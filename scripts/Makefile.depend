src = $(obj)

PHONY := __depend
__depend:

obj-y :=

include include/config/auto.conf
include scripts/Kbuild.include
include scripts/Makefile.lib

kbuild-dir := $(if $(filter /%,$(src)),$(src),$(srctree)/$(src))
kbuild-file := $(if $(wildcard $(kbuild-dir)/Kbuild),$(kbuild-dir)/Kbuild,$(kbuild-dir)/Makefile)
include $(kbuild-file)

obj-y := $(patsubst %,$(obj)/%,$(obj-y))
pkgdir-y := $(sort $(filter-out %/, $(obj-y)))
subdir-y := $(sort $(filter %/, $(obj-y)))

__depend: $(subdir-y) $(pkgdir-y)
	@:

PHONY += $(subdir-y)
$(subdir-y):
	$(Q)$(MAKE) $(depend)=$@

PHONY += $(pkgdir-y)
$(pkgdir-y):
	$(call cmd,add_dep)

PHONY += FORCE
FORCE:

.PHONY: $(PHONY)

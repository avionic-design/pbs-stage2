src = $(obj)

PHONY := __depend
__depend:

obj-y :=

include include/config/depends.conf
include scripts/Kbuild.include
include scripts/Makefile.lib

kbuild-dir := $(if $(filter /%,$(src)),$(src),$(srctree)/$(src))
kbuild-file := $(if $(wildcard $(kbuild-dir)/Kbuild),$(kbuild-dir)/Kbuild,$(kbuild-dir)/Makefile)
include $(kbuild-file)

$(depends):
	$(Q)$(MAKE) $(depend)=$(obj) $@=y depend

__depend: $(depends)

obj-y := $(patsubst %,$(obj)%,$(obj-y))
pkgdir-y := $(sort $(filter-out %/,$(obj-y)))
subdir-y := $(sort $(filter %/,$(obj-y)))

PHONY += $(subdir-y)
$(subdir-y):
	$(Q)$(MAKE) $(depend)=$(patsubst %//,%/,$@/) depend

PHONY += $(pkgdir-y)
$(pkgdir-y):
	@echo $@

depend: $(subdir-y) $(pkgdir-y)
	@:

PHONY += FORCE
FORCE:

.PHONY: $(PHONY)

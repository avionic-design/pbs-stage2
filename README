What is PBS:
------------

PBS is the Platform Build System. It is a set of scripts that automatically
build a defined set of software packages that can be installed in a root
filesystem or as an initial ramdisk.

PBS builds everything from source. To do this, it downloads software tarballs
from the internet and runs the contained build system to configure, build and
install each package.

The source tree contains the following directories:

	* arch: Architecture-specific definitions.
	* checksums: Checksum files to verify downloaded files against.
	* download: Destination directory for downloaded files.
	* packages: Package build scripts.
	* platforms: Platform build scripts.
	* scripts: PBS-related scripts and makefiles.
	* support: Miscellaneous support files.
	* toolchains: Cross-compilation toolchains.

In order to keep this tree clean, platforms should be built in separate build
directories. Typically, such a build directory would reside below the build
subdirectory in the source tree.

By passing the path (absolute or relative) to the build directory in the "O"
(output) variable, the PBS will know where to put temporary files.

Packages and platforms:
-----------------------

A package is any software component that can be built in an automated way.

A platform is a collection of packages and some additional files and scripts
to complete the root filesystem.


Building a toolchain:
---------------------

See Documentation/toolchains for details.


Configuring a platform:
-----------------------

A platform can be configured with the following command:

	$ make O=<build directory> menuconfig

When this command executes, it shows a dialog where the target hardware can be
configured and individual packages be selected for later inclusion in the root
filesystem.

PBS uses Kconfig to allow easy selection of software packages that are to be
built. Based on this configuration it generates a dependency list to make sure
that packets are built in the correct order.


Building a platform:
--------------------

Build a platform is done with the following command:

	$ make O=<build directory>

Where <build directory> is the directory where you already ran the menuconfig
command.


Packages:
---------

Packages in PBS are defined in the packages directory. They are categorized
by placing them into subdirectories.
To define a new packages, create a new directory with the name of the new
package in packages folder.
In order to build the package we need two files. The first one is a Kconfig
file. It will define the config variable for the package and is responsible
for dependeny tracking. The second file is the Makefile which defines the
actual build process.
To simplify package definition we have several predefined profiles. The most
common and recommended type of packages is auto-tools based (include
package/autotools.mk).
Once you're done with Makefile and Kconfig, you have to update the Kconfig and
Makefile of the parrent directory. Otherwise the new package is not known.
Finally you'll need to update one of the checksum files (usually sha256).


Build Process:
--------------

Each package is build in several steps. Each steps is marked complete with
stamp files created in the build directory. At the end of the build process
the following files are exist:
	.directory
	.chksum-<tarball>
	.checksum
	.extract-<tarball>
	.extract
	.setup
	.patch
	.configure
	.build                - Build the package
	.do-install           - 
	.prune                - Prune marked files
	.strip                - Strip the marked files
	.cleanup              - 
	.binary               - Create binary packages
	.install              - Install in sysroot dir


Requirements:
-------------

General requirements:

	- automake, autoconf, gcc, make
	- ncurses-devel
	- bash

Programs used to generate documentation during package creation:

	- texinfo
	- docbook-dtds,docbook-style-xsl
	  * Ubuntu: docbook-xml, docbook-xsl
	- xmlto

Libraries and tools required during platform setup:

	- gettext-devel
	- bison
	- flex, flex-static   (libs/pam)
	- expat-devel         (build-tools/dbus)
	- zlib-devel          (build-tools/glib)
	- libffi-devel        (build-tools/glib)
	- libpng-devel        (build-tools/gdk-pixbuf)
	- perl-XML-Simple     (build-tools/icon-naming-utils)
	  * Ubuntu: libxml-simple-perl

	- gperf               (core/udev - uclibc toolchain)
	- luadoc              (wm/awesome)
	- ImageMagick         (wm/awesome)
	  * Ubuntu: imagemagick
	- docbook-utils       (net/tunctl)
	- libgpg-error-devel  (libs/libgcrypt)
	- intltool            (libs/glib-networking)
--
vim: tw=78

From 31701f360e1107e1867cdd5628ecb0575a75578e Mon Sep 17 00:00:00 2001
From: Soeren Grunewald <soeren.grunewald@gmx.net>
Date: Thu, 11 Apr 2013 15:08:43 +0200
Subject: [PATCH 2/4] Rebase to 2013-04-09.

commit id is 7768342230450559509e3e593b2ea33e81ea0ca4

Note that we excluded the docs and test directory and all the
windows related stuff.
---
 ChangeLog                                          | 4254 +-------------------
 LICENSE_readme                                     |  137 +
 MAINTAINERS                                        |   13 +
 Makefile.in                                        |  209 +-
 aclocal.m4                                         |  393 +-
 autogen.sh                                         |    3 +
 autoregen.sh                                       |    2 +
 config.h.in                                        |   37 +-
 configure                                          | 2061 ++++++----
 configure.ac                                       |  101 +-
 docs/random/PORTED_09                              |   20 +
 ext/Makefile.am                                    |    6 -
 ext/Makefile.in                                    |  160 +-
 ext/aalib/Makefile.in                              |  124 +-
 ext/annodex/Makefile.in                            |  124 +-
 ext/annodex/gstannodex.c                           |    4 +
 ext/annodex/gstcmmlparser.c                        |    4 +
 ext/annodex/gstcmmltag.c                           |    4 +
 ext/cairo/Makefile.in                              |  125 +-
 ext/cairo/gsttextoverlay.c                         |   38 +-
 ext/cairo/gsttextoverlay.h                         |    8 +-
 ext/dv/Makefile.in                                 |  101 +-
 ext/esd/Makefile.in                                |  124 +-
 ext/esd/esdmon.c                                   |  465 +++
 ext/flac/Makefile.in                               |  124 +-
 ext/flac/gstflacdec.c                              |   81 +-
 ext/flac/gstflacdec.h                              |    2 +
 ext/flac/gstflacenc.c                              |    5 +-
 ext/gconf/Makefile.in                              |  124 +-
 ext/gdk_pixbuf/Makefile.am                         |    6 +-
 ext/gdk_pixbuf/Makefile.in                         |  144 +-
 ext/gdk_pixbuf/gst_loader.c                        |  281 ++
 ext/gdk_pixbuf/gstgdkanimation.c                   |  661 +++
 ext/gdk_pixbuf/gstgdkpixbuf.c                      |    8 +
 ext/gdk_pixbuf/gstgdkpixbufoverlay.c               |  533 +++
 ext/gdk_pixbuf/gstgdkpixbufoverlay.h               |   89 +
 ext/hal/Makefile.in                                |  124 +-
 ext/jack/Makefile.in                               |  124 +-
 ext/jack/gstjack.c                                 |   19 +
 ext/jack/gstjack.h                                 |   22 +-
 ext/jack/gstjackaudioclient.c                      |   94 +-
 ext/jack/gstjackaudioclient.h                      |    2 +
 ext/jack/gstjackaudiosink.c                        |   47 +-
 ext/jack/gstjackaudiosink.h                        |    1 +
 ext/jack/gstjackaudiosrc.c                         |   48 +-
 ext/jack/gstjackaudiosrc.h                         |    3 +-
 ext/jpeg/Makefile.in                               |  124 +-
 ext/jpeg/gstjpegdec.c                              |  835 +---
 ext/jpeg/gstjpegdec.h                              |   46 +-
 ext/jpeg/gstjpegenc.c                              |  359 +-
 ext/jpeg/gstjpegenc.h                              |   28 +-
 ext/libcaca/Makefile.in                            |  124 +-
 ext/libpng/Makefile.in                             |  124 +-
 ext/libpng/gstpng.h                                |   25 +
 ext/libpng/gstpngdec.c                             |  706 +---
 ext/libpng/gstpngdec.h                             |   29 +-
 ext/libpng/gstpngenc.c                             |  237 +-
 ext/libpng/gstpngenc.h                             |   13 +-
 ext/mikmod/Makefile.am                             |   11 +
 ext/mikmod/README                                  |   86 +
 ext/mikmod/drv_gst.c                               |  105 +
 ext/mikmod/gstmikmod.c                             |  554 +++
 ext/mikmod/gstmikmod.h                             |  109 +
 ext/mikmod/mikmod_reader.c                         |  113 +
 ext/mikmod/mikmod_types.c                          |  238 ++
 ext/mikmod/mikmod_types.h                          |   44 +
 ext/pulse/Makefile.in                              |  124 +-
 ext/pulse/pulseaudiosink.c                         |   13 +-
 ext/pulse/pulseprobe.c                             |    4 +
 ext/pulse/pulsesink.c                              |   12 +-
 ext/pulse/pulsesrc.c                               |   59 +-
 ext/raw1394/Makefile.in                            |  124 +-
 ext/raw1394/gst1394probe.c                         |    2 +
 ext/shout2/Makefile.in                             |  124 +-
 ext/soup/Makefile.in                               |  124 +-
 ext/soup/gstsouphttpsrc.c                          |   37 +-
 ext/speex/Makefile.in                              |  124 +-
 ext/speex/gstspeexdec.c                            |    5 +-
 ext/taglib/Makefile.am                             |    4 +-
 ext/taglib/Makefile.in                             |  148 +-
 ext/taglib/gstapev2mux.cc                          |   38 +-
 ext/taglib/gstapev2mux.h                           |    6 +-
 ext/taglib/gstid3v2mux.cc                          |   38 +-
 ext/taglib/gstid3v2mux.h                           |    6 +-
 ext/taglib/gsttaglibmux.c                          |  402 --
 ext/taglib/gsttaglibmux.h                          |   71 -
 ext/taglib/gsttaglibplugin.c                       |   49 +
 ext/wavpack/Makefile.in                            |  124 +-
 ext/wavpack/gstwavpackdec.c                        |  364 +-
 ext/wavpack/gstwavpackdec.h                        |   13 +-
 ext/wavpack/gstwavpackenc.c                        |  469 +--
 ext/wavpack/gstwavpackenc.h                        |    7 +-
 ext/wavpack/gstwavpackparse.c                      |   46 +-
 ext/wavpack/gstwavpackstreamreader.c               |    5 +-
 gconf/Makefile.in                                  |   56 +-
 gconf/gstreamer-0.10.schemas                       |  191 -
 gst-plugins-good.doap                              |   12 -
 gst-plugins-good.spec                              |  174 -
 gst/Makefile.in                                    |  154 +-
 gst/alpha/Makefile.in                              |  124 +-
 gst/alpha/gstalpha.c                               |    6 +
 gst/apetag/Makefile.in                             |  124 +-
 gst/audiofx/Makefile.in                            |  124 +-
 gst/audiofx/audiofirfilter.c                       |    4 +
 gst/audiofx/audiofxbasefirfilter.c                 |    2 +-
 gst/audiofx/audioiirfilter.c                       |    4 +
 gst/audioparsers/Makefile.am                       |    4 +-
 gst/audioparsers/Makefile.in                       |  137 +-
 gst/audioparsers/gstaacparse.c                     |  439 +-
 gst/audioparsers/gstaacparse.h                     |    2 +
 gst/audioparsers/gstac3parse.c                     |    5 +-
 gst/audioparsers/gstamrparse.c                     |    5 +-
 gst/audioparsers/gstdcaparse.c                     |    5 +-
 gst/audioparsers/gstflacparse.c                    |  141 +-
 gst/audioparsers/gstmpegaudioparse.c               |  177 +-
 gst/audioparsers/gstmpegaudioparse.h               |    2 +
 gst/audioparsers/gstwavpackparse.c                 |  648 +++
 gst/audioparsers/gstwavpackparse.h                 |  134 +
 gst/audioparsers/plugin.c                          |    3 +
 gst/auparse/Makefile.in                            |  124 +-
 gst/autodetect/Makefile.in                         |  124 +-
 gst/avi/Makefile.in                                |  124 +-
 gst/avi/avi-ids.h                                  |    1 +
 gst/avi/gstavidemux.c                              |  186 +-
 gst/avi/gstavimux.c                                |   83 +-
 gst/avi/gstavimux.h                                |    9 +-
 gst/cutter/Makefile.in                             |  124 +-
 gst/debugutils/Makefile.in                         |  124 +-
 gst/debugutils/rndbuffersize.c                     |   81 +-
 gst/deinterlace/Makefile.in                        |  104 +-
 gst/deinterlace/gstdeinterlace.c                   |   32 +-
 gst/deinterlace/gstdeinterlace.h                   |    2 +
 gst/deinterlace/gstdeinterlacemethod.c             |    4 +-
 gst/deinterlace/tvtime-dist.c                      |    8 +-
 gst/deinterlace/tvtime/greedyh.asm                 |    4 +-
 .../tvtime/tomsmocomp/SearchLoopTop.inc            |    2 +-
 gst/effectv/LICENSE                                |   14 +
 gst/effectv/Makefile.in                            |  124 +-
 gst/equalizer/Makefile.in                          |  130 +-
 gst/equalizer/gstiirequalizer.c                    |    7 +
 gst/equalizer/gstiirequalizer10bands.c             |   62 +-
 gst/equalizer/gstiirequalizer3bands.c              |   34 +-
 gst/flv/Makefile.in                                |  124 +-
 gst/flv/amfdefs.h                                  |    4 +-
 gst/flv/gstflvdemux.c                              |  141 +-
 gst/flv/gstflvmux.c                                |  151 +-
 gst/flv/gstflvmux.h                                |    8 +-
 gst/flx/Makefile.in                                |  124 +-
 gst/goom/Makefile.in                               |  125 +-
 gst/goom/filters_mmx.s                             |  216 +
 gst/goom/goomsl_lex.l                              |   94 +
 gst/goom/goomsl_yacc.y                             | 1438 +++++++
 gst/goom/surf3d.s                                  |  484 +++
 gst/goom2k1/Makefile.in                            |  124 +-
 gst/goom2k1/filters_mmx.s                          |  130 +
 gst/goom2k1/lines.c                                |    5 +
 gst/icydemux/Makefile.in                           |  124 +-
 gst/icydemux/gsticydemux.c                         |   10 +-
 gst/id3demux/Makefile.in                           |  124 +-
 gst/imagefreeze/Makefile.in                        |  124 +-
 gst/interleave/Makefile.in                         |  124 +-
 gst/interleave/interleave.c                        |  158 +-
 gst/interleave/interleave.h                        |    9 +-
 gst/isomp4/LEGAL                                   |   10 +
 gst/isomp4/Makefile.in                             |  124 +-
 gst/isomp4/gstqtmux.c                              |  139 +-
 gst/isomp4/gstqtmux.h                              |    9 +-
 gst/isomp4/gstqtmuxmap.c                           |    1 +
 gst/isomp4/qtdemux.c                               |  132 +-
 gst/isomp4/qtdemux.h                               |    2 +-
 gst/isomp4/qtdemux_dump.c                          |   22 +
 gst/isomp4/qtdemux_dump.h                          |    2 +
 gst/isomp4/qtdemux_fourcc.h                        |    8 +
 gst/isomp4/qtdemux_types.c                         |    1 +
 gst/law/Makefile.in                                |  124 +-
 gst/law/mulaw-conversion.c                         |    6 +-
 gst/level/Makefile.in                              |  124 +-
 gst/level/gstlevel.c                               |    1 -
 gst/matroska/Makefile.in                           |  124 +-
 gst/matroska/matroska-demux.c                      |  222 +-
 gst/matroska/matroska-demux.h                      |    4 +
 gst/matroska/matroska-mux.c                        |  660 +--
 gst/matroska/matroska-mux.h                        |    9 +-
 gst/matroska/matroska-parse.c                      |    4 +-
 gst/matroska/matroska-read-common.c                |   15 +-
 gst/matroska/matroska-read-common.h                |    2 +-
 gst/median/.gitignore                              |    7 +
 gst/median/Makefile.am                             |   10 +
 gst/median/gstmedian.c                             |  434 ++
 gst/median/gstmedian.h                             |   71 +
 gst/median/median.vcproj                           |  148 +
 gst/monoscope/Makefile.in                          |  124 +-
 gst/multifile/Makefile.in                          |  124 +-
 gst/multifile/gstmultifilesink.c                   |   18 +-
 gst/multifile/gstsplitfilesrc.c                    |  115 +-
 gst/multipart/Makefile.in                          |  124 +-
 gst/multipart/multipartmux.c                       |   20 +-
 gst/multipart/multipartmux.h                       |    6 +-
 gst/replaygain/Makefile.in                         |  124 +-
 gst/rtp/Makefile.in                                |  124 +-
 gst/rtp/gstrtpceltdepay.c                          |    2 +-
 gst/rtp/gstrtpdvdepay.c                            |   12 +-
 gst/rtp/gstrtpgstdepay.c                           |  277 +-
 gst/rtp/gstrtpgstpay.c                             |  444 +-
 gst/rtp/gstrtpgstpay.h                             |   12 +
 gst/rtp/gstrtph264depay.c                          |  400 +-
 gst/rtp/gstrtph264depay.h                          |    5 +
 gst/rtp/gstrtph264pay.c                            |  166 +-
 gst/rtp/gstrtpjpegpay.c                            |   20 +-
 gst/rtp/gstrtpmp2tdepay.c                          |   24 +-
 gst/rtp/gstrtpmp2tpay.c                            |   77 +-
 gst/rtp/gstrtpmparobustdepay.c                     |   21 +-
 gst/rtp/gstrtpqdmdepay.c                           |    4 +-
 gst/rtp/gstrtpsv3vdepay.c                          |    4 +-
 gst/rtp/gstrtptheoradepay.c                        |    9 -
 gst/rtpmanager/Makefile.in                         |  125 +-
 gst/rtpmanager/gstrtpbin.c                         |   28 +-
 gst/rtpmanager/gstrtpbin.h                         |    1 +
 gst/rtpmanager/gstrtpsession.c                     |   53 +-
 gst/rtpmanager/gstrtpssrcdemux.c                   |   22 +
 gst/rtpmanager/rtpsession.c                        |   35 +-
 gst/rtpmanager/rtpsession.h                        |    6 +-
 gst/rtpmanager/rtpsource.c                         |   31 +-
 gst/rtpmanager/rtpsource.h                         |    5 +-
 gst/rtsp/COPYING.MIT                               |   21 +
 gst/rtsp/Makefile.in                               |  124 +-
 gst/rtsp/URLS                                      |   38 +
 gst/rtsp/gstrtspsrc.c                              |  139 +-
 gst/rtsp/gstrtspsrc.h                              |    3 +
 gst/shapewipe/Makefile.am                          |    4 +-
 gst/shapewipe/Makefile.in                          |  131 +-
 gst/smpte/Makefile.in                              |  124 +-
 gst/smpte/gstsmpte.c                               |   72 +-
 gst/smpte/gstsmpte.h                               |    4 +-
 gst/spectrum/Makefile.in                           |  124 +-
 gst/udp/Makefile.in                                |  125 +-
 gst/udp/gstdynudpsink.c                            |    7 +-
 gst/udp/gstmultiudpsink.c                          |   17 +-
 gst/videobox/Makefile.in                           |  104 +-
 gst/videobox/gstvideoboxorc-dist.c                 |    2 +-
 gst/videocrop/Makefile.in                          |  124 +-
 gst/videocrop/gstvideocrop.c                       |  212 +-
 gst/videocrop/gstvideocrop.h                       |   11 +-
 gst/videofilter/Makefile.in                        |  124 +-
 gst/videofilter/gstvideobalance.c                  |   69 +
 gst/videofilter/gstvideoflip.c                     |  228 +-
 gst/videomixer/Makefile.in                         |  104 +-
 gst/videomixer/blend.c                             |    2 +-
 gst/videomixer/blendorc-dist.c                     |   14 +-
 gst/wavenc/Makefile.in                             |  124 +-
 gst/wavparse/Makefile.in                           |  124 +-
 gst/wavparse/gstwavparse.c                         |  185 +-
 gst/wavparse/gstwavparse.h                         |    2 +
 gst/y4m/Makefile.in                                |  124 +-
 ltmain.sh                                          |   34 +-
 m4/Makefile.in                                     |   51 +-
 m4/glibc2.m4                                       |   30 +
 m4/intl.m4                                         |  285 ++
 m4/intldir.m4                                      |   19 +
 m4/intmax.m4                                       |   33 +
 m4/libtool.m4                                      |   84 +-
 m4/lock.m4                                         |  316 ++
 m4/longlong.m4                                     |  109 +
 m4/printf-posix.m4                                 |   44 +
 m4/size_max.m4                                     |   68 +
 m4/visibility.m4                                   |   52 +
 m4/wchar_t.m4                                      |   20 +
 m4/wint_t.m4                                       |   28 +
 m4/xsize.m4                                        |   13 +
 pkgconfig/Makefile.in                              |   51 +-
 po/Makefile.in.in.orig                             |  429 ++
 po/Makevars.template                               |   41 +
 po/POTFILES.skip                                   |    6 +
 po/af.po                                           |    2 +-
 po/az.po                                           |    2 +-
 po/bg.po                                           |    2 +-
 po/ca.po                                           |  509 +--
 po/cs.po                                           |    2 +-
 po/da.po                                           |    2 +-
 po/de.po                                           |    2 +-
 po/el.po                                           |    2 +-
 po/en_GB.po                                        |    2 +-
 po/eo.po                                           |  247 +-
 po/es.po                                           |    2 +-
 po/eu.po                                           |    2 +-
 po/fi.po                                           |    2 +-
 po/fr.po                                           |    2 +-
 po/gl.po                                           |    2 +-
 po/gst-plugins-good-0.10.pot                       |  850 ----
 po/hu.po                                           |    2 +-
 po/id.po                                           |    2 +-
 po/it.po                                           |    2 +-
 po/ja.po                                           |    2 +-
 po/ky.po                                           |  475 +++
 po/lt.po                                           |    2 +-
 po/lv.po                                           |    2 +-
 po/mt.po                                           |    2 +-
 po/nb.po                                           |    2 +-
 po/nl.po                                           |    2 +-
 po/or.po                                           |    2 +-
 po/pl.po                                           |    2 +-
 po/pt_BR.po                                        |    2 +-
 po/ro.po                                           |    2 +-
 po/ru.po                                           |    2 +-
 po/sk.po                                           |    2 +-
 po/sl.po                                           |    2 +-
 po/sq.po                                           |    2 +-
 po/sr.po                                           |    2 +-
 po/sv.po                                           |    2 +-
 po/tr.po                                           |    2 +-
 po/uk.po                                           |    2 +-
 po/vi.po                                           |    2 +-
 po/zh_CN.po                                        |    2 +-
 po/zh_HK.po                                        |    2 +-
 po/zh_TW.po                                        |    2 +-
 stamp-h.in                                         |    1 +
 sys/Makefile.am                                    |    8 +-
 sys/Makefile.in                                    |  158 +-
 sys/directsound/Makefile.in                        |  124 +-
 sys/directsound/gstdirectsoundsink.c               |  145 +-
 sys/oss/Makefile.in                                |  124 +-
 sys/oss/gstossdmabuffer.c                          |  333 ++
 sys/oss/oss_probe.c                                |  256 ++
 sys/oss4/Makefile.in                               |  124 +-
 sys/oss4/oss4-audio.c                              |    4 +
 sys/oss4/oss4-property-probe.c                     |    4 +
 sys/osxaudio/Makefile.am                           |   18 +-
 sys/osxaudio/Makefile.in                           |  157 +-
 sys/osxaudio/gstosxaudioelement.c                  |    1 -
 sys/osxaudio/gstosxaudioelement.h                  |    8 +
 sys/osxaudio/gstosxaudiosink.c                     |  386 +-
 sys/osxaudio/gstosxaudiosink.h                     |    6 +-
 sys/osxaudio/gstosxaudiosrc.c                      |   45 +-
 sys/osxaudio/gstosxcoreaudio.c                     |  222 +
 sys/osxaudio/gstosxcoreaudio.h                     |  151 +
 sys/osxaudio/gstosxcoreaudiocommon.c               |  431 ++
 sys/osxaudio/gstosxcoreaudiocommon.h               |   65 +
 sys/osxaudio/gstosxcoreaudiohal.c                  | 1282 ++++++
 sys/osxaudio/gstosxcoreaudioremoteio.c             |  127 +
 sys/osxaudio/gstosxringbuffer.c                    |  543 +--
 sys/osxaudio/gstosxringbuffer.h                    |   21 +-
 sys/osxvideo/Makefile.am                           |   10 +-
 sys/osxvideo/Makefile.in                           |  146 +-
 sys/osxvideo/cocoawindow.h                         |   13 +-
 sys/osxvideo/cocoawindow.m                         |  488 ++-
 sys/osxvideo/osxvideosink.h                        |   74 +
 sys/osxvideo/osxvideosink.m                        |  557 ++-
 sys/sunaudio/Makefile.in                           |  124 +-
 sys/v4l2/Makefile.am                               |   17 +
 sys/v4l2/Makefile.in                               |  216 +-
 sys/v4l2/gstv4l2-marshal.list                      |    1 +
 sys/v4l2/gstv4l2bufferpool.c                       |   21 +-
 sys/v4l2/gstv4l2bufferpool.h                       |    3 +
 sys/v4l2/gstv4l2object.c                           |   58 +-
 sys/v4l2/gstv4l2sink.c                             |   14 +-
 sys/v4l2/gstv4l2src.c                              |   44 +-
 sys/v4l2/gstv4l2xoverlay.c                         |    4 +-
 sys/v4l2/v4l2_calls.c                              |    4 +-
 sys/v4l2/v4l2src_calls.c                           |    3 +
 sys/waveform/Makefile.am                           |   10 +-
 sys/waveform/Makefile.in                           |  137 +-
 sys/waveform/gstwaveformsink.c                     |   12 +-
 sys/ximage/Makefile.in                             |  124 +-
 sys/ximage/gstximagesrc.c                          |    3 +-
 win32/common/config.h-new                          |  454 +++
 365 files changed, 29348 insertions(+), 14802 deletions(-)
 create mode 100644 LICENSE_readme
 create mode 100644 MAINTAINERS
 create mode 100755 autoregen.sh
 create mode 100644 docs/random/PORTED_09
 create mode 100644 ext/esd/esdmon.c
 create mode 100644 ext/gdk_pixbuf/gst_loader.c
 create mode 100644 ext/gdk_pixbuf/gstgdkanimation.c
 create mode 100644 ext/gdk_pixbuf/gstgdkpixbufoverlay.c
 create mode 100644 ext/gdk_pixbuf/gstgdkpixbufoverlay.h
 create mode 100644 ext/libpng/gstpng.h
 create mode 100644 ext/mikmod/Makefile.am
 create mode 100644 ext/mikmod/README
 create mode 100644 ext/mikmod/drv_gst.c
 create mode 100644 ext/mikmod/gstmikmod.c
 create mode 100644 ext/mikmod/gstmikmod.h
 create mode 100644 ext/mikmod/mikmod_reader.c
 create mode 100644 ext/mikmod/mikmod_types.c
 create mode 100644 ext/mikmod/mikmod_types.h
 delete mode 100644 ext/taglib/gsttaglibmux.c
 delete mode 100644 ext/taglib/gsttaglibmux.h
 create mode 100644 ext/taglib/gsttaglibplugin.c
 delete mode 100644 gconf/gstreamer-0.10.schemas
 delete mode 100644 gst-plugins-good.spec
 create mode 100644 gst/audioparsers/gstwavpackparse.c
 create mode 100644 gst/audioparsers/gstwavpackparse.h
 create mode 100644 gst/effectv/LICENSE
 create mode 100644 gst/goom/filters_mmx.s
 create mode 100644 gst/goom/goomsl_lex.l
 create mode 100644 gst/goom/goomsl_yacc.y
 create mode 100644 gst/goom/surf3d.s
 create mode 100644 gst/goom2k1/filters_mmx.s
 create mode 100644 gst/isomp4/LEGAL
 create mode 100644 gst/median/.gitignore
 create mode 100644 gst/median/Makefile.am
 create mode 100644 gst/median/gstmedian.c
 create mode 100644 gst/median/gstmedian.h
 create mode 100644 gst/median/median.vcproj
 create mode 100644 gst/rtsp/COPYING.MIT
 create mode 100644 gst/rtsp/URLS
 create mode 100644 m4/glibc2.m4
 create mode 100644 m4/intl.m4
 create mode 100644 m4/intldir.m4
 create mode 100644 m4/intmax.m4
 create mode 100644 m4/lock.m4
 create mode 100644 m4/longlong.m4
 create mode 100644 m4/printf-posix.m4
 create mode 100644 m4/size_max.m4
 create mode 100644 m4/visibility.m4
 create mode 100644 m4/wchar_t.m4
 create mode 100644 m4/wint_t.m4
 create mode 100644 m4/xsize.m4
 create mode 100644 po/Makefile.in.in.orig
 create mode 100644 po/Makevars.template
 create mode 100644 po/POTFILES.skip
 create mode 100644 po/ky.po
 create mode 100644 stamp-h.in
 create mode 100644 sys/oss/gstossdmabuffer.c
 create mode 100644 sys/oss/oss_probe.c
 create mode 100644 sys/osxaudio/gstosxcoreaudio.c
 create mode 100644 sys/osxaudio/gstosxcoreaudio.h
 create mode 100644 sys/osxaudio/gstosxcoreaudiocommon.c
 create mode 100644 sys/osxaudio/gstosxcoreaudiocommon.h
 create mode 100644 sys/osxaudio/gstosxcoreaudiohal.c
 create mode 100644 sys/osxaudio/gstosxcoreaudioremoteio.c
 create mode 100644 sys/v4l2/gstv4l2-marshal.list
 create mode 100644 win32/common/config.h-new

diff --git a/ChangeLog b/ChangeLog
index efd0205..1308db3 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,3935 +1,24 @@
-=== release 0.10.31 ===
-
-2012-02-21  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* configure.ac:
-	  releasing 0.10.31, "Faster"
-
-2012-02-20 12:22:12 -0500  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtp/gstrtph264pay.c:
-	  rtph264pay: force baseline profile is profile-level-id is unspecified
-	  If profile-level-id is missing or invalid, we want any upstream
-	  encoder to default to baseline profile, so specify that in the
-	  caps we pass upstream. If the caps contain no profile restriction,
-	  an encoder may default to high or main profile.
-
-2012-02-17 17:21:53 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/equalizer/gstiirequalizer.c:
-	  equalizer: fix switching from passthrough to non-passthrough when parameters change
-	  commit b5bf0294 moved the if(need_new_coefficients) set_passthrough(equ)
-	  after the if(is_passthrough) return FLOW_OK shortcut, so the passthrough
-	  mode would never get updated even if the coefficients change.
-	  Fixes equalizer-test doing .. nothing.
-
-2012-02-16 17:14:20 +0800  Gary Ching-Pang Lin <chingpang@gmail.com>
-
-	* sys/v4l2/v4l2_calls.c:
-	  v4l2src: failure to query some optional controls is not a fatal error
-	  Don't post a (fatal) error message on the bus just because we
-	  failed to query some control. Fixes issue with built-in
-	  Suyin Corp webcam for HP notebook (usbid 064e:e28a) on
-	  OpenSuse 12.1, where querying red/blue balance fails.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=670197
-
-2012-02-16 12:59:10 +0000  Tuukka Pasanen <tuukka.pasanen@ilmi.fi>
-
-	* sys/v4l2/v4l2_calls.c:
-	  v4l2src: fix for webcamstudio vloopback
-	  Because vlooback emits 25 - ENOTTY and no EINVAL v4l2src thought it
-	  can't handle this and does not work.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=669455
-
-2012-02-13 12:06:37 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* tests/check/elements/flacparse.c:
-	  tests: flacparse: check and compare intended data
-
-2012-02-09 22:12:14 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* tests/check/elements/mpegaudioparse.c:
-	  tests: mpegaudioparse: remove stray declaration
-
-2012-02-09 10:11:48 +0100  Marc Leeman <marc.leeman@gmail.com>
-
-	* gst/udp/gstmultiudpsink.c:
-	  multiudpsink: typo fix (bytes send -> bytes sent)
-
-2012-02-07 14:10:44 -0800  Ralph Giles <giles@mozilla.com>
-
-	* ext/shout2/gstshout2.c:
-	  shout2send: send video/webm through libshout.
-	  This requires SHOUT_FORMAT_WEBM, added in libshout 2.3.0,
-	  so video/webm support is contingent on that symbol being
-	  defined.
-	  Also an indentation change required by the pre-commit hook.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=669590
-
-2012-01-28 11:13:16 +0100  Nicola Murino <nicola.murino@gmail.com>
-
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: avoid posting invalid duration for each frame
-	  https://bugzilla.gnome.org/show_bug.cgi?id=666583
-
-2012-02-05 13:40:13 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* configure.ac:
-	* win32/common/config.h:
-	  0.10.30.3 pre-release
-
-2012-02-03 22:05:59 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* ext/pulse/plugin.c:
-	  pulseaudiosink: Lower rank to prevent autoplugging
-	  pulseaudiosink breaks visualisations in its current form, so let's
-	  prevent it from being autoplugged for the time being.
-	  The best we can hope to do in the 0.10 series is query the list of
-	  available sinks and their formats, and expose these as the bin's sinkpad
-	  caps. While this is not a comprehensive solution, it will make sure that
-	  we're only trying to support compressed formats if we're certain that
-	  one exists.
-	  The long-term fix for this will be in the form of proper upstream
-	  renegotiation support in the 0.11/1.0 series.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=666361
-
-2012-02-03 14:53:31 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/flac/gstflacenc.c:
-	  flacenc: fix event leak when there is no peer on the src pad
-
-2012-02-02 12:27:09 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/flv/gstflvmux.c:
-	  flvmux: specify we only accept raw AAC in template caps
-	  No header seems to be added, and the codec ID is the same as used
-	  for raw by flvdemux, so raw seems the only supported case.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=665394
-
-2012-02-02 12:25:21 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/flv/gstflvdemux.c:
-	  flvdemux: specify we only output raw AAC in template caps
-	  https://bugzilla.gnome.org/show_bug.cgi?id=665394
-
-2012-01-30 14:52:37 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/rtp/gstrtpmp2tpay.c:
-	  rtpmp2tpay: do not try to flush a packet when no data is available
-	  https://bugzilla.gnome.org/show_bug.cgi?id=668874
-
-2010-06-11 08:36:33 +0200  Pascal Buhler <pascal.buhler@tandberg.com>
-
-	* gst/rtp/gstrtph264depay.c:
-	  rtph264depay: Exclude NALu size from payload length on truncated packets.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=667846
-
-2012-01-28 13:05:09 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/videobox/gstvideobox.c:
-	  videobox: avoid wrapping opaque to transparent
-
-2012-01-25 15:21:44 +0000  Jayakrishnan M <jay.krishnanm@gmail.com>
-
-	* ext/cairo/Makefile.am:
-	  cairo: fix build, make sure libgstvideo can be found
-	  https://bugzilla.gnome.org/show_bug.cgi?id=668648
-
-2012-01-25 13:19:12 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpbin.c:
-	* gst/rtpmanager/rtpsession.c:
-	  rtpmanager: don't pretend our random hostnames are fully-qualified domain names
-
-2012-01-23 13:15:46 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpbin.c:
-	* gst/rtpmanager/rtpsession.c:
-	  rtpmanager: don't reveal the user's username, hostname or real name by default
-	  Send a randomly made-up user@hostname as CNAME and don't
-	  send a NAME at all by default.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=668320
-
-2012-01-20 17:06:42 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: simplify internal src event debug logging
-	  ... which avoids almost superfluous obtaining of rtsp element.
-
-2012-01-20 17:03:50 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: avoid NULL string comparison
-
-2012-01-20 17:02:15 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtp/gstrtpmp4adepay.c:
-	  rtpmp4adepay: prevent out-of-bound array access
-
-2012-01-20 17:01:37 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/isomp4/atomsrecovery.c:
-	  isomp4: recovery: add sanity check
-	  ... on possibly bogus/corrupt input data.
-
-2012-01-20 16:58:28 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	  matroska-demux: remove redundant variable
-
-2012-01-20 16:57:52 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/deinterlace/gstdeinterlace.c:
-	  deinterlace: fix arithmetic for unsigned comparison
-
-2012-01-20 16:55:06 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/imagefreeze/gstimagefreeze.c:
-	  imagefreeze: add various missing break
-
-2012-01-20 16:49:14 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/alpha/gstalphacolor.c:
-	  alphacolor: remove redundant statement
-
-2012-01-20 16:48:49 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/flac/gstflacdec.c:
-	  flacdec: improve upstream peer duration querying
-	  ... to avoid accepting unhandled duration query result.
-
-2012-01-20 16:47:36 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/pulse/pulsesrc.c:
-	  pulsesrc: additional error condition checking
-
-2012-01-20 16:46:21 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/pulse/pulsesink.c:
-	  pulsesink: additional error condition checking
-
-2012-01-20 16:44:21 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/jpeg/gstjpegenc.c:
-	  jpegenc: check _alloc_buffer result and perform fallback alloc if needed
-	  ... rather than carrying on with NULL buffer.
-
-2012-01-13 18:11:36 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/pulse/pulsesrc.c:
-	  pulsesrc: fix wrong error check
-	  pa_stream_* functions return negative on error, despite the defines
-	  for error codes being positive.
-	  I only got to repro the error twice, so I'm not sure 100% sure this
-	  fixes the issue (the negative var being uninitialized after returning
-	  from pa_stream_get_latency).
-
-2012-01-16 17:51:18 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/cutter/gstcutter.c:
-	  cutter: fix leak of unused GValue
-
-2012-01-16 16:10:08 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* tests/check/elements/autodetect.c:
-	  tests: fix autodetect test not testing correctly for state change success
-	  State change to PAUSED can be done async, so if this happens, we need
-	  to wait for the change to be done (or failed).
-
-2012-01-16 15:42:46 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/rtp/gstrtph263ppay.c:
-	  rtph263ppay: fix caps leak
-
-2012-01-16 12:13:50 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/deinterlace/gstdeinterlace.c:
-	  deinterlace: make interlacedness test deterministic
-	  If the interlaced flag is not present in the caps, we assume the
-	  data is not interlaced, instead of leaving the boolean uninitialized.
-
-2012-01-13 17:43:49 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* sys/oss4/oss4-sink.c:
-	* sys/oss4/oss4-source.c:
-	  oss4: fix caps leaks
-
-2012-01-13 17:25:59 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* sys/v4l2/gstv4l2src.c:
-	  v4l2src: fix caps leak
-
-2012-01-13 15:57:20 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* tests/check/elements/videocrop.c:
-	  tests: fix caps leak in videocrop test
-
-2012-01-13 10:32:59 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpptdemux.c:
-	  rtpptdemux: plug pad leak in error code path
-	  Based on patch by: Stig Sandnes <stig.sandnes@cisco.com>
-	  Don't leak srcpad if there are no caps.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=667820
-
-2011-10-04 10:00:02 +0200  Stig Sandnes <stigsand@cisco.com>
-
-	* sys/osxvideo/cocoawindow.m:
-	  osxvideo: Fix leak of NSOpenGLPixelFormat object
-	  https://bugzilla.gnome.org/show_bug.cgi?id=667818
-
-2011-09-05 10:43:19 +0200  Havard Graff <havard.graff@tandberg.com>
-
-	* sys/v4l2/gstv4l2src.c:
-	  v4l2src: Don't assert when the interface is not implemented.
-	  Simply return FALSE instead.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=667817
-
-2012-01-12 00:18:39 +0200  Raimo Järvi <raimo.jarvi@gmail.com>
-
-	* sys/waveform/gstwaveformsink.c:
-	* sys/waveform/gstwaveformsink.h:
-	  waveformsink: Fix mingw warnings
-	  https://bugzilla.gnome.org/show_bug.cgi?id=667719
-
-2012-01-12 18:23:42 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpssrcdemux.c:
-	  gstrtpssrcdemux: fix element leak
-
-2012-01-12 14:19:22 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/matroska/matroska-read-common.c:
-	  matroska: do not leak attachment buffers
-
-2012-01-12 10:30:11 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/flac/gstflacenc.c:
-	  flacenc: do not drop the first data buffer on the floor (and leak it either)
-
-2012-01-11 18:45:33 -0300  Reynaldo H. Verdejo Pinochet <reynaldo@collabora.com>
-
-	* Android.mk:
-	  Temporarily disabling multifile for the Android build
-	  There is a hard dependency on inotify comming from gio. We
-	  are not currently bundling inotify with the Android dist so
-	  I'm disabling multifile for now until someone gets around
-	  to sort this out.
-	  This change fixes building on Android
-
-2012-01-11 01:45:34 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/pipelines/wavenc.c:
-	  tests: fix wavenc test on big endian
-	  wavenc only accepts little-endian PCM, but most of our
-	  elements such as audiotestsrc only produce or process
-	  audio in native endianness, so we need to plug a
-	  converter before wavenc on big endian systems.
-
-2012-01-05 19:25:33 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/isomp4/gstqtmux.c:
-	  isomp4: fix caps leak
-
-2012-01-05 19:08:03 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/isomp4/gstqtmux.c:
-	  isomp4: remove dead assignment
-
-2012-01-04 19:40:14 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* common:
-	  Automatic update of common submodule
-	  From 11f0cd5 to cb5da59
-
-2012-01-04 17:59:55 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/elements/qtmux.c:
-	  tests: fix some leaks and remove files when done in qtmux test
-
-2011-12-14 10:14:20 +0100  Peter Seiderer <ps.report@gmx.net>
-
-	* gst/multifile/gstmultifilesink.c:
-	  multifilesink: post better error message when we run out of disk space
-	  Map write errno ENOSPC to GST_RESOURCE_ERROR_NO_SPACE_LEFT.
-
-2011-12-27 11:50:03 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/udp/gstudpsrc.c:
-	  udpsrc: fix valgrind warning
-	  https://bugzilla.gnome.org/show_bug.cgi?id=666644
-
-2011-12-21 13:22:03 +0100  John Ogness <john.ogness@linutronix.de>
-
-	* gst/udp/gstudpsrc.c:
-	  udpsrc: drop dataless UDP packets
-	  It is allowed to send/receive UDP packets with no data. When such
-	  a packet is available, select() will return with success but
-	  ioctl(FIONREAD) will return 0. But a read() must still occur in
-	  order to clear off the UDP packet from the queue.
-	  This patch will read the dataless packet from the socket. If
-	  select() was woken for other reasons (and FIONREAD returns 0),
-	  this may result in a UDP packet getting accidentally dropped.
-	  But since UDP is not reliable, this is acceptable.
-	  NOTE: This patch fixes a nasty bug where sending a dataless
-	  UDP packet to a udpsrc instance will cause an infinite
-	  loop.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=666644
-	  Signed-off-by: John Ogness <john.ogness@linutronix.de>
-
-2011-12-21 20:50:21 +0100  Nicola Murino <nicola.murino@gmail.com>
-
-	* ext/jpeg/gstjpegdec.c:
-	  jpegdec: fix peer_caps leak
-	  https://bugzilla.gnome.org/show_bug.cgi?id=666688
-
-2011-12-25 14:23:29 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/flv/gstflvmux.c:
-	  flvmux: don't try to push already-freed buffers
-	  Fixes unit test.
-
-2011-09-09 11:42:09 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/audioparsers/gstac3parse.c:
-	  ac3parse: let bsid 9 and 10 through
-	  Files with 9 and 10 happen, and seem to comply with the <= 8
-	  format, so let them through.
-	  The spec says nothing about 9 and 10.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658546
-
-2011-12-16 19:15:38 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/flv/gstflvmux.c:
-	  flvmux: properly determine final duration
-	  ... which can be authoratively obtained from our own written timestamps.
-
-2011-12-19 13:56:30 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/flv/gstflvmux.c:
-	  flvmux: only write full metadata at start
-	  ... rather than having (potentially) unnecessary duplicates written all over,
-	  or even contradictory varying filesize info, or duration info that will not
-	  be rewritten upon header rewrite.
-
-2011-12-21 17:43:10 +0100  Branko Subasic <branko@axis.com>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-demux.h:
-	  matroskademux: do not consider duration of non-finalized file
-	  ... to avoid it clamping requested seek position.
-	  Non-finalized file case, determined by whether
-	  _parse_blockgroup_or_simpleblock ever updates the segment duration.
-	  Fixes #652195.
-
-2011-12-21 15:06:57 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: improve decision to fall back to scanning when seeking
-	  ... which is basically iff not streaming and no entry found in index
-
-2011-12-13 18:18:45 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/matroska/matroska-read-common.c:
-	  matroskademux: filter bogus index entries with missing block number
-	  ... to avoid contradictory information resulting in seeks sending more
-	  downstream than needed for the corresponding segment.
-
-2011-12-13 18:15:18 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: cater for safer arithmetic with global start time
-
-2011-12-13 17:02:01 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: tweak final closing segment sending
-	  ... to avoid it interfering with (sparse) stream syncing.
-
-2011-12-12 11:54:56 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst-libs/gst/glib-compat-private.h:
-	  glib-compat: Add license boilerplate for LGPL
-
-2011-12-12 15:15:46 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: mind (un)signed in some timestamp arithmetic
-	  ... to avoid ending up with invalid (negative) duration.
-
-2011-02-09 15:31:22 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/isomp4/qtdemux.c:
-	  qtdemux: increase parse tolerance for fuzzy file cases
-
-2011-12-12 10:38:20 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* Makefile.am:
-	  build: dist glib-compat-private.h properly
-	  Add missing slash.
-
-2011-12-12 10:18:14 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/elements/souphttpsrc.c:
-	  tests: use atexit, g_atexit has been deprecated in glib master
-
-2011-12-12 02:52:13 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/dv/gstdvdemux.c:
-	* ext/flac/gstflacdec.c:
-	* ext/wavpack/gstwavpackparse.c:
-	* gst/avi/gstavidemux.c:
-	* gst/flv/gstflvdemux.c:
-	* gst/imagefreeze/gstimagefreeze.c:
-	* gst/isomp4/gstqtmoovrecover.c:
-	* gst/isomp4/qtdemux.c:
-	* gst/matroska/matroska-demux.c:
-	* gst/rtpmanager/gstrtpssrcdemux.c:
-	* gst/rtsp/gstrtspsrc.c:
-	* gst/videomixer/videomixer2.c:
-	* gst/wavparse/gstwavparse.c:
-	  Suppress deprecation warnings in selected files, for g_static_rec_mutex_* mostly
-	  GStaticRecMutex is part of our API/ABI, not much we can do here
-	  in 0.10 for most of these.
-
-2011-12-12 02:41:37 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/elements/souphttpsrc.c:
-	* tests/icles/equalizer-test.c:
-	* tests/icles/gdkpixbufsink-test.c:
-	* tests/icles/test-oss4.c:
-	* tests/icles/videocrop-test.c:
-	  tests: g_thread_init() is deprecated in glib master
-	  It's not needed any longer.
-
-2011-12-12 02:38:37 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/soup/gstsouphttpclientsink.c:
-	* gst/rtpmanager/gstrtpsession.c:
-	* sys/oss4/oss4-mixer.c:
-	* tests/icles/v4l2src-test.c:
-	  Use g_thread_try_new() instead of g_thread_crate() with newer glib versions
-
-2011-12-12 02:31:36 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/alpha/gstalpha.c:
-	* gst/alpha/gstalpha.h:
-	  alpha: use new glib API for static mutex if available
-
-2011-12-12 02:30:45 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* Makefile.am:
-	* ext/jack/gstjackaudioclient.c:
-	* ext/pulse/pulseaudiosink.c:
-	* ext/pulse/pulsesink.c:
-	* ext/soup/gstsouphttpclientsink.c:
-	* gst-libs/gst/glib-compat-private.h:
-	* gst/audiofx/audiochebband.c:
-	* gst/audiofx/audiocheblimit.c:
-	* gst/audiofx/audiofirfilter.c:
-	* gst/audiofx/audioiirfilter.c:
-	* gst/audiofx/audiowsincband.c:
-	* gst/audiofx/audiowsinclimit.c:
-	* gst/equalizer/gstiirequalizer.c:
-	* gst/imagefreeze/gstimagefreeze.c:
-	* gst/rtpmanager/gstrtpbin.c:
-	* gst/rtpmanager/gstrtpjitterbuffer.c:
-	* gst/rtpmanager/gstrtpsession.c:
-	* gst/rtpmanager/rtpsession.c:
-	* gst/shapewipe/gstshapewipe.c:
-	* gst/udp/gstmultiudpsink.c:
-	* gst/videobox/gstvideobox.c:
-	* gst/videocrop/gstaspectratiocrop.c:
-	* gst/videomixer/videomixer.c:
-	* gst/videomixer/videomixer2.c:
-	* sys/oss4/oss4-mixer.c:
-	* sys/v4l2/gstv4l2bufferpool.c:
-	* sys/v4l2/gstv4l2xoverlay.c:
-	* sys/ximage/gstximagesrc.c:
-	  Work around deprecated thread API in glib master
-	  Add private replacements for deprecated functions such as
-	  g_mutex_new(), g_mutex_free(), g_cond_new() etc., mostly
-	  to avoid the deprecation warnings. We'll change these
-	  over to the new API once we depend on glib >= 2.32.
-
-2011-12-12 10:24:45 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* configure.ac:
-	  configure: Require GLib >= 2.24
-	  All other modules require this already and nobody is testing with
-	  older versions anyway.
-
-2011-12-11 18:40:31 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/gdk_pixbuf/gstgdkpixbufsink.c:
-	  gdkpixbufsink: fix inverted pixel-aspect-ratio
-	  Spotted by Mike Morrison.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=665882
-
-2011-12-11 17:55:14 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/pulse/pulseaudiosink.c:
-	  pulseaudiosink: don't leak pad template
-
-2011-12-10 15:13:07 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* configure.ac:
-	* gst/deinterlace/tvtime-dist.c:
-	* gst/videobox/gstvideoboxorc-dist.c:
-	* gst/videomixer/blendorc-dist.c:
-	* po/eo.po:
-	* win32/common/config.h:
-	  0.10.30.2 pre-release
-
-2011-12-10 14:48:57 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/soup/gstsouphttpclientsink.c:
-	  soup: fix start/stop race in souphttpclientsink
-	  Fix crash or hang in generic/states unit test when doing stop()
-	  right after start(). Create main loop in the start function already
-	  and not just in the thread function, so that stop() always has a
-	  valid main loop to quit on. Also, calling g_main_loop_quit() before
-	  g_main_loop_run() won't work and result in the stop function waiting
-	  for the thread to join forever. Therefore, wait for the thread to
-	  be ready and get the main loop running in the start() function, to
-	  be sure stop() always works.
-
-2011-12-10 13:35:08 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/files/Makefile.am:
-	  tests: dist test file used in matroskaparse unit test
-
-2011-12-10 12:32:32 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/elements/rgvolume.c:
-	  tests: fix up rgvolume test for basetransform event caching
-	  Some tests assumed that tag events would always pushed through
-	  immediately, which isn't the case any longer, so push a newsegment
-	  event and an empty buffer first.
-
-2011-12-10 02:21:02 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* po/LINGUAS:
-	* po/eo.po:
-	* po/ja.po:
-	* po/lv.po:
-	* po/sr.po:
-	  po: update translations
-
-2011-12-09 15:50:28 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/jack/gstjackaudiosink.c:
-	* ext/jack/gstjackaudiosrc.c:
-	  jack: don't leak client name when freeing the element
-	  And add gtk-doc chunks for the new property.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=665872
-
-2011-12-09 15:45:03 +0000  Nicolas Baron <hoggins@radiom.fr>
-
-	* ext/jack/gstjackaudiosink.c:
-	* ext/jack/gstjackaudiosink.h:
-	* ext/jack/gstjackaudiosrc.c:
-	* ext/jack/gstjackaudiosrc.h:
-	  jack: add "client-name" property to jackaudiosink and jackaudiosrc
-	  https://bugzilla.gnome.org/show_bug.cgi?id=665872
-
-2011-12-08 11:00:45 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/matroska/matroska-mux.c:
-	  matroskamux: stream-format=raw goes with aac caps, not mp3 caps
-
-2011-12-02 12:07:24 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* sys/v4l2/gstv4l2object.c:
-	  v4l2src: do not ignore the highest frame interval
-	  https://bugzilla.gnome.org/show_bug.cgi?id=665387
-
-2011-12-02 11:59:03 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* sys/v4l2/gstv4l2object.c:
-	  v4l2src: do not ignore the largest resolution
-	  The 'max' value isn't an STL style "one after the end" bound,
-	  but the largest allowed value.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=665387
-
-2011-12-06 16:47:25 +0100  Stefan Sauer <ensonic@users.sf.net>
-
-	* gst/multifile/gstmultifilesink.h:
-	  docs: add add the two enum values that were just added too
-
-2011-12-06 16:14:54 +0100  Stefan Sauer <ensonic@users.sf.net>
-
-	* docs/plugins/gst-plugins-good-plugins-sections.txt:
-	* gst/multifile/gstmultifilesink.h:
-	  multifilesink: expose the enum property docs for splitting mode.
-	  Fixes #665666.
-
-2011-12-05 12:15:21 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* sys/v4l2/gstv4l2object.c:
-	  v4l2: replace deprecated GST_CLASS_LOCK
-
-2011-11-24 13:58:01 +0100  Sebastian Rasmussen <sebrn@axis.com>
-
-	* gst/rtp/gstrtpjpegpay.c:
-	  rtpjpegpay: Ceil jpeg dimensions, instead of floor
-	  A JPEG image inside an RTP stream has a preceeding RFC2435 header that
-	  conveys width/height. The dimensions in this header are limited to be
-	  multiples of 8. Since JPEG uses an MCU of 8x8 pixels any image must
-	  already indirectly have image data dimensions that are rounded up in
-	  order to contain enough data to render the image. Therefore this fix
-	  safely rounds the image dimensions in the RFC2435 header up to the
-	  closest multiple of 8.
-
-2011-12-04 12:50:57 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/audioparsers/gstflacparse.c:
-	* gst/audioparsers/gstflacparse.h:
-	  flacparse: ensure we only check for sample/block mixup at start
-	  Otherwise we might trigger at some point within the file, but the
-	  check is only making sense for the second block.
-
-2011-12-03 18:14:59 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/matroska/matroska-parse.c:
-	  matroskaparse: warn if accumulating headers after they were pushed
-	  https://bugzilla.gnome.org/show_bug.cgi?id=665412
-
-2011-10-25 12:54:43 -0700  David Schleef <ds@schleef.org>
-
-	* gst/matroska/matroska-parse.c:
-	  matroskaparse: fix parsing
-	  Mark more parts as belonging to streamheaders.
-
-2011-12-03 17:30:10 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/flv/gstflvdemux.c:
-	  flvdemux: fix discontinuity threshold check when timestamps go backwards
-	  Since unsigned types are used, a negative value would show as very, very
-	  positive.
-	  Fixes A/V sync on some... less than well made files where timestamps go
-	  backwards.
-
-2011-12-02 12:01:22 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* sys/v4l2/gstv4l2object.c:
-	  v4l2src: add a comment about a "hidden" assumption on rank values
-	  https://bugzilla.gnome.org/show_bug.cgi?id=665387
-
-2011-12-01 14:13:05 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/Makefile.am:
-	  tests: fix up LIBS order som more`
-
-2011-12-01 13:22:42 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/matroska/matroska-mux.c:
-	  matroska-mux: fix name of new property and the unit test
-	  https://bugzilla.gnome.org/show_bug.cgi?id=654379
-
-2011-09-25 14:57:56 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/multifile/gstmultifilesink.c:
-	  multifilesink: add basic buffer list handling
-	  We assume for now that all buffers in a buffer list
-	  should end up in the same file (so we can group GOPs
-	  in buffer lists, for example). Could optimise this
-	  a bit to avoid the memcpy.
-
-2011-09-23 18:43:35 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/multifile/gstmultifilesink.c:
-	  multifilesink: write stream-headers when switching to the next file in max-size mode
-
-2011-09-23 18:31:01 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/multifile/gstmultifilesink.c:
-	* gst/multifile/gstmultifilesink.h:
-	  multifilesink: add new 'max-size' mode for switching to the next file
-
-2011-09-23 17:49:05 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/multifile/gstmultifilesink.c:
-	* gst/multifile/gstmultifilesink.h:
-	  multifilesink: add "max-file-size" property for new next-file mode
-
-2011-12-01 13:38:06 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: Don't forget SSA subtitles in last commit
-
-2011-12-01 13:34:52 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-ids.h:
-	  matroskademux: Only check for markup and escape if necessary for plaintext subtitles
-	  Otherwise we break USF and ASS/SSA subtitles.
-
-2011-12-01 13:23:33 +0100  Alessandro Decina <alessandro.d@gmail.com>
-
-	* gst/multifile/Makefile.am:
-	  multifile: fix build in uninstalled setup
-	  Add -base libs includes to CFLAGS, fix order of LIBS <cit>.
-
-2011-12-01 13:08:01 +0100  Alessandro Decina <alessandro.d@gmail.com>
-
-	* tests/check/elements/multifile.c:
-	  tests: fix g_mkdtemp presence check in multifile tests
-	  g_mkdtemp was added in glib 2.30 even though the doc claims it was added in
-	  2.26.
-
-2011-07-17 23:56:04 +0200  Alessandro Decina <alessandro.d@gmail.com>
-
-	* gst/multifile/Makefile.am:
-	* gst/multifile/gstmultifilesink.c:
-	* gst/multifile/gstmultifilesink.h:
-	* tests/check/Makefile.am:
-	* tests/check/elements/multifile.c:
-	  multifilesink: add flag to cut after a force key unit event
-
-2011-12-01 12:47:26 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: Copy all buffer flags when creating a subtitle buffer copy after postprocessing
-	  This also copies the caps. Otherwise we could end up pusing
-	  the first buffer without any caps, which causes downstream
-	  to not get notified about the caps.
-	  Fixes bug #664892.
-
-2011-10-11 02:07:13 +0200  Alexey Fisher <bug-track@fisher-privat.net>
-
-	* gst/matroska/matroska-mux.c:
-	  matroskamux: make default framerate optional per stream
-	  there is at least two use cases where default frame rate
-	  should or may be disabled:
-	  - vp8 stream with altref frame enabled. If default frame rate
-	  is enabled, some players will missinterprete it (critical!)
-	  - for webm container, to reduce micro overhead
-	  - for stream with variable frame rate.
-	  Signed-off-by: Alexey Fisher <bug-track@fisher-privat.net>
-
-2011-11-30 22:13:11 +0100  Stefan Sauer <ensonic@users.sf.net>
-
-	* gst/effectv/gstripple.c:
-	  rippletv: fix CLAMP end-values
-
-2011-11-30 19:25:37 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* docs/plugins/Makefile.am:
-	* docs/plugins/gst-plugins-good-plugins-docs.sgml:
-	* docs/plugins/gst-plugins-good-plugins-sections.txt:
-	* docs/plugins/gst-plugins-good-plugins.args:
-	* docs/plugins/gst-plugins-good-plugins.hierarchy:
-	* docs/plugins/gst-plugins-good-plugins.interfaces:
-	* docs/plugins/gst-plugins-good-plugins.signals:
-	* docs/plugins/inspect/plugin-1394.xml:
-	* docs/plugins/inspect/plugin-aasink.xml:
-	* docs/plugins/inspect/plugin-alaw.xml:
-	* docs/plugins/inspect/plugin-alpha.xml:
-	* docs/plugins/inspect/plugin-alphacolor.xml:
-	* docs/plugins/inspect/plugin-annodex.xml:
-	* docs/plugins/inspect/plugin-apetag.xml:
-	* docs/plugins/inspect/plugin-audiofx.xml:
-	* docs/plugins/inspect/plugin-audioparsers.xml:
-	* docs/plugins/inspect/plugin-auparse.xml:
-	* docs/plugins/inspect/plugin-autodetect.xml:
-	* docs/plugins/inspect/plugin-avi.xml:
-	* docs/plugins/inspect/plugin-cacasink.xml:
-	* docs/plugins/inspect/plugin-cairo.xml:
-	* docs/plugins/inspect/plugin-cutter.xml:
-	* docs/plugins/inspect/plugin-debug.xml:
-	* docs/plugins/inspect/plugin-deinterlace.xml:
-	* docs/plugins/inspect/plugin-dv.xml:
-	* docs/plugins/inspect/plugin-efence.xml:
-	* docs/plugins/inspect/plugin-effectv.xml:
-	* docs/plugins/inspect/plugin-equalizer.xml:
-	* docs/plugins/inspect/plugin-esdsink.xml:
-	* docs/plugins/inspect/plugin-flac.xml:
-	* docs/plugins/inspect/plugin-flv.xml:
-	* docs/plugins/inspect/plugin-flxdec.xml:
-	* docs/plugins/inspect/plugin-gconfelements.xml:
-	* docs/plugins/inspect/plugin-gdkpixbuf.xml:
-	* docs/plugins/inspect/plugin-goom.xml:
-	* docs/plugins/inspect/plugin-goom2k1.xml:
-	* docs/plugins/inspect/plugin-gstrtpmanager.xml:
-	* docs/plugins/inspect/plugin-halelements.xml:
-	* docs/plugins/inspect/plugin-icydemux.xml:
-	* docs/plugins/inspect/plugin-id3demux.xml:
-	* docs/plugins/inspect/plugin-imagefreeze.xml:
-	* docs/plugins/inspect/plugin-interleave.xml:
-	* docs/plugins/inspect/plugin-isomp4.xml:
-	* docs/plugins/inspect/plugin-jack.xml:
-	* docs/plugins/inspect/plugin-jpeg.xml:
-	* docs/plugins/inspect/plugin-level.xml:
-	* docs/plugins/inspect/plugin-matroska.xml:
-	* docs/plugins/inspect/plugin-monoscope.xml:
-	* docs/plugins/inspect/plugin-mulaw.xml:
-	* docs/plugins/inspect/plugin-multifile.xml:
-	* docs/plugins/inspect/plugin-multipart.xml:
-	* docs/plugins/inspect/plugin-navigationtest.xml:
-	* docs/plugins/inspect/plugin-oss4.xml:
-	* docs/plugins/inspect/plugin-ossaudio.xml:
-	* docs/plugins/inspect/plugin-png.xml:
-	* docs/plugins/inspect/plugin-pulseaudio.xml:
-	* docs/plugins/inspect/plugin-replaygain.xml:
-	* docs/plugins/inspect/plugin-rtp.xml:
-	* docs/plugins/inspect/plugin-rtsp.xml:
-	* docs/plugins/inspect/plugin-shapewipe.xml:
-	* docs/plugins/inspect/plugin-shout2send.xml:
-	* docs/plugins/inspect/plugin-smpte.xml:
-	* docs/plugins/inspect/plugin-soup.xml:
-	* docs/plugins/inspect/plugin-spectrum.xml:
-	* docs/plugins/inspect/plugin-speex.xml:
-	* docs/plugins/inspect/plugin-taglib.xml:
-	* docs/plugins/inspect/plugin-udp.xml:
-	* docs/plugins/inspect/plugin-video4linux2.xml:
-	* docs/plugins/inspect/plugin-videobox.xml:
-	* docs/plugins/inspect/plugin-videocrop.xml:
-	* docs/plugins/inspect/plugin-videofilter.xml:
-	* docs/plugins/inspect/plugin-videomixer.xml:
-	* docs/plugins/inspect/plugin-wavenc.xml:
-	* docs/plugins/inspect/plugin-wavpack.xml:
-	* docs/plugins/inspect/plugin-wavparse.xml:
-	* docs/plugins/inspect/plugin-ximagesrc.xml:
-	* docs/plugins/inspect/plugin-y4menc.xml:
-	  docs: update docs
-
-2011-11-30 19:00:42 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/multifile/Makefile.am:
-	* gst/multifile/gstsplitfilesrc.c:
-	* gst/multifile/patternspec.c:
-	* gst/multifile/patternspec.h:
-	  splitfilesrc: specify filenames via normal wildcards instead of regular expressions
-	  Less cracktastic in the end.
-
-2011-10-10 18:28:11 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/multifile/gstsplitfilesrc.c:
-	  splitfilesrc: check bytes actually read, just in case
-	  Handle corner case where we try to read beyond the end of the
-	  last file part, in which case we want to return a short read.
-	  If we get fewer bytes than expected for any other file part,
-	  we should just error out, since something fishy's going on
-	  then.
-
-2011-10-06 08:33:19 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/multifile/gstsplitfilesrc.c:
-	  splitfilesrc: set offsets on buffers
-	  Looks like some parsers (in some versions at least) expect the
-	  offsets to be set, and behave weird if that's not the case
-	  (e.g. off-by-one in h264parse).
-
-2011-07-28 20:19:56 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* configure.ac:
-	* gst/multifile/Makefile.am:
-	* gst/multifile/gstmultifile.c:
-	* gst/multifile/gstsplitfilesrc.c:
-	* gst/multifile/gstsplitfilesrc.h:
-	  multifile: add splitfilesrc element
-	  Add new splitfilesrc element that presents multiple files
-	  (selectable via a location regex) as one single contiguous
-	  file.
-
-2011-11-29 17:34:10 -0300  Thiago Santos <thiago.sousa.santos@collabora.com>
-
-	* ext/pulse/pulseaudiosink.c:
-	  Revert "pulseaudiosink: fix caps leak"
-	  This reverts commit d6a9de9e2aedc8b66ab3219902b5a37e8d65ada2.
-	  setcaps functions aren't supposed to take ownership of the caps passed
-
-2011-11-28 12:58:44 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/aalib/gstaasink.c:
-	* ext/annodex/gstcmmldec.c:
-	* ext/annodex/gstcmmlenc.c:
-	* ext/cairo/gstcairooverlay.c:
-	* ext/cairo/gstcairorender.c:
-	* ext/cairo/gsttextoverlay.c:
-	* ext/cairo/gsttimeoverlay.c:
-	* ext/dv/gstdvdec.c:
-	* ext/dv/gstdvdemux.c:
-	* ext/esd/esdmon.c:
-	* ext/esd/esdsink.c:
-	* ext/flac/gstflacdec.c:
-	* ext/flac/gstflacenc.c:
-	* ext/flac/gstflactag.c:
-	* ext/gconf/gstswitchsink.c:
-	* ext/gconf/gstswitchsrc.c:
-	* ext/gdk_pixbuf/gstgdkpixbuf.c:
-	* ext/gdk_pixbuf/gstgdkpixbufsink.c:
-	* ext/gdk_pixbuf/pixbufscale.c:
-	* ext/hal/gsthalaudiosink.c:
-	* ext/hal/gsthalaudiosrc.c:
-	* ext/jack/gstjackaudiosink.c:
-	* ext/jack/gstjackaudiosrc.c:
-	* ext/jpeg/gstjpegdec.c:
-	* ext/jpeg/gstjpegenc.c:
-	* ext/jpeg/gstsmokedec.c:
-	* ext/jpeg/gstsmokeenc.c:
-	* ext/libcaca/gstcacasink.c:
-	* ext/libmng/gstmngdec.c:
-	* ext/libmng/gstmngenc.c:
-	* ext/libpng/gstpngdec.c:
-	* ext/libpng/gstpngenc.c:
-	* ext/mikmod/gstmikmod.c:
-	* ext/pulse/pulseaudiosink.c:
-	* ext/pulse/pulsesink.c:
-	* ext/pulse/pulsesrc.c:
-	* ext/raw1394/gstdv1394src.c:
-	* ext/raw1394/gsthdv1394src.c:
-	* ext/shout2/gstshout2.c:
-	* ext/soup/gstsouphttpclientsink.c:
-	* ext/soup/gstsouphttpsrc.c:
-	* ext/speex/gstspeexdec.c:
-	* ext/speex/gstspeexenc.c:
-	* ext/taglib/gstapev2mux.cc:
-	* ext/taglib/gstid3v2mux.cc:
-	* ext/taglib/gsttaglibmux.c:
-	* ext/wavpack/gstwavpackdec.c:
-	* ext/wavpack/gstwavpackenc.c:
-	* ext/wavpack/gstwavpackparse.c:
-	* gst/alpha/gstalpha.c:
-	* gst/alpha/gstalphacolor.c:
-	* gst/apetag/gstapedemux.c:
-	* gst/audiofx/audiopanorama.c:
-	* gst/audioparsers/gstaacparse.c:
-	* gst/audioparsers/gstac3parse.c:
-	* gst/audioparsers/gstamrparse.c:
-	* gst/audioparsers/gstdcaparse.c:
-	* gst/audioparsers/gstflacparse.c:
-	* gst/audioparsers/gstmpegaudioparse.c:
-	* gst/auparse/gstauparse.c:
-	* gst/autodetect/gstautoaudiosink.c:
-	* gst/autodetect/gstautoaudiosrc.c:
-	* gst/autodetect/gstautovideosink.c:
-	* gst/autodetect/gstautovideosrc.c:
-	* gst/avi/gstavidemux.c:
-	* gst/avi/gstavimux.c:
-	* gst/avi/gstavisubtitle.c:
-	* gst/cutter/gstcutter.c:
-	* gst/debugutils/breakmydata.c:
-	* gst/debugutils/cpureport.c:
-	* gst/debugutils/efence.c:
-	* gst/debugutils/gstcapsdebug.c:
-	* gst/debugutils/gstcapssetter.c:
-	* gst/debugutils/gstnavigationtest.c:
-	* gst/debugutils/gstnavseek.c:
-	* gst/debugutils/gstpushfilesrc.c:
-	* gst/debugutils/gsttaginject.c:
-	* gst/debugutils/progressreport.c:
-	* gst/debugutils/rndbuffersize.c:
-	* gst/debugutils/testplugin.c:
-	* gst/deinterlace/gstdeinterlace.c:
-	* gst/effectv/gstaging.c:
-	* gst/effectv/gstdice.c:
-	* gst/effectv/gstedge.c:
-	* gst/effectv/gstop.c:
-	* gst/effectv/gstquark.c:
-	* gst/effectv/gstradioac.c:
-	* gst/effectv/gstrev.c:
-	* gst/effectv/gstripple.c:
-	* gst/effectv/gstshagadelic.c:
-	* gst/effectv/gststreak.c:
-	* gst/effectv/gstvertigo.c:
-	* gst/effectv/gstwarp.c:
-	* gst/flv/gstflvdemux.c:
-	* gst/flv/gstflvmux.c:
-	* gst/flx/gstflxdec.c:
-	* gst/goom/gstgoom.c:
-	* gst/goom2k1/gstgoom.c:
-	* gst/icydemux/gsticydemux.c:
-	* gst/id3demux/gstid3demux.c:
-	* gst/imagefreeze/gstimagefreeze.c:
-	* gst/interleave/deinterleave.c:
-	* gst/interleave/interleave.c:
-	* gst/isomp4/gstqtmux.c:
-	* gst/isomp4/gstrtpxqtdepay.c:
-	* gst/isomp4/qtdemux.c:
-	* gst/law/alaw-decode.c:
-	* gst/law/alaw-encode.c:
-	* gst/law/mulaw-decode.c:
-	* gst/law/mulaw-encode.c:
-	* gst/level/gstlevel.c:
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-mux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/webm-mux.c:
-	* gst/median/gstmedian.c:
-	* gst/monoscope/gstmonoscope.c:
-	* gst/multifile/gstmultifilesink.c:
-	* gst/multifile/gstmultifilesrc.c:
-	* gst/multipart/multipartdemux.c:
-	* gst/multipart/multipartmux.c:
-	* gst/replaygain/gstrganalysis.c:
-	* gst/replaygain/gstrglimiter.c:
-	* gst/replaygain/gstrgvolume.c:
-	* gst/rtp/gstasteriskh263.c:
-	* gst/rtp/gstrtpL16depay.c:
-	* gst/rtp/gstrtpL16pay.c:
-	* gst/rtp/gstrtpac3depay.c:
-	* gst/rtp/gstrtpac3pay.c:
-	* gst/rtp/gstrtpamrdepay.c:
-	* gst/rtp/gstrtpamrpay.c:
-	* gst/rtp/gstrtpbvdepay.c:
-	* gst/rtp/gstrtpbvpay.c:
-	* gst/rtp/gstrtpceltdepay.c:
-	* gst/rtp/gstrtpceltpay.c:
-	* gst/rtp/gstrtpdepay.c:
-	* gst/rtp/gstrtpdvdepay.c:
-	* gst/rtp/gstrtpdvpay.c:
-	* gst/rtp/gstrtpg722depay.c:
-	* gst/rtp/gstrtpg722pay.c:
-	* gst/rtp/gstrtpg723depay.c:
-	* gst/rtp/gstrtpg723pay.c:
-	* gst/rtp/gstrtpg726depay.c:
-	* gst/rtp/gstrtpg726pay.c:
-	* gst/rtp/gstrtpg729depay.c:
-	* gst/rtp/gstrtpg729pay.c:
-	* gst/rtp/gstrtpgsmdepay.c:
-	* gst/rtp/gstrtpgsmpay.c:
-	* gst/rtp/gstrtpgstdepay.c:
-	* gst/rtp/gstrtpgstpay.c:
-	* gst/rtp/gstrtph263depay.c:
-	* gst/rtp/gstrtph263pay.c:
-	* gst/rtp/gstrtph263pdepay.c:
-	* gst/rtp/gstrtph263ppay.c:
-	* gst/rtp/gstrtph264depay.c:
-	* gst/rtp/gstrtph264pay.c:
-	* gst/rtp/gstrtpilbcdepay.c:
-	* gst/rtp/gstrtpilbcpay.c:
-	* gst/rtp/gstrtpj2kdepay.c:
-	* gst/rtp/gstrtpj2kpay.c:
-	* gst/rtp/gstrtpjpegdepay.c:
-	* gst/rtp/gstrtpjpegpay.c:
-	* gst/rtp/gstrtpmp1sdepay.c:
-	* gst/rtp/gstrtpmp2tdepay.c:
-	* gst/rtp/gstrtpmp2tpay.c:
-	* gst/rtp/gstrtpmp4adepay.c:
-	* gst/rtp/gstrtpmp4apay.c:
-	* gst/rtp/gstrtpmp4gdepay.c:
-	* gst/rtp/gstrtpmp4gpay.c:
-	* gst/rtp/gstrtpmp4vdepay.c:
-	* gst/rtp/gstrtpmp4vpay.c:
-	* gst/rtp/gstrtpmpadepay.c:
-	* gst/rtp/gstrtpmpapay.c:
-	* gst/rtp/gstrtpmparobustdepay.c:
-	* gst/rtp/gstrtpmpvdepay.c:
-	* gst/rtp/gstrtpmpvpay.c:
-	* gst/rtp/gstrtppcmadepay.c:
-	* gst/rtp/gstrtppcmapay.c:
-	* gst/rtp/gstrtppcmudepay.c:
-	* gst/rtp/gstrtppcmupay.c:
-	* gst/rtp/gstrtpqcelpdepay.c:
-	* gst/rtp/gstrtpqdmdepay.c:
-	* gst/rtp/gstrtpsirendepay.c:
-	* gst/rtp/gstrtpsirenpay.c:
-	* gst/rtp/gstrtpspeexdepay.c:
-	* gst/rtp/gstrtpspeexpay.c:
-	* gst/rtp/gstrtpsv3vdepay.c:
-	* gst/rtp/gstrtptheoradepay.c:
-	* gst/rtp/gstrtptheorapay.c:
-	* gst/rtp/gstrtpvorbisdepay.c:
-	* gst/rtp/gstrtpvorbispay.c:
-	* gst/rtp/gstrtpvrawdepay.c:
-	* gst/rtp/gstrtpvrawpay.c:
-	* gst/rtpmanager/gstrtpbin.c:
-	* gst/rtpmanager/gstrtpjitterbuffer.c:
-	* gst/rtpmanager/gstrtpptdemux.c:
-	* gst/rtpmanager/gstrtpsession.c:
-	* gst/rtpmanager/gstrtpssrcdemux.c:
-	* gst/rtsp/gstrtpdec.c:
-	* gst/rtsp/gstrtspsrc.c:
-	* gst/shapewipe/gstshapewipe.c:
-	* gst/smpte/gstsmpte.c:
-	* gst/smpte/gstsmptealpha.c:
-	* gst/udp/gstdynudpsink.c:
-	* gst/udp/gstmultiudpsink.c:
-	* gst/udp/gstudpsrc.c:
-	* gst/videobox/gstvideobox.c:
-	* gst/videocrop/gstaspectratiocrop.c:
-	* gst/videocrop/gstvideocrop.c:
-	* gst/videofilter/gstgamma.c:
-	* gst/videofilter/gstvideobalance.c:
-	* gst/videofilter/gstvideoflip.c:
-	* gst/videomixer/videomixer.c:
-	* gst/videomixer/videomixer2.c:
-	* gst/wavenc/gstwavenc.c:
-	* gst/wavparse/gstwavparse.c:
-	* gst/y4m/gsty4mencode.c:
-	* sys/directsound/gstdirectsoundsink.c:
-	* sys/oss/gstosssink.c:
-	* sys/oss/gstosssrc.c:
-	* sys/oss4/oss4-sink.c:
-	* sys/oss4/oss4-source.c:
-	* sys/osxaudio/gstosxaudiosink.c:
-	* sys/osxaudio/gstosxaudiosrc.c:
-	* sys/osxvideo/osxvideosink.m:
-	* sys/sunaudio/gstsunaudiosink.c:
-	* sys/sunaudio/gstsunaudiosrc.c:
-	* sys/v4l2/gstv4l2sink.c:
-	* sys/v4l2/gstv4l2src.c:
-	* sys/waveform/gstwaveformsink.c:
-	* sys/ximage/gstximagesrc.c:
-	* tests/check/elements/qtmux.c:
-	  various: fix pad template leaks
-	  https://bugzilla.gnome.org/show_bug.cgi?id=662664
-
-2011-11-28 11:47:11 +0100  Chad <channa@caltech.edu>
-
-	* gst/debugutils/gsttaginject.c:
-	  taginject: set gap-aware
-	  The element does not modify the data anyway.
-
-2011-11-26 21:39:33 +0100  Stefan Sauer <ensonic@users.sf.net>
-
-	* gst/equalizer/gstiirequalizer.c:
-	  equalizer: also sync the parameters for the filter bands
-
-2011-11-26 16:06:59 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/matroska/matroska-ids.c:
-	  matroskademux: initialise seen_markup_tag field on subtitle stream context
-
-2011-11-25 19:28:55 -0300  Thiago Santos <thiago.sousa.santos@collabora.com>
-
-	* gst/isomp4/gstqtmuxmap.c:
-	  ismlmux: Use iso-fragmented as variant type
-	  Using 'iso' conflicts with mp4mux variant type, ismlmux now
-	  uses iso-fragmented
-	  Fixes #656823
-
-2011-11-24 12:05:33 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* ext/pulse/pulsesrc.c:
-	* ext/pulse/pulsesrc.h:
-	  pulsesrc: Implement GstStreamVolume interface
-	  PulseAudio 1.0 supports per-source-output volumes, and this exposes the
-	  functionality via the GstStreamVolume interface.
-	  When compiled against pre-1.0 PulseAudio, the interface is not
-	  implemented, and the "volume" or "mute" properties are not available.
-	  This bit of ugliness will go away when we can depend on PulseAudio 1.0
-	  or greater.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=595055
-
-2011-09-10 21:21:38 -0700  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* ext/pulse/pulsesrc.c:
-	  pulsesrc: Trivial comment copy-paste-o fix
-
-2011-11-14 12:43:27 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* ext/pulse/pulseaudiosink.c:
-	  pulseaudiosink: Remove redundant code
-
-2011-11-14 12:41:41 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* ext/pulse/pulseaudiosink.c:
-	  pulseaudiosink: Clean up refcounting in event probe
-	  Makes sure we don't leak a refcount if the object is disposed before a
-	  NEWSEGMENT turns up.
-
-2011-11-24 16:31:38 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/flv/gstflvdemux.c:
-	  flvdemux: fix seeking
-	  Which I accidentally broke when fixing flv videos breaking on
-	  spurious timestamp discontinuities in broken files.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=631430
-
-2011-11-25 13:13:47 +0100  Stefan Sauer <ensonic@users.sf.net>
-
-	* gst/effectv/gstradioac.c:
-	* gst/effectv/gstradioac.h:
-	  effectv: repair color modes in radioactv by taking rgb,bgr into account
-
-2011-11-25 11:44:49 +0100  Stefan Sauer <ensonic@users.sf.net>
-
-	* gst/effectv/gstradioac.c:
-	  radioactv: add one more set of caps
-	  It also work in this format. Avoids the need for conversion.
-
-2011-11-25 11:44:18 +0100  Stefan Sauer <ensonic@users.sf.net>
-
-	* gst/effectv/gstradioac.c:
-	* gst/effectv/gstshagadelic.c:
-	  effecttv: fix reverse negotiation
-	  The plugins were using _fixed_caps_ and thus not adjusting to new upstream
-	  sizes. Spotted by Tim Müller.
-
-2011-11-25 11:43:16 +0100  Stefan Sauer <ensonic@users.sf.net>
-
-	* gst/effectv/gstwarp.c:
-	  warptv: remove not needed ifdef
-
-2011-11-25 10:15:35 +0100  Stefan Sauer <ensonic@users.sf.net>
-
-	* gst/effectv/gstripple.c:
-	  rippletv: clean up the rendering code a bit
-	  This is corrrupts the memoy when resizing. Add a FIXME to make it resizeable
-	  once that is solved.
-
-2011-11-24 20:42:49 +0100  Stefan Sauer <ensonic@users.sf.net>
-
-	* gst/effectv/gstquark.c:
-	* gst/effectv/gststreak.c:
-	* gst/effectv/gstvertigo.c:
-	* gst/effectv/gstwarp.c:
-	  effecttv: fix reverse negotiation
-	  The plugins were using _fixed_caps_ and thus not adjusting to new upstream
-	  sizes. Spotted by Tim Müller.
-
-2011-11-24 14:14:53 -0300  Thiago Santos <thiago.sousa.santos@collabora.com>
-
-	* gst/multifile/gstmultifilesink.c:
-	  multifilesink: Fix leak of filename strings
-	  Do not forget to free the filename strings when deleting
-	  the list of files.
-
-2011-11-24 14:11:33 -0300  Thiago Santos <thiago.sousa.santos@collabora.com>
-
-	* tests/check/elements/multifile.c:
-	  multifile: fix build of tests
-	  Tests fail to build because g_mkdtemp is available from glib since
-	  2.26.
-	  This patch adds a condition around the redefinition of
-	  g_mkdtemp on the tests to only build it if glib is older than
-	  2.26.
-
-2011-09-27 16:49:45 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/wavparse/gstwavparse.c:
-	  wavparse: skip id32 tags
-	  This allows decoding at least one sample where something has
-	  stuffed some ID3 tag before the (supposedly initial) FMT\ .
-	  https://bugzilla.gnome.org/show_bug.cgi?id=660249
-
-2011-10-31 17:06:18 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/effectv/gstedge.c:
-	  edgetv: trivial comment fix for clarity
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661841
-
-2011-10-31 17:04:23 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/effectv/gstedge.c:
-	  edgetv: don't leave bits of the output buffer uninitialized
-	  Let's initialize them to zero. It looks alright, but then it
-	  also looks alright with v3, or with the corresponding pixels
-	  from the source. I don't know what the original intent would
-	  be, and the original effectv source also has this bug/feature.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661841
-
-2011-11-24 10:25:02 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/audioparsers/gstaacparse.c:
-	* gst/audioparsers/gstac3parse.c:
-	* gst/audioparsers/gstamrparse.c:
-	* gst/audioparsers/gstdcaparse.c:
-	* gst/audioparsers/gstflacparse.c:
-	* gst/audioparsers/gstmpegaudioparse.c:
-	  audioparse: Use the sinkpad template caps as fallback, not the srcpad ones
-
-2011-11-24 09:59:40 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/audioparsers/gstmpegaudioparse.c:
-	  mpegaudioparse: Implement ::get_sink_caps vfunc to propagate downstream caps constraints upstream
-
-2011-11-24 09:57:57 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/audioparsers/gstflacparse.c:
-	  flacparse: Implement ::get_sink_caps vfunc to propagate downstream caps constraints upstream
-
-2011-11-24 09:55:47 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/audioparsers/gstdcaparse.c:
-	  dcaparse: Implement ::get_sink_caps vfunc to propagate downstream caps constraints upstream
-
-2011-11-24 09:53:18 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/audioparsers/gstamrparse.c:
-	  amrparse: Implement ::get_sink_caps vfunc to propagate downstream caps constraints upstream
-
-2011-11-24 09:49:27 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/audioparsers/gstamrparse.c:
-	  amrparse: Mark some more functions as static
-
-2011-11-24 09:48:33 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/audioparsers/gstac3parse.c:
-	  ac3parse: Implement ::get_sink_caps vfunc to propagate downstream caps constraints upstream
-
-2011-11-24 09:44:58 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/audioparsers/gstaacparse.c:
-	  aacparse: Mark some functions as static and remove unused function declarations
-
-2011-11-24 09:43:14 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/audioparsers/gstaacparse.c:
-	  aacparse: Implement ::get_sink_caps vfunc to propagate downstream caps constraints upstream
-
-2011-11-23 00:57:39 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/Makefile.am:
-	* tests/check/elements/.gitignore:
-	* tests/check/elements/matroskaparse.c:
-	* tests/files/pinknoise-vorbis.mkv:
-	  tests: add basic unit test for matroskaparse
-
-2011-11-23 00:56:26 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/matroska/matroska-parse.c:
-	  matroskaparse: don't leak stream headers
-	  https://bugzilla.gnome.org/show_bug.cgi?id=664548
-
-2011-11-16 19:08:05 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/speex/gstspeexenc.c:
-	  speexenc: ensure to free allocated padded data
-
-2011-11-16 18:57:38 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/speex/gstspeexenc.c:
-	  speexenc: reset tag setter interface when appropriate
-
-2011-11-16 18:57:21 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/flac/gstflacenc.c:
-	  flacenc: reset tag setter interface when appropriate
-
-2011-11-14 15:34:57 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/audioparsers/gstflacparse.c:
-	* gst/audioparsers/gstflacparse.h:
-	  flacparse: detect when a file lies about fixed block size
-	  If the sample/block number happens to be the same as the block
-	  size, we assume variable block size, and thus counters in samples
-	  in the headers. This can only get us a false positive for a block
-	  size of 1, which is invalid. We can get false negatives more
-	  often though (eg, if not starting at the start of the stream),
-	  but then that's already GIGO.
-
-2011-09-02 19:20:07 -0400  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtpmanager/gstrtpsession.c:
-	  gstrtpsession: Add special mode to use FIR as repair as Google does
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658419
-
-2011-09-01 17:47:38 -0400  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtpmanager/gstrtpsession.c:
-	* gst/rtpmanager/rtpsession.c:
-	* gst/rtpmanager/rtpsession.h:
-	* gst/rtpmanager/rtpsource.h:
-	  rtpsession: Send FIR requests in response to key unit requests with all-headers=TRUE
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658419
-
-2011-09-01 16:25:21 -0400  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtpmanager/gstrtpsession.c:
-	* gst/rtpmanager/rtpsession.c:
-	* gst/rtpmanager/rtpsession.h:
-	* gst/rtpmanager/rtpsource.h:
-	  rtpsession: Put the PLI requests in each RTPSource
-	  Also refactor a bit and put all the keyframe request code in one
-	  place inside rtpsession.c
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658419
-
-2011-08-31 14:35:33 -0400  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtpmanager/rtpsession.c:
-	  rtpsession: Hack to FIR because Google doesn't set the sender ssrc correctly
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658419
-
-2011-08-30 19:06:13 -0400  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtpmanager/rtpsession.c:
-	* gst/rtpmanager/rtpsession.h:
-	  rtpsession: Process received Full Intra Requests
-	  Process FIR requests according to RFC 5104
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658419
-
-2011-11-07 18:43:26 +0000  Sjoerd Simons <sjoerd.simons@collabora.co.uk>
-
-	* sys/v4l2/gstv4l2object.c:
-	  v4l2: Set pixel-aspect-ratio to 1/1
-	  We don't currently support setting the pixel-aspect-ratio from V4L2. So
-	  simply set it to be 1/1 in the caps to prevent negotiation failures when
-	  fixating to weird values (e.g. when the downstream caps has
-	  pixel-aspect-ratio = [ MIN, MAX ] )
-	  https://bugzilla.gnome.org/show_bug.cgi?id=663580
-
-2011-11-11 10:06:25 -0300  Thiago Santos <thiago.sousa.santos@collabora.com>
-
-	* ext/pulse/pulseaudiosink.c:
-	  pulseaudiosink: fix caps leak
-
-2011-11-11 14:55:48 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/pulse/pulsesink.c:
-	  pulsesink: do not leak clientname when setting up property
-
-2011-11-11 18:05:35 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* ext/pulse/pulseaudiosink.c:
-	  pulse: Chain up dispose() in pulseaudiosink
-
-2011-11-08 15:35:26 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/avi/gstavidemux.c:
-	  avidemux: fix wrong stride when inverting uncompressed video
-	  Such frames have a stride multiple of 4, see
-	  http://lscube.org/pipermail/ffmpeg-issues/2010-April/010247.html.
-	  This showed up on a sample using a odd width of 24 bit video.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=652288
-
-2011-11-09 10:32:06 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/isomp4/qtdemux.c:
-	  qtdemux: minimal sanity check on creation datetime
-
-2011-11-02 12:58:12 -0400  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtp/gstrtph263ppay.c:
-	  rtph263ppay: Return the sink pad template as sink caps, not the src's
-	  https://bugzilla.gnome.org/show_bug.cgi?id=577784
-
-2009-03-15 19:26:48 -0400  Olivier Crête <olivier.crete@collabora.co.uk>
-
-	* gst/rtp/gstrtph263ppay.c:
-	  rtph263ppay: Also implement size/framerate restrictions in getcaps
-	  https://bugzilla.gnome.org/show_bug.cgi?id=577784
-
-2009-03-04 20:50:19 -0500  Olivier Crête <olivier.crete@collabora.co.uk>
-
-	* gst/rtp/gstrtph263ppay.c:
-	  rtph263ppay: Implement getcaps following RFC 4629, picks the right annexes
-	  https://bugzilla.gnome.org/show_bug.cgi?id=577784
-
-2011-11-08 14:31:34 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/isomp4/qtdemux.c:
-	  qtdemux: also set segment stop at startup rather than only post seek
-	  ... so as to ensure consistent playback with or without seek, especially
-	  in presence of some bogus edit list entries.
-
-2011-11-02 17:02:54 +0000  Raul Gutierrez Segales <rgs@collabora.co.uk>
-
-	* gst/flv/Makefile.am:
-	  gst/flv/: add amfdefs.h to noinst_HEADERS
-	  https://bugzilla.gnome.org/show_bug.cgi?id=663334
-
-2011-10-03 17:50:43 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/flv/gstflvdemux.c:
-	* gst/flv/gstflvdemux.h:
-	  flvdemux: detect large pts gaps and resync
-	  Should work on multiple gaps, but tested on only one.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=631430
-
-2011-08-22 10:40:45 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/flac/gstflacdec.c:
-	  flacdec: fix off by one between granpos and last_stop
-
-2011-10-07 19:41:35 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/audioparsers/gstflacparse.c:
-	  flacparse: fix last frame timestamp in fixed block size mode
-	  The last block may have a different block size, so we should not
-	  use it to scale or we'll end up with a wrong timestamp.
-	  See comment and quote from the FLAC format documentation in the code.
-	  Fixes looped playback of FLAC files (via about-to-finish).
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661215
-
-2011-10-27 15:52:47 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/cairo/gsttextoverlay.c:
-	* ext/cairo/gsttextoverlay.h:
-	  cairotextoverlay: add a 'silent' property to skip rendering
-	  https://bugzilla.gnome.org/show_bug.cgi?id=662856
-
-2011-11-07 12:00:12 +0100  René Stadler <rene.stadler@collabora.co.uk>
-
-	* gst/matroska/ebml-write.c:
-	  matroskamux: fix regression causing malformed files
-	  This was caused by me in 1b213d. It seems I was too focused on 0.11 when I did
-	  this and tested the wrong branch.
-	  The problem was reported by Alexey Fisher.
-
-2011-11-03 23:28:31 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/rtp/gstrtpvrawdepay.c:
-	  rtp: use GLib's G_BIG_ENDIAN define instead of BIG_ENDIAN
-	  Fixes compiler warning on mingw32
-
-2011-10-31 16:18:32 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/isomp4/gstqtmux.c:
-	  qtmux: avoid shortcut evaluation when adding paired mp4 tag
-	  Fixes (part of) #638711.
-
-2011-10-31 15:43:25 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/matroska/matroska-mux.c:
-	  matroskamux: do not use unoffical V_MJPEG codec id
-	  ... but as not spec'ed especially, consider it a VfW compatibility case.
-	  Fixes #659837.
-
-2011-10-30 19:30:14 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/flac/gstflacenc.h:
-	  flacenc: remove dead code from header
-	  We require a new-enough libflac that this condition will never apply.
-
-2011-10-28 09:57:36 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/jpeg/gstjpegdec.c:
-	  jpegdec: add sof-marker to template caps, so we don't get plugged for lossless jpeg
-	  jpegdec (using libjpeg 6.2/8) can't decode some lossless types of JPEG.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=556648
-
-2011-10-28 12:30:33 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/isomp4/qtdemux.c:
-	  qtdemux: elaborate some debug statements
-
-2011-10-11 20:56:51 +0400  Stas Sergeev <stsp@users.sourceforge.net>
-
-	* gst/flv/gstflvdemux.c:
-	  flvdemux: be careful with negative cts
-	  Fixes #661477.
-
-2011-10-06 13:04:54 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: tune non-update seek handling cases
-	  Fixes #661049.
-
-2011-10-28 10:40:36 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/videomixer/videomixer2.c:
-	  videomixer2: Use the clip function instead of the prepare_buffer function
-
-2011-10-28 09:36:17 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/videomixer/Makefile.am:
-	* gst/videomixer/gstcollectpads2.c:
-	* gst/videomixer/gstcollectpads2.h:
-	* gst/videomixer/videomixer2.h:
-	* gst/videomixer/videomixer2pad.h:
-	  videomixer2: Use collectpads2 from core
-
-2011-10-28 00:41:45 +1100  Jan Schmidt <thaytan@noraisin.net>
-
-	* gst/deinterlace/gstdeinterlace.c:
-	  deinterlace: Don't pointlessly hold object lock over caps operations
-	  Avoids a deadlock when getcaps is recursive due to the getcaps being
-	  reflected upstream/downstream. The lock isn't actually protecting
-	  anything here.
-
-2011-10-27 00:37:03 +1100  Jan Schmidt <thaytan@noraisin.net>
-
-	* gst/flv/amfdefs.h:
-	* gst/flv/gstflvmux.c:
-	  flvmux: add some comments and defines to clarify code.
-
-2011-10-10 15:36:14 +0200  René Stadler <rene.stadler@collabora.co.uk>
-
-	* gst/matroska/ebml-write.c:
-	  matroska: refactor ebml-write to be more 0.11 friendly
-	  Switching to a more 0.11-friendly pattern, where getting the buffer's data
-	  pointer and setting the size many times is less natural. This is of course in
-	  preparation to the upcoming port of the plugin.
-
-2011-10-11 21:45:46 +0200  René Stadler <rene.stadler@collabora.co.uk>
-
-	* gst/matroska/ebml-write.c:
-	  matroska: remove stale floatcast include
-	  GDOUBLE_TO_BE was moved to core a long time ago.
-
-2011-10-11 22:10:27 +0200  René Stadler <rene.stadler@collabora.co.uk>
-
-	* gst/matroska/matroska-mux.c:
-	  matroskamux: fix possible crash with malformed dirac codec_data
-	  Since size is unsigned, we need to safeguard against wrapping below zero.
-
-2011-10-21 22:33:34 +0200  René Stadler <rene.stadler@collabora.co.uk>
-
-	* gst/equalizer/gstiirequalizer.c:
-	  equalizer: remove avoidable call to gst_object_set_name
-
-2011-10-21 22:32:38 +0200  René Stadler <rene.stadler@collabora.co.uk>
-
-	* gst/deinterlace/gstdeinterlace.c:
-	  deinterlace: remove avoidable call to gst_object_set_name
-
-2011-10-16 20:30:25 +0200  René Stadler <mail@renestadler.de>
-
-	* ext/libpng/gstpngenc.c:
-	  pngenc: increase arbitrary resolution limits
-	  Apparently libpng can technically do up to 2^31-1 rows and columns. However it
-	  imposes an (arbitrary) default limit of 1 million (that could theoretically be
-	  lifted by using some additional API).
-	  Moved array allocation to the heap now.
-
-2011-10-16 20:25:41 +0200  René Stadler <mail@renestadler.de>
-
-	* ext/libpng/gstpngenc.c:
-	  pngenc: don't unconditionally allocate 4096 pointers on the stack
-	  Instead allocate as many as needed (on the stack still).
-
-2011-10-16 20:05:28 +0200  René Stadler <mail@renestadler.de>
-
-	* ext/libpng/gstpngenc.c:
-	  pngenc: ensure setcaps was called before chain function
-	  This is needed to properly error out for e.g. "fakesrc ! pngenc ! fakesink".
-
-2011-10-16 19:44:27 +0200  René Stadler <mail@renestadler.de>
-
-	* ext/libpng/gstpngenc.c:
-	  pngenc: validate input buffer size
-	  Just for safety; of course such mismatch represents a bug in another element.
-
-2011-10-16 19:41:28 +0200  René Stadler <mail@renestadler.de>
-
-	* ext/libpng/Makefile.am:
-	* ext/libpng/gstpngenc.c:
-	* ext/libpng/gstpngenc.h:
-	  pngenc: make setcaps more robust, use gstvideo functions
-	  A setcaps function needs to actually verify the caps carefully. In this case,
-	  it was possible to e.g. link a video decoder with YUV+RGB template caps to
-	  pngenc.  That would cause a crash when the decoder pushes a YUV buffer. Same
-	  thing when pushing a valid buffer that exceeds the resolution limits.
-	  Also, missing framerate caps field would cause a glib critical warning due to
-	  invalid GValue. This fails hard now.
-
-2011-10-21 10:01:43 +0200  René Stadler <rene.stadler@collabora.co.uk>
-
-	* gst/matroska/matroska-read-common.c:
-	  ebml: small correction to previous commit
-	  Signal a short read with UNEXPECTED, exactly like the peek_bytes function.
-
-2011-10-19 13:09:51 +0200  Edward Hervey <edward.hervey@collabora.co.uk>
-
-	* gst/matroska/matroska-read-common.c:
-	  ebml: Fix push-based behaviour
-	  The 'peek' method was completely wrong (!?)
-
-2011-10-18 18:31:17 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* ext/pulse/pulseaudiosink.c:
-	  pulse: Get caps correctly on pad block
-	  Instead of always going upstream, we should first see if already got
-	  caps from a setcaps() call.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661262
-
-2011-10-18 12:25:14 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/wavpack/gstwavpackenc.c:
-	  wavpackenc: don't unref buffer with gst_object_unref()
-
-2011-10-18 12:05:01 +0200  Wim Taymans <wim.taymans@collabora.co.uk>
-
-	* ext/pulse/pulsesink.c:
-	  pulsesink: only use is_pcm for 1.0 of pulseaudio
-
-2011-10-18 11:58:57 +0200  Wim Taymans <wim.taymans@collabora.co.uk>
-
-	* ext/pulse/pulsesink.c:
-	  pulsesink: only disable trickmodes for !pcm
-	  Only disable trickmodes when we are not dealing with raw PCM samples.
-
-2011-10-14 10:56:16 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* gst/videomixer/videomixer2.c:
-	  videomixer2: Fix a leak
-	  Buffers weren't being unref'ed in one case inside, causing memory usage
-	  to blow up.
-
-2011-10-14 09:10:01 +0200  Marc Leeman <marc.leeman@gmail.com>
-
-	* gst/rtp/gstrtpvrawdepay.c:
-	  set colour masks for video/x-raw-rgb in rtpvrawdepay
-
-2011-10-13 16:59:50 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* gst/videomixer/videomixer2.c:
-	  videomixer2: Fix incorrect gst_buffer_replace() call
-	  This got exposed when gst_buffer_replace() was changed from a macro to a
-	  function.
-
-2011-10-12 11:26:50 +0200  Edward Hervey <edward.hervey@collabora.co.uk>
-
-	* gst/rtp/gstrtpvrawpay.c:
-	  rtpvrawpay: Only use 24 LSB for depth=24 RGB caps
-	  ... and indent the masks for clarity
-
-2011-10-11 14:58:43 +0200  René Stadler <rene.stadler@collabora.co.uk>
-
-	* gst/matroska/matroska-mux.c:
-	  matroskamux: fix segment handling, so we actually use running time
-	  gst_matroska_mux_best_pad adjusts the buffer timestamp to running time using
-	  the segment stored in the pad's collect data. However, the event handler didn't
-	  pass the newsegment event on to collectpads' handler, so this segment was never
-	  updated at all.
-	  Re-fixes bug #432612.
-
-2011-10-10 19:01:23 +0100  Sjoerd Simons <sjoerd.simons@collabora.co.uk>
-
-	* gst/rtp/gstrtpg722pay.c:
-	  gstrtpg722pay: Compensate for clockrate vs. samplerate difference
-	  The RTP clock-rate used for G722 is 8000, even though the samplerate is
-	  16000. Compensate for this by pretending G722 has 8 bits per sample
-	  instead of the 4 bits as if it were a codec that ran at half the speed,
-	  but with twice the number of bits. Fixes #661376
-
-2011-09-27 19:25:53 +0100  Sjoerd Simons <sjoerd.simons@collabora.co.uk>
-
-	* ext/jpeg/gstjpegdec.c:
-	  jpegdec: Implement upstream negotiation
-	  Add upstream negotiation for jpegdec. Fixes #660275
-
-2011-10-10 19:02:58 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	  matroska-demux: don't leak audio codec_data buffer
-
-2011-10-10 13:20:04 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* tests/examples/cairo/Makefile.am:
-	  tests: add missing PLUGIN_ASE_LIBS to LDADD
-
-2011-10-09 21:31:27 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/speex/gstspeexenc.c:
-	* ext/speex/gstspeexenc.h:
-	  speexenc: only push header buffers following initial events
-
-2011-10-09 11:18:18 -0300  Thiago Santos <thiago.sousa.santos@collabora.com>
-
-	* gst/isomp4/atomsrecovery.c:
-	  qtmux: Fix memory leak on atoms recovery function
-	  Remember to free the ftyp data after writing it to a file.
-	  Fixes #660969
-
-2011-09-21 18:45:42 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-demux.h:
-	  matroskademux: improve segment handling with non-zero starting timestamp
-	  ... as well as related items, such as seeking and position reporting.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=659808
-
-2011-09-29 18:41:53 +0400  Stas Sergeev <stsp@users.sourceforge.net>
-
-	* sys/v4l2/gstv4l2object.c:
-	* sys/ximage/gstximagesrc.c:
-	  v4l2, ximagesrc: fix some printf format compiler warnings
-	  https://bugzilla.gnome.org/show_bug.cgi?id=660150
-
-2011-09-30 12:42:22 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* tests/check/elements/qtmux.c:
-	  tests: qtmux: Refactor bitrate check test
-	  Refactor bitrate check test to accomodate multiple tests
-	  for bitrate
-
-2011-09-30 13:02:31 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst/isomp4/atoms.c:
-	  qtmux: update esds atom under wave atom for aac bitrates
-	  AAC in mov format puts an ESDS atom inside of a WAVE atom in
-	  STSD atom, we need to update the bitrate on this ESDS. This patch
-	  fixes it.
-
-2011-09-30 12:41:52 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst/isomp4/atoms.c:
-	* gst/isomp4/fourcc.h:
-	  qtmux: Also update btrt atom
-	  When rewriting bitrates, also update the btrt atom under stsd
-
-2011-09-30 10:55:53 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* tests/check/elements/qtmux.c:
-	  tests: qtmux: add tests for bitrate average calculation
-	  Adds tests to make sure qtmux/mp4mux sets average bitrate
-	  correctly
-
-2011-09-28 11:41:49 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst/isomp4/atoms.c:
-	* gst/isomp4/atoms.h:
-	* gst/isomp4/gstqtmux.c:
-	* gst/isomp4/gstqtmux.h:
-	  qtmux: Calculate average bitrate for streams
-	  Calculate and use average bitrate for streams when no
-	  bitrate tag was received
-
-2011-09-28 10:41:14 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst/isomp4/gstqtmux.c:
-	  qtmux: Avoid a buffer metadata copy if possible
-	  If first_ts is 0 there is no need to subtract, so we might
-	  skip some copying to make the buffer metadata writable.
-
-2011-09-29 23:21:46 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/speex/gstspeexenc.c:
-	  speexenc: initialise variable before adding to it
-
-2011-09-29 17:21:22 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/speex/gstspeexdec.c:
-	* ext/speex/gstspeexdec.h:
-	  speexdec: port to audiodecoder
-
-2011-09-29 16:33:01 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/speex/gstspeexenc.h:
-	  speexenc: clean up some unused remnants
-
-2011-09-29 17:32:23 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/speex/Makefile.am:
-	* ext/speex/gstspeexenc.c:
-	* ext/speex/gstspeexenc.h:
-	  speexenc: port to audioencoder
-
-2011-09-28 16:09:58 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/flac/Makefile.am:
-	* ext/flac/gstflacenc.c:
-	* ext/flac/gstflacenc.h:
-	  flacenc: port to audioencoder
-
-2011-09-27 15:59:24 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-ids.h:
-	* gst/matroska/matroska-parse.c:
-	  matroskademux: ensure minimal alignment for audio/x-raw-* buffers
-	  Since matroskademux will attempt to push unaligned buffers,
-	  downstream might have trouble with those, especially if downstream
-	  uses ORC, such as audioconvert.
-	  Ensure we push buffers aligned to the basic type at least for
-	  those raw buffers.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=659798
-
-2011-09-28 00:10:09 +0300  Raimo Järvi <raimo.jarvi@gmail.com>
-
-	* gst/goom2k1/goom_core.c:
-	  goom2k1: Fix compiler warnings on 64 bit mingw-w64
-	  Fixes bug #660294.
-
-2011-09-25 15:13:39 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/soup/Makefile.am:
-	* ext/soup/gstsoup.c:
-	* ext/soup/gstsouphttpclientsink.c:
-	* ext/soup/gstsouphttpclientsink.h:
-	* ext/soup/gstsouphttpsink.c:
-	* ext/soup/gstsouphttpsink.h:
-	  soup: rename souphttpsink to souphttpclientsink
-	  To avoid confusion, and because we might want a server
-	  sink at some point too.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=659947
-
-2011-09-23 16:39:46 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/soup/gstsouphttpsink.c:
-	* ext/soup/gstsouphttpsink.h:
-	  souphttpsink: don't create unused second sink pad object
-	  The base class will create the sink pad.
-
-2011-09-23 15:36:36 +0200  Julien Isorce <julien.isorce@gmail.com>
-
-	* gst/audioparsers/gstac3parse.c:
-	  ac3parse: correctly check for ac3/e-ac3 switch
-	  https://bugzilla.gnome.org/show_bug.cgi?id=659943
-
-2011-09-20 13:38:53 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtp/gstrtph264depay.c:
-	  rtph264depay: improve downstream flow return feedback to upstream
-	  ... although basertpdepay does not really make it easy/possible to do so
-	  all the way.
-
-2011-09-20 12:11:47 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* sys/ximage/gstximagesrc.c:
-	* sys/ximage/gstximagesrc.h:
-	  ximagesrc: add xid and xname properties to allow capturing a particular window
-	  A particular window may be selected using the new xid (X-Window
-	  XID, eg a pointer) and xname (window title) properties. If both
-	  are specified, the XID is used in preference, falling back to
-	  xname if not found.
-	  Default (if none of xid and xname are specified, or if no such
-	  window is found) is to capture the root window.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=546932
-
-2011-08-02 17:39:44 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/elements/qtmux.c:
-	  tests: add unit test to make sure encodebin picks mp4mux for variant=iso
-	  https://bugzilla.gnome.org/show_bug.cgi?id=651496
-
-2011-09-19 12:15:11 +0200  Ha Nguyen <hanguytv@gmail.com>
-
-	* gst/rtpmanager/gstrtpbin.c:
-	  rtpbin: Fix a leaked clock for each buffering message
-	  Fixes bug #659237.
-
-2011-09-19 12:11:32 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/isomp4/qtdemux.c:
-	* gst/isomp4/qtdemux_fourcc.h:
-	  qtdemux: parse embedded ID32 tags
-
-2011-09-02 13:41:41 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtpmanager/rtpsession.c:
-	* gst/rtpmanager/rtpsource.c:
-	  rtpsession: avoid source premature timing out
-	  Use slightly adjusted sender interval to determine sender timeout rather than
-	  our own sender side interval (which may have been forced small).
-
-2011-08-25 12:40:52 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpsession.c:
-	* gst/rtpmanager/rtpsession.c:
-	* gst/rtpmanager/rtpsession.h:
-	  rtpsession: avoid timing out source too quickly
-	  ... following a PAUSE/PLAY cycle, particularly applicable when operating
-	  with a short RTCP interval (possibly forced so server-side).
-
-2011-08-24 14:37:52 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpbin.c:
-	* gst/rtpmanager/gstrtpjitterbuffer.c:
-	  rtpjitterbuffer/rtpbin: relax dropping rtcp packets
-	  ... to at least having it trigger a/v synchronization, possibly without
-	  using provided values which are still not considered sane
-	  (as previously dropped).
-
-2011-08-24 14:34:23 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpjitterbuffer.c:
-	  rtpjitterbuffer: some more reset when clearing pt map
-	  ... which in particular caters for some more reset following a possible
-	  rtsp PLAY.
-
-2011-08-21 21:58:38 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: do not set elements to PLAYING when doing seek in PAUSED
-
-2011-09-01 14:47:48 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtpmanager/rtpjitterbuffer.c:
-	  rtpjitterbuffer: only reset skew on gap if input ts available
-
-2011-08-18 14:12:21 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtpmanager/rtpjitterbuffer.c:
-	  rtpjitterbuffer: check some more for possible rtp timestamp discontinuity
-	  ... when operating in non slave mode, and reset if detected.
-	  This should avoid some (large) bogus outgoing timestamp due to jumps
-	  in rtp time, as result of PAUSE/PLAY or seek or ...
-
-2011-08-08 12:48:50 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: switch to rtp time based syncing when guessed appropriate
-
-2011-08-08 12:15:20 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpbin.c:
-	* gst/rtpmanager/gstrtpbin.h:
-	  rtpbin: alternative inter-stream syncing methods
-	  ... at least if not syncing to NPT time:
-	  * either sync using RTCP SR data (as currently)
-	  * only perform the above once using initial RTCP SR packets
-	  * discard RTCP and sync by equating provided stream's clock-base rtptime,
-	  as provided by jitterbuffer (typically obtained from RTP-Info in RTSP).
-
-2011-08-08 12:11:24 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpjitterbuffer.c:
-	  rtpjitterbuffer: also provide clock-base to sync signal
-
-2011-08-08 12:09:41 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpbin.c:
-	* gst/rtpmanager/gstrtpbin.h:
-	  rtpbin: allow configurable rtcp stream syncing interval
-	  ... rather than necessarily syncing at each RTCP SR.
-
-2011-08-01 08:35:01 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtpmanager/rtpsession.c:
-	  rtpsession: trigger reconsideration if rtcp interval set
-
-2011-08-01 08:32:24 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: configure rtcp interval if provided
-	  ... in PLAY response.
-
-2011-09-16 16:53:22 +0300  Lasse Laukkanen <lasse.laukkanen@digia.com>
-
-	* gst/isomp4/gstqtmux.c:
-	  isomp4: Fix allowing zero duration tracks
-	  https://bugzilla.gnome.org/show_bug.cgi?id=637486
-
-2011-09-05 10:11:18 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/udp/gstudpnetutils.c:
-	  udpsrc: error out when no protocol is specified in the uri
-	  It is certainly better than to crash.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658178
-
-2011-09-19 09:37:58 +0200  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/speex/gstspeexenc.c:
-	  speexenc: do not use invalid buffer timestamps
-
-2011-03-29 12:09:18 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* ext/pulse/Makefile.am:
-	* ext/pulse/plugin.c:
-	* ext/pulse/pulseaudiosink.c:
-	* ext/pulse/pulsesink.c:
-	* ext/pulse/pulsesink.h:
-	* ext/pulse/pulseutil.h:
-	  pulse: New pulseaudiosink element to handle format changes
-	  This introduces a new bin which wraps around pulsesink and depending on
-	  the formats supported by the sink, plugs in/out a decodebin2 as
-	  required. This allows users to switch sinks on the stream and adapts
-	  accordingly (for example, you could watch a movie in passthrough mode on
-	  your receiver which supports AC3 decode, then plug out and switch to a
-	  non-digital profile to continue uninterrupted on analog output).
-	  The bin is required because doing the same with playbin2/playsink will
-	  require API changes that cannot be made in 0.10. With 0.11/1.0, we
-	  should be able to ask for upstream caps renegotiation to deal with all
-	  this.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657179
-
-2011-09-16 15:03:23 +0200  Branko Subasic <branko@axis.com>
-
-	* gst/matroska/ebml-read.c:
-	* gst/matroska/ebml-read.h:
-	* gst/matroska/matroska-read-common.c:
-	  matroskademux: Avoid sending EOS when in paused state
-	  Changed the ebml reader's gst_ebml_peek_id_length() function so
-	  that it returns the actual reason for why the peek failed, instead
-	  of (almost) always returning GST_FLOW_UNEXPECTED. This prevents
-	  the pulling task from sending EOS when doing a flushing seek.
-
-2011-09-15 15:53:47 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: fix stuttering A/V
-	  Someone got had by implicit promotion to unsigned in ops with
-	  a signed and an unsigned value.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=659153
-
-2011-09-14 16:37:12 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/debugutils/gstnavseek.c:
-	  navseek: toggle pause/play on space bar
-	  A useful thing to have.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=659065
-
-2011-09-14 14:46:00 +0200  David Svensson Fors <davidsf@axis.com>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-demux.h:
-	  matroskademux: configurable timestamp gap handling
-	  matroskademux performs segment tricks to skip gaps in streams,
-	  notably at start for non 0 based files.  There may however be
-	  cases when full presentation (including intermediate gaps) is
-	  desired, so a property allows to configure as of which gap
-	  to act (or not at all).
-	  API: GstMatroskaDemux::max-gap-time
-	  Fixes #659009.
-
-2011-09-12 09:21:47 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* tests/check/elements/flvmux.c:
-	  tests: flvmux: Fix flvmux's tests after fix for request pads handling
-	  Now that flvmux doesn't release its request pads on PAUSED->READY the
-	  test doesn't need to re-request them for every reuse test start.
-
-2011-09-09 09:12:56 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst/isomp4/gstqtmux.c:
-	  qtmux: Fix ctts generation for streams that don't start at 0 timestamps
-	  Subtract the first timestamp of a stream from all input buffers to
-	  get 0-based timestamps for creating a sane ctts table. Without this
-	  patch the ctts could have larger values than needed, causing the
-	  playback to have a delay at startup.
-	  As the first timestamp is only found after a few buffers are queued
-	  (due to possible reordered buffers), once we find the first timestamp
-	  we subtract it from all buffers on the queue, from that point on,
-	  all buffers have their timestamps subtract when they are collected.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658659
-
-2011-09-12 07:55:19 +0200  Alessandro Decina <alessandro.d@gmail.com>
-
-	* gst/flv/gstflvmux.c:
-	  flvmux: don't release request pads going PAUSED->READY
-	  Don't release request pads but just reset them. This makes pipelines using
-	  flvmux reusable.
-
-2011-09-09 12:35:50 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/audioparsers/gstac3parse.c:
-	  ac3parse: use bsid 9 and 10 to control sample rate
-	  See http://matroska.org/technical/specs/codecid/index.html
-	  The spec is silent about this though...
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658546
-
-2011-09-07 14:13:03 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: ensure some initial state variable setup
-	  ... which might otherwise be skipped if the PLAY command is issued before
-	  the OPEN command had a chance to actually be acted upon.
-	  Fixes #657376.
-
-2011-09-08 15:02:05 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: tweak gap handling
-	  ... so as to avoid buffers before and after gap to have identical running time.
-
-2011-09-08 13:28:24 +0200  Guillaume Desmottes <guillaume.desmottes@collabora.co.uk>
-
-	* sys/v4l2/gstv4l2object.c:
-	  v4l2: use GST_RESOURCE_ERROR_BUSY if v4l2_ioctl fails with EBUSY
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658543
-
-2011-09-07 08:54:17 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst/isomp4/gstqtmux.c:
-	  qtmux: remove one G_UNLIKELY for user property
-	  Using G_UNLIKELY on user properties isn't nice, specially when
-	  that is the default option.
-
-2011-03-15 11:03:53 +0100  Andoni Morales Alastruey <amorales@flumotion.com>
-
-	* gst/matroska/matroska-mux.c:
-	* gst/matroska/matroska-mux.h:
-	  matroskamux: handle GstForceKeyUnit event
-	  ... by starting a new cluster after forwarding event.
-	  Fixes #644154.
-
-2011-09-07 14:27:36 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* tests/check/elements/cmmldec.c:
-	* tests/check/elements/cmmlenc.c:
-	  cmml: Use complete cmml caps in the unit test
-
-2011-09-07 14:26:01 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* tests/check/elements/qtmux.c:
-	  qtmux: Use complete MPEG caps in the unit test
-
-2011-09-07 14:18:58 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* docs/plugins/Makefile.am:
-	  docs: cleanup makefiles
-	  Remove commented out parts that we don't need. Remove "the wingo addition" - no
-	  so useful after all. Narrow down file-globs for plugin docs.
-
-2011-08-29 14:12:22 +0200  Konstantin Miller <konstantin.miller@gmail.com>
-
-	* ext/soup/gstsouphttpsrc.c:
-	  souphttpsrc: Don't handle HTTP response 407 as error if proxy authentication data is available
-	  Fixes bug #657422.
-
-2011-09-07 12:11:39 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/audioparsers/gstac3parse.c:
-	  ac3parse: Add Converter to the classification because it can convert between different alignments
-	  This allows decodebin2 to let it negotiate properly.
-
-2011-09-07 12:10:48 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/audioparsers/gstaacparse.c:
-	* gst/audioparsers/gstac3parse.c:
-	* gst/audioparsers/gstdcaparse.c:
-	* gst/audioparsers/gstflacparse.c:
-	* gst/audioparsers/gstmpegaudioparse.c:
-	  audioparsers: Improve src template caps
-	  Remove the parsed/framed fields and add all fields to the template
-	  caps that always exist.
-
-2011-09-06 15:59:49 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/audioparsers/gstaacparse.c:
-	* gst/audioparsers/gstaacparse.h:
-	  aacparse: parse codec_data to determine number of samples per frame
-	  Fixes #656734.
-
-2011-09-06 21:24:46 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* common:
-	  Automatic update of common submodule
-	  From a39eb83 to 11f0cd5
-
-2011-09-06 15:40:32 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* common:
-	  Automatic update of common submodule
-	  From 605cd9a to a39eb83
-
-2011-09-06 15:05:37 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/matroska/matroska-mux.c:
-	* gst/matroska/matroska-mux.h:
-	  matroskamux: make default duration check less sensitive
-	  Frame duration might vary for 1 usecond, in this case matroskamux
-	  decides to create BLOCKGROUP instead of SIMPLEBLOCK.
-	  Convert duration to timecodescale which is (typically) less precise, and
-	  then also allow the difference of 1/-1 to arrange for less sensitive check.
-	  Based on patch by Alexey Fisher <bug-track@fisher-privat.net>
-	  Fixes #653080.
-
-2011-09-06 13:18:40 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtp/gstrtpmp4gdepay.c:
-	  rtpmp4gdepay: improve bogus interleaved index compensating
-	  Patch by <gudake@gmail.com>
-	  Fixes #654585.
-
-2011-09-06 10:33:21 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* ext/soup/gstsouphttpsrc.c:
-	  souphttpsrc: Allow positive, non-1.0 segment rates
-	  Only negative rates are not supported. Fixes bug #658305.
-
-2011-09-05 15:50:56 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* tests/check/elements/parser.c:
-	  tests: parsers: provide more real data when testing draining of garbage
-
-2011-09-05 15:50:04 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/audioparsers/gstamrparse.c:
-	  amrparse: fix and streamline valid frame checking
-	  ... to handle various combinations of sync or not, and sufficient data
-	  or not as might be expected.
-	  Fixes #650714.
-
-2011-09-05 14:49:32 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/isomp4/qtdemux.c:
-	  qtdemux: fragmented support; avoid adjustment for keyframe seek
-	  ... since all index data may not yet be available at that time.
-
-2011-09-05 14:48:02 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/isomp4/qtdemux.c:
-	  qtdemux: fragmented support; mark all audio track samples as keyframe
-
-2011-09-05 14:46:29 +0200  Brian Li <brian7003@gmail.com>
-
-	* gst/isomp4/qtdemux.c:
-	  qtdemux: fragmented support; properly init return variable value
-	  Fixes #655918.
-
-2011-09-05 13:31:20 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: add gtk-doc for new short-header property
-
-2011-09-05 13:18:39 +0200  Marc Leeman <marc.leeman@gmail.com>
-
-	* gst/rtsp/gstrtspsrc.c:
-	* gst/rtsp/gstrtspsrc.h:
-	  rtspsrc: allow sending short RTSP requests to a server
-	  Some encoders (Arecont) do not like the long OPTIONS sent at startup as sent by
-	  GStreamer, but do accept the short header as sent by Live555.
-	  This patch makes the extending the request optional by adding a property
-	  (short-header).
-	  Fixes #655805.
-	  API: GstRTSPSrc:short-header
-
-2009-03-04 14:51:09 -0500  Olivier Crête <olivier.crete@collabora.co.uk>
-
-	* gst/rtp/gstrtph263ppay.c:
-	  rtph263ppay: Set H263-2000 if thats what the other side wants
-	  The static caps states this element supports H263-2000, but setcaps never
-	  sets it, so it was lie.
-	  See https://bugzilla.gnome.org/show_bug.cgi?id=577784
-
-2011-08-30 19:02:51 -0400  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtpmanager/rtpsession.c:
-	  rtpsession: Initialise the last_keyframe_request variable
-
-2011-08-31 16:04:24 +0200  Peter Korsgaard <jacmet@sunsite.dk>
-
-	* gst/udp/gstmultiudpsink.c:
-	  multiudpsink: make add/remove/clear/get-stats action signals
-	  http://bugzilla.gnome.org/show_bug.cgi?id=657830
-	  Signed-off-by: Peter Korsgaard <jacmet@sunsite.dk>
-
-2011-08-30 13:33:49 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/isomp4/qtdemux.c:
-	* gst/isomp4/qtdemux.h:
-	  qtdemux: push mode; perform some extra checks prior to upstream seeking
-
-2011-08-30 13:28:21 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/isomp4/qtdemux.c:
-	  qtdemux: push mode; fix buffered streaming
-	  That is, in case where no seek is peformed to moov, but preceding
-	  limited mdat is buffered.
-
-2011-08-29 15:13:56 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/isomp4/qtdemux.c:
-	  qtdemux: avoid overflow wraparound in timestamp when adding durations
-	  Do some type juggling to avoid overflow, while still allowing for 'negative'
-	  durations (which would need a wraparound effect).
-
-2011-08-25 23:37:47 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* sys/v4l2/v4l2src_calls.c:
-	  v4l2src: make this work more than once in a row
-	  We used to skip frame rate setup if the camera was already setup
-	  with the requested frame rate. This breaks some cameras though,
-	  causing them to not output data (several models of Thinkpad cameras
-	  have this problem at least).
-	  So, don't skip.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=638300
-
-2011-08-23 12:12:15 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/audioparsers/gstaacparse.c:
-	  aacparse: only require two frames in a row when we do not have sync
-	  This avoids a single bit error dropping two frames unnecessarily.
-	  The two consecutive frames check is still required when we don't
-	  have sync.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657080
-
-2011-08-23 21:41:15 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* ext/pulse/pulsesink.c:
-	  pulsesink: Trivial indentation fix
-
-2011-07-21 17:23:28 -0400  Monty Montgomery <cmontgom@redhat.com>
-
-	* ext/flac/gstflacdec.c:
-	  flacdec: Correct sample number rounding resulting in timestamp jitter
-	  flacdec converts the src timestamp to a sample number, uses that internally, then reconverts the sample number to a timestamp for the output buffer.  Unfortunately, sample numbers can't be represented in an integer number of nanoseconds, and the conversion process was truncating rather than rounding, resulting in sample numbers and output timestamps that were often off by a full sample.
-	  This corrects the time->sample convesion
-
-2011-08-20 14:48:20 -0700  David Schleef <ds@schleef.org>
-
-	* gst/debugutils/breakmydata.c:
-	  breakmydata: element is not passthrough
-
-2011-07-13 11:20:34 -0700  David Schleef <ds@schleef.org>
-
-	* gst/multifile/gstmultifilesrc.c:
-	  multifilesrc: quiet debugging
-
-2011-07-10 21:40:20 -0700  David Schleef <ds@schleef.org>
-
-	* gst/deinterlace/gstdeinterlace.c:
-	* gst/deinterlace/gstdeinterlace.h:
-	* gst/deinterlace/gstdeinterlacemethod.c:
-	* gst/deinterlace/gstdeinterlacemethod.h:
-	* gst/deinterlace/tvtime/greedy.c:
-	* gst/deinterlace/tvtime/greedyh.c:
-	* gst/deinterlace/tvtime/linearblend.c:
-	* gst/deinterlace/tvtime/scalerbob.c:
-	* gst/deinterlace/tvtime/tomsmocomp/TomsMoCompAll.inc:
-	* gst/deinterlace/tvtime/vfir.c:
-	* gst/deinterlace/tvtime/weave.c:
-	* gst/deinterlace/tvtime/weavebff.c:
-	* gst/deinterlace/tvtime/weavetff.c:
-	  deinterlace: change field handling through methods
-	  This likely breaks stuff.  The good: all of the methods now create
-	  field images aligned with input frames, without timestamp mangling.
-	  The bad: this touches a lot of code, much of which is hairy and in
-	  need of cleanup.  However, at this point we can reasonably create a
-	  PSNR-based test.
-
-2011-08-21 14:41:14 +0200  Alessandro Decina <alessandro.d@gmail.com>
-
-	* gst/multifile/gstmultifilesink.c:
-	  multifilesink: reset ->streamheaders to NULL on _stop
-	  Fixes invalid memory access reusing multifilesink
-
-2011-08-18 13:37:39 +0200  David Henningsson <david.henningsson@canonical.com>
-
-	* ext/pulse/pulsesink.c:
-	  pulsesink: Allow writes in bigger chunks
-	  There's no use in splitting the incoming data down to the segsize
-	  limit - by writing as much as possible in one chunk, we increase
-	  performance and avoid PulseAudio unnecessary rewinds.
-	  Signed-off-by: David Henningsson <david.henningsson@canonical.com>
-
-2011-08-08 22:14:28 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: ensure no-more-pads is always emitted
-	  In particular, do so even if failing to read while prerolling,
-	  such as when reading from a partial file (eg, while it is being
-	  downloaded).
-	  This fixes a wedge in playbin2.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=651965
-
-2011-08-16 17:27:13 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/flac/gstflacdec.c:
-	  flacdec: avoid timestamp/offset tracking going out of sync
-	  The libFLAC API is callback based, and we must only call it to
-	  output data when we know we have enough input data. For this
-	  reason, a single processing step is done when receiving a buffer.
-	  However, if there were metadata buffers still pending, a step
-	  intended for the first audio frame might end up writing that
-	  leftover metadata. Since a single step is done per buffer, this
-	  will cause every buffer to be written one step late.
-	  This would add some latency (a bufferfull's worth), possibly
-	  lose a buffer when seeking or the like, and also cause timestamp
-	  and offset to be applied to the wrong buffer, as updates to
-	  the "current" segment last_stop (from incoming buffer timestamp)
-	  will be applied to an output buffer originating from the previous
-	  incoming buffer.
-	  This fixes the issue by ensuring that, upon receiving the first
-	  audio frame, processing is done till all metadata is processed,
-	  so the next "single step" done will be for the audio frame. After
-	  this, we should keep to 1 input buffer -> 1 output buffer and so
-	  avoid getting out of sync.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650960
-
-2011-08-16 15:32:07 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/flac/gstflacdec.c:
-	  flacdec: bail on reserved value
-	  Now that we look at the right bits, we can test against the reserved
-	  value as we do for other fields.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650960
-
-2011-08-16 15:27:43 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/flac/gstflacdec.c:
-	  flacdec: fix bit twiddling
-	  Right shifting a 8 bit value by 8 bits is twice too much
-	  to get the high 4 bits.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650960
-
-2011-08-16 15:22:46 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/flac/gstflacdec.c:
-	  flacdec: warn if we see a variable block size where unsupported
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650960
-
-2011-08-16 18:25:29 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/spectrum/gstspectrum.c:
-	  spectrum: avoid crashing by resetting the correct number of channels
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656606
-
-2011-08-16 13:16:22 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/audioparsers/gstflacparse.c:
-	  flacparse: fix off by one in frame size check
-	  Yes, I was tracking another bug and the small test file I generated
-	  to test with improbably just happened to trigger this, with a second
-	  and last frame of 1615 bytes.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656649
-
-2011-08-14 20:46:01 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/id3demux/id3v2.3.0.html:
-	* gst/id3demux/id3v2.4.0-frames.txt:
-	* gst/id3demux/id3v2.4.0-structure.txt:
-	  id3demux: remove specs from git as well now that parsing code is in -base
-
-2011-07-14 15:42:36 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* configure.ac:
-	* gst/id3demux/Makefile.am:
-	* gst/id3demux/gstid3demux.c:
-	* gst/id3demux/id3tags.c:
-	* gst/id3demux/id3tags.h:
-	* gst/id3demux/id3v2frames.c:
-	  id3demux: use -base provided id3 tag parsing
-	  https://bugzilla.gnome.org/show_bug.cgi?id=654388
-
-2011-08-13 16:51:22 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/jack/gstjackaudiosrc.c:
-	  jackaudiosrc: fix error message code
-	  And also post 'not found' error if jackd is not even installed.
-
-2011-08-12 16:32:58 +0200  Stefan Kost <ensonic@users.sf.net>
-
-	* gst/isomp4/qtdemux.c:
-	  qtdemux: initialize bitrate variable and reset for each loop
-	  Don't check eventually unset variable and don't accidentially use values from last
-	  cycle.
-
-2011-08-09 11:28:17 +0200  Edward Hervey <edward.hervey@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: Properly error out if SDP contains no streams
-	  Also fixes unitialized variable error on macosx.
-
-2011-08-09 09:05:31 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* sys/ximage/gstximagesrc.c:
-	  ximagesrc: clear flags on buffer reuse
-	  This will ensure a logically new buffer does not keep flags from
-	  a previous use of that buffer (eg, DISCONT would be set on the first
-	  buffer, and mistakenly kept when reused).
-	  https://bugzilla.gnome.org/show_bug.cgi?id=653709
-
-2011-08-08 10:54:26 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* sys/v4l2/gstv4l2object.c:
-	  v4l2: take care not to change the current format where appropriate
-	  Some drivers are buggy are will change the current format when
-	  processing VIDIOC_TRY_FMT. Save and restore the current format
-	  to ensure the format is kept unchanged.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=649067
-
-2011-08-07 12:23:26 +0200  Sjoerd Simons <sjoerd.simons@collabora.co.uk>
-
-	* sys/v4l2/v4l2src_calls.c:
-	  v4l2src: Use fraction compare util function.
-	  Use the fraction compare utility to compare function, not the
-	  handcrafted one. The handcrafted one is buggy as it doesn't take into
-	  account rounding error. For example comparing a framerate of 20/1 on a
-	  camera configured as 30/1 fps would yield true: 1 == (1 * 20)/30 and not
-	  re-configure the camera. Fixes #656104
-
-2011-08-03 22:50:05 +1000  Jan Schmidt <thaytan@noraisin.net>
-
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	* gst/matroska/matroska.c:
-	  matroska: Register new debug category
-	  Register the matroskareadcommon debug category when the
-	  plugin is loaded to avoid assertion output when debug is turned on.
-
-2011-07-29 13:03:55 +0200  Philippe Normand <pnormand@igalia.com>
-
-	* gst/isomp4/qtdemux.c:
-	  qtdemux: soften assertion check on stream size
-	  https://bugzilla.gnome.org/show_bug.cgi?id=655570
-
-2011-08-03 10:09:42 +0200  Robert Krakora <rob.krakora@messagenetsystems.com>
-
-	* gst/rtp/gstrtpjpegpay.c:
-	  rtpjpegpay: Add support for H.264 payload in MJPEG container
-	  See http://www.quickcamteam.net/uvc-h264/USB_Video_Payload_H.264_0.87.pdf
-	  Fixes bug #655530.
-
-2011-08-02 22:05:08 -0400  Tristan Matthews <tristan@sat.qc.ca>
-
-	* ext/jack/gstjackaudiosink.c:
-	* ext/jack/gstjackaudiosink.h:
-	  jackaudiosink: Don't call g_alloca() in process_cb
-	  g_alloca() is not RT-safe, so instead we should allocate the
-	  memory needed in advance. Fixes #655866
-
-2011-08-02 23:42:58 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/multipart/multipartdemux.c:
-	* sys/v4l2/gstv4l2object.c:
-	  docs: fix two more Since: tags
-
-2011-07-31 04:19:00 +0300  Mart Raudsepp <leio@gentoo.org>
-
-	* gst/deinterlace/gstdeinterlace.c:
-	  deinterlace: Fix Since tags for fieldanalysis related new properties
-	  commit c1b100cf9c is after 0.10.29 and 0.10.30 was a branched release.
-	  So fix Since tags from 0.10.29 to 0.10.31 for the new properties.
-
-2011-07-29 13:05:42 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/pulse/pulsesink.c:
-	  pulsesink: fix variable-set-but-not-used compiler warning with older pulse versions
-
-2011-07-29 12:07:24 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtpmanager/rtpsession.c:
-	  rtpsession: properly init rtcp_min_interval
-
-2011-03-09 11:04:36 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* ext/pulse/pulsesink.c:
-	* ext/pulse/pulsesink.h:
-	* ext/pulse/pulseutil.c:
-	  pulsesink: Add support for compressed formats
-	  This adds support for various compressed formats (AC3, E-AC3, DTS and
-	  MP3) payloaded in IEC 61937 format (used for transmission over S/PDIF,
-	  HDMI and Bluetooth).
-	  The acceptcaps() function allows bins to probe for what formats the sink
-	  being connected to support. This only works after the element is set to
-	  at least READY.
-	  If the underlying sink changes and the format we are streaming is not
-	  available, we emit a message that will allow upstream elements/bins to
-	  block and renegotiate a new format.
-
-2011-03-01 15:34:46 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* configure.ac:
-	* ext/pulse/pulsesink.c:
-	* ext/pulse/pulseutil.c:
-	* ext/pulse/pulseutil.h:
-	  pulsesink: Use the extended stream API if available
-	  This uses the new extended API for creating streams. This will allow us
-	  to support compressed formats natively in pulsesink as well.
-
-2011-07-29 00:07:52 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* ext/pulse/pulsesrc.c:
-	* ext/pulse/pulsesrc.h:
-	  pulsesrc: Add a source-output-index property
-	  This exposes the source output index of the record stream that we open
-	  so that clients can use this with the introspection if they want (to
-	  move the stream, for example).
-
-2011-07-28 14:44:57 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpssrcdemux.c:
-	  rtpssrcdemux: keep a ref on the src pad while using it
-	  Prevent a possible race if clear_ssrc() is called between getting the pad and
-	  doing the push.
-	  Based on patch by <olivier.crete@collabora.com>
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650916
-
-2011-05-24 11:29:57 +0300  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtpmanager/gstrtpssrcdemux.c:
-	* gst/rtpmanager/gstrtpssrcdemux.h:
-	  rtpssrcdemux: Make the pads lock recursive and hold it across the signal emit
-	  We need to keep the lock held because we don't want a push before the "new-ssrc-pad"
-	  handler has completed. But we may want to push an event from inside that handler, hence
-	  the recursive mutex.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650916
-
-2011-05-24 11:17:25 +0300  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtpmanager/gstrtpssrcdemux.c:
-	  rtpssrcdemux: Use PADs lock
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650916
-
-2011-07-27 18:15:20 +0100  Sjoerd Simons <sjoerd.simons@collabora.co.uk>
-
-	* gst/rtp/gstrtph264depay.c:
-	* gst/rtp/gstrtph264depay.h:
-	  rtph264depay: Cope with FU-A E bit not being set
-	  Some h264 payloaders are unfortunately buggy and don't correctly set the
-	  E bit in FU-A NAL when they have ended. Work around this by assuming
-	  such a fragmentation unit has ended when there was no packet loss and a
-	  new NAL is started
-
-2011-04-12 17:01:47 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* gst/audioparsers/gstac3parse.c:
-	* gst/audioparsers/gstac3parse.h:
-	  ac3parse: Support switching alignment on-the-fly
-	  This allows switching of alignment for E-AC3 streams at run-time. This
-	  is requested by downstream elements via a custom event.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650313
-
-2011-04-09 12:26:56 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* gst/audioparsers/gstac3parse.c:
-	* gst/audioparsers/gstac3parse.h:
-	* tests/check/elements/ac3parse.c:
-	  ac3parse: Add support for IEC 61937 alignment
-	  When pushing out buffers over S/PDIF or HDMI, IEC 61937 payloading
-	  requires each buffer to contain 6 blocks from each substream. This adds
-	  code to collect all the frames needed to meet this requirement before
-	  pushing out a buffer.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650313
-
-2011-06-08 15:57:37 -0400  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtpmanager/rtpsession.c:
-	* gst/rtpmanager/rtpsession.h:
-	  rtpsession: Always send application requested feedback in immediate mode
-	  Send as many application requested feedback messages in immediate mode, even if they
-	  have already been sent.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=654583
-
-2011-06-08 14:48:01 -0400  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtpmanager/rtpsession.c:
-	  rtpsession: Don't let the computed RTP bandwidth fall too low
-	  If it falls too low, the computed RTCP bandwidth will be near zero and
-	  the RTCP thread will be stopped.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=654583
-
-2011-04-25 16:13:38 -0400  Olivier Crête <olivier.crete@collabora.co.uk>
-
-	* gst/rtpmanager/rtpsession.c:
-	  rtpsession: Wait longer to timeout SSRC collision
-	  Using the current RTCP interval to timeout SSRC collision can lead to
-	  collisions being timed out immediately if a BYE packet is sent because
-	  it is sent immediately, so the interval is 0. This is not what we
-	  want. So just set a static 10 times the default RTCP interval, it
-	  should be enough
-	  https://bugzilla.gnome.org/show_bug.cgi?id=648642
-
-2011-07-19 13:38:01 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: set SOURCE flag at init time
-	  Fixes #654816.
-
-2011-07-18 16:46:27 -0400  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtp/gstrtph264depay.c:
-	  rtph264depay: Complete merged AU on marker bit
-	  The marker bit on a RTP packet means the AU has been completed, so push it out
-	  immediately to reduce the latency.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=654850
-
-2011-07-18 20:27:38 -0400  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtp/gstrtph264pay.c:
-	* gst/rtp/gstrtph264pay.h:
-	  rtph264pay: Only set the marker bit on the last NALU of a multi-NALU access unit
-	  An access unit could contain multiple NAL units, in that case, only the last
-	  RTP packet of the last NALU should have its marker bit set.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=654850
-
-2011-07-20 08:52:58 +0200  Alessandro Decina <alessandro.d@gmail.com>
-
-	* gst/multipart/multipartmux.c:
-	  multipart: fix compiler warning
-
-2011-07-19 12:05:51 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/auparse/gstauparse.c:
-	  auparse: avoid hanging on invalid short input
-	  ... as in such case there is no srcpad yet on which to forward EOS.
-
-2011-07-18 15:13:33 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* ext/pulse/pulsesrc.c:
-	  pulsesrc: Fix default value leaking
-	  Remember to free the default value of client name, avoiding a
-	  leak
-
-2011-07-18 14:24:48 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtp/gstrtph264depay.c:
-	  rtph264depay: reset upon FLUSH_STOP
-	  ... which is particularly needed when merging NAL units, where not resetting
-	  would lead to output of an older (pre-flush) AU (with unintended timestamp).
-
-2011-07-18 14:30:51 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/multifile/gstmultifilesink.c:
-	  multifilesink: do not use g_slist_free_full
-	  ... as that is only in GLib 2.28, which is not yet required at this time.
-
-2011-07-18 09:38:26 +0200  Alessandro Decina <alessandro.d@gmail.com>
-
-	* gst/multifile/gstmultifilesink.c:
-	* gst/multifile/gstmultifilesink.h:
-	* tests/check/elements/multifile.c:
-	  multifilesink: add max-files property
-	  Add max-files property to limit the number of files saved on disk.
-	  API: multifilesink::max-files
-
-2011-07-17 23:36:55 +0200  Alessandro Decina <alessandro.d@gmail.com>
-
-	* gst/multifile/gstmultifilesink.c:
-	  multifilesink: refactor file opening and closing code
-
-2011-07-16 19:38:51 +0200  Alexey Fisher <bug-track@fisher-privat.net>
-
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: fix pixel-aspect-ratio if header has only one display variable
-	  Current matroska demux calculates the pixel aspect ratio only if both
-	  DisplayHeight and DisplayWidth are set, but it is legal to use only
-	  one variable if the other is equal to PixelWidth or PixelHeight, at
-	  least the mkclean utility is doing that. So this makse mkcleaned
-	  files play correctly.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=654744
-
-2011-07-16 23:47:50 +0100  Antoine Jacoutot <ajacoutot@openbsd.org>
-
-	* gst/goom/plugin_info.c:
-	  goom: fix build on PPC on openbsd
-	  A missing sys/param.h include results in:
-	  /usr/include/sys/proc.h:64: error: 'MAXLOGNAME' undeclared here (not in a
-	  function)
-	  /usr/include/sys/proc.h:285: error: 'MAXCOMLEN' undeclared here (not in a
-	  function)
-	  when compiling goom on openbsd/ppc. We can just remove the two sys/ includes
-	  here, they are not needed for anything.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=654749
-
-2011-07-14 20:10:02 -0400  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtp/gstrtppcmadepay.c:
-	* gst/rtp/gstrtppcmapay.c:
-	* gst/rtp/gstrtppcmudepay.c:
-	* gst/rtp/gstrtppcmupay.c:
-	  rtppcmApay/depay: Static clock rates on static payloads, dynamic on dynamic
-	  Partially reverts 397dc60b
-
-2011-03-04 15:41:22 -0500  Olivier Crête <olivier.crete@collabora.co.uk>
-
-	* gst/rtp/Makefile.am:
-	* gst/rtp/gstrtph264pay.c:
-	  rtph264pay: Implement getcaps
-	  Convert profile-level-id from RTP caps into video/x-h264 style caps (with profile and level)
-
-2011-07-12 15:04:38 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: fix seeking regression
-	  ... introduced when shuffling around code for the async implementation
-	  by setting state of source (and udp sources) in _play before downstream
-	  flushing is undone.
-
-2011-07-11 15:23:41 +0300  René Stadler <rene.stadler@nokia.com>
-
-	* gst/audioparsers/gstac3parse.c:
-	* gst/audioparsers/gstac3parse.h:
-	  ac3parse: fix buffer duration on blocks-per-frame change
-	  The gst_base_parse_set_frame_rate call was predicated on a change to
-	  sample rate, duration or profile. However, the block count per frame can
-	  also change between packets, which would result in incorrect buffer
-	  durations.
-
-2011-07-09 19:23:41 -0700  David Schleef <ds@schleef.org>
-
-	* gst/multifile/gstmultifilesrc.c:
-	* gst/multifile/gstmultifilesrc.h:
-	  multifilesrc: Improve looping
-	  Add start-index and stop-index properties.
-
-2011-06-16 13:57:03 +0100  Jonny Lamb <jonnylamb@jonnylamb.com>
-
-	* gst/multifile/gstmultifilesrc.c:
-	* gst/multifile/gstmultifilesrc.h:
-	  multifile: add loop property to multifilesrc
-	  Fixes: #652727
-	  Signed-off-by: Jonny Lamb <jonnylamb@jonnylamb.com>
-	  Signed-off-by: David Schleef <ds@schleef.org>
-
-2009-11-20 10:07:43 +0100  Philip Jägenstedt <philipj@opera.com>
-
-	* sys/directsound/gstdirectsoundsink.c:
-	  directsoundsink: 16-bit audio is signed, 8-bit is unsigned.
-	  Pretending to handle 8-bit signed causes distorted audio when
-	  actually given such audio, which you will get if passing 8-bit
-	  unsigned through audioconvert ! audioresample, as audioresample
-	  only handles 8-bit signed.  Fixes #605834.
-	  Signed-off-by: David Schleef <ds@schleef.org>
-
-2011-07-07 18:27:36 +0200  Alexey Fisher <bug-track@fisher-privat.net>
-
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: handle blocks with duration=0
-	  Some video frames, for example alt-ref frame in VP8, will be
-	  never displayed. This is why it has duration=0.
-	  This patch allow to use this duration.
-	  Bug: 654175
-	  Signed-off-by: Alexey Fisher <bug-track@fisher-privat.net>
-
-2011-07-06 17:18:05 -0700  David Schleef <ds@schleef.org>
-
-	* gst/isomp4/gstqtmux.c:
-	* gst/isomp4/gstqtmuxmap.c:
-	  qtmux: Add direct dirac mapping
-
-2011-06-29 20:59:26 +0300  René Stadler <rene.stadler@nokia.com>
-
-	* ext/pulse/pulsesink.c:
-	* ext/pulse/pulsesink.h:
-	  pulsesink: prevent race condition causing ref leak
-	  Since commit 8bfd80, gst_pulseringbuffer_stop doesn't wait for the
-	  deferred call to be run before returning. This causes a race when
-	  READY->NULL is executed shortly after, which stops the mainloop. This
-	  leaks the element reference which is passed as userdata for the callback
-	  (introduced in commit 7cf996, bug #614765).
-	  The correct fix is to wait in READY->NULL for all outstanding calls to
-	  be fired (since libpulse doesn't provide a DestroyNotify for the
-	  userdata). We get rid of the reference passing from 7cf996 altogether,
-	  since finalization from the callback would anyways lead to a deadlock.
-	  Re-fixes bug #614765.
-
-2011-07-04 08:58:14 +0300  René Stadler <rene.stadler@nokia.com>
-
-	* ext/pulse/pulsesink.c:
-	  pulsesink: small cleanup of copy-paste code
-
-2011-06-29 19:50:42 +0300  René Stadler <rene.stadler@nokia.com>
-
-	* ext/pulse/pulsesink.c:
-	* ext/pulse/pulsesink.h:
-	  pulsesink: remove unused member variable and misleading log message
-	  Wim changed it in commit 8bfd80 so that pa_defer_ran is not read
-	  anywhere.
-	  The log message used to annotate a mainloop_wait call which is gone.
-
-2011-07-04 12:58:38 -0700  David Schleef <ds@schleef.org>
-
-	* gst/goom/gstgoom.c:
-	  goom: Don't answer lantency queries before negotiation
-
-2011-07-04 14:30:09 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/jpeg/gstjpegdec.c:
-	  jpegdec: avoid crashing on invalid input without components
-
-2011-07-04 11:25:28 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/flv/gstflvmux.c:
-	  flvmux: pass along segment info to collectpads
-	  ... so it can track this and be subsequently used to determine running time etc.
-
-2011-07-04 11:24:23 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/flv/gstflvdemux.c:
-	  flvdemux: indicate raw format in aac caps
-
-2011-07-03 19:51:32 -0700  David Schleef <ds@schleef.org>
-
-	* ext/pulse/plugin.c:
-	  pulse: Increase ranks to PRIMARY + 10
-	  So that pulsesrc/pulsesink get chosen over other possible PRIMARY
-	  src/sinks by autoaudiosink.  Presumably, if pulse is available, it
-	  is always preferred over another src/sink.
-	  Fixes: #647540.
-
-2011-06-30 18:47:48 -0700  David Schleef <ds@schleef.org>
-
-	* gst/multipart/multipartmux.c:
-	  multipartmux: Add \r\n to tail of pushed buffers
-	  Clients such as Firefox require the \r\n after the payload.
-
-2011-06-16 14:52:51 +0200  Branko Subasic <branko@axis.com>
-
-	* gst/matroska/ebml-read.c:
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: avoid looping when searching for clusters
-	  Fixes some bugs that results in the demuxer looping when seaching
-	  for clusters in non-finalized files.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=652195
-
-2011-06-10 18:54:48 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-parse.c:
-	  matroskaparse: fix reference counting of parse->streamheader
-	  https://bugzilla.gnome.org/show_bug.cgi?id=652286
-	  Signed-off-by: David Schleef <ds@schleef.org>
-
-2011-06-29 14:39:52 -0700  David Schleef <ds@schleef.org>
-
-	* ext/jpeg/gstjpegenc.c:
-	  jpegenc: Don't round up size of encoded buffers
-	  For some reason, in code dating to 2001, encoded jpeg buffers were
-	  rounded up to multiples of 4 bytes.  With the added bonus that the
-	  extra bytes are unwritten, causing valgrind issues.  Oops.  I can't
-	  think of any reason why JPEG buffers need to be multiples of 4 bytes,
-	  so I removed the padding.  There might be some code somewhere that
-	  depends on this behavior, so if this needs to be reverted, please fix
-	  the valgrind issues.
-
-2011-06-29 12:05:04 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/isomp4/gstqtmux.c:
-	  qtmux: free date tag
-
-2011-06-28 12:26:37 +0200  Jonas Larsson <jonas.larsson@hiq.se>
-
-	* gst/audioparsers/gstaacparse.c:
-	  aacparse: not so greedy minimum frame size
-	  Fixes #653559.
-
-2011-06-25 11:39:23 -0700  David Schleef <ds@schleef.org>
-
-	* configure.ac:
-	  configure: remove non-pkg-config check for shout
-	  Fixes: 653327
-
-2011-06-20 18:49:57 +0200  Andoni Morales Alastruey <amorales@flumotion.com>
-
-	* ext/raw1394/gst1394clock.c:
-	  dv1394src: make the internal clock thread safe
-	  Fixes: #653091.
-
-2011-06-24 11:54:29 +0200  Miguel Angel Cabrera Moya <madmac2501@gmail.com>
-
-	* gst/rtpmanager/rtpjitterbuffer.c:
-	  rtpjitterbuffer: return correct type when assertion fails
-
-2011-06-23 11:28:27 -0700  David Schleef <ds@schleef.org>
-
-	* common:
-	  Automatic update of common submodule
-	  From 69b981f to 605cd9a
-
-2011-02-02 16:18:54 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* configure.ac:
-	* ext/pulse/pulsesink.c:
-	* ext/pulse/pulsesrc.c:
-	* ext/pulse/pulseutil.c:
-	* ext/pulse/pulseutil.h:
-	  pulse: Drop support for PA versions before 0.9.16
-	  This drops support fof PulseAudio versions prior to 0.9.16, which was
-	  released about 1.5 years ago. Testing with very old versions is not
-	  feasible and we don't want to maintain 2 independent code-paths.
-
-2011-06-21 15:15:06 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtp/gstrtpmp4adepay.c:
-	  rtpmp4adepay: fix output buffer timestamps in case of multiple frames
-
-2011-06-20 16:47:36 -0400  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst/rtpmanager/rtpsession.c:
-	  rtpsession: The signal has 5 arguments, not 4
-
-2011-06-18 13:43:02 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	  Bump git version after unplanned 0.10.30 release
-	  Merge branch '0.10.30'
-	  Conflicts:
-	  configure.ac
-	  docs/plugins/inspect/plugin-1394.xml
-	  docs/plugins/inspect/plugin-aasink.xml
-	  docs/plugins/inspect/plugin-alaw.xml
-	  docs/plugins/inspect/plugin-alpha.xml
-	  docs/plugins/inspect/plugin-alphacolor.xml
-	  docs/plugins/inspect/plugin-annodex.xml
-	  docs/plugins/inspect/plugin-apetag.xml
-	  docs/plugins/inspect/plugin-audiofx.xml
-	  docs/plugins/inspect/plugin-audioparsers.xml
-	  docs/plugins/inspect/plugin-auparse.xml
-	  docs/plugins/inspect/plugin-autodetect.xml
-	  docs/plugins/inspect/plugin-avi.xml
-	  docs/plugins/inspect/plugin-cacasink.xml
-	  docs/plugins/inspect/plugin-cairo.xml
-	  docs/plugins/inspect/plugin-cutter.xml
-	  docs/plugins/inspect/plugin-debug.xml
-	  docs/plugins/inspect/plugin-deinterlace.xml
-	  docs/plugins/inspect/plugin-dv.xml
-	  docs/plugins/inspect/plugin-efence.xml
-	  docs/plugins/inspect/plugin-effectv.xml
-	  docs/plugins/inspect/plugin-equalizer.xml
-	  docs/plugins/inspect/plugin-esdsink.xml
-	  docs/plugins/inspect/plugin-flac.xml
-	  docs/plugins/inspect/plugin-flv.xml
-	  docs/plugins/inspect/plugin-flxdec.xml
-	  docs/plugins/inspect/plugin-gconfelements.xml
-	  docs/plugins/inspect/plugin-gdkpixbuf.xml
-	  docs/plugins/inspect/plugin-goom.xml
-	  docs/plugins/inspect/plugin-goom2k1.xml
-	  docs/plugins/inspect/plugin-gstrtpmanager.xml
-	  docs/plugins/inspect/plugin-halelements.xml
-	  docs/plugins/inspect/plugin-icydemux.xml
-	  docs/plugins/inspect/plugin-id3demux.xml
-	  docs/plugins/inspect/plugin-imagefreeze.xml
-	  docs/plugins/inspect/plugin-interleave.xml
-	  docs/plugins/inspect/plugin-isomp4.xml
-	  docs/plugins/inspect/plugin-jack.xml
-	  docs/plugins/inspect/plugin-jpeg.xml
-	  docs/plugins/inspect/plugin-level.xml
-	  docs/plugins/inspect/plugin-matroska.xml
-	  docs/plugins/inspect/plugin-mulaw.xml
-	  docs/plugins/inspect/plugin-multifile.xml
-	  docs/plugins/inspect/plugin-multipart.xml
-	  docs/plugins/inspect/plugin-navigationtest.xml
-	  docs/plugins/inspect/plugin-oss4.xml
-	  docs/plugins/inspect/plugin-ossaudio.xml
-	  docs/plugins/inspect/plugin-png.xml
-	  docs/plugins/inspect/plugin-pulseaudio.xml
-	  docs/plugins/inspect/plugin-replaygain.xml
-	  docs/plugins/inspect/plugin-rtp.xml
-	  docs/plugins/inspect/plugin-rtsp.xml
-	  docs/plugins/inspect/plugin-shapewipe.xml
-	  docs/plugins/inspect/plugin-shout2send.xml
-	  docs/plugins/inspect/plugin-smpte.xml
-	  docs/plugins/inspect/plugin-soup.xml
-	  docs/plugins/inspect/plugin-spectrum.xml
-	  docs/plugins/inspect/plugin-speex.xml
-	  docs/plugins/inspect/plugin-taglib.xml
-	  docs/plugins/inspect/plugin-udp.xml
-	  docs/plugins/inspect/plugin-video4linux2.xml
-	  docs/plugins/inspect/plugin-videobox.xml
-	  docs/plugins/inspect/plugin-videocrop.xml
-	  docs/plugins/inspect/plugin-videofilter.xml
-	  docs/plugins/inspect/plugin-videomixer.xml
-	  docs/plugins/inspect/plugin-wavenc.xml
-	  docs/plugins/inspect/plugin-wavpack.xml
-	  docs/plugins/inspect/plugin-wavparse.xml
-	  docs/plugins/inspect/plugin-ximagesrc.xml
-	  docs/plugins/inspect/plugin-y4menc.xml
-	  win32/common/config.h
-
-2011-06-17 10:37:33 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* sys/sunaudio/gstsunaudiosink.c:
-	* sys/sunaudio/gstsunaudiosink.h:
-	  sunaudio: fix typo in comment
-
-2011-06-17 03:07:09 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst/audiofx/audioecho.c:
-	  audioecho: fix param flags
-	  If the parameter cannot be changed in paused&playing, it is not controlable. Set
-	  the appropriate mutability flag instead.
-
-=== release 0.10.30 ===
-
-2011-06-15 23:57:34 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ChangeLog:
-	* NEWS:
-	* RELEASE:
-	* configure.ac:
-	* docs/plugins/inspect/plugin-1394.xml:
-	* docs/plugins/inspect/plugin-aasink.xml:
-	* docs/plugins/inspect/plugin-alaw.xml:
-	* docs/plugins/inspect/plugin-alpha.xml:
-	* docs/plugins/inspect/plugin-alphacolor.xml:
-	* docs/plugins/inspect/plugin-annodex.xml:
-	* docs/plugins/inspect/plugin-apetag.xml:
-	* docs/plugins/inspect/plugin-audiofx.xml:
-	* docs/plugins/inspect/plugin-audioparsers.xml:
-	* docs/plugins/inspect/plugin-auparse.xml:
-	* docs/plugins/inspect/plugin-autodetect.xml:
-	* docs/plugins/inspect/plugin-avi.xml:
-	* docs/plugins/inspect/plugin-cacasink.xml:
-	* docs/plugins/inspect/plugin-cairo.xml:
-	* docs/plugins/inspect/plugin-cutter.xml:
-	* docs/plugins/inspect/plugin-debug.xml:
-	* docs/plugins/inspect/plugin-deinterlace.xml:
-	* docs/plugins/inspect/plugin-dv.xml:
-	* docs/plugins/inspect/plugin-efence.xml:
-	* docs/plugins/inspect/plugin-effectv.xml:
-	* docs/plugins/inspect/plugin-equalizer.xml:
-	* docs/plugins/inspect/plugin-esdsink.xml:
-	* docs/plugins/inspect/plugin-flac.xml:
-	* docs/plugins/inspect/plugin-flv.xml:
-	* docs/plugins/inspect/plugin-flxdec.xml:
-	* docs/plugins/inspect/plugin-gconfelements.xml:
-	* docs/plugins/inspect/plugin-gdkpixbuf.xml:
-	* docs/plugins/inspect/plugin-goom.xml:
-	* docs/plugins/inspect/plugin-goom2k1.xml:
-	* docs/plugins/inspect/plugin-gstrtpmanager.xml:
-	* docs/plugins/inspect/plugin-halelements.xml:
-	* docs/plugins/inspect/plugin-icydemux.xml:
-	* docs/plugins/inspect/plugin-id3demux.xml:
-	* docs/plugins/inspect/plugin-imagefreeze.xml:
-	* docs/plugins/inspect/plugin-interleave.xml:
-	* docs/plugins/inspect/plugin-isomp4.xml:
-	* docs/plugins/inspect/plugin-jack.xml:
-	* docs/plugins/inspect/plugin-jpeg.xml:
-	* docs/plugins/inspect/plugin-level.xml:
-	* docs/plugins/inspect/plugin-matroska.xml:
-	* docs/plugins/inspect/plugin-mulaw.xml:
-	* docs/plugins/inspect/plugin-multifile.xml:
-	* docs/plugins/inspect/plugin-multipart.xml:
-	* docs/plugins/inspect/plugin-navigationtest.xml:
-	* docs/plugins/inspect/plugin-oss4.xml:
-	* docs/plugins/inspect/plugin-ossaudio.xml:
-	* docs/plugins/inspect/plugin-png.xml:
-	* docs/plugins/inspect/plugin-pulseaudio.xml:
-	* docs/plugins/inspect/plugin-replaygain.xml:
-	* docs/plugins/inspect/plugin-rtp.xml:
-	* docs/plugins/inspect/plugin-rtsp.xml:
-	* docs/plugins/inspect/plugin-shapewipe.xml:
-	* docs/plugins/inspect/plugin-shout2send.xml:
-	* docs/plugins/inspect/plugin-smpte.xml:
-	* docs/plugins/inspect/plugin-soup.xml:
-	* docs/plugins/inspect/plugin-spectrum.xml:
-	* docs/plugins/inspect/plugin-speex.xml:
-	* docs/plugins/inspect/plugin-taglib.xml:
-	* docs/plugins/inspect/plugin-udp.xml:
-	* docs/plugins/inspect/plugin-video4linux2.xml:
-	* docs/plugins/inspect/plugin-videobox.xml:
-	* docs/plugins/inspect/plugin-videocrop.xml:
-	* docs/plugins/inspect/plugin-videofilter.xml:
-	* docs/plugins/inspect/plugin-videomixer.xml:
-	* docs/plugins/inspect/plugin-wavenc.xml:
-	* docs/plugins/inspect/plugin-wavpack.xml:
-	* docs/plugins/inspect/plugin-wavparse.xml:
-	* docs/plugins/inspect/plugin-ximagesrc.xml:
-	* docs/plugins/inspect/plugin-y4menc.xml:
-	* gst-plugins-good.doap:
-	* win32/common/config.h:
-	  Release 0.10.30
-	  This is an ad-hoc release that is almost identical to 0.10.29:
-	  * work around GLib atomic ops API change
-	  * better handling of malformed buffers in RTP depayloders
-	  * some minor compilation fixes
-
-2011-06-08 18:33:10 +0300  Raimo Järvi <raimo.jarvi@gmail.com>
-
-	* gst/udp/gstudpnetutils.h:
-	  udp: Fix compiler warning on mingw-w64
-	  Fixes: #652144.
-	  gstudpnetutils.h:32:0: error: "WINVER" redefined
-	  /usr/i686-w64-mingw32/sys-root/mingw/include/_mingw.h:231:0: note: this is the
-	  location of the previous definition
-
-2011-06-04 13:49:52 -0700  David Schleef <ds@schleef.org>
-
-	* gst/interleave/interleave.c:
-	  interleave: Work around changes in g_atomic API
-	  See #651514 for details.
-
-2011-05-18 12:36:40 +0200  Jose Antonio Santos Cadenas <santoscadenas@gmail.com>
-
-	* gst/rtp/gstrtpac3depay.c:
-	* gst/rtp/gstrtpbvdepay.c:
-	* gst/rtp/gstrtpg722depay.c:
-	* gst/rtp/gstrtpg726depay.c:
-	* gst/rtp/gstrtpgsmdepay.c:
-	* gst/rtp/gstrtpilbcdepay.c:
-	* gst/rtp/gstrtpmp1sdepay.c:
-	* gst/rtp/gstrtpmp2tdepay.c:
-	* gst/rtp/gstrtpmpvdepay.c:
-	* gst/rtp/gstrtppcmadepay.c:
-	* gst/rtp/gstrtppcmudepay.c:
-	* gst/rtp/gstrtpspeexdepay.c:
-	  rtp: Fix segmentation fault processing payload buffers
-	  This commit checks if the value returned by
-	  gst_rtp_buffer_get_payload_buffer and
-	  gst_rtp_buffer_get_payload_subbuffer is NULL before using it.
-
-2011-05-16 09:04:31 +0200  Pino Toscano <toscano.pino@tiscali.it>
-
-	* ext/pulse/pulseutil.c:
-	  pulse: Define PATH_MAX if it isn't defined
-	  GNU Hurd for example doesn't define it.
-
-2011-04-29 08:55:19 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/wavenc/gstwavenc.c:
-	  wavenc: Allow setcaps to be called after a format was negotiated if it's compatible
-	  Otherwise wavenc will fail if upstream decides to set equivalent caps or caps
-	  with additional information later.
-	  Thanks to Alexander Schremmer for finding this bug.
-
-2011-06-09 21:06:28 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst/matroska/matroska-read-common.c:
-	  matroska: add missing stdio include for sscanf
-
-2011-06-13 17:05:19 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/audioparsers/gstac3parse.c:
-	* gst/audioparsers/gstmpegaudioparse.c:
-	  audioparsers: not so greedy minimum frame size
-	  ... which will be determined by parsing anyway, and avoids introducing
-	  redundant additional latency.
-
-2011-06-08 18:33:10 +0300  Raimo Järvi <raimo.jarvi@gmail.com>
-
-	* gst/udp/gstudpnetutils.h:
-	  udp: Fix compiler warning on mingw-w64
-	  Fixes: #652144.
-	  gstudpnetutils.h:32:0: error: "WINVER" redefined
-	  /usr/i686-w64-mingw32/sys-root/mingw/include/_mingw.h:231:0: note: this is the
-	  location of the previous definition
-
-2011-06-06 18:21:04 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following function to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_parse_chapters
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-06-06 14:47:27 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-demux.h:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-parse.h:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following function to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_parse_attachments
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-06-06 12:43:14 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following function to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_parse_attached_file
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-06-05 22:45:55 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-demux.h:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-parse.h:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following function to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_parse_info
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-06-05 10:15:23 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-demux.h:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-parse.h:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following function to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_parse_metadata
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-06-05 09:54:42 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following function to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_parse_metadata_id_tag
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-06-05 02:24:41 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following function to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_parse_metadata_id_simple_tag
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-06-06 12:42:53 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: reset state tracking variable when appropriate
-	  ... so we don't end up interrupting an operation that should not be interrupted
-	  based on the indication of a previous interruptable operation.
-
-2011-06-04 13:49:52 -0700  David Schleef <ds@schleef.org>
-
-	* gst/interleave/interleave.c:
-	  interleave: Work around changes in g_atomic API
-	  See #651514 for details.
-
-2011-06-04 13:43:00 -0700  David Schleef <ds@schleef.org>
-
-	* ext/soup/gstsouphttpsink.c:
-	* ext/soup/gstsouphttpsink.h:
-	  souphttpsink: code cleanup
-
-2011-06-05 02:00:08 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-parse.c:
-	  matroskaparse: Use ARTIST tag instead of AUTHOR for GST_TAG_ARTIST
-	  AUTHOR only existed in an old version of the spec and ARTIST is
-	  the new replacement for this. We are still reading both to still
-	  be compatible with old files.
-	  Fixes bug #644875.
-
-2011-06-02 13:38:30 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* ext/dv/gstdvdemux.c:
-	  dvdemux: First query the peer duration in the requested format before converting to BYTES
-	  Fixes usage of dvdemux after another demuxer, e.g. mxfdemux.
-	  Fixes bug #650503.
-
-2011-06-02 10:41:52 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* ext/soup/gstsouphttpsink.c:
-	  souphttpsink: Fix refcounting of the "session" property
-	  Properties should never take ownership of the values
-	  passed to them.
-
-2011-06-01 17:04:27 -0700  David Schleef <ds@schleef.org>
-
-	* gst/matroska/matroska-mux.c:
-	  matroskamux: For streaming files, push tags first
-
-2011-05-24 14:52:01 -0700  David Schleef <ds@schleef.org>
-
-	* ext/soup/Makefile.am:
-	* ext/soup/gstsoup.c:
-	* ext/soup/gstsouphttpsink.c:
-	* ext/soup/gstsouphttpsink.h:
-	* ext/soup/gstsouphttpsrc.c:
-	  soup: Add souphttpsink
-
-2011-06-01 10:19:31 +0200  Thijs Vermeir <thijsvermeir@gmail.com>
-
-	* gst/udp/gstudpsrc.c:
-	  udpsrc: allow skip-first-bytes of full buffer size
-
-2011-05-30 18:31:50 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following functions to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_parse_header
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-30 12:09:31 +0200  Antonio Frediani <antonio.frediani@inwind.it>
-
-	* gst/isomp4/gstqtmux.c:
-	  qtmux: Use GST_TAG_IMAGE for coverart too
-	  Fixes bug #638107.
-
-2011-05-30 10:40:08 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following functions to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_get_seek_track
-	  - gst_matroska_{demux,parse}_reset_streams
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-28 22:04:34 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-demux.h:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-parse.h:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following function to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska{demux,parse}_found_global_tag
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-28 10:59:09 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following functions to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_index_seek_find
-	  - gst_matroska{demux,parse}_do_index_seek
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-27 23:15:23 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following function to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_tracknumber_unique
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-27 20:28:19 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following function to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_decode_data
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-27 19:30:48 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following function to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_get_length
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-27 09:17:46 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/avi/gstavimux.c:
-	  avimux: Revert 1a90a6c4 and drop Dirac support again
-	  It does not work at all (A/V sync issues), is not very useful,
-	  other containers work much better with Dirac and Dirac in AVI
-	  is not supported by other software.
-	  Fixes bug #541215.
-
-2011-05-26 23:35:52 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following functions to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_encoding_cmp
-	  - gst_matroska_{demux,parse}_read_track_encodings
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-23 18:06:44 +0300  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following functions to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_peek_id_length_pull
-	  - gst_matroska_{demux,parse}_peek_id_length_push
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-23 18:06:44 +0300  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-demux.h:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-parse.h:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following function to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_peek_adapter
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-26 12:48:36 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* sys/ximage/ximageutil.c:
-	  xvimagesink: Fallback to non-XShm mode if allocating the XShm image failed
-	  Fixes bug #630456.
-
-2011-05-26 12:22:52 +0200  Marc Leeman <marc.leeman@gmail.com>
-
-	* gst/rtp/gstrtpmp4vpay.c:
-	  rtpmp4vpay: Deprecated send-config property and replace by config-interval
-	  Fixes bug #622412.
-
-2010-06-23 11:12:00 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-ids.h:
-	  matroskademux: UTF-8 subtitles may have markup
-	  Fixes #616936.
-
-2011-01-23 15:56:49 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/cairo/gsttextoverlay.c:
-	* ext/cairo/gsttextoverlay.h:
-	  cairotextoverlay: forward new segment events from the sink to the source
-	  Not doing so will cause buffers to be received by downstream without
-	  a time base set.
-	  We use the same method avimux uses to get access to the event when
-	  collectpads got the sink event function.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=640323
-
-2011-01-24 11:11:48 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/cairo/gsttextoverlay.c:
-	  textoverlay: forward source events to sinks
-	  Events are passed to the video sink, and to the text sink if it is
-	  linked.
-	  This will allow seeking, for instance.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=586450
-
-2011-05-25 21:12:12 +0200  David Hoyt <dhoyt@llnl.gov>
-
-	* gst/multipart/multipartdemux.c:
-	* gst/multipart/multipartdemux.h:
-	  multipartdemux: Add property to assume a single stream and emit no-more-pads
-	  Fixes bug #616686.
-
-2011-05-25 14:50:26 +0200  Miguel Angel Cabrera Moya <madmac2501@gmail.com>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: uniform unknown message handling
-	  Do the same processing in all the cases when an unknown message is received.
-	  That is, give a warning.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=651059
-
-2011-05-23 18:06:44 +0300  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following function to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_peek_pull
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-23 18:06:44 +0300  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-demux.h:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-parse.h:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following function to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_peek_bytes
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-23 18:06:44 +0300  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following functions to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_{demux,parse}_encoding_order_unique
-	  - gst_matroska_{demux,parse}_read_track_encoding
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-24 13:12:19 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtp/gstrtppcmudepay.c:
-	  pcmudepay: allow variable sample rate
-
-2011-05-24 13:11:54 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtp/gstrtppcmadepay.c:
-	  pcmadepay: allow variable sample rate
-
-2010-04-04 06:43:41 -0500  Rob Clark <rob@ti.com>
-
-	* sys/v4l2/gstv4l2object.c:
-	* sys/v4l2/gstv4l2object.h:
-	* sys/v4l2/gstv4l2sink.c:
-	* sys/v4l2/gstv4l2tuner.c:
-	* sys/v4l2/gstv4l2tuner.h:
-	* sys/v4l2/v4l2_calls.c:
-	  v4l2: add norm property
-	  Based on a patch by Guennadi Liakhovetski.
-	  v2: updates because I forgot to add GstTuner interface to v4l2sink
-	  v3: update to add all possible values to norm enum
-
-2011-05-23 20:46:04 +0300  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: fixed copyright headers
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-23 18:06:44 +0300  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Move the following functions to matroska-read-common.[ch] from
-	  matroska-demux.c and matroska-parse.c:
-	  - gst_matroska_decode_content_encodings
-	  - gst_matroska_decompress_data
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-23 18:48:57 +0300  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-demux.h:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-parse.h:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: move GstMatroska{Demux,Parse}::state to GstMatroskaReadCommon
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-24 09:48:56 +0200  Jonas Larsson <jonas.larsson@hiq.se>
-
-	* gst/isomp4/qtdemux.c:
-	  qtdemux: Fix buffer leak with corrupted files
-	  Fixes bug #650912.
-
-2011-05-23 02:46:38 -0700  Miguel Angel Cabrera Moya <madmac2501@gmail.com>
-
-	* gst/deinterlace/gstdeinterlace.c:
-	  deinterlace: fix parameter type in trace
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650937
-
-2011-05-23 18:06:44 +0300  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/Makefile.am:
-	* gst/matroska/matroska-demux.c:
-	* gst/matroska/matroska-demux.h:
-	* gst/matroska/matroska-parse.c:
-	* gst/matroska/matroska-parse.h:
-	* gst/matroska/matroska-read-common.c:
-	* gst/matroska/matroska-read-common.h:
-	  matroska: refactor code common to matroskademux and matroskaparse
-	  Replace the following functions with their gst_matroska_read_common_*
-	  counterparts:
-	  - gst_matroska_{demux,parse}_parse_index
-	  - gst_matroska_{demux,parse}_parse_skip
-	  - gst_matroska_{demux,parse}_stream_from_num
-	  Introduce GstMatroskaReadCommon to contain those members of
-	  GstMatroskaDemux and GstMatroskaParse that were used by the above
-	  functions.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650877
-
-2011-05-23 13:50:46 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/audioparsers/gstflacparse.c:
-	  flacparse: tell baseparse the duration in samples for better accuracy
-	  Tell GstBaseParse the duration in samples instead of time, so that
-	  a duration query in DEFAULT format will return the correct number
-	  of samples without rounding errors. Baseparse will convert this
-	  into time itself when needed.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650785
-
-2011-05-23 13:25:44 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/flac/gstflacdec.c:
-	  flacdec: also try upstream first for duration query in DEFAULT format
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650785
-
-2011-05-23 13:23:21 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/audioparsers/gstflacparse.c:
-	  flacparse: make conversion from TIME to DEFAULT format (samples) work
-	  Fix copy'n'paste error in the previous commit.
-
-2011-05-23 11:36:36 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/audioparsers/gstflacparse.c:
-	  flacparse: Implement conversions between TIME and DEFAULT format
-	  Fixes bug #650785.
-
-2011-05-22 18:50:51 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/audioparsers/gstflacparse.c:
-	  flacparse: don't error out on invalid minimum_blocksize value in streaminfo header
-	  We don't use it, so may just as well accept an invalid value
-	  of 0 here, which is likely inconsequential anyway.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650691
-
-2011-05-20 10:34:47 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst/rtp/gstrtpjpegpay.c:
-	* gst/rtp/gstrtpmp4adepay.c:
-	* gst/rtp/gstrtpqcelpdepay.c:
-	  rtp: fix static array overruns in a nicer way
-	  Use G_N_ELEMENTS instead of hard-coding the array size.
-
-2011-05-20 00:53:44 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst/rtp/gstrtpjpegpay.c:
-	* gst/rtp/gstrtpmp4adepay.c:
-	* gst/rtp/gstrtpqcelpdepay.c:
-	  rtp: fix static array overruns
-	  Yes array[10] has elements from 0...9.
-
-2011-05-19 23:31:19 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* docs/plugins/gst-plugins-good-plugins.args:
-	* docs/plugins/gst-plugins-good-plugins.hierarchy:
-	* docs/plugins/gst-plugins-good-plugins.interfaces:
-	* docs/plugins/gst-plugins-good-plugins.prerequisites:
-	  docs: update plugin introspection data
-	  Now more files are merged and produced in a canonical fashion, which hopefully
-	  creates less or no delta in the future.
-
-2011-05-19 22:57:15 +0300  Stefan Kost <ensonic@users.sf.net>
+=== release 0.10.30 ===
 
-	* common:
-	  Automatic update of common submodule
-	  From 9e5bbd5 to 69b981f
+2011-06-15  Tim-Philipp Müller <tim.muller@collabora.co.uk>
 
-2011-05-19 18:21:33 +0300  Stefan Kost <ensonic@users.sf.net>
+	* configure.ac:
+	  releasing 0.10.30, "Adagio"
 
-	* gst/isomp4/qtdemux.c:
-	  qtdemux: add missing break
+2011-06-08 18:33:10 +0300  Raimo Järvi <raimo.jarvi@gmail.com>
 
-2010-11-08 14:06:15 +0100  Robert Swain <robert.swain@collabora.co.uk>
+	* gst/udp/gstudpnetutils.h:
+	  udp: Fix compiler warning on mingw-w64
+	  Fixes: #652144.
+	  gstudpnetutils.h:32:0: error: "WINVER" redefined
+	  /usr/i686-w64-mingw32/sys-root/mingw/include/_mingw.h:231:0: note: this is the
+	  location of the previous definition
 
-	* gst/deinterlace/gstdeinterlace.c:
-	* gst/deinterlace/gstdeinterlace.h:
-	  deinterlace: Add support for deinterlacing using buffer caps/flags
-	  When not using the fieldanalysis element immediately upstream of deinterlace,
-	  behaviour should remain unchanged. fieldanalysis will set the caps and flags on
-	  the buffers such that they can be interpreted and acted upon to produce
-	  progressive output.
-	  There are two main modes of operation:
-	  - Passive pattern locking
-	  Passive pattern locking is a non-blocking, low-latency mode of operation that
-	  is suitable for close-to-live usage. Initially a telecine stream will be
-	  output as variable framerate with naïve timestamp adjustment. With each
-	  incoming buffer, an attempt is made to lock onto a pattern. When a lock is
-	  obtained, the src pad and output buffer caps will reflect the pattern and
-	  timestamps will be accurately interpolated between pattern repeats. This
-	  means that initially and at pattern transitions there will be short periods
-	  of inaccurate timestamping.
-	  - Active pattern locking
-	  Active pattern locking is a blocking, high-latency mode of operation that is
-	  targeted at use-cases where timestamp accuracy is paramount. Buffers will be
-	  queued until enough are present to make a lock. When locked, timestamps will
-	  be accurately interpolated between pattern repeats. Orphan fields can be
-	  dropped or deinterlaced. If no lock can be obtained, a single field might be
-	  pushed through to be deinterlaced.
-	  Locking can also be disabled or 'auto' chooses between passive and active
-	  locking modes depending on whether upstream is live.
-
-2011-05-10 16:25:40 -0700  David Schleef <ds@schleef.org>
+2011-06-04 13:49:52 -0700  David Schleef <ds@schleef.org>
 
-	* configure.ac:
-	  configure: Remove config script check for caca
+	* gst/interleave/interleave.c:
+	  interleave: Work around changes in g_atomic API
+	  See #651514 for details.
 
 2011-05-18 12:36:40 +0200  Jose Antonio Santos Cadenas <santoscadenas@gmail.com>
 
@@ -3950,249 +39,12 @@
 	  gst_rtp_buffer_get_payload_buffer and
 	  gst_rtp_buffer_get_payload_subbuffer is NULL before using it.
 
-2011-05-18 16:10:07 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* common:
-	  Automatic update of common submodule
-	  From fd35073 to 9e5bbd5
-
-2011-05-18 12:52:31 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/avi/gstavidemux.c:
-	  avidemux: ensure 0-padding when correcting dubious list size
-
-2011-05-18 12:24:25 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* common:
-	  Automatic update of common submodule
-	  From 46dfcea to fd35073
-
-2011-05-18 10:22:27 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: use EINVAL for missing url parameter
-	  Fixes gcc warning about using uninitialized variable 'res'.
-
-2011-04-28 15:37:40 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst/debugutils/rndbuffersize.c:
-	* gst/videofilter/gstgamma.c:
-	  various: fix author tag in element details
-
-2011-04-20 15:25:58 -0400  Chris E Jones <chris@chrisejones.com>
-
-	* gst/auparse/gstauparse.c:
-	  auparse: implement seeking
-	  Implement seeking and seeking query. Fixes #644512
-
-2011-04-06 16:05:55 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: also allow PAUSE to be interrupted
-	  ... as it is on the way out to NULL.
-	  See #632504.
-
-2011-04-06 15:51:49 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: ensure proper closing and cleanup
-	  ... since the TEARDOWN sequence might not have had a chance to even start,
-	  but at least connections should be closed (synchronously) and state cleaned up.
-	  See #632504.
-
-2011-04-06 15:49:01 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	* gst/rtsp/gstrtspsrc.h:
-	  rtspsrc: fix and improve async handling
-	  Simplify the command handling; passing a command to thread means we really
-	  want it to get the message, which means to always flush provided the command
-	  can handle being interrupted.  Command thread indicates whether command
-	  allows interruption and ensure non-flushing connection as it subsequently
-	  needs it.
-	  In particular, this also makes the TEARDOWN sequence interruptable
-	  and also prevents races where _loop_ could miss a command and would
-	  continue receiving (or at least trying to).
-	  See #632504.
-
-2011-04-06 14:53:27 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: tweak post-seek loop handling
-
-2011-01-10 12:46:37 +0100  Wim Taymans <wim.taymans@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	* gst/rtsp/gstrtspsrc.h:
-	  rtspsrc: open on play and pause when not done yet
-	  With the async state changes, it is possible that we need to open the stream
-	  before play and pause.
-	  Also make sure we remember a previous open failure so that we don't keep trying
-	  again.
-
-2011-01-10 11:45:03 +0100  Wim Taymans <wim.taymans@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: improve async handling
-	  Simplify the command handling, only continue looping when we have not received
-	  another command or when the previous loop was successfull.
-	  Avoid looping on a disconnected socket.
-
-2011-01-07 18:02:49 +0100  Wim Taymans <wim.taymans@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: rework reconnect code
-	  Use the same async code path to implement reconnects.
-	  Make sure we only post progress messages when doing async things.
-
-2011-01-07 17:19:59 +0100  Wim Taymans <wim.taymans@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: small cleanups
-	  Make sure we cancel the previous task when queuing a new one.
-	  Move the messages to a central place so we can more easily post them.
-
-2011-01-07 15:15:49 +0100  Wim Taymans <wim.taymans@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: don't post errors when interrupting
-
-2011-01-07 13:43:06 +0100  Wim Taymans <wim.taymans@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	* gst/rtsp/gstrtspsrc.h:
-	  rtspsrc: implement more async handling
-	  Remove some old locks.
-	  Make sure we never go into the loop function when flushing.
-
-2011-01-07 11:40:32 +0100  Wim Taymans <wim.taymans@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.c:
-	  rtspsrc: first attempt at async implementation
-
-2011-01-07 11:40:11 +0100  Wim Taymans <wim.taymans@collabora.co.uk>
-
-	* gst/rtsp/gstrtspsrc.h:
-	  rtspsrc: small header cleanups
-
-2011-05-17 10:47:32 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpssrcdemux.c:
-	  ssrcdemux: Fix uninitialized variable compiler warning for (pre-) releases too
-
-2011-04-28 15:57:04 +0200  Edward Hervey <edward.hervey@collabora.co.uk>
-
-	* sys/v4l2/gstv4l2object.c:
-	  v4l2objects: Only allow mpeg-ts on source objects
-	  Ugly fix for #648312
-
-2011-05-17 09:24:08 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpssrcdemux.c:
-	  rtpssrcdemux: Fix uninitialized variable compiler warning
-
-2011-05-06 19:09:17 -0400  Olivier Crête <olivier.crete@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpssrcdemux.c:
-	  ssrcdemux: Implement iterate internal links for sink pads
-	  https://bugzilla.gnome.org/show_bug.cgi?id=649617
-
-2011-05-06 18:41:01 -0400  Olivier Crête <olivier.crete@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpssrcdemux.c:
-	  rtpssrcdemux: iterate pad function is only valid for src pads
-	  The iterate function is only used for src pads, so mark it as such and remove
-	  dead code.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=649617
-
-2011-05-06 18:12:53 -0400  Olivier Crête <olivier.crete@collabora.co.uk>
-
-	* gst/rtpmanager/gstrtpssrcdemux.c:
-	  rtpssrcdemux: Release lock before emitting signal
-	  If the lock is not released before emitting a signal, it may cause a deadlock
-	  if any other function in the element is called.
-	  Also removed an unused timestamp parameter
-	  https://bugzilla.gnome.org/show_bug.cgi?id=649617
-
-2011-05-15 23:25:15 +0300  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-parse.c:
-	  matroskaparse: calculate segment duration after parsing all the IDs
-	  Since the segment duration is given in terms of the
-	  GST_MATROSKA_ID_TIMECODESCALE we should only convert it into
-	  nanoseconds when we are sure that any scale specified in the file has
-	  been read.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650258
-
-2011-05-04 11:55:21 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: additional lock safety
-	  Fixes #619590.
-
-2011-04-26 16:06:56 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/isomp4/qtdemux.c:
-	  qtdemux: also check for bitrate info in caps
-
-2010-05-25 01:04:43 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* gst/isomp4/qtdemux.c:
-	* gst/isomp4/qtdemux.h:
-	  qtdemux: guess bitrate if only one stream's bitrate is unknown
-	  If the bitrates for all but one audio/video streams are known, and the
-	  total stream size and duration can be determined, this calculates the
-	  unkown bitrate as (stream size / duration) - (sum of known bitrates).
-	  While this is not guaranteed to be very accurate, it should be good
-	  enough for most purposes.
-	  For example, this is useful for H.263 + AAC streams where no 'btrt' atom
-	  is available for the video portion.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=619548
-
-2010-05-31 23:59:59 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* gst/isomp4/qtdemux.c:
-	  qtdemux: Export max bitrate for AMR-NB/-WB streams
-	  This parses the 'damr' atom if present, and exports the maximum bitrate
-	  of the stream using the mode set field to determine the highest bitrate
-	  frame type that might be present.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=620186
-
 2011-05-16 09:04:31 +0200  Pino Toscano <toscano.pino@tiscali.it>
 
 	* ext/pulse/pulseutil.c:
 	  pulse: Define PATH_MAX if it isn't defined
 	  GNU Hurd for example doesn't define it.
 
-2011-05-15 23:25:15 +0300  Debarshi Ray <rishi@gnu.org>
-
-	* gst/matroska/matroska-demux.c:
-	  matroskademux: calculate segment duration after parsing all the IDs
-	  Since the segment duration is given in terms of the
-	  GST_MATROSKA_ID_TIMECODESCALE we should only convert it into
-	  nanoseconds when we are sure that any scale specified in the file has
-	  been read.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=650258
-
-2011-05-09 19:00:45 +0200  Andoni Morales Alastruey <amorales@flumotion.com>
-
-	* gst/flv/gstflvmux.c:
-	  flvmux: Add support for mpegversion 2, which is also AAC
-
-2011-05-11 10:25:15 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* ext/flac/gstflacdec.c:
-	* ext/flac/gstflacdec.h:
-	  flacdec: Send EOS when seeking after the end of file instead of failing
-	  Fixes bug #649780.
-
-2011-04-29 08:59:20 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/wavenc/gstwavenc.c:
-	  wavenc: Set fixedcaps getcaps function on the sinkpad
-	  wavenc does not allow to change the caps during playback
-	  and always returning the template caps is just wrong.
-
 2011-04-29 08:55:19 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
 
 	* gst/wavenc/gstwavenc.c:
@@ -4201,82 +53,6 @@
 	  with additional information later.
 	  Thanks to Alexander Schremmer for finding this bug.
 
-2011-05-14 10:02:22 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* configure.ac:
-	* docs/plugins/gst-plugins-good-plugins.hierarchy:
-	* docs/plugins/inspect/plugin-1394.xml:
-	* docs/plugins/inspect/plugin-aasink.xml:
-	* docs/plugins/inspect/plugin-alaw.xml:
-	* docs/plugins/inspect/plugin-alpha.xml:
-	* docs/plugins/inspect/plugin-alphacolor.xml:
-	* docs/plugins/inspect/plugin-annodex.xml:
-	* docs/plugins/inspect/plugin-apetag.xml:
-	* docs/plugins/inspect/plugin-audiofx.xml:
-	* docs/plugins/inspect/plugin-audioparsers.xml:
-	* docs/plugins/inspect/plugin-auparse.xml:
-	* docs/plugins/inspect/plugin-autodetect.xml:
-	* docs/plugins/inspect/plugin-avi.xml:
-	* docs/plugins/inspect/plugin-cacasink.xml:
-	* docs/plugins/inspect/plugin-cairo.xml:
-	* docs/plugins/inspect/plugin-cutter.xml:
-	* docs/plugins/inspect/plugin-debug.xml:
-	* docs/plugins/inspect/plugin-deinterlace.xml:
-	* docs/plugins/inspect/plugin-dv.xml:
-	* docs/plugins/inspect/plugin-efence.xml:
-	* docs/plugins/inspect/plugin-effectv.xml:
-	* docs/plugins/inspect/plugin-equalizer.xml:
-	* docs/plugins/inspect/plugin-esdsink.xml:
-	* docs/plugins/inspect/plugin-flac.xml:
-	* docs/plugins/inspect/plugin-flv.xml:
-	* docs/plugins/inspect/plugin-flxdec.xml:
-	* docs/plugins/inspect/plugin-gconfelements.xml:
-	* docs/plugins/inspect/plugin-gdkpixbuf.xml:
-	* docs/plugins/inspect/plugin-goom.xml:
-	* docs/plugins/inspect/plugin-goom2k1.xml:
-	* docs/plugins/inspect/plugin-gstrtpmanager.xml:
-	* docs/plugins/inspect/plugin-halelements.xml:
-	* docs/plugins/inspect/plugin-icydemux.xml:
-	* docs/plugins/inspect/plugin-id3demux.xml:
-	* docs/plugins/inspect/plugin-imagefreeze.xml:
-	* docs/plugins/inspect/plugin-interleave.xml:
-	* docs/plugins/inspect/plugin-isomp4.xml:
-	* docs/plugins/inspect/plugin-jack.xml:
-	* docs/plugins/inspect/plugin-jpeg.xml:
-	* docs/plugins/inspect/plugin-level.xml:
-	* docs/plugins/inspect/plugin-matroska.xml:
-	* docs/plugins/inspect/plugin-mulaw.xml:
-	* docs/plugins/inspect/plugin-multifile.xml:
-	* docs/plugins/inspect/plugin-multipart.xml:
-	* docs/plugins/inspect/plugin-navigationtest.xml:
-	* docs/plugins/inspect/plugin-oss4.xml:
-	* docs/plugins/inspect/plugin-ossaudio.xml:
-	* docs/plugins/inspect/plugin-png.xml:
-	* docs/plugins/inspect/plugin-pulseaudio.xml:
-	* docs/plugins/inspect/plugin-replaygain.xml:
-	* docs/plugins/inspect/plugin-rtp.xml:
-	* docs/plugins/inspect/plugin-rtsp.xml:
-	* docs/plugins/inspect/plugin-shapewipe.xml:
-	* docs/plugins/inspect/plugin-shout2send.xml:
-	* docs/plugins/inspect/plugin-smpte.xml:
-	* docs/plugins/inspect/plugin-soup.xml:
-	* docs/plugins/inspect/plugin-spectrum.xml:
-	* docs/plugins/inspect/plugin-speex.xml:
-	* docs/plugins/inspect/plugin-taglib.xml:
-	* docs/plugins/inspect/plugin-udp.xml:
-	* docs/plugins/inspect/plugin-video4linux2.xml:
-	* docs/plugins/inspect/plugin-videobox.xml:
-	* docs/plugins/inspect/plugin-videocrop.xml:
-	* docs/plugins/inspect/plugin-videofilter.xml:
-	* docs/plugins/inspect/plugin-videomixer.xml:
-	* docs/plugins/inspect/plugin-wavenc.xml:
-	* docs/plugins/inspect/plugin-wavpack.xml:
-	* docs/plugins/inspect/plugin-wavparse.xml:
-	* docs/plugins/inspect/plugin-ximagesrc.xml:
-	* docs/plugins/inspect/plugin-y4menc.xml:
-	* win32/common/config.h:
-	  Back to development
-
 === release 0.10.29 ===
 
 2011-05-10 10:04:28 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
diff --git a/LICENSE_readme b/LICENSE_readme
new file mode 100644
index 0000000..67fd312
--- /dev/null
+++ b/LICENSE_readme
@@ -0,0 +1,137 @@
+
+Disclaimer:  The GStreamer team makes a real effort to make sure that
+the information in this file is as up-to-date and accurate as possible.
+However, this file may contain errors and omissions.  Some dependant
+libraries change their licensing from version-to-version and some of 
+the libraries listed here as LGPL were under the GPL license in
+older releases.  Distributions which include GStreamer are responsible
+for ensuring that plugins are used in accordance with licensing terms
+and other laws.
+
+GStreamer is developed under the terms of the LGPL (see LICENSE file for details).
+Some of our plugins however rely on libraries which are available under other
+licenses. This means that if you are using an application which has a non-GPL
+compatible license, for instance a closed-source application with GStreamer
+you have to make sure not to use GPL linked or derived plugins.  When using
+GPL linked plugins GStreamer is for all practical reasons under the GPL itself. 
+
+The plugins which use a GPL library are as follows:
+
+a52dec           liba52           (http://liba52.sourceforge.net/)
+aasink           aalib            (http://sourceforge.net/projects/aa-project/)
+cdparanoia       libcdparanoia    (http://www.xiph.org/paranoia/)
+dtsdec           libdts           (http://www.videolan.org/dtsdec.html)
+dvdnavsrc        libdvdnav        (http://dvd.sourceforge.net/)
+dxr3                              (http://dxr3.sourceforge.net/)
+icecastsend      libshout         (http://www.icecast.org)
+mad              libmad           (http://www.mars.org/home/rob/proj/mpeg/)
+mpeg2dec         libmpeg2         (http://libmpeg2.sourceforge.net/)
+mpeg2enc         libmpeg2enc      (http://mjpeg.sourceforge.net/)
+mplex            libmplex         (http://mjpeg.sourceforge.net/)
+siddec           libsidplay 1.36  (http://www.geocities.com/SiliconValley/Lakes/5147/sidplay/,
+                                   http://sourceforge.net/projects/sidplay2/)
+trm              libmusicbrainz   (http://www.musicbrainz.org/)
+xine             libxine          (http://xinehq.de/)
+xvid             libxvidcore      (http://www.xvid.org/)
+
+Plugins derived from GPL code are as follows:
+
+dvdreadsrc       libdvdread       (http://www.dtek.chalmers.se/groups/dvd/)
+jack             libjack          (http://jackit.sourceforge.net/)
+                                   Note libjack is LGPL, but plugin is GPL.
+monoscope        None             (Algorithm by Ralph Loader, Joerg Walter,
+                                   Richard Boulton, and Andy Lo A Foe)
+rtjpeg           None             (Erik Walthinsen's algorithm)
+rtp              None             (http://www.linphone.org/ortp/)
+synaesthesia                      (http://www.logarithmic.net/pfh/synaesthesia)
+system_encode    None             (Algorithm by Chrisoph Moar, Wim Tayman's and
+                                   Erik Walthinsen)
+vbidec           None             (Algorithm by Billy Biggs, Doug Bell, 
+                                   Erik Walthinsen and David I. Lehn)
+
+Plugins which use a LGPL library are as follows:
+
+alsa             alsa             (http://alsa-project.org/)
+artsdsink        aRts             (http://arts-project.org/)
+cacasink         libcaca          (http://sam.zoy.org/projects/libcaca/)
+colorspacelcs    libcolorspace    
+dvdec            libdv            (http://libdv.sourceforge.net/)
+esdmon,esdsink   libesd           (ftp.gnome.org/pub/GNOME/stable/sources/esound/)
+faac             libfaac          (http://www.audiocoding.com/modules/mydownloads/)
+fameenc          libfame          (http://fame.sourceforge.net/)
+ffmpeg           ffmpeg           (http://ffmpeg.sourceforge.net/)
+gdkpixbuf        GTK+             (http://www.gtk.org/)
+gnomevfs         gnome-vfs        (ftp.gnome.org//pub/GNOME/stable/sources/gnome-vfs/)
+gst_arts         aRts             (http://arts-project.org/)
+gst1394          libraw1394       (http://www.linux1394.org/)
+gstaf            libaudiofile     (http://www.68k.org/~michael/audiofile/)
+gstsf            libsndfile       (http://www.mega-nerd.com/libsndfile/)
+hermescolorspace Hermes           (http://www.clanlib.org/hermes/)
+kio              KDE              (http://www.kde.org/)
+ladspa                            (http://www.ladspa.org/)
+lame             libmp3lame       (http://lame.sourceforge.net/)
+libvisual        libvisual        (http://libvisual.sourceforge.net/)
+matroska                          (http://www.matroska.org/)
+mikmod           libmikmod        (http://mikmod.raphnet.net/)
+ossaudio                          (http://www.opensound.com/)
+qcamsrc
+rfbenc           librfb
+sdlvideosink     libsdl           (http://www.libsdl.org/)
+shout2send       libshout2        (http://www.icecast.org)
+smoothwave      
+swfdec                            (http://swfdec.sourceforge.net/)
+tarkin                            (http://svn.xiph.org/trunk/tarkin/)
+textoverlay      pango            (http://www.pango.org/)
+dirac                             (http://www.bbc.co.uk/rd/projects/dirac/)
+effectv (Our ports was relicensed)(http://effectv.sourceforge.net/)
+musepack 			  (http://www.musepack.net/)
+
+Plugins which use a BSD covered library are as follows:
+
+ogg              libogg/libvorbis (http://www.xiph.org/ogg/vorbis/)
+vorbis           libogg/libvorbis (http://www.xiph.org/ogg/vorbis/)
+gsttheora        libtheora        (http://www.theora.org/)
+speex                             (http://www.speex.org/)
+flac             libFLAC          (http://flac.sourceforge.net/)
+
+Plugins based on libraries with other free licenses:
+
+ximagesink       libXv
+xvimagesink      libXv            
+ - license:      MIT X11 / X Consortium license
+
+gsm              libgsm           
+ - license       MIT license http://kbs.cs.tu-berlin.de/~jutta/toast.html
+
+festival                          (http://www.cstr.ed.ac.uk/projects/festival/)
+ - license:      http://www.cstr.ed.ac.uk/projects/festival/freecopyright.shtml
+
+jpeg                              (http://www.ijg.org/)
+ - license:      IJG license
+
+nas                               (http://radscan.com/nas.html)
+ - license:      NAS license
+
+snapshot         libpng           (http://www.libpng.org/pub/png/)
+ - license:      PNG license
+
+mngdec/mngenc	libmng	    	(http://gjuyn.xs4all.nl/libmng)
+ - license 	 PNG license
+
+Plugins using non-free libraries:
+divxdec, divxenc                        (http://www.divx.com/)
+osxaudio                                (http://www.apple.com/macosx/)
+sunaudiosink                            (http://www.sun.com/)
+
+Unsure:
+
+faad             libfaad          (http://www.audiocoding.com/)
+faad's license depends on its major version :
+  - for FAAD1 : it is LGPL
+  - for FAAD2 : it is GPL
+look at these pages for more information on licenses :
+http://www.audiocoding.com/modules/wiki/?page=FAAD2
+http://www.audiocoding.com/modules/wiki/?page=FAAC
+
+by default, GStreamer faad plugin would compile against FAAD2 if available.
+it falls back to FAAD1 if not.
diff --git a/MAINTAINERS b/MAINTAINERS
new file mode 100644
index 0000000..2412862
--- /dev/null
+++ b/MAINTAINERS
@@ -0,0 +1,13 @@
+GStreamer is currently maintained by the consensus of a number
+of people, including, but not limited to:
+
+  David Schleef <ds@schleef.org>
+  Jan Schmidt <thaytan@noraisin.net>
+  Wim Taymans <wim.taymans@gmail.com>
+  Tim-Philipp Müller <tim centricular net>
+
+Maintainer-related issues should be addressed to:
+
+  gstreamer-devel@lists.sourceforge.net
+
+
diff --git a/Makefile.in b/Makefile.in
index c878bf4..0e9007d 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -27,6 +26,23 @@
 # set CRUFT_FILES and/or CRUFT_DIRS in your Makefile.am when you include this
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -45,6 +61,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = README $(am__configure_deps) $(noinst_HEADERS) \
 	$(srcdir)/Makefile.am $(srcdir)/Makefile.in \
 	$(srcdir)/config.h.in $(srcdir)/gst-plugins-good.spec.in \
@@ -61,7 +78,6 @@ am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -101,12 +117,18 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = config.h
 CONFIG_CLEAN_FILES = gst-plugins-good.spec
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
 RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
@@ -116,14 +138,20 @@ RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
 	$(RECURSIVE_CLEAN_TARGETS:-recursive=) tags TAGS ctags CTAGS \
-	distdir dist dist-all distcheck
+	cscope distdir dist dist-all distcheck
 ETAGS = etags
 CTAGS = ctags
+CSCOPE = cscope
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 distdir = $(PACKAGE)-$(VERSION)
 top_distdir = $(distdir)
@@ -133,6 +161,7 @@ am__remove_distdir = \
       && rm -rf "$(distdir)" \
       || { sleep 5 && rm -rf "$(distdir)"; }; \
   else :; fi
+am__post_remove_distdir = $(am__remove_distdir)
 am__relativize = \
   dir0=`pwd`; \
   sed_first='s,^\([^/]*\)/.*$$,\1,'; \
@@ -160,6 +189,7 @@ am__relativize = \
   reldir="$$dir2"
 DIST_ARCHIVES = $(distdir).tar.gz $(distdir).tar.bz2
 GZIP_ENV = --best
+DIST_TARGETS = dist-bzip2 dist-gzip
 distuninstallcheck_listfiles = find . -type f -print
 am__distuninstallcheck_listfiles = $(distuninstallcheck_listfiles) \
   | sed 's|^\./|$(prefix)/|' | grep -v '$(infodir)/dir$$'
@@ -219,6 +249,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -267,8 +298,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -349,7 +382,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -409,6 +442,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -482,7 +516,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -616,12 +654,12 @@ distclean-libtool:
 	-rm -f libtool config.lt
 
 # This directory's subdirectories are mostly independent; you can cd
-# into them and run `make' without going through this Makefile.
-# To change the values of `make' variables: instead of editing Makefiles,
-# (1) if the variable is set in `config.status', edit `config.status'
-#     (which will cause the Makefiles to be regenerated when you run `make');
-# (2) otherwise, pass the desired values on the `make' command line.
-$(RECURSIVE_TARGETS):
+# into them and run 'make' without going through this Makefile.
+# To change the values of 'make' variables: instead of editing Makefiles,
+# (1) if the variable is set in 'config.status', edit 'config.status'
+#     (which will cause the Makefiles to be regenerated when you run 'make');
+# (2) otherwise, pass the desired values on the 'make' command line.
+$(RECURSIVE_TARGETS) $(RECURSIVE_CLEAN_TARGETS):
 	@fail= failcom='exit 1'; \
 	for f in x $$MAKEFLAGS; do \
 	  case $$f in \
@@ -631,7 +669,11 @@ $(RECURSIVE_TARGETS):
 	done; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
-	list='$(SUBDIRS)'; for subdir in $$list; do \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	for subdir in $$list; do \
 	  echo "Making $$target in $$subdir"; \
 	  if test "$$subdir" = "."; then \
 	    dot_seen=yes; \
@@ -645,37 +687,6 @@ $(RECURSIVE_TARGETS):
 	if test "$$dot_seen" = "no"; then \
 	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
 	fi; test -z "$$fail"
-
-$(RECURSIVE_CLEAN_TARGETS):
-	@fail= failcom='exit 1'; \
-	for f in x $$MAKEFLAGS; do \
-	  case $$f in \
-	    *=* | --[!k]*);; \
-	    *k*) failcom='fail=yes';; \
-	  esac; \
-	done; \
-	dot_seen=no; \
-	case "$@" in \
-	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
-	  *) list='$(SUBDIRS)' ;; \
-	esac; \
-	rev=''; for subdir in $$list; do \
-	  if test "$$subdir" = "."; then :; else \
-	    rev="$$subdir $$rev"; \
-	  fi; \
-	done; \
-	rev="$$rev ."; \
-	target=`echo $@ | sed s/-recursive//`; \
-	for subdir in $$rev; do \
-	  echo "Making $$target in $$subdir"; \
-	  if test "$$subdir" = "."; then \
-	    local_target="$$target-am"; \
-	  else \
-	    local_target="$$target"; \
-	  fi; \
-	  ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
-	  || eval $$failcom; \
-	done && test -z "$$fail"
 tags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
@@ -684,6 +695,10 @@ ctags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
 	done
+cscopelist-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) cscopelist); \
+	done
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -747,8 +762,32 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscope: cscope.files
+	test ! -s cscope.files \
+	  || $(CSCOPE) -b -q $(AM_CSCOPEFLAGS) $(CSCOPEFLAGS) -i cscope.files $(CSCOPE_ARGS)
+
+clean-cscope:
+	-rm -f cscope.files
+
+cscope.files: clean-cscope cscopelist-recursive cscopelist
+
+cscopelist: cscopelist-recursive $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
+	-rm -f cscope.out cscope.in.out cscope.po.out cscope.files
 
 distdir: $(DISTFILES)
 	$(am__remove_distdir)
@@ -784,13 +823,10 @@ distdir: $(DISTFILES)
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -822,40 +858,35 @@ distdir: $(DISTFILES)
 	|| chmod -R a+r "$(distdir)"
 dist-gzip: distdir
 	tardir=$(distdir) && $(am__tar) | GZIP=$(GZIP_ENV) gzip -c >$(distdir).tar.gz
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 dist-bzip2: distdir
 	tardir=$(distdir) && $(am__tar) | BZIP2=$${BZIP2--9} bzip2 -c >$(distdir).tar.bz2
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 
 dist-lzip: distdir
 	tardir=$(distdir) && $(am__tar) | lzip -c $${LZIP_OPT--9} >$(distdir).tar.lz
-	$(am__remove_distdir)
-
-dist-lzma: distdir
-	tardir=$(distdir) && $(am__tar) | lzma -9 -c >$(distdir).tar.lzma
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 
 dist-xz: distdir
 	tardir=$(distdir) && $(am__tar) | XZ_OPT=$${XZ_OPT--e} xz -c >$(distdir).tar.xz
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 
 dist-tarZ: distdir
 	tardir=$(distdir) && $(am__tar) | compress -c >$(distdir).tar.Z
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 
 dist-shar: distdir
 	shar $(distdir) | GZIP=$(GZIP_ENV) gzip -c >$(distdir).shar.gz
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 
 dist-zip: distdir
 	-rm -f $(distdir).zip
 	zip -rq $(distdir).zip $(distdir)
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 
-dist dist-all: distdir
-	tardir=$(distdir) && $(am__tar) | GZIP=$(GZIP_ENV) gzip -c >$(distdir).tar.gz
-	tardir=$(distdir) && $(am__tar) | BZIP2=$${BZIP2--9} bzip2 -c >$(distdir).tar.bz2
-	$(am__remove_distdir)
+dist dist-all:
+	$(MAKE) $(AM_MAKEFLAGS) $(DIST_TARGETS) am__post_remove_distdir='@:'
+	$(am__post_remove_distdir)
 
 # This target untars the dist file and tries a VPATH configuration.  Then
 # it guarantees that the distribution is self-contained by making another
@@ -866,8 +897,6 @@ distcheck: dist
 	  GZIP=$(GZIP_ENV) gzip -dc $(distdir).tar.gz | $(am__untar) ;;\
 	*.tar.bz2*) \
 	  bzip2 -dc $(distdir).tar.bz2 | $(am__untar) ;;\
-	*.tar.lzma*) \
-	  lzma -dc $(distdir).tar.lzma | $(am__untar) ;;\
 	*.tar.lz*) \
 	  lzip -dc $(distdir).tar.lz | $(am__untar) ;;\
 	*.tar.xz*) \
@@ -879,9 +908,9 @@ distcheck: dist
 	*.zip*) \
 	  unzip $(distdir).zip ;;\
 	esac
-	chmod -R a-w $(distdir); chmod a+w $(distdir)
-	mkdir $(distdir)/_build
-	mkdir $(distdir)/_inst
+	chmod -R a-w $(distdir)
+	chmod u+w $(distdir)
+	mkdir $(distdir)/_build $(distdir)/_inst
 	chmod a-w $(distdir)
 	test -d $(distdir)/_build || exit 0; \
 	dc_install_base=`$(am__cd) $(distdir)/_inst && pwd | sed -e 's,^[^:\\/]:[\\/],/,'` \
@@ -914,7 +943,7 @@ distcheck: dist
 	  && $(MAKE) $(AM_MAKEFLAGS) distcleancheck \
 	  && cd "$$am__cwd" \
 	  || exit 1
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 	@(echo "$(distdir) archives ready for distribution: "; \
 	  list='$(DIST_ARCHIVES)'; for i in $$list; do echo $$i; done) | \
 	  sed -e 1h -e 1s/./=/g -e 1p -e 1x -e '$$p' -e '$$x'
@@ -1051,24 +1080,26 @@ ps-am:
 uninstall-am:
 
 .MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) all \
-	ctags-recursive install-am install-strip tags-recursive
+	cscopelist-recursive ctags-recursive install-am install-strip \
+	tags-recursive
 
 .PHONY: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) CTAGS GTAGS \
 	all all-am all-local am--refresh check check-am clean \
-	clean-generic clean-libtool ctags ctags-recursive dist \
-	dist-all dist-bzip2 dist-gzip dist-hook dist-lzip dist-lzma \
-	dist-shar dist-tarZ dist-xz dist-zip distcheck distclean \
-	distclean-generic distclean-hdr distclean-libtool \
-	distclean-tags distcleancheck distdir distuninstallcheck dvi \
-	dvi-am html html-am info info-am install install-am \
-	install-data install-data-am install-dvi install-dvi-am \
-	install-exec install-exec-am install-html install-html-am \
-	install-info install-info-am install-man install-pdf \
-	install-pdf-am install-ps install-ps-am install-strip \
-	installcheck installcheck-am installdirs installdirs-am \
-	maintainer-clean maintainer-clean-generic mostlyclean \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags tags-recursive uninstall uninstall-am
+	clean-cscope clean-generic clean-libtool cscope cscopelist \
+	cscopelist-recursive ctags ctags-recursive dist dist-all \
+	dist-bzip2 dist-gzip dist-hook dist-lzip dist-shar dist-tarZ \
+	dist-xz dist-zip distcheck distclean distclean-generic \
+	distclean-hdr distclean-libtool distclean-tags distcleancheck \
+	distdir distuninstallcheck dvi dvi-am html html-am info \
+	info-am install install-am install-data install-data-am \
+	install-dvi install-dvi-am install-exec install-exec-am \
+	install-html install-html-am install-info install-info-am \
+	install-man install-pdf install-pdf-am install-ps \
+	install-ps-am install-strip installcheck installcheck-am \
+	installdirs installdirs-am maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-generic \
+	mostlyclean-libtool pdf pdf-am ps ps-am tags tags-recursive \
+	uninstall uninstall-am
 
 
 win32-debug:
diff --git a/aclocal.m4 b/aclocal.m4
index e8cf18e..1d4a59b 100644
--- a/aclocal.m4
+++ b/aclocal.m4
@@ -1,8 +1,7 @@
-# generated automatically by aclocal 1.11.3 -*- Autoconf -*-
+# generated automatically by aclocal 1.12.6 -*- Autoconf -*-
+
+# Copyright (C) 1996-2012 Free Software Foundation, Inc.
 
-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
-# 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software Foundation,
-# Inc.
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -14,31 +13,28 @@
 
 m4_ifndef([AC_AUTOCONF_VERSION],
   [m4_copy([m4_PACKAGE_VERSION], [AC_AUTOCONF_VERSION])])dnl
-m4_if(m4_defn([AC_AUTOCONF_VERSION]), [2.68],,
-[m4_warning([this file was generated for autoconf 2.68.
+m4_if(m4_defn([AC_AUTOCONF_VERSION]), [2.69],,
+[m4_warning([this file was generated for autoconf 2.69.
 You have another version of autoconf.  It may work, but is not guaranteed to.
 If you have problems, you may need to regenerate the build system entirely.
-To do so, use the procedure documented by the package, typically `autoreconf'.])])
+To do so, use the procedure documented by the package, typically 'autoreconf'.])])
 
-# Copyright (C) 2002, 2003, 2005, 2006, 2007, 2008, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 2002-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 1
-
 # AM_AUTOMAKE_VERSION(VERSION)
 # ----------------------------
 # Automake X.Y traces this macro to ensure aclocal.m4 has been
 # generated from the m4 files accompanying Automake X.Y.
 # (This private macro should not be called outside this file.)
 AC_DEFUN([AM_AUTOMAKE_VERSION],
-[am__api_version='1.11'
+[am__api_version='1.12'
 dnl Some users find AM_AUTOMAKE_VERSION and mistake it for a way to
 dnl require some minimum version.  Point them to the right macro.
-m4_if([$1], [1.11.3], [],
+m4_if([$1], [1.12.6], [],
       [AC_FATAL([Do not call $0, use AM_INIT_AUTOMAKE([$1]).])])dnl
 ])
 
@@ -54,21 +50,19 @@ m4_define([_AM_AUTOCONF_VERSION], [])
 # Call AM_AUTOMAKE_VERSION and AM_AUTOMAKE_VERSION so they can be traced.
 # This function is AC_REQUIREd by AM_INIT_AUTOMAKE.
 AC_DEFUN([AM_SET_CURRENT_AUTOMAKE_VERSION],
-[AM_AUTOMAKE_VERSION([1.11.3])dnl
+[AM_AUTOMAKE_VERSION([1.12.6])dnl
 m4_ifndef([AC_AUTOCONF_VERSION],
   [m4_copy([m4_PACKAGE_VERSION], [AC_AUTOCONF_VERSION])])dnl
 _AM_AUTOCONF_VERSION(m4_defn([AC_AUTOCONF_VERSION]))])
 
 # Figure out how to run the assembler.                      -*- Autoconf -*-
 
-# Copyright (C) 2001, 2003, 2004, 2005, 2006  Free Software Foundation, Inc.
+# Copyright (C) 2001-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 5
-
 # AM_PROG_AS
 # ----------
 AC_DEFUN([AM_PROG_AS],
@@ -83,17 +77,15 @@ _AM_IF_OPTION([no-dependencies],, [_AM_DEPENDENCIES([CCAS])])dnl
 
 # AM_AUX_DIR_EXPAND                                         -*- Autoconf -*-
 
-# Copyright (C) 2001, 2003, 2005, 2011 Free Software Foundation, Inc.
+# Copyright (C) 2001-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 1
-
 # For projects using AC_CONFIG_AUX_DIR([foo]), Autoconf sets
-# $ac_aux_dir to `$srcdir/foo'.  In other projects, it is set to
-# `$srcdir', `$srcdir/..', or `$srcdir/../..'.
+# $ac_aux_dir to '$srcdir/foo'.  In other projects, it is set to
+# '$srcdir', '$srcdir/..', or '$srcdir/../..'.
 #
 # Of course, Automake must honor this variable whenever it calls a
 # tool from the auxiliary directory.  The problem is that $srcdir (and
@@ -112,7 +104,7 @@ _AM_IF_OPTION([no-dependencies],, [_AM_DEPENDENCIES([CCAS])])dnl
 #
 # The reason of the latter failure is that $top_srcdir and $ac_aux_dir
 # are both prefixed by $srcdir.  In an in-source build this is usually
-# harmless because $srcdir is `.', but things will broke when you
+# harmless because $srcdir is '.', but things will broke when you
 # start a VPATH build or use an absolute $srcdir.
 #
 # So we could use something similar to $top_srcdir/$ac_aux_dir/missing,
@@ -138,22 +130,19 @@ am_aux_dir=`cd $ac_aux_dir && pwd`
 
 # AM_CONDITIONAL                                            -*- Autoconf -*-
 
-# Copyright (C) 1997, 2000, 2001, 2003, 2004, 2005, 2006, 2008
-# Free Software Foundation, Inc.
+# Copyright (C) 1997-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 9
-
 # AM_CONDITIONAL(NAME, SHELL-CONDITION)
 # -------------------------------------
 # Define a conditional.
 AC_DEFUN([AM_CONDITIONAL],
-[AC_PREREQ(2.52)dnl
- ifelse([$1], [TRUE],  [AC_FATAL([$0: invalid condition: $1])],
-	[$1], [FALSE], [AC_FATAL([$0: invalid condition: $1])])dnl
+[AC_PREREQ([2.52])dnl
+ m4_if([$1], [TRUE],  [AC_FATAL([$0: invalid condition: $1])],
+       [$1], [FALSE], [AC_FATAL([$0: invalid condition: $1])])dnl
 AC_SUBST([$1_TRUE])dnl
 AC_SUBST([$1_FALSE])dnl
 _AM_SUBST_NOTMAKE([$1_TRUE])dnl
@@ -172,16 +161,14 @@ AC_CONFIG_COMMANDS_PRE(
 Usually this means the macro was only invoked conditionally.]])
 fi])])
 
-# Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2009,
-# 2010, 2011 Free Software Foundation, Inc.
+# Copyright (C) 1999-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 12
 
-# There are a few dirty hacks below to avoid letting `AC_PROG_CC' be
+# There are a few dirty hacks below to avoid letting 'AC_PROG_CC' be
 # written in clear, in which case automake, when reading aclocal.m4,
 # will think it sees a *use*, and therefore will trigger all it's
 # C support machinery.  Also note that it means that autoscan, seeing
@@ -191,7 +178,7 @@ fi])])
 # _AM_DEPENDENCIES(NAME)
 # ----------------------
 # See how the compiler implements dependency checking.
-# NAME is "CC", "CXX", "GCJ", or "OBJC".
+# NAME is "CC", "CXX", "OBJC", "OBJCXX", "UPC", or "GJC".
 # We try a few techniques and use that to set a single cache variable.
 #
 # We don't AC_REQUIRE the corresponding AC_PROG_CC since the latter was
@@ -204,12 +191,13 @@ AC_REQUIRE([AM_OUTPUT_DEPENDENCY_COMMANDS])dnl
 AC_REQUIRE([AM_MAKE_INCLUDE])dnl
 AC_REQUIRE([AM_DEP_TRACK])dnl
 
-ifelse([$1], CC,   [depcc="$CC"   am_compiler_list=],
-       [$1], CXX,  [depcc="$CXX"  am_compiler_list=],
-       [$1], OBJC, [depcc="$OBJC" am_compiler_list='gcc3 gcc'],
-       [$1], UPC,  [depcc="$UPC"  am_compiler_list=],
-       [$1], GCJ,  [depcc="$GCJ"  am_compiler_list='gcc3 gcc'],
-                   [depcc="$$1"   am_compiler_list=])
+m4_if([$1], [CC],   [depcc="$CC"   am_compiler_list=],
+      [$1], [CXX],  [depcc="$CXX"  am_compiler_list=],
+      [$1], [OBJC], [depcc="$OBJC" am_compiler_list='gcc3 gcc'],
+      [$1], [OBJCXX], [depcc="$OBJCXX" am_compiler_list='gcc3 gcc'],
+      [$1], [UPC],  [depcc="$UPC"  am_compiler_list=],
+      [$1], [GCJ],  [depcc="$GCJ"  am_compiler_list='gcc3 gcc'],
+                    [depcc="$$1"   am_compiler_list=])
 
 AC_CACHE_CHECK([dependency style of $depcc],
                [am_cv_$1_dependencies_compiler_type],
@@ -217,8 +205,8 @@ AC_CACHE_CHECK([dependency style of $depcc],
   # We make a subdir and do the tests there.  Otherwise we can end up
   # making bogus files that we don't know about and never remove.  For
   # instance it was reported that on HP-UX the gcc test will end up
-  # making a dummy file named `D' -- because `-MD' means `put the output
-  # in D'.
+  # making a dummy file named 'D' -- because '-MD' means "put the output
+  # in D".
   rm -rf conftest.dir
   mkdir conftest.dir
   # Copy depcomp to subdir because otherwise we won't find it if we're
@@ -258,16 +246,16 @@ AC_CACHE_CHECK([dependency style of $depcc],
     : > sub/conftest.c
     for i in 1 2 3 4 5 6; do
       echo '#include "conftst'$i'.h"' >> sub/conftest.c
-      # Using `: > sub/conftst$i.h' creates only sub/conftst1.h with
-      # Solaris 8's {/usr,}/bin/sh.
-      touch sub/conftst$i.h
+      # Using ": > sub/conftst$i.h" creates only sub/conftst1.h with
+      # Solaris 10 /bin/sh.
+      echo '/* dummy */' > sub/conftst$i.h
     done
     echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
 
-    # We check with `-c' and `-o' for the sake of the "dashmstdout"
+    # We check with '-c' and '-o' for the sake of the "dashmstdout"
     # mode.  It turns out that the SunPro C++ compiler does not properly
-    # handle `-M -o', and we need to detect this.  Also, some Intel
-    # versions had trouble with output in subdirs
+    # handle '-M -o', and we need to detect this.  Also, some Intel
+    # versions had trouble with output in subdirs.
     am__obj=sub/conftest.${OBJEXT-o}
     am__minus_obj="-o $am__obj"
     case $depmode in
@@ -276,8 +264,8 @@ AC_CACHE_CHECK([dependency style of $depcc],
       test "$am__universal" = false || continue
       ;;
     nosideeffect)
-      # after this tag, mechanisms are not by side-effect, so they'll
-      # only be used when explicitly requested
+      # After this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested.
       if test "x$enable_dependency_tracking" = xyes; then
 	continue
       else
@@ -285,7 +273,7 @@ AC_CACHE_CHECK([dependency style of $depcc],
       fi
       ;;
     msvc7 | msvc7msys | msvisualcpp | msvcmsys)
-      # This compiler won't grok `-c -o', but also, the minuso test has
+      # This compiler won't grok '-c -o', but also, the minuso test has
       # not run yet.  These depmodes are late enough in the game, and
       # so weak that their functioning should not be impacted.
       am__obj=conftest.${OBJEXT-o}
@@ -333,7 +321,7 @@ AM_CONDITIONAL([am__fastdep$1], [
 # AM_SET_DEPDIR
 # -------------
 # Choose a directory name for dependency files.
-# This macro is AC_REQUIREd in _AM_DEPENDENCIES
+# This macro is AC_REQUIREd in _AM_DEPENDENCIES.
 AC_DEFUN([AM_SET_DEPDIR],
 [AC_REQUIRE([AM_SET_LEADING_DOT])dnl
 AC_SUBST([DEPDIR], ["${am__leading_dot}deps"])dnl
@@ -343,9 +331,13 @@ AC_SUBST([DEPDIR], ["${am__leading_dot}deps"])dnl
 # AM_DEP_TRACK
 # ------------
 AC_DEFUN([AM_DEP_TRACK],
-[AC_ARG_ENABLE(dependency-tracking,
-[  --disable-dependency-tracking  speeds up one-time build
-  --enable-dependency-tracking   do not reject slow dependency extractors])
+[AC_ARG_ENABLE([dependency-tracking], [dnl
+AS_HELP_STRING(
+  [--enable-dependency-tracking],
+  [do not reject slow dependency extractors])
+AS_HELP_STRING(
+  [--disable-dependency-tracking],
+  [speeds up one-time build])])
 if test "x$enable_dependency_tracking" != xno; then
   am_depcomp="$ac_aux_dir/depcomp"
   AMDEPBACKSLASH='\'
@@ -360,14 +352,12 @@ _AM_SUBST_NOTMAKE([am__nodep])dnl
 
 # Generate code to set up dependency tracking.              -*- Autoconf -*-
 
-# Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2008
-# Free Software Foundation, Inc.
+# Copyright (C) 1999-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-#serial 5
 
 # _AM_OUTPUT_DEPENDENCY_COMMANDS
 # ------------------------------
@@ -386,7 +376,7 @@ AC_DEFUN([_AM_OUTPUT_DEPENDENCY_COMMANDS],
     # Strip MF so we end up with the name of the file.
     mf=`echo "$mf" | sed -e 's/:.*$//'`
     # Check whether this is an Automake generated Makefile or not.
-    # We used to match only the files named `Makefile.in', but
+    # We used to match only the files named 'Makefile.in', but
     # some people rename them; so instead we look at the file content.
     # Grep'ing the first line is not enough: some people post-process
     # each Makefile.in and add a new line on top of each file to say so.
@@ -398,21 +388,19 @@ AC_DEFUN([_AM_OUTPUT_DEPENDENCY_COMMANDS],
       continue
     fi
     # Extract the definition of DEPDIR, am__include, and am__quote
-    # from the Makefile without running `make'.
+    # from the Makefile without running 'make'.
     DEPDIR=`sed -n 's/^DEPDIR = //p' < "$mf"`
     test -z "$DEPDIR" && continue
     am__include=`sed -n 's/^am__include = //p' < "$mf"`
     test -z "am__include" && continue
     am__quote=`sed -n 's/^am__quote = //p' < "$mf"`
-    # When using ansi2knr, U may be empty or an underscore; expand it
-    U=`sed -n 's/^U = //p' < "$mf"`
     # Find all dependency output files, they are included files with
     # $(DEPDIR) in their names.  We invoke sed twice because it is the
     # simplest approach to changing $(DEPDIR) to its actual value in the
     # expansion.
     for file in `sed -n "
       s/^$am__include $am__quote\(.*(DEPDIR).*\)$am__quote"'$/\1/p' <"$mf" | \
-	 sed -e 's/\$(DEPDIR)/'"$DEPDIR"'/g' -e 's/\$U/'"$U"'/g'`; do
+	 sed -e 's/\$(DEPDIR)/'"$DEPDIR"'/g'`; do
       # Make sure the directory exists.
       test -f "$dirpart/$file" && continue
       fdir=`AS_DIRNAME(["$file"])`
@@ -430,7 +418,7 @@ AC_DEFUN([_AM_OUTPUT_DEPENDENCY_COMMANDS],
 # This macro should only be invoked once -- use via AC_REQUIRE.
 #
 # This code is only required when automatic dependency tracking
-# is enabled.  FIXME.  This creates each `.P' file that we will
+# is enabled.  FIXME.  This creates each '.P' file that we will
 # need in order to bootstrap the dependency handling code.
 AC_DEFUN([AM_OUTPUT_DEPENDENCY_COMMANDS],
 [AC_CONFIG_COMMANDS([depfiles],
@@ -438,29 +426,14 @@ AC_DEFUN([AM_OUTPUT_DEPENDENCY_COMMANDS],
      [AMDEP_TRUE="$AMDEP_TRUE" ac_aux_dir="$ac_aux_dir"])
 ])
 
-# Copyright (C) 1996, 1997, 2000, 2001, 2003, 2005
-# Free Software Foundation, Inc.
-#
-# This file is free software; the Free Software Foundation
-# gives unlimited permission to copy and/or distribute it,
-# with or without modifications, as long as this notice is preserved.
-
-# serial 8
-
-# AM_CONFIG_HEADER is obsolete.  It has been replaced by AC_CONFIG_HEADERS.
-AU_DEFUN([AM_CONFIG_HEADER], [AC_CONFIG_HEADERS($@)])
-
 # Do all the work for Automake.                             -*- Autoconf -*-
 
-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
-# 2005, 2006, 2008, 2009 Free Software Foundation, Inc.
+# Copyright (C) 1996-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 16
-
 # This macro actually does too much.  Some checks are only needed if
 # your package does certain things.  But this isn't really a big deal.
 
@@ -505,31 +478,41 @@ AC_SUBST([CYGPATH_W])
 # Define the identity of the package.
 dnl Distinguish between old-style and new-style calls.
 m4_ifval([$2],
-[m4_ifval([$3], [_AM_SET_OPTION([no-define])])dnl
+[AC_DIAGNOSE([obsolete],
+[$0: two- and three-arguments forms are deprecated.  For more info, see:
+http://www.gnu.org/software/automake/manual/automake.html#Modernize-AM_INIT_AUTOMAKE-invocation])
+m4_ifval([$3], [_AM_SET_OPTION([no-define])])dnl
  AC_SUBST([PACKAGE], [$1])dnl
  AC_SUBST([VERSION], [$2])],
 [_AM_SET_OPTIONS([$1])dnl
 dnl Diagnose old-style AC_INIT with new-style AM_AUTOMAKE_INIT.
-m4_if(m4_ifdef([AC_PACKAGE_NAME], 1)m4_ifdef([AC_PACKAGE_VERSION], 1), 11,,
+m4_if(
+  m4_ifdef([AC_PACKAGE_NAME], [ok]):m4_ifdef([AC_PACKAGE_VERSION], [ok]),
+  [ok:ok],,
   [m4_fatal([AC_INIT should be called with package and version arguments])])dnl
  AC_SUBST([PACKAGE], ['AC_PACKAGE_TARNAME'])dnl
  AC_SUBST([VERSION], ['AC_PACKAGE_VERSION'])])dnl
 
 _AM_IF_OPTION([no-define],,
-[AC_DEFINE_UNQUOTED(PACKAGE, "$PACKAGE", [Name of package])
- AC_DEFINE_UNQUOTED(VERSION, "$VERSION", [Version number of package])])dnl
+[AC_DEFINE_UNQUOTED([PACKAGE], ["$PACKAGE"], [Name of package])
+ AC_DEFINE_UNQUOTED([VERSION], ["$VERSION"], [Version number of package])])dnl
 
 # Some tools Automake needs.
 AC_REQUIRE([AM_SANITY_CHECK])dnl
 AC_REQUIRE([AC_ARG_PROGRAM])dnl
-AM_MISSING_PROG(ACLOCAL, aclocal-${am__api_version})
-AM_MISSING_PROG(AUTOCONF, autoconf)
-AM_MISSING_PROG(AUTOMAKE, automake-${am__api_version})
-AM_MISSING_PROG(AUTOHEADER, autoheader)
-AM_MISSING_PROG(MAKEINFO, makeinfo)
+AM_MISSING_PROG([ACLOCAL], [aclocal-${am__api_version}])
+AM_MISSING_PROG([AUTOCONF], [autoconf])
+AM_MISSING_PROG([AUTOMAKE], [automake-${am__api_version}])
+AM_MISSING_PROG([AUTOHEADER], [autoheader])
+AM_MISSING_PROG([MAKEINFO], [makeinfo])
 AC_REQUIRE([AM_PROG_INSTALL_SH])dnl
 AC_REQUIRE([AM_PROG_INSTALL_STRIP])dnl
-AC_REQUIRE([AM_PROG_MKDIR_P])dnl
+AC_REQUIRE([AC_PROG_MKDIR_P])dnl
+# For better backward compatibility.  To be removed once Automake 1.9.x
+# dies out for good.  For more background, see:
+# <http://lists.gnu.org/archive/html/automake/2012-07/msg00001.html>
+# <http://lists.gnu.org/archive/html/automake/2012-07/msg00014.html>
+AC_SUBST([mkdir_p], ['$(MKDIR_P)'])
 # We need awk for the "check" target.  The system "awk" is bad on
 # some platforms.
 AC_REQUIRE([AC_PROG_AWK])dnl
@@ -540,28 +523,35 @@ _AM_IF_OPTION([tar-ustar], [_AM_PROG_TAR([ustar])],
 			     [_AM_PROG_TAR([v7])])])
 _AM_IF_OPTION([no-dependencies],,
 [AC_PROVIDE_IFELSE([AC_PROG_CC],
-		  [_AM_DEPENDENCIES(CC)],
-		  [define([AC_PROG_CC],
-			  defn([AC_PROG_CC])[_AM_DEPENDENCIES(CC)])])dnl
+		  [_AM_DEPENDENCIES([CC])],
+		  [m4_define([AC_PROG_CC],
+			     m4_defn([AC_PROG_CC])[_AM_DEPENDENCIES([CC])])])dnl
 AC_PROVIDE_IFELSE([AC_PROG_CXX],
-		  [_AM_DEPENDENCIES(CXX)],
-		  [define([AC_PROG_CXX],
-			  defn([AC_PROG_CXX])[_AM_DEPENDENCIES(CXX)])])dnl
+		  [_AM_DEPENDENCIES([CXX])],
+		  [m4_define([AC_PROG_CXX],
+			     m4_defn([AC_PROG_CXX])[_AM_DEPENDENCIES([CXX])])])dnl
 AC_PROVIDE_IFELSE([AC_PROG_OBJC],
-		  [_AM_DEPENDENCIES(OBJC)],
-		  [define([AC_PROG_OBJC],
-			  defn([AC_PROG_OBJC])[_AM_DEPENDENCIES(OBJC)])])dnl
+		  [_AM_DEPENDENCIES([OBJC])],
+		  [m4_define([AC_PROG_OBJC],
+			     m4_defn([AC_PROG_OBJC])[_AM_DEPENDENCIES([OBJC])])])dnl
+dnl Support for Objective C++ was only introduced in Autoconf 2.65,
+dnl but we still cater to Autoconf 2.62.
+m4_ifdef([AC_PROG_OBJCXX],
+[AC_PROVIDE_IFELSE([AC_PROG_OBJCXX],
+		  [_AM_DEPENDENCIES([OBJCXX])],
+		  [m4_define([AC_PROG_OBJCXX],
+			     m4_defn([AC_PROG_OBJCXX])[_AM_DEPENDENCIES([OBJCXX])])])])dnl
 ])
 _AM_IF_OPTION([silent-rules], [AC_REQUIRE([AM_SILENT_RULES])])dnl
-dnl The `parallel-tests' driver may need to know about EXEEXT, so add the
-dnl `am__EXEEXT' conditional if _AM_COMPILER_EXEEXT was seen.  This macro
+dnl The 'parallel-tests' driver may need to know about EXEEXT, so add the
+dnl 'am__EXEEXT' conditional if _AM_COMPILER_EXEEXT was seen.  This macro
 dnl is hooked onto _AC_COMPILER_EXEEXT early, see below.
 AC_CONFIG_COMMANDS_PRE(dnl
 [m4_provide_if([_AM_COMPILER_EXEEXT],
   [AM_CONDITIONAL([am__EXEEXT], [test -n "$EXEEXT"])])])dnl
 ])
 
-dnl Hook into `_AC_COMPILER_EXEEXT' early to learn its expansion.  Do not
+dnl Hook into '_AC_COMPILER_EXEEXT' early to learn its expansion.  Do not
 dnl add the conditional right here, as _AC_COMPILER_EXEEXT may be further
 dnl mangled by Autoconf and run in a shell conditional statement.
 m4_define([_AC_COMPILER_EXEEXT],
@@ -589,15 +579,12 @@ for _am_header in $config_headers :; do
 done
 echo "timestamp for $_am_arg" >`AS_DIRNAME(["$_am_arg"])`/stamp-h[]$_am_stamp_count])
 
-# Copyright (C) 2001, 2003, 2005, 2008, 2011 Free Software Foundation,
-# Inc.
+# Copyright (C) 2001-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 1
-
 # AM_PROG_INSTALL_SH
 # ------------------
 # Define $install_sh.
@@ -611,16 +598,14 @@ if test x"${install_sh}" != xset; then
     install_sh="\${SHELL} $am_aux_dir/install-sh"
   esac
 fi
-AC_SUBST(install_sh)])
+AC_SUBST([install_sh])])
 
-# Copyright (C) 2003, 2005  Free Software Foundation, Inc.
+# Copyright (C) 2003-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 2
-
 # Check whether the underlying file-system supports filenames
 # with a leading dot.  For instance MS-DOS doesn't.
 AC_DEFUN([AM_SET_LEADING_DOT],
@@ -637,20 +622,17 @@ AC_SUBST([am__leading_dot])])
 # Add --enable-maintainer-mode option to configure.         -*- Autoconf -*-
 # From Jim Meyering
 
-# Copyright (C) 1996, 1998, 2000, 2001, 2002, 2003, 2004, 2005, 2008,
-# 2011 Free Software Foundation, Inc.
+# Copyright (C) 1996-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 5
-
 # AM_MAINTAINER_MODE([DEFAULT-MODE])
 # ----------------------------------
 # Control maintainer-specific portions of Makefiles.
-# Default is to disable them, unless `enable' is passed literally.
-# For symmetry, `disable' may be passed as well.  Anyway, the user
+# Default is to disable them, unless 'enable' is passed literally.
+# For symmetry, 'disable' may be passed as well.  Anyway, the user
 # can override the default with the --enable/--disable switch.
 AC_DEFUN([AM_MAINTAINER_MODE],
 [m4_case(m4_default([$1], [disable]),
@@ -661,10 +643,11 @@ AC_DEFUN([AM_MAINTAINER_MODE],
 AC_MSG_CHECKING([whether to enable maintainer-specific portions of Makefiles])
   dnl maintainer-mode's default is 'disable' unless 'enable' is passed
   AC_ARG_ENABLE([maintainer-mode],
-[  --][am_maintainer_other][-maintainer-mode  am_maintainer_other make rules and dependencies not useful
-			  (and sometimes confusing) to the casual installer],
-      [USE_MAINTAINER_MODE=$enableval],
-      [USE_MAINTAINER_MODE=]m4_if(am_maintainer_other, [enable], [no], [yes]))
+    [AS_HELP_STRING([--]am_maintainer_other[-maintainer-mode],
+      am_maintainer_other[ make rules and dependencies not useful
+      (and sometimes confusing) to the casual installer])],
+    [USE_MAINTAINER_MODE=$enableval],
+    [USE_MAINTAINER_MODE=]m4_if(am_maintainer_other, [enable], [no], [yes]))
   AC_MSG_RESULT([$USE_MAINTAINER_MODE])
   AM_CONDITIONAL([MAINTAINER_MODE], [test $USE_MAINTAINER_MODE = yes])
   MAINT=$MAINTAINER_MODE_TRUE
@@ -676,14 +659,12 @@ AU_DEFUN([jm_MAINTAINER_MODE], [AM_MAINTAINER_MODE])
 
 # Check to see how 'make' treats includes.	            -*- Autoconf -*-
 
-# Copyright (C) 2001, 2002, 2003, 2005, 2009  Free Software Foundation, Inc.
+# Copyright (C) 2001-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 4
-
 # AM_MAKE_INCLUDE()
 # -----------------
 # Check to see how make treats includes.
@@ -701,7 +682,7 @@ am__quote=
 _am_result=none
 # First try GNU make style include.
 echo "include confinc" > confmf
-# Ignore all kinds of additional output from `make'.
+# Ignore all kinds of additional output from 'make'.
 case `$am_make -s -f confmf 2> /dev/null` in #(
 *the\ am__doit\ target*)
   am__include=include
@@ -726,15 +707,12 @@ AC_MSG_RESULT([$_am_result])
 rm -f confinc confmf
 ])
 
-# Copyright (C) 1999, 2000, 2001, 2003, 2004, 2005, 2008
-# Free Software Foundation, Inc.
+# Copyright (C) 1999-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 6
-
 # AM_PROG_CC_C_O
 # --------------
 # Like AC_PROG_CC_C_O, but changed for automake.
@@ -763,15 +741,12 @@ m4_define([AC_PROG_CC],
 
 # Fake the existence of programs that GNU maintainers use.  -*- Autoconf -*-
 
-# Copyright (C) 1997, 1999, 2000, 2001, 2003, 2004, 2005, 2008
-# Free Software Foundation, Inc.
+# Copyright (C) 1997-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 6
-
 # AM_MISSING_PROG(NAME, PROGRAM)
 # ------------------------------
 AC_DEFUN([AM_MISSING_PROG],
@@ -779,7 +754,6 @@ AC_DEFUN([AM_MISSING_PROG],
 $1=${$1-"${am_missing_run}$2"}
 AC_SUBST($1)])
 
-
 # AM_MISSING_HAS_RUN
 # ------------------
 # Define MISSING if not defined so far and test if it supports --run.
@@ -800,25 +774,27 @@ if eval "$MISSING --run true"; then
   am_missing_run="$MISSING --run "
 else
   am_missing_run=
-  AC_MSG_WARN([`missing' script is too old or missing])
+  AC_MSG_WARN(['missing' script is too old or missing])
 fi
 ])
 
-# Copyright (C) 2003, 2004, 2005, 2006, 2011 Free Software Foundation,
-# Inc.
+# Copyright (C) 2003-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 1
-
 # AM_PROG_MKDIR_P
 # ---------------
-# Check for `mkdir -p'.
+# Check for 'mkdir -p'.
 AC_DEFUN([AM_PROG_MKDIR_P],
 [AC_PREREQ([2.60])dnl
 AC_REQUIRE([AC_PROG_MKDIR_P])dnl
+dnl FIXME to be removed in Automake 1.13.
+AC_DIAGNOSE([obsolete],
+[$0: this macro is deprecated, and will soon be removed.
+You should use the Autoconf-provided 'AC][_PROG_MKDIR_P' macro instead,
+and use '$(MKDIR_P)' instead of '$(mkdir_p)'in your Makefile.am files.])
 dnl Automake 1.8 to 1.9.6 used to define mkdir_p.  We now use MKDIR_P,
 dnl while keeping a definition of mkdir_p for backward compatibility.
 dnl @MKDIR_P@ is magic: AC_OUTPUT adjusts its value for each Makefile.
@@ -835,15 +811,12 @@ esac
 
 # Helper functions for option handling.                     -*- Autoconf -*-
 
-# Copyright (C) 2001, 2002, 2003, 2005, 2008, 2010 Free Software
-# Foundation, Inc.
+# Copyright (C) 2001-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 5
-
 # _AM_MANGLE_OPTION(NAME)
 # -----------------------
 AC_DEFUN([_AM_MANGLE_OPTION],
@@ -853,7 +826,7 @@ AC_DEFUN([_AM_MANGLE_OPTION],
 # --------------------
 # Set option NAME.  Presently that only means defining a flag for this option.
 AC_DEFUN([_AM_SET_OPTION],
-[m4_define(_AM_MANGLE_OPTION([$1]), 1)])
+[m4_define(_AM_MANGLE_OPTION([$1]), [1])])
 
 # _AM_SET_OPTIONS(OPTIONS)
 # ------------------------
@@ -869,22 +842,16 @@ AC_DEFUN([_AM_IF_OPTION],
 
 # Check to make sure that the build environment is sane.    -*- Autoconf -*-
 
-# Copyright (C) 1996, 1997, 2000, 2001, 2003, 2005, 2008
-# Free Software Foundation, Inc.
+# Copyright (C) 1996-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 5
-
 # AM_SANITY_CHECK
 # ---------------
 AC_DEFUN([AM_SANITY_CHECK],
 [AC_MSG_CHECKING([whether build environment is sane])
-# Just in case
-sleep 1
-echo timestamp > conftest.file
 # Reject unsafe characters in $srcdir or the absolute working directory
 # name.  Accept space and tab only in the latter.
 am_lf='
@@ -895,32 +862,40 @@ case `pwd` in
 esac
 case $srcdir in
   *[[\\\"\#\$\&\'\`$am_lf\ \	]]*)
-    AC_MSG_ERROR([unsafe srcdir value: `$srcdir']);;
+    AC_MSG_ERROR([unsafe srcdir value: '$srcdir']);;
 esac
 
-# Do `set' in a subshell so we don't clobber the current shell's
+# Do 'set' in a subshell so we don't clobber the current shell's
 # arguments.  Must try -L first in case configure is actually a
 # symlink; some systems play weird games with the mod time of symlinks
 # (eg FreeBSD returns the mod time of the symlink's containing
 # directory).
 if (
-   set X `ls -Lt "$srcdir/configure" conftest.file 2> /dev/null`
-   if test "$[*]" = "X"; then
-      # -L didn't work.
-      set X `ls -t "$srcdir/configure" conftest.file`
-   fi
-   rm -f conftest.file
-   if test "$[*]" != "X $srcdir/configure conftest.file" \
-      && test "$[*]" != "X conftest.file $srcdir/configure"; then
-
-      # If neither matched, then we have a broken ls.  This can happen
-      # if, for instance, CONFIG_SHELL is bash and it inherits a
-      # broken ls alias from the environment.  This has actually
-      # happened.  Such a system could not be considered "sane".
-      AC_MSG_ERROR([ls -t appears to fail.  Make sure there is not a broken
-alias in your environment])
-   fi
-
+   am_has_slept=no
+   for am_try in 1 2; do
+     echo "timestamp, slept: $am_has_slept" > conftest.file
+     set X `ls -Lt "$srcdir/configure" conftest.file 2> /dev/null`
+     if test "$[*]" = "X"; then
+	# -L didn't work.
+	set X `ls -t "$srcdir/configure" conftest.file`
+     fi
+     if test "$[*]" != "X $srcdir/configure conftest.file" \
+	&& test "$[*]" != "X conftest.file $srcdir/configure"; then
+
+	# If neither matched, then we have a broken ls.  This can happen
+	# if, for instance, CONFIG_SHELL is bash and it inherits a
+	# broken ls alias from the environment.  This has actually
+	# happened.  Such a system could not be considered "sane".
+	AC_MSG_ERROR([ls -t appears to fail.  Make sure there is not a broken
+  alias in your environment])
+     fi
+     if test "$[2]" = conftest.file || test $am_try -eq 2; then
+       break
+     fi
+     # Just in case.
+     sleep 1
+     am_has_slept=yes
+   done
    test "$[2]" = conftest.file
    )
 then
@@ -930,31 +905,50 @@ else
    AC_MSG_ERROR([newly created file is older than distributed files!
 Check your system clock])
 fi
-AC_MSG_RESULT(yes)])
+AC_MSG_RESULT([yes])
+# If we didn't sleep, we still need to ensure time stamps of config.status and
+# generated files are strictly newer.
+am_sleep_pid=
+if grep 'slept: no' conftest.file >/dev/null 2>&1; then
+  ( sleep 1 ) &
+  am_sleep_pid=$!
+fi
+AC_CONFIG_COMMANDS_PRE(
+  [AC_MSG_CHECKING([that generated files are newer than configure])
+   if test -n "$am_sleep_pid"; then
+     # Hide warnings about reused PIDs.
+     wait $am_sleep_pid 2>/dev/null
+   fi
+   AC_MSG_RESULT([done])])
+rm -f conftest.file
+])
 
-# Copyright (C) 2009, 2011  Free Software Foundation, Inc.
+# Copyright (C) 2009-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 2
-
 # AM_SILENT_RULES([DEFAULT])
 # --------------------------
 # Enable less verbose build rules; with the default set to DEFAULT
-# (`yes' being less verbose, `no' or empty being verbose).
+# ("yes" being less verbose, "no" or empty being verbose).
 AC_DEFUN([AM_SILENT_RULES],
-[AC_ARG_ENABLE([silent-rules],
-[  --enable-silent-rules          less verbose build output (undo: `make V=1')
-  --disable-silent-rules         verbose build output (undo: `make V=0')])
-case $enable_silent_rules in
-yes) AM_DEFAULT_VERBOSITY=0;;
-no)  AM_DEFAULT_VERBOSITY=1;;
-*)   AM_DEFAULT_VERBOSITY=m4_if([$1], [yes], [0], [1]);;
+[AC_ARG_ENABLE([silent-rules], [dnl
+AS_HELP_STRING(
+  [--enable-silent-rules],
+  [less verbose build output (undo: "make V=1")])
+AS_HELP_STRING(
+  [--disable-silent-rules],
+  [verbose build output (undo: "make V=0")])dnl
+])
+case $enable_silent_rules in @%:@ (((
+  yes) AM_DEFAULT_VERBOSITY=0;;
+   no) AM_DEFAULT_VERBOSITY=1;;
+    *) AM_DEFAULT_VERBOSITY=m4_if([$1], [yes], [0], [1]);;
 esac
 dnl
-dnl A few `make' implementations (e.g., NonStop OS and NextStep)
+dnl A few 'make' implementations (e.g., NonStop OS and NextStep)
 dnl do not support nested variable expansions.
 dnl See automake bug#9928 and bug#10237.
 am_make=${MAKE-make}
@@ -972,7 +966,7 @@ else
   am_cv_make_support_nested_variables=no
 fi])
 if test $am_cv_make_support_nested_variables = yes; then
-  dnl Using `$V' instead of `$(V)' breaks IRIX make.
+  dnl Using '$V' instead of '$(V)' breaks IRIX make.
   AM_V='$(V)'
   AM_DEFAULT_V='$(AM_DEFAULT_VERBOSITY)'
 else
@@ -989,44 +983,40 @@ AC_SUBST([AM_BACKSLASH])dnl
 _AM_SUBST_NOTMAKE([AM_BACKSLASH])dnl
 ])
 
-# Copyright (C) 2001, 2003, 2005, 2011 Free Software Foundation, Inc.
+# Copyright (C) 2001-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 1
-
 # AM_PROG_INSTALL_STRIP
 # ---------------------
-# One issue with vendor `install' (even GNU) is that you can't
+# One issue with vendor 'install' (even GNU) is that you can't
 # specify the program used to strip binaries.  This is especially
 # annoying in cross-compiling environments, where the build's strip
 # is unlikely to handle the host's binaries.
 # Fortunately install-sh will honor a STRIPPROG variable, so we
-# always use install-sh in `make install-strip', and initialize
+# always use install-sh in "make install-strip", and initialize
 # STRIPPROG with the value of the STRIP variable (set by the user).
 AC_DEFUN([AM_PROG_INSTALL_STRIP],
 [AC_REQUIRE([AM_PROG_INSTALL_SH])dnl
-# Installed binaries are usually stripped using `strip' when the user
-# run `make install-strip'.  However `strip' might not be the right
+# Installed binaries are usually stripped using 'strip' when the user
+# run "make install-strip".  However 'strip' might not be the right
 # tool to use in cross-compilation environments, therefore Automake
-# will honor the `STRIP' environment variable to overrule this program.
-dnl Don't test for $cross_compiling = yes, because it might be `maybe'.
+# will honor the 'STRIP' environment variable to overrule this program.
+dnl Don't test for $cross_compiling = yes, because it might be 'maybe'.
 if test "$cross_compiling" != no; then
   AC_CHECK_TOOL([STRIP], [strip], :)
 fi
 INSTALL_STRIP_PROGRAM="\$(install_sh) -c -s"
 AC_SUBST([INSTALL_STRIP_PROGRAM])])
 
-# Copyright (C) 2006, 2008, 2010 Free Software Foundation, Inc.
+# Copyright (C) 2006-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 3
-
 # _AM_SUBST_NOTMAKE(VARIABLE)
 # ---------------------------
 # Prevent Automake from outputting VARIABLE = @VARIABLE@ in Makefile.in.
@@ -1040,18 +1030,16 @@ AC_DEFUN([AM_SUBST_NOTMAKE], [_AM_SUBST_NOTMAKE($@)])
 
 # Check how to create a tarball.                            -*- Autoconf -*-
 
-# Copyright (C) 2004, 2005, 2012 Free Software Foundation, Inc.
+# Copyright (C) 2004-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 2
-
 # _AM_PROG_TAR(FORMAT)
 # --------------------
 # Check how to create a tarball in format FORMAT.
-# FORMAT should be one of `v7', `ustar', or `pax'.
+# FORMAT should be one of 'v7', 'ustar', or 'pax'.
 #
 # Substitute a variable $(am__tar) that is a command
 # writing to stdout a FORMAT-tarball containing the directory
@@ -1074,7 +1062,7 @@ AC_MSG_CHECKING([how to create a $1 tar archive])
 _am_tools='gnutar m4_if([$1], [ustar], [plaintar]) pax cpio none'
 _am_tools=${am_cv_prog_tar_$1-$_am_tools}
 # Do not fold the above two line into one, because Tru64 sh and
-# Solaris sh will not grok spaces in the rhs of `-'.
+# Solaris sh will not grok spaces in the rhs of '-'.
 for _am_tool in $_am_tools
 do
   case $_am_tool in
@@ -1139,7 +1127,6 @@ m4_include([common/m4/as-ac-expand.m4])
 m4_include([common/m4/as-auto-alt.m4])
 m4_include([common/m4/as-compiler-flag.m4])
 m4_include([common/m4/as-gcc-inline-assembly.m4])
-m4_include([common/m4/as-objc.m4])
 m4_include([common/m4/as-python.m4])
 m4_include([common/m4/as-scrub-include.m4])
 m4_include([common/m4/as-version.m4])
diff --git a/autogen.sh b/autogen.sh
index 1fcf9f2..645b2ae 100755
--- a/autogen.sh
+++ b/autogen.sh
@@ -29,6 +29,9 @@ then
     ln -s ../../common/hooks/pre-commit.hook .git/hooks/pre-commit
 fi
 
+# GNU gettext automake support doesn't get along with git.
+# https://bugzilla.gnome.org/show_bug.cgi?id=661128
+touch -t 200001010000 po/gst-plugins-good-0.10.pot
 
 CONFIGURE_DEF_OPT='--enable-maintainer-mode --enable-gtk-doc'
 
diff --git a/autoregen.sh b/autoregen.sh
new file mode 100755
index 0000000..ac55ee0
--- /dev/null
+++ b/autoregen.sh
@@ -0,0 +1,2 @@
+#!/bin/sh
+./autogen.sh --noconfigure $@
diff --git a/config.h.in b/config.h.in
index 53c97d2..4fc1252 100644
--- a/config.h.in
+++ b/config.h.in
@@ -82,46 +82,46 @@
 /* Define to 1 if you have the `cosh' function. */
 #undef HAVE_COSH
 
-/* Define if the host CPU is an Alpha */
+/* Define if the target CPU is an Alpha */
 #undef HAVE_CPU_ALPHA
 
-/* Define if the host CPU is an ARM */
+/* Define if the target CPU is an ARM */
 #undef HAVE_CPU_ARM
 
-/* Define if the host CPU is a CRIS */
+/* Define if the target CPU is a CRIS */
 #undef HAVE_CPU_CRIS
 
-/* Define if the host CPU is a CRISv32 */
+/* Define if the target CPU is a CRISv32 */
 #undef HAVE_CPU_CRISV32
 
-/* Define if the host CPU is a HPPA */
+/* Define if the target CPU is a HPPA */
 #undef HAVE_CPU_HPPA
 
-/* Define if the host CPU is an x86 */
+/* Define if the target CPU is an x86 */
 #undef HAVE_CPU_I386
 
-/* Define if the host CPU is a IA64 */
+/* Define if the target CPU is a IA64 */
 #undef HAVE_CPU_IA64
 
-/* Define if the host CPU is a M68K */
+/* Define if the target CPU is a M68K */
 #undef HAVE_CPU_M68K
 
-/* Define if the host CPU is a MIPS */
+/* Define if the target CPU is a MIPS */
 #undef HAVE_CPU_MIPS
 
-/* Define if the host CPU is a PowerPC */
+/* Define if the target CPU is a PowerPC */
 #undef HAVE_CPU_PPC
 
-/* Define if the host CPU is a 64 bit PowerPC */
+/* Define if the target CPU is a 64 bit PowerPC */
 #undef HAVE_CPU_PPC64
 
-/* Define if the host CPU is a S390 */
+/* Define if the target CPU is a S390 */
 #undef HAVE_CPU_S390
 
-/* Define if the host CPU is a SPARC */
+/* Define if the target CPU is a SPARC */
 #undef HAVE_CPU_SPARC
 
-/* Define if the host CPU is a x86_64 */
+/* Define if the target CPU is a x86_64 */
 #undef HAVE_CPU_X86_64
 
 /* Define if the GNU dcgettext() function is already present or preinstalled.
@@ -197,6 +197,9 @@
 /* Define to 1 if you have the <inttypes.h> header file. */
 #undef HAVE_INTTYPES_H
 
+/* building for iOS platofrm */
+#undef HAVE_IOS
+
 /* Define if we have struct ip_mreqn */
 #undef HAVE_IP_MREQN
 
@@ -338,6 +341,9 @@
 /* Define if valgrind should be used */
 #undef HAVE_VALGRIND
 
+/* Define to enable Win32 WaveForm (used by waveformsink). */
+#undef HAVE_WAVEFORM
+
 /* Define to enable wavpack plug-in (used by wavpack). */
 #undef HAVE_WAVPACK
 
@@ -414,6 +420,9 @@
 /* Define to 1 if you have the ANSI C header files. */
 #undef STDC_HEADERS
 
+/* the target CPU */
+#undef TARGET_CPU
+
 /* Version number of package */
 #undef VERSION
 
diff --git a/configure b/configure
index d9aae90..1af0085 100755
--- a/configure
+++ b/configure
@@ -1,13 +1,11 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.68 for GStreamer Good Plug-ins 0.10.31.
+# Generated by GNU Autoconf 2.69 for GStreamer Good Plug-ins 0.10.31.1.
 #
 # Report bugs to <http://bugzilla.gnome.org/enter_bug.cgi?product=GStreamer>.
 #
 #
-# Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-# 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free Software
-# Foundation, Inc.
+# Copyright (C) 1992-1996, 1998-2012 Free Software Foundation, Inc.
 #
 #
 # This configure script is free software; the Free Software Foundation
@@ -136,6 +134,31 @@ export LANGUAGE
 # CDPATH.
 (unset CDPATH) >/dev/null 2>&1 && unset CDPATH
 
+# Use a proper internal environment variable to ensure we don't fall
+  # into an infinite loop, continuously re-executing ourselves.
+  if test x"${_as_can_reexec}" != xno && test "x$CONFIG_SHELL" != x; then
+    _as_can_reexec=no; export _as_can_reexec;
+    # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+as_fn_exit 255
+  fi
+  # We don't want this to propagate to other subprocesses.
+          { _as_can_reexec=; unset _as_can_reexec;}
 if test "x$CONFIG_SHELL" = x; then
   as_bourne_compatible="if test -n \"\${ZSH_VERSION+set}\" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
@@ -169,7 +192,8 @@ if ( set x; as_fn_ret_success y && test x = \"\$1\" ); then :
 else
   exitcode=1; echo positional parameters were not saved.
 fi
-test x\$exitcode = x0 || exit 1"
+test x\$exitcode = x0 || exit 1
+test -x / || exit 1"
   as_suggested="  as_lineno_1=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_1a=\$LINENO
   as_lineno_2=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_2a=\$LINENO
   eval 'test \"x\$as_lineno_1'\$as_run'\" != \"x\$as_lineno_2'\$as_run'\" &&
@@ -222,21 +246,25 @@ IFS=$as_save_IFS
 
 
       if test "x$CONFIG_SHELL" != x; then :
-  # We cannot yet assume a decent shell, so we have to provide a
-	# neutralization value for shells without unset; and this also
-	# works around shells that cannot unset nonexistent variables.
-	# Preserve -v and -x to the replacement shell.
-	BASH_ENV=/dev/null
-	ENV=/dev/null
-	(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
-	export CONFIG_SHELL
-	case $- in # ((((
-	  *v*x* | *x*v* ) as_opts=-vx ;;
-	  *v* ) as_opts=-v ;;
-	  *x* ) as_opts=-x ;;
-	  * ) as_opts= ;;
-	esac
-	exec "$CONFIG_SHELL" $as_opts "$as_myself" ${1+"$@"}
+  export CONFIG_SHELL
+             # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+exit 255
 fi
 
     if test x$as_have_required = xno; then :
@@ -340,6 +368,14 @@ $as_echo X"$as_dir" |
 
 
 } # as_fn_mkdir_p
+
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
 # as_fn_append VAR VALUE
 # ----------------------
 # Append the text in VALUE to the end of the definition contained in VAR. Take
@@ -461,6 +497,10 @@ as_cr_alnum=$as_cr_Letters$as_cr_digits
   chmod +x "$as_me.lineno" ||
     { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2; as_fn_exit 1; }
 
+  # If we had to re-execute with $CONFIG_SHELL, we're ensured to have
+  # already done that, so ensure we don't try to do so again and fall
+  # in an infinite loop.  This has already happened in practice.
+  _as_can_reexec=no; export _as_can_reexec
   # Don't try to exec as it changes $[0], causing all sort of problems
   # (the dirname of $[0] is not the place where we might find the
   # original and so on.  Autoconf is especially sensitive to this).
@@ -495,16 +535,16 @@ if (echo >conf$$.file) 2>/dev/null; then
     # ... but there are two gotchas:
     # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
     # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
+    # In both cases, we have to default to `cp -pR'.
     ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
+      as_ln_s='cp -pR'
   elif ln conf$$.file conf$$ 2>/dev/null; then
     as_ln_s=ln
   else
-    as_ln_s='cp -p'
+    as_ln_s='cp -pR'
   fi
 else
-  as_ln_s='cp -p'
+  as_ln_s='cp -pR'
 fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
@@ -516,28 +556,8 @@ else
   as_mkdir_p=false
 fi
 
-if test -x / >/dev/null 2>&1; then
-  as_test_x='test -x'
-else
-  if ls -dL / >/dev/null 2>&1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d "$1"; then
-	test -d "$1/.";
-      else
-	case $1 in #(
-	-*)set "./$1";;
-	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -571,8 +591,8 @@ MAKEFLAGS=
 # Identity of this package.
 PACKAGE_NAME='GStreamer Good Plug-ins'
 PACKAGE_TARNAME='gst-plugins-good'
-PACKAGE_VERSION='0.10.31'
-PACKAGE_STRING='GStreamer Good Plug-ins 0.10.31'
+PACKAGE_VERSION='0.10.31.1'
+PACKAGE_STRING='GStreamer Good Plug-ins 0.10.31.1'
 PACKAGE_BUGREPORT='http://bugzilla.gnome.org/enter_bug.cgi?product=GStreamer'
 PACKAGE_URL=''
 
@@ -621,8 +641,10 @@ LTLIBOBJS
 LIBOBJS
 GST_PLUGIN_LDFLAGS
 GST_ALL_LDFLAGS
+GST_OBJCFLAGS
 GST_CXXFLAGS
 GST_LT_LDFLAGS
+GST_OPTION_OBJCFLAGS
 GST_OPTION_CXXFLAGS
 GST_OPTION_CFLAGS
 DEPRECATED_CFLAGS
@@ -765,6 +787,8 @@ USE_GST_V4L2_TRUE
 XVIDEO_LIBS
 USE_OSX_VIDEO_FALSE
 USE_OSX_VIDEO_TRUE
+HAVE_IOS_FALSE
+HAVE_IOS_TRUE
 USE_OSX_AUDIO_FALSE
 USE_OSX_AUDIO_TRUE
 USE_SUNAUDIO_FALSE
@@ -773,6 +797,8 @@ USE_OSS4_FALSE
 USE_OSS4_TRUE
 USE_OSS_FALSE
 USE_OSS_TRUE
+USE_WAVEFORM_FALSE
+USE_WAVEFORM_TRUE
 USE_DIRECTSOUND_FALSE
 USE_DIRECTSOUND_TRUE
 HAVE_DIRECTSOUND
@@ -870,6 +896,8 @@ DEFAULT_VIDEOSINK
 DEFAULT_AUDIOSRC
 DEFAULT_AUDIOSINK
 GST_LEVEL_DEFAULT
+ERROR_OBJCFLAGS
+WARNING_OBJCFLAGS
 ERROR_CXXFLAGS
 WARNING_CXXFLAGS
 ERROR_CFLAGS
@@ -962,8 +990,8 @@ CCAS
 am__fastdepOBJC_FALSE
 am__fastdepOBJC_TRUE
 OBJCDEPMODE
-OBJC_LDFLAGS
 ac_ct_OBJC
+OBJCFLAGS
 OBJC
 HAVE_CXX
 CXXCPP
@@ -1090,14 +1118,6 @@ AM_BACKSLASH
 AM_DEFAULT_VERBOSITY
 AM_DEFAULT_V
 AM_V
-host_os
-host_vendor
-host_cpu
-host
-build_os
-build_vendor
-build_cpu
-build
 MAINT
 MAINTAINER_MODE_FALSE
 MAINTAINER_MODE_TRUE
@@ -1129,6 +1149,18 @@ am__isrc
 INSTALL_DATA
 INSTALL_SCRIPT
 INSTALL_PROGRAM
+target_os
+target_vendor
+target_cpu
+target
+host_os
+host_vendor
+host_cpu
+host
+build_os
+build_vendor
+build_cpu
+build
 target_alias
 host_alias
 build_alias
@@ -1188,6 +1220,7 @@ enable_nls
 enable_rpath
 with_libiconv_prefix
 with_libintl_prefix
+enable_fatal_warnings
 enable_debug
 enable_profiling
 enable_valgrind
@@ -1257,6 +1290,7 @@ enable_wavenc
 enable_wavparse
 enable_y4m
 enable_directsound
+enable_waveform
 enable_oss
 enable_oss4
 enable_sunaudio
@@ -1316,6 +1350,8 @@ CXX
 CXXFLAGS
 CCC
 CXXCPP
+OBJC
+OBJCFLAGS
 CCAS
 CCASFLAGS
 GLIB_CFLAGS
@@ -1852,8 +1888,6 @@ target=$target_alias
 if test "x$host_alias" != x; then
   if test "x$build_alias" = x; then
     cross_compiling=maybe
-    $as_echo "$as_me: WARNING: if you wanted to set the --build type, don't use --host.
-    If a cross compiler is detected then cross compile mode will be used" >&2
   elif test "x$build_alias" != "x$host_alias"; then
     cross_compiling=yes
   fi
@@ -1939,7 +1973,7 @@ if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures GStreamer Good Plug-ins 0.10.31 to adapt to many kinds of systems.
+\`configure' configures GStreamer Good Plug-ins 0.10.31.1 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
@@ -2009,12 +2043,13 @@ X features:
 System types:
   --build=BUILD     configure for building on BUILD [guessed]
   --host=HOST       cross-compile to build programs to run on HOST [BUILD]
+  --target=TARGET   configure for building compilers for TARGET [HOST]
 _ACEOF
 fi
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of GStreamer Good Plug-ins 0.10.31:";;
+     short | recursive ) echo "Configuration of GStreamer Good Plug-ins 0.10.31.1:";;
    esac
   cat <<\_ACEOF
 
@@ -2022,19 +2057,24 @@ Optional Features:
   --disable-option-checking  ignore unrecognized --enable/--with options
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
-  --enable-maintainer-mode  enable make rules and dependencies not useful
-			  (and sometimes confusing) to the casual installer
-  --enable-silent-rules          less verbose build output (undo: `make V=1')
-  --disable-silent-rules         verbose build output (undo: `make V=0')
+  --enable-maintainer-mode
+                          enable make rules and dependencies not useful (and
+                          sometimes confusing) to the casual installer
+  --enable-silent-rules   less verbose build output (undo: "make V=1")
+  --disable-silent-rules  verbose build output (undo: "make V=0")
   --enable-shared[=PKGS]  build shared libraries [default=yes]
   --enable-static[=PKGS]  build static libraries [default=yes]
   --enable-fast-install[=PKGS]
                           optimize for fast installation [default=yes]
-  --disable-dependency-tracking  speeds up one-time build
-  --enable-dependency-tracking   do not reject slow dependency extractors
+  --enable-dependency-tracking
+                          do not reject slow dependency extractors
+  --disable-dependency-tracking
+                          speeds up one-time build
   --disable-libtool-lock  avoid locking (might break parallel builds)
   --disable-nls           do not use Native Language Support
   --disable-rpath         do not hardcode runtime library paths
+  --disable-fatal-warnings
+                          Don't turn compiler warnings into fatal errors
   --disable-debug         disable addition of -g debugging info
   --enable-profiling      adds -pg to compiler commandline, for profiling
   --disable-valgrind      disable run-time valgrind detection
@@ -2094,6 +2134,7 @@ Optional Features:
   --disable-wavparse      disable dependency-less wavparse plugin
   --disable-y4m           disable dependency-less y4m plugin
   --disable-directsound        disable DirectSound plug-in: directsoundsink
+  --disable-waveform           disable Win32 WaveForm: waveformsink
   --disable-oss                disable OSS audio: ossaudio
   --disable-oss4               disable Open Sound System 4: oss4
   --disable-sunaudio           disable Sun Audio: sunaudio
@@ -2195,6 +2236,8 @@ Some influential environment variables:
   CXX         C++ compiler command
   CXXFLAGS    C++ compiler flags
   CXXCPP      C++ preprocessor
+  OBJC        Objective C compiler command
+  OBJCFLAGS   Objective C compiler flags
   CCAS        assembler compiler command (defaults to CC)
   CCASFLAGS   assembler compiler flags (defaults to CFLAGS)
   GLIB_CFLAGS C compiler flags for GLIB, overriding pkg-config
@@ -2391,10 +2434,10 @@ fi
 test -n "$ac_init_help" && exit $ac_status
 if $ac_init_version; then
   cat <<\_ACEOF
-GStreamer Good Plug-ins configure 0.10.31
-generated by GNU Autoconf 2.68
+GStreamer Good Plug-ins configure 0.10.31.1
+generated by GNU Autoconf 2.69
 
-Copyright (C) 2010 Free Software Foundation, Inc.
+Copyright (C) 2012 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 _ACEOF
@@ -2470,7 +2513,7 @@ $as_echo "$ac_try_echo"; } >&5
 	 test ! -s conftest.err
        } && test -s conftest$ac_exeext && {
 	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
+	 test -x conftest$ac_exeext
        }; then :
   ac_retval=0
 else
@@ -2814,7 +2857,7 @@ $as_echo "$ac_try_echo"; } >&5
 	 test ! -s conftest.err
        } && test -s conftest$ac_exeext && {
 	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
+	 test -x conftest$ac_exeext
        }; then :
   ac_retval=0
 else
@@ -2833,6 +2876,44 @@ fi
 
 } # ac_fn_cxx_try_link
 
+# ac_fn_objc_try_compile LINENO
+# -----------------------------
+# Try to compile conftest.$ac_ext, and return whether this succeeded.
+ac_fn_objc_try_compile ()
+{
+  as_lineno=${as_lineno-"$1"} as_lineno_stack=as_lineno_stack=$as_lineno_stack
+  rm -f conftest.$ac_objext
+  if { { ac_try="$ac_compile"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compile") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    grep -v '^ *+' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+    mv -f conftest.er1 conftest.err
+  fi
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; } && {
+	 test -z "$ac_objc_werror_flag" ||
+	 test ! -s conftest.err
+       } && test -s conftest.$ac_objext; then :
+  ac_retval=0
+else
+  $as_echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+	ac_retval=1
+fi
+  eval $as_lineno_stack; ${as_lineno_stack:+:} unset as_lineno
+  as_fn_set_status $ac_retval
+
+} # ac_fn_objc_try_compile
+
 # ac_fn_c_check_type LINENO TYPE VAR INCLUDES
 # -------------------------------------------
 # Tests whether TYPE exists after having included INCLUDES, setting cache
@@ -2904,7 +2985,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(($2) >= 0)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2920,7 +3002,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(($2) <= $ac_mid)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2946,7 +3029,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(($2) < 0)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2962,7 +3046,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(($2) >= $ac_mid)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2996,7 +3081,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(($2) <= $ac_mid)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -3159,8 +3245,8 @@ cat >config.log <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by GStreamer Good Plug-ins $as_me 0.10.31, which was
-generated by GNU Autoconf 2.68.  Invocation command line was
+It was created by GStreamer Good Plug-ins $as_me 0.10.31.1, which was
+generated by GNU Autoconf 2.69.  Invocation command line was
 
   $ $0 $@
 
@@ -3512,12 +3598,6 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
 
-
-
-
-
-am__api_version='1.11'
-
 ac_aux_dir=
 for ac_dir in "$srcdir" "$srcdir/.." "$srcdir/../.."; do
   if test -f "$ac_dir/install-sh"; then
@@ -3547,6 +3627,122 @@ ac_config_sub="$SHELL $ac_aux_dir/config.sub"  # Please don't use this var.
 ac_configure="$SHELL $ac_aux_dir/configure"  # Please don't use this var.
 
 
+# Make sure we can run config.sub.
+$SHELL "$ac_aux_dir/config.sub" sun4 >/dev/null 2>&1 ||
+  as_fn_error $? "cannot run $SHELL $ac_aux_dir/config.sub" "$LINENO" 5
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking build system type" >&5
+$as_echo_n "checking build system type... " >&6; }
+if ${ac_cv_build+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_build_alias=$build_alias
+test "x$ac_build_alias" = x &&
+  ac_build_alias=`$SHELL "$ac_aux_dir/config.guess"`
+test "x$ac_build_alias" = x &&
+  as_fn_error $? "cannot guess build type; you must specify one" "$LINENO" 5
+ac_cv_build=`$SHELL "$ac_aux_dir/config.sub" $ac_build_alias` ||
+  as_fn_error $? "$SHELL $ac_aux_dir/config.sub $ac_build_alias failed" "$LINENO" 5
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_build" >&5
+$as_echo "$ac_cv_build" >&6; }
+case $ac_cv_build in
+*-*-*) ;;
+*) as_fn_error $? "invalid value of canonical build" "$LINENO" 5;;
+esac
+build=$ac_cv_build
+ac_save_IFS=$IFS; IFS='-'
+set x $ac_cv_build
+shift
+build_cpu=$1
+build_vendor=$2
+shift; shift
+# Remember, the first character of IFS is used to create $*,
+# except with old shells:
+build_os=$*
+IFS=$ac_save_IFS
+case $build_os in *\ *) build_os=`echo "$build_os" | sed 's/ /-/g'`;; esac
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking host system type" >&5
+$as_echo_n "checking host system type... " >&6; }
+if ${ac_cv_host+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test "x$host_alias" = x; then
+  ac_cv_host=$ac_cv_build
+else
+  ac_cv_host=`$SHELL "$ac_aux_dir/config.sub" $host_alias` ||
+    as_fn_error $? "$SHELL $ac_aux_dir/config.sub $host_alias failed" "$LINENO" 5
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_host" >&5
+$as_echo "$ac_cv_host" >&6; }
+case $ac_cv_host in
+*-*-*) ;;
+*) as_fn_error $? "invalid value of canonical host" "$LINENO" 5;;
+esac
+host=$ac_cv_host
+ac_save_IFS=$IFS; IFS='-'
+set x $ac_cv_host
+shift
+host_cpu=$1
+host_vendor=$2
+shift; shift
+# Remember, the first character of IFS is used to create $*,
+# except with old shells:
+host_os=$*
+IFS=$ac_save_IFS
+case $host_os in *\ *) host_os=`echo "$host_os" | sed 's/ /-/g'`;; esac
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking target system type" >&5
+$as_echo_n "checking target system type... " >&6; }
+if ${ac_cv_target+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test "x$target_alias" = x; then
+  ac_cv_target=$ac_cv_host
+else
+  ac_cv_target=`$SHELL "$ac_aux_dir/config.sub" $target_alias` ||
+    as_fn_error $? "$SHELL $ac_aux_dir/config.sub $target_alias failed" "$LINENO" 5
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_target" >&5
+$as_echo "$ac_cv_target" >&6; }
+case $ac_cv_target in
+*-*-*) ;;
+*) as_fn_error $? "invalid value of canonical target" "$LINENO" 5;;
+esac
+target=$ac_cv_target
+ac_save_IFS=$IFS; IFS='-'
+set x $ac_cv_target
+shift
+target_cpu=$1
+target_vendor=$2
+shift; shift
+# Remember, the first character of IFS is used to create $*,
+# except with old shells:
+target_os=$*
+IFS=$ac_save_IFS
+case $target_os in *\ *) target_os=`echo "$target_os" | sed 's/ /-/g'`;; esac
+
+
+# The aliases save the names the user supplied, while $host etc.
+# will get canonicalized.
+test -n "$target_alias" &&
+  test "$program_prefix$program_suffix$program_transform_name" = \
+    NONENONEs,x,x, &&
+  program_prefix=${target_alias}-
+
+
+
+
+am__api_version='1.12'
+
 # Find a good install program.  We prefer a C program (faster),
 # so one script is as good as another.  But avoid the broken or
 # incompatible versions:
@@ -3584,7 +3780,7 @@ case $as_dir/ in #((
     # by default.
     for ac_prog in ginstall scoinst install; do
       for ac_exec_ext in '' $ac_executable_extensions; do
-	if { test -f "$as_dir/$ac_prog$ac_exec_ext" && $as_test_x "$as_dir/$ac_prog$ac_exec_ext"; }; then
+	if as_fn_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
 	  if test $ac_prog = install &&
 	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
 	    # AIX install.  It has an incompatible calling convention.
@@ -3642,9 +3838,6 @@ test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether build environment is sane" >&5
 $as_echo_n "checking whether build environment is sane... " >&6; }
-# Just in case
-sleep 1
-echo timestamp > conftest.file
 # Reject unsafe characters in $srcdir or the absolute working directory
 # name.  Accept space and tab only in the latter.
 am_lf='
@@ -3655,32 +3848,40 @@ case `pwd` in
 esac
 case $srcdir in
   *[\\\"\#\$\&\'\`$am_lf\ \	]*)
-    as_fn_error $? "unsafe srcdir value: \`$srcdir'" "$LINENO" 5;;
+    as_fn_error $? "unsafe srcdir value: '$srcdir'" "$LINENO" 5;;
 esac
 
-# Do `set' in a subshell so we don't clobber the current shell's
+# Do 'set' in a subshell so we don't clobber the current shell's
 # arguments.  Must try -L first in case configure is actually a
 # symlink; some systems play weird games with the mod time of symlinks
 # (eg FreeBSD returns the mod time of the symlink's containing
 # directory).
 if (
-   set X `ls -Lt "$srcdir/configure" conftest.file 2> /dev/null`
-   if test "$*" = "X"; then
-      # -L didn't work.
-      set X `ls -t "$srcdir/configure" conftest.file`
-   fi
-   rm -f conftest.file
-   if test "$*" != "X $srcdir/configure conftest.file" \
-      && test "$*" != "X conftest.file $srcdir/configure"; then
-
-      # If neither matched, then we have a broken ls.  This can happen
-      # if, for instance, CONFIG_SHELL is bash and it inherits a
-      # broken ls alias from the environment.  This has actually
-      # happened.  Such a system could not be considered "sane".
-      as_fn_error $? "ls -t appears to fail.  Make sure there is not a broken
-alias in your environment" "$LINENO" 5
-   fi
-
+   am_has_slept=no
+   for am_try in 1 2; do
+     echo "timestamp, slept: $am_has_slept" > conftest.file
+     set X `ls -Lt "$srcdir/configure" conftest.file 2> /dev/null`
+     if test "$*" = "X"; then
+	# -L didn't work.
+	set X `ls -t "$srcdir/configure" conftest.file`
+     fi
+     if test "$*" != "X $srcdir/configure conftest.file" \
+	&& test "$*" != "X conftest.file $srcdir/configure"; then
+
+	# If neither matched, then we have a broken ls.  This can happen
+	# if, for instance, CONFIG_SHELL is bash and it inherits a
+	# broken ls alias from the environment.  This has actually
+	# happened.  Such a system could not be considered "sane".
+	as_fn_error $? "ls -t appears to fail.  Make sure there is not a broken
+  alias in your environment" "$LINENO" 5
+     fi
+     if test "$2" = conftest.file || test $am_try -eq 2; then
+       break
+     fi
+     # Just in case.
+     sleep 1
+     am_has_slept=yes
+   done
    test "$2" = conftest.file
    )
 then
@@ -3692,6 +3893,16 @@ Check your system clock" "$LINENO" 5
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
+# If we didn't sleep, we still need to ensure time stamps of config.status and
+# generated files are strictly newer.
+am_sleep_pid=
+if grep 'slept: no' conftest.file >/dev/null 2>&1; then
+  ( sleep 1 ) &
+  am_sleep_pid=$!
+fi
+
+rm -f conftest.file
+
 test "$program_prefix" != NONE &&
   program_transform_name="s&^&$program_prefix&;$program_transform_name"
 # Use a double $ so make ignores it.
@@ -3718,8 +3929,8 @@ if eval "$MISSING --run true"; then
   am_missing_run="$MISSING --run "
 else
   am_missing_run=
-  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: \`missing' script is too old or missing" >&5
-$as_echo "$as_me: WARNING: \`missing' script is too old or missing" >&2;}
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: 'missing' script is too old or missing" >&5
+$as_echo "$as_me: WARNING: 'missing' script is too old or missing" >&2;}
 fi
 
 if test x"${install_sh}" != xset; then
@@ -3731,10 +3942,10 @@ if test x"${install_sh}" != xset; then
   esac
 fi
 
-# Installed binaries are usually stripped using `strip' when the user
-# run `make install-strip'.  However `strip' might not be the right
+# Installed binaries are usually stripped using 'strip' when the user
+# run "make install-strip".  However 'strip' might not be the right
 # tool to use in cross-compilation environments, therefore Automake
-# will honor the `STRIP' environment variable to overrule this program.
+# will honor the 'STRIP' environment variable to overrule this program.
 if test "$cross_compiling" != no; then
   if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}strip", so it can be a program name with args.
@@ -3753,7 +3964,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_STRIP="${ac_tool_prefix}strip"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3793,7 +4004,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_STRIP="strip"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3844,7 +4055,7 @@ do
   test -z "$as_dir" && as_dir=.
     for ac_prog in mkdir gmkdir; do
 	 for ac_exec_ext in '' $ac_executable_extensions; do
-	   { test -f "$as_dir/$ac_prog$ac_exec_ext" && $as_test_x "$as_dir/$ac_prog$ac_exec_ext"; } || continue
+	   as_fn_executable_p "$as_dir/$ac_prog$ac_exec_ext" || continue
 	   case `"$as_dir/$ac_prog$ac_exec_ext" --version 2>&1` in #(
 	     'mkdir (GNU coreutils) '* | \
 	     'mkdir (coreutils) '* | \
@@ -3873,12 +4084,6 @@ fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MKDIR_P" >&5
 $as_echo "$MKDIR_P" >&6; }
 
-mkdir_p="$MKDIR_P"
-case $mkdir_p in
-  [\\/$]* | ?:[\\/]*) ;;
-  */*) mkdir_p="\$(top_builddir)/$mkdir_p" ;;
-esac
-
 for ac_prog in gawk mawk nawk awk
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
@@ -3897,7 +4102,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AWK="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3983,7 +4188,7 @@ fi
 
 # Define the identity of the package.
  PACKAGE='gst-plugins-good'
- VERSION='0.10.31'
+ VERSION='0.10.31.1'
 
 
 cat >>confdefs.h <<_ACEOF
@@ -4011,6 +4216,12 @@ AUTOHEADER=${AUTOHEADER-"${am_missing_run}autoheader"}
 
 MAKEINFO=${MAKEINFO-"${am_missing_run}makeinfo"}
 
+# For better backward compatibility.  To be removed once Automake 1.9.x
+# dies out for good.  For more background, see:
+# <http://lists.gnu.org/archive/html/automake/2012-07/msg00001.html>
+# <http://lists.gnu.org/archive/html/automake/2012-07/msg00014.html>
+mkdir_p='$(MKDIR_P)'
+
 # We need awk for the "check" target.  The system "awk" is bad on
 # some platforms.
 # Always define AMTAR for backward compatibility.  Yes, it's still used
@@ -4025,9 +4236,9 @@ am__tar='$${TAR-tar} chof - "$$tardir"' am__untar='$${TAR-tar} xf -'
 
 
 
-  PACKAGE_VERSION_MAJOR=$(echo 0.10.31 | cut -d'.' -f1)
-  PACKAGE_VERSION_MINOR=$(echo 0.10.31 | cut -d'.' -f2)
-  PACKAGE_VERSION_MICRO=$(echo 0.10.31 | cut -d'.' -f3)
+  PACKAGE_VERSION_MAJOR=$(echo 0.10.31.1 | cut -d'.' -f1)
+  PACKAGE_VERSION_MINOR=$(echo 0.10.31.1 | cut -d'.' -f2)
+  PACKAGE_VERSION_MICRO=$(echo 0.10.31.1 | cut -d'.' -f3)
 
 
 
@@ -4038,7 +4249,7 @@ am__tar='$${TAR-tar} chof - "$$tardir"' am__untar='$${TAR-tar} xf -'
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking nano version" >&5
 $as_echo_n "checking nano version... " >&6; }
 
-  NANO=$(echo 0.10.31 | cut -d'.' -f4)
+  NANO=$(echo 0.10.31.1 | cut -d'.' -f4)
 
   if test x"$NANO" = x || test "x$NANO" = "x0" ; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: 0 (release)" >&5
@@ -4090,76 +4301,6 @@ fi
 
 
 
-# Make sure we can run config.sub.
-$SHELL "$ac_aux_dir/config.sub" sun4 >/dev/null 2>&1 ||
-  as_fn_error $? "cannot run $SHELL $ac_aux_dir/config.sub" "$LINENO" 5
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking build system type" >&5
-$as_echo_n "checking build system type... " >&6; }
-if ${ac_cv_build+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_build_alias=$build_alias
-test "x$ac_build_alias" = x &&
-  ac_build_alias=`$SHELL "$ac_aux_dir/config.guess"`
-test "x$ac_build_alias" = x &&
-  as_fn_error $? "cannot guess build type; you must specify one" "$LINENO" 5
-ac_cv_build=`$SHELL "$ac_aux_dir/config.sub" $ac_build_alias` ||
-  as_fn_error $? "$SHELL $ac_aux_dir/config.sub $ac_build_alias failed" "$LINENO" 5
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_build" >&5
-$as_echo "$ac_cv_build" >&6; }
-case $ac_cv_build in
-*-*-*) ;;
-*) as_fn_error $? "invalid value of canonical build" "$LINENO" 5;;
-esac
-build=$ac_cv_build
-ac_save_IFS=$IFS; IFS='-'
-set x $ac_cv_build
-shift
-build_cpu=$1
-build_vendor=$2
-shift; shift
-# Remember, the first character of IFS is used to create $*,
-# except with old shells:
-build_os=$*
-IFS=$ac_save_IFS
-case $build_os in *\ *) build_os=`echo "$build_os" | sed 's/ /-/g'`;; esac
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking host system type" >&5
-$as_echo_n "checking host system type... " >&6; }
-if ${ac_cv_host+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test "x$host_alias" = x; then
-  ac_cv_host=$ac_cv_build
-else
-  ac_cv_host=`$SHELL "$ac_aux_dir/config.sub" $host_alias` ||
-    as_fn_error $? "$SHELL $ac_aux_dir/config.sub $host_alias failed" "$LINENO" 5
-fi
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_host" >&5
-$as_echo "$ac_cv_host" >&6; }
-case $ac_cv_host in
-*-*-*) ;;
-*) as_fn_error $? "invalid value of canonical host" "$LINENO" 5;;
-esac
-host=$ac_cv_host
-ac_save_IFS=$IFS; IFS='-'
-set x $ac_cv_host
-shift
-host_cpu=$1
-host_vendor=$2
-shift; shift
-# Remember, the first character of IFS is used to create $*,
-# except with old shells:
-host_os=$*
-IFS=$ac_save_IFS
-case $host_os in *\ *) host_os=`echo "$host_os" | sed 's/ /-/g'`;; esac
-
 
 
 # Check whether --enable-silent-rules was given.
@@ -4167,10 +4308,10 @@ if test "${enable_silent_rules+set}" = set; then :
   enableval=$enable_silent_rules;
 fi
 
-case $enable_silent_rules in
-yes) AM_DEFAULT_VERBOSITY=0;;
-no)  AM_DEFAULT_VERBOSITY=1;;
-*)   AM_DEFAULT_VERBOSITY=0;;
+case $enable_silent_rules in # (((
+  yes) AM_DEFAULT_VERBOSITY=0;;
+   no) AM_DEFAULT_VERBOSITY=1;;
+    *) AM_DEFAULT_VERBOSITY=0;;
 esac
 am_make=${MAKE-make}
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $am_make supports nested variables" >&5
@@ -4236,7 +4377,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AS="${ac_tool_prefix}as"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4276,7 +4417,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_AS="as"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4328,7 +4469,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DLLTOOL="${ac_tool_prefix}dlltool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4368,7 +4509,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DLLTOOL="dlltool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4420,7 +4561,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OBJDUMP="${ac_tool_prefix}objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4460,7 +4601,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OBJDUMP="objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4631,7 +4772,7 @@ am__quote=
 _am_result=none
 # First try GNU make style include.
 echo "include confinc" > confmf
-# Ignore all kinds of additional output from `make'.
+# Ignore all kinds of additional output from 'make'.
 case `$am_make -s -f confmf 2> /dev/null` in #(
 *the\ am__doit\ target*)
   am__include=include
@@ -4697,7 +4838,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4737,7 +4878,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4790,7 +4931,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}cc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4831,7 +4972,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
@@ -4889,7 +5030,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4933,7 +5074,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -5379,8 +5520,7 @@ cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
+struct stat;
 /* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
 struct buf { int x; };
 FILE * (*rcsopen) (struct buf *, struct stat *, int);
@@ -5476,8 +5616,8 @@ else
   # We make a subdir and do the tests there.  Otherwise we can end up
   # making bogus files that we don't know about and never remove.  For
   # instance it was reported that on HP-UX the gcc test will end up
-  # making a dummy file named `D' -- because `-MD' means `put the output
-  # in D'.
+  # making a dummy file named 'D' -- because '-MD' means "put the output
+  # in D".
   rm -rf conftest.dir
   mkdir conftest.dir
   # Copy depcomp to subdir because otherwise we won't find it if we're
@@ -5512,16 +5652,16 @@ else
     : > sub/conftest.c
     for i in 1 2 3 4 5 6; do
       echo '#include "conftst'$i'.h"' >> sub/conftest.c
-      # Using `: > sub/conftst$i.h' creates only sub/conftst1.h with
-      # Solaris 8's {/usr,}/bin/sh.
-      touch sub/conftst$i.h
+      # Using ": > sub/conftst$i.h" creates only sub/conftst1.h with
+      # Solaris 10 /bin/sh.
+      echo '/* dummy */' > sub/conftst$i.h
     done
     echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
 
-    # We check with `-c' and `-o' for the sake of the "dashmstdout"
+    # We check with '-c' and '-o' for the sake of the "dashmstdout"
     # mode.  It turns out that the SunPro C++ compiler does not properly
-    # handle `-M -o', and we need to detect this.  Also, some Intel
-    # versions had trouble with output in subdirs
+    # handle '-M -o', and we need to detect this.  Also, some Intel
+    # versions had trouble with output in subdirs.
     am__obj=sub/conftest.${OBJEXT-o}
     am__minus_obj="-o $am__obj"
     case $depmode in
@@ -5530,8 +5670,8 @@ else
       test "$am__universal" = false || continue
       ;;
     nosideeffect)
-      # after this tag, mechanisms are not by side-effect, so they'll
-      # only be used when explicitly requested
+      # After this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested.
       if test "x$enable_dependency_tracking" = xyes; then
 	continue
       else
@@ -5539,7 +5679,7 @@ else
       fi
       ;;
     msvc7 | msvc7msys | msvisualcpp | msvcmsys)
-      # This compiler won't grok `-c -o', but also, the minuso test has
+      # This compiler won't grok '-c -o', but also, the minuso test has
       # not run yet.  These depmodes are late enough in the game, and
       # so weak that their functioning should not be impacted.
       am__obj=conftest.${OBJEXT-o}
@@ -5615,7 +5755,7 @@ do
     for ac_prog in sed gsed; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_SED="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_SED" && $as_test_x "$ac_path_SED"; } || continue
+      as_fn_executable_p "$ac_path_SED" || continue
 # Check for GNU ac_path_SED and select it if it is found.
   # Check for GNU $ac_path_SED
 case `"$ac_path_SED" --version 2>&1` in
@@ -5691,7 +5831,7 @@ do
     for ac_prog in grep ggrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_GREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_GREP" && $as_test_x "$ac_path_GREP"; } || continue
+      as_fn_executable_p "$ac_path_GREP" || continue
 # Check for GNU ac_path_GREP and select it if it is found.
   # Check for GNU $ac_path_GREP
 case `"$ac_path_GREP" --version 2>&1` in
@@ -5757,7 +5897,7 @@ do
     for ac_prog in egrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_EGREP" && $as_test_x "$ac_path_EGREP"; } || continue
+      as_fn_executable_p "$ac_path_EGREP" || continue
 # Check for GNU ac_path_EGREP and select it if it is found.
   # Check for GNU $ac_path_EGREP
 case `"$ac_path_EGREP" --version 2>&1` in
@@ -5824,7 +5964,7 @@ do
     for ac_prog in fgrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_FGREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_FGREP" && $as_test_x "$ac_path_FGREP"; } || continue
+      as_fn_executable_p "$ac_path_FGREP" || continue
 # Check for GNU ac_path_FGREP and select it if it is found.
   # Check for GNU $ac_path_FGREP
 case `"$ac_path_FGREP" --version 2>&1` in
@@ -6080,7 +6220,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DUMPBIN="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6124,7 +6264,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DUMPBIN="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6548,7 +6688,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OBJDUMP="${ac_tool_prefix}objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6588,7 +6728,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OBJDUMP="objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6757,7 +6897,7 @@ linux* | k*bsd*-gnu | kopensolaris*-gnu)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-netbsd* | netbsdelf*-gnu)
+netbsd*)
   if echo __ELF__ | $CC -E - | $GREP __ELF__ > /dev/null; then
     lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|_pic\.a)$'
   else
@@ -6891,7 +7031,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DLLTOOL="${ac_tool_prefix}dlltool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6931,7 +7071,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DLLTOOL="dlltool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7032,7 +7172,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AR="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7076,7 +7216,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_AR="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7201,7 +7341,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_STRIP="${ac_tool_prefix}strip"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7241,7 +7381,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_STRIP="strip"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7300,7 +7440,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7340,7 +7480,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_RANLIB="ranlib"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7989,7 +8129,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_MANIFEST_TOOL="${ac_tool_prefix}mt"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8029,7 +8169,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_MANIFEST_TOOL="mt"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8109,7 +8249,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DSYMUTIL="${ac_tool_prefix}dsymutil"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8149,7 +8289,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DSYMUTIL="dsymutil"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8201,7 +8341,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_NMEDIT="${ac_tool_prefix}nmedit"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8241,7 +8381,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_NMEDIT="nmedit"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8293,7 +8433,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_LIPO="${ac_tool_prefix}lipo"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8333,7 +8473,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_LIPO="lipo"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8385,7 +8525,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OTOOL="${ac_tool_prefix}otool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8425,7 +8565,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OTOOL="otool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8477,7 +8617,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OTOOL64="${ac_tool_prefix}otool64"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8517,7 +8657,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OTOOL64="otool64"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -10153,9 +10293,6 @@ $as_echo_n "checking whether the $compiler linker ($LD) supports shared librarie
   openbsd*)
     with_gnu_ld=no
     ;;
-  linux* | k*bsd*-gnu | gnu*)
-    link_all_deplibs=no
-    ;;
   esac
 
   ld_shlibs=yes
@@ -10377,7 +10514,7 @@ _LT_EOF
       fi
       ;;
 
-    netbsd* | netbsdelf*-gnu)
+    netbsd*)
       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
 	archive_cmds='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
 	wlarc=
@@ -10554,7 +10691,6 @@ _LT_EOF
 	if test "$aix_use_runtimelinking" = yes; then
 	  shared_flag="$shared_flag "'${wl}-G'
 	fi
-	link_all_deplibs=no
       else
 	# not using gcc
 	if test "$host_cpu" = ia64; then
@@ -11008,7 +11144,7 @@ $as_echo "$lt_cv_irix_exported_symbol" >&6; }
       link_all_deplibs=yes
       ;;
 
-    netbsd* | netbsdelf*-gnu)
+    netbsd*)
       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
 	archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'  # a.out
       else
@@ -12036,18 +12172,6 @@ fi
   dynamic_linker='GNU/Linux ld.so'
   ;;
 
-netbsdelf*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='NetBSD ld.elf_so'
-  ;;
-
 netbsd*)
   version_type=sunos
   need_lib_prefix=no
@@ -13020,7 +13144,7 @@ CC="$lt_save_CC"
 
 
 GST_REQ=0.10.36
-GSTPB_REQ=0.10.36
+GSTPB_REQ=0.10.36.1
 
 
 
@@ -13086,6 +13210,13 @@ ACLOCAL_AMFLAGS="-I m4 -I common/m4"
 
 
 
+mkdir_p="$MKDIR_P"
+case $mkdir_p in
+  [\\/$]* | ?:[\\/]*) ;;
+  */*) mkdir_p="\$(top_builddir)/$mkdir_p" ;;
+esac
+
+
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether NLS is requested" >&5
 $as_echo_n "checking whether NLS is requested... " >&6; }
     # Check whether --enable-nls was given.
@@ -13193,7 +13324,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_GMSGFMT="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -15038,6 +15169,21 @@ _ACEOF
 
 
 
+  # Check whether --enable-fatal-warnings was given.
+if test "${enable_fatal_warnings+set}" = set; then :
+  enableval=$enable_fatal_warnings;
+      case "${enableval}" in
+        yes) FATAL_WARNINGS=yes ;;
+        no)  FATAL_WARNINGS=no ;;
+        *)   as_fn_error $? "bad value ${enableval} for --disable-fatal-warnings" "$LINENO" 5 ;;
+      esac
+
+else
+  FATAL_WARNINGS=no
+fi
+
+
+
     # Check whether --enable-debug was given.
 if test "${enable_debug+set}" = set; then :
   enableval=$enable_debug;
@@ -15087,7 +15233,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -15130,7 +15276,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_ac_pt_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -15377,13 +15523,13 @@ _ACEOF
 
         if test "x$GST_GCOV_ENABLED" = "xyes"
     then
-      CFLAGS="-O0"
+      CFLAGS="$CFLAGS -O0"
 
-      CXXFLAGS="-O0"
+      CXXFLAGS="$CXXFLAGS -O0"
 
-      FFLAGS="-O0"
+      FFLAGS="$FFLAGS -O0"
 
-      CCASFLAGS="-O0"
+      CCASFLAGS="$CCASFLAGS -O0"
 
       { $as_echo "$as_me:${as_lineno-$LINENO}: gcov enabled, setting CFLAGS and friends to $CFLAGS" >&5
 $as_echo "$as_me: gcov enabled, setting CFLAGS and friends to $CFLAGS" >&6;}
@@ -15718,10 +15864,9 @@ fi
 
 
 
-
-    case "x${host_cpu}" in
+    case "x${target_cpu}" in
     xi?86 | xk? | xi?86_64)
-      case $host_os in
+      case $target_os in
          solaris*)
             ac_fn_c_check_decl "$LINENO" "__i386" "ac_cv_have_decl___i386" "$ac_includes_default"
 if test "x$ac_cv_have_decl___i386" = xyes; then :
@@ -15757,7 +15902,7 @@ $as_echo "#define HAVE_CPU_X86_64 1" >>confdefs.h
 $as_echo "#define HAVE_CPU_I386 1" >>confdefs.h
 
 
-                                    case "x${host_cpu}" in
+                                    case "x${target_cpu}" in
               xi386 | xi486) ;;
             *)
 
@@ -16178,6 +16323,11 @@ cat >>confdefs.h <<_ACEOF
 _ACEOF
 
 
+cat >>confdefs.h <<_ACEOF
+#define TARGET_CPU "$target_cpu"
+_ACEOF
+
+
 
  { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether byte ordering is bigendian" >&5
 $as_echo_n "checking whether byte ordering is bigendian... " >&6; }
@@ -16427,7 +16577,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -16467,7 +16617,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -16520,7 +16670,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}cc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -16561,7 +16711,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
@@ -16619,7 +16769,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -16663,7 +16813,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -16859,8 +17009,7 @@ cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
+struct stat;
 /* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
 struct buf { int x; };
 FILE * (*rcsopen) (struct buf *, struct stat *, int);
@@ -16956,8 +17105,8 @@ else
   # We make a subdir and do the tests there.  Otherwise we can end up
   # making bogus files that we don't know about and never remove.  For
   # instance it was reported that on HP-UX the gcc test will end up
-  # making a dummy file named `D' -- because `-MD' means `put the output
-  # in D'.
+  # making a dummy file named 'D' -- because '-MD' means "put the output
+  # in D".
   rm -rf conftest.dir
   mkdir conftest.dir
   # Copy depcomp to subdir because otherwise we won't find it if we're
@@ -16992,16 +17141,16 @@ else
     : > sub/conftest.c
     for i in 1 2 3 4 5 6; do
       echo '#include "conftst'$i'.h"' >> sub/conftest.c
-      # Using `: > sub/conftst$i.h' creates only sub/conftst1.h with
-      # Solaris 8's {/usr,}/bin/sh.
-      touch sub/conftst$i.h
+      # Using ": > sub/conftst$i.h" creates only sub/conftst1.h with
+      # Solaris 10 /bin/sh.
+      echo '/* dummy */' > sub/conftst$i.h
     done
     echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
 
-    # We check with `-c' and `-o' for the sake of the "dashmstdout"
+    # We check with '-c' and '-o' for the sake of the "dashmstdout"
     # mode.  It turns out that the SunPro C++ compiler does not properly
-    # handle `-M -o', and we need to detect this.  Also, some Intel
-    # versions had trouble with output in subdirs
+    # handle '-M -o', and we need to detect this.  Also, some Intel
+    # versions had trouble with output in subdirs.
     am__obj=sub/conftest.${OBJEXT-o}
     am__minus_obj="-o $am__obj"
     case $depmode in
@@ -17010,8 +17159,8 @@ else
       test "$am__universal" = false || continue
       ;;
     nosideeffect)
-      # after this tag, mechanisms are not by side-effect, so they'll
-      # only be used when explicitly requested
+      # After this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested.
       if test "x$enable_dependency_tracking" = xyes; then
 	continue
       else
@@ -17019,7 +17168,7 @@ else
       fi
       ;;
     msvc7 | msvc7msys | msvisualcpp | msvcmsys)
-      # This compiler won't grok `-c -o', but also, the minuso test has
+      # This compiler won't grok '-c -o', but also, the minuso test has
       # not run yet.  These depmodes are late enough in the game, and
       # so weak that their functioning should not be impacted.
       am__obj=conftest.${OBJEXT-o}
@@ -17223,7 +17372,7 @@ main ()
   return 0;
 }
 _ACEOF
-for ac_arg in '' -std=gnu99 -std=c99 -c99 -AC99 -xc99=all -qlanglvl=extc99
+for ac_arg in '' -std=gnu99 -std=c99 -c99 -AC99 -D_STDC_C99= -qlanglvl=extc99
 do
   CC="$ac_save_CC $ac_arg"
   if ac_fn_c_try_compile "$LINENO"; then :
@@ -17263,8 +17412,7 @@ cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
+struct stat;
 /* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
 struct buf { int x; };
 FILE * (*rcsopen) (struct buf *, struct stat *, int);
@@ -17395,7 +17543,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CXX="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -17439,7 +17587,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CXX="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -17635,8 +17783,8 @@ else
   # We make a subdir and do the tests there.  Otherwise we can end up
   # making bogus files that we don't know about and never remove.  For
   # instance it was reported that on HP-UX the gcc test will end up
-  # making a dummy file named `D' -- because `-MD' means `put the output
-  # in D'.
+  # making a dummy file named 'D' -- because '-MD' means "put the output
+  # in D".
   rm -rf conftest.dir
   mkdir conftest.dir
   # Copy depcomp to subdir because otherwise we won't find it if we're
@@ -17671,16 +17819,16 @@ else
     : > sub/conftest.c
     for i in 1 2 3 4 5 6; do
       echo '#include "conftst'$i'.h"' >> sub/conftest.c
-      # Using `: > sub/conftst$i.h' creates only sub/conftst1.h with
-      # Solaris 8's {/usr,}/bin/sh.
-      touch sub/conftst$i.h
+      # Using ": > sub/conftst$i.h" creates only sub/conftst1.h with
+      # Solaris 10 /bin/sh.
+      echo '/* dummy */' > sub/conftst$i.h
     done
     echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
 
-    # We check with `-c' and `-o' for the sake of the "dashmstdout"
+    # We check with '-c' and '-o' for the sake of the "dashmstdout"
     # mode.  It turns out that the SunPro C++ compiler does not properly
-    # handle `-M -o', and we need to detect this.  Also, some Intel
-    # versions had trouble with output in subdirs
+    # handle '-M -o', and we need to detect this.  Also, some Intel
+    # versions had trouble with output in subdirs.
     am__obj=sub/conftest.${OBJEXT-o}
     am__minus_obj="-o $am__obj"
     case $depmode in
@@ -17689,8 +17837,8 @@ else
       test "$am__universal" = false || continue
       ;;
     nosideeffect)
-      # after this tag, mechanisms are not by side-effect, so they'll
-      # only be used when explicitly requested
+      # After this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested.
       if test "x$enable_dependency_tracking" = xyes; then
 	continue
       else
@@ -17698,7 +17846,7 @@ else
       fi
       ;;
     msvc7 | msvc7msys | msvisualcpp | msvcmsys)
-      # This compiler won't grok `-c -o', but also, the minuso test has
+      # This compiler won't grok '-c -o', but also, the minuso test has
       # not run yet.  These depmodes are late enough in the game, and
       # so weak that their functioning should not be impacted.
       am__obj=conftest.${OBJEXT-o}
@@ -18141,8 +18289,13 @@ with_gnu_ld=$lt_cv_prog_gnu_ld
       # Check if GNU C++ uses GNU ld as the underlying linker, since the
       # archiving commands below assume that GNU ld is being used.
       if test "$with_gnu_ld" = yes; then
-        archive_cmds_CXX='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
-        archive_expsym_cmds_CXX='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+        if test "$cross_compiling" = yes; then
+          archive_cmds_CXX='$CC $pic_flag $compiler_flags -shared $libobjs $deplibs ${wl}-soname $wl$soname -o $lib'
+          archive_expsym_cmds_CXX='$CC $pic_flag $compiler_flags -shared $libobjs $deplibs ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+        else
+          archive_cmds_CXX='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
+          archive_expsym_cmds_CXX='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+        fi
 
         hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
         export_dynamic_flag_spec_CXX='${wl}--export-dynamic'
@@ -19262,23 +19415,27 @@ if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
        if test "$pre_test_object_deps_done" = no; then
 	 case ${prev} in
 	 -L | -R)
-	   # Internal compiler library paths should come after those
-	   # provided the user.  The postdeps already come after the
-	   # user supplied libs so there is no need to process them.
-	   if test -z "$compiler_lib_search_path_CXX"; then
-	     compiler_lib_search_path_CXX="${prev}${p}"
-	   else
-	     compiler_lib_search_path_CXX="${compiler_lib_search_path_CXX} ${prev}${p}"
+	   if test "$cross_compiling" != yes; then
+	     # Internal compiler library paths should come after those
+	     # provided the user.  The postdeps already come after the
+	     # user supplied libs so there is no need to process them.
+	     if test -z "$compiler_lib_search_path_CXX"; then
+	       compiler_lib_search_path_CXX="${prev}${p}"
+	     else
+	       compiler_lib_search_path_CXX="${compiler_lib_search_path_CXX} ${prev}${p}"
+	     fi
 	   fi
 	   ;;
 	 # The "-l" case would never come before the object being
 	 # linked, so don't bother handling this case.
 	 esac
        else
-	 if test -z "$postdeps_CXX"; then
-	   postdeps_CXX="${prev}${p}"
-	 else
-	   postdeps_CXX="${postdeps_CXX} ${prev}${p}"
+	 if test "$cross_compiling" != yes; then
+	   if test -z "$postdeps_CXX"; then
+	     postdeps_CXX="${prev}${p}"
+	   else
+	     postdeps_CXX="${postdeps_CXX} ${prev}${p}"
+	   fi
 	 fi
        fi
        prev=
@@ -19293,17 +19450,19 @@ if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
 	 continue
        fi
 
-       if test "$pre_test_object_deps_done" = no; then
-	 if test -z "$predep_objects_CXX"; then
-	   predep_objects_CXX="$p"
-	 else
-	   predep_objects_CXX="$predep_objects_CXX $p"
-	 fi
-       else
-	 if test -z "$postdep_objects_CXX"; then
-	   postdep_objects_CXX="$p"
+       if test "$cross_compiling" != yes; then
+	 if test "$pre_test_object_deps_done" = no; then
+	   if test -z "$predep_objects_CXX"; then
+	     predep_objects_CXX="$p"
+	   else
+	     predep_objects_CXX="$predep_objects_CXX $p"
+	   fi
 	 else
-	   postdep_objects_CXX="$postdep_objects_CXX $p"
+	   if test -z "$postdep_objects_CXX"; then
+	     postdep_objects_CXX="$p"
+	   else
+	     postdep_objects_CXX="$postdep_objects_CXX $p"
+	   fi
 	 fi
        fi
        ;;
@@ -19649,7 +19808,7 @@ lt_prog_compiler_static_CXX=
 	    ;;
 	esac
 	;;
-      netbsd* | netbsdelf*-gnu)
+      netbsd*)
 	;;
       *qnx* | *nto*)
         # QNX uses GNU C++, but need to define -shared option too, otherwise
@@ -20020,9 +20179,6 @@ $as_echo_n "checking whether the $compiler linker ($LD) supports shared librarie
       ;;
     esac
     ;;
-  linux* | k*bsd*-gnu | gnu*)
-    link_all_deplibs_CXX=no
-    ;;
   *)
     export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
     ;;
@@ -20648,18 +20804,6 @@ fi
   dynamic_linker='GNU/Linux ld.so'
   ;;
 
-netbsdelf*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='NetBSD ld.elf_so'
-  ;;
-
 netbsd*)
   version_type=sunos
   need_lib_prefix=no
@@ -20982,7 +21126,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_HAVE_CXX="yes"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -21139,9 +21283,13 @@ ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $
 ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
-
+ac_ext=m
+ac_cpp='$OBJCPP $CPPFLAGS'
+ac_compile='$OBJC -c $OBJCFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$OBJC -o conftest$ac_exeext $OBJCFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_objc_compiler_gnu
 if test -n "$ac_tool_prefix"; then
-  for ac_prog in objcc objc gcc cc CC
+  for ac_prog in gcc objcc objc cc CC
   do
     # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
 set dummy $ac_tool_prefix$ac_prog; ac_word=$2
@@ -21159,7 +21307,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OBJC="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -21185,7 +21333,7 @@ fi
 fi
 if test -z "$OBJC"; then
   ac_ct_OBJC=$OBJC
-  for ac_prog in objcc objc gcc cc CC
+  for ac_prog in gcc objcc objc cc CC
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
@@ -21203,7 +21351,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OBJC="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -21228,7 +21376,7 @@ fi
 done
 
   if test "x$ac_ct_OBJC" = x; then
-    OBJC="none"
+    OBJC="gcc"
   else
     case $cross_compiling:$ac_tool_warned in
 yes:)
@@ -21240,175 +21388,151 @@ esac
   fi
 fi
 
+# Provide some information about the compiler.
+$as_echo "$as_me:${as_lineno-$LINENO}: checking for Objective C compiler version" >&5
+set X $ac_compile
+ac_compiler=$2
+for ac_option in --version -v -V -qversion; do
+  { { ac_try="$ac_compiler $ac_option >&5"
+case "(($ac_try" in
+  *\"* | *\`* | *\\*) ac_try_echo=\$ac_try;;
+  *) ac_try_echo=$ac_try;;
+esac
+eval ac_try_echo="\"\$as_me:${as_lineno-$LINENO}: $ac_try_echo\""
+$as_echo "$ac_try_echo"; } >&5
+  (eval "$ac_compiler $ac_option >&5") 2>conftest.err
+  ac_status=$?
+  if test -s conftest.err; then
+    sed '10a\
+... rest of stderr output deleted ...
+         10q' conftest.err >conftest.er1
+    cat conftest.er1 >&5
+  fi
+  rm -f conftest.er1 conftest.err
+  $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
+  test $ac_status = 0; }
+done
 
-OBJC_LDFLAGS="-lobjc"
-
-if test "x$OBJC" != xnone ; then
-
-depcc="$OBJC" am_compiler_list='gcc3 gcc'
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking dependency style of $depcc" >&5
-$as_echo_n "checking dependency style of $depcc... " >&6; }
-if ${am_cv_OBJC_dependencies_compiler_type+:} false; then :
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether we are using the GNU Objective C compiler" >&5
+$as_echo_n "checking whether we are using the GNU Objective C compiler... " >&6; }
+if ${ac_cv_objc_compiler_gnu+:} false; then :
   $as_echo_n "(cached) " >&6
 else
-  if test -z "$AMDEP_TRUE" && test -f "$am_depcomp"; then
-  # We make a subdir and do the tests there.  Otherwise we can end up
-  # making bogus files that we don't know about and never remove.  For
-  # instance it was reported that on HP-UX the gcc test will end up
-  # making a dummy file named `D' -- because `-MD' means `put the output
-  # in D'.
-  rm -rf conftest.dir
-  mkdir conftest.dir
-  # Copy depcomp to subdir because otherwise we won't find it if we're
-  # using a relative directory.
-  cp "$am_depcomp" conftest.dir
-  cd conftest.dir
-  # We will build objects and dependencies in a subdirectory because
-  # it helps to detect inapplicable dependency modes.  For instance
-  # both Tru64's cc and ICC support -MD to output dependencies as a
-  # side effect of compilation, but ICC will put the dependencies in
-  # the current directory while Tru64 will put them in the object
-  # directory.
-  mkdir sub
-
-  am_cv_OBJC_dependencies_compiler_type=none
-  if test "$am_compiler_list" = ""; then
-     am_compiler_list=`sed -n 's/^#*\([a-zA-Z0-9]*\))$/\1/p' < ./depcomp`
-  fi
-  am__universal=false
-
-
-  for depmode in $am_compiler_list; do
-    # Setup a source with many dependencies, because some compilers
-    # like to wrap large dependency lists on column 80 (with \), and
-    # we should not choose a depcomp mode which is confused by this.
-    #
-    # We need to recreate these files for each test, as the compiler may
-    # overwrite some of them when testing with obscure command lines.
-    # This happens at least with the AIX C compiler.
-    : > sub/conftest.c
-    for i in 1 2 3 4 5 6; do
-      echo '#include "conftst'$i'.h"' >> sub/conftest.c
-      # Using `: > sub/conftst$i.h' creates only sub/conftst1.h with
-      # Solaris 8's {/usr,}/bin/sh.
-      touch sub/conftst$i.h
-    done
-    echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-    # We check with `-c' and `-o' for the sake of the "dashmstdout"
-    # mode.  It turns out that the SunPro C++ compiler does not properly
-    # handle `-M -o', and we need to detect this.  Also, some Intel
-    # versions had trouble with output in subdirs
-    am__obj=sub/conftest.${OBJEXT-o}
-    am__minus_obj="-o $am__obj"
-    case $depmode in
-    gcc)
-      # This depmode causes a compiler race in universal mode.
-      test "$am__universal" = false || continue
-      ;;
-    nosideeffect)
-      # after this tag, mechanisms are not by side-effect, so they'll
-      # only be used when explicitly requested
-      if test "x$enable_dependency_tracking" = xyes; then
-	continue
-      else
-	break
-      fi
-      ;;
-    msvc7 | msvc7msys | msvisualcpp | msvcmsys)
-      # This compiler won't grok `-c -o', but also, the minuso test has
-      # not run yet.  These depmodes are late enough in the game, and
-      # so weak that their functioning should not be impacted.
-      am__obj=conftest.${OBJEXT-o}
-      am__minus_obj=
-      ;;
-    none) break ;;
-    esac
-    if depmode=$depmode \
-       source=sub/conftest.c object=$am__obj \
-       depfile=sub/conftest.Po tmpdepfile=sub/conftest.TPo \
-       $SHELL ./depcomp $depcc -c $am__minus_obj sub/conftest.c \
-         >/dev/null 2>conftest.err &&
-       grep sub/conftst1.h sub/conftest.Po > /dev/null 2>&1 &&
-       grep sub/conftst6.h sub/conftest.Po > /dev/null 2>&1 &&
-       grep $am__obj sub/conftest.Po > /dev/null 2>&1 &&
-       ${MAKE-make} -s -f confmf > /dev/null 2>&1; then
-      # icc doesn't choke on unknown options, it will just issue warnings
-      # or remarks (even with -Werror).  So we grep stderr for any message
-      # that says an option was ignored or not supported.
-      # When given -MP, icc 7.0 and 7.1 complain thusly:
-      #   icc: Command line warning: ignoring option '-M'; no argument required
-      # The diagnosis changed in icc 8.0:
-      #   icc: Command line remark: option '-MP' not supported
-      if (grep 'ignoring option' conftest.err ||
-          grep 'not supported' conftest.err) >/dev/null 2>&1; then :; else
-        am_cv_OBJC_dependencies_compiler_type=$depmode
-        break
-      fi
-    fi
-  done
+int
+main ()
+{
+#ifndef __GNUC__
+       choke me
+#endif
 
-  cd ..
-  rm -rf conftest.dir
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_objc_try_compile "$LINENO"; then :
+  ac_compiler_gnu=yes
 else
-  am_cv_OBJC_dependencies_compiler_type=none
+  ac_compiler_gnu=no
 fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+ac_cv_objc_compiler_gnu=$ac_compiler_gnu
 
 fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $am_cv_OBJC_dependencies_compiler_type" >&5
-$as_echo "$am_cv_OBJC_dependencies_compiler_type" >&6; }
-OBJCDEPMODE=depmode=$am_cv_OBJC_dependencies_compiler_type
-
- if
-  test "x$enable_dependency_tracking" != xno \
-  && test "$am_cv_OBJC_dependencies_compiler_type" = gcc3; then
-  am__fastdepOBJC_TRUE=
-  am__fastdepOBJC_FALSE='#'
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_objc_compiler_gnu" >&5
+$as_echo "$ac_cv_objc_compiler_gnu" >&6; }
+if test $ac_compiler_gnu = yes; then
+  GOBJC=yes
 else
-  am__fastdepOBJC_TRUE='#'
-  am__fastdepOBJC_FALSE=
+  GOBJC=
 fi
+ac_test_OBJCFLAGS=${OBJCFLAGS+set}
+ac_save_OBJCFLAGS=$OBJCFLAGS
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $OBJC accepts -g" >&5
+$as_echo_n "checking whether $OBJC accepts -g... " >&6; }
+if ${ac_cv_prog_objc_g+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_save_objc_werror_flag=$ac_objc_werror_flag
+   ac_objc_werror_flag=yes
+   ac_cv_prog_objc_g=no
+   OBJCFLAGS="-g"
+   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking if Objective C compiler works" >&5
-$as_echo_n "checking if Objective C compiler works... " >&6; }
-  cat >>conftest.m <<EOF
-#include <objc/Object.h>
-@interface Moo:Object
+int
+main ()
 {
+
+  ;
+  return 0;
 }
-- moo;
-int main();
-@end
+_ACEOF
+if ac_fn_objc_try_compile "$LINENO"; then :
+  ac_cv_prog_objc_g=yes
+else
+  OBJCFLAGS=""
+      cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
 
-@implementation Moo
-- moo
+int
+main ()
 {
-  exit(0);
+
+  ;
+  return 0;
 }
+_ACEOF
+if ac_fn_objc_try_compile "$LINENO"; then :
 
-int main()
+else
+  ac_objc_werror_flag=$ac_save_objc_werror_flag
+	 OBJCFLAGS="-g"
+	 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
 {
-  id moo;
-  moo = [Moo new];
-  [moo moo];
-  return 1;
+
+  ;
+  return 0;
 }
-@end
-EOF
-  ${OBJC} conftest.m ${OBJC_LDFLAGS} >&5 2>&5
-  if test -f a.out -o -f a.exe ; then
-    result=yes
+_ACEOF
+if ac_fn_objc_try_compile "$LINENO"; then :
+  ac_cv_prog_objc_g=yes
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+   ac_objc_werror_flag=$ac_save_objc_werror_flag
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_prog_objc_g" >&5
+$as_echo "$ac_cv_prog_objc_g" >&6; }
+if test "$ac_test_OBJCFLAGS" = set; then
+  OBJCFLAGS=$ac_save_OBJCFLAGS
+elif test $ac_cv_prog_objc_g = yes; then
+  if test "$GOBJC" = yes; then
+    OBJCFLAGS="-g -O2"
   else
-    result=no
-    echo failed program is: >&5
-    cat conftest.m >&5
+    OBJCFLAGS="-g"
   fi
-  rm -f conftest.m a.out a.exe
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $result" >&5
-$as_echo "$result" >&6; }
 else
+  if test "$GOBJC" = yes; then
+    OBJCFLAGS="-O2"
+  else
+    OBJCFLAGS=
+  fi
+fi
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 depcc="$OBJC" am_compiler_list='gcc3 gcc'
 
@@ -21421,8 +21545,8 @@ else
   # We make a subdir and do the tests there.  Otherwise we can end up
   # making bogus files that we don't know about and never remove.  For
   # instance it was reported that on HP-UX the gcc test will end up
-  # making a dummy file named `D' -- because `-MD' means `put the output
-  # in D'.
+  # making a dummy file named 'D' -- because '-MD' means "put the output
+  # in D".
   rm -rf conftest.dir
   mkdir conftest.dir
   # Copy depcomp to subdir because otherwise we won't find it if we're
@@ -21455,16 +21579,16 @@ else
     : > sub/conftest.c
     for i in 1 2 3 4 5 6; do
       echo '#include "conftst'$i'.h"' >> sub/conftest.c
-      # Using `: > sub/conftst$i.h' creates only sub/conftst1.h with
-      # Solaris 8's {/usr,}/bin/sh.
-      touch sub/conftst$i.h
+      # Using ": > sub/conftst$i.h" creates only sub/conftst1.h with
+      # Solaris 10 /bin/sh.
+      echo '/* dummy */' > sub/conftst$i.h
     done
     echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
 
-    # We check with `-c' and `-o' for the sake of the "dashmstdout"
+    # We check with '-c' and '-o' for the sake of the "dashmstdout"
     # mode.  It turns out that the SunPro C++ compiler does not properly
-    # handle `-M -o', and we need to detect this.  Also, some Intel
-    # versions had trouble with output in subdirs
+    # handle '-M -o', and we need to detect this.  Also, some Intel
+    # versions had trouble with output in subdirs.
     am__obj=sub/conftest.${OBJEXT-o}
     am__minus_obj="-o $am__obj"
     case $depmode in
@@ -21473,8 +21597,8 @@ else
       test "$am__universal" = false || continue
       ;;
     nosideeffect)
-      # after this tag, mechanisms are not by side-effect, so they'll
-      # only be used when explicitly requested
+      # After this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested.
       if test "x$enable_dependency_tracking" = xyes; then
 	continue
       else
@@ -21482,7 +21606,7 @@ else
       fi
       ;;
     msvc7 | msvc7msys | msvisualcpp | msvcmsys)
-      # This compiler won't grok `-c -o', but also, the minuso test has
+      # This compiler won't grok '-c -o', but also, the minuso test has
       # not run yet.  These depmodes are late enough in the game, and
       # so weak that their functioning should not be impacted.
       am__obj=conftest.${OBJEXT-o}
@@ -21536,9 +21660,6 @@ else
 fi
 
 
-fi
-
-
 
 if test "x$CC" != xcc; then
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $CC and cc understand -c and -o together" >&5
@@ -21685,8 +21806,8 @@ else
   # We make a subdir and do the tests there.  Otherwise we can end up
   # making bogus files that we don't know about and never remove.  For
   # instance it was reported that on HP-UX the gcc test will end up
-  # making a dummy file named `D' -- because `-MD' means `put the output
-  # in D'.
+  # making a dummy file named 'D' -- because '-MD' means "put the output
+  # in D".
   rm -rf conftest.dir
   mkdir conftest.dir
   # Copy depcomp to subdir because otherwise we won't find it if we're
@@ -21719,16 +21840,16 @@ else
     : > sub/conftest.c
     for i in 1 2 3 4 5 6; do
       echo '#include "conftst'$i'.h"' >> sub/conftest.c
-      # Using `: > sub/conftst$i.h' creates only sub/conftst1.h with
-      # Solaris 8's {/usr,}/bin/sh.
-      touch sub/conftst$i.h
+      # Using ": > sub/conftst$i.h" creates only sub/conftst1.h with
+      # Solaris 10 /bin/sh.
+      echo '/* dummy */' > sub/conftst$i.h
     done
     echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
 
-    # We check with `-c' and `-o' for the sake of the "dashmstdout"
+    # We check with '-c' and '-o' for the sake of the "dashmstdout"
     # mode.  It turns out that the SunPro C++ compiler does not properly
-    # handle `-M -o', and we need to detect this.  Also, some Intel
-    # versions had trouble with output in subdirs
+    # handle '-M -o', and we need to detect this.  Also, some Intel
+    # versions had trouble with output in subdirs.
     am__obj=sub/conftest.${OBJEXT-o}
     am__minus_obj="-o $am__obj"
     case $depmode in
@@ -21737,8 +21858,8 @@ else
       test "$am__universal" = false || continue
       ;;
     nosideeffect)
-      # after this tag, mechanisms are not by side-effect, so they'll
-      # only be used when explicitly requested
+      # After this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested.
       if test "x$enable_dependency_tracking" = xyes; then
 	continue
       else
@@ -21746,7 +21867,7 @@ else
       fi
       ;;
     msvc7 | msvc7msys | msvisualcpp | msvcmsys)
-      # This compiler won't grok `-c -o', but also, the minuso test has
+      # This compiler won't grok '-c -o', but also, the minuso test has
       # not run yet.  These depmodes are late enough in the game, and
       # so weak that their functioning should not be impacted.
       am__obj=conftest.${OBJEXT-o}
@@ -21859,7 +21980,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_VALGRIND_PATH="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -21999,7 +22120,7 @@ do
     for ac_prog in sed gsed; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_SED="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_SED" && $as_test_x "$ac_path_SED"; } || continue
+      as_fn_executable_p "$ac_path_SED" || continue
 # Check for GNU ac_path_SED and select it if it is found.
   # Check for GNU $ac_path_SED
 case `"$ac_path_SED" --version 2>&1` in
@@ -22074,7 +22195,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_GTKDOC_CHECK="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -22156,7 +22277,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_PYTHON="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -23556,9 +23677,6 @@ fi
 
         GLIB_EXTRA_CFLAGS="$GLIB_EXTRA_CFLAGS -DG_THREADS_MANDATORY"
 
-    if test "x$PACKAGE_VERSION_NANO" = "x1"; then
-    GLIB_EXTRA_CFLAGS="$GLIB_EXTRA_CFLAGS -DG_DISABLE_DEPRECATED"
-  fi
 
   # Check whether --enable-gobject-cast-checks was given.
 if test "${enable_gobject_cast_checks+set}" = set; then :
@@ -24757,7 +24875,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_GCONFTOOL="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -24959,7 +25077,6 @@ _ACEOF
   fi
 
 
-if test "x$HAVE_OSX_VIDEO" != "xyes"; then
 
 
 
@@ -25115,7 +25232,7 @@ rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 $as_echo "$flag_ok" >&6; }
 
 
-    if test "x$GST_GIT" != "xno"
+    if test "x$FATAL_WARNINGS" != "xno"
   then
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if compiler understands -Werror" >&5
@@ -25289,17 +25406,17 @@ fi
   fi
 
   if test "x
-        -Wmissing-declarations -Wmissing-prototypes -Wredundant-decls
-        -Wwrite-strings -Wold-style-definition -Waggregate-return
-        -Winit-self -Wmissing-include-dirs -Waddress -Wno-multichar
-        -Wnested-externs " != "x"
+      -Wmissing-declarations -Wmissing-prototypes -Wredundant-decls
+      -Wwrite-strings -Wold-style-definition -Waggregate-return
+      -Winit-self -Wmissing-include-dirs -Waddress -Wno-multichar
+      -Wnested-externs" != "x"
   then
     UNSUPPORTED=""
     list="
-        -Wmissing-declarations -Wmissing-prototypes -Wredundant-decls
-        -Wwrite-strings -Wold-style-definition -Waggregate-return
-        -Winit-self -Wmissing-include-dirs -Waddress -Wno-multichar
-        -Wnested-externs "
+      -Wmissing-declarations -Wmissing-prototypes -Wredundant-decls
+      -Wwrite-strings -Wold-style-definition -Waggregate-return
+      -Winit-self -Wmissing-include-dirs -Waddress -Wno-multichar
+      -Wnested-externs"
     for each in $list
     do
 
@@ -25352,20 +25469,22 @@ $as_echo "$as_me: set WARNING_CFLAGS to $WARNING_CFLAGS" >&6;}
   { $as_echo "$as_me:${as_lineno-$LINENO}: set ERROR_CFLAGS to $ERROR_CFLAGS" >&5
 $as_echo "$as_me: set ERROR_CFLAGS to $ERROR_CFLAGS" >&6;}
 
-else
 
 
 
 
-  WARNING_CFLAGS=""
-  ERROR_CFLAGS=""
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands " >&5
+$as_echo_n "checking to see if c++ compiler understands ... " >&6; }
 
+  save_CPPFLAGS="$CPPFLAGS"
+  CPPFLAGS="$CPPFLAGS "
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if compiler understands -Wall" >&5
-$as_echo_n "checking to see if compiler understands -Wall... " >&6; }
+  ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
 
-  save_CFLAGS="$CFLAGS"
-  CFLAGS="$CFLAGS -Wall"
 
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
@@ -25378,68 +25497,54 @@ main ()
   return 0;
 }
 _ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
+if ac_fn_cxx_try_compile "$LINENO"; then :
   flag_ok=yes
 else
   flag_ok=no
 fi
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  CFLAGS="$save_CFLAGS"
+  CPPFLAGS="$save_CPPFLAGS"
 
   if test "X$flag_ok" = Xyes ; then
-    WARNING_CFLAGS="$WARNING_CFLAGS -Wall"
+
     true
   else
 
     true
   fi
+
+  ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $flag_ok" >&5
 $as_echo "$flag_ok" >&6; }
 
 
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if compiler understands -Wdeclaration-after-statement" >&5
-$as_echo_n "checking to see if compiler understands -Wdeclaration-after-statement... " >&6; }
-
-  save_CFLAGS="$CFLAGS"
-  CFLAGS="$CFLAGS -Wdeclaration-after-statement"
 
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
 
-int
-main ()
-{
+  ERROR_CXXFLAGS=""
+  WARNING_CXXFLAGS=""
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  flag_ok=yes
-else
-  flag_ok=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  CFLAGS="$save_CFLAGS"
 
-  if test "X$flag_ok" = Xyes ; then
-    WARNING_CFLAGS="$WARNING_CFLAGS -Wdeclaration-after-statement"
-    true
-  else
 
-    true
-  fi
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $flag_ok" >&5
-$as_echo "$flag_ok" >&6; }
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands -Wall" >&5
+$as_echo_n "checking to see if c++ compiler understands -Wall... " >&6; }
 
+  save_CPPFLAGS="$CPPFLAGS"
+  CPPFLAGS="$CPPFLAGS -Wall"
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if compiler understands -Wvla" >&5
-$as_echo_n "checking to see if compiler understands -Wvla... " >&6; }
+  ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
 
-  save_CFLAGS="$CFLAGS"
-  CFLAGS="$CFLAGS -Wvla"
 
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
@@ -25452,70 +25557,50 @@ main ()
   return 0;
 }
 _ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
+if ac_fn_cxx_try_compile "$LINENO"; then :
   flag_ok=yes
 else
   flag_ok=no
 fi
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  CFLAGS="$save_CFLAGS"
+  CPPFLAGS="$save_CPPFLAGS"
 
   if test "X$flag_ok" = Xyes ; then
-    WARNING_CFLAGS="$WARNING_CFLAGS -Wvla"
+    WARNING_CXXFLAGS="$WARNING_CXXFLAGS -Wall"
     true
   else
 
     true
   fi
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $flag_ok" >&5
-$as_echo "$flag_ok" >&6; }
-
 
+  ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if compiler understands -Wpointer-arith" >&5
-$as_echo_n "checking to see if compiler understands -Wpointer-arith... " >&6; }
 
-  save_CFLAGS="$CFLAGS"
-  CFLAGS="$CFLAGS -Wpointer-arith"
-
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $flag_ok" >&5
+$as_echo "$flag_ok" >&6; }
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  flag_ok=yes
-else
-  flag_ok=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  CFLAGS="$save_CFLAGS"
+    if test "x$FATAL_WARNINGS" != "xno"
+  then
 
-  if test "X$flag_ok" = Xyes ; then
-    WARNING_CFLAGS="$WARNING_CFLAGS -Wpointer-arith"
-    true
-  else
 
-    true
-  fi
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $flag_ok" >&5
-$as_echo "$flag_ok" >&6; }
 
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands -Werror" >&5
+$as_echo_n "checking to see if c++ compiler understands -Werror... " >&6; }
 
-    if test "x$GST_GIT" != "xno"
-  then
+  save_CPPFLAGS="$CPPFLAGS"
+  CPPFLAGS="$CPPFLAGS -Werror"
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if compiler understands -Werror" >&5
-$as_echo_n "checking to see if compiler understands -Werror... " >&6; }
+  ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
 
-  save_CFLAGS="$CFLAGS"
-  CFLAGS="$CFLAGS -Werror"
 
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
@@ -25528,68 +25613,50 @@ main ()
   return 0;
 }
 _ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
+if ac_fn_cxx_try_compile "$LINENO"; then :
   flag_ok=yes
 else
   flag_ok=no
 fi
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  CFLAGS="$save_CFLAGS"
+  CPPFLAGS="$save_CPPFLAGS"
 
   if test "X$flag_ok" = Xyes ; then
-    ERROR_CFLAGS="$ERROR_CFLAGS -Werror"
+    ERROR_CXXFLAGS="$ERROR_CXXFLAGS -Werror"
     true
   else
 
     true
   fi
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $flag_ok" >&5
-$as_echo "$flag_ok" >&6; }
 
+  ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-        if test "x$ERROR_CFLAGS" = "x"
-    then
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if compiler understands -errwarn=%all" >&5
-$as_echo_n "checking to see if compiler understands -errwarn=%all... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $flag_ok" >&5
+$as_echo "$flag_ok" >&6; }
 
-  save_CFLAGS="$CFLAGS"
-  CFLAGS="$CFLAGS -errwarn=%all"
 
-  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
-/* end confdefs.h.  */
+    if test "x$ERROR_CXXFLAGS" != "x"
+    then
 
-int
-main ()
-{
 
-  ;
-  return 0;
-}
-_ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
-  flag_ok=yes
-else
-  flag_ok=no
-fi
-rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  CFLAGS="$save_CFLAGS"
 
-  if test "X$flag_ok" = Xyes ; then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands -Wno-non-virtual-dtor" >&5
+$as_echo_n "checking to see if c++ compiler understands -Wno-non-virtual-dtor... " >&6; }
 
-          ERROR_CFLAGS="-errwarn=%all"
-                                                                                for f in 'no%E_EMPTY_DECLARATION' \
-                   'no%E_STATEMENT_NOT_REACHED' \
-                   'no%E_ARGUEMENT_MISMATCH' \
-                   'no%E_MACRO_REDEFINED' \
-                   'no%E_LOOP_NOT_ENTERED_AT_TOP'
-          do
+  save_CPPFLAGS="$CPPFLAGS"
+  CPPFLAGS="$CPPFLAGS -Wno-non-virtual-dtor"
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if compiler understands -errwarn=%all,$f" >&5
-$as_echo_n "checking to see if compiler understands -errwarn=%all,$f... " >&6; }
+  ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
 
-  save_CFLAGS="$CFLAGS"
-  CFLAGS="$CFLAGS -errwarn=%all,$f"
 
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
@@ -25602,38 +25669,34 @@ main ()
   return 0;
 }
 _ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
+if ac_fn_cxx_try_compile "$LINENO"; then :
   flag_ok=yes
 else
   flag_ok=no
 fi
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  CFLAGS="$save_CFLAGS"
+  CPPFLAGS="$save_CPPFLAGS"
 
   if test "X$flag_ok" = Xyes ; then
-
-              ERROR_CFLAGS="$ERROR_CFLAGS,$f"
-
+    ERROR_CXXFLAGS="$ERROR_CXXFLAGS -Wno-non-virtual-dtor"
     true
   else
 
     true
   fi
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $flag_ok" >&5
-$as_echo "$flag_ok" >&6; }
 
-          done
+  ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-    true
-  else
 
-    true
-  fi
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $flag_ok" >&5
 $as_echo "$flag_ok" >&6; }
 
-    else
-                        if test -n "$PKG_CONFIG" && \
+
+				if test -n "$PKG_CONFIG" && \
     { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"glib-2.0 < 2.19.8\""; } >&5
   ($PKG_CONFIG --exists --print-errors "glib-2.0 < 2.19.8") 2>&5
   ac_status=$?
@@ -25641,11 +25704,20 @@ $as_echo "$flag_ok" >&6; }
   test $ac_status = 0; }; then
 
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if compiler understands -fno-strict-aliasing" >&5
-$as_echo_n "checking to see if compiler understands -fno-strict-aliasing... " >&6; }
 
-  save_CFLAGS="$CFLAGS"
-  CFLAGS="$CFLAGS -fno-strict-aliasing"
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands -fno-strict-aliasing" >&5
+$as_echo_n "checking to see if c++ compiler understands -fno-strict-aliasing... " >&6; }
+
+  save_CPPFLAGS="$CPPFLAGS"
+  CPPFLAGS="$CPPFLAGS -fno-strict-aliasing"
+
+  ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
 
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
@@ -25658,49 +25730,50 @@ main ()
   return 0;
 }
 _ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
+if ac_fn_cxx_try_compile "$LINENO"; then :
   flag_ok=yes
 else
   flag_ok=no
 fi
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  CFLAGS="$save_CFLAGS"
+  CPPFLAGS="$save_CPPFLAGS"
 
   if test "X$flag_ok" = Xyes ; then
-    ERROR_CFLAGS="$ERROR_CFLAGS -fno-strict-aliasing"
+    ERROR_CXXFLAGS="$ERROR_CXXFLAGS -fno-strict-aliasing"
     true
   else
 
     true
   fi
+
+  ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $flag_ok" >&5
 $as_echo "$flag_ok" >&6; }
 
 
 fi
-    fi
-  fi
+    else
 
-  if test "x
-        -Wmissing-declarations -Wmissing-prototypes -Wredundant-decls
-        -Wwrite-strings -Wold-style-definition
-        -Winit-self -Wmissing-include-dirs -Wno-multichar
-        -Wnested-externs " != "x"
-  then
-    UNSUPPORTED=""
-    list="
-        -Wmissing-declarations -Wmissing-prototypes -Wredundant-decls
-        -Wwrite-strings -Wold-style-definition
-        -Winit-self -Wmissing-include-dirs -Wno-multichar
-        -Wnested-externs "
-    for each in $list
-    do
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if compiler understands $each" >&5
-$as_echo_n "checking to see if compiler understands $each... " >&6; }
 
-  save_CFLAGS="$CFLAGS"
-  CFLAGS="$CFLAGS $each"
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands -errwarn=%all" >&5
+$as_echo_n "checking to see if c++ compiler understands -errwarn=%all... " >&6; }
+
+  save_CPPFLAGS="$CPPFLAGS"
+  CPPFLAGS="$CPPFLAGS -errwarn=%all"
+
+  ac_ext=cpp
+ac_cpp='$CXXCPP $CPPFLAGS'
+ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+
 
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
@@ -25713,48 +25786,47 @@ main ()
   return 0;
 }
 _ACEOF
-if ac_fn_c_try_compile "$LINENO"; then :
+if ac_fn_cxx_try_compile "$LINENO"; then :
   flag_ok=yes
 else
   flag_ok=no
 fi
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
-  CFLAGS="$save_CFLAGS"
+  CPPFLAGS="$save_CPPFLAGS"
 
   if test "X$flag_ok" = Xyes ; then
-    WARNING_CFLAGS="$WARNING_CFLAGS $each"
+    ERROR_CXXFLAGS="$ERROR_CXXFLAGS -errwarn=%all"
     true
   else
-    UNSUPPORTED="$UNSUPPORTED $each"
-    true
-  fi
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $flag_ok" >&5
-$as_echo "$flag_ok" >&6; }
 
-    done
-    if test "X$UNSUPPORTED" != X ; then
-      { $as_echo "$as_me:${as_lineno-$LINENO}: unsupported compiler flags: $UNSUPPORTED" >&5
-$as_echo "$as_me: unsupported compiler flags: $UNSUPPORTED" >&6;}
-    fi
+    true
   fi
 
+  ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: set WARNING_CFLAGS to $WARNING_CFLAGS" >&5
-$as_echo "$as_me: set WARNING_CFLAGS to $WARNING_CFLAGS" >&6;}
-  { $as_echo "$as_me:${as_lineno-$LINENO}: set ERROR_CFLAGS to $ERROR_CFLAGS" >&5
-$as_echo "$as_me: set ERROR_CFLAGS to $ERROR_CFLAGS" >&6;}
-
-fi
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $flag_ok" >&5
+$as_echo "$flag_ok" >&6; }
 
+      if test "x$ERROR_CXXFLAGS" != "x"; then
+                                                                                for f in 'no%E_EMPTY_DECLARATION' \
+                 'no%E_STATEMENT_NOT_REACHED' \
+                 'no%E_ARGUEMENT_MISMATCH' \
+                 'no%E_MACRO_REDEFINED' \
+                 'no%E_LOOP_NOT_ENTERED_AT_TOP'
+        do
 
 
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands " >&5
-$as_echo_n "checking to see if c++ compiler understands ... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands -errwarn=%all,$f" >&5
+$as_echo_n "checking to see if c++ compiler understands -errwarn=%all,$f... " >&6; }
 
   save_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS "
+  CPPFLAGS="$CPPFLAGS -errwarn=%all,$f"
 
   ac_ext=cpp
 ac_cpp='$CXXCPP $CPPFLAGS'
@@ -25783,10 +25855,10 @@ rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
   CPPFLAGS="$save_CPPFLAGS"
 
   if test "X$flag_ok" = Xyes ; then
-
+    ERROR_CXXFLAGS="$ERROR_CXXFLAGS
     true
   else
-
+    $f"
     true
   fi
 
@@ -25800,21 +25872,31 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $flag_ok" >&5
 $as_echo "$flag_ok" >&6; }
 
+        done
+      fi
+    fi
+  fi
 
+  if test "x
+        -Wmissing-declarations -Wredundant-decls
+        -Wwrite-strings
+        -Winit-self -Wmissing-include-dirs -Waddress -Wno-multichar " != "x"
+  then
+    UNSUPPORTED=""
+    list="
+        -Wmissing-declarations -Wredundant-decls
+        -Wwrite-strings
+        -Winit-self -Wmissing-include-dirs -Waddress -Wno-multichar "
+    for each in $list
+    do
 
 
 
-  ERROR_CXXFLAGS=""
-  WARNING_CXXFLAGS=""
-
-
-
-
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands -Wall" >&5
-$as_echo_n "checking to see if c++ compiler understands -Wall... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands $each" >&5
+$as_echo_n "checking to see if c++ compiler understands $each... " >&6; }
 
   save_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS -Wall"
+  CPPFLAGS="$CPPFLAGS $each"
 
   ac_ext=cpp
 ac_cpp='$CXXCPP $CPPFLAGS'
@@ -25843,7 +25925,76 @@ rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
   CPPFLAGS="$save_CPPFLAGS"
 
   if test "X$flag_ok" = Xyes ; then
-    WARNING_CXXFLAGS="$WARNING_CXXFLAGS -Wall"
+    WARNING_CXXFLAGS="$WARNING_CXXFLAGS $each"
+    true
+  else
+    UNSUPPORTED="$UNSUPPORTED $each"
+    true
+  fi
+
+  ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: result: $flag_ok" >&5
+$as_echo "$flag_ok" >&6; }
+
+    done
+    if test "X$UNSUPPORTED" != X ; then
+      { $as_echo "$as_me:${as_lineno-$LINENO}: unsupported compiler flags: $UNSUPPORTED" >&5
+$as_echo "$as_me: unsupported compiler flags: $UNSUPPORTED" >&6;}
+    fi
+  fi
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: set WARNING_CXXFLAGS to $WARNING_CXXFLAGS" >&5
+$as_echo "$as_me: set WARNING_CXXFLAGS to $WARNING_CXXFLAGS" >&6;}
+  { $as_echo "$as_me:${as_lineno-$LINENO}: set ERROR_CXXFLAGS to $ERROR_CXXFLAGS" >&5
+$as_echo "$as_me: set ERROR_CXXFLAGS to $ERROR_CXXFLAGS" >&6;}
+
+
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if Objective C compiler understands " >&5
+$as_echo_n "checking to see if Objective C compiler understands ... " >&6; }
+
+  save_CPPFLAGS="$CPPFLAGS"
+  CPPFLAGS="$CPPFLAGS "
+
+  ac_ext=m
+ac_cpp='$OBJCPP $CPPFLAGS'
+ac_compile='$OBJC -c $OBJCFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$OBJC -o conftest$ac_exeext $OBJCFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_objc_compiler_gnu
+
+
+  cat confdefs.h - <<_ACEOF >conftest.$ac_ext
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+if ac_fn_objc_try_compile "$LINENO"; then :
+  flag_ok=yes
+else
+  flag_ok=no
+fi
+rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
+  CPPFLAGS="$save_CPPFLAGS"
+
+  if test "X$flag_ok" = Xyes ; then
+
     true
   else
 
@@ -25861,22 +26012,26 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
 $as_echo "$flag_ok" >&6; }
 
 
-    if test "x$GST_GIT" != "xno"
-  then
 
 
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands -Werror" >&5
-$as_echo_n "checking to see if c++ compiler understands -Werror... " >&6; }
+  ERROR_OBJCFLAGS=""
+  WARNING_OBJCFLAGS=""
+
+
+
+
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if Objective C compiler understands -Wall" >&5
+$as_echo_n "checking to see if Objective C compiler understands -Wall... " >&6; }
 
   save_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS -Werror"
+  CPPFLAGS="$CPPFLAGS -Wall"
 
-  ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+  ac_ext=m
+ac_cpp='$OBJCPP $CPPFLAGS'
+ac_compile='$OBJC -c $OBJCFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$OBJC -o conftest$ac_exeext $OBJCFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_objc_compiler_gnu
 
 
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -25890,7 +26045,7 @@ main ()
   return 0;
 }
 _ACEOF
-if ac_fn_cxx_try_compile "$LINENO"; then :
+if ac_fn_objc_try_compile "$LINENO"; then :
   flag_ok=yes
 else
   flag_ok=no
@@ -25899,7 +26054,7 @@ rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
   CPPFLAGS="$save_CPPFLAGS"
 
   if test "X$flag_ok" = Xyes ; then
-    ERROR_CXXFLAGS="$ERROR_CXXFLAGS -Werror"
+    WARNING_OBJCFLAGS="$WARNING_OBJCFLAGS -Wall"
     true
   else
 
@@ -25917,22 +26072,22 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
 $as_echo "$flag_ok" >&6; }
 
 
-    if test "x$ERROR_CXXFLAGS" != "x"
-    then
+    if test "x$FATAL_WARNINGS" != "xno"
+  then
 
 
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands -Wno-non-virtual-dtor" >&5
-$as_echo_n "checking to see if c++ compiler understands -Wno-non-virtual-dtor... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if Objective C compiler understands -Werror" >&5
+$as_echo_n "checking to see if Objective C compiler understands -Werror... " >&6; }
 
   save_CPPFLAGS="$CPPFLAGS"
-  CPPFLAGS="$CPPFLAGS -Wno-non-virtual-dtor"
+  CPPFLAGS="$CPPFLAGS -Werror"
 
-  ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+  ac_ext=m
+ac_cpp='$OBJCPP $CPPFLAGS'
+ac_compile='$OBJC -c $OBJCFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$OBJC -o conftest$ac_exeext $OBJCFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_objc_compiler_gnu
 
 
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -25946,7 +26101,7 @@ main ()
   return 0;
 }
 _ACEOF
-if ac_fn_cxx_try_compile "$LINENO"; then :
+if ac_fn_objc_try_compile "$LINENO"; then :
   flag_ok=yes
 else
   flag_ok=no
@@ -25955,7 +26110,7 @@ rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
   CPPFLAGS="$save_CPPFLAGS"
 
   if test "X$flag_ok" = Xyes ; then
-    ERROR_CXXFLAGS="$ERROR_CXXFLAGS -Wno-non-virtual-dtor"
+    ERROR_OBJCFLAGS="$ERROR_OBJCFLAGS -Werror"
     true
   else
 
@@ -25973,6 +26128,8 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
 $as_echo "$flag_ok" >&6; }
 
 
+    if test "x$ERROR_OBJCFLAGS" != "x"
+    then
 				if test -n "$PKG_CONFIG" && \
     { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"glib-2.0 < 2.19.8\""; } >&5
   ($PKG_CONFIG --exists --print-errors "glib-2.0 < 2.19.8") 2>&5
@@ -25983,17 +26140,17 @@ $as_echo "$flag_ok" >&6; }
 
 
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands -fno-strict-aliasing" >&5
-$as_echo_n "checking to see if c++ compiler understands -fno-strict-aliasing... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if Objective C compiler understands -fno-strict-aliasing" >&5
+$as_echo_n "checking to see if Objective C compiler understands -fno-strict-aliasing... " >&6; }
 
   save_CPPFLAGS="$CPPFLAGS"
   CPPFLAGS="$CPPFLAGS -fno-strict-aliasing"
 
-  ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+  ac_ext=m
+ac_cpp='$OBJCPP $CPPFLAGS'
+ac_compile='$OBJC -c $OBJCFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$OBJC -o conftest$ac_exeext $OBJCFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_objc_compiler_gnu
 
 
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -26007,7 +26164,7 @@ main ()
   return 0;
 }
 _ACEOF
-if ac_fn_cxx_try_compile "$LINENO"; then :
+if ac_fn_objc_try_compile "$LINENO"; then :
   flag_ok=yes
 else
   flag_ok=no
@@ -26016,7 +26173,7 @@ rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
   CPPFLAGS="$save_CPPFLAGS"
 
   if test "X$flag_ok" = Xyes ; then
-    ERROR_CXXFLAGS="$ERROR_CXXFLAGS -fno-strict-aliasing"
+    ERROR_OBJCFLAGS="$ERROR_OBJCFLAGS -fno-strict-aliasing"
     true
   else
 
@@ -26039,17 +26196,17 @@ fi
 
 
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands -errwarn=%all" >&5
-$as_echo_n "checking to see if c++ compiler understands -errwarn=%all... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if Objective C compiler understands -errwarn=%all" >&5
+$as_echo_n "checking to see if Objective C compiler understands -errwarn=%all... " >&6; }
 
   save_CPPFLAGS="$CPPFLAGS"
   CPPFLAGS="$CPPFLAGS -errwarn=%all"
 
-  ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+  ac_ext=m
+ac_cpp='$OBJCPP $CPPFLAGS'
+ac_compile='$OBJC -c $OBJCFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$OBJC -o conftest$ac_exeext $OBJCFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_objc_compiler_gnu
 
 
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -26063,7 +26220,7 @@ main ()
   return 0;
 }
 _ACEOF
-if ac_fn_cxx_try_compile "$LINENO"; then :
+if ac_fn_objc_try_compile "$LINENO"; then :
   flag_ok=yes
 else
   flag_ok=no
@@ -26072,7 +26229,7 @@ rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
   CPPFLAGS="$save_CPPFLAGS"
 
   if test "X$flag_ok" = Xyes ; then
-    ERROR_CXXFLAGS="$ERROR_CXXFLAGS -errwarn=%all"
+    ERROR_OBJCFLAGS="$ERROR_OBJCFLAGS -errwarn=%all"
     true
   else
 
@@ -26089,7 +26246,7 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
   { $as_echo "$as_me:${as_lineno-$LINENO}: result: $flag_ok" >&5
 $as_echo "$flag_ok" >&6; }
 
-      if test "x$ERROR_CXXFLAGS" != "x"; then
+      if test "x$ERROR_OBJCFLAGS" != "x"; then
                                                                                 for f in 'no%E_EMPTY_DECLARATION' \
                  'no%E_STATEMENT_NOT_REACHED' \
                  'no%E_ARGUEMENT_MISMATCH' \
@@ -26099,17 +26256,17 @@ $as_echo "$flag_ok" >&6; }
 
 
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands -errwarn=%all,$f" >&5
-$as_echo_n "checking to see if c++ compiler understands -errwarn=%all,$f... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if Objective C compiler understands -errwarn=%all,$f" >&5
+$as_echo_n "checking to see if Objective C compiler understands -errwarn=%all,$f... " >&6; }
 
   save_CPPFLAGS="$CPPFLAGS"
   CPPFLAGS="$CPPFLAGS -errwarn=%all,$f"
 
-  ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+  ac_ext=m
+ac_cpp='$OBJCPP $CPPFLAGS'
+ac_compile='$OBJC -c $OBJCFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$OBJC -o conftest$ac_exeext $OBJCFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_objc_compiler_gnu
 
 
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -26123,7 +26280,7 @@ main ()
   return 0;
 }
 _ACEOF
-if ac_fn_cxx_try_compile "$LINENO"; then :
+if ac_fn_objc_try_compile "$LINENO"; then :
   flag_ok=yes
 else
   flag_ok=no
@@ -26132,7 +26289,7 @@ rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
   CPPFLAGS="$save_CPPFLAGS"
 
   if test "X$flag_ok" = Xyes ; then
-    ERROR_CXXFLAGS="$ERROR_CXXFLAGS
+    ERROR_OBJCFLAGS="$ERROR_OBJCFLAGS
     true
   else
     $f"
@@ -26155,31 +26312,33 @@ $as_echo "$flag_ok" >&6; }
   fi
 
   if test "x
-        -Wmissing-declarations -Wredundant-decls
-        -Wwrite-strings
-        -Winit-self -Wmissing-include-dirs -Waddress -Wno-multichar " != "x"
+      -Wmissing-declarations -Wmissing-prototypes -Wredundant-decls
+      -Wwrite-strings -Wold-style-definition
+      -Winit-self -Wmissing-include-dirs -Wno-multichar
+      -Wnested-externs" != "x"
   then
     UNSUPPORTED=""
     list="
-        -Wmissing-declarations -Wredundant-decls
-        -Wwrite-strings
-        -Winit-self -Wmissing-include-dirs -Waddress -Wno-multichar "
+      -Wmissing-declarations -Wmissing-prototypes -Wredundant-decls
+      -Wwrite-strings -Wold-style-definition
+      -Winit-self -Wmissing-include-dirs -Wno-multichar
+      -Wnested-externs"
     for each in $list
     do
 
 
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if c++ compiler understands $each" >&5
-$as_echo_n "checking to see if c++ compiler understands $each... " >&6; }
+  { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if Objective C compiler understands $each" >&5
+$as_echo_n "checking to see if Objective C compiler understands $each... " >&6; }
 
   save_CPPFLAGS="$CPPFLAGS"
   CPPFLAGS="$CPPFLAGS $each"
 
-  ac_ext=cpp
-ac_cpp='$CXXCPP $CPPFLAGS'
-ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext >&5'
-ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
-ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
+  ac_ext=m
+ac_cpp='$OBJCPP $CPPFLAGS'
+ac_compile='$OBJC -c $OBJCFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$OBJC -o conftest$ac_exeext $OBJCFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_objc_compiler_gnu
 
 
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
@@ -26193,7 +26352,7 @@ main ()
   return 0;
 }
 _ACEOF
-if ac_fn_cxx_try_compile "$LINENO"; then :
+if ac_fn_objc_try_compile "$LINENO"; then :
   flag_ok=yes
 else
   flag_ok=no
@@ -26202,7 +26361,7 @@ rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
   CPPFLAGS="$save_CPPFLAGS"
 
   if test "X$flag_ok" = Xyes ; then
-    WARNING_CXXFLAGS="$WARNING_CXXFLAGS $each"
+    WARNING_OBJCFLAGS="$WARNING_OBJCFLAGS $each"
     true
   else
     UNSUPPORTED="$UNSUPPORTED $each"
@@ -26228,10 +26387,10 @@ $as_echo "$as_me: unsupported compiler flags: $UNSUPPORTED" >&6;}
 
 
 
-  { $as_echo "$as_me:${as_lineno-$LINENO}: set WARNING_CXXFLAGS to $WARNING_CXXFLAGS" >&5
-$as_echo "$as_me: set WARNING_CXXFLAGS to $WARNING_CXXFLAGS" >&6;}
-  { $as_echo "$as_me:${as_lineno-$LINENO}: set ERROR_CXXFLAGS to $ERROR_CXXFLAGS" >&5
-$as_echo "$as_me: set ERROR_CXXFLAGS to $ERROR_CXXFLAGS" >&6;}
+  { $as_echo "$as_me:${as_lineno-$LINENO}: set WARNING_OBJCFLAGS to $WARNING_OBJCFLAGS" >&5
+$as_echo "$as_me: set WARNING_OBJCFLAGS to $WARNING_OBJCFLAGS" >&6;}
+  { $as_echo "$as_me:${as_lineno-$LINENO}: set ERROR_OBJCFLAGS to $ERROR_OBJCFLAGS" >&5
+$as_echo "$as_me: set ERROR_OBJCFLAGS to $ERROR_OBJCFLAGS" >&6;}
 
 
 
@@ -28255,11 +28414,14 @@ $as_echo_n "checking for DirectSound LDFLAGS... " >&6; }
 #include <dxerr9.h>
 #include <dsound.h>
 
-int main ()
+int
+main ()
 {
+
   DXGetErrorString9 (0);
   DirectSoundCreate(NULL, NULL, NULL);
 
+  ;
   return 0;
 }
 
@@ -28326,6 +28488,97 @@ fi
 
 
 echo
+{ $as_echo "$as_me:${as_lineno-$LINENO}: *** checking feature: Win32 WaveForm ***" >&5
+$as_echo "$as_me: *** checking feature: Win32 WaveForm ***" >&6;}
+if test "xwaveformsink" != "x"
+then
+  { $as_echo "$as_me:${as_lineno-$LINENO}: *** for plug-ins: waveformsink ***" >&5
+$as_echo "$as_me: *** for plug-ins: waveformsink ***" >&6;}
+fi
+NOUSE=
+if test "x$USE_WAVEFORM" = "xno"; then
+  NOUSE="yes"
+fi
+# Check whether --enable-waveform was given.
+if test "${enable_waveform+set}" = set; then :
+  enableval=$enable_waveform;  case "${enableval}" in
+      yes) USE_WAVEFORM=yes;;
+      no) USE_WAVEFORM=no;;
+      *) as_fn_error $? "bad value ${enableval} for --enable-waveform" "$LINENO" 5 ;;
+    esac
+else
+   USE_WAVEFORM=yes
+fi
+
+if test "x$NOUSE" = "xyes"; then
+  USE_WAVEFORM="no"
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: *** waveformsink pre-configured not to be built" >&5
+$as_echo "$as_me: WARNING: *** waveformsink pre-configured not to be built" >&2;}
+fi
+NOUSE=
+
+
+if test x$USE_WAVEFORM = xyes; then
+
+  gst_check_save_LIBS=$LIBS
+  gst_check_save_LDFLAGS=$LDFLAGS
+  gst_check_save_CFLAGS=$CFLAGS
+  gst_check_save_CPPFLAGS=$CPPFLAGS
+  gst_check_save_CXXFLAGS=$CXXFLAGS
+
+  HAVE_WAVEFORM=no
+
+  ac_fn_c_check_header_compile "$LINENO" "mmsystem.h" "ac_cv_header_mmsystem_h" "#include <windows.h>
+"
+if test "x$ac_cv_header_mmsystem_h" = xyes; then :
+  HAVE_WAVEFORM="yes"
+else
+  HAVE_WAVEFORM="no"
+fi
+
+
+
+
+  LIBS=$gst_check_save_LIBS
+  LDFLAGS=$gst_check_save_LDFLAGS
+  CFLAGS=$gst_check_save_CFLAGS
+  CPPFLAGS=$gst_check_save_CPPFLAGS
+  CXXFLAGS=$gst_check_save_CXXFLAGS
+
+    if test x$HAVE_WAVEFORM = xno; then
+    USE_WAVEFORM=no
+  else
+    { $as_echo "$as_me:${as_lineno-$LINENO}: *** These plugins will be built: waveformsink" >&5
+$as_echo "$as_me: *** These plugins will be built: waveformsink" >&6;}
+  fi
+fi
+if test x$USE_WAVEFORM = xyes; then
+  :
+  if test "xwaveformsink" != "x"; then
+    GST_PLUGINS_YES="\twaveformsink\n$GST_PLUGINS_YES"
+  fi
+
+$as_echo "#define HAVE_WAVEFORM /**/" >>confdefs.h
+
+else
+  { $as_echo "$as_me:${as_lineno-$LINENO}: *** These plugins will not be built: waveformsink" >&5
+$as_echo "$as_me: *** These plugins will not be built: waveformsink" >&6;}
+  if test "xwaveformsink" != "x"; then
+    GST_PLUGINS_NO="\twaveformsink\n$GST_PLUGINS_NO"
+  fi
+  :
+fi
+ if test x$USE_WAVEFORM = xyes; then
+  USE_WAVEFORM_TRUE=
+  USE_WAVEFORM_FALSE='#'
+else
+  USE_WAVEFORM_TRUE='#'
+  USE_WAVEFORM_FALSE=
+fi
+
+
+
+echo
 { $as_echo "$as_me:${as_lineno-$LINENO}: *** checking feature: OSS audio ***" >&5
 $as_echo "$as_me: *** checking feature: OSS audio ***" >&6;}
 if test "xossaudio" != "x"
@@ -28637,6 +28890,7 @@ fi
 
 
 
+have_ios="no"
 echo
 { $as_echo "$as_me:${as_lineno-$LINENO}: *** checking feature: OSX audio ***" >&5
 $as_echo "$as_me: *** checking feature: OSX audio ***" >&6;}
@@ -28682,7 +28936,15 @@ if test x$USE_OSX_AUDIO = xyes; then
 if test "x$ac_cv_header_CoreAudio_CoreAudio_h" = xyes; then :
   HAVE_OSX_AUDIO="yes"
 else
+      ac_fn_c_check_header_mongrel "$LINENO" "CoreAudio/CoreAudioTypes.h" "ac_cv_header_CoreAudio_CoreAudioTypes_h" "$ac_includes_default"
+if test "x$ac_cv_header_CoreAudio_CoreAudioTypes_h" = xyes; then :
+  HAVE_OSX_AUDIO="YES";have_ios="yes"
+else
   HAVE_OSX_AUDIO="no"
+
+fi
+
+
 fi
 
 
@@ -28726,6 +28988,19 @@ else
 fi
 
 
+if test "x$have_ios" = "xyes"; then
+
+$as_echo "#define HAVE_IOS 1" >>confdefs.h
+
+fi
+ if test "x$have_ios" = "xyes"; then
+  HAVE_IOS_TRUE=
+  HAVE_IOS_FALSE='#'
+else
+  HAVE_IOS_TRUE='#'
+  HAVE_IOS_FALSE=
+fi
+
 
 HAVE_OSX_VIDEO="no"
 echo
@@ -30731,7 +31006,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_AALIB_CONFIG="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -31693,7 +31968,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_ESD_CONFIG="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -35067,12 +35342,12 @@ if test -n "$PKG_CONFIG"; then
         pkg_cv_SOUP_CFLAGS="$SOUP_CFLAGS"
     else
         if test -n "$PKG_CONFIG" && \
-    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsoup-2.4 >= 2.26\""; } >&5
-  ($PKG_CONFIG --exists --print-errors "libsoup-2.4 >= 2.26") 2>&5
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsoup-2.4 >= 2.26.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libsoup-2.4 >= 2.26.1") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-  pkg_cv_SOUP_CFLAGS=`$PKG_CONFIG --cflags "libsoup-2.4 >= 2.26" 2>/dev/null`
+  pkg_cv_SOUP_CFLAGS=`$PKG_CONFIG --cflags "libsoup-2.4 >= 2.26.1" 2>/dev/null`
 else
   pkg_failed=yes
 fi
@@ -35085,12 +35360,12 @@ if test -n "$PKG_CONFIG"; then
         pkg_cv_SOUP_LIBS="$SOUP_LIBS"
     else
         if test -n "$PKG_CONFIG" && \
-    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsoup-2.4 >= 2.26\""; } >&5
-  ($PKG_CONFIG --exists --print-errors "libsoup-2.4 >= 2.26") 2>&5
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsoup-2.4 >= 2.26.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libsoup-2.4 >= 2.26.1") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-  pkg_cv_SOUP_LIBS=`$PKG_CONFIG --libs "libsoup-2.4 >= 2.26" 2>/dev/null`
+  pkg_cv_SOUP_LIBS=`$PKG_CONFIG --libs "libsoup-2.4 >= 2.26.1" 2>/dev/null`
 else
   pkg_failed=yes
 fi
@@ -35109,9 +35384,9 @@ else
         _pkg_short_errors_supported=no
 fi
         if test $_pkg_short_errors_supported = yes; then
-	        SOUP_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libsoup-2.4 >= 2.26"`
+	        SOUP_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libsoup-2.4 >= 2.26.1"`
         else
-	        SOUP_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libsoup-2.4 >= 2.26"`
+	        SOUP_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libsoup-2.4 >= 2.26.1"`
         fi
 	# Put the nasty error message in config.log where it belongs
 	echo "$SOUP_PKG_ERRORS" >&5
@@ -35145,12 +35420,12 @@ if test -n "$PKG_CONFIG"; then
         pkg_cv_SOUP_CFLAGS="$SOUP_CFLAGS"
     else
         if test -n "$PKG_CONFIG" && \
-    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsoup-2.4 >= 2.26\""; } >&5
-  ($PKG_CONFIG --exists --print-errors "libsoup-2.4 >= 2.26") 2>&5
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsoup-2.4 >= 2.26.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libsoup-2.4 >= 2.26.1") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-  pkg_cv_SOUP_CFLAGS=`$PKG_CONFIG --cflags "libsoup-2.4 >= 2.26" 2>/dev/null`
+  pkg_cv_SOUP_CFLAGS=`$PKG_CONFIG --cflags "libsoup-2.4 >= 2.26.1" 2>/dev/null`
 else
   pkg_failed=yes
 fi
@@ -35163,12 +35438,12 @@ if test -n "$PKG_CONFIG"; then
         pkg_cv_SOUP_LIBS="$SOUP_LIBS"
     else
         if test -n "$PKG_CONFIG" && \
-    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsoup-2.4 >= 2.26\""; } >&5
-  ($PKG_CONFIG --exists --print-errors "libsoup-2.4 >= 2.26") 2>&5
+    { { $as_echo "$as_me:${as_lineno-$LINENO}: \$PKG_CONFIG --exists --print-errors \"libsoup-2.4 >= 2.26.1\""; } >&5
+  ($PKG_CONFIG --exists --print-errors "libsoup-2.4 >= 2.26.1") 2>&5
   ac_status=$?
   $as_echo "$as_me:${as_lineno-$LINENO}: \$? = $ac_status" >&5
   test $ac_status = 0; }; then
-  pkg_cv_SOUP_LIBS=`$PKG_CONFIG --libs "libsoup-2.4 >= 2.26" 2>/dev/null`
+  pkg_cv_SOUP_LIBS=`$PKG_CONFIG --libs "libsoup-2.4 >= 2.26.1" 2>/dev/null`
 else
   pkg_failed=yes
 fi
@@ -35187,9 +35462,9 @@ else
         _pkg_short_errors_supported=no
 fi
         if test $_pkg_short_errors_supported = yes; then
-	        SOUP_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libsoup-2.4 >= 2.26"`
+	        SOUP_PKG_ERRORS=`$PKG_CONFIG --short-errors --errors-to-stdout --print-errors "libsoup-2.4 >= 2.26.1"`
         else
-	        SOUP_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libsoup-2.4 >= 2.26"`
+	        SOUP_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "libsoup-2.4 >= 2.26.1"`
         fi
 	# Put the nasty error message in config.log where it belongs
 	echo "$SOUP_PKG_ERRORS" >&5
@@ -36709,6 +36984,14 @@ else
 fi
 
  if false; then
+  USE_WAVEFORM_TRUE=
+  USE_WAVEFORM_FALSE='#'
+else
+  USE_WAVEFORM_TRUE='#'
+  USE_WAVEFORM_FALSE=
+fi
+
+ if false; then
   USE_WAVPACK_TRUE=
   USE_WAVPACK_FALSE='#'
 else
@@ -36766,17 +37049,21 @@ fi
 
 GST_OPTION_CFLAGS="\$(WARNING_CFLAGS) \$(ERROR_CFLAGS) \$(DEBUG_CFLAGS) \$(PROFILE_CFLAGS) \$(GCOV_CFLAGS) \$(OPT_CFLAGS) \$(DEPRECATED_CFLAGS)"
 GST_OPTION_CXXFLAGS="\$(WARNING_CXXFLAGS) \$(ERROR_CXXFLAGS) \$(DEBUG_CFLAGS) \$(PROFILE_CFLAGS) \$(GCOV_CFLAGS) \$(OPT_CFLAGS) \$(DEPRECATED_CFLAGS)"
+GST_OPTION_OBJCFLAGS="\$(WARNING_OBJCFLAGS) \$(ERROR_OBJCFLAGS) \$(DEBUG_CFLAGS) \$(PROFILE_CFLAGS) \$(GCOV_CFLAGS) \$(OPT_CFLAGS) \$(DEPRECATED_CFLAGS)"
+
 
 
 
 
 
 GST_CXXFLAGS="-I\$(top_srcdir)/gst-libs $GST_CFLAGS $GLIB_EXTRA_CFLAGS \$(GST_OPTION_CXXFLAGS)"
+GST_OBJCFLAGS="-I\$(top_srcdir)/gst-libs $GST_CFLAGS $GLIB_EXTRA_CFLAGS \$(GST_OPTION_OBJCFLAGS)"
 GST_CFLAGS="-I\$(top_srcdir)/gst-libs $GST_CFLAGS $GLIB_EXTRA_CFLAGS \$(GST_OPTION_CFLAGS)"
 
 
 
 
+
 GST_ALL_LDFLAGS="-no-undefined"
 
 
@@ -36935,6 +37222,14 @@ LIBOBJS=$ac_libobjs
 LTLIBOBJS=$ac_ltlibobjs
 
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking that generated files are newer than configure" >&5
+$as_echo_n "checking that generated files are newer than configure... " >&6; }
+   if test -n "$am_sleep_pid"; then
+     # Hide warnings about reused PIDs.
+     wait $am_sleep_pid 2>/dev/null
+   fi
+   { $as_echo "$as_me:${as_lineno-$LINENO}: result: done" >&5
+$as_echo "done" >&6; }
  if test -n "$EXEEXT"; then
   am__EXEEXT_TRUE=
   am__EXEEXT_FALSE='#'
@@ -37049,10 +37344,6 @@ if test -z "${am__fastdepOBJC_TRUE}" && test -z "${am__fastdepOBJC_FALSE}"; then
   as_fn_error $? "conditional \"am__fastdepOBJC\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
-if test -z "${am__fastdepOBJC_TRUE}" && test -z "${am__fastdepOBJC_FALSE}"; then
-  as_fn_error $? "conditional \"am__fastdepOBJC\" was never defined.
-Usually this means the macro was only invoked conditionally." "$LINENO" 5
-fi
 if test -z "${am__fastdepCCAS_TRUE}" && test -z "${am__fastdepCCAS_FALSE}"; then
   as_fn_error $? "conditional \"am__fastdepCCAS\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
@@ -37297,6 +37588,10 @@ if test -z "${USE_DIRECTSOUND_TRUE}" && test -z "${USE_DIRECTSOUND_FALSE}"; then
   as_fn_error $? "conditional \"USE_DIRECTSOUND\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${USE_WAVEFORM_TRUE}" && test -z "${USE_WAVEFORM_FALSE}"; then
+  as_fn_error $? "conditional \"USE_WAVEFORM\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${USE_OSS_TRUE}" && test -z "${USE_OSS_FALSE}"; then
   as_fn_error $? "conditional \"USE_OSS\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
@@ -37313,6 +37608,10 @@ if test -z "${USE_OSX_AUDIO_TRUE}" && test -z "${USE_OSX_AUDIO_FALSE}"; then
   as_fn_error $? "conditional \"USE_OSX_AUDIO\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${HAVE_IOS_TRUE}" && test -z "${HAVE_IOS_FALSE}"; then
+  as_fn_error $? "conditional \"HAVE_IOS\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${USE_OSX_VIDEO_TRUE}" && test -z "${USE_OSX_VIDEO_FALSE}"; then
   as_fn_error $? "conditional \"USE_OSX_VIDEO\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
@@ -37549,6 +37848,10 @@ if test -z "${USE_TAGLIB_TRUE}" && test -z "${USE_TAGLIB_FALSE}"; then
   as_fn_error $? "conditional \"USE_TAGLIB\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
 fi
+if test -z "${USE_WAVEFORM_TRUE}" && test -z "${USE_WAVEFORM_FALSE}"; then
+  as_fn_error $? "conditional \"USE_WAVEFORM\" was never defined.
+Usually this means the macro was only invoked conditionally." "$LINENO" 5
+fi
 if test -z "${USE_WAVPACK_TRUE}" && test -z "${USE_WAVPACK_FALSE}"; then
   as_fn_error $? "conditional \"USE_WAVPACK\" was never defined.
 Usually this means the macro was only invoked conditionally." "$LINENO" 5
@@ -37867,16 +38170,16 @@ if (echo >conf$$.file) 2>/dev/null; then
     # ... but there are two gotchas:
     # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
     # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
+    # In both cases, we have to default to `cp -pR'.
     ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
+      as_ln_s='cp -pR'
   elif ln conf$$.file conf$$ 2>/dev/null; then
     as_ln_s=ln
   else
-    as_ln_s='cp -p'
+    as_ln_s='cp -pR'
   fi
 else
-  as_ln_s='cp -p'
+  as_ln_s='cp -pR'
 fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
@@ -37936,28 +38239,16 @@ else
   as_mkdir_p=false
 fi
 
-if test -x / >/dev/null 2>&1; then
-  as_test_x='test -x'
-else
-  if ls -dL / >/dev/null 2>&1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d "$1"; then
-	test -d "$1/.";
-      else
-	case $1 in #(
-	-*)set "./$1";;
-	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
+
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -37978,8 +38269,8 @@ cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
-This file was extended by GStreamer Good Plug-ins $as_me 0.10.31, which was
-generated by GNU Autoconf 2.68.  Invocation command line was
+This file was extended by GStreamer Good Plug-ins $as_me 0.10.31.1, which was
+generated by GNU Autoconf 2.69.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
@@ -38044,11 +38335,11 @@ _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
 ac_cs_version="\\
-GStreamer Good Plug-ins config.status 0.10.31
-configured by $0, generated by GNU Autoconf 2.68,
+GStreamer Good Plug-ins config.status 0.10.31.1
+configured by $0, generated by GNU Autoconf 2.69,
   with options \\"\$ac_cs_config\\"
 
-Copyright (C) 2010 Free Software Foundation, Inc.
+Copyright (C) 2012 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
 
@@ -38139,7 +38430,7 @@ fi
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 if \$ac_cs_recheck; then
-  set X '$SHELL' '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
+  set X $SHELL '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
   shift
   \$as_echo "running CONFIG_SHELL=$SHELL \$*" >&6
   CONFIG_SHELL='$SHELL'
@@ -39291,7 +39582,7 @@ $as_echo "$as_me: executing $ac_file commands" >&6;}
     # Strip MF so we end up with the name of the file.
     mf=`echo "$mf" | sed -e 's/:.*$//'`
     # Check whether this is an Automake generated Makefile or not.
-    # We used to match only the files named `Makefile.in', but
+    # We used to match only the files named 'Makefile.in', but
     # some people rename them; so instead we look at the file content.
     # Grep'ing the first line is not enough: some people post-process
     # each Makefile.in and add a new line on top of each file to say so.
@@ -39325,21 +39616,19 @@ $as_echo X"$mf" |
       continue
     fi
     # Extract the definition of DEPDIR, am__include, and am__quote
-    # from the Makefile without running `make'.
+    # from the Makefile without running 'make'.
     DEPDIR=`sed -n 's/^DEPDIR = //p' < "$mf"`
     test -z "$DEPDIR" && continue
     am__include=`sed -n 's/^am__include = //p' < "$mf"`
     test -z "am__include" && continue
     am__quote=`sed -n 's/^am__quote = //p' < "$mf"`
-    # When using ansi2knr, U may be empty or an underscore; expand it
-    U=`sed -n 's/^U = //p' < "$mf"`
     # Find all dependency output files, they are included files with
     # $(DEPDIR) in their names.  We invoke sed twice because it is the
     # simplest approach to changing $(DEPDIR) to its actual value in the
     # expansion.
     for file in `sed -n "
       s/^$am__include $am__quote\(.*(DEPDIR).*\)$am__quote"'$/\1/p' <"$mf" | \
-	 sed -e 's/\$(DEPDIR)/'"$DEPDIR"'/g' -e 's/\$U/'"$U"'/g'`; do
+	 sed -e 's/\$(DEPDIR)/'"$DEPDIR"'/g'`; do
       # Make sure the directory exists.
       test -f "$dirpart/$file" && continue
       fdir=`$as_dirname -- "$file" ||
diff --git a/configure.ac b/configure.ac
index 8a43fda..e3eb71b 100644
--- a/configure.ac
+++ b/configure.ac
@@ -1,13 +1,11 @@
-AC_PREREQ(2.60)
+AC_PREREQ([2.60])
 
 dnl please read gstreamer/docs/random/autotools before changing this file
 
 dnl initialize autoconf
 dnl releases only do -Wall, git and prerelease does -Werror too
 dnl use a three digit version number for releases, and four for git/pre
-AC_INIT(GStreamer Good Plug-ins, 0.10.31,
-    http://bugzilla.gnome.org/enter_bug.cgi?product=GStreamer,
-    gst-plugins-good)
+AC_INIT([GStreamer Good Plug-ins],[0.10.31.1],[http://bugzilla.gnome.org/enter_bug.cgi?product=GStreamer],[gst-plugins-good])
 
 AG_GST_INIT
 
@@ -24,7 +22,7 @@ dnl can autoconf find the source ?
 AC_CONFIG_SRCDIR([gst/law/alaw.c])
 
 dnl define the output header for config
-AM_CONFIG_HEADER([config.h])
+AC_CONFIG_HEADERS([config.h])
 
 dnl AM_MAINTAINER_MODE only provides the option to configure to enable it
 AM_MAINTAINER_MODE
@@ -55,7 +53,7 @@ AM_PROG_LIBTOOL
 
 dnl *** required versions of GStreamer stuff ***
 GST_REQ=0.10.36
-GSTPB_REQ=0.10.36
+GSTPB_REQ=0.10.36.1
 
 dnl *** autotools stuff ****
 
@@ -73,6 +71,8 @@ AG_GST_GETTEXT([gst-plugins-good-$GST_MAJORMINOR])
 
 dnl *** check for arguments to configure ***
 
+AG_GST_ARG_DISABLE_FATAL_WARNINGS
+
 AG_GST_ARG_DEBUG
 AG_GST_ARG_PROFILING
 AG_GST_ARG_VALGRIND
@@ -116,7 +116,7 @@ dnl determine c++ preprocessor
 dnl FIXME: do we need this ?
 AC_PROG_CXXCPP
 
-AS_PROG_OBJC
+AC_PROG_OBJC
 
 dnl check if the compiler supports '-c' and '-o' options
 AM_PROG_CC_C_O
@@ -297,29 +297,25 @@ AG_GST_SET_PACKAGE_RELEASE_DATETIME_WITH_NANO([$PACKAGE_VERSION_NANO],
 
 dnl define an ERROR_CFLAGS Makefile variable
 dnl -Wundef: too many broken headers
-if test "x$HAVE_OSX_VIDEO" != "xyes"; then
-  AG_GST_SET_ERROR_CFLAGS($GST_GIT, [
-        -Wmissing-declarations -Wmissing-prototypes -Wredundant-decls
-        -Wwrite-strings -Wold-style-definition -Waggregate-return
-        -Winit-self -Wmissing-include-dirs -Waddress -Wno-multichar
-        -Wnested-externs ])
-else
-  dnl work-around for us passing GST_CFLAGS to the ObjC-compiler, which
-  dnl doesn't understand all warning flags that the C compiler knows about
-  dnl (e.g. -Waddress) or causes problems with some flags (-Waggregate-return)
-  AG_GST_SET_ERROR_CFLAGS($GST_GIT, [
-        -Wmissing-declarations -Wmissing-prototypes -Wredundant-decls
-        -Wwrite-strings -Wold-style-definition
-        -Winit-self -Wmissing-include-dirs -Wno-multichar
-        -Wnested-externs ])
-fi
+AG_GST_SET_ERROR_CFLAGS($FATAL_WARNINGS, [
+      -Wmissing-declarations -Wmissing-prototypes -Wredundant-decls
+      -Wwrite-strings -Wold-style-definition -Waggregate-return
+      -Winit-self -Wmissing-include-dirs -Waddress -Wno-multichar
+      -Wnested-externs])
 
 dnl define an ERROR_CXXFLAGS Makefile variable
-AG_GST_SET_ERROR_CXXFLAGS($GST_GIT, [
+AG_GST_SET_ERROR_CXXFLAGS($FATAL_WARNINGS, [
         -Wmissing-declarations -Wredundant-decls
         -Wwrite-strings
         -Winit-self -Wmissing-include-dirs -Waddress -Wno-multichar ])
 
+dnl define an ERROR_OBJCFLAGS Makefile variable
+AG_GST_SET_ERROR_OBJCFLAGS($FATAL_WARNINGS, [
+      -Wmissing-declarations -Wmissing-prototypes -Wredundant-decls
+      -Wwrite-strings -Wold-style-definition
+      -Winit-self -Wmissing-include-dirs -Wno-multichar
+      -Wnested-externs])
+
 dnl define correct level for debugging messages
 AG_GST_SET_LEVEL_DEFAULT($GST_GIT)
 
@@ -414,18 +410,14 @@ AG_GST_CHECK_FEATURE(DIRECTSOUND, [DirectSound plug-in], directsoundsink, [
   LDFLAGS="$LDFLAGS $DIRECTSOUND_LDFLAGS"
   LIBS="$LIBS -ldsound -ldxerr9 -luser32"
   AC_MSG_CHECKING(for DirectSound LDFLAGS)
-  AC_LINK_IFELSE([
+  AC_LINK_IFELSE([AC_LANG_PROGRAM([[
 #include <windows.h>
 #include <dxerr9.h>
 #include <dsound.h>
-
-int main ()
-{
+]], [[
   DXGetErrorString9 (0);
   DirectSoundCreate(NULL, NULL, NULL);
-
-  return 0;
-}
+]])
 ],
     [HAVE_DIRECTSOUND="yes"],
     [HAVE_DIRECTSOUND="no"])
@@ -444,6 +436,12 @@ int main ()
   AC_SUBST(HAVE_DIRECTSOUND)
 ])
 
+dnl *** Win32 WaveOut ***
+translit(dnm, m, l) AM_CONDITIONAL(USE_WAVEFORM, true)
+AG_GST_CHECK_FEATURE(WAVEFORM, [Win32 WaveForm], waveformsink, [
+  AC_CHECK_HEADER(mmsystem.h, HAVE_WAVEFORM="yes", HAVE_WAVEFORM="no", [#include <windows.h>])
+])
+
 dnl *** OSS audio *** (Linux, *BSD)
 translit(dnm, m, l) AM_CONDITIONAL(USE_OSS, true)
 AG_GST_CHECK_FEATURE(OSS, [OSS audio], ossaudio, [
@@ -484,9 +482,19 @@ AG_GST_CHECK_FEATURE(SUNAUDIO, [Sun Audio], sunaudio, [
 
 dnl *** OSX Audio ***
 translit(dnm, m, l) AM_CONDITIONAL(USE_OSX_AUDIO, true)
+have_ios="no"
 AG_GST_CHECK_FEATURE(OSX_AUDIO, [OSX audio], osxaudio, [
-  AC_CHECK_HEADER(CoreAudio/CoreAudio.h, HAVE_OSX_AUDIO="yes", HAVE_OSX_AUDIO="no")
+  AC_CHECK_HEADER(CoreAudio/CoreAudio.h,
+    HAVE_OSX_AUDIO="yes",
+    dnl *** Check for the iOS headers ***
+    [AC_CHECK_HEADER(CoreAudio/CoreAudioTypes.h,
+      [HAVE_OSX_AUDIO="YES";have_ios="yes"], HAVE_OSX_AUDIO="no"
+    )])
 ])
+if test "x$have_ios" = "xyes"; then
+  AC_DEFINE(HAVE_IOS, 1, [building for iOS platofrm])
+fi
+AM_CONDITIONAL(HAVE_IOS, test "x$have_ios" = "xyes")
 
 dnl *** OS X video ***
 translit(dnm, m, l) AM_CONDITIONAL(USE_OSX_VIDEO, true)
@@ -511,7 +519,7 @@ dnl renamed to GST_V4L2 because of some conflict with kernel headers
 translit(dnm, m, l) AM_CONDITIONAL(USE_GST_V4L2, true)
 AG_GST_CHECK_FEATURE(GST_V4L2, [Video 4 Linux 2], v4l2src, [
   AC_MSG_CHECKING([Checking for up to date v4l2 installation])
-  AC_TRY_COMPILE([
+  AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
 #include <sys/types.h>
 #ifdef __sun /* Solaris */
 #include <sys/types.h>
@@ -525,12 +533,12 @@ AG_GST_CHECK_FEATURE(GST_V4L2, [Video 4 Linux 2], v4l2src, [
 #if defined(V4L2_MAJOR_VERSION) || defined(V4L2_MINOR_VERSION)
 #error too early v4l2 version or no v4l2 at all
 #endif
-    ], [
+    ]], [[
 return 0;
-    ], [
+    ]])],[
       HAVE_GST_V4L2="yes"
       AC_MSG_RESULT(yes)
-    ], [
+    ],[
       HAVE_GST_V4L2="no"
       AC_MSG_RESULT(no)
 
@@ -552,7 +560,7 @@ return 0;
     dnl check for missing v4l2_buffer declaration (see #135919)
     MISSING_DECL=0
     AC_MSG_CHECKING(struct v4l2_buffer declaration)
-    AC_TRY_COMPILE([
+    AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
 #include <sys/types.h>
 #ifdef __sun /* Solaris */
 #include <sys/types.h>
@@ -563,11 +571,11 @@ return 0;
 #define __user
 #include <linux/videodev2.h>
 #endif
-    ],[
+    ]], [[
 struct v4l2_buffer buf;
 buf.index = 0;
 return 0;
-    ], [ AC_MSG_RESULT(yes) ], [ MISSING_DECL=1 && AC_MSG_RESULT(no) ])
+    ]])],[ AC_MSG_RESULT(yes) ],[ MISSING_DECL=1 && AC_MSG_RESULT(no) ])
     if [ test x$MISSING_DECL = x1 ]; then
       AC_DEFINE(GST_V4L2_MISSING_BUFDECL, 1, [struct v4l2_buffer missing])
     fi
@@ -579,8 +587,7 @@ return 0;
 
 # Optional gudev for device probing
 AC_ARG_WITH([gudev],
-  AC_HELP_STRING([--with-gudev],
-    [device detection with gudev]),
+  AS_HELP_STRING([--with-gudev],[device detection with gudev]),
   [],
   [with_gudev=check])
 if test x$HAVE_GST_V4L2 = xyes; then
@@ -602,8 +609,7 @@ AC_SUBST(GUDEV_LIBS)
 
 # Make libv4l2 non-automagic
 AC_ARG_WITH([libv4l2],
-  AC_HELP_STRING([--with-libv4l2],
-    [support video buffer conversion using libv4l2]),
+  AS_HELP_STRING([--with-libv4l2],[support video buffer conversion using libv4l2]),
   [],
   [with_libv4l2=check])
 if test x$HAVE_GST_V4L2 = xyes; then
@@ -910,7 +916,7 @@ AG_GST_CHECK_FEATURE(SOUP, [soup http client plugin (2.4)], souphttpsrc, [
     HAVE_SOUP="yes"
     AC_DEFINE(HAVE_LIBSOUP_GNOME, 1, [soup gnome integration])
   ],[
-    PKG_CHECK_MODULES(SOUP, libsoup-2.4 >= 2.26, HAVE_SOUP="yes", [
+    PKG_CHECK_MODULES(SOUP, libsoup-2.4 >= 2.26.1, HAVE_SOUP="yes", [
       HAVE_SOUP="no"
     ])
   ])
@@ -1046,6 +1052,7 @@ AM_CONDITIONAL(USE_SOUP, false)
 AM_CONDITIONAL(USE_SPEEX, false)
 AM_CONDITIONAL(USE_SUNAUDIO, false)
 AM_CONDITIONAL(USE_TAGLIB, false)
+AM_CONDITIONAL(USE_WAVEFORM, false)
 AM_CONDITIONAL(USE_WAVPACK, false)
 AM_CONDITIONAL(USE_X, false)
 AM_CONDITIONAL(USE_XSHM, false)
@@ -1078,12 +1085,14 @@ else
 fi
 AC_SUBST(DEPRECATED_CFLAGS)
 
-dnl every flag in GST_OPTION_CFLAGS and GST_OPTION_CXXFLAGS can be overridden
+dnl every flag in GST_OPTION_CFLAGS, GST_OPTION_CXXFLAGS and GST_OPTION_OBJCFLAGS can be overridden
 dnl at make time with e.g. make ERROR_CFLAGS=""
 GST_OPTION_CFLAGS="\$(WARNING_CFLAGS) \$(ERROR_CFLAGS) \$(DEBUG_CFLAGS) \$(PROFILE_CFLAGS) \$(GCOV_CFLAGS) \$(OPT_CFLAGS) \$(DEPRECATED_CFLAGS)"
 GST_OPTION_CXXFLAGS="\$(WARNING_CXXFLAGS) \$(ERROR_CXXFLAGS) \$(DEBUG_CFLAGS) \$(PROFILE_CFLAGS) \$(GCOV_CFLAGS) \$(OPT_CFLAGS) \$(DEPRECATED_CFLAGS)"
+GST_OPTION_OBJCFLAGS="\$(WARNING_OBJCFLAGS) \$(ERROR_OBJCFLAGS) \$(DEBUG_CFLAGS) \$(PROFILE_CFLAGS) \$(GCOV_CFLAGS) \$(OPT_CFLAGS) \$(DEPRECATED_CFLAGS)"
 AC_SUBST(GST_OPTION_CFLAGS)
 AC_SUBST(GST_OPTION_CXXFLAGS)
+AC_SUBST(GST_OPTION_OBJCFLAGS)
 
 dnl our libraries need to be versioned correctly
 AC_SUBST(GST_LT_LDFLAGS)
@@ -1093,9 +1102,11 @@ dnl prefer internal headers to already installed ones
 dnl also add builddir include for enumtypes and marshal
 dnl add ERROR_CFLAGS, but overridable
 GST_CXXFLAGS="-I\$(top_srcdir)/gst-libs $GST_CFLAGS $GLIB_EXTRA_CFLAGS \$(GST_OPTION_CXXFLAGS)"
+GST_OBJCFLAGS="-I\$(top_srcdir)/gst-libs $GST_CFLAGS $GLIB_EXTRA_CFLAGS \$(GST_OPTION_OBJCFLAGS)"
 GST_CFLAGS="-I\$(top_srcdir)/gst-libs $GST_CFLAGS $GLIB_EXTRA_CFLAGS \$(GST_OPTION_CFLAGS)"
 AC_SUBST(GST_CFLAGS)
 AC_SUBST(GST_CXXFLAGS)
+AC_SUBST(GST_OBJCFLAGS)
 AC_SUBST(GST_LIBS)
 
 dnl LDFLAGS really should only contain flags, not libs - they get added before
diff --git a/docs/random/PORTED_09 b/docs/random/PORTED_09
new file mode 100644
index 0000000..f96297d
--- /dev/null
+++ b/docs/random/PORTED_09
@@ -0,0 +1,20 @@
+When porting a plugin start with 0.8 CVS head, not the old code in this module. There are many bugfixes which have gone into 0.8 which you want to keep.
+
+List of ported plugins (update when you commit a ported plugin):
+speexenc (alima)
+auparse (alima)
+effectv (wim)
+mad	(wim)
+videofilter (wim)
+aalib	(wim)
+libcaca	(zeeshan)
+law	(wim)
+shout2  (zaheer) - not fully tested
+esdsink (arwed)
+multipart (dolphy)
+
+osssink is partially done in the threaded branch (wim)
+
+- Remember that some plugins are already ported and now in the gst-plugins-base module.
+
+When you have ported a plugin remember to copy the relevant parts from configure.ac.orig into configure.ac and re-enable it in the Makefile.am files.
diff --git a/ext/Makefile.am b/ext/Makefile.am
index 409408e..cac026e 100644
--- a/ext/Makefile.am
+++ b/ext/Makefile.am
@@ -70,12 +70,6 @@ else
 LIBDV_DIR =
 endif
 
-# if USE_LIBMNG
-# LIBMNG_DIR = libmng
-# else
-LIBMNG_DIR =
-# endif
-
 if USE_LIBPNG
 LIBPNG_DIR = libpng
 else
diff --git a/ext/Makefile.in b/ext/Makefile.in
index ab5eeca..29312e3 100644
--- a/ext/Makefile.in
+++ b/ext/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -20,6 +19,23 @@
 # descending into all subdirectories a second time, but only after the first
 # (parallel) run has finished, so it should go right through the second time.
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -38,6 +54,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
 	$(top_srcdir)/common/parallel-subdirs.mak
 subdir = ext
@@ -46,7 +63,6 @@ am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -84,12 +100,18 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
 RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
@@ -99,6 +121,11 @@ RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
@@ -187,6 +214,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -235,8 +263,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -317,7 +347,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -377,6 +407,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -450,7 +481,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -478,13 +513,7 @@ top_srcdir = @top_srcdir@
 @USE_LIBCACA_TRUE@LIBCACA_DIR = libcaca
 @USE_LIBDV_FALSE@LIBDV_DIR = 
 @USE_LIBDV_TRUE@LIBDV_DIR = dv
-
-# if USE_LIBMNG
-# LIBMNG_DIR = libmng
-# else
-LIBMNG_DIR = 
 @USE_LIBPNG_FALSE@LIBPNG_DIR = 
-# endif
 @USE_LIBPNG_TRUE@LIBPNG_DIR = libpng
 
 # if USE_MIKMOD
@@ -594,12 +623,12 @@ clean-libtool:
 	-rm -rf .libs _libs
 
 # This directory's subdirectories are mostly independent; you can cd
-# into them and run `make' without going through this Makefile.
-# To change the values of `make' variables: instead of editing Makefiles,
-# (1) if the variable is set in `config.status', edit `config.status'
-#     (which will cause the Makefiles to be regenerated when you run `make');
-# (2) otherwise, pass the desired values on the `make' command line.
-$(RECURSIVE_TARGETS):
+# into them and run 'make' without going through this Makefile.
+# To change the values of 'make' variables: instead of editing Makefiles,
+# (1) if the variable is set in 'config.status', edit 'config.status'
+#     (which will cause the Makefiles to be regenerated when you run 'make');
+# (2) otherwise, pass the desired values on the 'make' command line.
+$(RECURSIVE_TARGETS) $(RECURSIVE_CLEAN_TARGETS):
 	@fail= failcom='exit 1'; \
 	for f in x $$MAKEFLAGS; do \
 	  case $$f in \
@@ -609,7 +638,11 @@ $(RECURSIVE_TARGETS):
 	done; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
-	list='$(SUBDIRS)'; for subdir in $$list; do \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	for subdir in $$list; do \
 	  echo "Making $$target in $$subdir"; \
 	  if test "$$subdir" = "."; then \
 	    dot_seen=yes; \
@@ -623,37 +656,6 @@ $(RECURSIVE_TARGETS):
 	if test "$$dot_seen" = "no"; then \
 	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
 	fi; test -z "$$fail"
-
-$(RECURSIVE_CLEAN_TARGETS):
-	@fail= failcom='exit 1'; \
-	for f in x $$MAKEFLAGS; do \
-	  case $$f in \
-	    *=* | --[!k]*);; \
-	    *k*) failcom='fail=yes';; \
-	  esac; \
-	done; \
-	dot_seen=no; \
-	case "$@" in \
-	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
-	  *) list='$(SUBDIRS)' ;; \
-	esac; \
-	rev=''; for subdir in $$list; do \
-	  if test "$$subdir" = "."; then :; else \
-	    rev="$$subdir $$rev"; \
-	  fi; \
-	done; \
-	rev="$$rev ."; \
-	target=`echo $@ | sed s/-recursive//`; \
-	for subdir in $$rev; do \
-	  echo "Making $$target in $$subdir"; \
-	  if test "$$subdir" = "."; then \
-	    local_target="$$target-am"; \
-	  else \
-	    local_target="$$target"; \
-	  fi; \
-	  ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
-	  || eval $$failcom; \
-	done && test -z "$$fail"
 tags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
@@ -662,6 +664,10 @@ ctags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
 	done
+cscopelist-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) cscopelist); \
+	done
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -725,6 +731,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist: cscopelist-recursive $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -760,13 +780,10 @@ distdir: $(DISTFILES)
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -887,22 +904,23 @@ ps-am:
 
 uninstall-am:
 
-.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) ctags-recursive \
-	install-am install-strip tags-recursive
+.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) \
+	cscopelist-recursive ctags-recursive install-am install-strip \
+	tags-recursive
 
 .PHONY: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) CTAGS GTAGS \
 	all all-am check check-am clean clean-generic clean-libtool \
-	ctags ctags-recursive distclean distclean-generic \
-	distclean-libtool distclean-tags distdir dvi dvi-am html \
-	html-am info info-am install install-am install-data \
-	install-data-am install-dvi install-dvi-am install-exec \
-	install-exec-am install-html install-html-am install-info \
-	install-info-am install-man install-pdf install-pdf-am \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs installdirs-am maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-generic \
-	mostlyclean-libtool pdf pdf-am ps ps-am tags tags-recursive \
-	uninstall uninstall-am
+	cscopelist cscopelist-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-libtool distclean-tags \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-dvi \
+	install-dvi-am install-exec install-exec-am install-html \
+	install-html-am install-info install-info-am install-man \
+	install-pdf install-pdf-am install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	mostlyclean mostlyclean-generic mostlyclean-libtool pdf pdf-am \
+	ps ps-am tags tags-recursive uninstall uninstall-am
 
 
 .PHONY: independent-subdirs $(SUBDIRS)
diff --git a/ext/aalib/Makefile.in b/ext/aalib/Makefile.in
index 2e9e138..0168005 100644
--- a/ext/aalib/Makefile.in
+++ b/ext/aalib/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/aalib
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -118,10 +134,23 @@ libgstaasink_la_OBJECTS = $(am_libgstaasink_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstaasink_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstaasink_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstaasink_la_CFLAGS) $(CFLAGS) \
 	$(libgstaasink_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -134,22 +163,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstaasink_la_SOURCES)
 DIST_SOURCES = $(libgstaasink_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -209,6 +239,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -257,8 +288,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -339,7 +372,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -399,6 +432,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -472,7 +506,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -519,7 +557,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -527,6 +564,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -542,12 +581,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstaasink.la: $(libgstaasink_la_OBJECTS) $(libgstaasink_la_DEPENDENCIES) $(EXTRA_libgstaasink_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstaasink_la_LINK) -rpath $(plugindir) $(libgstaasink_la_OBJECTS) $(libgstaasink_la_LIBADD) $(LIBS)
 
@@ -642,6 +683,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -786,18 +841,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/annodex/Makefile.in b/ext/annodex/Makefile.in
index 5dc3209..c444be9 100644
--- a/ext/annodex/Makefile.in
+++ b/ext/annodex/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/annodex
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -123,10 +139,23 @@ libgstannodex_la_OBJECTS = $(am_libgstannodex_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstannodex_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstannodex_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstannodex_la_CFLAGS) $(CFLAGS) \
 	$(libgstannodex_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -139,22 +168,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstannodex_la_SOURCES)
 DIST_SOURCES = $(libgstannodex_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -214,6 +244,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -262,8 +293,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -344,7 +377,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -404,6 +437,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -477,7 +511,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -537,7 +575,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -545,6 +582,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -560,12 +599,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstannodex.la: $(libgstannodex_la_OBJECTS) $(libgstannodex_la_DEPENDENCIES) $(EXTRA_libgstannodex_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstannodex_la_LINK) -rpath $(plugindir) $(libgstannodex_la_OBJECTS) $(libgstannodex_la_LIBADD) $(LIBS)
 
@@ -700,6 +741,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -844,18 +899,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/annodex/gstannodex.c b/ext/annodex/gstannodex.c
index 05e10c8..72ea88d 100644
--- a/ext/annodex/gstannodex.c
+++ b/ext/annodex/gstannodex.c
@@ -21,6 +21,10 @@
  * Boston, MA 02111-1307, USA.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
diff --git a/ext/annodex/gstcmmlparser.c b/ext/annodex/gstcmmlparser.c
index 0e2f7cd..b76cf4a 100644
--- a/ext/annodex/gstcmmlparser.c
+++ b/ext/annodex/gstcmmlparser.c
@@ -21,6 +21,10 @@
  * Boston, MA 02111-1307, USA.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #include <string.h>
 #include <stdarg.h>
 #include <gst/gst.h>
diff --git a/ext/annodex/gstcmmltag.c b/ext/annodex/gstcmmltag.c
index 2cf5d5f..8b2a189 100644
--- a/ext/annodex/gstcmmltag.c
+++ b/ext/annodex/gstcmmltag.c
@@ -21,6 +21,10 @@
  * Boston, MA 02111-1307, USA.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
diff --git a/ext/cairo/Makefile.in b/ext/cairo/Makefile.in
index 84b71b4..11e859d 100644
--- a/ext/cairo/Makefile.in
+++ b/ext/cairo/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -25,6 +24,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -43,15 +59,16 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(am__noinst_HEADERS_DIST) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/gst-glib-gen.mak
+	$(srcdir)/Makefile.in $(top_srcdir)/common/gst-glib-gen.mak \
+	$(top_srcdir)/depcomp
 subdir = ext/cairo
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -139,10 +156,23 @@ libgstcairo_la_OBJECTS = $(am_libgstcairo_la_OBJECTS) \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstcairo_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstcairo_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstcairo_la_CFLAGS) $(CFLAGS) \
 	$(libgstcairo_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -155,22 +185,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstcairo_la_SOURCES) $(nodist_libgstcairo_la_SOURCES)
 DIST_SOURCES = $(am__libgstcairo_la_SOURCES_DIST)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 am__noinst_HEADERS_DIST = gsttimeoverlay.h gsttextoverlay.h \
 	gstcairorender.h gstcairooverlay.h
 HEADERS = $(noinst_HEADERS)
@@ -232,6 +263,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -280,8 +312,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -362,7 +396,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -422,6 +456,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -495,7 +530,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -576,7 +615,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -584,6 +622,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -599,12 +639,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstcairo.la: $(libgstcairo_la_OBJECTS) $(libgstcairo_la_DEPENDENCIES) $(EXTRA_libgstcairo_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstcairo_la_LINK) -rpath $(plugindir) $(libgstcairo_la_OBJECTS) $(libgstcairo_la_LIBADD) $(LIBS)
 
@@ -739,6 +781,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -887,18 +943,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # these are all the rules generating the relevant files
diff --git a/ext/cairo/gsttextoverlay.c b/ext/cairo/gsttextoverlay.c
index 8cb39cc..f8da308 100644
--- a/ext/cairo/gsttextoverlay.c
+++ b/ext/cairo/gsttextoverlay.c
@@ -106,7 +106,7 @@ static gboolean gst_text_overlay_setcaps (GstPad * pad, GstCaps * caps);
 static GstPadLinkReturn gst_text_overlay_text_pad_linked (GstPad * pad,
     GstPad * peer);
 static void gst_text_overlay_text_pad_unlinked (GstPad * pad);
-static GstFlowReturn gst_text_overlay_collected (GstCollectPads * pads,
+static GstFlowReturn gst_text_overlay_collected (GstCollectPads2 * pads,
     gpointer data);
 static void gst_text_overlay_finalize (GObject * object);
 static void gst_text_overlay_font_init (GstCairoTextOverlay * overlay);
@@ -215,7 +215,7 @@ gst_text_overlay_finalize (GObject * object)
 {
   GstCairoTextOverlay *overlay = GST_CAIRO_TEXT_OVERLAY (object);
 
-  gst_collect_pads_stop (overlay->collect);
+  gst_collect_pads2_stop (overlay->collect);
   gst_object_unref (overlay->collect);
 
   g_free (overlay->text_fill_image);
@@ -279,16 +279,16 @@ gst_text_overlay_init (GstCairoTextOverlay * overlay,
   overlay->fps_n = 0;
   overlay->fps_d = 1;
 
-  overlay->collect = gst_collect_pads_new ();
+  overlay->collect = gst_collect_pads2_new ();
 
-  gst_collect_pads_set_function (overlay->collect,
+  gst_collect_pads2_set_function (overlay->collect,
       GST_DEBUG_FUNCPTR (gst_text_overlay_collected), overlay);
 
-  overlay->video_collect_data = gst_collect_pads_add_pad (overlay->collect,
-      overlay->video_sinkpad, sizeof (GstCollectData));
+  overlay->video_collect_data = gst_collect_pads2_add_pad (overlay->collect,
+      overlay->video_sinkpad, sizeof (GstCollectData2));
 
   /* FIXME: hacked way to override/extend the event function of
-   * GstCollectPads; because it sets its own event function giving the
+   * GstCollectPads2; because it sets its own event function giving the
    * element no access to events. Nicked from avimux. */
   overlay->collect_event =
       (GstPadEventFunction) GST_PAD_EVENTFUNC (overlay->video_sinkpad);
@@ -640,8 +640,8 @@ gst_text_overlay_text_pad_linked (GstPad * pad, GstPad * peer)
   GST_DEBUG_OBJECT (overlay, "Text pad linked");
 
   if (overlay->text_collect_data == NULL) {
-    overlay->text_collect_data = gst_collect_pads_add_pad (overlay->collect,
-        overlay->text_sinkpad, sizeof (GstCollectData));
+    overlay->text_collect_data = gst_collect_pads2_add_pad (overlay->collect,
+        overlay->text_sinkpad, sizeof (GstCollectData2));
   }
 
   overlay->need_render = TRUE;
@@ -660,7 +660,7 @@ gst_text_overlay_text_pad_unlinked (GstPad * pad)
   GST_DEBUG_OBJECT (overlay, "Text pad unlinked");
 
   if (overlay->text_collect_data) {
-    gst_collect_pads_remove_pad (overlay->collect, overlay->text_sinkpad);
+    gst_collect_pads2_remove_pad (overlay->collect, overlay->text_sinkpad);
     overlay->text_collect_data = NULL;
   }
 
@@ -807,7 +807,7 @@ gst_text_overlay_pop_video (GstCairoTextOverlay * overlay)
 {
   GstBuffer *buf;
 
-  buf = gst_collect_pads_pop (overlay->collect, overlay->video_collect_data);
+  buf = gst_collect_pads2_pop (overlay->collect, overlay->video_collect_data);
   g_return_if_fail (buf != NULL);
   gst_buffer_unref (buf);
 }
@@ -818,7 +818,7 @@ gst_text_overlay_pop_text (GstCairoTextOverlay * overlay)
   GstBuffer *buf;
 
   if (overlay->text_collect_data) {
-    buf = gst_collect_pads_pop (overlay->collect, overlay->text_collect_data);
+    buf = gst_collect_pads2_pop (overlay->collect, overlay->text_collect_data);
     g_return_if_fail (buf != NULL);
     gst_buffer_unref (buf);
   }
@@ -828,7 +828,7 @@ gst_text_overlay_pop_text (GstCairoTextOverlay * overlay)
 
 /* This function is called when there is data on all pads */
 static GstFlowReturn
-gst_text_overlay_collected (GstCollectPads * pads, gpointer data)
+gst_text_overlay_collected (GstCollectPads2 * pads, gpointer data)
 {
   GstCairoTextOverlay *overlay;
   GstFlowReturn ret = GST_FLOW_OK;
@@ -842,14 +842,14 @@ gst_text_overlay_collected (GstCollectPads * pads, gpointer data)
 
   GST_DEBUG ("Collecting");
 
-  video_frame = gst_collect_pads_peek (overlay->collect,
+  video_frame = gst_collect_pads2_peek (overlay->collect,
       overlay->video_collect_data);
 
   /* send EOS if video stream EOSed regardless of text stream */
   if (video_frame == NULL) {
     GST_DEBUG ("Video stream at EOS");
     if (overlay->text_collect_data) {
-      text_buf = gst_collect_pads_pop (overlay->collect,
+      text_buf = gst_collect_pads2_pop (overlay->collect,
           overlay->text_collect_data);
     }
     gst_pad_push_event (overlay->srcpad, gst_event_new_eos ());
@@ -892,7 +892,7 @@ gst_text_overlay_collected (GstCollectPads * pads, gpointer data)
     goto done;
   }
 
-  text_buf = gst_collect_pads_peek (overlay->collect,
+  text_buf = gst_collect_pads2_peek (overlay->collect,
       overlay->text_collect_data);
 
   /* just push the video frame if the text stream has EOSed */
@@ -1004,7 +1004,7 @@ gst_text_overlay_video_event (GstPad * pad, GstEvent * event)
     gst_pad_push_event (overlay->srcpad, event);
   }
 
-  /* now GstCollectPads can take care of the rest, e.g. EOS */
+  /* now GstCollectPads2 can take care of the rest, e.g. EOS */
   ret = overlay->collect_event (pad, event);
   gst_object_unref (overlay);
   return ret;
@@ -1018,12 +1018,12 @@ gst_text_overlay_change_state (GstElement * element, GstStateChange transition)
 
   switch (transition) {
     case GST_STATE_CHANGE_READY_TO_PAUSED:
-      gst_collect_pads_start (overlay->collect);
+      gst_collect_pads2_start (overlay->collect);
       break;
     case GST_STATE_CHANGE_PAUSED_TO_READY:
       /* need to unblock the collectpads before calling the
        * parent change_state so that streaming can finish */
-      gst_collect_pads_stop (overlay->collect);
+      gst_collect_pads2_stop (overlay->collect);
       break;
     default:
       break;
diff --git a/ext/cairo/gsttextoverlay.h b/ext/cairo/gsttextoverlay.h
index dbb2154..1f98d3d 100644
--- a/ext/cairo/gsttextoverlay.h
+++ b/ext/cairo/gsttextoverlay.h
@@ -3,7 +3,7 @@
 #define __GST_CAIRO_TEXT_OVERLAY_H__
 
 #include <gst/gst.h>
-#include <gst/base/gstcollectpads.h>
+#include <gst/base/gstcollectpads2.h>
 
 G_BEGIN_DECLS
 
@@ -45,9 +45,9 @@ struct _GstCairoTextOverlay {
     GstPad               *text_sinkpad;
     GstPad               *srcpad;
 
-    GstCollectPads       *collect;
-    GstCollectData       *video_collect_data;
-    GstCollectData       *text_collect_data;
+    GstCollectPads2      *collect;
+    GstCollectData2      *video_collect_data;
+    GstCollectData2      *text_collect_data;
     GstPadEventFunction   collect_event;
 
     gint                  width;
diff --git a/ext/dv/Makefile.in b/ext/dv/Makefile.in
index bb9c93e..d08b002 100644
--- a/ext/dv/Makefile.in
+++ b/ext/dv/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -18,6 +17,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -36,16 +52,16 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 noinst_PROGRAMS = smpte_test$(EXEEXT)
 subdir = ext/dv
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -121,6 +137,7 @@ libgstdv_la_OBJECTS = $(am_libgstdv_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstdv_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstdv_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstdv_la_CFLAGS) $(CFLAGS) $(libgstdv_la_LDFLAGS) \
@@ -133,6 +150,18 @@ smpte_test_DEPENDENCIES = $(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
 smpte_test_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(smpte_test_CFLAGS) \
 	$(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -145,22 +174,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstdv_la_SOURCES) $(smpte_test_SOURCES)
 DIST_SOURCES = $(libgstdv_la_SOURCES) $(smpte_test_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -220,6 +250,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -268,8 +299,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -350,7 +383,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -410,6 +443,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -483,7 +517,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -537,7 +575,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -545,6 +582,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -560,12 +599,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstdv.la: $(libgstdv_la_OBJECTS) $(libgstdv_la_DEPENDENCIES) $(EXTRA_libgstdv_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstdv_la_LINK) -rpath $(plugindir) $(libgstdv_la_OBJECTS) $(libgstdv_la_LIBADD) $(LIBS)
 
@@ -726,6 +767,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -871,7 +926,7 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
 	clean-libtool clean-noinstPROGRAMS clean-pluginLTLIBRARIES \
-	ctags distclean distclean-compile distclean-generic \
+	cscopelist ctags distclean distclean-compile distclean-generic \
 	distclean-libtool distclean-tags distdir dvi dvi-am html \
 	html-am info info-am install install-am install-data \
 	install-data-am install-dvi install-dvi-am install-exec \
diff --git a/ext/esd/Makefile.in b/ext/esd/Makefile.in
index 0d5be60..ae697b3 100644
--- a/ext/esd/Makefile.in
+++ b/ext/esd/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/esd
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -120,10 +136,23 @@ libgstesd_la_OBJECTS = $(am_libgstesd_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstesd_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstesd_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstesd_la_CFLAGS) $(CFLAGS) \
 	$(libgstesd_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -136,22 +165,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstesd_la_SOURCES)
 DIST_SOURCES = $(libgstesd_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -211,6 +241,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -259,8 +290,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -341,7 +374,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -401,6 +434,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -474,7 +508,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -527,7 +565,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -535,6 +572,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -550,12 +589,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstesd.la: $(libgstesd_la_OBJECTS) $(libgstesd_la_DEPENDENCIES) $(EXTRA_libgstesd_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstesd_la_LINK) -rpath $(plugindir) $(libgstesd_la_OBJECTS) $(libgstesd_la_LIBADD) $(LIBS)
 
@@ -658,6 +699,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -802,18 +857,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/esd/esdmon.c b/ext/esd/esdmon.c
new file mode 100644
index 0000000..8b61b18
--- /dev/null
+++ b/ext/esd/esdmon.c
@@ -0,0 +1,465 @@
+/* GStreamer
+ * Copyright (C) <2001,2002> Richard Boulton <richard-gst@tartarus.org>
+ *
+ * Based on example.c:
+ * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+/**
+ * SECTION:element-esdmon
+ * @see_also: #GstAlsaSrc, #GstAutoAudioSrc
+ *
+ * This element records sound from an already-running Enlightened Sound Daemon
+ * (ESound Daemon, esd). Note that a sound daemon will never be auto-spawned
+ * through this element (regardless of the system configuration), since this
+ * is actively prevented by the element. If you must use esd, you need to
+ * make sure it is started automatically with your session or otherwise.
+ *
+ * TODO: insert some comments about how sucky esd is and that all the cool
+ * kids use pulseaudio or whatever these days.
+ * 
+ * <refsect2>
+ * <title>Example launch line</title>
+ * |[
+ * gst-launch esdmon ! audioconvert ! waveenc ! filesink location=record.wav
+ * ]| Record from audioinput
+ * </refsect2>
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+#include "esdmon.h"
+#include <esd.h>
+#include <unistd.h>
+
+/* Signals and args */
+enum
+{
+  /* FILL ME */
+  LAST_SIGNAL
+};
+
+enum
+{
+  ARG_0,
+  ARG_DEPTH,
+  ARG_BYTESPERREAD,
+  ARG_CUROFFSET,
+  ARG_CHANNELS,
+  ARG_RATE,
+  ARG_HOST
+};
+
+static GstStaticPadTemplate src_factory = GST_STATIC_PAD_TEMPLATE ("src",
+    GST_PAD_SRC,
+    GST_PAD_ALWAYS,
+    GST_STATIC_CAPS ("audio/x-raw-int, "
+        "endianness = (int) " G_STRINGIFY (G_BYTE_ORDER) ", "
+        "signed = (boolean) TRUE, "
+        "width = (int) 16, "
+        "depth = (int) 16, "
+        "rate = [ 8000, 96000 ], "
+        "channels = [ 1, 2 ]; "
+        "audio/x-raw-int, "
+        "signed = (boolean) FALSE, "
+        "width = (int) 8, "
+        "depth = (int) 8, " "rate = [ 8000, 96000 ], " "channels = [ 1, 2 ]")
+    );
+
+static void gst_esdmon_base_init (gpointer g_class);
+static void gst_esdmon_class_init (gpointer g_class, gpointer class_data);
+static void gst_esdmon_init (GTypeInstance * instance, gpointer g_class);
+
+static gboolean gst_esdmon_open_audio (GstEsdmon * src);
+static void gst_esdmon_close_audio (GstEsdmon * src);
+static GstStateChangeReturn gst_esdmon_change_state (GstElement * element,
+    GstStateChange transition);
+static gboolean gst_esdmon_sync_parms (GstEsdmon * esdmon);
+
+static GstData *gst_esdmon_get (GstPad * pad);
+
+static void gst_esdmon_set_property (GObject * object, guint prop_id,
+    const GValue * value, GParamSpec * pspec);
+static void gst_esdmon_get_property (GObject * object, guint prop_id,
+    GValue * value, GParamSpec * pspec);
+
+#define GST_TYPE_ESDMON_DEPTHS (gst_esdmon_depths_get_type())
+static GType
+gst_esdmon_depths_get_type (void)
+{
+  static GType esdmon_depths_type = 0;
+  static const GEnumValue esdmon_depths[] = {
+    {8, "8 Bits", "8"},
+    {16, "16 Bits", "16"},
+    {0, NULL, NULL},
+  };
+
+  if (!esdmon_depths_type) {
+    esdmon_depths_type =
+        g_enum_register_static ("GstEsdmonDepths", esdmon_depths);
+  }
+  return esdmon_depths_type;
+}
+
+#define GST_TYPE_ESDMON_CHANNELS (gst_esdmon_channels_get_type())
+static GType
+gst_esdmon_channels_get_type (void)
+{
+  static GType esdmon_channels_type = 0;
+  static const GEnumValue esdmon_channels[] = {
+    {1, "Mono", "mono"},
+    {2, "Stereo", "stereo"},
+    {0, NULL, NULL},
+  };
+
+  if (!esdmon_channels_type) {
+    esdmon_channels_type =
+        g_enum_register_static ("GstEsdmonChannels", esdmon_channels);
+  }
+  return esdmon_channels_type;
+}
+
+
+static GstElementClass *parent_class = NULL;
+
+/*static guint gst_esdmon_signals[LAST_SIGNAL] = { 0 }; */
+
+GType
+gst_esdmon_get_type (void)
+{
+  static GType esdmon_type = 0;
+
+  if (!esdmon_type) {
+    static const GTypeInfo esdmon_info = {
+      sizeof (GstEsdmonClass),
+      gst_esdmon_base_init,
+      NULL,
+      gst_esdmon_class_init,
+      NULL,
+      NULL,
+      sizeof (GstEsdmon),
+      0,
+      gst_esdmon_init,
+    };
+
+    esdmon_type =
+        g_type_register_static (GST_TYPE_ELEMENT, "GstEsdmon", &esdmon_info, 0);
+  }
+  return esdmon_type;
+}
+
+static void
+gst_esdmon_base_init (gpointer g_class)
+{
+  GstElementClass *element_class = GST_ELEMENT_CLASS (g_class);
+
+  gst_element_class_add_static_pad_template (element_class, &src_factory);
+  gst_element_class_set_details_simple (element_class, "Esound audio monitor",
+      "Source/Audio",
+      "Monitors audio from an esound server",
+      "Richard Boulton <richard-gst@tartarus.org>");
+}
+
+static void
+gst_esdmon_class_init (gpointer g_class, gpointer class_data)
+{
+  GObjectClass *gobject_class = G_OBJECT_CLASS (g_class);
+  GstElementClass *gstelement_class = GST_ELEMENT_CLASS (g_class);
+
+  parent_class = g_type_class_peek_parent (g_class);
+
+  /* FIXME: add long property descriptions */
+  g_object_class_install_property (gobject_class, ARG_BYTESPERREAD,
+      g_param_spec_ulong ("bytes-per-read", "bytes per read", "bytes per read",
+          0, G_MAXULONG, 0, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (gobject_class, ARG_CUROFFSET,
+      g_param_spec_ulong ("curoffset", "curoffset", "curoffset",
+          0, G_MAXULONG, 0, G_PARAM_READABLE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (gobject_class, ARG_DEPTH,
+      g_param_spec_enum ("depth", "depth", "depth", GST_TYPE_ESDMON_DEPTHS,
+          16, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (gobject_class, ARG_CHANNELS,
+      g_param_spec_enum ("channels", "channels", "channels",
+          GST_TYPE_ESDMON_CHANNELS, 2,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (gobject_class, ARG_RATE,
+      g_param_spec_int ("frequency", "frequency", "frequency",
+          G_MININT, G_MAXINT, 0, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (gobject_class, ARG_HOST,
+      g_param_spec_string ("host", "host", "host", NULL,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
+  gobject_class->set_property = gst_esdmon_set_property;
+  gobject_class->get_property = gst_esdmon_get_property;
+
+  gstelement_class->change_state = gst_esdmon_change_state;
+}
+
+static void
+gst_esdmon_init (GTypeInstance * instance, gpointer g_class)
+{
+  GstEsdmon *esdmon = GST_ESDMON (instance);
+
+  esdmon->srcpad =
+      gst_pad_new_from_template (gst_element_class_get_pad_template
+      (GST_ELEMENT_GET_CLASS (esdmon), "src"), "src");
+  gst_pad_set_get_function (esdmon->srcpad, gst_esdmon_get);
+  gst_pad_use_explicit_caps (esdmon->srcpad);
+  gst_element_add_pad (GST_ELEMENT (esdmon), esdmon->srcpad);
+
+  esdmon->fd = -1;
+  /* FIXME: get default from somewhere better than just putting them inline. */
+  esdmon->depth = 16;
+  esdmon->channels = 2;
+  esdmon->frequency = 44100;
+  esdmon->host = NULL;
+  esdmon->bytes_per_read = 4096;
+  esdmon->curoffset = 0;
+  esdmon->basetime = 0;
+  esdmon->samples_since_basetime = 0;
+}
+
+static gboolean
+gst_esdmon_sync_parms (GstEsdmon * esdmon)
+{
+  g_return_val_if_fail (esdmon != NULL, FALSE);
+  g_return_val_if_fail (GST_IS_ESDMON (esdmon), FALSE);
+
+  if (esdmon->fd == -1)
+    return TRUE;
+
+  /* Need to set fd to use new parameters: only way to do this is to reopen. */
+  gst_esdmon_close_audio (esdmon);
+  return gst_esdmon_open_audio (esdmon);
+}
+
+static GstData *
+gst_esdmon_get (GstPad * pad)
+{
+  GstEsdmon *esdmon;
+  GstBuffer *buf;
+  glong readbytes;
+  glong readsamples;
+
+  g_return_val_if_fail (pad != NULL, NULL);
+  esdmon = GST_ESDMON (gst_pad_get_parent (pad));
+
+  GST_DEBUG ("attempting to read something from esdmon");
+
+  buf = gst_buffer_new ();
+  g_return_val_if_fail (buf, NULL);
+
+  GST_BUFFER_DATA (buf) = (gpointer) g_malloc (esdmon->bytes_per_read);
+
+  readbytes = read (esdmon->fd, GST_BUFFER_DATA (buf), esdmon->bytes_per_read);
+
+  if (readbytes == 0) {
+    gst_element_set_eos (GST_ELEMENT (esdmon));
+    return NULL;
+  }
+  if (!GST_PAD_CAPS (pad)) {
+    GstCaps *caps = gst_caps_new_simple ("audio/x-raw-int",
+        "endianness", G_TYPE_INT, G_BYTE_ORDER,
+        "signed", G_TYPE_BOOLEAN, esdmon->depth == 8 ? FALSE : TRUE,
+        "width", G_TYPE_INT, esdmon->depth,
+        "depth", G_TYPE_INT, esdmon->depth,
+        "rate", G_TYPE_INT, esdmon->frequency,
+        "channels", G_TYPE_INT, esdmon->channels,
+        NULL);
+
+    /* set caps on src pad */
+    if (gst_pad_set_explicit_caps (esdmon->srcpad, caps) <= 0) {
+      GST_ELEMENT_ERROR (esdmon, CORE, NEGOTIATION, (NULL), (NULL));
+      gst_caps_free (caps);
+      return NULL;
+    }
+    gst_caps_free (caps);
+  }
+
+  GST_BUFFER_SIZE (buf) = readbytes;
+  GST_BUFFER_OFFSET (buf) = esdmon->curoffset;
+  GST_BUFFER_TIMESTAMP (buf) = esdmon->basetime +
+      esdmon->samples_since_basetime * GST_SECOND / esdmon->frequency;
+
+  esdmon->curoffset += readbytes;
+  readsamples = readbytes / esdmon->channels;
+  if (esdmon->depth == 16)
+    readsamples /= 2;
+  esdmon->samples_since_basetime += readsamples;
+
+  GST_DEBUG ("pushed buffer from esdmon of %ld bytes, timestamp %"
+      G_GINT64_FORMAT, readbytes, GST_BUFFER_TIMESTAMP (buf));
+  gst_object_unref (esdmon);
+  return GST_DATA (buf);
+}
+
+static void
+gst_esdmon_set_property (GObject * object, guint prop_id, const GValue * value,
+    GParamSpec * pspec)
+{
+  GstEsdmon *esdmon;
+
+  g_return_if_fail (GST_IS_ESDMON (object));
+  esdmon = GST_ESDMON (object);
+
+  switch (prop_id) {
+    case ARG_BYTESPERREAD:
+      esdmon->bytes_per_read = g_value_get_ulong (value);
+      /* No need to sync params - will just happen on next read. */
+      break;
+    case ARG_DEPTH:
+      esdmon->depth = g_value_get_enum (value);
+      gst_esdmon_sync_parms (esdmon);
+      break;
+    case ARG_CHANNELS:
+      esdmon->channels = g_value_get_enum (value);
+      gst_esdmon_sync_parms (esdmon);
+      break;
+    case ARG_RATE:
+      /* Preserve the timestamps */
+      esdmon->basetime =
+          esdmon->samples_since_basetime * GST_SECOND / esdmon->frequency;
+      esdmon->samples_since_basetime = 0;
+
+      /* Set the new frequency */
+      esdmon->frequency = g_value_get_int (value);
+      gst_esdmon_sync_parms (esdmon);
+      break;
+    case ARG_HOST:
+      if (esdmon->host != NULL)
+        g_free (esdmon->host);
+      if (g_value_get_string (value) == NULL)
+        esdmon->host = NULL;
+      else
+        esdmon->host = g_strdup (g_value_get_string (value));
+      break;
+    default:
+      break;
+  }
+}
+
+static void
+gst_esdmon_get_property (GObject * object, guint prop_id, GValue * value,
+    GParamSpec * pspec)
+{
+  GstEsdmon *esdmon;
+
+  g_return_if_fail (GST_IS_ESDMON (object));
+  esdmon = GST_ESDMON (object);
+
+  switch (prop_id) {
+    case ARG_BYTESPERREAD:
+      g_value_set_ulong (value, esdmon->bytes_per_read);
+      break;
+    case ARG_CUROFFSET:
+      g_value_set_ulong (value, esdmon->curoffset);
+      break;
+    case ARG_DEPTH:
+      g_value_set_enum (value, esdmon->depth);
+      break;
+    case ARG_CHANNELS:
+      g_value_set_enum (value, esdmon->channels);
+      break;
+    case ARG_RATE:
+      g_value_set_int (value, esdmon->frequency);
+      break;
+    case ARG_HOST:
+      g_value_set_string (value, esdmon->host);
+      break;
+    default:
+      G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
+      break;
+  }
+}
+
+static gboolean
+gst_esdmon_open_audio (GstEsdmon * src)
+{
+  /* Name used by esound for this connection. */
+  const char connname[] = "GStreamer";
+
+  /* Bitmap describing audio format. */
+  esd_format_t esdformat = ESD_STREAM | ESD_PLAY;
+
+  g_return_val_if_fail (src->fd == -1, FALSE);
+
+  if (src->depth == 16)
+    esdformat |= ESD_BITS16;
+  else if (src->depth == 8)
+    esdformat |= ESD_BITS8;
+  else {
+    GST_DEBUG ("esdmon: invalid bit depth (%d)", src->depth);
+    return FALSE;
+  }
+
+  if (src->channels == 2)
+    esdformat |= ESD_STEREO;
+  else if (src->channels == 1)
+    esdformat |= ESD_MONO;
+  else {
+    GST_DEBUG ("esdmon: invalid number of channels (%d)", src->channels);
+    return FALSE;
+  }
+
+  GST_DEBUG ("esdmon: attempting to open connection to esound server");
+  src->fd = esd_monitor_stream (esdformat, src->frequency, src->host, connname);
+  if (src->fd < 0) {
+    GST_DEBUG ("esdmon: can't open connection to esound server");
+    return FALSE;
+  }
+
+  GST_OBJECT_FLAG_SET (src, GST_ESDMON_OPEN);
+
+  return TRUE;
+}
+
+static void
+gst_esdmon_close_audio (GstEsdmon * src)
+{
+  if (src->fd < 0)
+    return;
+
+  close (src->fd);
+  src->fd = -1;
+
+  GST_OBJECT_FLAG_UNSET (src, GST_ESDMON_OPEN);
+
+  GST_DEBUG ("esdmon: closed sound device");
+}
+
+static GstStateChangeReturn
+gst_esdmon_change_state (GstElement * element, GstStateChange transition)
+{
+  g_return_val_if_fail (GST_IS_ESDMON (element), FALSE);
+
+  /* if going down into NULL state, close the fd if it's open */
+  if (GST_STATE_PENDING (element) == GST_STATE_NULL) {
+    if (GST_OBJECT_FLAG_IS_SET (element, GST_ESDMON_OPEN))
+      gst_esdmon_close_audio (GST_ESDMON (element));
+    /* otherwise (READY or higher) we need to open the fd */
+  } else {
+    if (!GST_OBJECT_FLAG_IS_SET (element, GST_ESDMON_OPEN)) {
+      if (!gst_esdmon_open_audio (GST_ESDMON (element)))
+        return GST_STATE_CHANGE_FAILURE;
+    }
+  }
+
+  if (GST_ELEMENT_CLASS (parent_class)->change_state)
+    return GST_ELEMENT_CLASS (parent_class)->change_state (element, transition);
+  return GST_STATE_CHANGE_SUCCESS;
+}
diff --git a/ext/flac/Makefile.in b/ext/flac/Makefile.in
index e02be9a..6de7ef5 100644
--- a/ext/flac/Makefile.in
+++ b/ext/flac/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/flac
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -121,10 +137,23 @@ libgstflac_la_OBJECTS = $(am_libgstflac_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstflac_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstflac_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstflac_la_CFLAGS) $(CFLAGS) \
 	$(libgstflac_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -137,22 +166,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstflac_la_SOURCES)
 DIST_SOURCES = $(libgstflac_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -212,6 +242,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -260,8 +291,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -342,7 +375,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -402,6 +435,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -475,7 +509,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -528,7 +566,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -536,6 +573,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -551,12 +590,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstflac.la: $(libgstflac_la_OBJECTS) $(libgstflac_la_DEPENDENCIES) $(EXTRA_libgstflac_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstflac_la_LINK) -rpath $(plugindir) $(libgstflac_la_OBJECTS) $(libgstflac_la_LIBADD) $(LIBS)
 
@@ -675,6 +716,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -819,18 +874,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/flac/gstflacdec.c b/ext/flac/gstflacdec.c
index 10f8916..35bfad8 100644
--- a/ext/flac/gstflacdec.c
+++ b/ext/flac/gstflacdec.c
@@ -445,6 +445,38 @@ gst_flac_dec_scan_got_frame (GstFlacDec * flacdec, guint8 * data, guint size,
   else if (sr == 0x0D || sr == 0x0E)
     sr_from_end = 16;
 
+  val = data[4];
+  /* This is slightly faster than a loop */
+  if (!(val & 0x80)) {
+    val = 0;
+  } else if ((val & 0xc0) && !(val & 0x20)) {
+    val = 1;
+  } else if ((val & 0xe0) && !(val & 0x10)) {
+    val = 2;
+  } else if ((val & 0xf0) && !(val & 0x08)) {
+    val = 3;
+  } else if ((val & 0xf8) && !(val & 0x04)) {
+    val = 4;
+  } else if ((val & 0xfc) && !(val & 0x02)) {
+    val = 5;
+  } else if ((val & 0xfe) && !(val & 0x01)) {
+    val = 6;
+  } else {
+    GST_LOG_OBJECT (flacdec, "failed to read sample/frame");
+    return FALSE;
+  }
+
+  val++;
+  headerlen = 4 + val + (bs_from_end / 8) + (sr_from_end / 8);
+
+  if (gst_flac_calculate_crc8 (data, headerlen) != data[headerlen]) {
+    GST_LOG_OBJECT (flacdec, "invalid checksum");
+    return FALSE;
+  }
+
+  if (!last_sample_num)
+    return TRUE;
+
   /* FIXME: This is can be 36 bit if variable block size is used,
    * fortunately not encoder supports this yet and we check for that
    * above.
@@ -456,14 +488,6 @@ gst_flac_dec_scan_got_frame (GstFlacDec * flacdec, guint8 * data, guint size,
     return FALSE;
   }
 
-  headerlen = 4 + g_unichar_to_utf8 ((gunichar) val, NULL) +
-      (bs_from_end / 8) + (sr_from_end / 8);
-
-  if (gst_flac_calculate_crc8 (data, headerlen) != data[headerlen]) {
-    GST_LOG_OBJECT (flacdec, "invalid checksum");
-    return FALSE;
-  }
-
   if (flacdec->min_blocksize == flacdec->max_blocksize) {
     *last_sample_num = (val + 1) * flacdec->min_blocksize;
   } else {
@@ -542,6 +566,26 @@ gst_flac_dec_scan_for_last_block (GstFlacDec * flacdec, gint64 * samples)
   }
 }
 
+static gboolean
+gst_flac_dec_handle_decoder_error (GstFlacDec * dec, gboolean msg)
+{
+  gboolean ret;
+
+  dec->error_count++;
+  if (dec->error_count > 10) {
+    if (msg)
+      GST_ELEMENT_ERROR (dec, STREAM, DECODE, (NULL), (NULL));
+    dec->last_flow = GST_FLOW_ERROR;
+    ret = TRUE;
+  } else {
+    GST_DEBUG_OBJECT (dec, "ignoring error for now at count %d",
+        dec->error_count);
+    ret = FALSE;
+  }
+
+  return ret;
+}
+
 static void
 gst_flac_extract_picture_buffer (GstFlacDec * dec,
     const FLAC__StreamMetadata * metadata)
@@ -672,8 +716,8 @@ gst_flac_dec_error_cb (const FLAC__StreamDecoder * d,
       break;
   }
 
-  GST_ELEMENT_ERROR (dec, STREAM, DECODE, (NULL), ("%s (%d)", error, status));
-  dec->last_flow = GST_FLOW_ERROR;
+  if (gst_flac_dec_handle_decoder_error (dec, FALSE))
+    GST_ELEMENT_ERROR (dec, STREAM, DECODE, (NULL), ("%s (%d)", error, status));
 }
 
 static FLAC__StreamDecoderSeekStatus
@@ -1023,6 +1067,9 @@ gst_flac_dec_write (GstFlacDec * flacdec, const FLAC__Frame * frame,
     g_assert_not_reached ();
   }
 
+  if (flacdec->error_count)
+    flacdec->error_count--;
+
   if (!flacdec->seeking) {
     GST_DEBUG_OBJECT (flacdec, "pushing %d samples at offset %" G_GINT64_FORMAT
         " (%" GST_TIME_FORMAT " + %" GST_TIME_FORMAT ")",
@@ -1418,11 +1465,9 @@ gst_flac_dec_chain (GstPad * pad, GstBuffer * buf)
   }
 
   if (dec->framed) {
-    gint64 unused;
-
     /* check if this is a flac audio frame (rather than a header or junk) */
     got_audio_frame = gst_flac_dec_scan_got_frame (dec, GST_BUFFER_DATA (buf),
-        GST_BUFFER_SIZE (buf), &unused);
+        GST_BUFFER_SIZE (buf), NULL);
 
     /* oggdemux will set granulepos in OFFSET_END instead of timestamp */
     if (G_LIKELY (got_audio_frame)) {
@@ -1503,6 +1548,15 @@ gst_flac_dec_chain (GstPad * pad, GstBuffer * buf)
     if (!FLAC__stream_decoder_process_single (dec->decoder)) {
       GST_DEBUG_OBJECT (dec, "process_single failed");
     }
+
+    if (FLAC__stream_decoder_get_state (dec->decoder) ==
+        FLAC__STREAM_DECODER_ABORTED) {
+      GST_WARNING_OBJECT (dec, "Read callback caused internal abort");
+      /* allow recovery */
+      gst_adapter_clear (dec->adapter);
+      FLAC__stream_decoder_flush (dec->decoder);
+      gst_flac_dec_handle_decoder_error (dec, TRUE);
+    }
   } else {
     GST_DEBUG_OBJECT (dec, "don't have all headers yet");
   }
@@ -2154,6 +2208,7 @@ gst_flac_dec_change_state (GstElement * element, GstStateChange transition)
       flacdec->width = 0;
       flacdec->sample_rate = 0;
       gst_segment_init (&flacdec->segment, GST_FORMAT_DEFAULT);
+      flacdec->error_count = 0;
       break;
     default:
       break;
diff --git a/ext/flac/gstflacdec.h b/ext/flac/gstflacdec.h
index 835bdbd..f3882a2 100644
--- a/ext/flac/gstflacdec.h
+++ b/ext/flac/gstflacdec.h
@@ -88,6 +88,8 @@ struct _GstFlacDec {
   guint16        max_blocksize;
 
   gint64         cur_granulepos; /* only used in framed mode (flac-in-ogg) */
+
+  gint           error_count;
 };
 
 struct _GstFlacDecClass {
diff --git a/ext/flac/gstflacenc.c b/ext/flac/gstflacenc.c
index 6a7e1c0..b4de217 100644
--- a/ext/flac/gstflacenc.c
+++ b/ext/flac/gstflacenc.c
@@ -225,7 +225,7 @@ static const GstFlacEncParams flacenc_params[] = {
 
 #define DEFAULT_QUALITY 5
 #define DEFAULT_PADDING 0
-#define DEFAULT_SEEKPOINTS 0
+#define DEFAULT_SEEKPOINTS -10
 
 #define GST_TYPE_FLAC_ENC_QUALITY (gst_flac_enc_quality_get_type ())
 static GType
@@ -814,7 +814,6 @@ gst_flac_enc_set_format (GstAudioEncoder * enc, GstAudioInfo * info)
 encoder_already_initialized:
   {
     g_warning ("flac already initialized -- fixme allow this");
-    gst_object_unref (flacenc);
     return FALSE;
   }
 setting_src_caps_failed:
@@ -822,14 +821,12 @@ setting_src_caps_failed:
     GST_DEBUG_OBJECT (flacenc,
         "Couldn't set caps on source pad: %" GST_PTR_FORMAT, caps);
     gst_caps_unref (caps);
-    gst_object_unref (flacenc);
     return FALSE;
   }
 failed_to_initialize:
   {
     GST_ELEMENT_ERROR (flacenc, LIBRARY, INIT, (NULL),
         ("could not initialize encoder (wrong parameters?)"));
-    gst_object_unref (flacenc);
     return FALSE;
   }
 }
diff --git a/ext/gconf/Makefile.in b/ext/gconf/Makefile.in
index ebcd7e1..3687c07 100644
--- a/ext/gconf/Makefile.in
+++ b/ext/gconf/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/gconf
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -126,10 +142,23 @@ libgstgconfelements_la_OBJECTS = $(am_libgstgconfelements_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstgconfelements_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstgconfelements_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstgconfelements_la_CFLAGS) $(CFLAGS) \
 	$(libgstgconfelements_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -142,22 +171,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstgconfelements_la_SOURCES)
 DIST_SOURCES = $(libgstgconfelements_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -217,6 +247,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -265,8 +296,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -347,7 +380,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -407,6 +440,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -480,7 +514,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -546,7 +584,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -554,6 +591,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -569,12 +608,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstgconfelements.la: $(libgstgconfelements_la_OBJECTS) $(libgstgconfelements_la_DEPENDENCIES) $(EXTRA_libgstgconfelements_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstgconfelements_la_LINK) -rpath $(plugindir) $(libgstgconfelements_la_OBJECTS) $(libgstgconfelements_la_LIBADD) $(LIBS)
 
@@ -725,6 +766,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -869,18 +924,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/gdk_pixbuf/Makefile.am b/ext/gdk_pixbuf/Makefile.am
index cf5265c..32a82ef 100644
--- a/ext/gdk_pixbuf/Makefile.am
+++ b/ext/gdk_pixbuf/Makefile.am
@@ -1,12 +1,15 @@
 plugin_LTLIBRARIES = libgstgdkpixbuf.la
 
-libgstgdkpixbuf_la_SOURCES = gstgdkpixbuf.c gstgdkpixbufsink.c pixbufscale.c
+libgstgdkpixbuf_la_SOURCES = gstgdkpixbuf.c gstgdkpixbufsink.c pixbufscale.c \
+	gstgdkpixbufoverlay.c
 libgstgdkpixbuf_la_CFLAGS = \
 	$(GST_PLUGINS_BASE_CFLAGS) \
+	$(GST_CONTROLLER_CFLAGS) \
 	$(GST_BASE_CFLAGS) \
 	$(GST_CFLAGS) $(GDK_PIXBUF_CFLAGS)
 libgstgdkpixbuf_la_LIBADD = \
 	$(GST_PLUGINS_BASE_LIBS) -lgstvideo-$(GST_MAJORMINOR) \
+	$(GST_CONTROLLER_LIBS) \
 	$(GST_BASE_LIBS) \
 	$(GST_LIBS) $(GDK_PIXBUF_LIBS)
 libgstgdkpixbuf_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS)
@@ -14,6 +17,7 @@ libgstgdkpixbuf_la_LIBTOOLFLAGS = --tag=disable-static
 
 noinst_HEADERS = \
 	gstgdkpixbuf.h \
+	gstgdkpixbufoverlay.h \
 	gstgdkpixbufsink.h \
 	pixbufscale.h \
 	gstgdkanimation.h
diff --git a/ext/gdk_pixbuf/Makefile.in b/ext/gdk_pixbuf/Makefile.in
index 72f8caa..9d9d874 100644
--- a/ext/gdk_pixbuf/Makefile.in
+++ b/ext/gdk_pixbuf/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/gdk_pixbuf
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -113,18 +129,32 @@ LTLIBRARIES = $(plugin_LTLIBRARIES)
 am__DEPENDENCIES_1 =
 libgstgdkpixbuf_la_DEPENDENCIES = $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
-	$(am__DEPENDENCIES_1)
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
 am_libgstgdkpixbuf_la_OBJECTS = libgstgdkpixbuf_la-gstgdkpixbuf.lo \
 	libgstgdkpixbuf_la-gstgdkpixbufsink.lo \
-	libgstgdkpixbuf_la-pixbufscale.lo
+	libgstgdkpixbuf_la-pixbufscale.lo \
+	libgstgdkpixbuf_la-gstgdkpixbufoverlay.lo
 libgstgdkpixbuf_la_OBJECTS = $(am_libgstgdkpixbuf_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstgdkpixbuf_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstgdkpixbuf_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstgdkpixbuf_la_CFLAGS) $(CFLAGS) \
 	$(libgstgdkpixbuf_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -137,22 +167,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstgdkpixbuf_la_SOURCES)
 DIST_SOURCES = $(libgstgdkpixbuf_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -212,6 +243,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -260,8 +292,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -342,7 +376,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -402,6 +436,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -475,19 +510,27 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
 plugin_LTLIBRARIES = libgstgdkpixbuf.la
-libgstgdkpixbuf_la_SOURCES = gstgdkpixbuf.c gstgdkpixbufsink.c pixbufscale.c
+libgstgdkpixbuf_la_SOURCES = gstgdkpixbuf.c gstgdkpixbufsink.c pixbufscale.c \
+	gstgdkpixbufoverlay.c
+
 libgstgdkpixbuf_la_CFLAGS = \
 	$(GST_PLUGINS_BASE_CFLAGS) \
+	$(GST_CONTROLLER_CFLAGS) \
 	$(GST_BASE_CFLAGS) \
 	$(GST_CFLAGS) $(GDK_PIXBUF_CFLAGS)
 
 libgstgdkpixbuf_la_LIBADD = \
 	$(GST_PLUGINS_BASE_LIBS) -lgstvideo-$(GST_MAJORMINOR) \
+	$(GST_CONTROLLER_LIBS) \
 	$(GST_BASE_LIBS) \
 	$(GST_LIBS) $(GDK_PIXBUF_LIBS)
 
@@ -495,6 +538,7 @@ libgstgdkpixbuf_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS)
 libgstgdkpixbuf_la_LIBTOOLFLAGS = --tag=disable-static
 noinst_HEADERS = \
 	gstgdkpixbuf.h \
+	gstgdkpixbufoverlay.h \
 	gstgdkpixbufsink.h \
 	pixbufscale.h \
 	gstgdkanimation.h
@@ -535,7 +579,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -543,6 +586,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -558,12 +603,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstgdkpixbuf.la: $(libgstgdkpixbuf_la_OBJECTS) $(libgstgdkpixbuf_la_DEPENDENCIES) $(EXTRA_libgstgdkpixbuf_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstgdkpixbuf_la_LINK) -rpath $(plugindir) $(libgstgdkpixbuf_la_OBJECTS) $(libgstgdkpixbuf_la_LIBADD) $(LIBS)
 
@@ -574,6 +621,7 @@ distclean-compile:
 	-rm -f *.tab.c
 
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstgdkpixbuf_la-gstgdkpixbuf.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstgdkpixbuf_la-gstgdkpixbufoverlay.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstgdkpixbuf_la-gstgdkpixbufsink.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstgdkpixbuf_la-pixbufscale.Plo@am__quote@
 
@@ -619,6 +667,13 @@ libgstgdkpixbuf_la-pixbufscale.lo: pixbufscale.c
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstgdkpixbuf_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstgdkpixbuf_la_CFLAGS) $(CFLAGS) -c -o libgstgdkpixbuf_la-pixbufscale.lo `test -f 'pixbufscale.c' || echo '$(srcdir)/'`pixbufscale.c
 
+libgstgdkpixbuf_la-gstgdkpixbufoverlay.lo: gstgdkpixbufoverlay.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstgdkpixbuf_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstgdkpixbuf_la_CFLAGS) $(CFLAGS) -MT libgstgdkpixbuf_la-gstgdkpixbufoverlay.lo -MD -MP -MF $(DEPDIR)/libgstgdkpixbuf_la-gstgdkpixbufoverlay.Tpo -c -o libgstgdkpixbuf_la-gstgdkpixbufoverlay.lo `test -f 'gstgdkpixbufoverlay.c' || echo '$(srcdir)/'`gstgdkpixbufoverlay.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libgstgdkpixbuf_la-gstgdkpixbufoverlay.Tpo $(DEPDIR)/libgstgdkpixbuf_la-gstgdkpixbufoverlay.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='gstgdkpixbufoverlay.c' object='libgstgdkpixbuf_la-gstgdkpixbufoverlay.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstgdkpixbuf_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstgdkpixbuf_la_CFLAGS) $(CFLAGS) -c -o libgstgdkpixbuf_la-gstgdkpixbufoverlay.lo `test -f 'gstgdkpixbufoverlay.c' || echo '$(srcdir)/'`gstgdkpixbufoverlay.c
+
 mostlyclean-libtool:
 	-rm -f *.lo
 
@@ -674,6 +729,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -818,18 +887,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/gdk_pixbuf/gst_loader.c b/ext/gdk_pixbuf/gst_loader.c
new file mode 100644
index 0000000..55fff06
--- /dev/null
+++ b/ext/gdk_pixbuf/gst_loader.c
@@ -0,0 +1,281 @@
+/*
+ * Copyright (C) 2003 Benjamin Otte <in7y118@public.uni-hamburg.de>
+ *
+ * gst_loader.c: Load GStreamer videos as gdkpixbufs
+ * 
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include "gstgdkanimation.h"
+#include <gst/gstinfo.h>
+#include <stdio.h>
+#include <sys/types.h>
+#include <sys/stat.h>
+#include <fcntl.h>
+
+
+typedef struct
+{
+  /* stuff gdk throws at us and we're supposed to keep */
+  GdkPixbufModuleSizeFunc size_func;
+  GdkPixbufModulePreparedFunc prepared_func;
+  GdkPixbufModuleUpdatedFunc updated_func;
+  gpointer user_data;
+  /* our own stuff - we're much better at keeping fields small :p */
+  GstGdkAnimation *ani;
+  gboolean initialized;
+}
+GstLoaderContext;
+
+GST_DEBUG_CATEGORY_STATIC (gst_loader_debug);
+#define GST_CAT_DEFAULT gst_loader_debug
+
+static gboolean
+gst_loader_init (GError ** error)
+{
+  static gboolean inited = FALSE;
+
+  if (inited)
+    return TRUE;
+
+  if (!g_thread_supported ()) {
+    g_set_error (error, GDK_PIXBUF_ERROR, GDK_PIXBUF_ERROR_FAILED,
+        "The GStreamer loader requires threading support.");
+    return FALSE;
+  }
+
+  if (!gst_init_check (0, NULL)) {
+    g_set_error (error, GDK_PIXBUF_ERROR, GDK_PIXBUF_ERROR_FAILED,
+        "GStreamer could not be initialized.");
+    return FALSE;
+  }
+
+  inited = TRUE;
+  GST_DEBUG_CATEGORY_INIT (gst_loader_debug, "gstloader", 0,
+      "entry point debugging for the GStreamer gdk pixbuf loader");
+  return TRUE;
+}
+
+static gpointer
+gst_loader_begin_load (GdkPixbufModuleSizeFunc size_func,
+    GdkPixbufModulePreparedFunc prepared_func,
+    GdkPixbufModuleUpdatedFunc updated_func, gpointer user_data,
+    GError ** error)
+{
+  GstLoaderContext *context;
+
+  if (!gst_loader_init (error))
+    return NULL;
+
+  context = g_new (GstLoaderContext, 1);
+  context->size_func = size_func;
+  context->prepared_func = prepared_func;
+  context->updated_func = updated_func;
+  context->user_data = user_data;
+  context->ani = gst_gdk_animation_new (error);
+  context->initialized = FALSE;
+
+  if (!context->ani) {
+    GST_WARNING ("creating animation failed");
+    g_free (context);
+    return NULL;
+  }
+  context->ani->temp_fd =
+      g_file_open_tmp (NULL, &context->ani->temp_location, error);
+  if (context->ani->temp_fd == 0) {
+    g_object_unref (context->ani);
+    g_free (context);
+    return NULL;
+  }
+
+  GST_LOG_OBJECT (context->ani, "begin loading");
+  return context;
+}
+
+static gboolean
+gst_loader_load_increment (gpointer context_pointer, const guchar * buf,
+    guint size, GError ** error)
+{
+  GdkPixbufAnimationIter *iter;
+  GstLoaderContext *context = (GstLoaderContext *) context_pointer;
+
+  GST_LOG_OBJECT (context->ani, "load increment: %u bytes", size);
+  gst_gdk_animation_add_data (context->ani, buf, size);
+  if (!context->initialized
+      && (iter =
+          gdk_pixbuf_animation_get_iter (GDK_PIXBUF_ANIMATION (context->ani),
+              NULL)) != NULL) {
+    int width =
+        gdk_pixbuf_animation_get_width (GDK_PIXBUF_ANIMATION (context->ani));
+    int height =
+        gdk_pixbuf_animation_get_height (GDK_PIXBUF_ANIMATION (context->ani));
+    GdkPixbuf *pixbuf =
+        gdk_pixbuf_animation_get_static_image (GDK_PIXBUF_ANIMATION
+        (context->ani));
+
+    g_object_unref (iter);
+    GST_LOG_OBJECT (context->ani, "initializing loader");
+    if (context->size_func) {
+      GST_LOG_OBJECT (context->ani, "calling size_func %p", context->size_func);
+      context->size_func (&width, &height, context->user_data);
+    }
+
+    if (context->prepared_func) {
+      GST_LOG_OBJECT (context->ani, "calling prepared_func %p",
+          context->prepared_func);
+      context->prepared_func (pixbuf, GDK_PIXBUF_ANIMATION (context->ani),
+          context->user_data);
+    }
+
+    context->initialized = TRUE;
+  }
+
+  return TRUE;
+}
+
+static gboolean
+gst_loader_stop_load (gpointer context_pointer, GError ** error)
+{
+  GstLoaderContext *context = (GstLoaderContext *) context_pointer;
+
+  GST_LOG_OBJECT (context->ani, "stop loading");
+  gst_gdk_animation_done_adding (context->ani);
+  g_object_unref (context->ani);
+  g_free (context);
+
+  return TRUE;
+}
+
+static GdkPixbufAnimation *
+gst_loader_load_animation (FILE * f, GError ** error)
+{
+  gchar *filename;
+  GstGdkAnimation *ani;
+  GdkPixbufAnimationIter *iter = NULL;
+
+  if (!gst_loader_init (error))
+    return NULL;
+
+  GST_LOG ("load_animation");
+  ani = gst_gdk_animation_new (error);
+  if (!ani)
+    return NULL;
+
+  filename = g_strdup_printf ("/proc/self/fd/%d", fileno (f));
+  ani->temp_fd = open (filename, 0);
+  if (ani->temp_fd >= 0) {
+    iter = gdk_pixbuf_animation_get_iter (GDK_PIXBUF_ANIMATION (ani), NULL);
+  } else {
+    GST_DEBUG ("open (\"%s\", 0) failed", filename);
+  }
+  g_free (filename);
+  if (iter == NULL) {
+    g_set_error (error, GDK_PIXBUF_ERROR, GDK_PIXBUF_ERROR_CORRUPT_IMAGE,
+        "could not create an image");
+    g_object_unref (ani);
+    GST_INFO ("could not create an image");
+    return NULL;
+  }
+  g_object_unref (iter);
+  GST_LOG_OBJECT (ani, "load_animation succeeded");
+  return GDK_PIXBUF_ANIMATION (ani);
+}
+
+static GdkPixbuf *
+gst_loader_load (FILE * f, GError ** error)
+{
+  GdkPixbufAnimation *ani;
+  GdkPixbuf *pixbuf;
+
+  ani = gst_loader_load_animation (f, error);
+  if (ani == NULL)
+    return NULL;
+
+  pixbuf = gdk_pixbuf_animation_get_static_image (ani);
+  if (!pixbuf) {
+    GST_ERROR_OBJECT (ani, "Could not get an image in _pixbuf_load");
+    g_object_unref (ani);
+    g_set_error (error, GDK_PIXBUF_ERROR, GDK_PIXBUF_ERROR_CORRUPT_IMAGE,
+        "Could not get an image from file.");
+    return NULL;
+  }
+
+  g_object_ref (pixbuf);
+  g_object_unref (ani);
+
+  return pixbuf;
+}
+
+void
+fill_vtable (GdkPixbufModule * module)
+{
+  module->load = gst_loader_load;
+  module->begin_load = gst_loader_begin_load;
+  module->load_increment = gst_loader_load_increment;
+  module->stop_load = gst_loader_stop_load;
+  module->load_animation = gst_loader_load_animation;
+}
+
+void
+fill_info (GdkPixbufFormat * info)
+{
+  static GdkPixbufModulePattern signature[] = {
+    /* AVI */
+    {"RIFF    AVI ", "    xxxx    ", 100},
+    /* MPEG 1 */
+    {"xx\001\272", "zz  ", 100},
+    /* MPEG 2 */
+    {"xx\001\263", "zz  ", 100},
+    /* Quicktime */
+    {"    wide", "xxxx    ", 80},
+    {"    moov", "xxxx    ", 80},
+    {"    mdat", "xxxx    ", 80},
+    {"    pnot", "xxxx    ", 80},
+    {"    PICT", "xxxx    ", 80},
+    {"    free", "xxxx    ", 80},
+    /* ASF */
+    {"\060\046\262\165\216\146\317\021\246\331 \252 \142\316\154",
+        "          z z   ", 100},
+    {NULL, NULL, 0}
+  };
+
+  static gchar *mime_types[] = {
+    "video/avi", "video/x-avi", "video/x-msvideo",
+    "video/mpeg",
+    "video/quicktime",
+    "video/x-ms-asf",
+    NULL
+  };
+
+  static gchar *extensions[] = {
+    "avi",
+    "mpeg", "mpe", "mpg",
+    "mov",
+    "asf", "wmv",
+    NULL
+  };
+
+  info->name = "GStreamer";
+  info->signature = signature;
+  info->description = "GStreamer supported video";
+  info->mime_types = mime_types;
+  info->extensions = extensions;
+  info->flags = 0;
+}
diff --git a/ext/gdk_pixbuf/gstgdkanimation.c b/ext/gdk_pixbuf/gstgdkanimation.c
new file mode 100644
index 0000000..4b81e9d
--- /dev/null
+++ b/ext/gdk_pixbuf/gstgdkanimation.c
@@ -0,0 +1,661 @@
+/*
+ * Copyright (C) 2003 Benjamin Otte <in7y118@public.uni-hamburg.de>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include "gstgdkanimation.h"
+#include <unistd.h>
+
+GST_DEBUG_CATEGORY_STATIC (gst_gdk_animation_debug);
+#define GST_CAT_DEFAULT gst_gdk_animation_debug
+
+static void gst_gdk_animation_class_init (gpointer g_class,
+    gpointer class_data);
+static void gst_gdk_animation_finalize (GObject * object);
+
+static gboolean gst_gdk_animation_is_static_image (GdkPixbufAnimation *
+    animation);
+static GdkPixbuf *gst_gdk_animation_get_static_image (GdkPixbufAnimation *
+    animation);
+static void gst_gdk_animation_get_size (GdkPixbufAnimation * anim, gint * width,
+    gint * height);
+static GdkPixbufAnimationIter *gst_gdk_animation_get_iter (GdkPixbufAnimation *
+    anim, const GTimeVal * start_time);
+
+
+static gpointer parent_class;
+
+GType
+gst_gdk_animation_get_type (void)
+{
+  static GType object_type = 0;
+
+  if (!object_type) {
+    static const GTypeInfo object_info = {
+      sizeof (GstGdkAnimationClass),
+      NULL,
+      NULL,
+      gst_gdk_animation_class_init,
+      NULL,                     /* class_finalize */
+      NULL,                     /* class_data */
+      sizeof (GstGdkAnimation),
+      0,                        /* n_preallocs */
+      NULL,
+    };
+
+    object_type = g_type_register_static (GDK_TYPE_PIXBUF_ANIMATION,
+        "GstGdkAnimation", &object_info, 0);
+
+    GST_DEBUG_CATEGORY_INIT (gst_gdk_animation_debug, "gstloader_animation", 0,
+        "GStreamer GdkPixbuf loader - GdkAnimation class");
+  }
+
+  return object_type;
+}
+
+static void
+gst_gdk_animation_class_init (gpointer g_class, gpointer class_data)
+{
+  GObjectClass *object_class = G_OBJECT_CLASS (g_class);
+  GdkPixbufAnimationClass *anim_class = GDK_PIXBUF_ANIMATION_CLASS (g_class);
+
+  parent_class = g_type_class_peek_parent (g_class);
+
+  object_class->finalize = gst_gdk_animation_finalize;
+
+  anim_class->is_static_image = gst_gdk_animation_is_static_image;
+  anim_class->get_static_image = gst_gdk_animation_get_static_image;
+  anim_class->get_size = gst_gdk_animation_get_size;
+  anim_class->get_iter = gst_gdk_animation_get_iter;
+}
+
+static void
+gst_gdk_animation_finalize (GObject * object)
+{
+  GstGdkAnimation *ani = GST_GDK_ANIMATION (object);
+
+  if (ani->temp_fd) {
+    close (ani->temp_fd);
+  }
+  if (ani->temp_location) {
+    remove (ani->temp_location);
+    g_free (ani->temp_location);
+  }
+  if (ani->pixbuf) {
+    g_object_unref (ani->pixbuf);
+    ani->pixbuf = NULL;
+  }
+
+  G_OBJECT_CLASS (parent_class)->finalize (object);
+}
+
+GstGdkAnimation *
+gst_gdk_animation_new (GError ** error)
+{
+  GstGdkAnimation *ani =
+      GST_GDK_ANIMATION (g_object_new (GST_TYPE_GDK_ANIMATION, NULL));
+
+  return ani;
+}
+
+gboolean
+gst_gdk_animation_add_data (GstGdkAnimation * ani, const guint8 * data,
+    guint size)
+{
+  return (write (ani->temp_fd, data, size) == size);
+}
+
+void
+gst_gdk_animation_done_adding (GstGdkAnimation * ani)
+{
+  close (ani->temp_fd);
+  ani->temp_fd = 0;
+}
+
+static gboolean
+gst_gdk_animation_is_static_image (GdkPixbufAnimation * animation)
+{
+  return FALSE;
+}
+
+static void
+gst_gdk_animation_get_size (GdkPixbufAnimation * anim, gint * width,
+    int *height)
+{
+  GstGdkAnimation *ani = GST_GDK_ANIMATION (anim);
+
+  GST_LOG_OBJECT (ani, "get_size called (%p, %p) %d x %d", width, height,
+      ani->width, ani->height);
+  if (width)
+    *width = ani->width;
+
+  if (height)
+    *height = ani->height;
+}
+
+
+static void gst_gdk_animation_iter_class_init (gpointer g_class,
+    gpointer class_data);
+static void gst_gdk_animation_iter_init (GTypeInstance * instance,
+    gpointer g_class);
+static void gst_gdk_animation_iter_finalize (GObject * object);
+
+static gint gst_gdk_animation_iter_get_delay_time (GdkPixbufAnimationIter *
+    iter);
+static GdkPixbuf *gst_gdk_animation_iter_get_pixbuf (GdkPixbufAnimationIter *
+    iter);
+static gboolean
+gst_gdk_animation_iter_on_currently_loading_frame (GdkPixbufAnimationIter *
+    iter);
+static gboolean gst_gdk_animation_iter_advance (GdkPixbufAnimationIter * iter,
+    const GTimeVal * current_time);
+
+static gpointer iter_parent_class;
+
+GType
+gst_gdk_animation_iter_get_type (void)
+{
+  static GType object_type = 0;
+
+  if (!object_type) {
+    static const GTypeInfo object_info = {
+      sizeof (GstGdkAnimationIterClass),
+      NULL,
+      NULL,
+      gst_gdk_animation_iter_class_init,
+      NULL,                     /* class_finalize */
+      NULL,                     /* class_data */
+      sizeof (GstGdkAnimationIter),
+      0,                        /* n_preallocs */
+      gst_gdk_animation_iter_init,
+    };
+
+    object_type = g_type_register_static (GDK_TYPE_PIXBUF_ANIMATION_ITER,
+        "GdkPixbufAniAnimIter", &object_info, 0);
+  }
+
+  return object_type;
+}
+
+static void
+gst_gdk_animation_iter_class_init (gpointer g_class, gpointer class_data)
+{
+  GObjectClass *object_class = G_OBJECT_CLASS (g_class);
+  GdkPixbufAnimationIterClass *anim_iter_class =
+      GDK_PIXBUF_ANIMATION_ITER_CLASS (g_class);
+
+  iter_parent_class = g_type_class_peek_parent (g_class);
+
+  object_class->finalize = gst_gdk_animation_iter_finalize;
+
+  anim_iter_class->get_delay_time = gst_gdk_animation_iter_get_delay_time;
+  anim_iter_class->get_pixbuf = gst_gdk_animation_iter_get_pixbuf;
+  anim_iter_class->on_currently_loading_frame =
+      gst_gdk_animation_iter_on_currently_loading_frame;
+  anim_iter_class->advance = gst_gdk_animation_iter_advance;
+}
+
+static void
+gst_gdk_animation_iter_init (GTypeInstance * instance, gpointer g_class)
+{
+  GstGdkAnimationIter *iter = GST_GDK_ANIMATION_ITER (instance);
+
+  iter->buffers = g_queue_new ();
+  iter->eos = FALSE;
+}
+
+static void
+gst_gdk_animation_iter_finalize (GObject * object)
+{
+  GstGdkAnimationIter *iter = GST_GDK_ANIMATION_ITER (object);
+
+  g_object_unref (iter->ani);
+
+  if (iter->pipeline)
+    g_object_unref (iter->pipeline);
+  if (iter->pixbuf)
+    g_object_unref (iter->pixbuf);
+  while (iter->buffers) {
+    GstBuffer *buffer = GST_BUFFER (g_queue_pop_head (iter->buffers));
+
+    if (buffer) {
+      GST_LOG_OBJECT (iter, "unreffing buffer %p on finalize", buffer);
+      gst_data_unref (GST_DATA (buffer));
+    } else {
+      g_queue_free (iter->buffers);
+      iter->buffers = NULL;
+    }
+  }
+  G_OBJECT_CLASS (iter_parent_class)->finalize (object);
+}
+
+static void
+got_handoff (GstElement * fakesink, GstBuffer * buffer, GstPad * pad,
+    GstGdkAnimationIter * iter)
+{
+  GST_LOG_OBJECT (iter, "enqueing buffer %p (timestamp %" G_GUINT64_FORMAT ")",
+      buffer, GST_BUFFER_TIMESTAMP (buffer));
+  gst_data_ref (GST_DATA (buffer));
+  g_queue_push_tail (iter->buffers, buffer);
+}
+
+static gboolean
+gst_gdk_animation_iter_create_pipeline (GstGdkAnimationIter * iter)
+{
+  GstElement *src, *typefind, *autoplugger, *sink, *colorspace;
+  GstCaps *caps = GST_CAPS_NEW ("pixbuf_filter32",
+      "video/x-raw-rgb",
+      "endianness", GST_PROPS_INT (G_BIG_ENDIAN),
+      "bpp", GST_PROPS_INT (32),
+      "red_mask", GST_PROPS_INT (0xFF000000),
+      "green_mask", GST_PROPS_INT (0x00FF0000),
+      "blue_mask", GST_PROPS_INT (0x0000FF00)
+      );
+
+  gst_caps_append (caps, GST_CAPS_NEW ("pixbuf_filter24",
+          "video/x-raw-rgb",
+          "endianness", GST_PROPS_INT (G_BIG_ENDIAN),
+          "bpp", GST_PROPS_INT (24),
+          "red_mask", GST_PROPS_INT (0xFF0000),
+          "green_mask", GST_PROPS_INT (0x00FF00),
+          "blue_mask", GST_PROPS_INT (0x0000FF)
+      ));
+
+  iter->pipeline = gst_element_factory_make ("pipeline", "main_pipeline");
+  if (iter->pipeline == NULL)
+    return FALSE;
+
+  if (!(src = gst_element_factory_make ("filesrc", "source")))
+    goto error;
+  gst_bin_add (GST_BIN (iter->pipeline), src);
+  if (iter->ani->temp_location) {
+    g_object_set (src, "location", iter->ani->temp_location, NULL);
+    GST_INFO_OBJECT (iter, "using file '%s'", iter->ani->temp_location);
+  } else {
+    gchar *filename = g_strdup_printf ("/proc/self/fd/%d", iter->ani->temp_fd);
+
+    g_object_set (src, "location", filename, NULL);
+    GST_INFO_OBJECT (iter, "using file '%s'", filename);
+    g_free (filename);
+  }
+
+  /* add typefind for correct typefinding */
+  if ((typefind = gst_element_factory_make ("typefind", "typefind"))) {
+    gst_bin_add (GST_BIN (iter->pipeline), typefind);
+    if (!gst_element_link (src, typefind))
+      goto error;
+  }
+
+  if (!(autoplugger = gst_element_factory_make ("spider", "autoplugger")))
+    goto error;
+  gst_bin_add (GST_BIN (iter->pipeline), autoplugger);
+  if (!gst_element_link (typefind, autoplugger))
+    goto error;
+
+  /* try ffcolorspace if available so we get svq1, too */
+  colorspace = gst_element_factory_make ("ffcolorspace", "ffcolorspace");
+  if (!colorspace)
+    colorspace = gst_element_factory_make ("colorspace", "colorspace");
+  if (!colorspace)
+    goto error;
+  gst_bin_add (GST_BIN (iter->pipeline), colorspace);
+  if (!gst_element_link (autoplugger, colorspace))
+    goto error;
+
+  if (!(sink = gst_element_factory_make ("fakesink", "sink")))
+    goto error;
+  g_object_set (sink, "signal-handoffs", TRUE, NULL);
+  g_signal_connect (sink, "handoff", (GCallback) got_handoff, iter);
+  gst_bin_add (GST_BIN (iter->pipeline), sink);
+  if (!gst_element_link_filtered (colorspace, sink, caps))
+    goto error;
+  if (gst_element_set_state (iter->pipeline,
+          GST_STATE_PLAYING) != GST_STATE_CHANGE_SUCCESS)
+    goto error;
+
+  return TRUE;
+error:
+  g_object_unref (iter->pipeline);
+  iter->pipeline = NULL;
+  return FALSE;
+}
+
+static gboolean
+gst_gdk_animation_iter_may_advance (GstGdkAnimationIter * iter)
+{
+  GstFormat bytes = GST_FORMAT_BYTES;
+  gint64 offset;
+  gint64 data_amount;
+
+  if (iter->ani->temp_fd == 0 || iter->ani->temp_location == NULL)
+    return TRUE;
+
+  data_amount = lseek (iter->ani->temp_fd, 0, SEEK_CUR);
+  g_assert (data_amount >= 0);
+  if (!gst_element_query (gst_bin_get_by_name (GST_BIN (iter->pipeline),
+              "source"), GST_QUERY_POSITION, &bytes, &offset))
+    g_assert_not_reached ();
+  if (data_amount - offset > GST_GDK_BUFFER_SIZE)
+    return TRUE;
+
+  return FALSE;
+}
+
+static gboolean
+gst_gdk_animation_get_more_buffers (GstGdkAnimationIter * iter)
+{
+  GstBuffer *last = g_queue_peek_tail (iter->buffers);
+
+  do {
+    GST_LOG_OBJECT (iter, "iterating...");
+    if (!gst_gdk_animation_iter_may_advance (iter)) {
+      GST_LOG_OBJECT (iter, "no more data available");
+      break;
+    }
+    if (!gst_bin_iterate (GST_BIN (iter->pipeline))) {
+      GST_LOG_OBJECT (iter, "iterating done, setting EOS");
+      iter->eos = TRUE;
+      break;
+    }
+  } while (last == g_queue_peek_tail (iter->buffers));
+  return last != g_queue_peek_tail (iter->buffers);
+}
+
+static void
+pixbuf_destroy_notify (guchar * pixels, gpointer data)
+{
+  GST_LOG ("unreffing buffer %p because pixbuf was destroyed", data);
+  gst_data_unref (GST_DATA (data));
+}
+
+static void
+gst_gdk_animation_iter_create_pixbuf (GstGdkAnimationIter * iter)
+{
+  GstBuffer *buf;
+  GstGdkAnimation *ani = iter->ani;
+
+  buf = g_queue_pop_head (iter->buffers);
+  g_assert (buf);
+  if (iter->pixbuf) {
+    GST_LOG_OBJECT (iter, "unreffing pixbuf %p", iter->pixbuf);
+    g_object_unref (iter->pixbuf);
+  }
+  if (ani->width == 0) {
+    GstPad *pad;
+    GstCaps *caps;
+    GstElement *fakesink =
+        gst_bin_get_by_name (GST_BIN (iter->pipeline), "sink");
+    g_assert (fakesink);
+    pad = gst_element_get_pad (fakesink, "sink");
+    g_assert (pad);
+    caps = gst_pad_get_negotiated_caps (pad);
+    g_assert (caps);
+    g_assert (GST_CAPS_IS_FIXED (caps));
+    g_assert (gst_caps_has_fixed_property (caps, "bpp") &&
+        gst_caps_has_fixed_property (caps, "width") &&
+        gst_caps_has_fixed_property (caps, "height"));
+    gst_caps_get_int (caps, "width", &ani->width);
+    gst_caps_get_int (caps, "height", &ani->height);
+    gst_caps_get_int (caps, "bpp", &ani->bpp);
+    GST_DEBUG_OBJECT (ani, "found format (width %d, height %d, bpp %d)",
+        ani->width, ani->height, ani->bpp);
+  }
+  g_assert (GST_BUFFER_SIZE (buf) == ani->width * ani->height * ani->bpp / 8);
+  if (ani->bpp == 32) {
+    gint i;
+    guint32 *data = (guint32 *) GST_BUFFER_DATA (buf);
+
+    /* ensure opacity */
+    for (i = 0; i < ani->width * ani->height; i++) {
+      data[i] |= 0xFF000000;
+    }
+  }
+  iter->pixbuf = gdk_pixbuf_new_from_data (GST_BUFFER_DATA (buf),
+      GDK_COLORSPACE_RGB, ani->bpp == 32, 8, ani->width, ani->height,
+      ani->width * ani->bpp / 8, pixbuf_destroy_notify, buf);
+  GST_LOG_OBJECT (iter, "created pixbuf %p from buffer %p (refcount %d)",
+      iter->pixbuf, buf, GST_DATA_REFCOUNT_VALUE (buf));
+}
+
+static GdkPixbufAnimationIter *
+gst_gdk_animation_get_iter (GdkPixbufAnimation * anim,
+    const GTimeVal * start_time)
+{
+  GstGdkAnimation *ani = GST_GDK_ANIMATION (anim);
+  GstGdkAnimationIter *iter;
+
+  if (ani->temp_fd != 0 && ani->temp_location != NULL &&
+      lseek (ani->temp_fd, 0, SEEK_CUR) < GST_GDK_BUFFER_SIZE) {
+    GST_DEBUG_OBJECT (ani, "Not enough data to create iterator.");
+    return NULL;
+  }
+
+  iter = g_object_new (GST_TYPE_GDK_ANIMATION_ITER, NULL);
+
+  iter->start = *start_time;
+
+  iter->ani = ani;
+  g_object_ref (ani);
+  if (!gst_gdk_animation_iter_create_pipeline (iter))
+    goto error;
+
+  if (!gst_gdk_animation_get_more_buffers (iter))
+    goto error;
+
+  gst_gdk_animation_iter_create_pixbuf (iter);
+
+  return GDK_PIXBUF_ANIMATION_ITER (iter);
+
+error:
+  g_object_unref (iter);
+  return NULL;
+}
+
+static gboolean
+gst_gdk_animation_iter_advance (GdkPixbufAnimationIter * anim_iter,
+    const GTimeVal * current_time)
+{
+  GstClockTime offset;
+  GstBuffer *buffer = NULL;
+  GstGdkAnimationIter *iter = GST_GDK_ANIMATION_ITER (anim_iter);
+
+  /* compute timestamp that next buffer must match */
+  offset =
+      ((GstClockTime) current_time->tv_sec - iter->start.tv_sec) * GST_SECOND;
+  if (iter->start.tv_usec > current_time->tv_usec) {
+    offset -=
+        ((GstClockTime) iter->start.tv_usec -
+        current_time->tv_usec) * GST_SECOND / G_USEC_PER_SEC;
+  } else {
+    offset +=
+        ((GstClockTime) current_time->tv_usec -
+        iter->start.tv_usec) * GST_SECOND / G_USEC_PER_SEC;
+  }
+  GST_DEBUG_OBJECT (iter,
+      "advancing to %ld:%ld (started at %ld:%ld) need offset %"
+      G_GUINT64_FORMAT, current_time->tv_sec, current_time->tv_usec,
+      iter->start.tv_sec, iter->start.tv_usec, offset);
+  if (!iter->just_seeked
+      && offset - iter->last_timestamp > GST_GDK_MAX_DELAY_TO_SEEK) {
+    GST_INFO_OBJECT (iter,
+        "current pipeline timestamp is too old (%" G_GUINT64_FORMAT " vs %"
+        G_GUINT64_FORMAT "), seeking there", iter->last_timestamp, offset);
+    if (gst_element_send_event (gst_bin_get_by_name (GST_BIN (iter->pipeline),
+                "sink"),
+            gst_event_new_seek (GST_FORMAT_TIME | GST_SEEK_METHOD_SET |
+                GST_SEEK_FLAG_FLUSH | GST_SEEK_FLAG_ACCURATE, offset))) {
+      iter->last_timestamp = offset;
+      iter->just_seeked = TRUE;
+    } else {
+      GST_WARNING_OBJECT (iter,
+          "seek to %" G_GUINT64_FORMAT " didn't work. Iterating there...",
+          offset);
+    }
+  } else if (iter->just_seeked) {
+    iter->just_seeked = FALSE;
+  }
+
+  while (TRUE) {
+    if (g_queue_is_empty (iter->buffers)) {
+      if (iter->eos)
+        return FALSE;
+      if (gst_gdk_animation_get_more_buffers (iter))
+        continue;
+      break;
+    }
+    if (GST_BUFFER_TIMESTAMP (g_queue_peek_head (iter->buffers)) > offset)
+      break;
+    if (buffer) {
+      GST_LOG_OBJECT (iter, "unreffing buffer %p, because timestamp too low (%"
+          G_GUINT64_FORMAT " vs %" G_GUINT64_FORMAT ")",
+          buffer, GST_BUFFER_TIMESTAMP (buffer), offset);
+      gst_data_unref (GST_DATA (buffer));
+    }
+    buffer = GST_BUFFER (g_queue_pop_head (iter->buffers));
+  }
+  if (!buffer)
+    return FALSE;
+  if (GST_BUFFER_TIMESTAMP (buffer) < iter->last_timestamp) {
+    gst_data_unref (GST_DATA (buffer));
+    iter->last_timestamp = offset;
+    return FALSE;
+  }
+  iter->last_timestamp = GST_BUFFER_TIMESTAMP (buffer);
+  g_queue_push_head (iter->buffers, buffer);
+  gst_gdk_animation_iter_create_pixbuf (iter);
+  return TRUE;
+}
+
+static gint
+gst_gdk_animation_iter_get_delay_time (GdkPixbufAnimationIter * anim_iter)
+{
+  gint delay;
+  GstGdkAnimationIter *iter = GST_GDK_ANIMATION_ITER (anim_iter);
+
+  while (g_queue_is_empty (iter->buffers)) {
+    if (iter->eos) {
+      GST_LOG_OBJECT (iter, "returning delay of infinite, we're EOS");
+      return -1;
+    }
+    if (!gst_gdk_animation_get_more_buffers (iter))
+      return -1;                /* FIXME? */
+  }
+
+  delay =
+      (GST_BUFFER_TIMESTAMP (g_queue_peek_head (iter->buffers)) -
+      iter->last_timestamp) * 1000 / GST_SECOND;
+  GST_LOG_OBJECT (iter, "returning delay of %d ms", delay);
+  return delay;
+}
+
+GdkPixbuf *
+gst_gdk_animation_iter_get_pixbuf (GdkPixbufAnimationIter * anim_iter)
+{
+  GstGdkAnimationIter *iter = GST_GDK_ANIMATION_ITER (anim_iter);
+
+  GST_LOG_OBJECT (iter, "returning pixbuf %p", iter->pixbuf);
+  return iter->pixbuf;
+}
+
+static gboolean
+gst_gdk_animation_iter_on_currently_loading_frame (GdkPixbufAnimationIter *
+    anim_iter)
+{
+  GstGdkAnimationIter *iter = GST_GDK_ANIMATION_ITER (anim_iter);
+
+  /* EOS - last frame */
+  if (iter->eos && g_queue_is_empty (iter->buffers))
+    return TRUE;
+
+  /* can't load more frames */
+  if (!gst_gdk_animation_iter_may_advance (iter))
+    return FALSE;
+
+  return TRUE;
+}
+
+static GdkPixbuf *
+gst_gdk_animation_get_static_image (GdkPixbufAnimation * animation)
+{
+  GstGdkAnimation *ani = GST_GDK_ANIMATION (animation);
+  GTimeVal tv;
+  GstGdkAnimationIter *iter;
+
+  if (!ani->pixbuf) {
+    GST_LOG_OBJECT (ani, "trying to create pixbuf");
+    g_get_current_time (&tv);
+    iter =
+        GST_GDK_ANIMATION_ITER (gdk_pixbuf_animation_get_iter (animation, &tv));
+    if (iter) {
+      guint64 offset;
+      GstBuffer *buf;
+      GstFormat time = GST_FORMAT_TIME;
+
+      if (!gst_element_query (gst_bin_get_by_name (GST_BIN (iter->pipeline),
+                  "sink"), GST_QUERY_TOTAL, &time, &offset)) {
+        offset = 0;
+      }
+      if (offset > 120 * GST_SECOND) {
+        offset = 120 * GST_SECOND;
+      } else if (offset < 120 * GST_SECOND && offset >= 10 * GST_SECOND) {
+        offset = offset / 2;
+      }
+      g_assert (time == GST_FORMAT_TIME);
+      GST_LOG_OBJECT (ani,
+          "using time offset %" G_GUINT64_FORMAT " for creating static image",
+          offset);
+      while ((buf = g_queue_pop_head (iter->buffers)) != NULL) {
+        gst_data_unref (GST_DATA (buf));
+      }
+      /* now we do evil stuff, be sure to get rid of the iterator afterwards */
+      if (!gst_element_send_event (gst_bin_get_by_name (GST_BIN
+                  (iter->pipeline), "sink"),
+              gst_event_new_seek (GST_FORMAT_TIME | GST_SEEK_METHOD_SET |
+                  GST_SEEK_FLAG_FLUSH | GST_SEEK_FLAG_ACCURATE, offset))) {
+        GST_INFO_OBJECT (ani, "seeking didn't work. Using next image");
+      }
+
+      do {
+        if (g_queue_is_empty (iter->buffers)) {
+          if (iter->eos)
+            return FALSE;
+          if (gst_gdk_animation_get_more_buffers (iter))
+            continue;
+        }
+      } while (FALSE);
+      if (!g_queue_is_empty (iter->buffers)) {
+        gst_gdk_animation_iter_create_pixbuf (iter);
+        ani->pixbuf =
+            gst_gdk_animation_iter_get_pixbuf (GDK_PIXBUF_ANIMATION_ITER
+            (iter));
+        g_object_ref (ani->pixbuf);
+      } else {
+        g_assert (ani->pixbuf == NULL);
+      }
+      /* DiE iterator, DiE */
+      g_object_unref (iter);
+    } else {
+      GST_DEBUG_OBJECT (ani, "Could not get an iterator. No pixbuf available");
+    }
+  }
+  GST_LOG_OBJECT (ani, "Returning pixbuf %p\n", ani->pixbuf);
+  return ani->pixbuf;
+}
diff --git a/ext/gdk_pixbuf/gstgdkpixbuf.c b/ext/gdk_pixbuf/gstgdkpixbuf.c
index 0a09400..5ed7a86 100644
--- a/ext/gdk_pixbuf/gstgdkpixbuf.c
+++ b/ext/gdk_pixbuf/gstgdkpixbuf.c
@@ -23,10 +23,12 @@
 #endif
 #include <gst/gst.h>
 #include <gst/video/video.h>
+#include <gst/controller/gstcontroller.h>
 #include <gdk-pixbuf/gdk-pixbuf.h>
 #include <string.h>
 
 #include "gstgdkpixbuf.h"
+#include "gstgdkpixbufoverlay.h"
 #include "gstgdkpixbufsink.h"
 #include "pixbufscale.h"
 
@@ -537,6 +539,10 @@ plugin_init (GstPlugin * plugin)
       gst_gdk_pixbuf_type_find, NULL, GST_CAPS_ANY, NULL);
 #endif
 
+  if (!gst_element_register (plugin, "gdkpixbufoverlay", GST_RANK_NONE,
+          GST_TYPE_GDK_PIXBUF_OVERLAY))
+    return FALSE;
+
   if (!gst_element_register (plugin, "gdkpixbufsink", GST_RANK_NONE,
           GST_TYPE_GDK_PIXBUF_SINK))
     return FALSE;
@@ -544,6 +550,8 @@ plugin_init (GstPlugin * plugin)
   if (!pixbufscale_init (plugin))
     return FALSE;
 
+  gst_controller_init (NULL, NULL);
+
   /* plugin initialisation succeeded */
   return TRUE;
 }
diff --git a/ext/gdk_pixbuf/gstgdkpixbufoverlay.c b/ext/gdk_pixbuf/gstgdkpixbufoverlay.c
new file mode 100644
index 0000000..59ef712
--- /dev/null
+++ b/ext/gdk_pixbuf/gstgdkpixbufoverlay.c
@@ -0,0 +1,533 @@
+/* GStreamer GdkPixbuf overlay
+ * Copyright (C) 2012 Tim-Philipp Müller <tim centricular net>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 51 Franklin Street, Suite 500,
+ * Boston, MA 02110-1335, USA.
+ */
+
+/**
+ * SECTION:element-gdkpixbufoverlay
+ * @see_also:
+ *
+ * The gdkpixbufoverlay element overlays an image loaded from file onto
+ * a video stream.
+ *
+ * Changing the positioning or overlay width and height properties at runtime
+ * is supported, but it might be prudent to to protect the property setting
+ * code with GST_BASE_TRANSFORM_LOCK and GST_BASE_TRANSFORM_UNLOCK, as
+ * g_object_set() is not atomic for multiple properties passed in one go.
+ *
+ * Changing the image at runtime is currently not supported.
+ *
+ * Negative offsets are also not yet supported.
+ *
+ * <refsect2>
+ * <title>Example launch line</title>
+ * |[
+ * gst-launch -v videotestsrc ! gdkpixbufoverlay location=image.png ! autovideosink
+ * ]|
+ * Overlays the image in image.png onto the test video picture produced by
+ * videotestsrc.
+ * </refsect2>
+ *
+ * Since: 0.10.33
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include <gst/gst.h>
+#include <gst/controller/gstcontroller.h>
+
+#include "gstgdkpixbufoverlay.h"
+
+GST_DEBUG_CATEGORY_STATIC (gdkpixbufoverlay_debug);
+#define GST_CAT_DEFAULT gdkpixbufoverlay_debug
+
+static void gst_gdk_pixbuf_overlay_set_property (GObject * object,
+    guint property_id, const GValue * value, GParamSpec * pspec);
+static void gst_gdk_pixbuf_overlay_get_property (GObject * object,
+    guint property_id, GValue * value, GParamSpec * pspec);
+static void gst_gdk_pixbuf_overlay_finalize (GObject * object);
+
+static gboolean gst_gdk_pixbuf_overlay_start (GstBaseTransform * trans);
+static gboolean gst_gdk_pixbuf_overlay_stop (GstBaseTransform * trans);
+static GstFlowReturn
+gst_gdk_pixbuf_overlay_transform_ip (GstBaseTransform * trans, GstBuffer * buf);
+static void gst_gdk_pixbuf_overlay_before_transform (GstBaseTransform * trans,
+    GstBuffer * outbuf);
+static gboolean
+gst_gdk_pixbuf_overlay_set_caps (GstBaseTransform * trans, GstCaps * incaps,
+    GstCaps * outcaps);
+
+enum
+{
+  PROP_0,
+  PROP_LOCATION,
+  PROP_OFFSET_X,
+  PROP_OFFSET_Y,
+  PROP_RELATIVE_X,
+  PROP_RELATIVE_Y,
+  PROP_OVERLAY_WIDTH,
+  PROP_OVERLAY_HEIGHT,
+  PROP_ALPHA
+};
+
+#define VIDEO_CAPS \
+    GST_VIDEO_CAPS_BGRx ";" \
+    GST_VIDEO_CAPS_RGB ";" \
+    GST_VIDEO_CAPS_BGR ";" \
+    GST_VIDEO_CAPS_RGBx ";" \
+    GST_VIDEO_CAPS_xRGB ";" \
+    GST_VIDEO_CAPS_xBGR ";" \
+    GST_VIDEO_CAPS_RGBA ";" \
+    GST_VIDEO_CAPS_BGRA ";" \
+    GST_VIDEO_CAPS_ARGB ";" \
+    GST_VIDEO_CAPS_ABGR ";" \
+    GST_VIDEO_CAPS_YUV ("{I420, YV12, AYUV, YUY2, UYVY, v308, v210," \
+        " v216, Y41B, Y42B, Y444, Y800, Y16, NV12, NV21, UYVP, A420," \
+        " YUV9, IYU1}")
+
+static GstStaticPadTemplate sink_template = GST_STATIC_PAD_TEMPLATE ("sink",
+    GST_PAD_SINK,
+    GST_PAD_ALWAYS,
+    GST_STATIC_CAPS (VIDEO_CAPS)
+    );
+
+static GstStaticPadTemplate src_template = GST_STATIC_PAD_TEMPLATE ("src",
+    GST_PAD_SRC,
+    GST_PAD_ALWAYS,
+    GST_STATIC_CAPS (VIDEO_CAPS)
+    );
+
+GST_BOILERPLATE (GstGdkPixbufOverlay, gst_gdk_pixbuf_overlay,
+    GstVideoFilter, GST_TYPE_VIDEO_FILTER);
+
+static void
+gst_gdk_pixbuf_overlay_base_init (gpointer g_class)
+{
+  GstElementClass *element_class = GST_ELEMENT_CLASS (g_class);
+
+  gst_element_class_add_static_pad_template (element_class, &sink_template);
+  gst_element_class_add_static_pad_template (element_class, &src_template);
+
+  gst_element_class_set_details_simple (element_class,
+      "GdkPixbuf Overlay", "Filter/Effect/Video",
+      "Overlay an image onto a video stream",
+      "Tim-Philipp Müller <tim centricular net>");
+}
+
+static void
+gst_gdk_pixbuf_overlay_class_init (GstGdkPixbufOverlayClass * klass)
+{
+  GstBaseTransformClass *basetrans_class = GST_BASE_TRANSFORM_CLASS (klass);
+  GObjectClass *gobject_class = G_OBJECT_CLASS (klass);
+
+  gobject_class->set_property = gst_gdk_pixbuf_overlay_set_property;
+  gobject_class->get_property = gst_gdk_pixbuf_overlay_get_property;
+  gobject_class->finalize = gst_gdk_pixbuf_overlay_finalize;
+
+  basetrans_class->start = GST_DEBUG_FUNCPTR (gst_gdk_pixbuf_overlay_start);
+  basetrans_class->stop = GST_DEBUG_FUNCPTR (gst_gdk_pixbuf_overlay_stop);
+  basetrans_class->set_caps =
+      GST_DEBUG_FUNCPTR (gst_gdk_pixbuf_overlay_set_caps);
+  basetrans_class->transform_ip =
+      GST_DEBUG_FUNCPTR (gst_gdk_pixbuf_overlay_transform_ip);
+  basetrans_class->before_transform =
+      GST_DEBUG_FUNCPTR (gst_gdk_pixbuf_overlay_before_transform);
+
+  g_object_class_install_property (gobject_class, PROP_LOCATION,
+      g_param_spec_string ("location", "location",
+          "Location of image file to overlay", NULL,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (gobject_class, PROP_OFFSET_X,
+      g_param_spec_int ("offset-x", "X Offset",
+          "Horizontal offset of overlay image in pixels from top-left corner "
+          "of video image", G_MININT, G_MAXINT, 0,
+          GST_PARAM_CONTROLLABLE | GST_PARAM_MUTABLE_PLAYING | G_PARAM_READWRITE
+          | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (gobject_class, PROP_OFFSET_Y,
+      g_param_spec_int ("offset-y", "Y Offset",
+          "Vertical offset of overlay image in pixels from top-left corner "
+          "of video image", G_MININT, G_MAXINT, 0,
+          GST_PARAM_CONTROLLABLE | GST_PARAM_MUTABLE_PLAYING | G_PARAM_READWRITE
+          | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (gobject_class, PROP_RELATIVE_X,
+      g_param_spec_double ("relative-x", "Relative X Offset",
+          "Horizontal offset of overlay image in fractions of video image "
+          "width, from top-left corner of video image", 0.0, 1.0, 0.0,
+          GST_PARAM_CONTROLLABLE | GST_PARAM_MUTABLE_PLAYING | G_PARAM_READWRITE
+          | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (gobject_class, PROP_RELATIVE_Y,
+      g_param_spec_double ("relative-y", "Relative Y Offset",
+          "Vertical offset of overlay image in fractions of video image "
+          "height, from top-left corner of video image", 0.0, 1.0, 0.0,
+          GST_PARAM_CONTROLLABLE | GST_PARAM_MUTABLE_PLAYING | G_PARAM_READWRITE
+          | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (gobject_class, PROP_OVERLAY_WIDTH,
+      g_param_spec_int ("overlay-width", "Overlay Width",
+          "Width of overlay image in pixels (0 = same as overlay image)", 0,
+          G_MAXINT, 0,
+          GST_PARAM_CONTROLLABLE | GST_PARAM_MUTABLE_PLAYING | G_PARAM_READWRITE
+          | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (gobject_class, PROP_OVERLAY_HEIGHT,
+      g_param_spec_int ("overlay-height", "Overlay Height",
+          "Height of overlay image in pixels (0 = same as overlay image)", 0,
+          G_MAXINT, 0,
+          GST_PARAM_CONTROLLABLE | GST_PARAM_MUTABLE_PLAYING | G_PARAM_READWRITE
+          | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (gobject_class, PROP_ALPHA,
+      g_param_spec_double ("alpha", "Alpha", "Global alpha of overlay image",
+          0.0, 1.0, 1.0, GST_PARAM_CONTROLLABLE | GST_PARAM_MUTABLE_PLAYING
+          | G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
+  GST_DEBUG_CATEGORY_INIT (gdkpixbufoverlay_debug, "gdkpixbufoverlay", 0,
+      "debug category for gdkpixbufoverlay element");
+}
+
+static void
+gst_gdk_pixbuf_overlay_init (GstGdkPixbufOverlay * overlay,
+    GstGdkPixbufOverlayClass * overlay_class)
+{
+  overlay->offset_x = 0;
+  overlay->offset_y = 0;
+
+  overlay->relative_x = 0.0;
+  overlay->relative_y = 0.0;
+
+  overlay->overlay_width = 0;
+  overlay->overlay_height = 0;
+
+  overlay->alpha = 1.0;
+}
+
+void
+gst_gdk_pixbuf_overlay_set_property (GObject * object, guint property_id,
+    const GValue * value, GParamSpec * pspec)
+{
+  GstGdkPixbufOverlay *overlay = GST_GDK_PIXBUF_OVERLAY (object);
+
+  GST_OBJECT_LOCK (overlay);
+
+  switch (property_id) {
+    case PROP_LOCATION:
+      g_free (overlay->location);
+      overlay->location = g_value_dup_string (value);
+      break;
+    case PROP_OFFSET_X:
+      overlay->offset_x = g_value_get_int (value);
+      overlay->update_composition = TRUE;
+      break;
+    case PROP_OFFSET_Y:
+      overlay->offset_y = g_value_get_int (value);
+      overlay->update_composition = TRUE;
+      break;
+    case PROP_RELATIVE_X:
+      overlay->relative_x = g_value_get_double (value);
+      overlay->update_composition = TRUE;
+      break;
+    case PROP_RELATIVE_Y:
+      overlay->relative_y = g_value_get_double (value);
+      overlay->update_composition = TRUE;
+      break;
+    case PROP_OVERLAY_WIDTH:
+      overlay->overlay_width = g_value_get_int (value);
+      overlay->update_composition = TRUE;
+      break;
+    case PROP_OVERLAY_HEIGHT:
+      overlay->overlay_height = g_value_get_int (value);
+      overlay->update_composition = TRUE;
+      break;
+    case PROP_ALPHA:
+      overlay->alpha = g_value_get_double (value);
+      overlay->update_composition = TRUE;
+      break;
+    default:
+      G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
+      break;
+  }
+
+  GST_OBJECT_UNLOCK (overlay);
+}
+
+void
+gst_gdk_pixbuf_overlay_get_property (GObject * object, guint property_id,
+    GValue * value, GParamSpec * pspec)
+{
+  GstGdkPixbufOverlay *overlay = GST_GDK_PIXBUF_OVERLAY (object);
+
+  GST_OBJECT_LOCK (overlay);
+
+  switch (property_id) {
+    case PROP_LOCATION:
+      g_value_set_string (value, overlay->location);
+      break;
+    case PROP_OFFSET_X:
+      g_value_set_int (value, overlay->offset_x);
+      break;
+    case PROP_OFFSET_Y:
+      g_value_set_int (value, overlay->offset_y);
+      break;
+    case PROP_RELATIVE_X:
+      g_value_set_double (value, overlay->relative_x);
+      break;
+    case PROP_RELATIVE_Y:
+      g_value_set_double (value, overlay->relative_y);
+      break;
+    case PROP_OVERLAY_WIDTH:
+      g_value_set_int (value, overlay->overlay_width);
+      break;
+    case PROP_OVERLAY_HEIGHT:
+      g_value_set_int (value, overlay->overlay_height);
+      break;
+    case PROP_ALPHA:
+      g_value_set_double (value, overlay->alpha);
+      break;
+    default:
+      G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
+      break;
+  }
+
+  GST_OBJECT_UNLOCK (overlay);
+}
+
+void
+gst_gdk_pixbuf_overlay_finalize (GObject * object)
+{
+  GstGdkPixbufOverlay *overlay = GST_GDK_PIXBUF_OVERLAY (object);
+
+  g_free (overlay->location);
+  overlay->location = NULL;
+
+  G_OBJECT_CLASS (parent_class)->finalize (object);
+}
+
+static gboolean
+gst_gdk_pixbuf_overlay_load_image (GstGdkPixbufOverlay * overlay, GError ** err)
+{
+  GdkPixbuf *pixbuf;
+  guint8 *pixels, *p;
+  gint width, height, stride, w, h;
+
+  pixbuf = gdk_pixbuf_new_from_file (overlay->location, err);
+
+  if (pixbuf == NULL)
+    return FALSE;
+
+  if (!gdk_pixbuf_get_has_alpha (pixbuf)) {
+    GdkPixbuf *alpha_pixbuf;
+
+    /* FIXME: we could do this much more efficiently ourselves below, but
+     * we're lazy for now */
+    /* FIXME: perhaps expose substitute_color via properties */
+    alpha_pixbuf = gdk_pixbuf_add_alpha (pixbuf, FALSE, 0, 0, 0);
+    g_object_unref (pixbuf);
+    pixbuf = alpha_pixbuf;
+  }
+
+  width = gdk_pixbuf_get_width (pixbuf);
+  height = gdk_pixbuf_get_height (pixbuf);
+  stride = gdk_pixbuf_get_rowstride (pixbuf);
+  pixels = gdk_pixbuf_get_pixels (pixbuf);
+
+  /* the memory layout in GdkPixbuf is R-G-B-A, we want:
+   *  - B-G-R-A on little-endian platforms
+   *  - A-R-G-B on big-endian platforms
+   */
+  for (h = 0; h < height; ++h) {
+    p = pixels + (h * stride);
+    for (w = 0; w < width; ++w) {
+      guint8 tmp;
+
+      /* R-G-B-A ==> B-G-R-A */
+      tmp = p[0];
+      p[0] = p[2];
+      p[2] = tmp;
+
+      if (G_BYTE_ORDER == G_BIG_ENDIAN) {
+        /* B-G-R-A ==> A-R-G-B */
+        /* we can probably assume sane alignment */
+        *((guint32 *) p) = GUINT32_SWAP_LE_BE (*((guint32 *) p));
+      }
+
+      p += 4;
+    }
+  }
+
+  overlay->pixels = gst_buffer_new ();
+  GST_BUFFER_DATA (overlay->pixels) = pixels;
+  /* assume we have row padding even for the last row */
+  GST_BUFFER_SIZE (overlay->pixels) = height * stride;
+  /* transfer ownership of pixbuf to buffer */
+  GST_BUFFER_MALLOCDATA (overlay->pixels) = (guint8 *) pixbuf;
+  GST_BUFFER_FREE_FUNC (overlay->pixels) = (GFreeFunc) g_object_unref;
+
+  overlay->pixels_width = width;
+  overlay->pixels_height = height;
+  overlay->pixels_stride = stride;
+
+  overlay->update_composition = TRUE;
+
+  GST_INFO_OBJECT (overlay, "Loaded image, %d x %d", width, height);
+  return TRUE;
+}
+
+static gboolean
+gst_gdk_pixbuf_overlay_start (GstBaseTransform * trans)
+{
+  GstGdkPixbufOverlay *overlay = GST_GDK_PIXBUF_OVERLAY (trans);
+  GError *err = NULL;
+
+  if (overlay->location != NULL) {
+    if (!gst_gdk_pixbuf_overlay_load_image (overlay, &err))
+      goto error_loading_image;
+
+    gst_base_transform_set_passthrough (trans, FALSE);
+  } else {
+    GST_WARNING_OBJECT (overlay, "no image location set, doing nothing");
+    gst_base_transform_set_passthrough (trans, TRUE);
+  }
+
+  return TRUE;
+
+/* ERRORS */
+error_loading_image:
+  {
+    GST_ELEMENT_ERROR (overlay, RESOURCE, OPEN_READ,
+        ("Could not load overlay image."), ("%s", err->message));
+    g_error_free (err);
+    return FALSE;
+  }
+}
+
+static gboolean
+gst_gdk_pixbuf_overlay_stop (GstBaseTransform * trans)
+{
+  GstGdkPixbufOverlay *overlay = GST_GDK_PIXBUF_OVERLAY (trans);
+
+  if (overlay->comp) {
+    gst_video_overlay_composition_unref (overlay->comp);
+    overlay->comp = NULL;
+  }
+
+  gst_buffer_replace (&overlay->pixels, NULL);
+
+  return TRUE;
+}
+
+static gboolean
+gst_gdk_pixbuf_overlay_set_caps (GstBaseTransform * trans, GstCaps * incaps,
+    GstCaps * outcaps)
+{
+  GstGdkPixbufOverlay *overlay = GST_GDK_PIXBUF_OVERLAY (trans);
+  GstVideoFormat video_format;
+  int w, h;
+
+  if (!gst_video_format_parse_caps (incaps, &video_format, &w, &h))
+    return FALSE;
+
+  overlay->format = video_format;
+  overlay->width = w;
+  overlay->height = h;
+  return TRUE;
+}
+
+static void
+gst_gdk_pixbuf_overlay_update_composition (GstGdkPixbufOverlay * overlay)
+{
+  GstVideoOverlayComposition *comp;
+  GstVideoOverlayRectangle *rect;
+  gint x, y, width, height;
+
+  if (overlay->comp) {
+    gst_video_overlay_composition_unref (overlay->comp);
+    overlay->comp = NULL;
+  }
+
+  if (overlay->alpha == 0.0)
+    return;
+
+  x = overlay->offset_x + (overlay->relative_x * overlay->pixels_width);
+  y = overlay->offset_y + (overlay->relative_y * overlay->pixels_height);
+
+  /* FIXME: this should work, but seems to crash */
+  if (x < 0)
+    x = 0;
+  if (y < 0)
+    y = 0;
+
+  width = overlay->overlay_width;
+  if (width == 0)
+    width = overlay->pixels_width;
+
+  height = overlay->overlay_height;
+  if (height == 0)
+    height = overlay->pixels_height;
+
+  GST_DEBUG_OBJECT (overlay, "overlay image dimensions: %d x %d, alpha=%.2f",
+      overlay->pixels_width, overlay->pixels_height, overlay->alpha);
+  GST_DEBUG_OBJECT (overlay, "properties: x,y: %d,%d (%g%%,%g%%) - WxH: %dx%d",
+      overlay->offset_x, overlay->offset_y,
+      overlay->relative_x * 100.0, overlay->relative_y * 100.0,
+      overlay->overlay_height, overlay->overlay_width);
+  GST_DEBUG_OBJECT (overlay, "overlay rendered: %d x %d @ %d,%d (onto %d x %d)",
+      width, height, x, y, overlay->width, overlay->height);
+
+  rect = gst_video_overlay_rectangle_new_argb (overlay->pixels,
+      overlay->pixels_width, overlay->pixels_height, overlay->pixels_stride,
+      x, y, width, height, GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE);
+
+  if (overlay->alpha != 1.0)
+    gst_video_overlay_rectangle_set_global_alpha (rect, overlay->alpha);
+
+  comp = gst_video_overlay_composition_new (rect);
+  gst_video_overlay_rectangle_unref (rect);
+
+  overlay->comp = comp;
+}
+
+static void
+gst_gdk_pixbuf_overlay_before_transform (GstBaseTransform * trans,
+    GstBuffer * outbuf)
+{
+  GstClockTime stream_time;
+
+  stream_time = gst_segment_to_stream_time (&trans->segment, GST_FORMAT_TIME,
+      GST_BUFFER_TIMESTAMP (outbuf));
+
+  if (GST_CLOCK_TIME_IS_VALID (stream_time))
+    gst_object_sync_values (G_OBJECT (trans), stream_time);
+}
+
+static GstFlowReturn
+gst_gdk_pixbuf_overlay_transform_ip (GstBaseTransform * trans, GstBuffer * buf)
+{
+  GstGdkPixbufOverlay *overlay = GST_GDK_PIXBUF_OVERLAY (trans);
+
+  GST_OBJECT_LOCK (overlay);
+
+  if (G_UNLIKELY (overlay->update_composition)) {
+    gst_gdk_pixbuf_overlay_update_composition (overlay);
+    overlay->update_composition = FALSE;
+  }
+
+  GST_OBJECT_UNLOCK (overlay);
+
+  if (overlay->comp != NULL)
+    gst_video_overlay_composition_blend (overlay->comp, buf);
+
+  return GST_FLOW_OK;
+}
diff --git a/ext/gdk_pixbuf/gstgdkpixbufoverlay.h b/ext/gdk_pixbuf/gstgdkpixbufoverlay.h
new file mode 100644
index 0000000..f815e31
--- /dev/null
+++ b/ext/gdk_pixbuf/gstgdkpixbufoverlay.h
@@ -0,0 +1,89 @@
+/* GStreamer GdkPixbuf overlay
+ * Copyright (C) 2012 Tim-Philipp Müller <tim centricular net>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifndef _GST_GDK_PIXBUF_OVERLAY_H_
+#define _GST_GDK_PIXBUF_OVERLAY_H_
+
+#include <gst/video/video.h>
+#include <gst/video/gstvideofilter.h>
+#include <gst/video/video-overlay-composition.h>
+
+#include <gdk-pixbuf/gdk-pixbuf.h>
+
+G_BEGIN_DECLS
+
+#define GST_TYPE_GDK_PIXBUF_OVERLAY   (gst_gdk_pixbuf_overlay_get_type())
+#define GST_GDK_PIXBUF_OVERLAY(obj)   (G_TYPE_CHECK_INSTANCE_CAST((obj),GST_TYPE_GDK_PIXBUF_OVERLAY,GstGdkPixbufOverlay))
+#define GST_GDK_PIXBUF_OVERLAY_CLASS(klass)   (G_TYPE_CHECK_CLASS_CAST((klass),GST_TYPE_GDK_PIXBUF_OVERLAY,GstGdkPixbufOverlayClass))
+#define GST_IS_GDK_PIXBUF_OVERLAY(obj)   (G_TYPE_CHECK_INSTANCE_TYPE((obj),GST_TYPE_GDK_PIXBUF_OVERLAY))
+#define GST_IS_GDK_PIXBUF_OVERLAY_CLASS(obj)   (G_TYPE_CHECK_CLASS_TYPE((klass),GST_TYPE_GDK_PIXBUF_OVERLAY))
+
+typedef struct _GstGdkPixbufOverlay GstGdkPixbufOverlay;
+typedef struct _GstGdkPixbufOverlayClass GstGdkPixbufOverlayClass;
+
+/**
+ * GstGdkPixbufOverlay:
+ *
+ * The opaque element instance structure.
+ */
+struct _GstGdkPixbufOverlay
+{
+  GstVideoFilter               videofilter;
+
+  /* negotiated format */
+  GstVideoFormat               format;
+  gint                         width;
+  gint                         height;
+
+  /* properties */
+  gchar                      * location;
+
+  gint                         offset_x;
+  gint                         offset_y;
+
+  gdouble                      relative_x;
+  gdouble                      relative_y;
+
+  gint                         overlay_width;
+  gint                         overlay_height;
+
+  gdouble                      alpha;
+
+  /* the loaded image */
+  GstBuffer                  * pixels;
+  guint                        pixels_width;
+  guint                        pixels_height;
+  guint                        pixels_stride;
+
+  GstVideoOverlayComposition * comp;
+
+  /* render position or dimension has changed */
+  gboolean                     update_composition;
+};
+
+struct _GstGdkPixbufOverlayClass
+{
+  GstVideoFilterClass  videofilter_class;
+};
+
+GType gst_gdk_pixbuf_overlay_get_type (void);
+
+G_END_DECLS
+
+#endif
diff --git a/ext/hal/Makefile.in b/ext/hal/Makefile.in
index 7a67203..8aa0567 100644
--- a/ext/hal/Makefile.in
+++ b/ext/hal/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/hal
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -122,10 +138,23 @@ libgsthalelements_la_OBJECTS = $(am_libgsthalelements_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgsthalelements_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgsthalelements_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgsthalelements_la_CFLAGS) $(CFLAGS) \
 	$(libgsthalelements_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -138,22 +167,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgsthalelements_la_SOURCES)
 DIST_SOURCES = $(libgsthalelements_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -213,6 +243,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -261,8 +292,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -343,7 +376,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -403,6 +436,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -476,7 +510,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -533,7 +571,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -541,6 +578,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -556,12 +595,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgsthalelements.la: $(libgsthalelements_la_OBJECTS) $(libgsthalelements_la_DEPENDENCIES) $(EXTRA_libgsthalelements_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgsthalelements_la_LINK) -rpath $(plugindir) $(libgsthalelements_la_OBJECTS) $(libgsthalelements_la_LIBADD) $(LIBS)
 
@@ -680,6 +721,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -824,18 +879,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/jack/Makefile.in b/ext/jack/Makefile.in
index 5c4f09f..4bf2a5e 100644
--- a/ext/jack/Makefile.in
+++ b/ext/jack/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/jack
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -121,10 +137,23 @@ libgstjack_la_OBJECTS = $(am_libgstjack_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstjack_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstjack_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstjack_la_CFLAGS) $(CFLAGS) \
 	$(libgstjack_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -137,22 +166,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstjack_la_SOURCES)
 DIST_SOURCES = $(libgstjack_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -212,6 +242,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -260,8 +291,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -342,7 +375,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -402,6 +435,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -475,7 +509,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -522,7 +560,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -530,6 +567,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -545,12 +584,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstjack.la: $(libgstjack_la_OBJECTS) $(libgstjack_la_DEPENDENCIES) $(EXTRA_libgstjack_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstjack_la_LINK) -rpath $(plugindir) $(libgstjack_la_OBJECTS) $(libgstjack_la_LIBADD) $(LIBS)
 
@@ -677,6 +718,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -821,18 +876,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/jack/gstjack.c b/ext/jack/gstjack.c
index 8180afb..680a12d 100644
--- a/ext/jack/gstjack.c
+++ b/ext/jack/gstjack.c
@@ -46,6 +46,25 @@ gst_jack_connect_get_type (void)
   return (GType) jack_connect_type;
 }
 
+GType
+gst_jack_transport_get_type (void)
+{
+  static volatile gsize type = 0;
+
+  if (g_once_init_enter (&type)) {
+    static const GFlagsValue flag_values[] = {
+      {GST_JACK_TRANSPORT_MASTER,
+          "Start and stop transport with state changes", "master"},
+      {GST_JACK_TRANSPORT_SLAVE,
+          "Follow transport state changes", "slave"},
+      {0, NULL, NULL},
+    };
+    GType tmp = g_flags_register_static ("GstJackTransport", flag_values);
+    g_once_init_leave (&type, tmp);
+  }
+  return (GType) type;
+}
+
 
 static gpointer
 gst_jack_client_copy (gpointer jclient)
diff --git a/ext/jack/gstjack.h b/ext/jack/gstjack.h
index d923866..50033d9 100644
--- a/ext/jack/gstjack.h
+++ b/ext/jack/gstjack.h
@@ -37,19 +37,35 @@
  *
  * Specify how the output ports will be connected.
  */
-
 typedef enum {
   GST_JACK_CONNECT_NONE,
   GST_JACK_CONNECT_AUTO,
   GST_JACK_CONNECT_AUTO_FORCED
 } GstJackConnect;
 
+/**
+ * GstJackTransport:
+ * @GST_JACK_TRANSPORT_AUTONOMOUS: no transport support
+ * @GST_JACK_TRANSPORT_MASTER: start and stop transport with state-changes
+ * @GST_JACK_TRANSPORT_SLAVE: follow transport state changes
+ *
+ * The jack transport state allow to sync multiple clients. This enum defines a
+ * client behaviour regarding to the transport mechanism.
+ */
+typedef enum {
+  GST_JACK_TRANSPORT_AUTONOMOUS = 0,
+  GST_JACK_TRANSPORT_MASTER = (1 << 0),
+  GST_JACK_TRANSPORT_SLAVE = (1 << 1),
+} GstJackTransport;
+
 typedef jack_default_audio_sample_t sample_t;
 
-#define GST_TYPE_JACK_CONNECT (gst_jack_connect_get_type())
-#define GST_TYPE_JACK_CLIENT  (gst_jack_client_get_type ())
+#define GST_TYPE_JACK_CONNECT   (gst_jack_connect_get_type ())
+#define GST_TYPE_JACK_TRANSPORT (gst_jack_transport_get_type ())
+#define GST_TYPE_JACK_CLIENT    (gst_jack_client_get_type ())
 
 GType gst_jack_client_get_type(void);
 GType gst_jack_connect_get_type(void);
+GType gst_jack_transport_get_type(void);
 
 #endif  // _GST_JACK_H_
diff --git a/ext/jack/gstjackaudioclient.c b/ext/jack/gstjackaudioclient.c
index 2bb3555..8680cda 100644
--- a/ext/jack/gstjackaudioclient.c
+++ b/ext/jack/gstjackaudioclient.c
@@ -22,6 +22,7 @@
 #include <string.h>
 
 #include "gstjackaudioclient.h"
+#include "gstjack.h"
 
 #include <gst/glib-compat-private.h>
 
@@ -55,6 +56,10 @@ typedef struct
   gint n_clients;
   GList *src_clients;
   GList *sink_clients;
+
+  /* transport state handling */
+  gint cur_ts;
+  GstState transport_state;
 } GstJackAudioConnection;
 
 /* an object sharing a jack_client_t connection. */
@@ -66,27 +71,65 @@ struct _GstJackAudioClient
   gboolean active;
   gboolean deactivate;
 
-  void (*shutdown) (void *arg);
+  JackShutdownCallback shutdown;
   JackProcessCallback process;
   JackBufferSizeCallback buffer_size;
   JackSampleRateCallback sample_rate;
   gpointer user_data;
 };
 
-typedef jack_default_audio_sample_t sample_t;
-
 typedef struct
 {
   jack_nframes_t nframes;
   gpointer user_data;
 } JackCB;
 
+static gboolean
+jack_handle_transport_change (GstJackAudioClient * client, GstState state)
+{
+  GstObject *obj = GST_OBJECT_PARENT (client->user_data);
+  guint mode;
+
+  g_object_get (obj, "transport", &mode, NULL);
+  if ((mode & GST_JACK_TRANSPORT_SLAVE) && (GST_STATE (obj) != state)) {
+    GST_INFO_OBJECT (obj, "requesting state change: %s",
+        gst_element_state_get_name (state));
+    gst_element_post_message (GST_ELEMENT (obj),
+        gst_message_new_request_state (obj, state));
+    return TRUE;
+  }
+  return FALSE;
+}
+
 static int
 jack_process_cb (jack_nframes_t nframes, void *arg)
 {
   GstJackAudioConnection *conn = (GstJackAudioConnection *) arg;
   GList *walk;
   int res = 0;
+  jack_transport_state_t ts = jack_transport_query (conn->client, NULL);
+
+  if (ts != conn->cur_ts) {
+    conn->cur_ts = ts;
+    switch (ts) {
+      case JackTransportStopped:
+        GST_DEBUG ("transport state is 'stopped'");
+        conn->transport_state = GST_STATE_PAUSED;
+        break;
+      case JackTransportStarting:
+        GST_DEBUG ("transport state is 'starting'");
+        conn->transport_state = GST_STATE_READY;
+        break;
+      case JackTransportRolling:
+        GST_DEBUG ("transport state is 'rolling'");
+        conn->transport_state = GST_STATE_PLAYING;
+        break;
+      default:
+        break;
+    }
+    GST_DEBUG ("num of clients: src=%d, sink=%d",
+        g_list_length (conn->src_clients), g_list_length (conn->sink_clients));
+  }
 
   g_mutex_lock (conn->lock);
   /* call sources first, then sinks. Sources will either push data into the
@@ -116,8 +159,28 @@ jack_process_cb (jack_nframes_t nframes, void *arg)
       }
     }
   }
-  g_mutex_unlock (conn->lock);
 
+  /* handle transport state requisition, do sinks first, stop after the first
+   * element that handled it */
+  if (conn->transport_state != GST_STATE_VOID_PENDING) {
+    for (walk = conn->sink_clients; walk; walk = g_list_next (walk)) {
+      if (jack_handle_transport_change ((GstJackAudioClient *) walk->data,
+              conn->transport_state)) {
+        conn->transport_state = GST_STATE_VOID_PENDING;
+        break;
+      }
+    }
+  }
+  if (conn->transport_state != GST_STATE_VOID_PENDING) {
+    for (walk = conn->src_clients; walk; walk = g_list_next (walk)) {
+      if (jack_handle_transport_change ((GstJackAudioClient *) walk->data,
+              conn->transport_state)) {
+        conn->transport_state = GST_STATE_VOID_PENDING;
+        break;
+      }
+    }
+  }
+  g_mutex_unlock (conn->lock);
   return res;
 }
 
@@ -224,6 +287,8 @@ gst_jack_audio_make_connection (const gchar * id, const gchar * server,
   conn->n_clients = 0;
   conn->src_clients = NULL;
   conn->sink_clients = NULL;
+  conn->cur_ts = -1;
+  conn->transport_state = GST_STATE_VOID_PENDING;
 
   /* set our callbacks  */
   jack_set_process_callback (jclient, jack_process_cb, conn);
@@ -233,6 +298,7 @@ gst_jack_audio_make_connection (const gchar * id, const gchar * server,
   jack_on_shutdown (jclient, jack_shutdown_cb, conn);
 
   /* all callbacks are set, activate the client */
+  GST_INFO ("activate jack_client %p", jclient);
   if ((res = jack_activate (jclient)))
     goto could_not_activate;
 
@@ -327,6 +393,7 @@ gst_jack_audio_unref_connection (GstJackAudioConnection * conn)
      *      waiting for the JACK thread, and can thus cause deadlock in 
      *      jack_process_cb()
      */
+    GST_INFO ("deactivate jack_client %p", conn->client);
     if ((res = jack_deactivate (conn->client))) {
       /* we only warn, this means the server is probably shut down and the client
        * is gone anyway. */
@@ -525,3 +592,22 @@ gst_jack_audio_client_set_active (GstJackAudioClient * client, gboolean active)
 
   return 0;
 }
+
+/**
+ * gst_jack_audio_client_get_transport_state:
+ * @client: a #GstJackAudioClient
+ *
+ * Check the current transport state. The client can use this to request a state
+ * change from the application.
+ *
+ * Returns: the state, %GST_STATE_VOID_PENDING for no change in the transport
+ * state
+ */
+GstState
+gst_jack_audio_client_get_transport_state (GstJackAudioClient * client)
+{
+  GstState state = client->conn->transport_state;
+
+  client->conn->transport_state = GST_STATE_VOID_PENDING;
+  return state;
+}
diff --git a/ext/jack/gstjackaudioclient.h b/ext/jack/gstjackaudioclient.h
index 5fb7e35..f2669c9 100644
--- a/ext/jack/gstjackaudioclient.h
+++ b/ext/jack/gstjackaudioclient.h
@@ -54,6 +54,8 @@ jack_client_t *       gst_jack_audio_client_get_client     (GstJackAudioClient *
 
 gboolean              gst_jack_audio_client_set_active     (GstJackAudioClient *client, gboolean active);
 
+GstState              gst_jack_audio_client_get_transport_state (GstJackAudioClient *client);
+
 G_END_DECLS
 
 #endif /* __GST_JACK_AUDIO_CLIENT_H__ */
diff --git a/ext/jack/gstjackaudiosink.c b/ext/jack/gstjackaudiosink.c
index 078ca24..527a864 100644
--- a/ext/jack/gstjackaudiosink.c
+++ b/ext/jack/gstjackaudiosink.c
@@ -560,6 +560,13 @@ gst_jack_ring_buffer_start (GstRingBuffer * buf)
 
   GST_DEBUG_OBJECT (sink, "start");
 
+  if (sink->transport & GST_JACK_TRANSPORT_MASTER) {
+    jack_client_t *client;
+
+    client = gst_jack_audio_client_get_client (sink->client);
+    jack_transport_start (client);
+  }
+
   return TRUE;
 }
 
@@ -572,6 +579,13 @@ gst_jack_ring_buffer_pause (GstRingBuffer * buf)
 
   GST_DEBUG_OBJECT (sink, "pause");
 
+  if (sink->transport & GST_JACK_TRANSPORT_MASTER) {
+    jack_client_t *client;
+
+    client = gst_jack_audio_client_get_client (sink->client);
+    jack_transport_stop (client);
+  }
+
   return TRUE;
 }
 
@@ -584,6 +598,13 @@ gst_jack_ring_buffer_stop (GstRingBuffer * buf)
 
   GST_DEBUG_OBJECT (sink, "stop");
 
+  if (sink->transport & GST_JACK_TRANSPORT_MASTER) {
+    jack_client_t *client;
+
+    client = gst_jack_audio_client_get_client (sink->client);
+    jack_transport_stop (client);
+  }
+
   return TRUE;
 }
 
@@ -650,7 +671,8 @@ enum
 
 #define DEFAULT_PROP_CONNECT 		GST_JACK_CONNECT_AUTO
 #define DEFAULT_PROP_SERVER 		NULL
-#define DEFAULT_PROP_CLIENT_NAME 	NULL
+#define DEFAULT_PROP_CLIENT_NAME	NULL
+#define DEFAULT_PROP_TRANSPORT	GST_JACK_TRANSPORT_AUTONOMOUS
 
 enum
 {
@@ -659,6 +681,7 @@ enum
   PROP_SERVER,
   PROP_CLIENT,
   PROP_CLIENT_NAME,
+  PROP_TRANSPORT,
   PROP_LAST
 };
 
@@ -736,6 +759,19 @@ gst_jack_audio_sink_class_init (GstJackAudioSinkClass * klass)
           GST_PARAM_MUTABLE_READY | G_PARAM_READWRITE |
           G_PARAM_STATIC_STRINGS));
 
+  /**
+   * GstJackAudioSink:transport
+   *
+   * The jack transport behaviour for the client.
+   *
+   * Since: 0.10.31
+   */
+  g_object_class_install_property (gobject_class, PROP_TRANSPORT,
+      g_param_spec_flags ("transport", "Transport mode",
+          "Jack transport behaviour of the client",
+          GST_TYPE_JACK_TRANSPORT, DEFAULT_PROP_TRANSPORT,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
   gstbasesink_class->get_caps = GST_DEBUG_FUNCPTR (gst_jack_audio_sink_getcaps);
 
   gstbaseaudiosink_class->create_ringbuffer =
@@ -757,8 +793,9 @@ gst_jack_audio_sink_init (GstJackAudioSink * sink,
   sink->jclient = NULL;
   sink->ports = NULL;
   sink->port_count = 0;
-  sink->client_name = g_strdup (DEFAULT_PROP_CLIENT_NAME);
   sink->buffers = NULL;
+  sink->client_name = g_strdup (DEFAULT_PROP_CLIENT_NAME);
+  sink->transport = DEFAULT_PROP_TRANSPORT;
 }
 
 static void
@@ -802,6 +839,9 @@ gst_jack_audio_sink_set_property (GObject * object, guint prop_id,
         sink->jclient = g_value_get_boxed (value);
       }
       break;
+    case PROP_TRANSPORT:
+      sink->transport = g_value_get_flags (value);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
@@ -829,6 +869,9 @@ gst_jack_audio_sink_get_property (GObject * object, guint prop_id,
     case PROP_CLIENT:
       g_value_set_boxed (value, sink->jclient);
       break;
+    case PROP_TRANSPORT:
+      g_value_set_flags (value, sink->transport);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
diff --git a/ext/jack/gstjackaudiosink.h b/ext/jack/gstjackaudiosink.h
index db5fc28..fbb660d 100644
--- a/ext/jack/gstjackaudiosink.h
+++ b/ext/jack/gstjackaudiosink.h
@@ -59,6 +59,7 @@ struct _GstJackAudioSink {
   gchar           *server;
   jack_client_t   *jclient;
   gchar           *client_name;
+  guint            transport;
 
   /* our client */
   GstJackAudioClient *client;
diff --git a/ext/jack/gstjackaudiosrc.c b/ext/jack/gstjackaudiosrc.c
index 3c37970..2063875 100644
--- a/ext/jack/gstjackaudiosrc.c
+++ b/ext/jack/gstjackaudiosrc.c
@@ -572,6 +572,13 @@ gst_jack_ring_buffer_start (GstRingBuffer * buf)
 
   GST_DEBUG_OBJECT (src, "start");
 
+  if (src->transport & GST_JACK_TRANSPORT_MASTER) {
+    jack_client_t *client;
+
+    client = gst_jack_audio_client_get_client (src->client);
+    jack_transport_start (client);
+  }
+
   return TRUE;
 }
 
@@ -584,6 +591,13 @@ gst_jack_ring_buffer_pause (GstRingBuffer * buf)
 
   GST_DEBUG_OBJECT (src, "pause");
 
+  if (src->transport & GST_JACK_TRANSPORT_MASTER) {
+    jack_client_t *client;
+
+    client = gst_jack_audio_client_get_client (src->client);
+    jack_transport_stop (client);
+  }
+
   return TRUE;
 }
 
@@ -596,6 +610,13 @@ gst_jack_ring_buffer_stop (GstRingBuffer * buf)
 
   GST_DEBUG_OBJECT (src, "stop");
 
+  if (src->transport & GST_JACK_TRANSPORT_MASTER) {
+    jack_client_t *client;
+
+    client = gst_jack_audio_client_get_client (src->client);
+    jack_transport_stop (client);
+  }
+
   return TRUE;
 }
 
@@ -654,6 +675,7 @@ enum
 #define DEFAULT_PROP_CONNECT 		GST_JACK_CONNECT_AUTO
 #define DEFAULT_PROP_SERVER 		NULL
 #define DEFAULT_PROP_CLIENT_NAME	NULL
+#define DEFAULT_PROP_TRANSPORT	GST_JACK_TRANSPORT_AUTONOMOUS
 
 enum
 {
@@ -662,6 +684,7 @@ enum
   PROP_SERVER,
   PROP_CLIENT,
   PROP_CLIENT_NAME,
+  PROP_TRANSPORT,
   PROP_LAST
 };
 
@@ -756,6 +779,19 @@ gst_jack_audio_src_class_init (GstJackAudioSrcClass * klass)
           GST_PARAM_MUTABLE_READY | G_PARAM_READWRITE |
           G_PARAM_STATIC_STRINGS));
 
+  /**
+   * GstJackAudioSink:transport
+   *
+   * The jack transport behaviour for the client.
+   *
+   * Since: 0.10.31
+   */
+  g_object_class_install_property (gobject_class, PROP_TRANSPORT,
+      g_param_spec_flags ("transport", "Transport mode",
+          "Jack transport behaviour of the client",
+          GST_TYPE_JACK_TRANSPORT, DEFAULT_PROP_TRANSPORT,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
   gstbasesrc_class->get_caps = GST_DEBUG_FUNCPTR (gst_jack_audio_src_getcaps);
   gstbaseaudiosrc_class->create_ringbuffer =
       GST_DEBUG_FUNCPTR (gst_jack_audio_src_create_ringbuffer);
@@ -767,11 +803,6 @@ gst_jack_audio_src_class_init (GstJackAudioSrcClass * klass)
   gst_jack_audio_client_init ();
 }
 
-/* initialize the new element
- * instantiate pads and add them to element
- * set pad calback functions
- * initialize instance structure
- */
 static void
 gst_jack_audio_src_init (GstJackAudioSrc * src, GstJackAudioSrcClass * gclass)
 {
@@ -783,6 +814,7 @@ gst_jack_audio_src_init (GstJackAudioSrc * src, GstJackAudioSrcClass * gclass)
   src->port_count = 0;
   src->buffers = NULL;
   src->client_name = g_strdup (DEFAULT_PROP_CLIENT_NAME);
+  src->transport = DEFAULT_PROP_TRANSPORT;
 }
 
 static void
@@ -824,6 +856,9 @@ gst_jack_audio_src_set_property (GObject * object, guint prop_id,
         src->jclient = g_value_get_boxed (value);
       }
       break;
+    case PROP_TRANSPORT:
+      src->transport = g_value_get_flags (value);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
@@ -849,6 +884,9 @@ gst_jack_audio_src_get_property (GObject * object, guint prop_id,
     case PROP_CLIENT:
       g_value_set_boxed (value, src->jclient);
       break;
+    case PROP_TRANSPORT:
+      g_value_set_flags (value, src->transport);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
diff --git a/ext/jack/gstjackaudiosrc.h b/ext/jack/gstjackaudiosrc.h
index b69a4d6..c63f40c 100644
--- a/ext/jack/gstjackaudiosrc.h
+++ b/ext/jack/gstjackaudiosrc.h
@@ -72,10 +72,11 @@ struct _GstJackAudioSrc
     GstCaps         *caps;
 
     /* properties */
-    GstJackConnect connect;
+    GstJackConnect   connect;
     gchar           *server;
     jack_client_t   *jclient;
     gchar           *client_name;
+    guint            transport;
 
     /* our client */
     GstJackAudioClient *client;
diff --git a/ext/jpeg/Makefile.in b/ext/jpeg/Makefile.in
index 3cc176c..fcaf72e 100644
--- a/ext/jpeg/Makefile.in
+++ b/ext/jpeg/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/jpeg
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -122,10 +138,23 @@ libgstjpeg_la_OBJECTS = $(am_libgstjpeg_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstjpeg_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstjpeg_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstjpeg_la_CFLAGS) $(CFLAGS) \
 	$(libgstjpeg_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -138,22 +167,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstjpeg_la_SOURCES)
 DIST_SOURCES = $(libgstjpeg_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -213,6 +243,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -261,8 +292,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -343,7 +376,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -403,6 +436,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -476,7 +510,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -537,7 +575,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -545,6 +582,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -560,12 +599,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstjpeg.la: $(libgstjpeg_la_OBJECTS) $(libgstjpeg_la_DEPENDENCIES) $(EXTRA_libgstjpeg_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstjpeg_la_LINK) -rpath $(plugindir) $(libgstjpeg_la_OBJECTS) $(libgstjpeg_la_LIBADD) $(LIBS)
 
@@ -700,6 +741,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -844,18 +899,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/jpeg/gstjpegdec.c b/ext/jpeg/gstjpegdec.c
index 18cf20d..fd94082 100644
--- a/ext/jpeg/gstjpegdec.c
+++ b/ext/jpeg/gstjpegdec.c
@@ -1,6 +1,8 @@
 /* GStreamer
  * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
  * Copyright (C) <2009> Tim-Philipp Müller <tim centricular net>
+ * Copyright (C) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
  *
  * This library is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Library General Public
@@ -102,53 +104,23 @@ GST_DEBUG_CATEGORY_STATIC (GST_CAT_PERFORMANCE);
 
 #define I420_SIZE(w,h)     (I420_V_OFFSET(w,h)+(I420_V_ROWSTRIDE(w)*GST_ROUND_UP_2(h)/2))
 
-static GstElementClass *parent_class;   /* NULL */
-
-static void gst_jpeg_dec_base_init (gpointer g_class);
-static void gst_jpeg_dec_class_init (GstJpegDecClass * klass);
-static void gst_jpeg_dec_init (GstJpegDec * jpegdec);
-
 static void gst_jpeg_dec_set_property (GObject * object, guint prop_id,
     const GValue * value, GParamSpec * pspec);
 static void gst_jpeg_dec_get_property (GObject * object, guint prop_id,
     GValue * value, GParamSpec * pspec);
 
-static GstFlowReturn gst_jpeg_dec_chain (GstPad * pad, GstBuffer * buffer);
-static gboolean gst_jpeg_dec_setcaps (GstPad * pad, GstCaps * caps);
-static GstCaps *gst_jpeg_dec_getcaps (GstPad * pad);
-static gboolean gst_jpeg_dec_sink_event (GstPad * pad, GstEvent * event);
-static gboolean gst_jpeg_dec_src_event (GstPad * pad, GstEvent * event);
-static GstStateChangeReturn gst_jpeg_dec_change_state (GstElement * element,
-    GstStateChange transition);
-static void gst_jpeg_dec_update_qos (GstJpegDec * dec, gdouble proportion,
-    GstClockTimeDiff diff, GstClockTime ts);
-static void gst_jpeg_dec_reset_qos (GstJpegDec * dec);
-static void gst_jpeg_dec_read_qos (GstJpegDec * dec, gdouble * proportion,
-    GstClockTime * time);
-
-GType
-gst_jpeg_dec_get_type (void)
-{
-  static GType type = 0;
-
-  if (!type) {
-    static const GTypeInfo jpeg_dec_info = {
-      sizeof (GstJpegDecClass),
-      (GBaseInitFunc) gst_jpeg_dec_base_init,
-      NULL,
-      (GClassInitFunc) gst_jpeg_dec_class_init,
-      NULL,
-      NULL,
-      sizeof (GstJpegDec),
-      0,
-      (GInstanceInitFunc) gst_jpeg_dec_init,
-    };
-
-    type = g_type_register_static (GST_TYPE_ELEMENT, "GstJpegDec",
-        &jpeg_dec_info, 0);
-  }
-  return type;
-}
+static gboolean gst_jpeg_dec_set_format (GstVideoDecoder * dec,
+    GstVideoCodecState * state);
+static gboolean gst_jpeg_dec_start (GstVideoDecoder * bdec);
+static gboolean gst_jpeg_dec_stop (GstVideoDecoder * bdec);
+static gboolean gst_jpeg_dec_reset (GstVideoDecoder * bdec, gboolean hard);
+static GstFlowReturn gst_jpeg_dec_parse (GstVideoDecoder * bdec,
+    GstVideoCodecFrame * frame, GstAdapter * adapter, gboolean at_eos);
+static GstFlowReturn gst_jpeg_dec_handle_frame (GstVideoDecoder * bdec,
+    GstVideoCodecFrame * frame);
+
+GST_BOILERPLATE (GstJpegDec, gst_jpeg_dec, GstVideoDecoder,
+    GST_TYPE_VIDEO_DECODER);
 
 static void
 gst_jpeg_dec_finalize (GObject * object)
@@ -156,8 +128,8 @@ gst_jpeg_dec_finalize (GObject * object)
   GstJpegDec *dec = GST_JPEG_DEC (object);
 
   jpeg_destroy_decompress (&dec->cinfo);
-
-  g_object_unref (dec->adapter);
+  if (dec->input_state)
+    gst_video_codec_state_unref (dec->input_state);
 
   G_OBJECT_CLASS (parent_class)->finalize (object);
 }
@@ -179,11 +151,11 @@ gst_jpeg_dec_base_init (gpointer g_class)
 static void
 gst_jpeg_dec_class_init (GstJpegDecClass * klass)
 {
-  GstElementClass *gstelement_class;
   GObjectClass *gobject_class;
+  GstVideoDecoderClass *vdec_class;
 
-  gstelement_class = (GstElementClass *) klass;
   gobject_class = (GObjectClass *) klass;
+  vdec_class = (GstVideoDecoderClass *) klass;
 
   parent_class = g_type_class_peek_parent (klass);
 
@@ -212,8 +184,12 @@ gst_jpeg_dec_class_init (GstJpegDecClass * klass)
           -1, G_MAXINT, JPEG_DEFAULT_MAX_ERRORS,
           G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
-  gstelement_class->change_state =
-      GST_DEBUG_FUNCPTR (gst_jpeg_dec_change_state);
+  vdec_class->start = gst_jpeg_dec_start;
+  vdec_class->stop = gst_jpeg_dec_stop;
+  vdec_class->reset = gst_jpeg_dec_reset;
+  vdec_class->parse = gst_jpeg_dec_parse;
+  vdec_class->set_format = gst_jpeg_dec_set_format;
+  vdec_class->handle_frame = gst_jpeg_dec_handle_frame;
 
   GST_DEBUG_CATEGORY_INIT (jpeg_dec_debug, "jpegdec", 0, "JPEG decoder");
   GST_DEBUG_CATEGORY_GET (GST_CAT_PERFORMANCE, "GST_PERFORMANCE");
@@ -271,7 +247,7 @@ gst_jpeg_dec_post_error_or_warning (GstJpegDec * dec)
     ret = GST_FLOW_OK;
   } else if (max_errors == 0) {
     /* FIXME: do something more clever in "automatic mode" */
-    if (dec->packetized) {
+    if (gst_video_decoder_get_packetized (GST_VIDEO_DECODER (dec))) {
       ret = (dec->error_count < 3) ? GST_FLOW_OK : GST_FLOW_ERROR;
     } else {
       ret = GST_FLOW_ERROR;
@@ -298,29 +274,15 @@ static boolean
 gst_jpeg_dec_fill_input_buffer (j_decompress_ptr cinfo)
 {
   GstJpegDec *dec;
-  guint av;
 
   dec = CINFO_GET_JPEGDEC (cinfo);
   g_return_val_if_fail (dec != NULL, FALSE);
+  g_return_val_if_fail (dec->current_frame != NULL, FALSE);
 
-  av = gst_adapter_available_fast (dec->adapter);
-  GST_DEBUG_OBJECT (dec, "fill_input_buffer: fast av=%u, remaining=%u", av,
-      dec->rem_img_len);
-
-  if (av == 0) {
-    GST_DEBUG_OBJECT (dec, "Out of data");
-    return FALSE;
-  }
-
-  if (dec->rem_img_len < av)
-    av = dec->rem_img_len;
-  dec->rem_img_len -= av;
-
-  g_free (dec->cur_buf);
-  dec->cur_buf = gst_adapter_take (dec->adapter, av);
-
-  cinfo->src->next_input_byte = dec->cur_buf;
-  cinfo->src->bytes_in_buffer = av;
+  cinfo->src->next_input_byte =
+      GST_BUFFER_DATA (dec->current_frame->input_buffer);
+  cinfo->src->bytes_in_buffer =
+      GST_BUFFER_SIZE (dec->current_frame->input_buffer);
 
   return TRUE;
 }
@@ -342,22 +304,6 @@ gst_jpeg_dec_skip_input_data (j_decompress_ptr cinfo, glong num_bytes)
   if (num_bytes > 0 && cinfo->src->bytes_in_buffer >= num_bytes) {
     cinfo->src->next_input_byte += (size_t) num_bytes;
     cinfo->src->bytes_in_buffer -= (size_t) num_bytes;
-  } else if (num_bytes > 0) {
-    gint available;
-
-    num_bytes -= cinfo->src->bytes_in_buffer;
-    cinfo->src->next_input_byte += (size_t) cinfo->src->bytes_in_buffer;
-    cinfo->src->bytes_in_buffer = 0;
-
-    available = gst_adapter_available (dec->adapter);
-    if (available < num_bytes || available < dec->rem_img_len) {
-      GST_WARNING_OBJECT (dec, "Less bytes to skip than available in the "
-          "adapter or the remaining image length %ld < %d or %u",
-          num_bytes, available, dec->rem_img_len);
-    }
-    num_bytes = MIN (MIN (num_bytes, available), dec->rem_img_len);
-    gst_adapter_flush (dec->adapter, num_bytes);
-    dec->rem_img_len -= num_bytes;
   }
 }
 
@@ -398,30 +344,14 @@ METHODDEF (void)
 }
 
 static void
-gst_jpeg_dec_init (GstJpegDec * dec)
+gst_jpeg_dec_init (GstJpegDec * dec, GstJpegDecClass * class)
 {
   GST_DEBUG ("initializing");
 
-  /* create the sink and src pads */
-  dec->sinkpad =
-      gst_pad_new_from_static_template (&gst_jpeg_dec_sink_pad_template,
-      "sink");
-  gst_element_add_pad (GST_ELEMENT (dec), dec->sinkpad);
-  gst_pad_set_setcaps_function (dec->sinkpad,
-      GST_DEBUG_FUNCPTR (gst_jpeg_dec_setcaps));
-  gst_pad_set_getcaps_function (dec->sinkpad,
-      GST_DEBUG_FUNCPTR (gst_jpeg_dec_getcaps));
-  gst_pad_set_chain_function (dec->sinkpad,
-      GST_DEBUG_FUNCPTR (gst_jpeg_dec_chain));
-  gst_pad_set_event_function (dec->sinkpad,
-      GST_DEBUG_FUNCPTR (gst_jpeg_dec_sink_event));
-
-  dec->srcpad =
-      gst_pad_new_from_static_template (&gst_jpeg_dec_src_pad_template, "src");
-  gst_pad_set_event_function (dec->srcpad,
-      GST_DEBUG_FUNCPTR (gst_jpeg_dec_src_event));
-  gst_pad_use_fixed_caps (dec->srcpad);
-  gst_element_add_pad (GST_ELEMENT (dec), dec->srcpad);
+  /* By default, handle non-packetized input. If set_format gets called, we'll
+   * figure out a better way to handle this
+   */
+  gst_video_decoder_set_packetized (GST_VIDEO_DECODER (dec), FALSE);
 
   /* setup jpeglib */
   memset (&dec->cinfo, 0, sizeof (dec->cinfo));
@@ -444,35 +374,6 @@ gst_jpeg_dec_init (GstJpegDec * dec)
   /* init properties */
   dec->idct_method = JPEG_DEFAULT_IDCT_METHOD;
   dec->max_errors = JPEG_DEFAULT_MAX_ERRORS;
-
-  dec->adapter = gst_adapter_new ();
-}
-
-static gboolean
-gst_jpeg_dec_ensure_header (GstJpegDec * dec)
-{
-  gint av;
-  gint offset;
-
-  av = gst_adapter_available (dec->adapter);
-  /* we expect at least 4 bytes, first of which start marker */
-  offset = gst_adapter_masked_scan_uint32 (dec->adapter, 0xffffff00, 0xffd8ff00,
-      0, av);
-  if (G_UNLIKELY (offset < 0)) {
-    GST_DEBUG_OBJECT (dec, "No JPEG header in current buffer");
-    /* not found */
-    if (av > 4)
-      gst_adapter_flush (dec->adapter, av - 4);
-    return FALSE;
-  }
-
-  if (offset > 0) {
-    GST_LOG_OBJECT (dec, "Skipping %u bytes.", offset);
-    gst_adapter_flush (dec->adapter, offset);
-  }
-  GST_DEBUG_OBJECT (dec, "Found JPEG header");
-
-  return TRUE;
 }
 
 static inline gboolean
@@ -483,42 +384,62 @@ gst_jpeg_dec_parse_tag_has_entropy_segment (guint8 tag)
   return FALSE;
 }
 
-/* returns image length in bytes if parsed successfully,
- * otherwise 0 if more data needed,
- * if < 0 the absolute value needs to be flushed */
-static gint
-gst_jpeg_dec_parse_image_data (GstJpegDec * dec)
+static GstFlowReturn
+gst_jpeg_dec_parse (GstVideoDecoder * bdec, GstVideoCodecFrame * frame,
+    GstAdapter * adapter, gboolean at_eos)
 {
   guint size;
+  gint toadd = 0;
   gboolean resync;
-  GstAdapter *adapter = dec->adapter;
-  gint offset, noffset;
+  gint offset = 0, noffset;
+  GstJpegDec *dec = (GstJpegDec *) bdec;
+
+  /* FIXME : The overhead of using scan_uint32 is massive */
 
   size = gst_adapter_available (adapter);
+  GST_DEBUG ("Parsing jpeg image data (%u bytes)", size);
 
-  /* we expect at least 4 bytes, first of which start marker */
-  if (gst_adapter_masked_scan_uint32 (adapter, 0xffff0000, 0xffd80000, 0, 4))
-    return 0;
+  if (at_eos) {
+    GST_DEBUG ("Flushing all data out");
+    toadd = size;
 
-  GST_DEBUG ("Parsing jpeg image data (%u bytes)", size);
+    /* If we have leftover data, throw it away */
+    if (!dec->saw_header)
+      goto drop_frame;
+    goto have_full_frame;
+  }
 
-  GST_DEBUG ("Parse state: offset=%d, resync=%d, entropy len=%d",
-      dec->parse_offset, dec->parse_resync, dec->parse_entropy_len);
+  if (size < 8)
+    goto need_more_data;
 
-  /* offset is 2 less than actual offset;
-   * - adapter needs at least 4 bytes for scanning,
-   * - start and end marker ensure at least that much
-   */
-  /* resume from state offset */
-  offset = dec->parse_offset;
+  if (!dec->saw_header) {
+    gint ret;
+    /* we expect at least 4 bytes, first of which start marker */
+    ret =
+        gst_adapter_masked_scan_uint32 (adapter, 0xffff0000, 0xffd80000, 0,
+        size - 4);
+
+    GST_DEBUG ("ret:%d", ret);
+    if (ret < 0)
+      goto need_more_data;
+
+    if (ret) {
+      gst_adapter_flush (adapter, ret);
+      size -= ret;
+    }
+    dec->saw_header = TRUE;
+  }
 
   while (1) {
     guint frame_len;
     guint32 value;
 
+    GST_DEBUG ("offset:%d, size:%d", offset, size);
+
     noffset =
         gst_adapter_masked_scan_uint32_peek (adapter, 0x0000ff00, 0x0000ff00,
         offset, size - offset, &value);
+
     /* lost sync if 0xff marker not where expected */
     if ((resync = (noffset != offset))) {
       GST_DEBUG ("Lost sync at 0x%08x, resyncing", offset + 2);
@@ -544,15 +465,18 @@ gst_jpeg_dec_parse_image_data (GstJpegDec * dec)
     if (value == 0xd9) {
       GST_DEBUG ("0x%08x: EOI marker", offset + 2);
       /* clear parse state */
+      dec->saw_header = FALSE;
       dec->parse_resync = FALSE;
-      dec->parse_offset = 0;
-      return (offset + 4);
-    } else if (value == 0xd8) {
+      toadd = offset + 4;
+      goto have_full_frame;
+    }
+    if (value == 0xd8) {
       /* Skip this frame if we found another SOI marker */
       GST_DEBUG ("0x%08x: SOI marker before EOI, skipping", offset + 2);
       dec->parse_resync = FALSE;
-      dec->parse_offset = 0;
-      return -(offset + 2);
+      /* FIXME : Need to skip data */
+      toadd -= offset + 2;
+      goto have_full_frame;
     }
 
 
@@ -577,9 +501,14 @@ gst_jpeg_dec_parse_image_data (GstJpegDec * dec)
     if (gst_jpeg_dec_parse_tag_has_entropy_segment (value)) {
       guint eseglen = dec->parse_entropy_len;
 
-      GST_DEBUG ("0x%08x: finding entropy segment length", offset + 2);
+      GST_DEBUG ("0x%08x: finding entropy segment length (eseglen:%d)",
+          offset + 2, eseglen);
+      if (size < offset + 2 + frame_len + eseglen)
+        goto need_more_data;
       noffset = offset + 2 + frame_len + dec->parse_entropy_len;
       while (1) {
+        GST_DEBUG ("noffset:%d, size:%d, size - noffset:%d",
+            noffset, size, size - noffset);
         noffset = gst_adapter_masked_scan_uint32_peek (adapter, 0x0000ff00,
             0x0000ff00, noffset, size - noffset, &value);
         if (noffset < 0) {
@@ -613,18 +542,27 @@ gst_jpeg_dec_parse_image_data (GstJpegDec * dec)
       GST_DEBUG ("found sync at 0x%x", offset + 2);
     }
 
+    /* Add current data to output buffer */
+    toadd += frame_len + 2;
     offset += frame_len + 2;
   }
 
-  /* EXITS */
 need_more_data:
-  {
-    dec->parse_offset = offset;
-    dec->parse_resync = resync;
-    return 0;
-  }
+  if (toadd)
+    gst_video_decoder_add_to_frame (bdec, toadd);
+  return GST_VIDEO_DECODER_FLOW_NEED_DATA;
+
+have_full_frame:
+  if (toadd)
+    gst_video_decoder_add_to_frame (bdec, toadd);
+  return gst_video_decoder_have_frame (bdec);
+
+drop_frame:
+  gst_adapter_flush (adapter, size);
+  return GST_FLOW_OK;
 }
 
+
 /* shamelessly ripped from jpegutils.c in mjpegtools */
 static void
 add_huff_table (j_decompress_ptr dinfo,
@@ -748,75 +686,26 @@ guarantee_huff_tables (j_decompress_ptr dinfo)
 }
 
 static gboolean
-gst_jpeg_dec_setcaps (GstPad * pad, GstCaps * caps)
+gst_jpeg_dec_set_format (GstVideoDecoder * dec, GstVideoCodecState * state)
 {
-  GstStructure *s;
-  GstJpegDec *dec;
-  const GValue *framerate;
-
-  dec = GST_JPEG_DEC (GST_OBJECT_PARENT (pad));
-  s = gst_caps_get_structure (caps, 0);
-
-  if ((framerate = gst_structure_get_value (s, "framerate")) != NULL) {
-    dec->framerate_numerator = gst_value_get_fraction_numerator (framerate);
-    dec->framerate_denominator = gst_value_get_fraction_denominator (framerate);
-    dec->packetized = TRUE;
-    GST_DEBUG ("got framerate of %d/%d fps => packetized mode",
-        dec->framerate_numerator, dec->framerate_denominator);
-  }
-
-  /* do not extract width/height here. we do that in the chain
-   * function on a per-frame basis (including the line[] array
-   * setup) */
+  GstJpegDec *jpeg = GST_JPEG_DEC (dec);
+  GstVideoInfo *info = &state->info;
+
+  /* FIXME : previously jpegdec would handled input as packetized
+   * if the framerate was present. Here we consider it packetized if
+   * the fps is != 1/1 */
+  if (GST_VIDEO_INFO_FPS_N (info) != 1 && GST_VIDEO_INFO_FPS_D (info) != 1)
+    gst_video_decoder_set_packetized (dec, TRUE);
+  else
+    gst_video_decoder_set_packetized (dec, FALSE);
 
-  /* But we can take the framerate values and set them on the src pad */
+  if (jpeg->input_state)
+    gst_video_codec_state_unref (jpeg->input_state);
+  jpeg->input_state = gst_video_codec_state_ref (state);
 
   return TRUE;
 }
 
-static GstCaps *
-gst_jpeg_dec_getcaps (GstPad * pad)
-{
-  GstJpegDec *dec;
-  GstCaps *caps;
-  GstPad *peer;
-
-  dec = GST_JPEG_DEC (GST_OBJECT_PARENT (pad));
-
-  if (GST_PAD_CAPS (pad))
-    return gst_caps_ref (GST_PAD_CAPS (pad));
-
-  peer = gst_pad_get_peer (dec->srcpad);
-
-  if (peer) {
-    GstCaps *peer_caps;
-    const GstCaps *templ_caps;
-    GstStructure *s;
-    guint i, n;
-
-    peer_caps = gst_pad_get_caps (peer);
-
-    /* Translate peercaps to image/jpeg */
-    peer_caps = gst_caps_make_writable (peer_caps);
-    n = gst_caps_get_size (peer_caps);
-    for (i = 0; i < n; i++) {
-      s = gst_caps_get_structure (peer_caps, i);
-
-      gst_structure_set_name (s, "image/jpeg");
-    }
-
-    templ_caps = gst_pad_get_pad_template_caps (pad);
-    caps = gst_caps_intersect_full (peer_caps, templ_caps,
-        GST_CAPS_INTERSECT_FIRST);
-    gst_caps_unref (peer_caps);
-    gst_object_unref (peer);
-  } else {
-    caps = gst_caps_copy (gst_pad_get_pad_template_caps (pad));
-  }
-
-  return caps;
-}
-
 
 /* yuk */
 static void
@@ -1104,148 +993,45 @@ format_not_supported:
 }
 
 static void
-gst_jpeg_dec_update_qos (GstJpegDec * dec, gdouble proportion,
-    GstClockTimeDiff diff, GstClockTime ts)
-{
-  GST_OBJECT_LOCK (dec);
-  dec->proportion = proportion;
-  if (G_LIKELY (ts != GST_CLOCK_TIME_NONE)) {
-    if (G_UNLIKELY (diff > 0))
-      dec->earliest_time = ts + 2 * diff + dec->qos_duration;
-    else
-      dec->earliest_time = ts + diff;
-  } else {
-    dec->earliest_time = GST_CLOCK_TIME_NONE;
-  }
-  GST_OBJECT_UNLOCK (dec);
-}
-
-static void
-gst_jpeg_dec_reset_qos (GstJpegDec * dec)
-{
-  gst_jpeg_dec_update_qos (dec, 0.5, 0, GST_CLOCK_TIME_NONE);
-}
-
-static void
-gst_jpeg_dec_read_qos (GstJpegDec * dec, gdouble * proportion,
-    GstClockTime * time)
-{
-  GST_OBJECT_LOCK (dec);
-  *proportion = dec->proportion;
-  *time = dec->earliest_time;
-  GST_OBJECT_UNLOCK (dec);
-}
-
-/* Perform qos calculations before decoding the next frame. Returns TRUE if the
- * frame should be decoded, FALSE if the frame can be dropped entirely */
-static gboolean
-gst_jpeg_dec_do_qos (GstJpegDec * dec, GstClockTime timestamp)
+gst_jpeg_dec_negotiate (GstJpegDec * dec, gint width, gint height, gint clrspc)
 {
-  GstClockTime qostime, earliest_time;
-  gdouble proportion;
-
-  /* no timestamp, can't do QoS => decode frame */
-  if (G_UNLIKELY (!GST_CLOCK_TIME_IS_VALID (timestamp))) {
-    GST_LOG_OBJECT (dec, "invalid timestamp, can't do QoS, decode frame");
-    return TRUE;
-  }
-
-  /* get latest QoS observation values */
-  gst_jpeg_dec_read_qos (dec, &proportion, &earliest_time);
+  GstVideoCodecState *outstate;
+  GstVideoInfo *info;
+  GstVideoFormat format;
 
-  /* skip qos if we have no observation (yet) => decode frame */
-  if (G_UNLIKELY (!GST_CLOCK_TIME_IS_VALID (earliest_time))) {
-    GST_LOG_OBJECT (dec, "no observation yet, decode frame");
-    return TRUE;
+  switch (clrspc) {
+    case JCS_RGB:
+      format = GST_VIDEO_FORMAT_RGB;
+      break;
+    case JCS_GRAYSCALE:
+      format = GST_VIDEO_FORMAT_GRAY8;
+      break;
+    default:
+      format = GST_VIDEO_FORMAT_I420;
+      break;
   }
 
-  /* qos is done on running time */
-  qostime = gst_segment_to_running_time (&dec->segment, GST_FORMAT_TIME,
-      timestamp);
+  /* Compare to currently configured output state */
+  outstate = gst_video_decoder_get_output_state (GST_VIDEO_DECODER (dec));
+  if (outstate) {
+    info = &outstate->info;
 
-  /* see how our next timestamp relates to the latest qos timestamp */
-  GST_LOG_OBJECT (dec, "qostime %" GST_TIME_FORMAT ", earliest %"
-      GST_TIME_FORMAT, GST_TIME_ARGS (qostime), GST_TIME_ARGS (earliest_time));
-
-  if (qostime != GST_CLOCK_TIME_NONE && qostime <= earliest_time) {
-    GST_DEBUG_OBJECT (dec, "we are late, drop frame");
-    return FALSE;
+    if (width == GST_VIDEO_INFO_WIDTH (info) &&
+        height == GST_VIDEO_INFO_HEIGHT (info) &&
+        format == GST_VIDEO_INFO_FORMAT (info)) {
+      gst_video_codec_state_unref (outstate);
+      return;
+    }
+    gst_video_codec_state_unref (outstate);
   }
 
-  GST_LOG_OBJECT (dec, "decode frame");
-  return TRUE;
-}
-
-static void
-gst_jpeg_dec_negotiate (GstJpegDec * dec, gint width, gint height, gint clrspc)
-{
-  GstCaps *caps;
-  GstVideoFormat format;
-
-  if (G_UNLIKELY (width == dec->caps_width && height == dec->caps_height &&
-          dec->framerate_numerator == dec->caps_framerate_numerator &&
-          dec->framerate_denominator == dec->caps_framerate_denominator &&
-          clrspc == dec->clrspc))
-    return;
-
-  /* framerate == 0/1 is a still frame */
-  if (dec->framerate_denominator == 0) {
-    dec->framerate_numerator = 0;
-    dec->framerate_denominator = 1;
-  }
+  outstate =
+      gst_video_decoder_set_output_state (GST_VIDEO_DECODER (dec), format,
+      width, height, dec->input_state);
 
-  /* calculate or assume an average frame duration for QoS purposes */
-  GST_OBJECT_LOCK (dec);
-  if (dec->framerate_numerator != 0) {
-    dec->qos_duration = gst_util_uint64_scale (GST_SECOND,
-        dec->framerate_denominator, dec->framerate_numerator);
-  } else {
-    /* if not set just use 25fps */
-    dec->qos_duration = gst_util_uint64_scale (GST_SECOND, 1, 25);
-  }
-  GST_OBJECT_UNLOCK (dec);
+  gst_video_codec_state_unref (outstate);
 
   if (dec->cinfo.jpeg_color_space == JCS_RGB) {
-    gint i;
-    GstCaps *allowed_caps;
-
-    GST_DEBUG_OBJECT (dec, "selecting RGB format");
-    /* retrieve allowed caps, and find the first one that reasonably maps
-     * to the parameters of the colourspace */
-    caps = gst_pad_get_allowed_caps (dec->srcpad);
-    if (!caps) {
-      GST_DEBUG_OBJECT (dec, "... but no peer, using template caps");
-      /* need to copy because get_allowed_caps returns a ref,
-       * and get_pad_template_caps doesn't */
-      caps = gst_caps_copy (gst_pad_get_pad_template_caps (dec->srcpad));
-    }
-    /* avoid lists of fourcc, etc */
-    allowed_caps = gst_caps_normalize (caps);
-    gst_caps_unref (caps);
-    caps = NULL;
-    GST_LOG_OBJECT (dec, "allowed source caps %" GST_PTR_FORMAT, allowed_caps);
-
-    for (i = 0; i < gst_caps_get_size (allowed_caps); i++) {
-      if (caps)
-        gst_caps_unref (caps);
-      caps = gst_caps_copy_nth (allowed_caps, i);
-      /* sigh, ds and _parse_caps need fixed caps for parsing, fixate */
-      gst_pad_fixate_caps (dec->srcpad, caps);
-      GST_LOG_OBJECT (dec, "checking caps %" GST_PTR_FORMAT, caps);
-      if (!gst_video_format_parse_caps (caps, &format, NULL, NULL))
-        continue;
-      /* we'll settle for the first (preferred) downstream rgb format */
-      if (gst_video_format_is_rgb (format))
-        break;
-      /* default fall-back */
-      format = GST_VIDEO_FORMAT_RGB;
-    }
-    if (caps)
-      gst_caps_unref (caps);
-    gst_caps_unref (allowed_caps);
-    caps = gst_video_format_new_caps (format, width, height,
-        dec->framerate_numerator, dec->framerate_denominator, 1, 1);
-    dec->outsize = gst_video_format_get_size (format, width, height);
     /* some format info */
     dec->offset[0] =
         gst_video_format_get_component_offset (format, 0, width, height);
@@ -1258,125 +1044,28 @@ gst_jpeg_dec_negotiate (GstJpegDec * dec, gint width, gint height, gint clrspc)
     dec->inc = gst_video_format_get_pixel_stride (format, 0);
   } else if (dec->cinfo.jpeg_color_space == JCS_GRAYSCALE) {
     /* TODO is anything else then 8bit supported in jpeg? */
-    format = GST_VIDEO_FORMAT_GRAY8;
-    caps = gst_video_format_new_caps (format, width, height,
-        dec->framerate_numerator, dec->framerate_denominator, 1, 1);
-    dec->outsize = gst_video_format_get_size (format, width, height);
     dec->offset[0] =
         gst_video_format_get_component_offset (format, 0, width, height);
     dec->stride = gst_video_format_get_row_stride (format, 0, width);
     dec->inc = gst_video_format_get_pixel_stride (format, 0);
-  } else {
-    /* go for plain and simple I420 */
-    /* TODO other YUV cases ? */
-    caps = gst_caps_new_simple ("video/x-raw-yuv",
-        "format", GST_TYPE_FOURCC, GST_MAKE_FOURCC ('I', '4', '2', '0'),
-        "width", G_TYPE_INT, width, "height", G_TYPE_INT, height,
-        "framerate", GST_TYPE_FRACTION, dec->framerate_numerator,
-        dec->framerate_denominator, NULL);
-    dec->outsize = I420_SIZE (width, height);
   }
 
-  GST_DEBUG_OBJECT (dec, "setting caps %" GST_PTR_FORMAT, caps);
   GST_DEBUG_OBJECT (dec, "max_v_samp_factor=%d", dec->cinfo.max_v_samp_factor);
   GST_DEBUG_OBJECT (dec, "max_h_samp_factor=%d", dec->cinfo.max_h_samp_factor);
-
-  gst_pad_set_caps (dec->srcpad, caps);
-  gst_caps_unref (caps);
-
-  dec->caps_width = width;
-  dec->caps_height = height;
-  dec->caps_framerate_numerator = dec->framerate_numerator;
-  dec->caps_framerate_denominator = dec->framerate_denominator;
 }
 
 static GstFlowReturn
-gst_jpeg_dec_chain (GstPad * pad, GstBuffer * buf)
+gst_jpeg_dec_handle_frame (GstVideoDecoder * bdec, GstVideoCodecFrame * frame)
 {
   GstFlowReturn ret = GST_FLOW_OK;
-  GstJpegDec *dec;
-  GstBuffer *outbuf = NULL;
-#ifndef GST_DISABLE_GST_DEBUG
-  guchar *data;
-#endif
+  GstJpegDec *dec = (GstJpegDec *) bdec;
   guchar *outdata;
   guchar *base[3], *last[3];
-  gint img_len;
-  guint outsize;
   gint width, height;
   gint r_h, r_v;
   guint code, hdr_ok;
-  GstClockTime timestamp, duration;
-
-  dec = GST_JPEG_DEC (GST_PAD_PARENT (pad));
-
-  timestamp = GST_BUFFER_TIMESTAMP (buf);
-  duration = GST_BUFFER_DURATION (buf);
-
-  if (GST_CLOCK_TIME_IS_VALID (timestamp))
-    dec->next_ts = timestamp;
-
-  if (GST_BUFFER_IS_DISCONT (buf)) {
-    GST_DEBUG_OBJECT (dec, "buffer has DISCONT flag set");
-    dec->discont = TRUE;
-    if (!dec->packetized && gst_adapter_available (dec->adapter)) {
-      GST_WARNING_OBJECT (dec, "DISCONT buffer in non-packetized mode, bad");
-      gst_adapter_clear (dec->adapter);
-    }
-  }
-
-  gst_adapter_push (dec->adapter, buf);
-  buf = NULL;
-
-  /* If we are non-packetized and know the total incoming size in bytes,
-   * just wait until we have enough before doing any processing. */
-
-  if (!dec->packetized && (dec->segment.format == GST_FORMAT_BYTES) &&
-      (dec->segment.stop != -1) &&
-      (gst_adapter_available (dec->adapter) < dec->segment.stop)) {
-    /* We assume that non-packetized input in bytes is *one* single jpeg image */
-    GST_DEBUG ("Non-packetized mode. Got %d bytes, need %" G_GINT64_FORMAT,
-        gst_adapter_available (dec->adapter), dec->segment.stop);
-    goto need_more_data;
-  }
-
-again:
-  if (!gst_jpeg_dec_ensure_header (dec))
-    goto need_more_data;
-
-  /* If we know that each input buffer contains data
-   * for a whole jpeg image (e.g. MJPEG streams), just 
-   * do some sanity checking instead of parsing all of 
-   * the jpeg data */
-  if (dec->packetized) {
-    img_len = gst_adapter_available (dec->adapter);
-  } else {
-    /* Parse jpeg image to handle jpeg input that
-     * is not aligned to buffer boundaries */
-    img_len = gst_jpeg_dec_parse_image_data (dec);
-
-    if (img_len == 0) {
-      goto need_more_data;
-    } else if (img_len < 0) {
-      gst_adapter_flush (dec->adapter, -img_len);
-      goto again;
-    }
-  }
-
-  dec->rem_img_len = img_len;
-
-  GST_LOG_OBJECT (dec, "image size = %u", img_len);
-
-  /* QoS: if we're too late anyway, skip decoding */
-  if (dec->packetized && !gst_jpeg_dec_do_qos (dec, timestamp))
-    goto skip_decoding;
-
-#ifndef GST_DISABLE_GST_DEBUG
-  data = (guint8 *) gst_adapter_peek (dec->adapter, 4);
-  GST_LOG_OBJECT (dec, "reading header %02x %02x %02x %02x", data[0], data[1],
-      data[2], data[3]);
-#endif
 
+  dec->current_frame = frame;
   gst_jpeg_dec_fill_input_buffer (&dec->cinfo);
 
   if (setjmp (dec->jerr.setjmp_buffer)) {
@@ -1474,36 +1163,14 @@ again:
 
   gst_jpeg_dec_negotiate (dec, width, height, dec->cinfo.jpeg_color_space);
 
-  ret = gst_pad_alloc_buffer_and_set_caps (dec->srcpad, GST_BUFFER_OFFSET_NONE,
-      dec->outsize, GST_PAD_CAPS (dec->srcpad), &outbuf);
+  ret = gst_video_decoder_alloc_output_frame (bdec, frame);
   if (G_UNLIKELY (ret != GST_FLOW_OK))
     goto alloc_failed;
 
-  outdata = GST_BUFFER_DATA (outbuf);
-  outsize = GST_BUFFER_SIZE (outbuf);
+  outdata = GST_BUFFER_DATA (frame->output_buffer);
 
-  GST_LOG_OBJECT (dec, "width %d, height %d, buffer size %d, required size %d",
-      width, height, outsize, dec->outsize);
+  GST_LOG_OBJECT (dec, "width %d, height %d", width, height);
 
-  GST_BUFFER_TIMESTAMP (outbuf) = dec->next_ts;
-
-  if (dec->packetized && GST_CLOCK_TIME_IS_VALID (dec->next_ts)) {
-    if (GST_CLOCK_TIME_IS_VALID (duration)) {
-      /* use duration from incoming buffer for outgoing buffer */
-      dec->next_ts += duration;
-    } else if (dec->framerate_numerator != 0) {
-      duration = gst_util_uint64_scale (GST_SECOND,
-          dec->framerate_denominator, dec->framerate_numerator);
-      dec->next_ts += duration;
-    } else {
-      duration = GST_CLOCK_TIME_NONE;
-      dec->next_ts = GST_CLOCK_TIME_NONE;
-    }
-  } else {
-    duration = GST_CLOCK_TIME_NONE;
-    dec->next_ts = GST_CLOCK_TIME_NONE;
-  }
-  GST_BUFFER_DURATION (outbuf) = duration;
 
   if (dec->cinfo.jpeg_color_space == JCS_RGB) {
     base[0] = outdata + dec->offset[0];
@@ -1559,46 +1226,12 @@ again:
   GST_LOG_OBJECT (dec, "decompressing finished");
   jpeg_finish_decompress (&dec->cinfo);
 
-  /* Clipping */
-  if (dec->segment.format == GST_FORMAT_TIME) {
-    gint64 start, stop, clip_start, clip_stop;
-
-    GST_LOG_OBJECT (dec, "Attempting clipping");
-
-    start = GST_BUFFER_TIMESTAMP (outbuf);
-    if (GST_BUFFER_DURATION (outbuf) == GST_CLOCK_TIME_NONE)
-      stop = start;
-    else
-      stop = start + GST_BUFFER_DURATION (outbuf);
-
-    if (gst_segment_clip (&dec->segment, GST_FORMAT_TIME,
-            start, stop, &clip_start, &clip_stop)) {
-      GST_LOG_OBJECT (dec, "Clipping start to %" GST_TIME_FORMAT,
-          GST_TIME_ARGS (clip_start));
-      GST_BUFFER_TIMESTAMP (outbuf) = clip_start;
-      if (GST_BUFFER_DURATION (outbuf) != GST_CLOCK_TIME_NONE) {
-        GST_LOG_OBJECT (dec, "Clipping duration to %" GST_TIME_FORMAT,
-            GST_TIME_ARGS (clip_stop - clip_start));
-        GST_BUFFER_DURATION (outbuf) = clip_stop - clip_start;
-      }
-    } else
-      goto drop_buffer;
-  }
-
   /* reset error count on successful decode */
   dec->error_count = 0;
 
-  ++dec->good_count;
+  ret = gst_video_decoder_finish_frame (bdec, frame);
 
-  GST_LOG_OBJECT (dec, "pushing buffer (ts=%" GST_TIME_FORMAT ", dur=%"
-      GST_TIME_FORMAT, GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (outbuf)),
-      GST_TIME_ARGS (GST_BUFFER_DURATION (outbuf)));
-
-  ret = gst_pad_push (dec->srcpad, outbuf);
-
-skip_decoding:
 done:
-  gst_adapter_flush (dec->adapter, dec->rem_img_len);
 
 exit:
 
@@ -1613,10 +1246,6 @@ exit:
 need_more_data:
   {
     GST_LOG_OBJECT (dec, "we need more data");
-    if (outbuf) {
-      gst_buffer_unref (outbuf);
-      outbuf = NULL;
-    }
     ret = GST_FLOW_OK;
     goto exit;
   }
@@ -1637,10 +1266,8 @@ decode_error:
     gst_jpeg_dec_set_error (dec, GST_FUNCTION, __LINE__,
         "Decode error #%u: %s", code, err_msg);
 
-    if (outbuf) {
-      gst_buffer_unref (outbuf);
-      outbuf = NULL;
-    }
+    gst_video_decoder_drop_frame (bdec, frame);
+
     ret = GST_FLOW_ERROR;
     goto done;
   }
@@ -1648,7 +1275,6 @@ decode_direct_failed:
   {
     /* already posted an error message */
     jpeg_abort_decompress (&dec->cinfo);
-    gst_buffer_replace (&outbuf, NULL);
     goto done;
   }
 alloc_failed:
@@ -1667,13 +1293,6 @@ alloc_failed:
     }
     goto exit;
   }
-drop_buffer:
-  {
-    GST_WARNING_OBJECT (dec, "Outgoing buffer is outside configured segment");
-    gst_buffer_unref (outbuf);
-    ret = GST_FLOW_OK;
-    goto exit;
-  }
 components_not_supported:
   {
     gst_jpeg_dec_set_error (dec, GST_FUNCTION, __LINE__,
@@ -1699,84 +1318,18 @@ invalid_yuvrgbgrayscale:
 }
 
 static gboolean
-gst_jpeg_dec_src_event (GstPad * pad, GstEvent * event)
+gst_jpeg_dec_reset (GstVideoDecoder * bdec, gboolean hard)
 {
-  GstJpegDec *dec;
-  gboolean res;
-
-  dec = GST_JPEG_DEC (gst_pad_get_parent (pad));
-  if (G_UNLIKELY (dec == NULL)) {
-    gst_event_unref (event);
-    return FALSE;
-  }
-
-  switch (GST_EVENT_TYPE (event)) {
-    case GST_EVENT_QOS:{
-      GstClockTimeDiff diff;
-      GstClockTime timestamp;
-      gdouble proportion;
-
-      gst_event_parse_qos (event, &proportion, &diff, &timestamp);
-      gst_jpeg_dec_update_qos (dec, proportion, diff, timestamp);
-      break;
-    }
-    default:
-      break;
-  }
-
-  res = gst_pad_push_event (dec->sinkpad, event);
-
-  gst_object_unref (dec);
-  return res;
-}
-
-static gboolean
-gst_jpeg_dec_sink_event (GstPad * pad, GstEvent * event)
-{
-  gboolean ret = TRUE;
-  GstJpegDec *dec = GST_JPEG_DEC (GST_OBJECT_PARENT (pad));
-
-  GST_DEBUG_OBJECT (dec, "event : %s", GST_EVENT_TYPE_NAME (event));
-
-  switch (GST_EVENT_TYPE (event)) {
-    case GST_EVENT_FLUSH_STOP:
-      GST_DEBUG_OBJECT (dec, "Aborting decompress");
-      jpeg_abort_decompress (&dec->cinfo);
-      gst_segment_init (&dec->segment, GST_FORMAT_UNDEFINED);
-      gst_adapter_clear (dec->adapter);
-      g_free (dec->cur_buf);
-      dec->cur_buf = NULL;
-      dec->parse_offset = 0;
-      dec->parse_entropy_len = 0;
-      dec->parse_resync = FALSE;
-      gst_jpeg_dec_reset_qos (dec);
-      break;
-    case GST_EVENT_NEWSEGMENT:{
-      gboolean update;
-      gdouble rate, applied_rate;
-      GstFormat format;
-      gint64 start, stop, position;
-
-      gst_event_parse_new_segment_full (event, &update, &rate, &applied_rate,
-          &format, &start, &stop, &position);
-
-      GST_DEBUG_OBJECT (dec, "Got NEWSEGMENT [%" GST_TIME_FORMAT
-          " - %" GST_TIME_FORMAT " / %" GST_TIME_FORMAT "]",
-          GST_TIME_ARGS (start), GST_TIME_ARGS (stop),
-          GST_TIME_ARGS (position));
-
-      gst_segment_set_newsegment_full (&dec->segment, update, rate,
-          applied_rate, format, start, stop, position);
-
-      break;
-    }
-    default:
-      break;
-  }
+  GstJpegDec *dec = (GstJpegDec *) bdec;
 
-  ret = gst_pad_push_event (dec->srcpad, event);
+  jpeg_abort_decompress (&dec->cinfo);
+  g_free (dec->cur_buf);
+  dec->cur_buf = NULL;
+  dec->parse_entropy_len = 0;
+  dec->parse_resync = FALSE;
+  dec->saw_header = FALSE;
 
-  return ret;
+  return TRUE;
 }
 
 static void
@@ -1823,51 +1376,27 @@ gst_jpeg_dec_get_property (GObject * object, guint prop_id, GValue * value,
   }
 }
 
-static GstStateChangeReturn
-gst_jpeg_dec_change_state (GstElement * element, GstStateChange transition)
+static gboolean
+gst_jpeg_dec_start (GstVideoDecoder * bdec)
 {
-  GstStateChangeReturn ret;
-  GstJpegDec *dec;
+  GstJpegDec *dec = (GstJpegDec *) bdec;
 
-  dec = GST_JPEG_DEC (element);
-
-  switch (transition) {
-    case GST_STATE_CHANGE_READY_TO_PAUSED:
-      dec->error_count = 0;
-      dec->good_count = 0;
-      dec->framerate_numerator = 0;
-      dec->framerate_denominator = 1;
-      dec->caps_framerate_numerator = dec->caps_framerate_denominator = 0;
-      dec->caps_width = -1;
-      dec->caps_height = -1;
-      dec->clrspc = -1;
-      dec->packetized = FALSE;
-      dec->next_ts = 0;
-      dec->discont = TRUE;
-      dec->parse_offset = 0;
-      dec->parse_entropy_len = 0;
-      dec->parse_resync = FALSE;
-      dec->cur_buf = NULL;
-      gst_segment_init (&dec->segment, GST_FORMAT_UNDEFINED);
-      gst_jpeg_dec_reset_qos (dec);
-    default:
-      break;
-  }
+  dec->error_count = 0;
+  dec->parse_entropy_len = 0;
+  dec->parse_resync = FALSE;
+  dec->cur_buf = NULL;
 
-  ret = GST_ELEMENT_CLASS (parent_class)->change_state (element, transition);
-  if (ret != GST_STATE_CHANGE_SUCCESS)
-    return ret;
+  return TRUE;
+}
 
-  switch (transition) {
-    case GST_STATE_CHANGE_PAUSED_TO_READY:
-      gst_adapter_clear (dec->adapter);
-      g_free (dec->cur_buf);
-      dec->cur_buf = NULL;
-      gst_jpeg_dec_free_buffers (dec);
-      break;
-    default:
-      break;
-  }
+static gboolean
+gst_jpeg_dec_stop (GstVideoDecoder * bdec)
+{
+  GstJpegDec *dec = (GstJpegDec *) bdec;
 
-  return ret;
+  g_free (dec->cur_buf);
+  dec->cur_buf = NULL;
+  gst_jpeg_dec_free_buffers (dec);
+
+  return TRUE;
 }
diff --git a/ext/jpeg/gstjpegdec.h b/ext/jpeg/gstjpegdec.h
index 7daf7b6..9368627 100644
--- a/ext/jpeg/gstjpegdec.h
+++ b/ext/jpeg/gstjpegdec.h
@@ -1,5 +1,7 @@
 /* GStreamer
  * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
+ * Copyright (C) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
  *
  * This library is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Library General Public
@@ -25,6 +27,7 @@
 #include <setjmp.h>
 #include <gst/gst.h>
 #include <gst/video/video.h>
+#include <gst/video/gstvideodecoder.h>
 #include <gst/base/gstadapter.h>
 
 /* this is a hack hack hack to get around jpeglib header bugs... */
@@ -64,50 +67,20 @@ struct GstJpegDecSourceMgr {
  * doesn't handle the N buffers in, 1 buffer out case,
  * but only the 1-in 1-out case */
 struct _GstJpegDec {
-  GstElement element;
-
-  /* pads */
-  GstPad  *sinkpad;
-  GstPad  *srcpad;
-
-  GstAdapter *adapter;
+  GstVideoDecoder decoder;
 
   guint8     *cur_buf;
 
-  /* TRUE if each input buffer contains a whole jpeg image */
-  gboolean packetized;
-
-  /* the (expected) timestamp of the next frame */
-  guint64  next_ts;
-
-  GstSegment segment;
-
-  /* TRUE if the next output buffer should have the DISCONT flag set */
-  gboolean discont;
-
-  /* QoS stuff *//* with LOCK */
-  gdouble proportion;
-  GstClockTime earliest_time;
-  GstClockTime qos_duration;
-
-  /* video state */
-  gint framerate_numerator;
-  gint framerate_denominator;
-
   /* negotiated state */
-  gint     caps_framerate_numerator;
-  gint     caps_framerate_denominator;
-  gint     caps_width;
-  gint     caps_height;
-  gint     outsize;
-  gint     clrspc;
+  GstVideoCodecState *input_state;
+  GstVideoCodecFrame *current_frame;
 
   gint     offset[3];
   gint     stride;
   gint     inc;
 
   /* parse state */
-  gint     parse_offset;
+  gboolean saw_header;
   gint     parse_entropy_len;
   gint     parse_resync;
 
@@ -123,9 +96,6 @@ struct _GstJpegDec {
   /* number of errors since start or last successfully decoded image */
   guint     error_count;
 
-  /* number of successfully decoded images since start */
-  guint     good_count;
-
   struct jpeg_decompress_struct cinfo;
   struct GstJpegDecErrorMgr     jerr;
   struct GstJpegDecSourceMgr    jsrc;
@@ -138,7 +108,7 @@ struct _GstJpegDec {
 };
 
 struct _GstJpegDecClass {
-  GstElementClass  parent_class;
+  GstVideoDecoderClass decoder_class;
 };
 
 GType gst_jpeg_dec_get_type(void);
diff --git a/ext/jpeg/gstjpegenc.c b/ext/jpeg/gstjpegenc.c
index c44cb2e..627d777 100644
--- a/ext/jpeg/gstjpegenc.c
+++ b/ext/jpeg/gstjpegenc.c
@@ -1,5 +1,7 @@
 /* GStreamer
  * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
+ * Copyright (C) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
  *
  * This library is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Library General Public
@@ -68,51 +70,25 @@ enum
 };
 
 static void gst_jpegenc_reset (GstJpegEnc * enc);
-static void gst_jpegenc_base_init (gpointer g_class);
-static void gst_jpegenc_class_init (GstJpegEnc * klass);
-static void gst_jpegenc_init (GstJpegEnc * jpegenc);
 static void gst_jpegenc_finalize (GObject * object);
 
-static GstFlowReturn gst_jpegenc_chain (GstPad * pad, GstBuffer * buf);
-static gboolean gst_jpegenc_setcaps (GstPad * pad, GstCaps * caps);
-static GstCaps *gst_jpegenc_getcaps (GstPad * pad);
-
 static void gst_jpegenc_resync (GstJpegEnc * jpegenc);
 static void gst_jpegenc_set_property (GObject * object, guint prop_id,
     const GValue * value, GParamSpec * pspec);
 static void gst_jpegenc_get_property (GObject * object, guint prop_id,
     GValue * value, GParamSpec * pspec);
-static GstStateChangeReturn gst_jpegenc_change_state (GstElement * element,
-    GstStateChange transition);
 
+static gboolean gst_jpegenc_start (GstVideoEncoder * benc);
+static gboolean gst_jpegenc_stop (GstVideoEncoder * benc);
+static gboolean gst_jpegenc_set_format (GstVideoEncoder * encoder,
+    GstVideoCodecState * state);
+static GstFlowReturn gst_jpegenc_handle_frame (GstVideoEncoder * encoder,
+    GstVideoCodecFrame * frame);
 
-static GstElementClass *parent_class = NULL;
 static guint gst_jpegenc_signals[LAST_SIGNAL] = { 0 };
 
-GType
-gst_jpegenc_get_type (void)
-{
-  static GType jpegenc_type = 0;
-
-  if (!jpegenc_type) {
-    static const GTypeInfo jpegenc_info = {
-      sizeof (GstJpegEnc),
-      (GBaseInitFunc) gst_jpegenc_base_init,
-      NULL,
-      (GClassInitFunc) gst_jpegenc_class_init,
-      NULL,
-      NULL,
-      sizeof (GstJpegEnc),
-      0,
-      (GInstanceInitFunc) gst_jpegenc_init,
-    };
-
-    jpegenc_type =
-        g_type_register_static (GST_TYPE_ELEMENT, "GstJpegEnc", &jpegenc_info,
-        0);
-  }
-  return jpegenc_type;
-}
+GST_BOILERPLATE (GstJpegEnc, gst_jpegenc, GstVideoEncoder,
+    GST_TYPE_VIDEO_ENCODER);
 
 /* *INDENT-OFF* */
 static GstStaticPadTemplate gst_jpegenc_sink_pad_template =
@@ -152,13 +128,13 @@ gst_jpegenc_base_init (gpointer g_class)
 }
 
 static void
-gst_jpegenc_class_init (GstJpegEnc * klass)
+gst_jpegenc_class_init (GstJpegEncClass * klass)
 {
   GObjectClass *gobject_class;
-  GstElementClass *gstelement_class;
+  GstVideoEncoderClass *venc_class;
 
   gobject_class = (GObjectClass *) klass;
-  gstelement_class = (GstElementClass *) klass;
+  venc_class = (GstVideoEncoderClass *) klass;
 
   parent_class = g_type_class_peek_parent (klass);
 
@@ -190,7 +166,10 @@ gst_jpegenc_class_init (GstJpegEnc * klass)
           JPEG_DEFAULT_IDCT_METHOD,
           G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
-  gstelement_class->change_state = gst_jpegenc_change_state;
+  venc_class->start = gst_jpegenc_start;
+  venc_class->stop = gst_jpegenc_stop;
+  venc_class->set_format = gst_jpegenc_set_format;
+  venc_class->handle_frame = gst_jpegenc_handle_frame;
 
   gobject_class->finalize = gst_jpegenc_finalize;
 
@@ -210,7 +189,6 @@ gst_jpegenc_flush_destination (j_compress_ptr cinfo)
   GstBuffer *overflow_buffer;
   guint32 old_buffer_size;
   GstJpegEnc *jpegenc = (GstJpegEnc *) (cinfo->client_data);
-  GstFlowReturn ret;
 
   GST_DEBUG_OBJECT (jpegenc,
       "gst_jpegenc_chain: flush_destination: buffer too small");
@@ -218,24 +196,15 @@ gst_jpegenc_flush_destination (j_compress_ptr cinfo)
   /* Our output buffer wasn't big enough.
    * Make a new buffer that's twice the size, */
   old_buffer_size = GST_BUFFER_SIZE (jpegenc->output_buffer);
-  ret = gst_pad_alloc_buffer_and_set_caps (jpegenc->srcpad,
-      GST_BUFFER_OFFSET_NONE, old_buffer_size * 2,
-      GST_PAD_CAPS (jpegenc->srcpad), &overflow_buffer);
-  /* handle here if needed */
-  if (ret != GST_FLOW_OK) {
-    overflow_buffer = gst_buffer_new_and_alloc (old_buffer_size * 2);
-    gst_buffer_set_caps (overflow_buffer, GST_PAD_CAPS (jpegenc->srcpad));
-  }
+  overflow_buffer = gst_buffer_new_and_alloc (old_buffer_size * 2);
 
   memcpy (GST_BUFFER_DATA (overflow_buffer),
       GST_BUFFER_DATA (jpegenc->output_buffer), old_buffer_size);
 
-  gst_buffer_copy_metadata (overflow_buffer, jpegenc->output_buffer,
-      GST_BUFFER_COPY_TIMESTAMPS);
-
   /* drop it into place, */
   gst_buffer_unref (jpegenc->output_buffer);
-  jpegenc->output_buffer = overflow_buffer;
+  jpegenc->current_frame->output_buffer = jpegenc->output_buffer =
+      overflow_buffer;
 
   /* and last, update libjpeg on where to work. */
   jpegenc->jdest.next_output_byte =
@@ -258,33 +227,17 @@ gst_jpegenc_term_destination (j_compress_ptr cinfo)
 
   g_signal_emit (G_OBJECT (jpegenc), gst_jpegenc_signals[FRAME_ENCODED], 0);
 
-  jpegenc->last_ret = gst_pad_push (jpegenc->srcpad, jpegenc->output_buffer);
+  jpegenc->current_frame->output_buffer = jpegenc->output_buffer;
   jpegenc->output_buffer = NULL;
+
+  gst_video_encoder_finish_frame (GST_VIDEO_ENCODER (jpegenc),
+      jpegenc->current_frame);
+  jpegenc->current_frame = NULL;
 }
 
 static void
-gst_jpegenc_init (GstJpegEnc * jpegenc)
+gst_jpegenc_init (GstJpegEnc * jpegenc, GstJpegEncClass * class)
 {
-  /* create the sink and src pads */
-  jpegenc->sinkpad =
-      gst_pad_new_from_static_template (&gst_jpegenc_sink_pad_template, "sink");
-  gst_pad_set_chain_function (jpegenc->sinkpad,
-      GST_DEBUG_FUNCPTR (gst_jpegenc_chain));
-  gst_pad_set_getcaps_function (jpegenc->sinkpad,
-      GST_DEBUG_FUNCPTR (gst_jpegenc_getcaps));
-  gst_pad_set_setcaps_function (jpegenc->sinkpad,
-      GST_DEBUG_FUNCPTR (gst_jpegenc_setcaps));
-  gst_element_add_pad (GST_ELEMENT (jpegenc), jpegenc->sinkpad);
-
-  jpegenc->srcpad =
-      gst_pad_new_from_static_template (&gst_jpegenc_src_pad_template, "src");
-  gst_pad_use_fixed_caps (jpegenc->srcpad);
-  gst_element_add_pad (GST_ELEMENT (jpegenc), jpegenc->srcpad);
-
-  /* reset the initial video state */
-  jpegenc->width = -1;
-  jpegenc->height = -1;
-
   /* setup jpeglib */
   memset (&jpegenc->cinfo, 0, sizeof (jpegenc->cinfo));
   memset (&jpegenc->jerr, 0, sizeof (jpegenc->jerr));
@@ -322,12 +275,6 @@ gst_jpegenc_reset (GstJpegEnc * enc)
       enc->row[i][j] = NULL;
     }
   }
-
-  enc->width = -1;
-  enc->height = -1;
-  enc->format = GST_VIDEO_FORMAT_UNKNOWN;
-  enc->fps_den = enc->par_den = 0;
-  enc->height = enc->width = 0;
 }
 
 static void
@@ -337,173 +284,94 @@ gst_jpegenc_finalize (GObject * object)
 
   jpeg_destroy_compress (&filter->cinfo);
 
-  G_OBJECT_CLASS (parent_class)->finalize (object);
-}
-
-static GstCaps *
-gst_jpegenc_getcaps (GstPad * pad)
-{
-  GstJpegEnc *jpegenc = GST_JPEGENC (gst_pad_get_parent (pad));
-  GstCaps *caps, *othercaps;
-  const GstCaps *templ;
-  gint i, j;
-  GstStructure *structure = NULL;
+  if (filter->input_state)
+    gst_video_codec_state_unref (filter->input_state);
 
-  /* we want to proxy properties like width, height and framerate from the
-     other end of the element */
-
-  othercaps = gst_pad_peer_get_caps_reffed (jpegenc->srcpad);
-  if (othercaps == NULL ||
-      gst_caps_is_empty (othercaps) || gst_caps_is_any (othercaps)) {
-    caps = gst_caps_copy (gst_pad_get_pad_template_caps (pad));
-    goto done;
-  }
-
-  caps = gst_caps_new_empty ();
-  templ = gst_pad_get_pad_template_caps (pad);
-
-  for (i = 0; i < gst_caps_get_size (templ); i++) {
-    /* pick fields from peer caps */
-    for (j = 0; j < gst_caps_get_size (othercaps); j++) {
-      GstStructure *s = gst_caps_get_structure (othercaps, j);
-      const GValue *val;
-
-      structure = gst_structure_copy (gst_caps_get_structure (templ, i));
-      if ((val = gst_structure_get_value (s, "width")))
-        gst_structure_set_value (structure, "width", val);
-      if ((val = gst_structure_get_value (s, "height")))
-        gst_structure_set_value (structure, "height", val);
-      if ((val = gst_structure_get_value (s, "framerate")))
-        gst_structure_set_value (structure, "framerate", val);
-
-      gst_caps_merge_structure (caps, structure);
-    }
-  }
-
-done:
-
-  gst_caps_replace (&othercaps, NULL);
-  gst_object_unref (jpegenc);
-
-  return caps;
+  G_OBJECT_CLASS (parent_class)->finalize (object);
 }
 
 static gboolean
-gst_jpegenc_setcaps (GstPad * pad, GstCaps * caps)
+gst_jpegenc_set_format (GstVideoEncoder * encoder, GstVideoCodecState * state)
 {
-  GstJpegEnc *enc = GST_JPEGENC (gst_pad_get_parent (pad));
-  GstVideoFormat format;
-  gint width, height;
-  gint fps_num, fps_den;
-  gint par_num, par_den;
+  GstJpegEnc *enc = GST_JPEGENC (encoder);
   gint i;
-  GstCaps *othercaps;
-  gboolean ret;
-
-  /* get info from caps */
-  if (!gst_video_format_parse_caps (caps, &format, &width, &height))
-    goto refuse_caps;
-  /* optional; pass along if present */
-  fps_num = fps_den = -1;
-  par_num = par_den = -1;
-  gst_video_parse_caps_framerate (caps, &fps_num, &fps_den);
-  gst_video_parse_caps_pixel_aspect_ratio (caps, &par_num, &par_den);
-
-  if (width == enc->width && height == enc->height && enc->format == format
-      && fps_num == enc->fps_num && fps_den == enc->fps_den
-      && par_num == enc->par_num && par_den == enc->par_den)
-    return TRUE;
-
-  /* store input description */
-  enc->format = format;
-  enc->width = width;
-  enc->height = height;
-  enc->fps_num = fps_num;
-  enc->fps_den = fps_den;
-  enc->par_num = par_num;
-  enc->par_den = par_den;
+  GstVideoInfo *info = &state->info;
+  GstVideoCodecState *output;
+
+  if (enc->input_state)
+    gst_video_codec_state_unref (enc->input_state);
+  enc->input_state = gst_video_codec_state_ref (state);
 
   /* prepare a cached image description  */
-  enc->channels = 3 + (gst_video_format_has_alpha (format) ? 1 : 0);
+  enc->channels = GST_VIDEO_INFO_N_COMPONENTS (info);
+
   /* ... but any alpha is disregarded in encoding */
-  if (gst_video_format_is_gray (format))
+  if (GST_VIDEO_INFO_IS_GRAY (info))
     enc->channels = 1;
-  else
-    enc->channels = 3;
+
   enc->h_max_samp = 0;
   enc->v_max_samp = 0;
   for (i = 0; i < enc->channels; ++i) {
-    enc->cwidth[i] = gst_video_format_get_component_width (format, i, width);
-    enc->cheight[i] = gst_video_format_get_component_height (format, i, height);
-    enc->offset[i] = gst_video_format_get_component_offset (format, i, width,
-        height);
-    enc->stride[i] = gst_video_format_get_row_stride (format, i, width);
-    enc->inc[i] = gst_video_format_get_pixel_stride (format, i);
-    enc->h_samp[i] = GST_ROUND_UP_4 (width) / enc->cwidth[i];
+    enc->cwidth[i] = GST_VIDEO_INFO_COMP_WIDTH (info, i);
+    enc->cheight[i] = GST_VIDEO_INFO_COMP_HEIGHT (info, i);
+    enc->offset[i] = GST_VIDEO_INFO_COMP_OFFSET (info, i);
+    enc->stride[i] = GST_VIDEO_INFO_COMP_STRIDE (info, i);
+    enc->inc[i] = GST_VIDEO_INFO_COMP_PSTRIDE (info, i);
+    enc->h_samp[i] =
+        GST_ROUND_UP_4 (GST_VIDEO_INFO_WIDTH (info)) / enc->cwidth[i];
     enc->h_max_samp = MAX (enc->h_max_samp, enc->h_samp[i]);
-    enc->v_samp[i] = GST_ROUND_UP_4 (height) / enc->cheight[i];
+    enc->v_samp[i] =
+        GST_ROUND_UP_4 (GST_VIDEO_INFO_HEIGHT (info)) / enc->cheight[i];
     enc->v_max_samp = MAX (enc->v_max_samp, enc->v_samp[i]);
   }
   /* samp should only be 1, 2 or 4 */
   g_assert (enc->h_max_samp <= 4);
   g_assert (enc->v_max_samp <= 4);
+
   /* now invert */
   /* maximum is invariant, as one of the components should have samp 1 */
   for (i = 0; i < enc->channels; ++i) {
+    GST_DEBUG ("%d %d", enc->h_samp[i], enc->h_max_samp);
     enc->h_samp[i] = enc->h_max_samp / enc->h_samp[i];
     enc->v_samp[i] = enc->v_max_samp / enc->v_samp[i];
   }
   enc->planar = (enc->inc[0] == 1 && enc->inc[1] == 1 && enc->inc[2] == 1);
 
-  othercaps = gst_caps_copy (gst_pad_get_pad_template_caps (enc->srcpad));
-  gst_caps_set_simple (othercaps,
-      "width", G_TYPE_INT, enc->width, "height", G_TYPE_INT, enc->height, NULL);
-  if (enc->fps_den > 0)
-    gst_caps_set_simple (othercaps,
-        "framerate", GST_TYPE_FRACTION, enc->fps_num, enc->fps_den, NULL);
-  if (enc->par_den > 0)
-    gst_caps_set_simple (othercaps,
-        "pixel-aspect-ratio", GST_TYPE_FRACTION, enc->par_num, enc->par_den,
-        NULL);
+  output =
+      gst_video_encoder_set_output_state (encoder,
+      gst_caps_new_simple ("image/jpeg", NULL), state);
+  gst_video_codec_state_unref (output);
 
-  ret = gst_pad_set_caps (enc->srcpad, othercaps);
-  gst_caps_unref (othercaps);
+  gst_jpegenc_resync (enc);
 
-  if (ret)
-    gst_jpegenc_resync (enc);
-
-  gst_object_unref (enc);
-
-  return ret;
-
-  /* ERRORS */
-refuse_caps:
-  {
-    GST_WARNING_OBJECT (enc, "refused caps %" GST_PTR_FORMAT, caps);
-    gst_object_unref (enc);
-    return FALSE;
-  }
+  return TRUE;
 }
 
 static void
 gst_jpegenc_resync (GstJpegEnc * jpegenc)
 {
+  GstVideoInfo *info;
   gint width, height;
   gint i, j;
 
   GST_DEBUG_OBJECT (jpegenc, "resync");
 
-  jpegenc->cinfo.image_width = width = jpegenc->width;
-  jpegenc->cinfo.image_height = height = jpegenc->height;
+  if (!jpegenc->input_state)
+    return;
+
+  info = &jpegenc->input_state->info;
+
+  jpegenc->cinfo.image_width = width = GST_VIDEO_INFO_WIDTH (info);
+  jpegenc->cinfo.image_height = height = GST_VIDEO_INFO_HEIGHT (info);
   jpegenc->cinfo.input_components = jpegenc->channels;
 
   GST_DEBUG_OBJECT (jpegenc, "width %d, height %d", width, height);
-  GST_DEBUG_OBJECT (jpegenc, "format %d", jpegenc->format);
+  GST_DEBUG_OBJECT (jpegenc, "format %d", GST_VIDEO_INFO_FORMAT (info));
 
-  if (gst_video_format_is_rgb (jpegenc->format)) {
+  if (GST_VIDEO_INFO_IS_RGB (info)) {
     GST_DEBUG_OBJECT (jpegenc, "RGB");
     jpegenc->cinfo.in_color_space = JCS_RGB;
-  } else if (gst_video_format_is_gray (jpegenc->format)) {
+  } else if (GST_VIDEO_INFO_IS_GRAY (info)) {
     GST_DEBUG_OBJECT (jpegenc, "gray");
     jpegenc->cinfo.in_color_space = JCS_GRAYSCALE;
   } else {
@@ -512,7 +380,7 @@ gst_jpegenc_resync (GstJpegEnc * jpegenc)
   }
 
   /* input buffer size as max output */
-  jpegenc->bufsize = gst_video_format_get_size (jpegenc->format, width, height);
+  jpegenc->bufsize = GST_VIDEO_INFO_SIZE (info);
   jpeg_set_defaults (&jpegenc->cinfo);
   jpegenc->cinfo.raw_data_in = TRUE;
   /* duh, libjpeg maps RGB to YUV ... and don't expect some conversion */
@@ -548,9 +416,8 @@ gst_jpegenc_resync (GstJpegEnc * jpegenc)
 }
 
 static GstFlowReturn
-gst_jpegenc_chain (GstPad * pad, GstBuffer * buf)
+gst_jpegenc_handle_frame (GstVideoEncoder * encoder, GstVideoCodecFrame * frame)
 {
-  GstFlowReturn ret;
   GstJpegEnc *jpegenc;
   guchar *data;
   gulong size;
@@ -558,28 +425,21 @@ gst_jpegenc_chain (GstPad * pad, GstBuffer * buf)
   guchar *base[3], *end[3];
   gint i, j, k;
 
-  jpegenc = GST_JPEGENC (GST_OBJECT_PARENT (pad));
+  jpegenc = GST_JPEGENC (encoder);
 
-  if (G_UNLIKELY (jpegenc->width <= 0 || jpegenc->height <= 0))
-    goto not_negotiated;
-
-  data = GST_BUFFER_DATA (buf);
-  size = GST_BUFFER_SIZE (buf);
+  data = GST_BUFFER_DATA (frame->input_buffer);
+  size = GST_BUFFER_SIZE (frame->input_buffer);
 
   GST_LOG_OBJECT (jpegenc, "got buffer of %lu bytes", size);
 
-  ret =
-      gst_pad_alloc_buffer_and_set_caps (jpegenc->srcpad,
-      GST_BUFFER_OFFSET_NONE, jpegenc->bufsize, GST_PAD_CAPS (jpegenc->srcpad),
-      &jpegenc->output_buffer);
-
-  if (ret != GST_FLOW_OK)
-    goto done;
+  if (size < GST_VIDEO_INFO_SIZE (&jpegenc->input_state->info))
+    goto input_too_small;
 
-  gst_buffer_copy_metadata (jpegenc->output_buffer, buf,
-      GST_BUFFER_COPY_TIMESTAMPS);
+  jpegenc->current_frame = frame;
+  jpegenc->output_buffer = frame->output_buffer =
+      gst_buffer_new_and_alloc (jpegenc->bufsize);
 
-  height = jpegenc->height;
+  height = GST_VIDEO_INFO_HEIGHT (&jpegenc->input_state->info);
 
   for (i = 0; i < jpegenc->channels; i++) {
     base[i] = data + jpegenc->offset[i];
@@ -641,17 +501,18 @@ gst_jpegenc_chain (GstPad * pad, GstBuffer * buf)
   jpeg_finish_compress (&jpegenc->cinfo);
   GST_LOG_OBJECT (jpegenc, "compressing done");
 
-done:
-  gst_buffer_unref (buf);
-
-  return ret;
+  return GST_FLOW_OK;
 
 /* ERRORS */
-not_negotiated:
+input_too_small:
   {
-    GST_WARNING_OBJECT (jpegenc, "no input format set (no caps on buffer)");
-    ret = GST_FLOW_NOT_NEGOTIATED;
-    goto done;
+    GST_ELEMENT_ERROR (jpegenc, STREAM, ENCODE, (NULL),
+        ("Input video buffer too small, expected at least %lu bytes, but got "
+            "only %lu bytes. This is either a bug in an upstream element or "
+            "you need to use the videoparse element to read raw video data in the "
+            "right chunking.",
+            GST_VIDEO_INFO_SIZE (&jpegenc->input_state->info), size));
+    return GST_FLOW_ERROR;
   }
 }
 
@@ -711,34 +572,24 @@ gst_jpegenc_get_property (GObject * object, guint prop_id, GValue * value,
   GST_OBJECT_UNLOCK (jpegenc);
 }
 
-static GstStateChangeReturn
-gst_jpegenc_change_state (GstElement * element, GstStateChange transition)
+static gboolean
+gst_jpegenc_start (GstVideoEncoder * benc)
 {
-  GstStateChangeReturn ret = GST_STATE_CHANGE_SUCCESS;
-  GstJpegEnc *filter = GST_JPEGENC (element);
-
-  switch (transition) {
-    case GST_STATE_CHANGE_NULL_TO_READY:
-      GST_DEBUG_OBJECT (element, "setting line buffers");
-      filter->line[0] = NULL;
-      filter->line[1] = NULL;
-      filter->line[2] = NULL;
-      break;
-    default:
-      break;
-  }
+  GstJpegEnc *enc = (GstJpegEnc *) benc;
 
-  ret = GST_ELEMENT_CLASS (parent_class)->change_state (element, transition);
-  if (ret == GST_STATE_CHANGE_FAILURE)
-    return ret;
+  enc->line[0] = NULL;
+  enc->line[1] = NULL;
+  enc->line[2] = NULL;
 
-  switch (transition) {
-    case GST_STATE_CHANGE_PAUSED_TO_READY:
-      gst_jpegenc_reset (filter);
-      break;
-    default:
-      break;
-  }
+  return TRUE;
+}
 
-  return ret;
+static gboolean
+gst_jpegenc_stop (GstVideoEncoder * benc)
+{
+  GstJpegEnc *enc = (GstJpegEnc *) benc;
+
+  gst_jpegenc_reset (enc);
+
+  return TRUE;
 }
diff --git a/ext/jpeg/gstjpegenc.h b/ext/jpeg/gstjpegenc.h
index f7a3ef0..95de0b0 100644
--- a/ext/jpeg/gstjpegenc.h
+++ b/ext/jpeg/gstjpegenc.h
@@ -1,5 +1,7 @@
 /* GStreamer
  * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
+ * Copyright (C) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
  *
  * This library is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Library General Public
@@ -24,6 +26,7 @@
 
 #include <gst/gst.h>
 #include <gst/video/video.h>
+#include <gst/video/gstvideoencoder.h>
 /* this is a hack hack hack to get around jpeglib header bugs... */
 #ifdef HAVE_STDLIB_H
 # undef HAVE_STDLIB_H
@@ -50,19 +53,13 @@ typedef struct _GstJpegEncClass GstJpegEncClass;
 
 struct _GstJpegEnc
 {
-  GstElement element;
-
-  /* pads */
-  GstPad *sinkpad, *srcpad;
-
-  /* stream/image properties */
-  GstVideoFormat format;
-  gint width;
-  gint height;
-  gint channels;
-  gint fps_num, fps_den;
-  gint par_num, par_den;
-  /* standard video_format indexed */
+  GstVideoEncoder encoder;
+
+  GstVideoCodecState *input_state;
+  GstVideoCodecFrame *current_frame;
+
+  guint channels;
+
   gint stride[GST_JPEG_ENC_MAX_COMPONENT];
   gint offset[GST_JPEG_ENC_MAX_COMPONENT];
   gint inc[GST_JPEG_ENC_MAX_COMPONENT];
@@ -89,15 +86,12 @@ struct _GstJpegEnc
   gint smoothing;
   gint idct_method;
 
-  /* cached return state for any problems that may occur in callbacks */
-  GstFlowReturn last_ret;
-
   GstBuffer *output_buffer;
 };
 
 struct _GstJpegEncClass
 {
-  GstElementClass parent_class;
+  GstVideoEncoderClass parent_class;
 
   /* signals */
   void (*frame_encoded) (GstElement * element);
diff --git a/ext/libcaca/Makefile.in b/ext/libcaca/Makefile.in
index d12e274..013abeb 100644
--- a/ext/libcaca/Makefile.in
+++ b/ext/libcaca/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/libcaca
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -118,10 +134,23 @@ libgstcacasink_la_OBJECTS = $(am_libgstcacasink_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstcacasink_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstcacasink_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstcacasink_la_CFLAGS) $(CFLAGS) \
 	$(libgstcacasink_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -134,22 +163,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstcacasink_la_SOURCES)
 DIST_SOURCES = $(libgstcacasink_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -209,6 +239,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -257,8 +288,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -339,7 +372,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -399,6 +432,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -472,7 +506,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -528,7 +566,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -536,6 +573,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -551,12 +590,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstcacasink.la: $(libgstcacasink_la_OBJECTS) $(libgstcacasink_la_DEPENDENCIES) $(EXTRA_libgstcacasink_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstcacasink_la_LINK) -rpath $(plugindir) $(libgstcacasink_la_OBJECTS) $(libgstcacasink_la_LIBADD) $(LIBS)
 
@@ -651,6 +692,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -795,18 +850,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/libpng/Makefile.in b/ext/libpng/Makefile.in
index 960a341..2df68c7 100644
--- a/ext/libpng/Makefile.in
+++ b/ext/libpng/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/libpng
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -119,10 +135,23 @@ libgstpng_la_OBJECTS = $(am_libgstpng_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstpng_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstpng_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstpng_la_CFLAGS) $(CFLAGS) \
 	$(libgstpng_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -135,22 +164,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstpng_la_SOURCES)
 DIST_SOURCES = $(libgstpng_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -210,6 +240,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -258,8 +289,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -340,7 +373,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -400,6 +433,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -473,7 +507,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -522,7 +560,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -530,6 +567,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -545,12 +584,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstpng.la: $(libgstpng_la_OBJECTS) $(libgstpng_la_DEPENDENCIES) $(EXTRA_libgstpng_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstpng_la_LINK) -rpath $(plugindir) $(libgstpng_la_OBJECTS) $(libgstpng_la_LIBADD) $(LIBS)
 
@@ -661,6 +702,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -805,18 +860,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/libpng/gstpng.h b/ext/libpng/gstpng.h
new file mode 100644
index 0000000..8c498d3
--- /dev/null
+++ b/ext/libpng/gstpng.h
@@ -0,0 +1,25 @@
+/* GStreamer
+ * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
+ *
+ * Filter:
+ * Copyright (C) 2000 Donald A. Graft
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ *
+ */
+
+#include <gst/gst.h>
+#include <png.h>
+
+GType gst_pngenc_get_type (void);
+
+extern GstPadTemplate *gst_png_sink_factory ();
+extern GstPadTemplate *gst_png_src_factory ();
diff --git a/ext/libpng/gstpngdec.c b/ext/libpng/gstpngdec.c
index 4a2b547..a1638c3 100644
--- a/ext/libpng/gstpngdec.c
+++ b/ext/libpng/gstpngdec.c
@@ -1,5 +1,7 @@
 /* GStreamer
  * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
+ * Copyright (C) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
  *
  * This library is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -33,61 +35,28 @@
 GST_DEBUG_CATEGORY_STATIC (pngdec_debug);
 #define GST_CAT_DEFAULT pngdec_debug
 
-static void gst_pngdec_base_init (gpointer g_class);
-static void gst_pngdec_class_init (GstPngDecClass * klass);
-static void gst_pngdec_init (GstPngDec * pngdec);
-
 static gboolean gst_pngdec_libpng_init (GstPngDec * pngdec);
-static gboolean gst_pngdec_libpng_clear (GstPngDec * pngdec);
-
-static GstStateChangeReturn gst_pngdec_change_state (GstElement * element,
-    GstStateChange transition);
-
-static gboolean gst_pngdec_sink_activate_push (GstPad * sinkpad,
-    gboolean active);
-static gboolean gst_pngdec_sink_activate_pull (GstPad * sinkpad,
-    gboolean active);
-static gboolean gst_pngdec_sink_activate (GstPad * sinkpad);
+static gboolean gst_pngdec_reset (GstVideoDecoder * decoder, gboolean hard);
 
 static GstFlowReturn gst_pngdec_caps_create_and_set (GstPngDec * pngdec);
 
-static void gst_pngdec_task (GstPad * pad);
-static GstFlowReturn gst_pngdec_chain (GstPad * pad, GstBuffer * buffer);
-static gboolean gst_pngdec_sink_event (GstPad * pad, GstEvent * event);
-static gboolean gst_pngdec_sink_setcaps (GstPad * pad, GstCaps * caps);
-
-static GstElementClass *parent_class = NULL;
+static gboolean gst_pngdec_start (GstVideoDecoder * decoder);
+static gboolean gst_pngdec_stop (GstVideoDecoder * decoder);
+static gboolean gst_pngdec_set_format (GstVideoDecoder * Decoder,
+    GstVideoCodecState * state);
+static GstFlowReturn gst_pngdec_handle_frame (GstVideoDecoder * decoder,
+    GstVideoCodecFrame * frame);
 
-GType
-gst_pngdec_get_type (void)
-{
-  static GType pngdec_type = 0;
-
-  if (!pngdec_type) {
-    static const GTypeInfo pngdec_info = {
-      sizeof (GstPngDecClass),
-      gst_pngdec_base_init,
-      NULL,
-      (GClassInitFunc) gst_pngdec_class_init,
-      NULL,
-      NULL,
-      sizeof (GstPngDec),
-      0,
-      (GInstanceInitFunc) gst_pngdec_init,
-    };
-
-    pngdec_type = g_type_register_static (GST_TYPE_ELEMENT, "GstPngDec",
-        &pngdec_info, 0);
-  }
-  return pngdec_type;
-}
+GST_BOILERPLATE (GstPngDec, gst_pngdec, GstVideoDecoder,
+    GST_TYPE_VIDEO_DECODER);
 
 static GstStaticPadTemplate gst_pngdec_src_pad_template =
     GST_STATIC_PAD_TEMPLATE ("src",
     GST_PAD_SRC,
     GST_PAD_ALWAYS,
     GST_STATIC_CAPS (GST_VIDEO_CAPS_RGBA ";" GST_VIDEO_CAPS_RGB ";"
-        GST_VIDEO_CAPS_ARGB_64)
+        GST_VIDEO_CAPS_ARGB_64 ";"
+        GST_VIDEO_CAPS_GRAY8 ";" GST_VIDEO_CAPS_GRAY16 ("BIG_ENDIAN"))
     );
 
 static GstStaticPadTemplate gst_pngdec_sink_pad_template =
@@ -115,54 +84,25 @@ gst_pngdec_base_init (gpointer g_class)
 static void
 gst_pngdec_class_init (GstPngDecClass * klass)
 {
-  GstElementClass *gstelement_class;
-
-  gstelement_class = (GstElementClass *) klass;
+  GstVideoDecoderClass *vdec_class = (GstVideoDecoderClass *) klass;
 
-  parent_class = g_type_class_peek_parent (klass);
-
-  gstelement_class->change_state = gst_pngdec_change_state;
+  vdec_class->start = gst_pngdec_start;
+  vdec_class->reset = gst_pngdec_reset;
+  vdec_class->set_format = gst_pngdec_set_format;
+  vdec_class->handle_frame = gst_pngdec_handle_frame;
 
   GST_DEBUG_CATEGORY_INIT (pngdec_debug, "pngdec", 0, "PNG image decoder");
 }
 
 static void
-gst_pngdec_init (GstPngDec * pngdec)
+gst_pngdec_init (GstPngDec * pngdec, GstPngDecClass * klass)
 {
-  pngdec->sinkpad =
-      gst_pad_new_from_static_template (&gst_pngdec_sink_pad_template, "sink");
-  gst_pad_set_activate_function (pngdec->sinkpad, gst_pngdec_sink_activate);
-  gst_pad_set_activatepush_function (pngdec->sinkpad,
-      gst_pngdec_sink_activate_push);
-  gst_pad_set_activatepull_function (pngdec->sinkpad,
-      gst_pngdec_sink_activate_pull);
-  gst_pad_set_chain_function (pngdec->sinkpad, gst_pngdec_chain);
-  gst_pad_set_event_function (pngdec->sinkpad, gst_pngdec_sink_event);
-  gst_pad_set_setcaps_function (pngdec->sinkpad, gst_pngdec_sink_setcaps);
-  gst_element_add_pad (GST_ELEMENT (pngdec), pngdec->sinkpad);
-
-  pngdec->srcpad =
-      gst_pad_new_from_static_template (&gst_pngdec_src_pad_template, "src");
-  gst_pad_use_fixed_caps (pngdec->srcpad);
-  gst_element_add_pad (GST_ELEMENT (pngdec), pngdec->srcpad);
-
   pngdec->buffer_out = NULL;
   pngdec->png = NULL;
   pngdec->info = NULL;
   pngdec->endinfo = NULL;
-  pngdec->setup = FALSE;
 
   pngdec->color_type = -1;
-  pngdec->width = -1;
-  pngdec->height = -1;
-  pngdec->bpp = -1;
-  pngdec->fps_n = 0;
-  pngdec->fps_d = 1;
-
-  pngdec->in_timestamp = GST_CLOCK_TIME_NONE;
-  pngdec->in_duration = GST_CLOCK_TIME_NONE;
-
-  gst_segment_init (&pngdec->segment, GST_FORMAT_UNDEFINED);
 
   pngdec->image_ready = FALSE;
 }
@@ -185,41 +125,54 @@ user_info_callback (png_structp png_ptr, png_infop info)
   GstPngDec *pngdec = NULL;
   GstFlowReturn ret = GST_FLOW_OK;
   size_t buffer_size;
-  GstBuffer *buffer = NULL;
-
-  pngdec = GST_PNGDEC (png_get_io_ptr (png_ptr));
+  guint height;
 
   GST_LOG ("info ready");
 
+  pngdec = GST_PNGDEC (png_get_io_ptr (png_ptr));
   /* Generate the caps and configure */
   ret = gst_pngdec_caps_create_and_set (pngdec);
   if (ret != GST_FLOW_OK) {
     goto beach;
   }
 
+  height = GST_VIDEO_INFO_HEIGHT (&pngdec->output_state->info);
+
   /* Allocate output buffer */
   pngdec->rowbytes = png_get_rowbytes (pngdec->png, pngdec->info);
+  GST_DEBUG ("png told us each row takes %d bytes", pngdec->rowbytes);
   if (pngdec->rowbytes > (G_MAXUINT32 - 3)
-      || pngdec->height > G_MAXUINT32 / pngdec->rowbytes) {
+      || height > G_MAXUINT32 / pngdec->rowbytes) {
     ret = GST_FLOW_ERROR;
     goto beach;
   }
   pngdec->rowbytes = GST_ROUND_UP_4 (pngdec->rowbytes);
-  buffer_size = pngdec->height * pngdec->rowbytes;
+  buffer_size = height * pngdec->rowbytes;
 
-  ret =
-      gst_pad_alloc_buffer_and_set_caps (pngdec->srcpad, GST_BUFFER_OFFSET_NONE,
-      buffer_size, GST_PAD_CAPS (pngdec->srcpad), &buffer);
-  if (ret != GST_FLOW_OK) {
-    goto beach;
-  }
+  GST_DEBUG ("Allocating a buffer of %" G_GSIZE_FORMAT " bytes", buffer_size);
 
-  pngdec->buffer_out = buffer;
+  g_assert (pngdec->buffer_out == NULL);
+  pngdec->buffer_out = pngdec->current_frame->output_buffer =
+      gst_buffer_new_and_alloc (buffer_size);
 
 beach:
   pngdec->ret = ret;
 }
 
+static gboolean
+gst_pngdec_set_format (GstVideoDecoder * decoder, GstVideoCodecState * state)
+{
+  GstPngDec *pngdec = (GstPngDec *) decoder;
+
+  if (pngdec->input_state)
+    gst_video_codec_state_unref (pngdec->input_state);
+  pngdec->input_state = gst_video_codec_state_ref (state);
+
+  /* We'll set format later on */
+
+  return TRUE;
+}
+
 static void
 user_endrow_callback (png_structp png_ptr, png_bytep new_row,
     png_uint_32 row_num, int pass)
@@ -243,31 +196,6 @@ user_endrow_callback (png_structp png_ptr, png_bytep new_row,
   }
 }
 
-static gboolean
-buffer_clip (GstPngDec * dec, GstBuffer * buffer)
-{
-  gboolean res = TRUE;
-  gint64 cstart, cstop;
-
-
-  if ((!GST_CLOCK_TIME_IS_VALID (GST_BUFFER_TIMESTAMP (buffer))) ||
-      (!GST_CLOCK_TIME_IS_VALID (GST_BUFFER_DURATION (buffer))) ||
-      (dec->segment.format != GST_FORMAT_TIME))
-    goto beach;
-
-  cstart = GST_BUFFER_TIMESTAMP (buffer);
-  cstop = GST_BUFFER_DURATION (buffer);
-
-  if ((res = gst_segment_clip (&dec->segment, GST_FORMAT_TIME,
-              cstart, cstart + cstop, &cstart, &cstop))) {
-    GST_BUFFER_TIMESTAMP (buffer) = cstart;
-    GST_BUFFER_DURATION (buffer) = cstop - cstart;
-  }
-
-beach:
-  return res;
-}
-
 static void
 user_end_callback (png_structp png_ptr, png_infop info)
 {
@@ -280,106 +208,36 @@ user_end_callback (png_structp png_ptr, png_infop info)
   if (!pngdec->buffer_out)
     return;
 
-  if (GST_CLOCK_TIME_IS_VALID (pngdec->in_timestamp))
-    GST_BUFFER_TIMESTAMP (pngdec->buffer_out) = pngdec->in_timestamp;
-  if (GST_CLOCK_TIME_IS_VALID (pngdec->in_duration))
-    GST_BUFFER_DURATION (pngdec->buffer_out) = pngdec->in_duration;
-
-  /* buffer clipping */
-  if (buffer_clip (pngdec, pngdec->buffer_out)) {
-    /* Push our buffer and then EOS if needed */
-    GST_LOG_OBJECT (pngdec, "pushing buffer with ts=%" GST_TIME_FORMAT,
-        GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (pngdec->buffer_out)));
-
-    pngdec->ret = gst_pad_push (pngdec->srcpad, pngdec->buffer_out);
-  } else {
-    GST_LOG_OBJECT (pngdec, "dropped decoded buffer");
-    gst_buffer_unref (pngdec->buffer_out);
-  }
+  pngdec->ret =
+      gst_video_decoder_finish_frame (GST_VIDEO_DECODER (pngdec),
+      pngdec->current_frame);
+
   pngdec->buffer_out = NULL;
   pngdec->image_ready = TRUE;
 }
 
-static void
-user_read_data (png_structp png_ptr, png_bytep data, png_size_t length)
-{
-  GstPngDec *pngdec;
-  GstBuffer *buffer;
-  GstFlowReturn ret = GST_FLOW_OK;
-  guint size;
-
-  pngdec = GST_PNGDEC (png_get_io_ptr (png_ptr));
-
-  GST_LOG ("reading %" G_GSIZE_FORMAT " bytes of data at offset %d", length,
-      pngdec->offset);
-
-  ret = gst_pad_pull_range (pngdec->sinkpad, pngdec->offset, length, &buffer);
-  if (ret != GST_FLOW_OK)
-    goto pause;
-
-  size = GST_BUFFER_SIZE (buffer);
-
-  if (size != length)
-    goto short_buffer;
-
-  memcpy (data, GST_BUFFER_DATA (buffer), size);
-
-  gst_buffer_unref (buffer);
-
-  pngdec->offset += length;
-
-  return;
-
-  /* ERRORS */
-pause:
-  {
-    GST_INFO_OBJECT (pngdec, "pausing task, reason %s",
-        gst_flow_get_name (ret));
-    gst_pad_pause_task (pngdec->sinkpad);
-    if (ret == GST_FLOW_UNEXPECTED) {
-      gst_pad_push_event (pngdec->srcpad, gst_event_new_eos ());
-    } else if (ret < GST_FLOW_UNEXPECTED || ret == GST_FLOW_NOT_LINKED) {
-      GST_ELEMENT_ERROR (pngdec, STREAM, FAILED,
-          (_("Internal data stream error.")),
-          ("stream stopped, reason %s", gst_flow_get_name (ret)));
-      gst_pad_push_event (pngdec->srcpad, gst_event_new_eos ());
-    }
-    png_error (png_ptr, "Internal data stream error.");
-    return;
-  }
-short_buffer:
-  {
-    gst_buffer_unref (buffer);
-    GST_ELEMENT_ERROR (pngdec, STREAM, FAILED,
-        (_("Internal data stream error.")),
-        ("Read %u, needed %" G_GSIZE_FORMAT "bytes", size, length));
-    ret = GST_FLOW_ERROR;
-    goto pause;
-  }
-}
 
 static GstFlowReturn
 gst_pngdec_caps_create_and_set (GstPngDec * pngdec)
 {
   GstFlowReturn ret = GST_FLOW_OK;
-  GstCaps *caps = NULL, *res = NULL;
-  GstPadTemplate *templ = NULL;
   gint bpc = 0, color_type;
   png_uint_32 width, height;
+  GstVideoFormat format = GST_VIDEO_FORMAT_UNKNOWN;
 
   g_return_val_if_fail (GST_IS_PNGDEC (pngdec), GST_FLOW_ERROR);
 
   /* Get bits per channel */
   bpc = png_get_bit_depth (pngdec->png, pngdec->info);
-  if (bpc > 8) {
-    /* Add alpha channel if 16-bit depth */
-    png_set_add_alpha (pngdec->png, 0xffff, PNG_FILLER_BEFORE);
-    png_set_swap (pngdec->png);
-  }
 
   /* Get Color type */
   color_type = png_get_color_type (pngdec->png, pngdec->info);
 
+  /* Add alpha channel if 16-bit depth, but not for GRAY images */
+  if ((bpc > 8) && (color_type != PNG_COLOR_TYPE_GRAY)) {
+    png_set_add_alpha (pngdec->png, 0xffff, PNG_FILLER_BEFORE);
+    png_set_swap (pngdec->png);
+  }
 #if 0
   /* We used to have this HACK to reverse the outgoing bytes, but the problem
    * that originally required the hack seems to have been in ffmpegcolorspace's
@@ -389,11 +247,16 @@ gst_pngdec_caps_create_and_set (GstPngDec * pngdec)
     png_set_bgr (pngdec->png);
 #endif
 
-  /* Gray scale converted to RGB and upscaled to 8 bits */
+  /* Gray scale with alpha channel converted to RGB */
+  if (color_type == PNG_COLOR_TYPE_GRAY_ALPHA) {
+    GST_LOG_OBJECT (pngdec,
+        "converting grayscale png with alpha channel to RGB");
+    png_set_gray_to_rgb (pngdec->png);
+  }
+
+  /* Gray scale converted to upscaled to 8 bits */
   if ((color_type == PNG_COLOR_TYPE_GRAY_ALPHA) ||
       (color_type == PNG_COLOR_TYPE_GRAY)) {
-    GST_LOG_OBJECT (pngdec, "converting grayscale png to RGB");
-    png_set_gray_to_rgb (pngdec->png);
     if (bpc < 8) {              /* Convert to 8 bits */
       GST_LOG_OBJECT (pngdec, "converting grayscale image to 8 bits");
 #if PNG_LIBPNG_VER < 10400
@@ -414,168 +277,74 @@ gst_pngdec_caps_create_and_set (GstPngDec * pngdec)
   png_read_update_info (pngdec->png, pngdec->info);
 
   /* Get IHDR header again after transformation settings */
-
   png_get_IHDR (pngdec->png, pngdec->info, &width, &height,
       &bpc, &pngdec->color_type, NULL, NULL, NULL);
 
-  pngdec->width = width;
-  pngdec->height = height;
-
-  GST_LOG_OBJECT (pngdec, "this is a %dx%d PNG image", pngdec->width,
-      pngdec->height);
+  GST_LOG_OBJECT (pngdec, "this is a %dx%d PNG image", width, height);
 
   switch (pngdec->color_type) {
     case PNG_COLOR_TYPE_RGB:
       GST_LOG_OBJECT (pngdec, "we have no alpha channel, depth is 24 bits");
-      pngdec->bpp = 3 * bpc;
+      if (bpc == 8)
+        format = GST_VIDEO_FORMAT_RGB;
       break;
     case PNG_COLOR_TYPE_RGB_ALPHA:
-      GST_LOG_OBJECT (pngdec, "we have an alpha channel, depth is 32 bits");
-      pngdec->bpp = 4 * bpc;
+      GST_LOG_OBJECT (pngdec,
+          "we have an alpha channel, depth is 32 or 64 bits");
+      if (bpc == 8)
+        format = GST_VIDEO_FORMAT_RGBA;
+      else if (bpc == 16)
+        format = GST_VIDEO_FORMAT_ARGB64;
+      break;
+    case PNG_COLOR_TYPE_GRAY:
+      GST_LOG_OBJECT (pngdec,
+          "We have an gray image, depth is 8 or 16 (be) bits");
+      if (bpc == 8)
+        format = GST_VIDEO_FORMAT_GRAY8;
+      else if (bpc == 16)
+        format = GST_VIDEO_FORMAT_GRAY16_BE;
       break;
     default:
-      GST_ELEMENT_ERROR (pngdec, STREAM, NOT_IMPLEMENTED, (NULL),
-          ("pngdec does not support this color type"));
-      ret = GST_FLOW_NOT_SUPPORTED;
-      goto beach;
-  }
-
-  caps = gst_caps_new_simple ("video/x-raw-rgb",
-      "width", G_TYPE_INT, pngdec->width,
-      "height", G_TYPE_INT, pngdec->height,
-      "bpp", G_TYPE_INT, pngdec->bpp,
-      "framerate", GST_TYPE_FRACTION, pngdec->fps_n, pngdec->fps_d, NULL);
-
-  templ = gst_static_pad_template_get (&gst_pngdec_src_pad_template);
-
-  res = gst_caps_intersect (caps, gst_pad_template_get_caps (templ));
-
-  gst_caps_unref (caps);
-  gst_object_unref (templ);
-
-  if (!gst_pad_set_caps (pngdec->srcpad, res))
-    ret = GST_FLOW_NOT_NEGOTIATED;
-
-  GST_DEBUG_OBJECT (pngdec, "our caps %" GST_PTR_FORMAT, res);
-
-  gst_caps_unref (res);
-
-  /* Push a newsegment event */
-  if (pngdec->need_newsegment) {
-    gst_pad_push_event (pngdec->srcpad,
-        gst_event_new_new_segment (FALSE, 1.0, GST_FORMAT_TIME, 0, -1, 0));
-    pngdec->need_newsegment = FALSE;
-  }
-
-beach:
-  return ret;
-}
-
-static void
-gst_pngdec_task (GstPad * pad)
-{
-  GstPngDec *pngdec;
-  GstBuffer *buffer = NULL;
-  size_t buffer_size = 0;
-  gint i = 0;
-  png_bytep *rows, inp;
-  png_uint_32 rowbytes;
-  GstFlowReturn ret = GST_FLOW_OK;
-
-  pngdec = GST_PNGDEC (GST_OBJECT_PARENT (pad));
-
-  GST_LOG_OBJECT (pngdec, "read frame");
-
-  /* Let libpng come back here on error */
-  if (setjmp (png_jmpbuf (pngdec->png))) {
-    ret = GST_FLOW_ERROR;
-    goto pause;
-  }
-
-  /* Set reading callback */
-  png_set_read_fn (pngdec->png, pngdec, user_read_data);
-
-  /* Read info */
-  png_read_info (pngdec->png, pngdec->info);
-
-  /* Generate the caps and configure */
-  ret = gst_pngdec_caps_create_and_set (pngdec);
-  if (ret != GST_FLOW_OK) {
-    goto pause;
+      break;
   }
 
-  /* Allocate output buffer */
-  rowbytes = png_get_rowbytes (pngdec->png, pngdec->info);
-  if (rowbytes > (G_MAXUINT32 - 3) || pngdec->height > G_MAXUINT32 / rowbytes) {
-    ret = GST_FLOW_ERROR;
-    goto pause;
+  if (format == GST_VIDEO_FORMAT_UNKNOWN) {
+    GST_ELEMENT_ERROR (pngdec, STREAM, NOT_IMPLEMENTED, (NULL),
+        ("pngdec does not support this color type"));
+    ret = GST_FLOW_NOT_SUPPORTED;
+    goto beach;
   }
-  rowbytes = GST_ROUND_UP_4 (rowbytes);
-  buffer_size = pngdec->height * rowbytes;
-  ret =
-      gst_pad_alloc_buffer_and_set_caps (pngdec->srcpad, GST_BUFFER_OFFSET_NONE,
-      buffer_size, GST_PAD_CAPS (pngdec->srcpad), &buffer);
-  if (ret != GST_FLOW_OK)
-    goto pause;
-
-  rows = (png_bytep *) g_malloc (sizeof (png_bytep) * pngdec->height);
 
-  inp = GST_BUFFER_DATA (buffer);
+  /* Check if output state changed */
+  if (pngdec->output_state) {
+    GstVideoInfo *info = &pngdec->output_state->info;
 
-  for (i = 0; i < pngdec->height; i++) {
-    rows[i] = inp;
-    inp += rowbytes;
+    if (width == GST_VIDEO_INFO_WIDTH (info) &&
+        height == GST_VIDEO_INFO_HEIGHT (info) &&
+        GST_VIDEO_INFO_FORMAT (info) == format) {
+      goto beach;
+    }
+    gst_video_codec_state_unref (pngdec->output_state);
   }
 
-  /* Read the actual picture */
-  png_read_image (pngdec->png, rows);
-  g_free (rows);
+  pngdec->output_state =
+      gst_video_decoder_set_output_state (GST_VIDEO_DECODER (pngdec), format,
+      width, height, pngdec->input_state);
+  GST_DEBUG ("Final %d %d", GST_VIDEO_INFO_WIDTH (&pngdec->output_state->info),
+      GST_VIDEO_INFO_HEIGHT (&pngdec->output_state->info));
 
-  /* Push the raw RGB frame */
-  ret = gst_pad_push (pngdec->srcpad, buffer);
-  if (ret != GST_FLOW_OK)
-    goto pause;
-
-  /* And we are done */
-  gst_pad_pause_task (pngdec->sinkpad);
-  gst_pad_push_event (pngdec->srcpad, gst_event_new_eos ());
-  return;
-
-pause:
-  {
-    GST_INFO_OBJECT (pngdec, "pausing task, reason %s",
-        gst_flow_get_name (ret));
-    gst_pad_pause_task (pngdec->sinkpad);
-    if (ret == GST_FLOW_UNEXPECTED) {
-      gst_pad_push_event (pngdec->srcpad, gst_event_new_eos ());
-    } else if (ret == GST_FLOW_NOT_LINKED || ret < GST_FLOW_UNEXPECTED) {
-      GST_ELEMENT_ERROR (pngdec, STREAM, FAILED,
-          (_("Internal data stream error.")),
-          ("stream stopped, reason %s", gst_flow_get_name (ret)));
-      gst_pad_push_event (pngdec->srcpad, gst_event_new_eos ());
-    }
-  }
+beach:
+  return ret;
 }
 
 static GstFlowReturn
-gst_pngdec_chain (GstPad * pad, GstBuffer * buffer)
+gst_pngdec_handle_frame (GstVideoDecoder * decoder, GstVideoCodecFrame * frame)
 {
-  GstPngDec *pngdec;
+  GstPngDec *pngdec = (GstPngDec *) decoder;
   GstFlowReturn ret = GST_FLOW_OK;
 
-  pngdec = GST_PNGDEC (gst_pad_get_parent (pad));
-
-  GST_LOG_OBJECT (pngdec, "Got buffer, size=%u", GST_BUFFER_SIZE (buffer));
-
-  if (G_UNLIKELY (!pngdec->setup))
-    goto not_configured;
-
-  /* Something is going wrong in our callbacks */
-  ret = pngdec->ret;
-  if (G_UNLIKELY (ret != GST_FLOW_OK)) {
-    GST_WARNING_OBJECT (pngdec, "we have a pending return code of %d", ret);
-    goto beach;
-  }
+  GST_LOG_OBJECT (pngdec, "Got buffer, size=%u",
+      GST_BUFFER_SIZE (frame->input_buffer));
 
   /* Let libpng come back here on error */
   if (setjmp (png_jmpbuf (pngdec->png))) {
@@ -584,169 +353,39 @@ gst_pngdec_chain (GstPad * pad, GstBuffer * buffer)
     goto beach;
   }
 
-  pngdec->in_timestamp = GST_BUFFER_TIMESTAMP (buffer);
-  pngdec->in_duration = GST_BUFFER_DURATION (buffer);
+  pngdec->current_frame = frame;
 
   /* Progressive loading of the PNG image */
-  png_process_data (pngdec->png, pngdec->info, GST_BUFFER_DATA (buffer),
-      GST_BUFFER_SIZE (buffer));
+  png_process_data (pngdec->png, pngdec->info,
+      GST_BUFFER_DATA (frame->input_buffer),
+      GST_BUFFER_SIZE (frame->input_buffer));
 
   if (pngdec->image_ready) {
-    if (pngdec->framed) {
+    if (1) {
       /* Reset ourselves for the next frame */
-      gst_pngdec_libpng_clear (pngdec);
-      gst_pngdec_libpng_init (pngdec);
+      gst_pngdec_reset (decoder, TRUE);
       GST_LOG_OBJECT (pngdec, "setting up callbacks for next frame");
       png_set_progressive_read_fn (pngdec->png, pngdec,
           user_info_callback, user_endrow_callback, user_end_callback);
     } else {
       GST_LOG_OBJECT (pngdec, "sending EOS");
-      pngdec->ret = gst_pad_push_event (pngdec->srcpad, gst_event_new_eos ());
+      pngdec->ret = GST_FLOW_UNEXPECTED;
     }
     pngdec->image_ready = FALSE;
   }
 
-  /* grab new return code */
   ret = pngdec->ret;
-
-  /* And release the buffer */
-  gst_buffer_unref (buffer);
-
 beach:
-  gst_object_unref (pngdec);
 
   return ret;
-
-  /* ERRORS */
-not_configured:
-  {
-    GST_LOG_OBJECT (pngdec, "we are not configured yet");
-    ret = GST_FLOW_WRONG_STATE;
-    goto beach;
-  }
 }
 
-static gboolean
-gst_pngdec_sink_setcaps (GstPad * pad, GstCaps * caps)
-{
-  GstStructure *s;
-  GstPngDec *pngdec;
-  gint num, denom;
-
-  pngdec = GST_PNGDEC (gst_pad_get_parent (pad));
-
-  s = gst_caps_get_structure (caps, 0);
-  if (gst_structure_get_fraction (s, "framerate", &num, &denom)) {
-    GST_DEBUG_OBJECT (pngdec, "framed input");
-    pngdec->framed = TRUE;
-    pngdec->fps_n = num;
-    pngdec->fps_d = denom;
-  } else {
-    GST_DEBUG_OBJECT (pngdec, "single picture input");
-    pngdec->framed = FALSE;
-    pngdec->fps_n = 0;
-    pngdec->fps_d = 1;
-  }
-
-  gst_object_unref (pngdec);
-  return TRUE;
-}
-
-static gboolean
-gst_pngdec_sink_event (GstPad * pad, GstEvent * event)
-{
-  GstPngDec *pngdec;
-  gboolean res;
-
-  pngdec = GST_PNGDEC (gst_pad_get_parent (pad));
-
-  switch (GST_EVENT_TYPE (event)) {
-    case GST_EVENT_NEWSEGMENT:{
-      gdouble rate, arate;
-      gboolean update;
-      gint64 start, stop, position;
-      GstFormat fmt;
-
-      gst_event_parse_new_segment_full (event, &update, &rate, &arate, &fmt,
-          &start, &stop, &position);
-
-      gst_segment_set_newsegment_full (&pngdec->segment, update, rate, arate,
-          fmt, start, stop, position);
-
-      GST_LOG_OBJECT (pngdec, "NEWSEGMENT (%s)", gst_format_get_name (fmt));
-
-      if (fmt == GST_FORMAT_TIME) {
-        pngdec->need_newsegment = FALSE;
-        res = gst_pad_push_event (pngdec->srcpad, event);
-      } else {
-        gst_event_unref (event);
-        res = TRUE;
-      }
-      break;
-    }
-    case GST_EVENT_FLUSH_STOP:
-    {
-      gst_pngdec_libpng_clear (pngdec);
-      gst_pngdec_libpng_init (pngdec);
-      png_set_progressive_read_fn (pngdec->png, pngdec,
-          user_info_callback, user_endrow_callback, user_end_callback);
-      pngdec->ret = GST_FLOW_OK;
-      gst_segment_init (&pngdec->segment, GST_FORMAT_UNDEFINED);
-      res = gst_pad_push_event (pngdec->srcpad, event);
-      break;
-    }
-    case GST_EVENT_EOS:
-    {
-      GST_LOG_OBJECT (pngdec, "EOS");
-      gst_pngdec_libpng_clear (pngdec);
-      pngdec->ret = GST_FLOW_UNEXPECTED;
-      res = gst_pad_push_event (pngdec->srcpad, event);
-      break;
-    }
-    default:
-      res = gst_pad_push_event (pngdec->srcpad, event);
-      break;
-  }
-
-  gst_object_unref (pngdec);
-  return res;
-}
-
-
 /* Clean up the libpng structures */
 static gboolean
-gst_pngdec_libpng_clear (GstPngDec * pngdec)
+gst_pngdec_reset (GstVideoDecoder * decoder, gboolean hard)
 {
-  png_infopp info = NULL, endinfo = NULL;
-
-  g_return_val_if_fail (GST_IS_PNGDEC (pngdec), FALSE);
-
-  GST_LOG ("cleaning up libpng structures");
-
-  if (pngdec->info) {
-    info = &pngdec->info;
-  }
-
-  if (pngdec->endinfo) {
-    endinfo = &pngdec->endinfo;
-  }
-
-  if (pngdec->png) {
-    png_destroy_read_struct (&(pngdec->png), info, endinfo);
-    pngdec->png = NULL;
-    pngdec->info = NULL;
-    pngdec->endinfo = NULL;
-  }
-
-  pngdec->bpp = pngdec->color_type = pngdec->height = pngdec->width = -1;
-  pngdec->offset = 0;
-  pngdec->rowbytes = 0;
-  pngdec->buffer_out = NULL;
-
-  pngdec->setup = FALSE;
-
-  pngdec->in_timestamp = GST_CLOCK_TIME_NONE;
-  pngdec->in_duration = GST_CLOCK_TIME_NONE;
+  gst_pngdec_stop (decoder);
+  gst_pngdec_start (decoder);
 
   return TRUE;
 }
@@ -756,9 +395,6 @@ gst_pngdec_libpng_init (GstPngDec * pngdec)
 {
   g_return_val_if_fail (GST_IS_PNGDEC (pngdec), FALSE);
 
-  if (pngdec->setup)
-    return TRUE;
-
   GST_LOG ("init libpng structures");
 
   /* initialize png struct stuff */
@@ -776,7 +412,8 @@ gst_pngdec_libpng_init (GstPngDec * pngdec)
   if (pngdec->endinfo == NULL)
     goto endinfo_failed;
 
-  pngdec->setup = TRUE;
+  png_set_progressive_read_fn (pngdec->png, pngdec,
+      user_info_callback, user_endrow_callback, user_end_callback);
 
   return TRUE;
 
@@ -789,110 +426,63 @@ init_failed:
   }
 info_failed:
   {
-    gst_pngdec_libpng_clear (pngdec);
     GST_ELEMENT_ERROR (pngdec, LIBRARY, INIT, (NULL),
         ("Failed to initialize info structure"));
     return FALSE;
   }
 endinfo_failed:
   {
-    gst_pngdec_libpng_clear (pngdec);
     GST_ELEMENT_ERROR (pngdec, LIBRARY, INIT, (NULL),
         ("Failed to initialize endinfo structure"));
     return FALSE;
   }
 }
 
-static GstStateChangeReturn
-gst_pngdec_change_state (GstElement * element, GstStateChange transition)
+static gboolean
+gst_pngdec_start (GstVideoDecoder * decoder)
 {
-  GstStateChangeReturn ret;
-  GstPngDec *pngdec;
-
-  pngdec = GST_PNGDEC (element);
-
-  switch (transition) {
-    case GST_STATE_CHANGE_READY_TO_PAUSED:
-      gst_pngdec_libpng_init (pngdec);
-      pngdec->need_newsegment = TRUE;
-      pngdec->framed = FALSE;
-      pngdec->ret = GST_FLOW_OK;
-      gst_segment_init (&pngdec->segment, GST_FORMAT_UNDEFINED);
-      break;
-    default:
-      break;
-  }
+  GstPngDec *pngdec = (GstPngDec *) decoder;
 
-  ret = parent_class->change_state (element, transition);
-  if (ret != GST_STATE_CHANGE_SUCCESS)
-    return ret;
+  gst_pngdec_libpng_init (pngdec);
 
-  switch (transition) {
-    case GST_STATE_CHANGE_PAUSED_TO_READY:
-      gst_pngdec_libpng_clear (pngdec);
-      break;
-    default:
-      break;
-  }
-
-  return ret;
+  return TRUE;
 }
 
-/* this function gets called when we activate ourselves in push mode. */
 static gboolean
-gst_pngdec_sink_activate_push (GstPad * sinkpad, gboolean active)
+gst_pngdec_stop (GstVideoDecoder * decoder)
 {
-  GstPngDec *pngdec;
-
-  pngdec = GST_PNGDEC (GST_OBJECT_PARENT (sinkpad));
-
-  pngdec->ret = GST_FLOW_OK;
+  GstPngDec *pngdec = (GstPngDec *) decoder;
+  png_infopp info = NULL, endinfo = NULL;
 
-  if (active) {
-    /* Let libpng come back here on error */
-    if (setjmp (png_jmpbuf (pngdec->png)))
-      goto setup_failed;
+  GST_LOG ("cleaning up libpng structures");
 
-    GST_LOG ("setting up progressive loading callbacks");
-    png_set_progressive_read_fn (pngdec->png, pngdec,
-        user_info_callback, user_endrow_callback, user_end_callback);
+  if (pngdec->info) {
+    info = &pngdec->info;
   }
-  return TRUE;
 
-setup_failed:
-  {
-    GST_LOG ("failed setting up libpng jmpbuf");
-    gst_pngdec_libpng_clear (pngdec);
-    return FALSE;
+  if (pngdec->endinfo) {
+    endinfo = &pngdec->endinfo;
   }
-}
 
-/* this function gets called when we activate ourselves in pull mode.
- * We can perform  random access to the resource and we start a task
- * to start reading */
-static gboolean
-gst_pngdec_sink_activate_pull (GstPad * sinkpad, gboolean active)
-{
-  if (active) {
-    return gst_pad_start_task (sinkpad, (GstTaskFunction) gst_pngdec_task,
-        sinkpad);
-  } else {
-    return gst_pad_stop_task (sinkpad);
+  if (pngdec->png) {
+    png_destroy_read_struct (&(pngdec->png), info, endinfo);
+    pngdec->png = NULL;
+    pngdec->info = NULL;
+    pngdec->endinfo = NULL;
   }
-}
 
-/* this function is called when the pad is activated and should start
- * processing data.
- *
- * We check if we can do random access to decide if we work push or
- * pull based.
- */
-static gboolean
-gst_pngdec_sink_activate (GstPad * sinkpad)
-{
-  if (gst_pad_check_pull_range (sinkpad)) {
-    return gst_pad_activate_pull (sinkpad, TRUE);
-  } else {
-    return gst_pad_activate_push (sinkpad, TRUE);
+  pngdec->color_type = -1;
+  pngdec->rowbytes = 0;
+  pngdec->buffer_out = NULL;
+
+  if (pngdec->input_state) {
+    gst_video_codec_state_unref (pngdec->input_state);
+    pngdec->input_state = NULL;
   }
+  if (pngdec->output_state) {
+    gst_video_codec_state_unref (pngdec->output_state);
+    pngdec->output_state = NULL;
+  }
+
+  return TRUE;
 }
diff --git a/ext/libpng/gstpngdec.h b/ext/libpng/gstpngdec.h
index 439b293..f5639d3 100644
--- a/ext/libpng/gstpngdec.h
+++ b/ext/libpng/gstpngdec.h
@@ -1,5 +1,7 @@
 /* GStreamer
  * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
+ * Copyright (C) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
  *
  * This library is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Library General Public
@@ -22,6 +24,7 @@
 #define __GST_PNGDEC_H__
 
 #include <gst/gst.h>
+#include <gst/video/gstvideodecoder.h>
 #include <png.h>
 
 G_BEGIN_DECLS
@@ -37,44 +40,30 @@ typedef struct _GstPngDecClass GstPngDecClass;
 
 struct _GstPngDec
 {
-  GstElement element;
+  GstVideoDecoder parent;
 
-  GstPad *sinkpad, *srcpad;
+  GstVideoCodecState *input_state;
+  GstVideoCodecState *output_state;
+  GstVideoCodecFrame *current_frame;
 
-  gboolean need_newsegment;
+  GstFlowReturn ret;
 
   /* Progressive */
   GstBuffer *buffer_out;
-  GstFlowReturn ret;
   png_uint_32 rowbytes;
   
-  /* Pull range */
-  gint offset;
-
   png_structp png;
   png_infop info;
   png_infop endinfo;
-  gboolean setup;
 
-  gint width;
-  gint height;
-  gint bpp;
   gint color_type;
-  gint fps_n;
-  gint fps_d;
-
-  /* Chain */
-  gboolean framed;
-  GstClockTime in_timestamp;
-  GstClockTime in_duration;
 
-  GstSegment segment;
   gboolean image_ready;
 };
 
 struct _GstPngDecClass
 {
-  GstElementClass parent_class;
+  GstVideoDecoderClass parent_class;
 };
 
 GType gst_pngdec_get_type(void);
diff --git a/ext/libpng/gstpngenc.c b/ext/libpng/gstpngenc.c
index 30986cd..2ad0c12 100644
--- a/ext/libpng/gstpngenc.c
+++ b/ext/libpng/gstpngenc.c
@@ -4,6 +4,9 @@
  * Filter:
  * Copyright (C) 2000 Donald A. Graft
  *
+ * Copyright (C) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
+ *
  * This library is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
@@ -41,14 +44,12 @@ enum
 };
 
 #define DEFAULT_SNAPSHOT                TRUE
-/* #define DEFAULT_NEWMEDIA             FALSE */
 #define DEFAULT_COMPRESSION_LEVEL       6
 
 enum
 {
   ARG_0,
   ARG_SNAPSHOT,
-/*   ARG_NEWMEDIA, */
   ARG_COMPRESSION_LEVEL
 };
 
@@ -66,19 +67,23 @@ static GstStaticPadTemplate pngenc_sink_template =
     GST_PAD_SINK,
     GST_PAD_ALWAYS,
     GST_STATIC_CAPS (GST_VIDEO_CAPS_RGBA ";" GST_VIDEO_CAPS_RGB ";"
-        GST_VIDEO_CAPS_GRAY8)
+        GST_VIDEO_CAPS_GRAY8 ";" GST_VIDEO_CAPS_GRAY16 ("BIG_ENDIAN"))
     );
 
-/* static GstElementClass *parent_class = NULL; */
-
-GST_BOILERPLATE (GstPngEnc, gst_pngenc, GstElement, GST_TYPE_ELEMENT);
+GST_BOILERPLATE (GstPngEnc, gst_pngenc, GstVideoEncoder,
+    GST_TYPE_VIDEO_ENCODER);
 
 static void gst_pngenc_set_property (GObject * object,
     guint prop_id, const GValue * value, GParamSpec * pspec);
 static void gst_pngenc_get_property (GObject * object,
     guint prop_id, GValue * value, GParamSpec * pspec);
 
-static GstFlowReturn gst_pngenc_chain (GstPad * pad, GstBuffer * data);
+static GstFlowReturn gst_pngenc_handle_frame (GstVideoEncoder * encoder,
+    GstVideoCodecFrame * frame);
+static gboolean gst_pngenc_set_format (GstVideoEncoder * encoder,
+    GstVideoCodecState * state);
+
+static void gst_pngenc_finalize (GObject * object);
 
 static void
 user_error_fn (png_structp png_ptr, png_const_charp error_msg)
@@ -111,8 +116,10 @@ static void
 gst_pngenc_class_init (GstPngEncClass * klass)
 {
   GObjectClass *gobject_class;
+  GstVideoEncoderClass *venc_class;
 
   gobject_class = (GObjectClass *) klass;
+  venc_class = (GstVideoEncoderClass *) klass;
 
   parent_class = g_type_class_peek_parent (klass);
 
@@ -124,11 +131,6 @@ gst_pngenc_class_init (GstPngEncClass * klass)
           "Send EOS after encoding a frame, useful for snapshots",
           DEFAULT_SNAPSHOT, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
-/*   g_object_class_install_property (gobject_class, ARG_NEWMEDIA, */
-/*       g_param_spec_boolean ("newmedia", "newmedia", */
-/*           "Send new media discontinuity after encoding each frame", */
-/*           DEFAULT_NEWMEDIA, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS)); */
-
   g_object_class_install_property (gobject_class, ARG_COMPRESSION_LEVEL,
       g_param_spec_uint ("compression-level", "compression-level",
           "PNG compression level",
@@ -136,30 +138,26 @@ gst_pngenc_class_init (GstPngEncClass * klass)
           DEFAULT_COMPRESSION_LEVEL,
           G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
+  venc_class->set_format = gst_pngenc_set_format;
+  venc_class->handle_frame = gst_pngenc_handle_frame;
+  gobject_class->finalize = gst_pngenc_finalize;
+
   GST_DEBUG_CATEGORY_INIT (pngenc_debug, "pngenc", 0, "PNG image encoder");
 }
 
 
 static gboolean
-gst_pngenc_setcaps (GstPad * pad, GstCaps * caps)
+gst_pngenc_set_format (GstVideoEncoder * encoder, GstVideoCodecState * state)
 {
   GstPngEnc *pngenc;
-  GstVideoFormat format;
-  int fps_n, fps_d;
-  GstCaps *pcaps;
-  gboolean ret;
-
-  pngenc = GST_PNGENC (gst_pad_get_parent (pad));
+  gboolean ret = TRUE;
+  GstVideoInfo *info;
+  GstVideoCodecState *output_state;
 
-  ret = gst_video_format_parse_caps (caps, &format,
-      &pngenc->width, &pngenc->height);
-  if (G_LIKELY (ret))
-    ret = gst_video_parse_caps_framerate (caps, &fps_n, &fps_d);
-
-  if (G_UNLIKELY (!ret))
-    goto done;
+  pngenc = GST_PNGENC (encoder);
+  info = &state->info;
 
-  switch (format) {
+  switch (GST_VIDEO_INFO_FORMAT (info)) {
     case GST_VIDEO_FORMAT_RGBA:
       pngenc->png_color_type = PNG_COLOR_TYPE_RGBA;
       break;
@@ -167,6 +165,7 @@ gst_pngenc_setcaps (GstPad * pad, GstCaps * caps)
       pngenc->png_color_type = PNG_COLOR_TYPE_RGB;
       break;
     case GST_VIDEO_FORMAT_GRAY8:
+    case GST_VIDEO_FORMAT_GRAY16_BE:
       pngenc->png_color_type = PNG_COLOR_TYPE_GRAY;
       break;
     default:
@@ -174,31 +173,25 @@ gst_pngenc_setcaps (GstPad * pad, GstCaps * caps)
       goto done;
   }
 
-  if (G_UNLIKELY (pngenc->width < 16 || pngenc->width > 1000000 ||
-          pngenc->height < 16 || pngenc->height > 1000000)) {
-    ret = FALSE;
-    goto done;
+  switch (GST_VIDEO_INFO_FORMAT (info)) {
+    case GST_VIDEO_FORMAT_GRAY16_BE:
+      pngenc->depth = 16;
+      break;
+    default:                   /* GST_VIDEO_FORMAT_RGB and GST_VIDEO_FORMAT_GRAY8 */
+      pngenc->depth = 8;
+      break;
   }
 
-  pngenc->stride = gst_video_format_get_row_stride (format, 0, pngenc->width);
-
-  pcaps = gst_caps_new_simple ("image/png",
-      "width", G_TYPE_INT, pngenc->width,
-      "height", G_TYPE_INT, pngenc->height,
-      "framerate", GST_TYPE_FRACTION, fps_n, fps_d, NULL);
+  if (pngenc->input_state)
+    gst_video_codec_state_unref (pngenc->input_state);
+  pngenc->input_state = gst_video_codec_state_ref (state);
 
-  ret = gst_pad_set_caps (pngenc->srcpad, pcaps);
+  output_state =
+      gst_video_encoder_set_output_state (encoder,
+      gst_caps_new_simple ("image/png", NULL), state);
+  gst_video_codec_state_unref (output_state);
 
-  gst_caps_unref (pcaps);
-
-  /* Fall-through. */
 done:
-  if (G_UNLIKELY (!ret)) {
-    pngenc->width = 0;
-    pngenc->height = 0;
-  }
-
-  gst_object_unref (pngenc);
 
   return ret;
 }
@@ -206,33 +199,26 @@ done:
 static void
 gst_pngenc_init (GstPngEnc * pngenc, GstPngEncClass * g_class)
 {
-  /* sinkpad */
-  pngenc->sinkpad = gst_pad_new_from_static_template
-      (&pngenc_sink_template, "sink");
-  gst_pad_set_chain_function (pngenc->sinkpad, gst_pngenc_chain);
-  /*   gst_pad_set_link_function (pngenc->sinkpad, gst_pngenc_sinklink); */
-  /*   gst_pad_set_getcaps_function (pngenc->sinkpad, gst_pngenc_sink_getcaps); */
-  gst_pad_set_setcaps_function (pngenc->sinkpad, gst_pngenc_setcaps);
-  gst_element_add_pad (GST_ELEMENT (pngenc), pngenc->sinkpad);
-
-  /* srcpad */
-  pngenc->srcpad = gst_pad_new_from_static_template
-      (&pngenc_src_template, "src");
-  /*   pngenc->srcpad = gst_pad_new ("src", GST_PAD_SRC); */
-  /*   gst_pad_set_getcaps_function (pngenc->srcpad, gst_pngenc_src_getcaps); */
-  /*   gst_pad_set_setcaps_function (pngenc->srcpad, gst_pngenc_setcaps); */
-  gst_element_add_pad (GST_ELEMENT (pngenc), pngenc->srcpad);
-
   /* init settings */
   pngenc->png_struct_ptr = NULL;
   pngenc->png_info_ptr = NULL;
 
   pngenc->snapshot = DEFAULT_SNAPSHOT;
-/*   pngenc->newmedia = FALSE; */
   pngenc->compression_level = DEFAULT_COMPRESSION_LEVEL;
 }
 
 static void
+gst_pngenc_finalize (GObject * object)
+{
+  GstPngEnc *pngenc = GST_PNGENC (object);
+
+  if (pngenc->input_state)
+    gst_video_codec_state_unref (pngenc->input_state);
+
+  G_OBJECT_CLASS (parent_class)->finalize (object);
+}
+
+static void
 user_flush_data (png_structp png_ptr G_GNUC_UNUSED)
 {
 }
@@ -257,61 +243,32 @@ user_write_data (png_structp png_ptr, png_bytep data, png_uint_32 length)
 }
 
 static GstFlowReturn
-gst_pngenc_chain (GstPad * pad, GstBuffer * buf)
+gst_pngenc_handle_frame (GstVideoEncoder * encoder, GstVideoCodecFrame * frame)
 {
   GstPngEnc *pngenc;
   gint row_index;
   png_byte **row_pointers;
   GstFlowReturn ret = GST_FLOW_OK;
-  GstBuffer *encoded_buf = NULL;
+  GstVideoInfo *info;
 
-  pngenc = GST_PNGENC (gst_pad_get_parent (pad));
+  pngenc = GST_PNGENC (encoder);
+  info = &pngenc->input_state->info;
 
   GST_DEBUG_OBJECT (pngenc, "BEGINNING");
 
-  if (G_UNLIKELY (pngenc->width <= 0 || pngenc->height <= 0)) {
-    ret = GST_FLOW_NOT_NEGOTIATED;
-    goto done;
-  }
-
-  if (G_UNLIKELY (GST_BUFFER_SIZE (buf) < pngenc->height * pngenc->stride)) {
-    gst_buffer_unref (buf);
-    GST_ELEMENT_ERROR (pngenc, STREAM, FORMAT, (NULL),
-        ("Provided input buffer is too small, caps problem?"));
-    ret = GST_FLOW_ERROR;
-    goto done;
-  }
-
   /* initialize png struct stuff */
   pngenc->png_struct_ptr = png_create_write_struct (PNG_LIBPNG_VER_STRING,
       (png_voidp) NULL, user_error_fn, user_warning_fn);
-  if (pngenc->png_struct_ptr == NULL) {
-    gst_buffer_unref (buf);
-    GST_ELEMENT_ERROR (pngenc, LIBRARY, INIT, (NULL),
-        ("Failed to initialize png structure"));
-    ret = GST_FLOW_ERROR;
-    goto done;
-  }
+  if (pngenc->png_struct_ptr == NULL)
+    goto struct_init_fail;
 
   pngenc->png_info_ptr = png_create_info_struct (pngenc->png_struct_ptr);
-  if (!pngenc->png_info_ptr) {
-    gst_buffer_unref (buf);
-    png_destroy_write_struct (&(pngenc->png_struct_ptr), (png_infopp) NULL);
-    GST_ELEMENT_ERROR (pngenc, LIBRARY, INIT, (NULL),
-        ("Failed to initialize the png info structure"));
-    ret = GST_FLOW_ERROR;
-    goto done;
-  }
+  if (!pngenc->png_info_ptr)
+    goto png_info_fail;
 
   /* non-0 return is from a longjmp inside of libpng */
-  if (setjmp (png_jmpbuf (pngenc->png_struct_ptr)) != 0) {
-    gst_buffer_unref (buf);
-    png_destroy_write_struct (&pngenc->png_struct_ptr, &pngenc->png_info_ptr);
-    GST_ELEMENT_ERROR (pngenc, LIBRARY, FAILED, (NULL),
-        ("returning from longjmp"));
-    ret = GST_FLOW_ERROR;
-    goto done;
-  }
+  if (setjmp (png_jmpbuf (pngenc->png_struct_ptr)) != 0)
+    goto longjmp_fail;
 
   png_set_filter (pngenc->png_struct_ptr, 0,
       PNG_FILTER_NONE | PNG_FILTER_VALUE_NONE);
@@ -319,9 +276,9 @@ gst_pngenc_chain (GstPad * pad, GstBuffer * buf)
 
   png_set_IHDR (pngenc->png_struct_ptr,
       pngenc->png_info_ptr,
-      pngenc->width,
-      pngenc->height,
-      8,
+      GST_VIDEO_INFO_WIDTH (info),
+      GST_VIDEO_INFO_HEIGHT (info),
+      pngenc->depth,
       pngenc->png_color_type,
       PNG_INTERLACE_NONE,
       PNG_COMPRESSION_TYPE_DEFAULT, PNG_FILTER_TYPE_DEFAULT);
@@ -329,16 +286,17 @@ gst_pngenc_chain (GstPad * pad, GstBuffer * buf)
   png_set_write_fn (pngenc->png_struct_ptr, pngenc,
       (png_rw_ptr) user_write_data, user_flush_data);
 
-  row_pointers = g_new (png_byte *, pngenc->height);
+  row_pointers = g_new (png_byte *, GST_VIDEO_INFO_HEIGHT (info));
 
-  for (row_index = 0; row_index < pngenc->height; row_index++) {
-    row_pointers[row_index] = GST_BUFFER_DATA (buf) +
-        (row_index * pngenc->stride);
+  for (row_index = 0; row_index < GST_VIDEO_INFO_HEIGHT (info); row_index++) {
+    row_pointers[row_index] = GST_BUFFER_DATA (frame->input_buffer) +
+        (row_index * GST_VIDEO_INFO_COMP_STRIDE (info, 0));
   }
 
   /* allocate the output buffer */
   pngenc->buffer_out =
-      gst_buffer_new_and_alloc (pngenc->height * pngenc->stride);
+      gst_buffer_new_and_alloc (GST_VIDEO_INFO_HEIGHT (info) *
+      GST_VIDEO_INFO_COMP_STRIDE (info, 0));
   pngenc->written = 0;
 
   png_write_info (pngenc->png_struct_ptr, pngenc->png_info_ptr);
@@ -347,38 +305,49 @@ gst_pngenc_chain (GstPad * pad, GstBuffer * buf)
 
   g_free (row_pointers);
 
-  encoded_buf = gst_buffer_create_sub (pngenc->buffer_out, 0, pngenc->written);
-
   png_destroy_info_struct (pngenc->png_struct_ptr, &pngenc->png_info_ptr);
   png_destroy_write_struct (&pngenc->png_struct_ptr, (png_infopp) NULL);
-  gst_buffer_copy_metadata (encoded_buf, buf, GST_BUFFER_COPY_TIMESTAMPS);
-  gst_buffer_unref (buf);
-  gst_buffer_set_caps (encoded_buf, GST_PAD_CAPS (pngenc->srcpad));
 
-  if ((ret = gst_pad_push (pngenc->srcpad, encoded_buf)) != GST_FLOW_OK)
-    goto done;
+  /* Set final size and store */
+  GST_BUFFER_SIZE (pngenc->buffer_out) = pngenc->written;
+  frame->output_buffer = pngenc->buffer_out;
 
-  if (pngenc->snapshot) {
-    GstEvent *event;
+  pngenc->buffer_out = NULL;
 
-    GST_DEBUG_OBJECT (pngenc, "snapshot mode, sending EOS");
-    /* send EOS event, since a frame has been pushed out */
-    event = gst_event_new_eos ();
+  if ((ret = gst_video_encoder_finish_frame (encoder, frame)) != GST_FLOW_OK)
+    goto done;
 
-    gst_pad_push_event (pngenc->srcpad, event);
+  if (pngenc->snapshot)
     ret = GST_FLOW_UNEXPECTED;
-  }
 
 done:
   GST_DEBUG_OBJECT (pngenc, "END, ret:%d", ret);
 
-  if (pngenc->buffer_out != NULL) {
-    gst_buffer_unref (pngenc->buffer_out);
-    pngenc->buffer_out = NULL;
+  return ret;
+
+  /* ERRORS */
+struct_init_fail:
+  {
+    GST_ELEMENT_ERROR (pngenc, LIBRARY, INIT, (NULL),
+        ("Failed to initialize png structure"));
+    return GST_FLOW_ERROR;
   }
 
-  gst_object_unref (pngenc);
-  return ret;
+png_info_fail:
+  {
+    png_destroy_write_struct (&(pngenc->png_struct_ptr), (png_infopp) NULL);
+    GST_ELEMENT_ERROR (pngenc, LIBRARY, INIT, (NULL),
+        ("Failed to initialize the png info structure"));
+    return GST_FLOW_ERROR;
+  }
+
+longjmp_fail:
+  {
+    png_destroy_write_struct (&pngenc->png_struct_ptr, &pngenc->png_info_ptr);
+    GST_ELEMENT_ERROR (pngenc, LIBRARY, FAILED, (NULL),
+        ("returning from longjmp"));
+    return GST_FLOW_ERROR;
+  }
 }
 
 
@@ -394,9 +363,6 @@ gst_pngenc_get_property (GObject * object,
     case ARG_SNAPSHOT:
       g_value_set_boolean (value, pngenc->snapshot);
       break;
-/*     case ARG_NEWMEDIA: */
-/*       g_value_set_boolean (value, pngenc->newmedia); */
-/*       break; */
     case ARG_COMPRESSION_LEVEL:
       g_value_set_uint (value, pngenc->compression_level);
       break;
@@ -419,9 +385,6 @@ gst_pngenc_set_property (GObject * object,
     case ARG_SNAPSHOT:
       pngenc->snapshot = g_value_get_boolean (value);
       break;
-/*     case ARG_NEWMEDIA: */
-/*       pngenc->newmedia = g_value_get_boolean (value); */
-/*       break; */
     case ARG_COMPRESSION_LEVEL:
       pngenc->compression_level = g_value_get_uint (value);
       break;
diff --git a/ext/libpng/gstpngenc.h b/ext/libpng/gstpngenc.h
index 792a7c9..b8150d4 100644
--- a/ext/libpng/gstpngenc.h
+++ b/ext/libpng/gstpngenc.h
@@ -1,5 +1,7 @@
 /* GStreamer
  * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
+ * Copyright (C) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
  *
  * This library is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Library General Public
@@ -22,6 +24,7 @@
 #define __GST_PNGENC_H__
 
 #include <gst/gst.h>
+#include <gst/video/gstvideoencoder.h>
 #include <png.h>
 
 #ifdef __cplusplus
@@ -40,9 +43,9 @@ typedef struct _GstPngEncClass GstPngEncClass;
 
 struct _GstPngEnc
 {
-  GstElement element;
+  GstVideoEncoder parent;
 
-  GstPad *sinkpad, *srcpad;
+  GstVideoCodecState *input_state;
   GstBuffer *buffer_out;
   guint written;
 
@@ -50,9 +53,7 @@ struct _GstPngEnc
   png_infop png_info_ptr;
 
   gint png_color_type;
-  gint width;
-  gint height;
-  gint stride;
+  gint depth;
   guint compression_level;
 
   gboolean snapshot;
@@ -61,7 +62,7 @@ struct _GstPngEnc
 
 struct _GstPngEncClass
 {
-  GstElementClass parent_class;
+  GstVideoEncoderClass parent_class;
 };
 
 GType gst_pngenc_get_type(void);
diff --git a/ext/mikmod/Makefile.am b/ext/mikmod/Makefile.am
new file mode 100644
index 0000000..f71b2b6
--- /dev/null
+++ b/ext/mikmod/Makefile.am
@@ -0,0 +1,11 @@
+plugin_LTLIBRARIES = libgstmikmod.la
+
+libgstmikmod_la_SOURCES = gstmikmod.c drv_gst.c mikmod_reader.c 
+libgstmikmod_la_CFLAGS = $(GST_CFLAGS) $(MIKMOD_CFLAGS)
+libgstmikmod_la_LIBADD = $(GST_LIBS) $(MIKMOD_LIBS)
+libgstmikmod_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS)
+libgstmikmod_la_LIBTOOLFLAGS = --tag=disable-static
+
+noinst_HEADERS = gstmikmod.h 
+
+EXTRA_DIST = README
diff --git a/ext/mikmod/README b/ext/mikmod/README
new file mode 100644
index 0000000..de64921
--- /dev/null
+++ b/ext/mikmod/README
@@ -0,0 +1,86 @@
+Hi,
+
+   This is the gstreamer MikMod plugin. It is able to play the IT, XM, S3M, 
+ MTM, 669, STM, ULT, FAR, MED, AMF, DSM, IMF, GDM, STX, OKT and of course MOD
+ module formats.
+
+  Take a look to : http://mikmod.raphnet.net/
+
+ 
+ Usage : gstreamer-launch filesrc location=foo.mod ! mikmod ! osssink
+     or  gst-player foo.mod
+
+
+Properties :
+
+  musicvolume :
+    Volume of the module. Allowed values range from 0 to 128. The default value is 128. 
+
+  pansep :
+    Stereo channels separation. Allowed values range from 0 (no separation, thus mono sound) 
+    to 128 (full channel separation). The default value is 128. 
+
+  reverb :
+    Amount of sound reverberation. Allowed values range from 0 (no reverberation) to 15 
+    (a rough estimate for chaos...). The default value is 6. 
+
+  sndfxvolume :
+    Volume of the sound effects. Allowed values range from 0 to 128. The default value is 128. 
+
+  volume :
+    Overall sound volume. Allowed values range from 0 to 128. The default value is 96
+
+  interp : 
+    This flag, if set, enables the interpolated mixers. Interpolated mixing gives better 
+    sound but takes a bit more time than standard mixing. If the library is built with the 
+    high quality mixer, interpolated mixing is always enabled, regardless of this flag. The
+    default value is false.
+
+  reverse : 
+    This flag, if set, exchanges the left and right stereo channels. The default value is false.
+
+  surround : 
+    This flag, if set, enables the surround mixers. Since surround mixing works only for stereo 
+    sound, this flag has no effect if the sound playback is in mono. The default value is true.
+
+  16bit : 
+    This flag, if set, selects 16 bit sound mode. This mode yields better sound quality, but needs 
+    twice more mixing time. The default value is true.
+
+  hqmixer :
+    This flag, if set, selects the high-quality software mixer. This mode yields better sound quality,
+    but needs more mixing time. Of course, this flag has no effect if no DMODE_SOFT_xx flag is set.
+    The default value is false.
+
+  soft_music : 
+    This flag, if set, selects software mixing of the module. The default value is true.
+
+  soft_sndfx :
+    This flag, if set, selects software mixing of the sound effects. The default value is true.
+
+  stereo :  
+    This flag, if set, selects stereo sound. The default value is true.
+    
+--
+Apoc    
+
+
+/*  MikMod sound library
+    (c) 1998, 1999, 2000 Miodrag Vallat and others - see file AUTHORS
+    for complete list.
+
+    This library is free software; you can redistribute it and/or modify
+    it under the terms of the GNU Library General Public License as
+    published by the Free Software Foundation; either version 2 of
+    the License, or (at your option) any later version.
+
+    This program is distributed in the hope that it will be useful,
+    but WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+    GNU Library General Public License for more details.
+
+    You should have received a copy of the GNU Library General Public
+    License along with this library; if not, write to the Free Software
+    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+    02111-1307, USA.
+*/
diff --git a/ext/mikmod/drv_gst.c b/ext/mikmod/drv_gst.c
new file mode 100644
index 0000000..2d7b8e6
--- /dev/null
+++ b/ext/mikmod/drv_gst.c
@@ -0,0 +1,105 @@
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include <stdlib.h>
+
+#include "gstmikmod.h"
+
+static int buffer_size;
+static SBYTE *audiobuffer = NULL;
+extern int need_sync;
+
+static BOOL
+mikmod_IsThere (void)
+{
+  return 1;
+}
+
+static BOOL
+mikmod_Init (void)
+{
+  buffer_size = 32768;
+  if (!(audiobuffer = (SBYTE *) g_malloc (buffer_size)))
+    return 1;
+
+  return VC_Init ();
+}
+
+static void
+mikmod_Exit (void)
+{
+  VC_Exit ();
+
+  if (audiobuffer) {
+    g_free (audiobuffer);
+    audiobuffer = NULL;
+  }
+}
+
+
+static void
+mikmod_Update (void)
+{
+  gint length;
+  GstBuffer *outdata;
+
+  length = VC_WriteBytes ((SBYTE *) audiobuffer, buffer_size);
+
+  outdata = gst_buffer_new ();
+
+  GST_BUFFER_DATA (outdata) = g_memdup (audiobuffer, length);
+  GST_BUFFER_SIZE (outdata) = length;
+
+  GST_BUFFER_TIMESTAMP (outdata) = timestamp;
+
+  if (need_sync == 1) {
+    /* FIXME, send a flush event or something */
+    need_sync = 0;
+  }
+  gst_pad_push (srcpad, GST_DATA (outdata));
+
+}
+
+static BOOL
+mikmod_Reset (void)
+{
+  VC_Exit ();
+  return VC_Init ();
+}
+
+
+MDRIVER drv_gst = {
+  NULL,
+  "mikmod",
+  "mikmod output driver v1.0",
+  0, 255,
+#if (LIBMIKMOD_VERSION > 0x030106)
+  "mikmod",
+  NULL,
+#endif
+  mikmod_IsThere,
+  VC_SampleLoad,
+  VC_SampleUnload,
+  VC_SampleSpace,
+  VC_SampleLength,
+  mikmod_Init,
+  mikmod_Exit,
+  mikmod_Reset,
+  VC_SetNumVoices,
+  VC_PlayStart,
+  VC_PlayStop,
+  mikmod_Update,
+  NULL,
+  VC_VoiceSetVolume,
+  VC_VoiceGetVolume,
+  VC_VoiceSetFrequency,
+  VC_VoiceGetFrequency,
+  VC_VoiceSetPanning,
+  VC_VoiceGetPanning,
+  VC_VoicePlay,
+  VC_VoiceStop,
+  VC_VoiceStopped,
+  VC_VoiceGetPosition,
+  VC_VoiceRealVolume
+};
diff --git a/ext/mikmod/gstmikmod.c b/ext/mikmod/gstmikmod.c
new file mode 100644
index 0000000..454cf35
--- /dev/null
+++ b/ext/mikmod/gstmikmod.c
@@ -0,0 +1,554 @@
+/* GStreamer
+ * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+#include "gstmikmod.h"
+
+#include <stdlib.h>
+
+/* Filter signals and args */
+enum
+{
+  /* FILL ME */
+  LAST_SIGNAL
+};
+
+enum
+{
+  ARG_0,
+  ARG_SONGNAME,
+  ARG_MODTYPE,
+  ARG_MUSICVOLUME,
+  ARG_PANSEP,
+  ARG_REVERB,
+  ARG_SNDFXVOLUME,
+  ARG_VOLUME,
+  ARG_INTERP,
+  ARG_REVERSE,
+  ARG_SURROUND,
+  ARG_HQMIXER,
+  ARG_SOFT_MUSIC,
+  ARG_SOFT_SNDFX
+};
+
+MODULE *module;
+MREADER *reader;
+GstPad *srcpad;
+GstClockTime timestamp;
+int need_sync;
+
+static GstStaticPadTemplate mikmod_src_factory = GST_STATIC_PAD_TEMPLATE ("src",
+    GST_PAD_SRC,
+    GST_PAD_ALWAYS,
+    GST_STATIC_CAPS ("audio/x-raw-int, "
+        "endianness = (int) BYTE_ORDER, "
+        "signed = (boolean) TRUE, "
+        "width = (int) 16, "
+        "depth = (int) 16, "
+        "rate = (int) { 8000, 11025, 22050, 44100 }, "
+        "channels = (int) [ 1, 2 ]; "
+        "audio/x-raw-int, "
+        "endianness = (int) BYTE_ORDER, "
+        "signed = (boolean) FALSE, "
+        "width = (int) 8, "
+        "depth = (int) 8, "
+        "rate = (int) { 8000, 11025, 22050, 44100 }, "
+        "channels = (int) [ 1, 2 ]")
+    );
+
+static GstStaticPadTemplate mikmod_sink_factory =
+GST_STATIC_PAD_TEMPLATE ("sink",
+    GST_PAD_SINK,
+    GST_PAD_ALWAYS,
+    GST_STATIC_CAPS ("audio/x-mod")
+    );
+
+static void gst_mikmod_base_init (gpointer g_class);
+static void gst_mikmod_class_init (GstMikModClass * klass);
+static void gst_mikmod_init (GstMikMod * filter);
+static void gst_mikmod_set_property (GObject * object, guint id,
+    const GValue * value, GParamSpec * pspec);
+static void gst_mikmod_get_property (GObject * object, guint id, GValue * value,
+    GParamSpec * pspec);
+static GstPadLinkReturn gst_mikmod_srclink (GstPad * pad, const GstCaps * caps);
+static GstCaps *gst_mikmod_srcfixate (GstPad * pad, const GstCaps * caps);
+static void gst_mikmod_loop (GstElement * element);
+static gboolean gst_mikmod_setup (GstMikMod * mikmod);
+static GstStateChangeReturn gst_mikmod_change_state (GstElement * element,
+    GstStateChange transition);
+
+
+
+static GstElementClass *parent_class = NULL;
+
+GType
+gst_mikmod_get_type (void)
+{
+  static GType mikmod_type = 0;
+
+  if (!mikmod_type) {
+    static const GTypeInfo mikmod_info = {
+      sizeof (GstMikModClass),
+      gst_mikmod_base_init,
+      NULL,
+      (GClassInitFunc) gst_mikmod_class_init,
+      NULL,
+      NULL,
+      sizeof (GstMikMod),
+      0,
+      (GInstanceInitFunc) gst_mikmod_init,
+    };
+
+    mikmod_type =
+        g_type_register_static (GST_TYPE_ELEMENT, "GstMikmod", &mikmod_info, 0);
+  }
+  return mikmod_type;
+}
+
+static void
+gst_mikmod_base_init (gpointer g_class)
+{
+  GstElementClass *element_class = GST_ELEMENT_CLASS (g_class);
+
+  gst_element_class_add_static_pad_template (element_class,
+      &mikmod_src_factory);
+  gst_element_class_add_static_pad_template (element_class,
+      &mikmod_sink_factory);
+  gst_element_class_set_details_simple (element_class, "MikMod audio decoder",
+      "Codec/Decoder/Audio",
+      "Module decoder based on libmikmod", "Jeremy SIMON <jsimon13@yahoo.fr>");
+}
+
+static void
+gst_mikmod_class_init (GstMikModClass * klass)
+{
+  GObjectClass *gobject_class;
+  GstElementClass *gstelement_class;
+
+  gobject_class = (GObjectClass *) klass;
+  gstelement_class = (GstElementClass *) klass;
+
+  parent_class = g_type_class_peek_parent (klass);
+
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_SONGNAME,
+      g_param_spec_string ("songname", "songname", "songname",
+          NULL, G_PARAM_READABLE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_MODTYPE,
+      g_param_spec_string ("modtype", "modtype", "modtype",
+          NULL, G_PARAM_READABLE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_MUSICVOLUME,
+      g_param_spec_int ("musicvolume", "musivolume", "musicvolume",
+          0, 128, 128, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_PANSEP,
+      g_param_spec_int ("pansep", "pansep", "pansep",
+          0, 128, 128, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_REVERB,
+      g_param_spec_int ("reverb", "reverb", "reverb",
+          0, 15, 0, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_SNDFXVOLUME,
+      g_param_spec_int ("sndfxvolume", "sndfxvolume", "sndfxvolume",
+          0, 128, 128, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_VOLUME,
+      g_param_spec_int ("volume", "volume", "volume",
+          0, 128, 96, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_INTERP,
+      g_param_spec_boolean ("interp", "interp", "interp",
+          FALSE, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_REVERSE,
+      g_param_spec_boolean ("reverse", "reverse", "reverse",
+          FALSE, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_SURROUND,
+      g_param_spec_boolean ("surround", "surround", "surround",
+          TRUE, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_HQMIXER,
+      g_param_spec_boolean ("hqmixer", "hqmixer", "hqmixer",
+          FALSE, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_SOFT_MUSIC,
+      g_param_spec_boolean ("soft-music", "soft music", "soft music",
+          TRUE, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_SOFT_SNDFX,
+      g_param_spec_boolean ("soft-sndfx", "soft sndfx", "soft sndfx",
+          TRUE, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
+
+  gobject_class->set_property = gst_mikmod_set_property;
+  gobject_class->get_property = gst_mikmod_get_property;
+
+  gstelement_class->change_state = gst_mikmod_change_state;
+}
+
+
+static void
+gst_mikmod_init (GstMikMod * filter)
+{
+  filter->sinkpad =
+      gst_pad_new_from_static_template (&mikmod_sink_factory, "sink");
+  filter->srcpad =
+      gst_pad_new_from_static_template (&mikmod_src_factory, "src");
+
+  gst_element_add_pad (GST_ELEMENT (filter), filter->sinkpad);
+  gst_element_add_pad (GST_ELEMENT (filter), filter->srcpad);
+  gst_pad_set_link_function (filter->srcpad, gst_mikmod_srclink);
+  gst_pad_set_fixate_function (filter->srcpad, gst_mikmod_srcfixate);
+
+  gst_element_set_loop_function (GST_ELEMENT (filter), gst_mikmod_loop);
+
+  filter->Buffer = NULL;
+
+  filter->stereo = TRUE;
+  filter->surround = TRUE;
+  filter->_16bit = TRUE;
+  filter->soft_music = TRUE;
+  filter->soft_sndfx = TRUE;
+  filter->mixfreq = 44100;
+  filter->reverb = 0;
+  filter->pansep = 128;
+  filter->musicvolume = 128;
+  filter->volume = 96;
+  filter->sndfxvolume = 128;
+  filter->songname = NULL;
+  filter->modtype = NULL;
+
+  filter->initialized = FALSE;
+}
+
+static GstCaps *
+gst_mikmod_srcfixate (GstPad * pad, const GstCaps * caps)
+{
+  GstCaps *ret;
+  GstStructure *structure;
+
+  /* FIXME: select est caps here */
+  if (gst_caps_get_size (caps) > 1)
+    return NULL;
+
+  ret = gst_caps_copy (caps);
+  structure = gst_caps_get_structure (ret, 0);
+
+  if (gst_structure_fixate_field_nearest_int (structure, "channels", 2))
+    return ret;
+  if (gst_structure_fixate_field_nearest_int (structure, "rate", 44100))
+    return ret;
+
+  gst_caps_free (ret);
+  return NULL;
+}
+
+static GstPadLinkReturn
+gst_mikmod_srclink (GstPad * pad, const GstCaps * caps)
+{
+  GstMikMod *filter;
+  GstStructure *structure;
+  gint depth;
+  gint channels;
+  gboolean result;
+
+  filter = GST_MIKMOD (gst_pad_get_parent (pad));
+
+  structure = gst_caps_get_structure (caps, 0);
+
+  gst_structure_get_int (structure, "depth", &depth);
+  filter->_16bit = (depth == 16);
+  gst_structure_get_int (structure, "channels", &channels);
+  filter->stereo = (channels == 2);
+  gst_structure_get_int (structure, "rate", &filter->mixfreq);
+
+  result = gst_mikmod_setup (filter);
+  gst_object_unref (filter);
+
+  if (result) {
+    return GST_PAD_LINK_OK;
+  } else {
+    return GST_PAD_LINK_REFUSED;
+  }
+}
+
+static void
+gst_mikmod_loop (GstElement * element)
+{
+  GstMikMod *mikmod;
+  GstBuffer *buffer_in;
+
+  g_return_if_fail (element != NULL);
+  g_return_if_fail (GST_IS_MIKMOD (element));
+
+  mikmod = GST_MIKMOD (element);
+  srcpad = mikmod->srcpad;
+  mikmod->Buffer = NULL;
+
+  if (!mikmod->initialized) {
+    while ((buffer_in = GST_BUFFER (gst_pad_pull (mikmod->sinkpad)))) {
+      if (GST_IS_EVENT (buffer_in)) {
+        GstEvent *event = GST_EVENT (buffer_in);
+
+        if (GST_EVENT_TYPE (event) == GST_EVENT_EOS)
+          break;
+      } else {
+        if (mikmod->Buffer) {
+          GstBuffer *merge;
+
+          merge = gst_buffer_merge (mikmod->Buffer, buffer_in);
+          gst_buffer_unref (buffer_in);
+          gst_buffer_unref (mikmod->Buffer);
+          mikmod->Buffer = merge;
+        } else {
+          mikmod->Buffer = buffer_in;
+        }
+      }
+    }
+
+    if (!GST_PAD_CAPS (mikmod->srcpad)) {
+      if (GST_PAD_LINK_SUCCESSFUL (gst_pad_renegotiate (mikmod->srcpad))) {
+        GST_ELEMENT_ERROR (mikmod, CORE, NEGOTIATION, (NULL), (NULL));
+        return;
+      }
+    }
+
+    MikMod_RegisterDriver (&drv_gst);
+    MikMod_RegisterAllLoaders ();
+
+    MikMod_Init ("");
+    reader = GST_READER_new (mikmod);
+    module = Player_LoadGeneric (reader, 64, 0);
+
+    gst_buffer_unref (mikmod->Buffer);
+
+    if (!Player_Active ())
+      Player_Start (module);
+
+    mikmod->initialized = TRUE;
+  }
+
+  if (Player_Active ()) {
+    timestamp = (module->sngtime / 1024.0) * GST_SECOND;
+    drv_gst.Update ();
+  } else {
+    gst_element_set_eos (GST_ELEMENT (mikmod));
+    gst_pad_push (mikmod->srcpad, GST_DATA (gst_event_new (GST_EVENT_EOS)));
+  }
+}
+
+
+static gboolean
+gst_mikmod_setup (GstMikMod * mikmod)
+{
+  md_musicvolume = mikmod->musicvolume;
+  md_pansep = mikmod->pansep;
+  md_reverb = mikmod->reverb;
+  md_sndfxvolume = mikmod->sndfxvolume;
+  md_volume = mikmod->volume;
+  md_mixfreq = mikmod->mixfreq;
+
+  md_mode = 0;
+
+  if (mikmod->interp)
+    md_mode = md_mode | DMODE_INTERP;
+
+  if (mikmod->reverse)
+    md_mode = md_mode | DMODE_REVERSE;
+
+  if (mikmod->surround)
+    md_mode = md_mode | DMODE_SURROUND;
+
+  if (mikmod->_16bit)
+    md_mode = md_mode | DMODE_16BITS;
+
+  if (mikmod->hqmixer)
+    md_mode = md_mode | DMODE_HQMIXER;
+
+  if (mikmod->soft_music)
+    md_mode = md_mode | DMODE_SOFT_MUSIC;
+
+  if (mikmod->soft_sndfx)
+    md_mode = md_mode | DMODE_SOFT_SNDFX;
+
+  if (mikmod->stereo)
+    md_mode = md_mode | DMODE_STEREO;
+
+  return TRUE;
+}
+
+
+static GstStateChangeReturn
+gst_mikmod_change_state (GstElement * element, GstStateChange transition)
+{
+  GstMikMod *mikmod;
+
+  g_return_val_if_fail (GST_IS_MIKMOD (element), GST_STATE_CHANGE_FAILURE);
+
+  mikmod = GST_MIKMOD (element);
+
+  GST_DEBUG ("state pending %d", GST_STATE_PENDING (element));
+
+  if (GST_STATE_PENDING (element) == GST_STATE_READY) {
+    gst_mikmod_setup (mikmod);
+
+    if (Player_Active ()) {
+      Player_TogglePause ();
+      Player_SetPosition (0);
+    }
+    mikmod->initialized = FALSE;
+  }
+
+  if (GST_STATE_PENDING (element) == GST_STATE_PLAYING) {
+    if (Player_Active () && Player_Paused ())
+      Player_TogglePause ();
+    else if (!Player_Active ())
+      Player_Start (module);
+
+  }
+
+  if (GST_STATE_PENDING (element) == GST_STATE_PAUSED)
+    if (Player_Active () && !Player_Paused ())
+      Player_TogglePause ();
+
+  if (GST_STATE_PENDING (element) == GST_STATE_NULL)
+    MikMod_Exit ();
+
+
+  if (GST_ELEMENT_CLASS (parent_class)->change_state)
+    return GST_ELEMENT_CLASS (parent_class)->change_state (element, transition);
+
+  return GST_STATE_CHANGE_SUCCESS;
+}
+
+
+
+static void
+gst_mikmod_set_property (GObject * object, guint id, const GValue * value,
+    GParamSpec * pspec)
+{
+  GstMikMod *filter;
+
+  g_return_if_fail (GST_IS_MIKMOD (object));
+  filter = GST_MIKMOD (object);
+
+  switch (id) {
+    case ARG_SONGNAME:
+      g_free (filter->songname);
+      filter->songname = g_strdup (g_value_get_string (value));
+      break;
+    case ARG_MODTYPE:
+      g_free (filter->modtype);
+      filter->modtype = g_strdup (g_value_get_string (value));
+      break;
+    case ARG_MUSICVOLUME:
+      filter->musicvolume = g_value_get_int (value);
+      break;
+    case ARG_PANSEP:
+      filter->pansep = g_value_get_int (value);
+      break;
+    case ARG_REVERB:
+      filter->reverb = g_value_get_int (value);
+      break;
+    case ARG_SNDFXVOLUME:
+      filter->sndfxvolume = g_value_get_int (value);
+      break;
+    case ARG_VOLUME:
+      filter->volume = g_value_get_int (value);
+      break;
+    case ARG_INTERP:
+      filter->interp = g_value_get_boolean (value);
+      break;
+    case ARG_REVERSE:
+      filter->reverse = g_value_get_boolean (value);
+      break;
+    case ARG_SURROUND:
+      filter->surround = g_value_get_boolean (value);
+      break;
+    case ARG_HQMIXER:
+      filter->hqmixer = g_value_get_boolean (value);
+      break;
+    case ARG_SOFT_MUSIC:
+      filter->soft_music = g_value_get_boolean (value);
+      break;
+    case ARG_SOFT_SNDFX:
+      filter->soft_sndfx = g_value_get_boolean (value);
+      break;
+    default:
+      break;
+  }
+}
+
+static void
+gst_mikmod_get_property (GObject * object, guint id, GValue * value,
+    GParamSpec * pspec)
+{
+  GstMikMod *filter;
+
+  g_return_if_fail (GST_IS_MIKMOD (object));
+  filter = GST_MIKMOD (object);
+
+  switch (id) {
+    case ARG_MUSICVOLUME:
+      g_value_set_int (value, filter->musicvolume);
+      break;
+    case ARG_PANSEP:
+      g_value_set_int (value, filter->pansep);
+      break;
+    case ARG_REVERB:
+      g_value_set_int (value, filter->reverb);
+      break;
+    case ARG_SNDFXVOLUME:
+      g_value_set_int (value, filter->sndfxvolume);
+      break;
+    case ARG_VOLUME:
+      g_value_set_int (value, filter->volume);
+      break;
+    case ARG_INTERP:
+      g_value_set_boolean (value, filter->interp);
+      break;
+    case ARG_REVERSE:
+      g_value_set_boolean (value, filter->reverse);
+      break;
+    case ARG_SURROUND:
+      g_value_set_boolean (value, filter->surround);
+      break;
+    case ARG_HQMIXER:
+      g_value_set_boolean (value, filter->hqmixer);
+      break;
+    case ARG_SOFT_MUSIC:
+      g_value_set_boolean (value, filter->soft_music);
+      break;
+    case ARG_SOFT_SNDFX:
+      g_value_set_boolean (value, filter->soft_sndfx);
+      break;
+    default:
+      break;
+  }
+}
+
+static gboolean
+plugin_init (GstPlugin * plugin)
+{
+  if (!gst_element_register (plugin, "mikmod", GST_RANK_SECONDARY,
+          GST_TYPE_MIKMOD))
+    return FALSE;
+
+  return TRUE;
+}
+
+GST_PLUGIN_DEFINE (GST_VERSION_MAJOR,
+    GST_VERSION_MINOR,
+    "mikmod",
+    "Mikmod plugin library",
+    plugin_init, VERSION, "LGPL", GST_PACKAGE_NAME, GST_PACKAGE_ORIGIN)
diff --git a/ext/mikmod/gstmikmod.h b/ext/mikmod/gstmikmod.h
new file mode 100644
index 0000000..939cb03
--- /dev/null
+++ b/ext/mikmod/gstmikmod.h
@@ -0,0 +1,109 @@
+/* GStreamer
+ * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+
+#ifndef __GST_MIKMOD_H__
+#define __GST_MIKMOD_H__
+
+#include <mikmod.h>
+#include <gst/gst.h>
+
+#ifdef __cplusplus
+extern "C" {
+#endif /* __cplusplus */
+
+
+#define GST_TYPE_MIKMOD \
+  (gst_mikmod_get_type())
+  
+#define GST_MIKMOD(obj) \
+  (G_TYPE_CHECK_INSTANCE_CAST((obj),GST_TYPE_MIKMOD,GstMikMod))
+#define GST_MIKMOD_CLASS(klass) \
+  (G_TYPE_CHECK_CLASS_CAST((klass),GST_TYPE_MIKMOD,GstMikModClass))
+#define GST_MIKMOD_GET_CLASS(obj) \
+  (G_TYPE_INSTANCE_GET_CLASS((obj),GST_TYPE_MIKMOD,GstMikModClass))
+#define GST_IS_MIKMOD(obj) \
+  (G_TYPE_CHECK_INSTANCE_TYPE((obj),GST_TYPE_MIKMOD))
+#define GST_IS_MIKMOD_CLASS(klass) \
+  (G_TYPE_CHECK_CLASS_TYPE((klass),GST_TYPE_MIKMOD))
+  
+struct _GstMikMod {
+  GstElement element;
+  GstPad *sinkpad, *srcpad;
+  GstBuffer *Buffer;
+
+  gchar *songname;
+  gchar *modtype;
+  gint musicvolume;
+  gint pansep;
+  gint reverb;
+  gint sndfxvolume;
+  gint volume;
+  gint mixfreq;
+  gint mode;
+  gboolean interp;
+  gboolean reverse;
+  gboolean surround;
+  gboolean _16bit;
+  gboolean hqmixer;
+  gboolean soft_music;
+  gboolean soft_sndfx;
+  gboolean stereo;
+
+  gboolean initialized;
+};
+
+struct _GstMikModClass {
+  GstElementClass parent_class;
+};
+
+typedef struct _GstMikMod GstMikMod;
+typedef struct _GstMikModClass GstMikModClass;
+
+extern MODULE *module;
+extern MREADER *reader;
+extern GstPad *srcpad;
+extern GstClockTime timestamp;
+extern int need_sync;
+
+GType gst_mikmod_get_type(void);
+
+/* symbols for mikmod_reader.h */
+struct _GST_READER
+{
+  MREADER core;
+  GstMikMod *mik;
+  guint64 offset;
+  gshort  eof;
+};
+
+
+typedef struct _GST_READER GST_READER;
+
+
+MREADER *GST_READER_new( GstMikMod *mik );
+
+/* symbols for drv_gst.c */
+extern MDRIVER drv_gst;
+
+#ifdef __cplusplus
+}
+#endif /* __cplusplus */
+
+#endif /* __GST_MIKMOD_H__ */
diff --git a/ext/mikmod/mikmod_reader.c b/ext/mikmod/mikmod_reader.c
new file mode 100644
index 0000000..f8e83de
--- /dev/null
+++ b/ext/mikmod/mikmod_reader.c
@@ -0,0 +1,113 @@
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include <unistd.h>
+#include <string.h>
+
+#include "gstmikmod.h"
+
+extern int need_sync;
+
+static BOOL GST_READER_Eof (MREADER * reader);
+static BOOL GST_READER_Read (MREADER * reader, void *ptr, size_t size);
+static int GST_READER_Get (MREADER * reader);
+static BOOL GST_READER_Seek (MREADER * reader, long offset, int whence);
+static long GST_READER_Tell (MREADER * reader);
+
+
+static BOOL
+GST_READER_Eof (MREADER * reader)
+{
+  GST_READER *gst_reader;
+
+  gst_reader = (GST_READER *) reader;
+
+  return gst_reader->eof;
+}
+
+
+static BOOL
+GST_READER_Read (MREADER * reader, void *ptr, size_t size)
+{
+  GST_READER *gst_reader;
+
+  gst_reader = (GST_READER *) reader;
+
+  memcpy (ptr, GST_BUFFER_DATA (gst_reader->mik->Buffer) + gst_reader->offset,
+      size);
+  gst_reader->offset = gst_reader->offset + size;
+
+  return 1;
+}
+
+
+static int
+GST_READER_Get (MREADER * reader)
+{
+  GST_READER *gst_reader;
+  int res;
+
+  gst_reader = (GST_READER *) reader;
+
+  res = *(GST_BUFFER_DATA (gst_reader->mik->Buffer) + gst_reader->offset);
+  gst_reader->offset += 1;
+
+  return res;
+}
+
+
+static BOOL
+GST_READER_Seek (MREADER * reader, long offset, int whence)
+{
+  GST_READER *gst_reader;
+
+  gst_reader = (GST_READER *) reader;
+
+  if (whence == SEEK_SET)
+    gst_reader->offset = offset;
+  else
+    gst_reader->offset += offset;
+
+  return 1;
+}
+
+
+static long
+GST_READER_Tell (MREADER * reader)
+{
+  GST_READER *gst_reader;
+
+  gst_reader = (GST_READER *) reader;
+
+  return gst_reader->offset;
+}
+
+
+MREADER *
+GST_READER_new (GstMikMod * mik)
+{
+  GST_READER *gst_reader;
+
+  gst_reader = (GST_READER *) g_malloc (sizeof (GST_READER));
+  gst_reader->offset = 0;
+  gst_reader->eof = 0;
+  gst_reader->mik = mik;
+  if (gst_reader) {
+    gst_reader->core.Eof = &GST_READER_Eof;
+    gst_reader->core.Read = &GST_READER_Read;
+    gst_reader->core.Get = &GST_READER_Get;
+    gst_reader->core.Seek = &GST_READER_Seek;
+    gst_reader->core.Tell = &GST_READER_Tell;
+  }
+
+  return (MREADER *) gst_reader;
+}
+
+
+void
+GST_READER_free (MREADER * reader)
+{
+  if (reader)
+    g_free (reader);
+}
diff --git a/ext/mikmod/mikmod_types.c b/ext/mikmod/mikmod_types.c
new file mode 100644
index 0000000..27b2cff
--- /dev/null
+++ b/ext/mikmod/mikmod_types.c
@@ -0,0 +1,238 @@
+/* GStreamer
+ * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include <gst/gst.h>
+#include "mikmod_types.h"
+#include <string.h>             /* memcmp */
+#include <ctype.h>              /* isdigit */
+
+#define MODULEHEADERSIZE 0x438
+
+
+gboolean
+MOD_CheckType (GstBuffer * buf)
+{
+  gchar *data;
+
+  data = GST_BUFFER_DATA (buf) + MODULEHEADERSIZE;
+
+  /* Protracker and variants */
+  if ((!memcmp (data, "M.K.", 4)) || (!memcmp (data, "M!K!", 4)))
+    return TRUE;
+
+  /* Star Tracker */
+  if (((!memcmp (data, "FLT", 3)) || (!memcmp (data, "EXO", 3)))
+      && (isdigit (data[3])))
+    return TRUE;
+
+  /* Oktalyzer (Amiga) */
+  if (!memcmp (data, "OKTA", 4))
+    return TRUE;
+
+  /* Oktalyser (Atari) */
+  if (!memcmp (data, "CD81", 4))
+    return TRUE;
+
+  /* Fasttracker */
+  if ((!memcmp (data + 1, "CHN", 3)) && (isdigit (data[0])))
+    return TRUE;
+
+  /* Fasttracker or Taketracker */
+  if (((!memcmp (data + 2, "CH", 2)) || (!memcmp (data + 2, "CN", 2)))
+      && (isdigit (data[0])) && (isdigit (data[1])))
+    return TRUE;
+
+  return FALSE;
+}
+
+gboolean
+Mod_669_CheckType (GstBuffer * buf)
+{
+  gchar *data;
+
+  data = GST_BUFFER_DATA (buf);
+
+  if (!memcmp (data, "if", 2) || !memcmp (data, "JN", 2))
+    return TRUE;
+
+  return FALSE;
+}
+
+gboolean
+Amf_CheckType (GstBuffer * buf)
+{
+  gchar *data;
+
+  data = GST_BUFFER_DATA (buf);
+
+  if (memcmp (data, "AMF", 3))
+    return FALSE;
+
+  data = GST_BUFFER_DATA (buf) + 3;
+
+  if (((gint) * data >= 10) && ((gint) * data <= 14))
+    return TRUE;
+
+  return FALSE;
+}
+
+gboolean
+Dsm_CheckType (GstBuffer * buf)
+{
+  gchar *data;
+
+  data = GST_BUFFER_DATA (buf);
+
+  if (!memcmp (data, "RIFF", 4) && !memcmp (data + 8, "DSMF", 4))
+    return TRUE;
+
+  return FALSE;
+}
+
+gboolean
+Fam_CheckType (GstBuffer * buf)
+{
+  gchar *data;
+  static unsigned char FARSIG[4 + 3] = { 'F', 'A', 'R', 0xfe, 13, 10, 26 };
+
+  data = GST_BUFFER_DATA (buf);
+
+  if ((memcmp (data, FARSIG, 4)) || (memcmp (data + 44, FARSIG + 4, 3)))
+    return FALSE;
+
+  return 1;
+}
+
+gboolean
+Gdm_CheckType (GstBuffer * buf)
+{
+  gchar *data;
+
+  data = GST_BUFFER_DATA (buf);
+
+  if (!memcmp (data, "GDM\xfe", 4) && !memcmp (data + 71, "GMFS", 4))
+    return TRUE;
+
+  return FALSE;
+}
+
+gboolean
+Imf_CheckType (GstBuffer * buf)
+{
+  gchar *data;
+
+  data = GST_BUFFER_DATA (buf) + 0x3c;
+
+  if (!memcmp (data, "IM10", 4))
+    return TRUE;
+
+  return FALSE;
+}
+
+gboolean
+It_CheckType (GstBuffer * buf)
+{
+  gchar *data;
+
+  data = GST_BUFFER_DATA (buf);
+
+  if (!memcmp (data, "IMPM", 4))
+    return TRUE;
+
+  return FALSE;
+}
+
+gboolean
+M15_CheckType (GstBuffer * buf)
+{
+  /* FIXME: M15 CheckType to do */
+  return FALSE;
+}
+
+gboolean
+Med_CheckType (GstBuffer * buf)
+{
+  gchar *data;
+
+  data = GST_BUFFER_DATA (buf);
+
+  if ((!memcmp (data, "MMD0", 4)) || (memcmp (data, "MMD1", 4)))
+    return TRUE;
+
+  return FALSE;
+}
+
+gboolean
+Mtm_CheckType (GstBuffer * buf)
+{
+  gchar *data;
+
+  data = GST_BUFFER_DATA (buf);
+
+  if (!memcmp (data, "MTM", 3))
+    return TRUE;
+
+  return FALSE;
+}
+
+gboolean
+Okt_CheckType (GstBuffer * buf)
+{
+  gchar *data;
+
+  data = GST_BUFFER_DATA (buf);
+
+  if (!memcmp (data, "OKTSONG", 8))
+    return TRUE;
+
+  return FALSE;
+}
+
+gboolean
+S3m_CheckType (GstBuffer * buf)
+{
+  gchar *data;
+
+  data = GST_BUFFER_DATA (buf) + 0x2c;
+
+  if (!memcmp (data, "SCRM", 4))
+    return TRUE;
+
+  return FALSE;
+}
+
+gboolean
+Xm_CheckType (GstBuffer * buf)
+{
+  gchar *data;
+
+  data = GST_BUFFER_DATA (buf);
+
+  if (memcmp (data, "Extended Module: ", 17))
+    return FALSE;
+
+  if (data[37] == 0x1a)
+    return TRUE;
+
+  return FALSE;
+}
diff --git a/ext/mikmod/mikmod_types.h b/ext/mikmod/mikmod_types.h
new file mode 100644
index 0000000..c431faf
--- /dev/null
+++ b/ext/mikmod/mikmod_types.h
@@ -0,0 +1,44 @@
+/* GStreamer
+ * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+#ifndef __MIKMOD_TYPES_H__
+#define __MIKMOD_TYPES_H__
+
+#ifdef __cplusplus
+extern "C" {
+#endif /* __cplusplus */
+
+gboolean MOD_CheckType (GstBuffer *buf);
+gboolean Mod_669_CheckType (GstBuffer *buf);
+gboolean Amf_CheckType (GstBuffer *buf);
+gboolean Dsm_CheckType (GstBuffer *buf);
+gboolean Fam_CheckType (GstBuffer *buf);
+gboolean Gdm_CheckType (GstBuffer *buf);
+gboolean Imf_CheckType (GstBuffer *buf);
+gboolean It_CheckType (GstBuffer *buf);
+gboolean M15_CheckType (GstBuffer *buf);
+gboolean Mtm_CheckType (GstBuffer *buf);
+gboolean Okt_CheckType (GstBuffer *buf);
+gboolean S3m_CheckType (GstBuffer *buf);
+gboolean Xm_CheckType (GstBuffer *buf);
+
+#ifdef __cplusplus
+}
+#endif /* __cplusplus */
+
+#endif /* __MIKMOD_TYPES_H__ */
diff --git a/ext/pulse/Makefile.in b/ext/pulse/Makefile.in
index 5bdbb98..d333e28 100644
--- a/ext/pulse/Makefile.in
+++ b/ext/pulse/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/pulse
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -123,10 +139,23 @@ libgstpulse_la_OBJECTS = $(am_libgstpulse_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstpulse_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstpulse_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstpulse_la_CFLAGS) $(CFLAGS) \
 	$(libgstpulse_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -139,22 +168,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstpulse_la_SOURCES)
 DIST_SOURCES = $(libgstpulse_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -214,6 +244,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -262,8 +293,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -344,7 +377,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -404,6 +437,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -477,7 +511,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -545,7 +583,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -553,6 +590,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -568,12 +607,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstpulse.la: $(libgstpulse_la_OBJECTS) $(libgstpulse_la_DEPENDENCIES) $(EXTRA_libgstpulse_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstpulse_la_LINK) -rpath $(plugindir) $(libgstpulse_la_OBJECTS) $(libgstpulse_la_LIBADD) $(LIBS)
 
@@ -732,6 +773,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -876,18 +931,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/pulse/pulseaudiosink.c b/ext/pulse/pulseaudiosink.c
index cd9f7d9..547560a 100644
--- a/ext/pulse/pulseaudiosink.c
+++ b/ext/pulse/pulseaudiosink.c
@@ -279,7 +279,9 @@ param_spec_copy (GParamSpec * spec)
 
   g_warning ("Unknown param type %ld for '%s'",
       (long) G_PARAM_SPEC_TYPE (spec), name);
-  g_assert_not_reached ();
+
+  /* Make compiler happy */
+  return NULL;
 }
 
 static void
@@ -642,7 +644,7 @@ static void
 proxypad_blocked_cb (GstPad * pad, gboolean blocked, gpointer data)
 {
   GstPulseAudioSink *pbin = GST_PULSE_AUDIO_SINK (data);
-  GstCaps *caps;
+  GstCaps *caps = NULL;
   GstPad *sinkpad = NULL;
 
   if (!blocked) {
@@ -674,8 +676,6 @@ proxypad_blocked_cb (GstPad * pad, gboolean blocked, gpointer data)
       } else
         GST_DEBUG_OBJECT (pbin, "Doing nothing");
 
-      gst_caps_unref (caps);
-      gst_object_unref (sinkpad);
       goto done;
     }
     /* pulsesink doesn't accept the incoming caps, so add a decodebin
@@ -701,6 +701,11 @@ done:
   gst_pad_set_blocked_async_full (pad, FALSE, proxypad_blocked_cb,
       gst_object_ref (pbin), (GDestroyNotify) gst_object_unref);
 
+  if (sinkpad)
+    gst_object_unref (sinkpad);
+  if (caps)
+    gst_caps_unref (caps);
+
   GST_PULSE_AUDIO_SINK_UNLOCK (pbin);
 }
 
diff --git a/ext/pulse/pulseprobe.c b/ext/pulse/pulseprobe.c
index 6ebbfb2..8024b5f 100644
--- a/ext/pulse/pulseprobe.c
+++ b/ext/pulse/pulseprobe.c
@@ -21,6 +21,10 @@
  *  USA.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
diff --git a/ext/pulse/pulsesink.c b/ext/pulse/pulsesink.c
index 11e9c89..3da6231 100644
--- a/ext/pulse/pulsesink.c
+++ b/ext/pulse/pulsesink.c
@@ -417,7 +417,7 @@ gst_pulsering_context_subscribe_cb (pa_context * c,
     GstPulseRingBuffer *pbuf = (GstPulseRingBuffer *) walk->data;
     psink = GST_PULSESINK_CAST (GST_OBJECT_PARENT (pbuf));
 
-    GST_LOG_OBJECT (psink, "type %d, idx %u", t, idx);
+    GST_LOG_OBJECT (psink, "type %04x, idx %u", t, idx);
 
     if (!pbuf->stream)
       continue;
@@ -929,8 +929,12 @@ gst_pulseringbuffer_acquire (GstRingBuffer * buf, GstRingBufferSpec * spec)
   flags = PA_STREAM_INTERPOLATE_TIMING | PA_STREAM_AUTO_TIMING_UPDATE |
       PA_STREAM_ADJUST_LATENCY | PA_STREAM_START_CORKED;
 
-  if (psink->mute_set && psink->mute)
-    flags |= PA_STREAM_START_MUTED;
+  if (psink->mute_set) {
+    if (psink->mute)
+      flags |= PA_STREAM_START_MUTED;
+    else
+      flags |= PA_STREAM_START_UNMUTED;
+  }
 
   /* we always start corked (see flags above) */
   pbuf->corked = TRUE;
@@ -2167,6 +2171,8 @@ out:
     pa_stream_unref (stream);
   }
 
+  gst_caps_replace (&spec.caps, NULL);
+
   pa_threaded_mainloop_unlock (mainloop);
 
 done:
diff --git a/ext/pulse/pulsesrc.c b/ext/pulse/pulsesrc.c
index 12e5282..371eb2b 100644
--- a/ext/pulse/pulsesrc.c
+++ b/ext/pulse/pulsesrc.c
@@ -111,6 +111,8 @@ static GstStateChangeReturn gst_pulsesrc_change_state (GstElement *
 
 static void gst_pulsesrc_init_interfaces (GType type);
 
+static GstClockTime gst_pulsesrc_get_time (GstClock * clock, GstPulseSrc * src);
+
 #if (G_BYTE_ORDER == G_LITTLE_ENDIAN)
 # define ENDIANNESS   "LITTLE_ENDIAN, BIG_ENDIAN"
 #else
@@ -398,6 +400,14 @@ gst_pulsesrc_init (GstPulseSrc * pulsesrc, GstPulseSrcClass * klass)
   /* this should be the default but it isn't yet */
   gst_base_audio_src_set_slave_method (GST_BASE_AUDIO_SRC (pulsesrc),
       GST_BASE_AUDIO_SRC_SLAVE_SKEW);
+
+  /* override with a custom clock */
+  if (GST_BASE_AUDIO_SRC (pulsesrc)->clock)
+    gst_object_unref (GST_BASE_AUDIO_SRC (pulsesrc)->clock);
+
+  GST_BASE_AUDIO_SRC (pulsesrc)->clock =
+      gst_audio_clock_new ("GstPulseSrcClock",
+      (GstAudioClockGetTimeFunc) gst_pulsesrc_get_time, pulsesrc);
 }
 
 static void
@@ -1108,9 +1118,6 @@ gst_pulsesrc_read (GstAudioSrc * asrc, gpointer data, guint length)
   GstPulseSrc *pulsesrc = GST_PULSESRC_CAST (asrc);
   size_t sum = 0;
 
-  pa_threaded_mainloop_lock (pulsesrc->mainloop);
-  pulsesrc->in_read = TRUE;
-
 #ifdef HAVE_PULSE_1_0
   if (g_atomic_int_compare_and_exchange (&pulsesrc->notify, 1, 0)) {
     g_object_notify (G_OBJECT (pulsesrc), "volume");
@@ -1118,6 +1125,9 @@ gst_pulsesrc_read (GstAudioSrc * asrc, gpointer data, guint length)
   }
 #endif
 
+  pa_threaded_mainloop_lock (pulsesrc->mainloop);
+  pulsesrc->in_read = TRUE;
+
   if (pulsesrc->paused)
     goto was_paused;
 
@@ -1421,6 +1431,7 @@ gst_pulsesrc_prepare (GstAudioSrc * asrc, GstRingBufferSpec * spec)
 #ifdef HAVE_PULSE_1_0
   pa_operation *o;
 #endif
+  GstAudioClock *clock;
 
   pa_threaded_mainloop_lock (pulsesrc->mainloop);
 
@@ -1428,7 +1439,7 @@ gst_pulsesrc_prepare (GstAudioSrc * asrc, GstRingBufferSpec * spec)
   /* enable event notifications */
   GST_LOG_OBJECT (pulsesrc, "subscribing to context events");
   if (!(o = pa_context_subscribe (pulsesrc->context,
-              PA_SUBSCRIPTION_MASK_SINK_INPUT, NULL, NULL))) {
+              PA_SUBSCRIPTION_MASK_SOURCE_OUTPUT, NULL, NULL))) {
     GST_ELEMENT_ERROR (pulsesrc, RESOURCE, FAILED,
         ("pa_context_subscribe() failed: %s",
             pa_strerror (pa_context_errno (pulsesrc->context))), (NULL));
@@ -1467,6 +1478,10 @@ gst_pulsesrc_prepare (GstAudioSrc * asrc, GstRingBufferSpec * spec)
     goto unlock_and_fail;
   }
 
+  /* our clock will now start from 0 again */
+  clock = GST_AUDIO_CLOCK (GST_BASE_AUDIO_SRC (pulsesrc)->clock);
+  gst_audio_clock_reset (clock, 0);
+
   pulsesrc->corked = TRUE;
 
   for (;;) {
@@ -1690,6 +1705,11 @@ gst_pulsesrc_change_state (GstElement * element, GstStateChange transition)
             gst_pulsemixer_ctrl_new (G_OBJECT (this), this->server,
             this->device, GST_PULSEMIXER_SOURCE);
       break;
+    case GST_STATE_CHANGE_READY_TO_PAUSED:
+      gst_element_post_message (element,
+          gst_message_new_clock_provide (GST_OBJECT_CAST (element),
+              GST_BASE_AUDIO_SRC (this)->clock, TRUE));
+      break;
     case GST_STATE_CHANGE_PAUSED_TO_PLAYING:
       /* uncork and start recording */
       gst_pulsesrc_play (this);
@@ -1728,6 +1748,12 @@ gst_pulsesrc_change_state (GstElement * element, GstStateChange transition)
         this->mainloop = NULL;
       }
       break;
+    case GST_STATE_CHANGE_PAUSED_TO_READY:
+      /* format_lost is reset in release() in baseaudiosink */
+      gst_element_post_message (element,
+          gst_message_new_clock_lost (GST_OBJECT_CAST (element),
+              GST_BASE_AUDIO_SRC (this)->clock));
+      break;
     default:
       break;
   }
@@ -1748,3 +1774,28 @@ mainloop_start_failed:
     return GST_STATE_CHANGE_FAILURE;
   }
 }
+
+static GstClockTime
+gst_pulsesrc_get_time (GstClock * clock, GstPulseSrc * src)
+{
+  pa_usec_t time = 0;
+
+  pa_threaded_mainloop_lock (src->mainloop);
+
+  if (gst_pulsesrc_is_dead (src, TRUE)) {
+    goto unlock_and_out;
+  }
+
+  if (pa_stream_get_time (src->stream, &time) < 0) {
+    GST_DEBUG_OBJECT (src, "could not get time");
+    time = GST_CLOCK_TIME_NONE;
+  } else {
+    time *= 1000;
+  }
+
+
+unlock_and_out:
+  pa_threaded_mainloop_unlock (src->mainloop);
+
+  return time;
+}
diff --git a/ext/raw1394/Makefile.in b/ext/raw1394/Makefile.in
index 0b4e7ac..79dc2cd 100644
--- a/ext/raw1394/Makefile.in
+++ b/ext/raw1394/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/raw1394
 DIST_COMMON = $(am__noinst_HEADERS_DIST) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -124,10 +140,23 @@ libgst1394_la_OBJECTS = $(am_libgst1394_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgst1394_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgst1394_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgst1394_la_CFLAGS) $(CFLAGS) \
 	$(libgst1394_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -140,22 +169,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgst1394_la_SOURCES)
 DIST_SOURCES = $(am__libgst1394_la_SOURCES_DIST)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 am__noinst_HEADERS_DIST = gstdv1394src.h gst1394probe.h \
 	gsthdv1394src.h gst1394clock.h
 HEADERS = $(noinst_HEADERS)
@@ -217,6 +247,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -265,8 +296,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -347,7 +380,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -407,6 +440,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -480,7 +514,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -546,7 +584,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -554,6 +591,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -569,12 +608,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgst1394.la: $(libgst1394_la_OBJECTS) $(libgst1394_la_DEPENDENCIES) $(EXTRA_libgst1394_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgst1394_la_LINK) -rpath $(plugindir) $(libgst1394_la_OBJECTS) $(libgst1394_la_LIBADD) $(LIBS)
 
@@ -701,6 +742,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -845,18 +900,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/raw1394/gst1394probe.c b/ext/raw1394/gst1394probe.c
index ee51ba0..a457ef6 100644
--- a/ext/raw1394/gst1394probe.c
+++ b/ext/raw1394/gst1394probe.c
@@ -17,6 +17,8 @@
  * Boston, MA 02111-1307, USA.
  */
 
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #include <libavc1394/avc1394.h>
 #include <libavc1394/avc1394_vcr.h>
 #include <libavc1394/rom1394.h>
diff --git a/ext/shout2/Makefile.in b/ext/shout2/Makefile.in
index cebe633..6c5eb8f 100644
--- a/ext/shout2/Makefile.in
+++ b/ext/shout2/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/shout2
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -118,10 +134,23 @@ libgstshout2_la_OBJECTS = $(am_libgstshout2_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstshout2_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstshout2_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstshout2_la_CFLAGS) $(CFLAGS) \
 	$(libgstshout2_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -134,22 +163,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstshout2_la_SOURCES)
 DIST_SOURCES = $(libgstshout2_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -209,6 +239,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -257,8 +288,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -339,7 +372,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -399,6 +432,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -472,7 +506,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -519,7 +557,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -527,6 +564,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -542,12 +581,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstshout2.la: $(libgstshout2_la_OBJECTS) $(libgstshout2_la_DEPENDENCIES) $(EXTRA_libgstshout2_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstshout2_la_LINK) -rpath $(plugindir) $(libgstshout2_la_OBJECTS) $(libgstshout2_la_LIBADD) $(LIBS)
 
@@ -642,6 +683,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -786,18 +841,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/soup/Makefile.in b/ext/soup/Makefile.in
index bbb13ad..07e05e8 100644
--- a/ext/soup/Makefile.in
+++ b/ext/soup/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/soup
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -121,10 +137,23 @@ libgstsouphttpsrc_la_OBJECTS = $(am_libgstsouphttpsrc_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstsouphttpsrc_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstsouphttpsrc_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstsouphttpsrc_la_CFLAGS) $(CFLAGS) \
 	$(libgstsouphttpsrc_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -137,22 +166,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstsouphttpsrc_la_SOURCES)
 DIST_SOURCES = $(libgstsouphttpsrc_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -212,6 +242,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -260,8 +291,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -342,7 +375,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -402,6 +435,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -475,7 +509,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -522,7 +560,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -530,6 +567,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -545,12 +584,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstsouphttpsrc.la: $(libgstsouphttpsrc_la_OBJECTS) $(libgstsouphttpsrc_la_DEPENDENCIES) $(EXTRA_libgstsouphttpsrc_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstsouphttpsrc_la_LINK) -rpath $(plugindir) $(libgstsouphttpsrc_la_OBJECTS) $(libgstsouphttpsrc_la_LIBADD) $(LIBS)
 
@@ -661,6 +702,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -805,18 +860,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/soup/gstsouphttpsrc.c b/ext/soup/gstsouphttpsrc.c
index 4d2fdef..447a3de 100644
--- a/ext/soup/gstsouphttpsrc.c
+++ b/ext/soup/gstsouphttpsrc.c
@@ -67,6 +67,8 @@
  * </refsect2>
  */
 
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
@@ -738,7 +740,7 @@ gst_soup_http_src_got_headers_cb (SoupMessage * msg, GstSoupHTTPSrc * src)
 
   if (src->automatic_redirect && SOUP_STATUS_IS_REDIRECTION (msg->status_code)) {
     GST_DEBUG_OBJECT (src, "%u redirect to \"%s\"", msg->status_code,
-        soup_message_headers_get (msg->response_headers, "Location"));
+        soup_message_headers_get_one (msg->response_headers, "Location"));
     return;
   }
 
@@ -771,7 +773,7 @@ gst_soup_http_src_got_headers_cb (SoupMessage * msg, GstSoupHTTPSrc * src)
   tag_list = gst_tag_list_new ();
 
   if ((value =
-          soup_message_headers_get (msg->response_headers,
+          soup_message_headers_get_one (msg->response_headers,
               "icy-metaint")) != NULL) {
     gint icy_metaint = atoi (value);
 
@@ -823,7 +825,7 @@ gst_soup_http_src_got_headers_cb (SoupMessage * msg, GstSoupHTTPSrc * src)
     g_hash_table_destroy (params);
 
   if ((value =
-          soup_message_headers_get (msg->response_headers,
+          soup_message_headers_get_one (msg->response_headers,
               "icy-name")) != NULL) {
     g_free (src->iradio_name);
     src->iradio_name = gst_soup_http_src_unicodify (value);
@@ -834,7 +836,7 @@ gst_soup_http_src_got_headers_cb (SoupMessage * msg, GstSoupHTTPSrc * src)
     }
   }
   if ((value =
-          soup_message_headers_get (msg->response_headers,
+          soup_message_headers_get_one (msg->response_headers,
               "icy-genre")) != NULL) {
     g_free (src->iradio_genre);
     src->iradio_genre = gst_soup_http_src_unicodify (value);
@@ -844,7 +846,7 @@ gst_soup_http_src_got_headers_cb (SoupMessage * msg, GstSoupHTTPSrc * src)
           src->iradio_genre, NULL);
     }
   }
-  if ((value = soup_message_headers_get (msg->response_headers, "icy-url"))
+  if ((value = soup_message_headers_get_one (msg->response_headers, "icy-url"))
       != NULL) {
     g_free (src->iradio_url);
     src->iradio_url = gst_soup_http_src_unicodify (value);
@@ -1145,8 +1147,6 @@ gst_soup_http_src_build_message (GstSoupHTTPSrc * src)
           *cookie);
     }
   }
-  soup_message_headers_append (src->msg->request_headers,
-      "transferMode.dlna.org", "Streaming");
   src->retry = FALSE;
 
   g_signal_connect (src->msg, "got_headers",
@@ -1374,8 +1374,9 @@ gst_soup_http_src_do_seek (GstBaseSrc * bsrc, GstSegment * segment)
 
   GST_DEBUG_OBJECT (src, "do_seek(%" G_GUINT64_FORMAT ")", segment->start);
 
-  if (src->read_position == segment->start) {
-    GST_DEBUG_OBJECT (src, "Seeking to current read position");
+  if (src->read_position == segment->start &&
+      src->request_position == src->read_position) {
+    GST_DEBUG_OBJECT (src, "Seek to current read position and no seek pending");
     return TRUE;
   }
 
@@ -1423,10 +1424,25 @@ gst_soup_http_src_query (GstBaseSrc * bsrc, GstQuery * query)
 static gboolean
 gst_soup_http_src_set_location (GstSoupHTTPSrc * src, const gchar * uri)
 {
+  const char *alt_schemes[] = { "icy://", "icyx://" };
+  guint i;
+
   if (src->location) {
     g_free (src->location);
     src->location = NULL;
   }
+
+  if (uri == NULL)
+    return FALSE;
+
+  for (i = 0; i < G_N_ELEMENTS (alt_schemes); i++) {
+    if (g_str_has_prefix (uri, alt_schemes[i])) {
+      src->location =
+          g_strdup_printf ("http://%s", uri + strlen (alt_schemes[i]));
+      return TRUE;
+    }
+  }
+
   src->location = g_strdup (uri);
 
   return TRUE;
@@ -1460,7 +1476,8 @@ gst_soup_http_src_uri_get_type (void)
 static gchar **
 gst_soup_http_src_uri_get_protocols (void)
 {
-  static const gchar *protocols[] = { "http", "https", NULL };
+  static const gchar *protocols[] = { "http", "https", "icy", "icyx", NULL };
+
   return (gchar **) protocols;
 }
 
diff --git a/ext/speex/Makefile.in b/ext/speex/Makefile.in
index 8f5bcef..52d14be 100644
--- a/ext/speex/Makefile.in
+++ b/ext/speex/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/speex
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -120,10 +136,23 @@ libgstspeex_la_OBJECTS = $(am_libgstspeex_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstspeex_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstspeex_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstspeex_la_CFLAGS) $(CFLAGS) \
 	$(libgstspeex_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -136,22 +165,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstspeex_la_SOURCES)
 DIST_SOURCES = $(libgstspeex_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -211,6 +241,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -259,8 +290,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -341,7 +374,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -401,6 +434,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -474,7 +508,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -532,7 +570,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -540,6 +577,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -555,12 +594,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstspeex.la: $(libgstspeex_la_OBJECTS) $(libgstspeex_la_DEPENDENCIES) $(EXTRA_libgstspeex_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstspeex_la_LINK) -rpath $(plugindir) $(libgstspeex_la_OBJECTS) $(libgstspeex_la_LIBADD) $(LIBS)
 
@@ -671,6 +712,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -815,18 +870,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/speex/gstspeexdec.c b/ext/speex/gstspeexdec.c
index e1d80b6..5abce70 100644
--- a/ext/speex/gstspeexdec.c
+++ b/ext/speex/gstspeexdec.c
@@ -309,8 +309,9 @@ gst_speex_dec_parse_comments (GstSpeexDec * dec, GstBuffer * buf)
 
   GST_INFO_OBJECT (dec, "tags: %" GST_PTR_FORMAT, list);
 
-  gst_element_found_tags_for_pad (GST_ELEMENT (dec),
-      GST_AUDIO_DECODER_SRC_PAD (dec), list);
+  gst_audio_decoder_merge_tags (GST_AUDIO_DECODER (dec), list,
+      GST_TAG_MERGE_REPLACE);
+  gst_tag_list_free (list);
 
   g_free (encoder);
   g_free (ver);
diff --git a/ext/taglib/Makefile.am b/ext/taglib/Makefile.am
index 75459c5..3b2e94c 100644
--- a/ext/taglib/Makefile.am
+++ b/ext/taglib/Makefile.am
@@ -1,6 +1,6 @@
 plugin_LTLIBRARIES = libgsttaglib.la
 
-libgsttaglib_la_SOURCES = gsttaglibmux.c gstid3v2mux.cc gstapev2mux.cc
+libgsttaglib_la_SOURCES = gsttaglibplugin.c gstid3v2mux.cc gstapev2mux.cc
 libgsttaglib_la_CFLAGS = \
 	$(GST_PLUGINS_BASE_CFLAGS) \
 	$(GST_CFLAGS) \
@@ -16,4 +16,4 @@ libgsttaglib_la_LIBADD = \
 libgsttaglib_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS)
 libgsttaglib_la_LIBTOOLFLAGS = --tag=disable-static
 
-noinst_HEADERS = gsttaglibmux.h gstid3v2mux.h gstapev2mux.h
+noinst_HEADERS = gstid3v2mux.h gstapev2mux.h
diff --git a/ext/taglib/Makefile.in b/ext/taglib/Makefile.in
index 4d907c2..0bd010a 100644
--- a/ext/taglib/Makefile.in
+++ b/ext/taglib/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/taglib
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -113,16 +129,29 @@ LTLIBRARIES = $(plugin_LTLIBRARIES)
 am__DEPENDENCIES_1 =
 libgsttaglib_la_DEPENDENCIES = $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
-am_libgsttaglib_la_OBJECTS = libgsttaglib_la-gsttaglibmux.lo \
+am_libgsttaglib_la_OBJECTS = libgsttaglib_la-gsttaglibplugin.lo \
 	libgsttaglib_la-gstid3v2mux.lo libgsttaglib_la-gstapev2mux.lo
 libgsttaglib_la_OBJECTS = $(am_libgsttaglib_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgsttaglib_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CXX \
 	$(libgsttaglib_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CXXLD) $(libgsttaglib_la_CXXFLAGS) $(CXXFLAGS) \
 	$(libgsttaglib_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -135,17 +164,16 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
 	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
 LTCXXCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) \
@@ -154,19 +182,23 @@ LTCXXCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) \
 	$(AM_CXXFLAGS) $(CXXFLAGS)
 AM_V_CXX = $(am__v_CXX_@AM_V@)
 am__v_CXX_ = $(am__v_CXX_@AM_DEFAULT_V@)
-am__v_CXX_0 = @echo "  CXX   " $@;
+am__v_CXX_0 = @echo "  CXX     " $@;
+am__v_CXX_1 = 
 CXXLD = $(CXX)
 CXXLINK = $(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CXXLD) $(AM_CXXFLAGS) \
 	$(CXXFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CXXLD = $(am__v_CXXLD_@AM_V@)
 am__v_CXXLD_ = $(am__v_CXXLD_@AM_DEFAULT_V@)
-am__v_CXXLD_0 = @echo "  CXXLD " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CXXLD_0 = @echo "  CXXLD   " $@;
+am__v_CXXLD_1 = 
 SOURCES = $(libgsttaglib_la_SOURCES)
 DIST_SOURCES = $(libgsttaglib_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -226,6 +258,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -274,8 +307,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -356,7 +391,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -416,6 +451,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -489,12 +525,16 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
 plugin_LTLIBRARIES = libgsttaglib.la
-libgsttaglib_la_SOURCES = gsttaglibmux.c gstid3v2mux.cc gstapev2mux.cc
+libgsttaglib_la_SOURCES = gsttaglibplugin.c gstid3v2mux.cc gstapev2mux.cc
 libgsttaglib_la_CFLAGS = \
 	$(GST_PLUGINS_BASE_CFLAGS) \
 	$(GST_CFLAGS) \
@@ -512,7 +552,7 @@ libgsttaglib_la_LIBADD = \
 
 libgsttaglib_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS)
 libgsttaglib_la_LIBTOOLFLAGS = --tag=disable-static
-noinst_HEADERS = gsttaglibmux.h gstid3v2mux.h gstapev2mux.h
+noinst_HEADERS = gstid3v2mux.h gstapev2mux.h
 all: all-am
 
 .SUFFIXES:
@@ -549,7 +589,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -557,6 +596,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -572,12 +613,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgsttaglib.la: $(libgsttaglib_la_OBJECTS) $(libgsttaglib_la_DEPENDENCIES) $(EXTRA_libgsttaglib_la_DEPENDENCIES) 
 	$(AM_V_CXXLD)$(libgsttaglib_la_LINK) -rpath $(plugindir) $(libgsttaglib_la_OBJECTS) $(libgsttaglib_la_LIBADD) $(LIBS)
 
@@ -589,7 +632,7 @@ distclean-compile:
 
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgsttaglib_la-gstapev2mux.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgsttaglib_la-gstid3v2mux.Plo@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgsttaglib_la-gsttaglibmux.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgsttaglib_la-gsttaglibplugin.Plo@am__quote@
 
 .c.o:
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(COMPILE) -MT $@ -MD -MP -MF $(DEPDIR)/$*.Tpo -c -o $@ $<
@@ -612,12 +655,12 @@ distclean-compile:
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LTCOMPILE) -c -o $@ $<
 
-libgsttaglib_la-gsttaglibmux.lo: gsttaglibmux.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgsttaglib_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgsttaglib_la_CFLAGS) $(CFLAGS) -MT libgsttaglib_la-gsttaglibmux.lo -MD -MP -MF $(DEPDIR)/libgsttaglib_la-gsttaglibmux.Tpo -c -o libgsttaglib_la-gsttaglibmux.lo `test -f 'gsttaglibmux.c' || echo '$(srcdir)/'`gsttaglibmux.c
-@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libgsttaglib_la-gsttaglibmux.Tpo $(DEPDIR)/libgsttaglib_la-gsttaglibmux.Plo
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='gsttaglibmux.c' object='libgsttaglib_la-gsttaglibmux.lo' libtool=yes @AMDEPBACKSLASH@
+libgsttaglib_la-gsttaglibplugin.lo: gsttaglibplugin.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgsttaglib_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgsttaglib_la_CFLAGS) $(CFLAGS) -MT libgsttaglib_la-gsttaglibplugin.lo -MD -MP -MF $(DEPDIR)/libgsttaglib_la-gsttaglibplugin.Tpo -c -o libgsttaglib_la-gsttaglibplugin.lo `test -f 'gsttaglibplugin.c' || echo '$(srcdir)/'`gsttaglibplugin.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libgsttaglib_la-gsttaglibplugin.Tpo $(DEPDIR)/libgsttaglib_la-gsttaglibplugin.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='gsttaglibplugin.c' object='libgsttaglib_la-gsttaglibplugin.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgsttaglib_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgsttaglib_la_CFLAGS) $(CFLAGS) -c -o libgsttaglib_la-gsttaglibmux.lo `test -f 'gsttaglibmux.c' || echo '$(srcdir)/'`gsttaglibmux.c
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgsttaglib_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgsttaglib_la_CFLAGS) $(CFLAGS) -c -o libgsttaglib_la-gsttaglibplugin.lo `test -f 'gsttaglibplugin.c' || echo '$(srcdir)/'`gsttaglibplugin.c
 
 .cc.o:
 @am__fastdepCXX_TRUE@	$(AM_V_CXX)$(CXXCOMPILE) -MT $@ -MD -MP -MF $(DEPDIR)/$*.Tpo -c -o $@ $<
@@ -709,6 +752,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -853,18 +910,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/taglib/gstapev2mux.cc b/ext/taglib/gstapev2mux.cc
index c99a31f..8863652 100644
--- a/ext/taglib/gstapev2mux.cc
+++ b/ext/taglib/gstapev2mux.cc
@@ -64,17 +64,25 @@ static GstStaticPadTemplate src_template = GST_STATIC_PAD_TEMPLATE ("src",
     GST_PAD_ALWAYS,
     GST_STATIC_CAPS ("application/x-apetag"));
 
-GST_BOILERPLATE (GstApev2Mux, gst_apev2_mux, GstTagLibMux,
-    GST_TYPE_TAG_LIB_MUX);
+static GstStaticPadTemplate sink_template = GST_STATIC_PAD_TEMPLATE ("sink",
+    GST_PAD_SINK,
+    GST_PAD_ALWAYS,
+    GST_STATIC_CAPS ("ANY"));
+
+GST_BOILERPLATE (GstApev2Mux, gst_apev2_mux, GstTagMux,
+    GST_TYPE_TAG_MUX);
 
-static GstBuffer *gst_apev2_mux_render_tag (GstTagLibMux * mux,
-    GstTagList * taglist);
+static GstBuffer *gst_apev2_mux_render_tag (GstTagMux * mux,
+    const GstTagList * taglist);
+static GstBuffer *gst_apev2_mux_render_end_tag (GstTagMux * mux,
+    const GstTagList * taglist);
 
 static void
 gst_apev2_mux_base_init (gpointer g_class)
 {
   GstElementClass *element_class = GST_ELEMENT_CLASS (g_class);
 
+  gst_element_class_add_static_pad_template (element_class, &sink_template);
   gst_element_class_add_static_pad_template (element_class, &src_template);
 
   gst_element_class_set_details_simple (element_class,
@@ -89,8 +97,10 @@ gst_apev2_mux_base_init (gpointer g_class)
 static void
 gst_apev2_mux_class_init (GstApev2MuxClass * klass)
 {
-  GST_TAG_LIB_MUX_CLASS (klass)->render_tag =
+  GST_TAG_MUX_CLASS (klass)->render_start_tag =
       GST_DEBUG_FUNCPTR (gst_apev2_mux_render_tag);
+  GST_TAG_MUX_CLASS (klass)->render_end_tag =
+      GST_DEBUG_FUNCPTR (gst_apev2_mux_render_end_tag);
 }
 
 static void
@@ -339,11 +349,12 @@ add_one_tag (const GstTagList * list, const gchar * tag, gpointer user_data)
 }
 
 static GstBuffer *
-gst_apev2_mux_render_tag (GstTagLibMux * mux, GstTagList * taglist)
+gst_apev2_mux_render_tag (GstTagMux * mux, const GstTagList * taglist)
 {
   APE::Tag apev2tag;
   ByteVector rendered_tag;
   GstBuffer *buf;
+  GstCaps *caps;
   guint tag_size;
 
   /* Render the tag */
@@ -357,17 +368,16 @@ gst_apev2_mux_render_tag (GstTagLibMux * mux, GstTagList * taglist)
   /* Create buffer with tag */
   buf = gst_buffer_new_and_alloc (tag_size);
   memcpy (GST_BUFFER_DATA (buf), rendered_tag.data (), tag_size);
-  gst_buffer_set_caps (buf, GST_PAD_CAPS (mux->srcpad));
+
+  caps = gst_static_pad_template_get_caps (&src_template);
+  gst_buffer_set_caps (buf, caps);
+  gst_caps_unref (caps);
 
   return buf;
 }
 
-gboolean
-gst_apev2_mux_plugin_init (GstPlugin * plugin)
+static GstBuffer *
+gst_apev2_mux_render_end_tag (GstTagMux * mux, const GstTagList * taglist)
 {
-  if (!gst_element_register (plugin, "apev2mux", GST_RANK_NONE,
-          GST_TYPE_APEV2_MUX))
-    return FALSE;
-
-  return TRUE;
+  return NULL;
 }
diff --git a/ext/taglib/gstapev2mux.h b/ext/taglib/gstapev2mux.h
index 8dd9333..9539a6a 100644
--- a/ext/taglib/gstapev2mux.h
+++ b/ext/taglib/gstapev2mux.h
@@ -22,7 +22,7 @@
 #ifndef GST_APEV2_MUX_H
 #define GST_APEV2_MUX_H
 
-#include "gsttaglibmux.h"
+#include <gst/tag/gsttagmux.h>
 
 G_BEGIN_DECLS
 
@@ -30,11 +30,11 @@ typedef struct _GstApev2Mux GstApev2Mux;
 typedef struct _GstApev2MuxClass GstApev2MuxClass;
 
 struct _GstApev2Mux {
-  GstTagLibMux  taglibmux;
+  GstTagMux  tagmux;
 };
 
 struct _GstApev2MuxClass {
-  GstTagLibMuxClass  taglibmux_class;
+  GstTagMuxClass  tagmux_class;
 };
 
 #define GST_TYPE_APEV2_MUX \
diff --git a/ext/taglib/gstid3v2mux.cc b/ext/taglib/gstid3v2mux.cc
index 2b5042e..cd61e91 100644
--- a/ext/taglib/gstid3v2mux.cc
+++ b/ext/taglib/gstid3v2mux.cc
@@ -72,18 +72,24 @@ static GstStaticPadTemplate src_template = GST_STATIC_PAD_TEMPLATE ("src",
     GST_PAD_ALWAYS,
     GST_STATIC_CAPS ("application/x-id3"));
 
+static GstStaticPadTemplate sink_template = GST_STATIC_PAD_TEMPLATE ("sink",
+    GST_PAD_SINK,
+    GST_PAD_ALWAYS,
+    GST_STATIC_CAPS ("ANY"));
 
-GST_BOILERPLATE (GstId3v2Mux, gst_id3v2_mux, GstTagLibMux,
-    GST_TYPE_TAG_LIB_MUX);
+GST_BOILERPLATE (GstId3v2Mux, gst_id3v2_mux, GstTagMux, GST_TYPE_TAG_MUX);
 
-static GstBuffer *gst_id3v2_mux_render_tag (GstTagLibMux * mux,
-    GstTagList * taglist);
+static GstBuffer *gst_id3v2_mux_render_tag (GstTagMux * mux,
+    const GstTagList * taglist);
+static GstBuffer *gst_id3v2_mux_render_end_tag (GstTagMux * mux,
+    const GstTagList * taglist);
 
 static void
 gst_id3v2_mux_base_init (gpointer g_class)
 {
   GstElementClass *element_class = GST_ELEMENT_CLASS (g_class);
 
+  gst_element_class_add_static_pad_template (element_class, &sink_template);
   gst_element_class_add_static_pad_template (element_class, &src_template);
 
   gst_element_class_set_details_simple (element_class,
@@ -98,8 +104,10 @@ gst_id3v2_mux_base_init (gpointer g_class)
 static void
 gst_id3v2_mux_class_init (GstId3v2MuxClass * klass)
 {
-  GST_TAG_LIB_MUX_CLASS (klass)->render_tag =
+  GST_TAG_MUX_CLASS (klass)->render_start_tag =
       GST_DEBUG_FUNCPTR (gst_id3v2_mux_render_tag);
+  GST_TAG_MUX_CLASS (klass)->render_end_tag =
+      GST_DEBUG_FUNCPTR (gst_id3v2_mux_render_end_tag);
 }
 
 static void
@@ -723,11 +731,12 @@ foreach_add_tag (const GstTagList * list, const gchar * tag, gpointer userdata)
 }
 
 static GstBuffer *
-gst_id3v2_mux_render_tag (GstTagLibMux * mux, GstTagList * taglist)
+gst_id3v2_mux_render_tag (GstTagMux * mux, const GstTagList * taglist)
 {
   ID3v2::Tag id3v2tag;
   ByteVector rendered_tag;
   GstBuffer *buf;
+  GstCaps *caps;
   guint tag_size;
 
   /* write all strings as UTF-8 by default */
@@ -757,19 +766,16 @@ gst_id3v2_mux_render_tag (GstTagLibMux * mux, GstTagList * taglist)
   /* Create buffer with tag */
   buf = gst_buffer_new_and_alloc (tag_size);
   memcpy (GST_BUFFER_DATA (buf), rendered_tag.data (), tag_size);
-  gst_buffer_set_caps (buf, GST_PAD_CAPS (mux->srcpad));
+
+  caps = gst_static_pad_template_get_caps (&src_template);
+  gst_buffer_set_caps (buf, caps);
+  gst_caps_unref (caps);
 
   return buf;
 }
 
-gboolean
-gst_id3v2_mux_plugin_init (GstPlugin * plugin)
+static GstBuffer *
+gst_id3v2_mux_render_end_tag (GstTagMux * mux, const GstTagList * taglist)
 {
-  if (!gst_element_register (plugin, "id3v2mux", GST_RANK_NONE,
-          GST_TYPE_ID3V2_MUX))
-    return FALSE;
-
-  gst_tag_register_musicbrainz_tags ();
-
-  return TRUE;
+  return NULL;
 }
diff --git a/ext/taglib/gstid3v2mux.h b/ext/taglib/gstid3v2mux.h
index 9d47d30..1a66b95 100644
--- a/ext/taglib/gstid3v2mux.h
+++ b/ext/taglib/gstid3v2mux.h
@@ -21,7 +21,7 @@
 #ifndef GST_ID3V2_MUX_H
 #define GST_ID3V2_MUX_H
 
-#include "gsttaglibmux.h"
+#include <gst/tag/gsttagmux.h>
 
 G_BEGIN_DECLS
 
@@ -29,11 +29,11 @@ typedef struct _GstId3v2Mux GstId3v2Mux;
 typedef struct _GstId3v2MuxClass GstId3v2MuxClass;
 
 struct _GstId3v2Mux {
-  GstTagLibMux  taglibmux;
+  GstTagMux  tagmux;
 };
 
 struct _GstId3v2MuxClass {
-  GstTagLibMuxClass  taglibmux_class;
+  GstTagMuxClass  tagmux_class;
 };
 
 #define GST_TYPE_ID3V2_MUX \
diff --git a/ext/taglib/gsttaglibmux.c b/ext/taglib/gsttaglibmux.c
deleted file mode 100644
index 094bec1..0000000
--- a/ext/taglib/gsttaglibmux.c
+++ /dev/null
@@ -1,402 +0,0 @@
-/* GStreamer taglib-based muxer base class
- * Copyright (C) 2006 Christophe Fergeau  <teuf@gnome.org>
- * Copyright (C) 2006 Tim-Philipp Müller <tim centricular net>
- * Copyright (C) 2006 Sebastian Dröge <slomo@circular-chaos.org>
-
- * This library is free software; you can redistribute it and/or
- * modify it under the terms of the GNU Library General Public
- * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
- *
- * This library is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- * Library General Public License for more details.
- *
- * You should have received a copy of the GNU Library General Public
- * License along with this library; if not, write to the
- * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
- * Boston, MA 02111-1307, USA.
- */
-
-#ifdef HAVE_CONFIG_H
-#include <config.h>
-#endif
-
-#include <string.h>
-#include <gst/gsttagsetter.h>
-#include <gst/tag/tag.h>
-
-#include "gsttaglibmux.h"
-
-GST_DEBUG_CATEGORY_STATIC (gst_tag_lib_mux_debug);
-#define GST_CAT_DEFAULT gst_tag_lib_mux_debug
-
-static GstStaticPadTemplate gst_tag_lib_mux_sink_template =
-GST_STATIC_PAD_TEMPLATE ("sink",
-    GST_PAD_SINK,
-    GST_PAD_ALWAYS,
-    GST_STATIC_CAPS ("ANY"));
-
-static void
-gst_tag_lib_mux_iface_init (GType taglib_type)
-{
-  static const GInterfaceInfo tag_setter_info = {
-    NULL,
-    NULL,
-    NULL
-  };
-
-  g_type_add_interface_static (taglib_type, GST_TYPE_TAG_SETTER,
-      &tag_setter_info);
-}
-
-GST_BOILERPLATE_FULL (GstTagLibMux, gst_tag_lib_mux,
-    GstElement, GST_TYPE_ELEMENT, gst_tag_lib_mux_iface_init);
-
-
-static GstStateChangeReturn
-gst_tag_lib_mux_change_state (GstElement * element, GstStateChange transition);
-static GstFlowReturn gst_tag_lib_mux_chain (GstPad * pad, GstBuffer * buffer);
-static gboolean gst_tag_lib_mux_sink_event (GstPad * pad, GstEvent * event);
-
-static void
-gst_tag_lib_mux_finalize (GObject * obj)
-{
-  GstTagLibMux *mux = GST_TAG_LIB_MUX (obj);
-
-  if (mux->newsegment_ev) {
-    gst_event_unref (mux->newsegment_ev);
-    mux->newsegment_ev = NULL;
-  }
-
-  if (mux->event_tags) {
-    gst_tag_list_free (mux->event_tags);
-    mux->event_tags = NULL;
-  }
-
-  G_OBJECT_CLASS (parent_class)->finalize (obj);
-}
-
-static void
-gst_tag_lib_mux_base_init (gpointer g_class)
-{
-  GstElementClass *element_class = GST_ELEMENT_CLASS (g_class);
-
-  gst_element_class_add_static_pad_template (element_class,
-      &gst_tag_lib_mux_sink_template);
-
-  GST_DEBUG_CATEGORY_INIT (gst_tag_lib_mux_debug, "taglibmux", 0,
-      "taglib-based muxer");
-}
-
-static void
-gst_tag_lib_mux_class_init (GstTagLibMuxClass * klass)
-{
-  GObjectClass *gobject_class;
-  GstElementClass *gstelement_class;
-
-  gobject_class = (GObjectClass *) klass;
-  gstelement_class = (GstElementClass *) klass;
-
-  gobject_class->finalize = gst_tag_lib_mux_finalize;
-  gstelement_class->change_state =
-      GST_DEBUG_FUNCPTR (gst_tag_lib_mux_change_state);
-}
-
-static void
-gst_tag_lib_mux_init (GstTagLibMux * mux, GstTagLibMuxClass * mux_class)
-{
-  GstElementClass *element_klass = GST_ELEMENT_CLASS (mux_class);
-  GstPadTemplate *tmpl;
-
-  /* pad through which data comes in to the element */
-  mux->sinkpad =
-      gst_pad_new_from_static_template (&gst_tag_lib_mux_sink_template, "sink");
-  gst_pad_set_chain_function (mux->sinkpad,
-      GST_DEBUG_FUNCPTR (gst_tag_lib_mux_chain));
-  gst_pad_set_event_function (mux->sinkpad,
-      GST_DEBUG_FUNCPTR (gst_tag_lib_mux_sink_event));
-  gst_element_add_pad (GST_ELEMENT (mux), mux->sinkpad);
-
-  /* pad through which data goes out of the element */
-  tmpl = gst_element_class_get_pad_template (element_klass, "src");
-  if (tmpl) {
-    mux->srcpad = gst_pad_new_from_template (tmpl, "src");
-    gst_pad_use_fixed_caps (mux->srcpad);
-    gst_pad_set_caps (mux->srcpad, gst_pad_template_get_caps (tmpl));
-    gst_element_add_pad (GST_ELEMENT (mux), mux->srcpad);
-  }
-
-  mux->render_tag = TRUE;
-}
-
-static GstBuffer *
-gst_tag_lib_mux_render_tag (GstTagLibMux * mux)
-{
-  GstTagLibMuxClass *klass;
-  GstTagMergeMode merge_mode;
-  GstTagSetter *tagsetter;
-  GstBuffer *buffer;
-  const GstTagList *tagsetter_tags;
-  GstTagList *taglist;
-  GstEvent *event;
-
-  tagsetter = GST_TAG_SETTER (mux);
-
-  tagsetter_tags = gst_tag_setter_get_tag_list (tagsetter);
-  merge_mode = gst_tag_setter_get_tag_merge_mode (tagsetter);
-
-  GST_LOG_OBJECT (mux, "merging tags, merge mode = %d", merge_mode);
-  GST_LOG_OBJECT (mux, "event tags: %" GST_PTR_FORMAT, mux->event_tags);
-  GST_LOG_OBJECT (mux, "set   tags: %" GST_PTR_FORMAT, tagsetter_tags);
-
-  taglist = gst_tag_list_merge (tagsetter_tags, mux->event_tags, merge_mode);
-
-  GST_LOG_OBJECT (mux, "final tags: %" GST_PTR_FORMAT, taglist);
-
-  klass = GST_TAG_LIB_MUX_CLASS (G_OBJECT_GET_CLASS (mux));
-
-  if (klass->render_tag == NULL)
-    goto no_vfunc;
-
-  buffer = klass->render_tag (mux, taglist);
-
-  if (buffer == NULL)
-    goto render_error;
-
-  mux->tag_size = GST_BUFFER_SIZE (buffer);
-  GST_LOG_OBJECT (mux, "tag size = %" G_GSIZE_FORMAT " bytes", mux->tag_size);
-
-  /* Send newsegment event from byte position 0, so the tag really gets
-   * written to the start of the file, independent of the upstream segment */
-  gst_pad_push_event (mux->srcpad,
-      gst_event_new_new_segment (FALSE, 1.0, GST_FORMAT_BYTES, 0, -1, 0));
-
-  /* Send an event about the new tags to downstream elements */
-  /* gst_event_new_tag takes ownership of the list, so no need to unref it */
-  event = gst_event_new_tag (taglist);
-  gst_pad_push_event (mux->srcpad, event);
-
-  GST_BUFFER_OFFSET (buffer) = 0;
-
-  return buffer;
-
-no_vfunc:
-  {
-    GST_ERROR_OBJECT (mux, "Subclass does not implement render_tag vfunc!");
-    gst_tag_list_free (taglist);
-    return NULL;
-  }
-
-render_error:
-  {
-    GST_ERROR_OBJECT (mux, "Failed to render tag");
-    gst_tag_list_free (taglist);
-    return NULL;
-  }
-}
-
-static GstEvent *
-gst_tag_lib_mux_adjust_event_offsets (GstTagLibMux * mux,
-    const GstEvent * newsegment_event)
-{
-  GstFormat format;
-  gint64 start, stop, cur;
-
-  gst_event_parse_new_segment ((GstEvent *) newsegment_event, NULL, NULL,
-      &format, &start, &stop, &cur);
-
-  g_assert (format == GST_FORMAT_BYTES);
-
-  if (start != -1)
-    start += mux->tag_size;
-  if (stop != -1)
-    stop += mux->tag_size;
-  if (cur != -1)
-    cur += mux->tag_size;
-
-  GST_DEBUG_OBJECT (mux, "adjusting newsegment event offsets to start=%"
-      G_GINT64_FORMAT ", stop=%" G_GINT64_FORMAT ", cur=%" G_GINT64_FORMAT
-      " (delta = +%" G_GSIZE_FORMAT ")", start, stop, cur, mux->tag_size);
-
-  return gst_event_new_new_segment (TRUE, 1.0, format, start, stop, cur);
-}
-
-static GstFlowReturn
-gst_tag_lib_mux_chain (GstPad * pad, GstBuffer * buffer)
-{
-  GstTagLibMux *mux = GST_TAG_LIB_MUX (GST_OBJECT_PARENT (pad));
-
-  if (mux->render_tag) {
-    GstFlowReturn ret;
-    GstBuffer *tag_buffer;
-
-    GST_INFO_OBJECT (mux, "Adding tags to stream");
-    tag_buffer = gst_tag_lib_mux_render_tag (mux);
-    if (tag_buffer == NULL)
-      goto no_tag_buffer;
-    ret = gst_pad_push (mux->srcpad, tag_buffer);
-    if (ret != GST_FLOW_OK) {
-      GST_DEBUG_OBJECT (mux, "flow: %s", gst_flow_get_name (ret));
-      gst_buffer_unref (buffer);
-      return ret;
-    }
-
-    /* Now send the cached newsegment event that we got from upstream */
-    if (mux->newsegment_ev) {
-      GST_DEBUG_OBJECT (mux, "sending cached newsegment event");
-      gst_pad_push_event (mux->srcpad,
-          gst_tag_lib_mux_adjust_event_offsets (mux, mux->newsegment_ev));
-      gst_event_unref (mux->newsegment_ev);
-      mux->newsegment_ev = NULL;
-    } else {
-      /* upstream sent no newsegment event or only one in a non-BYTE format */
-    }
-
-    mux->render_tag = FALSE;
-  }
-
-  buffer = gst_buffer_make_metadata_writable (buffer);
-
-  if (GST_BUFFER_OFFSET (buffer) != GST_BUFFER_OFFSET_NONE) {
-    GST_LOG_OBJECT (mux, "Adjusting buffer offset from %" G_GINT64_FORMAT
-        " to %" G_GINT64_FORMAT, GST_BUFFER_OFFSET (buffer),
-        GST_BUFFER_OFFSET (buffer) + mux->tag_size);
-    GST_BUFFER_OFFSET (buffer) += mux->tag_size;
-  }
-
-  gst_buffer_set_caps (buffer, GST_PAD_CAPS (mux->srcpad));
-  return gst_pad_push (mux->srcpad, buffer);
-
-/* ERRORS */
-no_tag_buffer:
-  {
-    GST_ELEMENT_ERROR (mux, LIBRARY, ENCODE, (NULL), (NULL));
-    return GST_FLOW_ERROR;
-  }
-}
-
-static gboolean
-gst_tag_lib_mux_sink_event (GstPad * pad, GstEvent * event)
-{
-  GstTagLibMux *mux;
-  gboolean result;
-
-  mux = GST_TAG_LIB_MUX (gst_pad_get_parent (pad));
-  result = FALSE;
-
-  switch (GST_EVENT_TYPE (event)) {
-    case GST_EVENT_TAG:{
-      GstTagList *tags;
-
-      gst_event_parse_tag (event, &tags);
-
-      GST_INFO_OBJECT (mux, "Got tag event: %" GST_PTR_FORMAT, tags);
-
-      if (mux->event_tags != NULL) {
-        gst_tag_list_insert (mux->event_tags, tags, GST_TAG_MERGE_REPLACE);
-      } else {
-        mux->event_tags = gst_tag_list_copy (tags);
-      }
-
-      GST_INFO_OBJECT (mux, "Event tags are now: %" GST_PTR_FORMAT,
-          mux->event_tags);
-
-      /* just drop the event, we'll push a new tag event in render_tag */
-      gst_event_unref (event);
-      result = TRUE;
-      break;
-    }
-    case GST_EVENT_NEWSEGMENT:{
-      GstFormat fmt;
-
-      gst_event_parse_new_segment (event, NULL, NULL, &fmt, NULL, NULL, NULL);
-
-      if (fmt != GST_FORMAT_BYTES) {
-        GST_WARNING_OBJECT (mux, "dropping newsegment event in %s format",
-            gst_format_get_name (fmt));
-        gst_event_unref (event);
-        break;
-      }
-
-      if (mux->render_tag) {
-        /* we have not rendered the tag yet, which means that we don't know
-         * how large it is going to be yet, so we can't adjust the offsets
-         * here at this point and need to cache the newsegment event for now
-         * (also, there could be tag events coming after this newsegment event
-         *  and before the first buffer). */
-        if (mux->newsegment_ev) {
-          GST_WARNING_OBJECT (mux, "discarding old cached newsegment event");
-          gst_event_unref (mux->newsegment_ev);
-        }
-
-        GST_LOG_OBJECT (mux, "caching newsegment event for later");
-        mux->newsegment_ev = event;
-      } else {
-        GST_DEBUG_OBJECT (mux, "got newsegment event, adjusting offsets");
-        gst_pad_push_event (mux->srcpad,
-            gst_tag_lib_mux_adjust_event_offsets (mux, event));
-        gst_event_unref (event);
-      }
-      event = NULL;
-      result = TRUE;
-      break;
-    }
-    default:
-      result = gst_pad_event_default (pad, event);
-      break;
-  }
-
-  gst_object_unref (mux);
-
-  return result;
-}
-
-
-static GstStateChangeReturn
-gst_tag_lib_mux_change_state (GstElement * element, GstStateChange transition)
-{
-  GstTagLibMux *mux;
-  GstStateChangeReturn result;
-
-  mux = GST_TAG_LIB_MUX (element);
-
-  result = GST_ELEMENT_CLASS (parent_class)->change_state (element, transition);
-  if (result != GST_STATE_CHANGE_SUCCESS) {
-    return result;
-  }
-
-  switch (transition) {
-    case GST_STATE_CHANGE_PAUSED_TO_READY:{
-      if (mux->newsegment_ev) {
-        gst_event_unref (mux->newsegment_ev);
-        mux->newsegment_ev = NULL;
-      }
-      if (mux->event_tags) {
-        gst_tag_list_free (mux->event_tags);
-        mux->event_tags = NULL;
-      }
-      mux->tag_size = 0;
-      mux->render_tag = TRUE;
-      break;
-    }
-    default:
-      break;
-  }
-
-  return result;
-}
-
-static gboolean
-plugin_init (GstPlugin * plugin)
-{
-  return (gst_id3v2_mux_plugin_init (plugin)
-      && gst_apev2_mux_plugin_init (plugin));
-}
-
-GST_PLUGIN_DEFINE (GST_VERSION_MAJOR,
-    GST_VERSION_MINOR,
-    "taglib",
-    "Tag writing plug-in based on taglib",
-    plugin_init, VERSION, "LGPL", GST_PACKAGE_NAME, GST_PACKAGE_ORIGIN);
diff --git a/ext/taglib/gsttaglibmux.h b/ext/taglib/gsttaglibmux.h
deleted file mode 100644
index d26ff30..0000000
--- a/ext/taglib/gsttaglibmux.h
+++ /dev/null
@@ -1,71 +0,0 @@
-/* GStreamer taglib-based muxer base class
- * Copyright (C) 2006 Christophe Fergeau  <teuf@gnome.org>
- * Copyright (C) 2006 Tim-Philipp Müller <tim centricular net>
-
- * This library is free software; you can redistribute it and/or
- * modify it under the terms of the GNU Library General Public
- * License as published by the Free Software Foundation; either
- * version 2 of the License, or (at your option) any later version.
- *
- * This library is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
- * Library General Public License for more details.
- *
- * You should have received a copy of the GNU Library General Public
- * License along with this library; if not, write to the
- * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
- * Boston, MA 02111-1307, USA.
- */
-
-#ifndef GST_TAG_LIB_MUX_H
-#define GST_TAG_LIB_MUX_H
-
-#include <gst/gst.h>
-
-G_BEGIN_DECLS
-
-typedef struct _GstTagLibMux GstTagLibMux;
-typedef struct _GstTagLibMuxClass GstTagLibMuxClass;
-
-/* Definition of structure storing data for this element. */
-struct _GstTagLibMux {
-  GstElement    element;
-
-  GstPad       *srcpad;
-  GstPad       *sinkpad;
-  GstTagList   *event_tags; /* tags received from upstream elements */
-  gsize         tag_size;
-  gboolean      render_tag;
-
-  GstEvent     *newsegment_ev; /* cached newsegment event from upstream */
-};
-
-/* Standard definition defining a class for this element. */
-struct _GstTagLibMuxClass {
-  GstElementClass parent_class;
-
-  /* vfuncs */
-  GstBuffer  * (*render_tag) (GstTagLibMux * mux, GstTagList * tag_list);
-};
-
-/* Standard macros for defining types for this element.  */
-#define GST_TYPE_TAG_LIB_MUX \
-  (gst_tag_lib_mux_get_type())
-#define GST_TAG_LIB_MUX(obj) \
-  (G_TYPE_CHECK_INSTANCE_CAST((obj),GST_TYPE_TAG_LIB_MUX,GstTagLibMux))
-#define GST_TAG_LIB_MUX_CLASS(klass) \
-  (G_TYPE_CHECK_CLASS_CAST((klass),GST_TYPE_TAG_LIB_MUX,GstTagLibMuxClass))
-#define GST_IS_TAG_LIB_MUX(obj) \
-  (G_TYPE_CHECK_INSTANCE_TYPE((obj),GST_TYPE_TAG_LIB_MUX))
-#define GST_IS_TAG_LIB_MUX_CLASS(klass) \
-  (G_TYPE_CHECK_CLASS_TYPE((klass),GST_TYPE_TAG_LIB_MUX))
-
-/* Standard function returning type information. */
-GType gst_tag_lib_mux_get_type (void);
-gboolean gst_apev2_mux_plugin_init (GstPlugin * plugin);
-gboolean gst_id3v2_mux_plugin_init (GstPlugin * plugin);
-
-G_END_DECLS
-
-#endif
diff --git a/ext/taglib/gsttaglibplugin.c b/ext/taglib/gsttaglibplugin.c
new file mode 100644
index 0000000..67ac332
--- /dev/null
+++ b/ext/taglib/gsttaglibplugin.c
@@ -0,0 +1,49 @@
+/* GStreamer taglib-based muxer base class
+ * Copyright (C) 2006 Christophe Fergeau  <teuf@gnome.org>
+ * Copyright (C) 2006 Tim-Philipp Müller <tim centricular net>
+ * Copyright (C) 2006 Sebastian Dröge <slomo@circular-chaos.org>
+
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include <config.h>
+#endif
+
+#include "gstapev2mux.h"
+#include "gstid3v2mux.h"
+
+#include <gst/tag/tag.h>
+
+static gboolean
+plugin_init (GstPlugin * plugin)
+{
+  if (!gst_element_register (plugin, "id3v2mux", GST_RANK_NONE,
+          GST_TYPE_ID3V2_MUX) ||
+      !gst_element_register (plugin, "apev2mux", GST_RANK_NONE,
+          GST_TYPE_APEV2_MUX))
+    return FALSE;
+
+  gst_tag_register_musicbrainz_tags ();
+
+  return TRUE;
+}
+
+GST_PLUGIN_DEFINE (GST_VERSION_MAJOR,
+    GST_VERSION_MINOR,
+    "taglib",
+    "Tag writing plug-in based on taglib",
+    plugin_init, VERSION, "LGPL", GST_PACKAGE_NAME, GST_PACKAGE_ORIGIN);
diff --git a/ext/wavpack/Makefile.in b/ext/wavpack/Makefile.in
index 4eb1dd1..20b1086 100644
--- a/ext/wavpack/Makefile.in
+++ b/ext/wavpack/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/wavpack
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -124,10 +140,23 @@ libgstwavpack_la_OBJECTS = $(am_libgstwavpack_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstwavpack_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstwavpack_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstwavpack_la_CFLAGS) $(CFLAGS) \
 	$(libgstwavpack_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -140,22 +169,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstwavpack_la_SOURCES)
 DIST_SOURCES = $(libgstwavpack_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -215,6 +245,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -263,8 +294,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -345,7 +378,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -405,6 +438,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -478,7 +512,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -542,7 +580,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -550,6 +587,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -565,12 +604,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstwavpack.la: $(libgstwavpack_la_OBJECTS) $(libgstwavpack_la_DEPENDENCIES) $(EXTRA_libgstwavpack_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstwavpack_la_LINK) -rpath $(plugindir) $(libgstwavpack_la_OBJECTS) $(libgstwavpack_la_LIBADD) $(LIBS)
 
@@ -705,6 +746,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -849,18 +904,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/wavpack/gstwavpackdec.c b/ext/wavpack/gstwavpackdec.c
index 4ba242d..05caa08 100644
--- a/ext/wavpack/gstwavpackdec.c
+++ b/ext/wavpack/gstwavpackdec.c
@@ -55,8 +55,6 @@
 #include "gstwavpackstreamreader.h"
 
 
-#define WAVPACK_DEC_MAX_ERRORS 16
-
 GST_DEBUG_CATEGORY_STATIC (gst_wavpack_dec_debug);
 #define GST_CAT_DEFAULT gst_wavpack_dec_debug
 
@@ -73,22 +71,34 @@ static GstStaticPadTemplate src_factory = GST_STATIC_PAD_TEMPLATE ("src",
     GST_PAD_SRC,
     GST_PAD_ALWAYS,
     GST_STATIC_CAPS ("audio/x-raw-int, "
-        "width = (int) 32, "
-        "depth = (int) [ 1, 32 ], "
+        "width = (int) 8, depth = (int) 8, "
+        "channels = (int) [ 1, 8 ], "
+        "rate = (int) [ 6000, 192000 ], "
+        "endianness = (int) BYTE_ORDER, " "signed = (boolean) true; "
+        "audio/x-raw-int, "
+        "width = (int) 16, depth = (int) 16, "
         "channels = (int) [ 1, 8 ], "
         "rate = (int) [ 6000, 192000 ], "
-        "endianness = (int) BYTE_ORDER, " "signed = (boolean) true")
+        "endianness = (int) BYTE_ORDER, " "signed = (boolean) true; "
+        "audio/x-raw-int, "
+        "width = (int) 32, depth = (int) 32, "
+        "channels = (int) [ 1, 8 ], "
+        "rate = (int) [ 6000, 192000 ], "
+        "endianness = (int) BYTE_ORDER, " "signed = (boolean) true; ")
     );
 
-static GstFlowReturn gst_wavpack_dec_chain (GstPad * pad, GstBuffer * buffer);
-static gboolean gst_wavpack_dec_sink_set_caps (GstPad * pad, GstCaps * caps);
-static gboolean gst_wavpack_dec_sink_event (GstPad * pad, GstEvent * event);
+static gboolean gst_wavpack_dec_start (GstAudioDecoder * dec);
+static gboolean gst_wavpack_dec_stop (GstAudioDecoder * dec);
+static gboolean gst_wavpack_dec_set_format (GstAudioDecoder * dec,
+    GstCaps * caps);
+static GstFlowReturn gst_wavpack_dec_handle_frame (GstAudioDecoder * dec,
+    GstBuffer * buffer);
+
 static void gst_wavpack_dec_finalize (GObject * object);
-static GstStateChangeReturn gst_wavpack_dec_change_state (GstElement * element,
-    GstStateChange transition);
 static void gst_wavpack_dec_post_tags (GstWavpackDec * dec);
 
-GST_BOILERPLATE (GstWavpackDec, gst_wavpack_dec, GstElement, GST_TYPE_ELEMENT);
+GST_BOILERPLATE (GstWavpackDec, gst_wavpack_dec, GstAudioDecoder,
+    GST_TYPE_AUDIO_DECODER);
 
 static void
 gst_wavpack_dec_base_init (gpointer klass)
@@ -108,11 +118,14 @@ static void
 gst_wavpack_dec_class_init (GstWavpackDecClass * klass)
 {
   GObjectClass *gobject_class = (GObjectClass *) klass;
-  GstElementClass *gstelement_class = (GstElementClass *) klass;
+  GstAudioDecoderClass *base_class = (GstAudioDecoderClass *) (klass);
 
-  gstelement_class->change_state =
-      GST_DEBUG_FUNCPTR (gst_wavpack_dec_change_state);
   gobject_class->finalize = gst_wavpack_dec_finalize;
+
+  base_class->start = GST_DEBUG_FUNCPTR (gst_wavpack_dec_start);
+  base_class->stop = GST_DEBUG_FUNCPTR (gst_wavpack_dec_stop);
+  base_class->set_format = GST_DEBUG_FUNCPTR (gst_wavpack_dec_set_format);
+  base_class->handle_frame = GST_DEBUG_FUNCPTR (gst_wavpack_dec_handle_frame);
 }
 
 static void
@@ -121,33 +134,15 @@ gst_wavpack_dec_reset (GstWavpackDec * dec)
   dec->wv_id.buffer = NULL;
   dec->wv_id.position = dec->wv_id.length = 0;
 
-  dec->error_count = 0;
-
   dec->channels = 0;
   dec->channel_mask = 0;
   dec->sample_rate = 0;
   dec->depth = 0;
-
-  gst_segment_init (&dec->segment, GST_FORMAT_TIME);
-  dec->next_block_index = 0;
 }
 
 static void
 gst_wavpack_dec_init (GstWavpackDec * dec, GstWavpackDecClass * gklass)
 {
-  dec->sinkpad = gst_pad_new_from_static_template (&sink_factory, "sink");
-  gst_pad_set_chain_function (dec->sinkpad,
-      GST_DEBUG_FUNCPTR (gst_wavpack_dec_chain));
-  gst_pad_set_setcaps_function (dec->sinkpad,
-      GST_DEBUG_FUNCPTR (gst_wavpack_dec_sink_set_caps));
-  gst_pad_set_event_function (dec->sinkpad,
-      GST_DEBUG_FUNCPTR (gst_wavpack_dec_sink_event));
-  gst_element_add_pad (GST_ELEMENT (dec), dec->sinkpad);
-
-  dec->srcpad = gst_pad_new_from_static_template (&src_factory, "src");
-  gst_pad_use_fixed_caps (dec->srcpad);
-  gst_element_add_pad (GST_ELEMENT (dec), dec->srcpad);
-
   dec->context = NULL;
   dec->stream_reader = gst_wavpack_stream_reader_new ();
 
@@ -166,26 +161,81 @@ gst_wavpack_dec_finalize (GObject * object)
 }
 
 static gboolean
-gst_wavpack_dec_sink_set_caps (GstPad * pad, GstCaps * caps)
+gst_wavpack_dec_start (GstAudioDecoder * dec)
 {
-  GstWavpackDec *dec = GST_WAVPACK_DEC (gst_pad_get_parent (pad));
+  GST_DEBUG_OBJECT (dec, "start");
+
+  /* never mind a few errors */
+  gst_audio_decoder_set_max_errors (dec, 16);
+  /* don't bother us with flushing */
+  gst_audio_decoder_set_drainable (dec, FALSE);
+  /* aim for some perfect timestamping */
+  gst_audio_decoder_set_tolerance (dec, 10 * GST_MSECOND);
+
+  return TRUE;
+}
+
+static gboolean
+gst_wavpack_dec_stop (GstAudioDecoder * dec)
+{
+  GstWavpackDec *wpdec = GST_WAVPACK_DEC (dec);
+
+  GST_DEBUG_OBJECT (dec, "stop");
+
+  if (wpdec->context) {
+    WavpackCloseFile (wpdec->context);
+    wpdec->context = NULL;
+  }
+
+  gst_wavpack_dec_reset (wpdec);
+
+  return TRUE;
+}
+
+static void
+gst_wavpack_dec_negotiate (GstWavpackDec * dec)
+{
+  GstCaps *caps;
+
+  /* arrange for 1, 2 or 4-byte width == depth output */
+  if (dec->depth == 24)
+    dec->width = 32;
+  else
+    dec->width = dec->depth;
+
+  caps = gst_caps_new_simple ("audio/x-raw-int",
+      "rate", G_TYPE_INT, dec->sample_rate,
+      "channels", G_TYPE_INT, dec->channels,
+      "depth", G_TYPE_INT, dec->width,
+      "width", G_TYPE_INT, dec->width,
+      "endianness", G_TYPE_INT, G_BYTE_ORDER,
+      "signed", G_TYPE_BOOLEAN, TRUE, NULL);
+
+  /* Only set the channel layout for more than two channels
+   * otherwise things break unfortunately */
+  if (dec->channel_mask != 0 && dec->channels > 2)
+    if (!gst_wavpack_set_channel_layout (caps, dec->channel_mask))
+      GST_WARNING_OBJECT (dec, "Failed to set channel layout");
+
+  GST_DEBUG_OBJECT (dec, "setting caps %" GST_PTR_FORMAT, caps);
+
+  /* should always succeed */
+  gst_pad_set_caps (GST_AUDIO_DECODER_SRC_PAD (dec), caps);
+  gst_caps_unref (caps);
+}
+
+static gboolean
+gst_wavpack_dec_set_format (GstAudioDecoder * bdec, GstCaps * caps)
+{
+  GstWavpackDec *dec = GST_WAVPACK_DEC (bdec);
   GstStructure *structure = gst_caps_get_structure (caps, 0);
 
   /* Check if we can set the caps here already */
   if (gst_structure_get_int (structure, "channels", &dec->channels) &&
       gst_structure_get_int (structure, "rate", &dec->sample_rate) &&
       gst_structure_get_int (structure, "width", &dec->depth)) {
-    GstCaps *caps;
     GstAudioChannelPosition *pos;
 
-    caps = gst_caps_new_simple ("audio/x-raw-int",
-        "rate", G_TYPE_INT, dec->sample_rate,
-        "channels", G_TYPE_INT, dec->channels,
-        "depth", G_TYPE_INT, dec->depth,
-        "width", G_TYPE_INT, 32,
-        "endianness", G_TYPE_INT, G_BYTE_ORDER,
-        "signed", G_TYPE_BOOLEAN, TRUE, NULL);
-
     /* If we already have the channel layout set from upstream
      * take this */
     if (gst_structure_has_field (structure, "channel-positions")) {
@@ -202,19 +252,13 @@ gst_wavpack_dec_sink_set_caps (GstPad * pad, GstCaps * caps)
         g_free (pos);
     }
 
-    GST_DEBUG_OBJECT (dec, "setting caps %" GST_PTR_FORMAT, caps);
-
-    /* should always succeed */
-    gst_pad_set_caps (dec->srcpad, caps);
-    gst_caps_unref (caps);
+    gst_wavpack_dec_negotiate (dec);
 
     /* send GST_TAG_AUDIO_CODEC and GST_TAG_BITRATE tags before something
      * is decoded or after the format has changed */
     gst_wavpack_dec_post_tags (dec);
   }
 
-  gst_object_unref (dec);
-
   return TRUE;
 }
 
@@ -225,28 +269,26 @@ gst_wavpack_dec_post_tags (GstWavpackDec * dec)
   GstFormat format_time = GST_FORMAT_TIME, format_bytes = GST_FORMAT_BYTES;
   gint64 duration, size;
 
-  list = gst_tag_list_new ();
-
-  gst_tag_list_add (list, GST_TAG_MERGE_REPLACE,
-      GST_TAG_AUDIO_CODEC, "Wavpack", NULL);
-
   /* try to estimate the average bitrate */
-  if (gst_pad_query_peer_duration (dec->sinkpad, &format_bytes, &size) &&
-      gst_pad_query_peer_duration (dec->sinkpad, &format_time, &duration) &&
-      size > 0 && duration > 0) {
+  if (gst_pad_query_peer_duration (GST_AUDIO_DECODER_SINK_PAD (dec),
+          &format_bytes, &size) &&
+      gst_pad_query_peer_duration (GST_AUDIO_DECODER_SINK_PAD (dec),
+          &format_time, &duration) && size > 0 && duration > 0) {
     guint64 bitrate;
 
+    list = gst_tag_list_new ();
+
     bitrate = gst_util_uint64_scale (size, 8 * GST_SECOND, duration);
     gst_tag_list_add (list, GST_TAG_MERGE_REPLACE, GST_TAG_BITRATE,
         (guint) bitrate, NULL);
-  }
 
-  gst_element_post_message (GST_ELEMENT (dec),
-      gst_message_new_tag (GST_OBJECT (dec), list));
+    gst_element_post_message (GST_ELEMENT (dec),
+        gst_message_new_tag (GST_OBJECT (dec), list));
+  }
 }
 
 static GstFlowReturn
-gst_wavpack_dec_chain (GstPad * pad, GstBuffer * buf)
+gst_wavpack_dec_handle_frame (GstAudioDecoder * bdec, GstBuffer * buf)
 {
   GstWavpackDec *dec;
   GstBuffer *outbuf = NULL;
@@ -254,8 +296,13 @@ gst_wavpack_dec_chain (GstPad * pad, GstBuffer * buf)
   WavpackHeader wph;
   int32_t decoded, unpacked_size;
   gboolean format_changed;
+  gint width, depth, i, max;
+  gint32 *dec_data = NULL;
+  guint8 *out_data;
 
-  dec = GST_WAVPACK_DEC (GST_PAD_PARENT (pad));
+  dec = GST_WAVPACK_DEC (bdec);
+
+  g_return_val_if_fail (buf != NULL, GST_FLOW_ERROR);
 
   /* check input, we only accept framed input with complete chunks */
   if (GST_BUFFER_SIZE (buf) < sizeof (WavpackHeader))
@@ -283,46 +330,31 @@ gst_wavpack_dec_chain (GstPad * pad, GstBuffer * buf)
     dec->context = WavpackOpenFileInputEx (dec->stream_reader,
         &dec->wv_id, NULL, error_msg, OPEN_STREAMING, 0);
 
+    /* expect this to work */
     if (!dec->context) {
-      GST_WARNING ("Couldn't decode buffer: %s", error_msg);
-      dec->error_count++;
-      if (dec->error_count <= WAVPACK_DEC_MAX_ERRORS) {
-        goto out;               /* just return OK for now */
-      } else {
-        goto decode_error;
-      }
+      GST_WARNING_OBJECT (dec, "Couldn't decode buffer: %s", error_msg);
+      goto context_failed;
     }
   }
 
   g_assert (dec->context != NULL);
 
-  dec->error_count = 0;
-
   format_changed =
       (dec->sample_rate != WavpackGetSampleRate (dec->context)) ||
       (dec->channels != WavpackGetNumChannels (dec->context)) ||
-      (dec->depth != WavpackGetBitsPerSample (dec->context)) ||
+      (dec->depth != WavpackGetBytesPerSample (dec->context) * 8) ||
 #ifdef WAVPACK_OLD_API
       (dec->channel_mask != dec->context->config.channel_mask);
 #else
       (dec->channel_mask != WavpackGetChannelMask (dec->context));
 #endif
 
-  if (!GST_PAD_CAPS (dec->srcpad) || format_changed) {
-    GstCaps *caps;
+  if (!GST_PAD_CAPS (GST_AUDIO_DECODER_SRC_PAD (dec)) || format_changed) {
     gint channel_mask;
 
     dec->sample_rate = WavpackGetSampleRate (dec->context);
     dec->channels = WavpackGetNumChannels (dec->context);
-    dec->depth = WavpackGetBitsPerSample (dec->context);
-
-    caps = gst_caps_new_simple ("audio/x-raw-int",
-        "rate", G_TYPE_INT, dec->sample_rate,
-        "channels", G_TYPE_INT, dec->channels,
-        "depth", G_TYPE_INT, dec->depth,
-        "width", G_TYPE_INT, 32,
-        "endianness", G_TYPE_INT, G_BYTE_ORDER,
-        "signed", G_TYPE_BOOLEAN, TRUE, NULL);
+    dec->depth = WavpackGetBytesPerSample (dec->context) * 8;
 
 #ifdef WAVPACK_OLD_API
     channel_mask = dec->context->config.channel_mask;
@@ -334,17 +366,7 @@ gst_wavpack_dec_chain (GstPad * pad, GstBuffer * buf)
 
     dec->channel_mask = channel_mask;
 
-    /* Only set the channel layout for more than two channels
-     * otherwise things break unfortunately */
-    if (channel_mask != 0 && dec->channels > 2)
-      if (!gst_wavpack_set_channel_layout (caps, channel_mask))
-        GST_WARNING_OBJECT (dec, "Failed to set channel layout");
-
-    GST_DEBUG_OBJECT (dec, "setting caps %" GST_PTR_FORMAT, caps);
-
-    /* should always succeed */
-    gst_pad_set_caps (dec->srcpad, caps);
-    gst_caps_unref (caps);
+    gst_wavpack_dec_negotiate (dec);
 
     /* send GST_TAG_AUDIO_CODEC and GST_TAG_BITRATE tags before something
      * is decoded or after the format has changed */
@@ -352,59 +374,82 @@ gst_wavpack_dec_chain (GstPad * pad, GstBuffer * buf)
   }
 
   /* alloc output buffer */
-  unpacked_size = 4 * wph.block_samples * dec->channels;
-  ret = gst_pad_alloc_buffer (dec->srcpad, GST_BUFFER_OFFSET (buf),
-      unpacked_size, GST_PAD_CAPS (dec->srcpad), &outbuf);
+  unpacked_size = (dec->width / 8) * wph.block_samples * dec->channels;
+  ret = gst_pad_alloc_buffer (GST_AUDIO_DECODER_SRC_PAD (dec),
+      GST_BUFFER_OFFSET (buf), unpacked_size,
+      GST_PAD_CAPS (GST_AUDIO_DECODER_SRC_PAD (dec)), &outbuf);
 
   if (ret != GST_FLOW_OK)
     goto out;
 
-  gst_buffer_copy_metadata (outbuf, buf, GST_BUFFER_COPY_TIMESTAMPS);
-
-  /* If we got a DISCONT buffer forward the flag. Nothing else
-   * has to be done as libwavpack doesn't store state between
-   * Wavpack blocks */
-  if (GST_BUFFER_IS_DISCONT (buf) || dec->next_block_index != wph.block_index)
-    GST_BUFFER_FLAG_SET (outbuf, GST_BUFFER_FLAG_DISCONT);
-
-  dec->next_block_index = wph.block_index + wph.block_samples;
+  dec_data = g_malloc (4 * wph.block_samples * dec->channels);
+  out_data = GST_BUFFER_DATA (outbuf);
 
   /* decode */
-  decoded = WavpackUnpackSamples (dec->context,
-      (int32_t *) GST_BUFFER_DATA (outbuf), wph.block_samples);
+  decoded = WavpackUnpackSamples (dec->context, dec_data, wph.block_samples);
   if (decoded != wph.block_samples)
     goto decode_error;
 
-  if ((outbuf = gst_audio_buffer_clip (outbuf, &dec->segment,
-              dec->sample_rate, 4 * dec->channels))) {
-    GST_LOG_OBJECT (dec, "pushing buffer with time %" GST_TIME_FORMAT,
-        GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (outbuf)));
-    ret = gst_pad_push (dec->srcpad, outbuf);
+  width = dec->width;
+  depth = dec->depth;
+  max = dec->channels * wph.block_samples;
+  if (width == 8) {
+    gint8 *outbuffer = (gint8 *) out_data;
+
+    for (i = 0; i < max; i++) {
+      *outbuffer++ = (gint8) (dec_data[i]);
+    }
+  } else if (width == 16) {
+    gint16 *outbuffer = (gint16 *) out_data;
+
+    for (i = 0; i < max; i++) {
+      *outbuffer++ = (gint16) (dec_data[i]);
+    }
+  } else if (dec->width == 32) {
+    gint32 *outbuffer = (gint32 *) out_data;
+
+    if (width != depth) {
+      for (i = 0; i < max; i++) {
+        *outbuffer++ = (gint32) (dec_data[i] << (width - depth));
+      }
+    } else {
+      for (i = 0; i < max; i++) {
+        *outbuffer++ = (gint32) dec_data[i];
+      }
+    }
+  } else {
+    g_assert_not_reached ();
   }
 
+  g_free (dec_data);
+
+  ret = gst_audio_decoder_finish_frame (bdec, outbuf, 1);
+
 out:
 
   if (G_UNLIKELY (ret != GST_FLOW_OK)) {
     GST_DEBUG_OBJECT (dec, "flow: %s", gst_flow_get_name (ret));
   }
 
-  gst_buffer_unref (buf);
-
   return ret;
 
 /* ERRORS */
 input_not_framed:
   {
     GST_ELEMENT_ERROR (dec, STREAM, DECODE, (NULL), ("Expected framed input"));
-    gst_buffer_unref (buf);
     return GST_FLOW_ERROR;
   }
 invalid_header:
   {
     GST_ELEMENT_ERROR (dec, STREAM, DECODE, (NULL), ("Invalid wavpack header"));
-    gst_buffer_unref (buf);
     return GST_FLOW_ERROR;
   }
+context_failed:
+  {
+    GST_AUDIO_DECODER_ERROR (bdec, 1, LIBRARY, INIT, (NULL),
+        ("error creating Wavpack context"), ret);
+    goto out;
+  }
 decode_error:
   {
     const gchar *reason = "unknown";
@@ -418,86 +463,15 @@ decode_error:
     } else {
       reason = "couldn't create decoder context";
     }
-    GST_ELEMENT_ERROR (dec, STREAM, DECODE, (NULL),
-        ("Failed to decode wavpack stream: %s", reason));
+    GST_AUDIO_DECODER_ERROR (bdec, 1, STREAM, DECODE, (NULL),
+        ("decoding error: %s", reason), ret);
+    g_free (dec_data);
     if (outbuf)
       gst_buffer_unref (outbuf);
-    gst_buffer_unref (buf);
-    return GST_FLOW_ERROR;
-  }
-}
-
-static gboolean
-gst_wavpack_dec_sink_event (GstPad * pad, GstEvent * event)
-{
-  GstWavpackDec *dec = GST_WAVPACK_DEC (gst_pad_get_parent (pad));
-
-  GST_LOG_OBJECT (dec, "Received %s event", GST_EVENT_TYPE_NAME (event));
-  switch (GST_EVENT_TYPE (event)) {
-    case GST_EVENT_NEWSEGMENT:{
-      GstFormat fmt;
-      gboolean is_update;
-      gint64 start, end, base;
-      gdouble rate;
-
-      gst_event_parse_new_segment (event, &is_update, &rate, &fmt, &start,
-          &end, &base);
-      if (fmt == GST_FORMAT_TIME) {
-        GST_DEBUG ("Got NEWSEGMENT event in GST_FORMAT_TIME, passing on (%"
-            GST_TIME_FORMAT " - %" GST_TIME_FORMAT ")", GST_TIME_ARGS (start),
-            GST_TIME_ARGS (end));
-        gst_segment_set_newsegment (&dec->segment, is_update, rate, fmt,
-            start, end, base);
-      } else {
-        gst_segment_init (&dec->segment, GST_FORMAT_TIME);
-      }
-      break;
-    }
-    default:
-      break;
-  }
-
-  gst_object_unref (dec);
-  return gst_pad_event_default (pad, event);
-}
-
-static GstStateChangeReturn
-gst_wavpack_dec_change_state (GstElement * element, GstStateChange transition)
-{
-  GstStateChangeReturn ret = GST_STATE_CHANGE_SUCCESS;
-  GstWavpackDec *dec = GST_WAVPACK_DEC (element);
-
-  switch (transition) {
-    case GST_STATE_CHANGE_NULL_TO_READY:
-      break;
-    case GST_STATE_CHANGE_READY_TO_PAUSED:
-      break;
-    case GST_STATE_CHANGE_PAUSED_TO_PLAYING:
-      break;
-    default:
-      break;
-  }
-
-  ret = GST_ELEMENT_CLASS (parent_class)->change_state (element, transition);
-
-  switch (transition) {
-    case GST_STATE_CHANGE_PLAYING_TO_PAUSED:
-      break;
-    case GST_STATE_CHANGE_PAUSED_TO_READY:
-      if (dec->context) {
-        WavpackCloseFile (dec->context);
-        dec->context = NULL;
-      }
-
-      gst_wavpack_dec_reset (dec);
-      break;
-    case GST_STATE_CHANGE_READY_TO_NULL:
-      break;
-    default:
-      break;
+    if (ret == GST_FLOW_OK)
+      gst_audio_decoder_finish_frame (bdec, NULL, 1);
+    return ret;
   }
-
-  return ret;
 }
 
 gboolean
diff --git a/ext/wavpack/gstwavpackdec.h b/ext/wavpack/gstwavpackdec.h
index eb6e4c3..68e8e33 100644
--- a/ext/wavpack/gstwavpackdec.h
+++ b/ext/wavpack/gstwavpackdec.h
@@ -24,6 +24,7 @@
 #define __GST_WAVPACK_DEC_H__
 
 #include <gst/gst.h>
+#include <gst/audio/gstaudiodecoder.h>
 
 #include <wavpack/wavpack.h>
 
@@ -45,31 +46,25 @@ typedef struct _GstWavpackDecClass GstWavpackDecClass;
 
 struct _GstWavpackDec
 {
-  GstElement element;
+  GstAudioDecoder element;
 
   /*< private > */
-  GstPad *sinkpad;
-  GstPad *srcpad;
 
   WavpackContext *context;
   WavpackStreamReader *stream_reader;
 
   read_id wv_id;
 
-  GstSegment segment;           /* used for clipping, TIME format */
-  guint32 next_block_index;
-
   gint sample_rate;
   gint depth;
+  gint width;
   gint channels;
   gint channel_mask;
-
-  gint error_count;
 };
 
 struct _GstWavpackDecClass
 {
-  GstElementClass parent;
+  GstAudioDecoderClass parent;
 };
 
 GType gst_wavpack_dec_get_type (void);
diff --git a/ext/wavpack/gstwavpackenc.c b/ext/wavpack/gstwavpackenc.c
index a22dd23..5094769 100644
--- a/ext/wavpack/gstwavpackenc.c
+++ b/ext/wavpack/gstwavpackenc.c
@@ -55,12 +55,18 @@
 #include "gstwavpackenc.h"
 #include "gstwavpackcommon.h"
 
-static GstFlowReturn gst_wavpack_enc_chain (GstPad * pad, GstBuffer * buffer);
-static gboolean gst_wavpack_enc_sink_set_caps (GstPad * pad, GstCaps * caps);
+static gboolean gst_wavpack_enc_start (GstAudioEncoder * enc);
+static gboolean gst_wavpack_enc_stop (GstAudioEncoder * enc);
+static gboolean gst_wavpack_enc_set_format (GstAudioEncoder * enc,
+    GstAudioInfo * info);
+static GstFlowReturn gst_wavpack_enc_handle_frame (GstAudioEncoder * enc,
+    GstBuffer * in_buf);
+static gboolean gst_wavpack_enc_sink_event (GstAudioEncoder * enc,
+    GstEvent * event);
+
 static int gst_wavpack_enc_push_block (void *id, void *data, int32_t count);
-static gboolean gst_wavpack_enc_sink_event (GstPad * pad, GstEvent * event);
-static GstStateChangeReturn gst_wavpack_enc_change_state (GstElement * element,
-    GstStateChange transition);
+static GstFlowReturn gst_wavpack_enc_drain (GstWavpackEnc * enc);
+
 static void gst_wavpack_enc_set_property (GObject * object, guint prop_id,
     const GValue * value, GParamSpec * pspec);
 static void gst_wavpack_enc_get_property (GObject * object, guint prop_id,
@@ -86,7 +92,7 @@ static GstStaticPadTemplate sink_factory = GST_STATIC_PAD_TEMPLATE ("sink",
     GST_PAD_ALWAYS,
     GST_STATIC_CAPS ("audio/x-raw-int, "
         "width = (int) 32, "
-        "depth = (int) [ 1, 32], "
+        "depth = (int) { 24, 32 }, "
         "endianness = (int) BYTE_ORDER, "
         "channels = (int) [ 1, 8 ], "
         "rate = (int) [ 6000, 192000 ]," "signed = (boolean) TRUE")
@@ -97,7 +103,7 @@ static GstStaticPadTemplate src_factory = GST_STATIC_PAD_TEMPLATE ("src",
     GST_PAD_ALWAYS,
     GST_STATIC_CAPS ("audio/x-wavpack, "
         "width = (int) [ 1, 32 ], "
-        "channels = (int) [ 1, 2 ], "
+        "channels = (int) [ 1, 8 ], "
         "rate = (int) [ 6000, 192000 ], " "framed = (boolean) TRUE")
     );
 
@@ -196,21 +202,8 @@ gst_wavpack_enc_joint_stereo_mode_get_type (void)
   return qtype;
 }
 
-static void
-_do_init (GType object_type)
-{
-  const GInterfaceInfo preset_interface_info = {
-    NULL,                       /* interface_init */
-    NULL,                       /* interface_finalize */
-    NULL                        /* interface_data */
-  };
-
-  g_type_add_interface_static (object_type, GST_TYPE_PRESET,
-      &preset_interface_info);
-}
-
-GST_BOILERPLATE_FULL (GstWavpackEnc, gst_wavpack_enc, GstElement,
-    GST_TYPE_ELEMENT, _do_init);
+GST_BOILERPLATE (GstWavpackEnc, gst_wavpack_enc, GstAudioEncoder,
+    GST_TYPE_AUDIO_ENCODER);
 
 static void
 gst_wavpack_enc_base_init (gpointer klass)
@@ -220,8 +213,7 @@ gst_wavpack_enc_base_init (gpointer klass)
   /* add pad templates */
   gst_element_class_add_static_pad_template (element_class, &sink_factory);
   gst_element_class_add_static_pad_template (element_class, &src_factory);
-  gst_element_class_add_static_pad_template (element_class,
-      &wvcsrc_factory);
+  gst_element_class_add_static_pad_template (element_class, &wvcsrc_factory);
 
   /* set element details */
   gst_element_class_set_details_simple (element_class, "Wavpack audio encoder",
@@ -230,23 +222,24 @@ gst_wavpack_enc_base_init (gpointer klass)
       "Sebastian Dröge <slomo@circular-chaos.org>");
 }
 
-
 static void
 gst_wavpack_enc_class_init (GstWavpackEncClass * klass)
 {
   GObjectClass *gobject_class = (GObjectClass *) klass;
-  GstElementClass *gstelement_class = (GstElementClass *) klass;
+  GstAudioEncoderClass *base_class = (GstAudioEncoderClass *) (klass);
 
   parent_class = g_type_class_peek_parent (klass);
 
-  /* set state change handler */
-  gstelement_class->change_state =
-      GST_DEBUG_FUNCPTR (gst_wavpack_enc_change_state);
-
   /* set property handlers */
   gobject_class->set_property = gst_wavpack_enc_set_property;
   gobject_class->get_property = gst_wavpack_enc_get_property;
 
+  base_class->start = GST_DEBUG_FUNCPTR (gst_wavpack_enc_start);
+  base_class->stop = GST_DEBUG_FUNCPTR (gst_wavpack_enc_stop);
+  base_class->set_format = GST_DEBUG_FUNCPTR (gst_wavpack_enc_set_format);
+  base_class->handle_frame = GST_DEBUG_FUNCPTR (gst_wavpack_enc_handle_frame);
+  base_class->event = GST_DEBUG_FUNCPTR (gst_wavpack_enc_sink_event);
+
   /* install all properties */
   g_object_class_install_property (gobject_class, ARG_MODE,
       g_param_spec_enum ("mode", "Encoding mode",
@@ -304,6 +297,9 @@ gst_wavpack_enc_reset (GstWavpackEnc * enc)
     g_checksum_free (enc->md5_context);
     enc->md5_context = NULL;
   }
+  if (enc->pending_segment)
+    gst_event_unref (enc->pending_segment);
+  enc->pending_segment = NULL;
 
   if (enc->pending_buffer) {
     gst_buffer_unref (enc->pending_buffer);
@@ -330,18 +326,7 @@ gst_wavpack_enc_reset (GstWavpackEnc * enc)
 static void
 gst_wavpack_enc_init (GstWavpackEnc * enc, GstWavpackEncClass * gclass)
 {
-  enc->sinkpad = gst_pad_new_from_static_template (&sink_factory, "sink");
-  gst_pad_set_setcaps_function (enc->sinkpad,
-      GST_DEBUG_FUNCPTR (gst_wavpack_enc_sink_set_caps));
-  gst_pad_set_chain_function (enc->sinkpad,
-      GST_DEBUG_FUNCPTR (gst_wavpack_enc_chain));
-  gst_pad_set_event_function (enc->sinkpad,
-      GST_DEBUG_FUNCPTR (gst_wavpack_enc_sink_event));
-  gst_element_add_pad (GST_ELEMENT (enc), enc->sinkpad);
-
-  /* setup src pad */
-  enc->srcpad = gst_pad_new_from_static_template (&src_factory, "src");
-  gst_element_add_pad (GST_ELEMENT (enc), enc->srcpad);
+  GstAudioEncoder *benc = GST_AUDIO_ENCODER (enc);
 
   /* initialize object attributes */
   enc->wp_config = NULL;
@@ -365,37 +350,51 @@ gst_wavpack_enc_init (GstWavpackEnc * enc, GstWavpackEncClass * gclass)
   enc->md5 = FALSE;
   enc->extra_processing = 0;
   enc->joint_stereo_mode = GST_WAVPACK_JS_MODE_AUTO;
+
+  /* require perfect ts */
+  gst_audio_encoder_set_perfect_timestamp (benc, TRUE);
+}
+
+
+static gboolean
+gst_wavpack_enc_start (GstAudioEncoder * enc)
+{
+  GST_DEBUG_OBJECT (enc, "start");
+
+  return TRUE;
+}
+
+static gboolean
+gst_wavpack_enc_stop (GstAudioEncoder * enc)
+{
+  GstWavpackEnc *wpenc = GST_WAVPACK_ENC (enc);
+
+  GST_DEBUG_OBJECT (enc, "stop");
+  gst_wavpack_enc_reset (wpenc);
+
+  return TRUE;
 }
 
 static gboolean
-gst_wavpack_enc_sink_set_caps (GstPad * pad, GstCaps * caps)
+gst_wavpack_enc_set_format (GstAudioEncoder * benc, GstAudioInfo * info)
 {
-  GstWavpackEnc *enc = GST_WAVPACK_ENC (gst_pad_get_parent (pad));
-  GstStructure *structure = gst_caps_get_structure (caps, 0);
+  GstWavpackEnc *enc = GST_WAVPACK_ENC (benc);
   GstAudioChannelPosition *pos;
+  GstCaps *caps;
 
-  if (!gst_structure_get_int (structure, "channels", &enc->channels) ||
-      !gst_structure_get_int (structure, "rate", &enc->samplerate) ||
-      !gst_structure_get_int (structure, "depth", &enc->depth)) {
-    GST_ELEMENT_ERROR (enc, LIBRARY, INIT, (NULL),
-        ("got invalid caps: %" GST_PTR_FORMAT, caps));
-    gst_object_unref (enc);
-    return FALSE;
-  }
+  /* we may be configured again, but that change should have cleanup context */
+  g_assert (enc->wp_context == NULL);
 
-  pos = gst_audio_get_channel_positions (structure);
-  /* If one channel is NONE they'll be all undefined */
-  if (pos != NULL && pos[0] == GST_AUDIO_CHANNEL_POSITION_NONE) {
-    g_free (pos);
-    pos = NULL;
-  }
+  enc->channels = GST_AUDIO_INFO_CHANNELS (info);
+  enc->depth = GST_AUDIO_INFO_DEPTH (info);
+  enc->samplerate = GST_AUDIO_INFO_RATE (info);
 
-  if (pos == NULL) {
-    GST_ELEMENT_ERROR (enc, STREAM, FORMAT, (NULL),
-        ("input has no valid channel layout"));
+  pos = info->position;
+  g_assert (pos);
 
-    gst_object_unref (enc);
-    return FALSE;
+  /* If one channel is NONE they'll be all undefined */
+  if (pos != NULL && pos[0] == GST_AUDIO_CHANNEL_POSITION_NONE) {
+    goto invalid_channels;
   }
 
   enc->channel_mask =
@@ -403,7 +402,6 @@ gst_wavpack_enc_sink_set_caps (GstPad * pad, GstCaps * caps)
   enc->need_channel_remap =
       gst_wavpack_set_channel_mapping (pos, enc->channels,
       enc->channel_mapping);
-  g_free (pos);
 
   /* set fixed src pad caps now that we know what we will get */
   caps = gst_caps_new_simple ("audio/x-wavpack",
@@ -414,18 +412,28 @@ gst_wavpack_enc_sink_set_caps (GstPad * pad, GstCaps * caps)
   if (!gst_wavpack_set_channel_layout (caps, enc->channel_mask))
     GST_WARNING_OBJECT (enc, "setting channel layout failed");
 
-  if (!gst_pad_set_caps (enc->srcpad, caps)) {
-    GST_ELEMENT_ERROR (enc, LIBRARY, INIT, (NULL),
-        ("setting caps failed: %" GST_PTR_FORMAT, caps));
-    gst_caps_unref (caps);
-    gst_object_unref (enc);
-    return FALSE;
-  }
-  gst_pad_use_fixed_caps (enc->srcpad);
+  if (!gst_pad_set_caps (GST_AUDIO_ENCODER_SRC_PAD (enc), caps))
+    goto setting_src_caps_failed;
 
   gst_caps_unref (caps);
-  gst_object_unref (enc);
+
+  /* no special feedback to base class; should provide all available samples */
+
   return TRUE;
+
+  /* ERRORS */
+setting_src_caps_failed:
+  {
+    GST_DEBUG_OBJECT (enc,
+        "Couldn't set caps on source pad: %" GST_PTR_FORMAT, caps);
+    gst_caps_unref (caps);
+    return FALSE;
+  }
+invalid_channels:
+  {
+    GST_DEBUG_OBJECT (enc, "input has invalid channel layout");
+    return FALSE;
+  }
 }
 
 static void
@@ -547,21 +555,14 @@ gst_wavpack_enc_push_block (void *id, void *data, int32_t count)
   GstBuffer *buffer;
   GstPad *pad;
   guchar *block = (guchar *) data;
+  gint samples = 0;
 
-  pad = (wid->correction) ? enc->wvcsrcpad : enc->srcpad;
+  pad = (wid->correction) ? enc->wvcsrcpad : GST_AUDIO_ENCODER_SRC_PAD (enc);
   flow =
       (wid->correction) ? &enc->wvcsrcpad_last_return : &enc->
       srcpad_last_return;
 
-  *flow = gst_pad_alloc_buffer_and_set_caps (pad, GST_BUFFER_OFFSET_NONE,
-      count, GST_PAD_CAPS (pad), &buffer);
-
-  if (*flow != GST_FLOW_OK) {
-    GST_WARNING_OBJECT (enc, "flow on %s:%s = %s",
-        GST_DEBUG_PAD_NAME (pad), gst_flow_get_name (*flow));
-    return FALSE;
-  }
-
+  buffer = gst_buffer_new_and_alloc (count);
   g_memmove (GST_BUFFER_DATA (buffer), block, count);
 
   if (count > sizeof (WavpackHeader) && memcmp (block, "wvpk", 4) == 0) {
@@ -597,12 +598,14 @@ gst_wavpack_enc_push_block (void *id, void *data, int32_t count)
       enc->pending_buffer = NULL;
       enc->pending_offset = 0;
 
-      /* if it's the first wavpack block, send a NEW_SEGMENT event */
-      if (wph.block_index == 0) {
-        gst_pad_push_event (pad,
-            gst_event_new_new_segment (FALSE,
-                1.0, GST_FORMAT_TIME, 0, GST_BUFFER_OFFSET_NONE, 0));
+      /* only send segment on correction pad,
+       * regular pad is handled normally by baseclass */
+      if (wid->correction && enc->pending_segment) {
+        gst_pad_push_event (pad, enc->pending_segment);
+        enc->pending_segment = NULL;
+      }
 
+      if (wph.block_index == 0) {
         /* save header for later reference, so we can re-send it later on
          * EOS with fixed up values for total sample count etc. */
         if (enc->first_block == NULL && !wid->correction) {
@@ -612,29 +615,30 @@ gst_wavpack_enc_push_block (void *id, void *data, int32_t count)
         }
       }
     }
+    samples = wph.block_samples;
 
-    /* set buffer timestamp, duration, offset, offset_end from
-     * the wavpack header */
-    GST_BUFFER_TIMESTAMP (buffer) = enc->timestamp_offset +
-        gst_util_uint64_scale_int (GST_SECOND, wph.block_index,
-        enc->samplerate);
-    GST_BUFFER_DURATION (buffer) =
-        gst_util_uint64_scale_int (GST_SECOND, wph.block_samples,
-        enc->samplerate);
+    /* decorate buffer */
+    /* NOTE: this will get overwritten by baseclass, but stay for those
+     * that are pushed directly
+     * FIXME: add setting to baseclass to avoid overwriting it ?? */
     GST_BUFFER_OFFSET (buffer) = wph.block_index;
     GST_BUFFER_OFFSET_END (buffer) = wph.block_index + wph.block_samples;
   } else {
     /* if it's something else set no timestamp and duration on the buffer */
     GST_DEBUG_OBJECT (enc, "got %d bytes of unknown data", count);
-
-    GST_BUFFER_TIMESTAMP (buffer) = GST_CLOCK_TIME_NONE;
-    GST_BUFFER_DURATION (buffer) = GST_CLOCK_TIME_NONE;
   }
 
-  /* push the buffer and forward errors */
-  GST_DEBUG_OBJECT (enc, "pushing buffer with %d bytes",
-      GST_BUFFER_SIZE (buffer));
-  *flow = gst_pad_push (pad, buffer);
+  if (wid->correction || wid->passthrough) {
+    /* push the buffer and forward errors */
+    GST_DEBUG_OBJECT (enc, "pushing buffer with %d bytes",
+        GST_BUFFER_SIZE (buffer));
+    *flow = gst_pad_push (pad, buffer);
+  } else {
+    GST_DEBUG_OBJECT (enc, "handing frame of %d bytes",
+        GST_BUFFER_SIZE (buffer));
+    *flow = gst_audio_encoder_finish_frame (GST_AUDIO_ENCODER (enc), buffer,
+        samples);
+  }
 
   if (*flow != GST_FLOW_OK) {
     GST_WARNING_OBJECT (enc, "flow on %s:%s = %s",
@@ -664,18 +668,25 @@ gst_wavpack_enc_fix_channel_order (GstWavpackEnc * enc, gint32 * data,
 }
 
 static GstFlowReturn
-gst_wavpack_enc_chain (GstPad * pad, GstBuffer * buf)
+gst_wavpack_enc_handle_frame (GstAudioEncoder * benc, GstBuffer * buf)
 {
-  GstWavpackEnc *enc = GST_WAVPACK_ENC (gst_pad_get_parent (pad));
-  uint32_t sample_count = GST_BUFFER_SIZE (buf) / 4;
+  GstWavpackEnc *enc = GST_WAVPACK_ENC (benc);
+  uint32_t sample_count;
   GstFlowReturn ret;
 
+  /* base class ensures configuration */
+  g_return_val_if_fail (enc->depth != 0, GST_FLOW_NOT_NEGOTIATED);
+
   /* reset the last returns to GST_FLOW_OK. This is only set to something else
    * while WavpackPackSamples() or more specific gst_wavpack_enc_push_block()
    * so not valid anymore */
   enc->srcpad_last_return = enc->wvcsrcpad_last_return = GST_FLOW_OK;
 
-  GST_DEBUG ("got %u raw samples", sample_count);
+  if (G_UNLIKELY (!buf))
+    return gst_wavpack_enc_drain (enc);
+
+  sample_count = GST_BUFFER_SIZE (buf) / 4;
+  GST_DEBUG_OBJECT (enc, "got %u raw samples", sample_count);
 
   /* check if we already have a valid WavpackContext, otherwise make one */
   if (!enc->wp_context) {
@@ -683,13 +694,8 @@ gst_wavpack_enc_chain (GstPad * pad, GstBuffer * buf)
     enc->wp_context =
         WavpackOpenFileOutput (gst_wavpack_enc_push_block, &enc->wv_id,
         (enc->correction_mode > 0) ? &enc->wvc_id : NULL);
-    if (!enc->wp_context) {
-      GST_ELEMENT_ERROR (enc, LIBRARY, INIT, (NULL),
-          ("error creating Wavpack context"));
-      gst_object_unref (enc);
-      gst_buffer_unref (buf);
-      return GST_FLOW_ERROR;
-    }
+    if (!enc->wp_context)
+      goto context_failed;
 
     /* set the WavpackConfig according to our parameters */
     gst_wavpack_enc_set_wp_config (enc);
@@ -699,76 +705,12 @@ gst_wavpack_enc_chain (GstPad * pad, GstBuffer * buf)
     if (!WavpackSetConfiguration (enc->wp_context,
             enc->wp_config, (uint32_t) (-1))
         || !WavpackPackInit (enc->wp_context)) {
-      GST_ELEMENT_ERROR (enc, LIBRARY, SETTINGS, (NULL),
-          ("error setting up wavpack encoding context"));
       WavpackCloseFile (enc->wp_context);
-      gst_object_unref (enc);
-      gst_buffer_unref (buf);
-      return GST_FLOW_ERROR;
-    }
-    GST_DEBUG ("setup of encoding context successfull");
-  }
-
-  /* Save the timestamp of the first buffer. This will be later
-   * used as offset for all following buffers */
-  if (enc->timestamp_offset == GST_CLOCK_TIME_NONE) {
-    if (GST_BUFFER_TIMESTAMP_IS_VALID (buf)) {
-      enc->timestamp_offset = GST_BUFFER_TIMESTAMP (buf);
-      enc->next_ts = GST_BUFFER_TIMESTAMP (buf);
-    } else {
-      enc->timestamp_offset = 0;
-      enc->next_ts = 0;
-    }
-  }
-
-  /* Check if we have a continous stream, if not drop some samples or the buffer or
-   * insert some silence samples */
-  if (enc->next_ts != GST_CLOCK_TIME_NONE &&
-      GST_BUFFER_TIMESTAMP (buf) < enc->next_ts) {
-    guint64 diff = enc->next_ts - GST_BUFFER_TIMESTAMP (buf);
-    guint64 diff_bytes;
-
-    GST_WARNING_OBJECT (enc, "Buffer is older than previous "
-        "timestamp + duration (%" GST_TIME_FORMAT "< %" GST_TIME_FORMAT
-        "), cannot handle. Clipping buffer.",
-        GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (buf)),
-        GST_TIME_ARGS (enc->next_ts));
-
-    diff_bytes =
-        GST_CLOCK_TIME_TO_FRAMES (diff, enc->samplerate) * enc->channels * 2;
-    if (diff_bytes >= GST_BUFFER_SIZE (buf)) {
-      gst_buffer_unref (buf);
-      return GST_FLOW_OK;
-    }
-    buf = gst_buffer_make_metadata_writable (buf);
-    GST_BUFFER_DATA (buf) += diff_bytes;
-    GST_BUFFER_SIZE (buf) -= diff_bytes;
-
-    GST_BUFFER_TIMESTAMP (buf) += diff;
-    if (GST_BUFFER_DURATION_IS_VALID (buf))
-      GST_BUFFER_DURATION (buf) -= diff;
-  }
-
-  /* Allow a diff of at most 5 ms */
-  if (enc->next_ts != GST_CLOCK_TIME_NONE
-      && GST_BUFFER_TIMESTAMP_IS_VALID (buf)) {
-    if (GST_BUFFER_TIMESTAMP (buf) != enc->next_ts &&
-        GST_BUFFER_TIMESTAMP (buf) - enc->next_ts > 5 * GST_MSECOND) {
-      GST_WARNING_OBJECT (enc,
-          "Discontinuity detected: %" G_GUINT64_FORMAT " > %" G_GUINT64_FORMAT,
-          GST_BUFFER_TIMESTAMP (buf) - enc->next_ts, 5 * GST_MSECOND);
-
-      WavpackFlushSamples (enc->wp_context);
-      enc->timestamp_offset += (GST_BUFFER_TIMESTAMP (buf) - enc->next_ts);
+      goto config_failed;
     }
+    GST_DEBUG_OBJECT (enc, "setup of encoding context successfull");
   }
 
-  if (GST_BUFFER_TIMESTAMP_IS_VALID (buf)
-      && GST_BUFFER_DURATION_IS_VALID (buf))
-    enc->next_ts = GST_BUFFER_TIMESTAMP (buf) + GST_BUFFER_DURATION (buf);
-  else
-    enc->next_ts = GST_CLOCK_TIME_NONE;
-
   if (enc->need_channel_remap) {
     buf = gst_buffer_make_writable (buf);
     gst_wavpack_enc_fix_channel_order (enc, (gint32 *) GST_BUFFER_DATA (buf),
@@ -785,7 +727,7 @@ gst_wavpack_enc_chain (GstPad * pad, GstBuffer * buf)
   /* encode and handle return values from encoding */
   if (WavpackPackSamples (enc->wp_context, (int32_t *) GST_BUFFER_DATA (buf),
           sample_count / enc->channels)) {
-    GST_DEBUG ("encoding samples successful");
+    GST_DEBUG_OBJECT (enc, "encoding samples successful");
     ret = GST_FLOW_OK;
   } else {
     if ((enc->srcpad_last_return == GST_FLOW_RESEND) ||
@@ -801,15 +743,35 @@ gst_wavpack_enc_chain (GstPad * pad, GstBuffer * buf)
         (enc->wvcsrcpad_last_return == GST_FLOW_WRONG_STATE)) {
       ret = GST_FLOW_WRONG_STATE;
     } else {
-      GST_ELEMENT_ERROR (enc, LIBRARY, ENCODE, (NULL),
-          ("encoding samples failed"));
-      ret = GST_FLOW_ERROR;
+      goto encoding_failed;
     }
   }
 
-  gst_buffer_unref (buf);
-  gst_object_unref (enc);
+exit:
   return ret;
+
+  /* ERRORS */
+encoding_failed:
+  {
+    GST_ELEMENT_ERROR (enc, LIBRARY, ENCODE, (NULL),
+        ("encoding samples failed"));
+    ret = GST_FLOW_ERROR;
+    goto exit;
+  }
+config_failed:
+  {
+    GST_ELEMENT_ERROR (enc, LIBRARY, SETTINGS, (NULL),
+        ("error setting up wavpack encoding context"));
+    ret = GST_FLOW_ERROR;
+    goto exit;
+  }
+context_failed:
+  {
+    GST_ELEMENT_ERROR (enc, LIBRARY, INIT, (NULL),
+        ("error creating Wavpack context"));
+    ret = GST_FLOW_ERROR;
+    goto exit;
+  }
 }
 
 static void
@@ -826,7 +788,7 @@ gst_wavpack_enc_rewrite_first_block (GstWavpackEnc * enc)
   WavpackUpdateNumSamples (enc->wp_context, enc->first_block);
 
   /* try to seek to the beginning of the output */
-  ret = gst_pad_push_event (enc->srcpad, event);
+  ret = gst_pad_push_event (GST_AUDIO_ENCODER_SRC_PAD (enc), event);
   if (ret) {
     /* try to rewrite the first block */
     GST_DEBUG_OBJECT (enc, "rewriting first block ...");
@@ -834,111 +796,84 @@ gst_wavpack_enc_rewrite_first_block (GstWavpackEnc * enc)
     ret = gst_wavpack_enc_push_block (&enc->wv_id,
         enc->first_block, enc->first_block_size);
     enc->wv_id.passthrough = FALSE;
+    g_free (enc->first_block);
+    enc->first_block = NULL;
   } else {
     GST_WARNING_OBJECT (enc, "rewriting of first block failed. "
         "Seeking to first block failed!");
   }
 }
 
-static gboolean
-gst_wavpack_enc_sink_event (GstPad * pad, GstEvent * event)
+static GstFlowReturn
+gst_wavpack_enc_drain (GstWavpackEnc * enc)
 {
-  GstWavpackEnc *enc = GST_WAVPACK_ENC (gst_pad_get_parent (pad));
-  gboolean ret = TRUE;
+  if (!enc->wp_context)
+    return GST_FLOW_OK;
 
-  GST_DEBUG ("Received %s event on sinkpad", GST_EVENT_TYPE_NAME (event));
+  GST_DEBUG_OBJECT (enc, "draining");
 
-  switch (GST_EVENT_TYPE (event)) {
-    case GST_EVENT_EOS:
-      /* Encode all remaining samples and flush them to the src pads */
-      WavpackFlushSamples (enc->wp_context);
-
-      /* Drop all remaining data, this is no complete block otherwise
-       * it would've been pushed already */
-      if (enc->pending_buffer) {
-        gst_buffer_unref (enc->pending_buffer);
-        enc->pending_buffer = NULL;
-        enc->pending_offset = 0;
-      }
+  /* Encode all remaining samples and flush them to the src pads */
+  WavpackFlushSamples (enc->wp_context);
 
-      /* write the MD5 sum if we have to write one */
-      if ((enc->md5) && (enc->md5_context)) {
-        guint8 md5_digest[16];
-        gsize digest_len = sizeof (md5_digest);
+  /* Drop all remaining data, this is no complete block otherwise
+   * it would've been pushed already */
+  if (enc->pending_buffer) {
+    gst_buffer_unref (enc->pending_buffer);
+    enc->pending_buffer = NULL;
+    enc->pending_offset = 0;
+  }
 
-        g_checksum_get_digest (enc->md5_context, md5_digest, &digest_len);
-        if (digest_len == sizeof (md5_digest))
-          WavpackStoreMD5Sum (enc->wp_context, md5_digest);
-        else
-          GST_WARNING_OBJECT (enc, "Calculating MD5 digest failed");
-      }
+  /* write the MD5 sum if we have to write one */
+  if ((enc->md5) && (enc->md5_context)) {
+    guint8 md5_digest[16];
+    gsize digest_len = sizeof (md5_digest);
 
-      /* Try to rewrite the first frame with the correct sample number */
-      if (enc->first_block)
-        gst_wavpack_enc_rewrite_first_block (enc);
+    g_checksum_get_digest (enc->md5_context, md5_digest, &digest_len);
+    if (digest_len == sizeof (md5_digest)) {
+      WavpackStoreMD5Sum (enc->wp_context, md5_digest);
+      WavpackFlushSamples (enc->wp_context);
+    } else
+      GST_WARNING_OBJECT (enc, "Calculating MD5 digest failed");
+  }
 
-      /* close the context if not already happened */
-      if (enc->wp_context) {
-        WavpackCloseFile (enc->wp_context);
-        enc->wp_context = NULL;
-      }
+  /* Try to rewrite the first frame with the correct sample number */
+  if (enc->first_block)
+    gst_wavpack_enc_rewrite_first_block (enc);
 
-      ret = gst_pad_event_default (pad, event);
-      break;
-    case GST_EVENT_NEWSEGMENT:
-      if (enc->wp_context) {
-        GST_WARNING_OBJECT (enc, "got NEWSEGMENT after encoding "
-            "already started");
-      }
-      /* drop NEWSEGMENT events, we create our own when pushing
-       * the first buffer to the pads */
-      gst_event_unref (event);
-      ret = TRUE;
-      break;
-    default:
-      ret = gst_pad_event_default (pad, event);
-      break;
+  /* close the context if not already happened */
+  if (enc->wp_context) {
+    WavpackCloseFile (enc->wp_context);
+    enc->wp_context = NULL;
   }
 
-  gst_object_unref (enc);
-  return ret;
+  return GST_FLOW_OK;
 }
 
-static GstStateChangeReturn
-gst_wavpack_enc_change_state (GstElement * element, GstStateChange transition)
+static gboolean
+gst_wavpack_enc_sink_event (GstAudioEncoder * benc, GstEvent * event)
 {
-  GstStateChangeReturn ret = GST_STATE_CHANGE_SUCCESS;
-  GstWavpackEnc *enc = GST_WAVPACK_ENC (element);
-
-  switch (transition) {
-    case GST_STATE_CHANGE_NULL_TO_READY:
-      /* set the last returned GstFlowReturns of the two pads to GST_FLOW_OK
-       * as they're only set to something else in WavpackPackSamples() or more
-       * specific gst_wavpack_enc_push_block() and nothing happened there yet */
-      enc->srcpad_last_return = enc->wvcsrcpad_last_return = GST_FLOW_OK;
-      break;
-    case GST_STATE_CHANGE_READY_TO_PAUSED:
-      break;
-    case GST_STATE_CHANGE_PAUSED_TO_PLAYING:
-    default:
-      break;
-  }
+  GstWavpackEnc *enc = GST_WAVPACK_ENC (benc);
 
-  ret = GST_ELEMENT_CLASS (parent_class)->change_state (element, transition);
+  GST_DEBUG_OBJECT (enc, "Received %s event on sinkpad",
+      GST_EVENT_TYPE_NAME (event));
 
-  switch (transition) {
-    case GST_STATE_CHANGE_PLAYING_TO_PAUSED:
-      break;
-    case GST_STATE_CHANGE_PAUSED_TO_READY:
-      gst_wavpack_enc_reset (enc);
-      break;
-    case GST_STATE_CHANGE_READY_TO_NULL:
+  switch (GST_EVENT_TYPE (event)) {
+    case GST_EVENT_NEWSEGMENT:
+      if (enc->wp_context) {
+        GST_WARNING_OBJECT (enc, "got NEWSEGMENT after encoding "
+            "already started");
+      }
+      /* peek and hold NEWSEGMENT events for sending on correction pad */
+      if (enc->pending_segment)
+        gst_event_unref (enc->pending_segment);
+      enc->pending_segment = gst_event_ref (event);
       break;
     default:
       break;
   }
 
-  return ret;
+  /* baseclass handles rest */
+  return FALSE;
 }
 
 static void
diff --git a/ext/wavpack/gstwavpackenc.h b/ext/wavpack/gstwavpackenc.h
index d2df844..aab4296 100644
--- a/ext/wavpack/gstwavpackenc.h
+++ b/ext/wavpack/gstwavpackenc.h
@@ -23,6 +23,7 @@
 #define __GST_WAVPACK_ENC_H__
 
 #include <gst/gst.h>
+#include <gst/audio/gstaudioencoder.h>
 
 #include <wavpack/wavpack.h>
 
@@ -50,10 +51,9 @@ typedef struct
 
 struct _GstWavpackEnc
 {
-  GstElement element;
+  GstAudioEncoder element;
 
   /*< private > */
-  GstPad *sinkpad, *srcpad;
   GstPad *wvcsrcpad;
 
   GstFlowReturn srcpad_last_return;
@@ -86,6 +86,7 @@ struct _GstWavpackEnc
 
   GstBuffer *pending_buffer;
   gint32 pending_offset;
+  GstEvent *pending_segment;
 
   GstClockTime timestamp_offset;
   GstClockTime next_ts;
@@ -93,7 +94,7 @@ struct _GstWavpackEnc
 
 struct _GstWavpackEncClass
 {
-  GstElementClass parent;
+  GstAudioEncoderClass parent;
 };
 
 GType gst_wavpack_enc_get_type (void);
diff --git a/ext/wavpack/gstwavpackparse.c b/ext/wavpack/gstwavpackparse.c
index e1ff785..e3625c5 100644
--- a/ext/wavpack/gstwavpackparse.c
+++ b/ext/wavpack/gstwavpackparse.c
@@ -121,8 +121,7 @@ gst_wavpack_parse_base_init (gpointer klass)
   GstElementClass *element_class = GST_ELEMENT_CLASS (klass);
 
   gst_element_class_add_static_pad_template (element_class, &src_factory);
-  gst_element_class_add_static_pad_template (element_class,
-      &wvc_src_factory);
+  gst_element_class_add_static_pad_template (element_class, &wvc_src_factory);
   gst_element_class_add_static_pad_template (element_class, &sink_factory);
 
   gst_element_class_set_details_simple (element_class, "Wavpack parser",
@@ -144,7 +143,6 @@ static void
 gst_wavpack_parse_class_init (GstWavpackParseClass * klass)
 {
   GObjectClass *gobject_class;
-
   GstElementClass *gstelement_class;
 
   gobject_class = (GObjectClass *) klass;
@@ -168,7 +166,6 @@ gst_wavpack_parse_index_get_entry_from_sample (GstWavpackParse * wvparse,
     gint64 sample_offset)
 {
   gint i;
-
   GSList *node;
 
   if (wvparse->entries == NULL)
@@ -289,9 +286,7 @@ static gboolean
 gst_wavpack_parse_src_query (GstPad * pad, GstQuery * query)
 {
   GstWavpackParse *parse = GST_WAVPACK_PARSE (gst_pad_get_parent (pad));
-
   GstFormat format;
-
   gboolean ret = FALSE;
 
   switch (GST_QUERY_TYPE (query)) {
@@ -411,9 +406,7 @@ gst_wavpack_parse_scan_to_find_sample (GstWavpackParse * parse,
     gint64 sample, gint64 * byte_offset, gint64 * start_sample)
 {
   GstWavpackParseIndexEntry *entry;
-
   GstFlowReturn ret;
-
   gint64 off = 0;
 
   /* first, check if we have to scan at all */
@@ -441,7 +434,6 @@ gst_wavpack_parse_scan_to_find_sample (GstWavpackParse * parse,
   /* now scan forward until we find the chunk we're looking for or hit EOS */
   do {
     WavpackHeader header;
-
     GstBuffer *buf;
 
     buf = gst_wavpack_parse_pull_buffer (parse, off, sizeof (WavpackHeader),
@@ -481,13 +473,9 @@ gst_wavpack_parse_send_newsegment (GstWavpackParse * wvparse, gboolean update)
   GstSegment *s = &wvparse->segment;
 
   gboolean ret;
-
   gint64 stop_time = -1;
-
   gint64 start_time = 0;
-
   gint64 cur_pos_time;
-
   gint64 diff;
 
   /* segment is in DEFAULT format, but we want to send a TIME newsegment */
@@ -524,31 +512,18 @@ gst_wavpack_parse_handle_seek_event (GstWavpackParse * wvparse,
     GstEvent * event)
 {
   GstSeekFlags seek_flags;
-
   GstSeekType start_type;
-
   GstSeekType stop_type;
-
   GstSegment segment;
-
   GstFormat format;
-
   gboolean only_update;
-
   gboolean flush, ret;
-
   gdouble speed;
-
   gint64 stop;
-
   gint64 start;                 /* sample we want to seek to                  */
-
   gint64 byte_offset;           /* byte offset the chunk we seek to starts at */
-
   gint64 chunk_start;           /* first sample in chunk we seek to           */
-
   guint rate;
-
   gint64 last_stop;
 
   if (wvparse->adapter) {
@@ -674,7 +649,6 @@ static gboolean
 gst_wavpack_parse_sink_event (GstPad * pad, GstEvent * event)
 {
   GstWavpackParse *parse;
-
   gboolean ret = TRUE;
 
   parse = GST_WAVPACK_PARSE (gst_pad_get_parent (pad));
@@ -733,7 +707,6 @@ static gboolean
 gst_wavpack_parse_src_event (GstPad * pad, GstEvent * event)
 {
   GstWavpackParse *parse;
-
   gboolean ret;
 
   parse = GST_WAVPACK_PARSE (gst_pad_get_parent (pad));
@@ -755,7 +728,6 @@ static void
 gst_wavpack_parse_init (GstWavpackParse * parse, GstWavpackParseClass * gclass)
 {
   GstElementClass *klass = GST_ELEMENT_GET_CLASS (parse);
-
   GstPadTemplate *tmpl;
 
   tmpl = gst_element_class_get_pad_template (klass, "sink");
@@ -780,7 +752,6 @@ static gint64
 gst_wavpack_parse_get_upstream_length (GstWavpackParse * parse)
 {
   gint64 length = -1;
-
   GstFormat format = GST_FORMAT_BYTES;
 
   if (!gst_pad_query_peer_duration (parse->sinkpad, &format, &length)) {
@@ -796,7 +767,6 @@ gst_wavpack_parse_pull_buffer (GstWavpackParse * wvparse, gint64 offset,
     guint size, GstFlowReturn * flow)
 {
   GstFlowReturn flow_ret;
-
   GstBuffer *buf = NULL;
 
   if (offset + size > wvparse->upstream_length) {
@@ -837,9 +807,7 @@ gst_wavpack_parse_create_src_pad (GstWavpackParse * wvparse, GstBuffer * buf,
     WavpackHeader * header)
 {
   GstWavpackMetadata meta;
-
   GstCaps *caps = NULL;
-
   guchar *bufptr;
 
   g_assert (wvparse->srcpad == NULL);
@@ -954,8 +922,8 @@ gst_wavpack_parse_push_buffer (GstWavpackParse * wvparse, GstBuffer * buf,
     WavpackHeader * header)
 {
   GstFlowReturn ret;
-  wvparse->current_offset += header->ckSize + 8;
 
+  wvparse->current_offset += header->ckSize + 8;
   wvparse->segment.last_stop = header->block_index;
 
   if (wvparse->need_newsegment) {
@@ -1021,8 +989,7 @@ gst_wavpack_parse_push_buffer (GstWavpackParse * wvparse, GstBuffer * buf,
 static guint8 *
 gst_wavpack_parse_find_marker (guint8 * buf, guint size)
 {
-  int i;
-
+  gint i;
   guint8 *ret = NULL;
 
   if (G_UNLIKELY (size < 4))
@@ -1041,7 +1008,6 @@ static GstFlowReturn
 gst_wavpack_parse_resync_loop (GstWavpackParse * parse, WavpackHeader * header)
 {
   GstFlowReturn flow_ret = GST_FLOW_UNEXPECTED;
-
   GstBuffer *buf = NULL;
 
   /* loop until we have a frame header or reach the end of the stream */
@@ -1108,7 +1074,6 @@ static void
 gst_wavpack_parse_loop (GstElement * element)
 {
   GstWavpackParse *parse = GST_WAVPACK_PARSE (element);
-
   GstFlowReturn flow_ret;
   WavpackHeader header = { {0,}, 0, };
   GstBuffer *buf = NULL;
@@ -1183,7 +1148,6 @@ static gboolean
 gst_wavpack_parse_resync_adapter (GstAdapter * adapter)
 {
   const guint8 *buf, *marker;
-
   guint avail = gst_adapter_available (adapter);
 
   if (avail < 4)
@@ -1215,11 +1179,8 @@ static GstFlowReturn
 gst_wavpack_parse_chain (GstPad * pad, GstBuffer * buf)
 {
   GstWavpackParse *wvparse = GST_WAVPACK_PARSE (GST_PAD_PARENT (pad));
-
   GstFlowReturn ret = GST_FLOW_OK;
-
   WavpackHeader wph;
-
   const guint8 *tmp_buf;
 
   if (!wvparse->adapter) {
@@ -1279,7 +1240,6 @@ static GstStateChangeReturn
 gst_wavpack_parse_change_state (GstElement * element, GstStateChange transition)
 {
   GstWavpackParse *wvparse = GST_WAVPACK_PARSE (element);
-
   GstStateChangeReturn ret = GST_STATE_CHANGE_SUCCESS;
 
   switch (transition) {
diff --git a/ext/wavpack/gstwavpackstreamreader.c b/ext/wavpack/gstwavpackstreamreader.c
index 074a2e7..da1fdc2 100644
--- a/ext/wavpack/gstwavpackstreamreader.c
+++ b/ext/wavpack/gstwavpackstreamreader.c
@@ -78,9 +78,10 @@ gst_wavpack_stream_reader_push_back_byte (void *id, int c)
 
   GST_DEBUG ("Pushing back one byte: 0x%x", c);
 
+  if (rid->position == 0)
+    return rid->position;
+
   rid->position -= 1;
-  if (rid->position < 0)
-    rid->position = 0;
   return rid->position;
 }
 
diff --git a/gconf/Makefile.in b/gconf/Makefile.in
index d9d53b2..1c482ac 100644
--- a/gconf/Makefile.in
+++ b/gconf/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,6 +50,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gconf
 DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
 	$(srcdir)/gstreamer.schemas.in
@@ -42,7 +59,6 @@ am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -80,14 +96,25 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES = gstreamer.schemas
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
 am__vpath_adj = case $$p in \
     $(srcdir)/*) f=`echo "$$p" | sed "s|^$$srcdirstrip/||"`;; \
@@ -173,6 +200,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -221,8 +249,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -303,7 +333,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -363,6 +393,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -436,7 +467,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -488,8 +523,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-schemaDATA: $(schema_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(schemadir)" || $(MKDIR_P) "$(DESTDIR)$(schemadir)"
 	@list='$(schema_DATA)'; test -n "$(schemadir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(schemadir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(schemadir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -510,6 +548,8 @@ TAGS:
 ctags: CTAGS
 CTAGS:
 
+cscope cscopelist:
+
 
 distdir: $(DISTFILES)
 	@srcdirstrip=`echo "$(srcdir)" | sed 's/[].[^$$\\*]/\\\\&/g'`; \
diff --git a/gconf/gstreamer-0.10.schemas b/gconf/gstreamer-0.10.schemas
deleted file mode 100644
index d889571..0000000
--- a/gconf/gstreamer-0.10.schemas
+++ /dev/null
@@ -1,191 +0,0 @@
-<gconfschemafile>
-  <schemalist>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/audiosink</key>
-      <applyto>/system/gstreamer/0.10/default/audiosink</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>autoaudiosink</default>
-      <locale name="C">
-        <short>default GStreamer audiosink</short>
-        <long>GStreamer can play audio using any number of output elements.  Some possible choices are osssink, esdsink and alsasink.  The audiosink can be a partial pipeline instead of just one element.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/audiosink_description</key>
-      <applyto>/system/gstreamer/0.10/default/audiosink_description</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>Default</default>
-      <locale name="C">
-        <short>description for default GStreamer audiosink</short>
-        <long>Describes the selected output element.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/musicaudiosink</key>
-      <applyto>/system/gstreamer/0.10/default/musicaudiosink</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>autoaudiosink</default>
-      <locale name="C">
-        <short>GStreamer audiosink for Music and Movies</short>
-        <long>GStreamer can play audio using any number of output elements.  Some possible choices are osssink, esdsink and alsasink.  The audiosink can be a partial pipeline instead of just one element.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/musicaudiosink_description</key>
-      <applyto>/system/gstreamer/0.10/default/musicaudiosink_description</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>Default</default>
-      <locale name="C">
-        <short>description for GStreamer audiosink for Music and Movies</short>
-        <long>Describes the selected output element for Music and Movies.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/chataudiosink</key>
-      <applyto>/system/gstreamer/0.10/default/chataudiosink</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>autoaudiosink</default>
-      <locale name="C">
-        <short>GStreamer audiosink for Audio/Video Conferencing</short>
-        <long>GStreamer can play audio using any number of output elements.  Some possible choices are osssink, esdsink and alsasink.  The audiosink can be a partial pipeline instead of just one element.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/chataudiosink_description</key>
-      <applyto>/system/gstreamer/0.10/default/chataudiosink_description</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>Default</default>
-      <locale name="C">
-        <short>description for GStreamer audiosink for Audio/Video Conferencing</short>
-        <long>Describes the selected output element for Audio/Video Conferencing.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/audiosink_description</key>
-      <applyto>/system/gstreamer/0.10/default/audiosink_description</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>Default</default>
-      <locale name="C">
-        <short>description for default GStreamer audiosink</short>
-        <long>Describes the selected output element.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/musicaudiosink</key>
-      <applyto>/system/gstreamer/0.10/default/musicaudiosink</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>autoaudiosink</default>
-      <locale name="C">
-        <short>GStreamer audiosink for Music and Movies</short>
-        <long>GStreamer can play audio using any number of output elements.  Some possible choices are osssink, esdsink and alsasink.  The audiosink can be a partial pipeline instead of just one element.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/musicaudiosink_description</key>
-      <applyto>/system/gstreamer/0.10/default/musicaudiosink_description</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>Default</default>
-      <locale name="C">
-        <short>description for GStreamer audiosink for Music and Movies</short>
-        <long>Describes the selected output element for Music and Movies.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/chataudiosink</key>
-      <applyto>/system/gstreamer/0.10/default/chataudiosink</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>autoaudiosink</default>
-      <locale name="C">
-        <short>GStreamer audiosink for Audio/Video Conferencing</short>
-        <long>GStreamer can play audio using any number of output elements.  Some possible choices are osssink, esdsink and alsasink.  The audiosink can be a partial pipeline instead of just one element.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/chataudiosink_description</key>
-      <applyto>/system/gstreamer/0.10/default/chataudiosink_description</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>Default</default>
-      <locale name="C">
-        <short>description for GStreamer audiosink for Audio/Video Conferencing</short>
-        <long>Describes the selected output element for Audio/Video Conferencing.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/videosink</key>
-      <applyto>/system/gstreamer/0.10/default/videosink</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>autovideosink</default>
-      <locale name="C">
-        <short>default GStreamer videosink</short>
-        <long>GStreamer can play video using any number of output elements.  Some possible choices are xvimagesink, ximagesink, sdlvideosink and aasink.  The videosink can be a partial pipeline instead of just one element.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/audiosrc</key>
-      <applyto>/system/gstreamer/0.10/default/audiosrc</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>alsasrc</default>
-      <locale name="C">
-        <short>default GStreamer audio source</short>
-        <long>GStreamer can record audio using any number of input elements.  Some possible choices are osssrc, esdsrc and alsasrc.  The audio source can be a partial pipeline instead of just one element.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/audiosrc_description</key>
-      <applyto>/system/gstreamer/0.10/default/audiosrc_description</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>Default</default>
-      <locale name="C">
-        <short>description for default GStreamer audiosrc</short>
-        <long>Describes the selected input element.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/audiosrc_description</key>
-      <applyto>/system/gstreamer/0.10/default/audiosrc_description</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>Default</default>
-      <locale name="C">
-        <short>description for default GStreamer audiosrc</short>
-        <long>Describes the selected input element.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/videosrc</key>
-      <applyto>/system/gstreamer/0.10/default/videosrc</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>v4l2src</default>
-      <locale name="C">
-        <short>default GStreamer video source</short>
-        <long>GStreamer can record video from any number of input elements.  Some possible choices are v4lsrc and videotestsrc. The video source can be a partial pipeline instead of just one element.</long>
-      </locale>
-    </schema>
-    <schema>
-      <key>/schemas/system/gstreamer/0.10/default/visualization</key>
-      <applyto>/system/gstreamer/0.10/default/visualization</applyto>
-      <owner>gstreamer</owner>
-      <type>string</type>
-      <default>goom</default>
-      <locale name="C">
-        <short>default GStreamer visualization plugin</short>
-        <long>GStreamer can put visualization plugins in a pipeline to transform audio stream in video frames. Default is goom but more visualization plugins will be ported soon. The visualization plugin can be a partial pipeline instead of just one element.</long>
-      </locale>
-    </schema>
-  </schemalist>
-</gconfschemafile>
diff --git a/gst-plugins-good.doap b/gst-plugins-good.doap
index 02c2cd7..f4cc81e 100644
--- a/gst-plugins-good.doap
+++ b/gst-plugins-good.doap
@@ -34,18 +34,6 @@ the plug-in code, LGPL or LGPL-compatible for the supporting library).
 
  <release>
   <Version>
-   <revision>0.10.31</revision>
-   <branch>0.10</branch>
-   <name>Faster</name>
-   <created>2012-02-20</created>
-   <file-release rdf:resource="http://gstreamer.freedesktop.org/src/gst-plugins-good/gst-plugins-good-0.10.31.tar.bz2" />
-   <file-release rdf:resource="http://gstreamer.freedesktop.org/src/gst-plugins-good/gst-plugins-good-0.10.31.tar.gz" />
-   <file-release rdf:resource="http://gstreamer.freedesktop.org/src/gst-plugins-good/gst-plugins-good-0.10.31.tar.xz" />
-  </Version>
- </release>
-
- <release>
-  <Version>
    <revision>0.10.30</revision>
    <branch>0.10</branch>
    <name>Adagio</name>
diff --git a/gst-plugins-good.spec b/gst-plugins-good.spec
deleted file mode 100644
index a3b073f..0000000
--- a/gst-plugins-good.spec
+++ /dev/null
@@ -1,174 +0,0 @@
-%define majorminor  0.10
-%define gstreamer   gstreamer
-
-%define gst_minver   0.10.0
-
-Name: 		%{gstreamer}-plugins-good
-Version: 	0.10.31
-Release: 	1.gst
-Summary: 	GStreamer plug-ins with good code and licensing
-
-Group: 		Applications/Multimedia
-License: 	LGPL
-URL:		http://gstreamer.freedesktop.org/
-Vendor:         GStreamer Backpackers Team <package@gstreamer.freedesktop.org>
-Source:         http://gstreamer.freedesktop.org/src/gst-plugins-good/gst-plugins-good-%{version}.tar.gz
-BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
-
-Requires: 	  %{gstreamer} >= %{gst_minver}
-BuildRequires: 	  %{gstreamer}-devel >= %{gst_minver}
-
-BuildRequires:  gcc-c++
-
-BuildRequires: esound-devel >= 0.2.8
-Obsoletes:     gstreamer-esd
-
-Provides:		gstreamer-audiosrc
-Provides:		gstreamer-audiosink
-BuildRequires: flac-devel >= 1.0.3
-BuildRequires: 	GConf2-devel
-BuildRequires: libjpeg-devel
-BuildRequires: libcaca-devel
-BuildRequires: libdv-devel
-BuildRequires: libpng-devel >= 1.2.0
-BuildRequires: glibc-devel
-BuildRequires:	speex-devel
-BuildRequires: hal-devel
-BuildRequires: libshout-devel >= 2.0
-BuildRequires:  aalib-devel >= 1.3
-Provides:       gstreamer-aasink = %{version}-%{release}
-BuildRequires: pulseaudio-libs-devel
-BuildRequires: libavc1394-devel
-BuildRequires: libdc1394-devel
-BuildRequires: libiec61883-devel  
-BuildRequires: libraw1394-devel
-
-%description
-GStreamer is a streaming media framework, based on graphs of filters which
-operate on media data. Applications using this library can do anything
-from real-time sound processing to playing videos, and just about anything
-else media-related.  Its plugin-based architecture means that new data
-types or processing capabilities can be added simply by installing new
-plug-ins.
-
-%prep
-%setup -q -n gst-plugins-good-%{version}
-%build
-%configure \
-  --enable-debug \
-  --enable-DEBUG 
-
-make %{?_smp_mflags}
-                                                                                
-%install
-rm -rf $RPM_BUILD_ROOT
-
-export GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1
-%makeinstall
-unset GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL
-                                                                                
-# Clean out files that should not be part of the rpm.
-rm -f $RPM_BUILD_ROOT%{_libdir}/gstreamer-%{majorminor}/*.la
-rm -f $RPM_BUILD_ROOT%{_libdir}/gstreamer-%{majorminor}/*.a
-rm -f $RPM_BUILD_ROOT%{_libdir}/*.a
-rm -f $RPM_BUILD_ROOT%{_libdir}/*.la
-
-%find_lang gst-plugins-good-%{majorminor}
-
-%clean
-rm -rf $RPM_BUILD_ROOT
-
-%post
-export GCONF_CONFIG_SOURCE=`gconftool-2 --get-default-source`
-gconftool-2 --makefile-install-rule %{_sysconfdir}/gconf/schemas/gstreamer-%{majorminor}.schemas > /dev/null
-
-%files -f gst-plugins-good-%{majorminor}.lang
-%defattr(-, root, root)
-%doc AUTHORS COPYING README REQUIREMENTS gst-plugins-good.doap
-%{_datadir}/gstreamer-%{majorminor}/presets/GstIirEqualizer10Bands.prs
-%{_datadir}/gstreamer-%{majorminor}/presets/GstIirEqualizer3Bands.prs
-
-# non-core plugins without external dependencies
-%{_libdir}/gstreamer-%{majorminor}/libgstalaw.so
-%{_libdir}/gstreamer-%{majorminor}/libgstalpha.so
-%{_libdir}/gstreamer-%{majorminor}/libgstautodetect.so
-%{_libdir}/gstreamer-%{majorminor}/libgstavi.so
-%{_libdir}/gstreamer-%{majorminor}/libgsteffectv.so
-%{_libdir}/gstreamer-%{majorminor}/libgstgoom.so
-%{_libdir}/gstreamer-%{majorminor}/libgstlevel.so
-%{_libdir}/gstreamer-%{majorminor}/libgstefence.so
-%{_libdir}/gstreamer-%{majorminor}/libgstmulaw.so
-%{_libdir}/gstreamer-%{majorminor}/libgstisomp4.so
-%{_libdir}/gstreamer-%{majorminor}/libgstrtp.so
-%{_libdir}/gstreamer-%{majorminor}/libgstrtpmanager.so
-%{_libdir}/gstreamer-%{majorminor}/libgstrtsp.so
-%{_libdir}/gstreamer-%{majorminor}/libgstsmpte.so
-%{_libdir}/gstreamer-%{majorminor}/libgstudp.so
-%{_libdir}/gstreamer-%{majorminor}/libgstvideobox.so
-%{_libdir}/gstreamer-%{majorminor}/libgstwavenc.so
-%{_libdir}/gstreamer-%{majorminor}/libgstwavparse.so
-%{_libdir}/gstreamer-%{majorminor}/libgstauparse.so
-%{_libdir}/gstreamer-%{majorminor}/libgstdebug.so
-%{_libdir}/gstreamer-%{majorminor}/libgstnavigationtest.so
-%{_libdir}/gstreamer-%{majorminor}/libgstalphacolor.so
-%{_libdir}/gstreamer-%{majorminor}/libgstcairo.so
-%{_libdir}/gstreamer-%{majorminor}/libgstflxdec.so
-%{_libdir}/gstreamer-%{majorminor}/libgstmatroska.so
-%{_libdir}/gstreamer-%{majorminor}/libgstvideomixer.so
-%{_libdir}/gstreamer-%{majorminor}/libgstcutter.so
-%{_libdir}/gstreamer-%{majorminor}/libgstmultipart.so
-%{_libdir}/gstreamer-%{majorminor}/libgstid3demux.so
-%{_libdir}/gstreamer-%{majorminor}/libgstgdkpixbuf.so
-%{_libdir}/gstreamer-%{majorminor}/libgstapetag.so
-%{_libdir}/gstreamer-%{majorminor}/libgstannodex.so
-%{_libdir}/gstreamer-%{majorminor}/libgstvideocrop.so
-%{_libdir}/gstreamer-%{majorminor}/libgsticydemux.so
-%{_libdir}/gstreamer-%{majorminor}/libgsttaglib.so
-%{_libdir}/gstreamer-%{majorminor}/libgstximagesrc.so
-%{_libdir}/gstreamer-%{majorminor}/libgstaudiofx.so
-%{_libdir}/gstreamer-%{majorminor}/libgstequalizer.so
-%{_libdir}/gstreamer-%{majorminor}/libgstmultifile.so
-%{_libdir}/gstreamer-%{majorminor}/libgstspectrum.so
-%{_libdir}/gstreamer-%{majorminor}/libgstgoom2k1.so
-%{_libdir}/gstreamer-%{majorminor}/libgstinterleave.so
-%{_libdir}/gstreamer-%{majorminor}/libgstreplaygain.so
-%{_libdir}/gstreamer-%{majorminor}/libgstdeinterlace.so
-%{_libdir}/gstreamer-%{majorminor}/libgstflv.so
-%{_libdir}/gstreamer-%{majorminor}/libgsty4menc.so
-%{_libdir}/gstreamer-%{majorminor}/libgstoss4audio.so
-%{_libdir}/gstreamer-%{majorminor}/libgstimagefreeze.so
-%{_libdir}/gstreamer-%{majorminor}/libgstshapewipe.so
-%{_libdir}/gstreamer-%{majorminor}/libgstvideofilter.so
-%{_libdir}/gstreamer-%{majorminor}/libgstaudioparsers.so
-
-# sys plugins
-%{_libdir}/gstreamer-%{majorminor}/libgstvideo4linux2.so
-
-# gstreamer-plugins with external dependencies but in the main package
-%{_libdir}/gstreamer-%{majorminor}/libgstcacasink.so
-%{_libdir}/gstreamer-%{majorminor}/libgstesd.so
-%{_libdir}/gstreamer-%{majorminor}/libgstflac.so
-%{_libdir}/gstreamer-%{majorminor}/libgstjack.so
-%{_libdir}/gstreamer-%{majorminor}/libgstjpeg.so
-%{_libdir}/gstreamer-%{majorminor}/libgstpng.so
-%{_libdir}/gstreamer-%{majorminor}/libgstossaudio.so
-%{_libdir}/gstreamer-%{majorminor}/libgstspeex.so
-%{_libdir}/gstreamer-%{majorminor}/libgstgconfelements.so
-%{_libdir}/gstreamer-%{majorminor}/libgsthalelements.so
-%{_libdir}/gstreamer-%{majorminor}/libgstshout2.so
-%{_libdir}/gstreamer-%{majorminor}/libgstaasink.so
-%{_libdir}/gstreamer-%{majorminor}/libgstdv.so
-%{_libdir}/gstreamer-%{majorminor}/libgst1394.so
-%{_libdir}/gstreamer-%{majorminor}/libgstwavpack.so
-%{_libdir}/gstreamer-%{majorminor}/libgstsouphttpsrc.so
-%{_libdir}/gstreamer-%{majorminor}/libgstpulse.so
-
-# schema files
-%{_sysconfdir}/gconf/schemas/gstreamer-%{majorminor}.schemas
-
-%changelog
-* Tue Jun 12 2007 Jan Schmidt <jan at fluendo dot com>
-- wavpack and qtdemux have moved from bad
-
-* Fri Sep 02 2005 Thomas Vander Stichele <thomas at apestaart dot org>
-- clean up for splitup
diff --git a/gst/Makefile.in b/gst/Makefile.in
index 3796579..9cba7a7 100644
--- a/gst/Makefile.in
+++ b/gst/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -20,6 +19,23 @@
 # descending into all subdirectories a second time, but only after the first
 # (parallel) run has finished, so it should go right through the second time.
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -38,6 +54,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
 	$(top_srcdir)/common/parallel-subdirs.mak
 subdir = gst
@@ -46,7 +63,6 @@ am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -84,12 +100,18 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
 RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
@@ -99,6 +121,11 @@ RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
@@ -187,6 +214,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -235,8 +263,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -317,7 +347,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -377,6 +407,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -450,7 +481,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -498,12 +533,12 @@ clean-libtool:
 	-rm -rf .libs _libs
 
 # This directory's subdirectories are mostly independent; you can cd
-# into them and run `make' without going through this Makefile.
-# To change the values of `make' variables: instead of editing Makefiles,
-# (1) if the variable is set in `config.status', edit `config.status'
-#     (which will cause the Makefiles to be regenerated when you run `make');
-# (2) otherwise, pass the desired values on the `make' command line.
-$(RECURSIVE_TARGETS):
+# into them and run 'make' without going through this Makefile.
+# To change the values of 'make' variables: instead of editing Makefiles,
+# (1) if the variable is set in 'config.status', edit 'config.status'
+#     (which will cause the Makefiles to be regenerated when you run 'make');
+# (2) otherwise, pass the desired values on the 'make' command line.
+$(RECURSIVE_TARGETS) $(RECURSIVE_CLEAN_TARGETS):
 	@fail= failcom='exit 1'; \
 	for f in x $$MAKEFLAGS; do \
 	  case $$f in \
@@ -513,7 +548,11 @@ $(RECURSIVE_TARGETS):
 	done; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
-	list='$(SUBDIRS)'; for subdir in $$list; do \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	for subdir in $$list; do \
 	  echo "Making $$target in $$subdir"; \
 	  if test "$$subdir" = "."; then \
 	    dot_seen=yes; \
@@ -527,37 +566,6 @@ $(RECURSIVE_TARGETS):
 	if test "$$dot_seen" = "no"; then \
 	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
 	fi; test -z "$$fail"
-
-$(RECURSIVE_CLEAN_TARGETS):
-	@fail= failcom='exit 1'; \
-	for f in x $$MAKEFLAGS; do \
-	  case $$f in \
-	    *=* | --[!k]*);; \
-	    *k*) failcom='fail=yes';; \
-	  esac; \
-	done; \
-	dot_seen=no; \
-	case "$@" in \
-	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
-	  *) list='$(SUBDIRS)' ;; \
-	esac; \
-	rev=''; for subdir in $$list; do \
-	  if test "$$subdir" = "."; then :; else \
-	    rev="$$subdir $$rev"; \
-	  fi; \
-	done; \
-	rev="$$rev ."; \
-	target=`echo $@ | sed s/-recursive//`; \
-	for subdir in $$rev; do \
-	  echo "Making $$target in $$subdir"; \
-	  if test "$$subdir" = "."; then \
-	    local_target="$$target-am"; \
-	  else \
-	    local_target="$$target"; \
-	  fi; \
-	  ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
-	  || eval $$failcom; \
-	done && test -z "$$fail"
 tags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
@@ -566,6 +574,10 @@ ctags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
 	done
+cscopelist-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) cscopelist); \
+	done
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -629,6 +641,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist: cscopelist-recursive $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -664,13 +690,10 @@ distdir: $(DISTFILES)
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -791,22 +814,23 @@ ps-am:
 
 uninstall-am:
 
-.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) ctags-recursive \
-	install-am install-strip tags-recursive
+.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) \
+	cscopelist-recursive ctags-recursive install-am install-strip \
+	tags-recursive
 
 .PHONY: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) CTAGS GTAGS \
 	all all-am check check-am clean clean-generic clean-libtool \
-	ctags ctags-recursive distclean distclean-generic \
-	distclean-libtool distclean-tags distdir dvi dvi-am html \
-	html-am info info-am install install-am install-data \
-	install-data-am install-dvi install-dvi-am install-exec \
-	install-exec-am install-html install-html-am install-info \
-	install-info-am install-man install-pdf install-pdf-am \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs installdirs-am maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-generic \
-	mostlyclean-libtool pdf pdf-am ps ps-am tags tags-recursive \
-	uninstall uninstall-am
+	cscopelist cscopelist-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-libtool distclean-tags \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-dvi \
+	install-dvi-am install-exec install-exec-am install-html \
+	install-html-am install-info install-info-am install-man \
+	install-pdf install-pdf-am install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	mostlyclean mostlyclean-generic mostlyclean-libtool pdf pdf-am \
+	ps ps-am tags tags-recursive uninstall uninstall-am
 
 
 .PHONY: independent-subdirs $(SUBDIRS)
diff --git a/gst/alpha/Makefile.in b/gst/alpha/Makefile.in
index 5809748..e822f4c 100644
--- a/gst/alpha/Makefile.in
+++ b/gst/alpha/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/alpha
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -119,6 +135,7 @@ libgstalpha_la_OBJECTS = $(am_libgstalpha_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstalpha_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstalpha_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstalpha_la_CFLAGS) $(CFLAGS) \
@@ -131,6 +148,18 @@ libgstalphacolor_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstalphacolor_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstalphacolor_la_CFLAGS) $(CFLAGS) \
 	$(libgstalphacolor_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -143,23 +172,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstalpha_la_SOURCES) $(libgstalphacolor_la_SOURCES)
 DIST_SOURCES = $(libgstalpha_la_SOURCES) \
 	$(libgstalphacolor_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -219,6 +249,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -267,8 +298,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -349,7 +382,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -409,6 +442,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -482,7 +516,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -542,7 +580,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -550,6 +587,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -565,12 +604,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstalpha.la: $(libgstalpha_la_OBJECTS) $(libgstalpha_la_DEPENDENCIES) $(EXTRA_libgstalpha_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstalpha_la_LINK) -rpath $(plugindir) $(libgstalpha_la_OBJECTS) $(libgstalpha_la_LIBADD) $(LIBS)
 libgstalphacolor.la: $(libgstalphacolor_la_OBJECTS) $(libgstalphacolor_la_DEPENDENCIES) $(EXTRA_libgstalphacolor_la_DEPENDENCIES) 
@@ -675,6 +716,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -819,18 +874,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/alpha/gstalpha.c b/gst/alpha/gstalpha.c
index f4d0cce..5564e7e 100644
--- a/gst/alpha/gstalpha.c
+++ b/gst/alpha/gstalpha.c
@@ -2356,6 +2356,12 @@ gst_alpha_init_params (GstAlpha * alpha)
   gfloat y;
   const gint *matrix;
 
+  if (alpha->in_format == GST_VIDEO_FORMAT_UNKNOWN
+      || alpha->out_format == GST_VIDEO_FORMAT_UNKNOWN) {
+    GST_DEBUG_OBJECT (alpha, "video formats not set yet");
+    return;
+  }
+
   /* RGB->RGB: convert to SDTV YUV, chroma keying, convert back
    * YUV->RGB: chroma keying, convert to RGB
    * RGB->YUV: convert to YUV, chroma keying
diff --git a/gst/apetag/Makefile.in b/gst/apetag/Makefile.in
index 7f5c58c..0e6df52 100644
--- a/gst/apetag/Makefile.in
+++ b/gst/apetag/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/apetag
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -118,10 +134,23 @@ libgstapetag_la_OBJECTS = $(am_libgstapetag_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstapetag_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstapetag_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstapetag_la_CFLAGS) $(CFLAGS) \
 	$(libgstapetag_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -134,22 +163,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstapetag_la_SOURCES)
 DIST_SOURCES = $(libgstapetag_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -209,6 +239,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -257,8 +288,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -339,7 +372,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -399,6 +432,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -472,7 +506,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -528,7 +566,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -536,6 +573,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -551,12 +590,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstapetag.la: $(libgstapetag_la_OBJECTS) $(libgstapetag_la_DEPENDENCIES) $(EXTRA_libgstapetag_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstapetag_la_LINK) -rpath $(plugindir) $(libgstapetag_la_OBJECTS) $(libgstapetag_la_LIBADD) $(LIBS)
 
@@ -651,6 +692,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -795,18 +850,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/audiofx/Makefile.in b/gst/audiofx/Makefile.in
index 6bccb89..3eb2f15 100644
--- a/gst/audiofx/Makefile.in
+++ b/gst/audiofx/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -19,6 +18,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -37,15 +53,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/audiofx
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -135,10 +151,23 @@ libgstaudiofx_la_OBJECTS = $(am_libgstaudiofx_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstaudiofx_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstaudiofx_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstaudiofx_la_CFLAGS) $(CFLAGS) \
 	$(libgstaudiofx_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -151,22 +180,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstaudiofx_la_SOURCES)
 DIST_SOURCES = $(libgstaudiofx_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -226,6 +256,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -274,8 +305,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -356,7 +389,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -416,6 +449,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -489,7 +523,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -583,7 +621,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -591,6 +628,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -606,12 +645,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstaudiofx.la: $(libgstaudiofx_la_OBJECTS) $(libgstaudiofx_la_DEPENDENCIES) $(EXTRA_libgstaudiofx_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstaudiofx_la_LINK) -rpath $(plugindir) $(libgstaudiofx_la_OBJECTS) $(libgstaudiofx_la_LIBADD) $(LIBS)
 
@@ -818,6 +859,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -962,18 +1017,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/audiofx/audiofirfilter.c b/gst/audiofx/audiofirfilter.c
index bd5a51b..e693b43 100644
--- a/gst/audiofx/audiofirfilter.c
+++ b/gst/audiofx/audiofirfilter.c
@@ -45,6 +45,10 @@
  * </refsect2>
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
diff --git a/gst/audiofx/audiofxbasefirfilter.c b/gst/audiofx/audiofxbasefirfilter.c
index ac1b148..a1b35a5 100644
--- a/gst/audiofx/audiofxbasefirfilter.c
+++ b/gst/audiofx/audiofxbasefirfilter.c
@@ -167,7 +167,7 @@ process_##channels##_##width (GstAudioFXBaseFIRFilter * self, const g##ctype * s
   if (self->buffer_fill > kernel_length) \
     self->buffer_fill = kernel_length; \
   \
-  return input_samples / channels; \
+  return input_samples; \
 } G_STMT_END
 
 DEFINE_PROCESS_FUNC (32, float);
diff --git a/gst/audiofx/audioiirfilter.c b/gst/audiofx/audioiirfilter.c
index ff5f9ca..48ead7a 100644
--- a/gst/audiofx/audioiirfilter.c
+++ b/gst/audiofx/audioiirfilter.c
@@ -41,6 +41,10 @@
  * </refsect2>
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
diff --git a/gst/audioparsers/Makefile.am b/gst/audioparsers/Makefile.am
index 22bc81f..4d4d53e 100644
--- a/gst/audioparsers/Makefile.am
+++ b/gst/audioparsers/Makefile.am
@@ -3,7 +3,7 @@ plugin_LTLIBRARIES = libgstaudioparsers.la
 libgstaudioparsers_la_SOURCES = \
 	gstaacparse.c gstamrparse.c gstac3parse.c \
 	gstdcaparse.c gstflacparse.c gstmpegaudioparse.c \
-	plugin.c
+	gstwavpackparse.c plugin.c
 
 libgstaudioparsers_la_CFLAGS = \
 	$(GST_PLUGINS_BASE_CFLAGS) $(GST_BASE_CFLAGS) $(GST_CFLAGS)
@@ -15,4 +15,4 @@ libgstaudioparsers_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS)
 libgstaudioparsers_la_LIBTOOLFLAGS = --tag=disable-static
 
 noinst_HEADERS = gstaacparse.h gstamrparse.h gstac3parse.h \
-	gstdcaparse.h gstflacparse.h gstmpegaudioparse.h
+	gstdcaparse.h gstflacparse.h gstmpegaudioparse.h gstwavpackparse.h
diff --git a/gst/audioparsers/Makefile.in b/gst/audioparsers/Makefile.in
index 93b2caf..73ae8d6 100644
--- a/gst/audioparsers/Makefile.in
+++ b/gst/audioparsers/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/audioparsers
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -120,15 +136,29 @@ am_libgstaudioparsers_la_OBJECTS =  \
 	libgstaudioparsers_la-gstdcaparse.lo \
 	libgstaudioparsers_la-gstflacparse.lo \
 	libgstaudioparsers_la-gstmpegaudioparse.lo \
+	libgstaudioparsers_la-gstwavpackparse.lo \
 	libgstaudioparsers_la-plugin.lo
 libgstaudioparsers_la_OBJECTS = $(am_libgstaudioparsers_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstaudioparsers_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstaudioparsers_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstaudioparsers_la_CFLAGS) $(CFLAGS) \
 	$(libgstaudioparsers_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -141,22 +171,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstaudioparsers_la_SOURCES)
 DIST_SOURCES = $(libgstaudioparsers_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -216,6 +247,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -264,8 +296,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -346,7 +380,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -406,6 +440,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -479,7 +514,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -487,7 +526,7 @@ plugin_LTLIBRARIES = libgstaudioparsers.la
 libgstaudioparsers_la_SOURCES = \
 	gstaacparse.c gstamrparse.c gstac3parse.c \
 	gstdcaparse.c gstflacparse.c gstmpegaudioparse.c \
-	plugin.c
+	gstwavpackparse.c plugin.c
 
 libgstaudioparsers_la_CFLAGS = \
 	$(GST_PLUGINS_BASE_CFLAGS) $(GST_BASE_CFLAGS) $(GST_CFLAGS)
@@ -500,7 +539,7 @@ libgstaudioparsers_la_LIBADD = \
 libgstaudioparsers_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS)
 libgstaudioparsers_la_LIBTOOLFLAGS = --tag=disable-static
 noinst_HEADERS = gstaacparse.h gstamrparse.h gstac3parse.h \
-	gstdcaparse.h gstflacparse.h gstmpegaudioparse.h
+	gstdcaparse.h gstflacparse.h gstmpegaudioparse.h gstwavpackparse.h
 
 all: all-am
 
@@ -538,7 +577,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -546,6 +584,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -561,12 +601,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstaudioparsers.la: $(libgstaudioparsers_la_OBJECTS) $(libgstaudioparsers_la_DEPENDENCIES) $(EXTRA_libgstaudioparsers_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstaudioparsers_la_LINK) -rpath $(plugindir) $(libgstaudioparsers_la_OBJECTS) $(libgstaudioparsers_la_LIBADD) $(LIBS)
 
@@ -582,6 +624,7 @@ distclean-compile:
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstaudioparsers_la-gstdcaparse.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstaudioparsers_la-gstflacparse.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstaudioparsers_la-gstmpegaudioparse.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstaudioparsers_la-gstwavpackparse.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstaudioparsers_la-plugin.Plo@am__quote@
 
 .c.o:
@@ -647,6 +690,13 @@ libgstaudioparsers_la-gstmpegaudioparse.lo: gstmpegaudioparse.c
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstaudioparsers_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstaudioparsers_la_CFLAGS) $(CFLAGS) -c -o libgstaudioparsers_la-gstmpegaudioparse.lo `test -f 'gstmpegaudioparse.c' || echo '$(srcdir)/'`gstmpegaudioparse.c
 
+libgstaudioparsers_la-gstwavpackparse.lo: gstwavpackparse.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstaudioparsers_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstaudioparsers_la_CFLAGS) $(CFLAGS) -MT libgstaudioparsers_la-gstwavpackparse.lo -MD -MP -MF $(DEPDIR)/libgstaudioparsers_la-gstwavpackparse.Tpo -c -o libgstaudioparsers_la-gstwavpackparse.lo `test -f 'gstwavpackparse.c' || echo '$(srcdir)/'`gstwavpackparse.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libgstaudioparsers_la-gstwavpackparse.Tpo $(DEPDIR)/libgstaudioparsers_la-gstwavpackparse.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='gstwavpackparse.c' object='libgstaudioparsers_la-gstwavpackparse.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstaudioparsers_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstaudioparsers_la_CFLAGS) $(CFLAGS) -c -o libgstaudioparsers_la-gstwavpackparse.lo `test -f 'gstwavpackparse.c' || echo '$(srcdir)/'`gstwavpackparse.c
+
 libgstaudioparsers_la-plugin.lo: plugin.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstaudioparsers_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstaudioparsers_la_CFLAGS) $(CFLAGS) -MT libgstaudioparsers_la-plugin.lo -MD -MP -MF $(DEPDIR)/libgstaudioparsers_la-plugin.Tpo -c -o libgstaudioparsers_la-plugin.lo `test -f 'plugin.c' || echo '$(srcdir)/'`plugin.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libgstaudioparsers_la-plugin.Tpo $(DEPDIR)/libgstaudioparsers_la-plugin.Plo
@@ -709,6 +759,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -853,18 +917,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/gst/audioparsers/gstaacparse.c b/gst/audioparsers/gstaacparse.c
index d8c0995..ed9ce39 100644
--- a/gst/audioparsers/gstaacparse.c
+++ b/gst/audioparsers/gstaacparse.c
@@ -44,6 +44,7 @@
 
 #include <string.h>
 
+#include <gst/base/gstbitreader.h>
 #include "gstaacparse.h"
 
 
@@ -52,7 +53,7 @@ static GstStaticPadTemplate src_template = GST_STATIC_PAD_TEMPLATE ("src",
     GST_PAD_ALWAYS,
     GST_STATIC_CAPS ("audio/mpeg, "
         "framed = (boolean) true, " "mpegversion = (int) { 2, 4 }, "
-        "stream-format = (string) { raw, adts, adif };"));
+        "stream-format = (string) { raw, adts, adif, loas };"));
 
 static GstStaticPadTemplate sink_template = GST_STATIC_PAD_TEMPLATE ("sink",
     GST_PAD_SINK,
@@ -65,10 +66,21 @@ GST_DEBUG_CATEGORY_STATIC (aacparse_debug);
 
 #define ADIF_MAX_SIZE 40        /* Should be enough */
 #define ADTS_MAX_SIZE 10        /* Should be enough */
+#define LOAS_MAX_SIZE 3         /* Should be enough */
 
 
 #define AAC_FRAME_DURATION(parse) (GST_SECOND/parse->frames_per_sec)
 
+static const gint loas_sample_rate_table[32] = {
+  96000, 88200, 64000, 48000, 44100, 32000, 24000, 22050,
+  16000, 12000, 11025, 8000, 7350, 0, 0, 0
+};
+
+static const gint loas_channels_table[32] = {
+  0, 1, 2, 3, 4, 5, 6, 8,
+  0, 0, 0, 0, 0, 0, 0, 0
+};
+
 static gboolean gst_aac_parse_start (GstBaseParse * parse);
 static gboolean gst_aac_parse_stop (GstBaseParse * parse);
 
@@ -112,8 +124,7 @@ gst_aac_parse_base_init (gpointer klass)
 {
   GstElementClass *element_class = GST_ELEMENT_CLASS (klass);
 
-  gst_element_class_add_static_pad_template (element_class,
-      &sink_template);
+  gst_element_class_add_static_pad_template (element_class, &sink_template);
   gst_element_class_add_static_pad_template (element_class, &src_template);
 
   gst_element_class_set_details_simple (element_class,
@@ -192,6 +203,9 @@ gst_aac_parse_set_src_caps (GstAacParse * aacparse, GstCaps * sink_caps)
     case DSPAAC_HEADER_ADIF:
       stream_format = "adif";
       break;
+    case DSPAAC_HEADER_LOAS:
+      stream_format = "loas";
+      break;
     default:
       stream_format = NULL;
   }
@@ -327,6 +341,8 @@ gst_aac_parse_check_adts_frame (GstAacParse * aacparse,
     const guint8 * data, const guint avail, gboolean drain,
     guint * framesize, guint * needed_data)
 {
+  *needed_data = 0;
+
   if (G_UNLIKELY (avail < 2))
     return FALSE;
 
@@ -365,6 +381,292 @@ gst_aac_parse_check_adts_frame (GstAacParse * aacparse,
   return FALSE;
 }
 
+static gboolean
+gst_aac_parse_latm_get_value (GstAacParse * aacparse, GstBitReader * br,
+    guint32 * value)
+{
+  guint8 bytes, i, byte;
+
+  *value = 0;
+  if (!gst_bit_reader_get_bits_uint8 (br, &bytes, 2))
+    return FALSE;
+  for (i = 0; i < bytes; ++i) {
+    *value <<= 8;
+    if (!gst_bit_reader_get_bits_uint8 (br, &byte, 8))
+      return FALSE;
+    *value += byte;
+  }
+  return TRUE;
+}
+
+static gboolean
+gst_aac_parse_get_audio_object_type (GstAacParse * aacparse, GstBitReader * br,
+    guint8 * audio_object_type)
+{
+  if (!gst_bit_reader_get_bits_uint8 (br, audio_object_type, 5))
+    return FALSE;
+  if (*audio_object_type == 31) {
+    if (!gst_bit_reader_get_bits_uint8 (br, audio_object_type, 6))
+      return FALSE;
+    *audio_object_type += 32;
+  }
+  GST_LOG_OBJECT (aacparse, "audio object type %u", *audio_object_type);
+  return TRUE;
+}
+
+static gboolean
+gst_aac_parse_get_audio_sample_rate (GstAacParse * aacparse, GstBitReader * br,
+    gint * sample_rate)
+{
+  guint8 sampling_frequency_index;
+  if (!gst_bit_reader_get_bits_uint8 (br, &sampling_frequency_index, 4))
+    return FALSE;
+  GST_LOG_OBJECT (aacparse, "sampling_frequency_index: %u",
+      sampling_frequency_index);
+  if (sampling_frequency_index == 0xf) {
+    guint32 sampling_rate;
+    if (!gst_bit_reader_get_bits_uint32 (br, &sampling_rate, 24))
+      return FALSE;
+    *sample_rate = sampling_rate;
+  } else {
+    *sample_rate = loas_sample_rate_table[sampling_frequency_index];
+    if (!*sample_rate)
+      return FALSE;
+  }
+  return TRUE;
+}
+
+/* See table 1.13 in ISO/IEC 14496-3 */
+static gboolean
+gst_aac_parse_read_loas_audio_specific_config (GstAacParse * aacparse,
+    GstBitReader * br, gint * sample_rate, gint * channels, guint32 * bits)
+{
+  guint8 audio_object_type, channel_configuration;
+
+  if (!gst_aac_parse_get_audio_object_type (aacparse, br, &audio_object_type))
+    return FALSE;
+
+  if (!gst_aac_parse_get_audio_sample_rate (aacparse, br, sample_rate))
+    return FALSE;
+
+  if (!gst_bit_reader_get_bits_uint8 (br, &channel_configuration, 4))
+    return FALSE;
+  GST_LOG_OBJECT (aacparse, "channel_configuration: %d", channel_configuration);
+  *channels = loas_channels_table[channel_configuration];
+  if (!*channels)
+    return FALSE;
+
+  if (audio_object_type == 5) {
+    GST_LOG_OBJECT (aacparse,
+        "Audio object type 5, so rereading sampling rate...");
+    if (!gst_aac_parse_get_audio_sample_rate (aacparse, br, sample_rate))
+      return FALSE;
+  }
+
+  GST_INFO_OBJECT (aacparse, "Found LOAS config: %d Hz, %d channels",
+      *sample_rate, *channels);
+
+  /* There's LOTS of stuff next, but we ignore it for now as we have
+     what we want (sample rate and number of channels */
+  GST_DEBUG_OBJECT (aacparse,
+      "Need more code to parse humongous LOAS data, currently ignored");
+  if (bits)
+    *bits = 0;
+  return TRUE;
+}
+
+
+static gboolean
+gst_aac_parse_read_loas_config (GstAacParse * aacparse, const guint8 * data,
+    guint avail, gint * sample_rate, gint * channels, gint * version)
+{
+  GstBitReader br;
+  guint8 u8, v, vA;
+
+  /* No version in the bitstream, but the spec has LOAS in the MPEG-4 section */
+  if (version)
+    *version = 4;
+
+  gst_bit_reader_init (&br, data, avail);
+
+  /* skip sync word (11 bits) and size (13 bits) */
+  gst_bit_reader_skip (&br, 11 + 13);
+
+  /* First bit is "use last config" */
+  if (!gst_bit_reader_get_bits_uint8 (&br, &u8, 1))
+    return FALSE;
+  if (u8) {
+    GST_DEBUG_OBJECT (aacparse, "Frame uses previous config");
+    if (!aacparse->sample_rate || !aacparse->channels) {
+      GST_WARNING_OBJECT (aacparse, "No previous config to use");
+    }
+    *sample_rate = aacparse->sample_rate;
+    *channels = aacparse->channels;
+    return TRUE;
+  }
+
+  GST_DEBUG_OBJECT (aacparse, "Frame contains new config");
+
+  if (!gst_bit_reader_get_bits_uint8 (&br, &v, 1))
+    return FALSE;
+  if (v) {
+    if (!gst_bit_reader_get_bits_uint8 (&br, &vA, 1))
+      return FALSE;
+  } else
+    vA = 0;
+
+  GST_LOG_OBJECT (aacparse, "v %d, vA %d", v, vA);
+  if (vA == 0) {
+    guint8 same_time, subframes, num_program, prog;
+    if (v == 1) {
+      guint32 value;
+      if (!gst_aac_parse_latm_get_value (aacparse, &br, &value))
+        return FALSE;
+    }
+    if (!gst_bit_reader_get_bits_uint8 (&br, &same_time, 1))
+      return FALSE;
+    if (!gst_bit_reader_get_bits_uint8 (&br, &subframes, 6))
+      return FALSE;
+    if (!gst_bit_reader_get_bits_uint8 (&br, &num_program, 4))
+      return FALSE;
+    GST_LOG_OBJECT (aacparse, "same_time %d, subframes %d, num_program %d",
+        same_time, subframes, num_program);
+
+    for (prog = 0; prog <= num_program; ++prog) {
+      guint8 num_layer, layer;
+      if (!gst_bit_reader_get_bits_uint8 (&br, &num_layer, 3))
+        return FALSE;
+      GST_LOG_OBJECT (aacparse, "Program %d: %d layers", prog, num_layer);
+
+      for (layer = 0; layer <= num_layer; ++layer) {
+        guint8 use_same_config;
+        if (prog == 0 && layer == 0) {
+          use_same_config = 0;
+        } else {
+          if (!gst_bit_reader_get_bits_uint8 (&br, &use_same_config, 1))
+            return FALSE;
+        }
+        if (!use_same_config) {
+          if (v == 0) {
+            if (!gst_aac_parse_read_loas_audio_specific_config (aacparse, &br,
+                    sample_rate, channels, NULL))
+              return FALSE;
+          } else {
+            guint32 bits, asc_len;
+            if (!gst_aac_parse_latm_get_value (aacparse, &br, &asc_len))
+              return FALSE;
+            if (!gst_aac_parse_read_loas_audio_specific_config (aacparse, &br,
+                    sample_rate, channels, &bits))
+              return FALSE;
+            asc_len -= bits;
+            gst_bit_reader_skip (&br, asc_len);
+          }
+        }
+      }
+    }
+    GST_WARNING_OBJECT (aacparse, "More data ignored");
+  } else {
+    GST_WARNING_OBJECT (aacparse, "Spec says \"TBD\"...");
+  }
+  return TRUE;
+}
+
+/**
+ * gst_aac_parse_loas_get_frame_len:
+ * @data: block of data containing a LOAS header.
+ *
+ * This function calculates LOAS frame length from the given header.
+ *
+ * Returns: size of the LOAS frame.
+ */
+static inline guint
+gst_aac_parse_loas_get_frame_len (const guint8 * data)
+{
+  return (((data[1] & 0x1f) << 8) | data[2]) + 3;
+}
+
+
+/**
+ * gst_aac_parse_check_loas_frame:
+ * @aacparse: #GstAacParse.
+ * @data: Data to be checked.
+ * @avail: Amount of data passed.
+ * @framesize: If valid LOAS frame was found, this will be set to tell the
+ *             found frame size in bytes.
+ * @needed_data: If frame was not found, this may be set to tell how much
+ *               more data is needed in the next round to detect the frame
+ *               reliably. This may happen when a frame header candidate
+ *               is found but it cannot be guaranteed to be the header without
+ *               peeking the following data.
+ *
+ * Check if the given data contains contains LOAS frame. The algorithm
+ * will examine LOAS frame header and calculate the frame size. Also, another
+ * consecutive LOAS frame header need to be present after the found frame.
+ * Otherwise the data is not considered as a valid LOAS frame. However, this
+ * "extra check" is omitted when EOS has been received. In this case it is
+ * enough when data[0] contains a valid LOAS header.
+ *
+ * This function may set the #needed_data to indicate that a possible frame
+ * candidate has been found, but more data (#needed_data bytes) is needed to
+ * be absolutely sure. When this situation occurs, FALSE will be returned.
+ *
+ * When a valid frame is detected, this function will use
+ * gst_base_parse_set_min_frame_size() function from #GstBaseParse class
+ * to set the needed bytes for next frame.This way next data chunk is already
+ * of correct size.
+ *
+ * LOAS can have three different formats, if I read the spec correctly. Only
+ * one of them is supported here, as the two samples I have use this one.
+ *
+ * Returns: TRUE if the given data contains a valid LOAS header.
+ */
+static gboolean
+gst_aac_parse_check_loas_frame (GstAacParse * aacparse,
+    const guint8 * data, const guint avail, gboolean drain,
+    guint * framesize, guint * needed_data)
+{
+  *needed_data = 0;
+
+  /* 3 byte header */
+  if (G_UNLIKELY (avail < 3))
+    return FALSE;
+
+  if ((data[0] == 0x56) && ((data[1] & 0xe0) == 0xe0)) {
+    *framesize = gst_aac_parse_loas_get_frame_len (data);
+    GST_DEBUG_OBJECT (aacparse, "Found %u byte LOAS frame", *framesize);
+
+    /* In EOS mode this is enough. No need to examine the data further.
+       We also relax the check when we have sync, on the assumption that
+       if we're not looking at random data, we have a much higher chance
+       to get the correct sync, and this avoids losing two frames when
+       a single bit corruption happens. */
+    if (drain || !GST_BASE_PARSE_LOST_SYNC (aacparse)) {
+      return TRUE;
+    }
+
+    if (*framesize + LOAS_MAX_SIZE > avail) {
+      /* We have found a possible frame header candidate, but can't be
+         sure since we don't have enough data to check the next frame */
+      GST_DEBUG ("NEED MORE DATA: we need %d, available %d",
+          *framesize + LOAS_MAX_SIZE, avail);
+      *needed_data = *framesize + LOAS_MAX_SIZE;
+      gst_base_parse_set_min_frame_size (GST_BASE_PARSE (aacparse),
+          *framesize + LOAS_MAX_SIZE);
+      return FALSE;
+    }
+
+    if ((data[*framesize] == 0x56) && ((data[*framesize + 1] & 0xe0) == 0xe0)) {
+      guint nextlen = gst_aac_parse_loas_get_frame_len (data + (*framesize));
+
+      GST_LOG ("LOAS frame found, len: %d bytes", *framesize);
+      gst_base_parse_set_min_frame_size (GST_BASE_PARSE (aacparse),
+          nextlen + LOAS_MAX_SIZE);
+      return TRUE;
+    }
+  }
+  return FALSE;
+}
+
 /* caller ensure sufficient data */
 static inline void
 gst_aac_parse_parse_adts_header (GstAacParse * aacparse, const guint8 * data,
@@ -410,7 +712,7 @@ gst_aac_parse_detect_stream (GstAacParse * aacparse,
     guint * framesize, gint * skipsize)
 {
   gboolean found = FALSE;
-  guint need_data = 0;
+  guint need_data_adts = 0, need_data_loas;
   guint i = 0;
 
   GST_DEBUG_OBJECT (aacparse, "Parsing header data");
@@ -419,12 +721,16 @@ gst_aac_parse_detect_stream (GstAacParse * aacparse,
      stream */
 
   /* Can we even parse the header? */
-  if (avail < ADTS_MAX_SIZE)
+  if (avail < MAX (ADTS_MAX_SIZE, LOAS_MAX_SIZE)) {
+    GST_DEBUG_OBJECT (aacparse, "Not enough data to check");
     return FALSE;
+  }
 
   for (i = 0; i < avail - 4; i++) {
     if (((data[i] == 0xff) && ((data[i + 1] & 0xf6) == 0xf0)) ||
+        ((data[0] == 0x56) && ((data[1] & 0xe0) == 0xe0)) ||
         strncmp ((char *) data + i, "ADIF", 4) == 0) {
+      GST_DEBUG_OBJECT (aacparse, "Found signature at offset %u", i);
       found = TRUE;
 
       if (i) {
@@ -444,15 +750,20 @@ gst_aac_parse_detect_stream (GstAacParse * aacparse,
   }
 
   if (gst_aac_parse_check_adts_frame (aacparse, data, avail, drain,
-          framesize, &need_data)) {
+          framesize, &need_data_adts)) {
     gint rate, channels;
 
     GST_INFO ("ADTS ID: %d, framesize: %d", (data[1] & 0x08) >> 3, *framesize);
 
-    aacparse->header_type = DSPAAC_HEADER_ADTS;
     gst_aac_parse_parse_adts_header (aacparse, data, &rate, &channels,
         &aacparse->object_type, &aacparse->mpegversion);
 
+    if (!channels || !framesize) {
+      GST_DEBUG_OBJECT (aacparse, "impossible ADTS configuration");
+      return FALSE;
+    }
+
+    aacparse->header_type = DSPAAC_HEADER_ADTS;
     gst_base_parse_set_frame_rate (GST_BASE_PARSE (aacparse), rate,
         aacparse->frame_samples, 2, 2);
 
@@ -462,7 +773,38 @@ gst_aac_parse_detect_stream (GstAacParse * aacparse,
     gst_base_parse_set_syncable (GST_BASE_PARSE (aacparse), TRUE);
 
     return TRUE;
-  } else if (need_data) {
+  }
+
+  if (gst_aac_parse_check_loas_frame (aacparse, data, avail, drain,
+          framesize, &need_data_loas)) {
+    gint rate, channels;
+
+    GST_INFO ("LOAS, framesize: %d", *framesize);
+
+    aacparse->header_type = DSPAAC_HEADER_LOAS;
+
+    if (!gst_aac_parse_read_loas_config (aacparse, data, avail, &rate,
+            &channels, &aacparse->mpegversion)) {
+      GST_WARNING_OBJECT (aacparse, "Error reading LOAS config");
+      return FALSE;
+    }
+
+    if (rate && channels) {
+      gst_base_parse_set_frame_rate (GST_BASE_PARSE (aacparse), rate,
+          aacparse->frame_samples, 2, 2);
+
+      GST_DEBUG ("LOAS: samplerate %d, channels %d, objtype %d, version %d",
+          rate, channels, aacparse->object_type, aacparse->mpegversion);
+      aacparse->sample_rate = rate;
+      aacparse->channels = channels;
+    }
+
+    gst_base_parse_set_syncable (GST_BASE_PARSE (aacparse), TRUE);
+
+    return TRUE;
+  }
+
+  if (need_data_adts || need_data_loas) {
     /* This tells the parent class not to skip any data */
     *skipsize = 0;
     return FALSE;
@@ -607,6 +949,19 @@ gst_aac_parse_check_valid_frame (GstBaseParse * parse,
           needed_data);
     }
 
+  } else if (aacparse->header_type == DSPAAC_HEADER_LOAS) {
+    guint needed_data = 1024;
+
+    ret = gst_aac_parse_check_loas_frame (aacparse, data,
+        GST_BUFFER_SIZE (buffer), GST_BASE_PARSE_DRAINING (parse),
+        framesize, &needed_data);
+
+    if (!ret) {
+      GST_DEBUG ("buffer didn't contain valid frame");
+      gst_base_parse_set_min_frame_size (GST_BASE_PARSE (aacparse),
+          needed_data);
+    }
+
   } else {
     GST_DEBUG ("buffer didn't contain valid frame");
     gst_base_parse_set_min_frame_size (GST_BASE_PARSE (aacparse),
@@ -626,7 +981,7 @@ gst_aac_parse_check_valid_frame (GstBaseParse * parse,
  *
  * Also determines frame overhead.
  * ADTS streams have a 7 byte header in each frame. MP4 and ADIF streams don't have
- * a per-frame header.
+ * a per-frame header. LOAS has 3 bytes.
  *
  * We're making a couple of simplifying assumptions:
  *
@@ -651,29 +1006,59 @@ gst_aac_parse_parse_frame (GstBaseParse * parse, GstBaseParseFrame * frame)
   aacparse = GST_AAC_PARSE (parse);
   buffer = frame->buffer;
 
-  if (G_UNLIKELY (aacparse->header_type != DSPAAC_HEADER_ADTS))
-    return ret;
+  if (aacparse->header_type == DSPAAC_HEADER_ADTS) {
+    /* see above */
+    frame->overhead = 7;
 
-  /* see above */
-  frame->overhead = 7;
+    gst_aac_parse_parse_adts_header (aacparse, GST_BUFFER_DATA (buffer),
+        &rate, &channels, NULL, NULL);
+    GST_LOG_OBJECT (aacparse, "rate: %d, chans: %d", rate, channels);
 
-  gst_aac_parse_parse_adts_header (aacparse, GST_BUFFER_DATA (buffer),
-      &rate, &channels, NULL, NULL);
-  GST_LOG_OBJECT (aacparse, "rate: %d, chans: %d", rate, channels);
+    if (G_UNLIKELY (rate != aacparse->sample_rate
+            || channels != aacparse->channels)) {
+      aacparse->sample_rate = rate;
+      aacparse->channels = channels;
 
-  if (G_UNLIKELY (rate != aacparse->sample_rate
-          || channels != aacparse->channels)) {
-    aacparse->sample_rate = rate;
-    aacparse->channels = channels;
+      if (!gst_aac_parse_set_src_caps (aacparse,
+              GST_PAD_CAPS (GST_BASE_PARSE (aacparse)->sinkpad))) {
+        /* If linking fails, we need to return appropriate error */
+        ret = GST_FLOW_NOT_LINKED;
+      }
 
-    if (!gst_aac_parse_set_src_caps (aacparse,
-            GST_PAD_CAPS (GST_BASE_PARSE (aacparse)->sinkpad))) {
-      /* If linking fails, we need to return appropriate error */
-      ret = GST_FLOW_NOT_LINKED;
+      gst_base_parse_set_frame_rate (GST_BASE_PARSE (aacparse),
+          aacparse->sample_rate, aacparse->frame_samples, 2, 2);
+    }
+  } else if (aacparse->header_type == DSPAAC_HEADER_LOAS) {
+    gboolean setcaps = FALSE;
+
+    /* see above */
+    frame->overhead = 3;
+
+    if (!gst_aac_parse_read_loas_config (aacparse, GST_BUFFER_DATA (buffer),
+            GST_BUFFER_SIZE (buffer), &rate, &channels, NULL)) {
+      GST_WARNING_OBJECT (aacparse, "Error reading LOAS config");
+    } else if (G_UNLIKELY (rate != aacparse->sample_rate
+            || channels != aacparse->channels)) {
+      aacparse->sample_rate = rate;
+      aacparse->channels = channels;
+      setcaps = TRUE;
+      GST_INFO_OBJECT (aacparse, "New LOAS config: %d Hz, %d channels", rate,
+          channels);
     }
 
-    gst_base_parse_set_frame_rate (GST_BASE_PARSE (aacparse),
-        aacparse->sample_rate, aacparse->frame_samples, 2, 2);
+    /* We want to set caps both at start, and when rate/channels change.
+       Since only some LOAS frames have that info, we may receive frames
+       before knowing about rate/channels. */
+    if (setcaps || !GST_PAD_CAPS (GST_BASE_PARSE_SRC_PAD (aacparse))) {
+      if (!gst_aac_parse_set_src_caps (aacparse,
+              GST_PAD_CAPS (GST_BASE_PARSE (aacparse)->sinkpad))) {
+        /* If linking fails, we need to return appropriate error */
+        ret = GST_FLOW_NOT_LINKED;
+      }
+
+      gst_base_parse_set_frame_rate (GST_BASE_PARSE (aacparse),
+          aacparse->sample_rate, aacparse->frame_samples, 2, 2);
+    }
   }
 
   return ret;
@@ -737,7 +1122,7 @@ gst_aac_parse_sink_getcaps (GstBaseParse * parse)
 
     res =
         gst_caps_intersect_full (peercaps,
-        gst_pad_get_pad_template_caps (GST_BASE_PARSE_SRC_PAD (parse)),
+        gst_pad_get_pad_template_caps (GST_BASE_PARSE_SINK_PAD (parse)),
         GST_CAPS_INTERSECT_FIRST);
     gst_caps_unref (peercaps);
   } else {
diff --git a/gst/audioparsers/gstaacparse.h b/gst/audioparsers/gstaacparse.h
index 1907c2e..11f75e6 100644
--- a/gst/audioparsers/gstaacparse.h
+++ b/gst/audioparsers/gstaacparse.h
@@ -45,6 +45,7 @@ G_BEGIN_DECLS
  * @DSPAAC_HEADER_UNKNOWN: Unknown (not recognized) header.
  * @DSPAAC_HEADER_ADIF: ADIF header found.
  * @DSPAAC_HEADER_ADTS: ADTS header found.
+ * @DSPAAC_HEADER_LOAS: LOAS header found.
  * @DSPAAC_HEADER_NONE: Raw stream, no header.
  *
  * Type header enumeration set in #header_type.
@@ -54,6 +55,7 @@ typedef enum {
   DSPAAC_HEADER_UNKNOWN,
   DSPAAC_HEADER_ADIF,
   DSPAAC_HEADER_ADTS,
+  DSPAAC_HEADER_LOAS,
   DSPAAC_HEADER_NONE
 } GstAacHeaderType;
 
diff --git a/gst/audioparsers/gstac3parse.c b/gst/audioparsers/gstac3parse.c
index 6fa4658..296b80f 100644
--- a/gst/audioparsers/gstac3parse.c
+++ b/gst/audioparsers/gstac3parse.c
@@ -174,8 +174,7 @@ gst_ac3_parse_base_init (gpointer klass)
 {
   GstElementClass *element_class = GST_ELEMENT_CLASS (klass);
 
-  gst_element_class_add_static_pad_template (element_class,
-      &sink_template);
+  gst_element_class_add_static_pad_template (element_class, &sink_template);
   gst_element_class_add_static_pad_template (element_class, &src_template);
 
   gst_element_class_set_details_simple (element_class,
@@ -688,7 +687,7 @@ gst_ac3_parse_get_sink_caps (GstBaseParse * parse)
 
     res =
         gst_caps_intersect_full (peercaps,
-        gst_pad_get_pad_template_caps (GST_BASE_PARSE_SRC_PAD (parse)),
+        gst_pad_get_pad_template_caps (GST_BASE_PARSE_SINK_PAD (parse)),
         GST_CAPS_INTERSECT_FIRST);
     gst_caps_unref (peercaps);
   } else {
diff --git a/gst/audioparsers/gstamrparse.c b/gst/audioparsers/gstamrparse.c
index 8f6ef94..bfdbcf1 100644
--- a/gst/audioparsers/gstamrparse.c
+++ b/gst/audioparsers/gstamrparse.c
@@ -101,8 +101,7 @@ gst_amr_parse_base_init (gpointer klass)
 {
   GstElementClass *element_class = GST_ELEMENT_CLASS (klass);
 
-  gst_element_class_add_static_pad_template (element_class,
-      &sink_template);
+  gst_element_class_add_static_pad_template (element_class, &sink_template);
   gst_element_class_add_static_pad_template (element_class, &src_template);
 
   gst_element_class_set_details_simple (element_class,
@@ -418,7 +417,7 @@ gst_amr_parse_sink_getcaps (GstBaseParse * parse)
 
     res =
         gst_caps_intersect_full (peercaps,
-        gst_pad_get_pad_template_caps (GST_BASE_PARSE_SRC_PAD (parse)),
+        gst_pad_get_pad_template_caps (GST_BASE_PARSE_SINK_PAD (parse)),
         GST_CAPS_INTERSECT_FIRST);
     gst_caps_unref (peercaps);
   } else {
diff --git a/gst/audioparsers/gstdcaparse.c b/gst/audioparsers/gstdcaparse.c
index c34d83e..1d5de06 100644
--- a/gst/audioparsers/gstdcaparse.c
+++ b/gst/audioparsers/gstdcaparse.c
@@ -87,8 +87,7 @@ gst_dca_parse_base_init (gpointer klass)
 {
   GstElementClass *element_class = GST_ELEMENT_CLASS (klass);
 
-  gst_element_class_add_static_pad_template (element_class,
-      &sink_template);
+  gst_element_class_add_static_pad_template (element_class, &sink_template);
   gst_element_class_add_static_pad_template (element_class, &src_template);
 
   gst_element_class_set_details_simple (element_class,
@@ -473,7 +472,7 @@ gst_dca_parse_get_sink_caps (GstBaseParse * parse)
 
     res =
         gst_caps_intersect_full (peercaps,
-        gst_pad_get_pad_template_caps (GST_BASE_PARSE_SRC_PAD (parse)),
+        gst_pad_get_pad_template_caps (GST_BASE_PARSE_SINK_PAD (parse)),
         GST_CAPS_INTERSECT_FIRST);
     gst_caps_unref (peercaps);
   } else {
diff --git a/gst/audioparsers/gstflacparse.c b/gst/audioparsers/gstflacparse.c
index 9cfdb98..c21b48b 100644
--- a/gst/audioparsers/gstflacparse.c
+++ b/gst/audioparsers/gstflacparse.c
@@ -184,6 +184,9 @@ static GstStaticPadTemplate sink_factory = GST_STATIC_PAD_TEMPLATE ("sink",
     GST_STATIC_CAPS ("audio/x-flac")
     );
 
+static GstBuffer *gst_flac_parse_generate_vorbiscomment (GstFlacParse *
+    flacparse);
+
 static void gst_flac_parse_finalize (GObject * object);
 static void gst_flac_parse_set_property (GObject * object, guint prop_id,
     const GValue * value, GParamSpec * pspec);
@@ -381,7 +384,8 @@ typedef enum
 
 static FrameHeaderCheckReturn
 gst_flac_parse_frame_header_is_valid (GstFlacParse * flacparse,
-    const guint8 * data, guint size, gboolean set, guint16 * block_size_ret)
+    const guint8 * data, guint size, gboolean set, guint16 * block_size_ret,
+    gboolean * suspect)
 {
   GstBitReader reader = GST_BIT_READER_INIT (data, size);
   guint8 blocking_strategy;
@@ -551,6 +555,16 @@ gst_flac_parse_frame_header_is_valid (GstFlacParse * flacparse,
     }
   }
 
+  /* documentation says:
+   * The "blocking strategy" bit must be the same throughout the entire stream. */
+  if (flacparse->blocking_strategy != blocking_strategy) {
+    if (flacparse->block_size != 0) {
+      GST_WARNING_OBJECT (flacparse, "blocking strategy is not constant");
+      if (suspect)
+        *suspect = TRUE;
+    }
+  }
+
   /* 
      The FLAC format documentation says:
      The "blocking strategy" bit determines how to calculate the sample number
@@ -575,6 +589,8 @@ gst_flac_parse_frame_header_is_valid (GstFlacParse * flacparse,
         /* TODO: can we know we're on the last frame, to avoid warning ? */
         GST_WARNING_OBJECT (flacparse, "Block size is not constant");
         block_size = flacparse->block_size;
+        if (suspect)
+          *suspect = TRUE;
       }
     }
   }
@@ -623,6 +639,7 @@ gst_flac_parse_frame_is_valid (GstFlacParse * flacparse,
   guint i, search_start, search_end;
   FrameHeaderCheckReturn header_ret;
   guint16 block_size;
+  gboolean suspect_start = FALSE, suspect_end = FALSE;
 
   buffer = frame->buffer;
   data = GST_BUFFER_DATA (buffer);
@@ -633,7 +650,7 @@ gst_flac_parse_frame_is_valid (GstFlacParse * flacparse,
 
   header_ret =
       gst_flac_parse_frame_header_is_valid (flacparse, data, size, TRUE,
-      &block_size);
+      &block_size, &suspect_start);
   if (header_ret == FRAME_HEADER_INVALID) {
     *ret = 0;
     return FALSE;
@@ -653,16 +670,23 @@ gst_flac_parse_frame_is_valid (GstFlacParse * flacparse,
 
   for (i = search_start; i < search_end; i++, remaining--) {
     if ((GST_READ_UINT16_BE (data + i) & 0xfffe) == 0xfff8) {
+      GST_LOG_OBJECT (flacparse, "possible frame end at offset %d", i);
+      suspect_end = FALSE;
       header_ret =
           gst_flac_parse_frame_header_is_valid (flacparse, data + i, remaining,
-          FALSE, NULL);
+          FALSE, NULL, &suspect_end);
       if (header_ret == FRAME_HEADER_VALID) {
-        if (flacparse->check_frame_checksums) {
+        if (flacparse->check_frame_checksums || suspect_start || suspect_end) {
           guint16 actual_crc = gst_flac_calculate_crc16 (data, i - 2);
           guint16 expected_crc = GST_READ_UINT16_BE (data + i - 2);
 
-          if (actual_crc != expected_crc)
+          GST_LOG_OBJECT (flacparse,
+              "checking checksum, frame suspect (%d, %d)",
+              suspect_start, suspect_end);
+          if (actual_crc != expected_crc) {
+            GST_DEBUG_OBJECT (flacparse, "checksum did not match");
             continue;
+          }
         }
         *ret = i;
         flacparse->block_size = block_size;
@@ -691,6 +715,15 @@ gst_flac_parse_frame_is_valid (GstFlacParse * flacparse,
     }
   }
 
+  /* so we searched to expected end and found nothing,
+   * give up on this frame (start) */
+  if (flacparse->max_framesize && i > 2 * flacparse->max_framesize) {
+    GST_LOG_OBJECT (flacparse,
+        "could not determine valid frame end, discarding frame (start)");
+    *ret = 1;
+    return FALSE;
+  }
+
 need_more:
   max = flacparse->max_framesize + 16;
   if (max == 16)
@@ -1038,6 +1071,16 @@ gst_flac_parse_handle_headers (GstFlacParse * flacparse)
     }
   }
 
+  /* at least this one we can generate easily
+   * to provide full headers downstream */
+  if (vorbiscomment == NULL && streaminfo != NULL) {
+    GST_DEBUG_OBJECT (flacparse,
+        "missing vorbiscomment header; generating dummy");
+    vorbiscomment = gst_flac_parse_generate_vorbiscomment (flacparse);
+    flacparse->headers = g_list_insert (flacparse->headers, vorbiscomment,
+        g_list_index (flacparse->headers, streaminfo) + 1);
+  }
+
   if (marker == NULL || streaminfo == NULL || vorbiscomment == NULL) {
     GST_WARNING_OBJECT (flacparse,
         "missing header %p %p %p, muxing into container "
@@ -1120,10 +1163,54 @@ push_headers:
   return res;
 }
 
+/* empty vorbiscomment */
+static GstBuffer *
+gst_flac_parse_generate_vorbiscomment (GstFlacParse * flacparse)
+{
+  GstTagList *taglist = gst_tag_list_new ();
+  guchar header[4];
+  guint size;
+  GstBuffer *vorbiscomment;
+  guint8 *data;
+
+  header[0] = 0x84;             /* is_last = 1; type = 4; */
+
+  vorbiscomment =
+      gst_tag_list_to_vorbiscomment_buffer (taglist, header,
+      sizeof (header), NULL);
+  gst_tag_list_free (taglist);
+
+  data = GST_BUFFER_DATA (vorbiscomment);
+  size = GST_BUFFER_SIZE (vorbiscomment);
+
+  /* Get rid of framing bit */
+  if (data[size - 1] == 1) {
+    GstBuffer *sub;
+
+    sub = gst_buffer_create_sub (vorbiscomment, 0, size - 1);
+    gst_buffer_unref (vorbiscomment);
+    vorbiscomment = sub;
+
+    data = GST_BUFFER_DATA (vorbiscomment);
+  }
+
+  size = GST_BUFFER_SIZE (vorbiscomment) - 4;
+  data[1] = ((size & 0xFF0000) >> 16);
+  data[2] = ((size & 0x00FF00) >> 8);
+  data[3] = (size & 0x0000FF);
+
+  GST_BUFFER_TIMESTAMP (vorbiscomment) = GST_CLOCK_TIME_NONE;
+  GST_BUFFER_DURATION (vorbiscomment) = GST_CLOCK_TIME_NONE;
+  GST_BUFFER_OFFSET (vorbiscomment) = 0;
+  GST_BUFFER_OFFSET_END (vorbiscomment) = 0;
+
+  return vorbiscomment;
+}
+
 static gboolean
 gst_flac_parse_generate_headers (GstFlacParse * flacparse)
 {
-  GstBuffer *marker, *streaminfo, *vorbiscomment;
+  GstBuffer *marker, *streaminfo;
   guint8 *data;
 
   marker = gst_buffer_new_and_alloc (4);
@@ -1190,42 +1277,8 @@ gst_flac_parse_generate_headers (GstFlacParse * flacparse)
   GST_BUFFER_OFFSET_END (streaminfo) = 0;
   flacparse->headers = g_list_append (flacparse->headers, streaminfo);
 
-  /* empty vorbiscomment */
-  {
-    GstTagList *taglist = gst_tag_list_new ();
-    guchar header[4];
-    guint size;
-
-    header[0] = 0x84;           /* is_last = 1; type = 4; */
-
-    vorbiscomment =
-        gst_tag_list_to_vorbiscomment_buffer (taglist, header,
-        sizeof (header), NULL);
-    gst_tag_list_free (taglist);
-
-    /* Get rid of framing bit */
-    if (GST_BUFFER_DATA (vorbiscomment)[GST_BUFFER_SIZE (vorbiscomment) -
-            1] == 1) {
-      GstBuffer *sub;
-
-      sub =
-          gst_buffer_create_sub (vorbiscomment, 0,
-          GST_BUFFER_SIZE (vorbiscomment) - 1);
-      gst_buffer_unref (vorbiscomment);
-      vorbiscomment = sub;
-    }
-
-    size = GST_BUFFER_SIZE (vorbiscomment) - 4;
-    GST_BUFFER_DATA (vorbiscomment)[1] = ((size & 0xFF0000) >> 16);
-    GST_BUFFER_DATA (vorbiscomment)[2] = ((size & 0x00FF00) >> 8);
-    GST_BUFFER_DATA (vorbiscomment)[3] = (size & 0x0000FF);
-
-    GST_BUFFER_TIMESTAMP (vorbiscomment) = GST_CLOCK_TIME_NONE;
-    GST_BUFFER_DURATION (vorbiscomment) = GST_CLOCK_TIME_NONE;
-    GST_BUFFER_OFFSET (vorbiscomment) = 0;
-    GST_BUFFER_OFFSET_END (vorbiscomment) = 0;
-    flacparse->headers = g_list_append (flacparse->headers, vorbiscomment);
-  }
+  flacparse->headers = g_list_append (flacparse->headers,
+      gst_flac_parse_generate_vorbiscomment (flacparse));
 
   return TRUE;
 }
@@ -1313,7 +1366,7 @@ gst_flac_parse_parse_frame (GstBaseParse * parse, GstBaseParseFrame * frame)
       flacparse->offset = GST_BUFFER_OFFSET (buffer);
       ret =
           gst_flac_parse_frame_header_is_valid (flacparse,
-          GST_BUFFER_DATA (buffer), GST_BUFFER_SIZE (buffer), TRUE, NULL);
+          GST_BUFFER_DATA (buffer), GST_BUFFER_SIZE (buffer), TRUE, NULL, NULL);
       if (ret != FRAME_HEADER_VALID) {
         GST_ERROR_OBJECT (flacparse,
             "Baseclass didn't provide a complete frame");
@@ -1454,7 +1507,7 @@ gst_flac_parse_get_sink_caps (GstBaseParse * parse)
 
     res =
         gst_caps_intersect_full (peercaps,
-        gst_pad_get_pad_template_caps (GST_BASE_PARSE_SRC_PAD (parse)),
+        gst_pad_get_pad_template_caps (GST_BASE_PARSE_SINK_PAD (parse)),
         GST_CAPS_INTERSECT_FIRST);
     gst_caps_unref (peercaps);
   } else {
diff --git a/gst/audioparsers/gstmpegaudioparse.c b/gst/audioparsers/gstmpegaudioparse.c
index 2381fc3..43c330c 100644
--- a/gst/audioparsers/gstmpegaudioparse.c
+++ b/gst/audioparsers/gstmpegaudioparse.c
@@ -146,8 +146,7 @@ gst_mpeg_audio_parse_base_init (gpointer klass)
 {
   GstElementClass *element_class = GST_ELEMENT_CLASS (klass);
 
-  gst_element_class_add_static_pad_template (element_class,
-      &sink_template);
+  gst_element_class_add_static_pad_template (element_class, &sink_template);
   gst_element_class_add_static_pad_template (element_class, &src_template);
 
   gst_element_class_set_details_simple (element_class, "MPEG1 Audio Parser",
@@ -200,6 +199,7 @@ gst_mpeg_audio_parse_reset (GstMpegAudioParse * mp3parse)
   mp3parse->sent_codec_tag = FALSE;
   mp3parse->last_posted_crc = CRC_UNKNOWN;
   mp3parse->last_posted_channel_mode = MPEG_AUDIO_CHANNEL_MODE_UNKNOWN;
+  mp3parse->freerate = 0;
 
   mp3parse->hdr_bitrate = 0;
 
@@ -307,14 +307,16 @@ mp3_type_frame_length_from_header (GstMpegAudioParse * mp3parse, guint32 header,
 
   bitrate = (header >> 12) & 0xF;
   bitrate = mp3types_bitrates[lsf][layer - 1][bitrate] * 1000;
-  /* The caller has ensured we have a valid header, so bitrate can't be
-     zero here. */
-  g_assert (bitrate != 0);
+  if (!bitrate) {
+    GST_LOG_OBJECT (mp3parse, "using freeform bitrate");
+    bitrate = mp3parse->freerate;
+  }
 
   samplerate = (header >> 10) & 0x3;
   samplerate = mp3types_freqs[lsf + mpg25][samplerate];
 
-  padding = (header >> 9) & 0x1;
+  /* force 0 length if 0 bitrate */
+  padding = (bitrate > 0) ? (header >> 9) & 0x1 : 0;
 
   mode = (header >> 6) & 0x3;
   channels = (mode == 3) ? 1 : 2;
@@ -419,8 +421,7 @@ gst_mp3parse_validate_extended (GstMpegAudioParse * mp3parse, GstBuffer * buf,
           (guint) next_header & HDRMASK, bpf);
       *valid = FALSE;
       return TRUE;
-    } else if ((((next_header >> 12) & 0xf) == 0) ||
-        (((next_header >> 12) & 0xf) == 0xf)) {
+    } else if (((next_header >> 12) & 0xf) == 0xf) {
       /* The essential parts were the same, but the bitrate held an
          invalid value - also reject */
       GST_DEBUG_OBJECT (mp3parse, "next header invalid (bitrate)");
@@ -431,6 +432,13 @@ gst_mp3parse_validate_extended (GstMpegAudioParse * mp3parse, GstBuffer * buf,
     bpf = mp3_type_frame_length_from_header (mp3parse, next_header,
         NULL, NULL, NULL, NULL, NULL, NULL, NULL);
 
+    /* if no bitrate, and no freeform rate known, then fail */
+    if (G_UNLIKELY (!bpf)) {
+      GST_DEBUG_OBJECT (mp3parse, "next header invalid (bitrate 0)");
+      *valid = FALSE;
+      return TRUE;
+    }
+
     offset += bpf;
     frames_found++;
   }
@@ -461,11 +469,6 @@ gst_mpeg_audio_parse_head_check (GstMpegAudioParse * mp3parse,
     return FALSE;
   }
   /* if it's an invalid bitrate */
-  if (((head >> 12) & 0xf) == 0x0) {
-    GST_WARNING_OBJECT (mp3parse, "invalid bitrate: 0x%lx."
-        "Free format files are not supported yet", (head >> 12) & 0xf);
-    return FALSE;
-  }
   if (((head >> 12) & 0xf) == 0xf) {
     GST_WARNING_OBJECT (mp3parse, "invalid bitrate: 0x%lx", (head >> 12) & 0xf);
     return FALSE;
@@ -486,6 +489,115 @@ gst_mpeg_audio_parse_head_check (GstMpegAudioParse * mp3parse,
   return TRUE;
 }
 
+/* Determines possible freeform frame rate/size by looking for next
+ * header with valid bitrate (0 or otherwise valid) (and sufficiently
+ * matching current header).
+ *
+ * Returns TRUE if we've found such one, and *rate then contains rate
+ * (or *rate contains 0 if decided no freeframe size could be determined).
+ * If not enough data, returns FALSE.
+ */
+static gboolean
+gst_mp3parse_find_freerate (GstMpegAudioParse * mp3parse, GstBuffer * buf,
+    guint32 header, gboolean at_eos, gint * _rate)
+{
+  guint32 next_header;
+  const guint8 *data;
+  guint available;
+  int offset = 4;
+  gulong samplerate, rate, layer, padding;
+  gboolean valid;
+  gint lsf, mpg25;
+
+  available = GST_BUFFER_SIZE (buf);
+  data = GST_BUFFER_DATA (buf);
+
+  *_rate = 0;
+
+  /* pick apart header again partially */
+  if (header & (1 << 20)) {
+    lsf = (header & (1 << 19)) ? 0 : 1;
+    mpg25 = 0;
+  } else {
+    lsf = 1;
+    mpg25 = 1;
+  }
+  layer = 4 - ((header >> 17) & 0x3);
+  samplerate = (header >> 10) & 0x3;
+  samplerate = mp3types_freqs[lsf + mpg25][samplerate];
+  padding = (header >> 9) & 0x1;
+
+  for (; offset < available; ++offset) {
+    /* Check if we have enough data for all these frames, plus the next
+       frame header. */
+    if (available < offset + 4) {
+      if (at_eos) {
+        /* Running out of data; failed to determine size */
+        return TRUE;
+      } else {
+        return FALSE;
+      }
+    }
+
+    valid = FALSE;
+    next_header = GST_READ_UINT32_BE (data + offset);
+    if ((next_header & 0xFFE00000) != 0xFFE00000)
+      goto next;
+
+    GST_DEBUG_OBJECT (mp3parse, "At %d: header=%08X, header2=%08X",
+        offset, (unsigned int) header, (unsigned int) next_header);
+
+    if ((next_header & HDRMASK) != (header & HDRMASK)) {
+      /* If any of the unmasked bits don't match, then it's not valid */
+      GST_DEBUG_OBJECT (mp3parse, "next header doesn't match "
+          "(header=%08X (%08X), header2=%08X (%08X))",
+          (guint) header, (guint) header & HDRMASK, (guint) next_header,
+          (guint) next_header & HDRMASK);
+      goto next;
+    } else if (((next_header >> 12) & 0xf) == 0xf) {
+      /* The essential parts were the same, but the bitrate held an
+         invalid value - also reject */
+      GST_DEBUG_OBJECT (mp3parse, "next header invalid (bitrate)");
+      goto next;
+    }
+
+    valid = TRUE;
+
+  next:
+    /* almost accept as free frame */
+    if (layer == 1) {
+      rate = samplerate * (offset - 4 * padding + 4) / 48000;
+    } else {
+      rate = samplerate * (offset - padding + 1) / (144 >> lsf) / 1000;
+    }
+
+    if (valid) {
+      GST_LOG_OBJECT (mp3parse, "calculated rate %lu", rate * 1000);
+      if (rate < 8 || (layer == 3 && rate > 640)) {
+        GST_DEBUG_OBJECT (mp3parse, "rate invalid");
+        if (rate < 8) {
+          /* maybe some hope */
+          continue;
+        } else {
+          GST_DEBUG_OBJECT (mp3parse, "aborting");
+          /* give up */
+          break;
+        }
+      }
+      *_rate = rate * 1000;
+      break;
+    } else {
+      /* avoid indefinite searching */
+      if (rate > 1000) {
+        GST_DEBUG_OBJECT (mp3parse, "exceeded sanity rate; aborting");
+        break;
+      }
+    }
+  }
+
+  return TRUE;
+}
+
 static gboolean
 gst_mpeg_audio_parse_check_valid_frame (GstBaseParse * parse,
     GstBaseParseFrame * frame, guint * framesize, gint * skipsize)
@@ -527,9 +639,14 @@ gst_mpeg_audio_parse_check_valid_frame (GstBaseParse * parse,
 
   GST_LOG_OBJECT (parse, "got frame");
 
+  lost_sync = GST_BASE_PARSE_LOST_SYNC (parse);
+  draining = GST_BASE_PARSE_DRAINING (parse);
+
+  if (G_UNLIKELY (lost_sync))
+    mp3parse->freerate = 0;
+
   bpf = mp3_type_frame_length_from_header (mp3parse, header,
       &version, &layer, &channels, &bitrate, &rate, &mode, &crc);
-  g_assert (bpf != 0);
 
   if (channels != mp3parse->channels || rate != mp3parse->rate ||
       layer != mp3parse->layer || version != mp3parse->version)
@@ -537,8 +654,30 @@ gst_mpeg_audio_parse_check_valid_frame (GstBaseParse * parse,
   else
     caps_change = FALSE;
 
-  lost_sync = GST_BASE_PARSE_LOST_SYNC (parse);
-  draining = GST_BASE_PARSE_DRAINING (parse);
+  /* maybe free format */
+  if (bpf == 0) {
+    GST_LOG_OBJECT (mp3parse, "possibly free format");
+    if (lost_sync || mp3parse->freerate == 0) {
+      GST_DEBUG_OBJECT (mp3parse, "finding free format rate");
+      if (!gst_mp3parse_find_freerate (mp3parse, buf, header, draining, &valid)) {
+        /* not enough data */
+        *framesize = G_MAXUINT;
+        *skipsize = 0;
+        return FALSE;
+      } else {
+        GST_DEBUG_OBJECT (parse, "determined freeform size %d", valid);
+        mp3parse->freerate = valid;
+      }
+    }
+    /* try again */
+    bpf = mp3_type_frame_length_from_header (mp3parse, header,
+        &version, &layer, &channels, &bitrate, &rate, &mode, &crc);
+    if (!bpf) {
+      /* did not come up with valid freeform length, reject after all */
+      *skipsize = 1;
+      return FALSE;
+    }
+  }
 
   if (!draining && (lost_sync || caps_change)) {
     if (!gst_mp3parse_validate_extended (mp3parse, buf, header, bpf, draining,
@@ -791,9 +930,7 @@ gst_mpeg_audio_parse_handle_first_frame (GstMpegAudioParse * mp3parse,
       GST_DEBUG_OBJECT (mp3parse, "Encoder delay %u, encoder padding %u",
           encoder_delay, encoder_padding);
     }
-  }
-
-  if (read_id_vbri == vbri_id) {
+  } else if (read_id_vbri == vbri_id) {
     gint64 total_bytes, total_frames;
     GstClockTime total_time;
     guint16 nseek_points;
@@ -1293,7 +1430,7 @@ gst_mpeg_audio_parse_get_sink_caps (GstBaseParse * parse)
 
     res =
         gst_caps_intersect_full (peercaps,
-        gst_pad_get_pad_template_caps (GST_BASE_PARSE_SRC_PAD (parse)),
+        gst_pad_get_pad_template_caps (GST_BASE_PARSE_SINK_PAD (parse)),
         GST_CAPS_INTERSECT_FIRST);
     gst_caps_unref (peercaps);
   } else {
diff --git a/gst/audioparsers/gstmpegaudioparse.h b/gst/audioparsers/gstmpegaudioparse.h
index 7580001..6b42673 100644
--- a/gst/audioparsers/gstmpegaudioparse.h
+++ b/gst/audioparsers/gstmpegaudioparse.h
@@ -60,6 +60,8 @@ struct _GstMpegAudioParse {
   /* samples per frame */
   gint        spf;
 
+  gint         freerate;
+
   gboolean     sent_codec_tag;
   guint        last_posted_bitrate;
   gint         last_posted_crc, last_crc;
diff --git a/gst/audioparsers/gstwavpackparse.c b/gst/audioparsers/gstwavpackparse.c
new file mode 100644
index 0000000..18c2fc2
--- /dev/null
+++ b/gst/audioparsers/gstwavpackparse.c
@@ -0,0 +1,648 @@
+/* GStreamer Wavpack parser
+ * Copyright (C) 2012 Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
+ * Copyright (C) 2012 Nokia Corporation. All rights reserved.
+ *   Contact: Stefan Kost <stefan.kost@nokia.com>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+/**
+ * SECTION:element-wavpackparse
+ * @short_description: Wavpack parser
+ * @see_also: #GstAmrParse, #GstAACParse
+ *
+ * This is an Wavpack parser.
+ *
+ * <refsect2>
+ * <title>Example launch line</title>
+ * |[
+ * gst-launch filesrc location=abc.wavpack ! wavpackparse ! wavpackdec ! audioresample ! audioconvert ! autoaudiosink
+ * ]|
+ * </refsect2>
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include <string.h>
+
+#include "gstwavpackparse.h"
+
+#include <gst/base/gstbytereader.h>
+#include <gst/audio/multichannel.h>
+
+GST_DEBUG_CATEGORY_STATIC (wavpack_parse_debug);
+#define GST_CAT_DEFAULT wavpack_parse_debug
+
+static GstStaticPadTemplate src_template = GST_STATIC_PAD_TEMPLATE ("src",
+    GST_PAD_SRC,
+    GST_PAD_ALWAYS,
+    GST_STATIC_CAPS ("audio/x-wavpack, "
+        "width = (int) [ 1, 32 ], "
+        "channels = (int) [ 1, 8 ], "
+        "rate = (int) [ 6000, 192000 ], " "framed = (boolean) TRUE; "
+        "audio/x-wavpack-correction, " "framed = (boolean) TRUE")
+    );
+
+static GstStaticPadTemplate sink_template = GST_STATIC_PAD_TEMPLATE ("sink",
+    GST_PAD_SINK,
+    GST_PAD_ALWAYS,
+    GST_STATIC_CAPS ("audio/x-wavpack"));
+
+static void gst_wavpack_parse_finalize (GObject * object);
+
+static gboolean gst_wavpack_parse_start (GstBaseParse * parse);
+static gboolean gst_wavpack_parse_stop (GstBaseParse * parse);
+static gboolean gst_wavpack_parse_check_valid_frame (GstBaseParse * parse,
+    GstBaseParseFrame * frame, guint * size, gint * skipsize);
+static GstFlowReturn gst_wavpack_parse_parse_frame (GstBaseParse * parse,
+    GstBaseParseFrame * frame);
+static GstCaps *gst_wavpack_parse_get_sink_caps (GstBaseParse * parse);
+
+/* FIXME remove when all properly renamed */
+typedef GstWavpackParse GstWavpackParse2;
+typedef GstWavpackParseClass GstWavpackParse2Class;
+
+GST_BOILERPLATE (GstWavpackParse2, gst_wavpack_parse, GstBaseParse,
+    GST_TYPE_BASE_PARSE);
+
+static void
+gst_wavpack_parse_base_init (gpointer klass)
+{
+  GstElementClass *element_class = GST_ELEMENT_CLASS (klass);
+
+  gst_element_class_add_static_pad_template (element_class, &sink_template);
+  gst_element_class_add_static_pad_template (element_class, &src_template);
+
+  gst_element_class_set_details_simple (element_class,
+      "Wavpack audio stream parser", "Codec/Parser/Audio",
+      "Wavpack parser", "Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>");
+}
+
+static void
+gst_wavpack_parse_class_init (GstWavpackParseClass * klass)
+{
+  GstBaseParseClass *parse_class = GST_BASE_PARSE_CLASS (klass);
+  GObjectClass *object_class = G_OBJECT_CLASS (klass);
+
+  GST_DEBUG_CATEGORY_INIT (wavpack_parse_debug, "wavpackparse", 0,
+      "Wavpack audio stream parser");
+
+  object_class->finalize = gst_wavpack_parse_finalize;
+
+  parse_class->start = GST_DEBUG_FUNCPTR (gst_wavpack_parse_start);
+  parse_class->stop = GST_DEBUG_FUNCPTR (gst_wavpack_parse_stop);
+  parse_class->check_valid_frame =
+      GST_DEBUG_FUNCPTR (gst_wavpack_parse_check_valid_frame);
+  parse_class->parse_frame = GST_DEBUG_FUNCPTR (gst_wavpack_parse_parse_frame);
+  parse_class->get_sink_caps =
+      GST_DEBUG_FUNCPTR (gst_wavpack_parse_get_sink_caps);
+}
+
+static void
+gst_wavpack_parse_reset (GstWavpackParse * wvparse)
+{
+  wvparse->channels = -1;
+  wvparse->channel_mask = 0;
+  wvparse->sample_rate = -1;
+  wvparse->width = -1;
+  wvparse->total_samples = 0;
+}
+
+static void
+gst_wavpack_parse_init (GstWavpackParse * wvparse, GstWavpackParseClass * klass)
+{
+  gst_wavpack_parse_reset (wvparse);
+}
+
+static void
+gst_wavpack_parse_finalize (GObject * object)
+{
+  G_OBJECT_CLASS (parent_class)->finalize (object);
+}
+
+static gboolean
+gst_wavpack_parse_start (GstBaseParse * parse)
+{
+  GstWavpackParse *wvparse = GST_WAVPACK_PARSE (parse);
+
+  GST_DEBUG_OBJECT (parse, "starting");
+
+  gst_wavpack_parse_reset (wvparse);
+
+  /* need header at least */
+  gst_base_parse_set_min_frame_size (GST_BASE_PARSE (wvparse),
+      sizeof (WavpackHeader));
+
+  /* inform baseclass we can come up with ts, based on counters in packets */
+  gst_base_parse_set_has_timing_info (GST_BASE_PARSE_CAST (wvparse), TRUE);
+  gst_base_parse_set_syncable (GST_BASE_PARSE_CAST (wvparse), TRUE);
+
+  return TRUE;
+}
+
+static gboolean
+gst_wavpack_parse_stop (GstBaseParse * parse)
+{
+  GST_DEBUG_OBJECT (parse, "stopping");
+
+  return TRUE;
+}
+
+static gint
+gst_wavpack_get_default_channel_mask (gint nchannels)
+{
+  gint channel_mask = 0;
+
+  /* Set the default channel mask for the given number of channels.
+   * It's the same as for WAVE_FORMAT_EXTENDED:
+   * http://www.microsoft.com/whdc/device/audio/multichaud.mspx
+   */
+  switch (nchannels) {
+    case 11:
+      channel_mask |= 0x00400;
+      channel_mask |= 0x00200;
+    case 9:
+      channel_mask |= 0x00100;
+    case 8:
+      channel_mask |= 0x00080;
+      channel_mask |= 0x00040;
+    case 6:
+      channel_mask |= 0x00020;
+      channel_mask |= 0x00010;
+    case 4:
+      channel_mask |= 0x00008;
+    case 3:
+      channel_mask |= 0x00004;
+    case 2:
+      channel_mask |= 0x00002;
+      channel_mask |= 0x00001;
+      break;
+    case 1:
+      /* For mono use front center */
+      channel_mask |= 0x00004;
+      break;
+  }
+
+  return channel_mask;
+}
+
+static const struct
+{
+  const guint32 ms_mask;
+  const GstAudioChannelPosition gst_pos;
+} layout_mapping[] = {
+  {
+  0x00001, GST_AUDIO_CHANNEL_POSITION_FRONT_LEFT}, {
+  0x00002, GST_AUDIO_CHANNEL_POSITION_FRONT_RIGHT}, {
+  0x00004, GST_AUDIO_CHANNEL_POSITION_FRONT_CENTER}, {
+  0x00008, GST_AUDIO_CHANNEL_POSITION_LFE}, {
+  0x00010, GST_AUDIO_CHANNEL_POSITION_REAR_LEFT}, {
+  0x00020, GST_AUDIO_CHANNEL_POSITION_REAR_RIGHT}, {
+  0x00040, GST_AUDIO_CHANNEL_POSITION_FRONT_LEFT_OF_CENTER}, {
+  0x00080, GST_AUDIO_CHANNEL_POSITION_FRONT_RIGHT_OF_CENTER}, {
+  0x00100, GST_AUDIO_CHANNEL_POSITION_REAR_CENTER}, {
+  0x00200, GST_AUDIO_CHANNEL_POSITION_SIDE_LEFT}, {
+  0x00400, GST_AUDIO_CHANNEL_POSITION_SIDE_RIGHT}, {
+  0x00800, GST_AUDIO_CHANNEL_POSITION_INVALID}, /* TOP_CENTER       */
+  {
+  0x01000, GST_AUDIO_CHANNEL_POSITION_INVALID}, /* TOP_FRONT_LEFT   */
+  {
+  0x02000, GST_AUDIO_CHANNEL_POSITION_INVALID}, /* TOP_FRONT_CENTER */
+  {
+  0x04000, GST_AUDIO_CHANNEL_POSITION_INVALID}, /* TOP_FRONT_RIGHT  */
+  {
+  0x08000, GST_AUDIO_CHANNEL_POSITION_INVALID}, /* TOP_BACK_LEFT    */
+  {
+  0x10000, GST_AUDIO_CHANNEL_POSITION_INVALID}, /* TOP_BACK_CENTER  */
+  {
+  0x20000, GST_AUDIO_CHANNEL_POSITION_INVALID}  /* TOP_BACK_RIGHT   */
+};
+
+#define MAX_CHANNEL_POSITIONS G_N_ELEMENTS (layout_mapping)
+
+static gboolean
+gst_wavpack_set_channel_layout (GstCaps * caps, gint layout)
+{
+  GstAudioChannelPosition pos[MAX_CHANNEL_POSITIONS];
+  GstStructure *s;
+  gint num_channels, i, p;
+
+  s = gst_caps_get_structure (caps, 0);
+  if (!gst_structure_get_int (s, "channels", &num_channels))
+    g_return_val_if_reached (FALSE);
+
+  if (num_channels == 1 && layout == 0x00004) {
+    pos[0] = GST_AUDIO_CHANNEL_POSITION_FRONT_MONO;
+    gst_audio_set_channel_positions (s, pos);
+    return TRUE;
+  }
+
+  p = 0;
+  for (i = 0; i < MAX_CHANNEL_POSITIONS; ++i) {
+    if ((layout & layout_mapping[i].ms_mask) != 0) {
+      if (p >= num_channels) {
+        GST_WARNING ("More bits set in the channel layout map than there "
+            "are channels! Broken file");
+        return FALSE;
+      }
+      if (layout_mapping[i].gst_pos == GST_AUDIO_CHANNEL_POSITION_INVALID) {
+        GST_WARNING ("Unsupported channel position (mask 0x%08x) in channel "
+            "layout map - ignoring those channels", layout_mapping[i].ms_mask);
+        /* what to do? just ignore it and let downstream deal with a channel
+         * layout that has INVALID positions in it for now ... */
+      }
+      pos[p] = layout_mapping[i].gst_pos;
+      ++p;
+    }
+  }
+
+  if (p != num_channels) {
+    GST_WARNING ("Only %d bits set in the channel layout map, but there are "
+        "supposed to be %d channels! Broken file", p, num_channels);
+    return FALSE;
+  }
+
+  gst_audio_set_channel_positions (s, pos);
+  return TRUE;
+}
+
+static const guint32 sample_rates[] = {
+  6000, 8000, 9600, 11025, 12000, 16000, 22050,
+  24000, 32000, 44100, 48000, 64000, 88200, 96000, 192000
+};
+
+#define CHECK(call) { \
+  if (!call) \
+    goto read_failed; \
+}
+
+/* caller ensures properly sync'ed with enough data */
+static gboolean
+gst_wavpack_parse_frame_metadata (GstWavpackParse * parse, GstBuffer * buf,
+    gint skip, WavpackHeader * wph, WavpackInfo * wpi)
+{
+  GstByteReader br;
+  gint i;
+
+  g_return_val_if_fail (wph != NULL || wpi != NULL, FALSE);
+  g_return_val_if_fail (GST_BUFFER_SIZE (buf) >= skip + sizeof (WavpackHeader),
+      FALSE);
+
+  gst_byte_reader_init (&br, GST_BUFFER_DATA (buf) + skip, wph->ckSize + 8);
+  /* skip past header */
+  gst_byte_reader_skip_unchecked (&br, sizeof (WavpackHeader));
+
+  /* get some basics from header */
+  i = (wph->flags >> 23) & 0xF;
+  if (!wpi->rate)
+    wpi->rate = (i < G_N_ELEMENTS (sample_rates)) ? sample_rates[i] : 44100;
+  wpi->width = ((wph->flags & 0x3) + 1) * 8;
+  if (!wpi->channels)
+    wpi->channels = (wph->flags & 0x4) ? 1 : 2;
+  if (!wpi->channel_mask)
+    wpi->channel_mask = 5 - wpi->channels;
+
+  /* need to dig metadata blocks for some more */
+  while (gst_byte_reader_get_remaining (&br)) {
+    gint size = 0;
+    guint16 size2 = 0;
+    guint8 c, id;
+    const guint8 *data;
+    GstByteReader mbr;
+
+    CHECK (gst_byte_reader_get_uint8 (&br, &id));
+    CHECK (gst_byte_reader_get_uint8 (&br, &c));
+    if (id & ID_LARGE)
+      CHECK (gst_byte_reader_get_uint16_le (&br, &size2));
+    size = size2;
+    size <<= 8;
+    size += c;
+    size <<= 1;
+    if (id & ID_ODD_SIZE)
+      size--;
+
+    CHECK (gst_byte_reader_get_data (&br, size + (size & 1), &data));
+    gst_byte_reader_init (&mbr, data, size);
+
+    switch (id) {
+      case ID_WVC_BITSTREAM:
+        GST_LOG_OBJECT (parse, "correction bitstream");
+        wpi->correction = TRUE;
+        break;
+      case ID_WV_BITSTREAM:
+      case ID_WVX_BITSTREAM:
+        break;
+      case ID_SAMPLE_RATE:
+        if (size == 3) {
+          CHECK (gst_byte_reader_get_uint24_le (&mbr, &wpi->rate));
+          GST_LOG_OBJECT (parse, "updated with custom rate %d", wpi->rate);
+        } else {
+          GST_DEBUG_OBJECT (parse, "unexpected size for SAMPLE_RATE metadata");
+        }
+        break;
+      case ID_CHANNEL_INFO:
+      {
+        guint16 channels;
+        guint32 mask = 0;
+
+        if (size == 6) {
+          CHECK (gst_byte_reader_get_uint16_le (&mbr, &channels));
+          channels = channels & 0xFFF;
+          CHECK (gst_byte_reader_get_uint24_le (&mbr, &mask));
+        } else if (size) {
+          CHECK (gst_byte_reader_get_uint8 (&mbr, &c));
+          channels = c;
+          while (gst_byte_reader_get_uint8 (&mbr, &c))
+            mask |= (((guint32) c) << 8);
+        } else {
+          GST_DEBUG_OBJECT (parse, "unexpected size for CHANNEL_INFO metadata");
+          break;
+        }
+        wpi->channels = channels;
+        wpi->channel_mask = mask;
+        break;
+      }
+      default:
+        GST_LOG_OBJECT (parse, "unparsed ID 0x%x", id);
+        break;
+    }
+  }
+
+  return TRUE;
+
+  /* ERRORS */
+read_failed:
+  {
+    GST_DEBUG_OBJECT (parse, "short read while parsing metadata");
+    /* let's look the other way anyway */
+    return TRUE;
+  }
+}
+
+/* caller ensures properly sync'ed with enough data */
+static gboolean
+gst_wavpack_parse_frame_header (GstWavpackParse * parse, GstBuffer * buf,
+    gint skip, WavpackHeader * _wph)
+{
+  GstByteReader br = GST_BYTE_READER_INIT_FROM_BUFFER (buf);
+  WavpackHeader wph = { {0,}, 0, };
+
+  g_return_val_if_fail (GST_BUFFER_SIZE (buf) >= skip + sizeof (WavpackHeader),
+      FALSE);
+
+  /* marker */
+  gst_byte_reader_skip_unchecked (&br, skip + 4);
+
+  /* read */
+  gst_byte_reader_get_uint32_le (&br, &wph.ckSize);
+  gst_byte_reader_get_uint16_le (&br, &wph.version);
+  gst_byte_reader_get_uint8 (&br, &wph.track_no);
+  gst_byte_reader_get_uint8 (&br, &wph.index_no);
+  gst_byte_reader_get_uint32_le (&br, &wph.total_samples);
+  gst_byte_reader_get_uint32_le (&br, &wph.block_index);
+  gst_byte_reader_get_uint32_le (&br, &wph.block_samples);
+  gst_byte_reader_get_uint32_le (&br, &wph.flags);
+  gst_byte_reader_get_uint32_le (&br, &wph.crc);
+
+  /* dump */
+  GST_LOG_OBJECT (parse, "size %d", wph.ckSize);
+  GST_LOG_OBJECT (parse, "version 0x%x", wph.version);
+  GST_LOG_OBJECT (parse, "total samples %d", wph.total_samples);
+  GST_LOG_OBJECT (parse, "block index %d", wph.block_index);
+  GST_LOG_OBJECT (parse, "block samples %d", wph.block_samples);
+  GST_LOG_OBJECT (parse, "flags 0x%x", wph.flags);
+  GST_LOG_OBJECT (parse, "crc 0x%x", wph.flags);
+
+  if (!parse->total_samples && wph.block_index == 0 && wph.total_samples != -1) {
+    GST_DEBUG_OBJECT (parse, "determined duration of %u samples",
+        wph.total_samples);
+    parse->total_samples = wph.total_samples;
+  }
+
+  if (_wph)
+    *_wph = wph;
+
+  return TRUE;
+}
+
+static gboolean
+gst_wavpack_parse_check_valid_frame (GstBaseParse * parse,
+    GstBaseParseFrame * frame, guint * framesize, gint * skipsize)
+{
+  GstWavpackParse *wvparse = GST_WAVPACK_PARSE (parse);
+  GstBuffer *buf = frame->buffer;
+  GstByteReader reader = GST_BYTE_READER_INIT_FROM_BUFFER (buf);
+  gint off;
+  gboolean lost_sync, draining, final;
+  guint frmsize = 0;
+  WavpackHeader wph;
+  WavpackInfo wpi = { 0, };
+
+  if (G_UNLIKELY (GST_BUFFER_SIZE (buf) < sizeof (WavpackHeader)))
+    return FALSE;
+
+  /* scan for 'wvpk' marker */
+  off = gst_byte_reader_masked_scan_uint32 (&reader, 0xffffffff, 0x7776706b,
+      0, GST_BUFFER_SIZE (buf));
+
+  GST_LOG_OBJECT (parse, "possible sync at buffer offset %d", off);
+
+  /* didn't find anything that looks like a sync word, skip */
+  if (off < 0) {
+    *skipsize = GST_BUFFER_SIZE (buf) - 3;
+    goto skip;
+  }
+
+  /* possible frame header, but not at offset 0? skip bytes before sync */
+  if (off > 0) {
+    *skipsize = off;
+    goto skip;
+  }
+
+  /* make sure the values in the frame header look sane */
+  gst_wavpack_parse_frame_header (wvparse, buf, 0, &wph);
+  frmsize = wph.ckSize + 8;
+
+  /* need the entire frame for parsing */
+  if (gst_byte_reader_get_remaining (&reader) < frmsize)
+    goto more;
+
+  /* got a frame, now we can dig for some more metadata */
+  GST_LOG_OBJECT (parse, "got frame");
+  gst_wavpack_parse_frame_metadata (wvparse, buf, 0, &wph, &wpi);
+
+  lost_sync = GST_BASE_PARSE_LOST_SYNC (parse);
+  draining = GST_BASE_PARSE_DRAINING (parse);
+
+  while (!(final = (wph.flags & FLAG_FINAL_BLOCK)) || (lost_sync && !draining)) {
+    guint32 word = 0;
+
+    GST_LOG_OBJECT (wvparse, "checking next frame syncword; "
+        "lost_sync: %d, draining: %d, final: %d", lost_sync, draining, final);
+
+    if (!gst_byte_reader_skip (&reader, wph.ckSize + 8) ||
+        !gst_byte_reader_peek_uint32_be (&reader, &word)) {
+      GST_DEBUG_OBJECT (wvparse, "... but not sufficient data");
+      frmsize += 4;
+      goto more;
+    } else {
+      if (word != 0x7776706b) {
+        GST_DEBUG_OBJECT (wvparse, "0x%x not OK", word);
+        *skipsize = off + 2;
+        goto skip;
+      }
+      /* need to parse each frame/block for metadata if several ones */
+      if (!final) {
+        gint av;
+
+        GST_LOG_OBJECT (wvparse, "checking frame at offset %d (0x%x)",
+            frmsize, frmsize);
+        av = gst_byte_reader_get_remaining (&reader);
+        if (av < sizeof (WavpackHeader)) {
+          frmsize += sizeof (WavpackHeader);
+          goto more;
+        }
+        gst_wavpack_parse_frame_header (wvparse, buf, frmsize, &wph);
+        off = frmsize;
+        frmsize += wph.ckSize + 8;
+        if (av < wph.ckSize + 8)
+          goto more;
+        gst_wavpack_parse_frame_metadata (wvparse, buf, off, &wph, &wpi);
+        /* could also check for matching block_index and block_samples ?? */
+      }
+    }
+
+    /* resynced if we make it here */
+    lost_sync = FALSE;
+  }
+
+  /* found frame (up to final), record gathered metadata */
+  wvparse->wpi = wpi;
+  wvparse->wph = wph;
+
+  *framesize = frmsize;
+  gst_base_parse_set_min_frame_size (parse, sizeof (WavpackHeader));
+
+  return TRUE;
+
+skip:
+  GST_LOG_OBJECT (wvparse, "skipping %d", *skipsize);
+  return FALSE;
+
+more:
+  GST_LOG_OBJECT (wvparse, "need at least %u", frmsize);
+  gst_base_parse_set_min_frame_size (parse, frmsize);
+  *skipsize = 0;
+  return FALSE;
+}
+
+static GstFlowReturn
+gst_wavpack_parse_parse_frame (GstBaseParse * parse, GstBaseParseFrame * frame)
+{
+  GstWavpackParse *wvparse = GST_WAVPACK_PARSE (parse);
+  GstBuffer *buf = frame->buffer;
+  guint rate, chans, width, mask;
+
+  /* re-use previously parsed data */
+  rate = wvparse->wpi.rate;
+  width = wvparse->wpi.width;
+  chans = wvparse->wpi.channels;
+  mask = wvparse->wpi.channel_mask;
+
+  GST_LOG_OBJECT (parse, "rate: %u, width: %u, chans: %u", rate, width, chans);
+
+  GST_BUFFER_TIMESTAMP (buf) =
+      gst_util_uint64_scale_int (wvparse->wph.block_index, GST_SECOND, rate);
+  GST_BUFFER_DURATION (buf) =
+      gst_util_uint64_scale_int (wvparse->wph.block_index +
+      wvparse->wph.block_samples, GST_SECOND, rate) -
+      GST_BUFFER_TIMESTAMP (buf);
+
+  if (G_UNLIKELY (wvparse->sample_rate != rate || wvparse->channels != chans
+          || wvparse->width != width || wvparse->channel_mask != mask)) {
+    GstCaps *caps;
+
+    if (wvparse->wpi.correction) {
+      caps = gst_caps_new_simple ("audio/x-wavpack-correction",
+          "framed", G_TYPE_BOOLEAN, TRUE, NULL);
+    } else {
+      caps = gst_caps_new_simple ("audio/x-wavpack",
+          "channels", G_TYPE_INT, chans,
+          "rate", G_TYPE_INT, rate,
+          "width", G_TYPE_INT, width, "framed", G_TYPE_BOOLEAN, TRUE, NULL);
+
+      if (!mask)
+        mask = gst_wavpack_get_default_channel_mask (wvparse->channels);
+      if (mask != 0) {
+        if (!gst_wavpack_set_channel_layout (caps, mask)) {
+          GST_WARNING_OBJECT (wvparse, "Failed to set channel layout");
+        }
+      }
+    }
+
+    gst_buffer_set_caps (buf, caps);
+    gst_pad_set_caps (GST_BASE_PARSE_SRC_PAD (parse), caps);
+    gst_caps_unref (caps);
+
+    wvparse->sample_rate = rate;
+    wvparse->channels = chans;
+    wvparse->width = width;
+    wvparse->channel_mask = mask;
+
+    if (wvparse->total_samples) {
+      GST_DEBUG_OBJECT (wvparse, "setting duration");
+      gst_base_parse_set_duration (GST_BASE_PARSE (wvparse),
+          GST_FORMAT_TIME, gst_util_uint64_scale_int (wvparse->total_samples,
+              GST_SECOND, wvparse->sample_rate), 0);
+    }
+  }
+
+  return GST_FLOW_OK;
+}
+
+static GstCaps *
+gst_wavpack_parse_get_sink_caps (GstBaseParse * parse)
+{
+  GstCaps *peercaps;
+  GstCaps *res;
+
+  peercaps = gst_pad_get_allowed_caps (GST_BASE_PARSE_SRC_PAD (parse));
+  if (peercaps) {
+    guint i, n;
+
+    /* Remove the framed field */
+    peercaps = gst_caps_make_writable (peercaps);
+    n = gst_caps_get_size (peercaps);
+    for (i = 0; i < n; i++) {
+      GstStructure *s = gst_caps_get_structure (peercaps, i);
+
+      gst_structure_remove_field (s, "framed");
+    }
+
+    res =
+        gst_caps_intersect_full (peercaps,
+        gst_pad_get_pad_template_caps (GST_BASE_PARSE_SINK_PAD (parse)),
+        GST_CAPS_INTERSECT_FIRST);
+    gst_caps_unref (peercaps);
+  } else {
+    res =
+        gst_caps_copy (gst_pad_get_pad_template_caps (GST_BASE_PARSE_SINK_PAD
+            (parse)));
+  }
+
+  return res;
+}
diff --git a/gst/audioparsers/gstwavpackparse.h b/gst/audioparsers/gstwavpackparse.h
new file mode 100644
index 0000000..7fc246e
--- /dev/null
+++ b/gst/audioparsers/gstwavpackparse.h
@@ -0,0 +1,134 @@
+/* GStreamer Wavpack parser
+ * Copyright (C) 2012 Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
+ * Copyright (C) 2012 Nokia Corporation. All rights reserved.
+ *   Contact: Stefan Kost <stefan.kost@nokia.com>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifndef __GST_WAVPACK_PARSE_H__
+#define __GST_WAVPACK_PARSE_H__
+
+#include <gst/gst.h>
+#include <gst/base/gstbaseparse.h>
+
+G_BEGIN_DECLS
+
+#define GST_TYPE_WAVPACK_PARSE \
+  (gst_wavpack_parse_get_type())
+#define GST_WAVPACK_PARSE(obj) \
+  (G_TYPE_CHECK_INSTANCE_CAST((obj), GST_TYPE_WAVPACK_PARSE, GstWavpackParse))
+#define GST_WAVPACK_PARSE_CLASS(klass) \
+  (G_TYPE_CHECK_CLASS_CAST((klass), GST_TYPE_WAVPACK_PARSE, GstWavpackParseClass))
+#define GST_IS_WAVPACK_PARSE(obj) \
+  (G_TYPE_CHECK_INSTANCE_TYPE((obj), GST_TYPE_WAVPACK_PARSE))
+#define GST_IS_WAVPACK_PARSE_CLASS(klass) \
+  (G_TYPE_CHECK_CLASS_TYPE((klass), GST_TYPE_WAVPACK_PARSE))
+
+
+#define ID_UNIQUE               0x3f
+#define ID_OPTIONAL_DATA        0x20
+#define ID_ODD_SIZE             0x40
+#define ID_LARGE                0x80
+
+#define ID_DUMMY                0x0
+#define ID_ENCODER_INFO         0x1
+#define ID_DECORR_TERMS         0x2
+#define ID_DECORR_WEIGHTS       0x3
+#define ID_DECORR_SAMPLES       0x4
+#define ID_ENTROPY_VARS         0x5
+#define ID_HYBRID_PROFILE       0x6
+#define ID_SHAPING_WEIGHTS      0x7
+#define ID_FLOAT_INFO           0x8
+#define ID_INT32_INFO           0x9
+#define ID_WV_BITSTREAM         0xa
+#define ID_WVC_BITSTREAM        0xb
+#define ID_WVX_BITSTREAM        0xc
+#define ID_CHANNEL_INFO         0xd
+
+#define ID_RIFF_HEADER          (ID_OPTIONAL_DATA | 0x1)
+#define ID_RIFF_TRAILER         (ID_OPTIONAL_DATA | 0x2)
+#define ID_REPLAY_GAIN          (ID_OPTIONAL_DATA | 0x3)
+#define ID_CUESHEET             (ID_OPTIONAL_DATA | 0x4)
+#define ID_CONFIG_BLOCK         (ID_OPTIONAL_DATA | 0x5)
+#define ID_MD5_CHECKSUM         (ID_OPTIONAL_DATA | 0x6)
+#define ID_SAMPLE_RATE          (ID_OPTIONAL_DATA | 0x7)
+
+#define FLAG_FINAL_BLOCK        (1 << 12)
+
+typedef struct {
+  char ckID [4];             /* "wvpk" */
+  guint32 ckSize;            /* size of entire block (minus 8, of course) */
+  guint16 version;           /* 0x402 to 0x410 are currently valid for decode */
+  guchar track_no;           /* track number (0 if not used, like now) */
+  guchar index_no;           /* track sub-index (0 if not used, like now) */
+  guint32 total_samples;     /* total samples for entire file, but this is
+                              * only valid if block_index == 0 and a value of
+                              * -1 indicates unknown length */
+  guint32 block_index;       /* index of first sample in block relative to
+                              * beginning of file (normally this would start
+                              * at 0 for the first block) */
+  guint32 block_samples;     /* number of samples in this block (0 = no audio) */
+  guint32 flags;             /* various flags for id and decoding */
+  guint32 crc;               /* crc for actual decoded data */
+} WavpackHeader;
+
+typedef struct {
+  gboolean correction;
+  guint rate;
+  guint width;
+  guint channels;
+  guint channel_mask;
+} WavpackInfo;
+
+typedef struct _GstWavpackParse GstWavpackParse;
+typedef struct _GstWavpackParseClass GstWavpackParseClass;
+
+/**
+ * GstWavpackParse:
+ *
+ * The opaque GstWavpackParse object
+ */
+struct _GstWavpackParse {
+  GstBaseParse baseparse;
+
+  /*< private >*/
+  gint          sample_rate;
+  gint          channels;
+  gint          width;
+  gint          channel_mask;
+
+  guint         total_samples;
+
+  WavpackHeader wph;
+  WavpackInfo   wpi;
+};
+
+/**
+ * GstWavpackParseClass:
+ * @parent_class: Element parent class.
+ *
+ * The opaque GstWavpackParseClass data structure.
+ */
+struct _GstWavpackParseClass {
+  GstBaseParseClass baseparse_class;
+};
+
+GType gst_wavpack_parse_get_type (void);
+
+G_END_DECLS
+
+#endif /* __GST_WAVPACK_PARSE_H__ */
diff --git a/gst/audioparsers/plugin.c b/gst/audioparsers/plugin.c
index ae8332d..16f98ff 100644
--- a/gst/audioparsers/plugin.c
+++ b/gst/audioparsers/plugin.c
@@ -27,6 +27,7 @@
 #include "gstdcaparse.h"
 #include "gstflacparse.h"
 #include "gstmpegaudioparse.h"
+#include "gstwavpackparse.h"
 
 static gboolean
 plugin_init (GstPlugin * plugin)
@@ -45,6 +46,8 @@ plugin_init (GstPlugin * plugin)
       GST_RANK_PRIMARY + 1, GST_TYPE_FLAC_PARSE);
   ret &= gst_element_register (plugin, "mpegaudioparse",
       GST_RANK_PRIMARY + 2, GST_TYPE_MPEG_AUDIO_PARSE);
+  ret &= gst_element_register (plugin, "wavpackparse2",
+      GST_RANK_SECONDARY, GST_TYPE_WAVPACK_PARSE);
 
   return ret;
 }
diff --git a/gst/auparse/Makefile.in b/gst/auparse/Makefile.in
index 392cb0a..b983d41 100644
--- a/gst/auparse/Makefile.in
+++ b/gst/auparse/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/auparse
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -118,10 +134,23 @@ libgstauparse_la_OBJECTS = $(am_libgstauparse_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstauparse_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstauparse_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstauparse_la_CFLAGS) $(CFLAGS) \
 	$(libgstauparse_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -134,22 +163,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstauparse_la_SOURCES)
 DIST_SOURCES = $(libgstauparse_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -209,6 +239,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -257,8 +288,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -339,7 +372,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -399,6 +432,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -472,7 +506,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -519,7 +557,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -527,6 +564,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -542,12 +581,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstauparse.la: $(libgstauparse_la_OBJECTS) $(libgstauparse_la_DEPENDENCIES) $(EXTRA_libgstauparse_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstauparse_la_LINK) -rpath $(plugindir) $(libgstauparse_la_OBJECTS) $(libgstauparse_la_LIBADD) $(LIBS)
 
@@ -642,6 +683,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -786,18 +841,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/autodetect/Makefile.in b/gst/autodetect/Makefile.in
index 395497d..94eb0d0 100644
--- a/gst/autodetect/Makefile.in
+++ b/gst/autodetect/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/autodetect
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -122,10 +138,23 @@ libgstautodetect_la_OBJECTS = $(am_libgstautodetect_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstautodetect_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstautodetect_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstautodetect_la_CFLAGS) $(CFLAGS) \
 	$(libgstautodetect_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -138,22 +167,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstautodetect_la_SOURCES)
 DIST_SOURCES = $(libgstautodetect_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -213,6 +243,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -261,8 +292,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -343,7 +376,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -403,6 +436,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -476,7 +510,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -535,7 +573,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -543,6 +580,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -558,12 +597,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstautodetect.la: $(libgstautodetect_la_OBJECTS) $(libgstautodetect_la_DEPENDENCIES) $(EXTRA_libgstautodetect_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstautodetect_la_LINK) -rpath $(plugindir) $(libgstautodetect_la_OBJECTS) $(libgstautodetect_la_LIBADD) $(LIBS)
 
@@ -690,6 +731,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -834,18 +889,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/avi/Makefile.in b/gst/avi/Makefile.in
index 45af373..49da18d 100644
--- a/gst/avi/Makefile.in
+++ b/gst/avi/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/avi
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -120,10 +136,23 @@ libgstavi_la_OBJECTS = $(am_libgstavi_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstavi_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstavi_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstavi_la_CFLAGS) $(CFLAGS) \
 	$(libgstavi_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -136,22 +165,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstavi_la_SOURCES)
 DIST_SOURCES = $(libgstavi_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -211,6 +241,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -259,8 +290,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -341,7 +374,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -401,6 +434,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -474,7 +508,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -539,7 +577,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -547,6 +584,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -562,12 +601,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstavi.la: $(libgstavi_la_OBJECTS) $(libgstavi_la_DEPENDENCIES) $(EXTRA_libgstavi_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstavi_la_LINK) -rpath $(plugindir) $(libgstavi_la_OBJECTS) $(libgstavi_la_LIBADD) $(LIBS)
 
@@ -686,6 +727,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -830,18 +885,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/avi/avi-ids.h b/gst/avi/avi-ids.h
index 7b724df..695a4f8 100644
--- a/gst/avi/avi-ids.h
+++ b/gst/avi/avi-ids.h
@@ -49,6 +49,7 @@ typedef struct _gst_riff_avih {
 /* vprp (video properties) ODML header */
 /* see ODML spec for some/more explanation */
 #define GST_RIFF_TAG_vprp GST_MAKE_FOURCC ('v','p','r','p')
+#define GST_RIFF_DXSB GST_MAKE_FOURCC ('D','X','S','B')
 #define GST_RIFF_VPRP_VIDEO_FIELDS        (2)
 
 typedef struct _gst_riff_vprp_video_field_desc {
diff --git a/gst/avi/gstavidemux.c b/gst/avi/gstavidemux.c
index b6c065f..17bbf31 100644
--- a/gst/avi/gstavidemux.c
+++ b/gst/avi/gstavidemux.c
@@ -76,6 +76,13 @@ static GstStaticPadTemplate sink_templ = GST_STATIC_PAD_TEMPLATE ("sink",
     GST_STATIC_CAPS ("video/x-msvideo")
     );
 
+#ifndef GST_DISABLE_GST_DEBUG
+static const char *const snap_types[2][2] = {
+  {"any", "before"},
+  {"after", "nearest"},
+};
+#endif
+
 static void gst_avi_demux_base_init (GstAviDemuxClass * klass);
 static void gst_avi_demux_class_init (GstAviDemuxClass * klass);
 static void gst_avi_demux_init (GstAviDemux * avi);
@@ -573,7 +580,7 @@ gst_avi_demux_handle_src_query (GstPad * pad, GstQuery * query)
           GST_DEBUG_OBJECT (query, "total frames is %" G_GUINT32_FORMAT,
               stream->idx_n);
 
-          if (stream->idx_n >= 0)
+          if (stream->idx_n > 0)
             gst_query_set_duration (query, fmt, stream->idx_n);
           else if (gst_pad_query_convert (pad, GST_FORMAT_TIME,
                   duration, &fmt, &dur))
@@ -1913,6 +1920,45 @@ gst_avi_demux_roundup_list (GstAviDemux * avi, GstBuffer ** buf)
   }
 }
 
+static GstCaps *
+gst_avi_demux_check_caps (GstAviDemux * avi, GstCaps * caps)
+{
+  GstStructure *s;
+  const GValue *val;
+  GstBuffer *buf;
+
+  s = gst_caps_get_structure (caps, 0);
+  if (!gst_structure_has_name (s, "video/x-h264"))
+    return caps;
+
+  GST_DEBUG_OBJECT (avi, "checking caps %" GST_PTR_FORMAT, caps);
+
+  /* some muxers put invalid bytestream stuff in h264 extra data */
+  val = gst_structure_get_value (s, "codec_data");
+  if (val && (buf = gst_value_get_buffer (val))) {
+    guint8 *data;
+    gint size;
+
+    data = GST_BUFFER_DATA (buf);
+    size = GST_BUFFER_SIZE (buf);
+    if (size >= 4) {
+      guint32 h = GST_READ_UINT32_BE (data);
+      if (h == 0x01) {
+        /* can hardly be valid AVC codec data */
+        GST_DEBUG_OBJECT (avi,
+            "discarding invalid codec_data containing byte-stream");
+        /* so do not pretend to downstream that it is packetized avc */
+        gst_structure_remove_field (s, "codec_data");
+        /* ... but rather properly parsed bytestream */
+        gst_structure_set (s, "stream-format", G_TYPE_STRING, "byte-stream",
+            "alignment", G_TYPE_STRING, "au", NULL);
+      }
+    }
+  }
+
+  return caps;
+}
+
 /*
  * gst_avi_demux_parse_stream:
  * @avi: calling element (used for debugging/errors).
@@ -2214,6 +2260,7 @@ gst_avi_demux_parse_stream (GstAviDemux * avi, GstBuffer * buf)
         g_free (vprp);
         vprp = NULL;
       }
+      caps = gst_avi_demux_check_caps (avi, caps);
       tag_name = GST_TAG_VIDEO_CODEC;
       avi->num_v_streams++;
       break;
@@ -2619,6 +2666,9 @@ gst_avi_demux_parse_index (GstAviDemux * avi, GstBuffer * buf)
     if (stream->strh->type == GST_RIFF_FCC_auds) {
       /* all audio frames are keyframes */
       ENTRY_SET_KEYFRAME (&entry);
+    } else if (stream->strf.vids->compression == GST_RIFF_DXSB) {
+      /* all xsub frames are keyframes */
+      ENTRY_SET_KEYFRAME (&entry);
     } else {
       guint32 flags;
       /* else read flags */
@@ -3163,6 +3213,7 @@ gst_avi_demux_stream_header_push (GstAviDemux * avi)
 
   switch (avi->header_state) {
     case GST_AVI_DEMUX_HEADER_TAG_LIST:
+    again:
       if (gst_avi_demux_peek_chunk (avi, &tag, &size)) {
         avi->offset += 8 + GST_ROUND_UP_2 (size);
         if (tag != GST_RIFF_TAG_LIST)
@@ -3173,8 +3224,12 @@ gst_avi_demux_stream_header_push (GstAviDemux * avi)
         GST_DEBUG ("Reading %d bytes", size);
         buf = gst_adapter_take_buffer (avi->adapter, size);
 
-        if (GST_READ_UINT32_LE (GST_BUFFER_DATA (buf)) != GST_RIFF_LIST_hdrl)
-          goto header_no_hdrl;
+        if (GST_READ_UINT32_LE (GST_BUFFER_DATA (buf)) != GST_RIFF_LIST_hdrl) {
+          GST_WARNING_OBJECT (avi, "Invalid AVI header (no hdrl at start): %"
+              GST_FOURCC_FORMAT, GST_FOURCC_ARGS (tag));
+          gst_buffer_unref (buf);
+          goto again;
+        }
 
         /* mind padding */
         if (size & 1)
@@ -3323,10 +3378,11 @@ gst_avi_demux_stream_header_push (GstAviDemux * avi)
               }
               break;
             default:
-              if (gst_avi_demux_peek_chunk (avi, &tag, &size)) {
+              if (gst_avi_demux_peek_chunk (avi, &tag, &size) || size == 0) {
+                /* accept 0 size buffer here */
+                avi->abort_buffering = FALSE;
                 avi->offset += 8 + GST_ROUND_UP_2 (size);
                 gst_adapter_flush (avi->adapter, 8 + GST_ROUND_UP_2 (size));
-                // ??? goto iterate; ???
               } else {
                 /* Need more data */
                 return GST_FLOW_OK;
@@ -3334,10 +3390,11 @@ gst_avi_demux_stream_header_push (GstAviDemux * avi)
               break;
           }
         } else {
-          if (gst_avi_demux_peek_chunk (avi, &tag, &size)) {
+          if (gst_avi_demux_peek_chunk (avi, &tag, &size) || size == 0) {
+            /* accept 0 size buffer here */
+            avi->abort_buffering = FALSE;
             avi->offset += 8 + GST_ROUND_UP_2 (size);
             gst_adapter_flush (avi->adapter, 8 + GST_ROUND_UP_2 (size));
-            //goto iterate;
           } else {
             /* Need more data */
             return GST_FLOW_OK;
@@ -3400,14 +3457,6 @@ header_no_list:
             GST_FOURCC_FORMAT, GST_FOURCC_ARGS (tag)));
     return GST_FLOW_ERROR;
   }
-header_no_hdrl:
-  {
-    GST_ELEMENT_ERROR (avi, STREAM, DEMUX, (NULL),
-        ("Invalid AVI header (no hdrl at start): %"
-            GST_FOURCC_FORMAT, GST_FOURCC_ARGS (tag)));
-    gst_buffer_unref (buf);
-    return GST_FLOW_ERROR;
-  }
 header_no_avih:
   {
     GST_ELEMENT_ERROR (avi, STREAM, DEMUX, (NULL),
@@ -3997,15 +4046,18 @@ static gboolean
 gst_avi_demux_do_seek (GstAviDemux * avi, GstSegment * segment)
 {
   GstClockTime seek_time;
-  gboolean keyframe;
+  gboolean keyframe, before, after;
   guint i, index;
   GstAviStream *stream;
 
   seek_time = segment->last_stop;
-  keyframe = !!(segment->flags & GST_SEEK_FLAG_KEY_UNIT);
+  keyframe = ! !(segment->flags & GST_SEEK_FLAG_KEY_UNIT);
+  before = ! !(segment->flags & GST_SEEK_FLAG_SNAP_BEFORE);
+  after = ! !(segment->flags & GST_SEEK_FLAG_SNAP_AFTER);
 
   GST_DEBUG_OBJECT (avi, "seek to: %" GST_TIME_FORMAT
-      " keyframe seeking:%d", GST_TIME_ARGS (seek_time), keyframe);
+      " keyframe seeking:%d, %s", GST_TIME_ARGS (seek_time), keyframe,
+      snap_types[before ? 1 : 0][after ? 1 : 0]);
 
   /* FIXME, this code assumes the main stream with keyframes is stream 0,
    * which is mostly correct... */
@@ -4017,11 +4069,25 @@ gst_avi_demux_do_seek (GstAviDemux * avi, GstSegment * segment)
 
   /* check if we are already on a keyframe */
   if (!ENTRY_IS_KEYFRAME (&stream->index[index])) {
-    GST_DEBUG_OBJECT (avi, "not keyframe, searching back");
-    /* now go to the previous keyframe, this is where we should start
-     * decoding from. */
-    index = gst_avi_demux_index_prev (avi, stream, index, TRUE);
-    GST_DEBUG_OBJECT (avi, "previous keyframe at %u", index);
+    gboolean next;
+
+    next = after && !before;
+    if (segment->rate < 0)
+      next = !next;
+
+    if (next) {
+      GST_DEBUG_OBJECT (avi, "not keyframe, searching forward");
+      /* now go to the next keyframe, this is where we should start
+       * decoding from. */
+      index = gst_avi_demux_index_next (avi, stream, index, TRUE);
+      GST_DEBUG_OBJECT (avi, "next keyframe at %u", index);
+    } else {
+      GST_DEBUG_OBJECT (avi, "not keyframe, searching back");
+      /* now go to the previous keyframe, this is where we should start
+       * decoding from. */
+      index = gst_avi_demux_index_prev (avi, stream, index, TRUE);
+      GST_DEBUG_OBJECT (avi, "previous keyframe at %u", index);
+    }
   }
 
   /* move the main stream to this position */
@@ -4227,7 +4293,7 @@ avi_demux_handle_seek_push (GstAviDemux * avi, GstPad * pad, GstEvent * event)
   GstSeekFlags flags;
   GstSeekType cur_type = GST_SEEK_TYPE_NONE, stop_type;
   gint64 cur, stop;
-  gboolean keyframe;
+  gboolean keyframe, before, after;
   GstAviStream *stream;
   guint index;
   guint n, str_num;
@@ -4268,13 +4334,15 @@ avi_demux_handle_seek_push (GstAviDemux * avi, GstPad * pad, GstEvent * event)
   gst_segment_set_seek (&seeksegment, rate, format, flags,
       cur_type, cur, stop_type, stop, &update);
 
-  keyframe = !!(flags & GST_SEEK_FLAG_KEY_UNIT);
+  keyframe = ! !(flags & GST_SEEK_FLAG_KEY_UNIT);
+  before = ! !(flags & GST_SEEK_FLAG_SNAP_BEFORE);
+  after = ! !(flags & GST_SEEK_FLAG_SNAP_AFTER);
   cur = seeksegment.last_stop;
 
   GST_DEBUG_OBJECT (avi,
       "Seek requested: ts %" GST_TIME_FORMAT " stop %" GST_TIME_FORMAT
-      ", kf %u, rate %lf", GST_TIME_ARGS (cur), GST_TIME_ARGS (stop), keyframe,
-      rate);
+      ", kf %u, %s, rate %lf", GST_TIME_ARGS (cur), GST_TIME_ARGS (stop),
+      keyframe, snap_types[before ? 1 : 0][after ? 1 : 0], rate);
 
   if (rate < 0) {
     GST_DEBUG_OBJECT (avi, "negative rate seek not supported in push mode");
@@ -4293,11 +4361,25 @@ avi_demux_handle_seek_push (GstAviDemux * avi, GstPad * pad, GstEvent * event)
 
   /* check if we are already on a keyframe */
   if (!ENTRY_IS_KEYFRAME (&stream->index[index])) {
-    GST_DEBUG_OBJECT (avi, "Entry is not a keyframe - searching back");
-    /* now go to the previous keyframe, this is where we should start
-     * decoding from. */
-    index = gst_avi_demux_index_prev (avi, stream, index, TRUE);
-    GST_DEBUG_OBJECT (avi, "Found previous keyframe at %u", index);
+    gboolean next;
+
+    next = after && !before;
+    if (seeksegment.rate < 0)
+      next = !next;
+
+    if (next) {
+      GST_DEBUG_OBJECT (avi, "Entry is not a keyframe - searching forward");
+      /* now go to the next keyframe, this is where we should start
+       * decoding from. */
+      index = gst_avi_demux_index_next (avi, stream, index, TRUE);
+      GST_DEBUG_OBJECT (avi, "Found previous keyframe at %u", index);
+    } else {
+      GST_DEBUG_OBJECT (avi, "Entry is not a keyframe - searching back");
+      /* now go to the previous keyframe, this is where we should start
+       * decoding from. */
+      index = gst_avi_demux_index_prev (avi, stream, index, TRUE);
+      GST_DEBUG_OBJECT (avi, "Found previous keyframe at %u", index);
+    }
   }
 
   gst_avi_demux_get_buffer_info (avi, stream, index,
@@ -4329,11 +4411,19 @@ avi_demux_handle_seek_push (GstAviDemux * avi, GstPad * pad, GstEvent * event)
 
     /* check if we are already on a keyframe */
     if (!ENTRY_IS_KEYFRAME (&str->index[idx])) {
-      GST_DEBUG_OBJECT (avi, "Entry is not a keyframe - searching back");
-      /* now go to the previous keyframe, this is where we should start
-       * decoding from. */
-      idx = gst_avi_demux_index_prev (avi, str, idx, TRUE);
-      GST_DEBUG_OBJECT (avi, "Found previous keyframe at %u", idx);
+      if (after && !before) {
+        GST_DEBUG_OBJECT (avi, "Entry is not a keyframe - searching forward");
+        /* now go to the next keyframe, this is where we should start
+         * decoding from. */
+        idx = gst_avi_demux_index_next (avi, str, idx, TRUE);
+        GST_DEBUG_OBJECT (avi, "Found next keyframe at %u", idx);
+      } else {
+        GST_DEBUG_OBJECT (avi, "Entry is not a keyframe - searching back");
+        /* now go to the previous keyframe, this is where we should start
+         * decoding from. */
+        idx = gst_avi_demux_index_prev (avi, str, idx, TRUE);
+        GST_DEBUG_OBJECT (avi, "Found previous keyframe at %u", idx);
+      }
     }
 
     gst_avi_demux_get_buffer_info (avi, str, idx,
@@ -4439,10 +4529,9 @@ swap_line (guint8 * d1, guint8 * d2, guint8 * tmp, gint bytes)
 
 
 #define gst_avi_demux_is_uncompressed(fourcc)		\
-  (fourcc &&						\
-    (fourcc == GST_RIFF_DIB ||				\
-     fourcc == GST_RIFF_rgb ||				\
-     fourcc == GST_RIFF_RGB || fourcc == GST_RIFF_RAW))
+  (fourcc == GST_RIFF_DIB ||				\
+   fourcc == GST_RIFF_rgb ||				\
+   fourcc == GST_RIFF_RGB || fourcc == GST_RIFF_RAW)
 
 /*
  * Invert DIB buffers... Takes existing buffer and
@@ -4457,11 +4546,19 @@ gst_avi_demux_invert (GstAviStream * stream, GstBuffer * buf)
   gint y, w, h;
   gint bpp, stride;
   guint8 *tmp = NULL;
+  guint32 fourcc;
 
   if (stream->strh->type != GST_RIFF_FCC_vids)
     return buf;
 
-  if (!gst_avi_demux_is_uncompressed (stream->strh->fcc_handler)) {
+  if (stream->strf.vids == NULL) {
+    GST_WARNING ("Failed to retrieve vids for stream");
+    return buf;
+  }
+
+  fourcc = (stream->strf.vids->compression) ?
+      stream->strf.vids->compression : stream->strh->fcc_handler;
+  if (!gst_avi_demux_is_uncompressed (fourcc)) {
     return buf;                 /* Ignore non DIB buffers */
   }
 
@@ -4471,11 +4568,6 @@ gst_avi_demux_invert (GstAviStream * stream, GstBuffer * buf)
     return buf;
   }
 
-  if (stream->strf.vids == NULL) {
-    GST_WARNING ("Failed to retrieve vids for stream");
-    return buf;
-  }
-
   h = stream->strf.vids->height;
   w = stream->strf.vids->width;
   stride = GST_ROUND_UP_4 (w * (bpp / 8));
diff --git a/gst/avi/gstavimux.c b/gst/avi/gstavimux.c
index fe50cef..bfbe3cc 100644
--- a/gst/avi/gstavimux.c
+++ b/gst/avi/gstavimux.c
@@ -180,7 +180,7 @@ static GstStaticPadTemplate audio_sink_factory =
         "rate = (int) [ 1000, 96000 ], " "channels = (int) [ 1, 2 ]; "
 #endif*/
         "audio/x-ac3, "
-        "rate = (int) [ 1000, 96000 ], " "channels = (int) [ 1, 2 ]; "
+        "rate = (int) [ 1000, 96000 ], " "channels = (int) [ 1, 6 ]; "
         "audio/x-alaw, "
         "rate = (int) [ 1000, 48000 ], " "channels = (int) [ 1, 2 ]; "
         "audio/x-mulaw, "
@@ -195,9 +195,10 @@ static void gst_avi_mux_class_init (GstAviMuxClass * klass);
 static void gst_avi_mux_init (GstAviMux * avimux);
 static void gst_avi_mux_pad_reset (GstAviPad * avipad, gboolean free);
 
-static GstFlowReturn gst_avi_mux_collect_pads (GstCollectPads * pads,
+static GstFlowReturn gst_avi_mux_collect_pads (GstCollectPads2 * pads,
     GstAviMux * avimux);
-static gboolean gst_avi_mux_handle_event (GstPad * pad, GstEvent * event);
+static gboolean gst_avi_mux_handle_event (GstCollectPads2 * pad,
+    GstCollectData2 * data, GstEvent * event, gpointer user_data);
 static GstPad *gst_avi_mux_request_new_pad (GstElement * element,
     GstPadTemplate * templ, const gchar * name);
 static void gst_avi_mux_release_pad (GstElement * element, GstPad * pad);
@@ -418,10 +419,13 @@ gst_avi_mux_init (GstAviMux * avimux)
   /* property */
   avimux->enable_large_avi = DEFAULT_BIGFILE;
 
-  avimux->collect = gst_collect_pads_new ();
-  gst_collect_pads_set_function (avimux->collect,
-      (GstCollectPadsFunction) (GST_DEBUG_FUNCPTR (gst_avi_mux_collect_pads)),
+  avimux->collect = gst_collect_pads2_new ();
+  gst_collect_pads2_set_function (avimux->collect,
+      (GstCollectPads2Function) (GST_DEBUG_FUNCPTR (gst_avi_mux_collect_pads)),
       avimux);
+  gst_collect_pads2_set_event_function (avimux->collect,
+      (GstCollectPads2EventFunction) (GST_DEBUG_FUNCPTR
+          (gst_avi_mux_handle_event)), avimux);
 
   /* set to clean state */
   gst_avi_mux_reset (avimux);
@@ -1024,16 +1028,9 @@ gst_avi_mux_request_new_pad (GstElement * element,
 
   g_free (name);
 
-  avipad->collect = gst_collect_pads_add_pad (avimux->collect,
+  avipad->collect = gst_collect_pads2_add_pad (avimux->collect,
       newpad, sizeof (GstAviCollectData));
   ((GstAviCollectData *) (avipad->collect))->avipad = avipad;
-  /* FIXME: hacked way to override/extend the event function of
-   * GstCollectPads; because it sets its own event function giving the
-   * element no access to events */
-  avimux->collect_event = (GstPadEventFunction) GST_PAD_EVENTFUNC (newpad);
-  gst_pad_set_event_function (newpad,
-      GST_DEBUG_FUNCPTR (gst_avi_mux_handle_event));
-
   if (!gst_element_add_pad (element, newpad))
     goto pad_add_failed;
 
@@ -1085,7 +1082,7 @@ gst_avi_mux_release_pad (GstElement * element, GstPad * pad)
        * as it also represent number of streams present */
       avipad->collect = NULL;
       GST_DEBUG_OBJECT (avimux, "removed pad '%s'", GST_PAD_NAME (pad));
-      gst_collect_pads_remove_pad (avimux->collect, pad);
+      gst_collect_pads2_remove_pad (avimux->collect, pad);
       gst_element_remove_pad (element, pad);
       /* if not started yet, we can remove any sign this pad ever existed */
       /* in this case _start will take care of the real pad count */
@@ -1161,18 +1158,32 @@ gst_avi_mux_write_tag (const GstTagList * list, const gchar * tag,
     0, NULL}
   };
   gint n;
-  gchar *str;
+  gchar *str = NULL;
   GstByteWriter *bw = data;
   guint chunk;
 
   for (n = 0; rifftags[n].fcc != 0; n++) {
-    if (!strcmp (rifftags[n].tag, tag) &&
-        gst_tag_list_get_string (list, tag, &str) && str) {
-      chunk = gst_avi_mux_start_chunk (bw, NULL, rifftags[n].fcc);
-      gst_byte_writer_put_string (bw, str);
-      gst_avi_mux_end_chunk (bw, chunk);
-      g_free (str);
-      break;
+    if (!strcmp (rifftags[n].tag, tag)) {
+      if (rifftags[n].fcc == GST_RIFF_INFO_ICRD) {
+        GDate *date;
+        /* special case for the date tag */
+        if (gst_tag_list_get_date (list, tag, &date)) {
+          str =
+              g_strdup_printf ("%04d:%02d:%02d", g_date_get_year (date),
+              g_date_get_month (date), g_date_get_day (date));
+          g_date_free (date);
+        }
+      } else {
+        gst_tag_list_get_string (list, tag, &str);
+      }
+      if (str) {
+        chunk = gst_avi_mux_start_chunk (bw, NULL, rifftags[n].fcc);
+        gst_byte_writer_put_string (bw, str);
+        gst_avi_mux_end_chunk (bw, chunk);
+        g_free (str);
+        str = NULL;
+        break;
+      }
     }
   }
 }
@@ -1861,12 +1872,12 @@ gst_avi_mux_restart_file (GstAviMux * avimux)
 
 /* handle events (search) */
 static gboolean
-gst_avi_mux_handle_event (GstPad * pad, GstEvent * event)
+gst_avi_mux_handle_event (GstCollectPads2 * pads, GstCollectData2 * data,
+    GstEvent * event, gpointer user_data)
 {
   GstAviMux *avimux;
-  gboolean ret;
 
-  avimux = GST_AVI_MUX (gst_pad_get_parent (pad));
+  avimux = GST_AVI_MUX (user_data);
 
   switch (GST_EVENT_TYPE (event)) {
     case GST_EVENT_TAG:{
@@ -1882,12 +1893,8 @@ gst_avi_mux_handle_event (GstPad * pad, GstEvent * event)
       break;
   }
 
-  /* now GstCollectPads can take care of the rest, e.g. EOS */
-  ret = avimux->collect_event (pad, event);
-
-  gst_object_unref (avimux);
-
-  return ret;
+  /* now GstCollectPads2 can take care of the rest, e.g. EOS */
+  return FALSE;
 }
 
 /* send extra 'padding' data */
@@ -1911,7 +1918,7 @@ gst_avi_mux_do_buffer (GstAviMux * avimux, GstAviPad * avipad)
   gulong total_size, pad_bytes = 0;
   guint flags;
 
-  data = gst_collect_pads_pop (avimux->collect, avipad->collect);
+  data = gst_collect_pads2_pop (avimux->collect, avipad->collect);
   /* arrange downstream running time */
   data = gst_buffer_make_metadata_writable (data);
   GST_BUFFER_TIMESTAMP (data) =
@@ -2037,7 +2044,7 @@ gst_avi_mux_do_one_buffer (GstAviMux * avimux)
     if (!avipad->hdr.fcc_handler)
       goto not_negotiated;
 
-    buffer = gst_collect_pads_peek (avimux->collect, avipad->collect);
+    buffer = gst_collect_pads2_peek (avimux->collect, avipad->collect);
     if (!buffer)
       continue;
     time = GST_BUFFER_TIMESTAMP (buffer);
@@ -2050,7 +2057,7 @@ gst_avi_mux_do_one_buffer (GstAviMux * avimux)
       if (G_UNLIKELY (!GST_CLOCK_TIME_IS_VALID (time))) {
         GST_DEBUG_OBJECT (avimux, "clipping buffer on pad %s outside segment",
             GST_PAD_NAME (avipad->collect->pad));
-        buffer = gst_collect_pads_pop (avimux->collect, avipad->collect);
+        buffer = gst_collect_pads2_pop (avimux->collect, avipad->collect);
         gst_buffer_unref (buffer);
         return GST_FLOW_OK;
       }
@@ -2089,7 +2096,7 @@ not_negotiated:
 }
 
 static GstFlowReturn
-gst_avi_mux_collect_pads (GstCollectPads * pads, GstAviMux * avimux)
+gst_avi_mux_collect_pads (GstCollectPads2 * pads, GstAviMux * avimux)
 {
   GstFlowReturn res;
 
@@ -2148,12 +2155,12 @@ gst_avi_mux_change_state (GstElement * element, GstStateChange transition)
 
   switch (transition) {
     case GST_STATE_CHANGE_READY_TO_PAUSED:
-      gst_collect_pads_start (avimux->collect);
+      gst_collect_pads2_start (avimux->collect);
       break;
     case GST_STATE_CHANGE_PAUSED_TO_PLAYING:
       break;
     case GST_STATE_CHANGE_PAUSED_TO_READY:
-      gst_collect_pads_stop (avimux->collect);
+      gst_collect_pads2_stop (avimux->collect);
       break;
     default:
       break;
diff --git a/gst/avi/gstavimux.h b/gst/avi/gstavimux.h
index 0d90392..cb0cdb7 100644
--- a/gst/avi/gstavimux.h
+++ b/gst/avi/gstavimux.h
@@ -23,7 +23,7 @@
 
 
 #include <gst/gst.h>
-#include <gst/base/gstcollectpads.h>
+#include <gst/base/gstcollectpads2.h>
 #include <gst/riff/riff-ids.h>
 #include "avi-ids.h"
 
@@ -74,7 +74,7 @@ typedef GstFlowReturn (*GstAviPadHook) (GstAviMux * avi, GstAviPad * avipad,
 struct _GstAviPad {
   /* do not extend, link to it */
   /* is NULL if original sink request pad has been removed */
-  GstCollectData *collect;
+  GstCollectData2 *collect;
 
   /* type */
   gboolean is_video;
@@ -129,7 +129,7 @@ typedef struct _GstAviAudioPad {
 
 typedef struct _GstAviCollectData {
   /* extend the CollectData */
-  GstCollectData collect;
+  GstCollectData2 collect;
 
   GstAviPad      *avipad;
 } GstAviCollectData;
@@ -143,8 +143,7 @@ struct _GstAviMux {
   GSList              *sinkpads;
   /* video restricted to 1 pad */
   guint               video_pads, audio_pads;
-  GstCollectPads      *collect;
-  GstPadEventFunction  collect_event;
+  GstCollectPads2     *collect;
 
   /* the AVI header */
   /* still some single stream video data in mux struct */
diff --git a/gst/cutter/Makefile.in b/gst/cutter/Makefile.in
index 80319bf..414dfc9 100644
--- a/gst/cutter/Makefile.in
+++ b/gst/cutter/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/cutter
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -118,10 +134,23 @@ libgstcutter_la_OBJECTS = $(am_libgstcutter_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstcutter_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstcutter_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstcutter_la_CFLAGS) $(CFLAGS) \
 	$(libgstcutter_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -134,22 +163,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstcutter_la_SOURCES)
 DIST_SOURCES = $(libgstcutter_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -209,6 +239,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -257,8 +288,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -339,7 +372,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -399,6 +432,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -472,7 +506,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -520,7 +558,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -528,6 +565,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -543,12 +582,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstcutter.la: $(libgstcutter_la_OBJECTS) $(libgstcutter_la_DEPENDENCIES) $(EXTRA_libgstcutter_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstcutter_la_LINK) -rpath $(plugindir) $(libgstcutter_la_OBJECTS) $(libgstcutter_la_LIBADD) $(LIBS)
 
@@ -643,6 +684,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -787,18 +842,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/debugutils/Makefile.in b/gst/debugutils/Makefile.in
index 16cc203..ece52b7 100644
--- a/gst/debugutils/Makefile.in
+++ b/gst/debugutils/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/debugutils
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -124,6 +140,7 @@ libgstdebug_la_OBJECTS = $(am_libgstdebug_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstdebug_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstdebug_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstdebug_la_CFLAGS) $(CFLAGS) \
@@ -147,6 +164,18 @@ libgstnavigationtest_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstnavigationtest_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstnavigationtest_la_CFLAGS) \
 	$(CFLAGS) $(libgstnavigationtest_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -159,24 +188,25 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstdebug_la_SOURCES) $(libgstefence_la_SOURCES) \
 	$(libgstnavigationtest_la_SOURCES)
 DIST_SOURCES = $(libgstdebug_la_SOURCES) $(libgstefence_la_SOURCES) \
 	$(libgstnavigationtest_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -236,6 +266,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -284,8 +315,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -366,7 +399,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -426,6 +459,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -499,7 +533,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -586,7 +624,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -594,6 +631,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -609,12 +648,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstdebug.la: $(libgstdebug_la_OBJECTS) $(libgstdebug_la_DEPENDENCIES) $(EXTRA_libgstdebug_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstdebug_la_LINK) -rpath $(plugindir) $(libgstdebug_la_OBJECTS) $(libgstdebug_la_LIBADD) $(LIBS)
 libgstefence.la: $(libgstefence_la_OBJECTS) $(libgstefence_la_DEPENDENCIES) $(EXTRA_libgstefence_la_DEPENDENCIES) 
@@ -817,6 +858,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -961,18 +1016,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/debugutils/rndbuffersize.c b/gst/debugutils/rndbuffersize.c
index e6ddd1f..33c80dd 100644
--- a/gst/debugutils/rndbuffersize.c
+++ b/gst/debugutils/rndbuffersize.c
@@ -22,8 +22,10 @@
  * This element pulls buffers with random sizes from the source.
  */
 
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
-#  include "config.h"
+#include "config.h"
 #endif
 
 #include <gst/gst.h>
@@ -51,6 +53,8 @@ struct _GstRndBufferSize
 
   GstPad *sinkpad, *srcpad;
   guint64 offset;
+
+  gboolean need_newsegment;
 };
 
 struct _GstRndBufferSizeClass
@@ -91,6 +95,7 @@ static gboolean gst_rnd_buffer_size_activate_pull (GstPad * pad,
 static void gst_rnd_buffer_size_loop (GstRndBufferSize * self);
 static GstStateChangeReturn gst_rnd_buffer_size_change_state (GstElement *
     element, GstStateChange transition);
+static gboolean gst_rnd_buffer_size_src_event (GstPad * pad, GstEvent * event);
 
 #define DEBUG_INIT(bla) \
   GST_DEBUG_CATEGORY_INIT (gst_rnd_buffer_size_debug, "rndbuffersize", 0, \
@@ -106,10 +111,8 @@ gst_rnd_buffer_size_base_init (gpointer g_class)
 {
   GstElementClass *gstelement_class = GST_ELEMENT_CLASS (g_class);
 
-  gst_element_class_add_static_pad_template (gstelement_class,
-      &sink_template);
-  gst_element_class_add_static_pad_template (gstelement_class,
-      &src_template);
+  gst_element_class_add_static_pad_template (gstelement_class, &sink_template);
+  gst_element_class_add_static_pad_template (gstelement_class, &src_template);
 
   gst_element_class_set_details_simple (gstelement_class, "Random buffer size",
       "Testing", "pull random sized buffers",
@@ -160,6 +163,8 @@ gst_rnd_buffer_size_init (GstRndBufferSize * self,
   gst_element_add_pad (GST_ELEMENT (self), self->sinkpad);
 
   self->srcpad = gst_pad_new_from_static_template (&src_template, "src");
+  gst_pad_set_event_function (self->srcpad,
+      GST_DEBUG_FUNCPTR (gst_rnd_buffer_size_src_event));
   gst_element_add_pad (GST_ELEMENT (self), self->srcpad);
 }
 
@@ -240,17 +245,72 @@ static gboolean
 gst_rnd_buffer_size_activate_pull (GstPad * pad, gboolean active)
 {
   GstRndBufferSize *self = GST_RND_BUFFER_SIZE (GST_OBJECT_PARENT (pad));
+  gboolean ret;
 
   if (active) {
     GST_INFO_OBJECT (self, "starting pull");
-    return gst_pad_start_task (pad, (GstTaskFunction) gst_rnd_buffer_size_loop,
+    ret = gst_pad_start_task (pad, (GstTaskFunction) gst_rnd_buffer_size_loop,
         self);
+    self->need_newsegment = TRUE;
   } else {
     GST_INFO_OBJECT (self, "stopping pull");
-    return gst_pad_stop_task (pad);
+    ret = gst_pad_stop_task (pad);
   }
+  return ret;
 }
 
+static gboolean
+gst_rnd_buffer_size_src_event (GstPad * pad, GstEvent * event)
+{
+  GstRndBufferSize *self;
+  GstSeekType start_type;
+  GstSeekFlags flags;
+  GstFormat format;
+  gint64 start;
+
+  if (GST_EVENT_TYPE (event) != GST_EVENT_SEEK) {
+    GST_WARNING_OBJECT (pad, "dropping %s event", GST_EVENT_TYPE_NAME (event));
+    return FALSE;
+  }
+
+  self = GST_RND_BUFFER_SIZE (GST_OBJECT_PARENT (pad));
+  gst_event_parse_seek (event, NULL, &format, &flags, &start_type, &start,
+      NULL, NULL);
+
+  if (format != GST_FORMAT_BYTES) {
+    GST_WARNING_OBJECT (pad, "only BYTE format supported");
+    return FALSE;
+  }
+  if (start_type != GST_SEEK_TYPE_SET) {
+    GST_WARNING_OBJECT (pad, "only SEEK_TYPE_SET supported");
+    return FALSE;
+  }
+
+  if ((flags & GST_SEEK_FLAG_FLUSH)) {
+    gst_pad_push_event (self->srcpad, gst_event_new_flush_start ());
+    gst_pad_push_event (self->sinkpad, gst_event_new_flush_start ());
+  } else {
+    gst_pad_pause_task (self->sinkpad);
+  }
+
+  GST_PAD_STREAM_LOCK (self->sinkpad);
+
+  if ((flags & GST_SEEK_FLAG_FLUSH)) {
+    gst_pad_push_event (self->srcpad, gst_event_new_flush_stop ());
+    gst_pad_push_event (self->sinkpad, gst_event_new_flush_stop ());
+  }
+
+  GST_INFO_OBJECT (pad, "seeking to offset %" G_GINT64_FORMAT, start);
+
+  self->offset = start;
+  self->need_newsegment = TRUE;
+
+  gst_pad_start_task (self->sinkpad, (GstTaskFunction) gst_rnd_buffer_size_loop,
+      self);
+
+  GST_PAD_STREAM_UNLOCK (self->sinkpad);
+  return TRUE;
+}
 
 static void
 gst_rnd_buffer_size_loop (GstRndBufferSize * self)
@@ -280,6 +340,13 @@ gst_rnd_buffer_size_loop (GstRndBufferSize * self)
     GST_WARNING_OBJECT (self, "short buffer: %u bytes", GST_BUFFER_SIZE (buf));
   }
 
+  if (self->need_newsegment) {
+    gst_pad_push_event (self->srcpad,
+        gst_event_new_new_segment (FALSE, 1.0, GST_FORMAT_BYTES,
+            self->offset, -1, 0));
+    self->need_newsegment = FALSE;
+  }
+
   self->offset += GST_BUFFER_SIZE (buf);
 
   ret = gst_pad_push (self->srcpad, buf);
diff --git a/gst/deinterlace/Makefile.in b/gst/deinterlace/Makefile.in
index 885ea1c..fda51d7 100644
--- a/gst/deinterlace/Makefile.in
+++ b/gst/deinterlace/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -39,6 +38,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -57,15 +73,16 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak
+	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak \
+	$(top_srcdir)/depcomp
 subdir = gst/deinterlace
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -153,10 +170,23 @@ libgstdeinterlace_la_OBJECTS = $(am_libgstdeinterlace_la_OBJECTS) \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstdeinterlace_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstdeinterlace_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstdeinterlace_la_CFLAGS) $(CFLAGS) \
 	$(libgstdeinterlace_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -169,23 +199,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstdeinterlace_la_SOURCES) \
 	$(nodist_libgstdeinterlace_la_SOURCES)
 DIST_SOURCES = $(libgstdeinterlace_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -245,6 +276,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -293,8 +325,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -375,7 +409,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -435,6 +469,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -508,7 +543,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -611,7 +650,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -619,6 +657,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -634,12 +674,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstdeinterlace.la: $(libgstdeinterlace_la_OBJECTS) $(libgstdeinterlace_la_DEPENDENCIES) $(EXTRA_libgstdeinterlace_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstdeinterlace_la_LINK) -rpath $(plugindir) $(libgstdeinterlace_la_OBJECTS) $(libgstdeinterlace_la_LIBADD) $(LIBS)
 
@@ -830,6 +872,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -980,8 +1036,8 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-local clean-pluginLTLIBRARIES ctags \
-	dist-hook distclean distclean-compile distclean-generic \
+	clean-libtool clean-local clean-pluginLTLIBRARIES cscopelist \
+	ctags dist-hook distclean distclean-compile distclean-generic \
 	distclean-libtool distclean-tags distdir dvi dvi-am html \
 	html-am info info-am install install-am install-data \
 	install-data-am install-dvi install-dvi-am install-exec \
diff --git a/gst/deinterlace/gstdeinterlace.c b/gst/deinterlace/gstdeinterlace.c
index a79b836..04ddc9d 100644
--- a/gst/deinterlace/gstdeinterlace.c
+++ b/gst/deinterlace/gstdeinterlace.c
@@ -1221,6 +1221,8 @@ static void
 gst_deinterlace_reset_qos (GstDeinterlace * self)
 {
   gst_deinterlace_update_qos (self, 0.5, 0, GST_CLOCK_TIME_NONE);
+  self->processed = 0;
+  self->dropped = 0;
 }
 
 static void
@@ -1236,15 +1238,16 @@ gst_deinterlace_read_qos (GstDeinterlace * self, gdouble * proportion,
 /* Perform qos calculations before processing the next frame. Returns TRUE if
  * the frame should be processed, FALSE if the frame can be dropped entirely */
 static gboolean
-gst_deinterlace_do_qos (GstDeinterlace * self, GstClockTime timestamp)
+gst_deinterlace_do_qos (GstDeinterlace * self, const GstBuffer * buffer)
 {
   GstClockTime qostime, earliest_time;
+  GstClockTime timestamp = GST_BUFFER_TIMESTAMP (buffer);
   gdouble proportion;
 
   /* no timestamp, can't do QoS => process frame */
   if (G_UNLIKELY (!GST_CLOCK_TIME_IS_VALID (timestamp))) {
     GST_LOG_OBJECT (self, "invalid timestamp, can't do QoS, process frame");
-    return TRUE;
+    goto keep_frame;
   }
 
   /* get latest QoS observation values */
@@ -1253,7 +1256,7 @@ gst_deinterlace_do_qos (GstDeinterlace * self, GstClockTime timestamp)
   /* skip qos if we have no observation (yet) => process frame */
   if (G_UNLIKELY (!GST_CLOCK_TIME_IS_VALID (earliest_time))) {
     GST_LOG_OBJECT (self, "no observation yet, process frame");
-    return TRUE;
+    goto keep_frame;
   }
 
   /* qos is done on running time */
@@ -1265,11 +1268,27 @@ gst_deinterlace_do_qos (GstDeinterlace * self, GstClockTime timestamp)
       GST_TIME_FORMAT, GST_TIME_ARGS (qostime), GST_TIME_ARGS (earliest_time));
 
   if (qostime != GST_CLOCK_TIME_NONE && qostime <= earliest_time) {
+    GstClockTime stream_time, jitter;
+    GstMessage *qos_msg;
+
     GST_DEBUG_OBJECT (self, "we are late, drop frame");
+    self->dropped++;
+    stream_time =
+        gst_segment_to_stream_time (&self->segment, GST_FORMAT_TIME, timestamp);
+    jitter = GST_CLOCK_DIFF (qostime, earliest_time);
+    qos_msg =
+        gst_message_new_qos (GST_OBJECT (self), FALSE, qostime, stream_time,
+        timestamp, GST_BUFFER_DURATION (buffer));
+    gst_message_set_qos_values (qos_msg, jitter, proportion, 1000000);
+    gst_message_set_qos_stats (qos_msg, GST_FORMAT_BUFFERS,
+        self->processed, self->dropped);
+    gst_element_post_message (GST_ELEMENT (self), qos_msg);
     return FALSE;
   }
 
   GST_LOG_OBJECT (self, "process frame");
+keep_frame:
+  self->processed++;
   return TRUE;
 }
 
@@ -1727,7 +1746,7 @@ restart:
     }
 
     /* Check if we need to drop the frame because of QoS */
-    if (!gst_deinterlace_do_qos (self, GST_BUFFER_TIMESTAMP (buf))) {
+    if (!gst_deinterlace_do_qos (self, buf)) {
       self->cur_field_idx--;
       gst_buffer_unref (gst_deinterlace_pop_history (self));
       gst_buffer_unref (outbuf);
@@ -1867,7 +1886,7 @@ restart:
     }
 
     /* Check if we need to drop the frame because of QoS */
-    if (!gst_deinterlace_do_qos (self, GST_BUFFER_TIMESTAMP (buf))) {
+    if (!gst_deinterlace_do_qos (self, buf)) {
       self->cur_field_idx--;
       gst_buffer_unref (gst_deinterlace_pop_history (self));
       gst_buffer_unref (outbuf);
@@ -1982,7 +2001,8 @@ gst_deinterlace_chain (GstPad * pad, GstBuffer * buf)
       self->fields = self->new_fields;
     if (self->new_mode != -1)
       self->mode = self->new_mode;
-    self->new_mode = self->new_fields = -1;
+    self->new_mode = -1;
+    self->new_fields = -1;
 
     self->reconfigure = FALSE;
     GST_OBJECT_UNLOCK (self);
diff --git a/gst/deinterlace/gstdeinterlace.h b/gst/deinterlace/gstdeinterlace.h
index a5a69a3..bdd3ee3 100644
--- a/gst/deinterlace/gstdeinterlace.h
+++ b/gst/deinterlace/gstdeinterlace.h
@@ -162,6 +162,8 @@ struct _GstDeinterlace
   /* QoS stuff */
   gdouble proportion;
   GstClockTime earliest_time;
+  gint64 processed;
+  gint64 dropped;
 
   GstCaps *request_caps;
 
diff --git a/gst/deinterlace/gstdeinterlacemethod.c b/gst/deinterlace/gstdeinterlacemethod.c
index 9927868..bfa982a 100644
--- a/gst/deinterlace/gstdeinterlacemethod.c
+++ b/gst/deinterlace/gstdeinterlacemethod.c
@@ -108,6 +108,7 @@ gst_deinterlace_method_setup_impl (GstDeinterlaceMethod * self,
     GstVideoFormat format, gint width, gint height)
 {
   gint i;
+  gint n_components;
   GstDeinterlaceMethodClass *klass = GST_DEINTERLACE_METHOD_GET_CLASS (self);
 
   self->format = format;
@@ -119,7 +120,8 @@ gst_deinterlace_method_setup_impl (GstDeinterlaceMethod * self,
   if (format == GST_VIDEO_FORMAT_UNKNOWN)
     return;
 
-  for (i = 0; i < 4; i++) {
+  n_components = 3 + gst_video_format_has_alpha (format);
+  for (i = 0; i < n_components; i++) {
     self->width[i] = gst_video_format_get_component_width (format, i, width);
     self->height[i] = gst_video_format_get_component_height (format, i, height);
     self->offset[i] =
diff --git a/gst/deinterlace/tvtime-dist.c b/gst/deinterlace/tvtime-dist.c
index a278f75..e1f7ed3 100644
--- a/gst/deinterlace/tvtime-dist.c
+++ b/gst/deinterlace/tvtime-dist.c
@@ -325,7 +325,7 @@ deinterlace_line_vfir (guint8 * ORC_RESTRICT d1, const guint8 * ORC_RESTRICT s1,
     const guint8 * ORC_RESTRICT s4, const guint8 * ORC_RESTRICT s5, int n)
 {
   OrcExecutor _ex, *ex = &_ex;
-  static volatile int p_inited = 0;
+  static int p_inited = 0;
   static OrcProgram *p = 0;
   void (*func) (OrcExecutor *);
 
@@ -468,7 +468,7 @@ deinterlace_line_linear (guint8 * ORC_RESTRICT d1,
     const guint8 * ORC_RESTRICT s1, const guint8 * ORC_RESTRICT s2, int n)
 {
   OrcExecutor _ex, *ex = &_ex;
-  static volatile int p_inited = 0;
+  static int p_inited = 0;
   static OrcProgram *p = 0;
   void (*func) (OrcExecutor *);
 
@@ -638,7 +638,7 @@ deinterlace_line_linear_blend (guint8 * ORC_RESTRICT d1,
     const guint8 * ORC_RESTRICT s3, int n)
 {
   OrcExecutor _ex, *ex = &_ex;
-  static volatile int p_inited = 0;
+  static int p_inited = 0;
   static OrcProgram *p = 0;
   void (*func) (OrcExecutor *);
 
@@ -921,7 +921,7 @@ deinterlace_line_greedy (orc_uint8 * ORC_RESTRICT d1,
     int p1, int n)
 {
   OrcExecutor _ex, *ex = &_ex;
-  static volatile int p_inited = 0;
+  static int p_inited = 0;
   static OrcProgram *p = 0;
   void (*func) (OrcExecutor *);
 
diff --git a/gst/deinterlace/tvtime/greedyh.asm b/gst/deinterlace/tvtime/greedyh.asm
index d87b9e3..c710b4a 100644
--- a/gst/deinterlace/tvtime/greedyh.asm
+++ b/gst/deinterlace/tvtime/greedyh.asm
@@ -43,7 +43,7 @@ FUNCT_NAME_YUY2 (GstDeinterlaceMethodGreedyH *self, const guint8 * L1, const gui
   gint64 MotionSense;
   gint64 i;
   glong LoopCtr;
-  glong oldbx;
+  glong oldbx = 0;
 
   gint64 QW256B;
   gint64 LastAvg = 0;          //interp value from left qword
@@ -262,7 +262,7 @@ FUNCT_NAME_UYVY (GstDeinterlaceMethodGreedyH *self, const guint8 * L1, const gui
   gint64 MotionSense;
   gint64 i;
   glong LoopCtr;
-  glong oldbx;
+  glong oldbx = 0;
 
   gint64 QW256B;
   gint64 LastAvg = 0;          //interp value from left qword
diff --git a/gst/deinterlace/tvtime/tomsmocomp/SearchLoopTop.inc b/gst/deinterlace/tvtime/tomsmocomp/SearchLoopTop.inc
index 9d6a490..275c7dd 100644
--- a/gst/deinterlace/tvtime/tomsmocomp/SearchLoopTop.inc
+++ b/gst/deinterlace/tvtime/tomsmocomp/SearchLoopTop.inc
@@ -92,7 +92,7 @@ long     Last8;
           int64_t Max_Vals  = 0x0000000000000000ull;
           int64_t ShiftMask = 0xfefffefffefffeffull;
 
-          long oldbx;
+          long oldbx = 0;
 
 		// pretend it's indented -->>
         __asm__ __volatile__
diff --git a/gst/effectv/LICENSE b/gst/effectv/LICENSE
new file mode 100644
index 0000000..91edebf
--- /dev/null
+++ b/gst/effectv/LICENSE
@@ -0,0 +1,14 @@
+/* GStreamer
+ * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
+ *
+ * EffecTV:
+ * Copyright (C) 2001 FUKUCHI Kentarou
+ *
+ * EffecTV is free software. We release this product under the terms of the
+ * GNU General Public License version 2. The license is included in the file
+ * COPYING.
+ *
+ * This program is distributed in the hope that it will be useful, but WITHOUT ANY
+ * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
+ * A PARTICULAR PURPOSE.  See the GNU General Public License for more details.
+ */
diff --git a/gst/effectv/Makefile.in b/gst/effectv/Makefile.in
index 3a06acb..05c8221 100644
--- a/gst/effectv/Makefile.in
+++ b/gst/effectv/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/effectv
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -126,10 +142,23 @@ libgsteffectv_la_OBJECTS = $(am_libgsteffectv_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgsteffectv_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgsteffectv_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgsteffectv_la_CFLAGS) $(CFLAGS) \
 	$(libgsteffectv_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -142,22 +171,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgsteffectv_la_SOURCES)
 DIST_SOURCES = $(libgsteffectv_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -217,6 +247,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -265,8 +296,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -347,7 +380,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -407,6 +440,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -480,7 +514,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -546,7 +584,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -554,6 +591,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -569,12 +608,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgsteffectv.la: $(libgsteffectv_la_OBJECTS) $(libgsteffectv_la_DEPENDENCIES) $(EXTRA_libgsteffectv_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgsteffectv_la_LINK) -rpath $(plugindir) $(libgsteffectv_la_OBJECTS) $(libgsteffectv_la_LIBADD) $(LIBS)
 
@@ -765,6 +806,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -909,18 +964,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/equalizer/Makefile.in b/gst/equalizer/Makefile.in
index 73e8aec..a12ccd3 100644
--- a/gst/equalizer/Makefile.in
+++ b/gst/equalizer/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -18,6 +17,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -36,15 +52,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/equalizer
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -123,10 +139,23 @@ libgstequalizer_la_OBJECTS = $(am_libgstequalizer_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstequalizer_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstequalizer_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstequalizer_la_CFLAGS) $(CFLAGS) \
 	$(libgstequalizer_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -139,22 +168,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstequalizer_la_SOURCES)
 DIST_SOURCES = $(libgstequalizer_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DATA = $(preset_DATA)
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
@@ -215,6 +245,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -263,8 +294,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -345,7 +378,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -405,6 +438,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -478,7 +512,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -538,7 +576,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -546,6 +583,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -561,12 +600,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstequalizer.la: $(libgstequalizer_la_OBJECTS) $(libgstequalizer_la_DEPENDENCIES) $(EXTRA_libgstequalizer_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstequalizer_la_LINK) -rpath $(plugindir) $(libgstequalizer_la_OBJECTS) $(libgstequalizer_la_LIBADD) $(LIBS)
 
@@ -637,8 +678,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-presetDATA: $(preset_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(presetdir)" || $(MKDIR_P) "$(DESTDIR)$(presetdir)"
 	@list='$(preset_DATA)'; test -n "$(presetdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(presetdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(presetdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -703,6 +747,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -847,19 +905,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES uninstall-presetDATA
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-presetDATA install-ps install-ps-am install-strip \
-	installcheck installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES \
-	uninstall-presetDATA
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-presetDATA install-ps \
+	install-ps-am install-strip installcheck installcheck-am \
+	installdirs maintainer-clean maintainer-clean-generic \
+	mostlyclean mostlyclean-compile mostlyclean-generic \
+	mostlyclean-libtool pdf pdf-am ps ps-am tags uninstall \
+	uninstall-am uninstall-pluginLTLIBRARIES uninstall-presetDATA
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/equalizer/gstiirequalizer.c b/gst/equalizer/gstiirequalizer.c
index ffd2c43..bf9ec4d 100644
--- a/gst/equalizer/gstiirequalizer.c
+++ b/gst/equalizer/gstiirequalizer.c
@@ -71,9 +71,16 @@ _do_init (GType object_type)
     NULL,                       /* interface_finalize */
     NULL                        /* interface_data */
   };
+  const GInterfaceInfo preset_interface_info = {
+    NULL,                       /* interface_init */
+    NULL,                       /* interface_finalize */
+    NULL                        /* interface_data */
+  };
 
   g_type_add_interface_static (object_type, GST_TYPE_CHILD_PROXY,
       &child_proxy_interface_info);
+  g_type_add_interface_static (object_type, GST_TYPE_PRESET,
+      &preset_interface_info);
 }
 
 GST_BOILERPLATE_FULL (GstIirEqualizer, gst_iir_equalizer,
diff --git a/gst/equalizer/gstiirequalizer10bands.c b/gst/equalizer/gstiirequalizer10bands.c
index b39515c..1afabc0 100644
--- a/gst/equalizer/gstiirequalizer10bands.c
+++ b/gst/equalizer/gstiirequalizer10bands.c
@@ -61,22 +61,8 @@ static void gst_iir_equalizer_10bands_get_property (GObject * object,
 GST_DEBUG_CATEGORY_EXTERN (equalizer_debug);
 #define GST_CAT_DEFAULT equalizer_debug
 
-
-static void
-_do_init (GType object_type)
-{
-  const GInterfaceInfo preset_interface_info = {
-    NULL,                       /* interface_init */
-    NULL,                       /* interface_finalize */
-    NULL                        /* interface_data */
-  };
-
-  g_type_add_interface_static (object_type, GST_TYPE_PRESET,
-      &preset_interface_info);
-}
-
-GST_BOILERPLATE_FULL (GstIirEqualizer10Bands, gst_iir_equalizer_10bands,
-    GstIirEqualizer, GST_TYPE_IIR_EQUALIZER, _do_init);
+GST_BOILERPLATE (GstIirEqualizer10Bands, gst_iir_equalizer_10bands,
+    GstIirEqualizer, GST_TYPE_IIR_EQUALIZER);
 
 /* equalizer implementation */
 
@@ -164,38 +150,38 @@ static void
 gst_iir_equalizer_10bands_set_property (GObject * object, guint prop_id,
     const GValue * value, GParamSpec * pspec)
 {
-  GstIirEqualizer *equ = GST_IIR_EQUALIZER (object);
+  GstObject *equ = GST_OBJECT (object);
 
   switch (prop_id) {
     case PROP_BAND0:
-      gst_child_proxy_set_property (GST_OBJECT (equ), "band0::gain", value);
+      gst_child_proxy_set_property (equ, "band0::gain", value);
       break;
     case PROP_BAND1:
-      gst_child_proxy_set_property (GST_OBJECT (equ), "band1::gain", value);
+      gst_child_proxy_set_property (equ, "band1::gain", value);
       break;
     case PROP_BAND2:
-      gst_child_proxy_set_property (GST_OBJECT (equ), "band2::gain", value);
+      gst_child_proxy_set_property (equ, "band2::gain", value);
       break;
     case PROP_BAND3:
-      gst_child_proxy_set_property (GST_OBJECT (equ), "band3::gain", value);
+      gst_child_proxy_set_property (equ, "band3::gain", value);
       break;
     case PROP_BAND4:
-      gst_child_proxy_set_property (GST_OBJECT (equ), "band4::gain", value);
+      gst_child_proxy_set_property (equ, "band4::gain", value);
       break;
     case PROP_BAND5:
-      gst_child_proxy_set_property (GST_OBJECT (equ), "band5::gain", value);
+      gst_child_proxy_set_property (equ, "band5::gain", value);
       break;
     case PROP_BAND6:
-      gst_child_proxy_set_property (GST_OBJECT (equ), "band6::gain", value);
+      gst_child_proxy_set_property (equ, "band6::gain", value);
       break;
     case PROP_BAND7:
-      gst_child_proxy_set_property (GST_OBJECT (equ), "band7::gain", value);
+      gst_child_proxy_set_property (equ, "band7::gain", value);
       break;
     case PROP_BAND8:
-      gst_child_proxy_set_property (GST_OBJECT (equ), "band8::gain", value);
+      gst_child_proxy_set_property (equ, "band8::gain", value);
       break;
     case PROP_BAND9:
-      gst_child_proxy_set_property (GST_OBJECT (equ), "band9::gain", value);
+      gst_child_proxy_set_property (equ, "band9::gain", value);
       break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
@@ -207,38 +193,38 @@ static void
 gst_iir_equalizer_10bands_get_property (GObject * object, guint prop_id,
     GValue * value, GParamSpec * pspec)
 {
-  GstIirEqualizer *equ = GST_IIR_EQUALIZER (object);
+  GstObject *equ = GST_OBJECT (object);
 
   switch (prop_id) {
     case PROP_BAND0:
-      gst_child_proxy_get_property (GST_OBJECT (equ), "band0::gain", value);
+      gst_child_proxy_get_property (equ, "band0::gain", value);
       break;
     case PROP_BAND1:
-      gst_child_proxy_get_property (GST_OBJECT (equ), "band1::gain", value);
+      gst_child_proxy_get_property (equ, "band1::gain", value);
       break;
     case PROP_BAND2:
-      gst_child_proxy_get_property (GST_OBJECT (equ), "band2::gain", value);
+      gst_child_proxy_get_property (equ, "band2::gain", value);
       break;
     case PROP_BAND3:
-      gst_child_proxy_get_property (GST_OBJECT (equ), "band3::gain", value);
+      gst_child_proxy_get_property (equ, "band3::gain", value);
       break;
     case PROP_BAND4:
-      gst_child_proxy_get_property (GST_OBJECT (equ), "band4::gain", value);
+      gst_child_proxy_get_property (equ, "band4::gain", value);
       break;
     case PROP_BAND5:
-      gst_child_proxy_get_property (GST_OBJECT (equ), "band5::gain", value);
+      gst_child_proxy_get_property (equ, "band5::gain", value);
       break;
     case PROP_BAND6:
-      gst_child_proxy_get_property (GST_OBJECT (equ), "band6::gain", value);
+      gst_child_proxy_get_property (equ, "band6::gain", value);
       break;
     case PROP_BAND7:
-      gst_child_proxy_get_property (GST_OBJECT (equ), "band7::gain", value);
+      gst_child_proxy_get_property (equ, "band7::gain", value);
       break;
     case PROP_BAND8:
-      gst_child_proxy_get_property (GST_OBJECT (equ), "band8::gain", value);
+      gst_child_proxy_get_property (equ, "band8::gain", value);
       break;
     case PROP_BAND9:
-      gst_child_proxy_get_property (GST_OBJECT (equ), "band9::gain", value);
+      gst_child_proxy_get_property (equ, "band9::gain", value);
       break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
diff --git a/gst/equalizer/gstiirequalizer3bands.c b/gst/equalizer/gstiirequalizer3bands.c
index 733c5b8..c125c73 100644
--- a/gst/equalizer/gstiirequalizer3bands.c
+++ b/gst/equalizer/gstiirequalizer3bands.c
@@ -53,22 +53,8 @@ static void gst_iir_equalizer_3bands_get_property (GObject * object,
 GST_DEBUG_CATEGORY_EXTERN (equalizer_debug);
 #define GST_CAT_DEFAULT equalizer_debug
 
-
-static void
-_do_init (GType object_type)
-{
-  const GInterfaceInfo preset_interface_info = {
-    NULL,                       /* interface_init */
-    NULL,                       /* interface_finalize */
-    NULL                        /* interface_data */
-  };
-
-  g_type_add_interface_static (object_type, GST_TYPE_PRESET,
-      &preset_interface_info);
-}
-
-GST_BOILERPLATE_FULL (GstIirEqualizer3Bands, gst_iir_equalizer_3bands,
-    GstIirEqualizer, GST_TYPE_IIR_EQUALIZER, _do_init);
+GST_BOILERPLATE (GstIirEqualizer3Bands, gst_iir_equalizer_3bands,
+    GstIirEqualizer, GST_TYPE_IIR_EQUALIZER);
 
 /* equalizer implementation */
 
@@ -120,17 +106,17 @@ static void
 gst_iir_equalizer_3bands_set_property (GObject * object, guint prop_id,
     const GValue * value, GParamSpec * pspec)
 {
-  GstIirEqualizer *equ = GST_IIR_EQUALIZER (object);
+  GstObject *equ = GST_OBJECT (object);
 
   switch (prop_id) {
     case PROP_BAND0:
-      gst_child_proxy_set_property (GST_OBJECT (equ), "band0::gain", value);
+      gst_child_proxy_set_property (equ, "band0::gain", value);
       break;
     case PROP_BAND1:
-      gst_child_proxy_set_property (GST_OBJECT (equ), "band1::gain", value);
+      gst_child_proxy_set_property (equ, "band1::gain", value);
       break;
     case PROP_BAND2:
-      gst_child_proxy_set_property (GST_OBJECT (equ), "band2::gain", value);
+      gst_child_proxy_set_property (equ, "band2::gain", value);
       break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
@@ -142,17 +128,17 @@ static void
 gst_iir_equalizer_3bands_get_property (GObject * object, guint prop_id,
     GValue * value, GParamSpec * pspec)
 {
-  GstIirEqualizer *equ = GST_IIR_EQUALIZER (object);
+  GstObject *equ = GST_OBJECT (object);
 
   switch (prop_id) {
     case PROP_BAND0:
-      gst_child_proxy_get_property (GST_OBJECT (equ), "band0::gain", value);
+      gst_child_proxy_get_property (equ, "band0::gain", value);
       break;
     case PROP_BAND1:
-      gst_child_proxy_get_property (GST_OBJECT (equ), "band1::gain", value);
+      gst_child_proxy_get_property (equ, "band1::gain", value);
       break;
     case PROP_BAND2:
-      gst_child_proxy_get_property (GST_OBJECT (equ), "band2::gain", value);
+      gst_child_proxy_get_property (equ, "band2::gain", value);
       break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
diff --git a/gst/flv/Makefile.in b/gst/flv/Makefile.in
index 9a786a1..c833636 100644
--- a/gst/flv/Makefile.in
+++ b/gst/flv/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/flv
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -119,10 +135,23 @@ libgstflv_la_OBJECTS = $(am_libgstflv_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstflv_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstflv_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstflv_la_CFLAGS) $(CFLAGS) \
 	$(libgstflv_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -135,22 +164,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstflv_la_SOURCES)
 DIST_SOURCES = $(libgstflv_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -210,6 +240,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -258,8 +289,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -340,7 +373,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -400,6 +433,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -473,7 +507,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -522,7 +560,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -530,6 +567,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -545,12 +584,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstflv.la: $(libgstflv_la_OBJECTS) $(libgstflv_la_DEPENDENCIES) $(EXTRA_libgstflv_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstflv_la_LINK) -rpath $(plugindir) $(libgstflv_la_OBJECTS) $(libgstflv_la_LIBADD) $(LIBS)
 
@@ -653,6 +694,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -797,18 +852,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/flv/amfdefs.h b/gst/flv/amfdefs.h
index 6c14f3f..00d0c1a 100644
--- a/gst/flv/amfdefs.h
+++ b/gst/flv/amfdefs.h
@@ -27,7 +27,7 @@
 #define AMF0_BOOLEAN_MARKER 0x1
 #define AMF0_STRING_MARKER 0x2
 #define AMF0_OBJECT_MARKER 0x3
-#define AMF0_MOVIECLIP_MARKER 0x4 // Reserved, not supported
+#define AMF0_MOVIECLIP_MARKER 0x4 /* Reserved, not supported */
 #define AMF0_NULL_MARKER 0x5
 #define AMF0_UNDEFINED_MARKER 0x6
 #define AMF0_REFERENCE_MARKER 0x7
@@ -37,7 +37,7 @@
 #define AMF0_DATE_MARKER 0xB
 #define AMF0_LONG_STRING_MARKER 0xC
 #define AMF0_UNSUPPORTED_MARKER 0xD
-#define AMF0_RECORDSET_MARKER 0xE // Reserved, not supported
+#define AMF0_RECORDSET_MARKER 0xE /* Reserved, not supported */
 #define AMF0_XML_DOCUMENT_MARKER 0xF
 #define AMF0_TYPED_OBJECT_MARKER 0x10
 
diff --git a/gst/flv/gstflvdemux.c b/gst/flv/gstflvdemux.c
index fbf7e25..203cb76 100644
--- a/gst/flv/gstflvdemux.c
+++ b/gst/flv/gstflvdemux.c
@@ -99,13 +99,15 @@ static gboolean gst_flv_demux_handle_seek_pull (GstFlvDemux * demux,
 static gboolean gst_flv_demux_query (GstPad * pad, GstQuery * query);
 static gboolean gst_flv_demux_src_event (GstPad * pad, GstEvent * event);
 
+static GstIndex *gst_flv_demux_get_index (GstElement * element);
 
 static void
 gst_flv_demux_parse_and_add_index_entry (GstFlvDemux * demux, GstClockTime ts,
     guint64 pos, gboolean keyframe)
 {
-  static GstIndexAssociation associations[2];
-  static GstIndexEntry *entry;
+  GstIndexAssociation associations[2];
+  GstIndex *index;
+  GstIndexEntry *entry;
 
   GST_LOG_OBJECT (demux,
       "adding key=%d association %" GST_TIME_FORMAT "-> %" G_GUINT64_FORMAT,
@@ -115,8 +117,13 @@ gst_flv_demux_parse_and_add_index_entry (GstFlvDemux * demux, GstClockTime ts,
   if (!demux->upstream_seekable)
     return;
 
+  index = gst_flv_demux_get_index (GST_ELEMENT (demux));
+
+  if (!index)
+    return;
+
   /* entry may already have been added before, avoid adding indefinitely */
-  entry = gst_index_get_assoc_entry (demux->index, demux->index_id,
+  entry = gst_index_get_assoc_entry (index, demux->index_id,
       GST_INDEX_LOOKUP_EXACT, GST_ASSOCIATION_FLAG_NONE, GST_FORMAT_BYTES, pos);
 
   if (entry) {
@@ -132,6 +139,7 @@ gst_flv_demux_parse_and_add_index_entry (GstFlvDemux * demux, GstClockTime ts,
     if (time != ts || key != ! !keyframe)
       GST_DEBUG_OBJECT (demux, "metadata mismatch");
 #endif
+    gst_object_unref (index);
     return;
   }
 
@@ -140,7 +148,7 @@ gst_flv_demux_parse_and_add_index_entry (GstFlvDemux * demux, GstClockTime ts,
   associations[1].format = GST_FORMAT_BYTES;
   associations[1].value = pos;
 
-  gst_index_add_associationv (demux->index, demux->index_id,
+  gst_index_add_associationv (index, demux->index_id,
       (keyframe) ? GST_ASSOCIATION_FLAG_KEY_UNIT :
       GST_ASSOCIATION_FLAG_DELTA_UNIT, 2,
       (const GstIndexAssociation *) &associations);
@@ -149,6 +157,8 @@ gst_flv_demux_parse_and_add_index_entry (GstFlvDemux * demux, GstClockTime ts,
     demux->index_max_pos = pos;
   if (ts > demux->index_max_time)
     demux->index_max_time = ts;
+
+  gst_object_unref (index);
 }
 
 static gchar *
@@ -311,7 +321,7 @@ gst_flv_demux_parse_metadata_item (GstFlvDemux * demux, GstByteReader * reader,
   GST_DEBUG_OBJECT (demux, "tag name %s, tag type %d", tag_name, tag_type);
 
   switch (tag_type) {
-    case 0:                    // Double
+    case 0:                    /* Double */
     {                           /* Use a union to read the uint64 and then as a double */
       gdouble d = 0;
 
@@ -343,7 +353,7 @@ gst_flv_demux_parse_metadata_item (GstFlvDemux * demux, GstByteReader * reader,
 
       break;
     }
-    case 1:                    // Boolean
+    case 1:                    /* Boolean */
     {
       guint8 b = 0;
 
@@ -356,7 +366,7 @@ gst_flv_demux_parse_metadata_item (GstFlvDemux * demux, GstByteReader * reader,
 
       break;
     }
-    case 2:                    // String
+    case 2:                    /* String */
     {
       gchar *s = NULL;
 
@@ -394,7 +404,7 @@ gst_flv_demux_parse_metadata_item (GstFlvDemux * demux, GstByteReader * reader,
 
       break;
     }
-    case 3:                    // Object
+    case 3:                    /* Object */
     {
       gboolean end_of_object_marker = FALSE;
 
@@ -410,7 +420,7 @@ gst_flv_demux_parse_metadata_item (GstFlvDemux * demux, GstByteReader * reader,
 
       break;
     }
-    case 8:                    // ECMA array
+    case 8:                    /* ECMA array */
     {
       guint32 nb_elems = 0;
       gboolean end_of_object_marker = FALSE;
@@ -433,7 +443,7 @@ gst_flv_demux_parse_metadata_item (GstFlvDemux * demux, GstByteReader * reader,
 
       break;
     }
-    case 9:                    // End marker
+    case 9:                    /* End marker */
     {
       GST_DEBUG_OBJECT (demux, "end marker ?");
       if (tag_name[0] == '\0') {
@@ -445,7 +455,7 @@ gst_flv_demux_parse_metadata_item (GstFlvDemux * demux, GstByteReader * reader,
 
       break;
     }
-    case 10:                   // Array
+    case 10:                   /* Array */
     {
       guint32 nb_elems = 0;
 
@@ -498,7 +508,7 @@ gst_flv_demux_parse_metadata_item (GstFlvDemux * demux, GstByteReader * reader,
 
       break;
     }
-    case 11:                   // Date
+    case 11:                   /* Date */
     {
       gdouble d = 0;
       gint16 i = 0;
@@ -606,7 +616,7 @@ gst_flv_demux_parse_tag_script (GstFlvDemux * demux, GstBuffer * buffer)
 
     g_free (function_name);
 
-    if (demux->index && demux->times && demux->filepositions) {
+    if (demux->times && demux->filepositions) {
       guint num;
 
       /* If an index was found, insert associations */
@@ -986,7 +996,7 @@ gst_flv_demux_parse_tag_audio (GstFlvDemux * demux, GstBuffer * buffer)
 
   /* Only add audio frames to the index if we have no video,
    * and if the index is not yet complete */
-  if (!demux->has_video && demux->index && !demux->indexed) {
+  if (!demux->has_video && !demux->indexed) {
     gst_flv_demux_parse_and_add_index_entry (demux,
         GST_BUFFER_TIMESTAMP (outbuf), demux->cur_tag_offset, TRUE);
   }
@@ -1359,7 +1369,7 @@ gst_flv_demux_parse_tag_video (GstFlvDemux * demux, GstBuffer * buffer)
   if (!keyframe)
     GST_BUFFER_FLAG_SET (outbuf, GST_BUFFER_FLAG_DELTA_UNIT);
 
-  if (!demux->indexed && demux->index) {
+  if (!demux->indexed) {
     gst_flv_demux_parse_and_add_index_entry (demux,
         GST_BUFFER_TIMESTAMP (outbuf), demux->cur_tag_offset, keyframe);
   }
@@ -1508,7 +1518,7 @@ gst_flv_demux_parse_tag_timestamp (GstFlvDemux * demux, gboolean index,
   ret = pts * GST_MSECOND;
   GST_LOG_OBJECT (demux, "pts: %" GST_TIME_FORMAT, GST_TIME_ARGS (ret));
 
-  if (index && demux->index && !demux->indexed && (type == 9 || (type == 8
+  if (index && !demux->indexed && (type == 9 || (type == 8
               && !demux->has_video))) {
     gst_flv_demux_parse_and_add_index_entry (demux, ret, demux->offset,
         keyframe);
@@ -2139,6 +2149,7 @@ static GstFlowReturn
 gst_flv_demux_seek_to_prev_keyframe (GstFlvDemux * demux)
 {
   GstFlowReturn ret = GST_FLOW_UNEXPECTED;
+  GstIndex *index;
   GstIndexEntry *entry = NULL;
 
   GST_DEBUG_OBJECT (demux,
@@ -2157,28 +2168,34 @@ gst_flv_demux_seek_to_prev_keyframe (GstFlvDemux * demux)
 
   GST_DEBUG_OBJECT (demux, "locating previous position");
 
+  index = gst_flv_demux_get_index (GST_ELEMENT (demux));
+
   /* locate index entry before previous start position */
-  if (demux->index)
-    entry = gst_index_get_assoc_entry (demux->index, demux->index_id,
+  if (index) {
+    entry = gst_index_get_assoc_entry (index, demux->index_id,
         GST_INDEX_LOOKUP_BEFORE, GST_ASSOCIATION_FLAG_KEY_UNIT,
         GST_FORMAT_BYTES, demux->from_offset - 1);
 
-  if (entry) {
-    gint64 bytes, time;
+    if (entry) {
+      gint64 bytes, time;
 
-    gst_index_entry_assoc_map (entry, GST_FORMAT_BYTES, &bytes);
-    gst_index_entry_assoc_map (entry, GST_FORMAT_TIME, &time);
+      gst_index_entry_assoc_map (entry, GST_FORMAT_BYTES, &bytes);
+      gst_index_entry_assoc_map (entry, GST_FORMAT_TIME, &time);
 
-    GST_DEBUG_OBJECT (demux, "found index entry for %" G_GINT64_FORMAT
-        " at %" GST_TIME_FORMAT ", seeking to %" G_GINT64_FORMAT,
-        demux->offset - 1, GST_TIME_ARGS (time), bytes);
+      GST_DEBUG_OBJECT (demux, "found index entry for %" G_GINT64_FORMAT
+          " at %" GST_TIME_FORMAT ", seeking to %" G_GINT64_FORMAT,
+          demux->offset - 1, GST_TIME_ARGS (time), bytes);
 
-    /* setup for next section */
-    demux->to_offset = demux->from_offset;
-    gst_flv_demux_move_to_offset (demux, bytes, FALSE);
-    ret = GST_FLOW_OK;
+      /* setup for next section */
+      demux->to_offset = demux->from_offset;
+      gst_flv_demux_move_to_offset (demux, bytes, FALSE);
+      ret = GST_FLOW_OK;
+    }
+
+    gst_object_unref (index);
   }
 
+
 done:
   return ret;
 }
@@ -2416,7 +2433,10 @@ pause:
         }
 
         GST_LOG_OBJECT (demux, "Sending EOS, at end of stream");
-        if (!gst_flv_demux_push_src_event (demux, gst_event_new_eos ()))
+        if (!demux->audio_pad && !demux->video_pad)
+          GST_ELEMENT_ERROR (demux, STREAM, FAILED,
+              ("Internal data stream error."), ("Got EOS before any data"));
+        else if (!gst_flv_demux_push_src_event (demux, gst_event_new_eos ()))
           GST_WARNING_OBJECT (demux, "failed pushing EOS on streams");
       }
     } else if (ret == GST_FLOW_NOT_LINKED || ret < GST_FLOW_UNEXPECTED) {
@@ -2435,15 +2455,18 @@ gst_flv_demux_find_offset (GstFlvDemux * demux, GstSegment * segment)
 {
   gint64 bytes = 0;
   gint64 time = 0;
+  GstIndex *index;
   GstIndexEntry *entry;
 
   g_return_val_if_fail (segment != NULL, 0);
 
   time = segment->last_stop;
 
-  if (demux->index) {
+  index = gst_flv_demux_get_index (GST_ELEMENT (demux));
+
+  if (index) {
     /* Let's check if we have an index entry for that seek time */
-    entry = gst_index_get_assoc_entry (demux->index, demux->index_id,
+    entry = gst_index_get_assoc_entry (index, demux->index_id,
         GST_INDEX_LOOKUP_BEFORE, GST_ASSOCIATION_FLAG_KEY_UNIT,
         GST_FORMAT_TIME, time);
 
@@ -2467,6 +2490,8 @@ gst_flv_demux_find_offset (GstFlvDemux * demux, GstSegment * segment)
       GST_DEBUG_OBJECT (demux, "no index entry found for %" GST_TIME_FORMAT,
           GST_TIME_ARGS (segment->start));
     }
+
+    gst_object_unref (index);
   }
 
   return bytes;
@@ -2884,20 +2909,34 @@ gst_flv_demux_sink_event (GstPad * pad, GstEvent * event)
       ret = gst_flv_demux_push_src_event (demux, event);
       break;
     case GST_EVENT_EOS:
+    {
+      GstIndex *index;
+
       GST_DEBUG_OBJECT (demux, "received EOS");
-      if (demux->index) {
+
+      index = gst_flv_demux_get_index (GST_ELEMENT (demux));
+
+      if (index) {
         GST_DEBUG_OBJECT (demux, "committing index");
-        gst_index_commit (demux->index, demux->index_id);
-      }
-      if (!demux->no_more_pads) {
-        gst_element_no_more_pads (GST_ELEMENT (demux));
-        demux->no_more_pads = TRUE;
+        gst_index_commit (index, demux->index_id);
+        gst_object_unref (index);
       }
 
-      if (!gst_flv_demux_push_src_event (demux, event))
-        GST_WARNING_OBJECT (demux, "failed pushing EOS on streams");
+      if (!demux->audio_pad && !demux->video_pad)
+        GST_ELEMENT_ERROR (demux, STREAM, FAILED,
+            ("Internal data stream error."), ("Got EOS before any data"));
+      else {
+        if (!demux->no_more_pads) {
+          gst_element_no_more_pads (GST_ELEMENT (demux));
+          demux->no_more_pads = TRUE;
+        }
+
+        if (!gst_flv_demux_push_src_event (demux, event))
+          GST_WARNING_OBJECT (demux, "failed pushing EOS on streams");
+      }
       ret = TRUE;
       break;
+    }
     case GST_EVENT_NEWSEGMENT:
     {
       GstFormat format;
@@ -2926,6 +2965,10 @@ gst_flv_demux_sink_event (GstPad * pad, GstEvent * event)
         demux->video_need_segment = TRUE;
         ret = TRUE;
         gst_event_unref (event);
+        if (demux->new_seg_event) {
+          gst_event_unref (demux->new_seg_event);
+          demux->new_seg_event = NULL;
+        }
       }
       break;
     }
@@ -3035,6 +3078,7 @@ gst_flv_demux_query (GstPad * pad, GstQuery * query)
         }
       }
       res = TRUE;
+      /* FIXME, check index this way is not thread safe */
       if (fmt != GST_FORMAT_TIME || !demux->index) {
         gst_query_set_seeking (query, fmt, FALSE, -1, -1);
       } else if (demux->random_access) {
@@ -3132,22 +3176,32 @@ static void
 gst_flv_demux_set_index (GstElement * element, GstIndex * index)
 {
   GstFlvDemux *demux = GST_FLV_DEMUX (element);
+  GstIndex *old_index;
 
   GST_OBJECT_LOCK (demux);
-  if (demux->index)
-    gst_object_unref (demux->index);
+
+  old_index = demux->index;
+
   if (index) {
     demux->index = gst_object_ref (index);
     demux->own_index = FALSE;
   } else
     demux->index = NULL;
 
+  if (old_index)
+    gst_object_unref (demux->index);
+
+  gst_object_ref (index);
+
   GST_OBJECT_UNLOCK (demux);
+
   /* object lock might be taken again */
   if (index)
     gst_index_get_writer_id (index, GST_OBJECT (element), &demux->index_id);
+
   GST_DEBUG_OBJECT (demux, "Set index %" GST_PTR_FORMAT, demux->index);
 
+  gst_object_unref (index);
 }
 
 static GstIndex *
@@ -3236,8 +3290,7 @@ gst_flv_demux_base_init (gpointer g_class)
 {
   GstElementClass *element_class = GST_ELEMENT_CLASS (g_class);
 
-  gst_element_class_add_static_pad_template (element_class,
-      &flv_sink_template);
+  gst_element_class_add_static_pad_template (element_class, &flv_sink_template);
   gst_element_class_add_static_pad_template (element_class,
       &audio_src_template);
   gst_element_class_add_static_pad_template (element_class,
diff --git a/gst/flv/gstflvmux.c b/gst/flv/gstflvmux.c
index 44ed7ea..c347ff0 100644
--- a/gst/flv/gstflvmux.c
+++ b/gst/flv/gstflvmux.c
@@ -100,7 +100,11 @@ GST_BOILERPLATE_FULL (GstFlvMux, gst_flv_mux, GstElement, GST_TYPE_ELEMENT,
 
 static void gst_flv_mux_finalize (GObject * object);
 static GstFlowReturn
-gst_flv_mux_collected (GstCollectPads * pads, gpointer user_data);
+gst_flv_mux_handle_buffer (GstCollectPads2 * pads, GstCollectData2 * cdata,
+    GstBuffer * buf, gpointer user_data);
+static gboolean
+gst_flv_mux_handle_sink_event (GstCollectPads2 * pads, GstCollectData2 * data,
+    GstEvent * event, gpointer user_data);
 
 static gboolean gst_flv_mux_handle_src_event (GstPad * pad, GstEvent * event);
 static GstPad *gst_flv_mux_request_new_pad (GstElement * element,
@@ -136,10 +140,8 @@ gst_flv_mux_base_init (gpointer g_class)
 {
   GstElementClass *element_class = GST_ELEMENT_CLASS (g_class);
 
-  gst_element_class_add_static_pad_template (element_class,
-      &videosink_templ);
-  gst_element_class_add_static_pad_template (element_class,
-      &audiosink_templ);
+  gst_element_class_add_static_pad_template (element_class, &videosink_templ);
+  gst_element_class_add_static_pad_template (element_class, &audiosink_templ);
   gst_element_class_add_static_pad_template (element_class, &src_templ);
   gst_element_class_set_details_simple (element_class, "FLV muxer",
       "Codec/Muxer",
@@ -198,9 +200,13 @@ gst_flv_mux_init (GstFlvMux * mux, GstFlvMuxClass * g_class)
 
   mux->new_tags = FALSE;
 
-  mux->collect = gst_collect_pads_new ();
-  gst_collect_pads_set_function (mux->collect,
-      (GstCollectPadsFunction) GST_DEBUG_FUNCPTR (gst_flv_mux_collected), mux);
+  mux->collect = gst_collect_pads2_new ();
+  gst_collect_pads2_set_buffer_function (mux->collect,
+      GST_DEBUG_FUNCPTR (gst_flv_mux_handle_buffer), mux);
+  gst_collect_pads2_set_event_function (mux->collect,
+      GST_DEBUG_FUNCPTR (gst_flv_mux_handle_sink_event), mux);
+  gst_collect_pads2_set_clip_function (mux->collect,
+      GST_DEBUG_FUNCPTR (gst_collect_pads2_clip_running_time), mux);
 
   gst_flv_mux_reset (GST_ELEMENT (mux));
 }
@@ -261,10 +267,10 @@ gst_flv_mux_handle_src_event (GstPad * pad, GstEvent * event)
 }
 
 static gboolean
-gst_flv_mux_handle_sink_event (GstPad * pad, GstEvent * event)
+gst_flv_mux_handle_sink_event (GstCollectPads2 * pads, GstCollectData2 * data,
+    GstEvent * event, gpointer user_data)
 {
-  GstFlvMux *mux = GST_FLV_MUX (gst_pad_get_parent (pad));
-  gboolean ret = TRUE;
+  GstFlvMux *mux = GST_FLV_MUX (user_data);
 
   switch (GST_EVENT_TYPE (event)) {
     case GST_EVENT_TAG:{
@@ -281,12 +287,8 @@ gst_flv_mux_handle_sink_event (GstPad * pad, GstEvent * event)
       break;
   }
 
-  /* now GstCollectPads can take care of the rest, e.g. EOS */
-  if (ret)
-    ret = mux->collect_event (pad, event);
-  gst_object_unref (mux);
-
-  return ret;
+  /* now GstCollectPads2 can take care of the rest, e.g. EOS */
+  return FALSE;
 }
 
 static gboolean
@@ -537,20 +539,12 @@ gst_flv_mux_request_new_pad (GstElement * element,
 
   pad = gst_pad_new_from_template (templ, name);
   cpad = (GstFlvPad *)
-      gst_collect_pads_add_pad (mux->collect, pad, sizeof (GstFlvPad));
+      gst_collect_pads2_add_pad (mux->collect, pad, sizeof (GstFlvPad));
 
   cpad->audio_codec_data = NULL;
   cpad->video_codec_data = NULL;
   gst_flv_mux_reset_pad (mux, cpad, video);
 
-  /* FIXME: hacked way to override/extend the event function of
-   * GstCollectPads; because it sets its own event function giving the
-   * element no access to events.
-   */
-  mux->collect_event = (GstPadEventFunction) GST_PAD_EVENTFUNC (pad);
-  gst_pad_set_event_function (pad,
-      GST_DEBUG_FUNCPTR (gst_flv_mux_handle_sink_event));
-
   gst_pad_set_setcaps_function (pad, setcapsfunc);
   gst_pad_set_active (pad, TRUE);
   gst_element_add_pad (element, pad);
@@ -565,7 +559,7 @@ gst_flv_mux_release_pad (GstElement * element, GstPad * pad)
   GstFlvPad *cpad = (GstFlvPad *) gst_pad_get_element_private (pad);
 
   gst_flv_mux_reset_pad (mux, cpad, cpad->video);
-  gst_collect_pads_remove_pad (mux->collect, pad);
+  gst_collect_pads2_remove_pad (mux->collect, pad);
   gst_element_remove_pad (element, pad);
 }
 
@@ -765,7 +759,7 @@ tags:
     guint64 dur;
 
     for (l = mux->collect->data; l; l = l->next) {
-      GstCollectData *cdata = l->data;
+      GstCollectData2 *cdata = l->data;
 
       fmt = GST_FORMAT_TIME;
 
@@ -1110,6 +1104,30 @@ gst_flv_mux_write_header (GstFlvMux * mux)
   GSList *l;
   GstFlowReturn ret;
 
+  /* if not streaming, check if downstream is seekable */
+  if (!mux->streamable) {
+    gboolean seekable;
+    GstQuery *query;
+
+    query = gst_query_new_seeking (GST_FORMAT_BYTES);
+    if (gst_pad_peer_query (mux->srcpad, query)) {
+      gst_query_parse_seeking (query, NULL, &seekable, NULL, NULL);
+      GST_INFO_OBJECT (mux, "downstream is %sseekable", seekable ? "" : "not ");
+      if (!seekable) {
+        mux->streamable = TRUE;
+        g_object_notify (G_OBJECT (mux), "streamable");
+        GST_WARNING_OBJECT (mux, "downstream is not seekable, but "
+            "streamable=false. Will ignore that and create streamable output "
+            "instead");
+      }
+    } else {
+      /* have to assume seeking is supported if query not handled downstream */
+      /* FIXME 0.11: change to query not handled => seeking not supported */
+      GST_WARNING_OBJECT (mux, "downstream did not handle seeking query");
+    }
+    gst_query_unref (query);
+  }
+
   header = gst_flv_mux_create_header (mux);
   metadata = gst_flv_mux_create_metadata (mux, TRUE);
   video_codec_data = NULL;
@@ -1215,18 +1233,12 @@ gst_flv_mux_update_index (GstFlvMux * mux, GstBuffer * buffer, GstFlvPad * cpad)
 }
 
 static GstFlowReturn
-gst_flv_mux_write_buffer (GstFlvMux * mux, GstFlvPad * cpad)
+gst_flv_mux_write_buffer (GstFlvMux * mux, GstFlvPad * cpad, GstBuffer * buffer)
 {
   GstBuffer *tag;
-  GstBuffer *buffer =
-      gst_collect_pads_pop (mux->collect, (GstCollectData *) cpad);
   GstFlowReturn ret;
 
-  /* arrange downstream running time */
-  buffer = gst_buffer_make_metadata_writable (buffer);
-  GST_BUFFER_TIMESTAMP (buffer) =
-      gst_segment_to_running_time (&cpad->collect.segment,
-      GST_FORMAT_TIME, GST_BUFFER_TIMESTAMP (buffer));
+  /* clipping function arranged for running_time */
 
   if (!mux->streamable)
     gst_flv_mux_update_index (mux, buffer, cpad);
@@ -1406,14 +1418,13 @@ gst_flv_mux_rewrite_header (GstFlvMux * mux)
 }
 
 static GstFlowReturn
-gst_flv_mux_collected (GstCollectPads * pads, gpointer user_data)
+gst_flv_mux_handle_buffer (GstCollectPads2 * pads, GstCollectData2 * cdata,
+    GstBuffer * buffer, gpointer user_data)
 {
   GstFlvMux *mux = GST_FLV_MUX (user_data);
   GstFlvPad *best;
   GstClockTime best_time;
   GstFlowReturn ret;
-  GSList *sl;
-  gboolean eos = TRUE;
 
   if (mux->state == GST_FLV_MUX_STATE_HEADER) {
     if (mux->collect->data == NULL) {
@@ -1440,46 +1451,12 @@ gst_flv_mux_collected (GstCollectPads * pads, gpointer user_data)
     mux->new_tags = FALSE;
   }
 
-
-  best = NULL;
-  best_time = GST_CLOCK_TIME_NONE;
-  for (sl = mux->collect->data; sl; sl = sl->next) {
-    GstFlvPad *cpad = sl->data;
-    GstBuffer *buffer = gst_collect_pads_peek (pads, (GstCollectData *) cpad);
-    GstClockTime time;
-
-    if (!buffer)
-      continue;
-
-    eos = FALSE;
-
-    time = GST_BUFFER_TIMESTAMP (buffer);
-    gst_buffer_unref (buffer);
-
-    /* Use buffers without valid timestamp first */
-    if (!GST_CLOCK_TIME_IS_VALID (time)) {
-      GST_WARNING_OBJECT (pads, "Buffer without valid timestamp");
-
-      best_time = cpad->last_timestamp;
-      best = cpad;
-      break;
-    }
-
-    time = gst_segment_to_running_time (&cpad->collect.segment,
-        GST_FORMAT_TIME, time);
-    if (G_UNLIKELY (!GST_CLOCK_TIME_IS_VALID (time))) {
-      GST_DEBUG_OBJECT (mux, "clipping buffer on pad %s outside segment",
-          GST_PAD_NAME (cpad->collect.pad));
-      buffer = gst_collect_pads_pop (pads, (GstCollectData *) cpad);
-      gst_buffer_unref (buffer);
-      return GST_FLOW_OK;
-    }
-
-    if (best == NULL || (GST_CLOCK_TIME_IS_VALID (best_time)
-            && time < best_time)) {
-      best = cpad;
-      best_time = time;
-    }
+  best = (GstFlvPad *) cdata;
+  if (best) {
+    g_assert (buffer);
+    best_time = GST_BUFFER_TIMESTAMP (buffer);
+  } else {
+    best_time = GST_CLOCK_TIME_NONE;
   }
 
   /* The FLV timestamp is an int32 field. For non-live streams error out if a
@@ -1488,17 +1465,17 @@ gst_flv_mux_collected (GstCollectPads * pads, gpointer user_data)
   if (!mux->streamable && GST_CLOCK_TIME_IS_VALID (best_time)
       && best_time / GST_MSECOND > G_MAXINT32) {
     GST_WARNING_OBJECT (mux, "Timestamp larger than FLV supports - EOS");
-    eos = TRUE;
+    gst_buffer_unref (buffer);
+    buffer = NULL;
+    best = NULL;
   }
 
-  if (!eos && best) {
-    return gst_flv_mux_write_buffer (mux, best);
-  } else if (eos) {
+  if (best) {
+    return gst_flv_mux_write_buffer (mux, best, buffer);
+  } else {
     gst_flv_mux_rewrite_header (mux);
     gst_pad_push_event (mux->srcpad, gst_event_new_eos ());
     return GST_FLOW_UNEXPECTED;
-  } else {
-    return GST_FLOW_OK;
   }
 }
 
@@ -1550,12 +1527,12 @@ gst_flv_mux_change_state (GstElement * element, GstStateChange transition)
     case GST_STATE_CHANGE_NULL_TO_READY:
       break;
     case GST_STATE_CHANGE_READY_TO_PAUSED:
-      gst_collect_pads_start (mux->collect);
+      gst_collect_pads2_start (mux->collect);
       break;
     case GST_STATE_CHANGE_PAUSED_TO_PLAYING:
       break;
     case GST_STATE_CHANGE_PAUSED_TO_READY:
-      gst_collect_pads_stop (mux->collect);
+      gst_collect_pads2_stop (mux->collect);
       break;
     default:
       break;
diff --git a/gst/flv/gstflvmux.h b/gst/flv/gstflvmux.h
index fff51b9..b0e10ea 100644
--- a/gst/flv/gstflvmux.h
+++ b/gst/flv/gstflvmux.h
@@ -22,7 +22,7 @@
 #define __GST_FLV_MUX_H__
 
 #include <gst/gst.h>
-#include <gst/base/gstcollectpads.h>
+#include <gst/base/gstcollectpads2.h>
 
 G_BEGIN_DECLS
 
@@ -39,7 +39,7 @@ G_BEGIN_DECLS
 
 typedef struct
 {
-  GstCollectData collect;
+  GstCollectData2 collect;
 
   gboolean video;
 
@@ -65,11 +65,9 @@ typedef struct _GstFlvMux {
   GstElement     element;
 
   GstPad         *srcpad;
-  GstCollectPads *collect;
+  GstCollectPads2 *collect;
 
   /* <private> */
-  GstPadEventFunction collect_event;
-
   GstFlvMuxState state;
   gboolean have_audio;
   gboolean have_video;
diff --git a/gst/flx/Makefile.in b/gst/flx/Makefile.in
index 3197a98..84e008d 100644
--- a/gst/flx/Makefile.in
+++ b/gst/flx/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/flx
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -119,10 +135,23 @@ libgstflxdec_la_OBJECTS = $(am_libgstflxdec_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstflxdec_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstflxdec_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstflxdec_la_CFLAGS) $(CFLAGS) \
 	$(libgstflxdec_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -135,22 +164,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstflxdec_la_SOURCES)
 DIST_SOURCES = $(libgstflxdec_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -210,6 +240,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -258,8 +289,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -340,7 +373,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -400,6 +433,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -473,7 +507,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -520,7 +558,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -528,6 +565,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -543,12 +582,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstflxdec.la: $(libgstflxdec_la_OBJECTS) $(libgstflxdec_la_DEPENDENCIES) $(EXTRA_libgstflxdec_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstflxdec_la_LINK) -rpath $(plugindir) $(libgstflxdec_la_OBJECTS) $(libgstflxdec_la_LIBADD) $(LIBS)
 
@@ -651,6 +692,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -795,18 +850,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/goom/Makefile.in b/gst/goom/Makefile.in
index 159fa32..17ee8d1 100644
--- a/gst/goom/Makefile.in
+++ b/gst/goom/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,14 +50,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/goom
-DIST_COMMON = README $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = README $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -138,10 +155,23 @@ libgstgoom_la_OBJECTS = $(am_libgstgoom_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstgoom_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstgoom_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstgoom_la_CFLAGS) $(CFLAGS) \
 	$(libgstgoom_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -154,22 +184,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstgoom_la_SOURCES)
 DIST_SOURCES = $(am__libgstgoom_la_SOURCES_DIST)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -228,6 +259,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -276,8 +308,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -358,7 +392,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -418,6 +452,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -491,7 +526,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -566,7 +605,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -574,6 +612,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -589,12 +629,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstgoom.la: $(libgstgoom_la_OBJECTS) $(libgstgoom_la_DEPENDENCIES) $(EXTRA_libgstgoom_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstgoom_la_LINK) -rpath $(plugindir) $(libgstgoom_la_OBJECTS) $(libgstgoom_la_LIBADD) $(LIBS)
 
@@ -833,6 +875,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -977,18 +1033,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 .NOTPARALLEL:
diff --git a/gst/goom/filters_mmx.s b/gst/goom/filters_mmx.s
new file mode 100644
index 0000000..964b5a6
--- /dev/null
+++ b/gst/goom/filters_mmx.s
@@ -0,0 +1,216 @@
+; Goom Project
+; Copyright (C) <2001> Jean-Christophe Hoelt <jeko@free.fr>
+;
+; This library is free software; you can redistribute it and/or
+; modify it under the terms of the GNU Library General Public
+; License as published by the Free Software Foundation; either
+; version 2 of the License, or (at your option) any later version.
+;
+; This library is distributed in the hope that it will be useful,
+; but WITHOUT ANY WARRANTY; without even the implied warranty of
+; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+; Library General Public License for more details.
+;
+; You should have received a copy of the GNU Library General Public
+; License along with this library; if not, write to the
+; Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+; Boston, MA 02111-1307, USA.
+;
+;//
+;// history
+;// 07/01/2001 : Changing FEMMS to EMMS : slower... but run on intel machines
+;//	03/01/2001 : WIDTH and HEIGHT are now variable
+;//	28/12/2000 : adding comments to the code, suppress some useless lines
+;//	27/12/2000 : reducing memory access... improving performance by 20%
+;//		coefficients are now on 1 byte
+;//	22/12/2000 : Changing data structure
+;//	16/12/2000 : AT&T version
+;//	14/12/2000 : unrolling loop
+;//	12/12/2000 : 64 bits memory access
+
+
+.data
+
+chaine:
+	.string	"pos = %d\n\0"
+	.long 0x0
+		
+thezero:
+	.long 0x00000000
+	.long 0x00000000
+
+.text
+
+.globl mmx_zoom		;// name of the function to call by C program
+/* .extern coeffs		;// the transformation buffer */
+.extern expix1,expix2 ;// the source and destination buffer
+.extern mmx_zoom_size, zoom_width ;// size of the buffers
+
+.extern brutS,brutD,buffratio,precalCoef,prevX,prevY
+
+#define PERTEMASK 15
+/* faire : a / sqrtperte <=> a >> PERTEDEC*/
+#define PERTEDEC 4
+
+.align 16
+mmx_zoom:
+
+		pushl %ebp
+		movl %esp,%ebp
+		subl $12,%esp
+
+		movl prevX,%eax
+		decl %eax
+		sarl $4,%eax
+		movl %eax,-4(%ebp)
+
+		movl prevY,%eax
+		decl %eax
+		sarl $4,%eax
+		movl %eax,-8(%ebp)
+
+;// initialisation du mm7 � zero
+		movq (thezero), %mm7
+
+movl mmx_zoom_size, %ecx
+decl %ecx
+
+.while:
+	;// esi <- nouvelle position
+	movl brutS, %eax
+	leal (%eax, %ecx, 8),%eax
+
+	movl (%eax),%edx /* = brutS.px (brutSmypos) */
+	movl 4(%eax),%eax /* = brutS.py */
+
+	movl brutD,%ebx
+	leal (%ebx, %ecx, 8),%ebx
+	movl (%ebx),%esi
+	subl %edx, %esi
+	imull buffratio,%esi
+	sarl $16,%esi
+	addl %edx,%esi /* esi = px */
+
+	/* eax contient deja brutS.py = le nouveau brutSmypos*/
+	/* ebx pointe sur brutD[myPos] */
+	movl 4(%ebx),%edi
+	subl %eax,%edi
+	imull buffratio,%edi
+	sarl $16,%edi
+	addl %eax,%edi /* edi = py */
+
+/*		pushl %eax
+		pushl %ebx*/
+/*		popl %ebx
+		popl %eax*/
+		
+	movl %esi,%eax
+	andl $15,%eax /* eax = coefh */
+	movl %edi,%ebx
+	andl $15,%ebx /* ebx = coefv */
+
+	leal 0(,%ebx,4),%ebx
+	sall $6,%eax
+	addl %ebx,%eax
+	movl $precalCoef,%ebx
+/*	movd (%eax,%ebx),%mm6*/ /* mm6 = coeffs */
+
+	cmpl -8(%ebp),%edi
+	jge .then1
+	cmpl -4(%ebp),%esi
+	jge .then1
+
+	sarl $4,%esi
+	sarl $4,%edi
+	imull zoom_width,%edi
+	leal (%esi,%edi),%esi
+	jmp .finsi1
+
+.then1:
+	movl $0,%esi
+.finsi1:
+
+	/** apres ce calcul, %esi = pos, %mm6 = coeffs **/
+/*	pushl %esi
+	pushl $chaine
+	call printf
+	addl $8,%esp*/
+
+	movl expix1,%eax
+
+	;// recuperation des deux premiers pixels dans mm0 et mm1
+/*	movq (%eax,%esi,4), %mm0		/* b1-v1-r1-a1-b2-v2-r2-a2 */
+	movq %mm0, %mm1				/* b1-v1-r1-a1-b2-v2-r2-a2 */
+
+	;// depackage du premier pixel
+	punpcklbw %mm7, %mm0	/* 00-b2-00-v2-00-r2-00-a2 */
+
+	movq %mm6, %mm5			/* ??-??-??-??-c4-c3-c2-c1 */
+	;// depackage du 2ieme pixel
+	punpckhbw %mm7, %mm1	/* 00-b1-00-v1-00-r1-00-a1 */
+
+	;// extraction des coefficients...
+	punpcklbw %mm5, %mm6	/* c4-c4-c3-c3-c2-c2-c1-c1 */
+	movq %mm6, %mm4			/* c4-c4-c3-c3-c2-c2-c1-c1 */
+	movq %mm6, %mm5			/* c4-c4-c3-c3-c2-c2-c1-c1 */
+
+	punpcklbw %mm5, %mm6	/* c2-c2-c2-c2-c1-c1-c1-c1 */
+	punpckhbw %mm5, %mm4	/* c4-c4-c4-c4-c3-c3-c3-c3 */
+
+	movq %mm6, %mm3			/* c2-c2-c2-c2-c1-c1-c1-c1 */
+	punpcklbw %mm7, %mm6	/* 00-c1-00-c1-00-c1-00-c1 */
+	punpckhbw %mm7, %mm3	/* 00-c2-00-c2-00-c2-00-c2 */
+	
+	;// multiplication des pixels par les coefficients
+	pmullw %mm6, %mm0		/* c1*b2-c1*v2-c1*r2-c1*a2 */
+	pmullw %mm3, %mm1		/* c2*b1-c2*v1-c2*r1-c2*a1 */
+	paddw %mm1, %mm0
+	
+	;// ...extraction des 2 derniers coefficients
+	movq %mm4, %mm5			/* c4-c4-c4-c4-c3-c3-c3-c3 */
+	punpcklbw %mm7, %mm4	/* 00-c3-00-c3-00-c3-00-c3 */
+	punpckhbw %mm7, %mm5	/* 00-c4-00-c4-00-c4-00-c4 */
+
+	/* ajouter la longueur de ligne a esi */
+	addl prevX,%esi
+		
+	;// recuperation des 2 derniers pixels
+/*	movq (%eax,%esi,4), %mm1*/
+	movq %mm1, %mm2
+	
+	;// depackage des pixels
+	punpcklbw %mm7, %mm1
+	punpckhbw %mm7, %mm2
+	
+	;// multiplication pas les coeffs
+	pmullw %mm4, %mm1
+	pmullw %mm5, %mm2
+	
+	;// ajout des valeurs obtenues � la valeur finale
+	paddw %mm1, %mm0
+	paddw %mm2, %mm0
+
+	;// division par 256 = 16+16+16+16, puis repackage du pixel final
+	psrlw $8, %mm0
+	packuswb %mm7, %mm0
+	
+	;// passage au suivant
+
+	;// enregistrement du resultat
+	movl expix2,%eax
+/*	movd %mm0,(%eax,%ecx,4)*/
+
+	decl %ecx
+	;// test de fin du tantque
+	cmpl $0, %ecx				;// 400x300
+
+	jz .fin_while
+	jmp .while
+
+.fin_while:
+	emms
+
+	movl %ebp,%esp
+	popl %ebp
+
+	ret                  ;//The End
diff --git a/gst/goom/goomsl_lex.l b/gst/goom/goomsl_lex.l
new file mode 100644
index 0000000..7a7de29
--- /dev/null
+++ b/gst/goom/goomsl_lex.l
@@ -0,0 +1,94 @@
+%{
+
+#include <math.h>
+#include <stdlib.h>
+#include <string.h>
+#include "goomsl.h"
+#include "goomsl_private.h"
+#include "goomsl_yacc.h"
+void yyerror(char *);
+void yyparse(void);
+
+GoomSL *currentGoomSL;
+static int  string_size;
+static char string[1024];
+%}
+
+DIGIT    [0-9]
+XDIGIT   [0-9a-f]
+ID       [a-zA-Z_@&][a-zA-Z0-9_\.]*
+
+%S C_COMMENT
+%S LINE_COMMENT
+%S STRING
+
+%%
+
+<LINE_COMMENT,C_COMMENT,INITIAL>^[ \t]*\n           { ++currentGoomSL->num_lines; /* Ignore empty lines */ }
+<LINE_COMMENT,C_COMMENT,INITIAL>^[ \t]*"//"[^\n]*\n { ++currentGoomSL->num_lines; /* Ignore empty lines */ }
+
+<LINE_COMMENT>\n    { ++currentGoomSL->num_lines; yylval.charValue=*yytext; BEGIN INITIAL; return '\n'; }
+<INITIAL>\n         { ++currentGoomSL->num_lines; yylval.charValue=*yytext; return '\n'; }
+
+<C_COMMENT>"*/"                { BEGIN INITIAL; }
+<C_COMMENT>\n                  { ++currentGoomSL->num_lines; }
+<C_COMMENT,LINE_COMMENT>.      { /* eat up comment */ }
+
+<INITIAL>"#RST_LINE#"             { currentGoomSL->num_lines = 0; }
+<INITIAL>"#FILE ".*"#"            { currentGoomSL->num_lines = 0; /* printf("%s\n", yytext); */ }
+<INITIAL>"#"[^\n]*                { /* ignore preprocessor lines */ }
+
+<INITIAL>"/*"                { BEGIN C_COMMENT; }
+<INITIAL>"//"                { BEGIN LINE_COMMENT; }
+<INITIAL>\"                  { BEGIN STRING; string_size=0; }
+
+<STRING>"\\n"                { string[string_size++] = '\n'; }
+<STRING>"\\\""               { string[string_size++] = '\"'; }
+<STRING>\"                   { /* fin de la chaine: on cree le pointeur qui va bien */
+                               unsigned int tmp;
+                               BEGIN INITIAL;
+                               string[string_size]=0;
+                               tmp = gsl_malloc(currentGoomSL, string_size+1);
+                               strcpy((char*)currentGoomSL->ptrArray[tmp],string);
+                               sprintf(yylval.strValue, "0x%08x", tmp);
+                               return LTYPE_PTR;
+                             }
+<STRING>.                    { string[string_size++] = *yytext; }
+
+<INITIAL>"float"                 { return FLOAT_TK; }
+<INITIAL>"int"                   { return INT_TK;   }
+<INITIAL>"boolean"               { return INT_TK;   }
+<INITIAL>"ptr"                   { return PTR_TK;   }
+<INITIAL>"string"                { return PTR_TK;   }
+<INITIAL>"declare"               { return DECLARE;  }
+<INITIAL>"external"              { return EXTERNAL; }
+<INITIAL>"struct"                { return STRUCT;   }
+<INITIAL>"not"                   { return NOT;      }
+<INITIAL>"while"                 { return WHILE;    } 
+<INITIAL>"do"                    { return DO;       }
+<INITIAL>"for"                   { return FOR;      }
+<INITIAL>"in"                    { return IN;       }
+<INITIAL>"true"                  { strncpy(yylval.strValue, "1", 2047);    return LTYPE_INTEGER; }
+<INITIAL>"false"                 { strncpy(yylval.strValue, "0", 2047);    return LTYPE_INTEGER; }
+<INITIAL>{ID}                    { strncpy(yylval.strValue, yytext, 2047); return LTYPE_VAR;     }
+<INITIAL>{DIGIT}+                { strncpy(yylval.strValue, yytext, 2047); return LTYPE_INTEGER; }
+<INITIAL>\'.\'                   { sprintf(yylval.strValue, "%d", (int)yytext[1]); return LTYPE_INTEGER; }
+<INITIAL>"0x"{XDIGIT}+           { strncpy(yylval.strValue, yytext, 2047); return LTYPE_INTEGER; }
+<INITIAL>{DIGIT}+"."{DIGIT}*     { strncpy(yylval.strValue, yytext, 2047); return LTYPE_FLOAT;   }
+<INITIAL>{DIGIT}+"%"             { sprintf(yylval.strValue, "%3.2f", atof(yytext)/100.0f); return LTYPE_FLOAT; }
+<INITIAL>"+="                    { return PLUS_EQ; }
+<INITIAL>"*="                    { return MUL_EQ; }
+<INITIAL>"-="                    { return SUB_EQ; }
+<INITIAL>"/="                    { return DIV_EQ; }
+<INITIAL>"<="                    { return LOW_EQ;  }
+<INITIAL>">="                    { return SUP_EQ;  }
+<INITIAL>"!="                    { return NOT_EQ;  }
+<INITIAL>"<>"                    { return NOT_EQ;  }
+<INITIAL>[ \t]+                  /* eat up whitespace */
+<INITIAL>.                       { yylval.charValue = *yytext; return *yytext;    }
+
+%%
+
+
+int yywrap(void) { return 1; yyunput(0,0); }
+
diff --git a/gst/goom/goomsl_yacc.y b/gst/goom/goomsl_yacc.y
new file mode 100644
index 0000000..078933c
--- /dev/null
+++ b/gst/goom/goomsl_yacc.y
@@ -0,0 +1,1438 @@
+/**
+ * copyright 2004, Jean-Christophe Hoelt <jeko@ios-software.com>
+ *
+ * This program is released under the terms of the GNU Lesser General Public Licence.
+ */
+%{
+    #include <stdio.h>
+    #include <stdlib.h>
+    #include <string.h>
+    #include <glib.h>
+    #include "goomsl.h"
+    #include "goomsl_private.h"
+
+#define STRUCT_ALIGNMENT 16
+/* #define VERBOSE  */
+
+    int yylex(void);
+    void yyerror(char *);
+    extern GoomSL *currentGoomSL;
+
+    static NodeType *nodeNew(const char *str, int type, int line_number);
+    static NodeType *nodeClone(NodeType *node);
+    static void nodeFreeInternals(NodeType *node);
+    static void nodeFree(NodeType *node);
+
+    static void commit_node(NodeType *node, int releaseIfTemp);
+    static void precommit_node(NodeType *node);
+
+    static NodeType *new_constInt(const char *str, int line_number);
+    static NodeType *new_constFloat(const char *str, int line_number);
+    static NodeType *new_constPtr(const char *str, int line_number);
+    static NodeType *new_var(const char *str, int line_number);
+    static NodeType *new_nop(const char *str);
+    static NodeType *new_op(const char *str, int type, int nbOp);
+
+    static int  allocateLabel();
+    static int  allocateTemp();
+    static void releaseTemp(int n);
+    static void releaseAllTemps();
+
+    static int is_tmp_expr(NodeType *node) {
+        if (node->str) {
+            return (!strncmp(node->str,"_i_tmp_",7))
+              || (!strncmp(node->str,"_f_tmp_",7))
+              || (!strncmp(node->str,"_p_tmp",7));
+        }
+        return 0;
+    }
+    /* pre: is_tmp_expr(node); */
+    static int get_tmp_id(NodeType *node)  { return atoi((node->str)+5); }
+
+    static int is_commutative_expr(int itype)
+    { /* {{{ */
+        return (itype == INSTR_ADD)
+            || (itype == INSTR_MUL)
+            || (itype == INSTR_ISEQUAL);
+    } /* }}} */
+
+    static void GSL_PUT_LABEL(char *name, int line_number)
+    { /* {{{ */
+#ifdef VERBOSE
+      printf("label %s\n", name);
+#endif
+      currentGoomSL->instr = gsl_instr_init(currentGoomSL, "label", INSTR_LABEL, 1, line_number);
+      gsl_instr_add_param(currentGoomSL->instr, name, TYPE_LABEL);
+    } /* }}} */
+    static void GSL_PUT_JUMP(char *name, int line_number)
+    { /* {{{ */
+#ifdef VERBOSE
+      printf("jump %s\n", name);
+#endif
+      currentGoomSL->instr = gsl_instr_init(currentGoomSL, "jump", INSTR_JUMP, 1, line_number);
+      gsl_instr_add_param(currentGoomSL->instr, name, TYPE_LABEL);
+    } /* }}} */
+
+    static void GSL_PUT_JXXX(char *name, char *iname, int instr_id, int line_number)
+    { /* {{{ */
+#ifdef VERBOSE
+      printf("%s %s\n", iname, name);
+#endif
+      currentGoomSL->instr = gsl_instr_init(currentGoomSL, iname, instr_id, 1, line_number);
+      gsl_instr_add_param(currentGoomSL->instr, name, TYPE_LABEL);
+    } /* }}} */
+    static void GSL_PUT_JZERO(char *name,int line_number)
+    { /* {{{ */
+      GSL_PUT_JXXX(name,"jzero.i",INSTR_JZERO,line_number);
+    } /* }}} */
+    static void GSL_PUT_JNZERO(char *name, int line_number)
+    { /* {{{ */
+      GSL_PUT_JXXX(name,"jnzero.i",INSTR_JNZERO,line_number);
+    } /* }}} */
+
+    /* Structures Management */
+
+#define ALIGN_ADDR(_addr,_align) {\
+   if (_align>1) {\
+       int _dec = (_addr%_align);\
+       if (_dec != 0) _addr += _align - _dec;\
+   }}
+
+    /* */
+    void gsl_prepare_struct(GSL_Struct *s, int s_align, int i_align, int f_align)
+    {
+      int i;
+      int consumed = 0;
+      int iblk=0, fblk=0;
+
+      s->iBlock[0].size = 0;
+      s->iBlock[0].data = 0;
+      s->fBlock[0].size = 0;
+      s->fBlock[0].data = 0;
+
+      /* Prepare sub-struct and calculate space needed for their storage */
+      for (i = 0; i < s->nbFields; ++i)
+      {
+        if (s->fields[i]->type < FIRST_RESERVED)
+        {
+          int j=0;
+          GSL_Struct *substruct = currentGoomSL->gsl_struct[s->fields[i]->type];
+          consumed += sizeof(int); /* stocke le prefix */
+          ALIGN_ADDR(consumed, s_align);
+          s->fields[i]->offsetInStruct = consumed;
+          gsl_prepare_struct(substruct, s_align, i_align, f_align);
+          for(j=0;substruct->iBlock[j].size>0;++j) {
+            s->iBlock[iblk].data = consumed + substruct->iBlock[j].data;
+            s->iBlock[iblk].size = substruct->iBlock[j].size;
+            iblk++;
+          }
+          for(j=0;substruct->fBlock[j].size>0;++j) {
+            s->fBlock[fblk].data = consumed + substruct->fBlock[j].data;
+            s->fBlock[fblk].size = substruct->fBlock[j].size;
+            fblk++;
+          }
+          consumed += substruct->size;
+        }
+      }
+
+      /* Then prepare integers */
+      ALIGN_ADDR(consumed, i_align);
+      for (i = 0; i < s->nbFields; ++i)
+      {
+        if (s->fields[i]->type == INSTR_INT)
+        {
+          if (s->iBlock[iblk].size == 0) {
+            s->iBlock[iblk].size = 1;
+            s->iBlock[iblk].data = consumed;
+          } else {
+            s->iBlock[iblk].size += 1;
+          }
+          s->fields[i]->offsetInStruct = consumed;
+          consumed += sizeof(int);
+        }
+      }
+
+      iblk++;
+      s->iBlock[iblk].size = 0;
+      s->iBlock[iblk].data = 0;
+
+      /* Then prepare floats */
+      ALIGN_ADDR(consumed, f_align);
+      for (i = 0; i < s->nbFields; ++i)
+      {
+        if (s->fields[i]->type == INSTR_FLOAT)
+        {
+          if (s->fBlock[fblk].size == 0) {
+            s->fBlock[fblk].size = 1;
+            s->fBlock[fblk].data = consumed;
+          } else {
+            s->fBlock[fblk].size += 1;
+          }
+          s->fields[i]->offsetInStruct = consumed;
+          consumed += sizeof(int);
+        }
+      }
+
+      fblk++;
+      s->fBlock[fblk].size = 0;
+      s->fBlock[fblk].data = 0;
+      
+      /* Finally prepare pointers */
+      ALIGN_ADDR(consumed, i_align);
+      for (i = 0; i < s->nbFields; ++i)
+      {
+        if (s->fields[i]->type == INSTR_PTR)
+        {
+          s->fields[i]->offsetInStruct = consumed;
+          consumed += sizeof(int);
+        }
+      }
+      s->size = consumed;
+    }
+
+    /* Returns the ID of a struct from its name */
+    int gsl_get_struct_id(const char *name) /* {{{ */
+    {
+      HashValue *ret = goom_hash_get(currentGoomSL->structIDS, name);
+      if (ret != NULL) return ret->i;
+      return -1;
+    } /* }}} */
+
+    /* Adds the definition of a struct */
+    void gsl_add_struct(const char *name, GSL_Struct *gsl_struct) /* {{{ */
+    {
+      /* Prepare the struct: ie calculate internal storage format */
+      gsl_prepare_struct(gsl_struct, STRUCT_ALIGNMENT, STRUCT_ALIGNMENT, STRUCT_ALIGNMENT);
+      
+      /* If the struct does not already exists */
+      if (gsl_get_struct_id(name) < 0)
+      {
+        /* adds it */
+        int id = currentGoomSL->nbStructID++;
+        goom_hash_put_int(currentGoomSL->structIDS, name, id);
+        if (currentGoomSL->gsl_struct_size <= id) {
+          currentGoomSL->gsl_struct_size *= 2;
+          currentGoomSL->gsl_struct = (GSL_Struct**)realloc(currentGoomSL->gsl_struct,
+                                                            sizeof(GSL_Struct*) * currentGoomSL->gsl_struct_size);
+        }
+        currentGoomSL->gsl_struct[id] = gsl_struct;
+      }
+    } /* }}} */
+    
+    /* Creates a field for a struct */
+    GSL_StructField *gsl_new_struct_field(const char *name, int type)
+    {
+      GSL_StructField *field = (GSL_StructField*)malloc(sizeof(GSL_StructField));
+      strcpy(field->name, name);
+      field->type = type;
+      return field;
+    }
+    
+    /* Create as field for a struct which will be a struct itself */
+    GSL_StructField *gsl_new_struct_field_struct(const char *name, const char *type)
+    {
+      GSL_StructField *field = gsl_new_struct_field(name, gsl_get_struct_id(type));
+      if (field->type < 0) {
+        g_assert_not_reached ();
+#if 0
+        fprintf(stderr, "ERROR: Line %d, Unknown structure: '%s'\n",
+                currentGoomSL->num_lines, type);
+        exit(1);
+#endif
+      }
+      return field;
+    }
+
+    /* Creates a Struct */
+    GSL_Struct *gsl_new_struct(GSL_StructField *field)
+    {
+      GSL_Struct *s = (GSL_Struct*)malloc(sizeof(GSL_Struct));
+      s->nbFields = 1;
+      s->fields[0] = field;
+      return s;
+    }
+
+    /* Adds a field to a struct */
+    void gsl_add_struct_field(GSL_Struct *s, GSL_StructField *field)
+    {
+      s->fields[s->nbFields++] = field;
+    }
+
+    int gsl_type_of_var(GoomHash *ns, const char *name)
+    {
+        char type_of[256];
+        HashValue *hv;
+        sprintf(type_of, "__type_of_%s", name);
+        hv = goom_hash_get(ns, type_of);
+        if (hv != NULL)
+          return hv->i;
+        fprintf(stderr, "ERROR: Unknown variable type: '%s'\n", name);
+        return -1;
+    }
+
+    static void gsl_declare_var(GoomHash *ns, const char *name, int type, void *space)
+    {
+        char type_of[256];
+        if (name[0] == '@') { ns = currentGoomSL->vars; }
+
+        if (space == NULL) {
+          switch (type) {
+            case INSTR_INT:
+            case INSTR_FLOAT:
+            case INSTR_PTR:
+              space = goom_heap_malloc_with_alignment(currentGoomSL->data_heap,
+                  sizeof(int), sizeof(int));
+            break;
+#if 0
+            case -1:
+              fprintf(stderr, "What the fuck!\n");
+              exit(1);
+#endif
+            default: /* On a un struct_id */
+              space = goom_heap_malloc_with_alignment_prefixed(currentGoomSL->data_heap,
+                  currentGoomSL->gsl_struct[type]->size, STRUCT_ALIGNMENT, sizeof(int));
+          }
+        }
+        goom_hash_put_ptr(ns, name, (void*)space);
+        sprintf(type_of, "__type_of_%s", name);
+        goom_hash_put_int(ns, type_of, type);
+
+        /* Ensuite le hack: on ajoute les champs en tant que variables. */
+        if (type < FIRST_RESERVED)
+        {
+          int i;
+          GSL_Struct *gsl_struct = currentGoomSL->gsl_struct[type];
+          ((int*)space)[-1] = type; /* stockage du type dans le prefixe de structure */
+          for (i = 0; i < gsl_struct->nbFields; ++i)
+          {
+            char full_name[256];
+            char *cspace = (char*)space + gsl_struct->fields[i]->offsetInStruct;
+            sprintf(full_name, "%s.%s", name, gsl_struct->fields[i]->name);
+            gsl_declare_var(ns, full_name, gsl_struct->fields[i]->type, cspace);
+          }
+       }
+    }
+    
+    /* Declare a variable which will be a struct */
+    static void gsl_struct_decl(GoomHash *namespace, const char *struct_name, const char *name)
+    {
+        int  struct_id = gsl_get_struct_id(struct_name);
+        gsl_declare_var(namespace, name, struct_id, NULL);
+    }
+
+    static void gsl_float_decl_global(const char *name)
+    {
+        gsl_declare_var(currentGoomSL->vars, name, INSTR_FLOAT, NULL);
+    }
+    static void gsl_int_decl_global(const char *name)
+    {
+        gsl_declare_var(currentGoomSL->vars, name, INSTR_INT, NULL);
+    }
+    static void gsl_ptr_decl_global(const char *name)
+    {
+        gsl_declare_var(currentGoomSL->vars, name, INSTR_PTR, NULL);
+    }
+    static void gsl_struct_decl_global_from_id(const char *name, int id)
+    {
+        gsl_declare_var(currentGoomSL->vars, name, id, NULL);
+    }
+    
+    /* FLOAT */
+    static void gsl_float_decl_local(const char *name)
+    {
+        gsl_declare_var(currentGoomSL->namespaces[currentGoomSL->currentNS], name, INSTR_FLOAT, NULL);
+    }
+    /* INT */
+    static void gsl_int_decl_local(const char *name)
+    {
+        gsl_declare_var(currentGoomSL->namespaces[currentGoomSL->currentNS], name, INSTR_INT, NULL);
+    }
+    /* PTR */
+    static void gsl_ptr_decl_local(const char *name)
+    {
+        gsl_declare_var(currentGoomSL->namespaces[currentGoomSL->currentNS], name, INSTR_PTR, NULL);
+    }
+    /* STRUCT */
+    static void gsl_struct_decl_local(const char *struct_name, const char *name)
+    {
+        gsl_struct_decl(currentGoomSL->namespaces[currentGoomSL->currentNS],struct_name,name);
+    }
+
+
+    static void commit_test2(NodeType *set,const char *type, int instr);
+    static NodeType *new_call(const char *name, NodeType *affect_list);
+
+    /* SETTER */
+    static NodeType *new_set(NodeType *lvalue, NodeType *expression)
+    { /* {{{ */
+        NodeType *set = new_op("set", OPR_SET, 2);
+        set->unode.opr.op[0] = lvalue;
+        set->unode.opr.op[1] = expression;
+        return set;
+    } /* }}} */
+    static void commit_set(NodeType *set)
+    { /* {{{ */
+      commit_test2(set,"set",INSTR_SET);
+    } /* }}} */
+
+    /* PLUS_EQ */
+    static NodeType *new_plus_eq(NodeType *lvalue, NodeType *expression) /* {{{ */
+    {
+        NodeType *set = new_op("plus_eq", OPR_PLUS_EQ, 2);
+        set->unode.opr.op[0] = lvalue;
+        set->unode.opr.op[1] = expression;
+        return set;
+    }
+    static void commit_plus_eq(NodeType *set)
+    {
+        precommit_node(set->unode.opr.op[1]);
+#ifdef VERBOSE
+        printf("add %s %s\n", set->unode.opr.op[0]->str, set->unode.opr.op[1]->str);
+#endif
+        currentGoomSL->instr = gsl_instr_init(currentGoomSL, "add", INSTR_ADD, 2, set->line_number);
+        commit_node(set->unode.opr.op[0],0);
+        commit_node(set->unode.opr.op[1],1);
+    } /* }}} */
+
+    /* SUB_EQ */
+    static NodeType *new_sub_eq(NodeType *lvalue, NodeType *expression) /* {{{ */
+    {
+        NodeType *set = new_op("sub_eq", OPR_SUB_EQ, 2);
+        set->unode.opr.op[0] = lvalue;
+        set->unode.opr.op[1] = expression;
+        return set;
+    }
+    static void commit_sub_eq(NodeType *set)
+    {
+        precommit_node(set->unode.opr.op[1]);
+#ifdef VERBOSE
+        printf("sub %s %s\n", set->unode.opr.op[0]->str, set->unode.opr.op[1]->str);
+#endif
+        currentGoomSL->instr = gsl_instr_init(currentGoomSL, "sub", INSTR_SUB, 2, set->line_number);
+        commit_node(set->unode.opr.op[0],0);
+        commit_node(set->unode.opr.op[1],1);
+    } /* }}} */
+
+    /* MUL_EQ */
+    static NodeType *new_mul_eq(NodeType *lvalue, NodeType *expression) /* {{{ */
+    {
+        NodeType *set = new_op("mul_eq", OPR_MUL_EQ, 2);
+        set->unode.opr.op[0] = lvalue;
+        set->unode.opr.op[1] = expression;
+        return set;
+    }
+    static void commit_mul_eq(NodeType *set)
+    {
+        precommit_node(set->unode.opr.op[1]);
+#ifdef VERBOSE
+        printf("mul %s %s\n", set->unode.opr.op[0]->str, set->unode.opr.op[1]->str);
+#endif
+        currentGoomSL->instr = gsl_instr_init(currentGoomSL, "mul", INSTR_MUL, 2, set->line_number);
+        commit_node(set->unode.opr.op[0],0);
+        commit_node(set->unode.opr.op[1],1);
+    } /* }}} */
+
+    /* DIV_EQ */
+    static NodeType *new_div_eq(NodeType *lvalue, NodeType *expression) /* {{{ */
+    {
+        NodeType *set = new_op("div_eq", OPR_DIV_EQ, 2);
+        set->unode.opr.op[0] = lvalue;
+        set->unode.opr.op[1] = expression;
+        return set;
+    }
+    static void commit_div_eq(NodeType *set)
+    {
+        precommit_node(set->unode.opr.op[1]);
+#ifdef VERBOSE
+        printf("div %s %s\n", set->unode.opr.op[0]->str, set->unode.opr.op[1]->str);
+#endif
+        currentGoomSL->instr = gsl_instr_init(currentGoomSL, "div", INSTR_DIV, 2, set->line_number);
+        commit_node(set->unode.opr.op[0],0);
+        commit_node(set->unode.opr.op[1],1);
+    } /* }}} */
+
+    /* commodity method for add, mult, ... */
+
+    static void precommit_expr(NodeType *expr, const char *type, int instr_id)
+    { /* {{{ */
+        NodeType *tmp, *tmpcpy;
+        int toAdd;
+
+        /* compute "left" and "right" */
+        switch (expr->unode.opr.nbOp) {
+        case 2:
+          precommit_node(expr->unode.opr.op[1]);
+        case 1:
+          precommit_node(expr->unode.opr.op[0]);
+        }
+
+        if (is_tmp_expr(expr->unode.opr.op[0])) {
+            tmp = expr->unode.opr.op[0];
+            toAdd = 1;
+        }
+        else if (is_commutative_expr(instr_id) && (expr->unode.opr.nbOp==2) && is_tmp_expr(expr->unode.opr.op[1])) {
+            tmp = expr->unode.opr.op[1];
+            toAdd = 0;
+        }
+        else {
+            char stmp[256];
+            /* declare a temporary variable to store the result */
+            if (expr->unode.opr.op[0]->type == CONST_INT_NODE) {
+                sprintf(stmp,"_i_tmp_%i",allocateTemp());
+                gsl_int_decl_global(stmp);
+            }
+            else if (expr->unode.opr.op[0]->type == CONST_FLOAT_NODE) {
+                sprintf(stmp,"_f_tmp%i",allocateTemp());
+                gsl_float_decl_global(stmp);
+            }
+            else if (expr->unode.opr.op[0]->type == CONST_PTR_NODE) {
+                sprintf(stmp,"_p_tmp%i",allocateTemp());
+                gsl_ptr_decl_global(stmp);
+            }
+            else {
+                int type = gsl_type_of_var(expr->unode.opr.op[0]->vnamespace, expr->unode.opr.op[0]->str);
+                if (type == INSTR_FLOAT) {
+                    sprintf(stmp,"_f_tmp_%i",allocateTemp());
+                    gsl_float_decl_global(stmp);
+                }
+                else if (type == INSTR_PTR) {
+                    sprintf(stmp,"_p_tmp_%i",allocateTemp());
+                    gsl_ptr_decl_global(stmp);
+                }
+                else if (type == INSTR_INT) {
+                    sprintf(stmp,"_i_tmp_%i",allocateTemp());
+                    gsl_int_decl_global(stmp);
+                }
+                else if (type == -1) {
+                    g_assert_not_reached ();
+#if 0
+                    fprintf(stderr, "ERROR: Line %d, Could not find variable '%s'\n",
+                            expr->line_number, expr->unode.opr.op[0]->str);
+                    exit(1);
+#endif
+                }
+                else { /* type is a struct_id */
+                    sprintf(stmp,"_s_tmp_%i",allocateTemp());
+                    gsl_struct_decl_global_from_id(stmp,type);
+                }
+            }
+            tmp = new_var(stmp,expr->line_number);
+
+            /* set the tmp to the value of "op1" */
+            tmpcpy = nodeClone(tmp);
+            commit_node(new_set(tmp,expr->unode.opr.op[0]),0);
+            toAdd = 1;
+
+            tmp = tmpcpy;
+        }
+
+        /* add op2 to tmp */
+#ifdef VERBOSE
+        if (expr->unode.opr.nbOp == 2)
+          printf("%s %s %s\n", type, tmp->str, expr->unode.opr.op[toAdd]->str);
+        else
+          printf("%s %s\n", type, tmp->str);
+#endif
+        currentGoomSL->instr = gsl_instr_init(currentGoomSL, type, instr_id, expr->unode.opr.nbOp, expr->line_number);
+        tmpcpy = nodeClone(tmp);
+        commit_node(tmp,0);
+        if (expr->unode.opr.nbOp == 2) {
+          commit_node(expr->unode.opr.op[toAdd],1);
+        }
+    
+        /* redefine the ADD node now as the computed variable */
+        nodeFreeInternals(expr);
+        *expr = *tmpcpy;
+        free(tmpcpy);
+    } /* }}} */
+
+    static NodeType *new_expr1(const char *name, int id, NodeType *expr1)
+    { /* {{{ */
+        NodeType *add = new_op(name, id, 1);
+        add->unode.opr.op[0] = expr1;
+        return add;
+    } /* }}} */
+
+    static NodeType *new_expr2(const char *name, int id, NodeType *expr1, NodeType *expr2)
+    { /* {{{ */
+        NodeType *add = new_op(name, id, 2);
+        add->unode.opr.op[0] = expr1;
+        add->unode.opr.op[1] = expr2;
+        return add;
+    } /* }}} */
+
+    /* ADD */
+    static NodeType *new_add(NodeType *expr1, NodeType *expr2) { /* {{{ */
+        return new_expr2("add", OPR_ADD, expr1, expr2);
+    }
+    static void precommit_add(NodeType *add) {
+        precommit_expr(add,"add",INSTR_ADD);
+    } /* }}} */
+
+    /* SUB */
+    static NodeType *new_sub(NodeType *expr1, NodeType *expr2) { /* {{{ */
+        return new_expr2("sub", OPR_SUB, expr1, expr2);
+    }
+    static void precommit_sub(NodeType *sub) {
+        precommit_expr(sub,"sub",INSTR_SUB);
+    } /* }}} */
+
+    /* NEG */
+    static NodeType *new_neg(NodeType *expr) { /* {{{ */
+        NodeType *zeroConst = NULL;
+        if (expr->type == CONST_INT_NODE)
+          zeroConst = new_constInt("0", currentGoomSL->num_lines);
+        else if (expr->type == CONST_FLOAT_NODE)
+          zeroConst = new_constFloat("0.0", currentGoomSL->num_lines);
+        else if (expr->type == CONST_PTR_NODE) {
+          g_assert_not_reached ();
+#if 0
+          fprintf(stderr, "ERROR: Line %d, Could not negate const pointer.\n",
+            currentGoomSL->num_lines);
+          exit(1);
+#endif
+        }
+        else {
+            int type = gsl_type_of_var(expr->vnamespace, expr->str);
+            if (type == INSTR_FLOAT)
+              zeroConst = new_constFloat("0.0", currentGoomSL->num_lines);
+            else if (type == INSTR_PTR) {
+              g_assert_not_reached ();
+#if 0
+              fprintf(stderr, "ERROR: Line %d, Could not negate pointer.\n",
+                currentGoomSL->num_lines);
+              exit(1);
+#endif
+            }
+            else if (type == INSTR_INT)
+              zeroConst = new_constInt("0", currentGoomSL->num_lines);
+            else if (type == -1) {
+                g_assert_not_reached ();
+#if 0
+                fprintf(stderr, "ERROR: Line %d, Could not find variable '%s'\n",
+                        expr->line_number, expr->unode.opr.op[0]->str);
+                exit(1);
+#endif
+            }
+            else { /* type is a struct_id */
+                g_assert_not_reached ();
+#if 0
+                fprintf(stderr, "ERROR: Line %d, Could not negate struct '%s'\n",
+                        expr->line_number, expr->str);
+                exit(1);
+#endif
+            }
+        }
+        return new_expr2("sub", OPR_SUB, zeroConst, expr);
+    }
+    /* }}} */
+
+    /* MUL */
+    static NodeType *new_mul(NodeType *expr1, NodeType *expr2) { /* {{{ */
+        return new_expr2("mul", OPR_MUL, expr1, expr2);
+    }
+    static void precommit_mul(NodeType *mul) {
+        precommit_expr(mul,"mul",INSTR_MUL);
+    } /* }}} */
+    
+    /* DIV */
+    static NodeType *new_div(NodeType *expr1, NodeType *expr2) { /* {{{ */
+        return new_expr2("div", OPR_DIV, expr1, expr2);
+    }
+    static void precommit_div(NodeType *mul) {
+        precommit_expr(mul,"div",INSTR_DIV);
+    } /* }}} */
+
+    /* CALL EXPRESSION */
+    static NodeType *new_call_expr(const char *name, NodeType *affect_list) { /* {{{ */
+        NodeType *call = new_call(name,affect_list);
+        NodeType *node = new_expr1(name, OPR_CALL_EXPR, call);
+        node->vnamespace = gsl_find_namespace(name);
+        if (node->vnamespace == NULL)
+          /* fprintf(stderr, "ERROR: Line %d, No return type for: '%s'\n", currentGoomSL->num_lines, name); */
+        return node;
+    }
+    static void precommit_call_expr(NodeType *call) {
+        char stmp[256];
+        NodeType *tmp,*tmpcpy;
+        int type = gsl_type_of_var(call->vnamespace, call->str);
+        if (type == INSTR_FLOAT) {
+          sprintf(stmp,"_f_tmp_%i",allocateTemp());
+          gsl_float_decl_global(stmp);
+        }
+        else if (type == INSTR_PTR) {
+          sprintf(stmp,"_p_tmp_%i",allocateTemp());
+          gsl_ptr_decl_global(stmp);
+        }
+        else if (type == INSTR_INT) {
+          sprintf(stmp,"_i_tmp_%i",allocateTemp());
+          gsl_int_decl_global(stmp);
+        }
+        else if (type == -1) {
+          g_assert_not_reached ();
+#if 0
+          fprintf(stderr, "ERROR: Line %d, Could not find variable '%s'\n",
+                  call->line_number, call->str);
+          exit(1);
+#endif
+        }
+        else { /* type is a struct_id */
+          sprintf(stmp,"_s_tmp_%i",allocateTemp());
+          gsl_struct_decl_global_from_id(stmp,type);
+        }
+        tmp = new_var(stmp,call->line_number);
+        commit_node(call->unode.opr.op[0],0);
+        tmpcpy = nodeClone(tmp);
+        commit_node(new_set(tmp,new_var(call->str,call->line_number)),0);
+        
+        nodeFreeInternals(call);
+        *call = *tmpcpy;
+        free(tmpcpy);
+    } /* }}} */
+
+    static void commit_test2(NodeType *set,const char *type, int instr)
+    { /* {{{ */
+        NodeType *tmp;
+        char stmp[256];
+        precommit_node(set->unode.opr.op[0]);
+        precommit_node(set->unode.opr.op[1]);
+        tmp = set->unode.opr.op[0];
+        
+        stmp[0] = 0;
+        if (set->unode.opr.op[0]->type == CONST_INT_NODE) {
+            sprintf(stmp,"_i_tmp_%i",allocateTemp());
+            gsl_int_decl_global(stmp);
+        }
+        else if (set->unode.opr.op[0]->type == CONST_FLOAT_NODE) {
+            sprintf(stmp,"_f_tmp%i",allocateTemp());
+            gsl_float_decl_global(stmp);
+        }
+        else if (set->unode.opr.op[0]->type == CONST_PTR_NODE) {
+            sprintf(stmp,"_p_tmp%i",allocateTemp());
+            gsl_ptr_decl_global(stmp);
+        }
+        if (stmp[0]) {
+            NodeType *tmpcpy;
+            tmp = new_var(stmp, set->line_number);
+            tmpcpy = nodeClone(tmp);
+            commit_node(new_set(tmp,set->unode.opr.op[0]),0);
+            tmp = tmpcpy;
+        }
+
+#ifdef VERBOSE
+        printf("%s %s %s\n", type, tmp->str, set->unode.opr.op[1]->str);
+#endif
+        currentGoomSL->instr = gsl_instr_init(currentGoomSL, type, instr, 2, set->line_number);
+        commit_node(tmp,instr!=INSTR_SET);
+        commit_node(set->unode.opr.op[1],1);
+    } /* }}} */
+    
+    /* NOT */
+    static NodeType *new_not(NodeType *expr1) { /* {{{ */
+        return new_expr1("not", OPR_NOT, expr1);
+    }
+    static void commit_not(NodeType *set)
+    {
+        commit_node(set->unode.opr.op[0],0);
+#ifdef VERBOSE
+        printf("not\n");
+#endif
+        currentGoomSL->instr = gsl_instr_init(currentGoomSL, "not", INSTR_NOT, 1, set->line_number);
+        gsl_instr_add_param(currentGoomSL->instr, "|dummy|", TYPE_LABEL);
+    } /* }}} */
+    
+    /* EQU */
+    static NodeType *new_equ(NodeType *expr1, NodeType *expr2) { /* {{{ */
+        return new_expr2("isequal", OPR_EQU, expr1, expr2);
+    }
+    static void commit_equ(NodeType *mul) {
+        commit_test2(mul,"isequal",INSTR_ISEQUAL);
+    } /* }}} */
+    
+    /* INF */
+    static NodeType *new_low(NodeType *expr1, NodeType *expr2) { /* {{{ */
+        return new_expr2("islower", OPR_LOW, expr1, expr2);
+    }
+    static void commit_low(NodeType *mul) {
+        commit_test2(mul,"islower",INSTR_ISLOWER);
+    } /* }}} */
+
+    /* WHILE */
+    static NodeType *new_while(NodeType *expression, NodeType *instr) { /* {{{ */
+        NodeType *node = new_op("while", OPR_WHILE, 2);
+        node->unode.opr.op[0] = expression;
+        node->unode.opr.op[1] = instr;
+        return node;
+    }
+
+    static void commit_while(NodeType *node)
+    {
+        int lbl = allocateLabel();
+        char start_while[1024], test_while[1024];
+        sprintf(start_while, "|start_while_%d|", lbl);
+        sprintf(test_while, "|test_while_%d|", lbl);
+       
+        GSL_PUT_JUMP(test_while,node->line_number);
+        GSL_PUT_LABEL(start_while,node->line_number);
+
+        /* code */
+        commit_node(node->unode.opr.op[1],0);
+
+        GSL_PUT_LABEL(test_while,node->line_number);
+        commit_node(node->unode.opr.op[0],0);
+        GSL_PUT_JNZERO(start_while,node->line_number);
+    } /* }}} */
+
+    /* FOR EACH */
+    static NodeType *new_static_foreach(NodeType *var, NodeType *var_list, NodeType *instr) { /* {{{ */
+        NodeType *node = new_op("for", OPR_FOREACH, 3);
+        node->unode.opr.op[0] = var;
+        node->unode.opr.op[1] = var_list;
+        node->unode.opr.op[2] = instr;
+        node->line_number = currentGoomSL->num_lines;
+        return node;
+    }
+    static void commit_foreach(NodeType *node)
+    {
+        NodeType *cur = node->unode.opr.op[1];
+        char tmp_func[256], tmp_loop[256];
+        int lbl = allocateLabel();
+        sprintf(tmp_func, "|foreach_func_%d|", lbl);
+        sprintf(tmp_loop, "|foreach_loop_%d|", lbl);
+
+        GSL_PUT_JUMP(tmp_loop, node->line_number);
+        GSL_PUT_LABEL(tmp_func, node->line_number);
+
+        precommit_node(node->unode.opr.op[2]);
+        commit_node(node->unode.opr.op[2], 0);
+
+        currentGoomSL->instr = gsl_instr_init(currentGoomSL, "ret", INSTR_RET, 1, node->line_number);
+        gsl_instr_add_param(currentGoomSL->instr, "|dummy|", TYPE_LABEL);
+#ifdef VERBOSE
+        printf("ret\n");
+#endif
+        
+        GSL_PUT_LABEL(tmp_loop, node->line_number);
+        
+        while (cur != NULL)
+        {
+          NodeType *x, *var;
+
+          /* 1: x=var */
+          x   = nodeClone(node->unode.opr.op[0]);
+          var = nodeClone(cur->unode.opr.op[0]);
+          commit_node(new_set(x, var),0);
+          
+          /* 2: instr */
+          currentGoomSL->instr = gsl_instr_init(currentGoomSL, "call", INSTR_CALL, 1, node->line_number);
+          gsl_instr_add_param(currentGoomSL->instr, tmp_func, TYPE_LABEL);
+#ifdef VERBOSE
+          printf("call %s\n", tmp_func);
+#endif
+          
+          /* 3: var=x */
+          x   = nodeClone(node->unode.opr.op[0]);
+          var = cur->unode.opr.op[0];
+          commit_node(new_set(var, x),0);
+          cur = cur->unode.opr.op[1];
+        }
+        nodeFree(node->unode.opr.op[0]);
+    } /* }}} */
+
+    /* IF */
+    static NodeType *new_if(NodeType *expression, NodeType *instr) { /* {{{ */
+        NodeType *node = new_op("if", OPR_IF, 2);
+        node->unode.opr.op[0] = expression;
+        node->unode.opr.op[1] = instr;
+        return node;
+    }
+    static void commit_if(NodeType *node) {
+
+        char slab[1024];
+        sprintf(slab, "|eif%d|", allocateLabel());
+        commit_node(node->unode.opr.op[0],0);
+        GSL_PUT_JZERO(slab,node->line_number);
+        /* code */
+        commit_node(node->unode.opr.op[1],0);
+        GSL_PUT_LABEL(slab,node->line_number);
+    } /* }}} */
+
+    /* BLOCK */
+    static NodeType *new_block(NodeType *lastNode) { /* {{{ */
+        NodeType *blk = new_op("block", OPR_BLOCK, 2);
+        blk->unode.opr.op[0] = new_nop("start_of_block");
+        blk->unode.opr.op[1] = lastNode;        
+        return blk;
+    }
+    static void commit_block(NodeType *node) {
+        commit_node(node->unode.opr.op[0]->unode.opr.next,0);
+    } /* }}} */
+
+    /* FUNCTION INTRO */
+    static NodeType *new_function_intro(const char *name) { /* {{{ */
+        char stmp[256];
+        if (strlen(name) < 200) {
+           sprintf(stmp, "|__func_%s|", name);
+        }
+        return new_op(stmp, OPR_FUNC_INTRO, 0);
+    }
+    static void commit_function_intro(NodeType *node) {
+        currentGoomSL->instr = gsl_instr_init(currentGoomSL, "label", INSTR_LABEL, 1, node->line_number);
+        gsl_instr_add_param(currentGoomSL->instr, node->str, TYPE_LABEL);
+#ifdef VERBOSE
+        printf("label %s\n", node->str);
+#endif
+    } /* }}} */
+
+    /* FUNCTION OUTRO */
+    static NodeType *new_function_outro() { /* {{{ */
+        return new_op("ret", OPR_FUNC_OUTRO, 0);
+    }
+    static void commit_function_outro(NodeType *node) {
+        currentGoomSL->instr = gsl_instr_init(currentGoomSL, "ret", INSTR_RET, 1, node->line_number);
+        gsl_instr_add_param(currentGoomSL->instr, "|dummy|", TYPE_LABEL);
+        releaseAllTemps();
+#ifdef VERBOSE
+        printf("ret\n");
+#endif
+    } /* }}} */
+    
+    /* AFFECTATION LIST */
+    static NodeType *new_affec_list(NodeType *set, NodeType *next) /* {{{ */
+    {
+      NodeType *node = new_op("affect_list", OPR_AFFECT_LIST, 2);
+      node->unode.opr.op[0] = set;
+      node->unode.opr.op[1] = next;
+      return node;
+    }
+    static NodeType *new_affect_list_after(NodeType *affect_list)
+    {
+      NodeType *ret  = NULL;
+      NodeType *cur  =  affect_list;
+      while(cur != NULL) {
+        NodeType *set  = cur->unode.opr.op[0];
+        NodeType *next = cur->unode.opr.op[1];
+        NodeType *lvalue     = set->unode.opr.op[0];
+        NodeType *expression = set->unode.opr.op[1];
+        if ((lvalue->str[0] == '&') && (expression->type == VAR_NODE)) {
+          NodeType *nset = new_set(nodeClone(expression), nodeClone(lvalue));
+          ret  = new_affec_list(nset, ret);
+        }
+        cur = next;
+      }
+      return ret;
+    }
+    static void commit_affect_list(NodeType *node)
+    {
+      NodeType *cur = node;
+      while(cur != NULL) {
+        NodeType *set = cur->unode.opr.op[0];
+        precommit_node(set->unode.opr.op[0]);
+        precommit_node(set->unode.opr.op[1]);
+        cur = cur->unode.opr.op[1];
+      }
+      cur = node;
+      while(cur != NULL) {
+        NodeType *set = cur->unode.opr.op[0];
+        commit_node(set,0);
+        cur = cur->unode.opr.op[1];
+      }
+    } /* }}} */
+
+    /* VAR LIST */
+    static NodeType *new_var_list(NodeType *var, NodeType *next) /* {{{ */
+    {
+      NodeType *node = new_op("var_list", OPR_VAR_LIST, 2);
+      node->unode.opr.op[0] = var;
+      node->unode.opr.op[1] = next;
+      return node;
+    }
+    static void commit_var_list(NodeType *node)
+    {
+    } /* }}} */
+
+    /* FUNCTION CALL */
+    static NodeType *new_call(const char *name, NodeType *affect_list) { /* {{{ */
+        HashValue *fval;
+        fval = goom_hash_get(currentGoomSL->functions, name);
+        if (!fval) {
+            gsl_declare_task(name);
+            fval = goom_hash_get(currentGoomSL->functions, name);
+        }
+        if (!fval) {
+            g_assert_not_reached ();
+#if 0
+            fprintf(stderr, "ERROR: Line %d, Could not find function %s\n", currentGoomSL->num_lines, name);
+            exit(1);
+            return NULL;
+#endif
+        }
+        else {
+            ExternalFunctionStruct *gef = (ExternalFunctionStruct*)fval->ptr;
+            if (gef->is_extern) {
+                NodeType *node =  new_op(name, OPR_EXT_CALL, 1);
+                node->unode.opr.op[0] = affect_list;
+                return node;
+            }
+            else {
+                NodeType *node;
+                char stmp[256];
+                if (strlen(name) < 200) {
+                    sprintf(stmp, "|__func_%s|", name);
+                }
+                node = new_op(stmp, OPR_CALL, 1);
+                node->unode.opr.op[0] = affect_list;
+                return node;
+            }
+        }
+    }
+    static void commit_ext_call(NodeType *node) {
+        NodeType *alafter = new_affect_list_after(node->unode.opr.op[0]);
+        commit_node(node->unode.opr.op[0],0);
+        currentGoomSL->instr = gsl_instr_init(currentGoomSL, "extcall", INSTR_EXT_CALL, 1, node->line_number);
+        gsl_instr_add_param(currentGoomSL->instr, node->str, TYPE_VAR);
+#ifdef VERBOSE
+        printf("extcall %s\n", node->str);
+#endif
+        commit_node(alafter,0);
+    }
+    static void commit_call(NodeType *node) {
+        NodeType *alafter = new_affect_list_after(node->unode.opr.op[0]);
+        commit_node(node->unode.opr.op[0],0);
+        currentGoomSL->instr = gsl_instr_init(currentGoomSL, "call", INSTR_CALL, 1, node->line_number);
+        gsl_instr_add_param(currentGoomSL->instr, node->str, TYPE_LABEL);
+#ifdef VERBOSE
+        printf("call %s\n", node->str);
+#endif
+        commit_node(alafter,0);
+    } /* }}} */
+
+    /** **/
+
+    static NodeType *rootNode = 0; /* TODO: reinitialiser a chaque compilation. */
+    static NodeType *lastNode = 0;
+    static NodeType *gsl_append(NodeType *curNode) {
+        if (curNode == 0) return 0; /* {{{ */
+        if (lastNode)
+            lastNode->unode.opr.next = curNode;
+        lastNode = curNode;
+        while(lastNode->unode.opr.next) lastNode = lastNode->unode.opr.next;
+        if (rootNode == 0)
+            rootNode = curNode;
+        return curNode;
+    } /* }}} */
+
+#if 1
+    int allocateTemp() {
+      return allocateLabel();
+    }
+    void releaseAllTemps() {}
+    void releaseTemp(int n) {}
+#else
+    static int nbTemp = 0;
+    static int *tempArray = 0;
+    static int tempArraySize = 0;
+    int allocateTemp() { /* TODO: allocateITemp, allocateFTemp */
+        int i = 0; /* {{{ */
+        if (tempArray == 0) {
+          tempArraySize = 256;
+          tempArray = (int*)malloc(tempArraySize * sizeof(int));
+        }
+        while (1) {
+          int j;
+          for (j=0;j<nbTemp;++j) {
+            if (tempArray[j] == i) break;
+          }
+          if (j == nbTemp) {
+            if (nbTemp == tempArraySize) {
+              tempArraySize *= 2;
+              tempArray = (int*)realloc(tempArray,tempArraySize * sizeof(int));
+            }
+            tempArray[nbTemp++] = i;
+            return i;
+          }
+          i++;
+        }
+    } /* }}} */
+    void releaseAllTemps() {
+      nbTemp = 0; /* {{{ */
+    } /* }}} */
+    void releaseTemp(int n) {
+      int j; /* {{{ */
+      for (j=0;j<nbTemp;++j) {
+        if (tempArray[j] == n) {
+          tempArray[j] = tempArray[--nbTemp];
+          break;
+        }
+      }
+    } /* }}} */
+#endif
+
+    static int lastLabel = 0;
+    int allocateLabel() {
+        return ++lastLabel; /* {{{ */
+    } /* }}} */
+
+    void gsl_commit_compilation()
+    { /* {{{ */
+        commit_node(rootNode,0);
+        rootNode = 0;
+        lastNode = 0;
+    } /* }}} */
+    
+    void precommit_node(NodeType *node)
+    { /* {{{ */
+        /* do here stuff for expression.. for exemple */
+        if (node->type == OPR_NODE)
+            switch(node->unode.opr.type) {
+                case OPR_ADD: precommit_add(node); break;
+                case OPR_SUB: precommit_sub(node); break;
+                case OPR_MUL: precommit_mul(node); break;
+                case OPR_DIV: precommit_div(node); break;
+                case OPR_CALL_EXPR: precommit_call_expr(node); break;
+            }
+    } /* }}} */
+    
+    void commit_node(NodeType *node, int releaseIfTmp)
+    { /* {{{ */
+        if (node == 0) return;
+        
+        switch(node->type) {
+            case OPR_NODE:
+                switch(node->unode.opr.type) {
+                    case OPR_SET:           commit_set(node); break;
+                    case OPR_PLUS_EQ:       commit_plus_eq(node); break;
+                    case OPR_SUB_EQ:        commit_sub_eq(node); break;
+                    case OPR_MUL_EQ:        commit_mul_eq(node); break;
+                    case OPR_DIV_EQ:        commit_div_eq(node); break;
+                    case OPR_IF:            commit_if(node); break;
+                    case OPR_WHILE:         commit_while(node); break;
+                    case OPR_BLOCK:         commit_block(node); break;
+                    case OPR_FUNC_INTRO:    commit_function_intro(node); break;
+                    case OPR_FUNC_OUTRO:    commit_function_outro(node); break;
+                    case OPR_CALL:          commit_call(node); break;
+                    case OPR_EXT_CALL:      commit_ext_call(node); break;
+                    case OPR_EQU:           commit_equ(node); break;
+                    case OPR_LOW:           commit_low(node); break;
+                    case OPR_NOT:           commit_not(node); break;
+                    case OPR_AFFECT_LIST:   commit_affect_list(node); break;
+                    case OPR_FOREACH:       commit_foreach(node); break;
+                    case OPR_VAR_LIST:      commit_var_list(node); break;
+#ifdef VERBOSE
+                    case EMPTY_NODE:        printf("NOP\n"); break;
+#endif
+                }
+
+                commit_node(node->unode.opr.next,0); /* recursive for the moment, maybe better to do something iterative? */
+                break;
+
+            case VAR_NODE:         gsl_instr_set_namespace(currentGoomSL->instr, node->vnamespace);
+                                   gsl_instr_add_param(currentGoomSL->instr, node->str, TYPE_VAR); break;
+            case CONST_INT_NODE:   gsl_instr_add_param(currentGoomSL->instr, node->str, TYPE_INTEGER); break;
+            case CONST_FLOAT_NODE: gsl_instr_add_param(currentGoomSL->instr, node->str, TYPE_FLOAT); break;
+            case CONST_PTR_NODE:   gsl_instr_add_param(currentGoomSL->instr, node->str, TYPE_PTR); break;
+        }
+        if (releaseIfTmp && is_tmp_expr(node))
+          releaseTemp(get_tmp_id(node));
+        
+        nodeFree(node);
+    } /* }}} */
+
+    NodeType *nodeNew(const char *str, int type, int line_number) {
+        NodeType *node = (NodeType*)malloc(sizeof(NodeType)); /* {{{ */
+        node->type = type;
+        node->str  = (char*)malloc(strlen(str)+1);
+        node->vnamespace = NULL;
+        node->line_number = line_number;
+        strcpy(node->str, str);
+        return node;
+    } /* }}} */
+    static NodeType *nodeClone(NodeType *node) {
+        NodeType *ret = nodeNew(node->str, node->type, node->line_number); /* {{{ */
+        ret->vnamespace = node->vnamespace;
+        ret->unode = node->unode;
+        return ret;
+    } /* }}} */
+
+    void nodeFreeInternals(NodeType *node) {
+        free(node->str); /* {{{ */
+    } /* }}} */
+    
+    void nodeFree(NodeType *node) {
+        nodeFreeInternals(node); /* {{{ */
+        free(node);
+    } /* }}} */
+
+    NodeType *new_constInt(const char *str, int line_number) {
+        NodeType *node = nodeNew(str, CONST_INT_NODE, line_number); /* {{{ */
+        node->unode.constInt.val = atoi(str);
+        return node;
+    } /* }}} */
+
+    NodeType *new_constPtr(const char *str, int line_number) {
+        NodeType *node = nodeNew(str, CONST_PTR_NODE, line_number); /* {{{ */
+        node->unode.constPtr.id = strtol(str,NULL,0);
+        return node;
+    } /* }}} */
+
+    NodeType *new_constFloat(const char *str, int line_number) {
+        NodeType *node = nodeNew(str, CONST_FLOAT_NODE, line_number); /* {{{ */
+        node->unode.constFloat.val = atof(str);
+        return node;
+    } /* }}} */
+
+    NodeType *new_var(const char *str, int line_number) {
+        NodeType *node = nodeNew(str, VAR_NODE, line_number); /* {{{ */
+        node->vnamespace = gsl_find_namespace(str);
+        if (node->vnamespace == 0) {
+            g_assert_not_reached ();
+#if 0
+            fprintf(stderr, "ERROR: Line %d, Variable not found: '%s'\n", line_number, str);
+            exit(1);
+#endif
+        }
+        return node;
+    } /* }}} */
+    
+    NodeType *new_nop(const char *str) {
+        NodeType *node = new_op(str, EMPTY_NODE, 0); /* {{{ */
+        return node;
+    } /* }}} */
+    
+    NodeType *new_op(const char *str, int type, int nbOp) {
+        int i; /* {{{ */
+        NodeType *node = nodeNew(str, OPR_NODE, currentGoomSL->num_lines);
+        node->unode.opr.next = 0;
+        node->unode.opr.type = type;
+        node->unode.opr.nbOp = nbOp;
+        for (i=0;i<nbOp;++i) node->unode.opr.op[i] = 0;
+        return node;
+    } /* }}} */
+
+
+    void gsl_declare_global_variable(int type, char *name) {
+      switch(type){
+        case -1: break;
+        case FLOAT_TK:gsl_float_decl_global(name);break;
+        case INT_TK:  gsl_int_decl_global(name);break;
+        case PTR_TK:  gsl_ptr_decl_global(name);break;
+        default:
+        {
+          int id = type - 1000;
+          gsl_struct_decl_global_from_id(name,id);
+        }
+      }
+    }
+
+%}
+
+%union {
+    int intValue;
+    float floatValue;
+    char charValue;
+    char strValue[2048];
+    NodeType *nPtr;
+    GoomHash *namespace;
+    GSL_Struct *gsl_struct;
+    GSL_StructField *gsl_struct_field;
+  };
+  
+%token <strValue>   LTYPE_INTEGER
+%token <strValue>   LTYPE_FLOAT
+%token <strValue>   LTYPE_VAR
+%token <strValue>   LTYPE_PTR
+
+%token PTR_TK INT_TK FLOAT_TK DECLARE EXTERNAL WHILE DO NOT PLUS_EQ SUB_EQ DIV_EQ MUL_EQ SUP_EQ LOW_EQ NOT_EQ STRUCT FOR IN
+
+%type <intValue> return_type
+%type <nPtr> expression constValue instruction test func_call func_call_expression
+%type <nPtr> start_block affectation_list affectation_in_list affectation declaration
+%type <nPtr> var_list_content var_list
+%type <strValue> task_name ext_task_name 
+%type <namespace> leave_namespace
+%type <gsl_struct> struct_members
+%type <gsl_struct_field> struct_member
+%left '\n'
+%left PLUS_EQ SUB_EQ MUL_EQ DIV_EQ
+%left NOT
+%left '=' '<' '>'
+%left '+' '-'
+%left '/' '*'
+
+%%
+
+/* -------------- Global architechture of a GSL program ------------*/
+
+gsl: gsl_code function_outro gsl_def_functions ;
+
+gsl_code: gsl_code instruction              { gsl_append($2); }
+   | gsl_code EXTERNAL '<' ext_task_name '>' return_type '\n' leave_namespace             { gsl_declare_global_variable($6,$4); }
+   | gsl_code EXTERNAL '<' ext_task_name ':' arglist '>' return_type '\n' leave_namespace { gsl_declare_global_variable($8,$4); }
+   | gsl_code DECLARE '<' task_name '>' return_type  '\n' leave_namespace                 { gsl_declare_global_variable($6,$4); }
+   | gsl_code DECLARE '<' task_name ':' arglist '>' return_type '\n' leave_namespace      { gsl_declare_global_variable($8,$4); }
+   | gsl_code struct_declaration
+   | gsl_code '\n'
+   |
+   ;
+
+/* ------------- Declaration of a structure ------------ */
+
+struct_declaration: STRUCT  '<' LTYPE_VAR  ':' struct_members '>' '\n' { gsl_add_struct($3, $5); }
+                  ;
+
+struct_members: opt_nl struct_member                    { $$ = gsl_new_struct($2);               }
+              | struct_members ',' opt_nl struct_member { $$ = $1; gsl_add_struct_field($1, $4); }
+              ;
+
+struct_member: INT_TK    LTYPE_VAR { $$ = gsl_new_struct_field($2, INSTR_INT); }
+             | FLOAT_TK  LTYPE_VAR { $$ = gsl_new_struct_field($2, INSTR_FLOAT); }
+             | PTR_TK    LTYPE_VAR { $$ = gsl_new_struct_field($2, INSTR_PTR); }
+             | LTYPE_VAR LTYPE_VAR { $$ = gsl_new_struct_field_struct($2, $1); }
+             ;
+
+/* ------------- Fonction declarations -------------- */
+
+ext_task_name: LTYPE_VAR { gsl_declare_external_task($1); gsl_enternamespace($1); strcpy($$,$1); }
+             ;
+task_name:     LTYPE_VAR { gsl_declare_task($1); gsl_enternamespace($1); strcpy($$,$1); strcpy($$,$1); }
+         ;
+
+return_type:      { $$=-1; }
+  | ':' INT_TK    { $$=INT_TK; }
+  | ':' FLOAT_TK  { $$=FLOAT_TK; }
+  | ':' PTR_TK    { $$=PTR_TK; }
+  | ':' LTYPE_VAR { $$= 1000 + gsl_get_struct_id($2); }
+  ;
+
+arglist: empty_declaration
+       | empty_declaration ',' arglist
+       ;
+
+/* ------------- Fonction definition -------------- */
+
+gsl_def_functions: gsl_def_functions function
+                 |
+                 ;
+
+function: function_intro gsl_code function_outro { gsl_leavenamespace(); }
+
+function_intro: '<' task_name '>' return_type '\n'             { gsl_append(new_function_intro($2));
+                                                                 gsl_declare_global_variable($4,$2); }
+              | '<' task_name ':' arglist '>' return_type '\n' { gsl_append(new_function_intro($2));
+                                                                 gsl_declare_global_variable($6,$2); }
+              ;
+function_outro: { gsl_append(new_function_outro()); } ;
+
+leave_namespace:      { $$ = gsl_leavenamespace();   };
+
+/* ------------ Variable declaration ---------------- */
+
+declaration: FLOAT_TK LTYPE_VAR '=' expression { gsl_float_decl_local($2); $$ = new_set(new_var($2,currentGoomSL->num_lines), $4); }
+           | INT_TK   LTYPE_VAR '=' expression { gsl_int_decl_local($2);   $$ = new_set(new_var($2,currentGoomSL->num_lines), $4); }
+           | PTR_TK   LTYPE_VAR '=' expression { gsl_ptr_decl_local($2);   $$ = new_set(new_var($2,currentGoomSL->num_lines), $4); }
+           | LTYPE_VAR LTYPE_VAR '=' expression { gsl_struct_decl_local($1,$2); $$ = new_set(new_var($2,currentGoomSL->num_lines), $4); }
+           | empty_declaration                { $$ = 0; }
+           ;
+
+empty_declaration: FLOAT_TK  LTYPE_VAR { gsl_float_decl_local($2);       }
+                 | INT_TK    LTYPE_VAR { gsl_int_decl_local($2);         }
+                 | PTR_TK    LTYPE_VAR { gsl_ptr_decl_local($2);         }
+                 | LTYPE_VAR LTYPE_VAR { gsl_struct_decl_local($1,$2);   }
+                 ;
+
+/* -------------- Instructions and Expressions ------------------ */
+
+instruction: affectation '\n' { $$ = $1; }
+           | declaration '\n' { $$ = $1; }
+           | '(' test ')' '?' opt_nl instruction     { $$ = new_if($2,$6); }
+           | WHILE test opt_nl DO opt_nl instruction { $$ = new_while($2,$6); }
+           | '{' '\n' start_block gsl_code '}' '\n'  { lastNode = $3->unode.opr.op[1]; $$=$3; }
+           | func_call                               { $$ = $1; }
+           | LTYPE_VAR PLUS_EQ expression { $$ = new_plus_eq(new_var($1,currentGoomSL->num_lines),$3); }
+           | LTYPE_VAR SUB_EQ expression  { $$ = new_sub_eq(new_var($1,currentGoomSL->num_lines),$3); }
+           | LTYPE_VAR MUL_EQ expression  { $$ = new_mul_eq(new_var($1,currentGoomSL->num_lines),$3); }
+           | LTYPE_VAR DIV_EQ expression  { $$ = new_div_eq(new_var($1,currentGoomSL->num_lines),$3); }
+           | FOR LTYPE_VAR IN var_list DO instruction { $$ = new_static_foreach(new_var($2, currentGoomSL->num_lines), $4, $6); }
+           ;
+
+var_list: '(' var_list_content ')'      { $$ = $2; }
+        ;
+var_list_content: LTYPE_VAR             { $$ = new_var_list(new_var($1,currentGoomSL->num_lines), NULL); }
+           | LTYPE_VAR var_list_content { $$ = new_var_list(new_var($1,currentGoomSL->num_lines), $2);   }
+           ;
+
+affectation: LTYPE_VAR '=' expression { $$ = new_set(new_var($1,currentGoomSL->num_lines),$3); } ;
+
+start_block: { $$ = new_block(lastNode); lastNode = $$->unode.opr.op[0]; }
+           ;
+
+expression: LTYPE_VAR   { $$ = new_var($1,currentGoomSL->num_lines); }
+          | constValue  { $$ = $1; }
+          | expression '*' expression { $$ = new_mul($1,$3); } 
+          | expression '/' expression { $$ = new_div($1,$3); } 
+          | expression '+' expression { $$ = new_add($1,$3); } 
+          | expression '-' expression { $$ = new_sub($1,$3); } 
+          | '-' expression            { $$ = new_neg($2);    }
+          | '(' expression ')'        { $$ = $2; }
+          | func_call_expression      { $$ = $1; }
+          ;
+
+test: expression '=' expression { $$ = new_equ($1,$3); } 
+    | expression '<' expression { $$ = new_low($1,$3); } 
+    | expression '>' expression { $$ = new_low($3,$1); }
+    | expression SUP_EQ expression { $$ = new_not(new_low($1,$3)); }
+    | expression LOW_EQ expression { $$ = new_not(new_low($3,$1)); }
+    | expression NOT_EQ expression { $$ = new_not(new_equ($1,$3)); }
+    | NOT test                  { $$ = new_not($2);    }
+    ;
+
+constValue: LTYPE_FLOAT   { $$ = new_constFloat($1,currentGoomSL->num_lines); }
+          | LTYPE_INTEGER { $$ = new_constInt($1,currentGoomSL->num_lines); } 
+          | LTYPE_PTR     { $$ = new_constPtr($1,currentGoomSL->num_lines); } 
+          ;
+
+/* ---------------- Function Calls ------------------ */
+
+func_call:   task_name '\n' leave_namespace                          { $$ = new_call($1,NULL); }
+           | task_name ':' affectation_list '\n' leave_namespace         { $$ = new_call($1,$3); }
+           | '[' task_name ']' '\n' leave_namespace                  { $$ = new_call($2,NULL); }
+           | '[' task_name ':' affectation_list ']' '\n' leave_namespace { $$ = new_call($2,$4); }
+           ;
+
+func_call_expression:
+            '[' task_name leave_namespace ']'                      { $$ = new_call_expr($2,NULL); }
+          | '[' task_name ':' affectation_list ']' leave_namespace { $$ = new_call_expr($2,$4); }
+          ;
+             
+affectation_list: affectation_in_list affectation_list     { $$ = new_affec_list($1,$2);   }
+            | affectation_in_list                          { $$ = new_affec_list($1,NULL); }
+
+affectation_in_list: LTYPE_VAR '=' leave_namespace expression {
+                              gsl_reenternamespace($3);
+                              $$ = new_set(new_var($1,currentGoomSL->num_lines),$4);
+                            }
+                   | ':' leave_namespace expression {
+                              gsl_reenternamespace($2);
+                              $$ = new_set(new_var("&this", currentGoomSL->num_lines),$3);
+                            }
+                   ;
+
+
+/* ------------ Misc ---------- */
+
+opt_nl: '\n' | ;
+           
+
+%%
+
+
+void yyerror(char *str)
+{ /* {{{ */
+    g_assert_not_reached ();
+#if 0
+    fprintf(stderr, "ERROR: Line %d, %s\n", currentGoomSL->num_lines, str);
+    currentGoomSL->compilationOK = 0;
+    exit(1);
+#endif
+} /* }}} */
+
diff --git a/gst/goom/surf3d.s b/gst/goom/surf3d.s
new file mode 100644
index 0000000..f8c8c5d
--- /dev/null
+++ b/gst/goom/surf3d.s
@@ -0,0 +1,484 @@
+	.file	"surf3d.c"
+	.version	"01.01"
+gcc2_compiled.:
+.text
+	.align 4
+.globl grid3d_new
+	.type	 grid3d_new,@function
+grid3d_new:
+	pushl %ebp
+	movl %esp,%ebp
+	subl $44,%esp
+	pushl %edi
+	pushl %esi
+	pushl %ebx
+	movl 20(%ebp),%eax
+	movl 12(%ebp),%esi
+	movl %eax,-8(%ebp)
+	addl $-12,%esp
+	pushl $44
+	call malloc
+	movl %esi,%edx
+	imull -8(%ebp),%edx
+	movl %eax,%edi
+	movl %edx,-12(%ebp)
+	leal (%edx,%edx,2),%ebx
+	movl %edx,8(%edi)
+	addl $-12,%esp
+	sall $2,%ebx
+	pushl %ebx
+	call malloc
+	addl $32,%esp
+	movl %eax,(%edi)
+	addl $-12,%esp
+	pushl %ebx
+	call malloc
+	movl %eax,4(%edi)
+	movl 24(%ebp),%eax
+	movl %eax,12(%edi)
+	movl 28(%ebp),%eax
+	movl %eax,16(%edi)
+	movl 32(%ebp),%eax
+	movl %eax,20(%edi)
+	movl 8(%ebp),%eax
+	movl %eax,28(%edi)
+	movl %esi,24(%edi)
+	movl -8(%ebp),%edx
+	movl 16(%ebp),%eax
+	movl %edx,32(%edi)
+	movl %eax,36(%edi)
+	movl $0,40(%edi)
+	testl %edx,%edx
+	je .L480
+	movl %esi,%eax
+	movl %esi,-28(%ebp)
+	shrl $31,%eax
+	addl %eax,%esi
+	movl -8(%ebp),%eax
+	shrl $31,%eax
+	addl -8(%ebp),%eax
+	movl -12(%ebp),%edx
+	sarl $1,%eax
+	movl %edx,-24(%ebp)
+	negl -28(%ebp)
+	movl %esi,-16(%ebp)
+	movl %eax,-20(%ebp)
+	.p2align 4,,7
+.L481:
+	movl -28(%ebp),%eax
+	addl %eax,-24(%ebp)
+	decl -8(%ebp)
+	movl 12(%ebp),%esi
+	testl %esi,%esi
+	je .L479
+	movl -8(%ebp),%eax
+	subl -20(%ebp),%eax
+	movl %eax,-4(%ebp)
+	fildl -4(%ebp)
+	movl %esi,-4(%ebp)
+	movl -24(%ebp),%edx
+	leal (%edx,%esi),%eax
+	movl -16(%ebp),%ebx
+	fildl 16(%ebp)
+	leal (%eax,%eax,2),%eax
+	sarl $1,%ebx
+	leal 0(,%eax,4),%ecx
+	fmulp %st,%st(1)
+	fildl 20(%ebp)
+	fdivrp %st,%st(1)
+	fildl 8(%ebp)
+	fildl -4(%ebp)
+	jmp .L484
+.L487:
+	fxch %st(2)
+	.p2align 4,,7
+.L484:
+	decl %esi
+	movl %esi,%eax
+	movl (%edi),%edx
+	subl %ebx,%eax
+	movl %eax,-4(%ebp)
+	fildl -4(%ebp)
+	addl $-12,%ecx
+	fmul %st(2),%st
+	fdiv %st(1),%st
+	fstps (%edx,%ecx)
+	fxch %st(2)
+	movl (%edi),%eax
+	movl $0,4(%eax,%ecx)
+	movl (%edi),%eax
+	fsts 8(%eax,%ecx)
+	testl %esi,%esi
+	jne .L487
+	fstp %st(0)
+	fstp %st(0)
+	fstp %st(0)
+.L479:
+	cmpl $0,-8(%ebp)
+	jne .L481
+.L480:
+	leal -56(%ebp),%esp
+	popl %ebx
+	movl %edi,%eax
+	popl %esi
+	popl %edi
+	leave
+	ret
+.Lfe1:
+	.size	 grid3d_new,.Lfe1-grid3d_new
+.section	.rodata
+	.align 8
+.LC48:
+	.long 0x0,0x3fe00000
+	.align 4
+.LC49:
+	.long 0x3f19999a
+	.align 4
+.LC50:
+	.long 0x3ee3d70a
+.text
+	.align 4
+.globl grid3d_update
+	.type	 grid3d_update,@function
+grid3d_update:
+	pushl %ebp
+	movl %esp,%ebp
+	subl $32,%esp
+	pushl %esi
+	pushl %ebx
+	flds 12(%ebp)
+	movl 8(%ebp),%ebx
+	movl 16(%ebp),%ecx
+	fld %st(0)
+#APP
+	fsin
+#NO_APP
+	fstps -4(%ebp)
+	flds -4(%ebp)
+	fxch %st(1)
+#APP
+	fcos
+#NO_APP
+	fstps -4(%ebp)
+	flds -4(%ebp)
+	cmpl $0,40(%ebx)
+	jne .L519
+	testl %ecx,%ecx
+	je .L520
+	xorl %esi,%esi
+	cmpl 24(%ebx),%esi
+	jge .L520
+	fldl .LC48
+	xorl %edx,%edx
+	.p2align 4,,7
+.L524:
+	movl (%ebx),%eax
+	fld %st(0)
+	fld %st(1)
+	fxch %st(1)
+	fmuls 4(%eax,%edx)
+	fxch %st(1)
+	fmuls (%ecx,%esi,4)
+	faddp %st,%st(1)
+	incl %esi
+	fstps 4(%eax,%edx)
+	addl $12,%edx
+	cmpl 24(%ebx),%esi
+	jl .L524
+	fstp %st(0)
+.L520:
+	movl 24(%ebx),%esi
+	cmpl 8(%ebx),%esi
+	jge .L519
+	leal (%esi,%esi,2),%eax
+	flds .LC49
+	flds .LC50
+	leal 0(,%eax,4),%ecx
+	.p2align 4,,7
+.L529:
+	movl (%ebx),%eax
+	flds 4(%eax,%ecx)
+	fmul %st(2),%st
+	fstps 4(%eax,%ecx)
+	movl %esi,%eax
+	subl 24(%ebx),%eax
+	movl (%ebx),%edx
+	leal (%eax,%eax,2),%eax
+	flds 4(%edx,%eax,4)
+	fmul %st(1),%st
+	fadds 4(%edx,%ecx)
+	incl %esi
+	fstps 4(%edx,%ecx)
+	addl $12,%ecx
+	cmpl 8(%ebx),%esi
+	jl .L529
+	fstp %st(0)
+	fstp %st(0)
+.L519:
+	xorl %esi,%esi
+	cmpl 8(%ebx),%esi
+	jge .L536
+	xorl %ecx,%ecx
+	.p2align 4,,7
+.L534:
+	movl (%ebx),%eax
+	flds (%eax,%ecx)
+	flds 8(%eax,%ecx)
+	fmul %st(2),%st
+	fxch %st(1)
+	fmul %st(3),%st
+	fsubp %st,%st(1)
+	movl 4(%ebx),%edx
+	incl %esi
+	fstps (%edx,%ecx)
+	movl (%ebx),%eax
+	flds (%eax,%ecx)
+	flds 8(%eax,%ecx)
+	fxch %st(1)
+	fmul %st(2),%st
+	fxch %st(1)
+	fmul %st(3),%st
+	faddp %st,%st(1)
+	movl 4(%ebx),%edx
+	fstps 8(%edx,%ecx)
+	movl (%ebx),%eax
+	flds 4(%eax,%ecx)
+	movl 4(%ebx),%edx
+	fstps 4(%edx,%ecx)
+	movl 4(%ebx),%eax
+	flds (%eax,%ecx)
+	fadds 12(%ebx)
+	fstps (%eax,%ecx)
+	movl 4(%ebx),%eax
+	flds 4(%eax,%ecx)
+	fadds 16(%ebx)
+	fstps 4(%eax,%ecx)
+	movl 4(%ebx),%eax
+	flds 8(%eax,%ecx)
+	fadds 20(%ebx)
+	fstps 8(%eax,%ecx)
+	addl $12,%ecx
+	cmpl 8(%ebx),%esi
+	jl .L534
+.L536:
+	fstp %st(0)
+	fstp %st(0)
+	popl %ebx
+	popl %esi
+	leave
+	ret
+.Lfe2:
+	.size	 grid3d_update,.Lfe2-grid3d_update
+.section	.rodata
+	.align 4
+.LC51:
+	.long 0x40000000
+	.align 8
+.LC52:
+	.long 0x0,0x42380000
+.text
+	.align 4
+.globl surf3d_draw
+	.type	 surf3d_draw,@function
+surf3d_draw:
+	pushl %ebp
+	movl %esp,%ebp
+	subl $60,%esp
+	pushl %edi
+	pushl %esi
+	pushl %ebx
+	movl $0,-20(%ebp)
+	movl -20(%ebp),%edx
+	movl 8(%ebp),%eax
+	cmpl 8(%eax),%edx
+	jge .L493
+	fldl .LC52
+	flds .LC51
+	xorl %edi,%edi
+	.p2align 4,,7
+.L495:
+	movl 8(%ebp),%eax
+	movl 4(%eax),%eax
+	movl %eax,-36(%ebp)
+	fcoms 8(%eax,%edi)
+	fnstsw %ax
+	andb $69,%ah
+	cmpb $1,%ah
+	jne .L496
+	fildl 16(%ebp)
+	movl -36(%ebp),%edx
+	fld %st(0)
+	fmuls (%edx,%edi)
+	fdivs 8(%edx,%edi)
+	fld %st(3)
+	faddp %st,%st(1)
+	fstpl -32(%ebp)
+	movl -32(%ebp),%eax
+	movl -28(%ebp),%edx
+	movl %eax,-40(%ebp)
+	sarl $16,-40(%ebp)
+	movl -36(%ebp),%edx
+	fmuls 4(%edx,%edi)
+	fdivs 8(%edx,%edi)
+	movl -40(%ebp),%ecx
+	fld %st(2)
+	faddp %st,%st(1)
+	fstpl -32(%ebp)
+	movl -32(%ebp),%eax
+	movl -28(%ebp),%edx
+	movl %eax,-44(%ebp)
+	movl 28(%ebp),%eax
+	sarl $1,%eax
+	addl %eax,%ecx
+	movl 32(%ebp),%eax
+	sarl $16,-44(%ebp)
+	sarl $1,%eax
+	movl %ecx,%ebx
+	subl -44(%ebp),%eax
+	movl %eax,%esi
+	cmpl 28(%ebp),%ebx
+	jge .L496
+	testl %ecx,%ecx
+	jl .L496
+	cmpl 32(%ebp),%esi
+	jge .L496
+	testl %eax,%eax
+	jge .L499
+.L496:
+	xorl %esi,%esi
+	xorl %ebx,%ebx
+.L499:
+	movl 20(%ebp),%eax
+	movl %ebx,%edx
+	leal (%eax,%edx,4),%edx
+	movl 28(%ebp),%eax
+	imull %esi,%eax
+	leal (%edx,%eax,4),%eax
+	testl %ebx,%ebx
+	je .L494
+	testl %esi,%esi
+	je .L494
+#APP
+	movd (%eax), %mm0
+	paddusb 12(%ebp), %mm0
+	movd %mm0, (%eax)
+#NO_APP
+.L494:
+	incl -20(%ebp)
+	addl $12,%edi
+	movl -20(%ebp),%eax
+	movl 8(%ebp),%edx
+	cmpl 8(%edx),%eax
+	jl .L495
+	fstp %st(0)
+	fstp %st(0)
+.L493:
+	popl %ebx
+	popl %esi
+	popl %edi
+	leave
+	ret
+.Lfe3:
+	.size	 surf3d_draw,.Lfe3-surf3d_draw
+	.align 4
+.globl surf3d_rotate
+	.type	 surf3d_rotate,@function
+surf3d_rotate:
+	pushl %ebp
+	movl %esp,%ebp
+	subl $32,%esp
+	pushl %esi
+	pushl %ebx
+	flds 12(%ebp)
+	movl 8(%ebp),%ebx
+	fld %st(0)
+#APP
+	fsin
+#NO_APP
+	fstps -4(%ebp)
+	flds -4(%ebp)
+	fxch %st(1)
+#APP
+	fcos
+#NO_APP
+	fstps -4(%ebp)
+	xorl %esi,%esi
+	flds -4(%ebp)
+	cmpl 8(%ebx),%esi
+	jge .L537
+	xorl %ecx,%ecx
+	.p2align 4,,7
+.L508:
+	movl (%ebx),%eax
+	flds (%eax,%ecx)
+	flds 8(%eax,%ecx)
+	fmul %st(2),%st
+	fxch %st(1)
+	fmul %st(3),%st
+	fsubp %st,%st(1)
+	movl 4(%ebx),%edx
+	incl %esi
+	fstps (%edx,%ecx)
+	movl (%ebx),%eax
+	flds (%eax,%ecx)
+	flds 8(%eax,%ecx)
+	fxch %st(1)
+	fmul %st(2),%st
+	fxch %st(1)
+	fmul %st(3),%st
+	faddp %st,%st(1)
+	movl 4(%ebx),%edx
+	fstps 8(%edx,%ecx)
+	movl (%ebx),%eax
+	flds 4(%eax,%ecx)
+	movl 4(%ebx),%edx
+	fstps 4(%edx,%ecx)
+	addl $12,%ecx
+	cmpl 8(%ebx),%esi
+	jl .L508
+.L537:
+	fstp %st(0)
+	fstp %st(0)
+	popl %ebx
+	popl %esi
+	leave
+	ret
+.Lfe4:
+	.size	 surf3d_rotate,.Lfe4-surf3d_rotate
+	.align 4
+.globl surf3d_translate
+	.type	 surf3d_translate,@function
+surf3d_translate:
+	pushl %ebp
+	movl %esp,%ebp
+	pushl %ebx
+	movl 8(%ebp),%ecx
+	xorl %ebx,%ebx
+	cmpl 8(%ecx),%ebx
+	jge .L512
+	xorl %edx,%edx
+	.p2align 4,,7
+.L514:
+	movl 4(%ecx),%eax
+	flds (%eax,%edx)
+	fadds 12(%ecx)
+	incl %ebx
+	fstps (%eax,%edx)
+	movl 4(%ecx),%eax
+	flds 4(%eax,%edx)
+	fadds 16(%ecx)
+	fstps 4(%eax,%edx)
+	movl 4(%ecx),%eax
+	flds 8(%eax,%edx)
+	fadds 20(%ecx)
+	fstps 8(%eax,%edx)
+	addl $12,%edx
+	cmpl 8(%ecx),%ebx
+	jl .L514
+.L512:
+	popl %ebx
+	leave
+	ret
+.Lfe5:
+	.size	 surf3d_translate,.Lfe5-surf3d_translate
+	.ident	"GCC: (GNU) 2.95.3 19991030 (prerelease)"
diff --git a/gst/goom2k1/Makefile.in b/gst/goom2k1/Makefile.in
index d6b9d6d..7d4d1ce 100644
--- a/gst/goom2k1/Makefile.in
+++ b/gst/goom2k1/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/goom2k1
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -121,10 +137,23 @@ libgstgoom2k1_la_OBJECTS = $(am_libgstgoom2k1_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstgoom2k1_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstgoom2k1_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstgoom2k1_la_CFLAGS) $(CFLAGS) \
 	$(libgstgoom2k1_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -137,22 +166,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstgoom2k1_la_SOURCES)
 DIST_SOURCES = $(libgstgoom2k1_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -212,6 +242,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -260,8 +291,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -342,7 +375,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -402,6 +435,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -475,7 +509,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -525,7 +563,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -533,6 +570,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -548,12 +587,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstgoom2k1.la: $(libgstgoom2k1_la_OBJECTS) $(libgstgoom2k1_la_DEPENDENCIES) $(EXTRA_libgstgoom2k1_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstgoom2k1_la_LINK) -rpath $(plugindir) $(libgstgoom2k1_la_OBJECTS) $(libgstgoom2k1_la_LIBADD) $(LIBS)
 
@@ -680,6 +721,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -824,18 +879,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/goom2k1/filters_mmx.s b/gst/goom2k1/filters_mmx.s
new file mode 100644
index 0000000..337de56
--- /dev/null
+++ b/gst/goom2k1/filters_mmx.s
@@ -0,0 +1,130 @@
+;// file : mmx_zoom.s
+;// author : JC Hoelt <jeko@free.fr>
+;//
+;// history
+;// 07/01/2001 : Changing FEMMS to EMMS : slower... but run on intel machines
+;//	03/01/2001 : WIDTH and HEIGHT are now variable
+;//	28/12/2000 : adding comments to the code, suppress some useless lines
+;//	27/12/2000 : reducing memory access... improving performance by 20%
+;//		coefficients are now on 1 byte
+;//	22/12/2000 : Changing data structure
+;//	16/12/2000 : AT&T version
+;//	14/12/2000 : unrolling loop
+;//	12/12/2000 : 64 bits memory access
+
+
+.data
+
+thezero:
+	.long 0x00000000
+	.long 0x00000000
+
+
+.text
+
+.globl mmx_zoom		;// name of the function to call by C program
+.extern coeffs		;// the transformation buffer
+.extern expix1,expix2 ;// the source and destination buffer
+.extern mmx_zoom_size, zoom_width ;// size of the buffers
+
+.align 16
+mmx_zoom:
+
+push %ebp
+push %esp
+
+;// initialisation du mm7  zero
+movq (thezero), %mm7
+
+movl zoom_width, %eax
+movl $4, %ebx
+mull %ebx
+movl %eax, %ebp
+
+movl (coeffs), %eax
+movl (expix1), %edx
+movl (expix2), %ebx
+movl $10, %edi
+movl mmx_zoom_size, %ecx
+
+.while:
+	;// esi <- nouvelle position
+	movl (%eax), %esi
+	leal (%edx, %esi), %esi
+
+	;// recuperation des deux premiers pixels dans mm0 et mm1
+	movq (%esi), %mm0		/* b1-v1-r1-a1-b2-v2-r2-a2 */
+	movq %mm0, %mm1			/* b1-v1-r1-a1-b2-v2-r2-a2 */
+
+	;// recuperation des 4 coefficients
+	movd 4(%eax), %mm6		/* ??-??-??-??-c4-c3-c2-c1 */
+	;// depackage du premier pixel
+	punpcklbw %mm7, %mm0	/* 00-b2-00-v2-00-r2-00-a2 */
+
+	movq %mm6, %mm5			/* ??-??-??-??-c4-c3-c2-c1 */
+	;// depackage du 2ieme pixel
+	punpckhbw %mm7, %mm1	/* 00-b1-00-v1-00-r1-00-a1 */
+
+	;// extraction des coefficients...
+	punpcklbw %mm5, %mm6	/* c4-c4-c3-c3-c2-c2-c1-c1 */
+	movq %mm6, %mm4			/* c4-c4-c3-c3-c2-c2-c1-c1 */
+	movq %mm6, %mm5			/* c4-c4-c3-c3-c2-c2-c1-c1 */
+
+	punpcklbw %mm5, %mm6	/* c2-c2-c2-c2-c1-c1-c1-c1 */
+	punpckhbw %mm5, %mm4	/* c4-c4-c4-c4-c3-c3-c3-c3 */
+
+	movq %mm6, %mm3			/* c2-c2-c2-c2-c1-c1-c1-c1 */
+	punpcklbw %mm7, %mm6	/* 00-c1-00-c1-00-c1-00-c1 */
+	punpckhbw %mm7, %mm3	/* 00-c2-00-c2-00-c2-00-c2 */
+	
+	;// multiplication des pixels par les coefficients
+	pmullw %mm6, %mm0		/* c1*b2-c1*v2-c1*r2-c1*a2 */
+	pmullw %mm3, %mm1		/* c2*b1-c2*v1-c2*r1-c2*a1 */
+	paddw %mm1, %mm0
+	
+	;// ...extraction des 2 derniers coefficients
+	movq %mm4, %mm5			/* c4-c4-c4-c4-c3-c3-c3-c3 */
+	punpcklbw %mm7, %mm4	/* 00-c3-00-c3-00-c3-00-c3 */
+	punpckhbw %mm7, %mm5	/* 00-c4-00-c4-00-c4-00-c4 */
+
+	;// recuperation des 2 derniers pixels
+	movq (%esi,%ebp), %mm1
+	movq %mm1, %mm2
+	
+	;// depackage des pixels
+	punpcklbw %mm7, %mm1
+	punpckhbw %mm7, %mm2
+	
+	;// multiplication pas les coeffs
+	pmullw %mm4, %mm1
+	pmullw %mm5, %mm2
+	
+	;// ajout des valeurs obtenues  la valeur finale
+	paddw %mm1, %mm0
+	paddw %mm2, %mm0
+
+	;// division par 256 = 16+16+16+16, puis repackage du pixel final
+	psrlw $8, %mm0
+	packuswb %mm7, %mm0
+	
+	;// passage au suivant
+	leal 8(%eax), %eax
+
+	decl %ecx
+	;// enregistrement du resultat
+	movd %mm0, (%ebx)
+	leal 4(%ebx), %ebx
+
+	;// test de fin du tantque
+	cmpl $0, %ecx				;// 400x300
+
+jz .fin_while
+jmp .while
+
+.fin_while:
+emms
+
+pop %esp
+pop %ebp
+
+ret                  ;//The End
diff --git a/gst/goom2k1/lines.c b/gst/goom2k1/lines.c
index 3214e1d..bb6348f 100644
--- a/gst/goom2k1/lines.c
+++ b/gst/goom2k1/lines.c
@@ -48,6 +48,11 @@ goom_lines (GoomData * goomdata, gint16 data[2][512], unsigned int ID,
       color2 = 0x00AA33DD;
       break;
     }
+    default:{
+      color1 = color2 = 0;
+      g_assert_not_reached ();
+      break;
+    }
   }
   *color = lighten (*color, power);
   color++;
diff --git a/gst/icydemux/Makefile.in b/gst/icydemux/Makefile.in
index c24dcea..d9a0537 100644
--- a/gst/icydemux/Makefile.in
+++ b/gst/icydemux/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/icydemux
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -119,10 +135,23 @@ libgsticydemux_la_OBJECTS = $(am_libgsticydemux_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgsticydemux_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgsticydemux_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgsticydemux_la_CFLAGS) $(CFLAGS) \
 	$(libgsticydemux_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -135,22 +164,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgsticydemux_la_SOURCES)
 DIST_SOURCES = $(libgsticydemux_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -210,6 +240,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -258,8 +289,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -340,7 +373,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -400,6 +433,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -473,7 +507,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -520,7 +558,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -528,6 +565,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -543,12 +582,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgsticydemux.la: $(libgsticydemux_la_OBJECTS) $(libgsticydemux_la_DEPENDENCIES) $(EXTRA_libgsticydemux_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgsticydemux_la_LINK) -rpath $(plugindir) $(libgsticydemux_la_OBJECTS) $(libgsticydemux_la_LIBADD) $(LIBS)
 
@@ -643,6 +684,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -787,18 +842,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/icydemux/gsticydemux.c b/gst/icydemux/gsticydemux.c
index 4a533b9..16dc2cf 100644
--- a/gst/icydemux/gsticydemux.c
+++ b/gst/icydemux/gsticydemux.c
@@ -543,7 +543,12 @@ gst_icydemux_chain (GstPad * pad, GstBuffer * buf)
   while (size) {
     if (icydemux->remaining) {
       chunk = (size <= icydemux->remaining) ? size : icydemux->remaining;
-      sub = gst_buffer_create_sub (buf, offset, chunk);
+      if (offset == 0 && chunk == size) {
+        sub = buf;
+        buf = NULL;
+      } else {
+        sub = gst_buffer_create_sub (buf, offset, chunk);
+      }
       offset += chunk;
       icydemux->remaining -= chunk;
       size -= chunk;
@@ -585,7 +590,8 @@ gst_icydemux_chain (GstPad * pad, GstBuffer * buf)
   }
 
 done:
-  gst_buffer_unref (buf);
+  if (buf)
+    gst_buffer_unref (buf);
 
   return ret;
 
diff --git a/gst/id3demux/Makefile.in b/gst/id3demux/Makefile.in
index a4753f3..a414815 100644
--- a/gst/id3demux/Makefile.in
+++ b/gst/id3demux/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/id3demux
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -118,10 +134,23 @@ libgstid3demux_la_OBJECTS = $(am_libgstid3demux_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstid3demux_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstid3demux_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstid3demux_la_CFLAGS) $(CFLAGS) \
 	$(libgstid3demux_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -134,22 +163,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstid3demux_la_SOURCES)
 DIST_SOURCES = $(libgstid3demux_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -209,6 +239,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -257,8 +288,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -339,7 +372,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -399,6 +432,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -472,7 +506,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -521,7 +559,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -529,6 +566,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -544,12 +583,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstid3demux.la: $(libgstid3demux_la_OBJECTS) $(libgstid3demux_la_DEPENDENCIES) $(EXTRA_libgstid3demux_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstid3demux_la_LINK) -rpath $(plugindir) $(libgstid3demux_la_OBJECTS) $(libgstid3demux_la_LIBADD) $(LIBS)
 
@@ -644,6 +685,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -788,18 +843,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/imagefreeze/Makefile.in b/gst/imagefreeze/Makefile.in
index 4c8a06d..041e815 100644
--- a/gst/imagefreeze/Makefile.in
+++ b/gst/imagefreeze/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/imagefreeze
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -118,10 +134,23 @@ libgstimagefreeze_la_OBJECTS = $(am_libgstimagefreeze_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstimagefreeze_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstimagefreeze_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstimagefreeze_la_CFLAGS) $(CFLAGS) \
 	$(libgstimagefreeze_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -134,22 +163,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstimagefreeze_la_SOURCES)
 DIST_SOURCES = $(libgstimagefreeze_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -209,6 +239,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -257,8 +288,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -339,7 +372,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -399,6 +432,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -472,7 +506,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -519,7 +557,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -527,6 +564,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -542,12 +581,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstimagefreeze.la: $(libgstimagefreeze_la_OBJECTS) $(libgstimagefreeze_la_DEPENDENCIES) $(EXTRA_libgstimagefreeze_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstimagefreeze_la_LINK) -rpath $(plugindir) $(libgstimagefreeze_la_OBJECTS) $(libgstimagefreeze_la_LIBADD) $(LIBS)
 
@@ -642,6 +683,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -786,18 +841,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/interleave/Makefile.in b/gst/interleave/Makefile.in
index fcd6846..52b2a7a 100644
--- a/gst/interleave/Makefile.in
+++ b/gst/interleave/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/interleave
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -120,10 +136,23 @@ libgstinterleave_la_OBJECTS = $(am_libgstinterleave_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstinterleave_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstinterleave_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstinterleave_la_CFLAGS) $(CFLAGS) \
 	$(libgstinterleave_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -136,22 +165,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstinterleave_la_SOURCES)
 DIST_SOURCES = $(libgstinterleave_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -211,6 +241,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -259,8 +290,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -341,7 +374,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -401,6 +434,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -474,7 +508,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -521,7 +559,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -529,6 +566,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -544,12 +583,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstinterleave.la: $(libgstinterleave_la_OBJECTS) $(libgstinterleave_la_DEPENDENCIES) $(EXTRA_libgstinterleave_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstinterleave_la_LINK) -rpath $(plugindir) $(libgstinterleave_la_OBJECTS) $(libgstinterleave_la_LIBADD) $(LIBS)
 
@@ -660,6 +701,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -804,18 +859,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/interleave/interleave.c b/gst/interleave/interleave.c
index bc672d1..e30db4b 100644
--- a/gst/interleave/interleave.c
+++ b/gst/interleave/interleave.c
@@ -57,6 +57,10 @@
  * </refsect2>
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #  include "config.h"
 #endif
@@ -227,7 +231,7 @@ static gboolean gst_interleave_sink_setcaps (GstPad * pad, GstCaps * caps);
 
 static GstCaps *gst_interleave_sink_getcaps (GstPad * pad);
 
-static GstFlowReturn gst_interleave_collected (GstCollectPads * pads,
+static GstFlowReturn gst_interleave_collected (GstCollectPads2 * pads,
     GstInterleave * self);
 
 static void
@@ -405,9 +409,9 @@ gst_interleave_init (GstInterleave * self, GstInterleaveClass * klass)
 
   gst_element_add_pad (GST_ELEMENT (self), self->src);
 
-  self->collect = gst_collect_pads_new ();
-  gst_collect_pads_set_function (self->collect,
-      (GstCollectPadsFunction) gst_interleave_collected, self);
+  self->collect = gst_collect_pads2_new ();
+  gst_collect_pads2_set_function (self->collect,
+      (GstCollectPads2Function) gst_interleave_collected, self);
 
   self->input_channel_positions = g_value_array_new (0);
   self->channel_positions_from_input = TRUE;
@@ -498,10 +502,10 @@ gst_interleave_request_new_pad (GstElement * element, GstPadTemplate * templ,
   gst_pad_set_getcaps_function (new_pad,
       GST_DEBUG_FUNCPTR (gst_interleave_sink_getcaps));
 
-  gst_collect_pads_add_pad (self->collect, new_pad, sizeof (GstCollectData));
+  gst_collect_pads2_add_pad (self->collect, new_pad, sizeof (GstCollectData2));
 
   /* FIXME: hacked way to override/extend the event function of
-   * GstCollectPads; because it sets its own event function giving the
+   * GstCollectPads2; because it sets its own event function giving the
    * element no access to events */
   self->collect_event = (GstPadEventFunction) GST_PAD_EVENTFUNC (new_pad);
   gst_pad_set_event_function (new_pad,
@@ -547,7 +551,7 @@ not_sink_pad:
 could_not_add:
   {
     GST_DEBUG_OBJECT (self, "could not add pad %s", GST_PAD_NAME (new_pad));
-    gst_collect_pads_remove_pad (self->collect, new_pad);
+    gst_collect_pads2_remove_pad (self->collect, new_pad);
     gst_object_unref (new_pad);
     return NULL;
   }
@@ -601,7 +605,7 @@ gst_interleave_release_pad (GstElement * element, GstPad * pad)
 
   GST_OBJECT_UNLOCK (self->collect);
 
-  gst_collect_pads_remove_pad (self->collect, pad);
+  gst_collect_pads2_remove_pad (self->collect, pad);
   gst_element_remove_pad (element, pad);
 }
 
@@ -619,11 +623,8 @@ gst_interleave_change_state (GstElement * element, GstStateChange transition)
     case GST_STATE_CHANGE_READY_TO_PAUSED:
       self->timestamp = 0;
       self->offset = 0;
-      self->segment_pending = TRUE;
-      self->segment_position = 0;
-      self->segment_rate = 1.0;
-      gst_segment_init (&self->segment, GST_FORMAT_UNDEFINED);
-      gst_collect_pads_start (self->collect);
+      gst_event_replace (&self->pending_segment, NULL);
+      gst_collect_pads2_start (self->collect);
       break;
     case GST_STATE_CHANGE_PAUSED_TO_PLAYING:
       break;
@@ -632,11 +633,11 @@ gst_interleave_change_state (GstElement * element, GstStateChange transition)
   }
 
   /* Stop before calling the parent's state change function as
-   * GstCollectPads might take locks and we would deadlock in that
+   * GstCollectPads2 might take locks and we would deadlock in that
    * case
    */
   if (transition == GST_STATE_CHANGE_PAUSED_TO_READY)
-    gst_collect_pads_stop (self->collect);
+    gst_collect_pads2_stop (self->collect);
 
   ret = GST_ELEMENT_CLASS (parent_class)->change_state (element, transition);
 
@@ -646,6 +647,7 @@ gst_interleave_change_state (GstElement * element, GstStateChange transition)
     case GST_STATE_CHANGE_PAUSED_TO_READY:
       gst_pad_set_caps (self->src, NULL);
       gst_caps_replace (&self->sinkcaps, NULL);
+      gst_event_replace (&self->pending_segment, NULL);
       break;
     case GST_STATE_CHANGE_READY_TO_NULL:
       break;
@@ -816,6 +818,8 @@ gst_interleave_sink_setcaps (GstPad * pad, GstCaps * caps)
 
     gst_structure_remove_field (s, "channel-positions");
 
+    GST_DEBUG_OBJECT (self, "setting sinkcaps %" GST_PTR_FORMAT, sinkcaps);
+
     gst_caps_replace (&self->sinkcaps, sinkcaps);
 
     gst_caps_unref (sinkcaps);
@@ -864,19 +868,22 @@ gst_interleave_sink_event (GstPad * pad, GstEvent * event)
 
   switch (GST_EVENT_TYPE (event)) {
     case GST_EVENT_FLUSH_STOP:
-      /* mark a pending new segment. This event is synchronized
-       * with the streaming thread so we can safely update the
-       * variable without races. It's somewhat weird because we
-       * assume the collectpads forwarded the FLUSH_STOP past us
-       * and downstream (using our source pad, the bastard!).
-       */
-      self->segment_pending = TRUE;
+      GST_OBJECT_LOCK (self);
+      gst_event_replace (&self->pending_segment, NULL);
+      GST_OBJECT_UNLOCK (self);
+      break;
+    case GST_EVENT_NEWSEGMENT:
+    {
+      GST_OBJECT_LOCK (self);
+      gst_event_replace (&self->pending_segment, event);
+      GST_OBJECT_UNLOCK (self);
       break;
+    }
     default:
       break;
   }
 
-  /* now GstCollectPads can take care of the rest, e.g. EOS */
+  /* now GstCollectPads2 can take care of the rest, e.g. EOS */
   ret = self->collect_event (pad, event);
 
   gst_object_unref (self);
@@ -1147,33 +1154,18 @@ gst_interleave_src_event (GstPad * pad, GstEvent * event)
     case GST_EVENT_SEEK:
     {
       GstSeekFlags flags;
-      GstSeekType curtype;
-      gint64 cur;
 
-      /* parse the seek parameters */
-      gst_event_parse_seek (event, &self->segment_rate, NULL, &flags, &curtype,
-          &cur, NULL, NULL);
+      gst_event_parse_seek (event, NULL, NULL, &flags, NULL, NULL, NULL, NULL);
 
       /* check if we are flushing */
       if (flags & GST_SEEK_FLAG_FLUSH) {
         /* make sure we accept nothing anymore and return WRONG_STATE */
-        gst_collect_pads_set_flushing (self->collect, TRUE);
+        gst_collect_pads2_set_flushing (self->collect, TRUE);
 
         /* flushing seek, start flush downstream, the flush will be done
          * when all pads received a FLUSH_STOP. */
         gst_pad_push_event (self->src, gst_event_new_flush_start ());
       }
-
-      /* now wait for the collected to be finished and mark a new
-       * segment */
-      GST_OBJECT_LOCK (self->collect);
-      if (curtype == GST_SEEK_TYPE_SET)
-        self->segment_position = cur;
-      else
-        self->segment_position = 0;
-      self->segment_pending = TRUE;
-      GST_OBJECT_UNLOCK (self->collect);
-
       result = forward_event (self, event);
       break;
     }
@@ -1192,24 +1184,27 @@ gst_interleave_src_event (GstPad * pad, GstEvent * event)
 }
 
 static GstFlowReturn
-gst_interleave_collected (GstCollectPads * pads, GstInterleave * self)
+gst_interleave_collected (GstCollectPads2 * pads, GstInterleave * self)
 {
   guint size;
-  GstBuffer *outbuf;
+  GstBuffer *outbuf = NULL;
   GstFlowReturn ret = GST_FLOW_OK;
   GSList *collected;
   guint nsamples;
   guint ncollected = 0;
   gboolean empty = TRUE;
   gint width = self->width / 8;
+  GstClockTime timestamp = -1;
+
+  size = gst_collect_pads2_available (pads);
+  if (size == 0)
+    goto eos;
 
   g_return_val_if_fail (self->func != NULL, GST_FLOW_NOT_NEGOTIATED);
   g_return_val_if_fail (self->width > 0, GST_FLOW_NOT_NEGOTIATED);
   g_return_val_if_fail (self->channels > 0, GST_FLOW_NOT_NEGOTIATED);
   g_return_val_if_fail (self->rate > 0, GST_FLOW_NOT_NEGOTIATED);
 
-  size = gst_collect_pads_available (pads);
-
   g_return_val_if_fail (size % width == 0, GST_FLOW_ERROR);
 
   GST_DEBUG_OBJECT (self, "Starting to collect %u bytes from %d channels", size,
@@ -1235,19 +1230,22 @@ gst_interleave_collected (GstCollectPads * pads, GstInterleave * self)
   memset (GST_BUFFER_DATA (outbuf), 0, size * self->channels);
 
   for (collected = pads->data; collected != NULL; collected = collected->next) {
-    GstCollectData *cdata;
+    GstCollectData2 *cdata;
     GstBuffer *inbuf;
     guint8 *outdata;
 
-    cdata = (GstCollectData *) collected->data;
+    cdata = (GstCollectData2 *) collected->data;
 
-    inbuf = gst_collect_pads_take_buffer (pads, cdata, size);
+    inbuf = gst_collect_pads2_take_buffer (pads, cdata, size);
     if (inbuf == NULL) {
       GST_DEBUG_OBJECT (cdata->pad, "No buffer available");
       goto next;
     }
     ncollected++;
 
+    if (timestamp == -1)
+      timestamp = GST_BUFFER_TIMESTAMP (inbuf);
+
     if (GST_BUFFER_FLAG_IS_SET (inbuf, GST_BUFFER_FLAG_GAP))
       goto next;
 
@@ -1266,15 +1264,64 @@ gst_interleave_collected (GstCollectPads * pads, GstInterleave * self)
   if (ncollected == 0)
     goto eos;
 
-  if (self->segment_pending) {
+  GST_OBJECT_LOCK (self);
+  if (self->pending_segment) {
     GstEvent *event;
+    gboolean update;
+    gdouble rate;
+    gdouble applied_rate;
+    GstFormat format;
+    gint64 start, stop;
+    gint64 position;
+
+    event = self->pending_segment;
+    self->pending_segment = NULL;
+    GST_OBJECT_UNLOCK (self);
+
+    /* convert the input segment to time now */
+    gst_event_parse_new_segment_full (event, &update, &rate, &applied_rate,
+        &format, &start, &stop, &position);
 
-    event = gst_event_new_new_segment_full (FALSE, self->segment_rate,
-        1.0, GST_FORMAT_TIME, self->timestamp, -1, self->segment_position);
+    if (format != GST_FORMAT_TIME) {
+      gst_event_unref (event);
 
+      /* not time, convert */
+      switch (format) {
+        case GST_FORMAT_BYTES:
+          start *= width;
+          if (stop != -1)
+            stop *= width;
+          if (position != -1)
+            position *= width;
+          /* fallthrough for the samples case */
+        case GST_FORMAT_DEFAULT:
+          start = gst_util_uint64_scale_int (start, GST_SECOND, self->rate);
+          if (stop != -1)
+            stop = gst_util_uint64_scale_int (stop, GST_SECOND, self->rate);
+          if (position != -1)
+            position =
+                gst_util_uint64_scale_int (position, GST_SECOND, self->rate);
+          break;
+        default:
+          GST_WARNING ("can't convert segment values");
+          start = 0;
+          stop = -1;
+          position = 0;
+          break;
+      }
+      event = gst_event_new_new_segment_full (update, rate, applied_rate,
+          GST_FORMAT_TIME, start, stop, position);
+    }
     gst_pad_push_event (self->src, event);
-    self->segment_pending = FALSE;
-    self->segment_position = 0;
+
+    GST_OBJECT_LOCK (self);
+  }
+  GST_OBJECT_UNLOCK (self);
+
+  if (timestamp != -1) {
+    self->offset = gst_util_uint64_scale_int (timestamp, self->rate,
+        GST_SECOND);
+    self->timestamp = timestamp;
   }
 
   GST_BUFFER_TIMESTAMP (outbuf) = self->timestamp;
@@ -1284,8 +1331,8 @@ gst_interleave_collected (GstCollectPads * pads, GstInterleave * self)
   self->timestamp = gst_util_uint64_scale_int (self->offset,
       GST_SECOND, self->rate);
 
-  GST_BUFFER_DURATION (outbuf) = self->timestamp -
-      GST_BUFFER_TIMESTAMP (outbuf);
+  GST_BUFFER_DURATION (outbuf) =
+      self->timestamp - GST_BUFFER_TIMESTAMP (outbuf);
 
   if (empty)
     GST_BUFFER_FLAG_SET (outbuf, GST_BUFFER_FLAG_GAP);
@@ -1299,7 +1346,8 @@ gst_interleave_collected (GstCollectPads * pads, GstInterleave * self)
 eos:
   {
     GST_DEBUG_OBJECT (self, "no data available, must be EOS");
-    gst_buffer_unref (outbuf);
+    if (outbuf)
+      gst_buffer_unref (outbuf);
     gst_pad_push_event (self->src, gst_event_new_eos ());
     return GST_FLOW_UNEXPECTED;
   }
diff --git a/gst/interleave/interleave.h b/gst/interleave/interleave.h
index fb3b274..5c6bf6b 100644
--- a/gst/interleave/interleave.h
+++ b/gst/interleave/interleave.h
@@ -27,7 +27,7 @@
 #define __INTERLEAVE_H__
 
 #include <gst/gst.h>
-#include <gst/base/gstcollectpads.h>
+#include <gst/base/gstcollectpads2.h>
 
 G_BEGIN_DECLS
 
@@ -49,7 +49,7 @@ struct _GstInterleave
   GstElement element;
 
   /*< private >*/
-  GstCollectPads *collect;
+  GstCollectPads2 *collect;
 
   gint channels;
   gint padcounter;
@@ -65,10 +65,7 @@ struct _GstInterleave
   GstClockTime timestamp;
   guint64 offset;
 
-  gboolean segment_pending;
-  guint64 segment_position;
-  gdouble segment_rate;
-  GstSegment segment;
+  GstEvent *pending_segment;
 
   GstPadEventFunction collect_event;
 
diff --git a/gst/isomp4/LEGAL b/gst/isomp4/LEGAL
new file mode 100644
index 0000000..5af6e8f
--- /dev/null
+++ b/gst/isomp4/LEGAL
@@ -0,0 +1,10 @@
+This is a demuxer supporting a subset of the Quicktime video container
+format developed by Apple. Apple and others have some patents on
+some features of the Quicktime container format in regards to technologies
+such as QuicktimeVR and RTP hinting. Due to that be aware that if ever
+such features are added to this demuxer it would need to be moved to the
+-ugly module or those features need to come as add-in functionality stored in 
+another module.
+
+As the plugin is as of today's date (19th of June 2007) it does not 
+violate any software patents we know of.
diff --git a/gst/isomp4/Makefile.in b/gst/isomp4/Makefile.in
index d34d265..be1e70f 100644
--- a/gst/isomp4/Makefile.in
+++ b/gst/isomp4/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/isomp4
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -127,10 +143,23 @@ libgstisomp4_la_OBJECTS = $(am_libgstisomp4_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstisomp4_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstisomp4_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstisomp4_la_CFLAGS) $(CFLAGS) \
 	$(libgstisomp4_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -143,22 +172,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstisomp4_la_SOURCES)
 DIST_SOURCES = $(libgstisomp4_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -218,6 +248,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -266,8 +297,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -348,7 +381,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -408,6 +441,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -481,7 +515,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -562,7 +600,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -570,6 +607,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -585,12 +624,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstisomp4.la: $(libgstisomp4_la_OBJECTS) $(libgstisomp4_la_DEPENDENCIES) $(EXTRA_libgstisomp4_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstisomp4_la_LINK) -rpath $(plugindir) $(libgstisomp4_la_OBJECTS) $(libgstisomp4_la_LIBADD) $(LIBS)
 
@@ -781,6 +822,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -925,18 +980,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/isomp4/gstqtmux.c b/gst/isomp4/gstqtmux.c
index 5e9fcdd..04818a3 100644
--- a/gst/isomp4/gstqtmux.c
+++ b/gst/isomp4/gstqtmux.c
@@ -224,10 +224,11 @@ static GstPad *gst_qt_mux_request_new_pad (GstElement * element,
 static void gst_qt_mux_release_pad (GstElement * element, GstPad * pad);
 
 /* event */
-static gboolean gst_qt_mux_sink_event (GstPad * pad, GstEvent * event);
+static gboolean gst_qt_mux_sink_event (GstCollectPads2 * pads,
+    GstCollectData2 * data, GstEvent * event, gpointer user_data);
 
-static GstFlowReturn gst_qt_mux_collected (GstCollectPads * pads,
-    gpointer user_data);
+static GstFlowReturn gst_qt_mux_handle_buffer (GstCollectPads2 * pads,
+    GstCollectData2 * cdata, GstBuffer * buf, gpointer user_data);
 static GstFlowReturn gst_qt_mux_add_buffer (GstQTMux * qtmux, GstQTPad * pad,
     GstBuffer * buf);
 
@@ -482,9 +483,13 @@ gst_qt_mux_init (GstQTMux * qtmux, GstQTMuxClass * qtmux_klass)
   gst_element_add_pad (GST_ELEMENT (qtmux), qtmux->srcpad);
 
   qtmux->sinkpads = NULL;
-  qtmux->collect = gst_collect_pads_new ();
-  gst_collect_pads_set_function (qtmux->collect,
-      (GstCollectPadsFunction) GST_DEBUG_FUNCPTR (gst_qt_mux_collected), qtmux);
+  qtmux->collect = gst_collect_pads2_new ();
+  gst_collect_pads2_set_buffer_function (qtmux->collect,
+      GST_DEBUG_FUNCPTR (gst_qt_mux_handle_buffer), qtmux);
+  gst_collect_pads2_set_event_function (qtmux->collect,
+      GST_DEBUG_FUNCPTR (gst_qt_mux_sink_event), qtmux);
+  gst_collect_pads2_set_clip_function (qtmux->collect,
+      GST_DEBUG_FUNCPTR (gst_collect_pads2_clip_running_time), qtmux);
 
   /* properties set to default upon construction */
 
@@ -1608,6 +1613,31 @@ gst_qt_mux_start_file (GstQTMux * qtmux)
   gst_pad_set_caps (qtmux->srcpad, caps);
   gst_caps_unref (caps);
 
+  /* if not streaming, check if downstream is seekable */
+  if (!qtmux->streamable) {
+    gboolean seekable;
+    GstQuery *query;
+
+    query = gst_query_new_seeking (GST_FORMAT_BYTES);
+    if (gst_pad_peer_query (qtmux->srcpad, query)) {
+      gst_query_parse_seeking (query, NULL, &seekable, NULL, NULL);
+      GST_INFO_OBJECT (qtmux, "downstream is %sseekable",
+          seekable ? "" : "not ");
+      if (!seekable) {
+        qtmux->streamable = TRUE;
+        g_object_notify (G_OBJECT (qtmux), "streamable");
+        GST_WARNING_OBJECT (qtmux, "downstream is not seekable, but "
+            "streamable=false. Will ignore that and create streamable output "
+            "instead");
+      }
+    } else {
+      /* have to assume seeking is supported if query not handled downstream */
+      /* FIXME 0.11: change to query not handled => seeking not supported */
+      GST_WARNING_OBJECT (qtmux, "downstream did not handle seeking query");
+    }
+    gst_query_unref (query);
+  }
+
   /* let downstream know we think in BYTES and expect to do seeking later on */
   gst_pad_push_event (qtmux->srcpad,
       gst_event_new_new_segment (FALSE, 1.0, GST_FORMAT_BYTES, 0, -1, 0));
@@ -1642,7 +1672,7 @@ gst_qt_mux_start_file (GstQTMux * qtmux)
         gst_buffer_unref (prefix);
 
       for (walk = qtmux->sinkpads; walk && !fail; walk = g_slist_next (walk)) {
-        GstCollectData *cdata = (GstCollectData *) walk->data;
+        GstCollectData2 *cdata = (GstCollectData2 *) walk->data;
         GstQTPad *qpad = (GstQTPad *) cdata;
         /* write info for each stream */
         fail = atoms_recov_write_trak_info (qtmux->moov_recov_file, qpad->trak);
@@ -1742,7 +1772,7 @@ gst_qt_mux_stop_file (GstQTMux * qtmux)
 
   /* pushing last buffers for each pad */
   for (walk = qtmux->collect->data; walk; walk = g_slist_next (walk)) {
-    GstCollectData *cdata = (GstCollectData *) walk->data;
+    GstCollectData2 *cdata = (GstCollectData2 *) walk->data;
     GstQTPad *qtpad = (GstQTPad *) cdata;
 
     /* avoid add_buffer complaining if not negotiated
@@ -1835,7 +1865,7 @@ gst_qt_mux_stop_file (GstQTMux * qtmux)
   /* check for late streams */
   first_ts = GST_CLOCK_TIME_NONE;
   for (walk = qtmux->collect->data; walk; walk = g_slist_next (walk)) {
-    GstCollectData *cdata = (GstCollectData *) walk->data;
+    GstCollectData2 *cdata = (GstCollectData2 *) walk->data;
     GstQTPad *qtpad = (GstQTPad *) cdata;
 
     if (!GST_CLOCK_TIME_IS_VALID (first_ts) ||
@@ -1848,7 +1878,7 @@ gst_qt_mux_stop_file (GstQTMux * qtmux)
       GST_TIME_ARGS (first_ts));
   /* add EDTSs for late streams */
   for (walk = qtmux->collect->data; walk; walk = g_slist_next (walk)) {
-    GstCollectData *cdata = (GstCollectData *) walk->data;
+    GstCollectData2 *cdata = (GstCollectData2 *) walk->data;
     GstQTPad *qtpad = (GstQTPad *) cdata;
     guint32 lateness;
     guint32 duration;
@@ -2064,7 +2094,7 @@ static void
 check_and_subtract_ts (GstQTMux * qtmux, GstClockTime * ts_a, GstClockTime ts_b)
 {
   if (G_LIKELY (GST_CLOCK_TIME_IS_VALID (*ts_a))) {
-    if (G_LIKELY (*ts_a > ts_b)) {
+    if (G_LIKELY (*ts_a >= ts_b)) {
       *ts_a -= ts_b;
     } else {
       *ts_a = 0;
@@ -2501,14 +2531,13 @@ not_negotiated:
 }
 
 static GstFlowReturn
-gst_qt_mux_collected (GstCollectPads * pads, gpointer user_data)
+gst_qt_mux_handle_buffer (GstCollectPads2 * pads, GstCollectData2 * cdata,
+    GstBuffer * buf, gpointer user_data)
 {
   GstFlowReturn ret = GST_FLOW_OK;
   GstQTMux *qtmux = GST_QT_MUX_CAST (user_data);
-  GSList *walk;
   GstQTPad *best_pad = NULL;
-  GstClockTime time, best_time = GST_CLOCK_TIME_NONE;
-  GstBuffer *buf;
+  GstClockTime best_time = GST_CLOCK_TIME_NONE;
 
   if (G_UNLIKELY (qtmux->state == GST_QT_MUX_STATE_STARTED)) {
     if ((ret = gst_qt_mux_start_file (qtmux)) != GST_FLOW_OK)
@@ -2520,52 +2549,14 @@ gst_qt_mux_collected (GstCollectPads * pads, gpointer user_data)
   if (G_UNLIKELY (qtmux->state == GST_QT_MUX_STATE_EOS))
     return GST_FLOW_UNEXPECTED;
 
-  /* select the best buffer */
-  walk = qtmux->collect->data;
-  while (walk) {
-    GstQTPad *pad;
-    GstCollectData *data;
-
-    data = (GstCollectData *) walk->data;
-    pad = (GstQTPad *) data;
-
-    walk = g_slist_next (walk);
-
-    buf = gst_collect_pads_peek (pads, data);
-    if (buf == NULL) {
-      GST_LOG_OBJECT (qtmux, "Pad %s has no buffers",
-          GST_PAD_NAME (pad->collect.pad));
-      continue;
-    }
-    time = GST_BUFFER_TIMESTAMP (buf);
-    gst_buffer_unref (buf);
-
-    /* invalid should pass */
-    if (G_LIKELY (GST_CLOCK_TIME_IS_VALID (time))) {
-      time =
-          gst_segment_to_running_time (&data->segment, GST_FORMAT_TIME, time);
-      if (G_UNLIKELY (!GST_CLOCK_TIME_IS_VALID (time))) {
-        GST_DEBUG_OBJECT (qtmux, "clipping buffer on pad %s outside segment",
-            GST_PAD_NAME (data->pad));
-        buf = gst_collect_pads_pop (pads, data);
-        gst_buffer_unref (buf);
-        return GST_FLOW_OK;
-      }
-    }
-
-    if (best_pad == NULL || !GST_CLOCK_TIME_IS_VALID (time) ||
-        (GST_CLOCK_TIME_IS_VALID (best_time) && time < best_time)) {
-      best_pad = pad;
-      best_time = time;
-    }
-  }
+  best_pad = (GstQTPad *) cdata;
 
+  /* clipping already converted to running time */
   if (best_pad != NULL) {
+    g_assert (buf);
+    best_time = GST_BUFFER_TIMESTAMP (buf);
     GST_LOG_OBJECT (qtmux, "selected pad %s with time %" GST_TIME_FORMAT,
         GST_PAD_NAME (best_pad->collect.pad), GST_TIME_ARGS (best_time));
-    buf = gst_collect_pads_pop (pads, &best_pad->collect);
-    buf = gst_buffer_make_metadata_writable (buf);
-    GST_BUFFER_TIMESTAMP (buf) = best_time;
     ret = gst_qt_mux_add_buffer (qtmux, best_pad, buf);
   } else {
     ret = gst_qt_mux_stop_file (qtmux);
@@ -3263,13 +3254,14 @@ refuse_renegotiation:
 }
 
 static gboolean
-gst_qt_mux_sink_event (GstPad * pad, GstEvent * event)
+gst_qt_mux_sink_event (GstCollectPads2 * pads, GstCollectData2 * data,
+    GstEvent * event, gpointer user_data)
 {
-  gboolean ret;
   GstQTMux *qtmux;
   guint32 avg_bitrate = 0, max_bitrate = 0;
+  GstPad *pad = data->pad;
 
-  qtmux = GST_QT_MUX_CAST (gst_pad_get_parent (pad));
+  qtmux = GST_QT_MUX_CAST (user_data);
   switch (GST_EVENT_TYPE (event)) {
     case GST_EVENT_TAG:{
       GstTagList *list;
@@ -3279,8 +3271,9 @@ gst_qt_mux_sink_event (GstPad * pad, GstEvent * event)
       GST_OBJECT_LOCK (qtmux);
       mode = gst_tag_setter_get_tag_merge_mode (setter);
 
-      GST_DEBUG_OBJECT (qtmux, "received tag event");
       gst_event_parse_tag (event, &list);
+      GST_DEBUG_OBJECT (qtmux, "received tag event on pad %s:%s : %"
+          GST_PTR_FORMAT, GST_DEBUG_PAD_NAME (pad), list);
 
       gst_tag_setter_merge_tags (setter, list, mode);
       GST_OBJECT_UNLOCK (qtmux);
@@ -3302,10 +3295,8 @@ gst_qt_mux_sink_event (GstPad * pad, GstEvent * event)
       break;
   }
 
-  ret = qtmux->collect_event (pad, event);
-  gst_object_unref (qtmux);
-
-  return ret;
+  /* now GstCollectPads2 can take care of the rest, e.g. EOS */
+  return FALSE;
 }
 
 static void
@@ -3327,7 +3318,7 @@ gst_qt_mux_release_pad (GstElement * element, GstPad * pad)
     }
   }
 
-  gst_collect_pads_remove_pad (mux->collect, pad);
+  gst_collect_pads2_remove_pad (mux->collect, pad);
 }
 
 static GstPad *
@@ -3362,8 +3353,8 @@ gst_qt_mux_request_new_pad (GstElement * element,
   newpad = gst_pad_new_from_template (templ, name);
   g_free (name);
   collect_pad = (GstQTPad *)
-      gst_collect_pads_add_pad_full (qtmux->collect, newpad, sizeof (GstQTPad),
-      (GstCollectDataDestroyNotify) (gst_qt_mux_pad_reset));
+      gst_collect_pads2_add_pad_full (qtmux->collect, newpad, sizeof (GstQTPad),
+      (GstCollectData2DestroyNotify) (gst_qt_mux_pad_reset), TRUE);
   /* set up pad */
   gst_qt_mux_pad_reset (collect_pad);
   collect_pad->trak = atom_trak_new (qtmux->context);
@@ -3379,14 +3370,6 @@ gst_qt_mux_request_new_pad (GstElement * element,
     gst_pad_set_setcaps_function (newpad,
         GST_DEBUG_FUNCPTR (gst_qt_mux_video_sink_set_caps));
 
-  /* FIXME: hacked way to override/extend the event function of
-   * GstCollectPads; because it sets its own event function giving the
-   * element no access to events.
-   */
-  qtmux->collect_event = (GstPadEventFunction) GST_PAD_EVENTFUNC (newpad);
-  gst_pad_set_event_function (newpad,
-      GST_DEBUG_FUNCPTR (gst_qt_mux_sink_event));
-
   gst_pad_set_active (newpad, TRUE);
   gst_element_add_pad (element, newpad);
 
@@ -3523,13 +3506,13 @@ gst_qt_mux_change_state (GstElement * element, GstStateChange transition)
     case GST_STATE_CHANGE_NULL_TO_READY:
       break;
     case GST_STATE_CHANGE_READY_TO_PAUSED:
-      gst_collect_pads_start (qtmux->collect);
+      gst_collect_pads2_start (qtmux->collect);
       qtmux->state = GST_QT_MUX_STATE_STARTED;
       break;
     case GST_STATE_CHANGE_PAUSED_TO_PLAYING:
       break;
     case GST_STATE_CHANGE_PAUSED_TO_READY:
-      gst_collect_pads_stop (qtmux->collect);
+      gst_collect_pads2_stop (qtmux->collect);
       break;
     default:
       break;
diff --git a/gst/isomp4/gstqtmux.h b/gst/isomp4/gstqtmux.h
index 1851973..b23982b 100644
--- a/gst/isomp4/gstqtmux.h
+++ b/gst/isomp4/gstqtmux.h
@@ -44,7 +44,7 @@
 #define __GST_QT_MUX_H__
 
 #include <gst/gst.h>
-#include <gst/base/gstcollectpads.h>
+#include <gst/base/gstcollectpads2.h>
 
 #include "fourcc.h"
 #include "atoms.h"
@@ -82,7 +82,7 @@ typedef GstBuffer * (*GstQTPadPrepareBufferFunc) (GstQTPad * pad,
 
 struct _GstQTPad
 {
-  GstCollectData collect;       /* we extend the CollectData */
+  GstCollectData2 collect;       /* we extend the CollectData2 */
 
   /* fourcc id of stream */
   guint32 fourcc;
@@ -144,7 +144,7 @@ struct _GstQTMux
   GstElement element;
 
   GstPad *srcpad;
-  GstCollectPads *collect;
+  GstCollectPads2 *collect;
   GSList *sinkpads;
 
   /* state */
@@ -191,9 +191,6 @@ struct _GstQTMux
   guint32 fragment_duration;
   gboolean streamable;
 
-  /* for collect pads event handling function */
-  GstPadEventFunction collect_event;
-
   /* for request pad naming */
   guint video_pads, audio_pads;
 };
diff --git a/gst/isomp4/gstqtmuxmap.c b/gst/isomp4/gstqtmuxmap.c
index e0fb78b..362b1b6 100644
--- a/gst/isomp4/gstqtmuxmap.c
+++ b/gst/isomp4/gstqtmuxmap.c
@@ -176,6 +176,7 @@ GstQTMuxFormatProp gst_qt_mux_format_list[] = {
             AAC_CAPS " ; "
             ADPCM_CAPS " ; "
             "audio/x-alaw, " COMMON_AUDIO_CAPS (2, MAX) "; "
+            "audio/x-mulaw, " COMMON_AUDIO_CAPS (2, MAX) "; "
             AMR_CAPS " ; " ALAC_CAPS)
       }
   ,
diff --git a/gst/isomp4/qtdemux.c b/gst/isomp4/qtdemux.c
index 14d5413..ea94cb2 100644
--- a/gst/isomp4/qtdemux.c
+++ b/gst/isomp4/qtdemux.c
@@ -2389,11 +2389,43 @@ unknown_stream:
 }
 
 static gboolean
+qtdemux_parse_tfdt (GstQTDemux * qtdemux, GstByteReader * br,
+    guint64 * decode_time)
+{
+  guint32 version = 0;
+
+  if (!gst_byte_reader_get_uint32_be (br, &version))
+    return FALSE;
+
+  version >>= 24;
+  if (version == 1) {
+    if (!gst_byte_reader_get_uint64_be (br, decode_time))
+      goto failed;
+  } else {
+    guint32 dec_time = 0;
+    if (!gst_byte_reader_get_uint32_be (br, &dec_time))
+      goto failed;
+    *decode_time = dec_time;
+  }
+
+  GST_INFO_OBJECT (qtdemux, "Track fragment decode time: %" G_GUINT64_FORMAT,
+      *decode_time);
+
+  return TRUE;
+
+failed:
+  {
+    GST_DEBUG_OBJECT (qtdemux, "parsing tfdt failed");
+    return FALSE;
+  }
+}
+
+static gboolean
 qtdemux_parse_moof (GstQTDemux * qtdemux, const guint8 * buffer, guint length,
     guint64 moof_offset, QtDemuxStream * stream)
 {
-  GNode *moof_node, *traf_node, *tfhd_node, *trun_node;
-  GstByteReader trun_data, tfhd_data;
+  GNode *moof_node, *traf_node, *tfhd_node, *trun_node, *tfdt_node;
+  GstByteReader trun_data, tfhd_data, tfdt_data;
   guint32 ds_size = 0, ds_duration = 0, ds_flags = 0;
   gint64 base_offset, running_offset;
 
@@ -2416,6 +2448,24 @@ qtdemux_parse_moof (GstQTDemux * qtdemux, const guint8 * buffer, guint length,
     if (!qtdemux_parse_tfhd (qtdemux, &tfhd_data, &stream, &ds_duration,
             &ds_size, &ds_flags, &base_offset))
       goto missing_tfhd;
+    tfdt_node =
+        qtdemux_tree_get_child_by_type_full (traf_node, FOURCC_tfdt,
+        &tfdt_data);
+    if (tfdt_node) {
+      guint64 decode_time = 0;
+      qtdemux_parse_tfdt (qtdemux, &tfdt_data, &decode_time);
+      /* If there is a new segment pending, update the time/position */
+      if (qtdemux->pending_newsegment) {
+        gst_event_replace (&qtdemux->pending_newsegment,
+            gst_event_new_new_segment (FALSE, 1.0, GST_FORMAT_TIME,
+                0, GST_CLOCK_TIME_NONE,
+                gst_util_uint64_scale (decode_time,
+                    GST_SECOND, stream->timescale)));
+        /* ref added when replaced, release the original _new one */
+        gst_event_unref (qtdemux->pending_newsegment);
+      }
+    }
+
     if (G_UNLIKELY (!stream)) {
       /* we lost track of offset, we'll need to regain it,
        * but can delay complaining until later or avoid doing so altogether */
@@ -4174,25 +4224,32 @@ gst_qtdemux_chain (GstPad * sinkpad, GstBuffer * inbuf)
         extract_initial_length_and_fourcc (data, demux->neededbytes, NULL,
             &fourcc);
         if (fourcc == FOURCC_moov) {
-          GST_DEBUG_OBJECT (demux, "Parsing [moov]");
+          /* in usual fragmented setup we could try to scan for more
+           * and end up at the the moov (after mdat) again */
+          if (demux->got_moov && demux->n_streams > 0) {
+            GST_DEBUG_OBJECT (demux,
+                "Skipping moov atom as we have one already");
+          } else {
+            GST_DEBUG_OBJECT (demux, "Parsing [moov]");
 
-          demux->got_moov = TRUE;
+            demux->got_moov = TRUE;
 
-          /* prepare newsegment to send when streaming actually starts */
-          if (!demux->pending_newsegment) {
-            demux->pending_newsegment =
-                gst_event_new_new_segment (FALSE, 1.0, GST_FORMAT_TIME,
-                0, GST_CLOCK_TIME_NONE, 0);
-          }
+            /* prepare newsegment to send when streaming actually starts */
+            if (!demux->pending_newsegment) {
+              demux->pending_newsegment =
+                  gst_event_new_new_segment (FALSE, 1.0, GST_FORMAT_TIME,
+                  0, GST_CLOCK_TIME_NONE, 0);
+            }
 
-          qtdemux_parse_moov (demux, data, demux->neededbytes);
-          qtdemux_node_dump (demux, demux->moov_node);
-          qtdemux_parse_tree (demux);
-          qtdemux_expose_streams (demux);
+            qtdemux_parse_moov (demux, data, demux->neededbytes);
+            qtdemux_node_dump (demux, demux->moov_node);
+            qtdemux_parse_tree (demux);
+            qtdemux_expose_streams (demux);
 
-          g_node_destroy (demux->moov_node);
-          demux->moov_node = NULL;
-          GST_DEBUG_OBJECT (demux, "Finished parsing the header");
+            g_node_destroy (demux->moov_node);
+            demux->moov_node = NULL;
+            GST_DEBUG_OBJECT (demux, "Finished parsing the header");
+          }
         } else if (fourcc == FOURCC_moof) {
           if (demux->got_moov && demux->fragmented) {
             GST_DEBUG_OBJECT (demux, "Parsing [moof]");
@@ -4791,6 +4848,11 @@ qtdemux_parse_node (GstQTDemux * qtdemux, GNode * node, const guint8 * buffer,
       case FOURCC_MP4V:
       case FOURCC_fmp4:
       case FOURCC_FMP4:
+      case FOURCC_apcs:
+      case FOURCC_apch:
+      case FOURCC_apcn:
+      case FOURCC_apco:
+      case FOURCC_ap4h:
       {
         const guint8 *buf;
         guint32 version;
@@ -7199,9 +7261,8 @@ qtdemux_parse_trak (GstQTDemux * qtdemux, GNode * trak)
               waveheader += 8;
               headerlen -= 8;
 
-              headerbuf = gst_buffer_new ();
-              GST_BUFFER_DATA (headerbuf) = (guint8 *) waveheader;
-              GST_BUFFER_SIZE (headerbuf) = headerlen;
+              headerbuf = gst_buffer_new_and_alloc (headerlen);
+              memcpy (GST_BUFFER_DATA (headerbuf), waveheader, headerlen);
 
               if (gst_riff_parse_strf_auds (GST_ELEMENT_CAST (qtdemux),
                       headerbuf, &header, &extra)) {
@@ -7211,6 +7272,7 @@ qtdemux_parse_trak (GstQTDemux * qtdemux, GNode * trak)
 
                 if (extra)
                   gst_buffer_unref (extra);
+                g_free (header);
               }
             }
           } else
@@ -9463,6 +9525,36 @@ qtdemux_video_caps (GstQTDemux * qtdemux, QtDemuxStream * stream,
       _codec ("On2 VP8");
       caps = gst_caps_from_string ("video/x-vp8");
       break;
+    case GST_MAKE_FOURCC ('a', 'p', 'c', 's'):
+      _codec ("Apple ProRes LT");
+      caps =
+          gst_caps_new_simple ("video/x-prores", "variant", G_TYPE_STRING, "lt",
+          NULL);
+      break;
+    case GST_MAKE_FOURCC ('a', 'p', 'c', 'h'):
+      _codec ("Apple ProRes HQ");
+      caps =
+          gst_caps_new_simple ("video/x-prores", "variant", G_TYPE_STRING, "hq",
+          NULL);
+      break;
+    case GST_MAKE_FOURCC ('a', 'p', 'c', 'n'):
+      _codec ("Apple ProRes");
+      caps =
+          gst_caps_new_simple ("video/x-prores", "variant", G_TYPE_STRING,
+          "standard", NULL);
+      break;
+    case GST_MAKE_FOURCC ('a', 'p', 'c', 'o'):
+      _codec ("Apple ProRes Proxy");
+      caps =
+          gst_caps_new_simple ("video/x-prores", "variant", G_TYPE_STRING,
+          "proxy", NULL);
+      break;
+    case GST_MAKE_FOURCC ('a', 'p', '4', 'h'):
+      _codec ("Apple ProRes 4444");
+      caps =
+          gst_caps_new_simple ("video/x-prores", "variant", G_TYPE_STRING,
+          "4444", NULL);
+      break;
     case FOURCC_ovc1:
       _codec ("VC-1");
       caps = gst_caps_new_simple ("video/x-wmv",
diff --git a/gst/isomp4/qtdemux.h b/gst/isomp4/qtdemux.h
index 8d35ead..f2d839d 100644
--- a/gst/isomp4/qtdemux.h
+++ b/gst/isomp4/qtdemux.h
@@ -46,7 +46,7 @@ GST_DEBUG_CATEGORY_EXTERN (qtdemux_debug);
 #define GST_QT_DEMUX_PRIVATE_TAG "private-qt-tag"
 #define GST_QT_DEMUX_CLASSIFICATION_TAG "classification"
 
-#define GST_QTDEMUX_MAX_STREAMS         8
+#define GST_QTDEMUX_MAX_STREAMS         32
 
 typedef struct _GstQTDemux GstQTDemux;
 typedef struct _GstQTDemuxClass GstQTDemuxClass;
diff --git a/gst/isomp4/qtdemux_dump.c b/gst/isomp4/qtdemux_dump.c
index fa66767..e8dd57e 100644
--- a/gst/isomp4/qtdemux_dump.c
+++ b/gst/isomp4/qtdemux_dump.c
@@ -721,6 +721,28 @@ qtdemux_dump_mehd (GstQTDemux * qtdemux, GstByteReader * data, int depth)
 }
 
 gboolean
+qtdemux_dump_tfdt (GstQTDemux * qtdemux, GstByteReader * data, int depth)
+{
+  guint32 version = 0;
+  guint64 decode_time;
+  guint value_size;
+
+  if (!gst_byte_reader_get_uint32_be (data, &version))
+    return FALSE;
+
+  GST_LOG ("%*s  version/flags: %08x", depth, "", version);
+
+  value_size = ((version >> 24) == 1) ? sizeof (guint64) : sizeof (guint32);
+  if (qt_atom_parser_get_offset (data, value_size, &decode_time)) {
+    GST_LOG ("%*s  Track fragment decode time: %" G_GUINT64_FORMAT,
+        depth, "", decode_time);
+    return TRUE;
+  }
+
+  return FALSE;
+}
+
+gboolean
 qtdemux_dump_sdtp (GstQTDemux * qtdemux, GstByteReader * data, int depth)
 {
   guint32 version;
diff --git a/gst/isomp4/qtdemux_dump.h b/gst/isomp4/qtdemux_dump.h
index 9bb1f95..d5486ee 100644
--- a/gst/isomp4/qtdemux_dump.h
+++ b/gst/isomp4/qtdemux_dump.h
@@ -75,6 +75,8 @@ gboolean qtdemux_dump_mehd (GstQTDemux * qtdemux, GstByteReader * data,
     int depth);
 gboolean qtdemux_dump_sdtp (GstQTDemux * qtdemux, GstByteReader * data,
     int depth);
+gboolean qtdemux_dump_tfdt (GstQTDemux * qtdemux, GstByteReader * data,
+    int depth);
 gboolean qtdemux_dump_unknown (GstQTDemux * qtdemux, GstByteReader * data,
     int depth);
 
diff --git a/gst/isomp4/qtdemux_fourcc.h b/gst/isomp4/qtdemux_fourcc.h
index 6666a94..d747825 100644
--- a/gst/isomp4/qtdemux_fourcc.h
+++ b/gst/isomp4/qtdemux_fourcc.h
@@ -173,6 +173,11 @@ G_BEGIN_DECLS
 #define FOURCC_tx3g     GST_MAKE_FOURCC('t','x','3','g')
 #define FOURCC_mp4s     GST_MAKE_FOURCC('m','p','4','s')
 #define FOURCC_gama     GST_MAKE_FOURCC('g','a','m','a')
+#define FOURCC_apcs     GST_MAKE_FOURCC('a','p','c','s')
+#define FOURCC_apch     GST_MAKE_FOURCC('a','p','c','h')
+#define FOURCC_apcn     GST_MAKE_FOURCC('a','p','c','n')
+#define FOURCC_apco     GST_MAKE_FOURCC('a','p','c','o')
+#define FOURCC_ap4h     GST_MAKE_FOURCC('a','p','4','h')
 
 /* SVQ3 fourcc */
 #define FOURCC_SEQH     GST_MAKE_FOURCC('S','E','Q','H')
@@ -230,6 +235,9 @@ G_BEGIN_DECLS
 #define FOURCC_ovc1     GST_MAKE_FOURCC('o','v','c','1')
 #define FOURCC_owma     GST_MAKE_FOURCC('o','w','m','a')
 
+/* MPEG DASH */
+#define FOURCC_tfdt     GST_MAKE_FOURCC('t','f','d','t')
+
 G_END_DECLS
 
 #endif /* __GST_QTDEMUX_FOURCC_H__ */
diff --git a/gst/isomp4/qtdemux_types.c b/gst/isomp4/qtdemux_types.c
index 38da35b..65afc8e 100644
--- a/gst/isomp4/qtdemux_types.c
+++ b/gst/isomp4/qtdemux_types.c
@@ -171,6 +171,7 @@ static const QtNodeType qt_node_types[] = {
       qtdemux_dump_mehd},
   {FOURCC_ovc1, "ovc1", 0},
   {FOURCC_owma, "owma", 0},
+  {FOURCC_tfdt, "Track fragment decode time", 0, qtdemux_dump_tfdt},
   {0, "unknown", 0,},
 };
 
diff --git a/gst/law/Makefile.in b/gst/law/Makefile.in
index dff15f8..5911050 100644
--- a/gst/law/Makefile.in
+++ b/gst/law/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/law
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -118,6 +134,7 @@ libgstalaw_la_OBJECTS = $(am_libgstalaw_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstalaw_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstalaw_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstalaw_la_CFLAGS) $(CFLAGS) \
@@ -131,6 +148,18 @@ libgstmulaw_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstmulaw_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstmulaw_la_CFLAGS) $(CFLAGS) \
 	$(libgstmulaw_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -143,22 +172,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstalaw_la_SOURCES) $(libgstmulaw_la_SOURCES)
 DIST_SOURCES = $(libgstalaw_la_SOURCES) $(libgstmulaw_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -218,6 +248,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -266,8 +297,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -348,7 +381,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -408,6 +441,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -481,7 +515,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -533,7 +571,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -541,6 +578,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -556,12 +595,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstalaw.la: $(libgstalaw_la_OBJECTS) $(libgstalaw_la_DEPENDENCIES) $(EXTRA_libgstalaw_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstalaw_la_LINK) -rpath $(plugindir) $(libgstalaw_la_OBJECTS) $(libgstalaw_la_LIBADD) $(LIBS)
 libgstmulaw.la: $(libgstmulaw_la_OBJECTS) $(libgstmulaw_la_DEPENDENCIES) $(EXTRA_libgstmulaw_la_DEPENDENCIES) 
@@ -706,6 +747,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -850,18 +905,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/law/mulaw-conversion.c b/gst/law/mulaw-conversion.c
index 8afae80..190a9f5 100644
--- a/gst/law/mulaw-conversion.c
+++ b/gst/law/mulaw-conversion.c
@@ -51,9 +51,10 @@ mulaw_encode (gint16 * in, guint8 * out, gint numsamples)
     7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
     7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7
   };
-  gint16 sign, exponent, mantissa, i;
+  gint16 sign, exponent, mantissa;
   gint16 sample;
   guint8 ulawbyte;
+  gint i;
 
   for (i = 0; i < numsamples; i++) {
     sample = in[i];
@@ -102,7 +103,8 @@ mulaw_decode (guint8 * in, gint16 * out, gint numsamples)
   static gint16 exp_lut[8] = { 0, 132, 396, 924, 1980, 4092, 8316, 16764 };
   gint16 sign, exponent, mantissa;
   guint8 ulawbyte;
-  gint16 linear, i;
+  gint16 linear;
+  gint i;
 
   for (i = 0; i < numsamples; i++) {
     ulawbyte = in[i];
diff --git a/gst/level/Makefile.in b/gst/level/Makefile.in
index 691dec8..a8f2091 100644
--- a/gst/level/Makefile.in
+++ b/gst/level/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/level
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -118,10 +134,23 @@ libgstlevel_la_OBJECTS = $(am_libgstlevel_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstlevel_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstlevel_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstlevel_la_CFLAGS) $(CFLAGS) \
 	$(libgstlevel_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -134,22 +163,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstlevel_la_SOURCES)
 DIST_SOURCES = $(libgstlevel_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -209,6 +239,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -257,8 +288,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -339,7 +372,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -399,6 +432,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -472,7 +506,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -519,7 +557,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -527,6 +564,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -542,12 +581,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstlevel.la: $(libgstlevel_la_OBJECTS) $(libgstlevel_la_DEPENDENCIES) $(EXTRA_libgstlevel_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstlevel_la_LINK) -rpath $(plugindir) $(libgstlevel_la_OBJECTS) $(libgstlevel_la_LIBADD) $(LIBS)
 
@@ -642,6 +683,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -786,18 +841,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/level/gstlevel.c b/gst/level/gstlevel.c
index 6d89a68..e2c6bb0 100644
--- a/gst/level/gstlevel.c
+++ b/gst/level/gstlevel.c
@@ -359,7 +359,6 @@ gst_level_calculate_##TYPE (gpointer data, guint num, guint channels,         \
                                                                               \
   normalizer = (gdouble) (G_GINT64_CONSTANT(1) << (RESOLUTION * 2));          \
                                                                               \
-  /* oil_squaresum_shifted_s16(&squaresum,in,num); */                         \
   for (j = 0; j < num; j += channels)                                         \
   {                                                                           \
     square = ((gdouble) in[j]) * in[j];                                       \
diff --git a/gst/matroska/Makefile.in b/gst/matroska/Makefile.in
index d21f919..5600a82 100644
--- a/gst/matroska/Makefile.in
+++ b/gst/matroska/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/matroska
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -127,10 +143,23 @@ libgstmatroska_la_OBJECTS = $(am_libgstmatroska_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstmatroska_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstmatroska_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstmatroska_la_CFLAGS) $(CFLAGS) \
 	$(libgstmatroska_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -143,22 +172,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstmatroska_la_SOURCES)
 DIST_SOURCES = $(libgstmatroska_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -218,6 +248,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -266,8 +297,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -348,7 +381,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -408,6 +441,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -481,7 +515,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -565,7 +603,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -573,6 +610,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -588,12 +627,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstmatroska.la: $(libgstmatroska_la_OBJECTS) $(libgstmatroska_la_DEPENDENCIES) $(EXTRA_libgstmatroska_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstmatroska_la_LINK) -rpath $(plugindir) $(libgstmatroska_la_OBJECTS) $(libgstmatroska_la_LIBADD) $(LIBS)
 
@@ -760,6 +801,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -904,18 +959,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/matroska/matroska-demux.c b/gst/matroska/matroska-demux.c
index 6e49baa..e9ce024 100644
--- a/gst/matroska/matroska-demux.c
+++ b/gst/matroska/matroska-demux.c
@@ -173,7 +173,7 @@ static GstCaps
 /* stream methods */
 static void gst_matroska_demux_reset (GstElement * element);
 static gboolean perform_seek_to_offset (GstMatroskaDemux * demux,
-    guint64 offset);
+    gdouble rate, guint64 offset);
 
 /* gobject functions */
 static void gst_matroska_demux_set_property (GObject * object,
@@ -438,6 +438,7 @@ gst_matroska_demux_reset (GstElement * element)
   demux->last_stop_end = GST_CLOCK_TIME_NONE;
   demux->seek_block = 0;
   demux->stream_start_time = GST_CLOCK_TIME_NONE;
+  demux->to_time = GST_CLOCK_TIME_NONE;
 
   demux->common.offset = 0;
   demux->cluster_time = GST_CLOCK_TIME_NONE;
@@ -446,6 +447,8 @@ gst_matroska_demux_reset (GstElement * element)
   demux->index_offset = 0;
   demux->seekable = FALSE;
   demux->need_newsegment = FALSE;
+  demux->requested_seek_time = GST_CLOCK_TIME_NONE;
+  demux->seek_offset = -1;
   demux->building_index = FALSE;
   if (demux->seek_event) {
     gst_event_unref (demux->seek_event);
@@ -555,6 +558,8 @@ gst_matroska_demux_add_stream (GstMatroskaDemux * demux, GstEbmlRead * ebml)
       GST_MATROSKA_TRACK_ENABLED | GST_MATROSKA_TRACK_DEFAULT |
       GST_MATROSKA_TRACK_LACING;
   context->last_flow = GST_FLOW_OK;
+  context->from_time = GST_CLOCK_TIME_NONE;
+  context->from_offset = -1;
   context->to_offset = G_MAXINT64;
   context->alignment = 1;
   demux->common.num_streams++;
@@ -1371,6 +1376,7 @@ gst_matroska_demux_query (GstMatroskaDemux * demux, GstPad * pad,
 
       gst_query_parse_position (query, &format, NULL);
 
+      res = TRUE;
       if (format == GST_FORMAT_TIME) {
         GST_OBJECT_LOCK (demux);
         if (context)
@@ -1391,9 +1397,9 @@ gst_matroska_demux_query (GstMatroskaDemux * demux, GstPad * pad,
       } else {
         GST_DEBUG_OBJECT (demux,
             "only position query in TIME and DEFAULT format is supported");
+        res = FALSE;
       }
 
-      res = TRUE;
       break;
     }
     case GST_QUERY_DURATION:
@@ -1402,6 +1408,7 @@ gst_matroska_demux_query (GstMatroskaDemux * demux, GstPad * pad,
 
       gst_query_parse_duration (query, &format, NULL);
 
+      res = TRUE;
       if (format == GST_FORMAT_TIME) {
         GST_OBJECT_LOCK (demux);
         gst_query_set_duration (query, GST_FORMAT_TIME,
@@ -1416,9 +1423,8 @@ gst_matroska_demux_query (GstMatroskaDemux * demux, GstPad * pad,
       } else {
         GST_DEBUG_OBJECT (demux,
             "only duration query in TIME and DEFAULT format is supported");
+        res = FALSE;
       }
-
-      res = TRUE;
       break;
     }
 
@@ -1543,26 +1549,30 @@ gst_matroska_demux_element_send_event (GstElement * element, GstEvent * event)
 
 static gboolean
 gst_matroska_demux_move_to_entry (GstMatroskaDemux * demux,
-    GstMatroskaIndex * entry, gboolean reset)
+    GstMatroskaIndex * entry, gboolean reset, gboolean update)
 {
   gint i;
 
   GST_OBJECT_LOCK (demux);
 
-  /* seek (relative to matroska segment) */
-  /* position might be invalid; will error when streaming resumes ... */
-  demux->common.offset = entry->pos + demux->common.ebml_segment_start;
+  if (update) {
+    /* seek (relative to matroska segment) */
+    /* position might be invalid; will error when streaming resumes ... */
+    demux->common.offset = entry->pos + demux->common.ebml_segment_start;
+    demux->next_cluster_offset = 0;
 
-  GST_DEBUG_OBJECT (demux, "Seeked to offset %" G_GUINT64_FORMAT ", block %d, "
-      "time %" GST_TIME_FORMAT, entry->pos + demux->common.ebml_segment_start,
-      entry->block, GST_TIME_ARGS (entry->time));
+    GST_DEBUG_OBJECT (demux,
+        "Seeked to offset %" G_GUINT64_FORMAT ", block %d, " "time %"
+        GST_TIME_FORMAT, entry->pos + demux->common.ebml_segment_start,
+        entry->block, GST_TIME_ARGS (entry->time));
 
-  /* update the time */
-  gst_matroska_read_common_reset_streams (&demux->common, entry->time, TRUE);
-  demux->common.segment.last_stop = entry->time;
-  demux->seek_block = entry->block;
-  demux->seek_first = TRUE;
-  demux->last_stop_end = GST_CLOCK_TIME_NONE;
+    /* update the time */
+    gst_matroska_read_common_reset_streams (&demux->common, entry->time, TRUE);
+    demux->common.segment.last_stop = entry->time;
+    demux->seek_block = entry->block;
+    demux->seek_first = TRUE;
+    demux->last_stop_end = GST_CLOCK_TIME_NONE;
+  }
 
   for (i = 0; i < demux->common.src->len; i++) {
     GstMatroskaTrackContext *stream = g_ptr_array_index (demux->common.src, i);
@@ -1574,6 +1584,7 @@ gst_matroska_demux_move_to_entry (GstMatroskaDemux * demux,
         stream->to_offset = stream->from_offset;
     }
     stream->from_offset = -1;
+    stream->from_time = GST_CLOCK_TIME_NONE;
   }
 
   GST_OBJECT_UNLOCK (demux);
@@ -1904,12 +1915,13 @@ gst_matroska_demux_handle_seek_event (GstMatroskaDemux * demux,
   GstSeekFlags flags;
   GstSeekType cur_type, stop_type;
   GstFormat format;
-  gboolean flush, keyunit;
+  gboolean flush, keyunit, before, after, snap_next;
   gdouble rate;
   gint64 cur, stop;
   GstMatroskaTrackContext *track = NULL;
   GstSegment seeksegment = { 0, };
   gboolean update = TRUE;
+  gboolean pad_locked = FALSE;
 
   if (pad)
     track = gst_pad_get_element_private (pad);
@@ -1931,8 +1943,7 @@ gst_matroska_demux_handle_seek_event (GstMatroskaDemux * demux,
    * we might be playing a file that's still being recorded
    * so, invalidate our current duration, which is only a moving target,
    * and should not be used to clamp anything */
-  if (!demux->streaming && !demux->common.index &&
-      demux->invalid_duration) {
+  if (!demux->streaming && !demux->common.index && demux->invalid_duration) {
     gst_segment_set_duration (&seeksegment, GST_FORMAT_TIME,
         GST_CLOCK_TIME_NONE);
   }
@@ -1941,13 +1952,20 @@ gst_matroska_demux_handle_seek_event (GstMatroskaDemux * demux,
     GST_DEBUG_OBJECT (demux, "configuring seek");
     gst_segment_set_seek (&seeksegment, rate, format, flags,
         cur_type, cur, stop_type, stop, &update);
-    /* compensate for clip start time */
+    /* compensate for clip start time, but only for SET seeks,
+     * otherwise it is already part of the segments */
     if (GST_CLOCK_TIME_IS_VALID (demux->stream_start_time)) {
-      seeksegment.last_stop += demux->stream_start_time;
-      seeksegment.start += demux->stream_start_time;
-      if (GST_CLOCK_TIME_IS_VALID (seeksegment.stop))
+      if (cur_type == GST_SEEK_TYPE_SET) {
+        if (rate > 0.0)
+          seeksegment.last_stop += demux->stream_start_time;
+        seeksegment.start += demux->stream_start_time;
+      }
+      if (stop_type == GST_SEEK_TYPE_SET
+          && GST_CLOCK_TIME_IS_VALID (seeksegment.stop)) {
+        if (rate < 0.0)
+          seeksegment.last_stop += demux->stream_start_time;
         seeksegment.stop += demux->stream_start_time;
-      /* note that time should stay at indicated position */
+      }
     }
   }
 
@@ -1958,41 +1976,54 @@ gst_matroska_demux_handle_seek_event (GstMatroskaDemux * demux,
 
   flush = ! !(flags & GST_SEEK_FLAG_FLUSH);
   keyunit = ! !(flags & GST_SEEK_FLAG_KEY_UNIT);
+  after = ! !(flags & GST_SEEK_FLAG_SNAP_AFTER);
+  before = ! !(flags & GST_SEEK_FLAG_SNAP_BEFORE);
 
-  GST_DEBUG_OBJECT (demux, "New segment %" GST_SEGMENT_FORMAT, &seeksegment);
+  /* always do full update if flushing, otherwise problems might arise
+   * downstream with missing keyframes etc. */
+  update = update || flush;
 
-  if (!update) {
-    /* only have to update some segment,
-     * but also still have to honour flush and so on */
-    GST_DEBUG_OBJECT (demux, "... no update");
-    /* bad goto, bad ... */
-    goto next;
-  }
+  GST_DEBUG_OBJECT (demux, "New segment %" GST_SEGMENT_FORMAT, &seeksegment);
 
   /* check sanity before we start flushing and all that */
+  snap_next = after && !before;
+  if (seeksegment.rate < 0)
+    snap_next = !snap_next;
   GST_OBJECT_LOCK (demux);
   track = gst_matroska_read_common_get_seek_track (&demux->common, track);
   if ((entry = gst_matroska_read_common_do_index_seek (&demux->common, track,
-              seeksegment.last_stop, &demux->seek_index, &demux->seek_entry)) ==
-      NULL) {
+              seeksegment.last_stop, &demux->seek_index, &demux->seek_entry,
+              snap_next)) == NULL) {
     /* pull mode without index can scan later on */
     if (demux->streaming) {
       GST_DEBUG_OBJECT (demux, "No matching seek entry in index");
       GST_OBJECT_UNLOCK (demux);
       return FALSE;
+    } else if (rate < 0.0) {
+      /* FIXME: We should build an index during playback or when scanning
+       * that can be used here. The reverse playback code requires seek_index
+       * and seek_entry to be set!
+       */
+      GST_DEBUG_OBJECT (demux,
+          "No matching seek entry in index, needed for reverse playback");
+      GST_OBJECT_UNLOCK (demux);
+      return FALSE;
     }
   }
   GST_DEBUG_OBJECT (demux, "Seek position looks sane");
   GST_OBJECT_UNLOCK (demux);
 
-  if (demux->streaming) {
-    /* need to seek to cluster start to pick up cluster time */
-    /* upstream takes care of flushing and all that
-     * ... and newsegment event handling takes care of the rest */
-    return perform_seek_to_offset (demux,
-        entry->pos + demux->common.ebml_segment_start);
+  if (!update) {
+    /* only have to update some segment,
+     * but also still have to honour flush and so on */
+    GST_DEBUG_OBJECT (demux, "... no update");
+    /* bad goto, bad ... */
+    goto next;
   }
 
+  if (demux->streaming)
+    goto finish;
+
 next:
   if (flush) {
     GST_DEBUG_OBJECT (demux, "Starting flush");
@@ -2011,6 +2042,7 @@ next:
    * forever. */
   GST_DEBUG_OBJECT (demux, "Waiting for streaming to stop");
   GST_PAD_STREAM_LOCK (demux->common.sinkpad);
+  pad_locked = TRUE;
 
   /* pull mode without index can do some scanning */
   if (!demux->streaming && !entry) {
@@ -2031,14 +2063,30 @@ next:
     }
   }
 
+finish:
   if (keyunit) {
-    GST_DEBUG_OBJECT (demux, "seek to key unit, adjusting segment start to %"
-        GST_TIME_FORMAT, GST_TIME_ARGS (entry->time));
+    GST_DEBUG_OBJECT (demux, "seek to key unit, adjusting segment start from %"
+        GST_TIME_FORMAT " to %" GST_TIME_FORMAT,
+        GST_TIME_ARGS (seeksegment.start), GST_TIME_ARGS (entry->time));
     seeksegment.start = MAX (entry->time, demux->stream_start_time);
     seeksegment.last_stop = seeksegment.start;
     seeksegment.time = seeksegment.start - demux->stream_start_time;
   }
 
+  if (demux->streaming) {
+    GST_OBJECT_LOCK (demux);
+    /* track real position we should start at */
+    GST_DEBUG_OBJECT (demux, "storing segment start");
+    demux->requested_seek_time = seeksegment.last_stop;
+    demux->seek_offset = entry->pos + demux->common.ebml_segment_start;
+    GST_OBJECT_UNLOCK (demux);
+    /* need to seek to cluster start to pick up cluster time */
+    /* upstream takes care of flushing and all that
+     * ... and newsegment event handling takes care of the rest */
+    return perform_seek_to_offset (demux, rate,
+        entry->pos + demux->common.ebml_segment_start);
+  }
+
 exit:
   if (flush) {
     GST_DEBUG_OBJECT (demux, "Stopping flush");
@@ -2065,7 +2113,7 @@ exit:
   GST_OBJECT_UNLOCK (demux);
 
   /* update some (segment) state */
-  if (update && !gst_matroska_demux_move_to_entry (demux, entry, TRUE))
+  if (!gst_matroska_demux_move_to_entry (demux, entry, TRUE, update))
     goto seek_error;
 
   /* notify start of new segment */
@@ -2080,10 +2128,28 @@ exit:
   GST_OBJECT_LOCK (demux);
   if (demux->new_segment)
     gst_event_unref (demux->new_segment);
-  demux->new_segment = gst_event_new_new_segment_full (!update,
-      demux->common.segment.rate, demux->common.segment.applied_rate,
-      demux->common.segment.format, demux->common.segment.start,
-      demux->common.segment.stop, demux->common.segment.time);
+
+  if (update) {
+    if (demux->common.segment.rate > 0.0)
+      demux->new_segment = gst_event_new_new_segment_full (FALSE,
+          demux->common.segment.rate, demux->common.segment.applied_rate,
+          demux->common.segment.format, demux->common.segment.last_stop,
+          demux->common.segment.stop, demux->common.segment.last_stop);
+    else
+      demux->new_segment = gst_event_new_new_segment_full (FALSE,
+          demux->common.segment.rate, demux->common.segment.applied_rate,
+          demux->common.segment.format, demux->common.segment.start,
+          demux->common.segment.last_stop, demux->common.segment.time);
+  } else {
+    demux->new_segment = gst_event_new_new_segment_full (TRUE,
+        demux->common.segment.rate, demux->common.segment.applied_rate,
+        demux->common.segment.format, demux->common.segment.start,
+        demux->common.segment.stop, demux->common.segment.time);
+  }
+  if (demux->common.segment.rate < 0 && demux->common.segment.stop == -1)
+    demux->to_time = demux->common.segment.last_stop;
+  else
+    demux->to_time = GST_CLOCK_TIME_NONE;
   GST_OBJECT_UNLOCK (demux);
 
   /* restart our task since it might have been stopped when we did the
@@ -2093,13 +2159,17 @@ exit:
       (GstTaskFunction) gst_matroska_demux_loop, demux->common.sinkpad);
 
   /* streaming can continue now */
-  GST_PAD_STREAM_UNLOCK (demux->common.sinkpad);
+  if (pad_locked) {
+    GST_PAD_STREAM_UNLOCK (demux->common.sinkpad);
+  }
 
   return TRUE;
 
 seek_error:
   {
-    GST_PAD_STREAM_UNLOCK (demux->common.sinkpad);
+    if (pad_locked) {
+      GST_PAD_STREAM_UNLOCK (demux->common.sinkpad);
+    }
     GST_ELEMENT_ERROR (demux, STREAM, DEMUX, (NULL), ("Got a seek error"));
     return FALSE;
   }
@@ -2178,7 +2248,7 @@ gst_matroska_demux_handle_seek_push (GstMatroskaDemux * demux, GstPad * pad,
     if (!building_index) {
       /* seek to the first subindex or legacy index */
       GST_INFO_OBJECT (demux, "Seeking to Cues at %" G_GUINT64_FORMAT, offset);
-      return perform_seek_to_offset (demux, offset);
+      return perform_seek_to_offset (demux, rate, offset);
     }
 
     /* well, we are handling it already */
@@ -2290,7 +2360,7 @@ gst_matroska_demux_seek_to_previous_keyframe (GstMatroskaDemux * demux)
 
     entry = &g_array_index (demux->seek_index, GstMatroskaIndex,
         --demux->seek_entry);
-    if (!gst_matroska_demux_move_to_entry (demux, entry, FALSE))
+    if (!gst_matroska_demux_move_to_entry (demux, entry, FALSE, TRUE))
       goto exit;
 
     ret = GST_FLOW_OK;
@@ -2873,6 +2943,8 @@ gst_matroska_demux_subtitle_chunk_has_tag (GstElement * element,
 {
   gchar *tag;
 
+  g_return_val_if_fail (text != NULL, FALSE);
+
   /* yes, this might all lead to false positives ... */
   tag = (gchar *) text;
   while ((tag = strchr (tag, '<'))) {
@@ -2914,6 +2986,9 @@ gst_matroska_demux_check_subtitle_buffer (GstElement * element,
   data = (const gchar *) GST_BUFFER_DATA (*buf);
   size = GST_BUFFER_SIZE (*buf);
 
+  if (!data || !size)
+    return GST_FLOW_OK;
+
   if (!sub_stream->invalid_utf8) {
     if (g_utf8_validate (data, size, NULL)) {
       goto next;
@@ -3306,7 +3381,8 @@ gst_matroska_demux_parse_blockgroup_or_simpleblock (GstMatroskaDemux * demux,
 
     /* need to refresh segment info ASAP */
     if (GST_CLOCK_TIME_IS_VALID (lace_time) && demux->need_newsegment) {
-      guint64 clace_time;
+      guint64 clace_time, duration;
+      gdouble rate;
 
       GST_DEBUG_OBJECT (demux,
           "generating segment starting at %" GST_TIME_FORMAT,
@@ -3318,9 +3394,21 @@ gst_matroska_demux_parse_blockgroup_or_simpleblock (GstMatroskaDemux * demux,
             GST_TIME_ARGS (lace_time));
       }
       clace_time = MAX (lace_time, demux->stream_start_time);
+      duration = demux->common.segment.duration;
+      rate = demux->common.segment.rate;
+      if (GST_CLOCK_TIME_IS_VALID (demux->common.segment.last_stop) &&
+          demux->common.segment.last_stop != 0) {
+        GST_DEBUG_OBJECT (demux,
+            "using stored seek position %" GST_TIME_FORMAT,
+            GST_TIME_ARGS (demux->common.segment.last_stop));
+        clace_time = demux->common.segment.last_stop + demux->stream_start_time;
+      }
+      gst_segment_init (&demux->common.segment, GST_FORMAT_TIME);
       gst_segment_set_newsegment (&demux->common.segment, FALSE,
-          demux->common.segment.rate, GST_FORMAT_TIME, clace_time,
-          GST_CLOCK_TIME_NONE, clace_time - demux->stream_start_time);
+          rate, GST_FORMAT_TIME, clace_time, GST_CLOCK_TIME_NONE,
+          clace_time - demux->stream_start_time);
+      gst_segment_set_duration (&demux->common.segment, GST_FORMAT_TIME,
+          duration);
       /* now convey our segment notion downstream */
       gst_matroska_demux_send_event (demux, gst_event_new_new_segment (FALSE,
               demux->common.segment.rate, demux->common.segment.format,
@@ -3434,7 +3522,9 @@ gst_matroska_demux_parse_blockgroup_or_simpleblock (GstMatroskaDemux * demux,
           gst_buffer_unref (sub);
           goto eos;
         }
-        if (offset >= stream->to_offset) {
+        if (offset >= stream->to_offset
+            || (GST_CLOCK_TIME_IS_VALID (demux->to_time)
+                && lace_time > demux->to_time)) {
           GST_DEBUG_OBJECT (demux, "Stream %d after playback section",
               stream->index);
           gst_buffer_unref (sub);
@@ -3589,6 +3679,7 @@ gst_matroska_demux_parse_blockgroup_or_simpleblock (GstMatroskaDemux * demux,
       }
 
       ret = gst_pad_push (stream->pad, sub);
+
       if (demux->common.segment.rate < 0) {
         if (lace_time > demux->common.segment.stop
             && ret == GST_FLOW_UNEXPECTED) {
@@ -4509,7 +4600,7 @@ pause:
  * Create and push a flushing seek event upstream
  */
 static gboolean
-perform_seek_to_offset (GstMatroskaDemux * demux, guint64 offset)
+perform_seek_to_offset (GstMatroskaDemux * demux, gdouble rate, guint64 offset)
 {
   GstEvent *event;
   gboolean res = 0;
@@ -4517,7 +4608,7 @@ perform_seek_to_offset (GstMatroskaDemux * demux, guint64 offset)
   GST_DEBUG_OBJECT (demux, "Seeking to %" G_GUINT64_FORMAT, offset);
 
   event =
-      gst_event_new_seek (1.0, GST_FORMAT_BYTES,
+      gst_event_new_seek (rate, GST_FORMAT_BYTES,
       GST_SEEK_FLAG_FLUSH | GST_SEEK_FLAG_ACCURATE, GST_SEEK_TYPE_SET, offset,
       GST_SEEK_TYPE_NONE, -1);
 
@@ -4627,6 +4718,15 @@ gst_matroska_demux_handle_sink_event (GstPad * pad, GstEvent * event)
       demux->need_newsegment = TRUE;
       /* but keep some of the upstream segment */
       demux->common.segment.rate = rate;
+      /* also check if need to keep some of the requested seek position */
+      if (demux->seek_offset == start) {
+        GST_DEBUG_OBJECT (demux, "position matches requested seek");
+        demux->common.segment.last_stop = demux->requested_seek_time;
+      } else {
+        GST_DEBUG_OBJECT (demux, "unexpected segment position");
+      }
+      demux->requested_seek_time = GST_CLOCK_TIME_NONE;
+      demux->seek_offset = -1;
       GST_OBJECT_UNLOCK (demux);
     exit:
       /* chain will send initial newsegment after pads have been added,
@@ -4652,11 +4752,15 @@ gst_matroska_demux_handle_sink_event (GstPad * pad, GstEvent * event)
     }
     case GST_EVENT_FLUSH_STOP:
     {
+      guint64 dur;
+
       gst_adapter_clear (demux->common.adapter);
       GST_OBJECT_LOCK (demux);
       gst_matroska_read_common_reset_streams (&demux->common,
           GST_CLOCK_TIME_NONE, TRUE);
-      demux->common.segment.last_stop = GST_CLOCK_TIME_NONE;
+      dur = demux->common.segment.duration;
+      gst_segment_init (&demux->common.segment, GST_FORMAT_TIME);
+      demux->common.segment.duration = dur;
       demux->cluster_time = GST_CLOCK_TIME_NONE;
       demux->cluster_offset = 0;
       GST_OBJECT_UNLOCK (demux);
diff --git a/gst/matroska/matroska-demux.h b/gst/matroska/matroska-demux.h
index 22093ea..cd860f7 100644
--- a/gst/matroska/matroska-demux.h
+++ b/gst/matroska/matroska-demux.h
@@ -73,6 +73,8 @@ typedef struct _GstMatroskaDemux {
   GstClockTime             last_stop_end;
   GstClockTime             stream_start_time;
 
+  /* Stop time for reverse playback */
+  GstClockTime             to_time;
   GstEvent                *close_segment;
   GstEvent                *new_segment;
 
@@ -81,6 +83,8 @@ typedef struct _GstMatroskaDemux {
   guint64                  cluster_offset;
   guint64                  first_cluster_offset;
   guint64                  next_cluster_offset;
+  GstClockTime             requested_seek_time;
+  guint64                  seek_offset;
 
   /* index stuff */
   gboolean                 seekable;
diff --git a/gst/matroska/matroska-mux.c b/gst/matroska/matroska-mux.c
index 30c0cdb..168b2a9 100644
--- a/gst/matroska/matroska-mux.c
+++ b/gst/matroska/matroska-mux.c
@@ -2,6 +2,7 @@
  * (c) 2003 Ronald Bultje <rbultje@ronald.bitfreak.net>
  * (c) 2005 Michal Benes <michal.benes@xeris.cz>
  * (c) 2008 Sebastian Dröge <sebastian.droege@collabora.co.uk>
+ * (c) 2011 Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
  *
  * matroska-mux.c: matroska file/stream muxer
  *
@@ -205,10 +206,14 @@ static GstStaticPadTemplate audiosink_templ =
     );
 
 static GstStaticPadTemplate subtitlesink_templ =
-GST_STATIC_PAD_TEMPLATE ("subtitle_%d",
+    GST_STATIC_PAD_TEMPLATE ("subtitle_%d",
     GST_PAD_SINK,
     GST_PAD_REQUEST,
-    GST_STATIC_CAPS ("subtitle/x-kate"));
+    GST_STATIC_CAPS ("subtitle/x-kate; "
+        "text/plain; application/x-ssa; application/x-ass; "
+        "application/x-usf; video/x-dvd-subpicture; "
+        "application/x-subtitle-unknown")
+    );
 
 static GArray *used_uids;
 G_LOCK_DEFINE_STATIC (used_uids);
@@ -222,8 +227,10 @@ GST_BOILERPLATE_FULL (GstMatroskaMux, gst_matroska_mux, GstElement,
 static void gst_matroska_mux_finalize (GObject * object);
 
 /* Pads collected callback */
-static GstFlowReturn
-gst_matroska_mux_collected (GstCollectPads * pads, gpointer user_data);
+static GstFlowReturn gst_matroska_mux_handle_buffer (GstCollectPads2 * pads,
+    GstCollectData2 * data, GstBuffer * buf, gpointer user_data);
+static gboolean gst_matroska_mux_handle_sink_event (GstCollectPads2 * pads,
+    GstCollectData2 * data, GstEvent * event, gpointer user_data);
 
 /* pad functions */
 static gboolean gst_matroska_mux_handle_src_event (GstPad * pad,
@@ -450,10 +457,13 @@ gst_matroska_mux_init (GstMatroskaMux * mux, GstMatroskaMuxClass * g_class)
   gst_pad_set_event_function (mux->srcpad, gst_matroska_mux_handle_src_event);
   gst_element_add_pad (GST_ELEMENT (mux), mux->srcpad);
 
-  mux->collect = gst_collect_pads_new ();
-  gst_collect_pads_set_function (mux->collect,
-      (GstCollectPadsFunction) GST_DEBUG_FUNCPTR (gst_matroska_mux_collected),
-      mux);
+  mux->collect = gst_collect_pads2_new ();
+  gst_collect_pads2_set_clip_function (mux->collect,
+      GST_DEBUG_FUNCPTR (gst_collect_pads2_clip_running_time), mux);
+  gst_collect_pads2_set_buffer_function (mux->collect,
+      GST_DEBUG_FUNCPTR (gst_matroska_mux_handle_buffer), mux);
+  gst_collect_pads2_set_event_function (mux->collect,
+      GST_DEBUG_FUNCPTR (gst_matroska_mux_handle_sink_event), mux);
 
   mux->ebml_write = gst_ebml_write_new (mux->srcpad);
   mux->doctype = GST_MATROSKA_DOCTYPE_MATROSKA;
@@ -570,12 +580,6 @@ gst_matroska_pad_reset (GstMatroskaPad * collect_pad, gboolean full)
     collect_pad->track = NULL;
   }
 
-  /* free cached buffer */
-  if (collect_pad->buffer != NULL) {
-    gst_buffer_unref (collect_pad->buffer);
-    collect_pad->buffer = NULL;
-  }
-
   if (!full && type != 0) {
     GstMatroskaTrackContext *context;
 
@@ -603,7 +607,6 @@ gst_matroska_pad_reset (GstMatroskaPad * collect_pad, gboolean full)
     /* TODO: check default values for the context */
     context->flags = GST_MATROSKA_TRACK_ENABLED | GST_MATROSKA_TRACK_DEFAULT;
     collect_pad->track = context;
-    collect_pad->buffer = NULL;
     collect_pad->duration = 0;
     collect_pad->start_ts = GST_CLOCK_TIME_NONE;
     collect_pad->end_ts = GST_CLOCK_TIME_NONE;
@@ -699,6 +702,55 @@ gst_matroska_mux_handle_src_event (GstPad * pad, GstEvent * event)
   return gst_pad_event_default (pad, event);
 }
 
+
+static void
+gst_matroska_mux_free_codec_priv (GstMatroskaTrackContext * context)
+{
+  if (context->codec_priv != NULL) {
+    g_free (context->codec_priv);
+    context->codec_priv = NULL;
+    context->codec_priv_size = 0;
+  }
+}
+
+static void
+gst_matroska_mux_build_vobsub_private (GstMatroskaTrackContext * context,
+    const guint * clut)
+{
+  gchar *clutv[17];
+  gchar *sclut;
+  gint i;
+  guint32 col;
+  gdouble y, u, v;
+  guint8 r, g, b;
+
+  /* produce comma-separated list in hex format */
+  for (i = 0; i < 16; ++i) {
+    col = clut[i];
+    /* replicate vobsub's slightly off RGB conversion calculation */
+    y = (((col >> 16) & 0xff) - 16) * 255 / 219;
+    u = ((col >> 8) & 0xff) - 128;
+    v = (col & 0xff) - 128;
+    r = CLAMP (1.0 * y + 1.4022 * u, 0, 255);
+    g = CLAMP (1.0 * y - 0.3456 * u - 0.7145 * v, 0, 255);
+    b = CLAMP (1.0 * y + 1.7710 * v, 0, 255);
+    clutv[i] = g_strdup_printf ("%02x%02x%02x", r, g, b);
+  }
+  clutv[i] = NULL;
+  sclut = g_strjoinv (",", clutv);
+
+  /* build codec private; only palette for now */
+  gst_matroska_mux_free_codec_priv (context);
+  context->codec_priv = (guint8 *) g_strdup_printf ("palette: %s", sclut);
+  /* include terminating 0 */
+  context->codec_priv_size = strlen ((gchar *) context->codec_priv) + 1;
+  g_free (sclut);
+  for (i = 0; i < 16; ++i) {
+    g_free (clutv[i]);
+  }
+}
+
+
 /**
  * gst_matroska_mux_handle_sink_event:
  * @pad: Pad which received the event.
@@ -709,15 +761,20 @@ gst_matroska_mux_handle_src_event (GstPad * pad, GstEvent * event)
  * Returns: #TRUE on success.
  */
 static gboolean
-gst_matroska_mux_handle_sink_event (GstPad * pad, GstEvent * event)
+gst_matroska_mux_handle_sink_event (GstCollectPads2 * pads,
+    GstCollectData2 * data, GstEvent * event, gpointer user_data)
 {
   GstMatroskaTrackContext *context;
   GstMatroskaPad *collect_pad;
   GstMatroskaMux *mux;
+  GstPad *pad;
   GstTagList *list;
-  gboolean ret = TRUE;
 
-  mux = GST_MATROSKA_MUX (gst_pad_get_parent (pad));
+  mux = GST_MATROSKA_MUX (user_data);
+  collect_pad = (GstMatroskaPad *) data;
+  pad = data->pad;
+  context = collect_pad->track;
+  g_assert (context);
 
   switch (GST_EVENT_TYPE (event)) {
     case GST_EVENT_TAG:{
@@ -726,11 +783,6 @@ gst_matroska_mux_handle_sink_event (GstPad * pad, GstEvent * event)
       GST_DEBUG_OBJECT (mux, "received tag event");
       gst_event_parse_tag (event, &list);
 
-      collect_pad = (GstMatroskaPad *) gst_pad_get_element_private (pad);
-      g_assert (collect_pad);
-      context = collect_pad->track;
-      g_assert (context);
-
       /* Matroska wants ISO 639-2B code, taglist most likely contains 639-1 */
       if (gst_tag_list_get_string (list, GST_TAG_LANGUAGE_CODE, &lang)) {
         const gchar *lang_code;
@@ -760,7 +812,6 @@ gst_matroska_mux_handle_sink_event (GstPad * pad, GstEvent * event)
       gst_event_parse_new_segment (event, NULL, NULL, &format, NULL, NULL,
           NULL);
       if (format != GST_FORMAT_TIME) {
-        ret = FALSE;
         gst_event_unref (event);
         event = NULL;
       }
@@ -774,6 +825,31 @@ gst_matroska_mux_handle_sink_event (GstPad * pad, GstEvent * event)
         gst_event_replace (&mux->force_key_unit_event, NULL);
         mux->force_key_unit_event = event;
         event = NULL;
+      } else if (gst_structure_has_name (structure, "application/x-gst-dvd") &&
+          !strcmp ("dvd-spu-clut-change",
+              gst_structure_get_string (structure, "event"))) {
+        gchar name[16];
+        gint i, value;
+        guint clut[16];
+
+        GST_DEBUG_OBJECT (pad, "New DVD colour table received");
+        if (context->type != GST_MATROSKA_TRACK_TYPE_SUBTITLE) {
+          GST_DEBUG_OBJECT (pad, "... discarding");
+          break;
+        }
+        /* first transform event data into table form */
+        for (i = 0; i < 16; i++) {
+          g_snprintf (name, sizeof (name), "clut%02d", i);
+          if (!gst_structure_get_int (structure, name, &value)) {
+            GST_ERROR_OBJECT (mux, "dvd-spu-clut-change event did not "
+                "contain %s field", name);
+            break;
+          }
+          clut[i] = value;
+        }
+
+        /* transform into private data for stream; text form */
+        gst_matroska_mux_build_vobsub_private (context, clut);
       }
       break;
     }
@@ -781,15 +857,22 @@ gst_matroska_mux_handle_sink_event (GstPad * pad, GstEvent * event)
       break;
   }
 
-  /* now GstCollectPads can take care of the rest, e.g. EOS */
+  /* now GstCollectPads2 can take care of the rest, e.g. EOS */
   if (event)
-    ret = mux->collect_event (pad, event);
-
-  gst_object_unref (mux);
-
-  return ret;
+    return FALSE;
+  else
+    return TRUE;
 }
 
+static void
+gst_matroska_mux_set_codec_id (GstMatroskaTrackContext * context,
+    const char *id)
+{
+  g_assert (context && id);
+  if (context->codec_id)
+    g_free (context->codec_id);
+  context->codec_id = g_strdup (id);
+}
 
 /**
  * gst_matroska_mux_video_pad_setcaps:
@@ -898,7 +981,8 @@ skip_details:
 
   /* find type */
   if (!strcmp (mimetype, "video/x-raw-yuv")) {
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_VIDEO_UNCOMPRESSED);
+    gst_matroska_mux_set_codec_id (context,
+        GST_MATROSKA_CODEC_ID_VIDEO_UNCOMPRESSED);
     gst_structure_get_fourcc (structure, "format", &videocontext->fourcc);
   } else if (!strcmp (mimetype, "video/x-xvid") /* MS/VfW compatibility cases */
       ||!strcmp (mimetype, "video/x-huffyuv")
@@ -990,18 +1074,15 @@ skip_details:
           GST_BUFFER_DATA (codec_buf), GST_BUFFER_SIZE (codec_buf));
     }
 
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_VIDEO_VFW_FOURCC);
+    gst_matroska_mux_set_codec_id (context,
+        GST_MATROSKA_CODEC_ID_VIDEO_VFW_FOURCC);
+    gst_matroska_mux_free_codec_priv (context);
     context->codec_priv = (gpointer) bih;
     context->codec_priv_size = size;
   } else if (!strcmp (mimetype, "video/x-h264")) {
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_VIDEO_MPEG4_AVC);
-
-    if (context->codec_priv != NULL) {
-      g_free (context->codec_priv);
-      context->codec_priv = NULL;
-      context->codec_priv_size = 0;
-    }
-
+    gst_matroska_mux_set_codec_id (context,
+        GST_MATROSKA_CODEC_ID_VIDEO_MPEG4_AVC);
+    gst_matroska_mux_free_codec_priv (context);
     /* Create avcC header */
     if (codec_buf != NULL) {
       context->codec_priv_size = GST_BUFFER_SIZE (codec_buf);
@@ -1012,13 +1093,9 @@ skip_details:
   } else if (!strcmp (mimetype, "video/x-theora")) {
     const GValue *streamheader;
 
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_VIDEO_THEORA);
+    gst_matroska_mux_set_codec_id (context, GST_MATROSKA_CODEC_ID_VIDEO_THEORA);
 
-    if (context->codec_priv != NULL) {
-      g_free (context->codec_priv);
-      context->codec_priv = NULL;
-      context->codec_priv_size = 0;
-    }
+    gst_matroska_mux_free_codec_priv (context);
 
     streamheader = gst_structure_get_value (structure, "streamheader");
     if (!theora_streamheader_to_codecdata (streamheader, context)) {
@@ -1027,22 +1104,25 @@ skip_details:
       goto refuse_caps;
     }
   } else if (!strcmp (mimetype, "video/x-dirac")) {
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_VIDEO_DIRAC);
+    gst_matroska_mux_set_codec_id (context, GST_MATROSKA_CODEC_ID_VIDEO_DIRAC);
   } else if (!strcmp (mimetype, "video/x-vp8")) {
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_VIDEO_VP8);
+    gst_matroska_mux_set_codec_id (context, GST_MATROSKA_CODEC_ID_VIDEO_VP8);
   } else if (!strcmp (mimetype, "video/mpeg")) {
     gint mpegversion;
 
     gst_structure_get_int (structure, "mpegversion", &mpegversion);
     switch (mpegversion) {
       case 1:
-        context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_VIDEO_MPEG1);
+        gst_matroska_mux_set_codec_id (context,
+            GST_MATROSKA_CODEC_ID_VIDEO_MPEG1);
         break;
       case 2:
-        context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_VIDEO_MPEG2);
+        gst_matroska_mux_set_codec_id (context,
+            GST_MATROSKA_CODEC_ID_VIDEO_MPEG2);
         break;
       case 4:
-        context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_VIDEO_MPEG4_ASP);
+        gst_matroska_mux_set_codec_id (context,
+            GST_MATROSKA_CODEC_ID_VIDEO_MPEG4_ASP);
         break;
       default:
         goto refuse_caps;
@@ -1050,6 +1130,7 @@ skip_details:
 
     /* global headers may be in codec data */
     if (codec_buf != NULL) {
+      gst_matroska_mux_free_codec_priv (context);
       context->codec_priv_size = GST_BUFFER_SIZE (codec_buf);
       context->codec_priv = g_malloc0 (context->codec_priv_size);
       memcpy (context->codec_priv, GST_BUFFER_DATA (codec_buf),
@@ -1066,16 +1147,20 @@ skip_details:
     gst_structure_get_int (structure, "rmversion", &rmversion);
     switch (rmversion) {
       case 1:
-        context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_VIDEO_REALVIDEO1);
+        gst_matroska_mux_set_codec_id (context,
+            GST_MATROSKA_CODEC_ID_VIDEO_REALVIDEO1);
         break;
       case 2:
-        context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_VIDEO_REALVIDEO2);
+        gst_matroska_mux_set_codec_id (context,
+            GST_MATROSKA_CODEC_ID_VIDEO_REALVIDEO2);
         break;
       case 3:
-        context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_VIDEO_REALVIDEO3);
+        gst_matroska_mux_set_codec_id (context,
+            GST_MATROSKA_CODEC_ID_VIDEO_REALVIDEO3);
         break;
       case 4:
-        context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_VIDEO_REALVIDEO4);
+        gst_matroska_mux_set_codec_id (context,
+            GST_MATROSKA_CODEC_ID_VIDEO_REALVIDEO4);
         break;
       default:
         goto refuse_caps;
@@ -1093,6 +1178,7 @@ skip_details:
 
       memcpy (priv_data, GST_BUFFER_DATA (codec_data_buf), priv_data_size);
 
+      gst_matroska_mux_free_codec_priv (context);
       context->codec_priv = priv_data;
       context->codec_priv_size = priv_data_size;
     }
@@ -1177,6 +1263,7 @@ xiphN_streamheader_to_codecdata (const GValue * streamheader,
     offset += GST_BUFFER_SIZE (buf[i]);
   }
 
+  gst_matroska_mux_free_codec_priv (context);
   context->codec_priv = priv_data;
   context->codec_priv_size = priv_data_size;
 
@@ -1356,6 +1443,7 @@ flac_streamheader_to_codecdata (const GValue * streamheader,
     return FALSE;
   }
 
+  gst_matroska_mux_free_codec_priv (context);
   context->codec_priv = g_malloc (GST_BUFFER_SIZE (buffer) - 9);
   context->codec_priv_size = GST_BUFFER_SIZE (buffer) - 9;
   memcpy (context->codec_priv, GST_BUFFER_DATA (buffer) + 9,
@@ -1365,9 +1453,7 @@ flac_streamheader_to_codecdata (const GValue * streamheader,
     bufval = &g_array_index (bufarr, GValue, i);
 
     if (G_VALUE_TYPE (bufval) != GST_TYPE_BUFFER) {
-      g_free (context->codec_priv);
-      context->codec_priv = NULL;
-      context->codec_priv_size = 0;
+      gst_matroska_mux_free_codec_priv (context);
       GST_WARNING ("streamheaders array does not contain GstBuffers");
       return FALSE;
     }
@@ -1421,6 +1507,7 @@ speex_streamheader_to_codecdata (const GValue * streamheader,
     return FALSE;
   }
 
+  gst_matroska_mux_free_codec_priv (context);
   context->codec_priv = g_malloc (GST_BUFFER_SIZE (buffer));
   context->codec_priv_size = GST_BUFFER_SIZE (buffer);
   memcpy (context->codec_priv, GST_BUFFER_DATA (buffer),
@@ -1429,9 +1516,7 @@ speex_streamheader_to_codecdata (const GValue * streamheader,
   bufval = &g_array_index (bufarr, GValue, 1);
 
   if (G_VALUE_TYPE (bufval) != GST_TYPE_BUFFER) {
-    g_free (context->codec_priv);
-    context->codec_priv = NULL;
-    context->codec_priv_size = 0;
+    gst_matroska_mux_free_codec_priv (context);
     GST_WARNING ("streamheaders array does not contain GstBuffers");
     return FALSE;
   }
@@ -1571,13 +1656,16 @@ gst_matroska_mux_audio_pad_setcaps (GstPad * pad, GstCaps * caps)
 
         switch (layer) {
           case 1:
-            context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_MPEG1_L1);
+            gst_matroska_mux_set_codec_id (context,
+                GST_MATROSKA_CODEC_ID_AUDIO_MPEG1_L1);
             break;
           case 2:
-            context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_MPEG1_L2);
+            gst_matroska_mux_set_codec_id (context,
+                GST_MATROSKA_CODEC_ID_AUDIO_MPEG1_L2);
             break;
           case 3:
-            context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_MPEG1_L3);
+            gst_matroska_mux_set_codec_id (context,
+                GST_MATROSKA_CODEC_ID_AUDIO_MPEG1_L3);
             break;
           default:
             goto refuse_caps;
@@ -1648,9 +1736,11 @@ gst_matroska_mux_audio_pad_setcaps (GstPad * pad, GstCaps * caps)
 
     audiocontext->bitdepth = depth;
     if (endianness == G_BIG_ENDIAN)
-      context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_PCM_INT_BE);
+      gst_matroska_mux_set_codec_id (context,
+          GST_MATROSKA_CODEC_ID_AUDIO_PCM_INT_BE);
     else
-      context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_PCM_INT_LE);
+      gst_matroska_mux_set_codec_id (context,
+          GST_MATROSKA_CODEC_ID_AUDIO_PCM_INT_LE);
 
   } else if (!strcmp (mimetype, "audio/x-raw-float")) {
     gint width;
@@ -1661,18 +1751,15 @@ gst_matroska_mux_audio_pad_setcaps (GstPad * pad, GstCaps * caps)
     }
 
     audiocontext->bitdepth = width;
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_PCM_FLOAT);
+    gst_matroska_mux_set_codec_id (context,
+        GST_MATROSKA_CODEC_ID_AUDIO_PCM_FLOAT);
 
   } else if (!strcmp (mimetype, "audio/x-vorbis")) {
     const GValue *streamheader;
 
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_VORBIS);
+    gst_matroska_mux_set_codec_id (context, GST_MATROSKA_CODEC_ID_AUDIO_VORBIS);
 
-    if (context->codec_priv != NULL) {
-      g_free (context->codec_priv);
-      context->codec_priv = NULL;
-      context->codec_priv_size = 0;
-    }
+    gst_matroska_mux_free_codec_priv (context);
 
     streamheader = gst_structure_get_value (structure, "streamheader");
     if (!vorbis_streamheader_to_codecdata (streamheader, context)) {
@@ -1683,12 +1770,9 @@ gst_matroska_mux_audio_pad_setcaps (GstPad * pad, GstCaps * caps)
   } else if (!strcmp (mimetype, "audio/x-flac")) {
     const GValue *streamheader;
 
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_FLAC);
-    if (context->codec_priv != NULL) {
-      g_free (context->codec_priv);
-      context->codec_priv = NULL;
-      context->codec_priv_size = 0;
-    }
+    gst_matroska_mux_set_codec_id (context, GST_MATROSKA_CODEC_ID_AUDIO_FLAC);
+
+    gst_matroska_mux_free_codec_priv (context);
 
     streamheader = gst_structure_get_value (structure, "streamheader");
     if (!flac_streamheader_to_codecdata (streamheader, context)) {
@@ -1699,12 +1783,8 @@ gst_matroska_mux_audio_pad_setcaps (GstPad * pad, GstCaps * caps)
   } else if (!strcmp (mimetype, "audio/x-speex")) {
     const GValue *streamheader;
 
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_SPEEX);
-    if (context->codec_priv != NULL) {
-      g_free (context->codec_priv);
-      context->codec_priv = NULL;
-      context->codec_priv_size = 0;
-    }
+    gst_matroska_mux_set_codec_id (context, GST_MATROSKA_CODEC_ID_AUDIO_SPEEX);
+    gst_matroska_mux_free_codec_priv (context);
 
     streamheader = gst_structure_get_value (structure, "streamheader");
     if (!speex_streamheader_to_codecdata (streamheader, context)) {
@@ -1713,11 +1793,11 @@ gst_matroska_mux_audio_pad_setcaps (GstPad * pad, GstCaps * caps)
       goto refuse_caps;
     }
   } else if (!strcmp (mimetype, "audio/x-ac3")) {
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_AC3);
+    gst_matroska_mux_set_codec_id (context, GST_MATROSKA_CODEC_ID_AUDIO_AC3);
   } else if (!strcmp (mimetype, "audio/x-eac3")) {
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_EAC3);
+    gst_matroska_mux_set_codec_id (context, GST_MATROSKA_CODEC_ID_AUDIO_EAC3);
   } else if (!strcmp (mimetype, "audio/x-dts")) {
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_DTS);
+    gst_matroska_mux_set_codec_id (context, GST_MATROSKA_CODEC_ID_AUDIO_DTS);
   } else if (!strcmp (mimetype, "audio/x-tta")) {
     gint width;
 
@@ -1726,7 +1806,7 @@ gst_matroska_mux_audio_pad_setcaps (GstPad * pad, GstCaps * caps)
 
     gst_structure_get_int (structure, "width", &width);
     audiocontext->bitdepth = width;
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_TTA);
+    gst_matroska_mux_set_codec_id (context, GST_MATROSKA_CODEC_ID_AUDIO_TTA);
 
   } else if (!strcmp (mimetype, "audio/x-pn-realaudio")) {
     gint raversion;
@@ -1735,13 +1815,16 @@ gst_matroska_mux_audio_pad_setcaps (GstPad * pad, GstCaps * caps)
     gst_structure_get_int (structure, "raversion", &raversion);
     switch (raversion) {
       case 1:
-        context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_REAL_14_4);
+        gst_matroska_mux_set_codec_id (context,
+            GST_MATROSKA_CODEC_ID_AUDIO_REAL_14_4);
         break;
       case 2:
-        context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_REAL_28_8);
+        gst_matroska_mux_set_codec_id (context,
+            GST_MATROSKA_CODEC_ID_AUDIO_REAL_28_8);
         break;
       case 8:
-        context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_REAL_COOK);
+        gst_matroska_mux_set_codec_id (context,
+            GST_MATROSKA_CODEC_ID_AUDIO_REAL_COOK);
         break;
       default:
         goto refuse_caps;
@@ -1759,6 +1842,8 @@ gst_matroska_mux_audio_pad_setcaps (GstPad * pad, GstCaps * caps)
 
       memcpy (priv_data, GST_BUFFER_DATA (codec_data_buf), priv_data_size);
 
+      gst_matroska_mux_free_codec_priv (context);
+
       context->codec_priv = priv_data;
       context->codec_priv_size = priv_data_size;
     }
@@ -1842,7 +1927,8 @@ gst_matroska_mux_audio_pad_setcaps (GstPad * pad, GstCaps * caps)
           GST_BUFFER_DATA (buf), GST_BUFFER_SIZE (buf));
     }
 
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_AUDIO_ACM);
+    gst_matroska_mux_set_codec_id (context, GST_MATROSKA_CODEC_ID_AUDIO_ACM);
+    gst_matroska_mux_free_codec_priv (context);
     context->codec_priv = (gpointer) codec_priv;
     context->codec_priv_size = codec_priv_size;
   }
@@ -1858,6 +1944,10 @@ refuse_caps:
   }
 }
 
+/* we probably don't have the data at start,
+ * so have to reserve (a maximum) space to write this at the end.
+ * bit spacy, but some formats can hold quite some */
+#define SUBTITLE_MAX_CODEC_PRIVATE   2048       /* must be > 128 */
 
 /**
  * gst_matroska_mux_subtitle_pad_setcaps:
@@ -1871,11 +1961,6 @@ refuse_caps:
 static gboolean
 gst_matroska_mux_subtitle_pad_setcaps (GstPad * pad, GstCaps * caps)
 {
-  /* FIXME:
-   * Consider this as boilerplate code for now. There is
-   * no single subtitle creation element in GStreamer,
-   * neither do I know how subtitling works at all. */
-
   /* There is now (at least) one such alement (kateenc), and I'm going
      to handle it here and claim it works when it can be piped back
      through GStreamer and VLC */
@@ -1886,6 +1971,9 @@ gst_matroska_mux_subtitle_pad_setcaps (GstPad * pad, GstCaps * caps)
   GstMatroskaPad *collect_pad;
   const gchar *mimetype;
   GstStructure *structure;
+  const GValue *value = NULL;
+  const GstBuffer *buf = NULL;
+  gboolean ret = TRUE;
 
   mux = GST_MATROSKA_MUX (GST_PAD_PARENT (pad));
 
@@ -1905,29 +1993,68 @@ gst_matroska_mux_subtitle_pad_setcaps (GstPad * pad, GstCaps * caps)
   scontext->invalid_utf8 = 0;
   context->default_duration = 0;
 
-  /* TODO: - other format than Kate */
-
   if (!strcmp (mimetype, "subtitle/x-kate")) {
     const GValue *streamheader;
 
-    context->codec_id = g_strdup (GST_MATROSKA_CODEC_ID_SUBTITLE_KATE);
+    gst_matroska_mux_set_codec_id (context,
+        GST_MATROSKA_CODEC_ID_SUBTITLE_KATE);
 
-    if (context->codec_priv != NULL) {
-      g_free (context->codec_priv);
-      context->codec_priv = NULL;
-      context->codec_priv_size = 0;
-    }
+    gst_matroska_mux_free_codec_priv (context);
 
     streamheader = gst_structure_get_value (structure, "streamheader");
     if (!kate_streamheader_to_codecdata (streamheader, context)) {
       GST_ELEMENT_ERROR (mux, STREAM, MUX, (NULL),
           ("kate stream headers missing or malformed"));
-      return FALSE;
+      ret = FALSE;
+      goto exit;
+    }
+  } else if (!strcmp (mimetype, "text/plain")) {
+    gst_matroska_mux_set_codec_id (context,
+        GST_MATROSKA_CODEC_ID_SUBTITLE_UTF8);
+  } else if (!strcmp (mimetype, "application/x-ssa")) {
+    gst_matroska_mux_set_codec_id (context, GST_MATROSKA_CODEC_ID_SUBTITLE_SSA);
+  } else if (!strcmp (mimetype, "application/x-ass")) {
+    gst_matroska_mux_set_codec_id (context, GST_MATROSKA_CODEC_ID_SUBTITLE_ASS);
+  } else if (!strcmp (mimetype, "application/x-usf")) {
+    gst_matroska_mux_set_codec_id (context, GST_MATROSKA_CODEC_ID_SUBTITLE_USF);
+  } else if (!strcmp (mimetype, "video/x-dvd-subpicture")) {
+    gst_matroska_mux_set_codec_id (context,
+        GST_MATROSKA_CODEC_ID_SUBTITLE_VOBSUB);
+  } else {
+    ret = FALSE;
+    goto exit;
+  }
+
+  /* maybe some private data, e.g. vobsub */
+  value = gst_structure_get_value (structure, "codec_data");
+  if (value)
+    buf = gst_value_get_buffer (value);
+  if (buf != NULL) {
+    guint8 *priv_data = NULL;
+    guint priv_data_size = 0;
+
+    priv_data_size = GST_BUFFER_SIZE (buf);
+    if (priv_data_size > SUBTITLE_MAX_CODEC_PRIVATE) {
+      GST_WARNING_OBJECT (mux, "pad %" GST_PTR_FORMAT " subtitle private data"
+          " exceeded maximum (%d); discarding", pad,
+          SUBTITLE_MAX_CODEC_PRIVATE);
+      return TRUE;
     }
-    return TRUE;
+
+    gst_matroska_mux_free_codec_priv (context);
+
+    priv_data = g_malloc0 (priv_data_size);
+    memcpy (priv_data, GST_BUFFER_DATA (buf), priv_data_size);
+    context->codec_priv = priv_data;
+    context->codec_priv_size = priv_data_size;
   }
 
-  return FALSE;
+  GST_DEBUG_OBJECT (pad, "codec_id %s, codec data size %u",
+      GST_STR_NULL (context->codec_id), context->codec_priv_size);
+
+exit:
+
+  return ret;
 }
 
 
@@ -1954,6 +2081,8 @@ gst_matroska_mux_request_new_pad (GstElement * element,
   GstPadSetCapsFunction setcapsfunc = NULL;
   GstMatroskaTrackContext *context = NULL;
   gint pad_id;
+  gboolean locked = TRUE;
+  gchar *id = NULL;
 
   if (templ == gst_element_class_get_pad_template (klass, "audio_%d")) {
     /* don't mix named and unnamed pads, if the pad already exists we fail when
@@ -1997,6 +2126,9 @@ gst_matroska_mux_request_new_pad (GstElement * element,
         g_new0 (GstMatroskaTrackSubtitleContext, 1);
     context->type = GST_MATROSKA_TRACK_TYPE_SUBTITLE;
     context->name = g_strdup ("Subtitle");
+    /* setcaps may only provide proper one a lot later */
+    id = g_strdup ("S_SUB_UNKNOWN");
+    locked = FALSE;
   } else {
     GST_WARNING_OBJECT (mux, "This is not our template!");
     return NULL;
@@ -2008,24 +2140,13 @@ gst_matroska_mux_request_new_pad (GstElement * element,
 
   gst_matroskamux_pad_init (newpad);
   collect_pad = (GstMatroskaPad *)
-      gst_collect_pads_add_pad_full (mux->collect, GST_PAD (newpad),
+      gst_collect_pads2_add_pad_full (mux->collect, GST_PAD (newpad),
       sizeof (GstMatroskamuxPad),
-      (GstCollectDataDestroyNotify) gst_matroska_pad_free);
+      (GstCollectData2DestroyNotify) gst_matroska_pad_free, locked);
 
   collect_pad->track = context;
   gst_matroska_pad_reset (collect_pad, FALSE);
-
-  /* FIXME: hacked way to override/extend the event function of
-   * GstCollectPads; because it sets its own event function giving the
-   * element no access to events.
-   * TODO GstCollectPads should really give its 'users' a clean chance to
-   * properly handle events that are not meant for collectpads itself.
-   * Perhaps a callback or so, though rejected (?) in #340060.
-   * This would allow (clean) transcoding of info from demuxer/streams
-   * to another muxer */
-  mux->collect_event = (GstPadEventFunction) GST_PAD_EVENTFUNC (newpad);
-  gst_pad_set_event_function (GST_PAD (newpad),
-      GST_DEBUG_FUNCPTR (gst_matroska_mux_handle_sink_event));
+  collect_pad->track->codec_id = id;
 
   gst_pad_set_setcaps_function (GST_PAD (newpad), setcapsfunc);
   gst_pad_set_active (GST_PAD (newpad), TRUE);
@@ -2063,7 +2184,7 @@ gst_matroska_mux_release_pad (GstElement * element, GstPad * pad)
   mux = GST_MATROSKA_MUX (GST_PAD_PARENT (pad));
 
   for (walk = mux->collect->data; walk; walk = g_slist_next (walk)) {
-    GstCollectData *cdata = (GstCollectData *) walk->data;
+    GstCollectData2 *cdata = (GstCollectData2 *) walk->data;
     GstMatroskaPad *collect_pad = (GstMatroskaPad *) cdata;
 
     if (cdata->pad == pad) {
@@ -2084,7 +2205,7 @@ gst_matroska_mux_release_pad (GstElement * element, GstPad * pad)
     }
   }
 
-  gst_collect_pads_remove_pad (mux->collect, pad);
+  gst_collect_pads2_remove_pad (mux->collect, pad);
   if (gst_element_remove_pad (element, pad))
     mux->num_streams--;
 }
@@ -2121,6 +2242,14 @@ gst_matroska_mux_track_header (GstMatroskaMux * mux,
         context->language);
   }
 
+  /* FIXME: until we have a nice way of getting the codecname
+   * out of the caps, I'm not going to enable this. Too much
+   * (useless, double, boring) work... */
+  /* TODO: Use value from tags if any */
+  /*gst_ebml_write_utf8 (ebml, GST_MATROSKA_ID_CODECNAME,
+     context->codec_name); */
+  gst_ebml_write_utf8 (ebml, GST_MATROSKA_ID_TRACKNAME, context->name);
+
   /* type-specific stuff */
   switch (context->type) {
     case GST_MATROSKA_TRACK_TYPE_VIDEO:{
@@ -2171,6 +2300,24 @@ gst_matroska_mux_track_header (GstMatroskaMux * mux,
       break;
     }
 
+      /* this is what we write for now and must be filled
+       * and remainder void'ed later on */
+#define SUBTITLE_DUMMY_SIZE   (1 + 1 + 14 + 1 + 2 + SUBTITLE_MAX_CODEC_PRIVATE)
+
+    case GST_MATROSKA_TRACK_TYPE_SUBTITLE:{
+      gpointer buf;
+
+      context->pos = ebml->pos;
+      /* CodecID is mandatory ... */
+      gst_ebml_write_ascii (ebml, GST_MATROSKA_ID_CODECID, "S_SUB_UNKNOWN");
+      /* reserve space */
+      buf = g_malloc0 (SUBTITLE_MAX_CODEC_PRIVATE);
+      gst_ebml_write_binary (ebml, GST_EBML_ID_VOID, buf,
+          SUBTITLE_MAX_CODEC_PRIVATE);
+      g_free (buf);
+      /* real data has to be written at finish */
+      return;
+    }
     default:
       /* doesn't need type-specific data */
       break;
@@ -2180,13 +2327,6 @@ gst_matroska_mux_track_header (GstMatroskaMux * mux,
   if (context->codec_priv)
     gst_ebml_write_binary (ebml, GST_MATROSKA_ID_CODECPRIVATE,
         context->codec_priv, context->codec_priv_size);
-  /* FIXME: until we have a nice way of getting the codecname
-   * out of the caps, I'm not going to enable this. Too much
-   * (useless, double, boring) work... */
-  /* TODO: Use value from tags if any */
-  /*gst_ebml_write_utf8 (ebml, GST_MATROSKA_ID_CODECNAME,
-     context->codec_name); */
-  gst_ebml_write_utf8 (ebml, GST_MATROSKA_ID_TRACKNAME, context->name);
 }
 
 
@@ -2215,6 +2355,30 @@ gst_matroska_mux_start (GstMatroskaMux * mux)
   guint32 segment_uid[4];
   GTimeVal time = { 0, 0 };
 
+  /* if not streaming, check if downstream is seekable */
+  if (!mux->streamable) {
+    gboolean seekable;
+    GstQuery *query;
+
+    query = gst_query_new_seeking (GST_FORMAT_BYTES);
+    if (gst_pad_peer_query (mux->srcpad, query)) {
+      gst_query_parse_seeking (query, NULL, &seekable, NULL, NULL);
+      GST_INFO_OBJECT (mux, "downstream is %sseekable", seekable ? "" : "not ");
+      if (!seekable) {
+        mux->streamable = TRUE;
+        g_object_notify (G_OBJECT (mux), "streamable");
+        GST_WARNING_OBJECT (mux, "downstream is not seekable, but "
+            "streamable=false. Will ignore that and create streamable output "
+            "instead");
+      }
+    } else {
+      /* have to assume seeking is supported if query not handled downstream */
+      /* FIXME 0.11: change to query not handled => seeking not supported */
+      GST_WARNING_OBJECT (mux, "downstream did not handle seeking query");
+    }
+    gst_query_unref (query);
+  }
+
   if (!strcmp (mux->doctype, GST_MATROSKA_DOCTYPE_WEBM)) {
     ebml->caps = gst_caps_new_simple ("video/webm", NULL);
   } else {
@@ -2256,7 +2420,7 @@ gst_matroska_mux_start (GstMatroskaMux * mux)
     if (tags != NULL && !gst_tag_list_is_empty (tags)) {
       guint64 master_tags, master_tag;
 
-      GST_DEBUG ("Writing tags");
+      GST_DEBUG_OBJECT (mux, "Writing tags");
 
       /* TODO: maybe limit via the TARGETS id by looking at the source pad */
       mux->tags_pos = ebml->pos;
@@ -2331,7 +2495,7 @@ gst_matroska_mux_start (GstMatroskaMux * mux)
       child = gst_ebml_write_master_start (ebml, GST_MATROSKA_ID_TRACKENTRY);
       gst_matroska_mux_track_header (mux, collect_pad->track);
       gst_ebml_write_master_finish (ebml, child);
-      /* some remaing pad/track setup */
+      /* some remaining pad/track setup */
       collect_pad->default_duration_scaled =
           gst_util_uint64_scale (collect_pad->track->default_duration,
           1, mux->time_scale);
@@ -2458,7 +2622,7 @@ gst_matroska_mux_finish (GstMatroskaMux * mux)
   if (tags != NULL && !gst_tag_list_is_empty (tags)) {
     guint64 master_tags, master_tag;
 
-    GST_DEBUG ("Writing tags");
+    GST_DEBUG_OBJECT (mux, "Writing tags");
 
     /* TODO: maybe limit via the TARGETS id by looking at the source pad */
     mux->tags_pos = ebml->pos;
@@ -2506,16 +2670,23 @@ gst_matroska_mux_finish (GstMatroskaMux * mux)
     gst_ebml_write_seek (ebml, my_pos);
   }
 
-  /* update duration */
-  /* first get the overall duration */
-  /* a released track may have left a duration in here */
+  /* loop tracks:
+   * - first get the overall duration
+   *   (a released track may have left a duration in here)
+   * - write some track header data for subtitles
+   */
   duration = mux->duration;
+  pos = ebml->pos;
   for (collected = mux->collect->data; collected;
       collected = g_slist_next (collected)) {
     GstMatroskaPad *collect_pad;
     GstClockTime min_duration;  /* observed minimum duration */
+    GstMatroskaTrackContext *context;
+    gint voidleft = 0, fill = 0;
+    gpointer codec_id;
 
     collect_pad = (GstMatroskaPad *) collected->data;
+    context = collect_pad->track;
 
     GST_DEBUG_OBJECT (mux,
         "Pad %" GST_PTR_FORMAT " start ts %" GST_TIME_FORMAT
@@ -2537,7 +2708,41 @@ gst_matroska_mux_finish (GstMatroskaMux * mux)
     if (GST_CLOCK_TIME_IS_VALID (collect_pad->duration) &&
         duration < collect_pad->duration)
       duration = collect_pad->duration;
-  }
+
+    if (context->type != GST_MATROSKA_TRACK_TYPE_SUBTITLE || !context->pos)
+      continue;
+
+  again:
+    /* write subtitle type and possible private data */
+    gst_ebml_write_seek (ebml, context->pos);
+    /* complex way to write ascii to account for extra filling */
+    codec_id = g_malloc0 (strlen (context->codec_id) + 1 + fill);
+    strcpy (codec_id, context->codec_id);
+    gst_ebml_write_binary (ebml, GST_MATROSKA_ID_CODECID,
+        codec_id, strlen (context->codec_id) + 1 + fill);
+    g_free (codec_id);
+    if (context->codec_priv)
+      gst_ebml_write_binary (ebml, GST_MATROSKA_ID_CODECPRIVATE,
+          context->codec_priv, context->codec_priv_size);
+    voidleft = SUBTITLE_DUMMY_SIZE - (ebml->pos - context->pos);
+    /* void'ify; sigh, variable sized length field */
+    if (voidleft == 1) {
+      fill = 1;
+      goto again;
+    } else if (voidleft && voidleft <= 128)
+      gst_ebml_write_buffer_header (ebml, GST_EBML_ID_VOID, voidleft - 2);
+    else if (voidleft >= 130)
+      gst_ebml_write_buffer_header (ebml, GST_EBML_ID_VOID, voidleft - 3);
+    else if (voidleft == 129) {
+      gst_ebml_write_buffer_header (ebml, GST_EBML_ID_VOID, 64);
+      gst_ebml_write_buffer_header (ebml, GST_EBML_ID_VOID, 63);
+    }
+  }
+
+  /* seek back (optional, but do anyway) */
+  gst_ebml_write_seek (ebml, pos);
+
+  /* update duration */
   if (duration != 0) {
     GST_DEBUG_OBJECT (mux, "final total duration: %" GST_TIME_FORMAT,
         GST_TIME_ARGS (duration));
@@ -2560,77 +2765,6 @@ gst_matroska_mux_finish (GstMatroskaMux * mux)
   gst_ebml_write_master_finish (ebml, mux->segment_pos);
 }
 
-
-/**
- * gst_matroska_mux_best_pad:
- * @mux: #GstMatroskaMux
- * @popped: True if at least one buffer was popped from #GstCollectPads
- *
- * Find a pad with the oldest data
- * (data from this pad should be written first).
- *
- * Returns: Selected pad.
- */
-static GstMatroskaPad *
-gst_matroska_mux_best_pad (GstMatroskaMux * mux, gboolean * popped)
-{
-  GSList *collected;
-  GstMatroskaPad *best = NULL;
-
-  *popped = FALSE;
-  for (collected = mux->collect->data; collected;
-      collected = g_slist_next (collected)) {
-    GstMatroskaPad *collect_pad;
-
-    collect_pad = (GstMatroskaPad *) collected->data;
-    /* fetch a new buffer if needed */
-    if (collect_pad->buffer == NULL) {
-      collect_pad->buffer = gst_collect_pads_pop (mux->collect,
-          (GstCollectData *) collect_pad);
-
-      if (collect_pad->buffer != NULL) {
-        GstClockTime time;
-
-        *popped = TRUE;
-        /* convert to running time */
-        time = GST_BUFFER_TIMESTAMP (collect_pad->buffer);
-        /* invalid should pass */
-        if (G_LIKELY (GST_CLOCK_TIME_IS_VALID (time))) {
-          time = gst_segment_to_running_time (&collect_pad->collect.segment,
-              GST_FORMAT_TIME, time);
-          if (G_UNLIKELY (!GST_CLOCK_TIME_IS_VALID (time))) {
-            GST_DEBUG_OBJECT (mux, "clipping buffer on pad %s outside segment",
-                GST_PAD_NAME (collect_pad->collect.pad));
-            gst_buffer_unref (collect_pad->buffer);
-            collect_pad->buffer = NULL;
-            return NULL;
-          } else {
-            GST_LOG_OBJECT (mux, "buffer ts %" GST_TIME_FORMAT " -> %"
-                GST_TIME_FORMAT " running time",
-                GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (collect_pad->buffer)),
-                GST_TIME_ARGS (time));
-            collect_pad->buffer =
-                gst_buffer_make_metadata_writable (collect_pad->buffer);
-            GST_BUFFER_TIMESTAMP (collect_pad->buffer) = time;
-          }
-        }
-      }
-    }
-
-    /* if we have a buffer check if it is better then the current best one */
-    if (collect_pad->buffer != NULL) {
-      if (best == NULL || !GST_BUFFER_TIMESTAMP_IS_VALID (collect_pad->buffer)
-          || (GST_BUFFER_TIMESTAMP_IS_VALID (best->buffer)
-              && GST_BUFFER_TIMESTAMP (collect_pad->buffer) <
-              GST_BUFFER_TIMESTAMP (best->buffer))) {
-        best = collect_pad;
-      }
-    }
-  }
-
-  return best;
-}
-
 /**
  * gst_matroska_mux_buffer_header:
  * @track: Track context.
@@ -2769,10 +2903,11 @@ gst_matroska_mux_stop_streamheader (GstMatroskaMux * mux)
  * Returns: Result of the gst_pad_push issued to write the data.
  */
 static GstFlowReturn
-gst_matroska_mux_write_data (GstMatroskaMux * mux, GstMatroskaPad * collect_pad)
+gst_matroska_mux_write_data (GstMatroskaMux * mux, GstMatroskaPad * collect_pad,
+    GstBuffer * buf)
 {
   GstEbmlWrite *ebml = mux->ebml_write;
-  GstBuffer *buf, *hdr;
+  GstBuffer *hdr;
   guint64 blockgroup;
   gboolean write_duration;
   gint16 relative_timestamp;
@@ -2782,8 +2917,6 @@ gst_matroska_mux_write_data (GstMatroskaMux * mux, GstMatroskaPad * collect_pad)
   GstMatroskamuxPad *pad;
 
   /* write data */
-  buf = collect_pad->buffer;
-  collect_pad->buffer = NULL;
   pad = GST_MATROSKAMUX_PAD_CAST (collect_pad->collect.pad);
 
   /* vorbis/theora headers are retrieved from caps and put in CodecPrivate */
@@ -2972,10 +3105,9 @@ gst_matroska_mux_write_data (GstMatroskaMux * mux, GstMatroskaPad * collect_pad)
   }
 }
 
-
 /**
- * gst_matroska_mux_collected:
- * @pads: #GstCollectPads
+ * gst_matroska_mux_handle_buffer:
+ * @pads: #GstCollectPads2
  * @uuser_data: #GstMatroskaMux
  *
  * Collectpads callback.
@@ -2983,12 +3115,12 @@ gst_matroska_mux_write_data (GstMatroskaMux * mux, GstMatroskaPad * collect_pad)
  * Returns: #GstFlowReturn
  */
 static GstFlowReturn
-gst_matroska_mux_collected (GstCollectPads * pads, gpointer user_data)
+gst_matroska_mux_handle_buffer (GstCollectPads2 * pads, GstCollectData2 * data,
+    GstBuffer * buf, gpointer user_data)
 {
   GstMatroskaMux *mux = GST_MATROSKA_MUX (user_data);
   GstEbmlWrite *ebml = mux->ebml_write;
   GstMatroskaPad *best;
-  gboolean popped;
   GstFlowReturn ret = GST_FLOW_OK;
 
   GST_DEBUG_OBJECT (mux, "Collected pads");
@@ -3007,53 +3139,53 @@ gst_matroska_mux_collected (GstCollectPads * pads, gpointer user_data)
     mux->state = GST_MATROSKA_MUX_STATE_DATA;
   }
 
-  do {
-    /* which stream to write from? */
-    best = gst_matroska_mux_best_pad (mux, &popped);
+  /* provided with stream to write from */
+  best = (GstMatroskaPad *) data;
 
-    /* if there is no best pad, we have reached EOS */
-    if (best == NULL) {
-      /* buffer popped, but none returned means it was clipped */
-      if (popped)
-        break;
-      GST_DEBUG_OBJECT (mux, "No best pad finishing...");
-      if (!mux->streamable) {
-        gst_matroska_mux_finish (mux);
-      } else {
-        GST_DEBUG_OBJECT (mux, "... but streamable, nothing to finish");
-      }
-      gst_pad_push_event (mux->srcpad, gst_event_new_eos ());
-      ret = GST_FLOW_UNEXPECTED;
-      break;
-    }
-    GST_DEBUG_OBJECT (best->collect.pad, "best pad - buffer ts %"
-        GST_TIME_FORMAT " dur %" GST_TIME_FORMAT,
-        GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (best->buffer)),
-        GST_TIME_ARGS (GST_BUFFER_DURATION (best->buffer)));
-
-    /* make note of first and last encountered timestamps, so we can calculate
-     * the actual duration later when we send an updated header on eos */
-    if (GST_BUFFER_TIMESTAMP_IS_VALID (best->buffer)) {
-      GstClockTime start_ts = GST_BUFFER_TIMESTAMP (best->buffer);
-      GstClockTime end_ts = start_ts;
-
-      if (GST_BUFFER_DURATION_IS_VALID (best->buffer))
-        end_ts += GST_BUFFER_DURATION (best->buffer);
-      else if (best->track->default_duration)
-        end_ts += best->track->default_duration;
-
-      if (!GST_CLOCK_TIME_IS_VALID (best->end_ts) || end_ts > best->end_ts)
-        best->end_ts = end_ts;
-
-      if (G_UNLIKELY (best->start_ts == GST_CLOCK_TIME_NONE ||
-              start_ts < best->start_ts))
-        best->start_ts = start_ts;
+  /* if there is no best pad, we have reached EOS */
+  if (best == NULL) {
+    GST_DEBUG_OBJECT (mux, "No best pad finishing...");
+    if (!mux->streamable) {
+      gst_matroska_mux_finish (mux);
+    } else {
+      GST_DEBUG_OBJECT (mux, "... but streamable, nothing to finish");
     }
+    gst_pad_push_event (mux->srcpad, gst_event_new_eos ());
+    ret = GST_FLOW_UNEXPECTED;
+    goto exit;
+  }
+
+  /* if we have a best stream, should also have a buffer */
+  g_assert (buf);
+
+  GST_DEBUG_OBJECT (best->collect.pad, "best pad - buffer ts %"
+      GST_TIME_FORMAT " dur %" GST_TIME_FORMAT,
+      GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (buf)),
+      GST_TIME_ARGS (GST_BUFFER_DURATION (buf)));
+
+  /* make note of first and last encountered timestamps, so we can calculate
+   * the actual duration later when we send an updated header on eos */
+  if (GST_BUFFER_TIMESTAMP_IS_VALID (buf)) {
+    GstClockTime start_ts = GST_BUFFER_TIMESTAMP (buf);
+    GstClockTime end_ts = start_ts;
+
+    if (GST_BUFFER_DURATION_IS_VALID (buf))
+      end_ts += GST_BUFFER_DURATION (buf);
+    else if (best->track->default_duration)
+      end_ts += best->track->default_duration;
+
+    if (!GST_CLOCK_TIME_IS_VALID (best->end_ts) || end_ts > best->end_ts)
+      best->end_ts = end_ts;
+
+    if (G_UNLIKELY (best->start_ts == GST_CLOCK_TIME_NONE ||
+            start_ts < best->start_ts))
+      best->start_ts = start_ts;
+  }
 
-    /* write one buffer */
-    ret = gst_matroska_mux_write_data (mux, best);
-  } while (ret == GST_FLOW_OK && !popped);
+  /* write one buffer */
+  ret = gst_matroska_mux_write_data (mux, best, buf);
 
+exit:
   return ret;
 }
 
@@ -3077,12 +3209,12 @@ gst_matroska_mux_change_state (GstElement * element, GstStateChange transition)
     case GST_STATE_CHANGE_NULL_TO_READY:
       break;
     case GST_STATE_CHANGE_READY_TO_PAUSED:
-      gst_collect_pads_start (mux->collect);
+      gst_collect_pads2_start (mux->collect);
       break;
     case GST_STATE_CHANGE_PAUSED_TO_PLAYING:
       break;
     case GST_STATE_CHANGE_PAUSED_TO_READY:
-      gst_collect_pads_stop (mux->collect);
+      gst_collect_pads2_stop (mux->collect);
       break;
     default:
       break;
diff --git a/gst/matroska/matroska-mux.h b/gst/matroska/matroska-mux.h
index 73bdc09..6eb584d 100644
--- a/gst/matroska/matroska-mux.h
+++ b/gst/matroska/matroska-mux.h
@@ -24,7 +24,7 @@
 #define __GST_MATROSKA_MUX_H__
 
 #include <gst/gst.h>
-#include <gst/base/gstcollectpads.h>
+#include <gst/base/gstcollectpads2.h>
 
 #include "ebml-write.h"
 #include "matroska-ids.h"
@@ -56,11 +56,9 @@ typedef struct _GstMatroskaMetaSeekIndex {
 /* all information needed for one matroska stream */
 typedef struct
 {
-  GstCollectData collect;       /* we extend the CollectData */
+  GstCollectData2 collect;       /* we extend the CollectData */
   GstMatroskaTrackContext *track;
 
-  GstBuffer *buffer;            /* the queued buffer for this pad */
-
   guint64 duration;
   GstClockTime start_ts;
   GstClockTime end_ts;    /* last timestamp + (if available) duration */
@@ -76,8 +74,7 @@ typedef struct _GstMatroskaMux {
 
   /* pads */
   GstPad        *srcpad;
-  GstCollectPads *collect;
-  GstPadEventFunction collect_event;
+  GstCollectPads2 *collect;
   GstEbmlWrite *ebml_write;
 
   guint          num_streams,
diff --git a/gst/matroska/matroska-parse.c b/gst/matroska/matroska-parse.c
index 6fd1f79..6189142 100644
--- a/gst/matroska/matroska-parse.c
+++ b/gst/matroska/matroska-parse.c
@@ -1369,8 +1369,8 @@ gst_matroska_parse_handle_seek_event (GstMatroskaParse * parse,
   /* check sanity before we start flushing and all that */
   GST_OBJECT_LOCK (parse);
   if ((entry = gst_matroska_read_common_do_index_seek (&parse->common, track,
-              seeksegment.last_stop, &parse->seek_index, &parse->seek_entry)) ==
-      NULL) {
+              seeksegment.last_stop, &parse->seek_index, &parse->seek_entry,
+              FALSE)) == NULL) {
     /* pull mode without index can scan later on */
     GST_DEBUG_OBJECT (parse, "No matching seek entry in index");
     GST_OBJECT_UNLOCK (parse);
diff --git a/gst/matroska/matroska-read-common.c b/gst/matroska/matroska-read-common.c
index d2c2bea..31b7f38 100644
--- a/gst/matroska/matroska-read-common.c
+++ b/gst/matroska/matroska-read-common.c
@@ -361,7 +361,7 @@ gst_matroska_index_seek_find (GstMatroskaIndex * i1, GstClockTime * time,
 GstMatroskaIndex *
 gst_matroska_read_common_do_index_seek (GstMatroskaReadCommon * common,
     GstMatroskaTrackContext * track, gint64 seek_pos, GArray ** _index,
-    gint * _entry_index)
+    gint * _entry_index, gboolean next)
 {
   GstMatroskaIndex *entry = NULL;
   GArray *index;
@@ -378,11 +378,16 @@ gst_matroska_read_common_do_index_seek (GstMatroskaReadCommon * common,
   entry =
       gst_util_array_binary_search (index->data, index->len,
       sizeof (GstMatroskaIndex),
-      (GCompareDataFunc) gst_matroska_index_seek_find, GST_SEARCH_MODE_BEFORE,
-      &seek_pos, NULL);
+      (GCompareDataFunc) gst_matroska_index_seek_find,
+      next ? GST_SEARCH_MODE_AFTER : GST_SEARCH_MODE_BEFORE, &seek_pos, NULL);
 
-  if (entry == NULL)
-    entry = &g_array_index (index, GstMatroskaIndex, 0);
+  if (entry == NULL) {
+    if (next) {
+      return NULL;
+    } else {
+      entry = &g_array_index (index, GstMatroskaIndex, 0);
+    }
+  }
 
   if (_index)
     *_index = index;
diff --git a/gst/matroska/matroska-read-common.h b/gst/matroska/matroska-read-common.h
index cf617e6..bb381a4 100644
--- a/gst/matroska/matroska-read-common.h
+++ b/gst/matroska/matroska-read-common.h
@@ -96,7 +96,7 @@ gint gst_matroska_index_seek_find (GstMatroskaIndex * i1, GstClockTime * time,
     gpointer user_data);
 GstMatroskaIndex * gst_matroska_read_common_do_index_seek (
     GstMatroskaReadCommon * common, GstMatroskaTrackContext * track, gint64
-    seek_pos, GArray ** _index, gint * _entry_index);
+    seek_pos, GArray ** _index, gint * _entry_index, gboolean next);
 void gst_matroska_read_common_found_global_tag (GstMatroskaReadCommon * common,
     GstElement * el, GstTagList * taglist);
 gint64 gst_matroska_read_common_get_length (GstMatroskaReadCommon * common);
diff --git a/gst/median/.gitignore b/gst/median/.gitignore
new file mode 100644
index 0000000..08f5ed3
--- /dev/null
+++ b/gst/median/.gitignore
@@ -0,0 +1,7 @@
+Makefile
+Makefile.in
+*.o
+*.lo
+*.la
+.deps
+.libs
diff --git a/gst/median/Makefile.am b/gst/median/Makefile.am
new file mode 100644
index 0000000..32f9d82
--- /dev/null
+++ b/gst/median/Makefile.am
@@ -0,0 +1,10 @@
+plugin_LTLIBRARIES = libgstmedian.la
+
+libgstmedian_la_SOURCES = gstmedian.c
+
+libgstmedian_la_CFLAGS = $(GST_CFLAGS)
+libgstmedian_la_LIBADD = $(GST_LIBS)
+libgstmedian_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS)
+libgstmedian_la_LIBTOOLFLAGS = --tag=disable-static
+
+noinst_HEADERS = gstmedian.h
diff --git a/gst/median/gstmedian.c b/gst/median/gstmedian.c
new file mode 100644
index 0000000..b758750
--- /dev/null
+++ b/gst/median/gstmedian.c
@@ -0,0 +1,434 @@
+/* GStreamer
+ * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+#include <string.h>
+#include "gstmedian.h"
+#include <gst/video/video.h>
+
+static GstStaticPadTemplate median_src_factory = GST_STATIC_PAD_TEMPLATE ("src",
+    GST_PAD_SRC,
+    GST_PAD_ALWAYS,
+    GST_STATIC_CAPS (GST_VIDEO_CAPS_YUV ("I420"))
+    );
+
+static GstStaticPadTemplate median_sink_factory =
+GST_STATIC_PAD_TEMPLATE ("sink",
+    GST_PAD_SINK,
+    GST_PAD_ALWAYS,
+    GST_STATIC_CAPS (GST_VIDEO_CAPS_YUV ("I420"))
+    );
+
+
+/* Median signals and args */
+enum
+{
+  /* FILL ME */
+  LAST_SIGNAL
+};
+
+enum
+{
+  ARG_0,
+  ARG_ACTIVE,
+  ARG_FILTERSIZE,
+  ARG_LUM_ONLY
+};
+
+static GType gst_median_get_type (void);
+static void gst_median_class_init (GstMedianClass * klass);
+static void gst_median_base_init (GstMedianClass * klass);
+static void gst_median_init (GstMedian * median);
+
+static void median_5 (unsigned char *src, unsigned char *dest, int height,
+    int width);
+static void median_9 (unsigned char *src, unsigned char *dest, int height,
+    int width);
+static void gst_median_chain (GstPad * pad, GstData * _data);
+
+static void gst_median_set_property (GObject * object, guint prop_id,
+    const GValue * value, GParamSpec * pspec);
+static void gst_median_get_property (GObject * object, guint prop_id,
+    GValue * value, GParamSpec * pspec);
+
+static GstElementClass *parent_class = NULL;
+
+/*static guint gst_median_signals[LAST_SIGNAL] = { 0 }; */
+
+GType
+gst_median_get_type (void)
+{
+  static GType median_type = 0;
+
+  if (!median_type) {
+    static const GTypeInfo median_info = {
+      sizeof (GstMedianClass),
+      (GBaseInitFunc) gst_median_base_init,
+      NULL,
+      (GClassInitFunc) gst_median_class_init,
+      NULL,
+      NULL,
+      sizeof (GstMedian),
+      0,
+      (GInstanceInitFunc) gst_median_init,
+    };
+
+    median_type =
+        g_type_register_static (GST_TYPE_ELEMENT, "GstMedian", &median_info, 0);
+  }
+  return median_type;
+}
+
+static void
+gst_median_base_init (GstMedianClass * klass)
+{
+  GstElementClass *element_class = GST_ELEMENT_CLASS (klass);
+
+  gst_element_class_add_static_pad_template (element_class,
+      &median_sink_factory);
+  gst_element_class_add_static_pad_template (element_class,
+      &median_src_factory);
+  gst_element_class_set_details_simple (element_class, "Median effect",
+      "Filter/Effect/Video",
+      "Apply a median filter to an image",
+      "Wim Taymans <wim.taymans@chello.be>");
+}
+
+static void
+gst_median_class_init (GstMedianClass * klass)
+{
+  GObjectClass *gobject_class;
+  GstElementClass *gstelement_class;
+
+  gobject_class = (GObjectClass *) klass;
+  gstelement_class = (GstElementClass *) klass;
+
+  parent_class = g_type_class_peek_parent (klass);
+
+  /* FIXME: add long property descriptions */
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_ACTIVE,
+      g_param_spec_boolean ("active", "active", "active", TRUE,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_FILTERSIZE,
+      g_param_spec_int ("filtersize", "filtersize", "filtersize", G_MININT,
+          G_MAXINT, 0, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_LUM_ONLY,
+      g_param_spec_boolean ("lum-only", "lum-only", "lum-only", TRUE,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
+  gobject_class->set_property = gst_median_set_property;
+  gobject_class->get_property = gst_median_get_property;
+}
+
+static gboolean
+gst_median_link (GstPad * pad, const GstCaps * caps)
+{
+  GstMedian *filter = GST_MEDIAN (gst_pad_get_parent (pad));
+  GstPad *otherpad = (pad == filter->srcpad) ? filter->sinkpad : filter->srcpad;
+  GstStructure *structure = gst_caps_get_structure (caps, 0);
+  gint w, h;
+  GstPadLinkReturn ret;
+
+  gst_structure_get_int (structure, "width", &w);
+  gst_structure_get_int (structure, "height", &h);
+
+  ret = gst_pad_try_set_caps (otherpad, caps);
+  if (GST_PAD_LINK_SUCCESSFUL (ret)) {
+    filter->width = w;
+    filter->height = h;
+  }
+
+  gst_object_unref (filter);
+
+  return ret;
+}
+
+void
+gst_median_init (GstMedian * median)
+{
+  median->sinkpad =
+      gst_pad_new_from_static_template (&media_sink_factory, "sink");
+  gst_pad_set_getcaps_function (median->sinkpad, gst_pad_proxy_getcaps);
+  gst_pad_set_link_function (median->sinkpad, gst_median_link);
+  gst_pad_set_chain_function (median->sinkpad, gst_median_chain);
+  gst_element_add_pad (GST_ELEMENT (median), median->sinkpad);
+
+  median->srcpad = gst_pad_new_from_static_template (&media_src_factory, "src");
+  gst_pad_set_getcaps_function (median->srcpad, gst_pad_proxy_getcaps);
+  gst_pad_set_link_function (median->sinkpad, gst_median_link);
+  gst_element_add_pad (GST_ELEMENT (median), median->srcpad);
+
+  median->filtersize = 5;
+  median->lum_only = TRUE;
+  median->active = TRUE;
+}
+
+#define PIX_SORT(a,b) { if ((a)>(b)) PIX_SWAP((a),(b)); }
+#define PIX_SWAP(a,b) { unsigned char temp=(a);(a)=(b);(b)=temp; }
+
+static void
+median_5 (unsigned char *src, unsigned char *dest, int width, int height)
+{
+  int nLastRow;
+  int nLastCol;
+  unsigned char p[9];
+  int i, j, k;
+
+  nLastCol = width - 1;
+  nLastRow = height - 1;
+
+  /*copy the top and bottom rows into the result array */
+  for (i = 0; i < width; i++) {
+    dest[i] = src[i];
+    dest[nLastRow * width + i] = src[nLastRow * width + i];
+  }
+  dest[i] = src[i];
+
+  nLastCol--;
+  nLastRow--;
+
+  /* process the interior pixels */
+  i = width + 1;
+  for (k = 0; k < nLastRow; k++) {
+    for (j = 0; j < nLastCol; j++, i++) {
+      p[0] = src[i - width];
+      p[1] = src[i - 1];
+      p[2] = src[i];
+      p[3] = src[i + 1];
+      p[4] = src[i + width];
+      PIX_SORT (p[0], p[1]);
+      PIX_SORT (p[3], p[4]);
+      PIX_SORT (p[0], p[3]);
+      PIX_SORT (p[1], p[4]);
+      PIX_SORT (p[1], p[2]);
+      PIX_SORT (p[2], p[3]);
+      PIX_SORT (p[1], p[2]);
+      dest[i] = p[2];
+    }
+    dest[i] = src[i];
+    i++;
+    dest[i] = src[i];
+    i++;
+  }
+  dest[i] = src[i];
+  i++;
+}
+
+static void
+median_9 (unsigned char *src, unsigned char *dest, int width, int height)
+{
+  int nLastRow;
+  int nLastCol;
+  unsigned char p[9];
+  int i, j, k;
+
+  nLastCol = width - 1;
+  nLastRow = height - 1;
+
+  /*copy the top and bottom rows into the result array */
+  for (i = 0; i < width; i++) {
+    dest[i] = src[i];
+    dest[nLastRow * width + i] = src[nLastRow * width + i];
+  }
+  dest[i] = src[i];
+
+  nLastCol--;
+  nLastRow--;
+
+  /* process the interior pixels */
+  i = width + 1;
+  for (k = 0; k < nLastRow; k++) {
+    for (j = 0; j < nLastCol; j++, i++) {
+      p[0] = src[i - width - 1];
+      p[1] = src[i - width];
+      p[2] = src[i - width + 1];
+      p[3] = src[i - 1];
+      p[4] = src[i];
+      p[5] = src[i + 1];
+      p[6] = src[i + width - 1];
+      p[7] = src[i + width];
+      p[8] = src[i + width + 1];
+      PIX_SORT (p[1], p[2]);
+      PIX_SORT (p[4], p[5]);
+      PIX_SORT (p[7], p[8]);
+      PIX_SORT (p[0], p[1]);
+      PIX_SORT (p[3], p[4]);
+      PIX_SORT (p[6], p[7]);
+      PIX_SORT (p[1], p[2]);
+      PIX_SORT (p[4], p[5]);
+      PIX_SORT (p[7], p[8]);
+      PIX_SORT (p[0], p[3]);
+      PIX_SORT (p[5], p[8]);
+      PIX_SORT (p[4], p[7]);
+      PIX_SORT (p[3], p[6]);
+      PIX_SORT (p[1], p[4]);
+      PIX_SORT (p[2], p[5]);
+      PIX_SORT (p[4], p[7]);
+      PIX_SORT (p[4], p[2]);
+      PIX_SORT (p[6], p[4]);
+      PIX_SORT (p[4], p[2]);
+      dest[i] = p[4];
+    }
+    dest[i] = src[i];
+    i++;
+    dest[i] = src[i];
+    i++;
+  }
+  dest[i] = src[i];
+  i++;
+}
+
+static void
+gst_median_chain (GstPad * pad, GstData * _data)
+{
+  GstBuffer *buf = GST_BUFFER (_data);
+  GstMedian *median;
+  guchar *data;
+  gulong size;
+  GstBuffer *outbuf;
+
+/*  GstMeta *meta; */
+  int lumsize, chromsize;
+
+  g_return_if_fail (pad != NULL);
+  g_return_if_fail (GST_IS_PAD (pad));
+  g_return_if_fail (buf != NULL);
+
+  median = GST_MEDIAN (GST_OBJECT_PARENT (pad));
+
+  if (!median->active) {
+    gst_pad_push (median->srcpad, GST_DATA (buf));
+    return;
+  }
+
+  data = GST_BUFFER_DATA (buf);
+  size = GST_BUFFER_SIZE (buf);
+
+  GST_DEBUG ("median: have buffer of %d", GST_BUFFER_SIZE (buf));
+
+  outbuf = gst_buffer_new ();
+  GST_BUFFER_DATA (outbuf) = g_malloc (GST_BUFFER_SIZE (buf));
+  GST_BUFFER_SIZE (outbuf) = GST_BUFFER_SIZE (buf);
+
+  lumsize = median->width * median->height;
+  chromsize = lumsize / 4;
+
+  if (median->filtersize == 5) {
+    median_5 (data, GST_BUFFER_DATA (outbuf), median->width, median->height);
+    if (!median->lum_only) {
+      median_5 (data + lumsize, GST_BUFFER_DATA (outbuf) + lumsize,
+          median->width / 2, median->height / 2);
+      median_5 (data + lumsize + chromsize,
+          GST_BUFFER_DATA (outbuf) + lumsize + chromsize, median->width / 2,
+          median->height / 2);
+    } else {
+      memcpy (GST_BUFFER_DATA (outbuf) + lumsize, data + lumsize,
+          chromsize * 2);
+    }
+  } else {
+    median_9 (data, GST_BUFFER_DATA (outbuf), median->width, median->height);
+    if (!median->lum_only) {
+      median_9 (data + lumsize, GST_BUFFER_DATA (outbuf) + lumsize,
+          median->width / 2, median->height / 2);
+      median_9 (data + lumsize + chromsize,
+          GST_BUFFER_DATA (outbuf) + lumsize + chromsize, median->width / 2,
+          median->height / 2);
+    } else {
+      memcpy (GST_BUFFER_DATA (outbuf) + lumsize, data + lumsize,
+          chromsize * 2);
+    }
+  }
+  GST_BUFFER_TIMESTAMP (outbuf) = GST_BUFFER_TIMESTAMP (buf);
+
+  gst_buffer_unref (buf);
+
+  gst_pad_push (median->srcpad, GST_DATA (outbuf));
+}
+
+static void
+gst_median_set_property (GObject * object, guint prop_id, const GValue * value,
+    GParamSpec * pspec)
+{
+  GstMedian *median;
+  gint argvalue;
+
+  g_return_if_fail (GST_IS_MEDIAN (object));
+  median = GST_MEDIAN (object);
+
+  switch (prop_id) {
+    case ARG_FILTERSIZE:
+      argvalue = g_value_get_int (value);
+      if (argvalue != 5 && argvalue != 9) {
+        g_warning ("median: invalid filtersize (%d), must be 5 or 9\n",
+            argvalue);
+      } else {
+        median->filtersize = argvalue;
+      }
+      break;
+    case ARG_ACTIVE:
+      median->active = g_value_get_boolean (value);
+      break;
+    case ARG_LUM_ONLY:
+      median->lum_only = g_value_get_boolean (value);
+      break;
+    default:
+      break;
+  }
+}
+
+static void
+gst_median_get_property (GObject * object, guint prop_id, GValue * value,
+    GParamSpec * pspec)
+{
+  GstMedian *median;
+
+  g_return_if_fail (GST_IS_MEDIAN (object));
+  median = GST_MEDIAN (object);
+
+  switch (prop_id) {
+    case ARG_FILTERSIZE:
+      g_value_set_int (value, median->filtersize);
+      break;
+    case ARG_ACTIVE:
+      g_value_set_boolean (value, median->active);
+      break;
+    case ARG_LUM_ONLY:
+      g_value_set_boolean (value, median->lum_only);
+      break;
+    default:
+      G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
+      break;
+  }
+}
+
+
+static gboolean
+plugin_init (GstPlugin * plugin)
+{
+  return gst_element_register (plugin, "median",
+      GST_RANK_NONE, GST_TYPE_MEDIAN);
+}
+
+GST_PLUGIN_DEFINE (GST_VERSION_MAJOR,
+    GST_VERSION_MINOR,
+    "median",
+    "Video median filter",
+    plugin_init, VERSION, GST_LICENSE, GST_PACKAGE_NAME, GST_PACKAGE_ORIGIN)
diff --git a/gst/median/gstmedian.h b/gst/median/gstmedian.h
new file mode 100644
index 0000000..bd98080
--- /dev/null
+++ b/gst/median/gstmedian.h
@@ -0,0 +1,71 @@
+/* GStreamer
+ * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+
+#ifndef __GST_MEDIAN_H__
+#define __GST_MEDIAN_H__
+
+
+#include <gst/gst.h>
+
+
+#ifdef __cplusplus
+extern "C" {
+#endif /* __cplusplus */
+
+
+#define GST_TYPE_MEDIAN \
+  (gst_median_get_type())
+#define GST_MEDIAN(obj) \
+  (G_TYPE_CHECK_INSTANCE_CAST((obj),GST_TYPE_MEDIAN,GstMedian))
+#define GST_MEDIAN_CLASS(klass) \
+  (G_TYPE_CHECK_CLASS_CAST((klass),GST_TYPE_MEDIAN,GstMedianClass))
+#define GST_IS_MEDIAN(obj) \
+  (G_TYPE_CHECK_INSTANCE_TYPE((obj),GST_TYPE_MEDIAN))
+#define GST_IS_MEDIAN_CLASS(klass) \
+  (G_TYPE_CHECK_CLASS_TYPE((klass),GST_TYPE_MEDIAN))
+
+typedef struct _GstMedian GstMedian;
+typedef struct _GstMedianClass GstMedianClass;
+
+struct _GstMedian {
+  GstElement element;
+
+  int format;
+  int width;
+  int height;
+
+  int filtersize;
+
+  gboolean active;
+  gboolean lum_only;
+
+  GstPad *sinkpad,*srcpad;
+};
+
+struct _GstMedianClass {
+  GstElementClass parent_class;
+};
+
+#ifdef __cplusplus
+}
+#endif /* __cplusplus */
+
+
+#endif /* __GST_MEDIAN_H__ */
diff --git a/gst/median/median.vcproj b/gst/median/median.vcproj
new file mode 100644
index 0000000..aac6f9a
--- /dev/null
+++ b/gst/median/median.vcproj
@@ -0,0 +1,148 @@
+<?xml version="1.0" encoding="Windows-1252"?>
+<VisualStudioProject
+	ProjectType="Visual C++"
+	Version="7.10"
+	Name="median"
+	ProjectGUID="{979C216F-0ACF-4956-AE00-055A42D678B9}"
+	Keyword="Win32Proj">
+	<Platforms>
+		<Platform
+			Name="Win32"/>
+	</Platforms>
+	<Configurations>
+		<Configuration
+			Name="Debug|Win32"
+			OutputDirectory="../../win32/Debug"
+			IntermediateDirectory="../../win32/Debug"
+			ConfigurationType="2"
+			CharacterSet="2">
+			<Tool
+				Name="VCCLCompilerTool"
+				Optimization="0"
+				AdditionalIncludeDirectories="../../../gstreamer/win32;../../../gstreamer;../../../gstreamer/libs;../../../glib;../../../glib/glib;../../../glib/gmodule;&quot;../../gst-libs&quot;;../../../popt/include;../../../libxml2/include/libxml2"
+				PreprocessorDefinitions="WIN32;_DEBUG;_WINDOWS;_USRDLL;median_EXPORTS;HAVE_CONFIG_H;_USE_MATH_DEFINES"
+				MinimalRebuild="TRUE"
+				BasicRuntimeChecks="3"
+				RuntimeLibrary="3"
+				UsePrecompiledHeader="0"
+				WarningLevel="3"
+				Detect64BitPortabilityProblems="TRUE"
+				DebugInformationFormat="4"/>
+			<Tool
+				Name="VCCustomBuildTool"/>
+			<Tool
+				Name="VCLinkerTool"
+				AdditionalDependencies="glib-2.0.lib gmodule-2.0.lib gthread-2.0.lib gobject-2.0.lib libgstreamer.lib gstbytestream.lib iconv.lib intl.lib"
+				OutputFile="$(OutDir)/gstmedian.dll"
+				LinkIncremental="2"
+				AdditionalLibraryDirectories="../../../gstreamer/win32/Debug;../../../glib/glib;../../../glib/gmodule;../../../glib/gthread;../../../glib/gobject;../../../gettext/lib;../../../libiconv/lib"
+				ModuleDefinitionFile=""
+				GenerateDebugInformation="TRUE"
+				ProgramDatabaseFile="$(OutDir)/median.pdb"
+				SubSystem="2"
+				OptimizeReferences="2"
+				ImportLibrary="$(OutDir)/gstmedian.lib"
+				TargetMachine="1"/>
+			<Tool
+				Name="VCMIDLTool"/>
+			<Tool
+				Name="VCPostBuildEventTool"
+				CommandLine="copy /Y $(TargetPath) c:\gstreamer\plugins"/>
+			<Tool
+				Name="VCPreBuildEventTool"/>
+			<Tool
+				Name="VCPreLinkEventTool"/>
+			<Tool
+				Name="VCResourceCompilerTool"/>
+			<Tool
+				Name="VCWebServiceProxyGeneratorTool"/>
+			<Tool
+				Name="VCXMLDataGeneratorTool"/>
+			<Tool
+				Name="VCWebDeploymentTool"/>
+			<Tool
+				Name="VCManagedWrapperGeneratorTool"/>
+			<Tool
+				Name="VCAuxiliaryManagedWrapperGeneratorTool"/>
+		</Configuration>
+		<Configuration
+			Name="Release|Win32"
+			OutputDirectory="../../win32/Release"
+			IntermediateDirectory="../../win32/Release"
+			ConfigurationType="2"
+			CharacterSet="2">
+			<Tool
+				Name="VCCLCompilerTool"
+				AdditionalIncludeDirectories="../../../gstreamer/win32;../../../gstreamer;../../../gstreamer/libs;../../../glib;../../../glib/glib;../../../glib/gmodule;&quot;../../gst-libs&quot;;../../../popt/include;../../../libxml2/include/libxml2"
+				PreprocessorDefinitions="WIN32;NDEBUG;GST_DISABLE_GST_DEBUG;_WINDOWS;_USRDLL;median_EXPORTS;HAVE_CONFIG_H;_USE_MATH_DEFINES"
+				RuntimeLibrary="2"
+				UsePrecompiledHeader="0"
+				WarningLevel="3"
+				Detect64BitPortabilityProblems="TRUE"
+				DebugInformationFormat="3"/>
+			<Tool
+				Name="VCCustomBuildTool"/>
+			<Tool
+				Name="VCLinkerTool"
+				AdditionalDependencies="glib-2.0.lib gmodule-2.0.lib gthread-2.0.lib gobject-2.0.lib libgstreamer.lib gstbytestream.lib iconv.lib intl.lib"
+				OutputFile="$(OutDir)/gstmedian.dll"
+				LinkIncremental="1"
+				AdditionalLibraryDirectories="../../../gstreamer/win32/Release;../../../glib/glib;../../../glib/gmodule;../../../glib/gthread;../../../glib/gobject;../../../gettext/lib;../../../libiconv/lib"
+				ModuleDefinitionFile=""
+				GenerateDebugInformation="TRUE"
+				SubSystem="2"
+				OptimizeReferences="2"
+				EnableCOMDATFolding="2"
+				ImportLibrary="$(OutDir)/gstmedian.lib"
+				TargetMachine="1"/>
+			<Tool
+				Name="VCMIDLTool"/>
+			<Tool
+				Name="VCPostBuildEventTool"
+				CommandLine="copy /Y $(TargetPath) c:\gstreamer\plugins"/>
+			<Tool
+				Name="VCPreBuildEventTool"/>
+			<Tool
+				Name="VCPreLinkEventTool"/>
+			<Tool
+				Name="VCResourceCompilerTool"/>
+			<Tool
+				Name="VCWebServiceProxyGeneratorTool"/>
+			<Tool
+				Name="VCXMLDataGeneratorTool"/>
+			<Tool
+				Name="VCWebDeploymentTool"/>
+			<Tool
+				Name="VCManagedWrapperGeneratorTool"/>
+			<Tool
+				Name="VCAuxiliaryManagedWrapperGeneratorTool"/>
+		</Configuration>
+	</Configurations>
+	<References>
+	</References>
+	<Files>
+		<Filter
+			Name="Source Files"
+			Filter="cpp;c;cxx;def;odl;idl;hpj;bat;asm;asmx"
+			UniqueIdentifier="{4FC737F1-C7A5-4376-A066-2A32D752A2FF}">
+			<File
+				RelativePath=".\gstmedian.c">
+			</File>
+		</Filter>
+		<Filter
+			Name="Header Files"
+			Filter="h;hpp;hxx;hm;inl;inc;xsd"
+			UniqueIdentifier="{93995380-89BD-4b04-88EB-625FBE52EBFB}">
+			<File
+				RelativePath=".\gstmedian.h">
+			</File>
+		</Filter>
+		<Filter
+			Name="Resource Files"
+			Filter="rc;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe;resx"
+			UniqueIdentifier="{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}">
+		</Filter>
+	</Files>
+	<Globals>
+	</Globals>
+</VisualStudioProject>
diff --git a/gst/monoscope/Makefile.in b/gst/monoscope/Makefile.in
index c49327e..df2d861 100644
--- a/gst/monoscope/Makefile.in
+++ b/gst/monoscope/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/monoscope
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -119,10 +135,23 @@ libgstmonoscope_la_OBJECTS = $(am_libgstmonoscope_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstmonoscope_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstmonoscope_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstmonoscope_la_CFLAGS) $(CFLAGS) \
 	$(libgstmonoscope_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -135,22 +164,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstmonoscope_la_SOURCES)
 DIST_SOURCES = $(libgstmonoscope_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -210,6 +240,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -258,8 +289,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -340,7 +373,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -400,6 +433,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -473,7 +507,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -520,7 +558,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -528,6 +565,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -543,12 +582,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstmonoscope.la: $(libgstmonoscope_la_OBJECTS) $(libgstmonoscope_la_DEPENDENCIES) $(EXTRA_libgstmonoscope_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstmonoscope_la_LINK) -rpath $(plugindir) $(libgstmonoscope_la_OBJECTS) $(libgstmonoscope_la_LIBADD) $(LIBS)
 
@@ -659,6 +700,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -803,18 +858,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/multifile/Makefile.in b/gst/multifile/Makefile.in
index 60d4d58..8ea0874 100644
--- a/gst/multifile/Makefile.in
+++ b/gst/multifile/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/multifile
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -124,10 +140,23 @@ libgstmultifile_la_OBJECTS = $(am_libgstmultifile_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstmultifile_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstmultifile_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstmultifile_la_CFLAGS) $(CFLAGS) \
 	$(libgstmultifile_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -140,22 +169,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstmultifile_la_SOURCES)
 DIST_SOURCES = $(libgstmultifile_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -215,6 +245,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -263,8 +294,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -345,7 +378,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -405,6 +438,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -478,7 +512,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -531,7 +569,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -539,6 +576,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -554,12 +593,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstmultifile.la: $(libgstmultifile_la_OBJECTS) $(libgstmultifile_la_DEPENDENCIES) $(EXTRA_libgstmultifile_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstmultifile_la_LINK) -rpath $(plugindir) $(libgstmultifile_la_OBJECTS) $(libgstmultifile_la_LIBADD) $(LIBS)
 
@@ -686,6 +727,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -830,18 +885,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/multifile/gstmultifilesink.c b/gst/multifile/gstmultifilesink.c
index 2be3b56..485bbf0 100644
--- a/gst/multifile/gstmultifilesink.c
+++ b/gst/multifile/gstmultifilesink.c
@@ -516,6 +516,7 @@ gst_multi_file_sink_render (GstBaseSink * sink, GstBuffer * buffer)
   gchar *filename;
   gboolean ret;
   GError *error = NULL;
+  gboolean first_file = TRUE;
 
   size = GST_BUFFER_SIZE (buffer);
   data = GST_BUFFER_DATA (buffer);
@@ -567,9 +568,10 @@ gst_multi_file_sink_render (GstBaseSink * sink, GstBuffer * buffer)
       if (GST_BUFFER_TIMESTAMP_IS_VALID (buffer) &&
           GST_BUFFER_TIMESTAMP (buffer) >= multifilesink->next_segment &&
           !GST_BUFFER_FLAG_IS_SET (buffer, GST_BUFFER_FLAG_DELTA_UNIT)) {
-        if (multifilesink->file)
+        if (multifilesink->file) {
+          first_file = FALSE;
           gst_multi_file_sink_close_file (multifilesink, buffer);
-
+        }
         multifilesink->next_segment += 10 * GST_SECOND;
       }
 
@@ -577,7 +579,8 @@ gst_multi_file_sink_render (GstBaseSink * sink, GstBuffer * buffer)
         if (!gst_multi_file_sink_open_next_file (multifilesink))
           goto stdio_write_error;
 
-        gst_multi_file_sink_write_stream_headers (multifilesink);
+        if (!first_file)
+          gst_multi_file_sink_write_stream_headers (multifilesink);
       }
 
       ret = fwrite (GST_BUFFER_DATA (buffer), GST_BUFFER_SIZE (buffer), 1,
@@ -609,15 +612,18 @@ gst_multi_file_sink_render (GstBaseSink * sink, GstBuffer * buffer)
             multifilesink->cur_file_size, new_size,
             multifilesink->max_file_size);
 
-        if (multifilesink->file != NULL)
+        if (multifilesink->file != NULL) {
+          first_file = FALSE;
           gst_multi_file_sink_close_file (multifilesink, NULL);
+        }
       }
 
       if (multifilesink->file == NULL) {
         if (!gst_multi_file_sink_open_next_file (multifilesink))
           goto stdio_write_error;
 
-        gst_multi_file_sink_write_stream_headers (multifilesink);
+        if (!first_file)
+          gst_multi_file_sink_write_stream_headers (multifilesink);
       }
 
       ret = fwrite (GST_BUFFER_DATA (buffer), GST_BUFFER_SIZE (buffer), 1,
@@ -703,7 +709,7 @@ static GstFlowReturn
 gst_multi_file_sink_render_list (GstBaseSink * sink, GstBufferList * list)
 {
   GstBuffer *buf;
-  guint size;
+  guint size = 0;
 
   gst_buffer_list_foreach (list, buffer_list_calc_size, &size);
   GST_LOG_OBJECT (sink, "total size of buffer list %p: %u", list, size);
diff --git a/gst/multifile/gstsplitfilesrc.c b/gst/multifile/gstsplitfilesrc.c
index 3125997..9cda44a 100644
--- a/gst/multifile/gstsplitfilesrc.c
+++ b/gst/multifile/gstsplitfilesrc.c
@@ -30,19 +30,18 @@
  * directories). The results will be sorted.
  *
  * <refsect2>
- * <title>Example launch line</title>
+ * <title>Example launch lines</title>
  * |[
- * gst-launch splitfilesrc location="/path/to/part-*.mpg" ! decodebin ! ... \
+ * gst-launch splitfilesrc location="/path/to/part-*.mpg" ! decodebin ! ...
  * ]| Plays the different parts as if they were one single MPEG file.
+ * |[
+ * gst-launch playbin2 uri="splitfile://path/to/foo.avi.*"
+ * ]| Plays the different parts as if they were one single AVI file.
  * </refsect2>
  *
  * Since: 0.10.31
  */
 
-/* TODO:
- *  - implement splitfile:// URI handler?
- */
-
 #ifdef HAVE_CONFIG_H
 #  include "config.h"
 #endif
@@ -65,6 +64,8 @@ enum
 
 #define DEFAULT_LOCATION NULL
 
+static void gst_split_file_src_uri_handler_init (gpointer g_iface,
+    gpointer iface_data);
 static void gst_split_file_src_set_property (GObject * object, guint prop_id,
     const GValue * value, GParamSpec * pspec);
 static void gst_split_file_src_get_property (GObject * object, guint prop_id,
@@ -89,8 +90,25 @@ GST_STATIC_PAD_TEMPLATE ("src",
 GST_DEBUG_CATEGORY_STATIC (splitfilesrc_debug);
 #define GST_CAT_DEFAULT splitfilesrc_debug
 
-GST_BOILERPLATE (GstSplitFileSrc, gst_split_file_src, GstBaseSrc,
-    GST_TYPE_BASE_SRC);
+
+
+static void
+_do_init (GType type)
+{
+  static const GInterfaceInfo urihandler_info = {
+    gst_split_file_src_uri_handler_init,
+    NULL,
+    NULL
+  };
+
+  g_type_add_interface_static (type, GST_TYPE_URI_HANDLER, &urihandler_info);
+
+  GST_DEBUG_CATEGORY_INIT (splitfilesrc_debug, "splitfilesrc", 0,
+      "Split File src");
+}
+
+GST_BOILERPLATE_FULL (GstSplitFileSrc, gst_split_file_src, GstBaseSrc,
+    GST_TYPE_BASE_SRC, _do_init);
 
 static void
 gst_split_file_src_base_init (gpointer g_class)
@@ -199,6 +217,25 @@ gst_split_file_src_get_size (GstBaseSrc * basesrc, guint64 * size)
 }
 
 static void
+gst_split_file_src_set_location (GstSplitFileSrc * src, const char *location)
+{
+  GST_OBJECT_LOCK (src);
+  g_free (src->location);
+
+  if (location != NULL && g_str_has_prefix (location, "splitfile://"))
+    src->location = gst_uri_get_location (location);
+  else
+    src->location = g_strdup (location);
+#ifdef G_OS_WIN32
+  if (!g_utf8_validate (src->location, -1, NULL)) {
+    g_warning ("splitfilesrc 'location' property must be in UTF-8 "
+        "encoding on Windows");
+  }
+#endif
+  GST_OBJECT_UNLOCK (src);
+}
+
+static void
 gst_split_file_src_set_property (GObject * object, guint prop_id,
     const GValue * value, GParamSpec * pspec)
 {
@@ -206,16 +243,7 @@ gst_split_file_src_set_property (GObject * object, guint prop_id,
 
   switch (prop_id) {
     case PROP_LOCATION:
-      GST_OBJECT_LOCK (src);
-      g_free (src->location);
-      src->location = g_value_dup_string (value);
-#ifdef G_OS_WIN32
-      if (!g_utf8_validate (src->location, -1, NULL)) {
-        g_warning ("splitfilesrc 'location' property must be in UTF-8 "
-            "encoding on Windows");
-      }
-#endif
-      GST_OBJECT_UNLOCK (src);
+      gst_split_file_src_set_location (src, g_value_get_string (value));
       break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
@@ -614,3 +642,54 @@ cancelled:
     return GST_FLOW_WRONG_STATE;
   }
 }
+
+static guint
+gst_split_file_src_uri_get_type (void)
+{
+  return GST_URI_SRC;
+}
+
+static gchar **
+gst_split_file_src_uri_get_protocols (void)
+{
+  static const gchar *protocols[] = { "splitfile", NULL };
+
+  return (gchar **) protocols;
+}
+
+static const gchar *
+gst_split_file_src_uri_get_uri (GstURIHandler * handler)
+{
+  GstSplitFileSrc *src = GST_SPLIT_FILE_SRC (handler);
+  gchar *ret;
+
+  GST_OBJECT_LOCK (src);
+  if (src->location != NULL)
+    ret = g_strdup_printf ("splitfile://%s", src->location);
+  else
+    ret = NULL;
+  GST_OBJECT_UNLOCK (src);
+
+  return ret;
+}
+
+static gboolean
+gst_split_file_src_uri_set_uri (GstURIHandler * handler, const gchar * uri)
+{
+  GstSplitFileSrc *src = GST_SPLIT_FILE_SRC (handler);
+
+  gst_split_file_src_set_location (src, uri);
+
+  return TRUE;
+}
+
+static void
+gst_split_file_src_uri_handler_init (gpointer g_iface, gpointer iface_data)
+{
+  GstURIHandlerInterface *iface = (GstURIHandlerInterface *) g_iface;
+
+  iface->get_type = gst_split_file_src_uri_get_type;
+  iface->get_protocols = gst_split_file_src_uri_get_protocols;
+  iface->get_uri = gst_split_file_src_uri_get_uri;
+  iface->set_uri = gst_split_file_src_uri_set_uri;
+}
diff --git a/gst/multipart/Makefile.in b/gst/multipart/Makefile.in
index 7a421f3..da04c11 100644
--- a/gst/multipart/Makefile.in
+++ b/gst/multipart/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/multipart
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -120,10 +136,23 @@ libgstmultipart_la_OBJECTS = $(am_libgstmultipart_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstmultipart_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstmultipart_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstmultipart_la_CFLAGS) $(CFLAGS) \
 	$(libgstmultipart_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -136,22 +165,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstmultipart_la_SOURCES)
 DIST_SOURCES = $(libgstmultipart_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -211,6 +241,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -259,8 +290,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -341,7 +374,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -401,6 +434,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -474,7 +508,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -521,7 +559,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -529,6 +566,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -544,12 +583,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstmultipart.la: $(libgstmultipart_la_OBJECTS) $(libgstmultipart_la_DEPENDENCIES) $(EXTRA_libgstmultipart_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstmultipart_la_LINK) -rpath $(plugindir) $(libgstmultipart_la_OBJECTS) $(libgstmultipart_la_LIBADD) $(LIBS)
 
@@ -660,6 +701,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -804,18 +859,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/multipart/multipartmux.c b/gst/multipart/multipartmux.c
index 9d3e56a..0417b76 100644
--- a/gst/multipart/multipartmux.c
+++ b/gst/multipart/multipartmux.c
@@ -88,7 +88,7 @@ static GstPad *gst_multipart_mux_request_new_pad (GstElement * element,
 static GstStateChangeReturn gst_multipart_mux_change_state (GstElement *
     element, GstStateChange transition);
 
-static GstFlowReturn gst_multipart_mux_collected (GstCollectPads * pads,
+static GstFlowReturn gst_multipart_mux_collected (GstCollectPads2 * pads,
     GstMultipartMux * mux);
 
 static void gst_multipart_mux_set_property (GObject * object, guint prop_id,
@@ -180,9 +180,9 @@ gst_multipart_mux_init (GstMultipartMux * multipart_mux)
 
   multipart_mux->boundary = g_strdup (DEFAULT_BOUNDARY);
 
-  multipart_mux->collect = gst_collect_pads_new ();
-  gst_collect_pads_set_function (multipart_mux->collect,
-      (GstCollectPadsFunction) GST_DEBUG_FUNCPTR (gst_multipart_mux_collected),
+  multipart_mux->collect = gst_collect_pads2_new ();
+  gst_collect_pads2_set_function (multipart_mux->collect,
+      (GstCollectPads2Function) GST_DEBUG_FUNCPTR (gst_multipart_mux_collected),
       multipart_mux);
 }
 
@@ -226,7 +226,7 @@ gst_multipart_mux_request_new_pad (GstElement * element,
     GstMultipartPadData *multipartpad;
 
     multipartpad = (GstMultipartPadData *)
-        gst_collect_pads_add_pad (multipart_mux->collect, newpad,
+        gst_collect_pads2_add_pad (multipart_mux->collect, newpad,
         sizeof (GstMultipartPadData));
 
     /* save a pointer to our data in the pad */
@@ -375,7 +375,7 @@ gst_multipart_mux_queue_pads (GstMultipartMux * mux)
   /* try to make sure we have a buffer from each usable pad first */
   walk = mux->collect->data;
   while (walk) {
-    GstCollectData *data = (GstCollectData *) walk->data;
+    GstCollectData2 *data = (GstCollectData2 *) walk->data;
     GstMultipartPadData *pad = (GstMultipartPadData *) data;
 
     walk = g_slist_next (walk);
@@ -384,7 +384,7 @@ gst_multipart_mux_queue_pads (GstMultipartMux * mux)
     if (pad->buffer == NULL) {
       GstBuffer *buf = NULL;
 
-      buf = gst_collect_pads_pop (mux->collect, data);
+      buf = gst_collect_pads2_pop (mux->collect, data);
 
       /* Store timestamp with segment_start and preroll */
       if (buf && GST_BUFFER_TIMESTAMP_IS_VALID (buf)) {
@@ -418,7 +418,7 @@ gst_multipart_mux_queue_pads (GstMultipartMux * mux)
  * 3) push both buffers on best pad, go to 1
  */
 static GstFlowReturn
-gst_multipart_mux_collected (GstCollectPads * pads, GstMultipartMux * mux)
+gst_multipart_mux_collected (GstCollectPads2 * pads, GstMultipartMux * mux)
 {
   GstMultipartPadData *best;
   GstFlowReturn ret = GST_FLOW_OK;
@@ -648,11 +648,11 @@ gst_multipart_mux_change_state (GstElement * element, GstStateChange transition)
       multipart_mux->negotiated = FALSE;
       multipart_mux->need_segment = TRUE;
       GST_DEBUG_OBJECT (multipart_mux, "starting collect pads");
-      gst_collect_pads_start (multipart_mux->collect);
+      gst_collect_pads2_start (multipart_mux->collect);
       break;
     case GST_STATE_CHANGE_PAUSED_TO_READY:
       GST_DEBUG_OBJECT (multipart_mux, "stopping collect pads");
-      gst_collect_pads_stop (multipart_mux->collect);
+      gst_collect_pads2_stop (multipart_mux->collect);
       break;
     default:
       break;
diff --git a/gst/multipart/multipartmux.h b/gst/multipart/multipartmux.h
index a52db36..1ea2d8a 100644
--- a/gst/multipart/multipartmux.h
+++ b/gst/multipart/multipartmux.h
@@ -23,7 +23,7 @@
 #define __GST_MULTIPART_MUX__
 
 #include <gst/gst.h>
-#include <gst/base/gstcollectpads.h>
+#include <gst/base/gstcollectpads2.h>
 
 #include <string.h>
 
@@ -42,7 +42,7 @@ typedef struct _GstMultipartMuxClass GstMultipartMuxClass;
 /* all information needed for one multipart stream */
 typedef struct
 {
-  GstCollectData collect;       /* we extend the CollectData */
+  GstCollectData2 collect;       /* we extend the CollectData2 */
 
   GstBuffer *buffer;            /* the queued buffer for this pad */
   GstClockTime timestamp;       /* its timestamp, converted to running_time so that we can
@@ -63,7 +63,7 @@ struct _GstMultipartMux
   GstPad *srcpad;
 
   /* sinkpads */
-  GstCollectPads *collect;
+  GstCollectPads2 *collect;
 
   gint numpads;
 
diff --git a/gst/replaygain/Makefile.in b/gst/replaygain/Makefile.in
index 81018de..1adc048 100644
--- a/gst/replaygain/Makefile.in
+++ b/gst/replaygain/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/replaygain
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -123,10 +139,23 @@ libgstreplaygain_la_OBJECTS = $(am_libgstreplaygain_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstreplaygain_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstreplaygain_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstreplaygain_la_CFLAGS) $(CFLAGS) \
 	$(libgstreplaygain_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -139,22 +168,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstreplaygain_la_SOURCES)
 DIST_SOURCES = $(libgstreplaygain_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -214,6 +244,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -262,8 +293,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -344,7 +377,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -404,6 +437,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -477,7 +511,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -543,7 +581,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -551,6 +588,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -566,12 +605,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstreplaygain.la: $(libgstreplaygain_la_OBJECTS) $(libgstreplaygain_la_DEPENDENCIES) $(EXTRA_libgstreplaygain_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstreplaygain_la_LINK) -rpath $(plugindir) $(libgstreplaygain_la_OBJECTS) $(libgstreplaygain_la_LIBADD) $(LIBS)
 
@@ -698,6 +739,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -842,18 +897,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/rtp/Makefile.in b/gst/rtp/Makefile.in
index 301db36..5888f30 100644
--- a/gst/rtp/Makefile.in
+++ b/gst/rtp/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/rtp
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in TODO
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp TODO
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -160,10 +176,23 @@ libgstrtp_la_OBJECTS = $(am_libgstrtp_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstrtp_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstrtp_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstrtp_la_CFLAGS) $(CFLAGS) \
 	$(libgstrtp_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -176,22 +205,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstrtp_la_SOURCES)
 DIST_SOURCES = $(libgstrtp_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -251,6 +281,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -299,8 +330,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -381,7 +414,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -441,6 +474,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -514,7 +548,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -715,7 +753,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -723,6 +760,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -738,12 +777,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstrtp.la: $(libgstrtp_la_OBJECTS) $(libgstrtp_la_DEPENDENCIES) $(EXTRA_libgstrtp_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstrtp_la_LINK) -rpath $(plugindir) $(libgstrtp_la_OBJECTS) $(libgstrtp_la_LIBADD) $(LIBS)
 
@@ -1406,6 +1447,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -1550,18 +1605,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/rtp/gstrtpceltdepay.c b/gst/rtp/gstrtpceltdepay.c
index b583efd..a51a27b 100644
--- a/gst/rtp/gstrtpceltdepay.c
+++ b/gst/rtp/gstrtpceltdepay.c
@@ -247,7 +247,7 @@ gst_rtp_celt_depay_process (GstBaseRTPDepayload * depayload, GstBuffer * buf)
     do {
       s = payload[pos++];
       size += s;
-      total_size += size + 1;
+      total_size += s + 1;
     } while (s == 0xff);
 
     outbuf = gst_rtp_buffer_get_payload_subbuffer (buf, offset, size);
diff --git a/gst/rtp/gstrtpdvdepay.c b/gst/rtp/gstrtpdvdepay.c
index 4098c39..43e6aa1 100644
--- a/gst/rtp/gstrtpdvdepay.c
+++ b/gst/rtp/gstrtpdvdepay.c
@@ -336,12 +336,14 @@ gst_rtp_dv_depay_process (GstBaseRTPDepayload * base, GstBuffer * in)
       GST_LOG_OBJECT (dvdepay, "got block at location %d", location);
     }
 
-    /* get the byte offset of the dif block */
-    offset = location * 80;
+    if (location != -1) {
+      /* get the byte offset of the dif block */
+      offset = location * 80;
 
-    /* And copy it in, provided the location is sane. */
-    if (offset >= 0 && offset <= dvdepay->frame_size - 80)
-      memcpy (GST_BUFFER_DATA (dvdepay->acc) + offset, payload, 80);
+      /* And copy it in, provided the location is sane. */
+      if (offset <= dvdepay->frame_size - 80)
+        memcpy (GST_BUFFER_DATA (dvdepay->acc) + offset, payload, 80);
+    }
 
     payload += 80;
     payload_len -= 80;
diff --git a/gst/rtp/gstrtpgstdepay.c b/gst/rtp/gstrtpgstdepay.c
index b187db4..20e1798 100644
--- a/gst/rtp/gstrtpgstdepay.c
+++ b/gst/rtp/gstrtpgstdepay.c
@@ -21,9 +21,9 @@
 #  include "config.h"
 #endif
 
-#include <gst/rtp/gstrtpbuffer.h>
-
 #include <string.h>
+#include <stdlib.h>
+
 #include "gstrtpgstdepay.h"
 
 GST_DEBUG_CATEGORY_STATIC (rtpgstdepay_debug);
@@ -141,11 +141,9 @@ gst_rtp_gst_depay_setcaps (GstBaseRTPDepayload * depayload, GstCaps * caps)
 {
   GstRtpGSTDepay *rtpgstdepay;
   GstStructure *structure;
-  GstCaps *outcaps;
   gint clock_rate;
   gboolean res;
   const gchar *capsenc;
-  gchar *capsstr;
 
   rtpgstdepay = GST_RTP_GST_DEPAY (depayload);
 
@@ -157,25 +155,154 @@ gst_rtp_gst_depay_setcaps (GstBaseRTPDepayload * depayload, GstCaps * caps)
 
   capsenc = gst_structure_get_string (structure, "caps");
   if (capsenc) {
+    GstCaps *outcaps;
     gsize out_len;
+    gchar *capsstr;
+    const gchar *capsver;
+    guint CV;
 
+    /* decode caps */
     capsstr = (gchar *) g_base64_decode (capsenc, &out_len);
     outcaps = gst_caps_from_string (capsstr);
     g_free (capsstr);
 
-    /* we have the SDP caps as output caps */
-    rtpgstdepay->current_CV = 0;
+    /* parse version */
+    capsver = gst_structure_get_string (structure, "capsversion");
+    if (capsver) {
+      CV = atoi (capsver);
+    } else {
+      /* no version, assume 0 */
+      CV = 0;
+    }
+    /* store in cache */
+    rtpgstdepay->current_CV = CV;
     gst_caps_ref (outcaps);
-    store_cache (rtpgstdepay, 0, outcaps);
+    store_cache (rtpgstdepay, CV, outcaps);
+
+    res = gst_pad_set_caps (depayload->srcpad, outcaps);
+    gst_caps_unref (outcaps);
   } else {
-    outcaps = gst_caps_new_any ();
+    GST_WARNING_OBJECT (depayload, "no caps given");
+    rtpgstdepay->current_CV = -1;
+    res = TRUE;
   }
-  res = gst_pad_set_caps (depayload->srcpad, outcaps);
-  gst_caps_unref (outcaps);
 
   return res;
 }
 
+static gboolean
+read_length (GstRtpGSTDepay * rtpgstdepay, guint8 * data, guint size,
+    guint * length, guint * skip)
+{
+  guint b, len, offset;
+
+  /* start reading the length, we need this to skip to the data later */
+  len = offset = 0;
+  do {
+    if (offset >= size)
+      return FALSE;
+    b = data[offset++];
+    len = (len << 7) | (b & 0x7f);
+  } while (b & 0x80);
+
+  /* check remaining buffer size */
+  if (size - offset < len)
+    return FALSE;
+
+  *length = len;
+  *skip = offset;
+
+  return TRUE;
+}
+
+static GstCaps *
+read_caps (GstRtpGSTDepay * rtpgstdepay, GstBuffer * buf, guint * skip)
+{
+  guint8 *data;
+  guint size, offset, length;
+  GstCaps *caps;
+
+  data = GST_BUFFER_DATA (buf);
+  size = GST_BUFFER_SIZE (buf);
+
+  GST_DEBUG_OBJECT (rtpgstdepay, "buffer size %u", size);
+
+  if (!read_length (rtpgstdepay, data, size, &length, &offset))
+    goto too_small;
+
+  GST_DEBUG_OBJECT (rtpgstdepay, "parsing caps %s", &data[offset]);
+
+  /* parse and store in cache */
+  caps = gst_caps_from_string ((gchar *) & data[offset]);
+
+  *skip = length + offset;
+
+  return caps;
+
+too_small:
+  {
+    GST_ELEMENT_WARNING (rtpgstdepay, STREAM, DECODE,
+        ("Buffer too small."), (NULL));
+    return NULL;
+  }
+}
+
+static GstEvent *
+read_event (GstRtpGSTDepay * rtpgstdepay, guint type,
+    GstBuffer * buf, guint * skip)
+{
+  guint8 *data;
+  guint size, offset, length;
+  GstStructure *s;
+  GstEvent *event;
+  GstEventType etype;
+  gchar *end;
+
+  data = GST_BUFFER_DATA (buf);
+  size = GST_BUFFER_SIZE (buf);
+
+  GST_DEBUG_OBJECT (rtpgstdepay, "buffer size %u", size);
+
+  if (!read_length (rtpgstdepay, data, size, &length, &offset))
+    goto too_small;
+
+  GST_DEBUG_OBJECT (rtpgstdepay, "parsing event %s", &data[offset]);
+
+  /* parse */
+  s = gst_structure_from_string ((gchar *) & data[offset], &end);
+
+  switch (type) {
+    case 1:
+      etype = GST_EVENT_TAG;
+      break;
+    case 2:
+      etype = GST_EVENT_CUSTOM_DOWNSTREAM;
+      break;
+    case 3:
+      etype = GST_EVENT_CUSTOM_BOTH;
+      break;
+    default:
+      goto unknown_event;
+  }
+  event = gst_event_new_custom (etype, s);
+
+  *skip = length + offset;
+
+  return event;
+
+too_small:
+  {
+    GST_ELEMENT_WARNING (rtpgstdepay, STREAM, DECODE,
+        ("Buffer too small."), (NULL));
+    return NULL;
+  }
+unknown_event:
+  {
+    GST_DEBUG_OBJECT (rtpgstdepay, "unknown event type");
+    return NULL;
+  }
+}
+
 static GstBuffer *
 gst_rtp_gst_depay_process (GstBaseRTPDepayload * depayload, GstBuffer * buf)
 {
@@ -183,7 +310,7 @@ gst_rtp_gst_depay_process (GstBaseRTPDepayload * depayload, GstBuffer * buf)
   GstBuffer *subbuf, *outbuf = NULL;
   gint payload_len;
   guint8 *payload;
-  guint CV;
+  guint CV, frag_offset, avail, offset;
 
   rtpgstdepay = GST_RTP_GST_DEPAY (depayload);
 
@@ -204,19 +331,23 @@ gst_rtp_gst_depay_process (GstBaseRTPDepayload * depayload, GstBuffer * buf)
    *  0                   1                   2                   3
    *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
-   * |C| CV  |D|X|Y|Z|                  MBZ                          |
+   * |C| CV  |D|X|Y|Z|     ETYPE     |  MBZ                          |
    * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    * |                          Frag_offset                          |
    * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    */
-  /* frag_offset =
-   *   (payload[4] << 24) | (payload[5] << 16) | (payload[6] << 8) | payload[7];
-   */
+  frag_offset =
+      (payload[4] << 24) | (payload[5] << 16) | (payload[6] << 8) | payload[7];
+
+  avail = gst_adapter_available (rtpgstdepay->adapter);
+  if (avail != frag_offset)
+    goto wrong_frag;
 
   /* subbuffer skipping the 8 header bytes */
   subbuf = gst_rtp_buffer_get_payload_subbuffer (buf, 8, -1);
   gst_adapter_push (rtpgstdepay->adapter, subbuf);
 
+  offset = 0;
   if (gst_rtp_buffer_get_marker (buf)) {
     guint avail;
     GstCaps *outcaps;
@@ -228,63 +359,67 @@ gst_rtp_gst_depay_process (GstBaseRTPDepayload * depayload, GstBuffer * buf)
     CV = (payload[0] >> 4) & 0x7;
 
     if (payload[0] & 0x80) {
-      guint b, csize, size, offset;
-      guint8 *data;
-      GstBuffer *subbuf;
+      guint size;
 
       /* C bit, we have inline caps */
-      data = GST_BUFFER_DATA (outbuf);
-      size = GST_BUFFER_SIZE (outbuf);
-
-      /* start reading the length, we need this to skip to the data later */
-      csize = offset = 0;
-      do {
-        if (offset >= size)
-          goto too_small;
-        b = data[offset++];
-        csize = (csize << 7) | (b & 0x7f);
-      } while (b & 0x80);
-
-      if (size < csize)
-        goto too_small;
-
-      /* parse and store in cache */
-      outcaps = gst_caps_from_string ((gchar *) & data[offset]);
+      outcaps = read_caps (rtpgstdepay, outbuf, &size);
+      if (outcaps == NULL)
+        goto no_caps;
+
+      GST_DEBUG_OBJECT (rtpgstdepay,
+          "inline caps %u, length %u, %" GST_PTR_FORMAT, CV, size, outcaps);
+
       store_cache (rtpgstdepay, CV, outcaps);
 
       /* skip caps */
-      offset += csize;
-      size -= csize;
+      offset += size;
+      avail -= size;
+    }
+    if (payload[1]) {
+      guint size;
+      GstEvent *event;
+
+      /* we have an event */
+      event = read_event (rtpgstdepay, payload[1], outbuf, &size);
+      if (event == NULL)
+        goto no_event;
 
       GST_DEBUG_OBJECT (rtpgstdepay,
-          "inline caps %u, length %u, %" GST_PTR_FORMAT, CV, csize, outcaps);
+          "inline event, length %u, %" GST_PTR_FORMAT, size, event);
 
-      /* create real data buffer when needed */
-      if (size)
-        subbuf = gst_buffer_create_sub (outbuf, offset, size);
-      else
-        subbuf = NULL;
+      gst_pad_push_event (depayload->srcpad, event);
 
-      gst_buffer_unref (outbuf);
-      outbuf = subbuf;
+      /* no buffer after event */
+      avail = 0;
     }
 
-    /* see what caps we need */
-    if (CV != rtpgstdepay->current_CV) {
-      /* we need to switch caps, check if we have the caps */
-      if ((outcaps = rtpgstdepay->CV_cache[CV]) == NULL)
-        goto missing_caps;
+    if (avail) {
+      if (offset != 0) {
+        GstBuffer *temp;
 
-      GST_DEBUG_OBJECT (rtpgstdepay,
-          "need caps switch from %u to %u, %" GST_PTR_FORMAT,
-          rtpgstdepay->current_CV, CV, outcaps);
+        GST_DEBUG_OBJECT (rtpgstdepay, "sub buffer: offset %u, size %u", offset,
+            avail);
 
-      /* and set caps */
-      if (gst_pad_set_caps (depayload->srcpad, outcaps))
-        rtpgstdepay->current_CV = CV;
-    }
+        temp = gst_buffer_create_sub (outbuf, offset, avail);
+        gst_buffer_unref (outbuf);
+        outbuf = temp;
+      }
+
+      /* see what caps we need */
+      if (CV != rtpgstdepay->current_CV) {
+        /* we need to switch caps, check if we have the caps */
+        if ((outcaps = rtpgstdepay->CV_cache[CV]) == NULL)
+          goto missing_caps;
+
+        GST_DEBUG_OBJECT (rtpgstdepay,
+            "need caps switch from %u to %u, %" GST_PTR_FORMAT,
+            rtpgstdepay->current_CV, CV, outcaps);
+
+        /* and set caps */
+        if (gst_pad_set_caps (depayload->srcpad, outcaps))
+          rtpgstdepay->current_CV = CV;
+      }
 
-    if (outbuf) {
       if (payload[0] & 0x8)
         GST_BUFFER_FLAG_SET (outbuf, GST_BUFFER_FLAG_DELTA_UNIT);
       if (payload[0] & 0x4)
@@ -293,6 +428,9 @@ gst_rtp_gst_depay_process (GstBaseRTPDepayload * depayload, GstBuffer * buf)
         GST_BUFFER_FLAG_SET (outbuf, GST_BUFFER_FLAG_MEDIA2);
       if (payload[0] & 0x1)
         GST_BUFFER_FLAG_SET (outbuf, GST_BUFFER_FLAG_MEDIA3);
+    } else {
+      gst_buffer_unref (outbuf);
+      outbuf = NULL;
     }
   }
   return outbuf;
@@ -304,20 +442,29 @@ empty_packet:
         ("Empty Payload."), (NULL));
     return NULL;
   }
-too_small:
+wrong_frag:
   {
-    GST_ELEMENT_WARNING (rtpgstdepay, STREAM, DECODE,
-        ("Buffer too small."), (NULL));
-    if (outbuf)
-      gst_buffer_unref (outbuf);
+    gst_adapter_clear (rtpgstdepay->adapter);
+    GST_LOG_OBJECT (rtpgstdepay, "wrong fragment, skipping");
+    return NULL;
+  }
+no_caps:
+  {
+    GST_WARNING_OBJECT (rtpgstdepay, "failed to parse caps");
+    gst_buffer_unref (outbuf);
+    return NULL;
+  }
+no_event:
+  {
+    GST_WARNING_OBJECT (rtpgstdepay, "failed to parse event");
+    gst_buffer_unref (outbuf);
     return NULL;
   }
 missing_caps:
   {
     GST_ELEMENT_WARNING (rtpgstdepay, STREAM, DECODE,
         ("Missing caps %u.", CV), (NULL));
-    if (outbuf)
-      gst_buffer_unref (outbuf);
+    gst_buffer_unref (outbuf);
     return NULL;
   }
 }
diff --git a/gst/rtp/gstrtpgstpay.c b/gst/rtp/gstrtpgstpay.c
index 3f244bc..0761b2a 100644
--- a/gst/rtp/gstrtpgstpay.c
+++ b/gst/rtp/gstrtpgstpay.c
@@ -27,31 +27,46 @@
 
 #include "gstrtpgstpay.h"
 
+GST_DEBUG_CATEGORY_STATIC (gst_rtp_pay_debug);
+#define GST_CAT_DEFAULT gst_rtp_pay_debug
+
 /*
  *  0                   1                   2                   3
  *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
- * |C| CV  |D|X|Y|Z|                  MBZ                          |
+ * |C| CV  |D|X|Y|Z|     ETYPE     |  MBZ                          |
  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  * |                          Frag_offset                          |
  * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  *
- * C: caps inlined flag 
+ * C: caps inlined flag
  *   When C set, first part of payload contains caps definition. Caps definition
  *   starts with variable-length length prefix and then a string of that length.
  *   the length is encoded in big endian 7 bit chunks, the top 1 bit of a byte
  *   is the continuation marker and the 7 next bits the data. A continuation
- *   marker of 1 means that the next byte contains more data. 
+ *   marker of 1 means that the next byte contains more data.
  *
  * CV: caps version, 0 = caps from SDP, 1 - 7 inlined caps
  * D: delta unit buffer
  * X: media 1 flag
  * Y: media 2 flag
  * Z: media 3 flag
- *
- *
+ * ETYPE: type of event. Payload contains the event, prefixed with a
+ *        variable length field.
+ *   0 = NO event
+ *   1 = GST_EVENT_TAG
+ *   2 = GST_EVENT_CUSTOM_DOWNSTREAM
+ *   3 = GST_EVENT_CUSTOM_BOTH
  */
 
+#define DEFAULT_BUFFER_LIST     FALSE
+enum
+{
+  PROP_0,
+  PROP_BUFFER_LIST,
+  PROP_LAST
+};
+
 static GstStaticPadTemplate gst_rtp_gst_pay_sink_template =
 GST_STATIC_PAD_TEMPLATE ("sink",
     GST_PAD_SINK,
@@ -68,10 +83,21 @@ GST_STATIC_PAD_TEMPLATE ("src",
         "clock-rate = (int) 90000, " "encoding-name = (string) \"X-GST\"")
     );
 
+static void gst_rtp_gst_pay_set_property (GObject * object, guint prop_id,
+    const GValue * value, GParamSpec * pspec);
+static void gst_rtp_gst_pay_get_property (GObject * object, guint prop_id,
+    GValue * value, GParamSpec * pspec);
+
+static void gst_rtp_gst_pay_finalize (GObject * obj);
+
+static GstStateChangeReturn
+gst_rtp_gst_pay_change_state (GstElement * element, GstStateChange transition);
+
 static gboolean gst_rtp_gst_pay_setcaps (GstBaseRTPPayload * payload,
     GstCaps * caps);
-static GstFlowReturn gst_rtp_gst_pay_handle_buffer (GstBaseRTPPayload * payload,
-    GstBuffer * buffer);
+static GstFlowReturn gst_rtp_gst_pay_handle_buffer (GstBaseRTPPayload *
+    payload, GstBuffer * buffer);
+static gboolean gst_rtp_gst_pay_handle_event (GstPad * pad, GstEvent * event);
 
 GST_BOILERPLATE (GstRtpGSTPay, gst_rtp_gst_pay, GstBaseRTPPayload,
     GST_TYPE_BASE_RTP_PAYLOAD)
@@ -94,89 +120,126 @@ GST_BOILERPLATE (GstRtpGSTPay, gst_rtp_gst_pay, GstBaseRTPPayload,
 static void
 gst_rtp_gst_pay_class_init (GstRtpGSTPayClass * klass)
 {
+  GObjectClass *gobject_class;
+  GstElementClass *gstelement_class;
   GstBaseRTPPayloadClass *gstbasertppayload_class;
 
+  gobject_class = (GObjectClass *) klass;
+  gstelement_class = (GstElementClass *) klass;
   gstbasertppayload_class = (GstBaseRTPPayloadClass *) klass;
 
+  gobject_class->set_property = gst_rtp_gst_pay_set_property;
+  gobject_class->get_property = gst_rtp_gst_pay_get_property;
+  gobject_class->finalize = gst_rtp_gst_pay_finalize;
+
+  g_object_class_install_property (G_OBJECT_CLASS (klass), PROP_BUFFER_LIST,
+      g_param_spec_boolean ("buffer-list", "Buffer List",
+          "Use Buffer Lists",
+          DEFAULT_BUFFER_LIST, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
+  gstelement_class->change_state = gst_rtp_gst_pay_change_state;
+
   gstbasertppayload_class->set_caps = gst_rtp_gst_pay_setcaps;
   gstbasertppayload_class->handle_buffer = gst_rtp_gst_pay_handle_buffer;
+  gstbasertppayload_class->handle_event = gst_rtp_gst_pay_handle_event;
+
+  GST_DEBUG_CATEGORY_INIT (gst_rtp_pay_debug, "rtpgstpay", 0,
+      "rtpgstpay element");
 }
 
 static void
 gst_rtp_gst_pay_init (GstRtpGSTPay * rtpgstpay, GstRtpGSTPayClass * klass)
 {
+  rtpgstpay->buffer_list = DEFAULT_BUFFER_LIST;
+  rtpgstpay->adapter = gst_adapter_new ();
+  gst_basertppayload_set_options (GST_BASE_RTP_PAYLOAD (rtpgstpay),
+      "application", TRUE, "X-GST", 90000);
 }
 
-static gboolean
-gst_rtp_gst_pay_setcaps (GstBaseRTPPayload * payload, GstCaps * caps)
+static void
+gst_rtp_gst_pay_reset (GstRtpGSTPay * rtpgstpay)
 {
-  gboolean res;
-  gchar *capsstr, *capsenc;
+  g_list_foreach (rtpgstpay->events, (GFunc) gst_event_unref, NULL);
+  g_list_free (rtpgstpay->events);
+  rtpgstpay->events = NULL;
+  rtpgstpay->have_caps = FALSE;
+}
 
-  capsstr = gst_caps_to_string (caps);
-  capsenc = g_base64_encode ((guchar *) capsstr, strlen (capsstr));
-  g_free (capsstr);
+static void
+gst_rtp_gst_pay_finalize (GObject * obj)
+{
+  GstRtpGSTPay *rtpgstpay;
 
-  gst_basertppayload_set_options (payload, "application", TRUE, "X-GST", 90000);
-  res =
-      gst_basertppayload_set_outcaps (payload, "caps", G_TYPE_STRING, capsenc,
-      NULL);
-  g_free (capsenc);
+  rtpgstpay = GST_RTP_GST_PAY (obj);
 
-  return res;
+  gst_rtp_gst_pay_reset (rtpgstpay);
+  g_object_unref (rtpgstpay->adapter);
+
+  G_OBJECT_CLASS (parent_class)->finalize (obj);
 }
 
-static GstFlowReturn
-gst_rtp_gst_pay_handle_buffer (GstBaseRTPPayload * basepayload,
-    GstBuffer * buffer)
+static void
+gst_rtp_gst_pay_set_property (GObject * object, guint prop_id,
+    const GValue * value, GParamSpec * pspec)
 {
   GstRtpGSTPay *rtpgstpay;
-  guint8 *data;
-  guint size;
-  GstBuffer *outbuf;
-  GstFlowReturn ret;
-  GstClockTime timestamp;
-  guint32 frag_offset;
-  guint flags;
 
-  rtpgstpay = GST_RTP_GST_PAY (basepayload);
+  rtpgstpay = GST_RTP_GST_PAY (object);
 
-  size = GST_BUFFER_SIZE (buffer);
-  data = GST_BUFFER_DATA (buffer);
-  timestamp = GST_BUFFER_TIMESTAMP (buffer);
+  switch (prop_id) {
+    case PROP_BUFFER_LIST:
+      rtpgstpay->buffer_list = g_value_get_boolean (value);
+      break;
+    default:
+      G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
+      break;
+  }
+}
 
-  ret = GST_FLOW_OK;
+static void
+gst_rtp_gst_pay_get_property (GObject * object, guint prop_id,
+    GValue * value, GParamSpec * pspec)
+{
+  GstRtpGSTPay *rtpgstpay;
+
+  rtpgstpay = GST_RTP_GST_PAY (object);
+
+  switch (prop_id) {
+    case PROP_BUFFER_LIST:
+      g_value_set_boolean (value, rtpgstpay->buffer_list);
+      break;
+    default:
+      G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
+      break;
+  }
+}
+
+static GstFlowReturn
+gst_rtp_gst_pay_flush (GstRtpGSTPay * rtpgstpay, GstClockTime timestamp)
+{
+  GstFlowReturn ret;
+  guint avail;
+  guint frag_offset;
+  GstBufferList *list = NULL;
+  GstBufferListIterator *it = NULL;
 
-  /* caps always from SDP for now */
-  flags = 0;
-  if (GST_BUFFER_FLAG_IS_SET (buffer, GST_BUFFER_FLAG_DELTA_UNIT))
-    flags |= (1 << 3);
-  if (GST_BUFFER_FLAG_IS_SET (buffer, GST_BUFFER_FLAG_MEDIA1))
-    flags |= (1 << 2);
-  if (GST_BUFFER_FLAG_IS_SET (buffer, GST_BUFFER_FLAG_MEDIA2))
-    flags |= (1 << 1);
-  if (GST_BUFFER_FLAG_IS_SET (buffer, GST_BUFFER_FLAG_MEDIA3))
-    flags |= (1 << 0);
-
-  /*
-   *  0                   1                   2                   3
-   *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
-   * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
-   * |C| CV  |D|X|Y|Z|                  MBZ                          |
-   * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
-   * |                          Frag_offset                          |
-   * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
-   */
   frag_offset = 0;
+  avail = gst_adapter_available (rtpgstpay->adapter);
+
+  if (rtpgstpay->buffer_list) {
+    list = gst_buffer_list_new ();
+    it = gst_buffer_list_iterate (list);
+  }
 
-  while (size > 0) {
+  while (avail) {
     guint towrite;
     guint8 *payload;
     guint payload_len;
     guint packet_len;
+    GstBuffer *outbuf;
 
     /* this will be the total lenght of the packet */
-    packet_len = gst_rtp_buffer_calc_packet_len (8 + size, 0, 0);
+    packet_len = gst_rtp_buffer_calc_packet_len (8 + avail, 0, 0);
 
     /* fill one MTU or all available bytes */
     towrite = MIN (packet_len, GST_BASE_RTP_PAYLOAD_MTU (rtpgstpay));
@@ -184,12 +247,29 @@ gst_rtp_gst_pay_handle_buffer (GstBaseRTPPayload * basepayload,
     /* this is the payload length */
     payload_len = gst_rtp_buffer_calc_payload_len (towrite, 0, 0);
 
-    /* create buffer to hold the payload */
-    outbuf = gst_rtp_buffer_new_allocate (payload_len, 0, 0);
+    if (rtpgstpay->buffer_list) {
+      outbuf = gst_rtp_buffer_new_allocate (8, 0, 0);
+    } else {
+      /* create buffer to hold the payload */
+      outbuf = gst_rtp_buffer_new_allocate (payload_len, 0, 0);
+    }
     payload = gst_rtp_buffer_get_payload (outbuf);
 
-    payload[0] = flags;
-    payload[1] = payload[2] = payload[3] = 0;
+    GST_DEBUG_OBJECT (rtpgstpay, "new packet len %u, frag %u", packet_len,
+        frag_offset);
+
+    /*
+     *  0                   1                   2                   3
+     *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+     * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
+     * |C| CV  |D|X|Y|Z|     ETYPE     |  MBZ                          |
+     * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
+     * |                          Frag_offset                          |
+     * +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
+     */
+    payload[0] = rtpgstpay->flags;
+    payload[1] = rtpgstpay->etype;
+    payload[2] = payload[3] = 0;
     payload[4] = frag_offset >> 24;
     payload[5] = frag_offset >> 16;
     payload[6] = frag_offset >> 8;
@@ -198,24 +278,250 @@ gst_rtp_gst_pay_handle_buffer (GstBaseRTPPayload * basepayload,
     payload += 8;
     payload_len -= 8;
 
-    memcpy (payload, data, payload_len);
-
-    data += payload_len;
-    size -= payload_len;
     frag_offset += payload_len;
+    avail -= payload_len;
+
+    GST_BUFFER_TIMESTAMP (outbuf) = timestamp;
 
-    if (size == 0)
+    if (avail == 0)
       gst_rtp_buffer_set_marker (outbuf, TRUE);
 
-    GST_BUFFER_TIMESTAMP (outbuf) = timestamp;
+    if (rtpgstpay->buffer_list) {
+      GstBuffer *paybuf;
+
+      /* create a new buf to hold the payload */
+      GST_DEBUG_OBJECT (rtpgstpay, "take %u bytes from adapter", payload_len);
+      paybuf = gst_adapter_take_buffer (rtpgstpay->adapter, payload_len);
+
+      /* create a new group to hold the rtp header and the payload */
+      gst_buffer_list_iterator_add_group (it);
+      gst_buffer_list_iterator_add (it, outbuf);
+      gst_buffer_list_iterator_add (it, paybuf);
+    } else {
+      GST_DEBUG_OBJECT (rtpgstpay, "copy %u bytes from adapter", payload_len);
+      gst_adapter_copy (rtpgstpay->adapter, payload, 0, payload_len);
+      gst_adapter_flush (rtpgstpay->adapter, payload_len);
+
+      ret = gst_basertppayload_push (GST_BASE_RTP_PAYLOAD (rtpgstpay), outbuf);
+      if (ret != GST_FLOW_OK)
+        goto push_failed;
+    }
+  }
+  if (rtpgstpay->buffer_list) {
+    gst_buffer_list_iterator_free (it);
+    /* push the whole buffer list at once */
+    ret = gst_basertppayload_push_list (GST_BASE_RTP_PAYLOAD (rtpgstpay), list);
+  }
+
+  rtpgstpay->flags &= 0x70;
+  rtpgstpay->etype = 0;
+
+  return GST_FLOW_OK;
+
+  /* ERRORS */
+push_failed:
+  {
+    GST_DEBUG_OBJECT (rtpgstpay, "push failed %d (%s)", ret,
+        gst_flow_get_name (ret));
+    gst_adapter_clear (rtpgstpay->adapter);
+    rtpgstpay->flags &= 0x70;
+    rtpgstpay->etype = 0;
+    return ret;
+  }
+}
+
+static GstBuffer *
+make_data_buffer (GstRtpGSTPay * rtpgstpay, gchar * data, guint size)
+{
+  guint plen;
+  guint8 *ptr;
+  GstBuffer *outbuf;
 
-    ret = gst_basertppayload_push (basepayload, outbuf);
+  /* calculate length */
+  plen = 1;
+  while (size >> (7 * plen))
+    plen++;
+
+  outbuf = gst_buffer_new_and_alloc (plen + size);
+  ptr = GST_BUFFER_DATA (outbuf);
+
+  /* write length */
+  while (plen) {
+    plen--;
+    *ptr++ = ((plen > 0) ? 0x80 : 0) | ((size >> (7 * plen)) & 0x7f);
   }
-  gst_buffer_unref (buffer);
+  /* copy data */
+  memcpy (ptr, data, size);
+
+  return outbuf;
+}
 
+static void
+process_event (GstRtpGSTPay * rtpgstpay, GstEvent * event)
+{
+  switch (GST_EVENT_TYPE (event)) {
+    case GST_EVENT_TAG:
+      rtpgstpay->etype = 1;
+      break;
+    case GST_EVENT_CUSTOM_DOWNSTREAM:
+      rtpgstpay->etype = 2;
+      break;
+    case GST_EVENT_CUSTOM_BOTH:
+      rtpgstpay->etype = 2;
+      break;
+    default:
+      break;
+  }
+  if (rtpgstpay->etype) {
+    const GstStructure *s;
+    gchar *estr;
+    guint elen;
+    GstBuffer *outbuf;
+
+    GST_DEBUG_OBJECT (rtpgstpay, "make event type %d", rtpgstpay->etype);
+    s = gst_event_get_structure (event);
+
+    estr = gst_structure_to_string (s);
+    elen = strlen (estr);
+    outbuf = make_data_buffer (rtpgstpay, estr, elen);
+    g_free (estr);
+
+    gst_adapter_push (rtpgstpay->adapter, outbuf);
+    /* flush the adapter immediately */
+    gst_rtp_gst_pay_flush (rtpgstpay, GST_CLOCK_TIME_NONE);
+  }
+}
+
+
+static gboolean
+gst_rtp_gst_pay_setcaps (GstBaseRTPPayload * payload, GstCaps * caps)
+{
+  GstRtpGSTPay *rtpgstpay;
+  gboolean res;
+  gchar *capsstr, *capsenc, *capsver;
+  guint capslen;
+  GstBuffer *outbuf;
+  GList *walk;
+
+  rtpgstpay = GST_RTP_GST_PAY (payload);
+
+  capsstr = gst_caps_to_string (caps);
+  capslen = strlen (capsstr);
+
+  rtpgstpay->current_CV = rtpgstpay->next_CV;
+
+  /* encode without 0 byte */
+  capsenc = g_base64_encode ((guchar *) capsstr, capslen);
+  GST_DEBUG_OBJECT (payload, "caps=%s, caps(base64)=%s", capsstr, capsenc);
+  /* for 0 byte */
+  capslen++;
+
+  /* make caps for SDP */
+  capsver = g_strdup_printf ("%d", rtpgstpay->current_CV);
+  res =
+      gst_basertppayload_set_outcaps (payload, "caps", G_TYPE_STRING, capsenc,
+      "capsversion", G_TYPE_STRING, capsver, NULL);
+
+  rtpgstpay->have_caps = TRUE;
+
+  for (walk = rtpgstpay->events; walk; walk = g_list_next (walk)) {
+    GstEvent *event = walk->data;
+
+    process_event (rtpgstpay, event);
+    gst_event_unref (event);
+  }
+  g_list_free (rtpgstpay->events);
+  rtpgstpay->events = NULL;
+
+  /* make a data buffer of it */
+  outbuf = make_data_buffer (rtpgstpay, capsstr, capslen);
+  g_free (capsstr);
+
+  /* store in adapter, we don't flush yet, buffer will follow */
+  rtpgstpay->flags = (1 << 7) | (rtpgstpay->current_CV << 4);
+  rtpgstpay->next_CV = (rtpgstpay->next_CV + 1) & 0x7;
+  gst_adapter_push (rtpgstpay->adapter, outbuf);
+
+  g_free (capsenc);
+  g_free (capsver);
+
+  return res;
+}
+
+static gboolean
+gst_rtp_gst_pay_handle_event (GstPad * pad, GstEvent * event)
+{
+  GstRtpGSTPay *rtpgstpay;
+
+  rtpgstpay = GST_RTP_GST_PAY (GST_PAD_PARENT (pad));
+
+  if (!rtpgstpay->have_caps) {
+    rtpgstpay->events =
+        g_list_append (rtpgstpay->events, gst_event_ref (event));
+  } else {
+    process_event (rtpgstpay, event);
+  }
+  /* FALSE to let base class handle it as well */
+  return FALSE;
+}
+
+static GstFlowReturn
+gst_rtp_gst_pay_handle_buffer (GstBaseRTPPayload * basepayload,
+    GstBuffer * buffer)
+{
+  GstFlowReturn ret;
+  GstRtpGSTPay *rtpgstpay;
+  GstClockTime timestamp;
+
+  rtpgstpay = GST_RTP_GST_PAY (basepayload);
+
+  timestamp = GST_BUFFER_TIMESTAMP (buffer);
+
+  /* caps always from SDP for now */
+  if (GST_BUFFER_FLAG_IS_SET (buffer, GST_BUFFER_FLAG_DELTA_UNIT))
+    rtpgstpay->flags |= (1 << 3);
+  if (GST_BUFFER_FLAG_IS_SET (buffer, GST_BUFFER_FLAG_MEDIA1))
+    rtpgstpay->flags |= (1 << 2);
+  if (GST_BUFFER_FLAG_IS_SET (buffer, GST_BUFFER_FLAG_MEDIA2))
+    rtpgstpay->flags |= (1 << 1);
+  if (GST_BUFFER_FLAG_IS_SET (buffer, GST_BUFFER_FLAG_MEDIA3))
+    rtpgstpay->flags |= (1 << 0);
+
+  gst_adapter_push (rtpgstpay->adapter, buffer);
+  ret = gst_rtp_gst_pay_flush (rtpgstpay, timestamp);
+
+  return ret;
+}
+
+static GstStateChangeReturn
+gst_rtp_gst_pay_change_state (GstElement * element, GstStateChange transition)
+{
+  GstRtpGSTPay *rtpgstpay;
+  GstStateChangeReturn ret;
+
+  rtpgstpay = GST_RTP_GST_PAY (element);
+
+  switch (transition) {
+    case GST_STATE_CHANGE_READY_TO_PAUSED:
+      gst_rtp_gst_pay_reset (rtpgstpay);
+      break;
+    default:
+      break;
+  }
+
+  ret = GST_ELEMENT_CLASS (parent_class)->change_state (element, transition);
+
+  switch (transition) {
+    case GST_STATE_CHANGE_PAUSED_TO_READY:
+      gst_rtp_gst_pay_reset (rtpgstpay);
+      break;
+    default:
+      break;
+  }
   return ret;
 }
 
+
 gboolean
 gst_rtp_gst_pay_plugin_init (GstPlugin * plugin)
 {
diff --git a/gst/rtp/gstrtpgstpay.h b/gst/rtp/gstrtpgstpay.h
index c7a7c02..d0b4bb8 100644
--- a/gst/rtp/gstrtpgstpay.h
+++ b/gst/rtp/gstrtpgstpay.h
@@ -22,6 +22,7 @@
 
 #include <gst/gst.h>
 #include <gst/rtp/gstbasertppayload.h>
+#include <gst/base/gstadapter.h>
 
 G_BEGIN_DECLS
 
@@ -42,6 +43,17 @@ typedef struct _GstRtpGSTPayClass GstRtpGSTPayClass;
 struct _GstRtpGSTPay
 {
   GstBaseRTPPayload payload;
+
+  gboolean buffer_list;
+
+  GstAdapter *adapter;
+  guint8 flags;
+  guint8 etype;
+  gboolean have_caps;
+  GList *events;
+
+  guint8 current_CV; /* CV field of incoming caps*/
+  guint8 next_CV;
 };
 
 struct _GstRtpGSTPayClass
diff --git a/gst/rtp/gstrtph264depay.c b/gst/rtp/gstrtph264depay.c
index efe1725..1a92dd2 100644
--- a/gst/rtp/gstrtph264depay.c
+++ b/gst/rtp/gstrtph264depay.c
@@ -24,6 +24,7 @@
 #include <stdio.h>
 #include <string.h>
 
+#include <gst/base/gstbitreader.h>
 #include <gst/rtp/gstrtpbuffer.h>
 #include "gstrtph264depay.h"
 
@@ -46,10 +47,13 @@ enum
 static const guint8 sync_bytes[] = { 0, 0, 0, 1 };
 
 static GstStaticPadTemplate gst_rtp_h264_depay_src_template =
-GST_STATIC_PAD_TEMPLATE ("src",
+    GST_STATIC_PAD_TEMPLATE ("src",
     GST_PAD_SRC,
     GST_PAD_ALWAYS,
-    GST_STATIC_CAPS ("video/x-h264")
+    GST_STATIC_CAPS ("video/x-h264, "
+        "stream-format = (string) avc, alignment = (string) au; "
+        "video/x-h264, "
+        "stream-format = (string) byte-stream, alignment = (string) { nal, au }")
     );
 
 static GstStaticPadTemplate gst_rtp_h264_depay_sink_template =
@@ -157,6 +161,10 @@ gst_rtp_h264_depay_init (GstRtpH264Depay * rtph264depay,
   rtph264depay->picture_adapter = gst_adapter_new ();
   rtph264depay->byte_stream = DEFAULT_BYTE_STREAM;
   rtph264depay->merge = DEFAULT_ACCESS_UNIT;
+  rtph264depay->sps = g_ptr_array_new_with_free_func (
+      (GDestroyNotify) gst_buffer_unref);
+  rtph264depay->pps = g_ptr_array_new_with_free_func (
+      (GDestroyNotify) gst_buffer_unref);
 }
 
 static void
@@ -169,6 +177,9 @@ gst_rtp_h264_depay_reset (GstRtpH264Depay * rtph264depay)
   rtph264depay->last_keyframe = FALSE;
   rtph264depay->last_ts = 0;
   rtph264depay->current_fu_type = 0;
+  rtph264depay->new_codec_data = FALSE;
+  g_ptr_array_set_size (rtph264depay->sps, 0);
+  g_ptr_array_set_size (rtph264depay->pps, 0);
 }
 
 static void
@@ -184,6 +195,9 @@ gst_rtp_h264_depay_finalize (GObject * object)
   g_object_unref (rtph264depay->adapter);
   g_object_unref (rtph264depay->picture_adapter);
 
+  g_ptr_array_free (rtph264depay->sps, TRUE);
+  g_ptr_array_free (rtph264depay->pps, TRUE);
+
   G_OBJECT_CLASS (parent_class)->finalize (object);
 }
 
@@ -288,17 +302,261 @@ gst_rtp_h264_depay_negotiate (GstRtpH264Depay * rtph264depay)
   }
 }
 
+/* Stolen from bad/gst/mpegtsdemux/payloader_parsers.c */
+/* variable length Exp-Golomb parsing according to H.264 spec 9.1*/
 static gboolean
-gst_rtp_h264_depay_setcaps (GstBaseRTPDepayload * depayload, GstCaps * caps)
+read_golomb (GstBitReader * br, guint32 * value)
+{
+  guint8 b, leading_zeros = -1;
+  *value = 1;
+
+  for (b = 0; !b; leading_zeros++) {
+    if (!gst_bit_reader_get_bits_uint8 (br, &b, 1))
+      return FALSE;
+    *value *= 2;
+  }
+
+  *value = (*value >> 1) - 1;
+  if (leading_zeros > 0) {
+    guint32 tmp = 0;
+    if (!gst_bit_reader_get_bits_uint32 (br, &tmp, leading_zeros))
+      return FALSE;
+    *value += tmp;
+  }
+
+  return TRUE;
+}
+
+static gboolean
+parse_sps (GstBuffer * nal, guint32 * sps_id)
+{
+  GstBitReader br = GST_BIT_READER_INIT (GST_BUFFER_DATA (nal) + 4,
+      GST_BUFFER_SIZE (nal) - 4);
+
+  if (GST_BUFFER_SIZE (nal) < 5)
+    return FALSE;
+
+  if (!read_golomb (&br, sps_id))
+    return FALSE;
+
+  return TRUE;
+}
+
+static gboolean
+parse_pps (GstBuffer * nal, guint32 * sps_id, guint32 * pps_id)
+{
+  GstBitReader br = GST_BIT_READER_INIT (GST_BUFFER_DATA (nal) + 1,
+      GST_BUFFER_SIZE (nal) - 1);
+
+  if (GST_BUFFER_SIZE (nal) < 2)
+    return FALSE;
+
+  if (!read_golomb (&br, pps_id))
+    return FALSE;
+  if (!read_golomb (&br, sps_id))
+    return FALSE;
+
+  return TRUE;
+}
+
+static gboolean
+gst_rtp_h264_set_src_caps (GstRtpH264Depay * rtph264depay)
 {
+  gboolean res;
   GstCaps *srccaps;
+  guchar level = 0;
+  guchar profile_compat = G_MAXUINT8;
+
+  if (!rtph264depay->byte_stream &&
+      (!rtph264depay->new_codec_data ||
+          rtph264depay->sps->len == 0 || rtph264depay->pps->len == 0))
+    return TRUE;
+
+  srccaps = gst_caps_new_simple ("video/x-h264",
+      "stream-format", G_TYPE_STRING,
+      rtph264depay->byte_stream ? "byte-stream" : "avc",
+      "alignment", G_TYPE_STRING, rtph264depay->merge ? "au" : "nal", NULL);
+
+  if (!rtph264depay->byte_stream) {
+    GstBuffer *codec_data;
+    guchar *data;
+    guint len;
+    guint i;
+
+    /* start with 7 bytes header */
+    len = 7;
+    /* count sps & pps */
+    for (i = 0; i < rtph264depay->sps->len; i++)
+      len += 2 + GST_BUFFER_SIZE (g_ptr_array_index (rtph264depay->sps, i));
+    for (i = 0; i < rtph264depay->pps->len; i++)
+      len += 2 + GST_BUFFER_SIZE (g_ptr_array_index (rtph264depay->pps, i));
+
+    codec_data = gst_buffer_new_and_alloc (len);
+    g_debug ("alloc_len: %u", len);
+    data = GST_BUFFER_DATA (codec_data);
+
+    /* 8 bits version == 1 */
+    *data++ = 1;
+
+    /* According to: ISO/IEC 14496-15:2004(E) section 5.2.4.1
+     * The level is the max level of all SPSes
+     * A profile compat bit can only be set if all SPSes include that bit
+     */
+    for (i = 0; i < rtph264depay->sps->len; i++) {
+      guchar *nal = GST_BUFFER_DATA (g_ptr_array_index (rtph264depay->sps, i));
+
+      profile_compat &= nal[2];
+      level = MAX (level, nal[3]);
+    }
+
+    /* Assume all SPSes use the same profile, so extract from the first SPS */
+    *data++ = GST_BUFFER_DATA (g_ptr_array_index (rtph264depay->sps, 0))[1];
+    *data++ = profile_compat;
+    *data++ = level;
+
+    /* 6 bits reserved | 2 bits lengthSizeMinusOn */
+    *data++ = 0xff;
+    /* 3 bits reserved | 5 bits numOfSequenceParameterSets */
+    *data++ = 0xe0 | (rtph264depay->sps->len & 0x1f);
+
+    /* copy all SPS */
+    for (i = 0; i < rtph264depay->sps->len; i++) {
+      GstBuffer *sps = g_ptr_array_index (rtph264depay->sps, i);
+
+      GST_DEBUG_OBJECT (rtph264depay, "copy SPS %d of length %d", i,
+          GST_BUFFER_SIZE (sps));
+      GST_WRITE_UINT16_BE (data, GST_BUFFER_SIZE (sps));
+      data += 2;
+      memcpy (data, GST_BUFFER_DATA (sps), GST_BUFFER_SIZE (sps));
+      data += GST_BUFFER_SIZE (sps);
+    }
+
+    /* 8 bits numOfPictureParameterSets */
+    *data++ = rtph264depay->pps->len;
+    /* copy all PPS */
+    for (i = 0; i < rtph264depay->pps->len; i++) {
+      GstBuffer *pps = g_ptr_array_index (rtph264depay->pps, i);
+
+      GST_DEBUG_OBJECT (rtph264depay, "copy PPS %d of length %d", i,
+          GST_BUFFER_SIZE (pps));
+      GST_WRITE_UINT16_BE (data, GST_BUFFER_SIZE (pps));
+      data += 2;
+      memcpy (data, GST_BUFFER_DATA (pps), GST_BUFFER_SIZE (pps));
+      data += GST_BUFFER_SIZE (pps);
+    }
+
+    GST_BUFFER_SIZE (codec_data) = data - GST_BUFFER_DATA (codec_data);
+
+    gst_caps_set_simple (srccaps,
+        "codec_data", GST_TYPE_BUFFER, codec_data, NULL);
+    gst_buffer_unref (codec_data);
+  }
+
+  res = gst_pad_set_caps (GST_BASE_RTP_DEPAYLOAD_SRCPAD (rtph264depay),
+      srccaps);
+  gst_caps_unref (srccaps);
+
+  if (res)
+    rtph264depay->new_codec_data = FALSE;
+
+  return res;
+}
+
+static gboolean
+gst_rtp_h264_add_sps_pps (GstRtpH264Depay * rtph264depay, GstBuffer * nal)
+{
+  guchar type = GST_BUFFER_DATA (nal)[0] & 0x1f;
+  guint i;
+
+  if (type == 7) {
+    guint32 sps_id;
+
+    if (!parse_sps (nal, &sps_id)) {
+      GST_WARNING_OBJECT (rtph264depay, "Invalid SPS,"
+          " can't parse seq_parameter_set_id");
+      goto drop;
+    }
+
+    for (i = 0; i < rtph264depay->sps->len; i++) {
+      GstBuffer *sps = g_ptr_array_index (rtph264depay->sps, i);
+      guint32 tmp_sps_id;
+
+      parse_sps (sps, &tmp_sps_id);
+      if (sps_id == tmp_sps_id) {
+        if (GST_BUFFER_SIZE (nal) == GST_BUFFER_SIZE (sps) &&
+            memcmp (GST_BUFFER_DATA (nal), GST_BUFFER_DATA (sps),
+                GST_BUFFER_SIZE (sps)) == 0) {
+          GST_LOG_OBJECT (rtph264depay, "Unchanged SPS %u, not updating",
+              sps_id);
+          goto drop;
+        } else {
+          g_ptr_array_remove_index_fast (rtph264depay->sps, i);
+          g_ptr_array_add (rtph264depay->sps, nal);
+          GST_LOG_OBJECT (rtph264depay, "Modified SPS %u, replacing", sps_id);
+          goto done;
+        }
+      }
+    }
+    GST_LOG_OBJECT (rtph264depay, "Adding new SPS %u", sps_id);
+    g_ptr_array_add (rtph264depay->sps, nal);
+  } else if (type == 8) {
+    guint32 sps_id;
+    guint32 pps_id;
+
+    if (!parse_pps (nal, &sps_id, &pps_id)) {
+      GST_WARNING_OBJECT (rtph264depay, "Invalid PPS,"
+          " can't parse seq_parameter_set_id or pic_parameter_set_id");
+      goto drop;
+    }
+
+    for (i = 0; i < rtph264depay->pps->len; i++) {
+      GstBuffer *pps = g_ptr_array_index (rtph264depay->pps, i);
+      guint32 tmp_sps_id;
+      guint32 tmp_pps_id;
+
+      parse_pps (pps, &tmp_sps_id, &tmp_pps_id);
+      if (sps_id == tmp_sps_id && pps_id == tmp_pps_id) {
+        if (GST_BUFFER_SIZE (nal) == GST_BUFFER_SIZE (pps) &&
+            memcmp (GST_BUFFER_DATA (nal), GST_BUFFER_DATA (pps),
+                GST_BUFFER_SIZE (pps)) == 0) {
+          GST_LOG_OBJECT (rtph264depay, "Unchanged PPS %u:%u, not updating",
+              sps_id, pps_id);
+          goto drop;
+        } else {
+          g_ptr_array_remove_index_fast (rtph264depay->pps, i);
+          g_ptr_array_add (rtph264depay->pps, nal);
+          GST_LOG_OBJECT (rtph264depay, "Modified PPS %u:%u, replacing",
+              sps_id, pps_id);
+          goto done;
+        }
+      }
+    }
+    GST_LOG_OBJECT (rtph264depay, "Adding new PPS %u:%i", sps_id, pps_id);
+    g_ptr_array_add (rtph264depay->pps, nal);
+  } else {
+    goto drop;
+  }
+
+done:
+  rtph264depay->new_codec_data = TRUE;
+
+  return TRUE;
+
+drop:
+  gst_buffer_unref (nal);
+
+  return FALSE;
+}
+
+static gboolean
+gst_rtp_h264_depay_setcaps (GstBaseRTPDepayload * depayload, GstCaps * caps)
+{
   gint clock_rate;
   GstStructure *structure = gst_caps_get_structure (caps, 0);
   GstRtpH264Depay *rtph264depay;
-  const gchar *ps, *profile;
+  const gchar *ps;
   GstBuffer *codec_data;
   guint8 *b64;
-  gboolean res;
 
   rtph264depay = GST_RTP_H264_DEPAY (depayload);
 
@@ -306,12 +564,8 @@ gst_rtp_h264_depay_setcaps (GstBaseRTPDepayload * depayload, GstCaps * caps)
     clock_rate = 90000;
   depayload->clock_rate = clock_rate;
 
-  srccaps = gst_caps_new_simple ("video/x-h264", NULL);
-
   /* Base64 encoded, comma separated config NALs */
   ps = gst_structure_get_string (structure, "sprop-parameter-sets");
-  /* hex: AVCProfileIndication:8 | profile_compat:8 | AVCLevelIndication:8 */
-  profile = gst_structure_get_string (structure, "profile-level-id");
 
   /* negotiate with downstream w.r.t. output format and alignment */
   gst_rtp_h264_depay_negotiate (rtph264depay);
@@ -361,123 +615,51 @@ gst_rtp_h264_depay_setcaps (GstBaseRTPDepayload * depayload, GstCaps * caps)
     rtph264depay->codec_data = codec_data;
   } else if (!rtph264depay->byte_stream) {
     gchar **params;
-    guint8 **sps, **pps;
-    guint len, num_sps, num_pps;
     gint i;
-    guint8 *data;
 
     if (ps == NULL)
       goto incomplete_caps;
 
     params = g_strsplit (ps, ",", 0);
-    len = g_strv_length (params);
-
-    GST_DEBUG_OBJECT (depayload, "we have %d params", len);
 
-    sps = g_new0 (guint8 *, len + 1);
-    pps = g_new0 (guint8 *, len + 1);
-    num_sps = num_pps = 0;
+    GST_DEBUG_OBJECT (depayload, "we have %d params", g_strv_length (params));
 
     /* start with 7 bytes header */
-    len = 7;
     for (i = 0; params[i]; i++) {
+      GstBuffer *nal;
       gsize nal_len;
-      guint8 *nalp;
       guint save = 0;
       gint state = 0;
 
       nal_len = strlen (params[i]);
-      nalp = g_malloc (nal_len + 2);
+      nal = gst_buffer_new_and_alloc (nal_len);
 
       nal_len =
-          g_base64_decode_step (params[i], nal_len, nalp + 2, &state, &save);
-      nalp[0] = (nal_len >> 8) & 0xff;
-      nalp[1] = nal_len & 0xff;
-      len += nal_len + 2;
-
-      /* copy to the right list */
-      if ((nalp[2] & 0x1f) == 7) {
-        GST_DEBUG_OBJECT (depayload, "adding param %d as SPS %d", i, num_sps);
-        sps[num_sps++] = nalp;
-      } else {
-        GST_DEBUG_OBJECT (depayload, "adding param %d as PPS %d", i, num_pps);
-        pps[num_pps++] = nalp;
-      }
-    }
-    g_strfreev (params);
+          g_base64_decode_step (params[i], nal_len, GST_BUFFER_DATA (nal),
+          &state, &save);
 
-    if (num_sps == 0 || (GST_READ_UINT16_BE (sps[0]) < 3) || num_pps == 0) {
-      g_strfreev ((gchar **) pps);
-      g_strfreev ((gchar **) sps);
-      goto incomplete_caps;
-    }
+      GST_BUFFER_SIZE (nal) = nal_len;
 
-    codec_data = gst_buffer_new_and_alloc (len);
-    data = GST_BUFFER_DATA (codec_data);
+      GST_DEBUG_OBJECT (depayload, "adding param %d as %s", i,
+          ((GST_BUFFER_DATA (nal)[0] & 0x1f) == 7) ? "SPS" : "PPS");
 
-    /* 8 bits version == 1 */
-    *data++ = 1;
-    if (profile) {
-      guint32 profile_id;
-
-      /* hex: AVCProfileIndication:8 | profile_compat:8 | AVCLevelIndication:8 */
-      sscanf (profile, "%6x", &profile_id);
-      *data++ = (profile_id >> 16) & 0xff;
-      *data++ = (profile_id >> 8) & 0xff;
-      *data++ = profile_id & 0xff;
-    } else {
-      /* extract from SPS */
-      *data++ = sps[0][3];
-      *data++ = sps[0][4];
-      *data++ = sps[0][5];
+      gst_rtp_h264_add_sps_pps (rtph264depay, nal);
     }
-    /* 6 bits reserved | 2 bits lengthSizeMinusOn */
-    *data++ = 0xff;
-    /* 3 bits reserved | 5 bits numOfSequenceParameterSets */
-    *data++ = 0xe0 | (num_sps & 0x1f);
+    g_strfreev (params);
 
-    /* copy all SPS */
-    for (i = 0; sps[i]; i++) {
-      len = ((sps[i][0] << 8) | sps[i][1]) + 2;
-      GST_DEBUG_OBJECT (depayload, "copy SPS %d of length %d", i, len);
-      memcpy (data, sps[i], len);
-      g_free (sps[i]);
-      data += len;
-    }
-    g_free (sps);
-    /* 8 bits numOfPictureParameterSets */
-    *data++ = num_pps;
-    /* copy all PPS */
-    for (i = 0; pps[i]; i++) {
-      len = ((pps[i][0] << 8) | pps[i][1]) + 2;
-      GST_DEBUG_OBJECT (depayload, "copy PPS %d of length %d", i, len);
-      memcpy (data, pps[i], len);
-      g_free (pps[i]);
-      data += len;
-    }
-    g_free (pps);
-    GST_BUFFER_SIZE (codec_data) = data - GST_BUFFER_DATA (codec_data);
+    if (rtph264depay->sps->len == 0 || rtph264depay->pps->len == 0)
+      goto incomplete_caps;
 
-    gst_caps_set_simple (srccaps,
-        "codec_data", GST_TYPE_BUFFER, codec_data, NULL);
-    gst_buffer_unref (codec_data);
   }
 
-  gst_caps_set_simple (srccaps, "stream-format", G_TYPE_STRING,
-      rtph264depay->byte_stream ? "byte-stream" : "avc",
-      "alignment", G_TYPE_STRING, rtph264depay->merge ? "au" : "nal", NULL);
-
-  res = gst_pad_set_caps (depayload->srcpad, srccaps);
-  gst_caps_unref (srccaps);
-
-  return res;
+  return gst_rtp_h264_set_src_caps (rtph264depay);
 
   /* ERRORS */
 incomplete_caps:
   {
-    GST_DEBUG_OBJECT (depayload, "we have incomplete caps");
-    gst_caps_unref (srccaps);
-    return FALSE;
+    GST_DEBUG_OBJECT (depayload, "we have incomplete caps,"
+        " doing setcaps later");
+    return TRUE;
   }
 }
 
@@ -532,6 +714,30 @@ gst_rtp_h264_depay_handle_nal (GstRtpH264Depay * rtph264depay, GstBuffer * nal,
   out_keyframe = keyframe;
   out_timestamp = in_timestamp;
 
+  if (!rtph264depay->byte_stream) {
+    if (nal_type == 7 || nal_type == 8) {
+      gst_rtp_h264_add_sps_pps (rtph264depay, gst_buffer_create_sub (nal, 4,
+              GST_BUFFER_SIZE (nal) - 4));
+      gst_buffer_unref (nal);
+      return NULL;
+    } else if (rtph264depay->sps->len == 0 || rtph264depay->pps->len == 0) {
+      /* Down push down any buffer in non-bytestream mode if the SPS/PPS haven't
+       * go through yet
+       */
+      gst_pad_push_event (GST_BASE_RTP_DEPAYLOAD_SINKPAD (depayload),
+          gst_event_new_custom (GST_EVENT_CUSTOM_UPSTREAM,
+              gst_structure_new ("GstForceKeyUnit",
+                  "all-headers", G_TYPE_BOOLEAN, TRUE, NULL)));
+      gst_buffer_unref (nal);
+      return FALSE;
+    }
+
+    if (rtph264depay->new_codec_data &&
+        rtph264depay->sps->len > 0 && rtph264depay->pps->len > 0)
+      gst_rtp_h264_set_src_caps (rtph264depay);
+  }
+
+
   if (rtph264depay->merge) {
     gboolean start = FALSE, complete = FALSE;
 
diff --git a/gst/rtp/gstrtph264depay.h b/gst/rtp/gstrtph264depay.h
index f50ffe6..fd2603f 100644
--- a/gst/rtp/gstrtph264depay.h
+++ b/gst/rtp/gstrtph264depay.h
@@ -61,6 +61,11 @@ struct _GstRtpH264Depay
   guint8 current_fu_type;
   GstClockTime fu_timestamp;
   gboolean fu_marker;
+
+  /* misc */
+  GPtrArray *sps;
+  GPtrArray *pps;
+  gboolean new_codec_data;
 };
 
 struct _GstRtpH264DepayClass
diff --git a/gst/rtp/gstrtph264pay.c b/gst/rtp/gstrtph264pay.c
index 1d0721e..4dc08c3 100644
--- a/gst/rtp/gstrtph264pay.c
+++ b/gst/rtp/gstrtph264pay.c
@@ -45,10 +45,13 @@ GST_DEBUG_CATEGORY_STATIC (rtph264pay_debug);
  */
 
 static GstStaticPadTemplate gst_rtp_h264_pay_sink_template =
-GST_STATIC_PAD_TEMPLATE ("sink",
+    GST_STATIC_PAD_TEMPLATE ("sink",
     GST_PAD_SINK,
     GST_PAD_ALWAYS,
-    GST_STATIC_CAPS ("video/x-h264")
+    GST_STATIC_CAPS ("video/x-h264, "
+        "stream-format = (string) byte-stream, alignment = (string) { nal, au };"
+        "video/x-h264, "
+        "stream-format = (string) avc, alignment = (string) au")
     );
 
 static GstStaticPadTemplate gst_rtp_h264_pay_src_template =
@@ -271,108 +274,127 @@ static const gchar *all_levels[] = {
 static GstCaps *
 gst_rtp_h264_pay_getcaps (GstBaseRTPPayload * payload, GstPad * pad)
 {
+  GstCaps *template_caps;
   GstCaps *allowed_caps;
+  GstCaps *caps, *icaps;
+  gboolean append_unrestricted;
+  guint i;
 
   allowed_caps =
       gst_pad_peer_get_caps_reffed (GST_BASE_RTP_PAYLOAD_SRCPAD (payload));
 
-  if (allowed_caps) {
-    GstCaps *caps = NULL;
-    guint i;
+  if (allowed_caps == NULL)
+    return NULL;
 
-    if (gst_caps_is_any (allowed_caps)) {
-      gst_caps_unref (allowed_caps);
-      goto any;
-    }
+  template_caps =
+      gst_static_pad_template_get_caps (&gst_rtp_h264_pay_sink_template);
 
-    if (gst_caps_is_empty (allowed_caps))
-      return allowed_caps;
+  if (gst_caps_is_any (allowed_caps)) {
+    caps = gst_caps_ref (template_caps);
+    goto done;
+  }
 
-    caps = gst_caps_new_empty ();
+  if (gst_caps_is_empty (allowed_caps)) {
+    caps = gst_caps_ref (allowed_caps);
+    goto done;
+  }
 
-    for (i = 0; i < gst_caps_get_size (allowed_caps); i++) {
-      GstStructure *s = gst_caps_get_structure (allowed_caps, i);
-      GstStructure *new_s = gst_structure_new ("video/x-h264", NULL);
-      const gchar *profile_level_id;
+  caps = gst_caps_new_empty ();
 
-      profile_level_id = gst_structure_get_string (s, "profile-level-id");
+  append_unrestricted = FALSE;
+  for (i = 0; i < gst_caps_get_size (allowed_caps); i++) {
+    GstStructure *s = gst_caps_get_structure (allowed_caps, i);
+    GstStructure *new_s = gst_structure_new ("video/x-h264", NULL);
+    const gchar *profile_level_id;
 
-      if (profile_level_id && strlen (profile_level_id) == 6) {
-        const gchar *profile;
-        const gchar *level;
-        long int spsint;
-        guint8 sps[3];
+    profile_level_id = gst_structure_get_string (s, "profile-level-id");
 
-        spsint = strtol (profile_level_id, NULL, 16);
-        sps[0] = spsint >> 16;
-        sps[1] = spsint >> 8;
-        sps[2] = spsint;
+    if (profile_level_id && strlen (profile_level_id) == 6) {
+      const gchar *profile;
+      const gchar *level;
+      long int spsint;
+      guint8 sps[3];
 
-        profile = gst_codec_utils_h264_get_profile (sps, 3);
-        level = gst_codec_utils_h264_get_level (sps, 3);
+      spsint = strtol (profile_level_id, NULL, 16);
+      sps[0] = spsint >> 16;
+      sps[1] = spsint >> 8;
+      sps[2] = spsint;
 
-        if (profile && level) {
-          GST_LOG_OBJECT (payload, "In caps, have profile %s and level %s",
-              profile, level);
+      profile = gst_codec_utils_h264_get_profile (sps, 3);
+      level = gst_codec_utils_h264_get_level (sps, 3);
 
-          if (!strcmp (profile, "constrained-baseline"))
-            gst_structure_set (new_s, "profile", G_TYPE_STRING, profile, NULL);
-          else {
-            GValue val = { 0, };
-            GValue profiles = { 0, };
+      if (profile && level) {
+        GST_LOG_OBJECT (payload, "In caps, have profile %s and level %s",
+            profile, level);
 
-            g_value_init (&profiles, GST_TYPE_LIST);
-            g_value_init (&val, G_TYPE_STRING);
+        if (!strcmp (profile, "constrained-baseline"))
+          gst_structure_set (new_s, "profile", G_TYPE_STRING, profile, NULL);
+        else {
+          GValue val = { 0, };
+          GValue profiles = { 0, };
 
-            g_value_set_static_string (&val, profile);
-            gst_value_list_append_value (&profiles, &val);
+          g_value_init (&profiles, GST_TYPE_LIST);
+          g_value_init (&val, G_TYPE_STRING);
 
-            g_value_set_static_string (&val, "constrained-baseline");
-            gst_value_list_append_value (&profiles, &val);
+          g_value_set_static_string (&val, profile);
+          gst_value_list_append_value (&profiles, &val);
 
-            gst_structure_take_value (new_s, "profile", &profiles);
-          }
+          g_value_set_static_string (&val, "constrained-baseline");
+          gst_value_list_append_value (&profiles, &val);
 
-          if (!strcmp (level, "1"))
-            gst_structure_set (new_s, "level", G_TYPE_STRING, level, NULL);
-          else {
-            GValue levels = { 0, };
-            GValue val = { 0, };
-            int j;
-
-            g_value_init (&levels, GST_TYPE_LIST);
-            g_value_init (&val, G_TYPE_STRING);
-
-            for (j = 0; all_levels[j]; j++) {
-              g_value_set_static_string (&val, all_levels[j]);
-              gst_value_list_prepend_value (&levels, &val);
-              if (!strcmp (level, all_levels[j]))
-                break;
-            }
-            gst_structure_take_value (new_s, "level", &levels);
-          }
-        } else {
-          /* Invalid profile-level-id means baseline */
+          gst_structure_take_value (new_s, "profile", &profiles);
+        }
 
-          gst_structure_set (new_s,
-              "profile", G_TYPE_STRING, "constrained-baseline", NULL);
+        if (!strcmp (level, "1"))
+          gst_structure_set (new_s, "level", G_TYPE_STRING, level, NULL);
+        else {
+          GValue levels = { 0, };
+          GValue val = { 0, };
+          int j;
+
+          g_value_init (&levels, GST_TYPE_LIST);
+          g_value_init (&val, G_TYPE_STRING);
+
+          for (j = 0; all_levels[j]; j++) {
+            g_value_set_static_string (&val, all_levels[j]);
+            gst_value_list_prepend_value (&levels, &val);
+            if (!strcmp (level, all_levels[j]))
+              break;
+          }
+          gst_structure_take_value (new_s, "level", &levels);
         }
       } else {
-        /* No profile-level-id also means baseline */
+        /* Invalid profile-level-id means baseline */
 
         gst_structure_set (new_s,
             "profile", G_TYPE_STRING, "constrained-baseline", NULL);
       }
+    } else {
+      /* No profile-level-id means baseline or unrestricted */
 
-      gst_caps_merge_structure (caps, new_s);
+      gst_structure_set (new_s,
+          "profile", G_TYPE_STRING, "constrained-baseline", NULL);
+      append_unrestricted = TRUE;
     }
 
-    gst_caps_unref (allowed_caps);
-    return caps;
+    gst_caps_merge_structure (caps, new_s);
+  }
+
+  if (append_unrestricted) {
+    gst_caps_merge_structure (caps, gst_structure_new ("video/x-h264", NULL));
   }
 
-any:
-  return gst_caps_new_simple ("video/x-h264", NULL);
+  icaps = gst_caps_intersect (caps, template_caps);
+  gst_caps_unref (caps);
+  caps = icaps;
+
+done:
+
+  gst_caps_unref (template_caps);
+  gst_caps_unref (allowed_caps);
+
+  GST_LOG_OBJECT (payload, "returning caps %" GST_PTR_FORMAT, caps);
+  return caps;
 }
 
 /* take the currently configured SPS and PPS lists and set them on the caps as
diff --git a/gst/rtp/gstrtpjpegpay.c b/gst/rtp/gstrtpjpegpay.c
index eae2840..d67ebef 100644
--- a/gst/rtp/gstrtpjpegpay.c
+++ b/gst/rtp/gstrtpjpegpay.c
@@ -421,7 +421,8 @@ no_table:
 
 static gboolean
 gst_rtp_jpeg_pay_read_sof (GstRtpJPEGPay * pay, const guint8 * data,
-    guint size, guint * offset, CompInfo info[])
+    guint size, guint * offset, CompInfo info[], RtpQuantTable tables[],
+    gulong tables_elements)
 {
   guint sof_size, off;
   guint width, height, infolen;
@@ -499,8 +500,18 @@ gst_rtp_jpeg_pay_read_sof (GstRtpJPEGPay * pay, const guint8 * data,
 
   /* the other components are free to use any quant table but they have to
    * have the same table id */
-  if (info[1].qt != info[2].qt)
-    goto invalid_comp;
+  if (info[1].qt != info[2].qt) {
+    /* Some MJPG (like the one from the Logitech C-920 camera) uses different
+     * quant tables for component 1 and 2 but both tables contain the exact
+     * same data, so we could consider them as being the same tables */
+    if (!(info[1].qt < tables_elements &&
+            info[2].qt < tables_elements &&
+            tables[info[1].qt].size > 0 &&
+            tables[info[1].qt].size == tables[info[2].qt].size &&
+            memcmp (tables[info[1].qt].data, tables[info[2].qt].data,
+                tables[info[1].qt].size) == 0))
+      goto invalid_comp;
+  }
 
   return TRUE;
 
@@ -651,7 +662,8 @@ gst_rtp_jpeg_pay_handle_buffer (GstBaseRTPPayload * basepayload,
         offset += gst_rtp_jpeg_pay_header_size (data, offset);
         break;
       case JPEG_MARKER_SOF:
-        if (!gst_rtp_jpeg_pay_read_sof (pay, data, size, &offset, info))
+        if (!gst_rtp_jpeg_pay_read_sof (pay, data, size, &offset, info, tables,
+                G_N_ELEMENTS (tables)))
           goto invalid_format;
         sof_found = TRUE;
         break;
diff --git a/gst/rtp/gstrtpmp2tdepay.c b/gst/rtp/gstrtpmp2tdepay.c
index 609bfba..eaef3ee 100644
--- a/gst/rtp/gstrtpmp2tdepay.c
+++ b/gst/rtp/gstrtpmp2tdepay.c
@@ -56,7 +56,8 @@ static GstStaticPadTemplate gst_rtp_mp2t_depay_sink_template =
     GST_STATIC_CAPS ("application/x-rtp, "
         "media = (string) \"video\", "
         "payload = (int) " GST_RTP_PAYLOAD_DYNAMIC_STRING ", "
-        "clock-rate = (int) [1, MAX ], " "encoding-name = (string) \"MP2T-ES\";"
+        "clock-rate = (int) [1, MAX ], "
+        "encoding-name = (string) { MP2T-ES, MP2T }; "
         /* All optional parameters
          *
          * "profile-level-id=[1,MAX]"
@@ -156,7 +157,7 @@ gst_rtp_mp2t_depay_process (GstBaseRTPDepayload * depayload, GstBuffer * buf)
 {
   GstRtpMP2TDepay *rtpmp2tdepay;
   GstBuffer *outbuf;
-  gint payload_len;
+  gint payload_len, leftover;
 
   rtpmp2tdepay = GST_RTP_MP2T_DEPAY (depayload);
 
@@ -165,9 +166,26 @@ gst_rtp_mp2t_depay_process (GstBaseRTPDepayload * depayload, GstBuffer * buf)
   if (G_UNLIKELY (payload_len <= rtpmp2tdepay->skip_first_bytes))
     goto empty_packet;
 
+  payload_len -= rtpmp2tdepay->skip_first_bytes;
+
+  /* RFC 2250
+   *
+   * 2. Encapsulation of MPEG System and Transport Streams
+   *
+   * For MPEG2 Transport Streams the RTP payload will contain an integral
+   * number of MPEG transport packets.
+   */
+  leftover = payload_len % 188;
+  if (G_UNLIKELY (leftover)) {
+    GST_WARNING ("We don't have an integral number of buffers (leftover: %d)",
+        leftover);
+
+    payload_len -= leftover;
+  }
+
   outbuf =
       gst_rtp_buffer_get_payload_subbuffer (buf, rtpmp2tdepay->skip_first_bytes,
-      -1);
+      payload_len);
 
   if (outbuf)
     GST_DEBUG ("gst_rtp_mp2t_depay_chain: pushing buffer of size %d",
diff --git a/gst/rtp/gstrtpmp2tpay.c b/gst/rtp/gstrtpmp2tpay.c
index 55ef623..108d10b 100644
--- a/gst/rtp/gstrtpmp2tpay.c
+++ b/gst/rtp/gstrtpmp2tpay.c
@@ -121,32 +121,53 @@ gst_rtp_mp2t_pay_setcaps (GstBaseRTPPayload * payload, GstCaps * caps)
 static GstFlowReturn
 gst_rtp_mp2t_pay_flush (GstRTPMP2TPay * rtpmp2tpay)
 {
-  guint avail;
-  guint8 *payload;
-  GstFlowReturn ret;
+  guint avail, mtu;
+  GstFlowReturn ret = GST_FLOW_OK;
   GstBuffer *outbuf;
 
   avail = gst_adapter_available (rtpmp2tpay->adapter);
-  if (avail == 0)
-    return GST_FLOW_OK;
-  outbuf = gst_rtp_buffer_new_allocate (avail, 0, 0);
 
-  /* get payload */
-  payload = gst_rtp_buffer_get_payload (outbuf);
+  mtu = GST_BASE_RTP_PAYLOAD_MTU (rtpmp2tpay);
+
+  while (avail > 0 && (ret == GST_FLOW_OK)) {
+    guint towrite;
+    guint8 *payload;
+    guint payload_len;
+    guint packet_len;
+
+    /* this will be the total length of the packet */
+    packet_len = gst_rtp_buffer_calc_packet_len (avail, 0, 0);
+
+    /* fill one MTU or all available bytes */
+    towrite = MIN (packet_len, mtu);
+
+    /* this is the payload length */
+    payload_len = gst_rtp_buffer_calc_payload_len (towrite, 0, 0);
+    payload_len -= payload_len % 188;
+
+    /* need whole packets */
+    if (!payload_len)
+      break;
 
-  /* copy stuff from adapter to payload */
-  gst_adapter_copy (rtpmp2tpay->adapter, payload, 0, avail);
+    /* create buffer to hold the payload */
+    outbuf = gst_rtp_buffer_new_allocate (payload_len, 0, 0);
 
-  GST_BUFFER_TIMESTAMP (outbuf) = rtpmp2tpay->first_ts;
-  GST_BUFFER_DURATION (outbuf) = rtpmp2tpay->duration;
+    /* get payload */
+    payload = gst_rtp_buffer_get_payload (outbuf);
 
-  GST_DEBUG_OBJECT (rtpmp2tpay, "pushing buffer of size %d",
-      GST_BUFFER_SIZE (outbuf));
+    /* copy stuff from adapter to payload */
+    gst_adapter_copy (rtpmp2tpay->adapter, payload, 0, payload_len);
+    gst_adapter_flush (rtpmp2tpay->adapter, payload_len);
+    avail -= payload_len;
 
-  ret = gst_basertppayload_push (GST_BASE_RTP_PAYLOAD (rtpmp2tpay), outbuf);
+    GST_BUFFER_TIMESTAMP (outbuf) = rtpmp2tpay->first_ts;
+    GST_BUFFER_DURATION (outbuf) = rtpmp2tpay->duration;
 
-  /* flush the adapter content */
-  gst_adapter_flush (rtpmp2tpay->adapter, avail);
+    GST_DEBUG_OBJECT (rtpmp2tpay, "pushing buffer of size %d",
+        GST_BUFFER_SIZE (outbuf));
+
+    ret = gst_basertppayload_push (GST_BASE_RTP_PAYLOAD (rtpmp2tpay), outbuf);
+  }
 
   return ret;
 }
@@ -166,6 +187,7 @@ gst_rtp_mp2t_pay_handle_buffer (GstBaseRTPPayload * basepayload,
   timestamp = GST_BUFFER_TIMESTAMP (buffer);
   duration = GST_BUFFER_DURATION (buffer);
 
+again:
   ret = GST_FLOW_OK;
   avail = gst_adapter_available (rtpmp2tpay->adapter);
 
@@ -175,13 +197,12 @@ gst_rtp_mp2t_pay_handle_buffer (GstBaseRTPPayload * basepayload,
     rtpmp2tpay->duration = duration;
   }
 
-  /* get packet length of previous data and this new data, 
-   * payload length includes a 4 byte header */
-  packet_len = gst_rtp_buffer_calc_packet_len (4 + avail + size, 0, 0);
+  /* get packet length of previous data and this new data */
+  packet_len = gst_rtp_buffer_calc_packet_len (avail + size, 0, 0);
 
-  /* if this buffer is going to overflow the packet, flush what we
-   * have. */
-  if (gst_basertppayload_is_filled (basepayload,
+  /* if this buffer is going to overflow the packet, flush what we have,
+   * or if upstream is handing us several packets, to keep latency low */
+  if (!size || gst_basertppayload_is_filled (basepayload,
           packet_len, rtpmp2tpay->duration + duration)) {
     ret = gst_rtp_mp2t_pay_flush (rtpmp2tpay);
     rtpmp2tpay->first_ts = timestamp;
@@ -194,7 +215,15 @@ gst_rtp_mp2t_pay_handle_buffer (GstBaseRTPPayload * basepayload,
   }
 
   /* copy buffer to adapter */
-  gst_adapter_push (rtpmp2tpay->adapter, buffer);
+  if (buffer) {
+    gst_adapter_push (rtpmp2tpay->adapter, buffer);
+    buffer = NULL;
+  }
+
+  if (size >= (188 * 2)) {
+    size = 0;
+    goto again;
+  }
 
   return ret;
 
diff --git a/gst/rtp/gstrtpmparobustdepay.c b/gst/rtp/gstrtpmparobustdepay.c
index 17645a4..7413c88 100644
--- a/gst/rtp/gstrtpmparobustdepay.c
+++ b/gst/rtp/gstrtpmparobustdepay.c
@@ -288,7 +288,7 @@ gst_rtp_mpa_robust_depay_generate_dummy_frame (GstRtpMPARobustDepay *
   dummy->size =
       mp3_type_frame_length_from_header (GST_ELEMENT_CAST (rtpmpadepay),
       dummy->header, NULL, NULL, NULL, NULL, NULL, NULL, NULL);
-  dummy->data_size = dummy->size - dummy->side_info;
+  dummy->data_size = dummy->size - 4 - dummy->side_info;
   dummy->backpointer = 0;
 
   dummy->buffer = gst_buffer_new_and_alloc (dummy->side_info + 4);
@@ -439,9 +439,9 @@ gst_rtp_mpa_robust_depay_deinterleave (GstRtpMPARobustDepay * rtpmpadepay,
       }
     }
     /* rewrite buffer sync header */
-    val = GST_READ_UINT16_BE (buf);
+    val = GST_READ_UINT16_BE (data);
     val = (0x7ff << 5) | val;
-    GST_WRITE_UINT16_BE (buf, val);
+    GST_WRITE_UINT16_BE (data, val);
     /* store and keep track of last indices */
     rtpmpadepay->last_icc = icc;
     rtpmpadepay->last_ii = iindex;
@@ -497,13 +497,13 @@ gst_rtp_mpa_robust_depay_push_mp3_frames (GstRtpMPARobustDepay * rtpmpadepay)
 
     if (rtpmpadepay->offset == GST_BUFFER_SIZE (frame->buffer)) {
       if (g_list_next (rtpmpadepay->cur_adu_frame)) {
-        GST_LOG_OBJECT (rtpmpadepay,
-            "moving to next ADU frame, size %d, side_info %d",
-            frame->size, frame->side_info);
         rtpmpadepay->size += frame->data_size;
         rtpmpadepay->cur_adu_frame = g_list_next (rtpmpadepay->cur_adu_frame);
         frame = (GstADUFrame *) rtpmpadepay->cur_adu_frame->data;
         rtpmpadepay->offset = 0;
+        GST_LOG_OBJECT (rtpmpadepay,
+            "moving to next ADU frame, size %d, side_info %d, backpointer %d",
+            frame->size, frame->side_info, frame->backpointer);
         /* layer I and II packets have no bitreservoir and must be sent as-is;
          * so flush any pending frame */
         if (G_UNLIKELY (frame->layer != 3 && rtpmpadepay->mp3_frame))
@@ -523,6 +523,7 @@ gst_rtp_mpa_robust_depay_push_mp3_frames (GstRtpMPARobustDepay * rtpmpadepay)
       gst_byte_writer_set_pos (rtpmpadepay->mp3_frame, 0);
       /* bytewriter corresponds to head frame,
        * i.e. the header and the side info must match */
+      g_assert (4 + head->side_info <= head->size);
       gst_byte_writer_put_data (rtpmpadepay->mp3_frame,
           GST_BUFFER_DATA (head->buffer), 4 + head->side_info);
     }
@@ -582,6 +583,8 @@ gst_rtp_mpa_robust_depay_push_mp3_frames (GstRtpMPARobustDepay * rtpmpadepay)
         /* position and append */
         GST_LOG_OBJECT (rtpmpadepay, "adding to current MP3 frame");
         gst_byte_writer_set_pos (rtpmpadepay->mp3_frame, tpos);
+        av -= (tpos - pos);
+        g_assert (GST_BUFFER_SIZE (buf) >= 4 + frame->side_info);
         av = MIN (av, GST_BUFFER_SIZE (buf) - 4 - frame->side_info);
         gst_byte_writer_put_data (rtpmpadepay->mp3_frame,
             GST_BUFFER_DATA (buf) + 4 + frame->side_info, av);
@@ -661,8 +664,8 @@ gst_rtp_mpa_robust_depay_process (GstBaseRTPDepayload * depayload,
    */
   while (payload_len) {
     if (G_LIKELY (rtpmpadepay->has_descriptor)) {
-      cont = !!(payload[offset] & 0x80);
-      dtype = !!(payload[offset] & 0x40);
+      cont = ! !(payload[offset] & 0x80);
+      dtype = ! !(payload[offset] & 0x40);
       if (dtype) {
         size = (payload[offset] & 0x3f) << 8 | payload[offset + 1];
         payload_len--;
@@ -775,6 +778,8 @@ gst_rtp_mpa_robust_change_state (GstElement * element,
       g_queue_foreach (rtpmpadepay->adu_frames,
           (GFunc) gst_rtp_mpa_robust_depay_free_frame, NULL);
       g_queue_clear (rtpmpadepay->adu_frames);
+      if (rtpmpadepay->mp3_frame)
+        gst_byte_writer_free (rtpmpadepay->mp3_frame);
       break;
     }
     default:
diff --git a/gst/rtp/gstrtpqdmdepay.c b/gst/rtp/gstrtpqdmdepay.c
index 0139709..2100b89 100644
--- a/gst/rtp/gstrtpqdmdepay.c
+++ b/gst/rtp/gstrtpqdmdepay.c
@@ -121,7 +121,7 @@ gst_rtp_qdm2_depay_finalize (GObject * object)
   G_OBJECT_CLASS (parent_class)->finalize (object);
 }
 
-// only on the sink
+/* only on the sink */
 gboolean
 gst_rtp_qdm2_depay_setcaps (GstBaseRTPDepayload * filter, GstCaps * caps)
 {
@@ -129,7 +129,7 @@ gst_rtp_qdm2_depay_setcaps (GstBaseRTPDepayload * filter, GstCaps * caps)
   gint clock_rate;
 
   if (!gst_structure_get_int (structure, "clock-rate", &clock_rate))
-    clock_rate = 44100;         // default
+    clock_rate = 44100;         /* default */
   filter->clock_rate = clock_rate;
 
   /* will set caps later */
diff --git a/gst/rtp/gstrtpsv3vdepay.c b/gst/rtp/gstrtpsv3vdepay.c
index b29fe02..5b52fc2 100644
--- a/gst/rtp/gstrtpsv3vdepay.c
+++ b/gst/rtp/gstrtpsv3vdepay.c
@@ -116,7 +116,7 @@ gst_rtp_sv3v_depay_finalize (GObject * object)
   G_OBJECT_CLASS (parent_class)->finalize (object);
 }
 
-// only on the sink
+/* only on the sink */
 gboolean
 gst_rtp_sv3v_depay_setcaps (GstBaseRTPDepayload * filter, GstCaps * caps)
 {
@@ -124,7 +124,7 @@ gst_rtp_sv3v_depay_setcaps (GstBaseRTPDepayload * filter, GstCaps * caps)
   gint clock_rate;
 
   if (!gst_structure_get_int (structure, "clock-rate", &clock_rate))
-    clock_rate = 90000;         // default
+    clock_rate = 90000;         /* default */
   filter->clock_rate = clock_rate;
 
   /* will set caps later */
diff --git a/gst/rtp/gstrtptheoradepay.c b/gst/rtp/gstrtptheoradepay.c
index 1e38262..c808c2a 100644
--- a/gst/rtp/gstrtptheoradepay.c
+++ b/gst/rtp/gstrtptheoradepay.c
@@ -322,10 +322,6 @@ gst_rtp_theora_depay_setcaps (GstBaseRTPDepayload * depayload, GstCaps * caps)
     guint8 *data;
     gsize size;
 
-    /* configure string should be in the caps */
-    if (configuration == NULL)
-      goto no_configuration;
-
     /* deserialize base64 to buffer */
     data = g_base64_decode (configuration, &size);
 
@@ -349,11 +345,6 @@ gst_rtp_theora_depay_setcaps (GstBaseRTPDepayload * depayload, GstCaps * caps)
   return res;
 
   /* ERRORS */
-no_configuration:
-  {
-    GST_ERROR_OBJECT (rtptheoradepay, "no configuration specified");
-    return FALSE;
-  }
 invalid_configuration:
   {
     GST_ERROR_OBJECT (rtptheoradepay, "invalid configuration specified");
diff --git a/gst/rtpmanager/Makefile.in b/gst/rtpmanager/Makefile.in
index 212952f..697574e 100644
--- a/gst/rtpmanager/Makefile.in
+++ b/gst/rtpmanager/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -25,6 +24,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -43,15 +59,16 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/gst-glib-gen.mak
+	$(srcdir)/Makefile.in $(top_srcdir)/common/gst-glib-gen.mak \
+	$(top_srcdir)/depcomp
 subdir = gst/rtpmanager
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -138,10 +155,23 @@ libgstrtpmanager_la_OBJECTS = $(am_libgstrtpmanager_la_OBJECTS) \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstrtpmanager_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstrtpmanager_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstrtpmanager_la_CFLAGS) $(CFLAGS) \
 	$(libgstrtpmanager_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -154,23 +184,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstrtpmanager_la_SOURCES) \
 	$(nodist_libgstrtpmanager_la_SOURCES)
 DIST_SOURCES = $(libgstrtpmanager_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -230,6 +261,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -278,8 +310,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -360,7 +394,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -420,6 +454,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -493,7 +528,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -578,7 +617,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -586,6 +624,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -601,12 +641,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstrtpmanager.la: $(libgstrtpmanager_la_OBJECTS) $(libgstrtpmanager_la_DEPENDENCIES) $(EXTRA_libgstrtpmanager_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstrtpmanager_la_LINK) -rpath $(plugindir) $(libgstrtpmanager_la_OBJECTS) $(libgstrtpmanager_la_LIBADD) $(LIBS)
 
@@ -781,6 +823,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -929,18 +985,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # these are all the rules generating the relevant files
diff --git a/gst/rtpmanager/gstrtpbin.c b/gst/rtpmanager/gstrtpbin.c
index f843ed2..e78835a 100644
--- a/gst/rtpmanager/gstrtpbin.c
+++ b/gst/rtpmanager/gstrtpbin.c
@@ -243,6 +243,7 @@ enum
 };
 
 #define DEFAULT_LATENCY_MS           200
+#define DEFAULT_DROP_ON_LATENCY      FALSE
 #define DEFAULT_SDES                 NULL
 #define DEFAULT_DO_LOST              FALSE
 #define DEFAULT_IGNORE_PT            FALSE
@@ -257,6 +258,7 @@ enum
 {
   PROP_0,
   PROP_LATENCY,
+  PROP_DROP_ON_LATENCY,
   PROP_SDES,
   PROP_DO_LOST,
   PROP_IGNORE_PT,
@@ -1188,8 +1190,11 @@ gst_rtp_bin_associate (GstRtpBin * bin, GstRtpBinStream * stream, guint8 len,
        * now equating rtptime obtained from RTP-Info,
        * where the large time represent the otherwise irrelevant npt/ntp time */
       stream->rtp_delta = (GST_SECOND << 28) - rtp_clock_base;
+    } else {
+      clock_base = rtp_clock_base;
     }
 
+    all_sync = TRUE;
     for (walk = client->streams; walk; walk = g_slist_next (walk)) {
       GstRtpBinStream *ostream = (GstRtpBinStream *) walk->data;
 
@@ -1215,7 +1220,7 @@ gst_rtp_bin_associate (GstRtpBin * bin, GstRtpBinStream * stream, guint8 len,
 
     /* arrange to re-sync for each stream upon significant change,
      * e.g. post-seek */
-    all_sync = (stream->clock_base == clock_base);
+    all_sync = all_sync && (stream->clock_base == clock_base);
     stream->clock_base = clock_base;
 
     /* may need init performed above later on, but nothing more to do now */
@@ -1433,6 +1438,7 @@ create_stream (GstRtpBinSession * session, guint32 ssrc)
 
   /* configure latency and packet lost */
   g_object_set (buffer, "latency", rtpbin->latency_ms, NULL);
+  g_object_set (buffer, "drop-on-latency", rtpbin->drop_on_latency, NULL);
   g_object_set (buffer, "do-lost", rtpbin->do_lost, NULL);
   g_object_set (buffer, "mode", rtpbin->buffer_mode, NULL);
 
@@ -1584,6 +1590,12 @@ gst_rtp_bin_class_init (GstRtpBinClass * klass)
           G_MAXUINT, DEFAULT_LATENCY_MS,
           G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
+  g_object_class_install_property (gobject_class, PROP_DROP_ON_LATENCY,
+      g_param_spec_boolean ("drop-on-latency",
+          "Drop buffers when maximum latency is reached",
+          "Tells the jitterbuffer to never exceed the given latency in size",
+          DEFAULT_DROP_ON_LATENCY, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
   /**
    * GstRtpBin::request-pt-map:
    * @rtpbin: the object which received the signal
@@ -1888,6 +1900,7 @@ gst_rtp_bin_init (GstRtpBin * rtpbin, GstRtpBinClass * klass)
 
   rtpbin->latency_ms = DEFAULT_LATENCY_MS;
   rtpbin->latency_ns = DEFAULT_LATENCY_MS * GST_MSECOND;
+  rtpbin->drop_on_latency = DEFAULT_DROP_ON_LATENCY;
   rtpbin->do_lost = DEFAULT_DO_LOST;
   rtpbin->ignore_pt = DEFAULT_IGNORE_PT;
   rtpbin->ntp_sync = DEFAULT_NTP_SYNC;
@@ -1994,6 +2007,14 @@ gst_rtp_bin_set_property (GObject * object, guint prop_id,
       /* propagate the property down to the jitterbuffer */
       gst_rtp_bin_propagate_property_to_jitterbuffer (rtpbin, "latency", value);
       break;
+    case PROP_DROP_ON_LATENCY:
+      GST_RTP_BIN_LOCK (rtpbin);
+      rtpbin->drop_on_latency = g_value_get_boolean (value);
+      GST_RTP_BIN_UNLOCK (rtpbin);
+      /* propagate the property down to the jitterbuffer */
+      gst_rtp_bin_propagate_property_to_jitterbuffer (rtpbin,
+          "drop-on-latency", value);
+      break;
     case PROP_SDES:
       gst_rtp_bin_set_sdes_struct (rtpbin, g_value_get_boxed (value));
       break;
@@ -2060,6 +2081,11 @@ gst_rtp_bin_get_property (GObject * object, guint prop_id,
       g_value_set_uint (value, rtpbin->latency_ms);
       GST_RTP_BIN_UNLOCK (rtpbin);
       break;
+    case PROP_DROP_ON_LATENCY:
+      GST_RTP_BIN_LOCK (rtpbin);
+      g_value_set_boolean (value, rtpbin->drop_on_latency);
+      GST_RTP_BIN_UNLOCK (rtpbin);
+      break;
     case PROP_SDES:
       g_value_take_boxed (value, gst_rtp_bin_get_sdes_struct (rtpbin));
       break;
diff --git a/gst/rtpmanager/gstrtpbin.h b/gst/rtpmanager/gstrtpbin.h
index a915787..1734560 100644
--- a/gst/rtpmanager/gstrtpbin.h
+++ b/gst/rtpmanager/gstrtpbin.h
@@ -47,6 +47,7 @@ struct _GstRtpBin {
   /* default latency for sessions */
   guint           latency_ms;
   guint64         latency_ns;
+  gboolean        drop_on_latency;
   gboolean        do_lost;
   gboolean        ignore_pt;
   gboolean        ntp_sync;
diff --git a/gst/rtpmanager/gstrtpsession.c b/gst/rtpmanager/gstrtpsession.c
index cf263e3..f657eb5 100644
--- a/gst/rtpmanager/gstrtpsession.c
+++ b/gst/rtpmanager/gstrtpsession.c
@@ -202,6 +202,7 @@ enum
 #define DEFAULT_NUM_ACTIVE_SOURCES   0
 #define DEFAULT_USE_PIPELINE_CLOCK   FALSE
 #define DEFAULT_RTCP_MIN_INTERVAL    (RTP_STATS_MIN_INTERVAL * GST_SECOND)
+#define DEFAULT_PROBATION            RTP_DEFAULT_PROBATION
 
 enum
 {
@@ -217,6 +218,7 @@ enum
   PROP_INTERNAL_SESSION,
   PROP_USE_PIPELINE_CLOCK,
   PROP_RTCP_MIN_INTERVAL,
+  PROP_PROBATION,
   PROP_LAST
 };
 
@@ -604,6 +606,12 @@ gst_rtp_session_class_init (GstRtpSessionClass * klass)
           0, G_MAXUINT64, DEFAULT_RTCP_MIN_INTERVAL,
           G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
+  g_object_class_install_property (gobject_class, PROP_PROBATION,
+      g_param_spec_uint ("probation", "Number of probations",
+          "Consecutive packet sequence numbers to accept the source",
+          0, G_MAXUINT, DEFAULT_PROBATION,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
   gstelement_class->change_state =
       GST_DEBUG_FUNCPTR (gst_rtp_session_change_state);
   gstelement_class->request_new_pad =
@@ -713,6 +721,9 @@ gst_rtp_session_set_property (GObject * object, guint prop_id,
       g_object_set_property (G_OBJECT (priv->session), "rtcp-min-interval",
           value);
       break;
+    case PROP_PROBATION:
+      g_object_set_property (G_OBJECT (priv->session), "probation", value);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
@@ -769,6 +780,9 @@ gst_rtp_session_get_property (GObject * object, guint prop_id,
       g_object_get_property (G_OBJECT (priv->session), "rtcp-min-interval",
           value);
       break;
+    case PROP_PROBATION:
+      g_object_get_property (G_OBJECT (priv->session), "probation", value);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
@@ -1460,8 +1474,21 @@ gst_rtp_session_event_recv_rtp_src (GstPad * pad, GstEvent * event)
       break;
   }
 
-  if (forward)
-    ret = gst_pad_push_event (rtpsession->recv_rtp_sink, event);
+  if (forward) {
+    GstPad *recv_rtp_sink = NULL;
+    GST_RTP_SESSION_LOCK (rtpsession);
+    if (rtpsession->recv_rtp_sink)
+      recv_rtp_sink = gst_object_ref (rtpsession->recv_rtp_sink);
+    GST_RTP_SESSION_UNLOCK (rtpsession);
+
+    if (recv_rtp_sink) {
+      ret = gst_pad_push_event (recv_rtp_sink, event);
+      gst_object_unref (recv_rtp_sink);
+    } else
+      gst_event_unref (event);
+  } else {
+    gst_event_unref (event);
+  }
 
   gst_object_unref (rtpsession);
 
@@ -1729,8 +1756,10 @@ gst_rtp_session_event_send_rtp_sink (GstPad * pad, GstEvent * event)
           current_time);
       break;
     }
-    default:{
+    default:
+    {
       GstPad *send_rtp_src = NULL;
+
       GST_RTP_SESSION_LOCK (rtpsession);
       if (rtpsession->send_rtp_src)
         send_rtp_src = gst_object_ref (rtpsession->send_rtp_src);
@@ -2187,12 +2216,20 @@ gst_rtp_session_request_key_unit (RTPSession * sess,
     gboolean all_headers, gpointer user_data)
 {
   GstRtpSession *rtpsession = GST_RTP_SESSION (user_data);
-  GstEvent *event;
+  GstPad *send_rtp_sink = NULL;
 
-  event = gst_event_new_custom (GST_EVENT_CUSTOM_UPSTREAM,
-      gst_structure_new ("GstForceKeyUnit",
-          "all-headers", G_TYPE_BOOLEAN, all_headers, NULL));
-  gst_pad_push_event (rtpsession->send_rtp_sink, event);
+  GST_RTP_SESSION_LOCK (rtpsession);
+  if (rtpsession->send_rtp_sink)
+    send_rtp_sink = gst_object_ref (rtpsession->send_rtp_sink);
+  GST_RTP_SESSION_UNLOCK (rtpsession);
+
+  if (send_rtp_sink) {
+    gst_pad_push_event (send_rtp_sink,
+        gst_event_new_custom (GST_EVENT_CUSTOM_UPSTREAM,
+            gst_structure_new ("GstForceKeyUnit",
+                "all-headers", G_TYPE_BOOLEAN, all_headers, NULL)));
+    gst_object_unref (send_rtp_sink);
+  }
 }
 
 static GstClockTime
diff --git a/gst/rtpmanager/gstrtpssrcdemux.c b/gst/rtpmanager/gstrtpssrcdemux.c
index 523f9c5..644034c 100644
--- a/gst/rtpmanager/gstrtpssrcdemux.c
+++ b/gst/rtpmanager/gstrtpssrcdemux.c
@@ -541,6 +541,17 @@ gst_rtp_ssrc_demux_chain (GstPad * pad, GstBuffer * buf)
   /* push to srcpad */
   ret = gst_pad_push (srcpad, buf);
 
+  if (ret != GST_FLOW_OK) {
+    /* check if the ssrc still there, may have been removed */
+    GST_PAD_LOCK (demux);
+    dpad = find_demux_pad_for_ssrc (demux, ssrc);
+    if (dpad == NULL || dpad->rtp_pad != srcpad) {
+      /* SSRC was removed during the push ... ignore the error */
+      ret = GST_FLOW_OK;
+    }
+    GST_PAD_UNLOCK (demux);
+  }
+
   gst_object_unref (srcpad);
 
   return ret;
@@ -606,6 +617,17 @@ gst_rtp_ssrc_demux_rtcp_chain (GstPad * pad, GstBuffer * buf)
   /* push to srcpad */
   ret = gst_pad_push (srcpad, buf);
 
+  if (ret != GST_FLOW_OK) {
+    /* check if the ssrc still there, may have been removed */
+    GST_PAD_LOCK (demux);
+    dpad = find_demux_pad_for_ssrc (demux, ssrc);
+    if (dpad == NULL || dpad->rtcp_pad != srcpad) {
+      /* SSRC was removed during the push ... ignore the error */
+      ret = GST_FLOW_OK;
+    }
+    GST_PAD_UNLOCK (demux);
+  }
+
   gst_object_unref (srcpad);
 
   return ret;
diff --git a/gst/rtpmanager/rtpsession.c b/gst/rtpmanager/rtpsession.c
index 9f15bd6..709614f 100644
--- a/gst/rtpmanager/rtpsession.c
+++ b/gst/rtpmanager/rtpsession.c
@@ -17,6 +17,10 @@
  * Boston, MA 02111-1307, USA.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #include <string.h>
 
 #include <gst/rtp/gstrtpbuffer.h>
@@ -63,6 +67,7 @@ enum
 #define DEFAULT_RTCP_MIN_INTERVAL    (RTP_STATS_MIN_INTERVAL * GST_SECOND)
 #define DEFAULT_RTCP_FEEDBACK_RETENTION_WINDOW (2 * GST_SECOND)
 #define DEFAULT_RTCP_IMMEDIATE_FEEDBACK_THRESHOLD (3)
+#define DEFAULT_PROBATION            RTP_DEFAULT_PROBATION
 
 enum
 {
@@ -82,6 +87,7 @@ enum
   PROP_RTCP_MIN_INTERVAL,
   PROP_RTCP_FEEDBACK_RETENTION_WINDOW,
   PROP_RTCP_IMMEDIATE_FEEDBACK_THRESHOLD,
+  PROP_PROBATION,
   PROP_LAST
 };
 
@@ -505,6 +511,12 @@ rtp_session_class_init (RTPSessionClass * klass)
           0, G_MAXUINT, DEFAULT_RTCP_IMMEDIATE_FEEDBACK_THRESHOLD,
           G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
+  g_object_class_install_property (gobject_class, PROP_PROBATION,
+      g_param_spec_uint ("probation", "Number of probations",
+          "Consecutive packet sequence numbers to accept the source",
+          0, G_MAXUINT, DEFAULT_PROBATION,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
   klass->get_source_by_ssrc =
       GST_DEBUG_FUNCPTR (rtp_session_get_source_by_ssrc);
   klass->on_sending_rtcp = GST_DEBUG_FUNCPTR (rtp_session_on_sending_rtcp);
@@ -555,6 +567,8 @@ rtp_session_init (RTPSession * sess)
   sess->header_len = 28;
   sess->mtu = DEFAULT_RTCP_MTU;
 
+  sess->probation = DEFAULT_PROBATION;
+
   /* some default SDES entries */
 
   /* we do not want to leak details like the username or hostname here */
@@ -682,6 +696,10 @@ rtp_session_set_property (GObject * object, guint prop_id,
     case PROP_RTCP_IMMEDIATE_FEEDBACK_THRESHOLD:
       sess->rtcp_immediate_feedback_threshold = g_value_get_uint (value);
       break;
+    case PROP_PROBATION:
+      sess->probation = g_value_get_uint (value);
+      g_object_set_property (G_OBJECT (sess->source), "probation", value);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
@@ -739,6 +757,10 @@ rtp_session_get_property (GObject * object, guint prop_id,
     case PROP_RTCP_IMMEDIATE_FEEDBACK_THRESHOLD:
       g_value_set_uint (value, sess->rtcp_immediate_feedback_threshold);
       break;
+    case PROP_PROBATION:
+      g_value_set_uint (value, sess->probation);
+      g_object_get_property (G_OBJECT (sess->source), "probation", value);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
@@ -1405,9 +1427,9 @@ obtain_source (RTPSession * sess, guint32 ssrc, gboolean * created,
      * packets of an SSRC, on the other hand, is a strong indication that we
      * are dealing with a valid source. */
     if (rtp)
-      source->probation = RTP_DEFAULT_PROBATION;
+      g_object_set (source, "probation", sess->probation, NULL);
     else
-      source->probation = 0;
+      g_object_set (source, "probation", 0, NULL);
 
     /* store from address, if any */
     if (arrival->have_address) {
@@ -1432,6 +1454,10 @@ obtain_source (RTPSession * sess, guint32 ssrc, gboolean * created,
     if (check_collision (sess, source, arrival, rtp)) {
       return NULL;
     }
+    /* Receiving RTCP packets of an SSRC is a strong indication that we
+     * are dealing with a valid source. */
+    if (!rtp)
+      g_object_set (source, "probation", 0, NULL);
   }
   /* update last activity */
   source->last_activity = arrival->current_time;
@@ -2044,6 +2070,9 @@ rtp_session_process_sdes (RTPSession * sess, GstRTCPPacket * packet,
     validated = !RTP_SOURCE_IS_ACTIVE (source);
     source->validated = TRUE;
 
+    if (created)
+      on_new_ssrc (sess, source);
+
     /* source became active */
     if (validated) {
       sess->stats.active_sources++;
@@ -2052,8 +2081,6 @@ rtp_session_process_sdes (RTPSession * sess, GstRTCPPacket * packet,
       on_ssrc_validated (sess, source);
     }
 
-    if (created)
-      on_new_ssrc (sess, source);
     if (changed)
       on_ssrc_sdes (sess, source);
 
diff --git a/gst/rtpmanager/rtpsession.h b/gst/rtpmanager/rtpsession.h
index ecc0b98..5f68956 100644
--- a/gst/rtpmanager/rtpsession.h
+++ b/gst/rtpmanager/rtpsession.h
@@ -80,7 +80,7 @@ typedef GstFlowReturn (*RTPSessionSendRTP) (RTPSession *sess, RTPSource *src, gp
  *
  * Returns: a #GstFlowReturn.
  */
-typedef GstFlowReturn (*RTPSessionSendRTCP) (RTPSession *sess, RTPSource *src, GstBuffer *buffer, 
+typedef GstFlowReturn (*RTPSessionSendRTCP) (RTPSession *sess, RTPSource *src, GstBuffer *buffer,
     gboolean eos, gpointer user_data);
 
 /**
@@ -114,7 +114,7 @@ typedef gint (*RTPSessionClockRate) (RTPSession *sess, guint8 payload, gpointer
  * @sess: an #RTPSession
  * @user_data: user data specified when registering
  *
- * This callback will be called when @sess needs to cancel the current timeout. 
+ * This callback will be called when @sess needs to cancel the current timeout.
  * The currently running timeout should be canceled and a new reporting interval
  * should be requested from @sess.
  */
@@ -190,6 +190,8 @@ struct _RTPSession {
   guint         header_len;
   guint         mtu;
 
+  guint         probation;
+
   /* bandwidths */
   gboolean     recalc_bandwidth;
   guint        bandwidth;
diff --git a/gst/rtpmanager/rtpsource.c b/gst/rtpmanager/rtpsource.c
index f1ee4ac..4b54263 100644
--- a/gst/rtpmanager/rtpsource.c
+++ b/gst/rtpmanager/rtpsource.c
@@ -39,6 +39,7 @@ enum
 #define DEFAULT_IS_VALIDATED         FALSE
 #define DEFAULT_IS_SENDER            FALSE
 #define DEFAULT_SDES                 NULL
+#define DEFAULT_PROBATION            RTP_DEFAULT_PROBATION
 
 enum
 {
@@ -49,6 +50,7 @@ enum
   PROP_IS_SENDER,
   PROP_SDES,
   PROP_STATS,
+  PROP_PROBATION,
   PROP_LAST
 };
 
@@ -199,6 +201,12 @@ rtp_source_class_init (RTPSourceClass * klass)
           "The stats of this source", GST_TYPE_STRUCTURE,
           G_PARAM_READABLE | G_PARAM_STATIC_STRINGS));
 
+  g_object_class_install_property (gobject_class, PROP_PROBATION,
+      g_param_spec_uint ("probation", "Number of probations",
+          "Consecutive packet sequence numbers to accept the source",
+          0, G_MAXUINT, DEFAULT_PROBATION,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
   GST_DEBUG_CATEGORY_INIT (rtp_source_debug, "rtpsource", 0, "RTP Source");
 }
 
@@ -227,7 +235,8 @@ rtp_source_init (RTPSource * src)
    * packets or a valid RTCP packet */
   src->validated = FALSE;
   src->internal = FALSE;
-  src->probation = RTP_DEFAULT_PROBATION;
+  src->probation = DEFAULT_PROBATION;
+  src->curr_probation = src->probation;
   src->closing = FALSE;
 
   src->sdes = gst_structure_new ("application/x-rtp-source-sdes", NULL);
@@ -448,6 +457,9 @@ rtp_source_set_property (GObject * object, guint prop_id,
     case PROP_SSRC:
       src->ssrc = g_value_get_uint (value);
       break;
+    case PROP_PROBATION:
+      src->probation = g_value_get_uint (value);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
@@ -481,6 +493,9 @@ rtp_source_get_property (GObject * object, guint prop_id,
     case PROP_STATS:
       g_value_take_boxed (value, rtp_source_create_stats (src));
       break;
+    case PROP_PROBATION:
+      g_value_set_uint (value, src->probation);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
@@ -1036,28 +1051,28 @@ rtp_source_process_rtp (RTPSource * src, GstBuffer * buffer,
     /* first time we heard of this source */
     init_seq (src, seqnr);
     src->stats.max_seq = seqnr - 1;
-    src->probation = RTP_DEFAULT_PROBATION;
+    src->curr_probation = src->probation;
   }
 
   udelta = seqnr - stats->max_seq;
 
   /* if we are still on probation, check seqnum */
-  if (src->probation) {
+  if (src->curr_probation) {
     expected = src->stats.max_seq + 1;
 
     /* when in probation, we require consecutive seqnums */
     if (seqnr == expected) {
       /* expected packet */
       GST_DEBUG ("probation: seqnr %d == expected %d", seqnr, expected);
-      src->probation--;
+      src->curr_probation--;
       src->stats.max_seq = seqnr;
-      if (src->probation == 0) {
+      if (src->curr_probation == 0) {
         GST_DEBUG ("probation done!");
         init_seq (src, seqnr);
       } else {
         GstBuffer *q;
 
-        GST_DEBUG ("probation %d: queue buffer", src->probation);
+        GST_DEBUG ("probation %d: queue buffer", src->curr_probation);
         /* when still in probation, keep packets in a list. */
         g_queue_push_tail (src->packets, buffer);
         /* remove packets from queue if there are too many */
@@ -1092,7 +1107,7 @@ rtp_source_process_rtp (RTPSource * src, GstBuffer * buffer,
     }
   } else {
     /* duplicate or reordered packet, will be filtered by jitterbuffer. */
-    GST_WARNING ("duplicate or reordered packet");
+    GST_WARNING ("duplicate or reordered packet (seqnr %d)", seqnr);
   }
 
   src->stats.octets_received += arrival->payload_len;
@@ -1128,7 +1143,7 @@ bad_sequence:
 probation_seqnum:
   {
     GST_WARNING ("probation: seqnr %d != expected %d", seqnr, expected);
-    src->probation = RTP_DEFAULT_PROBATION;
+    src->curr_probation = src->probation;
     src->stats.max_seq = seqnr;
     gst_buffer_unref (buffer);
     return GST_FLOW_OK;
diff --git a/gst/rtpmanager/rtpsource.h b/gst/rtpmanager/rtpsource.h
index fc204ae..2ef941f 100644
--- a/gst/rtpmanager/rtpsource.h
+++ b/gst/rtpmanager/rtpsource.h
@@ -71,7 +71,7 @@ typedef struct _RTPSourceClass RTPSourceClass;
  *
  * Returns: a #GstFlowReturn.
  */
-typedef GstFlowReturn (*RTPSourcePushRTP) (RTPSource *src, GstBuffer *buffer, 
+typedef GstFlowReturn (*RTPSourcePushRTP) (RTPSource *src, GstBuffer *buffer,
 	gpointer user_data);
 
 /**
@@ -126,7 +126,8 @@ struct _RTPSource {
   /*< private >*/
   guint32       ssrc;
 
-  gint          probation;
+  guint         probation;
+  guint         curr_probation;
   gboolean      validated;
   gboolean      internal;
   gboolean      is_csrc;
diff --git a/gst/rtsp/COPYING.MIT b/gst/rtsp/COPYING.MIT
new file mode 100644
index 0000000..6369b6d
--- /dev/null
+++ b/gst/rtsp/COPYING.MIT
@@ -0,0 +1,21 @@
+/*
+ * Unless otherwise indicated, Source Code is licensed under MIT license.
+ *
+ * Permission is hereby granted, free of charge, to any person obtaining a copy of
+ * this software and associated documentation files (the "Software"), to deal in
+ * the Software without restriction, including without limitation the rights to
+ * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
+ * of the Software, and to permit persons to whom the Software is furnished to do
+ * so, subject to the following conditions:
+ *
+ * The above copyright notice and this permission notice shall be included in all
+ * copies or substantial portions of the Software.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
+ * SOFTWARE.
+ */
diff --git a/gst/rtsp/Makefile.in b/gst/rtsp/Makefile.in
index bb7928e..b70ff7c 100644
--- a/gst/rtsp/Makefile.in
+++ b/gst/rtsp/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/rtsp
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -121,10 +137,23 @@ libgstrtsp_la_OBJECTS = $(am_libgstrtsp_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstrtsp_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstrtsp_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstrtsp_la_CFLAGS) $(CFLAGS) \
 	$(libgstrtsp_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -137,22 +166,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstrtsp_la_SOURCES)
 DIST_SOURCES = $(libgstrtsp_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -212,6 +242,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -260,8 +291,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -342,7 +375,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -402,6 +435,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -475,7 +509,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -532,7 +570,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -540,6 +577,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -555,12 +594,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstrtsp.la: $(libgstrtsp_la_OBJECTS) $(libgstrtsp_la_DEPENDENCIES) $(EXTRA_libgstrtsp_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstrtsp_la_LINK) -rpath $(plugindir) $(libgstrtsp_la_OBJECTS) $(libgstrtsp_la_LIBADD) $(LIBS)
 
@@ -679,6 +720,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -823,18 +878,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/rtsp/URLS b/gst/rtsp/URLS
new file mode 100644
index 0000000..26b4008
--- /dev/null
+++ b/gst/rtsp/URLS
@@ -0,0 +1,38 @@
+Some test URLS:
+
+SVQ3 video: 
+  rtsp://cumulus.creative.auckland.ac.nz/~shado/nelson_iv_512k.mov
+  rtsp://streamr.hitpops.jp/ngc/mov/m0609.mov 
+
+ASF (audio/video): 
+  rtsp://aod.mylisten.com/aod/8/03/069803_0903135.wma
+  rtsp://195.246.8.69/dur_pull_hi
+  rtsp://195.219.160.200/mcp?chid=25&pid=196&vid=2402201&br=800&tid=1&void=2844&muk=H1J4yFr0mJB
+  rtsp://a1174.v26630f.c26630.g.vm.akamaistream.net/7/1174/26630/361/od-video.msn.com/8/mbr/rs_perf_dilana_091206_finale9135.wmv
+
+MP4V-ES/mpeg4-generic(ACC):
+  rtsp://vod.nwec.jp/quicktime/505.mov
+  rtsp://203.140.68.241:554/hirakataeizou9.mp4
+  rtsp://kmdi.utoronto.ca:555/osconf/2004_may9.1.mp4
+
+X-QT(h264)/mpeg4-generic(ACC):
+  rtsp://a2047.v1413b.c1413.g.vq.akamaistream.net/5/2047/1413/1_h264_110/1a1a1ae656c632970267e04ebd3196c428970e7ce857b81c4aab1677e445aedc3fae1b4a7bafe013/8848125_1_110.mov
+
+MP4V-ES/MP4A-LATM
+  rtsp://68.251.168.13/thisislove.3gp
+
+H264/MPA
+  rtsp://130.192.86.166/ed.mov
+
+REAL:
+  rtsp://213.254.239.61/farm/*/encoder/tagesschau/live1high.rm
+  rtsp://64.192.137.105:554/real.amazon-de.eu2/phononet/B/0/0/0/H/W/Y/4/K/S/01.01.rm?cloakport=80,554,7070
+
+  rtsp://211.89.225.1/encoder/cnr7_p
+  rtsp://stream2.visual.cz/broadcast/ct/CT24-High.rm
+
+AAC, interleaved:
+  rtsp://ia300135.us.archive.org:554/0/items/uncovered_interviews/uncovered_interviews_3_256kb.mp4
+
+Various samples here:
+  http://www.jet-stream.nl/samples/mp4.html
diff --git a/gst/rtsp/gstrtspsrc.c b/gst/rtsp/gstrtspsrc.c
index de14225..b6e313c 100644
--- a/gst/rtsp/gstrtspsrc.c
+++ b/gst/rtsp/gstrtspsrc.c
@@ -175,9 +175,11 @@ gst_rtsp_src_buffer_mode_get_type (void)
 #define DEFAULT_UDP_BUFFER_SIZE  0x80000
 #define DEFAULT_TCP_TIMEOUT      20000000
 #define DEFAULT_LATENCY_MS       2000
+#define DEFAULT_DROP_ON_LATENCY  FALSE
 #define DEFAULT_CONNECTION_SPEED 0
 #define DEFAULT_NAT_METHOD       GST_RTSP_NAT_DUMMY
 #define DEFAULT_DO_RTCP          TRUE
+#define DEFAULT_DO_RTSP_KEEP_ALIVE       TRUE
 #define DEFAULT_PROXY            NULL
 #define DEFAULT_RTP_BLOCKSIZE    0
 #define DEFAULT_USER_ID          NULL
@@ -185,6 +187,7 @@ gst_rtsp_src_buffer_mode_get_type (void)
 #define DEFAULT_BUFFER_MODE      BUFFER_MODE_AUTO
 #define DEFAULT_PORT_RANGE       NULL
 #define DEFAULT_SHORT_HEADER     FALSE
+#define DEFAULT_PROBATION        2
 
 enum
 {
@@ -196,9 +199,11 @@ enum
   PROP_TIMEOUT,
   PROP_TCP_TIMEOUT,
   PROP_LATENCY,
+  PROP_DROP_ON_LATENCY,
   PROP_CONNECTION_SPEED,
   PROP_NAT_METHOD,
   PROP_DO_RTCP,
+  PROP_DO_RTSP_KEEP_ALIVE,
   PROP_PROXY,
   PROP_RTP_BLOCKSIZE,
   PROP_USER_ID,
@@ -207,6 +212,7 @@ enum
   PROP_PORT_RANGE,
   PROP_UDP_BUFFER_SIZE,
   PROP_SHORT_HEADER,
+  PROP_PROBATION,
   PROP_LAST
 };
 
@@ -383,6 +389,12 @@ gst_rtspsrc_class_init (GstRTSPSrcClass * klass)
           "Amount of ms to buffer", 0, G_MAXUINT, DEFAULT_LATENCY_MS,
           G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
+  g_object_class_install_property (gobject_class, PROP_DROP_ON_LATENCY,
+      g_param_spec_boolean ("drop-on-latency",
+          "Drop buffers when maximum latency is reached",
+          "Tells the jitterbuffer to never exceed the given latency in size",
+          DEFAULT_DROP_ON_LATENCY, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
   g_object_class_install_property (gobject_class, PROP_CONNECTION_SPEED,
       g_param_spec_uint ("connection-speed", "Connection Speed",
           "Network connection speed in kbps (0 = unknown)",
@@ -409,6 +421,20 @@ gst_rtspsrc_class_init (GstRTSPSrcClass * klass)
           DEFAULT_DO_RTCP, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
   /**
+   * GstRTSPSrc::do-rtsp-keep-alive
+   *
+   * Enable RTSP keep laive support. Some old server don't like RTSP
+   * keep alive and then this property needs to be set to FALSE.
+   *
+   * Since: 0.10.32
+   */
+  g_object_class_install_property (gobject_class, PROP_DO_RTSP_KEEP_ALIVE,
+      g_param_spec_boolean ("do-rtsp-keep-alive", "Do RTSP Keep Alive",
+          "Send RTSP keep alive packets, disable for old incompatible server.",
+          DEFAULT_DO_RTSP_KEEP_ALIVE,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
+  /**
    * GstRTSPSrc::proxy
    *
    * Set the proxy parameters. This has to be a string of the format
@@ -496,6 +522,12 @@ gst_rtspsrc_class_init (GstRTSPSrcClass * klass)
           "Only send the basic RTSP headers for broken encoders",
           DEFAULT_SHORT_HEADER, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
+  g_object_class_install_property (gobject_class, PROP_PROBATION,
+      g_param_spec_uint ("probation", "Number of probations",
+          "Consecutive packet sequence numbers to accept the source",
+          0, G_MAXUINT, DEFAULT_PROBATION,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
   gstelement_class->send_event = gst_rtspsrc_send_event;
   gstelement_class->change_state = gst_rtspsrc_change_state;
 
@@ -523,9 +555,11 @@ gst_rtspsrc_init (GstRTSPSrc * src, GstRTSPSrcClass * g_class)
   src->udp_timeout = DEFAULT_TIMEOUT;
   gst_rtspsrc_set_tcp_timeout (src, DEFAULT_TCP_TIMEOUT);
   src->latency = DEFAULT_LATENCY_MS;
+  src->drop_on_latency = DEFAULT_DROP_ON_LATENCY;
   src->connection_speed = DEFAULT_CONNECTION_SPEED;
   src->nat_method = DEFAULT_NAT_METHOD;
   src->do_rtcp = DEFAULT_DO_RTCP;
+  src->do_rtsp_keep_alive = DEFAULT_DO_RTSP_KEEP_ALIVE;
   gst_rtspsrc_set_proxy (src, DEFAULT_PROXY);
   src->rtp_blocksize = DEFAULT_RTP_BLOCKSIZE;
   src->user_id = g_strdup (DEFAULT_USER_ID);
@@ -535,6 +569,7 @@ gst_rtspsrc_init (GstRTSPSrc * src, GstRTSPSrcClass * g_class)
   src->client_port_range.max = 0;
   src->udp_buffer_size = DEFAULT_UDP_BUFFER_SIZE;
   src->short_header = DEFAULT_SHORT_HEADER;
+  src->probation = DEFAULT_PROBATION;
 
   /* get a list of all extensions */
   src->extensions = gst_rtsp_ext_list_get ();
@@ -683,6 +718,9 @@ gst_rtspsrc_set_property (GObject * object, guint prop_id, const GValue * value,
     case PROP_LATENCY:
       rtspsrc->latency = g_value_get_uint (value);
       break;
+    case PROP_DROP_ON_LATENCY:
+      rtspsrc->drop_on_latency = g_value_get_boolean (value);
+      break;
     case PROP_CONNECTION_SPEED:
       rtspsrc->connection_speed = g_value_get_uint (value);
       break;
@@ -692,6 +730,9 @@ gst_rtspsrc_set_property (GObject * object, guint prop_id, const GValue * value,
     case PROP_DO_RTCP:
       rtspsrc->do_rtcp = g_value_get_boolean (value);
       break;
+    case PROP_DO_RTSP_KEEP_ALIVE:
+      rtspsrc->do_rtsp_keep_alive = g_value_get_boolean (value);
+      break;
     case PROP_PROXY:
       gst_rtspsrc_set_proxy (rtspsrc, g_value_get_string (value));
       break;
@@ -731,6 +772,9 @@ gst_rtspsrc_set_property (GObject * object, guint prop_id, const GValue * value,
     case PROP_SHORT_HEADER:
       rtspsrc->short_header = g_value_get_boolean (value);
       break;
+    case PROP_PROBATION:
+      rtspsrc->probation = g_value_get_uint (value);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
@@ -773,6 +817,9 @@ gst_rtspsrc_get_property (GObject * object, guint prop_id, GValue * value,
     case PROP_LATENCY:
       g_value_set_uint (value, rtspsrc->latency);
       break;
+    case PROP_DROP_ON_LATENCY:
+      g_value_set_boolean (value, rtspsrc->drop_on_latency);
+      break;
     case PROP_CONNECTION_SPEED:
       g_value_set_uint (value, rtspsrc->connection_speed);
       break;
@@ -782,6 +829,9 @@ gst_rtspsrc_get_property (GObject * object, guint prop_id, GValue * value,
     case PROP_DO_RTCP:
       g_value_set_boolean (value, rtspsrc->do_rtcp);
       break;
+    case PROP_DO_RTSP_KEEP_ALIVE:
+      g_value_set_boolean (value, rtspsrc->do_rtsp_keep_alive);
+      break;
     case PROP_PROXY:
     {
       gchar *str;
@@ -826,6 +876,9 @@ gst_rtspsrc_get_property (GObject * object, guint prop_id, GValue * value,
     case PROP_SHORT_HEADER:
       g_value_set_boolean (value, rtspsrc->short_header);
       break;
+    case PROP_PROBATION:
+      g_value_set_uint (value, rtspsrc->probation);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
@@ -1712,7 +1765,7 @@ gst_rtspsrc_flush (GstRTSPSrc * src, gboolean flush, gboolean playing)
     }
   }
   gst_rtspsrc_push_event (src, event, FALSE);
-  gst_rtspsrc_loop_send_cmd (src, cmd, flush);
+  gst_rtspsrc_loop_send_cmd (src, cmd, FALSE);
 
   /* set up manager before data-flow resumes */
   /* to manage jitterbuffer buffer mode */
@@ -1891,6 +1944,7 @@ gst_rtspsrc_perform_seek (GstRTSPSrc * src, GstEvent * event)
     gst_rtspsrc_get_position (src);
     gst_rtspsrc_pause (src, FALSE, FALSE);
   }
+  src->skip = skip;
 
   gst_rtspsrc_do_seek (src, &seeksegment);
 
@@ -1951,7 +2005,6 @@ gst_rtspsrc_perform_seek (GstRTSPSrc * src, GstEvent * event)
     GstRTSPStream *stream = (GstRTSPStream *) walk->data;
     stream->discont = TRUE;
   }
-  src->skip = skip;
 
   GST_RTSP_STREAM_UNLOCK (src);
 
@@ -2249,6 +2302,9 @@ new_manager_pad (GstElement * manager, GstPad * pad, GstRTSPSrc * src)
   if (stream == NULL)
     goto unknown_stream;
 
+  /* save SSRC */
+  stream->ssrc = ssrc;
+
   /* create a new pad we will use to stream to */
   template = gst_static_pad_template_get (&rtptemplate);
   stream->srcpad = gst_ghost_pad_new_from_template (name, pad, template);
@@ -2349,20 +2405,30 @@ static void
 on_bye_ssrc (GObject * session, GObject * source, GstRTSPStream * stream)
 {
   GstRTSPSrc *src = stream->parent;
+  guint ssrc;
 
-  GST_DEBUG_OBJECT (src, "source in session %u received BYE", stream->id);
+  g_object_get (source, "ssrc", &ssrc, NULL);
 
-  gst_rtspsrc_do_stream_eos (src, stream);
+  GST_DEBUG_OBJECT (src, "source %08x, stream %08x, session %u received BYE",
+      ssrc, stream->ssrc, stream->id);
+
+  if (ssrc == stream->ssrc)
+    gst_rtspsrc_do_stream_eos (src, stream);
 }
 
 static void
 on_timeout (GObject * session, GObject * source, GstRTSPStream * stream)
 {
   GstRTSPSrc *src = stream->parent;
+  guint ssrc;
+
+  g_object_get (source, "ssrc", &ssrc, NULL);
 
-  GST_DEBUG_OBJECT (src, "source in session %u timed out", stream->id);
+  GST_WARNING_OBJECT (src, "source %08x, stream %08x in session %u timed out",
+      ssrc, stream->ssrc, stream->id);
 
-  gst_rtspsrc_do_stream_eos (src, stream);
+  if (ssrc == stream->ssrc)
+    gst_rtspsrc_do_stream_eos (src, stream);
 }
 
 static void
@@ -2433,6 +2499,11 @@ gst_rtspsrc_stream_configure_manager (GstRTSPSrc * src, GstRTSPStream * stream,
       g_object_set (src->manager, "latency", src->latency, NULL);
 
       klass = G_OBJECT_GET_CLASS (G_OBJECT (src->manager));
+      if (g_object_class_find_property (klass, "drop-on-latency")) {
+        g_object_set (src->manager, "drop-on-latency", src->drop_on_latency,
+            NULL);
+      }
+
       if (g_object_class_find_property (klass, "buffer-mode")) {
         if (src->buffer_mode != BUFFER_MODE_AUTO) {
           g_object_set (src->manager, "buffer-mode", src->buffer_mode, NULL);
@@ -2518,6 +2589,9 @@ gst_rtspsrc_stream_configure_manager (GstRTSPSrc * src, GstRTSPStream * stream,
           g_object_set (rtpsession, "rtcp-rs-bandwidth", stream->rs_bandwidth,
               NULL);
         }
+
+        g_object_set (rtpsession, "probation", src->probation, NULL);
+
         g_signal_connect (rtpsession, "on-bye-ssrc", (GCallback) on_bye_ssrc,
             stream);
         g_signal_connect (rtpsession, "on-bye-timeout", (GCallback) on_timeout,
@@ -2747,6 +2821,10 @@ gst_rtspsrc_stream_configure_mcast (GstRTSPSrc * src, GstRTSPStream * stream,
     gst_object_ref (stream->udpsrc[0]);
     gst_object_sink (stream->udpsrc[0]);
 
+    if (src->udp_buffer_size != 0)
+      g_object_set (G_OBJECT (stream->udpsrc[0]), "buffer-size",
+          src->udp_buffer_size, NULL);
+
     /* change state */
     gst_element_set_state (stream->udpsrc[0], GST_STATE_PAUSED);
   }
@@ -3485,6 +3563,12 @@ gst_rtspsrc_send_keep_alive (GstRTSPSrc * src)
   GstRTSPMethod method;
   gchar *control;
 
+  if (src->do_rtsp_keep_alive == FALSE) {
+    GST_DEBUG_OBJECT (src, "do-rtsp-keep-alive is FALSE, not sending.");
+    gst_rtsp_connection_reset_timeout (src->conninfo.connection);
+    return GST_RTSP_OK;
+  }
+
   GST_DEBUG_OBJECT (src, "creating server keep-alive");
 
   /* find a method to use for keep-alive */
@@ -3836,7 +3920,11 @@ gst_rtspsrc_loop_udp (GstRTSPSrc * src)
           goto connect_error;
 
         continue;
+      case GST_RTSP_ENET:
+        GST_DEBUG_OBJECT (src, "An ethernet problem occured.");
       default:
+        GST_ELEMENT_WARNING (src, RESOURCE, READ, (NULL),
+            ("Unhandled return value %d.", res));
         goto receive_error;
     }
 
@@ -3995,17 +4083,17 @@ no_protocols:
         ("Could not receive any UDP packets for %.4f seconds, maybe your "
             "firewall is blocking it. No other protocols to try.",
             gst_guint64_to_gdouble (src->udp_timeout / 1000000.0)));
-    return GST_FLOW_ERROR;
+    return GST_RTSP_ERROR;
   }
 open_failed:
   {
     GST_DEBUG_OBJECT (src, "open failed");
-    return GST_FLOW_OK;
+    return GST_RTSP_OK;
   }
 play_failed:
   {
     GST_DEBUG_OBJECT (src, "play failed");
-    return GST_FLOW_OK;
+    return GST_RTSP_OK;
   }
 }
 
@@ -4109,8 +4197,6 @@ gst_rtspsrc_loop_send_cmd (GstRTSPSrc * src, gint cmd, gboolean flush)
 {
   gint old;
 
-  /* FIXME flush param mute; remove at discretion */
-
   /* start new request */
   gst_rtspsrc_loop_start_cmd (src, cmd);
 
@@ -4127,7 +4213,7 @@ gst_rtspsrc_loop_send_cmd (GstRTSPSrc * src, gint cmd, gboolean flush)
   }
   src->loop_cmd = cmd;
   /* interrupt if allowed */
-  if (src->waiting) {
+  if (src->waiting || flush) {
     GST_DEBUG_OBJECT (src, "start connection flush");
     gst_rtspsrc_connection_flush (src, TRUE);
   }
@@ -5553,6 +5639,7 @@ gst_rtspsrc_open_from_sdp (GstRTSPSrc * src, GstSDPMessage * sdp,
 setup_failed:
   {
     GST_ERROR_OBJECT (src, "setup failed");
+    gst_rtspsrc_cleanup (src);
     return res;
   }
 }
@@ -6107,8 +6194,23 @@ gst_rtspsrc_play (GstRTSPSrc * src, GstSegment * segment, gboolean async)
    * only in async case, since receive elements may not have been affected
    * by overall state change (e.g. not around yet),
    * do not mess with state in sync case (e.g. seeking) */
-  if (async)
-    gst_element_set_state (GST_ELEMENT_CAST (src), GST_STATE_PLAYING);
+  if (async) {
+    /* state change might be happening in the application thread. A
+     * specific case is when chaging state to NULL where we will wait
+     * for this task to finish (gst_rtspsrc_stop). However this task
+     * will try to change the state to PLAYING causing a deadlock. */
+
+    /* make sure we are not in the middle of a state change. The
+     * state lock is a recursive lock so it's safe to lock twice from
+     * the same thread */
+    if (GST_STATE_TRYLOCK (src)) {
+      gst_element_set_state (GST_ELEMENT_CAST (src), GST_STATE_PLAYING);
+      GST_STATE_UNLOCK (src);
+    } else {
+      res = GST_RTSP_ERROR;
+      goto changing_state;
+    }
+  }
 
   /* construct a control url */
   if (src->control)
@@ -6265,6 +6367,11 @@ was_playing:
     GST_DEBUG_OBJECT (src, "we were already PLAYING");
     goto done;
   }
+changing_state:
+  {
+    GST_DEBUG_OBJECT (src, "failed going to PLAYING, already changing state");
+    goto done;
+  }
 create_request_failed:
   {
     gchar *str = gst_rtsp_strresult (res);
@@ -6438,7 +6545,7 @@ gst_rtspsrc_handle_message (GstBin * bin, GstMessage * message)
         /* we only act on the first udp timeout message, others are irrelevant
          * and can be ignored. */
         if (!ignore_timeout)
-          gst_rtspsrc_loop_send_cmd (rtspsrc, CMD_RECONNECT, TRUE);
+          gst_rtspsrc_loop_send_cmd (rtspsrc, CMD_RECONNECT, FALSE);
         /* eat and free */
         gst_message_unref (message);
         return;
@@ -6642,7 +6749,7 @@ gst_rtspsrc_change_state (GstElement * element, GstStateChange transition)
     case GST_STATE_CHANGE_PAUSED_TO_PLAYING:
     case GST_STATE_CHANGE_PLAYING_TO_PAUSED:
       /* unblock the tcp tasks and make the loop waiting */
-      gst_rtspsrc_loop_send_cmd (rtspsrc, CMD_WAIT, TRUE);
+      gst_rtspsrc_loop_send_cmd (rtspsrc, CMD_WAIT, FALSE);
       break;
     case GST_STATE_CHANGE_PAUSED_TO_READY:
       break;
diff --git a/gst/rtsp/gstrtspsrc.h b/gst/rtsp/gstrtspsrc.h
index cf8f81c..ba7d045 100644
--- a/gst/rtsp/gstrtspsrc.h
+++ b/gst/rtsp/gstrtspsrc.h
@@ -201,9 +201,11 @@ struct _GstRTSPSrc {
   GTimeVal          tcp_timeout;
   GTimeVal         *ptcp_timeout;
   guint             latency;
+  gboolean          drop_on_latency;
   guint             connection_speed;
   GstRTSPNatMethod  nat_method;
   gboolean          do_rtcp;
+  gboolean          do_rtsp_keep_alive;
   gchar            *proxy_host;
   guint             proxy_port;
   gchar            *proxy_user;
@@ -215,6 +217,7 @@ struct _GstRTSPSrc {
   GstRTSPRange      client_port_range;
   gint              udp_buffer_size;
   gboolean          short_header;
+  guint             probation;
 
   /* state */
   GstRTSPState       state;
diff --git a/gst/shapewipe/Makefile.am b/gst/shapewipe/Makefile.am
index 35cf5df..2119d12 100644
--- a/gst/shapewipe/Makefile.am
+++ b/gst/shapewipe/Makefile.am
@@ -2,8 +2,8 @@ plugin_LTLIBRARIES = libgstshapewipe.la
 
 libgstshapewipe_la_SOURCES = gstshapewipe.c
 
-libgstshapewipe_la_CFLAGS = $(GIO_CFLAGS) $(GST_CFLAGS) $(GST_CONTROLLER_CFLAGS) $(GST_PLUGINS_BASE_CFLAGS)
-libgstshapewipe_la_LIBADD = $(GIO_LIBS) $(GST_LIBS) $(GST_CONTROLLER_LIBS) $(GST_PLUGINS_BASE_LIBS) -lgstvideo-@GST_MAJORMINOR@
+libgstshapewipe_la_CFLAGS = $(GST_PLUGINS_BASE_CFLAGS) $(GST_CONTROLLER_CFLAGS) $(GST_CFLAGS)
+libgstshapewipe_la_LIBADD = $(GST_PLUGINS_BASE_LIBS) -lgstvideo-@GST_MAJORMINOR@ $(GST_CONTROLLER_LIBS) $(GST_LIBS)
 libgstshapewipe_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS)
 libgstshapewipe_la_LIBTOOLFLAGS = --tag=disable-static
 
diff --git a/gst/shapewipe/Makefile.in b/gst/shapewipe/Makefile.in
index 8de2d57..3c2d23c 100644
--- a/gst/shapewipe/Makefile.in
+++ b/gst/shapewipe/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/shapewipe
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -112,17 +128,29 @@ am__installdirs = "$(DESTDIR)$(plugindir)"
 LTLIBRARIES = $(plugin_LTLIBRARIES)
 am__DEPENDENCIES_1 =
 libgstshapewipe_la_DEPENDENCIES = $(am__DEPENDENCIES_1) \
-	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
-	$(am__DEPENDENCIES_1)
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
 am_libgstshapewipe_la_OBJECTS = libgstshapewipe_la-gstshapewipe.lo
 libgstshapewipe_la_OBJECTS = $(am_libgstshapewipe_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstshapewipe_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstshapewipe_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstshapewipe_la_CFLAGS) $(CFLAGS) \
 	$(libgstshapewipe_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -135,22 +163,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstshapewipe_la_SOURCES)
 DIST_SOURCES = $(libgstshapewipe_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -210,6 +239,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -258,8 +288,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -340,7 +372,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -400,6 +432,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -473,14 +506,18 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
 plugin_LTLIBRARIES = libgstshapewipe.la
 libgstshapewipe_la_SOURCES = gstshapewipe.c
-libgstshapewipe_la_CFLAGS = $(GIO_CFLAGS) $(GST_CFLAGS) $(GST_CONTROLLER_CFLAGS) $(GST_PLUGINS_BASE_CFLAGS)
-libgstshapewipe_la_LIBADD = $(GIO_LIBS) $(GST_LIBS) $(GST_CONTROLLER_LIBS) $(GST_PLUGINS_BASE_LIBS) -lgstvideo-@GST_MAJORMINOR@
+libgstshapewipe_la_CFLAGS = $(GST_PLUGINS_BASE_CFLAGS) $(GST_CONTROLLER_CFLAGS) $(GST_CFLAGS)
+libgstshapewipe_la_LIBADD = $(GST_PLUGINS_BASE_LIBS) -lgstvideo-@GST_MAJORMINOR@ $(GST_CONTROLLER_LIBS) $(GST_LIBS)
 libgstshapewipe_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS)
 libgstshapewipe_la_LIBTOOLFLAGS = --tag=disable-static
 noinst_HEADERS = gstshapewipe.h
@@ -520,7 +557,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -528,6 +564,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -543,12 +581,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstshapewipe.la: $(libgstshapewipe_la_OBJECTS) $(libgstshapewipe_la_DEPENDENCIES) $(EXTRA_libgstshapewipe_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstshapewipe_la_LINK) -rpath $(plugindir) $(libgstshapewipe_la_OBJECTS) $(libgstshapewipe_la_LIBADD) $(LIBS)
 
@@ -643,6 +683,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -787,18 +841,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/smpte/Makefile.in b/gst/smpte/Makefile.in
index e6ceb90..8d11e43 100644
--- a/gst/smpte/Makefile.in
+++ b/gst/smpte/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/smpte
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -122,10 +138,23 @@ libgstsmpte_la_OBJECTS = $(am_libgstsmpte_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstsmpte_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstsmpte_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstsmpte_la_CFLAGS) $(CFLAGS) \
 	$(libgstsmpte_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -138,22 +167,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstsmpte_la_SOURCES)
 DIST_SOURCES = $(libgstsmpte_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -213,6 +243,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -261,8 +292,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -343,7 +376,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -403,6 +436,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -476,7 +510,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -526,7 +564,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -534,6 +571,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -549,12 +588,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstsmpte.la: $(libgstsmpte_la_OBJECTS) $(libgstsmpte_la_DEPENDENCIES) $(EXTRA_libgstsmpte_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstsmpte_la_LINK) -rpath $(plugindir) $(libgstsmpte_la_OBJECTS) $(libgstsmpte_la_LIBADD) $(LIBS)
 
@@ -689,6 +730,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -833,18 +888,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/smpte/gstsmpte.c b/gst/smpte/gstsmpte.c
index 4b21cd0..294d68f 100644
--- a/gst/smpte/gstsmpte.c
+++ b/gst/smpte/gstsmpte.c
@@ -152,7 +152,7 @@ static void gst_smpte_base_init (GstSMPTEClass * klass);
 static void gst_smpte_init (GstSMPTE * smpte);
 static void gst_smpte_finalize (GstSMPTE * smpte);
 
-static GstFlowReturn gst_smpte_collected (GstCollectPads * pads,
+static GstFlowReturn gst_smpte_collected (GstCollectPads2 * pads,
     GstSMPTE * smpte);
 
 static void gst_smpte_set_property (GObject * object, guint prop_id,
@@ -360,15 +360,14 @@ gst_smpte_init (GstSMPTE * smpte)
       gst_pad_new_from_static_template (&gst_smpte_src_template, "src");
   gst_element_add_pad (GST_ELEMENT (smpte), smpte->srcpad);
 
-  smpte->collect = gst_collect_pads_new ();
-  gst_collect_pads_set_function (smpte->collect,
-      (GstCollectPadsFunction) GST_DEBUG_FUNCPTR (gst_smpte_collected), smpte);
-  gst_collect_pads_start (smpte->collect);
+  smpte->collect = gst_collect_pads2_new ();
+  gst_collect_pads2_set_function (smpte->collect,
+      (GstCollectPads2Function) GST_DEBUG_FUNCPTR (gst_smpte_collected), smpte);
 
-  gst_collect_pads_add_pad (smpte->collect, smpte->sinkpad1,
-      sizeof (GstCollectData));
-  gst_collect_pads_add_pad (smpte->collect, smpte->sinkpad2,
-      sizeof (GstCollectData));
+  gst_collect_pads2_add_pad (smpte->collect, smpte->sinkpad1,
+      sizeof (GstCollectData2));
+  gst_collect_pads2_add_pad (smpte->collect, smpte->sinkpad2,
+      sizeof (GstCollectData2));
 
   smpte->fps = DEFAULT_PROP_FPS;
   smpte->type = DEFAULT_PROP_TYPE;
@@ -408,8 +407,7 @@ gst_smpte_blend_i420 (guint8 * in1, guint8 * in2, guint8 * out, GstMask * mask,
   gint i, j;
   gint min, max;
   guint8 *in1u, *in1v, *in2u, *in2v, *outu, *outv;
-  gint lumsize = width * height;
-  gint chromsize = lumsize >> 2;
+  gint uoffset, voffset, ystr, ustr, vstr;
 
   if (border == 0)
     border++;
@@ -417,12 +415,19 @@ gst_smpte_blend_i420 (guint8 * in1, guint8 * in2, guint8 * out, GstMask * mask,
   min = pos - border;
   max = pos;
 
-  in1u = in1 + lumsize;
-  in1v = in1u + chromsize;
-  in2u = in2 + lumsize;
-  in2v = in2u + chromsize;
-  outu = out + lumsize;
-  outv = outu + chromsize;
+  uoffset = I420_U_OFFSET (width, height);
+  voffset = I420_V_OFFSET (width, height);
+
+  ystr = I420_Y_ROWSTRIDE (width);
+  ustr = I420_U_ROWSTRIDE (width);
+  vstr = I420_V_ROWSTRIDE (width);
+
+  in1u = in1 + uoffset;
+  in1v = in1 + voffset;
+  in2u = in2 + uoffset;
+  in2v = in2 + voffset;
+  outu = out + uoffset;
+  outv = out + voffset;
 
   maskp = mask->data;
 
@@ -431,17 +436,30 @@ gst_smpte_blend_i420 (guint8 * in1, guint8 * in2, guint8 * out, GstMask * mask,
       value = *maskp++;
       value = ((CLAMP (value, min, max) - min) << 8) / border;
 
-      *out++ = ((*in1++ * value) + (*in2++ * (256 - value))) >> 8;
+      out[j] = ((in1[j] * value) + (in2[j] * (256 - value))) >> 8;
       if (!(i & 1) && !(j & 1)) {
-        *outu++ = ((*in1u++ * value) + (*in2u++ * (256 - value))) >> 8;
-        *outv++ = ((*in1v++ * value) + (*in2v++ * (256 - value))) >> 8;
+        outu[j / 2] =
+            ((in1u[j / 2] * value) + (in2u[j / 2] * (256 - value))) >> 8;
+        outv[j / 2] =
+            ((in1v[j / 2] * value) + (in2v[j / 2] * (256 - value))) >> 8;
       }
     }
+    out += ystr;
+    in1 += ystr;
+    in2 += ystr;
+    if (!(i & 1)) {
+      outu += ustr;
+      in1u += ustr;
+      in2u += ustr;
+      outv += vstr;
+      in1v += vstr;
+      in2v += vstr;
+    }
   }
 }
 
 static GstFlowReturn
-gst_smpte_collected (GstCollectPads * pads, GstSMPTE * smpte)
+gst_smpte_collected (GstCollectPads2 * pads, GstSMPTE * smpte)
 {
   GstBuffer *outbuf;
   GstClockTime ts;
@@ -458,14 +476,14 @@ gst_smpte_collected (GstCollectPads * pads, GstSMPTE * smpte)
       smpte->fps_denom, smpte->fps_num);
 
   for (collected = pads->data; collected; collected = g_slist_next (collected)) {
-    GstCollectData *data;
+    GstCollectData2 *data;
 
-    data = (GstCollectData *) collected->data;
+    data = (GstCollectData2 *) collected->data;
 
     if (data->pad == smpte->sinkpad1)
-      in1 = gst_collect_pads_pop (pads, data);
+      in1 = gst_collect_pads2_pop (pads, data);
     else if (data->pad == smpte->sinkpad2)
-      in2 = gst_collect_pads_pop (pads, data);
+      in2 = gst_collect_pads2_pop (pads, data);
   }
 
   if (in1 == NULL) {
@@ -623,11 +641,11 @@ gst_smpte_change_state (GstElement * element, GstStateChange transition)
     case GST_STATE_CHANGE_READY_TO_PAUSED:
       gst_smpte_reset (smpte);
       GST_LOG_OBJECT (smpte, "starting collectpads");
-      gst_collect_pads_start (smpte->collect);
+      gst_collect_pads2_start (smpte->collect);
       break;
     case GST_STATE_CHANGE_PAUSED_TO_READY:
       GST_LOG_OBJECT (smpte, "stopping collectpads");
-      gst_collect_pads_stop (smpte->collect);
+      gst_collect_pads2_stop (smpte->collect);
       break;
     default:
       break;
diff --git a/gst/smpte/gstsmpte.h b/gst/smpte/gstsmpte.h
index dc6bc6d..ac138f4 100644
--- a/gst/smpte/gstsmpte.h
+++ b/gst/smpte/gstsmpte.h
@@ -22,7 +22,7 @@
 #define __GST_SMPTE_H__
 
 #include <gst/gst.h>
-#include <gst/base/gstcollectpads.h>
+#include <gst/base/gstcollectpads2.h>
 
 G_BEGIN_DECLS
 
@@ -49,7 +49,7 @@ struct _GstSMPTE {
   GstPad        *srcpad,
                 *sinkpad1,
                 *sinkpad2;
-  GstCollectPads *collect;
+  GstCollectPads2 *collect;
 
   /* properties */
   gint           type;
diff --git a/gst/spectrum/Makefile.in b/gst/spectrum/Makefile.in
index d667424..c41a1f8 100644
--- a/gst/spectrum/Makefile.in
+++ b/gst/spectrum/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/spectrum
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -119,10 +135,23 @@ libgstspectrum_la_OBJECTS = $(am_libgstspectrum_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstspectrum_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstspectrum_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstspectrum_la_CFLAGS) $(CFLAGS) \
 	$(libgstspectrum_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -135,22 +164,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstspectrum_la_SOURCES)
 DIST_SOURCES = $(libgstspectrum_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -210,6 +240,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -258,8 +289,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -340,7 +373,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -400,6 +433,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -473,7 +507,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -525,7 +563,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -533,6 +570,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -548,12 +587,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstspectrum.la: $(libgstspectrum_la_OBJECTS) $(libgstspectrum_la_DEPENDENCIES) $(EXTRA_libgstspectrum_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstspectrum_la_LINK) -rpath $(plugindir) $(libgstspectrum_la_OBJECTS) $(libgstspectrum_la_LIBADD) $(LIBS)
 
@@ -648,6 +689,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -792,18 +847,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/udp/Makefile.in b/gst/udp/Makefile.in
index d842e69..f370b20 100644
--- a/gst/udp/Makefile.in
+++ b/gst/udp/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -25,6 +24,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -43,15 +59,16 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/gst-glib-gen.mak
+	$(srcdir)/Makefile.in $(top_srcdir)/common/gst-glib-gen.mak \
+	$(top_srcdir)/depcomp
 subdir = gst/udp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -133,10 +150,23 @@ libgstudp_la_OBJECTS = $(am_libgstudp_la_OBJECTS) \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstudp_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstudp_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstudp_la_CFLAGS) $(CFLAGS) \
 	$(libgstudp_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -149,22 +179,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstudp_la_SOURCES) $(nodist_libgstudp_la_SOURCES)
 DIST_SOURCES = $(libgstudp_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -224,6 +255,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -272,8 +304,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -354,7 +388,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -414,6 +448,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -487,7 +522,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -556,7 +595,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -564,6 +602,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -579,12 +619,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstudp.la: $(libgstudp_la_OBJECTS) $(libgstudp_la_DEPENDENCIES) $(EXTRA_libgstudp_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstudp_la_LINK) -rpath $(plugindir) $(libgstudp_la_OBJECTS) $(libgstudp_la_LIBADD) $(LIBS)
 
@@ -735,6 +777,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -883,18 +939,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # these are all the rules generating the relevant files
diff --git a/gst/udp/gstdynudpsink.c b/gst/udp/gstdynudpsink.c
index 18c58ca..22e8602 100644
--- a/gst/udp/gstdynudpsink.c
+++ b/gst/udp/gstdynudpsink.c
@@ -19,6 +19,10 @@
  * Boston, MA 02111-1307, USA.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
@@ -129,8 +133,7 @@ gst_dynudpsink_base_init (gpointer g_class)
 {
   GstElementClass *element_class = GST_ELEMENT_CLASS (g_class);
 
-  gst_element_class_add_static_pad_template (element_class,
-      &sink_template);
+  gst_element_class_add_static_pad_template (element_class, &sink_template);
 
   gst_element_class_set_details_simple (element_class, "UDP packet sender",
       "Sink/Network",
diff --git a/gst/udp/gstmultiudpsink.c b/gst/udp/gstmultiudpsink.c
index b65ab8c..5a1c489 100644
--- a/gst/udp/gstmultiudpsink.c
+++ b/gst/udp/gstmultiudpsink.c
@@ -27,6 +27,10 @@
  * It can be combined with rtp payload encoders to implement RTP streaming.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
@@ -903,11 +907,18 @@ ttl_failed:
   {
     gchar *errormessage = socket_last_error_message ();
     int errorcode = socket_last_error_code ();
+#ifdef G_OS_WIN32
+    GST_WARNING_OBJECT (sink,
+        "Could not set TTL socket option (%d): %s", errorcode, errormessage);
+    g_free (errormessage);
+    return TRUE;
+#else
     CLOSE_IF_REQUESTED (sink);
     GST_ELEMENT_ERROR (sink, RESOURCE, SETTINGS, (NULL),
         ("Could not set TTL socket option (%d): %s", errorcode, errormessage));
     g_free (errormessage);
     return FALSE;
+#endif
   }
 loop_failed:
   {
@@ -968,8 +979,7 @@ gst_multiudpsink_init_send (GstMultiUDPSink * sink)
      * maximum of around 100K. Also a minimum of 128 bytes is required on
      * Linux. */
     ret =
-        setsockopt (sink->sockfd, SOL_SOCKET, SO_SNDBUF, (void *) &sndsize,
-        len);
+        setsockopt (sink->sock, SOL_SOCKET, SO_SNDBUF, (void *) &sndsize, len);
     if (ret != 0) {
       GST_ELEMENT_WARNING (sink, RESOURCE, SETTINGS, (NULL),
           ("Could not create a buffer of requested %d bytes, %d: %s (%d)",
@@ -980,8 +990,7 @@ gst_multiudpsink_init_send (GstMultiUDPSink * sink)
   /* read the value of the receive buffer. Note that on linux this returns 2x the
    * value we set because the kernel allocates extra memory for metadata.
    * The default on Linux is about 100K (which is about 50K without metadata) */
-  ret =
-      getsockopt (sink->sockfd, SOL_SOCKET, SO_SNDBUF, (void *) &sndsize, &len);
+  ret = getsockopt (sink->sock, SOL_SOCKET, SO_SNDBUF, (void *) &sndsize, &len);
   if (ret == 0)
     GST_DEBUG_OBJECT (sink, "have udp buffer of %d bytes", sndsize);
   else
diff --git a/gst/videobox/Makefile.in b/gst/videobox/Makefile.in
index 17680da..96f5c3e 100644
--- a/gst/videobox/Makefile.in
+++ b/gst/videobox/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -39,6 +38,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -57,15 +73,16 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak
+	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak \
+	$(top_srcdir)/depcomp
 subdir = gst/videobox
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -144,10 +161,23 @@ libgstvideobox_la_OBJECTS = $(am_libgstvideobox_la_OBJECTS) \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstvideobox_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstvideobox_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstvideobox_la_CFLAGS) $(CFLAGS) \
 	$(libgstvideobox_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -160,23 +190,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstvideobox_la_SOURCES) \
 	$(nodist_libgstvideobox_la_SOURCES)
 DIST_SOURCES = $(libgstvideobox_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -236,6 +267,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -284,8 +316,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -366,7 +400,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -426,6 +460,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -499,7 +534,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -570,7 +609,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -578,6 +616,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -593,12 +633,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstvideobox.la: $(libgstvideobox_la_OBJECTS) $(libgstvideobox_la_DEPENDENCIES) $(EXTRA_libgstvideobox_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstvideobox_la_LINK) -rpath $(plugindir) $(libgstvideobox_la_OBJECTS) $(libgstvideobox_la_LIBADD) $(LIBS)
 
@@ -701,6 +743,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -851,8 +907,8 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-local clean-pluginLTLIBRARIES ctags \
-	dist-hook distclean distclean-compile distclean-generic \
+	clean-libtool clean-local clean-pluginLTLIBRARIES cscopelist \
+	ctags dist-hook distclean distclean-compile distclean-generic \
 	distclean-libtool distclean-tags distdir dvi dvi-am html \
 	html-am info info-am install install-am install-data \
 	install-data-am install-dvi install-dvi-am install-exec \
diff --git a/gst/videobox/gstvideoboxorc-dist.c b/gst/videobox/gstvideoboxorc-dist.c
index 1e00246..6e9cd10 100644
--- a/gst/videobox/gstvideoboxorc-dist.c
+++ b/gst/videobox/gstvideoboxorc-dist.c
@@ -181,7 +181,7 @@ void
 orc_splat_u32 (guint32 * ORC_RESTRICT d1, int p1, int n)
 {
   OrcExecutor _ex, *ex = &_ex;
-  static volatile int p_inited = 0;
+  static int p_inited = 0;
   static OrcProgram *p = 0;
   void (*func) (OrcExecutor *);
 
diff --git a/gst/videocrop/Makefile.in b/gst/videocrop/Makefile.in
index 506a237..a0054a1 100644
--- a/gst/videocrop/Makefile.in
+++ b/gst/videocrop/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/videocrop
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -118,10 +134,23 @@ libgstvideocrop_la_OBJECTS = $(am_libgstvideocrop_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstvideocrop_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstvideocrop_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstvideocrop_la_CFLAGS) $(CFLAGS) \
 	$(libgstvideocrop_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -134,22 +163,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstvideocrop_la_SOURCES)
 DIST_SOURCES = $(libgstvideocrop_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -209,6 +239,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -257,8 +288,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -339,7 +372,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -399,6 +432,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -472,7 +506,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -524,7 +562,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -532,6 +569,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -547,12 +586,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstvideocrop.la: $(libgstvideocrop_la_OBJECTS) $(libgstvideocrop_la_DEPENDENCIES) $(EXTRA_libgstvideocrop_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstvideocrop_la_LINK) -rpath $(plugindir) $(libgstvideocrop_la_OBJECTS) $(libgstvideocrop_la_LIBADD) $(LIBS)
 
@@ -655,6 +696,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -799,18 +854,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/videocrop/gstvideocrop.c b/gst/videocrop/gstvideocrop.c
index 04b6e61..a6b4562 100644
--- a/gst/videocrop/gstvideocrop.c
+++ b/gst/videocrop/gstvideocrop.c
@@ -102,6 +102,8 @@ enum
   GST_VIDEO_CAPS_YUV ("Y800") ";"                \
   GST_VIDEO_CAPS_YUV ("I420") ";"                \
   GST_VIDEO_CAPS_YUV ("YV12") ";"                \
+  GST_VIDEO_CAPS_YUV ("NV12") ";"                \
+  GST_VIDEO_CAPS_YUV ("NV21") ";"                \
   GST_VIDEO_CAPS_RGB_16 ";"                      \
   GST_VIDEO_CAPS_RGB_15 ";"			 \
   GST_VIDEO_CAPS_GRAY
@@ -147,8 +149,7 @@ gst_video_crop_base_init (gpointer g_class)
       "Crops video into a user-defined region",
       "Tim-Philipp Müller <tim centricular net>");
 
-  gst_element_class_add_static_pad_template (element_class,
-      &sink_template);
+  gst_element_class_add_static_pad_template (element_class, &sink_template);
   gst_element_class_add_static_pad_template (element_class, &src_template);
 }
 
@@ -211,17 +212,21 @@ gst_video_crop_class_init (GstVideoCropClass * klass)
   gobject_class->get_property = gst_video_crop_get_property;
 
   g_object_class_install_property (gobject_class, ARG_LEFT,
-      g_param_spec_int ("left", "Left", "Pixels to crop at left",
-          0, G_MAXINT, 0, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+      g_param_spec_int ("left", "Left",
+          "Pixels to crop at left (-1 to auto-crop)", -1, G_MAXINT, 0,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
   g_object_class_install_property (gobject_class, ARG_RIGHT,
-      g_param_spec_int ("right", "Right", "Pixels to crop at right",
-          0, G_MAXINT, 0, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+      g_param_spec_int ("right", "Right",
+          "Pixels to crop at right (-1 to auto-crop)", -1, G_MAXINT, 0,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
   g_object_class_install_property (gobject_class, ARG_TOP,
-      g_param_spec_int ("top", "Top", "Pixels to crop at top",
-          0, G_MAXINT, 0, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+      g_param_spec_int ("top", "Top",
+          "Pixels to crop at top (-1 to auto-crop)", -1, G_MAXINT, 0,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
   g_object_class_install_property (gobject_class, ARG_BOTTOM,
-      g_param_spec_int ("bottom", "Bottom", "Pixels to crop at bottom",
-          0, G_MAXINT, 0, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+      g_param_spec_int ("bottom", "Bottom",
+          "Pixels to crop at bottom (-1 to auto-crop)", -1, G_MAXINT, 0,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
   basetransform_class->transform = GST_DEBUG_FUNCPTR (gst_video_crop_transform);
   basetransform_class->transform_caps =
@@ -237,6 +242,10 @@ gst_video_crop_class_init (GstVideoCropClass * klass)
 static void
 gst_video_crop_init (GstVideoCrop * vcrop, GstVideoCropClass * klass)
 {
+  vcrop->prop_right = 0;
+  vcrop->prop_left = 0;
+  vcrop->prop_top = 0;
+  vcrop->prop_bottom = 0;
   vcrop->crop_right = 0;
   vcrop->crop_left = 0;
   vcrop->crop_top = 0;
@@ -320,6 +329,15 @@ gst_video_crop_get_image_details_from_caps (GstVideoCrop * vcrop,
         details->size = details->v_off +
             details->v_stride * (GST_ROUND_UP_2 (height) / 2);
         break;
+      case GST_MAKE_FOURCC ('N', 'V', '1', '2'):
+      case GST_MAKE_FOURCC ('N', 'V', '2', '1'):
+        details->packing = VIDEO_CROP_PIXEL_FORMAT_SEMI_PLANAR;
+        details->y_stride = GST_ROUND_UP_4 (width);
+        details->uv_stride = details->y_stride;
+        details->y_off = 0;
+        details->uv_off = details->y_stride * GST_ROUND_UP_2 (height);
+        details->size = details->y_stride * GST_ROUND_UP_2 (height) * 3 / 2;
+        break;
       }
       default:
         goto unknown_format;
@@ -473,6 +491,42 @@ gst_video_crop_transform_planar (GstVideoCrop * vcrop, GstBuffer * inbuf,
   }
 }
 
+static void
+gst_video_crop_transform_semi_planar (GstVideoCrop * vcrop, GstBuffer * inbuf,
+    GstBuffer * outbuf)
+{
+  guint8 *y_out, *uv_out;
+  guint8 *y_in, *uv_in;
+  guint i, dx;
+
+  /* Y plane */
+  y_in = GST_BUFFER_DATA (inbuf);
+  y_out = GST_BUFFER_DATA (outbuf);
+
+  y_in += vcrop->crop_top * vcrop->in.y_stride + vcrop->crop_left;
+  dx = vcrop->out.width;
+
+  for (i = 0; i < vcrop->out.height; ++i) {
+    memcpy (y_out, y_in, dx);
+    y_in += vcrop->in.y_stride;
+    y_out += vcrop->out.y_stride;
+  }
+
+  /* UV plane */
+  uv_in = GST_BUFFER_DATA (inbuf) + vcrop->in.uv_off;
+  uv_out = GST_BUFFER_DATA (outbuf) + vcrop->out.uv_off;
+
+  uv_in += (vcrop->crop_top / 2) * vcrop->in.uv_stride;
+  uv_in += GST_ROUND_DOWN_2 (vcrop->crop_left);
+  dx = GST_ROUND_UP_2 (vcrop->out.width);
+
+  for (i = 0; i < GST_ROUND_UP_2 (vcrop->out.height) / 2; i++) {
+    memcpy (uv_out, uv_in, dx);
+    uv_in += vcrop->in.uv_stride;
+    uv_out += vcrop->out.uv_stride;
+  }
+}
+
 static GstFlowReturn
 gst_video_crop_transform (GstBaseTransform * trans, GstBuffer * inbuf,
     GstBuffer * outbuf)
@@ -489,6 +543,9 @@ gst_video_crop_transform (GstBaseTransform * trans, GstBuffer * inbuf,
     case VIDEO_CROP_PIXEL_FORMAT_PLANAR:
       gst_video_crop_transform_planar (vcrop, inbuf, outbuf);
       break;
+    case VIDEO_CROP_PIXEL_FORMAT_SEMI_PLANAR:
+      gst_video_crop_transform_semi_planar (vcrop, inbuf, outbuf);
+      break;
     default:
       g_assert_not_reached ();
   }
@@ -508,33 +565,69 @@ gst_video_crop_transform_dimension (gint val, gint delta)
 
 static gboolean
 gst_video_crop_transform_dimension_value (const GValue * src_val,
-    gint delta, GValue * dest_val)
+    gint delta, GValue * dest_val, GstPadDirection direction, gboolean dynamic)
 {
   gboolean ret = TRUE;
 
-  g_value_init (dest_val, G_VALUE_TYPE (src_val));
-
   if (G_VALUE_HOLDS_INT (src_val)) {
     gint ival = g_value_get_int (src_val);
-
     ival = gst_video_crop_transform_dimension (ival, delta);
-    g_value_set_int (dest_val, ival);
+
+    if (dynamic) {
+      if (direction == GST_PAD_SRC) {
+        if (ival == G_MAXINT) {
+          g_value_init (dest_val, G_TYPE_INT);
+          g_value_set_int (dest_val, ival);
+        } else {
+          g_value_init (dest_val, GST_TYPE_INT_RANGE);
+          gst_value_set_int_range (dest_val, ival, G_MAXINT);
+        }
+      } else {
+        if (ival == 1) {
+          g_value_init (dest_val, G_TYPE_INT);
+          g_value_set_int (dest_val, ival);
+        } else {
+          g_value_init (dest_val, GST_TYPE_INT_RANGE);
+          gst_value_set_int_range (dest_val, 1, ival);
+        }
+      }
+    } else {
+      g_value_init (dest_val, G_TYPE_INT);
+      g_value_set_int (dest_val, ival);
+    }
   } else if (GST_VALUE_HOLDS_INT_RANGE (src_val)) {
     gint min = gst_value_get_int_range_min (src_val);
     gint max = gst_value_get_int_range_max (src_val);
 
     min = gst_video_crop_transform_dimension (min, delta);
     max = gst_video_crop_transform_dimension (max, delta);
-    gst_value_set_int_range (dest_val, min, max);
+
+    if (dynamic) {
+      if (direction == GST_PAD_SRC)
+        max = G_MAXINT;
+      else
+        min = 1;
+    }
+
+    if (min == max) {
+      g_value_init (dest_val, G_TYPE_INT);
+      g_value_set_int (dest_val, min);
+    } else {
+      g_value_init (dest_val, GST_TYPE_INT_RANGE);
+      gst_value_set_int_range (dest_val, min, max);
+    }
   } else if (GST_VALUE_HOLDS_LIST (src_val)) {
     gint i;
 
+    g_value_init (dest_val, GST_TYPE_LIST);
+
     for (i = 0; i < gst_value_list_get_size (src_val); ++i) {
       const GValue *list_val;
       GValue newval = { 0, };
 
       list_val = gst_value_list_get_value (src_val, i);
-      if (gst_video_crop_transform_dimension_value (list_val, delta, &newval))
+      if (gst_video_crop_transform_dimension_value (list_val, delta, &newval,
+              direction, dynamic))
         gst_value_list_append_value (dest_val, &newval);
       g_value_unset (&newval);
     }
@@ -544,7 +637,6 @@ gst_video_crop_transform_dimension_value (const GValue * src_val,
       ret = FALSE;
     }
   } else {
-    g_value_unset (dest_val);
     ret = FALSE;
   }
 
@@ -557,21 +649,30 @@ gst_video_crop_transform_caps (GstBaseTransform * trans,
 {
   GstVideoCrop *vcrop;
   GstCaps *other_caps;
-  gint dy, dx, i;
+  gint dy, dx, i, left, right, bottom, top;
+  gboolean w_dynamic, h_dynamic;
 
   vcrop = GST_VIDEO_CROP (trans);
 
   GST_OBJECT_LOCK (vcrop);
 
   GST_LOG_OBJECT (vcrop, "l=%d,r=%d,b=%d,t=%d",
-      vcrop->crop_left, vcrop->crop_right, vcrop->crop_bottom, vcrop->crop_top);
+      vcrop->prop_left, vcrop->prop_right, vcrop->prop_bottom, vcrop->prop_top);
+
+  w_dynamic = (vcrop->prop_left == -1 || vcrop->prop_right == -1);
+  h_dynamic = (vcrop->prop_top == -1 || vcrop->prop_bottom == -1);
+
+  left = (vcrop->prop_left == -1) ? 0 : vcrop->prop_left;
+  right = (vcrop->prop_right == -1) ? 0 : vcrop->prop_right;
+  bottom = (vcrop->prop_bottom == -1) ? 0 : vcrop->prop_bottom;
+  top = (vcrop->prop_top == -1) ? 0 : vcrop->prop_top;
 
   if (direction == GST_PAD_SRC) {
-    dx = vcrop->crop_left + vcrop->crop_right;
-    dy = vcrop->crop_top + vcrop->crop_bottom;
+    dx = left + right;
+    dy = top + bottom;
   } else {
-    dx = 0 - (vcrop->crop_left + vcrop->crop_right);
-    dy = 0 - (vcrop->crop_top + vcrop->crop_bottom);
+    dx = 0 - (left + right);
+    dy = 0 - (top + bottom);
   }
   GST_OBJECT_UNLOCK (vcrop);
 
@@ -588,14 +689,16 @@ gst_video_crop_transform_caps (GstBaseTransform * trans,
     structure = gst_caps_get_structure (caps, i);
 
     v = gst_structure_get_value (structure, "width");
-    if (!gst_video_crop_transform_dimension_value (v, dx, &w_val)) {
+    if (!gst_video_crop_transform_dimension_value (v, dx, &w_val, direction,
+            w_dynamic)) {
       GST_WARNING_OBJECT (vcrop, "could not tranform width value with dx=%d"
           ", caps structure=%" GST_PTR_FORMAT, dx, structure);
       continue;
     }
 
     v = gst_structure_get_value (structure, "height");
-    if (!gst_video_crop_transform_dimension_value (v, dy, &h_val)) {
+    if (!gst_video_crop_transform_dimension_value (v, dy, &h_val, direction,
+            h_dynamic)) {
       g_value_unset (&w_val);
       GST_WARNING_OBJECT (vcrop, "could not tranform height value with dy=%d"
           ", caps structure=%" GST_PTR_FORMAT, dy, structure);
@@ -625,6 +728,7 @@ gst_video_crop_set_caps (GstBaseTransform * trans, GstCaps * incaps,
     GstCaps * outcaps)
 {
   GstVideoCrop *crop = GST_VIDEO_CROP (trans);
+  int dx, dy;
 
   if (!gst_video_crop_get_image_details_from_caps (crop, &crop->in, incaps))
     goto wrong_input;
@@ -632,6 +736,40 @@ gst_video_crop_set_caps (GstBaseTransform * trans, GstCaps * incaps,
   if (!gst_video_crop_get_image_details_from_caps (crop, &crop->out, outcaps))
     goto wrong_output;
 
+  crop->crop_left = crop->prop_left;
+  crop->crop_right = crop->prop_right;
+  crop->crop_top = crop->prop_top;
+  crop->crop_bottom = crop->prop_bottom;
+
+  dx = crop->in.width - crop->out.width;
+  dy = crop->in.height - crop->out.height;
+
+  if (crop->prop_left == -1 && crop->prop_right == -1) {
+    crop->crop_left = dx / 2;
+    crop->crop_right = dx / 2 + (dx & 1);
+  } else if (crop->prop_left == -1) {
+    if (G_UNLIKELY (crop->prop_right > dx))
+      goto cropping_too_much;
+    crop->crop_left = dx - crop->prop_right;
+  } else if (crop->prop_right == -1) {
+    if (G_UNLIKELY (crop->prop_left > dx))
+      goto cropping_too_much;
+    crop->crop_right = dx - crop->prop_left;
+  }
+
+  if (crop->prop_top == -1 && crop->prop_bottom == -1) {
+    crop->crop_top = dy / 2;
+    crop->crop_bottom = dy / 2 + (dy & 1);
+  } else if (crop->prop_top == -1) {
+    if (G_UNLIKELY (crop->prop_bottom > dy))
+      goto cropping_too_much;
+    crop->crop_top = dy - crop->prop_bottom;
+  } else if (crop->prop_bottom == -1) {
+    if (G_UNLIKELY (crop->prop_top > dy))
+      goto cropping_too_much;
+    crop->crop_bottom = dy - crop->prop_top;
+  }
+
   if (G_UNLIKELY ((crop->crop_left + crop->crop_right) >= crop->in.width ||
           (crop->crop_top + crop->crop_bottom) >= crop->in.height))
     goto cropping_too_much;
@@ -653,19 +791,19 @@ gst_video_crop_set_caps (GstBaseTransform * trans, GstCaps * incaps,
   /* ERROR */
 wrong_input:
   {
-    GST_DEBUG_OBJECT (crop, "failed to parse input caps %" GST_PTR_FORMAT,
+    GST_WARNING_OBJECT (crop, "failed to parse input caps %" GST_PTR_FORMAT,
         incaps);
     return FALSE;
   }
 wrong_output:
   {
-    GST_DEBUG_OBJECT (crop, "failed to parse output caps %" GST_PTR_FORMAT,
+    GST_WARNING_OBJECT (crop, "failed to parse output caps %" GST_PTR_FORMAT,
         outcaps);
     return FALSE;
   }
 cropping_too_much:
   {
-    GST_DEBUG_OBJECT (crop, "we are cropping too much");
+    GST_WARNING_OBJECT (crop, "we are cropping too much");
     return FALSE;
   }
 }
@@ -685,16 +823,16 @@ gst_video_crop_set_property (GObject * object, guint prop_id,
   GST_OBJECT_LOCK (video_crop);
   switch (prop_id) {
     case ARG_LEFT:
-      video_crop->crop_left = g_value_get_int (value);
+      video_crop->prop_left = g_value_get_int (value);
       break;
     case ARG_RIGHT:
-      video_crop->crop_right = g_value_get_int (value);
+      video_crop->prop_right = g_value_get_int (value);
       break;
     case ARG_TOP:
-      video_crop->crop_top = g_value_get_int (value);
+      video_crop->prop_top = g_value_get_int (value);
       break;
     case ARG_BOTTOM:
-      video_crop->crop_bottom = g_value_get_int (value);
+      video_crop->prop_bottom = g_value_get_int (value);
       break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
@@ -721,16 +859,16 @@ gst_video_crop_get_property (GObject * object, guint prop_id, GValue * value,
   GST_OBJECT_LOCK (video_crop);
   switch (prop_id) {
     case ARG_LEFT:
-      g_value_set_int (value, video_crop->crop_left);
+      g_value_set_int (value, video_crop->prop_left);
       break;
     case ARG_RIGHT:
-      g_value_set_int (value, video_crop->crop_right);
+      g_value_set_int (value, video_crop->prop_right);
       break;
     case ARG_TOP:
-      g_value_set_int (value, video_crop->crop_top);
+      g_value_set_int (value, video_crop->prop_top);
       break;
     case ARG_BOTTOM:
-      g_value_set_int (value, video_crop->crop_bottom);
+      g_value_set_int (value, video_crop->prop_bottom);
       break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
diff --git a/gst/videocrop/gstvideocrop.h b/gst/videocrop/gstvideocrop.h
index 477f21b..994b73d 100644
--- a/gst/videocrop/gstvideocrop.h
+++ b/gst/videocrop/gstvideocrop.h
@@ -38,7 +38,8 @@ G_BEGIN_DECLS
 typedef enum {
   VIDEO_CROP_PIXEL_FORMAT_PACKED_SIMPLE = 0,  /* RGBx, AYUV */
   VIDEO_CROP_PIXEL_FORMAT_PACKED_COMPLEX,     /* UYVY, YVYU */
-  VIDEO_CROP_PIXEL_FORMAT_PLANAR              /* I420, YV12 */
+  VIDEO_CROP_PIXEL_FORMAT_PLANAR,             /* I420, YV12 */
+  VIDEO_CROP_PIXEL_FORMAT_SEMI_PLANAR         /* NV12, NV21 */
 } VideoCropPixelFormat;
 
 typedef struct _GstVideoCropImageDetails GstVideoCropImageDetails;
@@ -60,6 +61,9 @@ struct _GstVideoCropImageDetails
   guint y_stride, y_off;
   guint u_stride, u_off;
   guint v_stride, v_off;
+
+  /* For bi-planar UV or VU plane */
+  guint uv_stride, uv_off;
 };
 
 typedef struct _GstVideoCrop GstVideoCrop;
@@ -70,6 +74,11 @@ struct _GstVideoCrop
   GstBaseTransform basetransform;
 
   /*< private >*/
+  gint prop_left;
+  gint prop_right;
+  gint prop_top;
+  gint prop_bottom;
+
   gint crop_left;
   gint crop_right;
   gint crop_top;
diff --git a/gst/videofilter/Makefile.in b/gst/videofilter/Makefile.in
index c49db72..2ed112d 100644
--- a/gst/videofilter/Makefile.in
+++ b/gst/videofilter/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/videofilter
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -122,10 +138,23 @@ libgstvideofilter_la_OBJECTS = $(am_libgstvideofilter_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstvideofilter_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstvideofilter_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstvideofilter_la_CFLAGS) $(CFLAGS) \
 	$(libgstvideofilter_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -138,22 +167,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstvideofilter_la_SOURCES)
 DIST_SOURCES = $(libgstvideofilter_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -213,6 +243,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -261,8 +292,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -343,7 +376,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -403,6 +436,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -476,7 +510,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -537,7 +575,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -545,6 +582,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -560,12 +599,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstvideofilter.la: $(libgstvideofilter_la_OBJECTS) $(libgstvideofilter_la_DEPENDENCIES) $(EXTRA_libgstvideofilter_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstvideofilter_la_LINK) -rpath $(plugindir) $(libgstvideofilter_la_OBJECTS) $(libgstvideofilter_la_LIBADD) $(LIBS)
 
@@ -684,6 +725,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -829,18 +884,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 gstvideoexample.c: $(srcdir)/make_filter $(srcdir)/gstvideotemplate.c
diff --git a/gst/videofilter/gstvideobalance.c b/gst/videofilter/gstvideobalance.c
index 83a2afd..c9e44b0 100644
--- a/gst/videofilter/gstvideobalance.c
+++ b/gst/videofilter/gstvideobalance.c
@@ -87,6 +87,8 @@ static GstStaticPadTemplate gst_video_balance_src_template =
         GST_VIDEO_CAPS_YUV ("YVYU") ";"
         GST_VIDEO_CAPS_YUV ("I420") ";"
         GST_VIDEO_CAPS_YUV ("YV12") ";"
+        GST_VIDEO_CAPS_YUV ("NV12") ";"
+        GST_VIDEO_CAPS_YUV ("NV21") ";"
         GST_VIDEO_CAPS_YUV ("IYUV") ";" GST_VIDEO_CAPS_YUV ("Y41B")
     )
     );
@@ -108,6 +110,8 @@ static GstStaticPadTemplate gst_video_balance_sink_template =
         GST_VIDEO_CAPS_YUV ("YVYU") ";"
         GST_VIDEO_CAPS_YUV ("I420") ";"
         GST_VIDEO_CAPS_YUV ("YV12") ";"
+        GST_VIDEO_CAPS_YUV ("NV12") ";"
+        GST_VIDEO_CAPS_YUV ("NV21") ";"
         GST_VIDEO_CAPS_YUV ("IYUV") ";" GST_VIDEO_CAPS_YUV ("Y41B")
     )
     );
@@ -266,6 +270,67 @@ gst_video_balance_planar_yuv (GstVideoBalance * videobalance, guint8 * data)
 }
 
 static void
+gst_video_balance_semiplanar_yuv (GstVideoBalance * videobalance, guint8 * data)
+{
+  gint x, y;
+  guint8 *ydata;
+  guint8 *uvdata;
+  gint ystride, uvstride;
+  gint upos, vpos;
+  GstVideoFormat format;
+  gint width, height;
+  gint width2, height2;
+  guint8 *tabley = videobalance->tabley;
+  guint8 **tableu = videobalance->tableu;
+  guint8 **tablev = videobalance->tablev;
+
+  format = videobalance->format;
+  width = videobalance->width;
+  height = videobalance->height;
+
+  ydata =
+      data + gst_video_format_get_component_offset (format, 0, width, height);
+  ystride = gst_video_format_get_row_stride (format, 0, width);
+
+  for (y = 0; y < height; y++) {
+    guint8 *yptr;
+
+    yptr = ydata + y * ystride;
+    for (x = 0; x < width; x++) {
+      *yptr = tabley[*yptr];
+      yptr++;
+    }
+  }
+
+  width2 = gst_video_format_get_component_width (format, 1, width);
+  height2 = gst_video_format_get_component_height (format, 1, height);
+
+  uvdata =
+      data + gst_video_format_get_component_offset (format,
+      (format == GST_VIDEO_FORMAT_NV12) ? 1 : 2, width, height);
+  uvstride = gst_video_format_get_row_stride (format, 1, width);
+
+  upos = format == GST_VIDEO_FORMAT_NV12 ? 0 : 1;
+  vpos = format == GST_VIDEO_FORMAT_NV12 ? 1 : 0;
+
+  for (y = 0; y < height2; y++) {
+    guint8 *uvptr;
+    guint8 u1, v1;
+
+    uvptr = uvdata + y * uvstride;
+
+    for (x = 0; x < width2; x++) {
+      u1 = uvptr[upos];
+      v1 = uvptr[vpos];
+
+      uvptr[upos] = tableu[u1][v1];
+      uvptr[vpos] = tablev[u1][v1];
+      uvptr += 2;
+    }
+  }
+}
+
+static void
 gst_video_balance_packed_yuv (GstVideoBalance * videobalance, guint8 * data)
 {
   gint x, y;
@@ -443,6 +508,10 @@ gst_video_balance_set_caps (GstBaseTransform * base, GstCaps * incaps,
     case GST_VIDEO_FORMAT_YVYU:
       videobalance->process = gst_video_balance_packed_yuv;
       break;
+    case GST_VIDEO_FORMAT_NV12:
+    case GST_VIDEO_FORMAT_NV21:
+      videobalance->process = gst_video_balance_semiplanar_yuv;
+      break;
     case GST_VIDEO_FORMAT_ARGB:
     case GST_VIDEO_FORMAT_ABGR:
     case GST_VIDEO_FORMAT_RGBA:
diff --git a/gst/videofilter/gstvideoflip.c b/gst/videofilter/gstvideoflip.c
index 7137057..1c58886 100644
--- a/gst/videofilter/gstvideoflip.c
+++ b/gst/videofilter/gstvideoflip.c
@@ -78,8 +78,10 @@ static GstStaticPadTemplate gst_video_flip_src_template =
         GST_VIDEO_CAPS_YUV ("I420") ";"
         GST_VIDEO_CAPS_YUV ("YV12") ";" GST_VIDEO_CAPS_YUV ("IYUV") ";"
         GST_VIDEO_CAPS_YUV ("YUY2") ";" GST_VIDEO_CAPS_YUV ("UYVY") ";"
-        GST_VIDEO_CAPS_YUV ("YVYU")
-
+        GST_VIDEO_CAPS_YUV ("NV12") ";" GST_VIDEO_CAPS_YUV ("NV21") ";"
+        GST_VIDEO_CAPS_YUV ("YVYU") ";" GST_VIDEO_CAPS_GRAY8 ";"
+        GST_VIDEO_CAPS_GRAY16 ("LITTLE_ENDIAN") ";"
+        GST_VIDEO_CAPS_GRAY16 ("BIG_ENDIAN")
     )
     );
 
@@ -97,7 +99,10 @@ static GstStaticPadTemplate gst_video_flip_sink_template =
         GST_VIDEO_CAPS_YUV ("I420") ";"
         GST_VIDEO_CAPS_YUV ("YV12") ";" GST_VIDEO_CAPS_YUV ("IYUV") ";"
         GST_VIDEO_CAPS_YUV ("YUY2") ";" GST_VIDEO_CAPS_YUV ("UYVY") ";"
-        GST_VIDEO_CAPS_YUV ("YVYU")
+        GST_VIDEO_CAPS_YUV ("NV12") ";" GST_VIDEO_CAPS_YUV ("NV21") ";"
+        GST_VIDEO_CAPS_YUV ("YVYU") ";" GST_VIDEO_CAPS_GRAY8 ";"
+        GST_VIDEO_CAPS_GRAY16 ("LITTLE_ENDIAN") ";"
+        GST_VIDEO_CAPS_GRAY16 ("BIG_ENDIAN")
     )
     );
 
@@ -471,6 +476,216 @@ gst_video_flip_planar_yuv (GstVideoFlip * videoflip, guint8 * dest,
 }
 
 static void
+gst_video_flip_semi_planar_yuv (GstVideoFlip * videoflip, guint8 * dest,
+    const guint8 * src)
+{
+  gint x, y;
+  guint8 const *s;
+  guint8 *d;
+  gint s_off, d_off;
+  GstVideoFormat format = videoflip->format;
+  gint sw = videoflip->from_width;
+  gint sh = videoflip->from_height;
+  gint dw = videoflip->to_width;
+  gint dh = videoflip->to_height;
+  gint src_y_stride, src_uv_stride;
+  gint src_y_offset, src_uv_offset;
+  gint src_y_height, src_uv_height;
+  gint src_y_width, src_uv_width;
+  gint dest_y_stride, dest_uv_stride;
+  gint dest_y_offset, dest_uv_offset;
+  gint dest_y_height, dest_uv_height;
+  gint dest_y_width, dest_uv_width;
+
+  src_y_stride = gst_video_format_get_row_stride (format, 0, sw);
+  src_uv_stride = gst_video_format_get_row_stride (format, 1, sw);
+
+  dest_y_stride = gst_video_format_get_row_stride (format, 0, dw);
+  dest_uv_stride = gst_video_format_get_row_stride (format, 1, dw);
+
+  src_y_offset = gst_video_format_get_component_offset (format, 0, sw, sh);
+  src_uv_offset = gst_video_format_get_component_offset (format, 1, sw, sh);
+
+  dest_y_offset = gst_video_format_get_component_offset (format, 0, dw, dh);
+  dest_uv_offset = gst_video_format_get_component_offset (format, 1, dw, dh);
+
+  src_y_width = gst_video_format_get_component_width (format, 0, sw);
+  src_uv_width = gst_video_format_get_component_width (format, 1, sw);
+
+  dest_y_width = gst_video_format_get_component_width (format, 0, dw);
+  dest_uv_width = gst_video_format_get_component_width (format, 1, dw);
+
+  src_y_height = gst_video_format_get_component_height (format, 0, sh);
+  src_uv_height = gst_video_format_get_component_height (format, 1, sh);
+
+  dest_y_height = gst_video_format_get_component_height (format, 0, dh);
+  dest_uv_height = gst_video_format_get_component_height (format, 1, dh);
+
+  switch (videoflip->method) {
+    case GST_VIDEO_FLIP_METHOD_90R:
+      /* Flip Y */
+      s = src + src_y_offset;
+      d = dest + dest_y_offset;
+      for (y = 0; y < dest_y_height; y++) {
+        for (x = 0; x < dest_y_width; x++) {
+          d[y * dest_y_stride + x] =
+              s[(src_y_height - 1 - x) * src_y_stride + y];
+        }
+      }
+      /* Flip UV */
+      s = src + src_uv_offset;
+      d = dest + dest_uv_offset;
+      for (y = 0; y < dest_uv_height; y++) {
+        for (x = 0; x < dest_uv_width; x++) {
+          d_off = y * dest_uv_stride + x * 2;
+          s_off = (src_uv_height - 1 - x) * src_uv_stride + y * 2;
+          d[d_off] = s[s_off];
+          d[d_off + 1] = s[s_off + 1];
+        }
+      }
+      break;
+    case GST_VIDEO_FLIP_METHOD_90L:
+      /* Flip Y */
+      s = src + src_y_offset;
+      d = dest + dest_y_offset;
+      for (y = 0; y < dest_y_height; y++) {
+        for (x = 0; x < dest_y_width; x++) {
+          d[y * dest_y_stride + x] =
+              s[x * src_y_stride + (src_y_width - 1 - y)];
+        }
+      }
+      /* Flip UV */
+      s = src + src_uv_offset;
+      d = dest + dest_uv_offset;
+      for (y = 0; y < dest_uv_height; y++) {
+        for (x = 0; x < dest_uv_width; x++) {
+          d_off = y * dest_uv_stride + x * 2;
+          s_off = x * src_uv_stride + (src_uv_width - 1 - y) * 2;
+          d[d_off] = s[s_off];
+          d[d_off + 1] = s[s_off + 1];
+        }
+      }
+      break;
+    case GST_VIDEO_FLIP_METHOD_180:
+      /* Flip Y */
+      s = src + src_y_offset;
+      d = dest + dest_y_offset;
+      for (y = 0; y < dest_y_height; y++) {
+        for (x = 0; x < dest_y_width; x++) {
+          d[y * dest_y_stride + x] =
+              s[(src_y_height - 1 - y) * src_y_stride + (src_y_width - 1 - x)];
+        }
+      }
+      /* Flip UV */
+      s = src + src_uv_offset;
+      d = dest + dest_uv_offset;
+      for (y = 0; y < dest_uv_height; y++) {
+        for (x = 0; x < dest_uv_width; x++) {
+          d_off = y * dest_uv_stride + x * 2;
+          s_off = (src_uv_height - 1 - y) * src_uv_stride + (src_uv_width - 1 -
+              x) * 2;
+          d[d_off] = s[s_off];
+          d[d_off + 1] = s[s_off + 1];
+        }
+      }
+      break;
+    case GST_VIDEO_FLIP_METHOD_HORIZ:
+      /* Flip Y */
+      s = src + src_y_offset;
+      d = dest + dest_y_offset;
+      for (y = 0; y < dest_y_height; y++) {
+        for (x = 0; x < dest_y_width; x++) {
+          d[y * dest_y_stride + x] =
+              s[y * src_y_stride + (src_y_width - 1 - x)];
+        }
+      }
+      /* Flip UV */
+      s = src + src_uv_offset;
+      d = dest + dest_uv_offset;
+      for (y = 0; y < dest_uv_height; y++) {
+        for (x = 0; x < dest_uv_width; x++) {
+          d_off = y * dest_uv_stride + x * 2;
+          s_off = y * src_uv_stride + (src_uv_width - 1 - x) * 2;
+          d[d_off] = s[s_off];
+          d[d_off + 1] = s[s_off + 1];
+        }
+      }
+      break;
+    case GST_VIDEO_FLIP_METHOD_VERT:
+      /* Flip Y */
+      s = src + src_y_offset;
+      d = dest + dest_y_offset;
+      for (y = 0; y < dest_y_height; y++) {
+        for (x = 0; x < dest_y_width; x++) {
+          d[y * dest_y_stride + x] =
+              s[(src_y_height - 1 - y) * src_y_stride + x];
+        }
+      }
+      /* Flip UV */
+      s = src + src_uv_offset;
+      d = dest + dest_uv_offset;
+      for (y = 0; y < dest_uv_height; y++) {
+        for (x = 0; x < dest_uv_width; x++) {
+          d_off = y * dest_uv_stride + x * 2;
+          s_off = (src_uv_height - 1 - y) * src_uv_stride + x * 2;
+          d[d_off] = s[s_off];
+          d[d_off + 1] = s[s_off + 1];
+        }
+      }
+      break;
+    case GST_VIDEO_FLIP_METHOD_TRANS:
+      /* Flip Y */
+      s = src + src_y_offset;
+      d = dest + dest_y_offset;
+      for (y = 0; y < dest_y_height; y++) {
+        for (x = 0; x < dest_y_width; x++) {
+          d[y * dest_y_stride + x] = s[x * src_y_stride + y];
+        }
+      }
+      /* Flip UV */
+      s = src + src_uv_offset;
+      d = dest + dest_uv_offset;
+      for (y = 0; y < dest_uv_height; y++) {
+        for (x = 0; x < dest_uv_width; x++) {
+          d_off = y * dest_uv_stride + x * 2;
+          s_off = x * src_uv_stride + y * 2;
+          d[d_off] = s[s_off];
+          d[d_off + 1] = s[s_off + 1];
+        }
+      }
+    case GST_VIDEO_FLIP_METHOD_OTHER:
+      /* Flip Y */
+      s = src + src_y_offset;
+      d = dest + dest_y_offset;
+      for (y = 0; y < dest_y_height; y++) {
+        for (x = 0; x < dest_y_width; x++) {
+          d[y * dest_y_stride + x] =
+              s[(src_y_height - 1 - x) * src_y_stride + (src_y_width - 1 - y)];
+        }
+      }
+      /* Flip UV */
+      s = src + src_uv_offset;
+      d = dest + dest_uv_offset;
+      for (y = 0; y < dest_uv_height; y++) {
+        for (x = 0; x < dest_uv_width; x++) {
+          d_off = y * dest_uv_stride + x * 2;
+          s_off = (src_uv_height - 1 - x) * src_uv_stride + (src_uv_width - 1 -
+              y) * 2;
+          d[d_off] = s[s_off];
+          d[d_off + 1] = s[s_off + 1];
+        }
+      }
+      break;
+    case GST_VIDEO_FLIP_METHOD_IDENTITY:
+      g_assert_not_reached ();
+      break;
+    default:
+      g_assert_not_reached ();
+      break;
+  }
+}
+
+static void
 gst_video_flip_packed_simple (GstVideoFlip * videoflip, guint8 * dest,
     const guint8 * src)
 {
@@ -861,8 +1076,15 @@ gst_video_flip_set_caps (GstBaseTransform * btrans, GstCaps * incaps,
     case GST_VIDEO_FORMAT_BGRx:
     case GST_VIDEO_FORMAT_RGB:
     case GST_VIDEO_FORMAT_BGR:
+    case GST_VIDEO_FORMAT_GRAY8:
+    case GST_VIDEO_FORMAT_GRAY16_BE:
+    case GST_VIDEO_FORMAT_GRAY16_LE:
       vf->process = gst_video_flip_packed_simple;
       break;
+    case GST_VIDEO_FORMAT_NV12:
+    case GST_VIDEO_FORMAT_NV21:
+      vf->process = gst_video_flip_semi_planar_yuv;
+      break;
     default:
       break;
   }
diff --git a/gst/videomixer/Makefile.in b/gst/videomixer/Makefile.in
index d6445e3..cced8a8 100644
--- a/gst/videomixer/Makefile.in
+++ b/gst/videomixer/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -39,6 +38,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -57,15 +73,16 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak
+	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak \
+	$(top_srcdir)/depcomp
 subdir = gst/videomixer
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -146,10 +163,23 @@ libgstvideomixer_la_OBJECTS = $(am_libgstvideomixer_la_OBJECTS) \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstvideomixer_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstvideomixer_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstvideomixer_la_CFLAGS) $(CFLAGS) \
 	$(libgstvideomixer_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -162,23 +192,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstvideomixer_la_SOURCES) \
 	$(nodist_libgstvideomixer_la_SOURCES)
 DIST_SOURCES = $(libgstvideomixer_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -238,6 +269,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -286,8 +318,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -368,7 +402,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -428,6 +462,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -501,7 +536,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -578,7 +617,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -586,6 +624,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -601,12 +641,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstvideomixer.la: $(libgstvideomixer_la_OBJECTS) $(libgstvideomixer_la_DEPENDENCIES) $(EXTRA_libgstvideomixer_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstvideomixer_la_LINK) -rpath $(plugindir) $(libgstvideomixer_la_OBJECTS) $(libgstvideomixer_la_LIBADD) $(LIBS)
 
@@ -725,6 +767,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -875,8 +931,8 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-local clean-pluginLTLIBRARIES ctags \
-	dist-hook distclean distclean-compile distclean-generic \
+	clean-libtool clean-local clean-pluginLTLIBRARIES cscopelist \
+	ctags dist-hook distclean distclean-compile distclean-generic \
 	distclean-libtool distclean-tags distdir dvi dvi-am html \
 	html-am info info-am install install-am install-data \
 	install-data-am install-dvi install-dvi-am install-exec \
diff --git a/gst/videomixer/blend.c b/gst/videomixer/blend.c
index aeeeef1..10dd5c3 100644
--- a/gst/videomixer/blend.c
+++ b/gst/videomixer/blend.c
@@ -98,7 +98,7 @@ BLEND_A32_LOOP (bgra, blend);
 BLEND_A32_LOOP (argb, overlay);
 BLEND_A32_LOOP (bgra, overlay);
 
-#if G_BYTE_ORDER == LITTLE_ENDIAN
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
 BLEND_A32 (argb, blend, _blend_loop_argb);
 BLEND_A32 (bgra, blend, _blend_loop_bgra);
 BLEND_A32 (argb, overlay, _overlay_loop_argb);
diff --git a/gst/videomixer/blendorc-dist.c b/gst/videomixer/blendorc-dist.c
index ee783d8..21b6ae1 100644
--- a/gst/videomixer/blendorc-dist.c
+++ b/gst/videomixer/blendorc-dist.c
@@ -193,7 +193,7 @@ void
 orc_splat_u32 (guint32 * ORC_RESTRICT d1, int p1, int n)
 {
   OrcExecutor _ex, *ex = &_ex;
-  static volatile int p_inited = 0;
+  static int p_inited = 0;
   static OrcProgram *p = 0;
   void (*func) (OrcExecutor *);
 
@@ -285,7 +285,7 @@ orc_memcpy_u32 (guint32 * ORC_RESTRICT d1, const guint32 * ORC_RESTRICT s1,
     int n)
 {
   OrcExecutor _ex, *ex = &_ex;
-  static volatile int p_inited = 0;
+  static int p_inited = 0;
   static OrcProgram *p = 0;
   void (*func) (OrcExecutor *);
 
@@ -438,7 +438,7 @@ orc_blend_u8 (guint8 * ORC_RESTRICT d1, int d1_stride,
     const guint8 * ORC_RESTRICT s1, int s1_stride, int p1, int n, int m)
 {
   OrcExecutor _ex, *ex = &_ex;
-  static volatile int p_inited = 0;
+  static int p_inited = 0;
   static OrcProgram *p = 0;
   void (*func) (OrcExecutor *);
 
@@ -742,7 +742,7 @@ orc_blend_argb (guint8 * ORC_RESTRICT d1, int d1_stride,
     const guint8 * ORC_RESTRICT s1, int s1_stride, int p1, int n, int m)
 {
   OrcExecutor _ex, *ex = &_ex;
-  static volatile int p_inited = 0;
+  static int p_inited = 0;
   static OrcProgram *p = 0;
   void (*func) (OrcExecutor *);
 
@@ -1076,7 +1076,7 @@ orc_blend_bgra (guint8 * ORC_RESTRICT d1, int d1_stride,
     const guint8 * ORC_RESTRICT s1, int s1_stride, int p1, int n, int m)
 {
   OrcExecutor _ex, *ex = &_ex;
-  static volatile int p_inited = 0;
+  static int p_inited = 0;
   static OrcProgram *p = 0;
   void (*func) (OrcExecutor *);
 
@@ -1562,7 +1562,7 @@ orc_overlay_argb (guint8 * ORC_RESTRICT d1, int d1_stride,
     const guint8 * ORC_RESTRICT s1, int s1_stride, int p1, int n, int m)
 {
   OrcExecutor _ex, *ex = &_ex;
-  static volatile int p_inited = 0;
+  static int p_inited = 0;
   static OrcProgram *p = 0;
   void (*func) (OrcExecutor *);
 
@@ -2086,7 +2086,7 @@ orc_overlay_bgra (guint8 * ORC_RESTRICT d1, int d1_stride,
     const guint8 * ORC_RESTRICT s1, int s1_stride, int p1, int n, int m)
 {
   OrcExecutor _ex, *ex = &_ex;
-  static volatile int p_inited = 0;
+  static int p_inited = 0;
   static OrcProgram *p = 0;
   void (*func) (OrcExecutor *);
 
diff --git a/gst/wavenc/Makefile.in b/gst/wavenc/Makefile.in
index 66b6a4d..90d9901 100644
--- a/gst/wavenc/Makefile.in
+++ b/gst/wavenc/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/wavenc
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -118,10 +134,23 @@ libgstwavenc_la_OBJECTS = $(am_libgstwavenc_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstwavenc_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstwavenc_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstwavenc_la_CFLAGS) $(CFLAGS) \
 	$(libgstwavenc_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -134,22 +163,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstwavenc_la_SOURCES)
 DIST_SOURCES = $(libgstwavenc_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -209,6 +239,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -257,8 +288,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -339,7 +372,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -399,6 +432,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -472,7 +506,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -526,7 +564,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -534,6 +571,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -549,12 +588,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstwavenc.la: $(libgstwavenc_la_OBJECTS) $(libgstwavenc_la_DEPENDENCIES) $(EXTRA_libgstwavenc_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstwavenc_la_LINK) -rpath $(plugindir) $(libgstwavenc_la_OBJECTS) $(libgstwavenc_la_LIBADD) $(LIBS)
 
@@ -649,6 +690,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -793,18 +848,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/wavparse/Makefile.in b/gst/wavparse/Makefile.in
index 186977f..de26c2a 100644
--- a/gst/wavparse/Makefile.in
+++ b/gst/wavparse/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/wavparse
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -119,10 +135,23 @@ libgstwavparse_la_OBJECTS = $(am_libgstwavparse_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstwavparse_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstwavparse_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstwavparse_la_CFLAGS) $(CFLAGS) \
 	$(libgstwavparse_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -135,22 +164,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstwavparse_la_SOURCES)
 DIST_SOURCES = $(libgstwavparse_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -210,6 +240,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -258,8 +289,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -340,7 +373,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -400,6 +433,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -473,7 +507,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -532,7 +570,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -540,6 +577,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -555,12 +594,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstwavparse.la: $(libgstwavparse_la_OBJECTS) $(libgstwavparse_la_DEPENDENCIES) $(EXTRA_libgstwavparse_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstwavparse_la_LINK) -rpath $(plugindir) $(libgstwavparse_la_OBJECTS) $(libgstwavparse_la_LIBADD) $(LIBS)
 
@@ -655,6 +696,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -799,18 +854,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/wavparse/gstwavparse.c b/gst/wavparse/gstwavparse.c
index 6c5e77b..719359b 100644
--- a/gst/wavparse/gstwavparse.c
+++ b/gst/wavparse/gstwavparse.c
@@ -87,6 +87,19 @@ static gboolean gst_wavparse_sink_event (GstPad * pad, GstEvent * event);
 static void gst_wavparse_loop (GstPad * pad);
 static gboolean gst_wavparse_srcpad_event (GstPad * pad, GstEvent * event);
 
+static void gst_wavparse_set_property (GObject * object, guint prop_id,
+    const GValue * value, GParamSpec * pspec);
+static void gst_wavparse_get_property (GObject * object, guint prop_id,
+    GValue * value, GParamSpec * pspec);
+
+#define DEFAULT_IGNORE_LENGTH FALSE
+
+enum
+{
+  PROP_0,
+  PROP_IGNORE_LENGTH,
+};
+
 static GstStaticPadTemplate sink_template_factory =
 GST_STATIC_PAD_TEMPLATE ("wavparse_sink",
     GST_PAD_SINK,
@@ -134,6 +147,27 @@ gst_wavparse_class_init (GstWavParseClass * klass)
 
   object_class->dispose = gst_wavparse_dispose;
 
+  object_class->set_property = gst_wavparse_set_property;
+  object_class->get_property = gst_wavparse_get_property;
+
+  /**
+   * GstWavParse:ignore-length
+   * 
+   * This selects whether the length found in a data chunk
+   * should be ignored. This may be useful for streamed audio
+   * where the length is unknown until the end of streaming,
+   * and various software/hardware just puts some random value
+   * in there and hopes it doesn't break too much.
+   *
+   * Since: 0.10.36
+   */
+  g_object_class_install_property (object_class, PROP_IGNORE_LENGTH,
+      g_param_spec_boolean ("ignore-length",
+          "Ignore length",
+          "Ignore length from the Wave header",
+          DEFAULT_IGNORE_LENGTH, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS)
+      );
+
   gstelement_class->change_state = gst_wavparse_change_state;
   gstelement_class->send_event = gst_wavparse_send_event;
 }
@@ -247,37 +281,6 @@ gst_wavparse_create_sourcepad (GstWavParse * wavparse)
   GST_DEBUG_OBJECT (wavparse, "srcpad created");
 }
 
-/* Compute (value * nom) % denom, avoiding overflow.  This can be used
- * to perform ceiling or rounding division together with
- * gst_util_uint64_scale[_int]. */
-#define uint64_scale_modulo(val, nom, denom) \
-  ((val % denom) * (nom % denom) % denom)
-
-/* Like gst_util_uint64_scale, but performs ceiling division. */
-static guint64
-uint64_ceiling_scale_int (guint64 val, gint num, gint denom)
-{
-  guint64 result = gst_util_uint64_scale_int (val, num, denom);
-
-  if (uint64_scale_modulo (val, num, denom) == 0)
-    return result;
-  else
-    return result + 1;
-}
-
-/* Like gst_util_uint64_scale, but performs ceiling division. */
-static guint64
-uint64_ceiling_scale (guint64 val, guint64 num, guint64 denom)
-{
-  guint64 result = gst_util_uint64_scale (val, num, denom);
-
-  if (uint64_scale_modulo (val, num, denom) == 0)
-    return result;
-  else
-    return result + 1;
-}
-
-
 /* FIXME: why is that not in use? */
 #if 0
 static void
@@ -565,7 +568,7 @@ gst_wavparse_fmt (GstWavParse * wav)
   gst_element_add_pad (GST_ELEMENT_CAST (wav), wav->srcpad);
   gst_element_no_more_pads (GST_ELEMENT_CAST (wav));
 
-  GST_DEBUG ("frequency %d, channels %d", wav->rate, wav->channels);
+  GST_DEBUG ("frequency %u, channels %u", wav->rate, wav->channels);
 
   return TRUE;
 
@@ -606,8 +609,8 @@ gst_wavparse_other (GstWavParse * wav)
     GST_WARNING_OBJECT (wav, "could not peek head");
     return FALSE;
   }
-  GST_DEBUG_OBJECT (wav, "got tag (%08x) %4.4s, length %d", tag,
-      (gchar *) & tag, length);
+  GST_DEBUG_OBJECT (wav, "got tag (%08x) %4.4s, length %u", tag,
+      (const gchar *) &tag, length);
 
   switch (tag) {
     case GST_RIFF_TAG_LIST:
@@ -758,12 +761,12 @@ gst_wavparse_time_to_bytepos (GstWavParse * wav, gint64 ts, gint64 * bytepos)
   }
 
   if (wav->bps > 0) {
-    *bytepos = uint64_ceiling_scale (ts, (guint64) wav->bps, GST_SECOND);
+    *bytepos = gst_util_uint64_scale_ceil (ts, (guint64) wav->bps, GST_SECOND);
     return TRUE;
   } else if (wav->fact) {
     guint64 bps =
         gst_util_uint64_scale_int (wav->datasize, wav->rate, wav->fact);
-    *bytepos = uint64_ceiling_scale (ts, bps, GST_SECOND);
+    *bytepos = gst_util_uint64_scale_ceil (ts, bps, GST_SECOND);
     return TRUE;
   }
 
@@ -1060,7 +1063,7 @@ gst_wavparse_peek_chunk_info (GstWavParse * wav, guint32 * tag, guint32 * size)
   *tag = GST_READ_UINT32_LE (data);
   *size = GST_READ_UINT32_LE (data + 4);
 
-  GST_DEBUG ("Next chunk size is %d bytes, type %" GST_FOURCC_FORMAT, *size,
+  GST_DEBUG ("Next chunk size is %u bytes, type %" GST_FOURCC_FORMAT, *size,
       GST_FOURCC_ARGS (*tag));
 
   return TRUE;
@@ -1090,7 +1093,7 @@ gst_wavparse_peek_chunk (GstWavParse * wav, guint32 * tag, guint32 * size)
    * so we throw poor man's exception, which can be caught if caller really
    * wants to handle 0 size chunk */
   if (!(*size) || (*size) >= (1 << 30)) {
-    GST_INFO ("Invalid/unexpected chunk size %d for tag %" GST_FOURCC_FORMAT,
+    GST_INFO ("Invalid/unexpected chunk size %u for tag %" GST_FOURCC_FORMAT,
         *size, GST_FOURCC_ARGS (*tag));
     /* chain should give up */
     wav->abort_buffering = TRUE;
@@ -1125,12 +1128,14 @@ gst_wavparse_calculate_duration (GstWavParse * wav)
   if (wav->bps > 0) {
     GST_INFO_OBJECT (wav, "Got datasize %" G_GUINT64_FORMAT, wav->datasize);
     wav->duration =
-        uint64_ceiling_scale (wav->datasize, GST_SECOND, (guint64) wav->bps);
+        gst_util_uint64_scale_ceil (wav->datasize, GST_SECOND,
+        (guint64) wav->bps);
     GST_INFO_OBJECT (wav, "Got duration (bps) %" GST_TIME_FORMAT,
         GST_TIME_ARGS (wav->duration));
     return TRUE;
   } else if (wav->fact) {
-    wav->duration = uint64_ceiling_scale_int (GST_SECOND, wav->fact, wav->rate);
+    wav->duration =
+        gst_util_uint64_scale_int_ceil (GST_SECOND, wav->fact, wav->rate);
     GST_INFO_OBJECT (wav, "Got duration (fact) %" GST_TIME_FORMAT,
         GST_TIME_ARGS (wav->duration));
     return TRUE;
@@ -1263,12 +1268,12 @@ gst_wavparse_stream_headers (GstWavParse * wav)
       {
         /* Note: workaround for mp2/mp3 embedded in wav, that relies on the
          * bitrate inside the mpeg stream */
-        GST_INFO ("resetting bps from %d to 0 for mp2/3", wav->av_bps);
+        GST_INFO ("resetting bps from %u to 0 for mp2/3", wav->av_bps);
         wav->bps = 0;
         break;
       }
       case GST_RIFF_WAVE_FORMAT_PCM:
-        if (wav->blockalign > wav->channels * (guint) ceil (wav->depth / 8.0))
+        if (wav->blockalign > wav->channels * ((wav->depth + 7) / 8))
           goto invalid_blockalign;
         /* fall through */
       default:
@@ -1347,7 +1352,11 @@ gst_wavparse_stream_headers (GstWavParse * wav)
      */
     switch (tag) {
       case GST_RIFF_TAG_data:{
-        GST_DEBUG_OBJECT (wav, "Got 'data' TAG, size : %d", size);
+        GST_DEBUG_OBJECT (wav, "Got 'data' TAG, size : %u", size);
+        if (wav->ignore_length) {
+          GST_DEBUG_OBJECT (wav, "Ignoring length");
+          size = 0;
+        }
         if (wav->streaming) {
           gst_adapter_flush (wav->adapter, 8);
           gotdata = TRUE;
@@ -1372,7 +1381,7 @@ gst_wavparse_stream_headers (GstWavParse * wav)
           /* We will continue parsing tags 'till end */
           wav->offset += size;
         }
-        GST_DEBUG_OBJECT (wav, "datasize = %d", size);
+        GST_DEBUG_OBJECT (wav, "datasize = %u", size);
         break;
       }
       case GST_RIFF_TAG_fact:{
@@ -1386,7 +1395,7 @@ gst_wavparse_stream_headers (GstWavParse * wav)
               /* need more data */
               goto exit;
             }
-            GST_DEBUG_OBJECT (wav, "need %d, available %d; ignoring chunk",
+            GST_DEBUG_OBJECT (wav, "need %u, available %u; ignoring chunk",
                 data_size, size);
             break;
           }
@@ -1431,7 +1440,7 @@ gst_wavparse_stream_headers (GstWavParse * wav)
             /* need more data */
             goto exit;
           }
-          GST_DEBUG_OBJECT (wav, "need %d, available %d; ignoring chunk",
+          GST_DEBUG_OBJECT (wav, "need %u, available %u; ignoring chunk",
               data_size, size);
           break;
         }
@@ -1559,18 +1568,20 @@ gst_wavparse_stream_headers (GstWavParse * wav)
     wav->bps =
         (guint32) gst_util_uint64_scale ((guint64) wav->rate, wav->datasize,
         (guint64) wav->fact);
-    GST_INFO_OBJECT (wav, "calculated bps : %d, enabling VBR", wav->bps);
+    GST_INFO_OBJECT (wav, "calculated bps : %u, enabling VBR", wav->bps);
 #endif
     wav->vbr = TRUE;
   }
 
   if (gst_wavparse_calculate_duration (wav)) {
     gst_segment_init (&wav->segment, GST_FORMAT_TIME);
-    gst_segment_set_duration (&wav->segment, GST_FORMAT_TIME, wav->duration);
+    if (!wav->ignore_length)
+      gst_segment_set_duration (&wav->segment, GST_FORMAT_TIME, wav->duration);
   } else {
     /* no bitrate, let downstream peer do the math, we'll feed it bytes. */
     gst_segment_init (&wav->segment, GST_FORMAT_BYTES);
-    gst_segment_set_duration (&wav->segment, GST_FORMAT_BYTES, wav->datasize);
+    if (!wav->ignore_length)
+      gst_segment_set_duration (&wav->segment, GST_FORMAT_BYTES, wav->datasize);
   }
 
   /* now we have all the info to perform a pending seek if any, if no
@@ -1597,7 +1608,7 @@ gst_wavparse_stream_headers (GstWavParse * wav)
   if (wav->blockalign > 0)
     wav->max_buf_size -= (wav->max_buf_size % wav->blockalign);
 
-  GST_DEBUG_OBJECT (wav, "max buffer size %d", wav->max_buf_size);
+  GST_DEBUG_OBJECT (wav, "max buffer size %u", wav->max_buf_size);
 
   return GST_FLOW_OK;
 
@@ -1646,7 +1657,7 @@ invalid_blockalign:
   {
     GST_ELEMENT_ERROR (wav, STREAM, FAILED, (NULL),
         ("Stream claims blockalign = %u, which is more than %u - invalid data",
-            wav->blockalign, wav->channels * (guint) ceil (wav->depth / 8.0)));
+            wav->blockalign, wav->channels * ((wav->depth + 7) / 8)));
     goto fail;
   }
 invalid_bps:
@@ -1665,7 +1676,7 @@ no_bytes_per_sample:
 unknown_format:
   {
     GST_ELEMENT_ERROR (wav, STREAM, TYPE_NOT_FOUND, (NULL),
-        ("No caps found for format 0x%x, %d channels, %d Hz",
+        ("No caps found for format 0x%x, %u channels, %u Hz",
             wav->format, wav->channels, wav->rate));
     goto fail;
   }
@@ -1868,13 +1879,13 @@ iterate_adapter:
     if (G_UNLIKELY (extra)) {
       extra = wav->bytes_per_sample - extra;
       if (extra <= avail) {
-        GST_DEBUG_OBJECT (wav, "flushing %d bytes to sample boundary", extra);
+        GST_DEBUG_OBJECT (wav, "flushing %u bytes to sample boundary", extra);
         gst_adapter_flush (wav->adapter, extra);
         wav->offset += extra;
         wav->dataleft -= extra;
         goto iterate_adapter;
       } else {
-        GST_DEBUG_OBJECT (wav, "flushing %d bytes", avail);
+        GST_DEBUG_OBJECT (wav, "flushing %u bytes", avail);
         gst_adapter_clear (wav->adapter);
         wav->offset += avail;
         wav->dataleft -= avail;
@@ -1883,7 +1894,7 @@ iterate_adapter:
     }
 
     if (avail < desired) {
-      GST_LOG_OBJECT (wav, "Got only %d bytes of data from the sinkpad", avail);
+      GST_LOG_OBJECT (wav, "Got only %u bytes of data from the sinkpad", avail);
       return GST_FLOW_OK;
     }
 
@@ -1936,9 +1947,10 @@ iterate_adapter:
 
   if (wav->bps > 0) {
     /* and timestamps if we have a bitrate, be careful for overflows */
-    timestamp = uint64_ceiling_scale (pos, GST_SECOND, (guint64) wav->bps);
+    timestamp =
+        gst_util_uint64_scale_ceil (pos, GST_SECOND, (guint64) wav->bps);
     next_timestamp =
-        uint64_ceiling_scale (nextpos, GST_SECOND, (guint64) wav->bps);
+        gst_util_uint64_scale_ceil (nextpos, GST_SECOND, (guint64) wav->bps);
     duration = next_timestamp - timestamp;
 
     /* update current running segment position */
@@ -1949,8 +1961,8 @@ iterate_adapter:
     guint64 bps =
         gst_util_uint64_scale_int (wav->datasize, wav->rate, wav->fact);
     /* and timestamps if we have a bitrate, be careful for overflows */
-    timestamp = uint64_ceiling_scale (pos, GST_SECOND, bps);
-    next_timestamp = uint64_ceiling_scale (nextpos, GST_SECOND, bps);
+    timestamp = gst_util_uint64_scale_ceil (pos, GST_SECOND, bps);
+    next_timestamp = gst_util_uint64_scale_ceil (nextpos, GST_SECOND, bps);
     duration = next_timestamp - timestamp;
   } else {
     /* no bitrate, all we know is that the first sample has timestamp 0, all
@@ -2237,10 +2249,12 @@ gst_wavparse_sink_event (GstPad * pad, GstEvent * event)
           if (bps) {
             if (start >= 0)
               start =
-                  uint64_ceiling_scale (start, GST_SECOND, (guint64) wav->bps);
+                  gst_util_uint64_scale_ceil (start, GST_SECOND,
+                  (guint64) wav->bps);
             if (stop >= 0)
               stop =
-                  uint64_ceiling_scale (stop, GST_SECOND, (guint64) wav->bps);
+                  gst_util_uint64_scale_ceil (stop, GST_SECOND,
+                  (guint64) wav->bps);
           }
         }
       } else {
@@ -2355,13 +2369,14 @@ gst_wavparse_pad_convert (GstPad * pad,
               "src=%" G_GINT64_FORMAT ", offset=%" G_GINT64_FORMAT, src_value,
               wavparse->offset);
           if (wavparse->bps > 0)
-            *dest_value = uint64_ceiling_scale (src_value, GST_SECOND,
+            *dest_value = gst_util_uint64_scale_ceil (src_value, GST_SECOND,
                 (guint64) wavparse->bps);
           else if (wavparse->fact) {
-            guint64 bps = uint64_ceiling_scale_int (wavparse->datasize,
+            guint64 bps = gst_util_uint64_scale_int_ceil (wavparse->datasize,
                 wavparse->rate, wavparse->fact);
 
-            *dest_value = uint64_ceiling_scale_int (src_value, GST_SECOND, bps);
+            *dest_value =
+                gst_util_uint64_scale_int_ceil (src_value, GST_SECOND, bps);
           } else {
             res = FALSE;
           }
@@ -2489,6 +2504,11 @@ gst_wavparse_pad_query (GstPad * pad, GstQuery * query)
       gint64 duration = 0;
       GstFormat format;
 
+      if (wav->ignore_length) {
+        res = FALSE;
+        break;
+      }
+
       gst_query_parse_duration (query, &format, NULL);
 
       switch (format) {
@@ -2657,6 +2677,43 @@ gst_wavparse_change_state (GstElement * element, GstStateChange transition)
   return ret;
 }
 
+static void
+gst_wavparse_set_property (GObject * object, guint prop_id,
+    const GValue * value, GParamSpec * pspec)
+{
+  GstWavParse *self;
+
+  g_return_if_fail (GST_IS_WAVPARSE (object));
+  self = GST_WAVPARSE (object);
+
+  switch (prop_id) {
+    case PROP_IGNORE_LENGTH:
+      self->ignore_length = g_value_get_boolean (value);
+      break;
+    default:
+      G_OBJECT_WARN_INVALID_PROPERTY_ID (self, prop_id, pspec);
+  }
+
+}
+
+static void
+gst_wavparse_get_property (GObject * object, guint prop_id,
+    GValue * value, GParamSpec * pspec)
+{
+  GstWavParse *self;
+
+  g_return_if_fail (GST_IS_WAVPARSE (object));
+  self = GST_WAVPARSE (object);
+
+  switch (prop_id) {
+    case PROP_IGNORE_LENGTH:
+      g_value_set_boolean (value, self->ignore_length);
+      break;
+    default:
+      G_OBJECT_WARN_INVALID_PROPERTY_ID (self, prop_id, pspec);
+  }
+}
+
 static gboolean
 plugin_init (GstPlugin * plugin)
 {
diff --git a/gst/wavparse/gstwavparse.h b/gst/wavparse/gstwavparse.h
index ecac968..972463f 100644
--- a/gst/wavparse/gstwavparse.h
+++ b/gst/wavparse/gstwavparse.h
@@ -118,6 +118,8 @@ struct _GstWavParse {
   gboolean first;
   /* discont after seek */
   gboolean discont;
+
+  gboolean ignore_length;
 };
 
 struct _GstWavParseClass {
diff --git a/gst/y4m/Makefile.in b/gst/y4m/Makefile.in
index 1791a24..62c79e8 100644
--- a/gst/y4m/Makefile.in
+++ b/gst/y4m/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/y4m
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -117,10 +133,23 @@ libgsty4menc_la_OBJECTS = $(am_libgsty4menc_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgsty4menc_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgsty4menc_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgsty4menc_la_CFLAGS) $(CFLAGS) \
 	$(libgsty4menc_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -133,22 +162,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgsty4menc_la_SOURCES)
 DIST_SOURCES = $(libgsty4menc_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -208,6 +238,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -256,8 +287,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -338,7 +371,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -398,6 +431,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -471,7 +505,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -518,7 +556,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -526,6 +563,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -541,12 +580,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgsty4menc.la: $(libgsty4menc_la_OBJECTS) $(libgsty4menc_la_DEPENDENCIES) $(EXTRA_libgsty4menc_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgsty4menc_la_LINK) -rpath $(plugindir) $(libgsty4menc_la_OBJECTS) $(libgsty4menc_la_LIBADD) $(LIBS)
 
@@ -641,6 +682,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -785,18 +840,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/ltmain.sh b/ltmain.sh
index c7d06c3..79fb897 100644
--- a/ltmain.sh
+++ b/ltmain.sh
@@ -70,7 +70,7 @@
 #         compiler:		$LTCC
 #         compiler flags:		$LTCFLAGS
 #         linker:		$LD (gnu? $with_gnu_ld)
-#         $progname:	(GNU libtool) 2.4.2 Debian-2.4.2-1
+#         $progname:	(GNU libtool) 2.4.2
 #         automake:	$automake_version
 #         autoconf:	$autoconf_version
 #
@@ -80,7 +80,7 @@
 
 PROGRAM=libtool
 PACKAGE=libtool
-VERSION="2.4.2 Debian-2.4.2-1"
+VERSION=2.4.2
 TIMESTAMP=""
 package_revision=1.3337
 
@@ -6124,10 +6124,7 @@ func_mode_link ()
 	case $pass in
 	dlopen) libs="$dlfiles" ;;
 	dlpreopen) libs="$dlprefiles" ;;
-	link)
-	  libs="$deplibs %DEPLIBS%"
-	  test "X$link_all_deplibs" != Xno && libs="$libs $dependency_libs"
-	  ;;
+	link) libs="$deplibs %DEPLIBS% $dependency_libs" ;;
 	esac
       fi
       if test "$linkmode,$pass" = "lib,dlpreopen"; then
@@ -6447,19 +6444,19 @@ func_mode_link ()
 	    # It is a libtool convenience library, so add in its objects.
 	    func_append convenience " $ladir/$objdir/$old_library"
 	    func_append old_convenience " $ladir/$objdir/$old_library"
-	    tmp_libs=
-	    for deplib in $dependency_libs; do
-	      deplibs="$deplib $deplibs"
-	      if $opt_preserve_dup_deps ; then
-		case "$tmp_libs " in
-		*" $deplib "*) func_append specialdeplibs " $deplib" ;;
-		esac
-	      fi
-	      func_append tmp_libs " $deplib"
-	    done
 	  elif test "$linkmode" != prog && test "$linkmode" != lib; then
 	    func_fatal_error "\`$lib' is not a convenience library"
 	  fi
+	  tmp_libs=
+	  for deplib in $dependency_libs; do
+	    deplibs="$deplib $deplibs"
+	    if $opt_preserve_dup_deps ; then
+	      case "$tmp_libs " in
+	      *" $deplib "*) func_append specialdeplibs " $deplib" ;;
+	      esac
+	    fi
+	    func_append tmp_libs " $deplib"
+	  done
 	  continue
 	fi # $pass = conv
 
@@ -6921,7 +6918,7 @@ func_mode_link ()
 	      fi
 	    else
 	      # We cannot seem to hardcode it, guess we'll fake it.
-	      add_dir="-L$libdir"
+	      add_dir="-L$lt_sysroot$libdir"
 	      # Try looking first in the location we're being installed to.
 	      if test -n "$inst_prefix_dir"; then
 		case $libdir in
@@ -7352,9 +7349,6 @@ func_mode_link ()
 	    revision="$number_minor"
 	    lt_irix_increment=no
 	    ;;
-	  *)
-	    func_fatal_configuration "$modename: unknown library version type \`$version_type'"
-	    ;;
 	  esac
 	  ;;
 	no)
diff --git a/m4/Makefile.in b/m4/Makefile.in
index b206372..ee6375d 100644
--- a/m4/Makefile.in
+++ b/m4/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,6 +14,23 @@
 
 @SET_MAKE@
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -33,6 +49,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = m4
 DIST_COMMON = README $(srcdir)/Makefile.am $(srcdir)/Makefile.in
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
@@ -40,7 +57,6 @@ am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -78,14 +94,25 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 AALIB_CFLAGS = @AALIB_CFLAGS@
 AALIB_CONFIG = @AALIB_CONFIG@
@@ -142,6 +169,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -190,8 +218,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -272,7 +302,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -332,6 +362,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -405,7 +436,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -494,6 +529,8 @@ TAGS:
 ctags: CTAGS
 CTAGS:
 
+cscope cscopelist:
+
 
 distdir: $(DISTFILES)
 	@srcdirstrip=`echo "$(srcdir)" | sed 's/[].[^$$\\*]/\\\\&/g'`; \
diff --git a/m4/glibc2.m4 b/m4/glibc2.m4
new file mode 100644
index 0000000..e8f5bfe
--- /dev/null
+++ b/m4/glibc2.m4
@@ -0,0 +1,30 @@
+# glibc2.m4 serial 1
+dnl Copyright (C) 2000-2002, 2004 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+# Test for the GNU C Library, version 2.0 or newer.
+# From Bruno Haible.
+
+AC_DEFUN([gt_GLIBC2],
+  [
+    AC_CACHE_CHECK(whether we are using the GNU C Library 2 or newer,
+      ac_cv_gnu_library_2,
+      [AC_EGREP_CPP([Lucky GNU user],
+	[
+#include <features.h>
+#ifdef __GNU_LIBRARY__
+ #if (__GLIBC__ >= 2)
+  Lucky GNU user
+ #endif
+#endif
+	],
+	ac_cv_gnu_library_2=yes,
+	ac_cv_gnu_library_2=no)
+      ]
+    )
+    AC_SUBST(GLIBC2)
+    GLIBC2="$ac_cv_gnu_library_2"
+  ]
+)
diff --git a/m4/intl.m4 b/m4/intl.m4
new file mode 100644
index 0000000..934408b
--- /dev/null
+++ b/m4/intl.m4
@@ -0,0 +1,285 @@
+# intl.m4 serial 8 (gettext-0.17)
+dnl Copyright (C) 1995-2007 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+dnl
+dnl This file can can be used in projects which are not available under
+dnl the GNU General Public License or the GNU Library General Public
+dnl License but which still want to provide support for the GNU gettext
+dnl functionality.
+dnl Please note that the actual code of the GNU gettext library is covered
+dnl by the GNU Library General Public License, and the rest of the GNU
+dnl gettext package package is covered by the GNU General Public License.
+dnl They are *not* in the public domain.
+
+dnl Authors:
+dnl   Ulrich Drepper <drepper@cygnus.com>, 1995-2000.
+dnl   Bruno Haible <haible@clisp.cons.org>, 2000-2006.
+
+AC_PREREQ(2.52)
+
+dnl Checks for all prerequisites of the intl subdirectory,
+dnl except for INTL_LIBTOOL_SUFFIX_PREFIX (and possibly LIBTOOL), INTLOBJS,
+dnl            USE_INCLUDED_LIBINTL, BUILD_INCLUDED_LIBINTL.
+AC_DEFUN([AM_INTL_SUBDIR],
+[
+  AC_REQUIRE([AC_PROG_INSTALL])dnl
+  AC_REQUIRE([AM_PROG_MKDIR_P])dnl defined by automake
+  AC_REQUIRE([AC_PROG_CC])dnl
+  AC_REQUIRE([AC_CANONICAL_HOST])dnl
+  AC_REQUIRE([gt_GLIBC2])dnl
+  AC_REQUIRE([AC_PROG_RANLIB])dnl
+  AC_REQUIRE([gl_VISIBILITY])dnl
+  AC_REQUIRE([gt_INTL_SUBDIR_CORE])dnl
+  AC_REQUIRE([AC_TYPE_LONG_LONG_INT])dnl
+  AC_REQUIRE([gt_TYPE_WCHAR_T])dnl
+  AC_REQUIRE([gt_TYPE_WINT_T])dnl
+  AC_REQUIRE([gl_AC_HEADER_INTTYPES_H])
+  AC_REQUIRE([gt_TYPE_INTMAX_T])
+  AC_REQUIRE([gt_PRINTF_POSIX])
+  AC_REQUIRE([gl_GLIBC21])dnl
+  AC_REQUIRE([gl_XSIZE])dnl
+  AC_REQUIRE([gt_INTL_MACOSX])dnl
+
+  AC_CHECK_TYPE([ptrdiff_t], ,
+    [AC_DEFINE([ptrdiff_t], [long],
+       [Define as the type of the result of subtracting two pointers, if the system doesn't define it.])
+    ])
+  AC_CHECK_HEADERS([stddef.h stdlib.h string.h])
+  AC_CHECK_FUNCS([asprintf fwprintf putenv setenv setlocale snprintf wcslen])
+
+  dnl Use the _snprintf function only if it is declared (because on NetBSD it
+  dnl is defined as a weak alias of snprintf; we prefer to use the latter).
+  gt_CHECK_DECL(_snprintf, [#include <stdio.h>])
+  gt_CHECK_DECL(_snwprintf, [#include <stdio.h>])
+
+  dnl Use the *_unlocked functions only if they are declared.
+  dnl (because some of them were defined without being declared in Solaris
+  dnl 2.5.1 but were removed in Solaris 2.6, whereas we want binaries built
+  dnl on Solaris 2.5.1 to run on Solaris 2.6).
+  dnl Don't use AC_CHECK_DECLS because it isn't supported in autoconf-2.13.
+  gt_CHECK_DECL(getc_unlocked, [#include <stdio.h>])
+
+  case $gt_cv_func_printf_posix in
+    *yes) HAVE_POSIX_PRINTF=1 ;;
+    *) HAVE_POSIX_PRINTF=0 ;;
+  esac
+  AC_SUBST([HAVE_POSIX_PRINTF])
+  if test "$ac_cv_func_asprintf" = yes; then
+    HAVE_ASPRINTF=1
+  else
+    HAVE_ASPRINTF=0
+  fi
+  AC_SUBST([HAVE_ASPRINTF])
+  if test "$ac_cv_func_snprintf" = yes; then
+    HAVE_SNPRINTF=1
+  else
+    HAVE_SNPRINTF=0
+  fi
+  AC_SUBST([HAVE_SNPRINTF])
+  if test "$ac_cv_func_wprintf" = yes; then
+    HAVE_WPRINTF=1
+  else
+    HAVE_WPRINTF=0
+  fi
+  AC_SUBST([HAVE_WPRINTF])
+
+  AM_LANGINFO_CODESET
+  gt_LC_MESSAGES
+
+  dnl Compilation on mingw and Cygwin needs special Makefile rules, because
+  dnl 1. when we install a shared library, we must arrange to export
+  dnl    auxiliary pointer variables for every exported variable,
+  dnl 2. when we install a shared library and a static library simultaneously,
+  dnl    the include file specifies __declspec(dllimport) and therefore we
+  dnl    must arrange to define the auxiliary pointer variables for the
+  dnl    exported variables _also_ in the static library.
+  if test "$enable_shared" = yes; then
+    case "$host_os" in
+      mingw* | cygwin*) is_woe32dll=yes ;;
+      *) is_woe32dll=no ;;
+    esac
+  else
+    is_woe32dll=no
+  fi
+  WOE32DLL=$is_woe32dll
+  AC_SUBST([WOE32DLL])
+
+  dnl On mingw and Cygwin, we can activate special Makefile rules which add
+  dnl version information to the shared libraries and executables.
+  case "$host_os" in
+    mingw* | cygwin*) is_woe32=yes ;;
+    *) is_woe32=no ;;
+  esac
+  WOE32=$is_woe32
+  AC_SUBST([WOE32])
+  if test $WOE32 = yes; then
+    dnl Check for a program that compiles Windows resource files.
+    AC_CHECK_TOOL([WINDRES], [windres])
+  fi
+
+  dnl Determine whether when creating a library, "-lc" should be passed to
+  dnl libtool or not. On many platforms, it is required for the libtool option
+  dnl -no-undefined to work. On HP-UX, however, the -lc - stored by libtool
+  dnl in the *.la files - makes it impossible to create multithreaded programs,
+  dnl because libtool also reorders the -lc to come before the -pthread, and
+  dnl this disables pthread_create() <http://docs.hp.com/en/1896/pthreads.html>.
+  case "$host_os" in
+    hpux*) LTLIBC="" ;;
+    *)     LTLIBC="-lc" ;;
+  esac
+  AC_SUBST([LTLIBC])
+
+  dnl Rename some macros and functions used for locking.
+  AH_BOTTOM([
+#define __libc_lock_t                   gl_lock_t
+#define __libc_lock_define              gl_lock_define
+#define __libc_lock_define_initialized  gl_lock_define_initialized
+#define __libc_lock_init                gl_lock_init
+#define __libc_lock_lock                gl_lock_lock
+#define __libc_lock_unlock              gl_lock_unlock
+#define __libc_lock_recursive_t                   gl_recursive_lock_t
+#define __libc_lock_define_recursive              gl_recursive_lock_define
+#define __libc_lock_define_initialized_recursive  gl_recursive_lock_define_initialized
+#define __libc_lock_init_recursive                gl_recursive_lock_init
+#define __libc_lock_lock_recursive                gl_recursive_lock_lock
+#define __libc_lock_unlock_recursive              gl_recursive_lock_unlock
+#define glthread_in_use  libintl_thread_in_use
+#define glthread_lock_init     libintl_lock_init
+#define glthread_lock_lock     libintl_lock_lock
+#define glthread_lock_unlock   libintl_lock_unlock
+#define glthread_lock_destroy  libintl_lock_destroy
+#define glthread_rwlock_init     libintl_rwlock_init
+#define glthread_rwlock_rdlock   libintl_rwlock_rdlock
+#define glthread_rwlock_wrlock   libintl_rwlock_wrlock
+#define glthread_rwlock_unlock   libintl_rwlock_unlock
+#define glthread_rwlock_destroy  libintl_rwlock_destroy
+#define glthread_recursive_lock_init     libintl_recursive_lock_init
+#define glthread_recursive_lock_lock     libintl_recursive_lock_lock
+#define glthread_recursive_lock_unlock   libintl_recursive_lock_unlock
+#define glthread_recursive_lock_destroy  libintl_recursive_lock_destroy
+#define glthread_once                 libintl_once
+#define glthread_once_call            libintl_once_call
+#define glthread_once_singlethreaded  libintl_once_singlethreaded
+])
+])
+
+
+dnl Checks for the core files of the intl subdirectory:
+dnl   dcigettext.c
+dnl   eval-plural.h
+dnl   explodename.c
+dnl   finddomain.c
+dnl   gettextP.h
+dnl   gmo.h
+dnl   hash-string.h hash-string.c
+dnl   l10nflist.c
+dnl   libgnuintl.h.in (except the *printf stuff)
+dnl   loadinfo.h
+dnl   loadmsgcat.c
+dnl   localealias.c
+dnl   log.c
+dnl   plural-exp.h plural-exp.c
+dnl   plural.y
+dnl Used by libglocale.
+AC_DEFUN([gt_INTL_SUBDIR_CORE],
+[
+  AC_REQUIRE([AC_C_INLINE])dnl
+  AC_REQUIRE([AC_TYPE_SIZE_T])dnl
+  AC_REQUIRE([gl_AC_HEADER_STDINT_H])
+  AC_REQUIRE([AC_FUNC_ALLOCA])dnl
+  AC_REQUIRE([AC_FUNC_MMAP])dnl
+  AC_REQUIRE([gt_INTDIV0])dnl
+  AC_REQUIRE([gl_AC_TYPE_UINTMAX_T])dnl
+  AC_REQUIRE([gt_INTTYPES_PRI])dnl
+  AC_REQUIRE([gl_LOCK])dnl
+
+  AC_TRY_LINK(
+    [int foo (int a) { a = __builtin_expect (a, 10); return a == 10 ? 0 : 1; }],
+    [],
+    [AC_DEFINE([HAVE_BUILTIN_EXPECT], 1,
+       [Define to 1 if the compiler understands __builtin_expect.])])
+
+  AC_CHECK_HEADERS([argz.h inttypes.h limits.h unistd.h sys/param.h])
+  AC_CHECK_FUNCS([getcwd getegid geteuid getgid getuid mempcpy munmap \
+    stpcpy strcasecmp strdup strtoul tsearch argz_count argz_stringify \
+    argz_next __fsetlocking])
+
+  dnl Use the *_unlocked functions only if they are declared.
+  dnl (because some of them were defined without being declared in Solaris
+  dnl 2.5.1 but were removed in Solaris 2.6, whereas we want binaries built
+  dnl on Solaris 2.5.1 to run on Solaris 2.6).
+  dnl Don't use AC_CHECK_DECLS because it isn't supported in autoconf-2.13.
+  gt_CHECK_DECL(feof_unlocked, [#include <stdio.h>])
+  gt_CHECK_DECL(fgets_unlocked, [#include <stdio.h>])
+
+  AM_ICONV
+
+  dnl glibc >= 2.4 has a NL_LOCALE_NAME macro when _GNU_SOURCE is defined,
+  dnl and a _NL_LOCALE_NAME macro always.
+  AC_CACHE_CHECK([for NL_LOCALE_NAME macro], gt_cv_nl_locale_name,
+    [AC_TRY_LINK([#include <langinfo.h>
+#include <locale.h>],
+      [char* cs = nl_langinfo(_NL_LOCALE_NAME(LC_MESSAGES));
+       return !cs;
+      ],
+      gt_cv_nl_locale_name=yes,
+      gt_cv_nl_locale_name=no)
+    ])
+  if test $gt_cv_nl_locale_name = yes; then
+    AC_DEFINE(HAVE_NL_LOCALE_NAME, 1,
+      [Define if you have <langinfo.h> and it defines the NL_LOCALE_NAME macro if _GNU_SOURCE is defined.])
+  fi
+
+  dnl intl/plural.c is generated from intl/plural.y. It requires bison,
+  dnl because plural.y uses bison specific features. It requires at least
+  dnl bison-1.26 because earlier versions generate a plural.c that doesn't
+  dnl compile.
+  dnl bison is only needed for the maintainer (who touches plural.y). But in
+  dnl order to avoid separate Makefiles or --enable-maintainer-mode, we put
+  dnl the rule in general Makefile. Now, some people carelessly touch the
+  dnl files or have a broken "make" program, hence the plural.c rule will
+  dnl sometimes fire. To avoid an error, defines BISON to ":" if it is not
+  dnl present or too old.
+  AC_CHECK_PROGS([INTLBISON], [bison])
+  if test -z "$INTLBISON"; then
+    ac_verc_fail=yes
+  else
+    dnl Found it, now check the version.
+    AC_MSG_CHECKING([version of bison])
+changequote(<<,>>)dnl
+    ac_prog_version=`$INTLBISON --version 2>&1 | sed -n 's/^.*GNU Bison.* \([0-9]*\.[0-9.]*\).*$/\1/p'`
+    case $ac_prog_version in
+      '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
+      1.2[6-9]* | 1.[3-9][0-9]* | [2-9].*)
+changequote([,])dnl
+         ac_prog_version="$ac_prog_version, ok"; ac_verc_fail=no;;
+      *) ac_prog_version="$ac_prog_version, bad"; ac_verc_fail=yes;;
+    esac
+    AC_MSG_RESULT([$ac_prog_version])
+  fi
+  if test $ac_verc_fail = yes; then
+    INTLBISON=:
+  fi
+])
+
+
+dnl gt_CHECK_DECL(FUNC, INCLUDES)
+dnl Check whether a function is declared.
+AC_DEFUN([gt_CHECK_DECL],
+[
+  AC_CACHE_CHECK([whether $1 is declared], ac_cv_have_decl_$1,
+    [AC_TRY_COMPILE([$2], [
+#ifndef $1
+  char *p = (char *) $1;
+#endif
+], ac_cv_have_decl_$1=yes, ac_cv_have_decl_$1=no)])
+  if test $ac_cv_have_decl_$1 = yes; then
+    gt_value=1
+  else
+    gt_value=0
+  fi
+  AC_DEFINE_UNQUOTED([HAVE_DECL_]translit($1, [a-z], [A-Z]), [$gt_value],
+    [Define to 1 if you have the declaration of `$1', and to 0 if you don't.])
+])
diff --git a/m4/intldir.m4 b/m4/intldir.m4
new file mode 100644
index 0000000..7a28843
--- /dev/null
+++ b/m4/intldir.m4
@@ -0,0 +1,19 @@
+# intldir.m4 serial 1 (gettext-0.16)
+dnl Copyright (C) 2006 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+dnl
+dnl This file can can be used in projects which are not available under
+dnl the GNU General Public License or the GNU Library General Public
+dnl License but which still want to provide support for the GNU gettext
+dnl functionality.
+dnl Please note that the actual code of the GNU gettext library is covered
+dnl by the GNU Library General Public License, and the rest of the GNU
+dnl gettext package package is covered by the GNU General Public License.
+dnl They are *not* in the public domain.
+
+AC_PREREQ(2.52)
+
+dnl Tells the AM_GNU_GETTEXT macro to consider an intl/ directory.
+AC_DEFUN([AM_GNU_GETTEXT_INTL_SUBDIR], [])
diff --git a/m4/intmax.m4 b/m4/intmax.m4
new file mode 100644
index 0000000..ce7a8a4
--- /dev/null
+++ b/m4/intmax.m4
@@ -0,0 +1,33 @@
+# intmax.m4 serial 3 (gettext-0.16)
+dnl Copyright (C) 2002-2005 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+dnl Test whether the system has the 'intmax_t' type, but don't attempt to
+dnl find a replacement if it is lacking.
+
+AC_DEFUN([gt_TYPE_INTMAX_T],
+[
+  AC_REQUIRE([gl_AC_HEADER_INTTYPES_H])
+  AC_REQUIRE([gl_AC_HEADER_STDINT_H])
+  AC_CACHE_CHECK(for intmax_t, gt_cv_c_intmax_t,
+    [AC_TRY_COMPILE([
+#include <stddef.h>
+#include <stdlib.h>
+#if HAVE_STDINT_H_WITH_UINTMAX
+#include <stdint.h>
+#endif
+#if HAVE_INTTYPES_H_WITH_UINTMAX
+#include <inttypes.h>
+#endif
+],     [intmax_t x = -1;
+        return !x;],
+       gt_cv_c_intmax_t=yes,
+       gt_cv_c_intmax_t=no)])
+  if test $gt_cv_c_intmax_t = yes; then
+    AC_DEFINE(HAVE_INTMAX_T, 1,
+      [Define if you have the 'intmax_t' type in <stdint.h> or <inttypes.h>.])
+  fi
+])
diff --git a/m4/libtool.m4 b/m4/libtool.m4
index 828104c..327d0bd 100644
--- a/m4/libtool.m4
+++ b/m4/libtool.m4
@@ -2684,18 +2684,6 @@ linux* | k*bsd*-gnu | kopensolaris*-gnu)
   dynamic_linker='GNU/Linux ld.so'
   ;;
 
-netbsdelf*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='NetBSD ld.elf_so'
-  ;;
-
 netbsd*)
   version_type=sunos
   need_lib_prefix=no
@@ -3301,7 +3289,7 @@ linux* | k*bsd*-gnu | kopensolaris*-gnu)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-netbsd* | netbsdelf*-gnu)
+netbsd*)
   if echo __ELF__ | $CC -E - | $GREP __ELF__ > /dev/null; then
     lt_cv_deplibs_check_method='match_pattern /lib[[^/]]+(\.so\.[[0-9]]+\.[[0-9]]+|_pic\.a)$'
   else
@@ -4113,7 +4101,7 @@ m4_if([$1], [CXX], [
 	    ;;
 	esac
 	;;
-      netbsd* | netbsdelf*-gnu)
+      netbsd*)
 	;;
       *qnx* | *nto*)
         # QNX uses GNU C++, but need to define -shared option too, otherwise
@@ -4590,9 +4578,6 @@ m4_if([$1], [CXX], [
       ;;
     esac
     ;;
-  linux* | k*bsd*-gnu | gnu*)
-    _LT_TAGVAR(link_all_deplibs, $1)=no
-    ;;
   *)
     _LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
     ;;
@@ -4655,9 +4640,6 @@ dnl Note also adjust exclude_expsyms for C++ above.
   openbsd*)
     with_gnu_ld=no
     ;;
-  linux* | k*bsd*-gnu | gnu*)
-    _LT_TAGVAR(link_all_deplibs, $1)=no
-    ;;
   esac
 
   _LT_TAGVAR(ld_shlibs, $1)=yes
@@ -4879,7 +4861,7 @@ _LT_EOF
       fi
       ;;
 
-    netbsd* | netbsdelf*-gnu)
+    netbsd*)
       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
 	_LT_TAGVAR(archive_cmds, $1)='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
 	wlarc=
@@ -5056,7 +5038,6 @@ _LT_EOF
 	if test "$aix_use_runtimelinking" = yes; then
 	  shared_flag="$shared_flag "'${wl}-G'
 	fi
-	_LT_TAGVAR(link_all_deplibs, $1)=no
       else
 	# not using gcc
 	if test "$host_cpu" = ia64; then
@@ -5361,7 +5342,7 @@ _LT_EOF
       _LT_TAGVAR(link_all_deplibs, $1)=yes
       ;;
 
-    netbsd* | netbsdelf*-gnu)
+    netbsd*)
       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
 	_LT_TAGVAR(archive_cmds, $1)='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'  # a.out
       else
@@ -5938,8 +5919,13 @@ if test "$_lt_caught_CXX_error" != yes; then
       # Check if GNU C++ uses GNU ld as the underlying linker, since the
       # archiving commands below assume that GNU ld is being used.
       if test "$with_gnu_ld" = yes; then
-        _LT_TAGVAR(archive_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
-        _LT_TAGVAR(archive_expsym_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+        if test "$cross_compiling" = yes; then
+          _LT_TAGVAR(archive_cmds, $1)='$CC $pic_flag $compiler_flags -shared $libobjs $deplibs ${wl}-soname $wl$soname -o $lib'
+          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC $pic_flag $compiler_flags -shared $libobjs $deplibs ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+        else
+          _LT_TAGVAR(archive_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
+          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+        fi
 
         _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
         _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
@@ -7036,23 +7022,27 @@ if AC_TRY_EVAL(ac_compile); then
        if test "$pre_test_object_deps_done" = no; then
 	 case ${prev} in
 	 -L | -R)
-	   # Internal compiler library paths should come after those
-	   # provided the user.  The postdeps already come after the
-	   # user supplied libs so there is no need to process them.
-	   if test -z "$_LT_TAGVAR(compiler_lib_search_path, $1)"; then
-	     _LT_TAGVAR(compiler_lib_search_path, $1)="${prev}${p}"
-	   else
-	     _LT_TAGVAR(compiler_lib_search_path, $1)="${_LT_TAGVAR(compiler_lib_search_path, $1)} ${prev}${p}"
+	   if test "$cross_compiling" != yes; then
+	     # Internal compiler library paths should come after those
+	     # provided the user.  The postdeps already come after the
+	     # user supplied libs so there is no need to process them.
+	     if test -z "$_LT_TAGVAR(compiler_lib_search_path, $1)"; then
+	       _LT_TAGVAR(compiler_lib_search_path, $1)="${prev}${p}"
+	     else
+	       _LT_TAGVAR(compiler_lib_search_path, $1)="${_LT_TAGVAR(compiler_lib_search_path, $1)} ${prev}${p}"
+	     fi
 	   fi
 	   ;;
 	 # The "-l" case would never come before the object being
 	 # linked, so don't bother handling this case.
 	 esac
        else
-	 if test -z "$_LT_TAGVAR(postdeps, $1)"; then
-	   _LT_TAGVAR(postdeps, $1)="${prev}${p}"
-	 else
-	   _LT_TAGVAR(postdeps, $1)="${_LT_TAGVAR(postdeps, $1)} ${prev}${p}"
+	 if test "$cross_compiling" != yes; then
+	   if test -z "$_LT_TAGVAR(postdeps, $1)"; then
+	     _LT_TAGVAR(postdeps, $1)="${prev}${p}"
+	   else
+	     _LT_TAGVAR(postdeps, $1)="${_LT_TAGVAR(postdeps, $1)} ${prev}${p}"
+	   fi
 	 fi
        fi
        prev=
@@ -7067,17 +7057,19 @@ if AC_TRY_EVAL(ac_compile); then
 	 continue
        fi
 
-       if test "$pre_test_object_deps_done" = no; then
-	 if test -z "$_LT_TAGVAR(predep_objects, $1)"; then
-	   _LT_TAGVAR(predep_objects, $1)="$p"
-	 else
-	   _LT_TAGVAR(predep_objects, $1)="$_LT_TAGVAR(predep_objects, $1) $p"
-	 fi
-       else
-	 if test -z "$_LT_TAGVAR(postdep_objects, $1)"; then
-	   _LT_TAGVAR(postdep_objects, $1)="$p"
+       if test "$cross_compiling" != yes; then
+	 if test "$pre_test_object_deps_done" = no; then
+	   if test -z "$_LT_TAGVAR(predep_objects, $1)"; then
+	     _LT_TAGVAR(predep_objects, $1)="$p"
+	   else
+	     _LT_TAGVAR(predep_objects, $1)="$_LT_TAGVAR(predep_objects, $1) $p"
+	   fi
 	 else
-	   _LT_TAGVAR(postdep_objects, $1)="$_LT_TAGVAR(postdep_objects, $1) $p"
+	   if test -z "$_LT_TAGVAR(postdep_objects, $1)"; then
+	     _LT_TAGVAR(postdep_objects, $1)="$p"
+	   else
+	     _LT_TAGVAR(postdep_objects, $1)="$_LT_TAGVAR(postdep_objects, $1) $p"
+	   fi
 	 fi
        fi
        ;;
diff --git a/m4/lock.m4 b/m4/lock.m4
new file mode 100644
index 0000000..9111933
--- /dev/null
+++ b/m4/lock.m4
@@ -0,0 +1,316 @@
+# lock.m4 serial 7 (gettext-0.17)
+dnl Copyright (C) 2005-2007 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+
+dnl Tests for a multithreading library to be used.
+dnl Defines at most one of the macros USE_POSIX_THREADS, USE_SOLARIS_THREADS,
+dnl USE_PTH_THREADS, USE_WIN32_THREADS
+dnl Sets the variables LIBTHREAD and LTLIBTHREAD to the linker options for use
+dnl in a Makefile (LIBTHREAD for use without libtool, LTLIBTHREAD for use with
+dnl libtool).
+dnl Sets the variables LIBMULTITHREAD and LTLIBMULTITHREAD similarly, for
+dnl programs that really need multithread functionality. The difference
+dnl between LIBTHREAD and LIBMULTITHREAD is that on platforms supporting weak
+dnl symbols, typically LIBTHREAD="" whereas LIBMULTITHREAD="-lpthread".
+dnl Adds to CPPFLAGS the flag -D_REENTRANT or -D_THREAD_SAFE if needed for
+dnl multithread-safe programs.
+
+AC_DEFUN([gl_LOCK_EARLY],
+[
+  AC_REQUIRE([gl_LOCK_EARLY_BODY])
+])
+
+dnl The guts of gl_LOCK_EARLY. Needs to be expanded only once.
+
+AC_DEFUN([gl_LOCK_EARLY_BODY],
+[
+  dnl Ordering constraints: This macro modifies CPPFLAGS in a way that
+  dnl influences the result of the autoconf tests that test for *_unlocked
+  dnl declarations, on AIX 5 at least. Therefore it must come early.
+  AC_BEFORE([$0], [gl_FUNC_GLIBC_UNLOCKED_IO])dnl
+  AC_BEFORE([$0], [gl_ARGP])dnl
+
+  AC_REQUIRE([AC_CANONICAL_HOST])
+  dnl _GNU_SOURCE is needed for pthread_rwlock_t on glibc systems.
+  dnl AC_USE_SYSTEM_EXTENSIONS was introduced in autoconf 2.60 and obsoletes
+  dnl AC_GNU_SOURCE.
+  m4_ifdef([AC_USE_SYSTEM_EXTENSIONS],
+    [AC_REQUIRE([AC_USE_SYSTEM_EXTENSIONS])],
+    [AC_REQUIRE([AC_GNU_SOURCE])])
+  dnl Check for multithreading.
+  AC_ARG_ENABLE(threads,
+AC_HELP_STRING([--enable-threads={posix|solaris|pth|win32}], [specify multithreading API])
+AC_HELP_STRING([--disable-threads], [build without multithread safety]),
+    [gl_use_threads=$enableval],
+    [case "$host_os" in
+       dnl Disable multithreading by default on OSF/1, because it interferes
+       dnl with fork()/exec(): When msgexec is linked with -lpthread, its child
+       dnl process gets an endless segmentation fault inside execvp().
+       osf*) gl_use_threads=no ;;
+       *)    gl_use_threads=yes ;;
+     esac
+    ])
+  if test "$gl_use_threads" = yes || test "$gl_use_threads" = posix; then
+    # For using <pthread.h>:
+    case "$host_os" in
+      osf*)
+        # On OSF/1, the compiler needs the flag -D_REENTRANT so that it
+        # groks <pthread.h>. cc also understands the flag -pthread, but
+        # we don't use it because 1. gcc-2.95 doesn't understand -pthread,
+        # 2. putting a flag into CPPFLAGS that has an effect on the linker
+        # causes the AC_TRY_LINK test below to succeed unexpectedly,
+        # leading to wrong values of LIBTHREAD and LTLIBTHREAD.
+        CPPFLAGS="$CPPFLAGS -D_REENTRANT"
+        ;;
+    esac
+    # Some systems optimize for single-threaded programs by default, and
+    # need special flags to disable these optimizations. For example, the
+    # definition of 'errno' in <errno.h>.
+    case "$host_os" in
+      aix* | freebsd*) CPPFLAGS="$CPPFLAGS -D_THREAD_SAFE" ;;
+      solaris*) CPPFLAGS="$CPPFLAGS -D_REENTRANT" ;;
+    esac
+  fi
+])
+
+dnl The guts of gl_LOCK. Needs to be expanded only once.
+
+AC_DEFUN([gl_LOCK_BODY],
+[
+  AC_REQUIRE([gl_LOCK_EARLY_BODY])
+  gl_threads_api=none
+  LIBTHREAD=
+  LTLIBTHREAD=
+  LIBMULTITHREAD=
+  LTLIBMULTITHREAD=
+  if test "$gl_use_threads" != no; then
+    dnl Check whether the compiler and linker support weak declarations.
+    AC_MSG_CHECKING([whether imported symbols can be declared weak])
+    gl_have_weak=no
+    AC_TRY_LINK([extern void xyzzy ();
+#pragma weak xyzzy], [xyzzy();], [gl_have_weak=yes])
+    AC_MSG_RESULT([$gl_have_weak])
+    if test "$gl_use_threads" = yes || test "$gl_use_threads" = posix; then
+      # On OSF/1, the compiler needs the flag -pthread or -D_REENTRANT so that
+      # it groks <pthread.h>. It's added above, in gl_LOCK_EARLY_BODY.
+      AC_CHECK_HEADER(pthread.h, gl_have_pthread_h=yes, gl_have_pthread_h=no)
+      if test "$gl_have_pthread_h" = yes; then
+        # Other possible tests:
+        #   -lpthreads (FSU threads, PCthreads)
+        #   -lgthreads
+        gl_have_pthread=
+        # Test whether both pthread_mutex_lock and pthread_mutexattr_init exist
+        # in libc. IRIX 6.5 has the first one in both libc and libpthread, but
+        # the second one only in libpthread, and lock.c needs it.
+        AC_TRY_LINK([#include <pthread.h>],
+          [pthread_mutex_lock((pthread_mutex_t*)0);
+           pthread_mutexattr_init((pthread_mutexattr_t*)0);],
+          [gl_have_pthread=yes])
+        # Test for libpthread by looking for pthread_kill. (Not pthread_self,
+        # since it is defined as a macro on OSF/1.)
+        if test -n "$gl_have_pthread"; then
+          # The program links fine without libpthread. But it may actually
+          # need to link with libpthread in order to create multiple threads.
+          AC_CHECK_LIB(pthread, pthread_kill,
+            [LIBMULTITHREAD=-lpthread LTLIBMULTITHREAD=-lpthread
+             # On Solaris and HP-UX, most pthread functions exist also in libc.
+             # Therefore pthread_in_use() needs to actually try to create a
+             # thread: pthread_create from libc will fail, whereas
+             # pthread_create will actually create a thread.
+             case "$host_os" in
+               solaris* | hpux*)
+                 AC_DEFINE([PTHREAD_IN_USE_DETECTION_HARD], 1,
+                   [Define if the pthread_in_use() detection is hard.])
+             esac
+            ])
+        else
+          # Some library is needed. Try libpthread and libc_r.
+          AC_CHECK_LIB(pthread, pthread_kill,
+            [gl_have_pthread=yes
+             LIBTHREAD=-lpthread LTLIBTHREAD=-lpthread
+             LIBMULTITHREAD=-lpthread LTLIBMULTITHREAD=-lpthread])
+          if test -z "$gl_have_pthread"; then
+            # For FreeBSD 4.
+            AC_CHECK_LIB(c_r, pthread_kill,
+              [gl_have_pthread=yes
+               LIBTHREAD=-lc_r LTLIBTHREAD=-lc_r
+               LIBMULTITHREAD=-lc_r LTLIBMULTITHREAD=-lc_r])
+          fi
+        fi
+        if test -n "$gl_have_pthread"; then
+          gl_threads_api=posix
+          AC_DEFINE([USE_POSIX_THREADS], 1,
+            [Define if the POSIX multithreading library can be used.])
+          if test -n "$LIBMULTITHREAD" || test -n "$LTLIBMULTITHREAD"; then
+            if test $gl_have_weak = yes; then
+              AC_DEFINE([USE_POSIX_THREADS_WEAK], 1,
+                [Define if references to the POSIX multithreading library should be made weak.])
+              LIBTHREAD=
+              LTLIBTHREAD=
+            fi
+          fi
+          # OSF/1 4.0 and MacOS X 10.1 lack the pthread_rwlock_t type and the
+          # pthread_rwlock_* functions.
+          AC_CHECK_TYPE([pthread_rwlock_t],
+            [AC_DEFINE([HAVE_PTHREAD_RWLOCK], 1,
+               [Define if the POSIX multithreading library has read/write locks.])],
+            [],
+            [#include <pthread.h>])
+          # glibc defines PTHREAD_MUTEX_RECURSIVE as enum, not as a macro.
+          AC_TRY_COMPILE([#include <pthread.h>],
+            [#if __FreeBSD__ == 4
+error "No, in FreeBSD 4.0 recursive mutexes actually don't work."
+#else
+int x = (int)PTHREAD_MUTEX_RECURSIVE;
+return !x;
+#endif],
+            [AC_DEFINE([HAVE_PTHREAD_MUTEX_RECURSIVE], 1,
+               [Define if the <pthread.h> defines PTHREAD_MUTEX_RECURSIVE.])])
+        fi
+      fi
+    fi
+    if test -z "$gl_have_pthread"; then
+      if test "$gl_use_threads" = yes || test "$gl_use_threads" = solaris; then
+        gl_have_solaristhread=
+        gl_save_LIBS="$LIBS"
+        LIBS="$LIBS -lthread"
+        AC_TRY_LINK([#include <thread.h>
+#include <synch.h>],
+          [thr_self();],
+          [gl_have_solaristhread=yes])
+        LIBS="$gl_save_LIBS"
+        if test -n "$gl_have_solaristhread"; then
+          gl_threads_api=solaris
+          LIBTHREAD=-lthread
+          LTLIBTHREAD=-lthread
+          LIBMULTITHREAD="$LIBTHREAD"
+          LTLIBMULTITHREAD="$LTLIBTHREAD"
+          AC_DEFINE([USE_SOLARIS_THREADS], 1,
+            [Define if the old Solaris multithreading library can be used.])
+          if test $gl_have_weak = yes; then
+            AC_DEFINE([USE_SOLARIS_THREADS_WEAK], 1,
+              [Define if references to the old Solaris multithreading library should be made weak.])
+            LIBTHREAD=
+            LTLIBTHREAD=
+          fi
+        fi
+      fi
+    fi
+    if test "$gl_use_threads" = pth; then
+      gl_save_CPPFLAGS="$CPPFLAGS"
+      AC_LIB_LINKFLAGS(pth)
+      gl_have_pth=
+      gl_save_LIBS="$LIBS"
+      LIBS="$LIBS -lpth"
+      AC_TRY_LINK([#include <pth.h>], [pth_self();], gl_have_pth=yes)
+      LIBS="$gl_save_LIBS"
+      if test -n "$gl_have_pth"; then
+        gl_threads_api=pth
+        LIBTHREAD="$LIBPTH"
+        LTLIBTHREAD="$LTLIBPTH"
+        LIBMULTITHREAD="$LIBTHREAD"
+        LTLIBMULTITHREAD="$LTLIBTHREAD"
+        AC_DEFINE([USE_PTH_THREADS], 1,
+          [Define if the GNU Pth multithreading library can be used.])
+        if test -n "$LIBMULTITHREAD" || test -n "$LTLIBMULTITHREAD"; then
+          if test $gl_have_weak = yes; then
+            AC_DEFINE([USE_PTH_THREADS_WEAK], 1,
+              [Define if references to the GNU Pth multithreading library should be made weak.])
+            LIBTHREAD=
+            LTLIBTHREAD=
+          fi
+        fi
+      else
+        CPPFLAGS="$gl_save_CPPFLAGS"
+      fi
+    fi
+    if test -z "$gl_have_pthread"; then
+      if test "$gl_use_threads" = yes || test "$gl_use_threads" = win32; then
+        if { case "$host_os" in
+               mingw*) true;;
+               *) false;;
+             esac
+           }; then
+          gl_threads_api=win32
+          AC_DEFINE([USE_WIN32_THREADS], 1,
+            [Define if the Win32 multithreading API can be used.])
+        fi
+      fi
+    fi
+  fi
+  AC_MSG_CHECKING([for multithread API to use])
+  AC_MSG_RESULT([$gl_threads_api])
+  AC_SUBST(LIBTHREAD)
+  AC_SUBST(LTLIBTHREAD)
+  AC_SUBST(LIBMULTITHREAD)
+  AC_SUBST(LTLIBMULTITHREAD)
+])
+
+AC_DEFUN([gl_LOCK],
+[
+  AC_REQUIRE([gl_LOCK_EARLY])
+  AC_REQUIRE([gl_LOCK_BODY])
+  gl_PREREQ_LOCK
+])
+
+# Prerequisites of lib/lock.c.
+AC_DEFUN([gl_PREREQ_LOCK], [
+  AC_REQUIRE([AC_C_INLINE])
+])
+
+dnl Survey of platforms:
+dnl
+dnl Platform          Available   Compiler    Supports   test-lock
+dnl                   flavours    option      weak       result
+dnl ---------------   ---------   ---------   --------   ---------
+dnl Linux 2.4/glibc   posix       -lpthread       Y      OK
+dnl
+dnl GNU Hurd/glibc    posix
+dnl
+dnl FreeBSD 5.3       posix       -lc_r           Y
+dnl                   posix       -lkse ?         Y
+dnl                   posix       -lpthread ?     Y
+dnl                   posix       -lthr           Y
+dnl
+dnl FreeBSD 5.2       posix       -lc_r           Y
+dnl                   posix       -lkse           Y
+dnl                   posix       -lthr           Y
+dnl
+dnl FreeBSD 4.0,4.10  posix       -lc_r           Y      OK
+dnl
+dnl NetBSD 1.6        --
+dnl
+dnl OpenBSD 3.4       posix       -lpthread       Y      OK
+dnl
+dnl MacOS X 10.[123]  posix       -lpthread       Y      OK
+dnl
+dnl Solaris 7,8,9     posix       -lpthread       Y      Sol 7,8: 0.0; Sol 9: OK
+dnl                   solaris     -lthread        Y      Sol 7,8: 0.0; Sol 9: OK
+dnl
+dnl HP-UX 11          posix       -lpthread       N (cc) OK
+dnl                                               Y (gcc)
+dnl
+dnl IRIX 6.5          posix       -lpthread       Y      0.5
+dnl
+dnl AIX 4.3,5.1       posix       -lpthread       N      AIX 4: 0.5; AIX 5: OK
+dnl
+dnl OSF/1 4.0,5.1     posix       -pthread (cc)   N      OK
+dnl                               -lpthread (gcc) Y
+dnl
+dnl Cygwin            posix       -lpthread       Y      OK
+dnl
+dnl Any of the above  pth         -lpth                  0.0
+dnl
+dnl Mingw             win32                       N      OK
+dnl
+dnl BeOS 5            --
+dnl
+dnl The test-lock result shows what happens if in test-lock.c EXPLICIT_YIELD is
+dnl turned off:
+dnl   OK if all three tests terminate OK,
+dnl   0.5 if the first test terminates OK but the second one loops endlessly,
+dnl   0.0 if the first test already loops endlessly.
diff --git a/m4/longlong.m4 b/m4/longlong.m4
new file mode 100644
index 0000000..a72e53b
--- /dev/null
+++ b/m4/longlong.m4
@@ -0,0 +1,109 @@
+# longlong.m4 serial 13
+dnl Copyright (C) 1999-2007 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Paul Eggert.
+
+# Define HAVE_LONG_LONG_INT if 'long long int' works.
+# This fixes a bug in Autoconf 2.61, but can be removed once we
+# assume 2.62 everywhere.
+
+# Note: If the type 'long long int' exists but is only 32 bits large
+# (as on some very old compilers), HAVE_LONG_LONG_INT will not be
+# defined. In this case you can treat 'long long int' like 'long int'.
+
+AC_DEFUN([AC_TYPE_LONG_LONG_INT],
+[
+  AC_CACHE_CHECK([for long long int], [ac_cv_type_long_long_int],
+    [AC_LINK_IFELSE(
+       [_AC_TYPE_LONG_LONG_SNIPPET],
+       [dnl This catches a bug in Tandem NonStop Kernel (OSS) cc -O circa 2004.
+	dnl If cross compiling, assume the bug isn't important, since
+	dnl nobody cross compiles for this platform as far as we know.
+	AC_RUN_IFELSE(
+	  [AC_LANG_PROGRAM(
+	     [[@%:@include <limits.h>
+	       @%:@ifndef LLONG_MAX
+	       @%:@ define HALF \
+			(1LL << (sizeof (long long int) * CHAR_BIT - 2))
+	       @%:@ define LLONG_MAX (HALF - 1 + HALF)
+	       @%:@endif]],
+	     [[long long int n = 1;
+	       int i;
+	       for (i = 0; ; i++)
+		 {
+		   long long int m = n << i;
+		   if (m >> i != n)
+		     return 1;
+		   if (LLONG_MAX / 2 < m)
+		     break;
+		 }
+	       return 0;]])],
+	  [ac_cv_type_long_long_int=yes],
+	  [ac_cv_type_long_long_int=no],
+	  [ac_cv_type_long_long_int=yes])],
+       [ac_cv_type_long_long_int=no])])
+  if test $ac_cv_type_long_long_int = yes; then
+    AC_DEFINE([HAVE_LONG_LONG_INT], 1,
+      [Define to 1 if the system has the type `long long int'.])
+  fi
+])
+
+# Define HAVE_UNSIGNED_LONG_LONG_INT if 'unsigned long long int' works.
+# This fixes a bug in Autoconf 2.61, but can be removed once we
+# assume 2.62 everywhere.
+
+# Note: If the type 'unsigned long long int' exists but is only 32 bits
+# large (as on some very old compilers), AC_TYPE_UNSIGNED_LONG_LONG_INT
+# will not be defined. In this case you can treat 'unsigned long long int'
+# like 'unsigned long int'.
+
+AC_DEFUN([AC_TYPE_UNSIGNED_LONG_LONG_INT],
+[
+  AC_CACHE_CHECK([for unsigned long long int],
+    [ac_cv_type_unsigned_long_long_int],
+    [AC_LINK_IFELSE(
+       [_AC_TYPE_LONG_LONG_SNIPPET],
+       [ac_cv_type_unsigned_long_long_int=yes],
+       [ac_cv_type_unsigned_long_long_int=no])])
+  if test $ac_cv_type_unsigned_long_long_int = yes; then
+    AC_DEFINE([HAVE_UNSIGNED_LONG_LONG_INT], 1,
+      [Define to 1 if the system has the type `unsigned long long int'.])
+  fi
+])
+
+# Expands to a C program that can be used to test for simultaneous support
+# of 'long long' and 'unsigned long long'. We don't want to say that
+# 'long long' is available if 'unsigned long long' is not, or vice versa,
+# because too many programs rely on the symmetry between signed and unsigned
+# integer types (excluding 'bool').
+AC_DEFUN([_AC_TYPE_LONG_LONG_SNIPPET],
+[
+  AC_LANG_PROGRAM(
+    [[/* Test preprocessor.  */
+      #if ! (-9223372036854775807LL < 0 && 0 < 9223372036854775807ll)
+        error in preprocessor;
+      #endif
+      #if ! (18446744073709551615ULL <= -1ull)
+        error in preprocessor;
+      #endif
+      /* Test literals.  */
+      long long int ll = 9223372036854775807ll;
+      long long int nll = -9223372036854775807LL;
+      unsigned long long int ull = 18446744073709551615ULL;
+      /* Test constant expressions.   */
+      typedef int a[((-9223372036854775807LL < 0 && 0 < 9223372036854775807ll)
+		     ? 1 : -1)];
+      typedef int b[(18446744073709551615ULL <= (unsigned long long int) -1
+		     ? 1 : -1)];
+      int i = 63;]],
+    [[/* Test availability of runtime routines for shift and division.  */
+      long long int llmax = 9223372036854775807ll;
+      unsigned long long int ullmax = 18446744073709551615ull;
+      return ((ll << 63) | (ll >> 63) | (ll < i) | (ll > i)
+	      | (llmax / ll) | (llmax % ll)
+	      | (ull << 63) | (ull >> 63) | (ull << i) | (ull >> i)
+	      | (ullmax / ull) | (ullmax % ull));]])
+])
diff --git a/m4/printf-posix.m4 b/m4/printf-posix.m4
new file mode 100644
index 0000000..14ba612
--- /dev/null
+++ b/m4/printf-posix.m4
@@ -0,0 +1,44 @@
+# printf-posix.m4 serial 3 (gettext-0.17)
+dnl Copyright (C) 2003, 2007 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+dnl Test whether the printf() function supports POSIX/XSI format strings with
+dnl positions.
+
+AC_DEFUN([gt_PRINTF_POSIX],
+[
+  AC_REQUIRE([AC_PROG_CC])
+  AC_CACHE_CHECK([whether printf() supports POSIX/XSI format strings],
+    gt_cv_func_printf_posix,
+    [
+      AC_TRY_RUN([
+#include <stdio.h>
+#include <string.h>
+/* The string "%2$d %1$d", with dollar characters protected from the shell's
+   dollar expansion (possibly an autoconf bug).  */
+static char format[] = { '%', '2', '$', 'd', ' ', '%', '1', '$', 'd', '\0' };
+static char buf[100];
+int main ()
+{
+  sprintf (buf, format, 33, 55);
+  return (strcmp (buf, "55 33") != 0);
+}], gt_cv_func_printf_posix=yes, gt_cv_func_printf_posix=no,
+      [
+        AC_EGREP_CPP(notposix, [
+#if defined __NetBSD__ || defined __BEOS__ || defined _MSC_VER || defined __MINGW32__ || defined __CYGWIN__
+  notposix
+#endif
+        ], gt_cv_func_printf_posix="guessing no",
+           gt_cv_func_printf_posix="guessing yes")
+      ])
+    ])
+  case $gt_cv_func_printf_posix in
+    *yes)
+      AC_DEFINE(HAVE_POSIX_PRINTF, 1,
+        [Define if your printf() function supports format strings with positions.])
+      ;;
+  esac
+])
diff --git a/m4/size_max.m4 b/m4/size_max.m4
new file mode 100644
index 0000000..6cb4868
--- /dev/null
+++ b/m4/size_max.m4
@@ -0,0 +1,68 @@
+# size_max.m4 serial 6
+dnl Copyright (C) 2003, 2005-2006 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+
+AC_DEFUN([gl_SIZE_MAX],
+[
+  AC_CHECK_HEADERS(stdint.h)
+  dnl First test whether the system already has SIZE_MAX.
+  AC_MSG_CHECKING([for SIZE_MAX])
+  AC_CACHE_VAL([gl_cv_size_max], [
+    gl_cv_size_max=
+    AC_EGREP_CPP([Found it], [
+#include <limits.h>
+#if HAVE_STDINT_H
+#include <stdint.h>
+#endif
+#ifdef SIZE_MAX
+Found it
+#endif
+], gl_cv_size_max=yes)
+    if test -z "$gl_cv_size_max"; then
+      dnl Define it ourselves. Here we assume that the type 'size_t' is not wider
+      dnl than the type 'unsigned long'. Try hard to find a definition that can
+      dnl be used in a preprocessor #if, i.e. doesn't contain a cast.
+      AC_COMPUTE_INT([size_t_bits_minus_1], [sizeof (size_t) * CHAR_BIT - 1],
+        [#include <stddef.h>
+#include <limits.h>], size_t_bits_minus_1=)
+      AC_COMPUTE_INT([fits_in_uint], [sizeof (size_t) <= sizeof (unsigned int)],
+        [#include <stddef.h>], fits_in_uint=)
+      if test -n "$size_t_bits_minus_1" && test -n "$fits_in_uint"; then
+        if test $fits_in_uint = 1; then
+          dnl Even though SIZE_MAX fits in an unsigned int, it must be of type
+          dnl 'unsigned long' if the type 'size_t' is the same as 'unsigned long'.
+          AC_TRY_COMPILE([#include <stddef.h>
+            extern size_t foo;
+            extern unsigned long foo;
+            ], [], fits_in_uint=0)
+        fi
+        dnl We cannot use 'expr' to simplify this expression, because 'expr'
+        dnl works only with 'long' integers in the host environment, while we
+        dnl might be cross-compiling from a 32-bit platform to a 64-bit platform.
+        if test $fits_in_uint = 1; then
+          gl_cv_size_max="(((1U << $size_t_bits_minus_1) - 1) * 2 + 1)"
+        else
+          gl_cv_size_max="(((1UL << $size_t_bits_minus_1) - 1) * 2 + 1)"
+        fi
+      else
+        dnl Shouldn't happen, but who knows...
+        gl_cv_size_max='((size_t)~(size_t)0)'
+      fi
+    fi
+  ])
+  AC_MSG_RESULT([$gl_cv_size_max])
+  if test "$gl_cv_size_max" != yes; then
+    AC_DEFINE_UNQUOTED([SIZE_MAX], [$gl_cv_size_max],
+      [Define as the maximum value of type 'size_t', if the system doesn't define it.])
+  fi
+])
+
+dnl Autoconf >= 2.61 has AC_COMPUTE_INT built-in.
+dnl Remove this when we can assume autoconf >= 2.61.
+m4_ifdef([AC_COMPUTE_INT], [], [
+  AC_DEFUN([AC_COMPUTE_INT], [_AC_COMPUTE_INT([$2],[$1],[$3],[$4])])
+])
diff --git a/m4/visibility.m4 b/m4/visibility.m4
new file mode 100644
index 0000000..2ff6330
--- /dev/null
+++ b/m4/visibility.m4
@@ -0,0 +1,52 @@
+# visibility.m4 serial 1 (gettext-0.15)
+dnl Copyright (C) 2005 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+
+dnl Tests whether the compiler supports the command-line option
+dnl -fvisibility=hidden and the function and variable attributes
+dnl __attribute__((__visibility__("hidden"))) and
+dnl __attribute__((__visibility__("default"))).
+dnl Does *not* test for __visibility__("protected") - which has tricky
+dnl semantics (see the 'vismain' test in glibc) and does not exist e.g. on
+dnl MacOS X.
+dnl Does *not* test for __visibility__("internal") - which has processor
+dnl dependent semantics.
+dnl Does *not* test for #pragma GCC visibility push(hidden) - which is
+dnl "really only recommended for legacy code".
+dnl Set the variable CFLAG_VISIBILITY.
+dnl Defines and sets the variable HAVE_VISIBILITY.
+
+AC_DEFUN([gl_VISIBILITY],
+[
+  AC_REQUIRE([AC_PROG_CC])
+  CFLAG_VISIBILITY=
+  HAVE_VISIBILITY=0
+  if test -n "$GCC"; then
+    AC_MSG_CHECKING([for simple visibility declarations])
+    AC_CACHE_VAL(gl_cv_cc_visibility, [
+      gl_save_CFLAGS="$CFLAGS"
+      CFLAGS="$CFLAGS -fvisibility=hidden"
+      AC_TRY_COMPILE(
+        [extern __attribute__((__visibility__("hidden"))) int hiddenvar;
+         extern __attribute__((__visibility__("default"))) int exportedvar;
+         extern __attribute__((__visibility__("hidden"))) int hiddenfunc (void);
+         extern __attribute__((__visibility__("default"))) int exportedfunc (void);],
+        [],
+        gl_cv_cc_visibility=yes,
+        gl_cv_cc_visibility=no)
+      CFLAGS="$gl_save_CFLAGS"])
+    AC_MSG_RESULT([$gl_cv_cc_visibility])
+    if test $gl_cv_cc_visibility = yes; then
+      CFLAG_VISIBILITY="-fvisibility=hidden"
+      HAVE_VISIBILITY=1
+    fi
+  fi
+  AC_SUBST([CFLAG_VISIBILITY])
+  AC_SUBST([HAVE_VISIBILITY])
+  AC_DEFINE_UNQUOTED([HAVE_VISIBILITY], [$HAVE_VISIBILITY],
+    [Define to 1 or 0, depending whether the compiler supports simple visibility declarations.])
+])
diff --git a/m4/wchar_t.m4 b/m4/wchar_t.m4
new file mode 100644
index 0000000..cde2129
--- /dev/null
+++ b/m4/wchar_t.m4
@@ -0,0 +1,20 @@
+# wchar_t.m4 serial 1 (gettext-0.12)
+dnl Copyright (C) 2002-2003 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+dnl Test whether <stddef.h> has the 'wchar_t' type.
+dnl Prerequisite: AC_PROG_CC
+
+AC_DEFUN([gt_TYPE_WCHAR_T],
+[
+  AC_CACHE_CHECK([for wchar_t], gt_cv_c_wchar_t,
+    [AC_TRY_COMPILE([#include <stddef.h>
+       wchar_t foo = (wchar_t)'\0';], ,
+       gt_cv_c_wchar_t=yes, gt_cv_c_wchar_t=no)])
+  if test $gt_cv_c_wchar_t = yes; then
+    AC_DEFINE(HAVE_WCHAR_T, 1, [Define if you have the 'wchar_t' type.])
+  fi
+])
diff --git a/m4/wint_t.m4 b/m4/wint_t.m4
new file mode 100644
index 0000000..af5ed93
--- /dev/null
+++ b/m4/wint_t.m4
@@ -0,0 +1,28 @@
+# wint_t.m4 serial 2 (gettext-0.17)
+dnl Copyright (C) 2003, 2007 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+dnl Test whether <wchar.h> has the 'wint_t' type.
+dnl Prerequisite: AC_PROG_CC
+
+AC_DEFUN([gt_TYPE_WINT_T],
+[
+  AC_CACHE_CHECK([for wint_t], gt_cv_c_wint_t,
+    [AC_TRY_COMPILE([
+/* Tru64 with Desktop Toolkit C has a bug: <stdio.h> must be included before
+   <wchar.h>.
+   BSD/OS 4.0.1 has a bug: <stddef.h>, <stdio.h> and <time.h> must be included
+   before <wchar.h>.  */
+#include <stddef.h>
+#include <stdio.h>
+#include <time.h>
+#include <wchar.h>
+       wint_t foo = (wchar_t)'\0';], ,
+       gt_cv_c_wint_t=yes, gt_cv_c_wint_t=no)])
+  if test $gt_cv_c_wint_t = yes; then
+    AC_DEFINE(HAVE_WINT_T, 1, [Define if you have the 'wint_t' type.])
+  fi
+])
diff --git a/m4/xsize.m4 b/m4/xsize.m4
new file mode 100644
index 0000000..85bb721
--- /dev/null
+++ b/m4/xsize.m4
@@ -0,0 +1,13 @@
+# xsize.m4 serial 3
+dnl Copyright (C) 2003-2004 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+AC_DEFUN([gl_XSIZE],
+[
+  dnl Prerequisites of lib/xsize.h.
+  AC_REQUIRE([gl_SIZE_MAX])
+  AC_REQUIRE([AC_C_INLINE])
+  AC_CHECK_HEADERS(stdint.h)
+])
diff --git a/pkgconfig/Makefile.in b/pkgconfig/Makefile.in
index 7a5838e..0a318e6 100644
--- a/pkgconfig/Makefile.in
+++ b/pkgconfig/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,6 +14,23 @@
 
 @SET_MAKE@
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -33,6 +49,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = pkgconfig
 DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
 	$(srcdir)/gstreamer-plugins-good-uninstalled.pc.in
@@ -41,7 +58,6 @@ am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -79,14 +95,25 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES = gstreamer-plugins-good-uninstalled.pc
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 AALIB_CFLAGS = @AALIB_CFLAGS@
 AALIB_CONFIG = @AALIB_CONFIG@
@@ -143,6 +170,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -191,8 +219,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -273,7 +303,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -333,6 +363,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -406,7 +437,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -480,6 +515,8 @@ TAGS:
 ctags: CTAGS
 CTAGS:
 
+cscope cscopelist:
+
 
 distdir: $(DISTFILES)
 	@srcdirstrip=`echo "$(srcdir)" | sed 's/[].[^$$\\*]/\\\\&/g'`; \
diff --git a/po/Makefile.in.in.orig b/po/Makefile.in.in.orig
new file mode 100644
index 0000000..fecf500
--- /dev/null
+++ b/po/Makefile.in.in.orig
@@ -0,0 +1,429 @@
+# Makefile for PO directory in any package using GNU gettext.
+# Copyright (C) 1995-1997, 2000-2007 by Ulrich Drepper <drepper@gnu.ai.mit.edu>
+#
+# This file can be copied and used freely without restrictions.  It can
+# be used in projects which are not available under the GNU General Public
+# License but which still want to provide support for the GNU gettext
+# functionality.
+# Please note that the actual code of GNU gettext is covered by the GNU
+# General Public License and is *not* in the public domain.
+#
+# Origin: gettext-0.17
+GETTEXT_MACRO_VERSION = 0.17
+
+PACKAGE = @PACKAGE@
+VERSION = @VERSION@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+
+SHELL = /bin/sh
+@SET_MAKE@
+
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+VPATH = @srcdir@
+
+prefix = @prefix@
+exec_prefix = @exec_prefix@
+datarootdir = @datarootdir@
+datadir = @datadir@
+localedir = @localedir@
+gettextsrcdir = $(datadir)/gettext/po
+
+INSTALL = @INSTALL@
+INSTALL_DATA = @INSTALL_DATA@
+
+# We use $(mkdir_p).
+# In automake <= 1.9.x, $(mkdir_p) is defined either as "mkdir -p --" or as
+# "$(mkinstalldirs)" or as "$(install_sh) -d". For these automake versions,
+# @install_sh@ does not start with $(SHELL), so we add it.
+# In automake >= 1.10, @mkdir_p@ is derived from ${MKDIR_P}, which is defined
+# either as "/path/to/mkdir -p" or ".../install-sh -c -d". For these automake
+# versions, $(mkinstalldirs) and $(install_sh) are unused.
+mkinstalldirs = $(SHELL) @install_sh@ -d
+install_sh = $(SHELL) @install_sh@
+MKDIR_P = @MKDIR_P@
+mkdir_p = @mkdir_p@
+
+GMSGFMT_ = @GMSGFMT@
+GMSGFMT_no = @GMSGFMT@
+GMSGFMT_yes = @GMSGFMT_015@
+GMSGFMT = $(GMSGFMT_$(USE_MSGCTXT))
+MSGFMT_ = @MSGFMT@
+MSGFMT_no = @MSGFMT@
+MSGFMT_yes = @MSGFMT_015@
+MSGFMT = $(MSGFMT_$(USE_MSGCTXT))
+XGETTEXT_ = @XGETTEXT@
+XGETTEXT_no = @XGETTEXT@
+XGETTEXT_yes = @XGETTEXT_015@
+XGETTEXT = $(XGETTEXT_$(USE_MSGCTXT))
+MSGMERGE = msgmerge
+MSGMERGE_UPDATE = @MSGMERGE@ --update
+MSGINIT = msginit
+MSGCONV = msgconv
+MSGFILTER = msgfilter
+
+POFILES = @POFILES@
+GMOFILES = @GMOFILES@
+UPDATEPOFILES = @UPDATEPOFILES@
+DUMMYPOFILES = @DUMMYPOFILES@
+DISTFILES.common = Makefile.in.in remove-potcdate.sin \
+$(DISTFILES.common.extra1) $(DISTFILES.common.extra2) $(DISTFILES.common.extra3)
+DISTFILES = $(DISTFILES.common) Makevars POTFILES.in \
+$(POFILES) $(GMOFILES) \
+$(DISTFILES.extra1) $(DISTFILES.extra2) $(DISTFILES.extra3)
+
+POTFILES = \
+
+CATALOGS = @CATALOGS@
+
+# Makevars gets inserted here. (Don't remove this line!)
+
+.SUFFIXES:
+.SUFFIXES: .po .gmo .mo .sed .sin .nop .po-create .po-update
+
+.po.mo:
+	@echo "$(MSGFMT) -c -o $@ $<"; \
+	$(MSGFMT) -c -o t-$@ $< && mv t-$@ $@
+
+.po.gmo:
+	@lang=`echo $* | sed -e 's,.*/,,'`; \
+	test "$(srcdir)" = . && cdcmd="" || cdcmd="cd $(srcdir) && "; \
+	echo "$${cdcmd}rm -f $${lang}.gmo && $(GMSGFMT) -c --statistics -o $${lang}.gmo $${lang}.po"; \
+	cd $(srcdir) && rm -f $${lang}.gmo && $(GMSGFMT) -c --statistics -o t-$${lang}.gmo $${lang}.po && mv t-$${lang}.gmo $${lang}.gmo
+
+.sin.sed:
+	sed -e '/^#/d' $< > t-$@
+	mv t-$@ $@
+
+
+all: check-macro-version all-@USE_NLS@
+
+all-yes: stamp-po
+all-no:
+
+# Ensure that the gettext macros and this Makefile.in.in are in sync.
+check-macro-version:
+	@test "$(GETTEXT_MACRO_VERSION)" = "@GETTEXT_MACRO_VERSION@" \
+	  || { echo "*** error: gettext infrastructure mismatch: using a Makefile.in.in from gettext version $(GETTEXT_MACRO_VERSION) but the autoconf macros are from gettext version @GETTEXT_MACRO_VERSION@" 1>&2; \
+	       exit 1; \
+	     }
+
+# $(srcdir)/$(DOMAIN).pot is only created when needed. When xgettext finds no
+# internationalized messages, no $(srcdir)/$(DOMAIN).pot is created (because
+# we don't want to bother translators with empty POT files). We assume that
+# LINGUAS is empty in this case, i.e. $(POFILES) and $(GMOFILES) are empty.
+# In this case, stamp-po is a nop (i.e. a phony target).
+
+# stamp-po is a timestamp denoting the last time at which the CATALOGS have
+# been loosely updated. Its purpose is that when a developer or translator
+# checks out the package via CVS, and the $(DOMAIN).pot file is not in CVS,
+# "make" will update the $(DOMAIN).pot and the $(CATALOGS), but subsequent
+# invocations of "make" will do nothing. This timestamp would not be necessary
+# if updating the $(CATALOGS) would always touch them; however, the rule for
+# $(POFILES) has been designed to not touch files that don't need to be
+# changed.
+stamp-po: $(srcdir)/$(DOMAIN).pot
+	test ! -f $(srcdir)/$(DOMAIN).pot || \
+	  test -z "$(GMOFILES)" || $(MAKE) $(GMOFILES)
+	@test ! -f $(srcdir)/$(DOMAIN).pot || { \
+	  echo "touch stamp-po" && \
+	  echo timestamp > stamp-poT && \
+	  mv stamp-poT stamp-po; \
+	}
+
+# Note: Target 'all' must not depend on target '$(DOMAIN).pot-update',
+# otherwise packages like GCC can not be built if only parts of the source
+# have been downloaded.
+
+# This target rebuilds $(DOMAIN).pot; it is an expensive operation.
+# Note that $(DOMAIN).pot is not touched if it doesn't need to be changed.
+$(DOMAIN).pot-update: $(POTFILES) $(srcdir)/POTFILES.in remove-potcdate.sed
+	if LC_ALL=C grep 'GNU @PACKAGE@' $(top_srcdir)/* 2>/dev/null | grep -v 'libtool:' >/dev/null; then \
+	  package_gnu='GNU '; \
+	else \
+	  package_gnu=''; \
+	fi; \
+	if test -n '$(MSGID_BUGS_ADDRESS)' || test '$(PACKAGE_BUGREPORT)' = '@'PACKAGE_BUGREPORT'@'; then \
+	  msgid_bugs_address='$(MSGID_BUGS_ADDRESS)'; \
+	else \
+	  msgid_bugs_address='$(PACKAGE_BUGREPORT)'; \
+	fi; \
+	case `$(XGETTEXT) --version | sed 1q | sed -e 's,^[^0-9]*,,'` in \
+	  '' | 0.[0-9] | 0.[0-9].* | 0.1[0-5] | 0.1[0-5].* | 0.16 | 0.16.[0-1]*) \
+	    $(XGETTEXT) --default-domain=$(DOMAIN) --directory=$(top_srcdir) \
+	      --add-comments=TRANSLATORS: $(XGETTEXT_OPTIONS) @XGETTEXT_EXTRA_OPTIONS@ \
+	      --files-from=$(srcdir)/POTFILES.in \
+	      --copyright-holder='$(COPYRIGHT_HOLDER)' \
+	      --msgid-bugs-address="$$msgid_bugs_address" \
+	    ;; \
+	  *) \
+	    $(XGETTEXT) --default-domain=$(DOMAIN) --directory=$(top_srcdir) \
+	      --add-comments=TRANSLATORS: $(XGETTEXT_OPTIONS) @XGETTEXT_EXTRA_OPTIONS@ \
+	      --files-from=$(srcdir)/POTFILES.in \
+	      --copyright-holder='$(COPYRIGHT_HOLDER)' \
+	      --package-name="$${package_gnu}@PACKAGE@" \
+	      --package-version='@VERSION@' \
+	      --msgid-bugs-address="$$msgid_bugs_address" \
+	    ;; \
+	esac
+	test ! -f $(DOMAIN).po || { \
+	  if test -f $(srcdir)/$(DOMAIN).pot; then \
+	    sed -f remove-potcdate.sed < $(srcdir)/$(DOMAIN).pot > $(DOMAIN).1po && \
+	    sed -f remove-potcdate.sed < $(DOMAIN).po > $(DOMAIN).2po && \
+	    if cmp $(DOMAIN).1po $(DOMAIN).2po >/dev/null 2>&1; then \
+	      rm -f $(DOMAIN).1po $(DOMAIN).2po $(DOMAIN).po; \
+	    else \
+	      rm -f $(DOMAIN).1po $(DOMAIN).2po $(srcdir)/$(DOMAIN).pot && \
+	      mv $(DOMAIN).po $(srcdir)/$(DOMAIN).pot; \
+	    fi; \
+	  else \
+	    mv $(DOMAIN).po $(srcdir)/$(DOMAIN).pot; \
+	  fi; \
+	}
+
+# This rule has no dependencies: we don't need to update $(DOMAIN).pot at
+# every "make" invocation, only create it when it is missing.
+# Only "make $(DOMAIN).pot-update" or "make dist" will force an update.
+$(srcdir)/$(DOMAIN).pot:
+	$(MAKE) $(DOMAIN).pot-update
+
+# This target rebuilds a PO file if $(DOMAIN).pot has changed.
+# Note that a PO file is not touched if it doesn't need to be changed.
+$(POFILES): $(srcdir)/$(DOMAIN).pot
+	@lang=`echo $@ | sed -e 's,.*/,,' -e 's/\.po$$//'`; \
+	if test -f "$(srcdir)/$${lang}.po"; then \
+	  test "$(srcdir)" = . && cdcmd="" || cdcmd="cd $(srcdir) && "; \
+	  echo "$${cdcmd}$(MSGMERGE_UPDATE) $${lang}.po $(DOMAIN).pot"; \
+	  cd $(srcdir) && $(MSGMERGE_UPDATE) $${lang}.po $(DOMAIN).pot; \
+	else \
+	  $(MAKE) $${lang}.po-create; \
+	fi
+
+
+install: install-exec install-data
+install-exec:
+install-data: install-data-@USE_NLS@
+	if test "$(PACKAGE)" = "gettext-tools"; then \
+	  $(mkdir_p) $(DESTDIR)$(gettextsrcdir); \
+	  for file in $(DISTFILES.common) Makevars.template; do \
+	    $(INSTALL_DATA) $(srcdir)/$$file \
+			    $(DESTDIR)$(gettextsrcdir)/$$file; \
+	  done; \
+	  for file in Makevars; do \
+	    rm -f $(DESTDIR)$(gettextsrcdir)/$$file; \
+	  done; \
+	else \
+	  : ; \
+	fi
+install-data-no: all
+install-data-yes: all
+	$(mkdir_p) $(DESTDIR)$(datadir)
+	@catalogs='$(CATALOGS)'; \
+	for cat in $$catalogs; do \
+	  cat=`basename $$cat`; \
+	  lang=`echo $$cat | sed -e 's/\.gmo$$//'`; \
+	  dir=$(localedir)/$$lang/LC_MESSAGES; \
+	  $(mkdir_p) $(DESTDIR)$$dir; \
+	  if test -r $$cat; then realcat=$$cat; else realcat=$(srcdir)/$$cat; fi; \
+	  $(INSTALL_DATA) $$realcat $(DESTDIR)$$dir/$(DOMAIN).mo; \
+	  echo "installing $$realcat as $(DESTDIR)$$dir/$(DOMAIN).mo"; \
+	  for lc in '' $(EXTRA_LOCALE_CATEGORIES); do \
+	    if test -n "$$lc"; then \
+	      if (cd $(DESTDIR)$(localedir)/$$lang && LC_ALL=C ls -l -d $$lc 2>/dev/null) | grep ' -> ' >/dev/null; then \
+	        link=`cd $(DESTDIR)$(localedir)/$$lang && LC_ALL=C ls -l -d $$lc | sed -e 's/^.* -> //'`; \
+	        mv $(DESTDIR)$(localedir)/$$lang/$$lc $(DESTDIR)$(localedir)/$$lang/$$lc.old; \
+	        mkdir $(DESTDIR)$(localedir)/$$lang/$$lc; \
+	        (cd $(DESTDIR)$(localedir)/$$lang/$$lc.old && \
+	         for file in *; do \
+	           if test -f $$file; then \
+	             ln -s ../$$link/$$file $(DESTDIR)$(localedir)/$$lang/$$lc/$$file; \
+	           fi; \
+	         done); \
+	        rm -f $(DESTDIR)$(localedir)/$$lang/$$lc.old; \
+	      else \
+	        if test -d $(DESTDIR)$(localedir)/$$lang/$$lc; then \
+	          :; \
+	        else \
+	          rm -f $(DESTDIR)$(localedir)/$$lang/$$lc; \
+	          mkdir $(DESTDIR)$(localedir)/$$lang/$$lc; \
+	        fi; \
+	      fi; \
+	      rm -f $(DESTDIR)$(localedir)/$$lang/$$lc/$(DOMAIN).mo; \
+	      ln -s ../LC_MESSAGES/$(DOMAIN).mo $(DESTDIR)$(localedir)/$$lang/$$lc/$(DOMAIN).mo 2>/dev/null || \
+	      ln $(DESTDIR)$(localedir)/$$lang/LC_MESSAGES/$(DOMAIN).mo $(DESTDIR)$(localedir)/$$lang/$$lc/$(DOMAIN).mo 2>/dev/null || \
+	      cp -p $(DESTDIR)$(localedir)/$$lang/LC_MESSAGES/$(DOMAIN).mo $(DESTDIR)$(localedir)/$$lang/$$lc/$(DOMAIN).mo; \
+	      echo "installing $$realcat link as $(DESTDIR)$(localedir)/$$lang/$$lc/$(DOMAIN).mo"; \
+	    fi; \
+	  done; \
+	done
+
+install-strip: install
+
+installdirs: installdirs-exec installdirs-data
+installdirs-exec:
+installdirs-data: installdirs-data-@USE_NLS@
+	if test "$(PACKAGE)" = "gettext-tools"; then \
+	  $(mkdir_p) $(DESTDIR)$(gettextsrcdir); \
+	else \
+	  : ; \
+	fi
+installdirs-data-no:
+installdirs-data-yes:
+	$(mkdir_p) $(DESTDIR)$(datadir)
+	@catalogs='$(CATALOGS)'; \
+	for cat in $$catalogs; do \
+	  cat=`basename $$cat`; \
+	  lang=`echo $$cat | sed -e 's/\.gmo$$//'`; \
+	  dir=$(localedir)/$$lang/LC_MESSAGES; \
+	  $(mkdir_p) $(DESTDIR)$$dir; \
+	  for lc in '' $(EXTRA_LOCALE_CATEGORIES); do \
+	    if test -n "$$lc"; then \
+	      if (cd $(DESTDIR)$(localedir)/$$lang && LC_ALL=C ls -l -d $$lc 2>/dev/null) | grep ' -> ' >/dev/null; then \
+	        link=`cd $(DESTDIR)$(localedir)/$$lang && LC_ALL=C ls -l -d $$lc | sed -e 's/^.* -> //'`; \
+	        mv $(DESTDIR)$(localedir)/$$lang/$$lc $(DESTDIR)$(localedir)/$$lang/$$lc.old; \
+	        mkdir $(DESTDIR)$(localedir)/$$lang/$$lc; \
+	        (cd $(DESTDIR)$(localedir)/$$lang/$$lc.old && \
+	         for file in *; do \
+	           if test -f $$file; then \
+	             ln -s ../$$link/$$file $(DESTDIR)$(localedir)/$$lang/$$lc/$$file; \
+	           fi; \
+	         done); \
+	        rm -f $(DESTDIR)$(localedir)/$$lang/$$lc.old; \
+	      else \
+	        if test -d $(DESTDIR)$(localedir)/$$lang/$$lc; then \
+	          :; \
+	        else \
+	          rm -f $(DESTDIR)$(localedir)/$$lang/$$lc; \
+	          mkdir $(DESTDIR)$(localedir)/$$lang/$$lc; \
+	        fi; \
+	      fi; \
+	    fi; \
+	  done; \
+	done
+
+# Define this as empty until I found a useful application.
+installcheck:
+
+uninstall: uninstall-exec uninstall-data
+uninstall-exec:
+uninstall-data: uninstall-data-@USE_NLS@
+	if test "$(PACKAGE)" = "gettext-tools"; then \
+	  for file in $(DISTFILES.common) Makevars.template; do \
+	    rm -f $(DESTDIR)$(gettextsrcdir)/$$file; \
+	  done; \
+	else \
+	  : ; \
+	fi
+uninstall-data-no:
+uninstall-data-yes:
+	catalogs='$(CATALOGS)'; \
+	for cat in $$catalogs; do \
+	  cat=`basename $$cat`; \
+	  lang=`echo $$cat | sed -e 's/\.gmo$$//'`; \
+	  for lc in LC_MESSAGES $(EXTRA_LOCALE_CATEGORIES); do \
+	    rm -f $(DESTDIR)$(localedir)/$$lang/$$lc/$(DOMAIN).mo; \
+	  done; \
+	done
+
+check: all
+
+info dvi ps pdf html tags TAGS ctags CTAGS ID:
+
+mostlyclean:
+	rm -f remove-potcdate.sed
+	rm -f stamp-poT
+	rm -f core core.* $(DOMAIN).po $(DOMAIN).1po $(DOMAIN).2po *.new.po
+	rm -fr *.o
+
+clean: mostlyclean
+
+distclean: clean
+	rm -f Makefile Makefile.in POTFILES *.mo
+
+maintainer-clean: distclean
+	@echo "This command is intended for maintainers to use;"
+	@echo "it deletes files that may require special tools to rebuild."
+	rm -f stamp-po $(GMOFILES)
+
+distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
+dist distdir:
+	$(MAKE) update-po
+	@$(MAKE) dist2
+# This is a separate target because 'update-po' must be executed before.
+dist2: stamp-po $(DISTFILES)
+	dists="$(DISTFILES)"; \
+	if test "$(PACKAGE)" = "gettext-tools"; then \
+	  dists="$$dists Makevars.template"; \
+	fi; \
+	if test -f $(srcdir)/$(DOMAIN).pot; then \
+	  dists="$$dists $(DOMAIN).pot stamp-po"; \
+	fi; \
+	if test -f $(srcdir)/ChangeLog; then \
+	  dists="$$dists ChangeLog"; \
+	fi; \
+	for i in 0 1 2 3 4 5 6 7 8 9; do \
+	  if test -f $(srcdir)/ChangeLog.$$i; then \
+	    dists="$$dists ChangeLog.$$i"; \
+	  fi; \
+	done; \
+	if test -f $(srcdir)/LINGUAS; then dists="$$dists LINGUAS"; fi; \
+	for file in $$dists; do \
+	  if test -f $$file; then \
+	    cp -p $$file $(distdir) || exit 1; \
+	  else \
+	    cp -p $(srcdir)/$$file $(distdir) || exit 1; \
+	  fi; \
+	done
+
+update-po: Makefile
+	$(MAKE) $(DOMAIN).pot-update
+	test -z "$(UPDATEPOFILES)" || $(MAKE) $(UPDATEPOFILES)
+	$(MAKE) update-gmo
+
+# General rule for creating PO files.
+
+.nop.po-create:
+	@lang=`echo $@ | sed -e 's/\.po-create$$//'`; \
+	echo "File $$lang.po does not exist. If you are a translator, you can create it through 'msginit'." 1>&2; \
+	exit 1
+
+# General rule for updating PO files.
+
+.nop.po-update:
+	@lang=`echo $@ | sed -e 's/\.po-update$$//'`; \
+	if test "$(PACKAGE)" = "gettext-tools"; then PATH=`pwd`/../src:$$PATH; fi; \
+	tmpdir=`pwd`; \
+	echo "$$lang:"; \
+	test "$(srcdir)" = . && cdcmd="" || cdcmd="cd $(srcdir) && "; \
+	echo "$${cdcmd}$(MSGMERGE) $$lang.po $(DOMAIN).pot -o $$lang.new.po"; \
+	cd $(srcdir); \
+	if $(MSGMERGE) $$lang.po $(DOMAIN).pot -o $$tmpdir/$$lang.new.po; then \
+	  if cmp $$lang.po $$tmpdir/$$lang.new.po >/dev/null 2>&1; then \
+	    rm -f $$tmpdir/$$lang.new.po; \
+	  else \
+	    if mv -f $$tmpdir/$$lang.new.po $$lang.po; then \
+	      :; \
+	    else \
+	      echo "msgmerge for $$lang.po failed: cannot move $$tmpdir/$$lang.new.po to $$lang.po" 1>&2; \
+	      exit 1; \
+	    fi; \
+	  fi; \
+	else \
+	  echo "msgmerge for $$lang.po failed!" 1>&2; \
+	  rm -f $$tmpdir/$$lang.new.po; \
+	fi
+
+$(DUMMYPOFILES):
+
+update-gmo: Makefile $(GMOFILES)
+	@:
+
+Makefile: Makefile.in.in Makevars $(top_builddir)/config.status @POMAKEFILEDEPS@
+	cd $(top_builddir) \
+	  && $(SHELL) ./config.status $(subdir)/$@.in po-directories
+
+force:
+
+# Tell versions [3.59,3.63) of GNU make not to export all variables.
+# Otherwise a system limit (for SysV at least) may be exceeded.
+.NOEXPORT:
diff --git a/po/Makevars.template b/po/Makevars.template
new file mode 100644
index 0000000..32692ab
--- /dev/null
+++ b/po/Makevars.template
@@ -0,0 +1,41 @@
+# Makefile variables for PO directory in any package using GNU gettext.
+
+# Usually the message domain is the same as the package name.
+DOMAIN = $(PACKAGE)
+
+# These two variables depend on the location of this directory.
+subdir = po
+top_builddir = ..
+
+# These options get passed to xgettext.
+XGETTEXT_OPTIONS = --keyword=_ --keyword=N_
+
+# This is the copyright holder that gets inserted into the header of the
+# $(DOMAIN).pot file.  Set this to the copyright holder of the surrounding
+# package.  (Note that the msgstr strings, extracted from the package's
+# sources, belong to the copyright holder of the package.)  Translators are
+# expected to transfer the copyright for their translations to this person
+# or entity, or to disclaim their copyright.  The empty string stands for
+# the public domain; in this case the translators are expected to disclaim
+# their copyright.
+COPYRIGHT_HOLDER = Free Software Foundation, Inc.
+
+# This is the email address or URL to which the translators shall report
+# bugs in the untranslated strings:
+# - Strings which are not entire sentences, see the maintainer guidelines
+#   in the GNU gettext documentation, section 'Preparing Strings'.
+# - Strings which use unclear terms or require additional context to be
+#   understood.
+# - Strings which make invalid assumptions about notation of date, time or
+#   money.
+# - Pluralisation problems.
+# - Incorrect English spelling.
+# - Incorrect formatting.
+# It can be your email address, or a mailing list address where translators
+# can write to without being subscribed, or the URL of a web page through
+# which the translators can contact you.
+MSGID_BUGS_ADDRESS =
+
+# This is the list of locale categories, beyond LC_MESSAGES, for which the
+# message catalogs shall be used.  It is usually empty.
+EXTRA_LOCALE_CATEGORIES =
diff --git a/po/POTFILES.skip b/po/POTFILES.skip
new file mode 100644
index 0000000..02201b7
--- /dev/null
+++ b/po/POTFILES.skip
@@ -0,0 +1,6 @@
+gst/goom/convolve_fx.c
+gst/goom/mmx.c
+gst/goom/xmmx.c
+gst/oldcore/gstmultifilesrc.c
+sys/v4l2/gstv4l2xoverlay.c
+
diff --git a/po/af.po b/po/af.po
index 091d1da..ced1f84 100644
--- a/po/af.po
+++ b/po/af.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins 0.7.6\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2004-03-18 14:16+0200\n"
 "Last-Translator: Petri Jooste <rkwjpj@puk.ac.za>\n"
 "Language-Team: Afrikaans <i18n@af.org.za>\n"
diff --git a/po/az.po b/po/az.po
index a061a71..26f77d9 100644
--- a/po/az.po
+++ b/po/az.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-0.8.0\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2004-03-19 18:29+0200\n"
 "Last-Translator: Metin Amiroff <metin@karegen.com>\n"
 "Language-Team: Azerbaijani <translation-team-az@lists.sourceforge.net>\n"
diff --git a/po/bg.po b/po/bg.po
index 8d97a10..59b85c9 100644
--- a/po/bg.po
+++ b/po/bg.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.28.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-04-26 22:35+0300\n"
 "Last-Translator: Alexander Shopov <ash@kambanaria.org>\n"
 "Language-Team: Bulgarian <dict@fsa-bg.org>\n"
diff --git a/po/ca.po b/po/ca.po
index be989e2..4cb58a9 100644
--- a/po/ca.po
+++ b/po/ca.po
@@ -2,799 +2,664 @@
 # Copyright © 2005 Free Software Foundation, Inc.
 # This file is put in the public domain.
 # Jordi Mallach <jordi@sindominio.net>, 2005.
-# Jordi Estrada <jordi.estrada@yamaha-motor.es>, 2011.
-# Gil Forcada <gforcada@gnome.org>, 2012.
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: gst-plugins-good 0.10.28.2\n"
+"Project-Id-Version: gst-plugins-good 0.9.7\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
-"PO-Revision-Date: 2012-01-01 14:19+0100\n"
-"Last-Translator: Gil Forcada <gforcada@gnome.org>\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
+"PO-Revision-Date: 2005-12-04 21:54+0100\n"
+"Last-Translator: Jordi Mallach <jordi@sindominio.net>\n"
 "Language-Team: Catalan <ca@dodds.net>\n"
 "Language: ca\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"Plural-Forms: nplurals=2; plural=n != 1;\n"
 
 msgid "Could not establish connection to sound server"
-msgstr "No s'ha pogut establir la connexió al servidor de so"
+msgstr ""
 
 msgid "Failed to query sound server capabilities"
-msgstr "Ha fallat en consultar les capacitats del servidor de so"
+msgstr ""
 
 #. TRANSLATORS: 'song title' by 'artist name'
 #, c-format
 msgid "'%s' by '%s'"
-msgstr "«%s» per «%s»"
+msgstr ""
 
 msgid "Internal data stream error."
 msgstr "S'ha produït un error intern de flux de dades."
 
 msgid "Failed to decode JPEG image"
-msgstr "Ha fallat en descodificar la imatge JPEG"
+msgstr ""
 
 msgid "Could not connect to server"
-msgstr "No s'ha pogut connectar al servidor"
+msgstr ""
 
 msgid "Server does not support seeking."
-msgstr "El servidor no ademet les cerques."
+msgstr ""
 
 msgid "Could not resolve server name."
-msgstr "No s'ha pogut resoldre el nom del servidor."
+msgstr ""
 
 msgid "Could not establish connection to server."
-msgstr "No s'ha pogut establir la connexió al servidor."
+msgstr ""
 
 msgid "Secure connection setup failed."
-msgstr "Ha fallat la configuració de connexió segura."
+msgstr ""
 
 msgid ""
 "A network error occured, or the server closed the connection unexpectedly."
 msgstr ""
-"S'ha produït un error de xarxa, o el servidor ha tancat la connexió "
-"inesperadament."
 
 msgid "Server sent bad data."
-msgstr "El servidor ha enviat dades errònies."
+msgstr ""
 
 msgid "No URL set."
-msgstr "No s'ha indicat cap URL."
+msgstr ""
 
 msgid "No or invalid input audio, AVI stream will be corrupt."
-msgstr "Manca o no és vàlida l'entrada d'àudio, el flux AVI estarà malmès."
+msgstr "L'entrada d'àudio manca o és invàlida, el flux AVI serà corrupte."
 
 msgid "This file contains no playable streams."
-msgstr "Aquest fitxer no conté cap flux reproduïble."
+msgstr ""
 
 msgid "This file is invalid and cannot be played."
-msgstr "Aquest fitxer no és vàlid i no es pot reproduir."
+msgstr ""
 
 msgid "This file is corrupt and cannot be played."
-msgstr "Aquest fitxer està malmès i no es pot reproduir."
+msgstr ""
 
 msgid "Invalid atom size."
-msgstr "La mida de l'àtom no és vàlida."
+msgstr ""
 
 msgid "This file is incomplete and cannot be played."
-msgstr "Aquest fitxer no està complet i no es pot reproduir."
+msgstr ""
 
 msgid "The video in this file might not play correctly."
-msgstr "El vídeo en aquest fitxer podria no reproduir-se correctament."
+msgstr ""
 
 #, c-format
 msgid "This file contains too many streams. Only playing first %d"
 msgstr ""
-"Aquest fitxer conté massa fluxos. Només s'estan reproduint els primers %d"
 
 msgid ""
 "No supported stream was found. You might need to install a GStreamer RTSP "
 "extension plugin for Real media streams."
 msgstr ""
-"No s'ha trobat cap flux compatible. Podríeu necessitar instal·lar un "
-"connector d'extensió RTSP del GStreamer per a fluxos de multimèdia Real."
 
 msgid ""
 "No supported stream was found. You might need to allow more transport "
 "protocols or may otherwise be missing the right GStreamer RTSP extension "
 "plugin."
 msgstr ""
-"No s'ha trobat cap flux compatible. Podríeu necessitar permetre més "
-"protocols de transport o bé potser manca el connector d'extensió RTSP del "
-"GStreamer correcte."
 
+#, fuzzy
 msgid "Internal data flow error."
 msgstr "S'ha produït un error intern de flux de dades."
 
 msgid "Volume"
-msgstr "Volum"
+msgstr ""
 
 msgid "Bass"
-msgstr "Baixos"
+msgstr ""
 
 msgid "Treble"
-msgstr "Aguts"
+msgstr ""
 
 msgid "Synth"
-msgstr "Sintetitzador"
+msgstr ""
 
 msgid "PCM"
-msgstr "PCM"
+msgstr ""
 
 msgid "Speaker"
-msgstr "Altaveu"
+msgstr ""
 
 msgid "Line-in"
-msgstr "Línia d'entrada"
+msgstr ""
 
 msgid "Microphone"
-msgstr "Micròfon"
+msgstr ""
 
 msgid "CD"
-msgstr "CD"
+msgstr ""
 
 msgid "Mixer"
-msgstr "Mesclador"
+msgstr ""
 
 msgid "PCM-2"
-msgstr "PCM-2"
+msgstr ""
 
 msgid "Record"
-msgstr "Enregistrament"
+msgstr ""
 
 msgid "In-gain"
-msgstr "Guany d'entrada"
+msgstr ""
 
 msgid "Out-gain"
-msgstr "Guany de sortida"
+msgstr ""
 
 msgid "Line-1"
-msgstr "Línia-1"
+msgstr ""
 
 msgid "Line-2"
-msgstr "Línia-2"
+msgstr ""
 
 msgid "Line-3"
-msgstr "Línia-3"
+msgstr ""
 
 msgid "Digital-1"
-msgstr "Digital-1"
+msgstr ""
 
 msgid "Digital-2"
-msgstr "Digital-2"
+msgstr ""
 
 msgid "Digital-3"
-msgstr "Digital-3"
+msgstr ""
 
 msgid "Phone-in"
-msgstr "Entrada del telèfon"
+msgstr ""
 
 msgid "Phone-out"
-msgstr "Sortida del telèfon"
+msgstr ""
 
 msgid "Video"
-msgstr "Vídeo"
+msgstr ""
 
 msgid "Radio"
-msgstr "Ràdio"
+msgstr ""
 
 msgid "Monitor"
-msgstr "Monitor"
+msgstr ""
 
 msgid ""
 "Could not open audio device for playback. Device is being used by another "
 "application."
 msgstr ""
-"No s'ha pogut obrir el dispositiu d'àudio per a la reproducció. Una altra "
-"aplicació està utilitzant el dispositiu."
 
 msgid ""
 "Could not open audio device for playback. You don't have permission to open "
 "the device."
 msgstr ""
-"No s'ha pogut obrir el dispositiu d'àudio per a la reproducció. No teniu "
-"permís per obrir el dispositiu."
 
 msgid "Could not open audio device for playback."
-msgstr "No s'ha pogut obrir el dispositiu d'àudio per a la reproducció."
+msgstr ""
 
 msgid ""
 "Could not open audio device for recording. You don't have permission to open "
 "the device."
 msgstr ""
-"No s'ha pogut obrir el dispositiu d'àudio per a l'enregistrament. No teniu "
-"permís per obrir el dispositiu."
 
 msgid "Could not open audio device for recording."
-msgstr "No s'ha pogut obrir el dispositiu d'àudio per a l'enregistrament."
+msgstr ""
 
+#, fuzzy
 msgid "Could not open audio device for mixer control handling."
-msgstr ""
-"No s'ha pogut obrir el dispositiu d'àudio per a la gestió del control del "
-"mesclador."
+msgstr "No s'ha pogut el dispositiu d'àudio «%s» per a l'escriptura."
 
+#, fuzzy
 msgid ""
 "Could not open audio device for mixer control handling. This version of the "
 "Open Sound System is not supported by this element."
-msgstr ""
-"No s'ha pogut obrir el dispositiu d'àudio per a la gestió del control del "
-"mesclador. Aquesta versió de l'Open Sound System no és compatible amb aquest "
-"element."
+msgstr "No s'ha pogut el dispositiu d'àudio «%s» per a l'escriptura."
 
 msgid "Master"
-msgstr "Mestre"
+msgstr ""
 
 msgid "Front"
-msgstr "Frontal"
+msgstr ""
 
+#, fuzzy
 msgid "Rear"
-msgstr "Posterior"
+msgstr "Enregistrament"
 
 msgid "Headphones"
-msgstr "Auriculars"
+msgstr ""
 
 msgid "Center"
-msgstr "Central"
+msgstr ""
 
 msgid "LFE"
-msgstr "LFE (efectes de baixa freqüència)"
+msgstr ""
 
 msgid "Surround"
-msgstr "So envoltant"
+msgstr ""
 
+#, fuzzy
 msgid "Side"
-msgstr "Lateral"
+msgstr "Vídeo"
 
 msgid "Built-in Speaker"
-msgstr "Altaveu incorporat"
+msgstr ""
 
 msgid "AUX 1 Out"
-msgstr "Sortida AUX 1"
+msgstr ""
 
 msgid "AUX 2 Out"
-msgstr "Sortida AUX 2"
+msgstr ""
 
 msgid "AUX Out"
-msgstr "Sortida AUX"
+msgstr ""
 
 msgid "3D Depth"
-msgstr "Profunditat 3D"
+msgstr ""
 
 msgid "3D Center"
-msgstr "Centre 3D"
+msgstr ""
 
 msgid "3D Enhance"
-msgstr "Millora 3D"
+msgstr ""
 
 msgid "Telephone"
-msgstr "Telèfon"
+msgstr ""
 
 msgid "Line Out"
-msgstr "Línia de sortida"
+msgstr ""
 
+#, fuzzy
 msgid "Line In"
-msgstr "Línia d'entrada"
+msgstr "Línia-entrada"
 
 msgid "Internal CD"
-msgstr "CD intern"
+msgstr ""
 
 msgid "Video In"
-msgstr "Entrada de vídeo"
+msgstr ""
 
 msgid "AUX 1 In"
-msgstr "Entrada AUX 1"
+msgstr ""
 
 msgid "AUX 2 In"
-msgstr "Entrada AUX 2"
+msgstr ""
 
 msgid "AUX In"
-msgstr "Entrada AUX"
+msgstr ""
 
 msgid "Record Gain"
-msgstr "Guany d'enregistrament"
+msgstr ""
 
+#, fuzzy
 msgid "Output Gain"
-msgstr "Guany de sortida"
+msgstr "Ganància-sortida"
 
+#, fuzzy
 msgid "Microphone Boost"
-msgstr "Amplificació del micròfon"
+msgstr "Micròfon"
 
 msgid "Loopback"
-msgstr "Bucle local"
+msgstr ""
 
 msgid "Diagnostic"
-msgstr "Diagnòstic"
+msgstr ""
 
 msgid "Bass Boost"
-msgstr "Amplificació dels baixos"
+msgstr ""
 
 msgid "Playback Ports"
-msgstr "Ports de reproducció"
+msgstr ""
 
 msgid "Input"
-msgstr "Entrada"
+msgstr ""
 
 msgid "Record Source"
-msgstr "Font d'enregistrament"
+msgstr ""
 
+#, fuzzy
 msgid "Monitor Source"
-msgstr "Font del monitor"
+msgstr "Monitor"
 
 msgid "Keyboard Beep"
-msgstr "So del teclat"
+msgstr ""
 
 msgid "Simulate Stereo"
-msgstr "Estèreo simulat"
+msgstr ""
 
 msgid "Stereo"
-msgstr "Estèreo"
+msgstr ""
 
 msgid "Surround Sound"
-msgstr "So envoltant"
+msgstr ""
 
+#, fuzzy
 msgid "Microphone Gain"
-msgstr "Guany del micròfon"
+msgstr "Micròfon"
 
+#, fuzzy
 msgid "Speaker Source"
-msgstr "Font de l'altaveu"
+msgstr "Altaveu"
 
+#, fuzzy
 msgid "Microphone Source"
-msgstr "Font del micròfon"
+msgstr "Micròfon"
 
 msgid "Jack"
-msgstr "Jack"
+msgstr ""
 
 msgid "Center / LFE"
-msgstr "Centre / LFE (efectes de baixa freqüència)"
+msgstr ""
 
 msgid "Stereo Mix"
-msgstr "Mescla estèreo"
+msgstr ""
 
 msgid "Mono Mix"
-msgstr "Mescla mono"
+msgstr ""
 
 msgid "Input Mix"
-msgstr "Mescla d'entrada"
+msgstr ""
 
 msgid "SPDIF In"
-msgstr "Entrada SPDIF"
+msgstr ""
 
 msgid "SPDIF Out"
-msgstr "Sortida SPDIF"
+msgstr ""
 
+#, fuzzy
 msgid "Microphone 1"
-msgstr "Micròfon 1"
+msgstr "Micròfon"
 
+#, fuzzy
 msgid "Microphone 2"
-msgstr "Micròfon 2"
+msgstr "Micròfon"
 
+#, fuzzy
 msgid "Digital Out"
-msgstr "Sortida digital"
+msgstr "Digital-1"
 
+#, fuzzy
 msgid "Digital In"
-msgstr "Entrada digital"
+msgstr "Digital-1"
 
 msgid "HDMI"
-msgstr "HDMI"
+msgstr ""
 
 msgid "Modem"
-msgstr "Mòdem"
+msgstr ""
 
 msgid "Handset"
-msgstr "Comandament a distància"
+msgstr ""
 
 msgid "Other"
-msgstr "Altres"
+msgstr ""
 
 msgid "None"
-msgstr "Cap"
+msgstr ""
 
 msgid "On"
-msgstr "Encès"
+msgstr ""
 
 msgid "Off"
-msgstr "Apagat"
+msgstr ""
 
 msgid "Mute"
-msgstr "Silenci"
+msgstr ""
 
 msgid "Fast"
-msgstr "Ràpid"
+msgstr ""
 
 #. TRANSLATORS: "Very Low" is a quality setting here
 msgid "Very Low"
-msgstr "Molt baixa"
+msgstr ""
 
 #. TRANSLATORS: "Low" is a quality setting here
 msgid "Low"
-msgstr "Baixa"
+msgstr ""
 
 #. TRANSLATORS: "Medium" is a quality setting here
 msgid "Medium"
-msgstr "Mitjana"
+msgstr ""
 
 #. TRANSLATORS: "High" is a quality setting here
 msgid "High"
-msgstr "Alta"
+msgstr ""
 
 #. TRANSLATORS: "Very High" is a quality setting here
 msgid "Very High"
-msgstr "Molt alta"
+msgstr ""
 
 #. TRANSLATORS: "Production" is a quality setting here
 msgid "Production"
-msgstr "Producció"
+msgstr ""
 
+#, fuzzy
 msgid "Front Panel Microphone"
-msgstr "Micròfon del quadre frontal"
+msgstr "Micròfon"
 
 msgid "Front Panel Line In"
-msgstr "Línia d'entrada del quadre frontal"
+msgstr ""
 
 msgid "Front Panel Headphones"
-msgstr "Auriculars del quadre frontal"
+msgstr ""
 
 msgid "Front Panel Line Out"
-msgstr "Línia de sortida del quadre frontal"
+msgstr ""
 
 msgid "Green Connector"
-msgstr "Connector verd"
+msgstr ""
 
 msgid "Pink Connector"
-msgstr "Connector rosa"
+msgstr ""
 
 msgid "Blue Connector"
-msgstr "Connector blau"
+msgstr ""
 
 msgid "White Connector"
-msgstr "Connector blanc"
+msgstr ""
 
 msgid "Black Connector"
-msgstr "Connector negre"
+msgstr ""
 
 msgid "Gray Connector"
-msgstr "Connector gris"
+msgstr ""
 
 msgid "Orange Connector"
-msgstr "Connector taronja"
+msgstr ""
 
 msgid "Red Connector"
-msgstr "Connector vermell"
+msgstr ""
 
 msgid "Yellow Connector"
-msgstr "Connector groc"
+msgstr ""
 
 msgid "Green Front Panel Connector"
-msgstr "Connector verd del quadre frontal"
+msgstr ""
 
 msgid "Pink Front Panel Connector"
-msgstr "Connector rosa del quadre frontal"
+msgstr ""
 
 msgid "Blue Front Panel Connector"
-msgstr "Connector blau del quadre frontal"
+msgstr ""
 
 msgid "White Front Panel Connector"
-msgstr "Connector blanc del quadre frontal"
+msgstr ""
 
 msgid "Black Front Panel Connector"
-msgstr "Connector negre del quadre frontal"
+msgstr ""
 
 msgid "Gray Front Panel Connector"
-msgstr "Connector gris del quadre frontal"
+msgstr ""
 
 msgid "Orange Front Panel Connector"
-msgstr "Connector taronja del quadre frontal"
+msgstr ""
 
 msgid "Red Front Panel Connector"
-msgstr "Connector vermell del quadre frontal"
+msgstr ""
 
 msgid "Yellow Front Panel Connector"
-msgstr "Connector groc del quadre frontal"
+msgstr ""
 
 msgid "Spread Output"
-msgstr "Sortida de propagació"
+msgstr ""
 
 msgid "Downmix"
-msgstr "Downmix"
+msgstr ""
 
 msgid "Virtual Mixer Input"
-msgstr "Entrada del mesclador virtual"
+msgstr ""
 
 msgid "Virtual Mixer Output"
-msgstr "Sortida del mesclador virtual"
+msgstr ""
 
 msgid "Virtual Mixer Channels"
-msgstr "Canals del mesclador virtual"
+msgstr ""
 
 #. TRANSLATORS: name + number of a volume mixer control
 #, c-format
 msgid "%s %d Function"
-msgstr "Funció %s %d"
+msgstr ""
 
 #. TRANSLATORS: name of a volume mixer control
 #, c-format
 msgid "%s Function"
-msgstr "Funció %s"
+msgstr ""
 
 msgid ""
 "Could not open audio device for playback. This version of the Open Sound "
 "System is not supported by this element."
 msgstr ""
-"No s'ha pogut obrir el dispositiu d'àudio per a la reproducció. Aquesta "
-"versió de l'Open Sound System no és compatible amb aquest element."
 
 msgid "Playback is not supported by this audio device."
-msgstr "Aquest dispositiu d'àudio no permet la reproducció."
+msgstr ""
 
 msgid "Audio playback error."
-msgstr "S'ha produït un error al reproduir l'àudio."
+msgstr ""
 
 msgid "Recording is not supported by this audio device."
-msgstr "Aquest dispositiu d'àudio no permet l'enregistrament."
+msgstr ""
 
 msgid "Error recording from audio device."
-msgstr "S'ha produït un error a l'enregistrar des del dispositiu d'àudio."
+msgstr ""
 
 msgid "Gain"
-msgstr "Guany"
+msgstr ""
 
 msgid "Headphone"
-msgstr "Auriculars"
+msgstr ""
 
 #, c-format
 msgid "Error reading %d bytes from device '%s'."
-msgstr "S'ha produït un error al llegir %d bytes des del dispositiu «%s»."
+msgstr ""
 
 #, c-format
 msgid "Got unexpected frame size of %u instead of %u."
-msgstr "S'ha obtingut una mida de fotograma inesperada de %u en lloc de %u."
+msgstr ""
 
 #, c-format
 msgid "Error reading %d bytes on device '%s'."
-msgstr "S'ha produït un error al llegir %d bytes en el dispositiu «%s»."
+msgstr ""
 
 #, c-format
 msgid ""
 "Error getting capabilities for device '%s': It isn't a v4l2 driver. Check if "
 "it is a v4l1 driver."
 msgstr ""
-"S'ha produït un error en obtenir les capacitats del dispositiu «%s»: no és "
-"un controlador v4l2. Comproveu si és un controlador v4l1."
 
 #, c-format
 msgid "Failed to query attributes of input %d in device %s"
 msgstr ""
-"S'ha produït un error en consultar els atributs de l'entrada %d en el "
-"dispositiu %s"
 
 #, c-format
 msgid "Failed to get setting of tuner %d on device '%s'."
 msgstr ""
-"No s'han pogut obtenir els paràmetres del sintonitzador %d en el dispositiu "
-"«%s»."
 
 #, c-format
 msgid "Failed to query norm on device '%s'."
-msgstr "S'ha produït un error en consultar la norma en el dispositiu «%s»."
+msgstr ""
 
 #, c-format
 msgid "Failed getting controls attributes on device '%s'."
 msgstr ""
-"No s'ha pogut obtenir els atributs dels controls en el dispositiu «%s»."
 
 #, c-format
 msgid "Cannot identify device '%s'."
-msgstr "No es pot identificar el dispositiu «%s»."
+msgstr ""
 
 #, c-format
 msgid "This isn't a device '%s'."
-msgstr "Això no és un dispositiu «%s»."
+msgstr ""
 
 #, c-format
 msgid "Could not open device '%s' for reading and writing."
-msgstr "No s'ha pogut obrir el dispositiu «%s» per a lectura i l'escriptura."
+msgstr ""
 
 #, c-format
 msgid "Device '%s' is not a capture device."
-msgstr "El dispositiu «%s» no és un dispositiu de captura."
+msgstr ""
 
 #, c-format
 msgid "Device '%s' is not a output device."
-msgstr "El dispositiu «%s» no és un dispositiu de sortida."
+msgstr ""
 
 #, c-format
 msgid "Failed to set norm for device '%s'."
-msgstr "No s'ha pogut establir la norma per al dispositiu «%s»."
+msgstr ""
 
 #, c-format
 msgid "Failed to get current tuner frequency for device '%s'."
 msgstr ""
-"No s'ha pogut obtenir la freqüència actual del sintonitzador per al "
-"dispositiu «%s»."
 
 #, c-format
 msgid "Failed to set current tuner frequency for device '%s' to %lu Hz."
 msgstr ""
-"No s'ha pogut establir la freqüència actual del sintonitzador per al "
-"dispositiu «%s» a %lu Hz."
 
 #, c-format
 msgid "Failed to get signal strength for device '%s'."
-msgstr "No s'ha pogut obtenir la intensitat del senyal per al dispositiu «%s»."
+msgstr ""
 
 #, c-format
 msgid "Failed to get value for control %d on device '%s'."
 msgstr ""
-"No s'ha pogut obtenir el valor per al control %d en el dispositiu «%s»."
 
 #, c-format
 msgid "Failed to set value %d for control %d on device '%s'."
 msgstr ""
-"No s'ha pogut establir el valor %d per al control %d en el dispositiu «%s»."
 
 #, c-format
 msgid "Failed to get current input on device '%s'. May be it is a radio device"
 msgstr ""
-"No s'ha pogut obtenir l'entrada actual en el dispositiu «%s». Potser és un "
-"dispositiu de ràdio"
 
 #, c-format
 msgid "Failed to set input %d on device %s."
-msgstr "No s'ha pogut establir l'entrada %d en el dispositiu %s."
+msgstr ""
 
 #, c-format
 msgid ""
 "Failed to get current output on device '%s'. May be it is a radio device"
 msgstr ""
-"No s'ha pogut obtenir la sortida actual en el dispositiu «%s». Potser és un "
-"dispositiu de ràdio"
 
 #, c-format
 msgid "Failed to set output %d on device %s."
-msgstr "No s'ha pogut establir la sortida %d en el dispositiu %s."
+msgstr ""
 
 #, c-format
 msgid "Could not enqueue buffers in device '%s'."
 msgstr ""
-"No s'han pogut enviar a la cua les memòries intermèdies en el dispositiu "
-"«%s»."
 
 #, c-format
 msgid "Failed trying to get video frames from device '%s'."
 msgstr ""
-"S'ha produït un error en provar d'obtenir fotogrames de vídeo des del "
-"dispositiu «%s»."
 
 #, c-format
 msgid "Failed after %d tries. device %s. system error: %s"
-msgstr "Ha fallat després de %d intents. Dispositiu %s. Error de sistema: %s"
+msgstr ""
 
 #, c-format
 msgid "Could not get parameters on device '%s'"
-msgstr "No s'han pogut obtenir els paràmetres del dispositiu «%s»"
+msgstr ""
 
 msgid "Video input device did not accept new frame rate setting."
 msgstr ""
-"El dispositiu d'entrada de vídeo no ha acceptat el paràmetre nou de "
-"fotogrames per segon."
 
 #, c-format
 msgid "Could not map buffers from device '%s'"
-msgstr "No s'han pogut mapejar les memòries intermèdies del dispositiu «%s»"
+msgstr ""
 
 #, c-format
 msgid "The driver of device '%s' does not support any known capture method."
 msgstr ""
-"El controlador del dispositiu «%s» no és compatible amb cap mètode de "
-"captura conegut."
 
 msgid "Changing resolution at runtime is not yet supported."
-msgstr "Encara no es permet el canvi de la resolució en temps d'execució."
+msgstr ""
 
 msgid "Cannot operate without a clock"
-msgstr "No es pot operar sense un rellotge"
-
-#~ msgid "Describes the selected input element."
-#~ msgstr "Descriu l'element d'entrada seleccionat."
-
-#~ msgid "Describes the selected output element for Audio/Video Conferencing."
-#~ msgstr ""
-#~ "Descriu l'element de sortida seleccionat per a les conferències d'àudio/"
-#~ "vídeo."
-
-#~ msgid "Describes the selected output element for Music and Movies."
-#~ msgstr ""
-#~ "Descriu l'element de sortida seleccionat per a la música i les "
-#~ "pel·lícules."
-
-#~ msgid "Describes the selected output element."
-#~ msgstr "Descriu l'element de sortida seleccionat."
-
-#~ msgid "GStreamer audiosink for Audio/Video Conferencing"
-#~ msgstr "L'audiosink del GStreamer per a les conferències d'àudio/vídeo"
-
-#~ msgid "GStreamer audiosink for Music and Movies"
-#~ msgstr "L'audiosink del GStreamer per a la música i les pel·lícules"
-
-#~ msgid ""
-#~ "GStreamer can play audio using any number of output elements. Some "
-#~ "possible choices are osssink, esdsink and alsasink. The audiosink can be "
-#~ "a partial pipeline instead of just one element."
-#~ msgstr ""
-#~ "El GStreamer pot reproduir l'àudio utilitzant qualsevol nombre d'elements "
-#~ "de sortida. Algunes opcions possibles són l'osssink, l'esdsink i "
-#~ "l'alsasink. L'audiosink pot ser un conducte parcial en lloc d'un sol "
-#~ "element."
-
-#~ msgid ""
-#~ "GStreamer can play video using any number of output elements. Some "
-#~ "possible choices are xvimagesink, ximagesink, sdlvideosink and aasink. "
-#~ "The videosink can be a partial pipeline instead of just one element."
-#~ msgstr ""
-#~ "El GStreamer pot reproduir el vídeo utilitzant qualsevol nombre "
-#~ "d'elements de sortida. Algunes opcions possibles són el xvimagesink, el "
-#~ "ximagesink, el sdlvideosink i l'aasink. El videosink pot ser un conducte "
-#~ "parcial en lloc d'un sol element."
-
-#~ msgid ""
-#~ "GStreamer can put visualization plugins in a pipeline to transform audio "
-#~ "stream in video frames. Default is goom but more visualization plugins "
-#~ "will be ported soon. The visualization plugin can be a partial pipeline "
-#~ "instead of just one element."
-#~ msgstr ""
-#~ "El GStreamer pot posar els connectors de visualització en un conducte per "
-#~ "transformar el flux d'àudio en els fotogrames del vídeo. Per defecte és "
-#~ "el goom però aviat s'importaran més connectors de visualització. El "
-#~ "connector de visualització pot ser un conducte parcial en lloc d'un sol "
-#~ "element."
-
-#~ msgid ""
-#~ "GStreamer can record audio using any number of input elements. Some "
-#~ "possible choices are osssrc, esdsrc and alsasrc. The audio source can be "
-#~ "a partial pipeline instead of just one element."
-#~ msgstr ""
-#~ "El GStreamer pot enregistrar l'àudio utilitzant qualsevol nombre "
-#~ "d'elements d'entrada. Algunes opcions possibles són l'osssrc, l'esdsrc i "
-#~ "l'alsasrc. La font d'àudio pot ser un conducte parcial en lloc d'un sol "
-#~ "element."
-
-#~ msgid ""
-#~ "GStreamer can record video from any number of input elements. Some "
-#~ "possible choices are v4lsrc and videotestsrc. The video source can be a "
-#~ "partial pipeline instead of just one element."
-#~ msgstr ""
-#~ "El GStreamer pot enregistrar el vídeo de qualsevol nombre d'elements "
-#~ "d'entrada. Algunes opcions possibles són el v4lsrc i el videotestsrc. La "
-#~ "font del vídeo pot ser un conducte parcial en lloc d'un sol element."
-
-#~ msgid "default GStreamer audio source"
-#~ msgstr "font d'àudio del GStreamer per defecte"
-
-#~ msgid "default GStreamer audiosink"
-#~ msgstr "audiosink del GStreamer per defecte"
-
-#~ msgid "default GStreamer video source"
-#~ msgstr "font de vídeo del GStreamer per defecte"
-
-#~ msgid "default GStreamer videosink"
-#~ msgstr "videosink del GStreamer per defecte"
-
-#~ msgid "default GStreamer visualization plugin"
-#~ msgstr "connector de visualització del GStreamer per defecte"
-
-#~ msgid "description for GStreamer audiosink for Audio/Video Conferencing"
-#~ msgstr ""
-#~ "descripció de l'audiosink del GStreamer per a les conferències d'àudio/"
-#~ "vídeo"
-
-#~ msgid "description for GStreamer audiosink for Music and Movies"
-#~ msgstr ""
-#~ "descripció de l'audiosink del GStreamer per a la música i les pel·lícules"
-
-#~ msgid "description for default GStreamer audiosink"
-#~ msgstr "descripció de l'audiosink del GStreamer per defecte"
-
-#~ msgid "description for default GStreamer audiosrc"
-#~ msgstr "descripció de l'audiosrc del GStreamer per defecte"
+msgstr ""
diff --git a/po/cs.po b/po/cs.po
index ab849d2..9a92b87 100644
--- a/po/cs.po
+++ b/po/cs.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good-0.10.26.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-01-12 23:07+0100\n"
 "Last-Translator: Petr Kovar <pknbe@volny.cz>\n"
 "Language-Team: Czech <translation-team-cs@lists.sourceforge.net>\n"
diff --git a/po/da.po b/po/da.po
index 2cfb6df..1ee58b3 100644
--- a/po/da.po
+++ b/po/da.po
@@ -12,7 +12,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good-0.10.26.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-01-07 23:54+0200\n"
 "Last-Translator: Joe Hansen <joedalton2@yahoo.dk>\n"
 "Language-Team: Danish <dansk@dansk-gruppen.dk>\n"
diff --git a/po/de.po b/po/de.po
index 3281ae5..d02c6d9 100644
--- a/po/de.po
+++ b/po/de.po
@@ -14,7 +14,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.26.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-01-21 22:36+0100\n"
 "Last-Translator: Christian Kirbach <christian.kirbach@googlemail.com>\n"
 "Language-Team: German <translation-team-de@lists.sourceforge.net>\n"
diff --git a/po/el.po b/po/el.po
index 08b2099..666c90b 100644
--- a/po/el.po
+++ b/po/el.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.25.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2010-10-27 12:16+0200\n"
 "Last-Translator: Michael Kotsarinis <mk73628@gmail.com>\n"
 "Language-Team: Greek <team@lists.gnome.gr>\n"
diff --git a/po/en_GB.po b/po/en_GB.po
index e3eae96..2568d35 100644
--- a/po/en_GB.po
+++ b/po/en_GB.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins 0.8.1\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2004-04-26 10:41-0400\n"
 "Last-Translator: Gareth Owen <gowen72@yahoo.com>\n"
 "Language-Team: English (British) <en_gb@li.org>\n"
diff --git a/po/eo.po b/po/eo.po
index 4813b1a..73f84a3 100644
--- a/po/eo.po
+++ b/po/eo.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.28.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-04-16 16:25+0100\n"
 "PO-Revision-Date: 2011-06-04 21:48+0100\n"
 "Last-Translator: Kristjan SCHMIDT <kristjan.schmidt@googlemail.com>\n"
 "Language-Team: Esperanto <translation-team-eo@lists.sourceforge.net>\n"
@@ -17,635 +17,816 @@ msgstr ""
 "Content-Transfer-Encoding: 8bit\n"
 "Plural-Forms: nplurals=2; plural=(n != 1);\n"
 
+#: ext/esd/esdsink.c:253 ext/esd/esdsink.c:358
 msgid "Could not establish connection to sound server"
 msgstr ""
 
+#: ext/esd/esdsink.c:260
 msgid "Failed to query sound server capabilities"
 msgstr ""
 
 #. TRANSLATORS: 'song title' by 'artist name'
+#: ext/pulse/pulsesink.c:2686
 #, c-format
 msgid "'%s' by '%s'"
 msgstr "'%s' de '%s'"
 
+#: ext/flac/gstflacdec.c:1117 ext/libpng/gstpngdec.c:349
+#: ext/libpng/gstpngdec.c:360 ext/libpng/gstpngdec.c:559
+#: ext/wavpack/gstwavpackparse.c:1170 gst/avi/gstavidemux.c:5203
 msgid "Internal data stream error."
 msgstr "Interna datumflu-eraro."
 
+#: ext/jpeg/gstjpegdec.c:286
 msgid "Failed to decode JPEG image"
 msgstr ""
 
+#: ext/shout2/gstshout2.c:578
 msgid "Could not connect to server"
 msgstr "Ne eblis konekti al servilo"
 
+#: ext/soup/gstsouphttpsrc.c:871
 msgid "Server does not support seeking."
 msgstr ""
 
+#: ext/soup/gstsouphttpsrc.c:1078
 msgid "Could not resolve server name."
 msgstr ""
 
+#: ext/soup/gstsouphttpsrc.c:1084
 msgid "Could not establish connection to server."
 msgstr ""
 
+#: ext/soup/gstsouphttpsrc.c:1089
 msgid "Secure connection setup failed."
 msgstr ""
 
-msgid ""
-"A network error occured, or the server closed the connection unexpectedly."
+#: ext/soup/gstsouphttpsrc.c:1094
+msgid "A network error occured, or the server closed the connection unexpectedly."
 msgstr ""
 
+#: ext/soup/gstsouphttpsrc.c:1100
 msgid "Server sent bad data."
 msgstr ""
 
+#: ext/soup/gstsouphttpsrc.c:1249
 msgid "No URL set."
 msgstr ""
 
+#: gst/avi/gstavimux.c:1810
 msgid "No or invalid input audio, AVI stream will be corrupt."
 msgstr ""
 
+#: gst/quicktime/qtdemux.c:519 gst/quicktime/qtdemux.c:523
 msgid "This file contains no playable streams."
 msgstr ""
 
+#: gst/quicktime/qtdemux.c:558 gst/quicktime/qtdemux.c:4009
+#: gst/quicktime/qtdemux.c:4071 gst/quicktime/qtdemux.c:4219
 msgid "This file is invalid and cannot be played."
 msgstr ""
 
+#: gst/quicktime/qtdemux.c:2439 gst/quicktime/qtdemux.c:2515
+#: gst/quicktime/qtdemux.c:2558 gst/quicktime/qtdemux.c:4798
+#: gst/quicktime/qtdemux.c:4805 gst/quicktime/qtdemux.c:5391
+#: gst/quicktime/qtdemux.c:5817 gst/quicktime/qtdemux.c:5824
+#: gst/quicktime/qtdemux.c:7305
 msgid "This file is corrupt and cannot be played."
 msgstr ""
 
+#: gst/quicktime/qtdemux.c:2647
 msgid "Invalid atom size."
 msgstr ""
 
+#: gst/quicktime/qtdemux.c:2716
 msgid "This file is incomplete and cannot be played."
 msgstr ""
 
+#: gst/quicktime/qtdemux.c:4994
 msgid "The video in this file might not play correctly."
 msgstr ""
 
+#: gst/quicktime/qtdemux.c:7334
 #, c-format
 msgid "This file contains too many streams. Only playing first %d"
 msgstr ""
 
-msgid ""
-"No supported stream was found. You might need to install a GStreamer RTSP "
-"extension plugin for Real media streams."
+#: gst/rtsp/gstrtspsrc.c:5187
+msgid "No supported stream was found. You might need to install a GStreamer RTSP extension plugin for Real media streams."
 msgstr ""
 
-msgid ""
-"No supported stream was found. You might need to allow more transport "
-"protocols or may otherwise be missing the right GStreamer RTSP extension "
-"plugin."
+#: gst/rtsp/gstrtspsrc.c:5192
+msgid "No supported stream was found. You might need to allow more transport protocols or may otherwise be missing the right GStreamer RTSP extension plugin."
 msgstr ""
 
+#: gst/wavparse/gstwavparse.c:2103
 msgid "Internal data flow error."
 msgstr ""
 
+#: sys/oss/gstossmixertrack.c:98 sys/oss4/oss4-mixer.c:722
+#: sys/sunaudio/gstsunaudiomixertrack.c:69
 msgid "Volume"
 msgstr "Laŭteco"
 
+#: sys/oss/gstossmixertrack.c:99 sys/oss4/oss4-mixer.c:735
 msgid "Bass"
 msgstr "Baso"
 
+#: sys/oss/gstossmixertrack.c:100 sys/oss4/oss4-mixer.c:736
 msgid "Treble"
 msgstr ""
 
+#: sys/oss/gstossmixertrack.c:101
 msgid "Synth"
 msgstr "Sintezilo"
 
+#: sys/oss/gstossmixertrack.c:102 sys/oss4/oss4-mixer.c:750
 msgid "PCM"
 msgstr ""
 
+#: sys/oss/gstossmixertrack.c:103
 msgid "Speaker"
 msgstr "Parolilo"
 
+#: sys/oss/gstossmixertrack.c:104
 msgid "Line-in"
 msgstr ""
 
+#: sys/oss/gstossmixertrack.c:105 sys/oss4/oss4-mixer.c:741
 msgid "Microphone"
 msgstr "Mikrofono"
 
+#: sys/oss/gstossmixertrack.c:106
 msgid "CD"
 msgstr "KD"
 
+#: sys/oss/gstossmixertrack.c:107
 msgid "Mixer"
 msgstr "Miksilo"
 
+#: sys/oss/gstossmixertrack.c:108
 msgid "PCM-2"
 msgstr ""
 
+#: sys/oss/gstossmixertrack.c:109
 msgid "Record"
 msgstr "Registri"
 
+#: sys/oss/gstossmixertrack.c:110
 msgid "In-gain"
 msgstr ""
 
+#: sys/oss/gstossmixertrack.c:111
 msgid "Out-gain"
 msgstr ""
 
+#: sys/oss/gstossmixertrack.c:112
 msgid "Line-1"
 msgstr ""
 
+#: sys/oss/gstossmixertrack.c:113
 msgid "Line-2"
 msgstr ""
 
+#: sys/oss/gstossmixertrack.c:114
 msgid "Line-3"
 msgstr ""
 
+#: sys/oss/gstossmixertrack.c:115
 msgid "Digital-1"
 msgstr ""
 
+#: sys/oss/gstossmixertrack.c:116
 msgid "Digital-2"
 msgstr ""
 
+#: sys/oss/gstossmixertrack.c:117
 msgid "Digital-3"
 msgstr ""
 
+#: sys/oss/gstossmixertrack.c:118
 msgid "Phone-in"
 msgstr ""
 
+#: sys/oss/gstossmixertrack.c:119
 msgid "Phone-out"
 msgstr ""
 
+#: sys/oss/gstossmixertrack.c:120
 msgid "Video"
 msgstr "Video"
 
+#: sys/oss/gstossmixertrack.c:121
 msgid "Radio"
 msgstr "Radio"
 
+#: sys/oss/gstossmixertrack.c:122 sys/oss4/oss4-mixer.c:764
+#: sys/sunaudio/gstsunaudiomixertrack.c:71
 msgid "Monitor"
 msgstr "Ekrano"
 
-msgid ""
-"Could not open audio device for playback. Device is being used by another "
-"application."
-msgstr ""
-"Ne eblis malfermi la sonaparaton por reproduktado. Ĝi estas uzate de alia "
-"aplikaĵo."
+#: sys/oss/gstosssink.c:399 sys/oss4/oss4-sink.c:494
+#: sys/oss4/oss4-source.c:361
+msgid "Could not open audio device for playback. Device is being used by another application."
+msgstr "Ne eblis malfermi la sonaparaton por reproduktado. Ĝi estas uzate de alia aplikaĵo."
 
-msgid ""
-"Could not open audio device for playback. You don't have permission to open "
-"the device."
+#: sys/oss/gstosssink.c:406 sys/oss4/oss4-sink.c:504
+#: sys/oss4/oss4-source.c:371
+msgid "Could not open audio device for playback. You don't have permission to open the device."
 msgstr ""
 
+#: sys/oss/gstosssink.c:414 sys/oss4/oss4-sink.c:515
+#: sys/oss4/oss4-source.c:382
 msgid "Could not open audio device for playback."
 msgstr "Ne eblis malfermi la sonaparaton por reproduktado."
 
-msgid ""
-"Could not open audio device for recording. You don't have permission to open "
-"the device."
+#: sys/oss/gstosssrc.c:370
+msgid "Could not open audio device for recording. You don't have permission to open the device."
 msgstr ""
 
+#: sys/oss/gstosssrc.c:378
 msgid "Could not open audio device for recording."
 msgstr "Ne eblis malfermi sonaparaton por registrado."
 
+#: sys/oss4/oss4-mixer.c:302
 msgid "Could not open audio device for mixer control handling."
 msgstr ""
 
-msgid ""
-"Could not open audio device for mixer control handling. This version of the "
-"Open Sound System is not supported by this element."
+#: sys/oss4/oss4-mixer.c:316
+msgid "Could not open audio device for mixer control handling. This version of the Open Sound System is not supported by this element."
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:723
 msgid "Master"
 msgstr "Ĉefe"
 
+#: sys/oss4/oss4-mixer.c:724
 msgid "Front"
 msgstr "Antaŭe"
 
+#: sys/oss4/oss4-mixer.c:725
 msgid "Rear"
 msgstr "Malantaŭe"
 
+#: sys/oss4/oss4-mixer.c:726
 msgid "Headphones"
 msgstr "Kaptelefono"
 
+#: sys/oss4/oss4-mixer.c:727
 msgid "Center"
 msgstr "Centre"
 
+#: sys/oss4/oss4-mixer.c:728
 msgid "LFE"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:729
 msgid "Surround"
 msgstr "Ĉirkaŭe"
 
+#: sys/oss4/oss4-mixer.c:730
 msgid "Side"
 msgstr "Flanke"
 
+#: sys/oss4/oss4-mixer.c:731 sys/sunaudio/gstsunaudiomixertrack.c:72
 msgid "Built-in Speaker"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:732 sys/sunaudio/gstsunaudiomixertrack.c:76
 msgid "AUX 1 Out"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:733 sys/sunaudio/gstsunaudiomixertrack.c:77
 msgid "AUX 2 Out"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:734
 msgid "AUX Out"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:737
 msgid "3D Depth"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:738
 msgid "3D Center"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:739
 msgid "3D Enhance"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:740
 msgid "Telephone"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:742 sys/sunaudio/gstsunaudiomixertrack.c:74
 msgid "Line Out"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:743 sys/oss4/oss4-mixer.c:744
 msgid "Line In"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:745
 msgid "Internal CD"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:746
 msgid "Video In"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:747
 msgid "AUX 1 In"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:748
 msgid "AUX 2 In"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:749
 msgid "AUX In"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:751 sys/oss4/oss4-mixer.c:752
 msgid "Record Gain"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:753
 msgid "Output Gain"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:754
 msgid "Microphone Boost"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:755
 msgid "Loopback"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:756
 msgid "Diagnostic"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:757
 msgid "Bass Boost"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:758
 msgid "Playback Ports"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:759
 msgid "Input"
 msgstr "Enigo"
 
+#: sys/oss4/oss4-mixer.c:760 sys/oss4/oss4-mixer.c:761
 msgid "Record Source"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:762
 msgid "Monitor Source"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:763
 msgid "Keyboard Beep"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:765
 msgid "Simulate Stereo"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:766 sys/oss4/oss4-mixer.c:786
 msgid "Stereo"
 msgstr "Dukanale"
 
+#: sys/oss4/oss4-mixer.c:767
 msgid "Surround Sound"
 msgstr "Ĉirkaŭa sono"
 
+#: sys/oss4/oss4-mixer.c:768
 msgid "Microphone Gain"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:769
 msgid "Speaker Source"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:770
 msgid "Microphone Source"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:771
 msgid "Jack"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:772
 msgid "Center / LFE"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:773
 msgid "Stereo Mix"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:774
 msgid "Mono Mix"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:775
 msgid "Input Mix"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:776
 msgid "SPDIF In"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:777 sys/sunaudio/gstsunaudiomixertrack.c:75
 msgid "SPDIF Out"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:778
 msgid "Microphone 1"
 msgstr "Mikrofono 1"
 
+#: sys/oss4/oss4-mixer.c:779
 msgid "Microphone 2"
 msgstr "Mikrofono 2"
 
+#: sys/oss4/oss4-mixer.c:780
 msgid "Digital Out"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:781
 msgid "Digital In"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:782
 msgid "HDMI"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:783
 msgid "Modem"
 msgstr "Modemo"
 
+#: sys/oss4/oss4-mixer.c:784
 msgid "Handset"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:785
 msgid "Other"
 msgstr "Alia"
 
+#: sys/oss4/oss4-mixer.c:787
 msgid "None"
 msgstr "Neniu"
 
+#: sys/oss4/oss4-mixer.c:788
 msgid "On"
 msgstr "Enŝaltite"
 
+#: sys/oss4/oss4-mixer.c:789
 msgid "Off"
 msgstr "Elŝaltite"
 
+#: sys/oss4/oss4-mixer.c:790
 msgid "Mute"
 msgstr "Silentigi"
 
+#: sys/oss4/oss4-mixer.c:791
 msgid "Fast"
 msgstr "Rapide"
 
 #. TRANSLATORS: "Very Low" is a quality setting here
+#: sys/oss4/oss4-mixer.c:793
 msgid "Very Low"
 msgstr "Tre malalte"
 
 #. TRANSLATORS: "Low" is a quality setting here
+#: sys/oss4/oss4-mixer.c:795
 msgid "Low"
 msgstr "Malalte"
 
 #. TRANSLATORS: "Medium" is a quality setting here
+#: sys/oss4/oss4-mixer.c:797
 msgid "Medium"
 msgstr "Meze"
 
 #. TRANSLATORS: "High" is a quality setting here
+#: sys/oss4/oss4-mixer.c:799
 msgid "High"
 msgstr "Alte"
 
 #. TRANSLATORS: "Very High" is a quality setting here
+#: sys/oss4/oss4-mixer.c:801 sys/oss4/oss4-mixer.c:802
 msgid "Very High"
 msgstr "Tre alte"
 
 #. TRANSLATORS: "Production" is a quality setting here
+#: sys/oss4/oss4-mixer.c:804
 msgid "Production"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:805
 msgid "Front Panel Microphone"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:806
 msgid "Front Panel Line In"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:807
 msgid "Front Panel Headphones"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:808
 msgid "Front Panel Line Out"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:809
 msgid "Green Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:810
 msgid "Pink Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:811
 msgid "Blue Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:812
 msgid "White Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:813
 msgid "Black Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:814
 msgid "Gray Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:815
 msgid "Orange Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:816
 msgid "Red Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:817
 msgid "Yellow Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:818
 msgid "Green Front Panel Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:819
 msgid "Pink Front Panel Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:820
 msgid "Blue Front Panel Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:821
 msgid "White Front Panel Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:822
 msgid "Black Front Panel Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:823
 msgid "Gray Front Panel Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:824
 msgid "Orange Front Panel Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:825
 msgid "Red Front Panel Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:826
 msgid "Yellow Front Panel Connector"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:827
 msgid "Spread Output"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:828
 msgid "Downmix"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:872
 msgid "Virtual Mixer Input"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:874
 msgid "Virtual Mixer Output"
 msgstr ""
 
+#: sys/oss4/oss4-mixer.c:876
 msgid "Virtual Mixer Channels"
 msgstr ""
 
 #. TRANSLATORS: name + number of a volume mixer control
+#: sys/oss4/oss4-mixer.c:927
 #, c-format
 msgid "%s %d Function"
 msgstr "%s %d funkcio"
 
 #. TRANSLATORS: name of a volume mixer control
+#: sys/oss4/oss4-mixer.c:934
 #, c-format
 msgid "%s Function"
 msgstr "%s funcio"
 
-msgid ""
-"Could not open audio device for playback. This version of the Open Sound "
-"System is not supported by this element."
+#: sys/oss4/oss4-sink.c:524 sys/oss4/oss4-source.c:392
+msgid "Could not open audio device for playback. This version of the Open Sound System is not supported by this element."
 msgstr ""
 
+#: sys/oss4/oss4-sink.c:640
 msgid "Playback is not supported by this audio device."
 msgstr ""
 
+#: sys/oss4/oss4-sink.c:647
 msgid "Audio playback error."
 msgstr ""
 
+#: sys/oss4/oss4-source.c:514
 msgid "Recording is not supported by this audio device."
 msgstr ""
 
+#: sys/oss4/oss4-source.c:521
 msgid "Error recording from audio device."
 msgstr ""
 
+#: sys/sunaudio/gstsunaudiomixertrack.c:70
 msgid "Gain"
 msgstr ""
 
+#: sys/sunaudio/gstsunaudiomixertrack.c:73
 msgid "Headphone"
 msgstr ""
 
+#: sys/v4l2/gstv4l2src.c:887
 #, c-format
 msgid "Error reading %d bytes from device '%s'."
 msgstr ""
 
+#: sys/v4l2/gstv4l2src.c:913
 #, c-format
 msgid "Got unexpected frame size of %u instead of %u."
 msgstr ""
 
+#: sys/v4l2/gstv4l2src.c:931
 #, c-format
 msgid "Error reading %d bytes on device '%s'."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:99
 #, c-format
-msgid ""
-"Error getting capabilities for device '%s': It isn't a v4l2 driver. Check if "
-"it is a v4l1 driver."
+msgid "Error getting capabilities for device '%s': It isn't a v4l2 driver. Check if it is a v4l1 driver."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:139
 #, c-format
 msgid "Failed to query attributes of input %d in device %s"
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:169
 #, c-format
 msgid "Failed to get setting of tuner %d on device '%s'."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:213
 #, c-format
 msgid "Failed to query norm on device '%s'."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:264 sys/v4l2/v4l2_calls.c:347
 #, c-format
 msgid "Failed getting controls attributes on device '%s'."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:492
 #, c-format
 msgid "Cannot identify device '%s'."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:499
 #, c-format
 msgid "This isn't a device '%s'."
 msgstr "Tio ne estas '%s'-aparato."
 
+#: sys/v4l2/v4l2_calls.c:506
 #, c-format
 msgid "Could not open device '%s' for reading and writing."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:513
 #, c-format
 msgid "Device '%s' is not a capture device."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:522
 #, c-format
 msgid "Device '%s' is not a output device."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:622
 #, c-format
 msgid "Failed to set norm for device '%s'."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:660
 #, c-format
 msgid "Failed to get current tuner frequency for device '%s'."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:702
 #, c-format
 msgid "Failed to set current tuner frequency for device '%s' to %lu Hz."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:736
 #, c-format
 msgid "Failed to get signal strength for device '%s'."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:772
 #, c-format
 msgid "Failed to get value for control %d on device '%s'."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:807
 #, c-format
 msgid "Failed to set value %d for control %d on device '%s'."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:839
 #, c-format
 msgid "Failed to get current input on device '%s'. May be it is a radio device"
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:864
 #, c-format
 msgid "Failed to set input %d on device %s."
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:896
 #, c-format
-msgid ""
-"Failed to get current output on device '%s'. May be it is a radio device"
+msgid "Failed to get current output on device '%s'. May be it is a radio device"
 msgstr ""
 
+#: sys/v4l2/v4l2_calls.c:921
 #, c-format
 msgid "Failed to set output %d on device %s."
 msgstr ""
 
+#: sys/v4l2/v4l2src_calls.c:81
 #, c-format
 msgid "Could not enqueue buffers in device '%s'."
 msgstr ""
 
+#: sys/v4l2/v4l2src_calls.c:197
 #, c-format
 msgid "Failed trying to get video frames from device '%s'."
 msgstr ""
 
+#: sys/v4l2/v4l2src_calls.c:199
 #, c-format
 msgid "Failed after %d tries. device %s. system error: %s"
 msgstr ""
 
+#: sys/v4l2/v4l2src_calls.c:239
 #, c-format
 msgid "Could not get parameters on device '%s'"
 msgstr ""
 
+#: sys/v4l2/v4l2src_calls.c:267
 msgid "Video input device did not accept new frame rate setting."
 msgstr ""
 
+#: sys/v4l2/v4l2src_calls.c:339
 #, c-format
 msgid "Could not map buffers from device '%s'"
 msgstr ""
 
+#: sys/v4l2/v4l2src_calls.c:347
 #, c-format
 msgid "The driver of device '%s' does not support any known capture method."
 msgstr ""
 
+#: sys/ximage/gstximagesrc.c:719
 msgid "Changing resolution at runtime is not yet supported."
 msgstr ""
 
+#: sys/ximage/gstximagesrc.c:733
 msgid "Cannot operate without a clock"
 msgstr ""
diff --git a/po/es.po b/po/es.po
index 487fd7f..2a66fc9 100644
--- a/po/es.po
+++ b/po/es.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.26.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-02-12 18:30+0100\n"
 "Last-Translator: Jorge González González <aloriel@gmail.com>\n"
 "Language-Team: Spanish <es@li.org>\n"
diff --git a/po/eu.po b/po/eu.po
index 61db9d0..710d817 100644
--- a/po/eu.po
+++ b/po/eu.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good-0.10.18.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2010-03-25 12:37+0100\n"
 "Last-Translator: Mikel Olasagasti Uranga <hey_neken@mundurat.net>\n"
 "Language-Team: Basque <translation-team-eu@lists.sourceforge.net>\n"
diff --git a/po/fi.po b/po/fi.po
index 7363d97..ff809c5 100644
--- a/po/fi.po
+++ b/po/fi.po
@@ -11,7 +11,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.25.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2010-11-17 23:03+0200\n"
 "Last-Translator: Tommi Vainikainen <Tommi.Vainikainen@iki.fi>\n"
 "Language-Team: Finnish <translation-team-fi@lists.sourceforge.net>\n"
diff --git a/po/fr.po b/po/fr.po
index 945e1e5..c3a6013 100644
--- a/po/fr.po
+++ b/po/fr.po
@@ -9,7 +9,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.28.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-04-28 09:22+0200\n"
 "Last-Translator: Claude Paroz <claude@2xlibre.net>\n"
 "Language-Team: French <traduc@traduc.org>\n"
diff --git a/po/gl.po b/po/gl.po
index b0b12f2..c8f52a6 100644
--- a/po/gl.po
+++ b/po/gl.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.26.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-01-09 21:20+0100\n"
 "Last-Translator: Fran Diéguez <frandieguez@ubuntu.com>\n"
 "Language-Team: Galician <proxecto@trasno.net>\n"
diff --git a/po/gst-plugins-good-0.10.pot b/po/gst-plugins-good-0.10.pot
index c9aee42..e69de29 100644
--- a/po/gst-plugins-good-0.10.pot
+++ b/po/gst-plugins-good-0.10.pot
@@ -1,850 +0,0 @@
-# SOME DESCRIPTIVE TITLE.
-# This file is put in the public domain.
-# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
-#
-#, fuzzy
-msgid ""
-msgstr ""
-"Project-Id-Version: gst-plugins-good 0.10.31\n"
-"Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
-"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
-"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
-"Language-Team: LANGUAGE <LL@li.org>\n"
-"Language: \n"
-"MIME-Version: 1.0\n"
-"Content-Type: text/plain; charset=CHARSET\n"
-"Content-Transfer-Encoding: 8bit\n"
-
-#: ext/esd/esdsink.c:252 ext/esd/esdsink.c:357
-msgid "Could not establish connection to sound server"
-msgstr ""
-
-#: ext/esd/esdsink.c:259
-msgid "Failed to query sound server capabilities"
-msgstr ""
-
-#. TRANSLATORS: 'song title' by 'artist name'
-#: ext/pulse/pulsesink.c:2889
-#, c-format
-msgid "'%s' by '%s'"
-msgstr ""
-
-#: ext/flac/gstflacdec.c:1150 ext/libpng/gstpngdec.c:343
-#: ext/libpng/gstpngdec.c:354 ext/libpng/gstpngdec.c:553
-#: ext/wavpack/gstwavpackparse.c:1173 gst/avi/gstavidemux.c:5211
-msgid "Internal data stream error."
-msgstr ""
-
-#: ext/jpeg/gstjpegdec.c:289
-msgid "Failed to decode JPEG image"
-msgstr ""
-
-#: ext/shout2/gstshout2.c:588
-msgid "Could not connect to server"
-msgstr ""
-
-#: ext/soup/gstsouphttpsrc.c:873
-msgid "Server does not support seeking."
-msgstr ""
-
-#: ext/soup/gstsouphttpsrc.c:1080
-msgid "Could not resolve server name."
-msgstr ""
-
-#: ext/soup/gstsouphttpsrc.c:1086
-msgid "Could not establish connection to server."
-msgstr ""
-
-#: ext/soup/gstsouphttpsrc.c:1091
-msgid "Secure connection setup failed."
-msgstr ""
-
-#: ext/soup/gstsouphttpsrc.c:1096
-msgid ""
-"A network error occured, or the server closed the connection unexpectedly."
-msgstr ""
-
-#: ext/soup/gstsouphttpsrc.c:1102
-msgid "Server sent bad data."
-msgstr ""
-
-#: ext/soup/gstsouphttpsrc.c:1251
-msgid "No URL set."
-msgstr ""
-
-#: gst/avi/gstavimux.c:1806
-msgid "No or invalid input audio, AVI stream will be corrupt."
-msgstr ""
-
-#: gst/isomp4/qtdemux.c:522 gst/isomp4/qtdemux.c:526
-msgid "This file contains no playable streams."
-msgstr ""
-
-#: gst/isomp4/qtdemux.c:561 gst/isomp4/qtdemux.c:4080
-#: gst/isomp4/qtdemux.c:4150 gst/isomp4/qtdemux.c:4299
-msgid "This file is invalid and cannot be played."
-msgstr ""
-
-#: gst/isomp4/qtdemux.c:2464 gst/isomp4/qtdemux.c:2540
-#: gst/isomp4/qtdemux.c:2583 gst/isomp4/qtdemux.c:4881
-#: gst/isomp4/qtdemux.c:4888 gst/isomp4/qtdemux.c:5479
-#: gst/isomp4/qtdemux.c:5907 gst/isomp4/qtdemux.c:5914
-#: gst/isomp4/qtdemux.c:7477
-msgid "This file is corrupt and cannot be played."
-msgstr ""
-
-#: gst/isomp4/qtdemux.c:2672
-msgid "Invalid atom size."
-msgstr ""
-
-#: gst/isomp4/qtdemux.c:2741
-msgid "This file is incomplete and cannot be played."
-msgstr ""
-
-#: gst/isomp4/qtdemux.c:5077
-msgid "The video in this file might not play correctly."
-msgstr ""
-
-#: gst/isomp4/qtdemux.c:7506
-#, c-format
-msgid "This file contains too many streams. Only playing first %d"
-msgstr ""
-
-#: gst/rtsp/gstrtspsrc.c:5380
-msgid ""
-"No supported stream was found. You might need to install a GStreamer RTSP "
-"extension plugin for Real media streams."
-msgstr ""
-
-#: gst/rtsp/gstrtspsrc.c:5385
-msgid ""
-"No supported stream was found. You might need to allow more transport "
-"protocols or may otherwise be missing the right GStreamer RTSP extension "
-"plugin."
-msgstr ""
-
-#: gst/wavparse/gstwavparse.c:2109
-msgid "Internal data flow error."
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:98 sys/oss4/oss4-mixer.c:728
-#: sys/sunaudio/gstsunaudiomixertrack.c:69
-msgid "Volume"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:99 sys/oss4/oss4-mixer.c:741
-msgid "Bass"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:100 sys/oss4/oss4-mixer.c:742
-msgid "Treble"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:101
-msgid "Synth"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:102 sys/oss4/oss4-mixer.c:756
-msgid "PCM"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:103
-msgid "Speaker"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:104
-msgid "Line-in"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:105 sys/oss4/oss4-mixer.c:747
-msgid "Microphone"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:106
-msgid "CD"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:107
-msgid "Mixer"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:108
-msgid "PCM-2"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:109
-msgid "Record"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:110
-msgid "In-gain"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:111
-msgid "Out-gain"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:112
-msgid "Line-1"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:113
-msgid "Line-2"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:114
-msgid "Line-3"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:115
-msgid "Digital-1"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:116
-msgid "Digital-2"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:117
-msgid "Digital-3"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:118
-msgid "Phone-in"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:119
-msgid "Phone-out"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:120
-msgid "Video"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:121
-msgid "Radio"
-msgstr ""
-
-#: sys/oss/gstossmixertrack.c:122 sys/oss4/oss4-mixer.c:770
-#: sys/sunaudio/gstsunaudiomixertrack.c:71
-msgid "Monitor"
-msgstr ""
-
-#: sys/oss/gstosssink.c:399 sys/oss4/oss4-sink.c:495
-#: sys/oss4/oss4-source.c:362
-msgid ""
-"Could not open audio device for playback. Device is being used by another "
-"application."
-msgstr ""
-
-#: sys/oss/gstosssink.c:406 sys/oss4/oss4-sink.c:505
-#: sys/oss4/oss4-source.c:372
-msgid ""
-"Could not open audio device for playback. You don't have permission to open "
-"the device."
-msgstr ""
-
-#: sys/oss/gstosssink.c:414 sys/oss4/oss4-sink.c:516
-#: sys/oss4/oss4-source.c:383
-msgid "Could not open audio device for playback."
-msgstr ""
-
-#: sys/oss/gstosssrc.c:370
-msgid ""
-"Could not open audio device for recording. You don't have permission to open "
-"the device."
-msgstr ""
-
-#: sys/oss/gstosssrc.c:378
-msgid "Could not open audio device for recording."
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:303
-msgid "Could not open audio device for mixer control handling."
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:317
-msgid ""
-"Could not open audio device for mixer control handling. This version of the "
-"Open Sound System is not supported by this element."
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:729
-msgid "Master"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:730
-msgid "Front"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:731
-msgid "Rear"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:732
-msgid "Headphones"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:733
-msgid "Center"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:734
-msgid "LFE"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:735
-msgid "Surround"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:736
-msgid "Side"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:737 sys/sunaudio/gstsunaudiomixertrack.c:72
-msgid "Built-in Speaker"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:738 sys/sunaudio/gstsunaudiomixertrack.c:76
-msgid "AUX 1 Out"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:739 sys/sunaudio/gstsunaudiomixertrack.c:77
-msgid "AUX 2 Out"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:740
-msgid "AUX Out"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:743
-msgid "3D Depth"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:744
-msgid "3D Center"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:745
-msgid "3D Enhance"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:746
-msgid "Telephone"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:748 sys/sunaudio/gstsunaudiomixertrack.c:74
-msgid "Line Out"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:749 sys/oss4/oss4-mixer.c:750
-msgid "Line In"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:751
-msgid "Internal CD"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:752
-msgid "Video In"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:753
-msgid "AUX 1 In"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:754
-msgid "AUX 2 In"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:755
-msgid "AUX In"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:757 sys/oss4/oss4-mixer.c:758
-msgid "Record Gain"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:759
-msgid "Output Gain"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:760
-msgid "Microphone Boost"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:761
-msgid "Loopback"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:762
-msgid "Diagnostic"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:763
-msgid "Bass Boost"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:764
-msgid "Playback Ports"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:765
-msgid "Input"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:766 sys/oss4/oss4-mixer.c:767
-msgid "Record Source"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:768
-msgid "Monitor Source"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:769
-msgid "Keyboard Beep"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:771
-msgid "Simulate Stereo"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:772 sys/oss4/oss4-mixer.c:792
-msgid "Stereo"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:773
-msgid "Surround Sound"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:774
-msgid "Microphone Gain"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:775
-msgid "Speaker Source"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:776
-msgid "Microphone Source"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:777
-msgid "Jack"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:778
-msgid "Center / LFE"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:779
-msgid "Stereo Mix"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:780
-msgid "Mono Mix"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:781
-msgid "Input Mix"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:782
-msgid "SPDIF In"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:783 sys/sunaudio/gstsunaudiomixertrack.c:75
-msgid "SPDIF Out"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:784
-msgid "Microphone 1"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:785
-msgid "Microphone 2"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:786
-msgid "Digital Out"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:787
-msgid "Digital In"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:788
-msgid "HDMI"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:789
-msgid "Modem"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:790
-msgid "Handset"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:791
-msgid "Other"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:793
-msgid "None"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:794
-msgid "On"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:795
-msgid "Off"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:796
-msgid "Mute"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:797
-msgid "Fast"
-msgstr ""
-
-#. TRANSLATORS: "Very Low" is a quality setting here
-#: sys/oss4/oss4-mixer.c:799
-msgid "Very Low"
-msgstr ""
-
-#. TRANSLATORS: "Low" is a quality setting here
-#: sys/oss4/oss4-mixer.c:801
-msgid "Low"
-msgstr ""
-
-#. TRANSLATORS: "Medium" is a quality setting here
-#: sys/oss4/oss4-mixer.c:803
-msgid "Medium"
-msgstr ""
-
-#. TRANSLATORS: "High" is a quality setting here
-#: sys/oss4/oss4-mixer.c:805
-msgid "High"
-msgstr ""
-
-#. TRANSLATORS: "Very High" is a quality setting here
-#: sys/oss4/oss4-mixer.c:807 sys/oss4/oss4-mixer.c:808
-msgid "Very High"
-msgstr ""
-
-#. TRANSLATORS: "Production" is a quality setting here
-#: sys/oss4/oss4-mixer.c:810
-msgid "Production"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:811
-msgid "Front Panel Microphone"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:812
-msgid "Front Panel Line In"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:813
-msgid "Front Panel Headphones"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:814
-msgid "Front Panel Line Out"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:815
-msgid "Green Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:816
-msgid "Pink Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:817
-msgid "Blue Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:818
-msgid "White Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:819
-msgid "Black Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:820
-msgid "Gray Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:821
-msgid "Orange Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:822
-msgid "Red Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:823
-msgid "Yellow Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:824
-msgid "Green Front Panel Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:825
-msgid "Pink Front Panel Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:826
-msgid "Blue Front Panel Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:827
-msgid "White Front Panel Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:828
-msgid "Black Front Panel Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:829
-msgid "Gray Front Panel Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:830
-msgid "Orange Front Panel Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:831
-msgid "Red Front Panel Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:832
-msgid "Yellow Front Panel Connector"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:833
-msgid "Spread Output"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:834
-msgid "Downmix"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:878
-msgid "Virtual Mixer Input"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:880
-msgid "Virtual Mixer Output"
-msgstr ""
-
-#: sys/oss4/oss4-mixer.c:882
-msgid "Virtual Mixer Channels"
-msgstr ""
-
-#. TRANSLATORS: name + number of a volume mixer control
-#: sys/oss4/oss4-mixer.c:933
-#, c-format
-msgid "%s %d Function"
-msgstr ""
-
-#. TRANSLATORS: name of a volume mixer control
-#: sys/oss4/oss4-mixer.c:940
-#, c-format
-msgid "%s Function"
-msgstr ""
-
-#: sys/oss4/oss4-sink.c:525 sys/oss4/oss4-source.c:393
-msgid ""
-"Could not open audio device for playback. This version of the Open Sound "
-"System is not supported by this element."
-msgstr ""
-
-#: sys/oss4/oss4-sink.c:641
-msgid "Playback is not supported by this audio device."
-msgstr ""
-
-#: sys/oss4/oss4-sink.c:648
-msgid "Audio playback error."
-msgstr ""
-
-#: sys/oss4/oss4-source.c:515
-msgid "Recording is not supported by this audio device."
-msgstr ""
-
-#: sys/oss4/oss4-source.c:522
-msgid "Error recording from audio device."
-msgstr ""
-
-#: sys/sunaudio/gstsunaudiomixertrack.c:70
-msgid "Gain"
-msgstr ""
-
-#: sys/sunaudio/gstsunaudiomixertrack.c:73
-msgid "Headphone"
-msgstr ""
-
-#: sys/v4l2/gstv4l2src.c:892
-#, c-format
-msgid "Error reading %d bytes from device '%s'."
-msgstr ""
-
-#: sys/v4l2/gstv4l2src.c:918
-#, c-format
-msgid "Got unexpected frame size of %u instead of %u."
-msgstr ""
-
-#: sys/v4l2/gstv4l2src.c:936
-#, c-format
-msgid "Error reading %d bytes on device '%s'."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:99
-#, c-format
-msgid ""
-"Error getting capabilities for device '%s': It isn't a v4l2 driver. Check if "
-"it is a v4l1 driver."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:139
-#, c-format
-msgid "Failed to query attributes of input %d in device %s"
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:169
-#, c-format
-msgid "Failed to get setting of tuner %d on device '%s'."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:213
-#, c-format
-msgid "Failed to query norm on device '%s'."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:347
-#, c-format
-msgid "Failed getting controls attributes on device '%s'."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:492
-#, c-format
-msgid "Cannot identify device '%s'."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:499
-#, c-format
-msgid "This isn't a device '%s'."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:506
-#, c-format
-msgid "Could not open device '%s' for reading and writing."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:513
-#, c-format
-msgid "Device '%s' is not a capture device."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:522
-#, c-format
-msgid "Device '%s' is not a output device."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:622
-#, c-format
-msgid "Failed to set norm for device '%s'."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:660
-#, c-format
-msgid "Failed to get current tuner frequency for device '%s'."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:702
-#, c-format
-msgid "Failed to set current tuner frequency for device '%s' to %lu Hz."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:736
-#, c-format
-msgid "Failed to get signal strength for device '%s'."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:772
-#, c-format
-msgid "Failed to get value for control %d on device '%s'."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:807
-#, c-format
-msgid "Failed to set value %d for control %d on device '%s'."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:839
-#, c-format
-msgid "Failed to get current input on device '%s'. May be it is a radio device"
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:864
-#, c-format
-msgid "Failed to set input %d on device %s."
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:896
-#, c-format
-msgid ""
-"Failed to get current output on device '%s'. May be it is a radio device"
-msgstr ""
-
-#: sys/v4l2/v4l2_calls.c:921
-#, c-format
-msgid "Failed to set output %d on device %s."
-msgstr ""
-
-#: sys/v4l2/v4l2src_calls.c:81
-#, c-format
-msgid "Could not enqueue buffers in device '%s'."
-msgstr ""
-
-#: sys/v4l2/v4l2src_calls.c:197
-#, c-format
-msgid "Failed trying to get video frames from device '%s'."
-msgstr ""
-
-#: sys/v4l2/v4l2src_calls.c:199
-#, c-format
-msgid "Failed after %d tries. device %s. system error: %s"
-msgstr ""
-
-#: sys/v4l2/v4l2src_calls.c:234
-#, c-format
-msgid "Could not get parameters on device '%s'"
-msgstr ""
-
-#: sys/v4l2/v4l2src_calls.c:261
-msgid "Video input device did not accept new frame rate setting."
-msgstr ""
-
-#: sys/v4l2/v4l2src_calls.c:331
-#, c-format
-msgid "Could not map buffers from device '%s'"
-msgstr ""
-
-#: sys/v4l2/v4l2src_calls.c:339
-#, c-format
-msgid "The driver of device '%s' does not support any known capture method."
-msgstr ""
-
-#: sys/ximage/gstximagesrc.c:796
-msgid "Changing resolution at runtime is not yet supported."
-msgstr ""
-
-#: sys/ximage/gstximagesrc.c:810
-msgid "Cannot operate without a clock"
-msgstr ""
diff --git a/po/hu.po b/po/hu.po
index 9c0b115..10ca581 100644
--- a/po/hu.po
+++ b/po/hu.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.25.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2010-11-04 01:21+0100\n"
 "Last-Translator: Gabor Kelemen <kelemeng@gnome.hu>\n"
 "Language-Team: Hungarian <translation-team-hu@lists.sourceforge.net>\n"
diff --git a/po/id.po b/po/id.po
index 14130d9..194804b 100644
--- a/po/id.po
+++ b/po/id.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.26.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-02-26 18:09+0700\n"
 "Last-Translator: Andhika Padmawan <andhika.padmawan@gmail.com>\n"
 "Language-Team: Indonesian <translation-team-id@lists.sourceforge.net>\n"
diff --git a/po/it.po b/po/it.po
index f4e2f5d..7b5c907 100644
--- a/po/it.po
+++ b/po/it.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.25.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2010-10-25 10:11+0200\n"
 "Last-Translator: Luca Ferretti <elle.uca@infinito.it>\n"
 "Language-Team: Italian <tp@lists.linux.it>\n"
diff --git a/po/ja.po b/po/ja.po
index 58df5a4..1a5899e 100644
--- a/po/ja.po
+++ b/po/ja.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.28.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-12-10 02:18+0000\n"
 "PO-Revision-Date: 2011-08-28 23:59+0900\n"
 "Last-Translator: Takeshi Hamasaki <hmatrjp@users.sourceforge.jp>\n"
 "Language-Team: Japanese <translation-team-ja@lists.sourceforge.net>\n"
diff --git a/po/ky.po b/po/ky.po
new file mode 100644
index 0000000..cd3afe7
--- /dev/null
+++ b/po/ky.po
@@ -0,0 +1,475 @@
+# Translation of 'gst-plugins-good' messages to Kirghiz.
+# Copyright (C) 2002 Free Software Foundation, Inc.
+# Ilyas Bakirov <just_ilyas@yahoo.com>, 2007.
+#
+msgid ""
+msgstr ""
+"Project-Id-Version: gst-plugins-good 0.10.23\n"
+"Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
+"POT-Creation-Date: 2010-05-11 15:35+0100\n"
+"PO-Revision-Date: 2007-11-13 17:16+0600\n"
+"Last-Translator: Ilyas Bakirov <just_ilyas@yahoo.com>\n"
+"Language-Team: Kirghiz <i18n-team-ky-kyrgyz@lists.sourceforge.net>\n"
+"MIME-Version: 1.0\n"
+"Content-Type: text/plain; charset=utf-8\n"
+"Content-Transfer-Encoding: 8bit\n"
+"X-Poedit-Language: Kyrgyz\n"
+"X-Poedit-Country: KYRGYZSTAN\n"
+
+#: sys/oss4/oss4-mixer.c:302
+#, fuzzy
+msgid "Could not open audio device for mixer control handling."
+msgstr "\"%s\"  файлы окууга ачылган жок."
+
+#: sys/oss4/oss4-mixer.c:316
+msgid ""
+"Could not open audio device for mixer control handling. This version of the "
+"Open Sound System is not supported by this element."
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:722
+msgid "Volume"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:723
+msgid "Master"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:724
+msgid "Front"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:725
+msgid "Rear"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:726
+msgid "Headphones"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:727
+msgid "Center"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:728
+msgid "LFE"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:729
+msgid "Surround"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:730
+msgid "Side"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:731
+msgid "Built-in Speaker"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:732
+msgid "AUX 1 Out"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:733
+msgid "AUX 2 Out"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:734
+msgid "AUX Out"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:735
+msgid "Bass"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:736
+msgid "Treble"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:737
+msgid "3D Depth"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:738
+msgid "3D Center"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:739
+msgid "3D Enhance"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:740
+msgid "Telephone"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:741
+msgid "Microphone"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:742
+msgid "Line Out"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:743 sys/oss4/oss4-mixer.c:744
+msgid "Line In"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:745
+msgid "Internal CD"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:746
+msgid "Video In"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:747
+msgid "AUX 1 In"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:748
+msgid "AUX 2 In"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:749
+msgid "AUX In"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:750
+msgid "PCM"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:751 sys/oss4/oss4-mixer.c:752
+msgid "Record Gain"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:753
+msgid "Output Gain"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:754
+msgid "Microphone Boost"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:755
+msgid "Loopback"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:756
+msgid "Diagnostic"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:757
+msgid "Bass Boost"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:758
+msgid "Playback Ports"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:759
+msgid "Input"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:760 sys/oss4/oss4-mixer.c:761
+msgid "Record Source"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:762
+msgid "Monitor Source"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:763
+msgid "Keyboard Beep"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:764
+msgid "Monitor"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:765
+msgid "Simulate Stereo"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:766 sys/oss4/oss4-mixer.c:786
+msgid "Stereo"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:767
+msgid "Surround Sound"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:768
+msgid "Microphone Gain"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:769
+msgid "Speaker Source"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:770
+msgid "Microphone Source"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:771
+msgid "Jack"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:772
+msgid "Center / LFE"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:773
+msgid "Stereo Mix"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:774
+msgid "Mono Mix"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:775
+msgid "Input Mix"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:776
+msgid "SPDIF In"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:777
+msgid "SPDIF Out"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:778
+msgid "Microphone 1"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:779
+msgid "Microphone 2"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:780
+msgid "Digital Out"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:781
+msgid "Digital In"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:782
+msgid "HDMI"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:783
+msgid "Modem"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:784
+msgid "Handset"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:785
+msgid "Other"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:787
+msgid "None"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:788
+msgid "On"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:789
+msgid "Off"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:790
+msgid "Mute"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:791
+msgid "Fast"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:792
+msgid "Very Low"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:793
+msgid "Low"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:794
+msgid "Medium"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:795
+msgid "High"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:796 sys/oss4/oss4-mixer.c:797
+msgid "Very High"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:798
+msgid "Production"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:799
+msgid "Front Panel Microphone"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:800
+msgid "Front Panel Line In"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:801
+msgid "Front Panel Headphones"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:802
+msgid "Front Panel Line Out"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:803
+msgid "Green Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:804
+msgid "Pink Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:805
+msgid "Blue Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:806
+msgid "White Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:807
+msgid "Black Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:808
+msgid "Gray Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:809
+msgid "Orange Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:810
+msgid "Red Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:811
+msgid "Yellow Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:812
+msgid "Green Front Panel Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:813
+msgid "Pink Front Panel Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:814
+msgid "Blue Front Panel Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:815
+msgid "White Front Panel Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:816
+msgid "Black Front Panel Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:817
+msgid "Gray Front Panel Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:818
+msgid "Orange Front Panel Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:819
+msgid "Red Front Panel Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:820
+msgid "Yellow Front Panel Connector"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:821
+msgid "Spread Output"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:822
+msgid "Downmix"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:866
+msgid "Virtual Mixer Input"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:868
+msgid "Virtual Mixer Output"
+msgstr ""
+
+#: sys/oss4/oss4-mixer.c:870
+msgid "Virtual Mixer Channels"
+msgstr ""
+
+#. TRANSLATORS: name + number of a volume mixer control
+#: sys/oss4/oss4-mixer.c:921
+#, c-format
+msgid "%s %d Function"
+msgstr ""
+
+#. TRANSLATORS: name of a volume mixer control
+#: sys/oss4/oss4-mixer.c:928
+#, c-format
+msgid "%s Function"
+msgstr ""
+
+#: sys/oss4/oss4-sink.c:498 sys/oss4/oss4-source.c:367
+msgid ""
+"Could not open audio device for playback. Device is being used by another "
+"application."
+msgstr ""
+
+#: sys/oss4/oss4-sink.c:508 sys/oss4/oss4-source.c:377
+msgid ""
+"Could not open audio device for playback. You don't have permission to open "
+"the device."
+msgstr ""
+
+#: sys/oss4/oss4-sink.c:519 sys/oss4/oss4-source.c:388
+#, fuzzy
+msgid "Could not open audio device for playback."
+msgstr "Алдын \"%s\" жабдыкты ачалган жок."
+
+#: sys/oss4/oss4-sink.c:528 sys/oss4/oss4-source.c:398
+msgid ""
+"Could not open audio device for playback. This version of the Open Sound "
+"System is not supported by this element."
+msgstr ""
+
+#: sys/oss4/oss4-sink.c:644
+msgid "Playback is not supported by this audio device."
+msgstr ""
+
+#: sys/oss4/oss4-sink.c:651
+msgid "Audio playback error."
+msgstr ""
+
+#: sys/oss4/oss4-source.c:520
+msgid "Recording is not supported by this audio device."
+msgstr ""
+
+#: sys/oss4/oss4-source.c:527
+msgid "Error recording from audio device."
+msgstr ""
diff --git a/po/lt.po b/po/lt.po
index aeae1c0..78e5013 100644
--- a/po/lt.po
+++ b/po/lt.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.23.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2010-07-16 19:34+0300\n"
 "Last-Translator: Žygimantas Beručka <uid0@akl.lt>\n"
 "Language-Team: Lithuanian <komp_lt@konferencijos.lt>\n"
diff --git a/po/lv.po b/po/lv.po
index c17e0fb..15affb3 100644
--- a/po/lv.po
+++ b/po/lv.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.28.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-12-10 02:18+0000\n"
 "PO-Revision-Date: 2011-09-02 11:23-0000\n"
 "Last-Translator: Rihards Priedītis <rprieditis@gmail.com>\n"
 "Language-Team: Latvian <translation-team-lv@lists.sourceforge.net>\n"
diff --git a/po/mt.po b/po/mt.po
index bcac65a..96935f1 100644
--- a/po/mt.po
+++ b/po/mt.po
@@ -5,7 +5,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good-0.10.10.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2008-10-26 19:09+0100\n"
 "Last-Translator: Michel Bugeja <michelbugeja@rabatmalta.com>\n"
 "Language-Team: Maltese <translation-team-mt@lists.sourceforge.net>\n"
diff --git a/po/nb.po b/po/nb.po
index ebda484..595d485 100644
--- a/po/nb.po
+++ b/po/nb.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.25.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2010-10-24 21:53+0200\n"
 "Last-Translator: Kjartan Maraas <kmaraas@gnome.org>\n"
 "Language-Team: Norwegian Bokmaal <i18n-nb@lister.ping.uio.no>\n"
diff --git a/po/nl.po b/po/nl.po
index f768f9f..778380e 100644
--- a/po/nl.po
+++ b/po/nl.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.28.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-04-27 00:05+0200\n"
 "Last-Translator: Freek de Kruijf <f.de.kruijf@gmail.com>\n"
 "Language-Team: Dutch <vertaling@vrijschrift.org>\n"
diff --git a/po/or.po b/po/or.po
index f1a1aef..6528dea 100644
--- a/po/or.po
+++ b/po/or.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-0.8.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2004-09-27 13:32+0530\n"
 "Last-Translator: Gora Mohanty <gora_mohanty@yahoo.co.in>\n"
 "Language-Team: Oriya <gora_mohanty@yahoo.co.in>\n"
diff --git a/po/pl.po b/po/pl.po
index c1c6ab8..64a7f36 100644
--- a/po/pl.po
+++ b/po/pl.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.26.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-01-07 21:53+0100\n"
 "Last-Translator: Jakub Bogusz <qboosh@pld-linux.org>\n"
 "Language-Team: Polish <translation-team-pl@lists.sourceforge.net>\n"
diff --git a/po/pt_BR.po b/po/pt_BR.po
index 77a15af..534a4fb 100644
--- a/po/pt_BR.po
+++ b/po/pt_BR.po
@@ -11,7 +11,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.26.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-01-08 01:28-0300\n"
 "Last-Translator: Fabrício Godoy <skarllot@gmail.com>\n"
 "Language-Team: Brazilian Portuguese <ldp-br@bazar.conectiva.com.br>\n"
diff --git a/po/ro.po b/po/ro.po
index 3fff185..dc0db8c 100644
--- a/po/ro.po
+++ b/po/ro.po
@@ -5,7 +5,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.23.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2010-08-16 03:22+0300\n"
 "Last-Translator: Lucian Adrian Grijincu <lucian.grijincu@gmail.com>\n"
 "Language-Team: Romanian <translation-team-ro@lists.sourceforge.net>\n"
diff --git a/po/ru.po b/po/ru.po
index 636b4ed..83f867a 100644
--- a/po/ru.po
+++ b/po/ru.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.28.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-04-26 21:13+0400\n"
 "Last-Translator: Yuri Kozlov <yuray@komyakino.ru>\n"
 "Language-Team: Russian <gnu@mx.ru>\n"
diff --git a/po/sk.po b/po/sk.po
index fc0e190..d04bc76 100644
--- a/po/sk.po
+++ b/po/sk.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.25.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2010-11-08 15:48+0100\n"
 "Last-Translator: Peter Tuhársky <tuharsky@misbb.sk>\n"
 "Language-Team: Slovak <sk-i18n@lists.linux.sk>\n"
diff --git a/po/sl.po b/po/sl.po
index 3de6781..414796f 100644
--- a/po/sl.po
+++ b/po/sl.po
@@ -9,7 +9,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.26.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-03-12 18:35+0100\n"
 "Last-Translator: Klemen Košir <klemen.kosir@gmx.com>\n"
 "Language-Team: Slovenian <translation-team-sl@lists.sourceforge.net>\n"
diff --git a/po/sq.po b/po/sq.po
index 6d593a0..309b072 100644
--- a/po/sq.po
+++ b/po/sq.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins 0.8.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2004-08-07 20:29+0200\n"
 "Last-Translator: Laurent Dhima <laurenti@alblinux.net>\n"
 "Language-Team: Albanian <begraj@hotmail.com>\n"
diff --git a/po/sr.po b/po/sr.po
index c6a7c1f..141138d 100644
--- a/po/sr.po
+++ b/po/sr.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good-0.10.28.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-12-10 02:18+0000\n"
 "PO-Revision-Date: 2011-12-04 16:44+0200\n"
 "Last-Translator: Мирослав Николић <miroslavnikolic@rocketmail.com>\n"
 "Language-Team: Serbian <gnu@prevod.org>\n"
diff --git a/po/sv.po b/po/sv.po
index 23d28da..1eca391 100644
--- a/po/sv.po
+++ b/po/sv.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.26.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-01-09 19:36+0100\n"
 "Last-Translator: Daniel Nylander <po@danielnylander.se>\n"
 "Language-Team: Swedish <tp-sv@listor.tp-sv.se>\n"
diff --git a/po/tr.po b/po/tr.po
index 3df6bc2..747b3e4 100644
--- a/po/tr.po
+++ b/po/tr.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.26.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-01-08 00:03+0200\n"
 "Last-Translator: Server Acim <serveracim@gmail.com>\n"
 "Language-Team: Turkish <gnu-tr-u12a@lists.sourceforge.net>\n"
diff --git a/po/uk.po b/po/uk.po
index b180f15..3bc721d 100644
--- a/po/uk.po
+++ b/po/uk.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.28.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2011-05-01 11:55+0300\n"
 "Last-Translator: Yuri Chornoivan <yurchor@ukr.net>\n"
 "Language-Team: Ukrainian <translation-team-uk@lists.sourceforge.net>\n"
diff --git a/po/vi.po b/po/vi.po
index abc2ab8..1bce35d 100644
--- a/po/vi.po
+++ b/po/vi.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.23.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2010-10-03 18:48+1030\n"
 "Last-Translator: Clytie Siddall <clytie@riverland.net.au>\n"
 "Language-Team: Vietnamese <vi-VN@googlegroups.com>\n"
diff --git a/po/zh_CN.po b/po/zh_CN.po
index 88f1b37..4c053e9 100644
--- a/po/zh_CN.po
+++ b/po/zh_CN.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good 0.10.16.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2009-11-13 22:20+0800\n"
 "Last-Translator: Ji ZhengYu <zhengyuji@gmail.com>\n"
 "Language-Team: Chinese (simplified) <i18n-zh@googlegroups.com>\n"
diff --git a/po/zh_HK.po b/po/zh_HK.po
index dbb2616..78913ad 100644
--- a/po/zh_HK.po
+++ b/po/zh_HK.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good-0.10.2 0.10.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2006-08-29 01:08+0800\n"
 "Last-Translator: Abel Cheung <abelcheung@gmail.com>\n"
 "Language-Team: Chinese (Hong Kong) <community@linuxhall.org>\n"
diff --git a/po/zh_TW.po b/po/zh_TW.po
index 363a9d5..f87df80 100644
--- a/po/zh_TW.po
+++ b/po/zh_TW.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-good-0.10.2 0.10.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-21 00:10+0000\n"
+"POT-Creation-Date: 2011-05-10 09:38+0100\n"
 "PO-Revision-Date: 2006-08-29 01:08+0800\n"
 "Last-Translator: Abel Cheung <abelcheung@gmail.com>\n"
 "Language-Team: Chinese (traditional) <zh-l10n@linux.org.tw>\n"
diff --git a/stamp-h.in b/stamp-h.in
new file mode 100644
index 0000000..9788f70
--- /dev/null
+++ b/stamp-h.in
@@ -0,0 +1 @@
+timestamp
diff --git a/sys/Makefile.am b/sys/Makefile.am
index ab08d04..7ccd9e7 100644
--- a/sys/Makefile.am
+++ b/sys/Makefile.am
@@ -23,6 +23,12 @@ else
 DIRECTSOUND_DIR=
 endif
 
+if USE_WAVEFORM
+WAVEFORM_DIR=waveform
+else
+WAVEFORM_DIR=
+endif
+
 if USE_SUNAUDIO
 SUNAUDIO_DIR=sunaudio
 else
@@ -77,7 +83,7 @@ else
 XIMAGE_DIR=
 endif
 
-SUBDIRS=$(DIRECTSOUND_DIR) $(OSS_DIR) $(OSS4_DIR) $(OSX_AUDIO_DIR) $(OSX_VIDEO_DIR) $(SUNAUDIO_DIR) $(V4L2_DIR) $(XIMAGE_DIR)
+SUBDIRS=$(DIRECTSOUND_DIR) $(WAVEFORM_DIR) $(OSS_DIR) $(OSS4_DIR) $(OSX_AUDIO_DIR) $(OSX_VIDEO_DIR) $(SUNAUDIO_DIR) $(V4L2_DIR) $(XIMAGE_DIR)
 
 DIST_SUBDIRS=directsound oss oss4 osxaudio osxvideo sunaudio v4l2 waveform ximage
 
diff --git a/sys/Makefile.in b/sys/Makefile.in
index c37f1df..07e8088 100644
--- a/sys/Makefile.in
+++ b/sys/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -26,6 +25,23 @@
 # descending into all subdirectories a second time, but only after the first
 # (parallel) run has finished, so it should go right through the second time.
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -44,6 +60,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
 	$(top_srcdir)/common/parallel-subdirs.mak
 subdir = sys
@@ -52,7 +69,6 @@ am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -90,12 +106,18 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
 RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
@@ -105,6 +127,11 @@ RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
@@ -193,6 +220,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -241,8 +269,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -323,7 +353,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -383,6 +413,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -456,7 +487,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -466,6 +501,8 @@ top_srcdir = @top_srcdir@
 @USE_OSS4_TRUE@OSS4_DIR = oss4
 @USE_DIRECTSOUND_FALSE@DIRECTSOUND_DIR = 
 @USE_DIRECTSOUND_TRUE@DIRECTSOUND_DIR = directsound
+@USE_WAVEFORM_FALSE@WAVEFORM_DIR = 
+@USE_WAVEFORM_TRUE@WAVEFORM_DIR = waveform
 @USE_SUNAUDIO_FALSE@SUNAUDIO_DIR = 
 @USE_SUNAUDIO_TRUE@SUNAUDIO_DIR = sunaudio
 @USE_OSX_AUDIO_FALSE@OSX_AUDIO_DIR = 
@@ -500,7 +537,7 @@ top_srcdir = @top_srcdir@
 # GL_DIR=
 # endif
 @USE_X_TRUE@XIMAGE_DIR = ximage
-SUBDIRS = $(DIRECTSOUND_DIR) $(OSS_DIR) $(OSS4_DIR) $(OSX_AUDIO_DIR) $(OSX_VIDEO_DIR) $(SUNAUDIO_DIR) $(V4L2_DIR) $(XIMAGE_DIR)
+SUBDIRS = $(DIRECTSOUND_DIR) $(WAVEFORM_DIR) $(OSS_DIR) $(OSS4_DIR) $(OSX_AUDIO_DIR) $(OSX_VIDEO_DIR) $(SUNAUDIO_DIR) $(V4L2_DIR) $(XIMAGE_DIR)
 DIST_SUBDIRS = directsound oss oss4 osxaudio osxvideo sunaudio v4l2 waveform ximage
 all: all-recursive
 
@@ -544,12 +581,12 @@ clean-libtool:
 	-rm -rf .libs _libs
 
 # This directory's subdirectories are mostly independent; you can cd
-# into them and run `make' without going through this Makefile.
-# To change the values of `make' variables: instead of editing Makefiles,
-# (1) if the variable is set in `config.status', edit `config.status'
-#     (which will cause the Makefiles to be regenerated when you run `make');
-# (2) otherwise, pass the desired values on the `make' command line.
-$(RECURSIVE_TARGETS):
+# into them and run 'make' without going through this Makefile.
+# To change the values of 'make' variables: instead of editing Makefiles,
+# (1) if the variable is set in 'config.status', edit 'config.status'
+#     (which will cause the Makefiles to be regenerated when you run 'make');
+# (2) otherwise, pass the desired values on the 'make' command line.
+$(RECURSIVE_TARGETS) $(RECURSIVE_CLEAN_TARGETS):
 	@fail= failcom='exit 1'; \
 	for f in x $$MAKEFLAGS; do \
 	  case $$f in \
@@ -559,7 +596,11 @@ $(RECURSIVE_TARGETS):
 	done; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
-	list='$(SUBDIRS)'; for subdir in $$list; do \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	for subdir in $$list; do \
 	  echo "Making $$target in $$subdir"; \
 	  if test "$$subdir" = "."; then \
 	    dot_seen=yes; \
@@ -573,37 +614,6 @@ $(RECURSIVE_TARGETS):
 	if test "$$dot_seen" = "no"; then \
 	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
 	fi; test -z "$$fail"
-
-$(RECURSIVE_CLEAN_TARGETS):
-	@fail= failcom='exit 1'; \
-	for f in x $$MAKEFLAGS; do \
-	  case $$f in \
-	    *=* | --[!k]*);; \
-	    *k*) failcom='fail=yes';; \
-	  esac; \
-	done; \
-	dot_seen=no; \
-	case "$@" in \
-	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
-	  *) list='$(SUBDIRS)' ;; \
-	esac; \
-	rev=''; for subdir in $$list; do \
-	  if test "$$subdir" = "."; then :; else \
-	    rev="$$subdir $$rev"; \
-	  fi; \
-	done; \
-	rev="$$rev ."; \
-	target=`echo $@ | sed s/-recursive//`; \
-	for subdir in $$rev; do \
-	  echo "Making $$target in $$subdir"; \
-	  if test "$$subdir" = "."; then \
-	    local_target="$$target-am"; \
-	  else \
-	    local_target="$$target"; \
-	  fi; \
-	  ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
-	  || eval $$failcom; \
-	done && test -z "$$fail"
 tags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
@@ -612,6 +622,10 @@ ctags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
 	done
+cscopelist-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) cscopelist); \
+	done
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -675,6 +689,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist: cscopelist-recursive $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -710,13 +738,10 @@ distdir: $(DISTFILES)
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -837,22 +862,23 @@ ps-am:
 
 uninstall-am:
 
-.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) ctags-recursive \
-	install-am install-strip tags-recursive
+.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) \
+	cscopelist-recursive ctags-recursive install-am install-strip \
+	tags-recursive
 
 .PHONY: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) CTAGS GTAGS \
 	all all-am check check-am clean clean-generic clean-libtool \
-	ctags ctags-recursive distclean distclean-generic \
-	distclean-libtool distclean-tags distdir dvi dvi-am html \
-	html-am info info-am install install-am install-data \
-	install-data-am install-dvi install-dvi-am install-exec \
-	install-exec-am install-html install-html-am install-info \
-	install-info-am install-man install-pdf install-pdf-am \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs installdirs-am maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-generic \
-	mostlyclean-libtool pdf pdf-am ps ps-am tags tags-recursive \
-	uninstall uninstall-am
+	cscopelist cscopelist-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-libtool distclean-tags \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-dvi \
+	install-dvi-am install-exec install-exec-am install-html \
+	install-html-am install-info install-info-am install-man \
+	install-pdf install-pdf-am install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	mostlyclean mostlyclean-generic mostlyclean-libtool pdf pdf-am \
+	ps ps-am tags tags-recursive uninstall uninstall-am
 
 
 .PHONY: independent-subdirs $(SUBDIRS)
diff --git a/sys/directsound/Makefile.in b/sys/directsound/Makefile.in
index 94cbb01..41f3794 100644
--- a/sys/directsound/Makefile.in
+++ b/sys/directsound/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = sys/directsound
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -122,10 +138,23 @@ libgstdirectsoundsink_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstdirectsoundsink_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstdirectsoundsink_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstdirectsoundsink_la_CFLAGS) \
 	$(CFLAGS) $(libgstdirectsoundsink_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -138,22 +167,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstdirectsoundsink_la_SOURCES)
 DIST_SOURCES = $(libgstdirectsoundsink_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -213,6 +243,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -261,8 +292,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -343,7 +376,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -403,6 +436,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -476,7 +510,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -534,7 +572,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -542,6 +579,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -557,12 +596,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstdirectsoundsink.la: $(libgstdirectsoundsink_la_OBJECTS) $(libgstdirectsoundsink_la_DEPENDENCIES) $(EXTRA_libgstdirectsoundsink_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstdirectsoundsink_la_LINK) -rpath $(plugindir) $(libgstdirectsoundsink_la_OBJECTS) $(libgstdirectsoundsink_la_LIBADD) $(LIBS)
 
@@ -665,6 +706,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -809,18 +864,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/sys/directsound/gstdirectsoundsink.c b/sys/directsound/gstdirectsoundsink.c
index 2f9a04c..7385cff 100644
--- a/sys/directsound/gstdirectsoundsink.c
+++ b/sys/directsound/gstdirectsoundsink.c
@@ -53,6 +53,7 @@
 #endif
 
 #include "gstdirectsoundsink.h"
+#include <gst/audio/gstaudioiec61937.h>
 
 #include <math.h>
 
@@ -74,6 +75,8 @@ static void gst_directsound_sink_get_property (GObject * object, guint prop_id,
     GValue * value, GParamSpec * pspec);
 
 static GstCaps *gst_directsound_sink_getcaps (GstBaseSink * bsink);
+static GstBuffer *gst_directsound_sink_payload (GstBaseAudioSink * sink,
+    GstBuffer * buf);
 static gboolean gst_directsound_sink_prepare (GstAudioSink * asink,
     GstRingBufferSpec * spec);
 static gboolean gst_directsound_sink_unprepare (GstAudioSink * asink);
@@ -86,6 +89,9 @@ static guint gst_directsound_sink_delay (GstAudioSink * asink);
 static void gst_directsound_sink_reset (GstAudioSink * asink);
 static GstCaps *gst_directsound_probe_supported_formats (GstDirectSoundSink *
     dsoundsink, const GstCaps * template_caps);
+static gboolean gst_directsound_sink_acceptcaps (GstPad * pad, GstCaps * caps);
+static boolean gst_directsound_sink_is_spdif_format (GstDirectSoundSink *
+    dsoundsink);
 
 /* interfaces */
 static void gst_directsound_sink_interfaces_init (GType type);
@@ -108,7 +114,8 @@ static GstStaticPadTemplate directsoundsink_sink_factory =
         "width = (int) 8, "
         "depth = (int) 8, "
         "rate = (int) [ 1, MAX ], " "channels = (int) [ 1, 2 ];"
-        "audio/x-iec958"));
+        "audio/x-ac3, framed = (boolean) true;"
+        "audio/x-dts, framed = (boolean) true;"));
 
 enum
 {
@@ -291,6 +298,9 @@ gst_directsound_sink_class_init (GstDirectSoundSinkClass * klass)
   gstbasesink_class->get_caps =
       GST_DEBUG_FUNCPTR (gst_directsound_sink_getcaps);
 
+  gstbaseaudiosink_class->payload =
+      GST_DEBUG_FUNCPTR (gst_directsound_sink_payload);
+
   gstaudiosink_class->prepare =
       GST_DEBUG_FUNCPTR (gst_directsound_sink_prepare);
   gstaudiosink_class->unprepare =
@@ -331,6 +341,9 @@ gst_directsound_sink_init (GstDirectSoundSink * dsoundsink,
   dsoundsink->volume = 100;
   dsoundsink->dsound_lock = g_mutex_new ();
   dsoundsink->first_buffer_after_reset = FALSE;
+
+  gst_pad_set_acceptcaps_function (GST_BASE_SINK (dsoundsink)->sinkpad,
+      GST_DEBUG_FUNCPTR (gst_directsound_sink_acceptcaps));
 }
 
 static void
@@ -407,6 +420,59 @@ gst_directsound_sink_getcaps (GstBaseSink * bsink)
 }
 
 static gboolean
+gst_directsound_sink_acceptcaps (GstPad * pad, GstCaps * caps)
+{
+  GstDirectSoundSink *dsink =
+      GST_DIRECTSOUND_SINK (gst_pad_get_parent_element (pad));
+  GstCaps *pad_caps;
+  GstStructure *st;
+  gboolean ret = FALSE;
+
+  GstRingBufferSpec spec = { 0 };
+
+  pad_caps = gst_pad_get_caps_reffed (pad);
+  if (pad_caps) {
+    gboolean cret = gst_caps_can_intersect (pad_caps, caps);
+    gst_caps_unref (pad_caps);
+    if (!cret)
+      goto done;
+  }
+
+  /* If we've not got fixed caps, creating a stream might fail, so let's just
+   * return from here with default acceptcaps behaviour */
+  if (!gst_caps_is_fixed (caps))
+    goto done;
+
+  /* parse helper expects this set, so avoid nasty warning
+   * will be set properly later on anyway  */
+  spec.latency_time = GST_SECOND;
+  if (!gst_ring_buffer_parse_caps (&spec, caps))
+    goto done;
+
+  /* Make sure input is framed (one frame per buffer) and can be payloaded */
+  switch (spec.type) {
+    case GST_BUFTYPE_AC3:
+    case GST_BUFTYPE_DTS:
+    {
+      gboolean framed = FALSE, parsed = FALSE;
+      st = gst_caps_get_structure (caps, 0);
+
+      gst_structure_get_boolean (st, "framed", &framed);
+      gst_structure_get_boolean (st, "parsed", &parsed);
+      if ((!framed && !parsed) || gst_audio_iec61937_frame_size (&spec) <= 0)
+        goto done;
+    }
+    default:
+      break;
+  }
+  ret = TRUE;
+
+done:
+  gst_object_unref (dsink);
+  return ret;
+}
+
+static gboolean
 gst_directsound_sink_open (GstAudioSink * asink)
 {
   GstDirectSoundSink *dsoundsink = GST_DIRECTSOUND_SINK (asink);
@@ -431,6 +497,15 @@ gst_directsound_sink_open (GstAudioSink * asink)
   return TRUE;
 }
 
+static boolean
+gst_directsound_sink_is_spdif_format (GstDirectSoundSink * dsoundsink)
+{
+  GstBufferFormatType type;
+
+  type = GST_BASE_AUDIO_SINK (dsoundsink)->ringbuffer->spec.type;
+  return type == GST_BUFTYPE_AC3 || type == GST_BUFTYPE_DTS;
+}
+
 static gboolean
 gst_directsound_sink_prepare (GstAudioSink * asink, GstRingBufferSpec * spec)
 {
@@ -445,7 +520,7 @@ gst_directsound_sink_prepare (GstAudioSink * asink, GstRingBufferSpec * spec)
 
   /* fill the WAVEFORMATEX structure with spec params */
   memset (&wfx, 0, sizeof (wfx));
-  if (spec->format != GST_IEC958) {
+  if (!gst_directsound_sink_is_spdif_format (dsoundsink)) {
     wfx.cbSize = sizeof (wfx);
     wfx.wFormatTag = WAVE_FORMAT_PCM;
     wfx.nChannels = spec->channels;
@@ -472,7 +547,7 @@ gst_directsound_sink_prepare (GstAudioSink * asink, GstRingBufferSpec * spec)
     wfx.cbSize = 0;
     wfx.wFormatTag = WAVE_FORMAT_DOLBY_AC3_SPDIF;
     wfx.nChannels = 2;
-    wfx.nSamplesPerSec = spec->rate;
+    wfx.nSamplesPerSec = 48000;
     wfx.wBitsPerSample = 16;
     wfx.nBlockAlign = wfx.wBitsPerSample / 8 * wfx.nChannels;
     wfx.nAvgBytesPerSec = wfx.nSamplesPerSec * wfx.nBlockAlign;
@@ -498,7 +573,7 @@ gst_directsound_sink_prepare (GstAudioSink * asink, GstRingBufferSpec * spec)
   memset (&descSecondary, 0, sizeof (DSBUFFERDESC));
   descSecondary.dwSize = sizeof (DSBUFFERDESC);
   descSecondary.dwFlags = DSBCAPS_GETCURRENTPOSITION2 | DSBCAPS_GLOBALFOCUS;
-  if (spec->format != GST_IEC958)
+  if (!gst_directsound_sink_is_spdif_format (dsoundsink))
     descSecondary.dwFlags |= DSBCAPS_CTRLVOLUME;
 
   descSecondary.dwBufferBytes = dsoundsink->buffer_size;
@@ -563,10 +638,6 @@ gst_directsound_sink_write (GstAudioSink * asink, gpointer data, guint length)
 
   dsoundsink = GST_DIRECTSOUND_SINK (asink);
 
-  /* Fix endianness */
-  if (dsoundsink->buffer_format == GST_IEC958)
-    _swab (data, data, length);
-
   GST_DSOUND_LOCK (dsoundsink);
 
   /* get current buffer status */
@@ -735,6 +806,8 @@ gst_directsound_probe_supported_formats (GstDirectSoundSink * dsoundsink,
   DSBUFFERDESC descSecondary;
   WAVEFORMATEX wfx;
   GstCaps *caps;
+  GstCaps *tmp, *tmp2;
+  LPDIRECTSOUNDBUFFER tmpBuffer;
 
   caps = gst_caps_copy (template_caps);
 
@@ -761,16 +834,24 @@ gst_directsound_probe_supported_formats (GstDirectSoundSink * dsoundsink,
   descSecondary.lpwfxFormat = &wfx;
 
   hRes = IDirectSound_CreateSoundBuffer (dsoundsink->pDS, &descSecondary,
-      &dsoundsink->pDSBSecondary, NULL);
+      &tmpBuffer, NULL);
   if (FAILED (hRes)) {
     GST_INFO_OBJECT (dsoundsink, "AC3 passthrough not supported "
         "(IDirectSound_CreateSoundBuffer returned: %s)\n",
         DXGetErrorString9 (hRes));
-    caps =
-        gst_caps_subtract (caps, gst_caps_new_simple ("audio/x-iec958", NULL));
+    tmp = gst_caps_new_simple ("audio/x-ac3", NULL);
+    tmp2 = gst_caps_subtract (caps, tmp);
+    gst_caps_unref (tmp);
+    gst_caps_unref (caps);
+    caps = tmp2;
+    tmp = gst_caps_new_simple ("audio/x-dts", NULL);
+    tmp2 = gst_caps_subtract (caps, tmp);
+    gst_caps_unref (tmp);
+    gst_caps_unref (caps);
+    caps = tmp2;
   } else {
     GST_INFO_OBJECT (dsoundsink, "AC3 passthrough supported");
-    hRes = IDirectSoundBuffer_Release (dsoundsink->pDSBSecondary);
+    hRes = IDirectSoundBuffer_Release (tmpBuffer);
     if (FAILED (hRes)) {
       GST_DEBUG_OBJECT (dsoundsink,
           "(IDirectSoundBuffer_Release returned: %s)\n",
@@ -778,8 +859,46 @@ gst_directsound_probe_supported_formats (GstDirectSoundSink * dsoundsink,
     }
   }
 #else
-  caps = gst_caps_subtract (caps, gst_caps_new_simple ("audio/x-iec958", NULL));
+  tmp = gst_caps_new_simple ("audio/x-ac3", NULL);
+  tmp2 = gst_caps_subtract (caps, tmp);
+  gst_caps_unref (tmp);
+  gst_caps_unref (caps);
+  caps = tmp2;
+  tmp = gst_caps_new_simple ("audio/x-dts", NULL);
+  tmp2 = gst_caps_subtract (caps, tmp);
+  gst_caps_unref (tmp);
+  gst_caps_unref (caps);
+  caps = tmp2;
 #endif
 
   return caps;
 }
+
+static GstBuffer *
+gst_directsound_sink_payload (GstBaseAudioSink * sink, GstBuffer * buf)
+{
+  if (gst_directsound_sink_is_spdif_format ((GstDirectSoundSink *) sink)) {
+    gint framesize = gst_audio_iec61937_frame_size (&sink->ringbuffer->spec);
+    GstBuffer *out;
+
+    if (framesize <= 0)
+      return NULL;
+
+    out = gst_buffer_new_and_alloc (framesize);
+
+    if (!gst_audio_iec61937_payload (GST_BUFFER_DATA (buf),
+            GST_BUFFER_SIZE (buf), GST_BUFFER_DATA (out),
+            GST_BUFFER_SIZE (out), &sink->ringbuffer->spec)) {
+      gst_buffer_unref (out);
+      return NULL;
+    }
+
+    gst_buffer_copy_metadata (out, buf, GST_BUFFER_COPY_ALL);
+    /* Fix endianness */
+    _swab ((gchar *) GST_BUFFER_DATA (buf), (gchar *) GST_BUFFER_DATA (buf),
+        GST_BUFFER_SIZE (buf));
+    return out;
+  } else {
+    return gst_buffer_ref (buf);
+  }
+}
diff --git a/sys/oss/Makefile.in b/sys/oss/Makefile.in
index ce15b09..e2b74ba 100644
--- a/sys/oss/Makefile.in
+++ b/sys/oss/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = sys/oss
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -123,10 +139,23 @@ libgstossaudio_la_OBJECTS = $(am_libgstossaudio_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstossaudio_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstossaudio_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstossaudio_la_CFLAGS) $(CFLAGS) \
 	$(libgstossaudio_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -139,22 +168,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstossaudio_la_SOURCES)
 DIST_SOURCES = $(libgstossaudio_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -214,6 +244,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -262,8 +293,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -344,7 +377,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -404,6 +437,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -477,7 +511,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -545,7 +583,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -553,6 +590,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -568,12 +607,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstossaudio.la: $(libgstossaudio_la_OBJECTS) $(libgstossaudio_la_DEPENDENCIES) $(EXTRA_libgstossaudio_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstossaudio_la_LINK) -rpath $(plugindir) $(libgstossaudio_la_OBJECTS) $(libgstossaudio_la_LIBADD) $(LIBS)
 
@@ -716,6 +757,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -860,18 +915,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/sys/oss/gstossdmabuffer.c b/sys/oss/gstossdmabuffer.c
new file mode 100644
index 0000000..5e2d46e
--- /dev/null
+++ b/sys/oss/gstossdmabuffer.c
@@ -0,0 +1,333 @@
+/* GStreamer
+ * Copyright (C) 1999,2000 Erik Walthinsen <omega@cse.ogi.edu>
+ *                    2005 Wim Taymans <wim@fluendo.com>
+ *
+ * gstossdmabuffer.c: 
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <unistd.h>
+#include <fcntl.h>
+#include <string.h>
+#include <sys/types.h>
+#include <sys/mman.h>
+
+#ifdef HAVE_OSS_INCLUDE_IN_SYS
+# include <sys/soundcard.h>
+#else
+# ifdef HAVE_OSS_INCLUDE_IN_ROOT
+#  include <soundcard.h>
+# else
+#  ifdef HAVE_OSS_INCLUDE_IN_MACHINE
+#   include <machine/soundcard.h>
+#  else
+#   error "What to include?"
+#  endif /* HAVE_OSS_INCLUDE_IN_MACHINE */
+# endif /* HAVE_OSS_INCLUDE_IN_ROOT */
+#endif /* HAVE_OSS_INCLUDE_IN_SYS */
+
+#include <sys/time.h>
+#include <sys/ioctl.h>
+#include <pthread.h>
+
+#include "gstossdmabuffer.h"
+
+GST_DEBUG_CATEGORY_EXTERN (oss_debug);
+#define GST_CAT_DEFAULT oss_debug
+
+static void gst_ossdmabuffer_class_init (GstOssDMABufferClass * klass);
+static void gst_ossdmabuffer_init (GstOssDMABuffer * ossdmabuffer);
+static void gst_ossdmabuffer_dispose (GObject * object);
+static void gst_ossdmabuffer_finalize (GObject * object);
+
+static gboolean gst_ossdmabuffer_acquire (GstRingBuffer * buf,
+    GstRingBufferSpec * spec);
+static gboolean gst_ossdmabuffer_release (GstRingBuffer * buf);
+static gboolean gst_ossdmabuffer_play (GstRingBuffer * buf);
+static gboolean gst_ossdmabuffer_stop (GstRingBuffer * buf);
+
+static GstRingBufferClass *parent_class = NULL;
+
+GType
+gst_ossdmabuffer_get_type (void)
+{
+  static GType ossdmabuffer_type = 0;
+
+  if (!ossdmabuffer_type) {
+    static const GTypeInfo ossdmabuffer_info = {
+      sizeof (GstOssDMABufferClass),
+      NULL,
+      NULL,
+      (GClassInitFunc) gst_ossdmabuffer_class_init,
+      NULL,
+      NULL,
+      sizeof (GstOssDMABuffer),
+      0,
+      (GInstanceInitFunc) gst_ossdmabuffer_init,
+      NULL
+    };
+
+    ossdmabuffer_type =
+        g_type_register_static (GST_TYPE_RINGBUFFER, "GstOssDMABuffer",
+        &ossdmabuffer_info, 0);
+  }
+  return ossdmabuffer_type;
+}
+
+static void
+gst_ossdmabuffer_class_init (GstOssDMABufferClass * klass)
+{
+  GObjectClass *gobject_class;
+  GstObjectClass *gstobject_class;
+  GstRingBufferClass *gstringbuffer_class;
+
+  gobject_class = (GObjectClass *) klass;
+  gstobject_class = (GstObjectClass *) klass;
+  gstringbuffer_class = (GstRingBufferClass *) klass;
+
+  parent_class = g_type_class_peek_parent (klass);
+
+  gobject_class->dispose = gst_ossdmabuffer_dispose;
+  gobject_class->finalize = gst_ossdmabuffer_finalize;
+
+  gstringbuffer_class->acquire = gst_ossdmabuffer_acquire;
+  gstringbuffer_class->release = gst_ossdmabuffer_release;
+  gstringbuffer_class->play = gst_ossdmabuffer_play;
+  gstringbuffer_class->stop = gst_ossdmabuffer_stop;
+}
+
+static void
+gst_ossdmabuffer_init (GstOssDMABuffer * ossdmabuffer)
+{
+  ossdmabuffer->cond = g_cond_new ();
+  ossdmabuffer->element = g_object_new (GST_TYPE_OSSELEMENT, NULL);
+}
+
+static void
+gst_ossdmabuffer_dispose (GObject * object)
+{
+  G_OBJECT_CLASS (parent_class)->dispose (object);
+}
+
+static void
+gst_ossdmabuffer_finalize (GObject * object)
+{
+  GstOssDMABuffer *obuf = (GstOssDMABuffer *) object;
+
+  g_cond_free (obuf->cond);
+
+  G_OBJECT_CLASS (parent_class)->finalize (object);
+}
+
+static void
+gst_ossdmabuffer_func (GstRingBuffer * buf)
+{
+  fd_set writeset;
+  struct count_info count;
+  GstOssDMABuffer *obuf = (GstOssDMABuffer *) buf;
+
+  GST_OBJECT_LOCK (buf);
+  while (obuf->running) {
+    if (buf->state == GST_RINGBUFFER_STATE_PLAYING) {
+      int segsize;
+
+      GST_OBJECT_UNLOCK (buf);
+
+      segsize = buf->spec.segsize;
+
+      FD_ZERO (&writeset);
+      FD_SET (obuf->fd, &writeset);
+
+      select (obuf->fd + 1, NULL, &writeset, NULL, NULL);
+
+      if (ioctl (obuf->fd, SNDCTL_DSP_GETOPTR, &count) == -1) {
+        perror ("GETOPTR");
+        continue;
+      }
+
+      if (count.blocks > buf->spec.segtotal)
+        count.blocks = buf->spec.segtotal;
+
+      gst_ringbuffer_callback (buf, count.blocks);
+
+      GST_OBJECT_LOCK (buf);
+    } else {
+      GST_OSSDMABUFFER_SIGNAL (obuf);
+      GST_OSSDMABUFFER_WAIT (obuf);
+    }
+  }
+  GST_OBJECT_UNLOCK (buf);
+}
+
+static gboolean
+gst_ossdmabuffer_acquire (GstRingBuffer * buf, GstRingBufferSpec * spec)
+{
+  int tmp;
+  struct audio_buf_info info;
+  GstOssDMABuffer *obuf = (GstOssDMABuffer *) buf;;
+  caddr_t mmap_buf;
+  int mode;
+  gint size;
+  gboolean parsed;
+
+  parsed = gst_osselement_parse_caps (obuf->element, spec->caps);
+  if (!parsed)
+    return FALSE;
+
+  mode = O_RDWR;
+  mode |= O_NONBLOCK;
+
+  obuf->fd = open ("/dev/dsp", mode, 0);
+  if (obuf->fd == -1) {
+    perror ("OPEN");
+    return FALSE;
+  }
+  //obuf->frag = 0x00040008;
+  obuf->frag = 0xffff000a;
+
+  tmp = obuf->element->format;
+  if (ioctl (obuf->fd, SNDCTL_DSP_SETFMT, &tmp) == -1) {
+    perror ("SETFMT");
+    return FALSE;
+  }
+
+  tmp = obuf->element->channels;
+  if (ioctl (obuf->fd, SNDCTL_DSP_STEREO, &tmp) == -1) {
+    perror ("STEREO");
+    return FALSE;
+  }
+
+  tmp = obuf->element->channels;
+  if (ioctl (obuf->fd, SNDCTL_DSP_CHANNELS, &tmp) == -1) {
+    perror ("CHANNELS");
+    return FALSE;
+  }
+
+  tmp = obuf->element->rate;
+  if (ioctl (obuf->fd, SNDCTL_DSP_SPEED, &tmp) == -1) {
+    perror ("SPEED");
+    return FALSE;
+  }
+
+  if (ioctl (obuf->fd, SNDCTL_DSP_GETCAPS, &obuf->caps) == -1) {
+    perror ("/dev/dsp");
+    fprintf (stderr, "Sorry but your sound driver is too old\n");
+    return FALSE;
+  }
+
+  if (!(obuf->caps & DSP_CAP_TRIGGER) || !(obuf->caps & DSP_CAP_MMAP)) {
+    fprintf (stderr, "Sorry but your soundcard can't do this\n");
+    return FALSE;
+  }
+
+  if (ioctl (obuf->fd, SNDCTL_DSP_SETFRAGMENT, &obuf->frag) == -1) {
+    perror ("SETFRAGMENT");
+    return FALSE;
+  }
+
+  if (ioctl (obuf->fd, SNDCTL_DSP_GETOSPACE, &info) == -1) {
+    perror ("GETOSPACE");
+    return FALSE;
+  }
+
+  buf->spec.segsize = info.fragsize;
+  buf->spec.segtotal = info.fragstotal;
+  size = info.fragsize * info.fragstotal;
+  g_print ("segsize %d, segtotal %d\n", info.fragsize, info.fragstotal);
+
+  mmap_buf = (caddr_t) mmap (NULL, size, PROT_WRITE,
+      MAP_FILE | MAP_SHARED, obuf->fd, 0);
+
+  if ((caddr_t) mmap_buf == (caddr_t) - 1) {
+    perror ("mmap (write)");
+    return FALSE;
+  }
+
+  buf->data = gst_buffer_new ();
+  GST_BUFFER_DATA (buf->data) = mmap_buf;
+  GST_BUFFER_SIZE (buf->data) = size;
+  GST_BUFFER_FLAG_SET (buf->data, GST_BUFFER_DONTFREE);
+
+  tmp = 0;
+  if (ioctl (obuf->fd, SNDCTL_DSP_SETTRIGGER, &tmp) == -1) {
+    perror ("SETTRIGGER");
+    return FALSE;
+  }
+
+  GST_OBJECT_LOCK (obuf);
+  obuf->running = TRUE;
+  obuf->thread = g_thread_create ((GThreadFunc) gst_ossdmabuffer_func,
+      buf, TRUE, NULL);
+  GST_OSSDMABUFFER_WAIT (obuf);
+  GST_OBJECT_UNLOCK (obuf);
+
+  return TRUE;
+}
+
+static gboolean
+gst_ossdmabuffer_release (GstRingBuffer * buf)
+{
+  GstOssDMABuffer *obuf = (GstOssDMABuffer *) buf;;
+
+  gst_buffer_unref (buf->data);
+
+  GST_OBJECT_LOCK (obuf);
+  obuf->running = FALSE;
+  GST_OSSDMABUFFER_SIGNAL (obuf);
+  GST_OBJECT_UNLOCK (obuf);
+
+  g_thread_join (obuf->thread);
+
+  return TRUE;
+}
+
+static gboolean
+gst_ossdmabuffer_play (GstRingBuffer * buf)
+{
+  int tmp;
+  GstOssDMABuffer *obuf;
+
+  obuf = (GstOssDMABuffer *) buf;
+
+  tmp = PCM_ENABLE_OUTPUT;
+  if (ioctl (obuf->fd, SNDCTL_DSP_SETTRIGGER, &tmp) == -1) {
+    perror ("SETTRIGGER");
+  }
+  GST_OSSDMABUFFER_SIGNAL (obuf);
+
+  return TRUE;
+}
+
+static gboolean
+gst_ossdmabuffer_stop (GstRingBuffer * buf)
+{
+  int tmp;
+  GstOssDMABuffer *obuf;
+
+  obuf = (GstOssDMABuffer *) buf;
+
+  tmp = 0;
+  if (ioctl (obuf->fd, SNDCTL_DSP_SETTRIGGER, &tmp) == -1) {
+    perror ("SETTRIGGER");
+  }
+  GST_OSSDMABUFFER_WAIT (obuf);
+  buf->playseg = 0;
+
+  return TRUE;
+}
diff --git a/sys/oss/oss_probe.c b/sys/oss/oss_probe.c
new file mode 100644
index 0000000..af624fa
--- /dev/null
+++ b/sys/oss/oss_probe.c
@@ -0,0 +1,256 @@
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+
+#include <unistd.h>
+#include <fcntl.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <sys/ioctl.h>
+#include <glib.h>
+
+#ifdef HAVE_OSS_INCLUDE_IN_SYS
+# include <sys/soundcard.h>
+#else
+# ifdef HAVE_OSS_INCLUDE_IN_ROOT
+#  include <soundcard.h>
+# else
+#  ifdef HAVE_OSS_INCLUDE_IN_MACHINE
+#   include <machine/soundcard.h>
+#  else
+#   error "What to include?"
+#  endif /* HAVE_OSS_INCLUDE_IN_MACHINE */
+# endif /* HAVE_OSS_INCLUDE_IN_ROOT */
+#endif /* HAVE_OSS_INCLUDE_IN_SYS */
+
+typedef struct _Probe Probe;
+struct _Probe
+{
+  int fd;
+  int format;
+  int n_channels;
+  GArray *rates;
+  int min;
+  int max;
+};
+
+typedef struct _Range Range;
+struct _Range
+{
+  int min;
+  int max;
+};
+
+static gboolean probe_check (Probe * probe);
+static int check_rate (Probe * probe, int irate);
+static void add_range (GQueue * queue, int min, int max);
+static void add_rate (GArray * array, int rate);
+static int int_compare (gconstpointer a, gconstpointer b);
+
+int
+main (int argc, char *argv[])
+{
+  int fd;
+  int i;
+  Probe *probe;
+
+  fd = open ("/dev/dsp", O_RDWR);
+  if (fd < 0) {
+    perror ("/dev/dsp");
+    exit (1);
+  }
+
+  probe = g_new0 (Probe, 1);
+  probe->fd = fd;
+  probe->format = AFMT_S16_LE;
+  probe->n_channels = 2;
+
+  probe_check (probe);
+  g_array_sort (probe->rates, int_compare);
+  for (i = 0; i < probe->rates->len; i++) {
+    g_print ("%d\n", g_array_index (probe->rates, int, i));
+  }
+
+  g_array_free (probe->rates, TRUE);
+  g_free (probe);
+
+#if 0
+  probe = g_new0 (Probe, 1);
+  probe->fd = fd;
+  probe->format = AFMT_S16_LE;
+  probe->n_channels = 1;
+
+  probe_check (probe);
+  for (i = 0; i < probe->rates->len; i++) {
+    g_print ("%d\n", g_array_index (probe->rates, int, i));
+  }
+
+  probe = g_new0 (Probe, 1);
+  probe->fd = fd;
+  probe->format = AFMT_U8;
+  probe->n_channels = 2;
+
+  probe_check (probe);
+  for (i = 0; i < probe->rates->len; i++) {
+    g_print ("%d\n", g_array_index (probe->rates, int, i));
+  }
+
+  probe = g_new0 (Probe, 1);
+  probe->fd = fd;
+  probe->format = AFMT_U8;
+  probe->n_channels = 1;
+
+  probe_check (probe);
+  for (i = 0; i < probe->rates->len; i++) {
+    g_print ("%d\n", g_array_index (probe->rates, int, i));
+  }
+#endif
+
+  return 0;
+}
+
+static gboolean
+probe_check (Probe * probe)
+{
+  Range *range;
+  GQueue *ranges;
+  int exact_rates = 0;
+  gboolean checking_exact_rates = TRUE;
+  int n_checks = 0;
+  gboolean result = TRUE;
+
+  ranges = g_queue_new ();
+
+  probe->rates = g_array_new (FALSE, FALSE, sizeof (int));
+
+  probe->min = check_rate (probe, 1000);
+  n_checks++;
+  probe->max = check_rate (probe, 100000);
+  n_checks++;
+  add_range (ranges, probe->min + 1, probe->max - 1);
+
+  while ((range = g_queue_pop_head (ranges))) {
+    int min1;
+    int max1;
+    int mid;
+    int mid_ret;
+
+    g_print ("checking [%d,%d]\n", range->min, range->max);
+
+    mid = (range->min + range->max) / 2;
+    mid_ret = check_rate (probe, mid);
+    n_checks++;
+
+    if (mid == mid_ret && checking_exact_rates) {
+      int max_exact_matches = 100;
+
+      exact_rates++;
+      if (exact_rates > max_exact_matches) {
+        g_print ("got %d exact rates, assuming all are exact\n",
+            max_exact_matches);
+        result = FALSE;
+        g_free (range);
+        break;
+      }
+    } else {
+      checking_exact_rates = FALSE;
+    }
+
+    /* Assume that the rate is arithmetically rounded to the nearest
+     * supported rate. */
+    if (mid == mid_ret) {
+      min1 = mid - 1;
+      max1 = mid + 1;
+    } else {
+      if (mid < mid_ret) {
+        min1 = mid - (mid_ret - mid);
+        max1 = mid_ret + 1;
+      } else {
+        min1 = mid_ret - 1;
+        max1 = mid + (mid - mid_ret);
+      }
+    }
+
+    add_range (ranges, range->min, min1);
+    add_range (ranges, max1, range->max);
+
+    g_free (range);
+  }
+
+  while ((range = g_queue_pop_head (ranges))) {
+    g_free (range);
+  }
+  g_queue_free (ranges);
+
+  return result;
+}
+
+static void
+add_range (GQueue * queue, int min, int max)
+{
+  g_print ("trying to add [%d,%d]\n", min, max);
+  if (min <= max) {
+    Range *range = g_new0 (Range, 1);
+
+    range->min = min;
+    range->max = max;
+
+    g_queue_push_tail (queue, range);
+    //g_queue_push_head (queue, range);
+  }
+}
+
+static int
+check_rate (Probe * probe, int irate)
+{
+  int rate;
+  int format;
+  int n_channels;
+
+  rate = irate;
+  format = probe->format;
+  n_channels = probe->n_channels;
+
+  ioctl (probe->fd, SNDCTL_DSP_SETFMT, &format);
+  ioctl (probe->fd, SNDCTL_DSP_CHANNELS, &n_channels);
+  ioctl (probe->fd, SNDCTL_DSP_SPEED, &rate);
+
+  g_print ("rate %d -> %d\n", irate, rate);
+
+  if (rate == irate - 1 || rate == irate + 1) {
+    rate = irate;
+  }
+  add_rate (probe->rates, rate);
+  return rate;
+}
+
+static void
+add_rate (GArray * array, int rate)
+{
+  int i;
+  int val;
+
+  for (i = 0; i < array->len; i++) {
+    val = g_array_index (array, int, i);
+
+    if (val == rate)
+      return;
+  }
+  g_print ("supported rate: %d\n", rate);
+  g_array_append_val (array, rate);
+}
+
+static int
+int_compare (gconstpointer a, gconstpointer b)
+{
+  const int *va = (const int *) a;
+  const int *vb = (const int *) b;
+
+  if (*va < *vb)
+    return -1;
+  if (*va > *vb)
+    return 1;
+  return 0;
+}
diff --git a/sys/oss4/Makefile.in b/sys/oss4/Makefile.in
index 3cda65b..cd3b517 100644
--- a/sys/oss4/Makefile.in
+++ b/sys/oss4/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = sys/oss4
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -125,10 +141,23 @@ libgstoss4audio_la_OBJECTS = $(am_libgstoss4audio_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstoss4audio_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstoss4audio_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstoss4audio_la_CFLAGS) $(CFLAGS) \
 	$(libgstoss4audio_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -141,22 +170,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstoss4audio_la_SOURCES)
 DIST_SOURCES = $(libgstoss4audio_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -216,6 +246,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -264,8 +295,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -346,7 +379,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -406,6 +439,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -479,7 +513,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -550,7 +588,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -558,6 +595,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -573,12 +612,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstoss4audio.la: $(libgstoss4audio_la_OBJECTS) $(libgstoss4audio_la_DEPENDENCIES) $(EXTRA_libgstoss4audio_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstoss4audio_la_LINK) -rpath $(plugindir) $(libgstoss4audio_la_OBJECTS) $(libgstoss4audio_la_LIBADD) $(LIBS)
 
@@ -729,6 +770,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -873,18 +928,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/sys/oss4/oss4-audio.c b/sys/oss4/oss4-audio.c
index 09f8495..6317400 100644
--- a/sys/oss4/oss4-audio.c
+++ b/sys/oss4/oss4-audio.c
@@ -17,6 +17,10 @@
  * Boston, MA 02111-1307, USA.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
diff --git a/sys/oss4/oss4-property-probe.c b/sys/oss4/oss4-property-probe.c
index a99410e..5674da5 100644
--- a/sys/oss4/oss4-property-probe.c
+++ b/sys/oss4/oss4-property-probe.c
@@ -17,6 +17,10 @@
  * Boston, MA 02111-1307, USA.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #include <config.h>
 #endif
diff --git a/sys/osxaudio/Makefile.am b/sys/osxaudio/Makefile.am
index cfd0c4d..917c9bf 100644
--- a/sys/osxaudio/Makefile.am
+++ b/sys/osxaudio/Makefile.am
@@ -4,6 +4,8 @@ libgstosxaudio_la_SOURCES = gstosxringbuffer.c   \
                             gstosxaudioelement.c \
                             gstosxaudiosink.c    \
                             gstosxaudiosrc.c     \
+                            gstosxcoreaudiocommon.c     \
+                            gstosxcoreaudio.c     \
                             gstosxaudio.c
 
 libgstosxaudio_la_CFLAGS = $(GST_PLUGINS_BASE_CFLAGS) $(GST_CFLAGS) \
@@ -14,13 +16,23 @@ libgstosxaudio_la_LIBADD = 			  \
     $(GST_PLUGINS_BASE_LIBS)          \
     $(GST_BASE_LIBS)                  \
     $(GST_LIBS)
-libgstosxaudio_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS) -Wl,-framework -Wl,CoreAudio -Wl,-framework -Wl,AudioUnit -Wl,-framework -Wl,CoreServices
-libgstosxaudio_la_LIBTOOLFLAGS = --tag=disable-static
+
+libgstosxaudio_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS) -Wl,-framework,CoreAudio  -Wl,-framework,AudioToolbox
+
+if !HAVE_IOS
+libgstosxaudio_la_LDFLAGS += -Wl,-framework,AudioUnit -Wl,-framework,CoreServices
+endif
+
+libgstosxaudio_la_LIBTOOLFLAGS = --tag=disable-static --tag=CC
 
 noinst_HEADERS = gstosxaudiosink.h	  \
                  gstosxaudioelement.h \
                  gstosxringbuffer.h	  \
-                 gstosxaudiosrc.h
+                 gstosxaudiosrc.h     \
+                 gstosxcoreaudiocommon.h     \
+                 gstosxcoreaudio.h \
+                 gstosxcoreaudiohal.c \
+                 gstosxcoreaudioremoteio.c
 
 
 
diff --git a/sys/osxaudio/Makefile.in b/sys/osxaudio/Makefile.in
index 9e8e186..61fe4b6 100644
--- a/sys/osxaudio/Makefile.in
+++ b/sys/osxaudio/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,16 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
+@HAVE_IOS_FALSE@am__append_1 = -Wl,-framework,AudioUnit -Wl,-framework,CoreServices
 subdir = sys/osxaudio
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -117,15 +134,30 @@ am_libgstosxaudio_la_OBJECTS = libgstosxaudio_la-gstosxringbuffer.lo \
 	libgstosxaudio_la-gstosxaudioelement.lo \
 	libgstosxaudio_la-gstosxaudiosink.lo \
 	libgstosxaudio_la-gstosxaudiosrc.lo \
+	libgstosxaudio_la-gstosxcoreaudiocommon.lo \
+	libgstosxaudio_la-gstosxcoreaudio.lo \
 	libgstosxaudio_la-gstosxaudio.lo
 libgstosxaudio_la_OBJECTS = $(am_libgstosxaudio_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstosxaudio_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstosxaudio_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstosxaudio_la_CFLAGS) $(CFLAGS) \
 	$(libgstosxaudio_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -138,22 +170,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstosxaudio_la_SOURCES)
 DIST_SOURCES = $(libgstosxaudio_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -213,6 +246,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -261,8 +295,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -343,7 +379,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -403,6 +439,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -476,7 +513,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -485,6 +526,8 @@ libgstosxaudio_la_SOURCES = gstosxringbuffer.c   \
                             gstosxaudioelement.c \
                             gstosxaudiosink.c    \
                             gstosxaudiosrc.c     \
+                            gstosxcoreaudiocommon.c     \
+                            gstosxcoreaudio.c     \
                             gstosxaudio.c
 
 libgstosxaudio_la_CFLAGS = $(GST_PLUGINS_BASE_CFLAGS) $(GST_CFLAGS) \
@@ -497,12 +540,18 @@ libgstosxaudio_la_LIBADD = \
     $(GST_BASE_LIBS)                  \
     $(GST_LIBS)
 
-libgstosxaudio_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS) -Wl,-framework -Wl,CoreAudio -Wl,-framework -Wl,AudioUnit -Wl,-framework -Wl,CoreServices
-libgstosxaudio_la_LIBTOOLFLAGS = --tag=disable-static
+libgstosxaudio_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS) \
+	-Wl,-framework,CoreAudio -Wl,-framework,AudioToolbox \
+	$(am__append_1)
+libgstosxaudio_la_LIBTOOLFLAGS = --tag=disable-static --tag=CC
 noinst_HEADERS = gstosxaudiosink.h	  \
                  gstosxaudioelement.h \
                  gstosxringbuffer.h	  \
-                 gstosxaudiosrc.h
+                 gstosxaudiosrc.h     \
+                 gstosxcoreaudiocommon.h     \
+                 gstosxcoreaudio.h \
+                 gstosxcoreaudiohal.c \
+                 gstosxcoreaudioremoteio.c
 
 all: all-am
 
@@ -540,7 +589,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -548,6 +596,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -563,12 +613,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstosxaudio.la: $(libgstosxaudio_la_OBJECTS) $(libgstosxaudio_la_DEPENDENCIES) $(EXTRA_libgstosxaudio_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstosxaudio_la_LINK) -rpath $(plugindir) $(libgstosxaudio_la_OBJECTS) $(libgstosxaudio_la_LIBADD) $(LIBS)
 
@@ -582,6 +634,8 @@ distclean-compile:
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstosxaudio_la-gstosxaudioelement.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstosxaudio_la-gstosxaudiosink.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstosxaudio_la-gstosxaudiosrc.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstosxaudio_la-gstosxcoreaudio.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstosxaudio_la-gstosxcoreaudiocommon.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstosxaudio_la-gstosxringbuffer.Plo@am__quote@
 
 .c.o:
@@ -633,6 +687,20 @@ libgstosxaudio_la-gstosxaudiosrc.lo: gstosxaudiosrc.c
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstosxaudio_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstosxaudio_la_CFLAGS) $(CFLAGS) -c -o libgstosxaudio_la-gstosxaudiosrc.lo `test -f 'gstosxaudiosrc.c' || echo '$(srcdir)/'`gstosxaudiosrc.c
 
+libgstosxaudio_la-gstosxcoreaudiocommon.lo: gstosxcoreaudiocommon.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstosxaudio_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstosxaudio_la_CFLAGS) $(CFLAGS) -MT libgstosxaudio_la-gstosxcoreaudiocommon.lo -MD -MP -MF $(DEPDIR)/libgstosxaudio_la-gstosxcoreaudiocommon.Tpo -c -o libgstosxaudio_la-gstosxcoreaudiocommon.lo `test -f 'gstosxcoreaudiocommon.c' || echo '$(srcdir)/'`gstosxcoreaudiocommon.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libgstosxaudio_la-gstosxcoreaudiocommon.Tpo $(DEPDIR)/libgstosxaudio_la-gstosxcoreaudiocommon.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='gstosxcoreaudiocommon.c' object='libgstosxaudio_la-gstosxcoreaudiocommon.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstosxaudio_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstosxaudio_la_CFLAGS) $(CFLAGS) -c -o libgstosxaudio_la-gstosxcoreaudiocommon.lo `test -f 'gstosxcoreaudiocommon.c' || echo '$(srcdir)/'`gstosxcoreaudiocommon.c
+
+libgstosxaudio_la-gstosxcoreaudio.lo: gstosxcoreaudio.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstosxaudio_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstosxaudio_la_CFLAGS) $(CFLAGS) -MT libgstosxaudio_la-gstosxcoreaudio.lo -MD -MP -MF $(DEPDIR)/libgstosxaudio_la-gstosxcoreaudio.Tpo -c -o libgstosxaudio_la-gstosxcoreaudio.lo `test -f 'gstosxcoreaudio.c' || echo '$(srcdir)/'`gstosxcoreaudio.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libgstosxaudio_la-gstosxcoreaudio.Tpo $(DEPDIR)/libgstosxaudio_la-gstosxcoreaudio.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='gstosxcoreaudio.c' object='libgstosxaudio_la-gstosxcoreaudio.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstosxaudio_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstosxaudio_la_CFLAGS) $(CFLAGS) -c -o libgstosxaudio_la-gstosxcoreaudio.lo `test -f 'gstosxcoreaudio.c' || echo '$(srcdir)/'`gstosxcoreaudio.c
+
 libgstosxaudio_la-gstosxaudio.lo: gstosxaudio.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstosxaudio_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstosxaudio_la_CFLAGS) $(CFLAGS) -MT libgstosxaudio_la-gstosxaudio.lo -MD -MP -MF $(DEPDIR)/libgstosxaudio_la-gstosxaudio.Tpo -c -o libgstosxaudio_la-gstosxaudio.lo `test -f 'gstosxaudio.c' || echo '$(srcdir)/'`gstosxaudio.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libgstosxaudio_la-gstosxaudio.Tpo $(DEPDIR)/libgstosxaudio_la-gstosxaudio.Plo
@@ -695,6 +763,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -839,18 +921,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/sys/osxaudio/gstosxaudioelement.c b/sys/osxaudio/gstosxaudioelement.c
index a41f4b8..16e8d6a 100644
--- a/sys/osxaudio/gstosxaudioelement.c
+++ b/sys/osxaudio/gstosxaudioelement.c
@@ -46,7 +46,6 @@
  *
  */
 
-#include <gst/gst.h>
 #include "gstosxaudioelement.h"
 
 static void
diff --git a/sys/osxaudio/gstosxaudioelement.h b/sys/osxaudio/gstosxaudioelement.h
index b5d90c0..198dc1e 100644
--- a/sys/osxaudio/gstosxaudioelement.h
+++ b/sys/osxaudio/gstosxaudioelement.h
@@ -49,8 +49,16 @@
 #ifndef __GST_OSX_AUDIO_ELEMENT_H__
 #define __GST_OSX_AUDIO_ELEMENT_H__
 
+#ifdef HAVE_CONFIG_H
+#  include <config.h>
+#endif
+
 #include <gst/gst.h>
+#ifdef HAVE_IOS
+#include <CoreAudio/CoreAudioTypes.h>
+#else
 #include <CoreAudio/CoreAudio.h>
+#endif
 #include <AudioUnit/AudioUnit.h>
 
 G_BEGIN_DECLS
diff --git a/sys/osxaudio/gstosxaudiosink.c b/sys/osxaudio/gstosxaudiosink.c
index cd456e5..3716320 100644
--- a/sys/osxaudio/gstosxaudiosink.c
+++ b/sys/osxaudio/gstosxaudiosink.c
@@ -2,6 +2,7 @@
  * GStreamer
  * Copyright (C) 2005,2006 Zaheer Abbas Merali <zaheerabbas at merali dot org>
  * Copyright (C) 2007,2008 Pioneers of the Inevitable <songbird@songbirdnest.com>
+ * Copyright (C) 2012 Fluendo S.A. <support@fluendo.com>
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
@@ -66,14 +67,17 @@
 #endif
 
 #include <gst/gst.h>
-#include <CoreAudio/CoreAudio.h>
-#include <CoreAudio/AudioHardware.h>
+#include <gst/audio/multichannel.h>
+#include <gst/audio/gstaudioiec61937.h>
+
 #include "gstosxaudiosink.h"
 #include "gstosxaudioelement.h"
 
 GST_DEBUG_CATEGORY_STATIC (osx_audiosink_debug);
 #define GST_CAT_DEFAULT osx_audiosink_debug
 
+#include "gstosxcoreaudio.h"
+
 /* Filter signals and args */
 enum
 {
@@ -98,7 +102,37 @@ static GstStaticPadTemplate sink_factory = GST_STATIC_PAD_TEMPLATE ("sink",
         "signed = (boolean) { TRUE }, "
         "width = (int) 32, "
         "depth = (int) 32, "
-        "rate = (int) [1, MAX], " "channels = (int) [1, MAX]")
+        "rate = (int) [1, MAX], "
+        "channels = (int) [1, 9];"
+        "audio/x-raw-int, "
+        "endianness = (int) {" G_STRINGIFY (G_BYTE_ORDER) " }, "
+        "signed = (boolean) { TRUE }, "
+        "width = (int) 32, "
+        "depth = (int) 32, "
+        "rate = (int) [1, MAX], "
+        "channels = (int) [1, 9];"
+        "audio/x-raw-int, "
+        "endianness = (int) {" G_STRINGIFY (G_BYTE_ORDER) " }, "
+        "signed = (boolean) { TRUE }, "
+        "width = (int) 24, "
+        "depth = (int) 24, "
+        "rate = (int) [1, MAX], "
+        "channels = (int) [1, 9];"
+        "audio/x-raw-int, "
+        "endianness = (int) {" G_STRINGIFY (G_BYTE_ORDER) " }, "
+        "signed = (boolean) { TRUE }, "
+        "width = (int) 16, "
+        "depth = (int) 16, "
+        "rate = (int) [1, MAX], "
+        "channels = (int) [1, 9];"
+        "audio/x-raw-int, "
+        "endianness = (int) {" G_STRINGIFY (G_BYTE_ORDER) " }, "
+        "signed = (boolean) { TRUE }, "
+        "width = (int) 8, "
+        "depth = (int) 8, "
+        "rate = (int) [1, MAX], " "channels = (int) [1, MAX];"
+        "audio/x-ac3, framed = (boolean) true;"
+        "audio/x-dts, framed = (boolean) true")
     );
 
 static void gst_osx_audio_sink_set_property (GObject * object, guint prop_id,
@@ -106,11 +140,17 @@ static void gst_osx_audio_sink_set_property (GObject * object, guint prop_id,
 static void gst_osx_audio_sink_get_property (GObject * object, guint prop_id,
     GValue * value, GParamSpec * pspec);
 
+static gboolean gst_osx_audio_sink_stop (GstBaseSink * base);
+static GstCaps *gst_osx_audio_sink_getcaps (GstBaseSink * base);
+static gboolean gst_osx_audio_sink_acceptcaps (GstPad * pad, GstCaps * caps);
+
+static GstBuffer *gst_osx_audio_sink_sink_payload (GstBaseAudioSink * sink,
+    GstBuffer * buf);
 static GstRingBuffer *gst_osx_audio_sink_create_ringbuffer (GstBaseAudioSink *
     sink);
 static void gst_osx_audio_sink_osxelement_init (gpointer g_iface,
     gpointer iface_data);
-static void gst_osx_audio_sink_select_device (GstOsxAudioSink * osxsink);
+static gboolean gst_osx_audio_sink_select_device (GstOsxAudioSink * osxsink);
 static void gst_osx_audio_sink_set_volume (GstOsxAudioSink * sink);
 
 static OSStatus gst_osx_audio_sink_io_proc (GstOsxRingBuffer * buf,
@@ -129,6 +169,7 @@ gst_osx_audio_sink_do_init (GType type)
 
   GST_DEBUG_CATEGORY_INIT (osx_audiosink_debug, "osxaudiosink", 0,
       "OSX Audio Sink");
+  gst_core_audio_init_debug ();
   GST_DEBUG ("Adding static interface");
   g_type_add_interface_static (type, GST_OSX_AUDIO_ELEMENT_TYPE,
       &osxelement_info);
@@ -168,16 +209,23 @@ gst_osx_audio_sink_class_init (GstOsxAudioSinkClass * klass)
   gobject_class->set_property = gst_osx_audio_sink_set_property;
   gobject_class->get_property = gst_osx_audio_sink_get_property;
 
+#ifndef HAVE_IOS
   g_object_class_install_property (gobject_class, ARG_DEVICE,
       g_param_spec_int ("device", "Device ID", "Device ID of output device",
           0, G_MAXINT, 0, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+#endif
 
   g_object_class_install_property (gobject_class, ARG_VOLUME,
       g_param_spec_double ("volume", "Volume", "Volume of this stream",
           0, 1.0, 1.0, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
+  gstbasesink_class->get_caps = GST_DEBUG_FUNCPTR (gst_osx_audio_sink_getcaps);
+  gstbasesink_class->stop = GST_DEBUG_FUNCPTR (gst_osx_audio_sink_stop);
+
   gstbaseaudiosink_class->create_ringbuffer =
       GST_DEBUG_FUNCPTR (gst_osx_audio_sink_create_ringbuffer);
+  gstbaseaudiosink_class->payload =
+      GST_DEBUG_FUNCPTR (gst_osx_audio_sink_sink_payload);
 }
 
 static void
@@ -186,7 +234,12 @@ gst_osx_audio_sink_init (GstOsxAudioSink * sink, GstOsxAudioSinkClass * gclass)
   GST_DEBUG ("Initialising object");
 
   sink->device_id = kAudioDeviceUnknown;
+  sink->cached_caps = NULL;
+
   sink->volume = DEFAULT_VOLUME;
+
+  gst_pad_set_acceptcaps_function (GST_BASE_SINK (sink)->sinkpad,
+      GST_DEBUG_FUNCPTR (gst_osx_audio_sink_acceptcaps));
 }
 
 static void
@@ -196,9 +249,11 @@ gst_osx_audio_sink_set_property (GObject * object, guint prop_id,
   GstOsxAudioSink *sink = GST_OSX_AUDIO_SINK (object);
 
   switch (prop_id) {
+#ifndef HAVE_IOS
     case ARG_DEVICE:
       sink->device_id = g_value_get_int (value);
       break;
+#endif
     case ARG_VOLUME:
       sink->volume = g_value_get_double (value);
       gst_osx_audio_sink_set_volume (sink);
@@ -215,9 +270,11 @@ gst_osx_audio_sink_get_property (GObject * object, guint prop_id,
 {
   GstOsxAudioSink *sink = GST_OSX_AUDIO_SINK (object);
   switch (prop_id) {
+#ifndef HAVE_IOS
     case ARG_DEVICE:
       g_value_set_int (value, sink->device_id);
       break;
+#endif
     case ARG_VOLUME:
       g_value_set_double (value, sink->volume);
       break;
@@ -227,6 +284,141 @@ gst_osx_audio_sink_get_property (GObject * object, guint prop_id,
   }
 }
 
+static gboolean
+gst_osx_audio_sink_stop (GstBaseSink * base)
+{
+  GstOsxAudioSink *sink = GST_OSX_AUDIO_SINK (base);
+
+  if (sink->cached_caps) {
+    gst_caps_unref (sink->cached_caps);
+    sink->cached_caps = NULL;
+  }
+
+  return GST_CALL_PARENT_WITH_DEFAULT (GST_BASE_SINK_CLASS, stop, (base), TRUE);
+}
+
+static GstCaps *
+gst_osx_audio_sink_getcaps (GstBaseSink * base)
+{
+  GstOsxAudioSink *sink = GST_OSX_AUDIO_SINK (base);
+  gchar *caps_string = NULL;
+
+  if (sink->cached_caps) {
+    caps_string = gst_caps_to_string (sink->cached_caps);
+    GST_DEBUG_OBJECT (sink, "using cached caps: %s", caps_string);
+    g_free (caps_string);
+    return gst_caps_ref (sink->cached_caps);
+  }
+
+  GST_DEBUG_OBJECT (sink, "using template caps");
+  return NULL;
+}
+
+static gboolean
+gst_osx_audio_sink_acceptcaps (GstPad * pad, GstCaps * caps)
+{
+  GstOsxAudioSink *sink = GST_OSX_AUDIO_SINK (gst_pad_get_parent_element (pad));
+  GstOsxRingBuffer *osxbuf;
+  GstCaps *pad_caps;
+  GstStructure *st;
+  gboolean ret = FALSE;
+  GstRingBufferSpec spec = { 0 };
+  gchar *caps_string = NULL;
+
+  osxbuf = GST_OSX_RING_BUFFER (GST_BASE_AUDIO_SINK (sink)->ringbuffer);
+
+  caps_string = gst_caps_to_string (caps);
+  GST_DEBUG_OBJECT (sink, "acceptcaps called with %s", caps_string);
+  g_free (caps_string);
+
+  pad_caps = gst_pad_get_caps_reffed (pad);
+  if (pad_caps) {
+    gboolean cret = gst_caps_can_intersect (pad_caps, caps);
+    gst_caps_unref (pad_caps);
+    if (!cret)
+      goto done;
+  }
+
+  /* If we've not got fixed caps, creating a stream might fail,
+   * so let's just return from here with default acceptcaps
+   * behaviour */
+  if (!gst_caps_is_fixed (caps))
+    goto done;
+
+  /* parse helper expects this set, so avoid nasty warning
+   * will be set properly later on anyway  */
+  spec.latency_time = GST_SECOND;
+  if (!gst_ring_buffer_parse_caps (&spec, caps))
+    goto done;
+
+  /* Make sure input is framed and can be payloaded */
+  switch (spec.type) {
+    case GST_BUFTYPE_AC3:
+    {
+      gboolean framed = FALSE;
+
+      st = gst_caps_get_structure (caps, 0);
+
+      gst_structure_get_boolean (st, "framed", &framed);
+      if (!framed || gst_audio_iec61937_frame_size (&spec) <= 0)
+        goto done;
+      break;
+    }
+    case GST_BUFTYPE_DTS:
+    {
+      gboolean parsed = FALSE;
+
+      st = gst_caps_get_structure (caps, 0);
+
+      gst_structure_get_boolean (st, "parsed", &parsed);
+      if (!parsed || gst_audio_iec61937_frame_size (&spec) <= 0)
+        goto done;
+      break;
+    }
+    default:
+      break;
+  }
+  ret = TRUE;
+
+done:
+  gst_object_unref (sink);
+  return ret;
+}
+
+static GstBuffer *
+gst_osx_audio_sink_sink_payload (GstBaseAudioSink * sink, GstBuffer * buf)
+{
+  GstOsxAudioSink *osxsink;
+
+  osxsink = GST_OSX_AUDIO_SINK (sink);
+
+  if (RINGBUFFER_IS_SPDIF (sink->ringbuffer->spec.type)) {
+    gint framesize = gst_audio_iec61937_frame_size (&sink->ringbuffer->spec);
+    GstBuffer *out;
+
+    if (framesize <= 0)
+      return NULL;
+
+    out = gst_buffer_new_and_alloc (framesize);
+
+    if (!gst_audio_iec61937_payload (GST_BUFFER_DATA (buf),
+            GST_BUFFER_SIZE (buf), GST_BUFFER_DATA (out),
+            GST_BUFFER_SIZE (out), &sink->ringbuffer->spec)) {
+      gst_buffer_unref (out);
+      return NULL;
+    }
+
+    gst_buffer_copy_metadata (out, buf, GST_BUFFER_COPY_ALL);
+
+    /* Fix endianness */
+    swab ((gchar *) GST_BUFFER_DATA (buf),
+        (gchar *) GST_BUFFER_DATA (buf), GST_BUFFER_SIZE (buf));
+    return out;
+  } else {
+    return gst_buffer_ref (buf);
+  }
+}
+
 static GstRingBuffer *
 gst_osx_audio_sink_create_ringbuffer (GstBaseAudioSink * sink)
 {
@@ -235,26 +427,31 @@ gst_osx_audio_sink_create_ringbuffer (GstBaseAudioSink * sink)
 
   osxsink = GST_OSX_AUDIO_SINK (sink);
 
-  gst_osx_audio_sink_select_device (osxsink);
+  if (!gst_osx_audio_sink_select_device (osxsink)) {
+    GST_ERROR_OBJECT (sink, "Could not select device");
+    return NULL;
+  }
 
-  GST_DEBUG ("Creating ringbuffer");
+  GST_DEBUG_OBJECT (sink, "Creating ringbuffer");
   ringbuffer = g_object_new (GST_TYPE_OSX_RING_BUFFER, NULL);
-  GST_DEBUG ("osx sink 0x%p element 0x%p  ioproc 0x%p", osxsink,
+  GST_DEBUG_OBJECT (sink, "osx sink %p element %p  ioproc %p", osxsink,
       GST_OSX_AUDIO_ELEMENT_GET_INTERFACE (osxsink),
       (void *) gst_osx_audio_sink_io_proc);
 
   gst_osx_audio_sink_set_volume (osxsink);
 
-  ringbuffer->element = GST_OSX_AUDIO_ELEMENT_GET_INTERFACE (osxsink);
-  ringbuffer->device_id = osxsink->device_id;
+  ringbuffer->core_audio->element =
+      GST_OSX_AUDIO_ELEMENT_GET_INTERFACE (osxsink);
+  ringbuffer->core_audio->device_id = osxsink->device_id;
+  ringbuffer->core_audio->is_src = FALSE;
 
   return GST_RING_BUFFER (ringbuffer);
 }
 
-/* HALOutput AudioUnit will request fairly arbitrarily-sized chunks of data,
- * not of a fixed size. So, we keep track of where in the current ringbuffer
- * segment we are, and only advance the segment once we've read the whole
- * thing */
+/* HALOutput AudioUnit will request fairly arbitrarily-sized chunks
+ * of data, not of a fixed size. So, we keep track of where in
+ * the current ringbuffer segment we are, and only advance the segment
+ * once we've read the whole thing */
 static OSStatus
 gst_osx_audio_sink_io_proc (GstOsxRingBuffer * buf,
     AudioUnitRenderActionFlags * ioActionFlags,
@@ -264,7 +461,8 @@ gst_osx_audio_sink_io_proc (GstOsxRingBuffer * buf,
   guint8 *readptr;
   gint readseg;
   gint len;
-  gint remaining = bufferList->mBuffers[0].mDataByteSize;
+  gint stream_idx = buf->core_audio->stream_idx;
+  gint remaining = bufferList->mBuffers[stream_idx].mDataByteSize;
   gint offset = 0;
 
   while (remaining) {
@@ -277,7 +475,7 @@ gst_osx_audio_sink_io_proc (GstOsxRingBuffer * buf,
     if (len > remaining)
       len = remaining;
 
-    memcpy ((char *) bufferList->mBuffers[0].mData + offset,
+    memcpy ((char *) bufferList->mBuffers[stream_idx].mData + offset,
         readptr + buf->segoffset, len);
 
     buf->segoffset += len;
@@ -308,41 +506,145 @@ gst_osx_audio_sink_osxelement_init (gpointer g_iface, gpointer iface_data)
 static void
 gst_osx_audio_sink_set_volume (GstOsxAudioSink * sink)
 {
-  if (!sink->audiounit)
+  GstOsxRingBuffer *osxbuf;
+
+  osxbuf = GST_OSX_RING_BUFFER (GST_BASE_AUDIO_SINK (sink)->ringbuffer);
+  if (!osxbuf)
     return;
 
-  AudioUnitSetParameter (sink->audiounit, kHALOutputParam_Volume,
-      kAudioUnitScope_Global, 0, (float) sink->volume, 0);
+  gst_core_audio_set_volume (osxbuf->core_audio, sink->volume);
 }
 
-static void
-gst_osx_audio_sink_select_device (GstOsxAudioSink * osxsink)
+static gboolean
+gst_osx_audio_sink_allowed_caps (GstOsxAudioSink * osxsink)
 {
-  OSStatus status;
-  UInt32 propertySize;
-
-  if (osxsink->device_id == kAudioDeviceUnknown) {
-    /* If no specific device has been selected by the user, then pick the
-     * default device */
-    GST_DEBUG_OBJECT (osxsink, "Selecting device for OSXAudioSink");
-    propertySize = sizeof (osxsink->device_id);
-    status =
-        AudioHardwareGetProperty (kAudioHardwarePropertyDefaultOutputDevice,
-        &propertySize, &osxsink->device_id);
-
-    if (status) {
-      GST_WARNING_OBJECT (osxsink,
-          "AudioHardwareGetProperty returned %d", (int) status);
-    } else {
-      GST_DEBUG_OBJECT (osxsink, "AudioHardwareGetProperty returned 0");
+  gint i, max_channels = 0;
+  gboolean spdif_allowed, use_positions = FALSE;
+  AudioChannelLayout *layout;
+  GstElementClass *element_class;
+  GstPadTemplate *pad_template;
+  GstCaps *caps, *in_caps;
+
+  GstAudioChannelPosition pos[9] = {
+    GST_AUDIO_CHANNEL_POSITION_INVALID,
+    GST_AUDIO_CHANNEL_POSITION_INVALID,
+    GST_AUDIO_CHANNEL_POSITION_INVALID,
+    GST_AUDIO_CHANNEL_POSITION_INVALID,
+    GST_AUDIO_CHANNEL_POSITION_INVALID,
+    GST_AUDIO_CHANNEL_POSITION_INVALID,
+    GST_AUDIO_CHANNEL_POSITION_INVALID,
+    GST_AUDIO_CHANNEL_POSITION_INVALID,
+    GST_AUDIO_CHANNEL_POSITION_INVALID
+  };
+
+  /* First collect info about the HW capabilites and preferences */
+  spdif_allowed =
+      gst_core_audio_audio_device_is_spdif_avail (osxsink->device_id);
+  layout = gst_core_audio_audio_device_get_channel_layout (osxsink->device_id);
+
+  GST_DEBUG_OBJECT (osxsink, "Selected device ID: %u SPDIF allowed: %d",
+      (unsigned) osxsink->device_id, spdif_allowed);
+
+  if (layout) {
+    max_channels = layout->mNumberChannelDescriptions;
+  } else {
+    GST_WARNING_OBJECT (osxsink, "This driver does not support "
+        "kAudioDevicePropertyPreferredChannelLayout.");
+    max_channels = 2;
+  }
+
+  if (max_channels > 2) {
+    max_channels = MIN (max_channels, 9);
+    use_positions = TRUE;
+    for (i = 0; i < max_channels; i++) {
+      switch (layout->mChannelDescriptions[i].mChannelLabel) {
+        case kAudioChannelLabel_Left:
+          pos[i] = GST_AUDIO_CHANNEL_POSITION_FRONT_LEFT;
+          break;
+        case kAudioChannelLabel_Right:
+          pos[i] = GST_AUDIO_CHANNEL_POSITION_FRONT_RIGHT;
+          break;
+        case kAudioChannelLabel_Center:
+          pos[i] = GST_AUDIO_CHANNEL_POSITION_FRONT_CENTER;
+          break;
+        case kAudioChannelLabel_LFEScreen:
+          pos[i] = GST_AUDIO_CHANNEL_POSITION_LFE;
+          break;
+        case kAudioChannelLabel_LeftSurround:
+          pos[i] = GST_AUDIO_CHANNEL_POSITION_REAR_LEFT;
+          break;
+        case kAudioChannelLabel_RightSurround:
+          pos[i] = GST_AUDIO_CHANNEL_POSITION_REAR_RIGHT;
+          break;
+        case kAudioChannelLabel_RearSurroundLeft:
+          pos[i] = GST_AUDIO_CHANNEL_POSITION_SIDE_LEFT;
+          break;
+        case kAudioChannelLabel_RearSurroundRight:
+          pos[i] = GST_AUDIO_CHANNEL_POSITION_SIDE_RIGHT;
+          break;
+        case kAudioChannelLabel_CenterSurround:
+          pos[i] = GST_AUDIO_CHANNEL_POSITION_REAR_CENTER;
+          break;
+        default:
+          GST_WARNING_OBJECT (osxsink, "unrecognized channel: %d",
+              (int) layout->mChannelDescriptions[i].mChannelLabel);
+          use_positions = FALSE;
+          max_channels = 2;
+          break;
+      }
     }
+  }
+  g_free (layout);
+
+  /* Recover the template caps */
+  element_class = GST_ELEMENT_GET_CLASS (osxsink);
+  pad_template = gst_element_class_get_pad_template (element_class, "sink");
+  in_caps = gst_pad_template_get_caps (pad_template);
+
+  /* Create the allowed subset  */
+  caps = gst_caps_new_empty ();
+  for (i = 0; i < gst_caps_get_size (in_caps); i++) {
+    GstStructure *in_s, *out_s;
+
+    in_s = gst_caps_get_structure (in_caps, i);
 
-    if (osxsink->device_id == kAudioDeviceUnknown) {
-      GST_WARNING_OBJECT (osxsink,
-          "AudioHardwareGetProperty: device_id is kAudioDeviceUnknown");
+    if (gst_structure_has_name (in_s, "audio/x-ac3") ||
+        gst_structure_has_name (in_s, "audio/x-dts")) {
+      if (spdif_allowed) {
+        gst_caps_append_structure (caps, gst_structure_copy (in_s));
+      }
+    } else {
+      if (max_channels > 2 && use_positions) {
+        out_s = gst_structure_copy (in_s);
+        gst_structure_remove_field (out_s, "channels");
+        gst_structure_set (out_s, "channels", G_TYPE_INT, max_channels, NULL);
+        gst_audio_set_channel_positions (out_s, pos);
+        gst_caps_append_structure (caps, out_s);
+      }
+      out_s = gst_structure_copy (in_s);
+      gst_structure_remove_field (out_s, "channels");
+      gst_structure_set (out_s, "channels", GST_TYPE_INT_RANGE, 1, 2, NULL);
+      gst_caps_append_structure (caps, out_s);
     }
+  }
 
-    GST_DEBUG_OBJECT (osxsink, "AudioHardwareGetProperty: device_id is %lu",
-        (long) osxsink->device_id);
+  if (osxsink->cached_caps) {
+    gst_caps_unref (osxsink->cached_caps);
   }
+
+  osxsink->cached_caps = caps;
+
+  return TRUE;
+}
+
+static gboolean
+gst_osx_audio_sink_select_device (GstOsxAudioSink * osxsink)
+{
+  gboolean res = FALSE;
+
+  if (!gst_core_audio_select_device (&osxsink->device_id))
+    return FALSE;
+  res = gst_osx_audio_sink_allowed_caps (osxsink);
+
+  return res;
 }
diff --git a/sys/osxaudio/gstosxaudiosink.h b/sys/osxaudio/gstosxaudiosink.h
index aac9719..e3aaec3 100644
--- a/sys/osxaudio/gstosxaudiosink.h
+++ b/sys/osxaudio/gstosxaudiosink.h
@@ -2,6 +2,7 @@
  * GStreamer
  * Copyright (C) 2005-2006 Zaheer Abbas Merali <zaheerabbas at merali dot org>
  * Copyright (C) 2007 Pioneers of the Inevitable <songbird@songbirdnest.com>
+ * Copyright (C) 2012 Fluendo S.A. <support@fluendo.com>
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
@@ -70,11 +71,13 @@ struct _GstOsxAudioSink
   GstBaseAudioSink sink;
 
   AudioDeviceID device_id;
+
   AudioUnit audiounit;
   double volume;
+  GstCaps *cached_caps;
 };
 
-struct _GstOsxAudioSinkClass 
+struct _GstOsxAudioSinkClass
 {
   GstBaseAudioSinkClass parent_class;
 };
@@ -84,3 +87,4 @@ GType gst_osx_audio_sink_get_type (void);
 G_END_DECLS
 
 #endif /* __GST_OSXAUDIOSINK_H__ */
+
diff --git a/sys/osxaudio/gstosxaudiosrc.c b/sys/osxaudio/gstosxaudiosrc.c
index 7e9ad24..31e3080 100644
--- a/sys/osxaudio/gstosxaudiosrc.c
+++ b/sys/osxaudio/gstosxaudiosrc.c
@@ -60,8 +60,6 @@
 #endif
 
 #include <gst/gst.h>
-#include <CoreAudio/CoreAudio.h>
-#include <CoreAudio/AudioHardware.h>
 #include "gstosxaudiosrc.h"
 #include "gstosxaudioelement.h"
 
@@ -265,9 +263,10 @@ gst_osx_audio_src_create_ringbuffer (GstBaseAudioSrc * src)
       GST_OSX_AUDIO_ELEMENT_GET_INTERFACE (osxsrc),
       (void *) gst_osx_audio_src_io_proc);
 
-  ringbuffer->element = GST_OSX_AUDIO_ELEMENT_GET_INTERFACE (osxsrc);
-  ringbuffer->is_src = TRUE;
-  ringbuffer->device_id = osxsrc->device_id;
+  ringbuffer->core_audio->element =
+      GST_OSX_AUDIO_ELEMENT_GET_INTERFACE (osxsrc);
+  ringbuffer->core_audio->is_src = TRUE;
+  ringbuffer->core_audio->device_id = osxsrc->device_id;
 
   return GST_RING_BUFFER (ringbuffer);
 }
@@ -285,15 +284,15 @@ gst_osx_audio_src_io_proc (GstOsxRingBuffer * buf,
   gint remaining;
   gint offset = 0;
 
-  status = AudioUnitRender (buf->audiounit, ioActionFlags, inTimeStamp,
-      inBusNumber, inNumberFrames, buf->recBufferList);
+  status = AudioUnitRender (buf->core_audio->audiounit, ioActionFlags,
+      inTimeStamp, inBusNumber, inNumberFrames, buf->core_audio->recBufferList);
 
   if (status) {
     GST_WARNING_OBJECT (buf, "AudioUnitRender returned %d", (int) status);
     return status;
   }
 
-  remaining = buf->recBufferList->mBuffers[0].mDataByteSize;
+  remaining = buf->core_audio->recBufferList->mBuffers[0].mDataByteSize;
 
   while (remaining) {
     if (!gst_ring_buffer_prepare_read (GST_RING_BUFFER (buf),
@@ -306,7 +305,8 @@ gst_osx_audio_src_io_proc (GstOsxRingBuffer * buf,
       len = remaining;
 
     memcpy (writeptr + buf->segoffset,
-        (char *) buf->recBufferList->mBuffers[0].mData + offset, len);
+        (char *) buf->core_audio->recBufferList->mBuffers[0].mData + offset,
+        len);
 
     buf->segoffset += len;
     offset += len;
@@ -333,30 +333,5 @@ gst_osx_audio_src_osxelement_init (gpointer g_iface, gpointer iface_data)
 static void
 gst_osx_audio_src_select_device (GstOsxAudioSrc * osxsrc)
 {
-  OSStatus status;
-  UInt32 propertySize;
-
-  if (osxsrc->device_id == kAudioDeviceUnknown) {
-    /* If no specific device has been selected by the user, then pick the
-     * default device */
-    GST_DEBUG_OBJECT (osxsrc, "Selecting device for OSXAudioSrc");
-    propertySize = sizeof (osxsrc->device_id);
-    status = AudioHardwareGetProperty (kAudioHardwarePropertyDefaultInputDevice,
-        &propertySize, &osxsrc->device_id);
-
-    if (status) {
-      GST_WARNING_OBJECT (osxsrc,
-          "AudioHardwareGetProperty returned %d", (int) status);
-    } else {
-      GST_DEBUG_OBJECT (osxsrc, "AudioHardwareGetProperty returned 0");
-    }
-
-    if (osxsrc->device_id == kAudioDeviceUnknown) {
-      GST_WARNING_OBJECT (osxsrc,
-          "AudioHardwareGetProperty: device_id is kAudioDeviceUnknown");
-    }
-
-    GST_DEBUG_OBJECT (osxsrc, "AudioHardwareGetProperty: device_id is %lu",
-        (long) osxsrc->device_id);
-  }
+  gst_core_audio_select_source_device (&osxsrc->device_id);
 }
diff --git a/sys/osxaudio/gstosxcoreaudio.c b/sys/osxaudio/gstosxcoreaudio.c
new file mode 100644
index 0000000..6109bb9
--- /dev/null
+++ b/sys/osxaudio/gstosxcoreaudio.c
@@ -0,0 +1,222 @@
+/*
+ * GStreamer
+ * Copyright (C) 2012-2013 Fluendo S.A. <support@fluendo.com>
+ *   Authors: Josep Torra Vallès <josep@fluendo.com>
+ *            Andoni Morales Alastruey <amorales@fluendo.com>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ *
+ */
+
+#include "gstosxcoreaudio.h"
+#include "gstosxcoreaudiocommon.h"
+#include "gstosxaudiosrc.h"
+
+GST_DEBUG_CATEGORY_STATIC (osx_audio_debug);
+#define GST_CAT_DEFAULT osx_audio_debug
+
+G_DEFINE_TYPE (GstCoreAudio, gst_core_audio, G_TYPE_OBJECT);
+
+#ifdef HAVE_IOS
+#include "gstosxcoreaudioremoteio.c"
+#else
+#include "gstosxcoreaudiohal.c"
+#endif
+
+
+static void
+gst_core_audio_class_init (GstCoreAudioClass * klass)
+{
+}
+
+static void
+gst_core_audio_init (GstCoreAudio * core_audio)
+{
+  core_audio->is_passthrough = FALSE;
+  core_audio->device_id = kAudioDeviceUnknown;
+  core_audio->is_src = FALSE;
+  core_audio->audiounit = NULL;
+#ifndef HAVE_IOS
+  core_audio->hog_pid = -1;
+  core_audio->disabled_mixing = FALSE;
+#endif
+}
+
+/**************************
+ *       Public API       *
+ *************************/
+
+GstCoreAudio *
+gst_core_audio_new (GstObject * osxbuf)
+{
+  GstCoreAudio *core_audio;
+
+  core_audio = g_object_new (GST_TYPE_CORE_AUDIO, NULL);
+  core_audio->osxbuf = osxbuf;
+  return core_audio;
+}
+
+gboolean
+gst_core_audio_close (GstCoreAudio * core_audio)
+{
+  AudioComponentInstanceDispose (core_audio->audiounit);
+  core_audio->audiounit = NULL;
+  return TRUE;
+}
+
+gboolean
+gst_core_audio_open (GstCoreAudio * core_audio)
+{
+
+  if (!gst_core_audio_open_impl (core_audio))
+    return FALSE;
+
+  if (core_audio->is_src) {
+    AudioStreamBasicDescription asbd_in;
+    UInt32 propertySize;
+    OSStatus status;
+
+    GstOsxAudioSrc *src =
+        GST_OSX_AUDIO_SRC (GST_OBJECT_PARENT (core_audio->osxbuf));
+
+    propertySize = sizeof (asbd_in);
+    status = AudioUnitGetProperty (core_audio->audiounit,
+        kAudioUnitProperty_StreamFormat,
+        kAudioUnitScope_Input, 1, &asbd_in, &propertySize);
+
+    if (status) {
+      AudioComponentInstanceDispose (core_audio->audiounit);
+      core_audio->audiounit = NULL;
+      GST_WARNING_OBJECT (core_audio,
+          "Unable to obtain device properties: %" GST_FOURCC_FORMAT,
+          GST_FOURCC_ARGS (status));
+      return FALSE;
+    } else {
+      src->deviceChannels = asbd_in.mChannelsPerFrame;
+    }
+  }
+
+  return TRUE;
+}
+
+gboolean
+gst_core_audio_start_processing (GstCoreAudio * core_audio)
+{
+  return gst_core_audio_start_processing_impl (core_audio);
+}
+
+gboolean
+gst_core_audio_pause_processing (GstCoreAudio * core_audio)
+{
+  return gst_core_audio_pause_processing_impl (core_audio);
+}
+
+gboolean
+gst_core_audio_stop_processing (GstCoreAudio * core_audio)
+{
+  return gst_core_audio_stop_processing_impl (core_audio);
+}
+
+gboolean
+gst_core_audio_get_samples_and_latency (GstCoreAudio * core_audio,
+    gdouble rate, guint * samples, gdouble * latency)
+{
+  return gst_core_audio_get_samples_and_latency_impl (core_audio, rate,
+      samples, latency);
+}
+
+gboolean
+gst_core_audio_initialize (GstCoreAudio * core_audio,
+    AudioStreamBasicDescription format, GstCaps * caps, gboolean is_passthrough)
+{
+  guint32 frame_size;
+  OSStatus status;
+
+  GST_DEBUG_OBJECT (core_audio,
+      "Initializing: passthrough:%d caps:%" GST_PTR_FORMAT, is_passthrough,
+      caps);
+
+  if (!gst_core_audio_initialize_impl (core_audio, format, caps,
+          is_passthrough, &frame_size)) {
+    goto error;
+  }
+
+  if (core_audio->is_src) {
+    /* create AudioBufferList needed for recording */
+    core_audio->recBufferList =
+        buffer_list_alloc (format.mChannelsPerFrame,
+        frame_size * format.mBytesPerFrame);
+  }
+
+  /* Initialize the AudioUnit */
+  status = AudioUnitInitialize (core_audio->audiounit);
+  if (status) {
+    GST_ERROR_OBJECT (core_audio, "Failed to initialise AudioUnit: %"
+        GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+    goto error;
+  }
+  return TRUE;
+
+error:
+  if (core_audio->is_src && core_audio->recBufferList) {
+    buffer_list_free (core_audio->recBufferList);
+    core_audio->recBufferList = NULL;
+  }
+  return FALSE;
+}
+
+void
+gst_core_audio_unitialize (GstCoreAudio * core_audio)
+{
+  AudioUnitUninitialize (core_audio->audiounit);
+
+  if (core_audio->recBufferList) {
+    buffer_list_free (core_audio->recBufferList);
+    core_audio->recBufferList = NULL;
+  }
+}
+
+void
+gst_core_audio_set_volume (GstCoreAudio * core_audio, gfloat volume)
+{
+  AudioUnitSetParameter (core_audio->audiounit, kHALOutputParam_Volume,
+      kAudioUnitScope_Global, 0, (float) volume, 0);
+}
+
+gboolean
+gst_core_audio_select_device (AudioDeviceID * device_id)
+{
+  return gst_core_audio_select_device_impl (device_id);
+}
+
+gboolean
+gst_core_audio_select_source_device (AudioDeviceID * device_id)
+{
+  return gst_core_audio_select_source_device_impl (device_id);
+}
+
+void
+gst_core_audio_init_debug (void)
+{
+  GST_DEBUG_CATEGORY_INIT (osx_audio_debug, "osxaudio", 0,
+      "OSX Audio Elements");
+}
+
+gboolean
+gst_core_audio_audio_device_is_spdif_avail (AudioDeviceID device_id)
+{
+  return gst_core_audio_audio_device_is_spdif_avail_impl (device_id);
+}
diff --git a/sys/osxaudio/gstosxcoreaudio.h b/sys/osxaudio/gstosxcoreaudio.h
new file mode 100644
index 0000000..71fcfa6
--- /dev/null
+++ b/sys/osxaudio/gstosxcoreaudio.h
@@ -0,0 +1,151 @@
+/*
+ * GStreamer
+ * Copyright (C) 2012 Fluendo S.A. <support@fluendo.com>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ *
+ */
+
+#ifndef __GST_CORE_AUDIO_H__
+#define __GST_CORE_AUDIO_H__
+
+#ifdef HAVE_CONFIG_H
+#  include <config.h>
+#endif
+
+#include <gst/gst.h>
+#ifdef HAVE_IOS
+  #include <CoreAudio/CoreAudioTypes.h>
+  #define AudioDeviceID gint
+  #define kAudioDeviceUnknown 0
+#else
+  #include <CoreAudio/CoreAudio.h>
+  #include <AudioToolbox/AudioToolbox.h>
+  #if MAC_OS_X_VERSION_MIN_REQUIRED <= MAC_OS_X_VERSION_10_5
+    #include <CoreServices/CoreServices.h>
+    #define AudioComponentFindNext FindNextComponent
+    #define AudioComponentInstanceNew OpenAComponent
+    #define AudioComponentInstanceDispose CloseComponent
+    #define AudioComponent Component
+    #define AudioComponentDescription ComponentDescription
+  #endif
+#endif
+#include <AudioUnit/AudioUnit.h>
+#include "gstosxaudioelement.h"
+
+
+G_BEGIN_DECLS
+
+#define GST_TYPE_CORE_AUDIO \
+  (gst_core_audio_get_type())
+#define GST_CORE_AUDIO(obj) \
+  (G_TYPE_CHECK_INSTANCE_CAST((obj),GST_TYPE_CORE_AUDIO,GstCoreAudio))
+#define GST_CORE_AUDIO_CLASS(klass) \
+  (G_TYPE_CHECK_CLASS_CAST((klass),GST_TYPE_CORE_AUDIO,GstCoreAudioClass))
+#define GST_CORE_AUDIO_GET_CLASS(obj) \
+  (G_TYPE_INSTANCE_GET_CLASS((obj),GST_TYPE_CORE_AUDIO,GstCoreAudioClass))
+#define GST_IS_CORE_AUDIO(obj) \
+  (G_TYPE_CHECK_INSTANCE_TYPE((obj),GST_TYPE_CORE_AUDIO))
+#define GST_IS_CORE_AUDIO_CLASS(klass) \
+  (G_TYPE_CHECK_CLASS_TYPE((klass),GST_TYPE_CORE_AUDIO))
+
+#define CORE_AUDIO_FORMAT_IS_SPDIF(f) ((f).mFormat.mFormatID == 'IAC3' || (f).mFormat.mFormatID == 'iac3' || (f).mFormat.mFormatID == kAudioFormat60958AC3 || (f).mFormat.mFormatID == kAudioFormatAC3)
+
+#define CORE_AUDIO_FORMAT "FormatID: %" GST_FOURCC_FORMAT " rate: %f flags: 0x%x BytesPerPacket: %u FramesPerPacket: %u BytesPerFrame: %u ChannelsPerFrame: %u BitsPerChannel: %u"
+#define CORE_AUDIO_FORMAT_ARGS(f) GST_FOURCC_ARGS((f).mFormatID),(f).mSampleRate,(unsigned)(f).mFormatFlags,(unsigned)(f).mBytesPerPacket,(unsigned)(f).mFramesPerPacket,(unsigned)(f).mBytesPerFrame,(unsigned)(f).mChannelsPerFrame,(unsigned)(f).mBitsPerChannel
+
+typedef struct _GstCoreAudio GstCoreAudio;
+typedef struct _GstCoreAudioClass GstCoreAudioClass;
+
+struct _GstCoreAudio
+{
+  GObject object;
+
+  GstObject *osxbuf;
+  GstOsxAudioElementInterface *element;
+
+  gboolean is_src;
+  gboolean is_passthrough;
+  AudioDeviceID device_id;
+  AudioStreamBasicDescription stream_format;
+  gint stream_idx;
+  gboolean io_proc_active;
+  gboolean io_proc_needs_deactivation;
+
+  /* For LPCM in/out */
+  AudioUnit audiounit;
+  AudioBufferList *recBufferList;
+
+#ifndef HAVE_IOS
+  /* For SPDIF out */
+  pid_t hog_pid;
+  gboolean disabled_mixing;
+  AudioStreamID stream_id;
+  gboolean revert_format;
+  AudioStreamBasicDescription original_format;
+  AudioDeviceIOProcID procID;
+#endif
+};
+
+struct _GstCoreAudioClass
+{
+  GObjectClass parent_class;
+};
+
+GType gst_core_audio_get_type                                (void);
+
+void gst_core_audio_init_debug (void);
+
+GstCoreAudio * gst_core_audio_new                            (GstObject *osxbuf);
+
+gboolean gst_core_audio_open                                 (GstCoreAudio *core_audio);
+
+gboolean gst_core_audio_close                                (GstCoreAudio *core_audio);
+
+gboolean gst_core_audio_initialize                           (GstCoreAudio *core_audio,
+                                                              AudioStreamBasicDescription format,
+                                                              GstCaps *caps,
+                                                              gboolean is_passthrough);
+
+void gst_core_audio_unitialize                               (GstCoreAudio *core_audio);
+
+gboolean gst_core_audio_start_processing                     (GstCoreAudio *core_audio);
+
+gboolean gst_core_audio_pause_processing                     (GstCoreAudio *core_audio);
+
+gboolean gst_core_audio_stop_processing                      (GstCoreAudio *core_audio);
+
+gboolean gst_core_audio_get_samples_and_latency              (GstCoreAudio * core_audio,
+                                                              gdouble rate,
+                                                              guint *samples,
+                                                              gdouble *latency);
+
+void  gst_core_audio_set_volume                              (GstCoreAudio *core_audio,
+                                                              gfloat volume);
+
+gboolean gst_core_audio_audio_device_is_spdif_avail          (AudioDeviceID device_id);
+
+
+gboolean gst_core_audio_select_device                        (AudioDeviceID *device_id);
+
+gboolean gst_core_audio_select_source_device                        (AudioDeviceID *device_id);
+
+AudioChannelLayout * gst_core_audio_audio_device_get_channel_layout (AudioDeviceID device_id);
+
+
+G_END_DECLS
+
+#endif /* __GST_CORE_AUDIO_H__ */
diff --git a/sys/osxaudio/gstosxcoreaudiocommon.c b/sys/osxaudio/gstosxcoreaudiocommon.c
new file mode 100644
index 0000000..5200b2e
--- /dev/null
+++ b/sys/osxaudio/gstosxcoreaudiocommon.c
@@ -0,0 +1,431 @@
+/*
+ * GStreamer
+ * Copyright (C) 2012-2013 Fluendo S.A. <support@fluendo.com>
+ *   Authors: Josep Torra Vallès <josep@fluendo.com>
+ *            Andoni Morales Alastruey <amorales@fluendo.com>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ *
+ */
+
+#include "gstosxcoreaudiocommon.h"
+
+void
+gst_core_audio_remove_render_callback (GstCoreAudio * core_audio)
+{
+  AURenderCallbackStruct input;
+  OSStatus status;
+
+  /* Deactivate the render callback by calling SetRenderCallback
+   * with a NULL inputProc.
+   */
+  input.inputProc = NULL;
+  input.inputProcRefCon = NULL;
+
+  status = AudioUnitSetProperty (core_audio->audiounit, kAudioUnitProperty_SetRenderCallback, kAudioUnitScope_Global, 0,        /* N/A for global */
+      &input, sizeof (input));
+
+  if (status) {
+    GST_WARNING_OBJECT (core_audio->osxbuf, "Failed to remove render callback %"
+        GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+  }
+
+  /* Remove the RenderNotify too */
+  status = AudioUnitRemoveRenderNotify (core_audio->audiounit,
+      (AURenderCallback) gst_core_audio_render_notify, core_audio);
+
+  if (status) {
+    GST_WARNING_OBJECT (core_audio->osxbuf,
+        "Failed to remove render notify callback %" GST_FOURCC_FORMAT,
+        GST_FOURCC_ARGS (status));
+  }
+
+  /* We're deactivated.. */
+  core_audio->io_proc_needs_deactivation = FALSE;
+  core_audio->io_proc_active = FALSE;
+}
+
+OSStatus
+gst_core_audio_render_notify (GstCoreAudio * core_audio,
+    AudioUnitRenderActionFlags * ioActionFlags,
+    const AudioTimeStamp * inTimeStamp,
+    unsigned int inBusNumber,
+    unsigned int inNumberFrames, AudioBufferList * ioData)
+{
+  /* Before rendering a frame, we get the PreRender notification.
+   * Here, we detach the RenderCallback if we've been paused.
+   *
+   * This is necessary (rather than just directly detaching it) to
+   * work around some thread-safety issues in CoreAudio
+   */
+  if ((*ioActionFlags) & kAudioUnitRenderAction_PreRender) {
+    if (core_audio->io_proc_needs_deactivation) {
+      gst_core_audio_remove_render_callback (core_audio);
+    }
+  }
+
+  return noErr;
+}
+
+gboolean
+gst_core_audio_io_proc_start (GstCoreAudio * core_audio)
+{
+  OSStatus status;
+  AURenderCallbackStruct input;
+  AudioUnitPropertyID callback_type;
+
+  GST_DEBUG_OBJECT (core_audio->osxbuf,
+      "osx ring buffer start ioproc: %p device_id %lu",
+      core_audio->element->io_proc, (gulong) core_audio->device_id);
+  if (!core_audio->io_proc_active) {
+    callback_type = core_audio->is_src ?
+        kAudioOutputUnitProperty_SetInputCallback :
+        kAudioUnitProperty_SetRenderCallback;
+
+    input.inputProc = (AURenderCallback) core_audio->element->io_proc;
+    input.inputProcRefCon = core_audio->osxbuf;
+
+    status = AudioUnitSetProperty (core_audio->audiounit, callback_type, kAudioUnitScope_Global, 0,     /* N/A for global */
+        &input, sizeof (input));
+
+    if (status) {
+      GST_ERROR_OBJECT (core_audio->osxbuf,
+          "AudioUnitSetProperty failed: %" GST_FOURCC_FORMAT,
+          GST_FOURCC_ARGS (status));
+      return FALSE;
+    }
+    // ### does it make sense to do this notify stuff for input mode?
+    status = AudioUnitAddRenderNotify (core_audio->audiounit,
+        (AURenderCallback) gst_core_audio_render_notify, core_audio);
+
+    if (status) {
+      GST_ERROR_OBJECT (core_audio->osxbuf,
+          "AudioUnitAddRenderNotify failed %"
+          GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+      return FALSE;
+    }
+    core_audio->io_proc_active = TRUE;
+  }
+
+  core_audio->io_proc_needs_deactivation = FALSE;
+
+  status = AudioOutputUnitStart (core_audio->audiounit);
+  if (status) {
+    GST_ERROR_OBJECT (core_audio->osxbuf, "AudioOutputUnitStart failed: %"
+        GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+    return FALSE;
+  }
+  return TRUE;
+}
+
+gboolean
+gst_core_audio_io_proc_stop (GstCoreAudio * core_audio)
+{
+  OSErr status;
+
+  GST_DEBUG_OBJECT (core_audio->osxbuf,
+      "osx ring buffer stop ioproc: %p device_id %lu",
+      core_audio->element->io_proc, (gulong) core_audio->device_id);
+
+  status = AudioOutputUnitStop (core_audio->audiounit);
+  if (status) {
+    GST_WARNING_OBJECT (core_audio->osxbuf,
+        "AudioOutputUnitStop failed: %" GST_FOURCC_FORMAT,
+        GST_FOURCC_ARGS (status));
+  }
+  // ###: why is it okay to directly remove from here but not from pause() ?
+  if (core_audio->io_proc_active) {
+    gst_core_audio_remove_render_callback (core_audio);
+  }
+  return TRUE;
+}
+
+AudioBufferList *
+buffer_list_alloc (int channels, int size)
+{
+  AudioBufferList *list;
+  int total_size;
+  int n;
+
+  total_size = sizeof (AudioBufferList) + 1 * sizeof (AudioBuffer);
+  list = (AudioBufferList *) g_malloc (total_size);
+
+  list->mNumberBuffers = 1;
+  for (n = 0; n < (int) list->mNumberBuffers; ++n) {
+    list->mBuffers[n].mNumberChannels = channels;
+    list->mBuffers[n].mDataByteSize = size;
+    list->mBuffers[n].mData = g_malloc (size);
+  }
+
+  return list;
+}
+
+void
+buffer_list_free (AudioBufferList * list)
+{
+  int n;
+
+  for (n = 0; n < (int) list->mNumberBuffers; ++n) {
+    if (list->mBuffers[n].mData)
+      g_free (list->mBuffers[n].mData);
+  }
+
+  g_free (list);
+}
+
+gboolean
+gst_core_audio_bind_device (GstCoreAudio * core_audio)
+{
+  OSStatus status;
+
+  /* Specify which device we're using. */
+  GST_DEBUG_OBJECT (core_audio->osxbuf, "Bind AudioUnit to device %d",
+      (int) core_audio->device_id);
+  status = AudioUnitSetProperty (core_audio->audiounit,
+      kAudioOutputUnitProperty_CurrentDevice, kAudioUnitScope_Global, 0,
+      &core_audio->device_id, sizeof (AudioDeviceID));
+  if (status) {
+    GST_ERROR_OBJECT (core_audio->osxbuf, "Failed binding to device: %"
+        GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+    goto audiounit_error;
+  }
+  return TRUE;
+
+audiounit_error:
+  if (core_audio->recBufferList) {
+    buffer_list_free (core_audio->recBufferList);
+    core_audio->recBufferList = NULL;
+  }
+  return FALSE;
+}
+
+gboolean
+gst_core_audio_set_channels_layout (GstCoreAudio * core_audio,
+    gint channels, GstCaps * caps)
+{
+  /* Configure the output stream and allocate ringbuffer memory */
+  AudioChannelLayout *layout = NULL;
+  OSStatus status;
+  int layoutSize, element, i;
+  AudioUnitScope scope;
+  GstStructure *structure;
+  GstAudioChannelPosition *positions;
+
+  /* Describe channels */
+  layoutSize = sizeof (AudioChannelLayout) +
+      channels * sizeof (AudioChannelDescription);
+  layout = g_malloc (layoutSize);
+
+  structure = gst_caps_get_structure (caps, 0);
+  positions = gst_audio_get_channel_positions (structure);
+
+  layout->mChannelLayoutTag = kAudioChannelLayoutTag_UseChannelDescriptions;
+  layout->mChannelBitmap = 0;   /* Not used */
+  layout->mNumberChannelDescriptions = channels;
+  for (i = 0; i < channels; i++) {
+    if (positions) {
+      layout->mChannelDescriptions[i].mChannelLabel =
+          gst_audio_channel_position_to_coreaudio_channel_label (positions[i],
+          i);
+    } else {
+      /* Discrete channel numbers are ORed into this */
+      layout->mChannelDescriptions[i].mChannelLabel =
+          kAudioChannelLabel_Discrete_0 | i;
+    }
+
+    /* Others unused */
+    layout->mChannelDescriptions[i].mChannelFlags = 0;
+    layout->mChannelDescriptions[i].mCoordinates[0] = 0.f;
+    layout->mChannelDescriptions[i].mCoordinates[1] = 0.f;
+    layout->mChannelDescriptions[i].mCoordinates[2] = 0.f;
+  }
+
+  if (positions) {
+    g_free (positions);
+    positions = NULL;
+  }
+
+  scope = core_audio->is_src ? kAudioUnitScope_Output : kAudioUnitScope_Input;
+  element = core_audio->is_src ? 1 : 0;
+
+  if (layoutSize) {
+    status = AudioUnitSetProperty (core_audio->audiounit,
+        kAudioUnitProperty_AudioChannelLayout,
+        scope, element, layout, layoutSize);
+    if (status) {
+      GST_WARNING_OBJECT (core_audio->osxbuf,
+          "Failed to set output channel layout: %" GST_FOURCC_FORMAT,
+          GST_FOURCC_ARGS (status));
+      return FALSE;
+    }
+  }
+
+  g_free (layout);
+  return TRUE;
+}
+
+gboolean
+gst_core_audio_set_format (GstCoreAudio * core_audio,
+    AudioStreamBasicDescription format)
+{
+  /* Configure the output stream and allocate ringbuffer memory */
+  OSStatus status;
+  UInt32 propertySize;
+  int element;
+  AudioUnitScope scope;
+
+  GST_DEBUG_OBJECT (core_audio->osxbuf, "Setting format for AudioUnit");
+
+  scope = core_audio->is_src ? kAudioUnitScope_Output : kAudioUnitScope_Input;
+  element = core_audio->is_src ? 1 : 0;
+
+  propertySize = sizeof (AudioStreamBasicDescription);
+  status = AudioUnitSetProperty (core_audio->audiounit,
+      kAudioUnitProperty_StreamFormat, scope, element, &format, propertySize);
+
+  if (status) {
+    GST_WARNING_OBJECT (core_audio->osxbuf,
+        "Failed to set audio description: %" GST_FOURCC_FORMAT,
+        GST_FOURCC_ARGS (status));
+    return FALSE;;
+  }
+
+  return TRUE;
+}
+
+gboolean
+gst_core_audio_open_device (GstCoreAudio * core_audio, OSType sub_type,
+    const gchar * adesc)
+{
+  AudioComponentDescription desc;
+  AudioComponent comp;
+  OSStatus status;
+  AudioUnit unit;
+  UInt32 enableIO;
+
+  desc.componentType = kAudioUnitType_Output;
+  desc.componentSubType = sub_type;
+  desc.componentManufacturer = kAudioUnitManufacturer_Apple;
+  desc.componentFlags = 0;
+  desc.componentFlagsMask = 0;
+
+  comp = AudioComponentFindNext (NULL, &desc);
+
+  if (comp == NULL) {
+    GST_WARNING_OBJECT (core_audio->osxbuf, "Couldn't find %s component",
+        adesc);
+    return FALSE;
+  }
+
+  status = AudioComponentInstanceNew (comp, &unit);
+
+  if (status) {
+    GST_ERROR_OBJECT (core_audio->osxbuf, "Couldn't open %s component %"
+        GST_FOURCC_FORMAT, adesc, GST_FOURCC_ARGS (status));
+    return FALSE;
+  }
+
+  if (core_audio->is_src) {
+    /* enable input */
+    enableIO = 1;
+    status = AudioUnitSetProperty (unit, kAudioOutputUnitProperty_EnableIO, kAudioUnitScope_Input, 1,   /* 1 = input element */
+        &enableIO, sizeof (enableIO));
+
+    if (status) {
+      AudioComponentInstanceDispose (unit);
+      GST_WARNING_OBJECT (core_audio->osxbuf, "Failed to enable input: %"
+          GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+      return FALSE;
+    }
+
+    /* disable output */
+    enableIO = 0;
+    status = AudioUnitSetProperty (unit, kAudioOutputUnitProperty_EnableIO, kAudioUnitScope_Output, 0,  /* 0 = output element */
+        &enableIO, sizeof (enableIO));
+
+    if (status) {
+      AudioComponentInstanceDispose (unit);
+      GST_WARNING_OBJECT (core_audio->osxbuf, "Failed to disable output: %"
+          GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+      return FALSE;
+    }
+  }
+
+  GST_DEBUG_OBJECT (core_audio->osxbuf, "Created %s AudioUnit: %p", adesc,
+      unit);
+  core_audio->audiounit = unit;
+  return TRUE;
+}
+
+AudioChannelLabel
+gst_audio_channel_position_to_coreaudio_channel_label (GstAudioChannelPosition
+    position, int channel)
+{
+  switch (position) {
+    case GST_AUDIO_CHANNEL_POSITION_NONE:
+      return kAudioChannelLabel_Discrete_0 | channel;
+    case GST_AUDIO_CHANNEL_POSITION_FRONT_MONO:
+      return kAudioChannelLabel_Mono;
+    case GST_AUDIO_CHANNEL_POSITION_FRONT_LEFT:
+      return kAudioChannelLabel_Left;
+    case GST_AUDIO_CHANNEL_POSITION_FRONT_RIGHT:
+      return kAudioChannelLabel_Right;
+    case GST_AUDIO_CHANNEL_POSITION_REAR_CENTER:
+      return kAudioChannelLabel_CenterSurround;
+    case GST_AUDIO_CHANNEL_POSITION_REAR_LEFT:
+      return kAudioChannelLabel_LeftSurround;
+    case GST_AUDIO_CHANNEL_POSITION_REAR_RIGHT:
+      return kAudioChannelLabel_RightSurround;
+    case GST_AUDIO_CHANNEL_POSITION_LFE:
+      return kAudioChannelLabel_LFEScreen;
+    case GST_AUDIO_CHANNEL_POSITION_FRONT_CENTER:
+      return kAudioChannelLabel_Center;
+    case GST_AUDIO_CHANNEL_POSITION_FRONT_LEFT_OF_CENTER:
+      return kAudioChannelLabel_Center; // ???
+    case GST_AUDIO_CHANNEL_POSITION_FRONT_RIGHT_OF_CENTER:
+      return kAudioChannelLabel_Center; // ???
+    case GST_AUDIO_CHANNEL_POSITION_SIDE_LEFT:
+      return kAudioChannelLabel_LeftSurroundDirect;
+    case GST_AUDIO_CHANNEL_POSITION_SIDE_RIGHT:
+      return kAudioChannelLabel_RightSurroundDirect;
+    default:
+      return kAudioChannelLabel_Unknown;
+  }
+}
+
+void
+gst_core_audio_dump_channel_layout (AudioChannelLayout * channel_layout)
+{
+  UInt32 i;
+
+  GST_DEBUG ("mChannelLayoutTag: 0x%lx",
+      (unsigned long) channel_layout->mChannelLayoutTag);
+  GST_DEBUG ("mChannelBitmap: 0x%lx",
+      (unsigned long) channel_layout->mChannelBitmap);
+  GST_DEBUG ("mNumberChannelDescriptions: %lu",
+      (unsigned long) channel_layout->mNumberChannelDescriptions);
+  for (i = 0; i < channel_layout->mNumberChannelDescriptions; i++) {
+    AudioChannelDescription *channel_desc =
+        &channel_layout->mChannelDescriptions[i];
+    GST_DEBUG ("  mChannelLabel: 0x%lx mChannelFlags: 0x%lx "
+        "mCoordinates[0]: %f mCoordinates[1]: %f "
+        "mCoordinates[2]: %f",
+        (unsigned long) channel_desc->mChannelLabel,
+        (unsigned long) channel_desc->mChannelFlags,
+        channel_desc->mCoordinates[0], channel_desc->mCoordinates[1],
+        channel_desc->mCoordinates[2]);
+  }
+}
diff --git a/sys/osxaudio/gstosxcoreaudiocommon.h b/sys/osxaudio/gstosxcoreaudiocommon.h
new file mode 100644
index 0000000..7b6a53d
--- /dev/null
+++ b/sys/osxaudio/gstosxcoreaudiocommon.h
@@ -0,0 +1,65 @@
+/*
+ * GStreamer
+ * Copyright (C) 2012-2013 Fluendo S.A. <support@fluendo.com>
+ *   Authors: Josep Torra Vallès <josep@fluendo.com>
+ *            Andoni Morales Alastruey <amorales@fluendo.com>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ *
+ */
+
+#include "gstosxcoreaudio.h"
+#include <gst/audio/multichannel.h>
+
+typedef struct
+{
+  GMutex *lock;
+  GCond *cond;
+} PropertyMutex;
+
+gboolean gst_core_audio_bind_device                       (GstCoreAudio *core_audio);
+
+void gst_core_audio_dump_channel_layout                   (AudioChannelLayout * channel_layout);
+
+void gst_core_audio_remove_render_callback                (GstCoreAudio * core_audio);
+
+gboolean gst_core_audio_io_proc_start                     (GstCoreAudio * core_audio);
+
+gboolean gst_core_audio_io_proc_stop                      (GstCoreAudio * core_audio);
+
+AudioBufferList * buffer_list_alloc                       (int channels, int size);
+
+void buffer_list_free                                     (AudioBufferList * list);
+
+gboolean gst_core_audio_set_format                        (GstCoreAudio * core_audio,
+                                                           AudioStreamBasicDescription format);
+
+gboolean gst_core_audio_set_channels_layout               (GstCoreAudio * core_audio,
+                                                           gint channels, GstCaps * caps);
+
+gboolean gst_core_audio_open_device                       (GstCoreAudio *core_audio,
+                                                           OSType sub_type,
+                                                           const gchar *adesc);
+
+OSStatus gst_core_audio_render_notify                     (GstCoreAudio * core_audio,
+                                                           AudioUnitRenderActionFlags * ioActionFlags,
+                                                           const AudioTimeStamp * inTimeStamp,
+                                                           unsigned int inBusNumber,
+                                                           unsigned int inNumberFrames,
+                                                           AudioBufferList * ioData);
+
+AudioChannelLabel gst_audio_channel_position_to_coreaudio_channel_label (GstAudioChannelPosition position, int channel);
+
diff --git a/sys/osxaudio/gstosxcoreaudiohal.c b/sys/osxaudio/gstosxcoreaudiohal.c
new file mode 100644
index 0000000..0bdfaec
--- /dev/null
+++ b/sys/osxaudio/gstosxcoreaudiohal.c
@@ -0,0 +1,1282 @@
+/*
+ * GStreamer
+ * Copyright (C) 2012-2013 Fluendo S.A. <support@fluendo.com>
+ *   Authors: Josep Torra Vallès <josep@fluendo.com>
+ *            Andoni Morales Alastruey <amorales@fluendo.com>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ *
+ */
+
+#include <unistd.h>             /* for getpid */
+#include "gstosxaudiosink.h"
+
+static inline gboolean
+_audio_system_set_runloop (CFRunLoopRef runLoop)
+{
+  OSStatus status = noErr;
+
+  gboolean res = FALSE;
+
+  AudioObjectPropertyAddress runloopAddress = {
+    kAudioHardwarePropertyRunLoop,
+    kAudioObjectPropertyScopeGlobal,
+    kAudioObjectPropertyElementMaster
+  };
+
+  status = AudioObjectSetPropertyData (kAudioObjectSystemObject,
+      &runloopAddress, 0, NULL, sizeof (CFRunLoopRef), &runLoop);
+  if (status == noErr) {
+    res = TRUE;
+  } else {
+    GST_ERROR ("failed to set runloop to %p: %" GST_FOURCC_FORMAT,
+        runLoop, GST_FOURCC_ARGS (status));
+  }
+
+  return res;
+}
+
+static inline AudioDeviceID
+_audio_system_get_default_output (void)
+{
+  OSStatus status = noErr;
+  UInt32 propertySize = sizeof (AudioDeviceID);
+  AudioDeviceID device_id = kAudioDeviceUnknown;
+
+  AudioObjectPropertyAddress defaultDeviceAddress = {
+    kAudioHardwarePropertyDefaultOutputDevice,
+    kAudioDevicePropertyScopeOutput,
+    kAudioObjectPropertyElementMaster
+  };
+
+  status = AudioObjectGetPropertyData (kAudioObjectSystemObject,
+      &defaultDeviceAddress, 0, NULL, &propertySize, &device_id);
+  if (status != noErr) {
+    GST_ERROR ("failed getting default output device: %"
+        GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+  }
+
+  return device_id;
+}
+
+static inline AudioDeviceID *
+_audio_system_get_devices (gint * ndevices)
+{
+  OSStatus status = noErr;
+  UInt32 propertySize = 0;
+  AudioDeviceID *devices = NULL;
+
+  AudioObjectPropertyAddress audioDevicesAddress = {
+    kAudioHardwarePropertyDevices,
+    kAudioDevicePropertyScopeOutput,
+    kAudioObjectPropertyElementMaster
+  };
+
+  status = AudioObjectGetPropertyDataSize (kAudioObjectSystemObject,
+      &audioDevicesAddress, 0, NULL, &propertySize);
+  if (status != noErr) {
+    GST_WARNING ("failed getting number of devices: %"
+        GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+    return NULL;
+  }
+
+  *ndevices = propertySize / sizeof (AudioDeviceID);
+
+  devices = (AudioDeviceID *) g_malloc (propertySize);
+  if (devices) {
+    status = AudioObjectGetPropertyData (kAudioObjectSystemObject,
+        &audioDevicesAddress, 0, NULL, &propertySize, devices);
+    if (status != noErr) {
+      GST_WARNING ("failed getting the list of devices: %"
+          GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+      g_free (devices);
+      *ndevices = 0;
+      return NULL;
+    }
+  }
+  return devices;
+}
+
+static inline gboolean
+_audio_device_is_alive (AudioDeviceID device_id)
+{
+  OSStatus status = noErr;
+  int alive = FALSE;
+  UInt32 propertySize = sizeof (alive);
+
+  AudioObjectPropertyAddress audioDeviceAliveAddress = {
+    kAudioDevicePropertyDeviceIsAlive,
+    kAudioDevicePropertyScopeOutput,
+    kAudioObjectPropertyElementMaster
+  };
+
+  status = AudioObjectGetPropertyData (device_id,
+      &audioDeviceAliveAddress, 0, NULL, &propertySize, &alive);
+  if (status != noErr) {
+    alive = FALSE;
+  }
+
+  return alive;
+}
+
+static inline guint
+_audio_device_get_latency (AudioDeviceID device_id)
+{
+  OSStatus status = noErr;
+  UInt32 latency = 0;
+  UInt32 propertySize = sizeof (latency);
+
+  AudioObjectPropertyAddress audioDeviceLatencyAddress = {
+    kAudioDevicePropertyLatency,
+    kAudioDevicePropertyScopeOutput,
+    kAudioObjectPropertyElementMaster
+  };
+
+  status = AudioObjectGetPropertyData (device_id,
+      &audioDeviceLatencyAddress, 0, NULL, &propertySize, &latency);
+  if (status != noErr) {
+    GST_ERROR ("failed to get latency: %" GST_FOURCC_FORMAT,
+        GST_FOURCC_ARGS (status));
+    latency = -1;
+  }
+
+  return latency;
+}
+
+static inline pid_t
+_audio_device_get_hog (AudioDeviceID device_id)
+{
+  OSStatus status = noErr;
+  pid_t hog_pid;
+  UInt32 propertySize = sizeof (hog_pid);
+
+  AudioObjectPropertyAddress audioDeviceHogModeAddress = {
+    kAudioDevicePropertyHogMode,
+    kAudioDevicePropertyScopeOutput,
+    kAudioObjectPropertyElementMaster
+  };
+
+  status = AudioObjectGetPropertyData (device_id,
+      &audioDeviceHogModeAddress, 0, NULL, &propertySize, &hog_pid);
+  if (status != noErr) {
+    GST_ERROR ("failed to get hog: %" GST_FOURCC_FORMAT,
+        GST_FOURCC_ARGS (status));
+    hog_pid = -1;
+  }
+
+  return hog_pid;
+}
+
+static inline gboolean
+_audio_device_set_hog (AudioDeviceID device_id, pid_t hog_pid)
+{
+  OSStatus status = noErr;
+  UInt32 propertySize = sizeof (hog_pid);
+  gboolean res = FALSE;
+
+  AudioObjectPropertyAddress audioDeviceHogModeAddress = {
+    kAudioDevicePropertyHogMode,
+    kAudioDevicePropertyScopeOutput,
+    kAudioObjectPropertyElementMaster
+  };
+
+  status = AudioObjectSetPropertyData (device_id,
+      &audioDeviceHogModeAddress, 0, NULL, propertySize, &hog_pid);
+
+  if (status == noErr) {
+    res = TRUE;
+  } else {
+    GST_ERROR ("failed to set hog: %" GST_FOURCC_FORMAT,
+        GST_FOURCC_ARGS (status));
+  }
+
+  return res;
+}
+
+static inline gboolean
+_audio_device_set_mixing (AudioDeviceID device_id, gboolean enable_mix)
+{
+  OSStatus status = noErr;
+  UInt32 propertySize = 0, can_mix = enable_mix;
+  Boolean writable = FALSE;
+  gboolean res = FALSE;
+
+  AudioObjectPropertyAddress audioDeviceSupportsMixingAddress = {
+    kAudioDevicePropertySupportsMixing,
+    kAudioObjectPropertyScopeGlobal,
+    kAudioObjectPropertyElementMaster
+  };
+
+  if (AudioObjectHasProperty (device_id, &audioDeviceSupportsMixingAddress)) {
+    /* Set mixable to false if we are allowed to */
+    status = AudioObjectIsPropertySettable (device_id,
+        &audioDeviceSupportsMixingAddress, &writable);
+    if (status) {
+      GST_DEBUG ("AudioObjectIsPropertySettable: %" GST_FOURCC_FORMAT,
+          GST_FOURCC_ARGS (status));
+    }
+    status = AudioObjectGetPropertyDataSize (device_id,
+        &audioDeviceSupportsMixingAddress, 0, NULL, &propertySize);
+    if (status) {
+      GST_DEBUG ("AudioObjectGetPropertyDataSize: %" GST_FOURCC_FORMAT,
+          GST_FOURCC_ARGS (status));
+    }
+    status = AudioObjectGetPropertyData (device_id,
+        &audioDeviceSupportsMixingAddress, 0, NULL, &propertySize, &can_mix);
+    if (status) {
+      GST_DEBUG ("AudioObjectGetPropertyData: %" GST_FOURCC_FORMAT,
+          GST_FOURCC_ARGS (status));
+    }
+
+    if (status == noErr && writable) {
+      can_mix = enable_mix;
+      status = AudioObjectSetPropertyData (device_id,
+          &audioDeviceSupportsMixingAddress, 0, NULL, propertySize, &can_mix);
+      res = TRUE;
+    }
+
+    if (status != noErr) {
+      GST_ERROR ("failed to set mixmode: %" GST_FOURCC_FORMAT,
+          GST_FOURCC_ARGS (status));
+    }
+  } else {
+    GST_DEBUG ("property not found, mixing coudln't be changed");
+  }
+
+  return res;
+}
+
+static inline gchar *
+_audio_device_get_name (AudioDeviceID device_id)
+{
+  OSStatus status = noErr;
+  UInt32 propertySize = 0;
+  gchar *device_name = NULL;
+
+  AudioObjectPropertyAddress deviceNameAddress = {
+    kAudioDevicePropertyDeviceName,
+    kAudioDevicePropertyScopeOutput,
+    kAudioObjectPropertyElementMaster
+  };
+
+  /* Get the length of the device name */
+  status = AudioObjectGetPropertyDataSize (device_id,
+      &deviceNameAddress, 0, NULL, &propertySize);
+  if (status != noErr) {
+    goto beach;
+  }
+
+  /* Get the name of the device */
+  device_name = (gchar *) g_malloc (propertySize);
+  status = AudioObjectGetPropertyData (device_id,
+      &deviceNameAddress, 0, NULL, &propertySize, device_name);
+  if (status != noErr) {
+    g_free (device_name);
+    device_name = NULL;
+  }
+
+beach:
+  return device_name;
+}
+
+static inline gboolean
+_audio_device_has_output (AudioDeviceID device_id)
+{
+  OSStatus status = noErr;
+  UInt32 propertySize;
+
+  AudioObjectPropertyAddress streamsAddress = {
+    kAudioDevicePropertyStreams,
+    kAudioDevicePropertyScopeOutput,
+    kAudioObjectPropertyElementMaster
+  };
+
+  status = AudioObjectGetPropertyDataSize (device_id,
+      &streamsAddress, 0, NULL, &propertySize);
+  if (status != noErr) {
+    return FALSE;
+  }
+  if (propertySize == 0) {
+    return FALSE;
+  }
+
+  return TRUE;
+}
+
+AudioChannelLayout *
+gst_core_audio_audio_device_get_channel_layout (AudioDeviceID device_id)
+{
+  OSStatus status = noErr;
+  UInt32 propertySize = 0;
+  AudioChannelLayout *layout = NULL;
+
+  AudioObjectPropertyAddress channelLayoutAddress = {
+    kAudioDevicePropertyPreferredChannelLayout,
+    kAudioDevicePropertyScopeOutput,
+    kAudioObjectPropertyElementMaster
+  };
+
+  /* Get the length of the default channel layout structure */
+  status = AudioObjectGetPropertyDataSize (device_id,
+      &channelLayoutAddress, 0, NULL, &propertySize);
+  if (status != noErr) {
+    GST_ERROR ("failed to get prefered layout: %" GST_FOURCC_FORMAT,
+        GST_FOURCC_ARGS (status));
+    goto beach;
+  }
+
+  /* Get the default channel layout of the device */
+  layout = (AudioChannelLayout *) g_malloc (propertySize);
+  status = AudioObjectGetPropertyData (device_id,
+      &channelLayoutAddress, 0, NULL, &propertySize, layout);
+  if (status != noErr) {
+    GST_ERROR ("failed to get prefered layout: %" GST_FOURCC_FORMAT,
+        GST_FOURCC_ARGS (status));
+    goto failed;
+  }
+
+  if (layout->mChannelLayoutTag == kAudioChannelLayoutTag_UseChannelBitmap) {
+    /* bitmap defined channellayout */
+    status =
+        AudioFormatGetProperty (kAudioFormatProperty_ChannelLayoutForBitmap,
+        sizeof (UInt32), &layout->mChannelBitmap, &propertySize, layout);
+    if (status != noErr) {
+      GST_ERROR ("failed to get layout for bitmap: %" GST_FOURCC_FORMAT,
+          GST_FOURCC_ARGS (status));
+      goto failed;
+    }
+  } else if (layout->mChannelLayoutTag !=
+      kAudioChannelLayoutTag_UseChannelDescriptions) {
+    /* layouttags defined channellayout */
+    status = AudioFormatGetProperty (kAudioFormatProperty_ChannelLayoutForTag,
+        sizeof (AudioChannelLayoutTag), &layout->mChannelLayoutTag,
+        &propertySize, layout);
+    if (status != noErr) {
+      GST_ERROR ("failed to get layout for tag: %" GST_FOURCC_FORMAT,
+          GST_FOURCC_ARGS (status));
+      goto failed;
+    }
+  }
+
+beach:
+  gst_core_audio_dump_channel_layout (layout);
+  return layout;
+
+failed:
+  g_free (layout);
+  return NULL;
+}
+
+static inline AudioStreamID *
+_audio_device_get_streams (AudioDeviceID device_id, gint * nstreams)
+{
+  OSStatus status = noErr;
+  UInt32 propertySize = 0;
+  AudioStreamID *streams = NULL;
+
+  AudioObjectPropertyAddress streamsAddress = {
+    kAudioDevicePropertyStreams,
+    kAudioDevicePropertyScopeOutput,
+    kAudioObjectPropertyElementMaster
+  };
+
+  status = AudioObjectGetPropertyDataSize (device_id,
+      &streamsAddress, 0, NULL, &propertySize);
+  if (status != noErr) {
+    GST_WARNING ("failed getting number of streams: %"
+        GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+    return NULL;
+  }
+
+  *nstreams = propertySize / sizeof (AudioStreamID);
+  streams = (AudioStreamID *) g_malloc (propertySize);
+
+  if (streams) {
+    status = AudioObjectGetPropertyData (device_id,
+        &streamsAddress, 0, NULL, &propertySize, streams);
+    if (status != noErr) {
+      GST_WARNING ("failed getting the list of streams: %"
+          GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+      g_free (streams);
+      *nstreams = 0;
+      return NULL;
+    }
+  }
+
+  return streams;
+}
+
+static inline guint
+_audio_stream_get_latency (AudioStreamID stream_id)
+{
+  OSStatus status = noErr;
+  UInt32 latency;
+  UInt32 propertySize = sizeof (latency);
+
+  AudioObjectPropertyAddress latencyAddress = {
+    kAudioStreamPropertyLatency,
+    kAudioObjectPropertyScopeGlobal,
+    kAudioObjectPropertyElementMaster
+  };
+
+  status = AudioObjectGetPropertyData (stream_id,
+      &latencyAddress, 0, NULL, &propertySize, &latency);
+  if (status != noErr) {
+    GST_ERROR ("failed to get latency: %" GST_FOURCC_FORMAT,
+        GST_FOURCC_ARGS (status));
+    latency = -1;
+  }
+
+  return latency;
+}
+
+static inline gboolean
+_audio_stream_get_current_format (AudioStreamID stream_id,
+    AudioStreamBasicDescription * format)
+{
+  OSStatus status = noErr;
+  UInt32 propertySize = sizeof (AudioStreamBasicDescription);
+
+  AudioObjectPropertyAddress formatAddress = {
+    kAudioStreamPropertyPhysicalFormat,
+    kAudioObjectPropertyScopeGlobal,
+    kAudioObjectPropertyElementMaster
+  };
+
+  status = AudioObjectGetPropertyData (stream_id,
+      &formatAddress, 0, NULL, &propertySize, format);
+  if (status != noErr) {
+    GST_ERROR ("failed to get current format: %" GST_FOURCC_FORMAT,
+        GST_FOURCC_ARGS (status));
+    return FALSE;
+  }
+
+  return TRUE;
+}
+
+static inline gboolean
+_audio_stream_set_current_format (AudioStreamID stream_id,
+    AudioStreamBasicDescription format)
+{
+  OSStatus status = noErr;
+  UInt32 propertySize = sizeof (AudioStreamBasicDescription);
+
+  AudioObjectPropertyAddress formatAddress = {
+    kAudioStreamPropertyPhysicalFormat,
+    kAudioObjectPropertyScopeGlobal,
+    kAudioObjectPropertyElementMaster
+  };
+
+  status = AudioObjectSetPropertyData (stream_id,
+      &formatAddress, 0, NULL, propertySize, &format);
+  if (status != noErr) {
+    GST_ERROR ("failed to set current format: %" GST_FOURCC_FORMAT,
+        GST_FOURCC_ARGS (status));
+    return FALSE;
+  }
+
+  return TRUE;
+}
+
+static inline AudioStreamRangedDescription *
+_audio_stream_get_formats (AudioStreamID stream_id, gint * nformats)
+{
+  OSStatus status = noErr;
+  UInt32 propertySize = 0;
+  AudioStreamRangedDescription *formats = NULL;
+
+  AudioObjectPropertyAddress formatsAddress = {
+    kAudioStreamPropertyAvailablePhysicalFormats,
+    kAudioObjectPropertyScopeGlobal,
+    kAudioObjectPropertyElementMaster
+  };
+
+  status = AudioObjectGetPropertyDataSize (stream_id,
+      &formatsAddress, 0, NULL, &propertySize);
+  if (status != noErr) {
+    GST_WARNING ("failed getting number of stream formats: %"
+        GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+    return NULL;
+  }
+
+  *nformats = propertySize / sizeof (AudioStreamRangedDescription);
+
+  formats = (AudioStreamRangedDescription *) g_malloc (propertySize);
+  if (formats) {
+    status = AudioObjectGetPropertyData (stream_id,
+        &formatsAddress, 0, NULL, &propertySize, formats);
+    if (status != noErr) {
+      GST_WARNING ("failed getting the list of stream formats: %"
+          GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+      g_free (formats);
+      *nformats = 0;
+      return NULL;
+    }
+  }
+  return formats;
+}
+
+static inline gboolean
+_audio_stream_is_spdif_avail (AudioStreamID stream_id)
+{
+  AudioStreamRangedDescription *formats;
+  gint i, nformats = 0;
+  gboolean res = FALSE;
+
+  formats = _audio_stream_get_formats (stream_id, &nformats);
+  GST_DEBUG ("found %d stream formats", nformats);
+
+  if (formats) {
+    GST_DEBUG ("formats supported on stream ID: %u", (unsigned) stream_id);
+
+    for (i = 0; i < nformats; i++) {
+      GST_DEBUG ("  " CORE_AUDIO_FORMAT,
+          CORE_AUDIO_FORMAT_ARGS (formats[i].mFormat));
+
+      if (CORE_AUDIO_FORMAT_IS_SPDIF (formats[i])) {
+        res = TRUE;
+      }
+    }
+    g_free (formats);
+  }
+
+  return res;
+}
+
+static OSStatus
+_audio_stream_format_listener (AudioObjectID inObjectID,
+    UInt32 inNumberAddresses,
+    const AudioObjectPropertyAddress inAddresses[], void *inClientData)
+{
+  OSStatus status = noErr;
+  guint i;
+  PropertyMutex *prop_mutex = inClientData;
+
+  for (i = 0; i < inNumberAddresses; i++) {
+    if (inAddresses[i].mSelector == kAudioStreamPropertyPhysicalFormat) {
+      g_mutex_lock (prop_mutex->lock);
+      g_cond_signal (prop_mutex->cond);
+      g_mutex_unlock (prop_mutex->lock);
+      break;
+    }
+  }
+  return (status);
+}
+
+static gboolean
+_audio_stream_change_format (AudioStreamID stream_id,
+    AudioStreamBasicDescription format)
+{
+  OSStatus status = noErr;
+  gint i;
+  gboolean ret = FALSE;
+  AudioStreamBasicDescription cformat;
+  PropertyMutex prop_mutex;
+
+  AudioObjectPropertyAddress formatAddress = {
+    kAudioStreamPropertyPhysicalFormat,
+    kAudioObjectPropertyScopeGlobal,
+    kAudioObjectPropertyElementMaster
+  };
+
+  GST_DEBUG ("setting stream format: " CORE_AUDIO_FORMAT,
+      CORE_AUDIO_FORMAT_ARGS (format));
+
+  /* Condition because SetProperty is asynchronous */
+  prop_mutex.lock = g_mutex_new ();
+  prop_mutex.cond = g_cond_new ();
+
+  g_mutex_lock (prop_mutex.lock);
+
+  /* Install the property listener to serialize the operations */
+  status = AudioObjectAddPropertyListener (stream_id, &formatAddress,
+      _audio_stream_format_listener, (void *) &prop_mutex);
+  if (status != noErr) {
+    GST_ERROR ("AudioObjectAddPropertyListener failed: %"
+        GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+    goto done;
+  }
+
+  /* Change the format */
+  if (!_audio_stream_set_current_format (stream_id, format)) {
+    goto done;
+  }
+
+  /* The AudioObjectSetProperty is not only asynchronous
+   * it is also not atomic in its behaviour.
+   * Therefore we check 4 times before we really give up. */
+  for (i = 0; i < 4; i++) {
+    GTimeVal timeout;
+
+    g_get_current_time (&timeout);
+    g_time_val_add (&timeout, 250000);
+
+    if (!g_cond_timed_wait (prop_mutex.cond, prop_mutex.lock, &timeout)) {
+      GST_LOG ("timeout...");
+    }
+
+    if (_audio_stream_get_current_format (stream_id, &cformat)) {
+      GST_DEBUG ("current stream format: " CORE_AUDIO_FORMAT,
+          CORE_AUDIO_FORMAT_ARGS (cformat));
+
+      if (cformat.mSampleRate == format.mSampleRate &&
+          cformat.mFormatID == format.mFormatID &&
+          cformat.mFramesPerPacket == format.mFramesPerPacket) {
+        /* The right format is now active */
+        break;
+      }
+    }
+  }
+
+  if (cformat.mSampleRate != format.mSampleRate ||
+      cformat.mFormatID != format.mFormatID ||
+      cformat.mFramesPerPacket != format.mFramesPerPacket) {
+    goto done;
+  }
+
+  ret = TRUE;
+
+done:
+  /* Removing the property listener */
+  status = AudioObjectRemovePropertyListener (stream_id,
+      &formatAddress, _audio_stream_format_listener, (void *) &prop_mutex);
+  if (status != noErr) {
+    GST_ERROR ("AudioObjectRemovePropertyListener failed: %"
+        GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+  }
+  /* Destroy the lock and condition */
+  g_mutex_unlock (prop_mutex.lock);
+  g_mutex_free (prop_mutex.lock);
+  g_cond_free (prop_mutex.cond);
+
+  return ret;
+}
+
+static OSStatus
+_audio_stream_hardware_changed_listener (AudioObjectID inObjectID,
+    UInt32 inNumberAddresses,
+    const AudioObjectPropertyAddress inAddresses[], void *inClientData)
+{
+  OSStatus status = noErr;
+  guint i;
+  GstCoreAudio *core_audio = inClientData;
+
+  for (i = 0; i < inNumberAddresses; i++) {
+    if (inAddresses[i].mSelector == kAudioDevicePropertyDeviceHasChanged) {
+      if (!gst_core_audio_audio_device_is_spdif_avail (core_audio->device_id)) {
+        GstOsxAudioSink *sink =
+            GST_OSX_AUDIO_SINK (GST_OBJECT_PARENT (core_audio->osxbuf));
+        GST_ELEMENT_ERROR (sink, RESOURCE, FAILED,
+            ("SPDIF output no longer available"),
+            ("Audio device is reporting that SPDIF output isn't available"));
+      }
+      break;
+    }
+  }
+  return (status);
+}
+
+static inline gboolean
+_monitorize_spdif (GstCoreAudio * core_audio)
+{
+  OSStatus status = noErr;
+  gboolean ret = TRUE;
+
+  AudioObjectPropertyAddress propAddress = {
+    kAudioDevicePropertyDeviceHasChanged,
+    kAudioObjectPropertyScopeGlobal,
+    kAudioObjectPropertyElementMaster
+  };
+
+  /* Install the property listener */
+  status = AudioObjectAddPropertyListener (core_audio->device_id,
+      &propAddress, _audio_stream_hardware_changed_listener,
+      (void *) core_audio);
+  if (status != noErr) {
+    GST_ERROR_OBJECT (core_audio->osxbuf,
+        "AudioObjectAddPropertyListener failed: %"
+        GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+    ret = FALSE;
+  }
+
+  return ret;
+}
+
+static inline gboolean
+_unmonitorize_spdif (GstCoreAudio * core_audio)
+{
+  OSStatus status = noErr;
+  gboolean ret = TRUE;
+
+  AudioObjectPropertyAddress propAddress = {
+    kAudioDevicePropertyDeviceHasChanged,
+    kAudioObjectPropertyScopeGlobal,
+    kAudioObjectPropertyElementMaster
+  };
+
+  /* Remove the property listener */
+  status = AudioObjectRemovePropertyListener (core_audio->device_id,
+      &propAddress, _audio_stream_hardware_changed_listener,
+      (void *) core_audio);
+  if (status != noErr) {
+    GST_ERROR_OBJECT (core_audio->osxbuf,
+        "AudioObjectRemovePropertyListener failed: %"
+        GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+    ret = FALSE;
+  }
+
+  return ret;
+}
+
+static inline gboolean
+_open_spdif (GstCoreAudio * core_audio)
+{
+  gboolean res = FALSE;
+  pid_t hog_pid, own_pid = getpid ();
+
+  /* We need the device in exclusive and disable the mixing */
+  hog_pid = _audio_device_get_hog (core_audio->device_id);
+
+  if (hog_pid != -1 && hog_pid != own_pid) {
+    GST_DEBUG_OBJECT (core_audio,
+        "device is currently in use by another application");
+    goto done;
+  }
+
+  if (_audio_device_set_hog (core_audio->device_id, own_pid)) {
+    core_audio->hog_pid = own_pid;
+  }
+
+  if (_audio_device_set_mixing (core_audio->device_id, FALSE)) {
+    GST_DEBUG_OBJECT (core_audio, "disabled mixing on the device");
+    core_audio->disabled_mixing = TRUE;
+  }
+
+  res = TRUE;
+done:
+  return res;
+}
+
+static inline gboolean
+_close_spdif (GstCoreAudio * core_audio)
+{
+  pid_t hog_pid;
+
+  _unmonitorize_spdif (core_audio);
+
+  if (core_audio->revert_format) {
+    if (!_audio_stream_change_format (core_audio->stream_id,
+            core_audio->original_format)) {
+      GST_WARNING_OBJECT (core_audio->osxbuf, "Format revert failed");
+    }
+    core_audio->revert_format = FALSE;
+  }
+
+  if (core_audio->disabled_mixing) {
+    _audio_device_set_mixing (core_audio->device_id, TRUE);
+    core_audio->disabled_mixing = FALSE;
+  }
+
+  if (core_audio->hog_pid != -1) {
+    hog_pid = _audio_device_get_hog (core_audio->device_id);
+    if (hog_pid == getpid ()) {
+      if (_audio_device_set_hog (core_audio->device_id, -1)) {
+        core_audio->hog_pid = -1;
+      }
+    }
+  }
+
+  return TRUE;
+}
+
+static OSStatus
+_io_proc_spdif (AudioDeviceID inDevice,
+    const AudioTimeStamp * inNow,
+    const void *inInputData,
+    const AudioTimeStamp * inTimestamp,
+    AudioBufferList * bufferList,
+    const AudioTimeStamp * inOutputTime, GstCoreAudio * core_audio)
+{
+  OSStatus status;
+
+  status = core_audio->element->io_proc (core_audio->osxbuf, NULL, inTimestamp,
+      0, 0, bufferList);
+
+  return status;
+}
+
+static inline gboolean
+_acquire_spdif (GstCoreAudio * core_audio, AudioStreamBasicDescription format)
+{
+  AudioStreamID *streams = NULL;
+  gint i, j, nstreams = 0;
+  gboolean ret = FALSE;
+
+  if (!_open_spdif (core_audio))
+    goto done;
+
+  streams = _audio_device_get_streams (core_audio->device_id, &nstreams);
+
+  for (i = 0; i < nstreams; i++) {
+    AudioStreamRangedDescription *formats = NULL;
+    gint nformats = 0;
+
+    formats = _audio_stream_get_formats (streams[i], &nformats);
+
+    if (formats) {
+      gboolean is_spdif = FALSE;
+
+      /* Check if one of the supported formats is a digital format */
+      for (j = 0; j < nformats; j++) {
+        if (CORE_AUDIO_FORMAT_IS_SPDIF (formats[j])) {
+          is_spdif = TRUE;
+          break;
+        }
+      }
+
+      if (is_spdif) {
+        /* if this stream supports a digital (cac3) format,
+         * then go set it. */
+        gint requested_rate_format = -1;
+        gint current_rate_format = -1;
+        gint backup_rate_format = -1;
+
+        core_audio->stream_id = streams[i];
+        core_audio->stream_idx = i;
+
+        if (!core_audio->revert_format) {
+          if (!_audio_stream_get_current_format (core_audio->stream_id,
+                  &core_audio->original_format)) {
+            GST_WARNING_OBJECT (core_audio->osxbuf,
+                "format could not be saved");
+            g_free (formats);
+            continue;
+          }
+          core_audio->revert_format = TRUE;
+        }
+
+        for (j = 0; j < nformats; j++) {
+          if (CORE_AUDIO_FORMAT_IS_SPDIF (formats[j])) {
+            GST_LOG_OBJECT (core_audio->osxbuf,
+                "found stream format: " CORE_AUDIO_FORMAT,
+                CORE_AUDIO_FORMAT_ARGS (formats[j].mFormat));
+
+            if (formats[j].mFormat.mSampleRate == format.mSampleRate) {
+              requested_rate_format = j;
+              break;
+            } else if (formats[j].mFormat.mSampleRate ==
+                core_audio->original_format.mSampleRate) {
+              current_rate_format = j;
+            } else {
+              if (backup_rate_format < 0 ||
+                  formats[j].mFormat.mSampleRate >
+                  formats[backup_rate_format].mFormat.mSampleRate) {
+                backup_rate_format = j;
+              }
+            }
+          }
+        }
+
+        if (requested_rate_format >= 0) {
+          /* We prefer to output at the rate of the original audio */
+          core_audio->stream_format = formats[requested_rate_format].mFormat;
+        } else if (current_rate_format >= 0) {
+          /* If not possible, we will try to use the current rate */
+          core_audio->stream_format = formats[current_rate_format].mFormat;
+        } else {
+          /* And if we have to, any digital format will be just
+           * fine (highest rate possible) */
+          core_audio->stream_format = formats[backup_rate_format].mFormat;
+        }
+      }
+      g_free (formats);
+    }
+  }
+  g_free (streams);
+
+  GST_DEBUG_OBJECT (core_audio,
+      "original stream format: " CORE_AUDIO_FORMAT,
+      CORE_AUDIO_FORMAT_ARGS (core_audio->original_format));
+
+  if (!_audio_stream_change_format (core_audio->stream_id,
+          core_audio->stream_format))
+    goto done;
+
+  ret = TRUE;
+
+done:
+  return ret;
+}
+
+static inline void
+_remove_render_spdif_callback (GstCoreAudio * core_audio)
+{
+  OSStatus status;
+
+  /* Deactivate the render callback by calling
+   * AudioDeviceDestroyIOProcID */
+  status =
+      AudioDeviceDestroyIOProcID (core_audio->device_id, core_audio->procID);
+  if (status != noErr) {
+    GST_ERROR_OBJECT (core_audio->osxbuf,
+        "AudioDeviceDestroyIOProcID failed: %"
+        GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+  }
+
+  GST_DEBUG_OBJECT (core_audio,
+      "osx ring buffer removed ioproc ID: %p device_id %lu",
+      core_audio->procID, (gulong) core_audio->device_id);
+
+  /* We're deactivated.. */
+  core_audio->procID = 0;
+  core_audio->io_proc_needs_deactivation = FALSE;
+  core_audio->io_proc_active = FALSE;
+}
+
+static inline gboolean
+_io_proc_spdif_start (GstCoreAudio * core_audio)
+{
+  OSErr status;
+
+  GST_DEBUG_OBJECT (core_audio,
+      "osx ring buffer start ioproc ID: %p device_id %lu",
+      core_audio->procID, (gulong) core_audio->device_id);
+
+  if (!core_audio->io_proc_active) {
+    /* Add IOProc callback */
+    status = AudioDeviceCreateIOProcID (core_audio->device_id,
+        (AudioDeviceIOProc) _io_proc_spdif,
+        (void *) core_audio, &core_audio->procID);
+    if (status != noErr) {
+      GST_ERROR_OBJECT (core_audio->osxbuf,
+          ":AudioDeviceCreateIOProcID failed: %"
+          GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+      return FALSE;
+    }
+    core_audio->io_proc_active = TRUE;
+  }
+
+  core_audio->io_proc_needs_deactivation = FALSE;
+
+  /* Start device */
+  status = AudioDeviceStart (core_audio->device_id, core_audio->procID);
+  if (status != noErr) {
+    GST_ERROR_OBJECT (core_audio->osxbuf,
+        "AudioDeviceStart failed: %" GST_FOURCC_FORMAT,
+        GST_FOURCC_ARGS (status));
+    return FALSE;
+  }
+  return TRUE;
+}
+
+static inline gboolean
+_io_proc_spdif_stop (GstCoreAudio * core_audio)
+{
+  OSErr status;
+
+  /* Stop device */
+  status = AudioDeviceStop (core_audio->device_id, core_audio->procID);
+  if (status != noErr) {
+    GST_ERROR_OBJECT (core_audio->osxbuf,
+        "AudioDeviceStop failed: %" GST_FOURCC_FORMAT,
+        GST_FOURCC_ARGS (status));
+  }
+
+  GST_DEBUG_OBJECT (core_audio,
+      "osx ring buffer stop ioproc ID: %p device_id %lu",
+      core_audio->procID, (gulong) core_audio->device_id);
+
+  if (core_audio->io_proc_active) {
+    _remove_render_spdif_callback (core_audio);
+  }
+
+  _close_spdif (core_audio);
+
+  return TRUE;
+}
+
+
+/***********************
+ *   Implementation    *
+ **********************/
+
+static gboolean
+gst_core_audio_open_impl (GstCoreAudio * core_audio)
+{
+  /* The following is needed to instruct HAL to create their own
+   * thread to handle the notifications. */
+  _audio_system_set_runloop (NULL);
+
+  /* Create a HALOutput AudioUnit.
+   * This is the lowest-level output API that is actually sensibly
+   * usable (the lower level ones require that you do
+   * channel-remapping yourself, and the CoreAudio channel mapping
+   * is sufficiently complex that doing so would be very difficult)
+   *
+   * Note that for input we request an output unit even though
+   * we will do input with it.
+   * http://developer.apple.com/technotes/tn2002/tn2091.html
+   */
+  return gst_core_audio_open_device (core_audio, kAudioUnitSubType_HALOutput,
+      "HALOutput");
+}
+
+static gboolean
+gst_core_audio_start_processing_impl (GstCoreAudio * core_audio)
+{
+  if (core_audio->is_passthrough) {
+    return _io_proc_spdif_start (core_audio);
+  } else {
+    return gst_core_audio_io_proc_start (core_audio);
+  }
+}
+
+static gboolean
+gst_core_audio_pause_processing_impl (GstCoreAudio * core_audio)
+{
+  if (core_audio->is_passthrough) {
+    GST_DEBUG_OBJECT (core_audio,
+        "osx ring buffer pause ioproc ID: %p device_id %lu",
+        core_audio->procID, (gulong) core_audio->device_id);
+
+    if (core_audio->io_proc_active) {
+      _remove_render_spdif_callback (core_audio);
+    }
+  } else {
+    GST_DEBUG_OBJECT (core_audio,
+        "osx ring buffer pause ioproc: %p device_id %lu",
+        core_audio->element->io_proc, (gulong) core_audio->device_id);
+    if (core_audio->io_proc_active) {
+      /* CoreAudio isn't threadsafe enough to do this here;
+       * we must deactivate the render callback elsewhere. See:
+       * http://lists.apple.com/archives/Coreaudio-api/2006/Mar/msg00010.html
+       */
+      core_audio->io_proc_needs_deactivation = TRUE;
+    }
+  }
+  return TRUE;
+}
+
+static gboolean
+gst_core_audio_stop_processing_impl (GstCoreAudio * core_audio)
+{
+  if (core_audio->is_passthrough) {
+    _io_proc_spdif_stop (core_audio);
+  } else {
+    gst_core_audio_io_proc_stop (core_audio);
+  }
+
+  return TRUE;
+}
+
+static gboolean
+gst_core_audio_get_samples_and_latency_impl (GstCoreAudio * core_audio,
+    gdouble rate, guint * samples, gdouble * latency)
+{
+  OSStatus status;
+  UInt32 size = sizeof (double);
+
+  if (core_audio->is_passthrough) {
+    *samples = _audio_device_get_latency (core_audio->device_id);
+    *samples += _audio_stream_get_latency (core_audio->stream_id);
+    *latency = (double) *samples / rate;
+  } else {
+    status = AudioUnitGetProperty (core_audio->audiounit, kAudioUnitProperty_Latency, kAudioUnitScope_Global, 0,        /* N/A for global */
+        latency, &size);
+
+    if (status) {
+      GST_WARNING_OBJECT (core_audio->osxbuf, "Failed to get latency: %"
+          GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+      *samples = 0;
+      return FALSE;
+    }
+
+    *samples = *latency * rate;
+  }
+  return TRUE;
+}
+
+static gboolean
+gst_core_audio_initialize_impl (GstCoreAudio * core_audio,
+    AudioStreamBasicDescription format, GstCaps * caps,
+    gboolean is_passthrough, guint32 * frame_size)
+{
+  gboolean ret = FALSE;
+
+  core_audio->is_passthrough = is_passthrough;
+  if (is_passthrough) {
+    if (!_acquire_spdif (core_audio, format))
+      goto done;
+    _monitorize_spdif (core_audio);
+  } else {
+    OSStatus status;
+    UInt32 propertySize;
+
+    core_audio->stream_idx = 0;
+    if (!gst_core_audio_set_format (core_audio, format))
+      goto done;
+
+    if (!gst_core_audio_set_channels_layout (core_audio,
+            format.mChannelsPerFrame, caps))
+      goto done;
+
+    if (!gst_core_audio_bind_device (core_audio))
+      goto done;
+
+    if (core_audio->is_src) {
+      propertySize = sizeof (*frame_size);
+      status = AudioUnitGetProperty (core_audio->audiounit, kAudioDevicePropertyBufferFrameSize, kAudioUnitScope_Global, 0,     /* N/A for global */
+          frame_size, &propertySize);
+
+      if (status) {
+        GST_WARNING_OBJECT (core_audio->osxbuf, "Failed to get frame size: %"
+            GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+        goto done;
+      }
+    }
+  }
+
+  ret = TRUE;
+
+done:
+  if (ret) {
+    GST_DEBUG_OBJECT (core_audio, "osxbuf ring buffer acquired");
+  }
+  return ret;
+}
+
+static gboolean
+gst_core_audio_select_device_impl (AudioDeviceID * device_id)
+{
+  AudioDeviceID *devices = NULL;
+  AudioDeviceID default_device_id = 0;
+  AudioChannelLayout *channel_layout;
+  gint i, ndevices = 0;
+  gboolean res = FALSE;
+
+  devices = _audio_system_get_devices (&ndevices);
+
+  if (ndevices < 1) {
+    GST_ERROR ("no audio output devices found");
+    goto done;
+  }
+
+  GST_DEBUG ("found %d audio device(s)", ndevices);
+
+  for (i = 0; i < ndevices; i++) {
+    gchar *device_name;
+
+    if ((device_name = _audio_device_get_name (devices[i]))) {
+      if (!_audio_device_has_output (devices[i])) {
+        GST_DEBUG ("Input Device ID: %u Name: %s",
+            (unsigned) devices[i], device_name);
+      } else {
+        GST_DEBUG ("Output Device ID: %u Name: %s",
+            (unsigned) devices[i], device_name);
+
+        channel_layout =
+            gst_core_audio_audio_device_get_channel_layout (devices[i]);
+        if (channel_layout) {
+          gst_core_audio_dump_channel_layout (channel_layout);
+          g_free (channel_layout);
+        }
+      }
+
+      g_free (device_name);
+    }
+  }
+
+  /* Find the ID of the default output device */
+  default_device_id = _audio_system_get_default_output ();
+
+  /* Here we decide if selected device is valid or autoselect
+   * the default one when required */
+  if (*device_id == kAudioDeviceUnknown) {
+    if (default_device_id != kAudioDeviceUnknown) {
+      *device_id = default_device_id;
+      res = TRUE;
+    }
+  } else {
+    for (i = 0; i < ndevices; i++) {
+      if (*device_id == devices[i]) {
+        res = TRUE;
+      }
+    }
+
+    if (res && !_audio_device_is_alive (*device_id)) {
+      GST_ERROR ("Requested device not usable");
+      res = FALSE;
+      goto done;
+    }
+  }
+
+done:
+  g_free (devices);
+  return res;
+}
+
+static gboolean
+gst_core_audio_audio_device_is_spdif_avail_impl (AudioDeviceID device_id)
+{
+  AudioStreamID *streams = NULL;
+  gint i, nstreams = 0;
+  gboolean res = FALSE;
+
+  streams = _audio_device_get_streams (device_id, &nstreams);
+  GST_DEBUG ("found %d streams", nstreams);
+  if (streams) {
+    for (i = 0; i < nstreams; i++) {
+      if (_audio_stream_is_spdif_avail (streams[i])) {
+        res = TRUE;
+      }
+    }
+
+    g_free (streams);
+  }
+
+  return res;
+}
+
+static gboolean
+gst_core_audio_select_source_device_impl (AudioDeviceID * device_id)
+{
+  OSStatus status;
+  UInt32 propertySize;
+
+  if (*device_id == kAudioDeviceUnknown) {
+    /* If no specific device has been selected by the user, then pick the
+     * default device */
+    GST_DEBUG ("Selecting device for OSXAudioSrc");
+    propertySize = sizeof (*device_id);
+    status = AudioHardwareGetProperty (kAudioHardwarePropertyDefaultInputDevice,
+        &propertySize, device_id);
+
+    if (status) {
+      GST_WARNING ("AudioHardwareGetProperty returned %d", (int) status);
+    } else {
+      GST_DEBUG ("AudioHardwareGetProperty returned 0");
+    }
+
+    if (*device_id == kAudioDeviceUnknown) {
+      GST_WARNING ("AudioHardwareGetProperty: device_id is "
+          "kAudioDeviceUnknown");
+    }
+
+    GST_DEBUG ("AudioHardwareGetProperty: device_id is %lu", (long) *device_id);
+  }
+
+  return TRUE;
+}
diff --git a/sys/osxaudio/gstosxcoreaudioremoteio.c b/sys/osxaudio/gstosxcoreaudioremoteio.c
new file mode 100644
index 0000000..076bd11
--- /dev/null
+++ b/sys/osxaudio/gstosxcoreaudioremoteio.c
@@ -0,0 +1,127 @@
+/*
+ * GStreamer
+ * Copyright (C) 2012 Fluendo S.A. <support@fluendo.com>
+ *   Authors: Andoni Morales Alastruey <amorales@fluendo.com>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ *
+ */
+
+#import <AudioUnit/AUComponent.h>
+
+static gboolean
+gst_core_audio_open_impl (GstCoreAudio * core_audio)
+{
+  return gst_core_audio_open_device (core_audio, kAudioUnitSubType_RemoteIO,
+      "RemoteIO");
+}
+
+static gboolean
+gst_core_audio_start_processing_impl (GstCoreAudio * core_audio)
+{
+  return gst_core_audio_io_proc_start (core_audio);
+}
+
+static gboolean
+gst_core_audio_pause_processing_impl (GstCoreAudio * core_audio)
+{
+  GST_DEBUG_OBJECT (core_audio,
+      "osx ring buffer pause ioproc: %p device_id %lu",
+      core_audio->element->io_proc, (gulong) core_audio->device_id);
+
+  if (core_audio->io_proc_active) {
+    /* CoreAudio isn't threadsafe enough to do this here;
+     * we must deactivate the render callback elsewhere. See:
+     * http://lists.apple.com/archives/Coreaudio-api/2006/Mar/msg00010.html
+     */
+    core_audio->io_proc_needs_deactivation = TRUE;
+  }
+  return TRUE;
+}
+
+static gboolean
+gst_core_audio_stop_processing_impl (GstCoreAudio * core_audio)
+{
+  gst_core_audio_io_proc_stop (core_audio);
+  return TRUE;
+}
+
+static gboolean
+gst_core_audio_get_samples_and_latency_impl (GstCoreAudio * core_audio,
+    gdouble rate, guint * samples, gdouble * latency)
+{
+  OSStatus status;
+  UInt32 size;
+
+  status = AudioUnitGetProperty (core_audio->audiounit, kAudioUnitProperty_Latency, kAudioUnitScope_Global, 0,  /* N/A for global */
+      latency, &size);
+
+  if (status) {
+    GST_WARNING_OBJECT (core_audio, "Failed to get latency: %"
+        GST_FOURCC_FORMAT, GST_FOURCC_ARGS (status));
+    *samples = 0;
+    return FALSE;
+  }
+
+  *samples = *latency * rate;
+  return TRUE;
+}
+
+static gboolean
+gst_core_audio_initialize_impl (GstCoreAudio * core_audio,
+    AudioStreamBasicDescription format, GstCaps * caps,
+    gboolean is_passthrough, guint32 * frame_size)
+{
+  core_audio->is_passthrough = is_passthrough;
+  core_audio->stream_idx = 0;
+  if (!gst_core_audio_set_format (core_audio, format))
+    return FALSE;
+
+  /* FIXME: Use kAudioSessionProperty_CurrentHardwareSampleRate and
+   * kAudioSessionProperty_CurrentHardwareIOBufferDuration with property
+   * listeners to detect changes in screen locks.
+   * For now use the maximum value */
+  *frame_size = 4196;
+
+  GST_DEBUG_OBJECT (core_audio, "osxbuf ring buffer acquired");
+  return TRUE;
+}
+
+AudioChannelLayout *
+gst_core_audio_audio_device_get_channel_layout (AudioDeviceID device_id)
+{
+  return NULL;
+}
+
+static gboolean
+gst_core_audio_select_device_impl (AudioDeviceID * device_id)
+{
+  /* No device selection in iOS */
+  return TRUE;
+}
+
+static gboolean
+gst_core_audio_select_source_device_impl (AudioDeviceID * device_id)
+{
+  return TRUE;
+}
+
+static gboolean
+gst_core_audio_audio_device_is_spdif_avail_impl (AudioDeviceID device_id)
+{
+  /* No SPDIF in iOS */
+  return FALSE;
+}
diff --git a/sys/osxaudio/gstosxringbuffer.c b/sys/osxaudio/gstosxringbuffer.c
index 095efc1..82da799 100644
--- a/sys/osxaudio/gstosxringbuffer.c
+++ b/sys/osxaudio/gstosxringbuffer.c
@@ -2,6 +2,7 @@
  * GStreamer
  * Copyright (C) 2006 Zaheer Abbas Merali <zaheerabbas at merali dot org>
  * Copyright (C) 2008 Pioneers of the Inevitable <songbird@songbirdnest.com>
+ * Copyright (C) 2012 Fluendo S.A. <support@fluendo.com>
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
@@ -42,17 +43,23 @@
  * Boston, MA 02111-1307, USA.
  */
 
-#include <CoreAudio/CoreAudio.h>
-#include <CoreServices/CoreServices.h>
+#ifdef HAVE_CONFIG_H
+#  include <config.h>
+#endif
+
 #include <gst/gst.h>
 #include <gst/audio/multichannel.h>
 #include "gstosxringbuffer.h"
 #include "gstosxaudiosink.h"
 #include "gstosxaudiosrc.h"
 
+#include <unistd.h>             /* for getpid() */
+
 GST_DEBUG_CATEGORY_STATIC (osx_audio_debug);
 #define GST_CAT_DEFAULT osx_audio_debug
 
+#include "gstosxcoreaudio.h"
+
 static void gst_osx_ring_buffer_dispose (GObject * object);
 static void gst_osx_ring_buffer_finalize (GObject * object);
 static gboolean gst_osx_ring_buffer_open_device (GstRingBuffer * buf);
@@ -68,14 +75,6 @@ static gboolean gst_osx_ring_buffer_stop (GstRingBuffer * buf);
 static guint gst_osx_ring_buffer_delay (GstRingBuffer * buf);
 static GstRingBufferClass *ring_parent_class = NULL;
 
-static OSStatus gst_osx_ring_buffer_render_notify (GstOsxRingBuffer * osxbuf,
-    AudioUnitRenderActionFlags * ioActionFlags,
-    const AudioTimeStamp * inTimeStamp, unsigned int inBusNumber,
-    unsigned int inNumberFrames, AudioBufferList * ioData);
-
-static AudioBufferList *buffer_list_alloc (int channels, int size);
-static void buffer_list_free (AudioBufferList * list);
-
 static void
 gst_osx_ring_buffer_do_init (GType type)
 {
@@ -83,8 +82,8 @@ gst_osx_ring_buffer_do_init (GType type)
       "OSX Audio Elements");
 }
 
-GST_BOILERPLATE_FULL (GstOsxRingBuffer, gst_osx_ring_buffer, GstRingBuffer,
-    GST_TYPE_RING_BUFFER, gst_osx_ring_buffer_do_init);
+GST_BOILERPLATE_FULL (GstOsxRingBuffer, gst_osx_ring_buffer,
+    GstRingBuffer, GST_TYPE_RING_BUFFER, gst_osx_ring_buffer_do_init);
 
 static void
 gst_osx_ring_buffer_base_init (gpointer g_class)
@@ -130,12 +129,20 @@ static void
 gst_osx_ring_buffer_init (GstOsxRingBuffer * ringbuffer,
     GstOsxRingBufferClass * g_class)
 {
-  /* Nothing to do right now */
+  ringbuffer->core_audio = gst_core_audio_new (GST_OBJECT (ringbuffer));
 }
 
 static void
 gst_osx_ring_buffer_dispose (GObject * object)
 {
+  GstOsxRingBuffer *osxbuf;
+
+  osxbuf = GST_OSX_RING_BUFFER (object);
+
+  if (osxbuf->core_audio) {
+    g_object_unref (osxbuf->core_audio);
+    osxbuf->core_audio = NULL;
+  }
   G_OBJECT_CLASS (ring_parent_class)->dispose (object);
 }
 
@@ -145,128 +152,14 @@ gst_osx_ring_buffer_finalize (GObject * object)
   G_OBJECT_CLASS (ring_parent_class)->finalize (object);
 }
 
-static AudioUnit
-gst_osx_ring_buffer_create_audio_unit (GstOsxRingBuffer * osxbuf,
-    gboolean input, AudioDeviceID device_id)
-{
-  ComponentDescription desc;
-  Component comp;
-  OSStatus status;
-  AudioUnit unit;
-  UInt32 enableIO;
-
-  /* Create a HALOutput AudioUnit.
-   * This is the lowest-level output API that is actually sensibly usable
-   * (the lower level ones require that you do channel-remapping yourself,
-   * and the CoreAudio channel mapping is sufficiently complex that doing
-   * so would be very difficult)
-   *
-   * Note that for input we request an output unit even though we will do
-   * input with it: http://developer.apple.com/technotes/tn2002/tn2091.html
-   */
-  desc.componentType = kAudioUnitType_Output;
-  desc.componentSubType = kAudioUnitSubType_HALOutput;
-  desc.componentManufacturer = kAudioUnitManufacturer_Apple;
-  desc.componentFlags = 0;
-  desc.componentFlagsMask = 0;
-
-  comp = FindNextComponent (NULL, &desc);
-  if (comp == NULL) {
-    GST_WARNING_OBJECT (osxbuf, "Couldn't find HALOutput component");
-    return NULL;
-  }
-
-  status = OpenAComponent (comp, &unit);
-
-  if (status) {
-    GST_WARNING_OBJECT (osxbuf, "Couldn't open HALOutput component");
-    return NULL;
-  }
-
-  if (input) {
-    /* enable input */
-    enableIO = 1;
-    status = AudioUnitSetProperty (unit, kAudioOutputUnitProperty_EnableIO, kAudioUnitScope_Input, 1,   /* 1 = input element */
-        &enableIO, sizeof (enableIO));
-
-    if (status) {
-      CloseComponent (unit);
-      GST_WARNING_OBJECT (osxbuf, "Failed to enable input: %lx",
-          (gulong) status);
-      return NULL;
-    }
-
-    /* disable output */
-    enableIO = 0;
-    status = AudioUnitSetProperty (unit, kAudioOutputUnitProperty_EnableIO, kAudioUnitScope_Output, 0,  /* 0 = output element */
-        &enableIO, sizeof (enableIO));
-
-    if (status) {
-      CloseComponent (unit);
-      GST_WARNING_OBJECT (osxbuf, "Failed to disable output: %lx",
-          (gulong) status);
-      return NULL;
-    }
-  }
-
-  /* Specify which device we're using. */
-  GST_DEBUG_OBJECT (osxbuf, "Setting device to %d", (int) device_id);
-  status = AudioUnitSetProperty (unit, kAudioOutputUnitProperty_CurrentDevice, kAudioUnitScope_Global, 0,       /* N/A for global */
-      &device_id, sizeof (AudioDeviceID));
-
-  if (status) {
-    CloseComponent (unit);
-    GST_WARNING_OBJECT (osxbuf, "Failed to set device: %lx", (gulong) status);
-    return NULL;
-  }
-
-  GST_DEBUG_OBJECT (osxbuf, "Create HALOutput AudioUnit: %p", unit);
-
-  return unit;
-}
-
 static gboolean
 gst_osx_ring_buffer_open_device (GstRingBuffer * buf)
 {
   GstOsxRingBuffer *osxbuf;
-  GstOsxAudioSink *sink;
-  GstOsxAudioSrc *src;
-  AudioStreamBasicDescription asbd_in;
-  OSStatus status;
-  UInt32 propertySize;
 
   osxbuf = GST_OSX_RING_BUFFER (buf);
-  sink = NULL;
-  src = NULL;
-
-  osxbuf->audiounit = gst_osx_ring_buffer_create_audio_unit (osxbuf,
-      osxbuf->is_src, osxbuf->device_id);
-
-  if (osxbuf->is_src) {
-    src = GST_OSX_AUDIO_SRC (GST_OBJECT_PARENT (buf));
-
-    propertySize = sizeof (asbd_in);
-    status = AudioUnitGetProperty (osxbuf->audiounit,
-        kAudioUnitProperty_StreamFormat,
-        kAudioUnitScope_Input, 1, &asbd_in, &propertySize);
-
-    if (status) {
-      CloseComponent (osxbuf->audiounit);
-      osxbuf->audiounit = NULL;
-      GST_WARNING_OBJECT (osxbuf, "Unable to obtain device properties: %lx",
-          (gulong) status);
-      return FALSE;
-    }
-
-    src->deviceChannels = asbd_in.mChannelsPerFrame;
-  } else {
-    sink = GST_OSX_AUDIO_SINK (GST_OBJECT_PARENT (buf));
 
-    /* needed for the sink's volume control */
-    sink->audiounit = osxbuf->audiounit;
-  }
-
-  return TRUE;
+  return gst_core_audio_open (osxbuf->core_audio);
 }
 
 static gboolean
@@ -275,194 +168,82 @@ gst_osx_ring_buffer_close_device (GstRingBuffer * buf)
   GstOsxRingBuffer *osxbuf;
   osxbuf = GST_OSX_RING_BUFFER (buf);
 
-  CloseComponent (osxbuf->audiounit);
-  osxbuf->audiounit = NULL;
-
-  return TRUE;
-}
-
-static AudioChannelLabel
-gst_audio_channel_position_to_coreaudio_channel_label (GstAudioChannelPosition
-    position, int channel)
-{
-  switch (position) {
-    case GST_AUDIO_CHANNEL_POSITION_NONE:
-      return kAudioChannelLabel_Discrete_0 | channel;
-    case GST_AUDIO_CHANNEL_POSITION_FRONT_MONO:
-      return kAudioChannelLabel_Mono;
-    case GST_AUDIO_CHANNEL_POSITION_FRONT_LEFT:
-      return kAudioChannelLabel_Left;
-    case GST_AUDIO_CHANNEL_POSITION_FRONT_RIGHT:
-      return kAudioChannelLabel_Right;
-    case GST_AUDIO_CHANNEL_POSITION_REAR_CENTER:
-      return kAudioChannelLabel_CenterSurround;
-    case GST_AUDIO_CHANNEL_POSITION_REAR_LEFT:
-      return kAudioChannelLabel_LeftSurround;
-    case GST_AUDIO_CHANNEL_POSITION_REAR_RIGHT:
-      return kAudioChannelLabel_RightSurround;
-    case GST_AUDIO_CHANNEL_POSITION_LFE:
-      return kAudioChannelLabel_LFEScreen;
-    case GST_AUDIO_CHANNEL_POSITION_FRONT_CENTER:
-      return kAudioChannelLabel_Center;
-    case GST_AUDIO_CHANNEL_POSITION_FRONT_LEFT_OF_CENTER:
-      return kAudioChannelLabel_Center; // ???
-    case GST_AUDIO_CHANNEL_POSITION_FRONT_RIGHT_OF_CENTER:
-      return kAudioChannelLabel_Center; // ???
-    case GST_AUDIO_CHANNEL_POSITION_SIDE_LEFT:
-      return kAudioChannelLabel_LeftSurroundDirect;
-    case GST_AUDIO_CHANNEL_POSITION_SIDE_RIGHT:
-      return kAudioChannelLabel_RightSurroundDirect;
-    default:
-      return kAudioChannelLabel_Unknown;
-  }
+  return gst_core_audio_close (osxbuf->core_audio);
 }
 
 static gboolean
 gst_osx_ring_buffer_acquire (GstRingBuffer * buf, GstRingBufferSpec * spec)
 {
-  /* Configure the output stream and allocate ringbuffer memory */
+  gboolean ret = FALSE, is_passthrough = FALSE;
   GstOsxRingBuffer *osxbuf;
   AudioStreamBasicDescription format;
-  AudioChannelLayout *layout = NULL;
-  OSStatus status;
-  UInt32 propertySize;
-  int layoutSize;
-  int element;
-  int i;
-  AudioUnitScope scope;
-  gboolean ret = FALSE;
-  GstStructure *structure;
-  GstAudioChannelPosition *positions;
-  UInt32 frameSize;
 
   osxbuf = GST_OSX_RING_BUFFER (buf);
 
-  /* Fill out the audio description we're going to be using */
-  format.mFormatID = kAudioFormatLinearPCM;
-  format.mSampleRate = (double) spec->rate;
-  format.mChannelsPerFrame = spec->channels;
-  format.mFormatFlags = kAudioFormatFlagsNativeFloatPacked;
-  format.mBytesPerFrame = spec->channels * sizeof (float);
-  format.mBitsPerChannel = sizeof (float) * 8;
-  format.mBytesPerPacket = spec->channels * sizeof (float);
-  format.mFramesPerPacket = 1;
-  format.mReserved = 0;
-
-  /* Describe channels */
-  layoutSize = sizeof (AudioChannelLayout) +
-      spec->channels * sizeof (AudioChannelDescription);
-  layout = g_malloc (layoutSize);
-
-  structure = gst_caps_get_structure (spec->caps, 0);
-  positions = gst_audio_get_channel_positions (structure);
-
-  layout->mChannelLayoutTag = kAudioChannelLayoutTag_UseChannelDescriptions;
-  layout->mChannelBitmap = 0;   /* Not used */
-  layout->mNumberChannelDescriptions = spec->channels;
-  for (i = 0; i < spec->channels; i++) {
-    if (positions) {
-      layout->mChannelDescriptions[i].mChannelLabel =
-          gst_audio_channel_position_to_coreaudio_channel_label (positions[i],
-          i);
+  if (RINGBUFFER_IS_SPDIF (spec->type)) {
+    format.mFormatID = kAudioFormat60958AC3;
+    format.mSampleRate = (double) spec->rate;
+    format.mChannelsPerFrame = 2;
+    format.mFormatFlags = kAudioFormatFlagIsSignedInteger |
+        kAudioFormatFlagIsPacked | kAudioFormatFlagIsNonMixable;
+    format.mBytesPerFrame = 0;
+    format.mBitsPerChannel = 16;
+    format.mBytesPerPacket = 6144;
+    format.mFramesPerPacket = 1536;
+    format.mReserved = 0;
+    spec->segsize = 6144;
+    spec->segtotal = 10;
+    is_passthrough = TRUE;
+  } else {
+    int width, depth;
+    /* Fill out the audio description we're going to be using */
+    format.mFormatID = kAudioFormatLinearPCM;
+    format.mSampleRate = (double) spec->rate;
+    format.mChannelsPerFrame = spec->channels;
+    if (spec->type == GST_BUFTYPE_FLOAT) {
+      format.mFormatFlags = kAudioFormatFlagsNativeFloatPacked;
+      width = depth = spec->width;
     } else {
-      /* Discrete channel numbers are ORed into this */
-      layout->mChannelDescriptions[i].mChannelLabel =
-          kAudioChannelLabel_Discrete_0 | i;
+      format.mFormatFlags = kAudioFormatFlagIsSignedInteger;
+      width = spec->width;
+      depth = spec->depth;
+      if (width == depth) {
+        format.mFormatFlags |= kAudioFormatFlagIsPacked;
+      } else {
+        format.mFormatFlags |= kAudioFormatFlagIsAlignedHigh;
+      }
+      if (spec->bigend) {
+        format.mFormatFlags |= kAudioFormatFlagIsBigEndian;
+      }
     }
-
-    /* Others unused */
-    layout->mChannelDescriptions[i].mChannelFlags = 0;
-    layout->mChannelDescriptions[i].mCoordinates[0] = 0.f;
-    layout->mChannelDescriptions[i].mCoordinates[1] = 0.f;
-    layout->mChannelDescriptions[i].mCoordinates[2] = 0.f;
+    format.mBytesPerFrame = spec->channels * (width >> 3);
+    format.mBitsPerChannel = depth;
+    format.mBytesPerPacket = spec->channels * (width >> 3);
+    format.mFramesPerPacket = 1;
+    format.mReserved = 0;
+    spec->segsize =
+        (spec->latency_time * spec->rate / G_USEC_PER_SEC) *
+        spec->bytes_per_sample;
+    spec->segtotal = spec->buffer_time / spec->latency_time;
+    is_passthrough = FALSE;
   }
 
-  if (positions) {
-    g_free (positions);
-    positions = NULL;
-  }
-
-  GST_LOG_OBJECT (osxbuf, "Format: %x, %f, %u, %x, %d, %d, %d, %d, %d",
-      (unsigned int) format.mFormatID,
-      format.mSampleRate,
-      (unsigned int) format.mChannelsPerFrame,
-      (unsigned int) format.mFormatFlags,
-      (unsigned int) format.mBytesPerFrame,
-      (unsigned int) format.mBitsPerChannel,
-      (unsigned int) format.mBytesPerPacket,
-      (unsigned int) format.mFramesPerPacket, (unsigned int) format.mReserved);
-
-  GST_DEBUG_OBJECT (osxbuf, "Setting format for AudioUnit");
-
-  scope = osxbuf->is_src ? kAudioUnitScope_Output : kAudioUnitScope_Input;
-  element = osxbuf->is_src ? 1 : 0;
-
-  propertySize = sizeof (format);
-  status = AudioUnitSetProperty (osxbuf->audiounit,
-      kAudioUnitProperty_StreamFormat, scope, element, &format, propertySize);
-
-  if (status) {
-    GST_WARNING_OBJECT (osxbuf, "Failed to set audio description: %lx",
-        (gulong) status);
-    goto done;
-  }
-
-  status = AudioUnitSetProperty (osxbuf->audiounit,
-      kAudioUnitProperty_AudioChannelLayout,
-      scope, element, layout, layoutSize);
-  if (status) {
-    GST_WARNING_OBJECT (osxbuf, "Failed to set output channel layout: %lx",
-        (gulong) status);
-    goto done;
-  }
-
-  spec->segsize =
-      (spec->latency_time * spec->rate / G_USEC_PER_SEC) *
-      spec->bytes_per_sample;
-  spec->segtotal = spec->buffer_time / spec->latency_time;
-
-  /* create AudioBufferList needed for recording */
-  if (osxbuf->is_src) {
-    propertySize = sizeof (frameSize);
-    status = AudioUnitGetProperty (osxbuf->audiounit, kAudioDevicePropertyBufferFrameSize, kAudioUnitScope_Global, 0,   /* N/A for global */
-        &frameSize, &propertySize);
-
-    if (status) {
-      GST_WARNING_OBJECT (osxbuf, "Failed to get frame size: %lx",
-          (gulong) status);
-      goto done;
-    }
-
-    osxbuf->recBufferList = buffer_list_alloc (format.mChannelsPerFrame,
-        frameSize * format.mBytesPerFrame);
-  }
+  GST_DEBUG_OBJECT (osxbuf, "Format: " CORE_AUDIO_FORMAT,
+      CORE_AUDIO_FORMAT_ARGS (format));
 
   buf->data = gst_buffer_new_and_alloc (spec->segtotal * spec->segsize);
   memset (GST_BUFFER_DATA (buf->data), 0, GST_BUFFER_SIZE (buf->data));
 
-  osxbuf->segoffset = 0;
+  ret = gst_core_audio_initialize (osxbuf->core_audio, format, spec->caps,
+      is_passthrough);
 
-  status = AudioUnitInitialize (osxbuf->audiounit);
-  if (status) {
+  if (!ret) {
     gst_buffer_unref (buf->data);
     buf->data = NULL;
-
-    if (osxbuf->recBufferList) {
-      buffer_list_free (osxbuf->recBufferList);
-      osxbuf->recBufferList = NULL;
-    }
-
-    GST_WARNING_OBJECT (osxbuf,
-        "Failed to initialise AudioUnit: %d", (int) status);
-    goto done;
   }
 
-  GST_DEBUG_OBJECT (osxbuf, "osx ring buffer acquired");
-
-  ret = TRUE;
+  osxbuf->segoffset = 0;
 
-done:
-  g_free (layout);
   return ret;
 }
 
@@ -473,217 +254,59 @@ gst_osx_ring_buffer_release (GstRingBuffer * buf)
 
   osxbuf = GST_OSX_RING_BUFFER (buf);
 
-  AudioUnitUninitialize (osxbuf->audiounit);
+  gst_core_audio_unitialize (osxbuf->core_audio);
 
   gst_buffer_unref (buf->data);
   buf->data = NULL;
 
-  if (osxbuf->recBufferList) {
-    buffer_list_free (osxbuf->recBufferList);
-    osxbuf->recBufferList = NULL;
-  }
-
   return TRUE;
 }
 
-static void
-gst_osx_ring_buffer_remove_render_callback (GstOsxRingBuffer * osxbuf)
-{
-  AURenderCallbackStruct input;
-  OSStatus status;
-
-  /* Deactivate the render callback by calling SetRenderCallback with a NULL
-   * inputProc.
-   */
-  input.inputProc = NULL;
-  input.inputProcRefCon = NULL;
-
-  status = AudioUnitSetProperty (osxbuf->audiounit, kAudioUnitProperty_SetRenderCallback, kAudioUnitScope_Global, 0,    /* N/A for global */
-      &input, sizeof (input));
-
-  if (status) {
-    GST_WARNING_OBJECT (osxbuf, "Failed to remove render callback");
-  }
-
-  /* Remove the RenderNotify too */
-  status = AudioUnitRemoveRenderNotify (osxbuf->audiounit,
-      (AURenderCallback) gst_osx_ring_buffer_render_notify, osxbuf);
-
-  if (status) {
-    GST_WARNING_OBJECT (osxbuf, "Failed to remove render notify callback");
-  }
-
-  /* We're deactivated.. */
-  osxbuf->io_proc_needs_deactivation = FALSE;
-  osxbuf->io_proc_active = FALSE;
-}
-
-static OSStatus
-gst_osx_ring_buffer_render_notify (GstOsxRingBuffer * osxbuf,
-    AudioUnitRenderActionFlags * ioActionFlags,
-    const AudioTimeStamp * inTimeStamp,
-    unsigned int inBusNumber,
-    unsigned int inNumberFrames, AudioBufferList * ioData)
-{
-  /* Before rendering a frame, we get the PreRender notification.
-   * Here, we detach the RenderCallback if we've been paused.
-   *
-   * This is necessary (rather than just directly detaching it) to work
-   * around some thread-safety issues in CoreAudio
-   */
-  if ((*ioActionFlags) & kAudioUnitRenderAction_PreRender) {
-    if (osxbuf->io_proc_needs_deactivation) {
-      gst_osx_ring_buffer_remove_render_callback (osxbuf);
-    }
-  }
-
-  return noErr;
-}
-
 static gboolean
 gst_osx_ring_buffer_start (GstRingBuffer * buf)
 {
-  OSStatus status;
   GstOsxRingBuffer *osxbuf;
-  AURenderCallbackStruct input;
-  AudioUnitPropertyID callback_type;
 
   osxbuf = GST_OSX_RING_BUFFER (buf);
 
-  GST_DEBUG ("osx ring buffer start ioproc: 0x%p device_id %lu",
-      osxbuf->element->io_proc, (gulong) osxbuf->device_id);
-  if (!osxbuf->io_proc_active) {
-    callback_type = osxbuf->is_src ?
-        kAudioOutputUnitProperty_SetInputCallback :
-        kAudioUnitProperty_SetRenderCallback;
-
-    input.inputProc = (AURenderCallback) osxbuf->element->io_proc;
-    input.inputProcRefCon = osxbuf;
-
-    status = AudioUnitSetProperty (osxbuf->audiounit, callback_type, kAudioUnitScope_Global, 0, /* N/A for global */
-        &input, sizeof (input));
-
-    if (status) {
-      GST_WARNING ("AudioUnitSetProperty returned %d", (int) status);
-      return FALSE;
-    }
-    // ### does it make sense to do this notify stuff for input mode?
-    status = AudioUnitAddRenderNotify (osxbuf->audiounit,
-        (AURenderCallback) gst_osx_ring_buffer_render_notify, osxbuf);
-
-    if (status) {
-      GST_WARNING ("AudioUnitAddRenderNotify returned %d", (int) status);
-      return FALSE;
-    }
-
-    osxbuf->io_proc_active = TRUE;
-  }
-
-  osxbuf->io_proc_needs_deactivation = FALSE;
-
-  status = AudioOutputUnitStart (osxbuf->audiounit);
-  if (status) {
-    GST_WARNING ("AudioOutputUnitStart returned %d", (int) status);
-    return FALSE;
-  }
-  return TRUE;
+  return gst_core_audio_start_processing (osxbuf->core_audio);
 }
 
-// ###
 static gboolean
 gst_osx_ring_buffer_pause (GstRingBuffer * buf)
 {
   GstOsxRingBuffer *osxbuf = GST_OSX_RING_BUFFER (buf);
 
-  GST_DEBUG ("osx ring buffer pause ioproc: 0x%p device_id %lu",
-      osxbuf->element->io_proc, (gulong) osxbuf->device_id);
-  if (osxbuf->io_proc_active) {
-    /* CoreAudio isn't threadsafe enough to do this here; we must deactivate
-     * the render callback elsewhere. See:
-     *   http://lists.apple.com/archives/Coreaudio-api/2006/Mar/msg00010.html
-     */
-    osxbuf->io_proc_needs_deactivation = TRUE;
-  }
-  return TRUE;
+  return gst_core_audio_pause_processing (osxbuf->core_audio);
 }
 
-// ###
+
 static gboolean
 gst_osx_ring_buffer_stop (GstRingBuffer * buf)
 {
-  OSErr status;
   GstOsxRingBuffer *osxbuf;
 
   osxbuf = GST_OSX_RING_BUFFER (buf);
 
-  GST_DEBUG ("osx ring buffer stop ioproc: 0x%p device_id %lu",
-      osxbuf->element->io_proc, (gulong) osxbuf->device_id);
+  gst_core_audio_stop_processing (osxbuf->core_audio);
 
-  status = AudioOutputUnitStop (osxbuf->audiounit);
-  if (status)
-    GST_WARNING ("AudioOutputUnitStop returned %d", (int) status);
-
-  // ###: why is it okay to directly remove from here but not from pause() ?
-  if (osxbuf->io_proc_active) {
-    gst_osx_ring_buffer_remove_render_callback (osxbuf);
-  }
   return TRUE;
 }
 
 static guint
 gst_osx_ring_buffer_delay (GstRingBuffer * buf)
 {
-  double latency;
-  UInt32 size = sizeof (double);
   GstOsxRingBuffer *osxbuf;
-  OSStatus status;
+  double latency;
   guint samples;
 
   osxbuf = GST_OSX_RING_BUFFER (buf);
 
-  status = AudioUnitGetProperty (osxbuf->audiounit, kAudioUnitProperty_Latency, kAudioUnitScope_Global, 0,      /* N/A for global */
-      &latency, &size);
-
-  if (status) {
-    GST_WARNING_OBJECT (buf, "Failed to get latency: %d", (int) status);
+  if (!gst_core_audio_get_samples_and_latency (osxbuf->core_audio,
+          GST_RING_BUFFER (buf)->spec.rate, &samples, &latency)) {
     return 0;
   }
-
-  samples = latency * GST_RING_BUFFER (buf)->spec.rate;
-  GST_DEBUG_OBJECT (buf, "Got latency: %f seconds -> %d samples", latency,
-      samples);
+  GST_DEBUG_OBJECT (buf, "Got latency: %f seconds -> %d samples",
+      latency, samples);
   return samples;
 }
-
-static AudioBufferList *
-buffer_list_alloc (int channels, int size)
-{
-  AudioBufferList *list;
-  int total_size;
-  int n;
-
-  total_size = sizeof (AudioBufferList) + 1 * sizeof (AudioBuffer);
-  list = (AudioBufferList *) g_malloc (total_size);
-
-  list->mNumberBuffers = 1;
-  for (n = 0; n < (int) list->mNumberBuffers; ++n) {
-    list->mBuffers[n].mNumberChannels = channels;
-    list->mBuffers[n].mDataByteSize = size;
-    list->mBuffers[n].mData = g_malloc (size);
-  }
-
-  return list;
-}
-
-static void
-buffer_list_free (AudioBufferList * list)
-{
-  int n;
-
-  for (n = 0; n < (int) list->mNumberBuffers; ++n) {
-    if (list->mBuffers[n].mData)
-      g_free (list->mBuffers[n].mData);
-  }
-
-  g_free (list);
-}
diff --git a/sys/osxaudio/gstosxringbuffer.h b/sys/osxaudio/gstosxringbuffer.h
index 5e6dbe4..3f24d38 100644
--- a/sys/osxaudio/gstosxringbuffer.h
+++ b/sys/osxaudio/gstosxringbuffer.h
@@ -1,6 +1,7 @@
 /*
  * GStreamer
  * Copyright (C) 2006 Zaheer Abbas Merali <zaheerabbas at merali dot org>
+ * Copyright (C) 2012 Fluendo S.A. <support@fluendo.com>
  *
  * Permission is hereby granted, free of charge, to any person obtaining a
  * copy of this software and associated documentation files (the "Software"),
@@ -44,10 +45,14 @@
 #ifndef __GST_OSX_RING_BUFFER_H__
 #define __GST_OSX_RING_BUFFER_H__
 
+#ifdef HAVE_CONFIG_H
+#  include <config.h>
+#endif
+
 #include <gst/gst.h>
 #include <gst/audio/gstringbuffer.h>
-#include <CoreAudio/CoreAudio.h>
-#include "gstosxaudioelement.h"
+#include <gstosxcoreaudio.h>
+
 
 G_BEGIN_DECLS
 
@@ -64,6 +69,8 @@ G_BEGIN_DECLS
 #define GST_IS_OSX_RING_BUFFER_CLASS(klass) \
   (G_TYPE_CHECK_CLASS_TYPE((klass),GST_TYPE_OSX_RING_BUFFER))
 
+#define RINGBUFFER_IS_SPDIF(t) ((t) == GST_BUFTYPE_AC3 || (t) == GST_BUFTYPE_DTS)
+
 typedef struct _GstOsxRingBuffer GstOsxRingBuffer;
 typedef struct _GstOsxRingBufferClass GstOsxRingBufferClass;
 
@@ -71,15 +78,10 @@ struct _GstOsxRingBuffer
 {
   GstRingBuffer object;
 
-  gboolean is_src;
-  AudioUnit audiounit;
-  AudioDeviceID device_id;
-  gboolean io_proc_active;
-  gboolean io_proc_needs_deactivation;
+  GstCoreAudio *core_audio;
+
   guint buffer_len;
   guint segoffset;
-  AudioBufferList * recBufferList;
-  GstOsxAudioElementInterface * element;
 };
 
 struct _GstOsxRingBufferClass
@@ -92,3 +94,4 @@ GType gst_osx_ring_buffer_get_type (void);
 G_END_DECLS
 
 #endif /* __GST_OSX_RING_BUFFER_H__ */
+
diff --git a/sys/osxvideo/Makefile.am b/sys/osxvideo/Makefile.am
index 8893c2e..03b0363 100644
--- a/sys/osxvideo/Makefile.am
+++ b/sys/osxvideo/Makefile.am
@@ -3,17 +3,17 @@ plugin_LTLIBRARIES = libgstosxvideosink.la
 
 libgstosxvideosink_la_SOURCES = osxvideosink.m cocoawindow.m 
 libgstosxvideosink_la_CFLAGS = $(GST_CFLAGS) $(GST_BASE_CFLAGS) \
-	$(GST_PLUGINS_BASE_CFLAGS)
+	$(GST_PLUGINS_BASE_CFLAGS) -DRUN_NS_APP_THREAD
+libgstosxvideosink_la_OBJCFLAGS = $(GST_OBJCFLAGS) $(GST_BASE_CFLAGS) \
+	$(GST_PLUGINS_BASE_CFLAGS) -DRUN_NS_APP_THREAD
 libgstosxvideosink_la_LIBADD =  \
 	$(GST_LIBS) \
 	$(GST_BASE_LIBS) \
-    $(GST_PLUGINS_BASE_LIBS) \
-    -lgstvideo-$(GST_MAJORMINOR) \
+	$(GST_PLUGINS_BASE_LIBS) \
+	-lgstvideo-$(GST_MAJORMINOR) \
 	-lgstinterfaces-$(GST_MAJORMINOR)
 
 libgstosxvideosink_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS) -Wl,-framework -Wl,Cocoa -Wl,-framework -Wl,QuickTime -Wl,-framework -Wl,OpenGL
 libgstosxvideosink_la_LIBTOOLFLAGS = --tag=disable-static
 
-AM_OBJCFLAGS=$(CFLAGS) $(GST_CFLAGS) $(GST_PLUGINS_BASE_CFLAGS) $(GST_BASE_CFLAGS) -Wno-aggregate-return
-
 noinst_HEADERS = osxvideosink.h cocoawindow.h
diff --git a/sys/osxvideo/Makefile.in b/sys/osxvideo/Makefile.in
index fe62cb4..30d5bdd 100644
--- a/sys/osxvideo/Makefile.in
+++ b/sys/osxvideo/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = sys/osxvideo
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -120,10 +136,23 @@ libgstosxvideosink_la_OBJECTS = $(am_libgstosxvideosink_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstosxvideosink_la_LINK = $(LIBTOOL) $(AM_V_lt) \
 	$(libgstosxvideosink_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
-	--mode=link $(OBJCLD) $(AM_OBJCFLAGS) $(OBJCFLAGS) \
-	$(libgstosxvideosink_la_LDFLAGS) $(LDFLAGS) -o $@
+	--mode=link $(OBJCLD) $(libgstosxvideosink_la_OBJCFLAGS) \
+	$(OBJCFLAGS) $(libgstosxvideosink_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -136,22 +165,23 @@ LTOBJCCOMPILE = $(LIBTOOL) $(AM_V_lt) $(AM_LIBTOOLFLAGS) \
 	$(AM_OBJCFLAGS) $(OBJCFLAGS)
 AM_V_OBJC = $(am__v_OBJC_@AM_V@)
 am__v_OBJC_ = $(am__v_OBJC_@AM_DEFAULT_V@)
-am__v_OBJC_0 = @echo "  OBJC  " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_OBJC_0 = @echo "  OBJC    " $@;
+am__v_OBJC_1 = 
 OBJCLD = $(OBJC)
 OBJCLINK = $(LIBTOOL) $(AM_V_lt) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(OBJCLD) $(AM_OBJCFLAGS) $(OBJCFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_OBJCLD = $(am__v_OBJCLD_@AM_V@)
 am__v_OBJCLD_ = $(am__v_OBJCLD_@AM_DEFAULT_V@)
-am__v_OBJCLD_0 = @echo "  OBJCLD" $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_OBJCLD_0 = @echo "  OBJCLD  " $@;
+am__v_OBJCLD_1 = 
 SOURCES = $(libgstosxvideosink_la_SOURCES)
 DIST_SOURCES = $(libgstosxvideosink_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -211,6 +241,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -259,8 +290,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -341,7 +374,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -401,6 +434,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -474,25 +508,31 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
 plugin_LTLIBRARIES = libgstosxvideosink.la
 libgstosxvideosink_la_SOURCES = osxvideosink.m cocoawindow.m 
 libgstosxvideosink_la_CFLAGS = $(GST_CFLAGS) $(GST_BASE_CFLAGS) \
-	$(GST_PLUGINS_BASE_CFLAGS)
+	$(GST_PLUGINS_BASE_CFLAGS) -DRUN_NS_APP_THREAD
+
+libgstosxvideosink_la_OBJCFLAGS = $(GST_OBJCFLAGS) $(GST_BASE_CFLAGS) \
+	$(GST_PLUGINS_BASE_CFLAGS) -DRUN_NS_APP_THREAD
 
 libgstosxvideosink_la_LIBADD = \
 	$(GST_LIBS) \
 	$(GST_BASE_LIBS) \
-    $(GST_PLUGINS_BASE_LIBS) \
-    -lgstvideo-$(GST_MAJORMINOR) \
+	$(GST_PLUGINS_BASE_LIBS) \
+	-lgstvideo-$(GST_MAJORMINOR) \
 	-lgstinterfaces-$(GST_MAJORMINOR)
 
 libgstosxvideosink_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS) -Wl,-framework -Wl,Cocoa -Wl,-framework -Wl,QuickTime -Wl,-framework -Wl,OpenGL
 libgstosxvideosink_la_LIBTOOLFLAGS = --tag=disable-static
-AM_OBJCFLAGS = $(CFLAGS) $(GST_CFLAGS) $(GST_PLUGINS_BASE_CFLAGS) $(GST_BASE_CFLAGS) -Wno-aggregate-return
 noinst_HEADERS = osxvideosink.h cocoawindow.h
 all: all-am
 
@@ -530,7 +570,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -538,6 +577,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -553,12 +594,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstosxvideosink.la: $(libgstosxvideosink_la_OBJECTS) $(libgstosxvideosink_la_DEPENDENCIES) $(EXTRA_libgstosxvideosink_la_DEPENDENCIES) 
 	$(AM_V_OBJCLD)$(libgstosxvideosink_la_LINK) -rpath $(plugindir) $(libgstosxvideosink_la_OBJECTS) $(libgstosxvideosink_la_LIBADD) $(LIBS)
 
@@ -593,18 +636,18 @@ distclean-compile:
 @am__fastdepOBJC_FALSE@	$(AM_V_OBJC@am__nodep@)$(LTOBJCCOMPILE) -c -o $@ $<
 
 libgstosxvideosink_la-osxvideosink.lo: osxvideosink.m
-@am__fastdepOBJC_TRUE@	$(AM_V_OBJC)$(LIBTOOL) $(AM_V_lt) $(libgstosxvideosink_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(OBJC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_OBJCFLAGS) $(OBJCFLAGS) -MT libgstosxvideosink_la-osxvideosink.lo -MD -MP -MF $(DEPDIR)/libgstosxvideosink_la-osxvideosink.Tpo -c -o libgstosxvideosink_la-osxvideosink.lo `test -f 'osxvideosink.m' || echo '$(srcdir)/'`osxvideosink.m
+@am__fastdepOBJC_TRUE@	$(AM_V_OBJC)$(LIBTOOL) $(AM_V_lt) $(libgstosxvideosink_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(OBJC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstosxvideosink_la_OBJCFLAGS) $(OBJCFLAGS) -MT libgstosxvideosink_la-osxvideosink.lo -MD -MP -MF $(DEPDIR)/libgstosxvideosink_la-osxvideosink.Tpo -c -o libgstosxvideosink_la-osxvideosink.lo `test -f 'osxvideosink.m' || echo '$(srcdir)/'`osxvideosink.m
 @am__fastdepOBJC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libgstosxvideosink_la-osxvideosink.Tpo $(DEPDIR)/libgstosxvideosink_la-osxvideosink.Plo
 @AMDEP_TRUE@@am__fastdepOBJC_FALSE@	$(AM_V_OBJC)source='osxvideosink.m' object='libgstosxvideosink_la-osxvideosink.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepOBJC_FALSE@	DEPDIR=$(DEPDIR) $(OBJCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepOBJC_FALSE@	$(AM_V_OBJC@am__nodep@)$(LIBTOOL) $(AM_V_lt) $(libgstosxvideosink_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(OBJC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_OBJCFLAGS) $(OBJCFLAGS) -c -o libgstosxvideosink_la-osxvideosink.lo `test -f 'osxvideosink.m' || echo '$(srcdir)/'`osxvideosink.m
+@am__fastdepOBJC_FALSE@	$(AM_V_OBJC@am__nodep@)$(LIBTOOL) $(AM_V_lt) $(libgstosxvideosink_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(OBJC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstosxvideosink_la_OBJCFLAGS) $(OBJCFLAGS) -c -o libgstosxvideosink_la-osxvideosink.lo `test -f 'osxvideosink.m' || echo '$(srcdir)/'`osxvideosink.m
 
 libgstosxvideosink_la-cocoawindow.lo: cocoawindow.m
-@am__fastdepOBJC_TRUE@	$(AM_V_OBJC)$(LIBTOOL) $(AM_V_lt) $(libgstosxvideosink_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(OBJC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_OBJCFLAGS) $(OBJCFLAGS) -MT libgstosxvideosink_la-cocoawindow.lo -MD -MP -MF $(DEPDIR)/libgstosxvideosink_la-cocoawindow.Tpo -c -o libgstosxvideosink_la-cocoawindow.lo `test -f 'cocoawindow.m' || echo '$(srcdir)/'`cocoawindow.m
+@am__fastdepOBJC_TRUE@	$(AM_V_OBJC)$(LIBTOOL) $(AM_V_lt) $(libgstosxvideosink_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(OBJC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstosxvideosink_la_OBJCFLAGS) $(OBJCFLAGS) -MT libgstosxvideosink_la-cocoawindow.lo -MD -MP -MF $(DEPDIR)/libgstosxvideosink_la-cocoawindow.Tpo -c -o libgstosxvideosink_la-cocoawindow.lo `test -f 'cocoawindow.m' || echo '$(srcdir)/'`cocoawindow.m
 @am__fastdepOBJC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libgstosxvideosink_la-cocoawindow.Tpo $(DEPDIR)/libgstosxvideosink_la-cocoawindow.Plo
 @AMDEP_TRUE@@am__fastdepOBJC_FALSE@	$(AM_V_OBJC)source='cocoawindow.m' object='libgstosxvideosink_la-cocoawindow.lo' libtool=yes @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepOBJC_FALSE@	DEPDIR=$(DEPDIR) $(OBJCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepOBJC_FALSE@	$(AM_V_OBJC@am__nodep@)$(LIBTOOL) $(AM_V_lt) $(libgstosxvideosink_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(OBJC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_OBJCFLAGS) $(OBJCFLAGS) -c -o libgstosxvideosink_la-cocoawindow.lo `test -f 'cocoawindow.m' || echo '$(srcdir)/'`cocoawindow.m
+@am__fastdepOBJC_FALSE@	$(AM_V_OBJC@am__nodep@)$(LIBTOOL) $(AM_V_lt) $(libgstosxvideosink_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(OBJC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstosxvideosink_la_OBJCFLAGS) $(OBJCFLAGS) -c -o libgstosxvideosink_la-cocoawindow.lo `test -f 'cocoawindow.m' || echo '$(srcdir)/'`cocoawindow.m
 
 mostlyclean-libtool:
 	-rm -f *.lo
@@ -661,6 +704,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -805,18 +862,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/sys/osxvideo/cocoawindow.h b/sys/osxvideo/cocoawindow.h
index 7324cc7..110bb84 100644
--- a/sys/osxvideo/cocoawindow.h
+++ b/sys/osxvideo/cocoawindow.h
@@ -29,6 +29,7 @@
 #import <Cocoa/Cocoa.h>
 #import <QuickTime/QuickTime.h>
 #import <glib.h>
+#import <gst/interfaces/navigation.h>
 
 struct _GstOSXImage;
 
@@ -42,8 +43,14 @@ struct _GstOSXImage;
     char* data;
     int width, height;
     BOOL fullscreen;
+    BOOL keepAspectRatio;
     NSOpenGLContext* fullScreenContext; 
     NSOpenGLContext* actualContext;
+    NSTrackingArea *trackingArea;
+    GstNavigation *navigation;
+    NSRect drawingBounds;
+    NSThread *mainThread;
+    NSUInteger savedModifierFlags;
 }
 - (void) drawQuad;
 - (void) drawRect: (NSRect) rect;
@@ -54,12 +61,16 @@ struct _GstOSXImage;
 - (void) displayTexture;
 - (char*) getTextureBuffer;
 - (void) setFullScreen: (BOOL) flag;
+- (void) setKeepAspectRatio: (BOOL) flag;
 - (void) reshape;
 - (void) setVideoSize: (int) w: (int) h;
+- (NSRect) getDrawingBounds;
 - (BOOL) haveSuperview;
 - (void) haveSuperviewReal: (NSMutableArray *)closure;
 - (void) addToSuperview: (NSView *)superview;
 - (void) removeFromSuperview: (id)unused;
+- (void) setNavigation: (GstNavigation *) nav;
+- (void) setMainThread: (NSThread *) thread;
 
 @end
 
@@ -70,5 +81,5 @@ struct _GstOSXImage;
 
 - (void) setContentSize: (NSSize) size;
 - (GstGLView *) gstView;
-- (id)initWithContentRect:(NSRect)contentRect styleMask:(unsigned int)styleMask backing:(NSBackingStoreType)bufferingType defer:(BOOL)flag screen:(NSScreen *)aScreen;
+- (id)initWithContentNSRect:(NSRect)contentRect styleMask:(unsigned int)styleMask backing:(NSBackingStoreType)bufferingType defer:(BOOL)flag screen:(NSScreen *)aScreen;
 @end
diff --git a/sys/osxvideo/cocoawindow.m b/sys/osxvideo/cocoawindow.m
index ed24fad..9c1781b 100644
--- a/sys/osxvideo/cocoawindow.m
+++ b/sys/osxvideo/cocoawindow.m
@@ -36,13 +36,300 @@
 #include <OpenGL/gl.h>
 #include <OpenGL/glext.h>
 
+#include <Carbon/Carbon.h>
+
 /* Debugging category */
 #include <gst/gstinfo.h>
 
+#if MAC_OS_X_VERSION_MAX_ALLOWED <= 1040
+#define kVK_ANSI_Keypad0 0x52
+#define kVK_ANSI_Keypad1 0x53
+#define kVK_ANSI_Keypad2 0x54
+#define kVK_ANSI_Keypad3 0x55
+#define kVK_ANSI_Keypad4 0x56
+#define kVK_ANSI_Keypad5 0x57
+#define kVK_ANSI_Keypad6 0x58
+#define kVK_ANSI_Keypad7 0x59
+#define kVK_ANSI_Keypad8 0x5b
+#define kVK_ANSI_Keypad9 0x5c
+#define kVK_ANSI_KeypadDecimal 0x41
+#define kVK_ANSI_KeypadDivide 0x4b
+#define kVK_ANSI_KeypadEnter 0x4c
+#define kVK_ANSI_KeypadMinus 0x4e
+#define kVK_ANSI_KeypadMultiply 0x43
+#define kVK_ANSI_KeypadPlus 0x45
+#define kVK_Control 0x3b
+#define kVK_Delete 0x33
+#define kVK_DownArrow 0x7d
+#define kVK_End 0x77
+#define kVK_Escape 0x35
+#define kVK_F1 0x7a
+#define kVK_F10 0x6d
+#define kVK_F11 0x67
+#define kVK_F12 0x6f
+#define kVK_F2 0x78
+#define kVK_F3 0x63
+#define kVK_F4 0x76
+#define kVK_F5 0x60
+#define kVK_F6 0x61
+#define kVK_F7 0x62
+#define kVK_F8 0x64
+#define kVK_F9 0x65
+#define kVK_ForwardDelete 0x75
+#define kVK_Help 0x72
+#define kVK_Home 0x73
+#define kVK_LeftArrow 0x7b
+#define kVK_Option 0x3a
+#define kVK_PageDown 0x79
+#define kVK_PageUp 0x74
+#define kVK_Return 0x24
+#define kVK_RightArrow 0x7c
+#define kVK_Shift 0x38
+#define kVK_Tab 0x30
+#define kVK_UpArrow 0x7e
+#endif /* MAC_OS_X_VERSION_MAX_ALLOWED <= 1040 */
+
+static
+const gchar* gst_keycode_to_keyname(gint16 keycode)
+{
+    switch (keycode)
+    {
+      case kVK_ANSI_A:
+        return "a";
+      case kVK_ANSI_S:
+        return "s";
+      case kVK_ANSI_D:
+        return "d";
+      case kVK_ANSI_F:
+        return "f";
+      case kVK_ANSI_H:
+        return "h";
+      case kVK_ANSI_G:
+        return "g";
+      case kVK_ANSI_Z:
+        return "z";
+      case kVK_ANSI_X:
+        return "x";
+      case kVK_ANSI_C:
+        return "c";
+      case kVK_ANSI_V:
+        return "v";
+      case kVK_ANSI_B:
+        return "b";
+      case kVK_ANSI_Q:
+        return "q";
+      case kVK_ANSI_W:
+        return "w";
+      case kVK_ANSI_E:
+        return "e";
+      case kVK_ANSI_R:
+        return "r";
+      case kVK_ANSI_Y:
+        return "y";
+      case kVK_ANSI_T:
+        return "t";
+      case kVK_ANSI_1:
+        return "1";
+      case kVK_ANSI_2:
+        return "2";
+      case kVK_ANSI_3:
+        return "3";
+      case kVK_ANSI_4:
+        return "4";
+      case kVK_ANSI_6:
+        return "6";
+      case kVK_ANSI_5:
+        return "5";
+      case kVK_ANSI_Equal:
+        return "equal";
+      case kVK_ANSI_9:
+        return "9";
+      case kVK_ANSI_7:
+        return "7";
+      case kVK_ANSI_Minus:
+        return "minus";
+      case kVK_ANSI_8:
+        return "8";
+      case kVK_ANSI_0:
+        return "0";
+      case kVK_ANSI_RightBracket:
+        return "bracketright";
+      case kVK_ANSI_O:
+        return "0";
+      case kVK_ANSI_U:
+        return "u";
+      case kVK_ANSI_LeftBracket:
+        return "bracketleft";
+      case kVK_ANSI_I:
+        return "i";
+      case kVK_ANSI_P:
+        return "p";
+      case kVK_ANSI_L:
+        return "l";
+      case kVK_ANSI_J:
+        return "j";
+      case kVK_ANSI_Quote:
+        return "apostrophe";
+      case kVK_ANSI_K:
+        return "k";
+      case kVK_ANSI_Semicolon:
+        return "semicolon";
+      case kVK_ANSI_Backslash:
+        return "backslash";
+      case kVK_ANSI_Comma:
+        return "comma";
+      case kVK_ANSI_Slash:
+        return "slash";
+      case kVK_ANSI_N:
+        return "n";
+      case kVK_ANSI_M:
+        return "m";
+      case kVK_ANSI_Period:
+        return "period";
+      case kVK_ANSI_Grave:
+        return "grave";
+      case kVK_ANSI_KeypadDecimal:
+        return "KP_Delete";
+      case kVK_ANSI_KeypadMultiply:
+        return "KP_Multiply";
+      case kVK_ANSI_KeypadPlus:
+        return "KP_Add";
+      case kVK_ANSI_KeypadClear:
+        return "KP_Clear";
+      case kVK_ANSI_KeypadDivide:
+        return "KP_Divide";
+      case kVK_ANSI_KeypadEnter:
+        return "KP_Enter";
+      case kVK_ANSI_KeypadMinus:
+        return "KP_Subtract";
+      case kVK_ANSI_KeypadEquals:
+        return "KP_Equals";
+      case kVK_ANSI_Keypad0:
+        return "KP_Insert";
+      case kVK_ANSI_Keypad1:
+        return "KP_End";
+      case kVK_ANSI_Keypad2:
+        return "KP_Down";
+      case kVK_ANSI_Keypad3:
+        return "KP_Next";
+      case kVK_ANSI_Keypad4:
+        return "KP_Left";
+      case kVK_ANSI_Keypad5:
+        return "KP_Begin";
+      case kVK_ANSI_Keypad6:
+        return "KP_Right";
+      case kVK_ANSI_Keypad7:
+        return "KP_Home";
+      case kVK_ANSI_Keypad8:
+        return "KP_Up";
+      case kVK_ANSI_Keypad9:
+        return "KP_Prior";
+
+    /* keycodes for keys that are independent of keyboard layout*/
+
+      case kVK_Return:
+        return "Return";
+      case kVK_Tab:
+        return "Tab";
+      case kVK_Space:
+        return "space";
+      case kVK_Delete:
+        return "Backspace";
+      case kVK_Escape:
+        return "Escape";
+      case kVK_Command:
+        return "Command";
+      case kVK_Shift:
+        return "Shift_L";
+      case kVK_CapsLock:
+        return "Caps_Lock";
+      case kVK_Option:
+        return "Option_L";
+      case kVK_Control:
+        return "Control_L";
+      case kVK_RightShift:
+        return "Shift_R";
+      case kVK_RightOption:
+        return "Option_R";
+      case kVK_RightControl:
+        return "Control_R";
+      case kVK_Function:
+        return "Function";
+      case kVK_F17:
+        return "F17";
+      case kVK_VolumeUp:
+        return "VolumeUp";
+      case kVK_VolumeDown:
+        return "VolumeDown";
+      case kVK_Mute:
+        return "Mute";
+      case kVK_F18:
+        return "F18";
+      case kVK_F19:
+        return "F19";
+      case kVK_F20:
+        return "F20";
+      case kVK_F5:
+        return "F5";
+      case kVK_F6:
+        return "F6";
+      case kVK_F7:
+        return "F7";
+      case kVK_F3:
+        return "F3";
+      case kVK_F8:
+        return "F8";
+      case kVK_F9:
+        return "F9";
+      case kVK_F11:
+        return "F11";
+      case kVK_F13:
+        return "F13";
+      case kVK_F16:
+        return "F16";
+      case kVK_F14:
+        return "F14";
+      case kVK_F10:
+        return "F10";
+      case kVK_F12:
+        return "F12";
+      case kVK_F15:
+        return "F15";
+      case kVK_Help:
+        return "Help";
+      case kVK_Home:
+        return "Home";
+      case kVK_PageUp:
+        return "Prior";
+      case kVK_ForwardDelete:
+        return "Delete";
+      case kVK_F4:
+        return "F4";
+      case kVK_End:
+        return "End";
+      case kVK_F2:
+        return "F2";
+      case kVK_PageDown:
+        return "Next";
+      case kVK_F1:
+        return "F1";
+      case kVK_LeftArrow:
+        return "Left";
+      case kVK_RightArrow:
+        return "Right";
+      case kVK_DownArrow:
+        return "Down";
+      case kVK_UpArrow:
+        return "Up";
+    default:
+        return "";
+  };
+}
+
 @ implementation GstOSXVideoSinkWindow
 
 /* The object has to be released */
-- (id) initWithContentRect: (NSRect) rect
+- (id) initWithContentNSRect: (NSRect) rect
 		 styleMask: (unsigned int) styleMask
 		   backing: (NSBackingStoreType) bufferingType 
 		     defer: (BOOL) flag
@@ -69,8 +356,6 @@
   width = size.width;
   height = size.height;
 
-  [gstview setVideoSize: (int) width:(int) height];
-
   [super setContentSize:size];
 }
 
@@ -82,21 +367,6 @@
   [self setAcceptsMouseMovedEvents:YES];
 }
 
-- (void) sendEvent:(NSEvent *) event {
-  BOOL taken = NO;
-
-  GST_DEBUG ("event %p type:%d", event,(gint)[event type]);
-
-  if ([event type] == NSKeyDown) {
-  }
-  /*taken = [gstview keyDown:event]; */
-
-  if (!taken) {
-    [super sendEvent:event];
-  }
-}
-
-
 @end
 
 
@@ -141,15 +411,31 @@
   data = nil;
   width = frame.size.width;
   height = frame.size.height;
+  drawingBounds = NSMakeRect(0, 0, width, height);
 
   GST_LOG ("Width: %d Height: %d", width, height);
 
+  trackingArea = [[NSTrackingArea alloc] initWithRect:[self bounds]
+      options: (NSTrackingMouseEnteredAndExited | NSTrackingMouseMoved | NSTrackingActiveInKeyWindow)
+      owner:self
+      userInfo:nil];
+
+  [self addTrackingArea:trackingArea];
+  mainThread = [NSThread mainThread];
+
   [self initTextures];
   return self;
 }
 
+- (NSRect) getDrawingBounds {
+  return drawingBounds;
+}
+
 - (void) reshape {
   NSRect bounds;
+  gdouble frame_par, view_par;
+  gint view_height, view_width, c_height, c_width, c_x, c_y;
+
 
   GST_LOG ("reshaping");
 
@@ -160,9 +446,33 @@
   [actualContext makeCurrentContext];
 
   bounds = [self bounds];
+  view_width = bounds.size.width;
+  view_height = bounds.size.height;
+
+  frame_par = (gdouble) width / height;
+  view_par = (gdouble) view_width / view_height;
+  if (!keepAspectRatio)
+    view_par = frame_par;
+
+  if (frame_par == view_par) {
+    c_height = view_height;
+    c_width = view_width;
+    c_x = 0;
+    c_y = 0;
+  } else if (frame_par < view_par) {
+    c_height = view_height;
+    c_width = c_height * frame_par;
+    c_x = (view_width - c_width) / 2;
+    c_y = 0;
+  } else {
+    c_width = view_width;
+    c_height = c_width / frame_par;
+    c_x = 0;
+    c_y = (view_height - c_height) / 2;
+  }
 
-  glViewport (0, 0, (GLint) bounds.size.width, (GLint) bounds.size.height);
-
+  drawingBounds = NSMakeRect(c_x, c_y, c_width, c_height);
+  glViewport (c_x, c_y, (GLint) c_width, (GLint) c_height);
 }
 
 - (void) initTextures {
@@ -382,6 +692,16 @@
 
 //  data = g_malloc0 (2 * w * h);
   [self initTextures];
+  [self reshape];
+}
+
+- (void) setKeepAspectRatio: (BOOL) flag {
+  keepAspectRatio = flag;
+  [self reshape];
+}
+
+- (void) setMainThread: (NSThread *) thread {
+  mainThread = thread;
 }
 
 - (void) haveSuperviewReal:(NSMutableArray *)closure {
@@ -391,8 +711,9 @@
 
 - (BOOL) haveSuperview {
 	NSMutableArray *closure = [NSMutableArray arrayWithCapacity:1];
-	[self performSelectorOnMainThread:@selector(haveSuperviewReal:)
-			withObject:(id)closure waitUntilDone:YES];
+	[self performSelector:@selector(haveSuperviewReal:)
+		onThread:mainThread
+		withObject:(id)closure waitUntilDone:YES];
 
 	return [[closure objectAtIndex:0] boolValue];
 }
@@ -406,8 +727,9 @@
 }
 
 - (void) addToSuperview: (NSView *)superview {
-	[self performSelectorOnMainThread:@selector(addToSuperviewReal:)
-			withObject:superview waitUntilDone:YES];
+	[self performSelector:@selector(addToSuperviewReal:)
+		onThread:mainThread
+		withObject:superview waitUntilDone:YES];
 }
 
 - (void) removeFromSuperview: (id)unused
@@ -429,4 +751,122 @@
 
   [super dealloc];
 }
+
+- (void)updateTrackingAreas {
+  [self removeTrackingArea:trackingArea];
+  [trackingArea release];
+  trackingArea = [[NSTrackingArea alloc] initWithRect: [self bounds]
+      options: (NSTrackingMouseEnteredAndExited | NSTrackingMouseMoved | NSTrackingActiveInKeyWindow)
+      owner:self userInfo:nil];
+  [self addTrackingArea:trackingArea];
+}
+
+- (BOOL)acceptsFirstResponder {
+    return YES;
+}
+
+- (void) setNavigation:(GstNavigation *)nav
+{
+  navigation = nav;
+}
+
+- (void)sendMouseEvent:(NSEvent *)event: (const char *)event_name
+{
+  NSPoint location;
+  gint button;
+  gdouble x, y;
+
+  if (!navigation)
+    return;
+
+  switch ([event type]) {
+    case NSMouseMoved:
+      button = 0;
+      break;
+    case NSLeftMouseDown:
+    case NSLeftMouseUp:
+      button = 1;
+      break;
+    case NSRightMouseDown:
+    case NSRightMouseUp:
+      button = 2;
+      break;
+    default:
+      button = 3;
+      break;
+  }
+
+  location = [self convertPoint:[event locationInWindow] fromView:nil];
+
+  x = location.x;
+  y = location.y;
+  /* invert Y */
+
+  y = (1 - ((gdouble) y) / [self bounds].size.height) * [self bounds].size.height;
+
+  gst_navigation_send_mouse_event (navigation, event_name, button, x, y);
+}
+
+- (void)sendKeyEvent:(NSEvent *)event: (const char *)event_name
+{
+  if (!navigation)
+    return;
+
+  gst_navigation_send_key_event(navigation, event_name, gst_keycode_to_keyname([event keyCode]));
+}
+
+- (void)sendModifierKeyEvent:(NSEvent *)event
+{
+  NSUInteger flags = [event modifierFlags];
+  const gchar* event_name = flags > savedModifierFlags ? "key-press" : "key-release";
+  savedModifierFlags = flags;
+  [self sendKeyEvent: event: event_name];
+}
+
+- (void)keyDown:(NSEvent *) event;
+{
+  [self sendKeyEvent: event: "key-press"];
+  [super keyDown: event];
+}
+
+- (void)keyUp:(NSEvent *) event;
+{
+  [self sendKeyEvent: event: "key-release"];
+  [super keyUp: event];
+}
+
+- (void)flagsChanged:(NSEvent *) event;
+{
+  [self sendModifierKeyEvent: event];
+  [super flagsChanged: event];
+}
+
+- (void)mouseDown:(NSEvent *) event;
+{
+  [self sendMouseEvent:event: "mouse-button-press"];
+  [super mouseDown: event];
+}
+
+- (void)mouseUp:(NSEvent *) event;
+{
+  [self sendMouseEvent:event: "mouse-button-release"];
+  [super mouseUp: event];
+}
+
+- (void)mouseMoved:(NSEvent *)event;
+{
+  [self sendMouseEvent:event: "mouse-move"];
+  [super mouseMoved: event];
+}
+
+- (void)mouseEntered:(NSEvent *)event;
+{
+  [super mouseEntered: event];
+}
+
+- (void)mouseExited:(NSEvent *)event;
+{
+  [super mouseExited: event];
+}
+
 @end
diff --git a/sys/osxvideo/osxvideosink.h b/sys/osxvideo/osxvideosink.h
index 2a228d0..622f0ad 100644
--- a/sys/osxvideo/osxvideosink.h
+++ b/sys/osxvideo/osxvideosink.h
@@ -31,6 +31,7 @@
 
 #include <string.h>
 #include <math.h>
+#include <objc/runtime.h>
 #include <Cocoa/Cocoa.h>
 
 #include <QuickTime/QuickTime.h>
@@ -39,6 +40,14 @@
 GST_DEBUG_CATEGORY_EXTERN (gst_debug_osx_video_sink);
 #define GST_CAT_DEFAULT gst_debug_osx_video_sink
 
+/* The hack doesn't work on leopard, the _CFMainPThread symbol
+ * is doesn't exist in the CoreFoundation library */
+#if MAC_OS_X_VERSION_MIN_REQUIRED <= MAC_OS_X_VERSION_10_5
+#ifdef RUN_NS_APP_THREAD
+#undef RUN_NS_APP_THREAD
+#endif
+#endif
+
 G_BEGIN_DECLS
 
 #define GST_TYPE_OSX_VIDEO_SINK \
@@ -62,15 +71,32 @@ typedef struct _GstOSXVideoSinkClass GstOSXVideoSinkClass;
 /* OSXWindow stuff */
 struct _GstOSXWindow {
   gint width, height;
+  gboolean closed;
   gboolean internal;
   GstGLView* gstview;
+  GstOSXVideoSinkWindow* win;
 };
 
 struct _GstOSXVideoSink {
   /* Our element stuff */
   GstVideoSink videosink;
   GstOSXWindow *osxwindow;
+  void *osxvideosinkobject;
   NSView *superview;
+  NSThread *ns_app_thread;
+#ifdef RUN_NS_APP_THREAD
+  GMutex *loop_thread_lock;
+  GCond *loop_thread_cond;
+#else
+  guint cocoa_timeout;
+#endif
+  GMutex *mrl_check_lock;
+  GCond *mrl_check_cond;
+  gboolean mrl_check_done;
+  gboolean main_run_loop_running;
+  gboolean app_started;
+  gboolean keep_par;
+  gboolean embed;
 };
 
 struct _GstOSXVideoSinkClass {
@@ -79,6 +105,54 @@ struct _GstOSXVideoSinkClass {
 
 GType gst_osx_video_sink_get_type(void);
 
+#if MAC_OS_X_VERSION_MAX_ALLOWED >= MAC_OS_X_VERSION_10_4
+@interface NSApplication(AppleMenu)
+- (void)setAppleMenu:(NSMenu *)menu;
+@end
+#endif
+
+@interface GstBufferObject : NSObject
+{
+  @public
+  GstBuffer *buf;
+}
+
+-(id) initWithBuffer: (GstBuffer *) buf;
+@end
+
+
+#if MAC_OS_X_VERSION_MIN_REQUIRED <= MAC_OS_X_VERSION_10_5
+@interface GstWindowDelegate : NSObject
+#else
+@interface GstWindowDelegate : NSObject <NSWindowDelegate>
+#endif
+{
+  @public
+  GstOSXVideoSink *osxvideosink;
+}
+-(id) initWithSink: (GstOSXVideoSink *) sink;
+@end
+
+@interface GstOSXVideoSinkObject : NSObject
+{
+  BOOL destroyed;
+
+  @public
+  GstOSXVideoSink *osxvideosink;
+}
+
+-(id) initWithSink: (GstOSXVideoSink *) sink;
+-(void) createInternalWindow;
+-(void) resize;
+-(void) destroy;
+-(void) showFrame: (GstBufferObject*) buf;
+#ifdef RUN_NS_APP_THREAD
++ (BOOL) isMainThread;
+-(void) nsAppThread;
+-(void) checkMainRunLoop;
+#endif
+@end
+
 G_END_DECLS
 
 #endif /* __GST_OSX_VIDEO_SINK_H__ */
diff --git a/sys/osxvideo/osxvideosink.m b/sys/osxvideo/osxvideosink.m
index 5914550..4842543 100644
--- a/sys/osxvideo/osxvideosink.m
+++ b/sys/osxvideo/osxvideosink.m
@@ -37,7 +37,13 @@
  */
 
 #include "config.h"
+
+/* FIXME 1.x: suppress warnings for deprecated API such as GStaticRecMutex
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #include <gst/interfaces/xoverlay.h>
+#include <gst/interfaces/navigation.h>
 
 #include "osxvideosink.h"
 #include <unistd.h>
@@ -46,6 +52,11 @@
 GST_DEBUG_CATEGORY (gst_debug_osx_video_sink);
 #define GST_CAT_DEFAULT gst_debug_osx_video_sink
 
+#ifdef RUN_NS_APP_THREAD
+extern  void _CFRunLoopSetCurrent(CFRunLoopRef rl);
+extern pthread_t _CFMainPThread;
+#endif
+
 static GstStaticPadTemplate gst_osx_video_sink_sink_template_factory =
 GST_STATIC_PAD_TEMPLATE ("sink",
     GST_PAD_SINK,
@@ -65,12 +76,145 @@ enum
 {
   ARG_0,
   ARG_EMBED,
+  ARG_FORCE_PAR,
 };
 
 static void gst_osx_video_sink_osxwindow_destroy (GstOSXVideoSink * osxvideosink);
 
 static GstVideoSinkClass *parent_class = NULL;
 
+/* Helper to trigger calls from the main thread */
+static void
+gst_osx_video_sink_call_from_main_thread(GstOSXVideoSink *osxvideosink,
+    NSObject * object, SEL function, NSObject *data, BOOL waitUntilDone)
+{
+
+  NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
+
+  [object performSelector:function onThread:osxvideosink->ns_app_thread
+          withObject:data waitUntilDone:waitUntilDone];
+  [pool release];
+}
+
+/* Poll for cocoa events */
+static void
+run_ns_app_loop (void) {
+  NSEvent *event;
+  NSAutoreleasePool *pool =[[NSAutoreleasePool alloc] init];
+  NSDate *pollTime = nil;
+
+#ifdef RUN_NS_APP_THREAD
+  /* when running the loop in a thread we want to sleep as long as possible */
+  pollTime = [NSDate distantFuture];
+#else
+  pollTime = [NSDate distantPast];
+#endif
+
+  do {
+      event = [NSApp nextEventMatchingMask:NSAnyEventMask untilDate:pollTime
+          inMode:NSDefaultRunLoopMode dequeue:YES];
+      [NSApp sendEvent:event];
+    }
+  while (event != nil);
+  [pool release];
+}
+
+static void
+gst_osx_videosink_check_main_run_loop (GstOSXVideoSink *sink)
+{
+  /* check if the main run loop is running */
+  gboolean is_running;
+
+  if (sink->mrl_check_done) {
+    return;
+  }
+  /* the easy way */
+  is_running = [[NSRunLoop mainRunLoop] currentMode] != nil;
+  if (is_running) {
+    goto exit;
+  } else {
+    /* the previous check doesn't always work with main loops that run
+     * cocoa's main run loop manually, like the gdk one, giving false
+     * negatives. This check defers a call to the main thread and waits to
+     * be awaken by this function. */
+    NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
+    GstOSXVideoSinkObject * object = (GstOSXVideoSinkObject *) sink->osxvideosinkobject;
+    GTimeVal abstime;
+
+    g_mutex_lock(sink->mrl_check_lock);
+    [object performSelectorOnMainThread:
+          @selector(checkMainRunLoop)
+          withObject:nil waitUntilDone:NO];
+    /* Wait 100 ms */
+    g_get_current_time (&abstime);
+    g_time_val_add (&abstime, 100 * 1000);
+    is_running = g_cond_timed_wait(sink->mrl_check_cond,
+        sink->mrl_check_lock, &abstime);
+    g_mutex_unlock(sink->mrl_check_lock);
+
+    [pool release];
+  }
+
+exit:
+  {
+  GST_DEBUG_OBJECT(sink, "The main runloop %s is running",
+      is_running ? "" : " not ");
+  sink->main_run_loop_running = is_running;
+  sink->mrl_check_done = TRUE;
+  }
+}
+
+static void
+gst_osx_video_sink_run_cocoa_loop (GstOSXVideoSink * sink )
+{
+  /* Cocoa applications require a main runloop running to dispatch UI
+   * events and process deferred calls to the main thread through
+   * perfermSelectorOnMainThread.
+   * Since the sink needs to create it's own Cocoa window when no
+   * external NSView is passed to the sink through the GstXOverlay API,
+   * we need to run the cocoa mainloop somehow.
+   */
+  if (!sink->main_run_loop_running) {
+#ifdef RUN_NS_APP_THREAD
+    /* run the main runloop in a separate thread */
+
+    /* override [NSThread isMainThread] with our own implementation so that we can
+     * make it believe our dedicated thread is the main thread 
+     */
+    Method origIsMainThread = class_getClassMethod([NSThread class],
+        NSSelectorFromString(@"isMainThread"));
+    Method ourIsMainThread = class_getClassMethod([GstOSXVideoSinkObject class],
+        NSSelectorFromString(@"isMainThread"));
+
+    method_exchangeImplementations(origIsMainThread, ourIsMainThread);
+
+    sink->ns_app_thread = [[NSThread alloc]
+        initWithTarget:sink->osxvideosinkobject
+        selector:@selector(nsAppThread) object:nil];
+    [sink->ns_app_thread start];
+
+    g_mutex_lock (sink->loop_thread_lock);
+    while (!sink->app_started)
+      g_cond_wait (sink->loop_thread_cond, sink->loop_thread_lock);
+    g_mutex_unlock (sink->loop_thread_lock);
+#else
+  /* assume that there is a GMainLoop and iterate the main runloop from there
+   */
+    sink->cocoa_timeout = g_timeout_add (10,
+        (GSourceFunc) run_ns_app_loop, NULL);
+#endif
+  }
+}
+
+static void
+gst_osx_video_sink_stop_cocoa_loop (GstOSXVideoSink * osxvideosink)
+{
+#ifndef RUN_NS_APP_THREAD
+  if (osxvideosink->cocoa_timeout)
+    g_source_remove(osxvideosink->cocoa_timeout);
+#endif
+}
+
 /* This function handles osx window creation */
 static gboolean
 gst_osx_video_sink_osxwindow_create (GstOSXVideoSink * osxvideosink, gint width,
@@ -91,6 +235,7 @@ gst_osx_video_sink_osxwindow_create (GstOSXVideoSink * osxvideosink, gint width,
 
   osxwindow->width = width;
   osxwindow->height = height;
+  osxwindow->closed = FALSE;
 
   /* Allocate our GstGLView for the window, and then tell the application
    * about it (hopefully it's listening...) */
@@ -109,6 +254,11 @@ gst_osx_video_sink_osxwindow_create (GstOSXVideoSink * osxvideosink, gint width,
 
   GST_INFO_OBJECT (osxvideosink, "'have-ns-view' message sent");
 
+  osxvideosink->ns_app_thread = [NSThread mainThread];
+  gst_osx_videosink_check_main_run_loop (osxvideosink);
+  gst_osx_video_sink_run_cocoa_loop (osxvideosink);
+  [osxwindow->gstview setMainThread:osxvideosink->ns_app_thread];
+
   /* check if have-ns-view was handled and osxwindow->gstview was added to a
    * superview
    */
@@ -125,16 +275,26 @@ gst_osx_video_sink_osxwindow_create (GstOSXVideoSink * osxvideosink, gint width,
        * from the main thread
        */
       GST_INFO_OBJECT (osxvideosink, "we have a superview, adding our view to it");
-      [osxwindow->gstview performSelectorOnMainThread:@selector(addToSuperview:)
-          withObject:osxvideosink->superview waitUntilDone:YES];
+      gst_osx_video_sink_call_from_main_thread(osxvideosink, osxwindow->gstview,
+          @selector(addToSuperview:), osxvideosink->superview, NO);
+
     } else {
-      /* the view wasn't added to a superview. It's possible that the
-       * application handled have-ns-view, stored our view internally and is
-       * going to add it to a superview later (webkit does that now).
-       */
-      GST_INFO_OBJECT (osxvideosink, "no superview");
+      if (osxvideosink->embed) {
+        /* the view wasn't added to a superview. It's possible that the
+         * application handled have-ns-view, stored our view internally and is
+         * going to add it to a superview later (webkit does that now).
+         */
+        GST_INFO_OBJECT (osxvideosink, "no superview");
+      } else {
+        gst_osx_video_sink_call_from_main_thread(osxvideosink,
+          osxvideosink->osxvideosinkobject,
+          @selector(createInternalWindow), nil, YES);
+        GST_INFO_OBJECT (osxvideosink, "No superview, creating an internal window.");
+      }
     }
   }
+  [osxwindow->gstview setNavigation: GST_NAVIGATION(osxvideosink)];
+  [osxvideosink->osxwindow->gstview setKeepAspectRatio: osxvideosink->keep_par];
 
   [pool release];
 
@@ -149,17 +309,10 @@ gst_osx_video_sink_osxwindow_destroy (GstOSXVideoSink * osxvideosink)
   g_return_if_fail (GST_IS_OSX_VIDEO_SINK (osxvideosink));
   pool = [[NSAutoreleasePool alloc] init];
 
-  if (osxvideosink->osxwindow) {
-    if (osxvideosink->superview) {
-      [osxvideosink->osxwindow->gstview
-          performSelectorOnMainThread:@selector(removeFromSuperview:)
-            withObject:(id)nil waitUntilDone:YES];
-    }
-    [osxvideosink->osxwindow->gstview release];
-
-    g_free (osxvideosink->osxwindow);
-    osxvideosink->osxwindow = NULL;
-  }
+  gst_osx_video_sink_call_from_main_thread(osxvideosink,
+      osxvideosink->osxvideosinkobject,
+      @selector(destroy), (id) nil, YES);
+  gst_osx_video_sink_stop_cocoa_loop (osxvideosink);
   [pool release];
 }
 
@@ -168,6 +321,8 @@ static void
 gst_osx_video_sink_osxwindow_resize (GstOSXVideoSink * osxvideosink,
     GstOSXWindow * osxwindow, guint width, guint height)
 {
+  GstOSXVideoSinkObject *object = osxvideosink->osxvideosinkobject;
+
   NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
   g_return_if_fail (osxwindow != NULL);
   g_return_if_fail (GST_IS_OSX_VIDEO_SINK (osxvideosink));
@@ -178,8 +333,9 @@ gst_osx_video_sink_osxwindow_resize (GstOSXVideoSink * osxvideosink,
   GST_DEBUG_OBJECT (osxvideosink, "Resizing window to (%d,%d)", width, height);
 
   /* Directly resize the underlying view */
-  GST_DEBUG_OBJECT (osxvideosink, "Calling setVideoSize on %p", osxwindow->gstview); 
-  [osxwindow->gstview setVideoSize:width :height];
+  GST_DEBUG_OBJECT (osxvideosink, "Calling setVideoSize on %p", osxwindow->gstview);
+  gst_osx_video_sink_call_from_main_thread(osxvideosink, object,
+      @selector(resize), (id)nil, YES);
 
   [pool release];
 }
@@ -256,6 +412,7 @@ gst_osx_video_sink_change_state (GstElement * element,
     case GST_STATE_CHANGE_PAUSED_TO_READY:
       GST_VIDEO_SINK_WIDTH (osxvideosink) = 0;
       GST_VIDEO_SINK_HEIGHT (osxvideosink) = 0;
+      osxvideosink->app_started = FALSE;
       gst_osx_video_sink_osxwindow_destroy (osxvideosink);
       break;
     case GST_STATE_CHANGE_READY_TO_NULL:
@@ -272,18 +429,17 @@ static GstFlowReturn
 gst_osx_video_sink_show_frame (GstBaseSink * bsink, GstBuffer * buf)
 {
   GstOSXVideoSink *osxvideosink;
-  guint8 *viewdata;
+  GstBufferObject* bufferobject;
   NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
 
   osxvideosink = GST_OSX_VIDEO_SINK (bsink);
-  viewdata = (guint8 *) [osxvideosink->osxwindow->gstview getTextureBuffer];
 
   GST_DEBUG ("show_frame");
-  memcpy (viewdata, GST_BUFFER_DATA (buf), GST_BUFFER_SIZE (buf));
-  [osxvideosink->osxwindow->gstview displayTexture];
-
+  bufferobject = [[GstBufferObject alloc] initWithBuffer:buf];
+  gst_osx_video_sink_call_from_main_thread(osxvideosink,
+      osxvideosink->osxvideosinkobject,
+      @selector(showFrame:), bufferobject, NO);
   [pool release];
-
   return GST_FLOW_OK;
 }
 
@@ -309,7 +465,13 @@ gst_osx_video_sink_set_property (GObject * object, guint prop_id,
 
   switch (prop_id) {
     case ARG_EMBED:
-      /* Ignore, just here for backwards compatibility */
+      osxvideosink->embed = g_value_get_boolean(value);
+      break;
+    case ARG_FORCE_PAR:
+      osxvideosink->keep_par = g_value_get_boolean(value);
+      if (osxvideosink->osxwindow)
+        [osxvideosink->osxwindow->gstview
+            setKeepAspectRatio: osxvideosink->keep_par];
       break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
@@ -329,7 +491,10 @@ gst_osx_video_sink_get_property (GObject * object, guint prop_id,
 
   switch (prop_id) {
     case ARG_EMBED:
-      g_value_set_boolean (value, TRUE);
+      g_value_set_boolean (value, osxvideosink->embed);
+      break;
+    case ARG_FORCE_PAR:
+      g_value_set_boolean (value, osxvideosink->keep_par);
       break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
@@ -339,10 +504,21 @@ gst_osx_video_sink_get_property (GObject * object, guint prop_id,
 
 
 static void
-gst_osx_video_sink_init (GstOSXVideoSink * osxvideosink)
+gst_osx_video_sink_init (GstOSXVideoSink * sink)
 {
-  osxvideosink->osxwindow = NULL;
-  osxvideosink->superview = NULL;
+  sink->osxwindow = NULL;
+  sink->superview = NULL;
+  sink->osxvideosinkobject = [[GstOSXVideoSinkObject alloc] initWithSink:sink];
+#ifdef RUN_NS_APP_THREAD
+  sink->loop_thread_lock = g_mutex_new ();
+  sink->loop_thread_cond = g_cond_new ();
+#endif
+  sink->mrl_check_lock = g_mutex_new ();
+  sink->mrl_check_cond = g_cond_new ();
+  sink->mrl_check_done = FALSE;
+  sink->main_run_loop_running = FALSE;
+  sink->app_started = FALSE;
+  sink->keep_par = FALSE;
 }
 
 static void
@@ -366,6 +542,15 @@ gst_osx_video_sink_finalize (GObject *object)
   if (osxvideosink->superview)
     [osxvideosink->superview release];
 
+  if (osxvideosink->osxvideosinkobject)
+    [(GstOSXVideoSinkObject*)(osxvideosink->osxvideosinkobject) release];
+
+  if (osxvideosink->mrl_check_lock)
+    g_mutex_free (osxvideosink->mrl_check_lock);
+
+  if (osxvideosink->mrl_check_cond)
+    g_cond_free (osxvideosink->mrl_check_cond);
+
   G_OBJECT_CLASS (parent_class)->finalize (object);
 }
 
@@ -402,12 +587,24 @@ gst_osx_video_sink_class_init (GstOSXVideoSinkClass * klass)
   g_object_class_install_property (gobject_class, ARG_EMBED,
       g_param_spec_boolean ("embed", "embed", "For ABI compatiblity only, do not use",
           FALSE, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
+  /**
+   * GstOSXVideoSink:force-aspect-ratio
+   *
+   * When enabled, scaling will respect original aspect ratio.
+   *
+   **/
+
+  g_object_class_install_property (gobject_class, ARG_FORCE_PAR,
+      g_param_spec_boolean ("force-aspect-ratio", "force aspect ration",
+          "When enabled, scaling will respect original aspect ration",
+          FALSE, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 }
 
 static gboolean
 gst_osx_video_sink_interface_supported (GstImplementsInterface * iface, GType type)
 {
-  g_assert (type == GST_TYPE_X_OVERLAY);
+  g_assert (type == GST_TYPE_X_OVERLAY || type == GST_TYPE_NAVIGATION);
   return TRUE;
 }
 
@@ -418,6 +615,73 @@ gst_osx_video_sink_interface_init (GstImplementsInterfaceClass * klass)
 }
 
 static void
+gst_osx_video_sink_navigation_send_event (GstNavigation * navigation,
+    GstStructure * structure)
+{
+  GstOSXVideoSink *osxvideosink = GST_OSX_VIDEO_SINK (navigation);
+  GstPad *peer;
+  GstEvent *event;
+  GstVideoRectangle src, dst, result;
+  NSRect bounds;
+  gdouble x, y, xscale = 1.0, yscale = 1.0;
+
+  peer = gst_pad_get_peer (GST_VIDEO_SINK_PAD (osxvideosink));
+
+  if (!peer || !osxvideosink->osxwindow)
+    return;
+
+  event = gst_event_new_navigation (structure);
+
+  bounds = [osxvideosink->osxwindow->gstview getDrawingBounds];
+
+  if (osxvideosink->keep_par) {
+    /* We get the frame position using the calculated geometry from _setcaps
+       that respect pixel aspect ratios */
+    src.w = GST_VIDEO_SINK_WIDTH (osxvideosink);
+    src.h = GST_VIDEO_SINK_HEIGHT (osxvideosink);
+    dst.w = bounds.size.width;
+    dst.h = bounds.size.height;
+
+    gst_video_sink_center_rect (src, dst, &result, TRUE);
+    result.x += bounds.origin.x;
+    result.y += bounds.origin.y;
+  } else {
+    result.x = bounds.origin.x;
+    result.y = bounds.origin.y;
+    result.w = bounds.size.width;
+    result.h = bounds.size.height;
+  }
+
+  /* We calculate scaling using the original video frames geometry to include
+     pixel aspect ratio scaling. */
+  xscale = (gdouble) osxvideosink->osxwindow->width / result.w;
+  yscale = (gdouble) osxvideosink->osxwindow->height / result.h;
+
+  /* Converting pointer coordinates to the non scaled geometry */
+  if (gst_structure_get_double (structure, "pointer_x", &x)) {
+    x = MIN (x, result.x + result.w);
+    x = MAX (x - result.x, 0);
+    gst_structure_set (structure, "pointer_x", G_TYPE_DOUBLE,
+        (gdouble) x * xscale, NULL);
+  }
+  if (gst_structure_get_double (structure, "pointer_y", &y)) {
+    y = MIN (y, result.y + result.h);
+    y = MAX (y - result.y, 0);
+    gst_structure_set (structure, "pointer_y", G_TYPE_DOUBLE,
+        (gdouble) y * yscale, NULL);
+  }
+
+  gst_pad_send_event (peer, event);
+  gst_object_unref (peer);
+}
+
+static void
+gst_osx_video_sink_navigation_init (GstNavigationInterface * iface)
+{
+  iface->send_event = gst_osx_video_sink_navigation_send_event;
+}
+
+static void
 gst_osx_video_sink_set_window_handle (GstXOverlay * overlay, guintptr handle_id)
 {
   GstOSXVideoSink *osxvideosink = GST_OSX_VIDEO_SINK (overlay);
@@ -426,18 +690,24 @@ gst_osx_video_sink_set_window_handle (GstXOverlay * overlay, guintptr handle_id)
   if (osxvideosink->superview) {
     GST_INFO_OBJECT (osxvideosink, "old xwindow id %p", osxvideosink->superview);
     if (osxvideosink->osxwindow) {
-      [osxvideosink->osxwindow->gstview
-          performSelectorOnMainThread:@selector(removeFromSuperview:)
-            withObject:(id)nil waitUntilDone:YES];
+      gst_osx_video_sink_call_from_main_thread(osxvideosink,
+          osxvideosink->osxwindow->gstview,
+          @selector(removeFromSuperview:), (id)nil, YES);
     }
     [osxvideosink->superview release];
+
   }
 
   GST_INFO_OBJECT (osxvideosink, "set xwindow id 0x%lx", window_id);
   osxvideosink->superview = [((NSView *) window_id) retain];
   if (osxvideosink->osxwindow) {
-      [osxvideosink->osxwindow->gstview performSelectorOnMainThread:@selector(addToSuperview:)
-          withObject:osxvideosink->superview waitUntilDone:YES];
+      gst_osx_video_sink_call_from_main_thread(osxvideosink,
+        osxvideosink->osxwindow->gstview,
+        @selector(addToSuperview:), osxvideosink->superview, YES);
+  }
+
+  if (window_id) {
+    osxvideosink->osxwindow->internal = FALSE;
   }
 }
 
@@ -491,6 +761,11 @@ gst_osx_video_sink_get_type (void)
       NULL,
     };
 
+    static const GInterfaceInfo navigation_info = {
+      (GInterfaceInitFunc) gst_osx_video_sink_navigation_init,
+      NULL,
+      NULL,
+    };
     osxvideosink_type = g_type_register_static (GST_TYPE_VIDEO_SINK,
         "GstOSXVideoSink", &osxvideosink_info, 0);
 
@@ -498,11 +773,219 @@ gst_osx_video_sink_get_type (void)
         GST_TYPE_IMPLEMENTS_INTERFACE, &iface_info);
     g_type_add_interface_static (osxvideosink_type, GST_TYPE_X_OVERLAY,
         &overlay_info);
+    g_type_add_interface_static (osxvideosink_type, GST_TYPE_NAVIGATION,
+        &navigation_info);
   }
 
   return osxvideosink_type;
 }
 
+@implementation GstWindowDelegate
+- (id) initWithSink: (GstOSXVideoSink *) sink
+{
+  self = [super init];
+  self->osxvideosink = sink;
+  return self;
+}
+
+- (void)windowWillClose:(NSNotification *)notification {
+  /* Only handle close events if the window was closed manually by the user
+   * and not becuase of a state change state to READY */
+  if (!osxvideosink->osxwindow->closed) {
+    osxvideosink->osxwindow->closed = TRUE;
+    GST_ELEMENT_ERROR (osxvideosink, RESOURCE, NOT_FOUND, ("Output window was closed"), (NULL));
+    gst_osx_video_sink_osxwindow_destroy(osxvideosink);
+  }
+}
+
+@end
+
+@ implementation GstOSXVideoSinkObject
+
+-(id) initWithSink: (GstOSXVideoSink*) sink
+{
+  self = [super init];
+  self->osxvideosink = sink;
+  return self;
+}
+
+-(void) createInternalWindow
+{
+  GstOSXWindow *osxwindow = osxvideosink->osxwindow;
+  ProcessSerialNumber psn;
+  NSRect rect;
+  unsigned int mask;
+
+  osxwindow->internal = TRUE;
+
+  mask =  NSTitledWindowMask             |
+          NSClosableWindowMask           |
+          NSResizableWindowMask          |
+          NSTexturedBackgroundWindowMask |
+          NSMiniaturizableWindowMask;
+
+  rect.origin.x = 100.0;
+  rect.origin.y = 100.0;
+  rect.size.width = (float) osxwindow->width;
+  rect.size.height = (float) osxwindow->height;
+
+#ifndef RUN_NS_APP_THREAD
+  if (!osxvideosink->app_started) {
+    [NSApplication sharedApplication];
+    [NSApp finishLaunching];
+    osxvideosink->app_started = TRUE;
+  }
+#endif
+
+  if (!GetCurrentProcess(&psn)) {
+      TransformProcessType(&psn, kProcessTransformToForegroundApplication);
+      SetFrontProcess(&psn);
+  }
+
+  osxwindow->win =[[GstOSXVideoSinkWindow alloc]
+                       initWithContentNSRect: rect
+                       styleMask: mask
+                       backing: NSBackingStoreBuffered
+                       defer: NO
+                       screen: nil];
+  GST_DEBUG("VideoSinkWindow created, %p", osxwindow->win);
+  [osxwindow->win makeKeyAndOrderFront:NSApp];
+  osxwindow->gstview =[osxwindow->win gstView];
+  [osxwindow->win setDelegate:[[GstWindowDelegate alloc]
+      initWithSink:osxvideosink]];
+
+}
+
+#ifdef RUN_NS_APP_THREAD
++ (BOOL) isMainThread
+{
+  /* FIXME: ideally we should return YES only for ->ns_app_thread here */
+  return YES;
+}
+#endif
+
+- (void) resize
+{
+  GstOSXWindow *osxwindow = osxvideosink->osxwindow;
+
+  NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
+
+  GST_INFO_OBJECT (osxvideosink, "resizing");
+  NSSize size = {osxwindow->width, osxwindow->height};
+  if (osxwindow->internal) {
+    [osxwindow->win setContentSize:size];
+  }
+  if (osxwindow->gstview) {
+      [osxwindow->gstview setVideoSize :(int)osxwindow->width :(int)osxwindow->height];
+  }
+  GST_INFO_OBJECT (osxvideosink, "done");
+
+  [pool release];
+}
+
+- (void) showFrame: (GstBufferObject *) object
+{
+  guint8 *viewdata;
+  NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
+  GstBuffer *buf = object->buf;
+
+  if (!destroyed)
+  {
+    viewdata = (guint8 *) [osxvideosink->osxwindow->gstview getTextureBuffer];
+
+    memcpy (viewdata, GST_BUFFER_DATA(buf), GST_BUFFER_SIZE(buf));
+    [osxvideosink->osxwindow->gstview displayTexture];
+  }
+
+  [object release];
+
+  [pool release];
+}
+
+-(void) destroy
+{
+  NSAutoreleasePool *pool;
+
+  pool = [[NSAutoreleasePool alloc] init];
+
+  destroyed = TRUE;
+
+  if (osxvideosink->osxwindow) {
+    if (osxvideosink->superview) {
+      [osxvideosink->osxwindow->gstview removeFromSuperview];
+    }
+    [osxvideosink->osxwindow->gstview release];
+    if (osxvideosink->osxwindow->internal) {
+      if (!osxvideosink->osxwindow->closed) {
+        osxvideosink->osxwindow->closed = TRUE;
+        [osxvideosink->osxwindow->win release];
+      }
+    }
+
+    g_free (osxvideosink->osxwindow);
+    osxvideosink->osxwindow = NULL;
+  }
+  [pool release];
+}
+
+#ifdef RUN_NS_APP_THREAD
+-(void) nsAppThread
+{
+  NSAutoreleasePool *pool;
+  GstOSXVideoSink *sink = osxvideosink;
+
+  /* set the main runloop as the runloop for the current thread. This has the
+   * effect that calling NSApp nextEventMatchingMask:untilDate:inMode:dequeue
+   * runs the main runloop.
+   */
+  _CFRunLoopSetCurrent(CFRunLoopGetMain());
+
+  /* this is needed to make IsMainThread checks in core foundation work from the
+   * current thread
+   */
+  _CFMainPThread = pthread_self();
+
+  pool = [[NSAutoreleasePool alloc] init];
+
+  [NSApplication sharedApplication];
+  [NSApp finishLaunching];
+
+  g_mutex_lock (sink->loop_thread_lock);
+  sink->app_started = TRUE;
+  g_cond_signal (sink->loop_thread_cond);
+  g_mutex_unlock (sink->loop_thread_lock);
+
+  /* run the loop */
+  run_ns_app_loop ();
+
+  [pool release];
+}
+#endif
+
+-(void) checkMainRunLoop
+{
+  g_mutex_lock(osxvideosink->mrl_check_lock);
+  g_cond_signal(osxvideosink->mrl_check_cond);
+  g_mutex_unlock(osxvideosink->mrl_check_lock);
+}
+
+@end
+
+@ implementation GstBufferObject
+-(id) initWithBuffer: (GstBuffer*) buffer
+{
+  self = [super init];
+  gst_buffer_ref(buffer);
+  self->buf = buffer;
+  return self;
+}
+
+-(void) dealloc{
+  gst_buffer_unref(buf);
+  [super dealloc];
+}
+@end
+
 static gboolean
 plugin_init (GstPlugin * plugin)
 {
diff --git a/sys/sunaudio/Makefile.in b/sys/sunaudio/Makefile.in
index a1d1abd..126cc24 100644
--- a/sys/sunaudio/Makefile.in
+++ b/sys/sunaudio/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = sys/sunaudio
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -124,10 +140,23 @@ libgstsunaudio_la_OBJECTS = $(am_libgstsunaudio_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstsunaudio_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstsunaudio_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstsunaudio_la_CFLAGS) $(CFLAGS) \
 	$(libgstsunaudio_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -140,22 +169,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstsunaudio_la_SOURCES)
 DIST_SOURCES = $(libgstsunaudio_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -215,6 +245,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -263,8 +294,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -345,7 +378,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -405,6 +438,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -478,7 +512,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -543,7 +581,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -551,6 +588,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -566,12 +605,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstsunaudio.la: $(libgstsunaudio_la_OBJECTS) $(libgstsunaudio_la_DEPENDENCIES) $(EXTRA_libgstsunaudio_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstsunaudio_la_LINK) -rpath $(plugindir) $(libgstsunaudio_la_OBJECTS) $(libgstsunaudio_la_LIBADD) $(LIBS)
 
@@ -714,6 +755,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -858,18 +913,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/sys/v4l2/Makefile.am b/sys/v4l2/Makefile.am
index a7a99de..b6d6de9 100644
--- a/sys/v4l2/Makefile.am
+++ b/sys/v4l2/Makefile.am
@@ -8,6 +8,23 @@ xv_source =
 xv_libs =
 endif
 
+glib_gen_prefix = __gst_v4l2
+glib_gen_basename = gstv4l2
+
+include $(top_srcdir)/common/gst-glib-gen.mak
+
+built_sources = gstv4l2-marshal.c
+built_headers = gstv4l2-marshal.h
+
+BUILT_SOURCES = $(built_sources) $(built_headers)
+
+CLEANFILES = $(BUILT_SOURCES)
+
+nodist_libgstvideo4linux2_la_SOURCES = \
+      $(built_sources)
+
+EXTRA_DIST = gstv4l2-marshal.list
+
 libgstvideo4linux2_la_SOURCES = gstv4l2.c \
 				gstv4l2colorbalance.c \
 				gstv4l2object.c \
diff --git a/sys/v4l2/Makefile.in b/sys/v4l2/Makefile.in
index c9ad860..15d9bdf 100644
--- a/sys/v4l2/Makefile.in
+++ b/sys/v4l2/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,8 +14,33 @@
 
 @SET_MAKE@
 
+# these are the variables your Makefile.am should set
+# the example is based on the colorbalance interface
+
+#glib_enum_headers=$(colorbalance_headers)
+#glib_enum_define=GST_COLOR_BALANCE
+#glib_gen_prefix=gst_color_balance
+#glib_gen_basename=colorbalance
+
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,16 +59,17 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
+DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
+	$(srcdir)/Makefile.in $(top_srcdir)/common/gst-glib-gen.mak \
+	$(top_srcdir)/depcomp
 @BUILD_EXPERIMENTAL_TRUE@am__append_1 = gstv4l2sink.c
 subdir = sys/v4l2
-DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -138,14 +163,30 @@ am_libgstvideo4linux2_la_OBJECTS = libgstvideo4linux2_la-gstv4l2.lo \
 	libgstvideo4linux2_la-v4l2_calls.lo \
 	libgstvideo4linux2_la-v4l2src_calls.lo $(am__objects_1) \
 	$(am__objects_2)
-libgstvideo4linux2_la_OBJECTS = $(am_libgstvideo4linux2_la_OBJECTS)
+am__objects_3 = libgstvideo4linux2_la-gstv4l2-marshal.lo
+nodist_libgstvideo4linux2_la_OBJECTS = $(am__objects_3)
+libgstvideo4linux2_la_OBJECTS = $(am_libgstvideo4linux2_la_OBJECTS) \
+	$(nodist_libgstvideo4linux2_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstvideo4linux2_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstvideo4linux2_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstvideo4linux2_la_CFLAGS) $(CFLAGS) \
 	$(libgstvideo4linux2_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -158,22 +199,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
-SOURCES = $(libgstvideo4linux2_la_SOURCES)
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
+SOURCES = $(libgstvideo4linux2_la_SOURCES) \
+	$(nodist_libgstvideo4linux2_la_SOURCES)
 DIST_SOURCES = $(am__libgstvideo4linux2_la_SOURCES_DIST)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -233,6 +276,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -281,8 +325,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -363,7 +409,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -423,6 +469,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -496,7 +543,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -505,6 +556,17 @@ plugin_LTLIBRARIES = libgstvideo4linux2.la
 @USE_XVIDEO_TRUE@xv_source = gstv4l2xoverlay.c
 @USE_XVIDEO_FALSE@xv_libs = 
 @USE_XVIDEO_TRUE@xv_libs = $(X_LIBS) $(XVIDEO_LIBS)
+glib_gen_prefix = __gst_v4l2
+glib_gen_basename = gstv4l2
+enum_headers = $(foreach h,$(glib_enum_headers),\n\#include \"$(h)\")
+built_sources = gstv4l2-marshal.c
+built_headers = gstv4l2-marshal.h
+BUILT_SOURCES = $(built_sources) $(built_headers)
+CLEANFILES = $(BUILT_SOURCES)
+nodist_libgstvideo4linux2_la_SOURCES = \
+      $(built_sources)
+
+EXTRA_DIST = gstv4l2-marshal.list
 libgstvideo4linux2_la_SOURCES = gstv4l2.c gstv4l2colorbalance.c \
 	gstv4l2object.c gstv4l2bufferpool.c gstv4l2src.c \
 	gstv4l2radio.c gstv4l2tuner.c gstv4l2vidorient.c v4l2_calls.c \
@@ -543,11 +605,12 @@ noinst_HEADERS = \
 	v4l2_calls.h \
 	v4l2src_calls.h
 
-all: all-am
+all: $(BUILT_SOURCES)
+	$(MAKE) $(AM_MAKEFLAGS) all-am
 
 .SUFFIXES:
 .SUFFIXES: .c .lo .o .obj
-$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am $(top_srcdir)/common/gst-glib-gen.mak $(am__configure_deps)
 	@for dep in $?; do \
 	  case '$(am__configure_deps)' in \
 	    *$$dep*) \
@@ -568,6 +631,7 @@ Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
 	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
 	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
 	esac;
+$(top_srcdir)/common/gst-glib-gen.mak:
 
 $(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
@@ -579,7 +643,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -587,6 +650,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -602,12 +667,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstvideo4linux2.la: $(libgstvideo4linux2_la_OBJECTS) $(libgstvideo4linux2_la_DEPENDENCIES) $(EXTRA_libgstvideo4linux2_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstvideo4linux2_la_LINK) -rpath $(plugindir) $(libgstvideo4linux2_la_OBJECTS) $(libgstvideo4linux2_la_LIBADD) $(LIBS)
 
@@ -617,6 +684,7 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstvideo4linux2_la-gstv4l2-marshal.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstvideo4linux2_la-gstv4l2.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstvideo4linux2_la-gstv4l2bufferpool.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstvideo4linux2_la-gstv4l2colorbalance.Plo@am__quote@
@@ -735,6 +803,13 @@ libgstvideo4linux2_la-gstv4l2sink.lo: gstv4l2sink.c
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstvideo4linux2_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstvideo4linux2_la_CFLAGS) $(CFLAGS) -c -o libgstvideo4linux2_la-gstv4l2sink.lo `test -f 'gstv4l2sink.c' || echo '$(srcdir)/'`gstv4l2sink.c
 
+libgstvideo4linux2_la-gstv4l2-marshal.lo: gstv4l2-marshal.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstvideo4linux2_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstvideo4linux2_la_CFLAGS) $(CFLAGS) -MT libgstvideo4linux2_la-gstv4l2-marshal.lo -MD -MP -MF $(DEPDIR)/libgstvideo4linux2_la-gstv4l2-marshal.Tpo -c -o libgstvideo4linux2_la-gstv4l2-marshal.lo `test -f 'gstv4l2-marshal.c' || echo '$(srcdir)/'`gstv4l2-marshal.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libgstvideo4linux2_la-gstv4l2-marshal.Tpo $(DEPDIR)/libgstvideo4linux2_la-gstv4l2-marshal.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='gstv4l2-marshal.c' object='libgstvideo4linux2_la-gstv4l2-marshal.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(libgstvideo4linux2_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstvideo4linux2_la_CFLAGS) $(CFLAGS) -c -o libgstvideo4linux2_la-gstv4l2-marshal.lo `test -f 'gstv4l2-marshal.c' || echo '$(srcdir)/'`gstv4l2-marshal.c
+
 mostlyclean-libtool:
 	-rm -f *.lo
 
@@ -790,6 +865,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -824,13 +913,15 @@ distdir: $(DISTFILES)
 	  fi; \
 	done
 check-am: all-am
-check: check-am
+check: $(BUILT_SOURCES)
+	$(MAKE) $(AM_MAKEFLAGS) check-am
 all-am: Makefile $(LTLIBRARIES) $(HEADERS)
 installdirs:
 	for dir in "$(DESTDIR)$(plugindir)"; do \
 	  test -z "$$dir" || $(MKDIR_P) "$$dir"; \
 	done
-install: install-am
+install: $(BUILT_SOURCES)
+	$(MAKE) $(AM_MAKEFLAGS) install-am
 install-exec: install-exec-am
 install-data: install-data-am
 uninstall: uninstall-am
@@ -852,6 +943,7 @@ install-strip:
 mostlyclean-generic:
 
 clean-generic:
+	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
 
 distclean-generic:
 	-test -z "$(CONFIG_CLEAN_FILES)" || rm -f $(CONFIG_CLEAN_FILES)
@@ -860,6 +952,7 @@ distclean-generic:
 maintainer-clean-generic:
 	@echo "This command is intended for maintainers to use"
 	@echo "it deletes files that may require special tools to rebuild."
+	-test -z "$(BUILT_SOURCES)" || rm -f $(BUILT_SOURCES)
 clean: clean-am
 
 clean-am: clean-generic clean-libtool clean-pluginLTLIBRARIES \
@@ -931,22 +1024,59 @@ ps-am:
 
 uninstall-am: uninstall-pluginLTLIBRARIES
 
-.MAKE: install-am install-strip
+.MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
-
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
+
+
+# these are all the rules generating the relevant files
+$(glib_gen_basename)-marshal.h: $(glib_gen_basename)-marshal.list
+	$(AM_V_GEN)glib-genmarshal --header --prefix=$(glib_gen_prefix)_marshal $^ > $(glib_gen_basename)-marshal.h.tmp && \
+	mv $(glib_gen_basename)-marshal.h.tmp $(glib_gen_basename)-marshal.h
+
+$(glib_gen_basename)-marshal.c: $(glib_gen_basename)-marshal.list
+	$(AM_V_GEN)echo "#include \"$(glib_gen_basename)-marshal.h\"" >> $(glib_gen_basename)-marshal.c.tmp && \
+	glib-genmarshal --body --prefix=$(glib_gen_prefix)_marshal $^ >> $(glib_gen_basename)-marshal.c.tmp && \
+	mv $(glib_gen_basename)-marshal.c.tmp $(glib_gen_basename)-marshal.c
+
+$(glib_gen_basename)-enumtypes.h: $(glib_enum_headers)
+	$(AM_V_GEN)glib-mkenums \
+	--fhead "#ifndef __$(glib_enum_define)_ENUM_TYPES_H__\n#define __$(glib_enum_define)_ENUM_TYPES_H__\n\n#include <glib-object.h>\n\nG_BEGIN_DECLS\n" \
+	--fprod "\n/* enumerations from \"@filename@\" */\n" \
+	--vhead "GType @enum_name@_get_type (void);\n#define GST_TYPE_@ENUMSHORT@ (@enum_name@_get_type())\n"         \
+	--ftail "G_END_DECLS\n\n#endif /* __$(glib_enum_define)_ENUM_TYPES_H__ */" \
+	$^ > $@
+
+$(glib_gen_basename)-enumtypes.c: $(glib_enum_headers)
+	@if test "x$(glib_enum_headers)" = "x"; then echo "ERROR: glib_enum_headers is empty, please fix Makefile"; exit 1; fi
+	$(AM_V_GEN)glib-mkenums \
+	--fhead "#include \"$(glib_gen_basename)-enumtypes.h\"\n$(enum_headers)" \
+	--fprod "\n/* enumerations from \"@filename@\" */" \
+	--vhead "GType\n@enum_name@_get_type (void)\n{\n  static volatile gsize g_define_type_id__volatile = 0;\n  if (g_once_init_enter (&g_define_type_id__volatile)) {\n    static const G@Type@Value values[] = {"     \
+	--vprod "      { @VALUENAME@, \"@VALUENAME@\", \"@valuenick@\" }," \
+	--vtail "      { 0, NULL, NULL }\n    };\n    GType g_define_type_id = g_@type@_register_static (\"@EnumName@\", values);\n    g_once_init_leave (&g_define_type_id__volatile, g_define_type_id);\n  }\n  return g_define_type_id__volatile;\n}\n" \
+	$^ > $@
+
+# a hack rule to make sure .Plo files exist because they get include'd
+# from Makefile's
+.deps/%-marshal.Plo:
+	@touch $@
+
+.deps/%-enumtypes.Plo:
+	@touch $@
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
diff --git a/sys/v4l2/gstv4l2-marshal.list b/sys/v4l2/gstv4l2-marshal.list
new file mode 100644
index 0000000..266c722
--- /dev/null
+++ b/sys/v4l2/gstv4l2-marshal.list
@@ -0,0 +1 @@
+VOID:INT,UINT,UINT,UINT
diff --git a/sys/v4l2/gstv4l2bufferpool.c b/sys/v4l2/gstv4l2bufferpool.c
index b81c6a4..5aaed5a 100644
--- a/sys/v4l2/gstv4l2bufferpool.c
+++ b/sys/v4l2/gstv4l2bufferpool.c
@@ -98,6 +98,7 @@ gst_v4l2_buffer_finalize (GstV4l2Buffer * buffer)
     GST_LOG_OBJECT (pool->v4l2elem, "reviving buffer %p, %d", buffer, index);
     gst_buffer_ref (GST_BUFFER (buffer));
     GST_BUFFER_SIZE (buffer) = 0;
+    GST_BUFFER_FLAG_UNSET (buffer, GST_BUFFER_FLAG_DISCONT);
     pool->buffers[index] = buffer;
   }
 
@@ -106,9 +107,9 @@ gst_v4l2_buffer_finalize (GstV4l2Buffer * buffer)
   if (!resuscitated) {
     GST_LOG_OBJECT (pool->v4l2elem,
         "buffer %p (data %p, len %u) not recovered, unmapping",
-        buffer, GST_BUFFER_DATA (buffer), buffer->vbuffer.length);
+        buffer, GST_BUFFER_DATA (buffer), buffer->mmap_length);
     gst_mini_object_unref (GST_MINI_OBJECT (pool));
-    v4l2_munmap ((void *) GST_BUFFER_DATA (buffer), buffer->vbuffer.length);
+    v4l2_munmap ((void *) GST_BUFFER_DATA (buffer), buffer->mmap_length);
 
     GST_MINI_OBJECT_CLASS (v4l2buffer_parent_class)->finalize (GST_MINI_OBJECT
         (buffer));
@@ -181,8 +182,8 @@ gst_v4l2_buffer_new (GstV4l2BufferPool * pool, guint index, GstCaps * caps)
     GST_LOG_OBJECT (pool->v4l2elem, "  MMAP offset:  %u",
         ret->vbuffer.m.offset);
   GST_LOG_OBJECT (pool->v4l2elem, "  length:    %u", ret->vbuffer.length);
-  GST_LOG_OBJECT (pool->v4l2elem, "  input:     %u", ret->vbuffer.input);
 
+  ret->mmap_length = ret->vbuffer.length;
   data = (guint8 *) v4l2_mmap (0, ret->vbuffer.length,
       PROT_READ | PROT_WRITE, MAP_SHARED, pool->video_fd,
       ret->vbuffer.m.offset);
@@ -436,6 +437,7 @@ buffer_new_failed:
 void
 gst_v4l2_buffer_pool_destroy (GstV4l2BufferPool * pool)
 {
+  struct v4l2_requestbuffers breq;
   gint n;
 
   GST_V4L2_BUFFER_POOL_LOCK (pool);
@@ -462,6 +464,19 @@ gst_v4l2_buffer_pool_destroy (GstV4l2BufferPool * pool)
       gst_buffer_unref (buf);
   }
 
+  /* Free the buffers from the kernel too */
+  GST_DEBUG_OBJECT (pool->v4l2elem, "Freeing the buffers from the kernel");
+
+  memset (&breq, 0, sizeof (struct v4l2_requestbuffers));
+  breq.type = pool->type;
+  breq.count = 0;
+  breq.memory = V4L2_MEMORY_MMAP;
+
+  if (v4l2_ioctl (pool->video_fd, VIDIOC_REQBUFS, &breq) < 0) {
+    /* Not much else we can do here */
+    GST_WARNING_OBJECT (pool->v4l2elem, "Error freeing the kernel buffers");
+  }
+
   gst_mini_object_unref (GST_MINI_OBJECT (pool));
 }
 
diff --git a/sys/v4l2/gstv4l2bufferpool.h b/sys/v4l2/gstv4l2bufferpool.h
index caad9ac..36ea323 100644
--- a/sys/v4l2/gstv4l2bufferpool.h
+++ b/sys/v4l2/gstv4l2bufferpool.h
@@ -70,6 +70,9 @@ struct _GstV4l2Buffer {
   GstBuffer   buffer;
 
   struct v4l2_buffer vbuffer;
+  /* warning: the size of mmap buffer and
+   * the actual frame-buffer can be different. */
+  size_t mmap_length;
 
   /* FIXME: have GstV4l2Src* instead, as this has GstV4l2BufferPool* */
   /* FIXME: do we really want to fix this if GstV4l2Buffer/Pool is shared
diff --git a/sys/v4l2/gstv4l2object.c b/sys/v4l2/gstv4l2object.c
index 81d1cb7..1238e52 100644
--- a/sys/v4l2/gstv4l2object.c
+++ b/sys/v4l2/gstv4l2object.c
@@ -18,6 +18,10 @@
  * USA.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #include <config.h>
 #endif
@@ -836,6 +840,10 @@ static const GstV4L2FormatDesc gst_v4l2_formats[] = {
   {V4L2_PIX_FMT_DV, TRUE},
   {V4L2_PIX_FMT_MPEG, FALSE},
 
+#ifdef V4L2_PIX_FMT_H264
+  {V4L2_PIX_FMT_H264, TRUE},
+#endif
+
   /*  Vendor-specific formats   */
   {V4L2_PIX_FMT_WNVA, TRUE},
 
@@ -1151,6 +1159,11 @@ gst_v4l2_object_v4l2fourcc_to_structure (guint32 fourcc)
     case V4L2_PIX_FMT_JPEG:    /* JFIF JPEG */
       structure = gst_structure_new ("image/jpeg", NULL);
       break;
+#ifdef V4L2_PIX_FMT_H264
+    case V4L2_PIX_FMT_H264:    /* H.264 */
+      structure = gst_structure_new ("video/x-h264", NULL);
+      break;
+#endif
     case V4L2_PIX_FMT_RGB332:
     case V4L2_PIX_FMT_RGB555:
     case V4L2_PIX_FMT_RGB555X:
@@ -1208,18 +1221,22 @@ gst_v4l2_object_v4l2fourcc_to_structure (guint32 fourcc)
           b_mask = 0xff0000;
           break;
         case V4L2_PIX_FMT_RGB32:
-          bpp = depth = 32;
+          /* GST_VIDEO_FORMAT_RGBx */
+          bpp = 32;
+          depth = 24;
           endianness = G_BIG_ENDIAN;
           r_mask = 0xff000000;
           g_mask = 0x00ff0000;
           b_mask = 0x0000ff00;
           break;
         case V4L2_PIX_FMT_BGR32:
-          bpp = depth = 32;
+          /* GST_VIDEO_FORMAT_BGRx */
+          bpp = 32;
+          depth = 24;
           endianness = G_BIG_ENDIAN;
-          r_mask = 0x000000ff;
-          g_mask = 0x0000ff00;
-          b_mask = 0x00ff0000;
+          r_mask = 0x0000ff00;
+          g_mask = 0x00ff0000;
+          b_mask = 0xff000000;
           break;
         default:
           g_assert_not_reached ();
@@ -1480,8 +1497,9 @@ gst_v4l2_object_get_caps_info (GstV4l2Object * v4l2object, GstCaps * caps,
 #endif
     }
   } else if (!strcmp (mimetype, "video/x-raw-rgb")) {
-    gint depth, endianness, r_mask;
+    gint bpp, depth, endianness, r_mask;
 
+    gst_structure_get_int (structure, "bpp", &bpp);
     gst_structure_get_int (structure, "depth", &depth);
     gst_structure_get_int (structure, "endianness", &endianness);
     gst_structure_get_int (structure, "red_mask", &r_mask);
@@ -1499,16 +1517,20 @@ gst_v4l2_object_get_caps_info (GstV4l2Object * v4l2object, GstCaps * caps,
             V4L2_PIX_FMT_RGB565 : V4L2_PIX_FMT_RGB565X;
         break;
       case 24:
-        fourcc = (r_mask == 0xFF) ? V4L2_PIX_FMT_BGR24 : V4L2_PIX_FMT_RGB24;
-        break;
-      case 32:
-        fourcc = (r_mask == 0xFF) ? V4L2_PIX_FMT_BGR32 : V4L2_PIX_FMT_RGB32;
+        if (bpp == 24)
+          fourcc = (r_mask == 0xFF) ? V4L2_PIX_FMT_BGR24 : V4L2_PIX_FMT_RGB24;
+        else
+          fourcc = (r_mask == 0xFF00) ? V4L2_PIX_FMT_BGR32 : V4L2_PIX_FMT_RGB32;
         break;
     }
   } else if (strcmp (mimetype, "video/x-dv") == 0) {
     fourcc = V4L2_PIX_FMT_DV;
   } else if (strcmp (mimetype, "image/jpeg") == 0) {
     fourcc = V4L2_PIX_FMT_JPEG;
+#ifdef V4L2_PIX_FMT_H264
+  } else if (strcmp (mimetype, "video/x-h264") == 0) {
+    fourcc = V4L2_PIX_FMT_H264;
+#endif
 #ifdef V4L2_PIX_FMT_SBGGR8
   } else if (strcmp (mimetype, "video/x-raw-bayer") == 0) {
     fourcc = V4L2_PIX_FMT_SBGGR8;
@@ -1561,10 +1583,18 @@ gst_v4l2_object_probe_caps_for_format_and_size (GstV4l2Object * v4l2object,
   gint int_width = width;
   gint int_height = height;
 
-  /* interlaced detection using VIDIOC_TRY/S_FMT */
-  if (!gst_v4l2_object_get_nearest_size (v4l2object, pixelformat,
-          &int_width, &int_height, &interlaced))
-    return NULL;
+  if (!strcmp ((char *) v4l2object->vcap.driver, "uvcvideo")) {
+    /*
+     * UVC devices are never interlaced, and doing VIDIOC_TRY_FMT on them
+     * causes expensive and slow USB IO, so don't probe them for interlaced
+     */
+    interlaced = FALSE;
+  } else {
+    /* Interlaced detection using VIDIOC_TRY/S_FMT */
+    if (!gst_v4l2_object_get_nearest_size (v4l2object, pixelformat,
+            &int_width, &int_height, &interlaced))
+      return NULL;
+  }
 
   memset (&ival, 0, sizeof (struct v4l2_frmivalenum));
   ival.index = 0;
diff --git a/sys/v4l2/gstv4l2sink.c b/sys/v4l2/gstv4l2sink.c
index f6aba24..267b06d 100644
--- a/sys/v4l2/gstv4l2sink.c
+++ b/sys/v4l2/gstv4l2sink.c
@@ -107,12 +107,10 @@ gst_v4l2sink_iface_supported (GstImplementsInterface * iface, GType iface_type)
   g_assert (iface_type == GST_TYPE_X_OVERLAY ||
       iface_type == GST_TYPE_NAVIGATION ||
       iface_type == GST_TYPE_COLOR_BALANCE ||
-      iface_type == GST_TYPE_VIDEO_ORIENTATION ||
-      iface_type == GST_TYPE_TUNER);
+      iface_type == GST_TYPE_VIDEO_ORIENTATION || iface_type == GST_TYPE_TUNER);
 #else
   g_assert (iface_type == GST_TYPE_COLOR_BALANCE ||
-      iface_type == GST_TYPE_VIDEO_ORIENTATION ||
-      iface_type == GST_TYPE_TUNER);
+      iface_type == GST_TYPE_VIDEO_ORIENTATION || iface_type == GST_TYPE_TUNER);
 #endif
 
   if (v4l2object->video_fd == -1)
@@ -844,6 +842,7 @@ gst_v4l2sink_show_frame (GstBaseSink * bsink, GstBuffer * buf)
   GST_DEBUG_OBJECT (v4l2sink, "render buffer: %p", buf);
 
   if (!GST_IS_V4L2_BUFFER (buf)) {
+    GstCaps *caps;
     GstFlowReturn ret;
 
     /* special case check for sub-buffers:  In certain cases, places like
@@ -872,9 +871,12 @@ gst_v4l2sink_show_frame (GstBaseSink * bsink, GstBuffer * buf)
     GST_DEBUG_OBJECT (v4l2sink, "slow-path.. I got a %s so I need to memcpy",
         g_type_name (G_OBJECT_TYPE (buf)));
 
+    caps = GST_BUFFER_CAPS (buf);
+    if (!caps)
+      caps = v4l2sink->current_caps;
+
     ret = gst_v4l2sink_buffer_alloc (bsink,
-        GST_BUFFER_OFFSET (buf), GST_BUFFER_SIZE (buf), GST_BUFFER_CAPS (buf),
-        &newbuf);
+        GST_BUFFER_OFFSET (buf), GST_BUFFER_SIZE (buf), caps, &newbuf);
 
     if (GST_FLOW_OK != ret) {
       GST_DEBUG_OBJECT (v4l2sink,
diff --git a/sys/v4l2/gstv4l2src.c b/sys/v4l2/gstv4l2src.c
index f8ae09c..f0a04af 100644
--- a/sys/v4l2/gstv4l2src.c
+++ b/sys/v4l2/gstv4l2src.c
@@ -51,6 +51,7 @@
 #include "v4l2src_calls.h"
 #include <unistd.h>
 
+#include "gstv4l2-marshal.h"
 #include "gstv4l2colorbalance.h"
 #include "gstv4l2tuner.h"
 #ifdef HAVE_XVIDEO
@@ -78,6 +79,15 @@ enum
   PROP_DECIMATE
 };
 
+/* signals and args */
+enum
+{
+  SIGNAL_PRE_SET_FORMAT,
+  LAST_SIGNAL
+};
+
+static guint gst_v4l2_signals[LAST_SIGNAL] = { 0 };
+
 GST_IMPLEMENT_V4L2_PROBE_METHODS (GstV4l2SrcClass, gst_v4l2src);
 GST_IMPLEMENT_V4L2_COLOR_BALANCE_METHODS (GstV4l2Src, gst_v4l2src);
 GST_IMPLEMENT_V4L2_TUNER_METHODS (GstV4l2Src, gst_v4l2src);
@@ -96,14 +106,14 @@ gst_v4l2src_iface_supported (GstImplementsInterface * iface, GType iface_type)
 
 #ifdef HAVE_XVIDEO
   if (!(iface_type == GST_TYPE_TUNER ||
-        iface_type == GST_TYPE_X_OVERLAY ||
-        iface_type == GST_TYPE_COLOR_BALANCE ||
-        iface_type == GST_TYPE_VIDEO_ORIENTATION))
+          iface_type == GST_TYPE_X_OVERLAY ||
+          iface_type == GST_TYPE_COLOR_BALANCE ||
+          iface_type == GST_TYPE_VIDEO_ORIENTATION))
     return FALSE;
 #else
   if (!(iface_type == GST_TYPE_TUNER ||
-        iface_type == GST_TYPE_COLOR_BALANCE ||
-        iface_type == GST_TYPE_VIDEO_ORIENTATION))
+          iface_type == GST_TYPE_COLOR_BALANCE ||
+          iface_type == GST_TYPE_VIDEO_ORIENTATION))
     return FALSE;
 #endif
 
@@ -285,6 +295,30 @@ gst_v4l2src_class_init (GstV4l2SrcClass * klass)
           "Only use every nth frame", 1, G_MAXINT,
           PROP_DEF_DECIMATE, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
+  /**
+   * GstV4l2Src::prepare-format:
+   * @v4l2src: the v4l2src instance
+   * @fd: the file descriptor of the current device
+   * @fourcc: the fourcc of the format being set
+   * @width: The width of the video
+   * @height: The height of the video
+   *
+   * This signal gets emitted before calling the v4l2 VIDIOC_S_FMT ioctl
+   * (set format). This allows for any custom configuration of the device to
+   * happen prior to the format being set.
+   * This is mostly useful for UVC H264 encoding cameras which need the H264
+   * Probe & Commit to happen prior to the normal Probe & Commit.
+   *
+   * Since: 0.10.32
+   */
+  gst_v4l2_signals[SIGNAL_PRE_SET_FORMAT] = g_signal_new ("prepare-format",
+      G_TYPE_FROM_CLASS (klass),
+      G_SIGNAL_RUN_LAST,
+      0,
+      NULL, NULL,
+      __gst_v4l2_marshal_VOID__INT_UINT_UINT_UINT,
+      G_TYPE_NONE, 4, G_TYPE_INT, G_TYPE_UINT, G_TYPE_UINT, G_TYPE_UINT);
+
   basesrc_class->get_caps = GST_DEBUG_FUNCPTR (gst_v4l2src_get_caps);
   basesrc_class->set_caps = GST_DEBUG_FUNCPTR (gst_v4l2src_set_caps);
   basesrc_class->start = GST_DEBUG_FUNCPTR (gst_v4l2src_start);
diff --git a/sys/v4l2/gstv4l2xoverlay.c b/sys/v4l2/gstv4l2xoverlay.c
index 60d0919..f1c4d51 100644
--- a/sys/v4l2/gstv4l2xoverlay.c
+++ b/sys/v4l2/gstv4l2xoverlay.c
@@ -32,6 +32,8 @@
 #include <X11/extensions/Xv.h>
 #include <X11/extensions/Xvlib.h>
 #include <sys/stat.h>
+/* for XkbKeycodeToKeysym */
+#include <X11/XKBlib.h>
 
 #include <gst/interfaces/navigation.h>
 
@@ -323,7 +325,7 @@ event_refresh (gpointer data)
           case KeyPress:
           case KeyRelease:
             g_mutex_lock (v4l2xv->mutex);
-            keysym = XKeycodeToKeysym (v4l2xv->dpy, e.xkey.keycode, 0);
+            keysym = XkbKeycodeToKeysym (v4l2xv->dpy, e.xkey.keycode, 0, 0);
             if (keysym != NoSymbol) {
               key_str = XKeysymToString (keysym);
             } else {
diff --git a/sys/v4l2/v4l2_calls.c b/sys/v4l2/v4l2_calls.c
index 309bfb6..e0eefb0 100644
--- a/sys/v4l2/v4l2_calls.c
+++ b/sys/v4l2/v4l2_calls.c
@@ -132,7 +132,7 @@ gst_v4l2_fill_lists (GstV4l2Object * v4l2object)
 
     input.index = n;
     if (v4l2_ioctl (v4l2object->video_fd, VIDIOC_ENUMINPUT, &input) < 0) {
-      if (errno == EINVAL)
+      if (errno == EINVAL || errno == ENOTTY)
         break;                  /* end of enumeration */
       else {
         GST_ELEMENT_ERROR (e, RESOURCE, SETTINGS,
@@ -148,7 +148,7 @@ gst_v4l2_fill_lists (GstV4l2Object * v4l2object)
     GST_LOG_OBJECT (e, "   name:      '%s'", input.name);
     GST_LOG_OBJECT (e, "   type:      %08x", input.type);
     GST_LOG_OBJECT (e, "   audioset:  %08x", input.audioset);
-    GST_LOG_OBJECT (e, "   std:       %016x", (guint) input.std);
+    GST_LOG_OBJECT (e, "   std:       %016" G_GINT64_MODIFIER "x", input.std);
     GST_LOG_OBJECT (e, "   status:    %08x", input.status);
 
     v4l2channel = g_object_new (GST_TYPE_V4L2_TUNER_CHANNEL, NULL);
diff --git a/sys/v4l2/v4l2src_calls.c b/sys/v4l2/v4l2src_calls.c
index bfa5589..fa9a55c 100644
--- a/sys/v4l2/v4l2src_calls.c
+++ b/sys/v4l2/v4l2src_calls.c
@@ -218,6 +218,9 @@ gst_v4l2src_set_capture (GstV4l2Src * v4l2src, guint32 pixelformat,
   if (pixelformat == GST_MAKE_FOURCC ('M', 'P', 'E', 'G'))
     return TRUE;
 
+  g_signal_emit_by_name (v4l2src, "prepare-format",
+      v4l2src->v4l2object->video_fd, pixelformat, width, height);
+
   if (!gst_v4l2_object_set_format (v4l2src->v4l2object, pixelformat, width,
           height, interlaced)) {
     /* error already reported */
diff --git a/sys/waveform/Makefile.am b/sys/waveform/Makefile.am
index a9562a8..9a9fac3 100644
--- a/sys/waveform/Makefile.am
+++ b/sys/waveform/Makefile.am
@@ -1,19 +1,15 @@
 plugin_LTLIBRARIES = libgstwaveformsink.la
 
-# FIXME: Replace DIRECTSOUND CFLAGS+LIBS with waveform related ones and fix
-# the configure.ac + sys/Makefile.am to get this stuff building in MingW
-# For now, it's just disted for use in the VS builds.
-
 libgstwaveformsink_la_SOURCES =  gstwaveformsink.c gstwaveformplugin.c
 libgstwaveformsink_la_CFLAGS = $(GST_CFLAGS) $(GST_BASE_CFLAGS) \
-        $(GST_PLUGINS_BASE_CFLAGS) $(DIRECTSOUND_CFLAGS)
+        $(GST_PLUGINS_BASE_CFLAGS)
 libgstwaveformsink_la_LIBADD = \
 	$(GST_PLUGINS_BASE_LIBS) \
         -lgstaudio-$(GST_MAJORMINOR) -lgstinterfaces-$(GST_MAJORMINOR) \
         $(GST_BASE_LIBS) \
 	$(GST_LIBS) \
-	$(DIRECTSOUND_LIBS)
-libgstwaveformsink_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS) $(DIRECTSOUND_LDFLAGS)
+	-lwinmm
+libgstwaveformsink_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS)
 libgstwaveformsink_la_LIBTOOLFLAGS = --tag=disable-static
 
 noinst_HEADERS = gstwaveformsink.h
diff --git a/sys/waveform/Makefile.in b/sys/waveform/Makefile.in
index efdf5e7..23136a9 100644
--- a/sys/waveform/Makefile.in
+++ b/sys/waveform/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = sys/waveform
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -112,8 +128,7 @@ am__installdirs = "$(DESTDIR)$(plugindir)"
 LTLIBRARIES = $(plugin_LTLIBRARIES)
 am__DEPENDENCIES_1 =
 libgstwaveformsink_la_DEPENDENCIES = $(am__DEPENDENCIES_1) \
-	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
-	$(am__DEPENDENCIES_1)
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
 am_libgstwaveformsink_la_OBJECTS =  \
 	libgstwaveformsink_la-gstwaveformsink.lo \
 	libgstwaveformsink_la-gstwaveformplugin.lo
@@ -121,10 +136,23 @@ libgstwaveformsink_la_OBJECTS = $(am_libgstwaveformsink_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstwaveformsink_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstwaveformsink_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstwaveformsink_la_CFLAGS) $(CFLAGS) \
 	$(libgstwaveformsink_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -137,22 +165,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstwaveformsink_la_SOURCES)
 DIST_SOURCES = $(libgstwaveformsink_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -212,6 +241,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -260,8 +290,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -342,7 +374,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -402,6 +434,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -475,27 +508,27 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
 plugin_LTLIBRARIES = libgstwaveformsink.la
-
-# FIXME: Replace DIRECTSOUND CFLAGS+LIBS with waveform related ones and fix
-# the configure.ac + sys/Makefile.am to get this stuff building in MingW
-# For now, it's just disted for use in the VS builds.
 libgstwaveformsink_la_SOURCES = gstwaveformsink.c gstwaveformplugin.c
 libgstwaveformsink_la_CFLAGS = $(GST_CFLAGS) $(GST_BASE_CFLAGS) \
-        $(GST_PLUGINS_BASE_CFLAGS) $(DIRECTSOUND_CFLAGS)
+        $(GST_PLUGINS_BASE_CFLAGS)
 
 libgstwaveformsink_la_LIBADD = \
 	$(GST_PLUGINS_BASE_LIBS) \
         -lgstaudio-$(GST_MAJORMINOR) -lgstinterfaces-$(GST_MAJORMINOR) \
         $(GST_BASE_LIBS) \
 	$(GST_LIBS) \
-	$(DIRECTSOUND_LIBS)
+	-lwinmm
 
-libgstwaveformsink_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS) $(DIRECTSOUND_LDFLAGS)
+libgstwaveformsink_la_LDFLAGS = $(GST_PLUGIN_LDFLAGS)
 libgstwaveformsink_la_LIBTOOLFLAGS = --tag=disable-static
 noinst_HEADERS = gstwaveformsink.h
 all: all-am
@@ -534,7 +567,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -542,6 +574,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -557,12 +591,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstwaveformsink.la: $(libgstwaveformsink_la_OBJECTS) $(libgstwaveformsink_la_DEPENDENCIES) $(EXTRA_libgstwaveformsink_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstwaveformsink_la_LINK) -rpath $(plugindir) $(libgstwaveformsink_la_OBJECTS) $(libgstwaveformsink_la_LIBADD) $(LIBS)
 
@@ -665,6 +701,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -809,18 +859,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/sys/waveform/gstwaveformsink.c b/sys/waveform/gstwaveformsink.c
index 0c59829..3ff72a9 100644
--- a/sys/waveform/gstwaveformsink.c
+++ b/sys/waveform/gstwaveformsink.c
@@ -49,10 +49,6 @@
 
 GST_DEBUG_CATEGORY_STATIC (waveformsink_debug);
 
-static void gst_waveform_sink_base_init (gpointer g_class);
-static void gst_waveform_sink_class_init (GstWaveFormSinkClass * klass);
-static void gst_waveform_sink_init (GstWaveFormSink * wfsink,
-    GstWaveFormSinkClass * g_class);
 static void gst_waveform_sink_finalise (GObject * object);
 static void gst_waveform_sink_set_property (GObject * object,
     guint prop_id, const GValue * value, GParamSpec * pspec);
@@ -154,7 +150,7 @@ static void
 gst_waveform_sink_set_property (GObject * object, guint prop_id,
     const GValue * value, GParamSpec * pspec)
 {
-  GstWaveFormSink *wfsink = GST_WAVEFORM_SINK (object);
+  /* GstWaveFormSink *wfsink = GST_WAVEFORM_SINK (object); */
 
   switch (prop_id) {
     default:
@@ -167,7 +163,7 @@ static void
 gst_waveform_sink_get_property (GObject * object, guint prop_id,
     GValue * value, GParamSpec * pspec)
 {
-  GstWaveFormSink *wfsink = GST_WAVEFORM_SINK (object);
+  /* GstWaveFormSink *wfsink = GST_WAVEFORM_SINK (object); */
 
   switch (prop_id) {
     default:
@@ -348,7 +344,7 @@ gst_waveform_sink_getcaps (GstBaseSink * bsink)
 static gboolean
 gst_waveform_sink_open (GstAudioSink * asink)
 {
-  GstWaveFormSink *wfsink = GST_WAVEFORM_SINK (asink);
+  /* GstWaveFormSink *wfsink = GST_WAVEFORM_SINK (asink); */
 
   /* nothing to do here as the device needs to be opened with the format we will use */
 
@@ -448,7 +444,7 @@ gst_waveform_sink_unprepare (GstAudioSink * asink)
 static gboolean
 gst_waveform_sink_close (GstAudioSink * asink)
 {
-  GstWaveFormSink *wfsink = GST_WAVEFORM_SINK (asink);
+  /* GstWaveFormSink *wfsink = GST_WAVEFORM_SINK (asink); */
 
   return TRUE;
 }
diff --git a/sys/ximage/Makefile.in b/sys/ximage/Makefile.in
index 129f9a8..6400524 100644
--- a/sys/ximage/Makefile.in
+++ b/sys/ximage/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,15 +51,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = sys/ximage
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
 	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
 	$(top_srcdir)/common/m4/as-gcc-inline-assembly.m4 \
-	$(top_srcdir)/common/m4/as-objc.m4 \
 	$(top_srcdir)/common/m4/as-python.m4 \
 	$(top_srcdir)/common/m4/as-scrub-include.m4 \
 	$(top_srcdir)/common/m4/as-version.m4 \
@@ -121,10 +137,23 @@ libgstximagesrc_la_OBJECTS = $(am_libgstximagesrc_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstximagesrc_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstximagesrc_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstximagesrc_la_CFLAGS) $(CFLAGS) \
 	$(libgstximagesrc_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -137,22 +166,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstximagesrc_la_SOURCES)
 DIST_SOURCES = $(libgstximagesrc_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -212,6 +242,7 @@ ECHO_T = @ECHO_T@
 EGREP = @EGREP@
 ERROR_CFLAGS = @ERROR_CFLAGS@
 ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+ERROR_OBJCFLAGS = @ERROR_OBJCFLAGS@
 ESD_CFLAGS = @ESD_CFLAGS@
 ESD_CONFIG = @ESD_CONFIG@
 ESD_LIBS = @ESD_LIBS@
@@ -260,8 +291,10 @@ GST_LIBS = @GST_LIBS@
 GST_LICENSE = @GST_LICENSE@
 GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
 GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OBJCFLAGS = @GST_OBJCFLAGS@
 GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
 GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_OPTION_OBJCFLAGS = @GST_OPTION_OBJCFLAGS@
 GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
 GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
 GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
@@ -342,7 +375,7 @@ NM = @NM@
 NMEDIT = @NMEDIT@
 OBJC = @OBJC@
 OBJCDEPMODE = @OBJCDEPMODE@
-OBJC_LDFLAGS = @OBJC_LDFLAGS@
+OBJCFLAGS = @OBJCFLAGS@
 OBJDUMP = @OBJDUMP@
 OBJEXT = @OBJEXT@
 ORCC = @ORCC@
@@ -402,6 +435,7 @@ VALGRIND_PATH = @VALGRIND_PATH@
 VERSION = @VERSION@
 WARNING_CFLAGS = @WARNING_CFLAGS@
 WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WARNING_OBJCFLAGS = @WARNING_OBJCFLAGS@
 WAVPACK_CFLAGS = @WAVPACK_CFLAGS@
 WAVPACK_LIBS = @WAVPACK_LIBS@
 WIN32_LIBS = @WIN32_LIBS@
@@ -475,7 +509,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -531,7 +569,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -539,6 +576,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -554,12 +593,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstximagesrc.la: $(libgstximagesrc_la_OBJECTS) $(libgstximagesrc_la_DEPENDENCIES) $(EXTRA_libgstximagesrc_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstximagesrc_la_LINK) -rpath $(plugindir) $(libgstximagesrc_la_OBJECTS) $(libgstximagesrc_la_LIBADD) $(LIBS)
 
@@ -662,6 +703,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -806,18 +861,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/sys/ximage/gstximagesrc.c b/sys/ximage/gstximagesrc.c
index 36c0b44..9740312 100644
--- a/sys/ximage/gstximagesrc.c
+++ b/sys/ximage/gstximagesrc.c
@@ -1074,8 +1074,7 @@ gst_ximage_src_get_caps (GstBaseSrc * bs)
   if (s->endx >= s->startx && s->endy >= s->starty) {
     /* this means user has put in values */
     if (s->startx < xcontext->width && s->endx < xcontext->width &&
-        s->starty < xcontext->height && s->endy < xcontext->height &&
-        s->startx >= 0 && s->starty >= 0) {
+        s->starty < xcontext->height && s->endy < xcontext->height) {
       /* values are fine */
       s->width = width = s->endx - s->startx + 1;
       s->height = height = s->endy - s->starty + 1;
diff --git a/win32/common/config.h-new b/win32/common/config.h-new
new file mode 100644
index 0000000..57a2dd3
--- /dev/null
+++ b/win32/common/config.h-new
@@ -0,0 +1,454 @@
+/* Autogenerated config.h created for win32 Visual Studio builds */
+
+/* PREFIX -- specifically added for Windows for easier moving */
+#define PREFIX "C:\\gstreamer"
+
+#define GST_INSTALL_PLUGINS_HELPER PREFIX "\\libexec\\gst-install-plugins-helper.exe"
+
+/* Define if building universal (internal helper macro) */
+#undef AC_APPLE_UNIVERSAL_BUILD
+
+/* Default audio sink */
+#define DEFAULT_AUDIOSINK "directsoundsink"
+
+/* Default audio source */
+#define DEFAULT_AUDIOSRC "audiotestsrc"
+
+/* Default video sink */
+#undef DEFAULT_VIDEOSINK
+
+/* Default video source */
+#define DEFAULT_VIDEOSRC "videotestsrc"
+
+/* Default visualizer */
+#define DEFAULT_VISUALIZER "goom"
+
+/* Disable Orc */
+#undef DISABLE_ORC
+
+/* Define to 1 if translation of program messages to the user's native
+   language is requested. */
+#undef ENABLE_NLS
+
+/* gettext package name */
+#define GETTEXT_PACKAGE "gst-plugins-good-0.10"
+
+/* Defined if gcov is enabled to force a rebuild due to config.h changing */
+#undef GST_GCOV_ENABLED
+
+/* Default errorlevel to use */
+#define GST_LEVEL_DEFAULT GST_LEVEL_ERROR
+
+/* GStreamer license */
+#define GST_LICENSE "LGPL"
+
+/* package name in plugins */
+#define GST_PACKAGE_NAME "GStreamer Good Plug-ins git"
+
+/* package origin */
+#define GST_PACKAGE_ORIGIN "Unknown package origin"
+
+/* GStreamer package release date/time for plugins as YYYY-MM-DD */
+#define GST_PACKAGE_RELEASE_DATETIME "2013-04-11T11:50Z"
+
+/* struct v4l2_buffer missing */
+#undef GST_V4L2_MISSING_BUFDECL
+
+/* I know the API is subject to change. */
+#undef G_UDEV_API_IS_SUBJECT_TO_CHANGE
+
+/* Define to enable aalib ASCII Art library (used by aasink). */
+#undef HAVE_AALIB
+
+/* Define to enable XML library (used by annodex). */
+#undef HAVE_ANNODEX
+
+/* Define to 1 if you have the `asinh' function. */
+#undef HAVE_ASINH
+
+/* Define to enable bz2 library for matroska . */
+#undef HAVE_BZ2
+
+/* Define to enable Cairo graphics rendering (used by cairo). */
+#undef HAVE_CAIRO
+
+/* Define to enable Cairo graphics rendering gobject bindings (used by
+   cairooverlay). */
+#undef HAVE_CAIRO_GOBJECT
+
+/* Define to 1 if you have the MacOS X function CFLocaleCopyCurrent in the
+   CoreFoundation framework. */
+#undef HAVE_CFLOCALECOPYCURRENT
+
+/* Define to 1 if you have the MacOS X function CFPreferencesCopyAppValue in
+   the CoreFoundation framework. */
+#undef HAVE_CFPREFERENCESCOPYAPPVALUE
+
+/* Define to 1 if you have the `cosh' function. */
+#undef HAVE_COSH
+
+/* Define if the target CPU is an Alpha */
+#undef HAVE_CPU_ALPHA
+
+/* Define if the target CPU is an ARM */
+#undef HAVE_CPU_ARM
+
+/* Define if the target CPU is a CRIS */
+#undef HAVE_CPU_CRIS
+
+/* Define if the target CPU is a CRISv32 */
+#undef HAVE_CPU_CRISV32
+
+/* Define if the target CPU is a HPPA */
+#undef HAVE_CPU_HPPA
+
+/* Define if the target CPU is an x86 */
+#define HAVE_CPU_I386 1
+
+/* Define if the target CPU is a IA64 */
+#undef HAVE_CPU_IA64
+
+/* Define if the target CPU is a M68K */
+#undef HAVE_CPU_M68K
+
+/* Define if the target CPU is a MIPS */
+#undef HAVE_CPU_MIPS
+
+/* Define if the target CPU is a PowerPC */
+#undef HAVE_CPU_PPC
+
+/* Define if the target CPU is a 64 bit PowerPC */
+#undef HAVE_CPU_PPC64
+
+/* Define if the target CPU is a S390 */
+#undef HAVE_CPU_S390
+
+/* Define if the target CPU is a SPARC */
+#undef HAVE_CPU_SPARC
+
+/* Define if the target CPU is a x86_64 */
+#undef HAVE_CPU_X86_64
+
+/* Define if the GNU dcgettext() function is already present or preinstalled.
+   */
+#undef HAVE_DCGETTEXT
+
+/* Define to enable DirectSound plug-in (used by directsoundsink). */
+#undef HAVE_DIRECTSOUND
+
+/* Define to 1 if you have the <dlfcn.h> header file. */
+#undef HAVE_DLFCN_H
+
+/* define for working do while(0) macros */
+#undef HAVE_DOWHILE_MACROS
+
+/* Define to enable raw1394 and avc1394 library (used by 1394). */
+#undef HAVE_DV1394
+
+/* Define to enable ESounD sound daemon (used by esdsink). */
+#undef HAVE_ESD
+
+/* Define to enable building of experimental plug-ins. */
+#undef HAVE_EXPERIMENTAL
+
+/* Define to enable building of plug-ins with external deps. */
+#undef HAVE_EXTERNAL
+
+/* Define to 1 if you have the <fcntl.h> header file. */
+#undef HAVE_FCNTL_H
+
+/* FIONREAD ioctl found in sys/filio.h */
+#undef HAVE_FIONREAD_IN_SYS_FILIO
+
+/* FIONREAD ioctl found in sys/ioclt.h */
+#undef HAVE_FIONREAD_IN_SYS_IOCTL
+
+/* Define to enable FLAC lossless audio (used by flac). */
+#undef HAVE_FLAC
+
+/* Define to 1 if you have the `fpclass' function. */
+#undef HAVE_FPCLASS
+
+/* Define if compiler supports gcc inline assembly */
+#undef HAVE_GCC_ASM
+
+/* Define to enable GConf libraries (used by gconfelements). */
+#undef HAVE_GCONF
+
+/* Define to enable GConf schemas. */
+#undef HAVE_GCONFTOOL
+
+/* Define to enable GDK pixbuf (used by gdkpixbuf). */
+#undef HAVE_GDK_PIXBUF
+
+/* Define to 1 if you have the `getpagesize' function. */
+#undef HAVE_GETPAGESIZE
+
+/* Define if the GNU gettext() function is already present or preinstalled. */
+#undef HAVE_GETTEXT
+
+/* Define to enable Video 4 Linux 2 (used by v4l2src). */
+#undef HAVE_GST_V4L2
+
+/* Whether gudev is available for device detection */
+#undef HAVE_GUDEV
+
+/* Define to enable HAL libraries (used by halelements). */
+#undef HAVE_HAL
+
+/* Define if you have the iconv() function and it works. */
+#undef HAVE_ICONV
+
+/* Define to 1 if you have the <inttypes.h> header file. */
+#undef HAVE_INTTYPES_H
+
+/* building for iOS platofrm */
+#undef HAVE_IOS
+
+/* Define if we have struct ip_mreqn */
+#undef HAVE_IP_MREQN
+
+/* Define to 1 if you have the `isinf' function. */
+#undef HAVE_ISINF
+
+/* Define to enable Jack (used by jack). */
+#undef HAVE_JACK
+
+/* defined if jack >= 0.120.1 is available */
+#undef HAVE_JACK_0_120_1
+
+/* defined if jack >= 1.9.7 is available */
+#undef HAVE_JACK_1_9_7
+
+/* Define to enable jpeg library (used by jpeg). */
+#undef HAVE_JPEG
+
+/* Define to enable libcaca coloured ASCII art (used by cacasink). */
+#undef HAVE_LIBCACA
+
+/* Define to enable libdv DV demuxer/decoder (used by dv). */
+#undef HAVE_LIBDV
+
+/* Define to enable Portable Network Graphics library (used by png). */
+#undef HAVE_LIBPNG
+
+/* Define to 1 if you have the `socket' library (-lsocket). */
+#undef HAVE_LIBSOCKET
+
+/* soup gnome integration */
+#undef HAVE_LIBSOUP_GNOME
+
+/* Whether libv4l2 is available for video buffer conversion */
+#undef HAVE_LIBV4L2
+
+/* Define to 1 if you have the <memory.h> header file. */
+#undef HAVE_MEMORY_H
+
+/* Define to 1 if you have a working `mmap' system call. */
+#undef HAVE_MMAP
+
+/* Define to 1 if you have the <netinet/in.h> header file. */
+#undef HAVE_NETINET_IN_H
+
+/* Use Orc */
+#undef HAVE_ORC
+
+/* Define to enable OSS audio (used by ossaudio). */
+#undef HAVE_OSS
+
+/* Define to enable Open Sound System 4 (used by oss4). */
+#undef HAVE_OSS4
+
+/* Define if OSS includes are in /machine/ */
+#undef HAVE_OSS_INCLUDE_IN_MACHINE
+
+/* Define if OSS includes are in / */
+#undef HAVE_OSS_INCLUDE_IN_ROOT
+
+/* Define if OSS includes are in /sys/ */
+#undef HAVE_OSS_INCLUDE_IN_SYS
+
+/* Define to enable OSX audio (used by osxaudio). */
+#undef HAVE_OSX_AUDIO
+
+/* Define to enable OSX video (used by osxvideosink). */
+#undef HAVE_OSX_VIDEO
+
+/* Define to 1 if you have the <process.h> header file. */
+#define HAVE_PROCESS_H 1
+
+/* Define to enable pulseaudio plug-in (used by pulseaudio). */
+#undef HAVE_PULSE
+
+/* defined if pulseaudio >= 0.9.20 is available */
+#undef HAVE_PULSE_0_9_20
+
+/* defined if pulseaudio >= 1.0 is available */
+#undef HAVE_PULSE_1_0
+
+/* Define if RDTSC is available */
+#undef HAVE_RDTSC
+
+/* Define to 1 if you have the `rint' function. */
+#undef HAVE_RINT
+
+/* Define to enable Shoutcast/Icecast client library (used by shout2). */
+#undef HAVE_SHOUT2
+
+/* Define to 1 if you have the `sinh' function. */
+#undef HAVE_SINH
+
+/* Define to enable soup http client plugin (2.4) (used by souphttpsrc). */
+#undef HAVE_SOUP
+
+/* Define to enable speex speech codec (used by speex). */
+#undef HAVE_SPEEX
+
+/* Define to 1 if you have the <stdint.h> header file. */
+#undef HAVE_STDINT_H
+
+/* Define to 1 if you have the <stdlib.h> header file. */
+#define HAVE_STDLIB_H 1
+
+/* Define to 1 if you have the <strings.h> header file. */
+#undef HAVE_STRINGS_H
+
+/* Define to 1 if you have the <string.h> header file. */
+#define HAVE_STRING_H 1
+
+/* Define to enable Sun Audio (used by sunaudio). */
+#undef HAVE_SUNAUDIO
+
+/* Define to 1 if you have the <sys/ioctl.h> header file. */
+#undef HAVE_SYS_IOCTL_H
+
+/* Define to 1 if you have the <sys/param.h> header file. */
+#undef HAVE_SYS_PARAM_H
+
+/* Define to 1 if you have the <sys/socket.h> header file. */
+#undef HAVE_SYS_SOCKET_H
+
+/* Define to 1 if you have the <sys/stat.h> header file. */
+#define HAVE_SYS_STAT_H 1
+
+/* Define to 1 if you have the <sys/time.h> header file. */
+#undef HAVE_SYS_TIME_H
+
+/* Define to 1 if you have the <sys/types.h> header file. */
+#define HAVE_SYS_TYPES_H 1
+
+/* Define to enable taglib tagging library (used by taglib). */
+#undef HAVE_TAGLIB
+
+/* Define to 1 if you have the <unistd.h> header file. */
+#undef HAVE_UNISTD_H
+
+/* Define if valgrind should be used */
+#undef HAVE_VALGRIND
+
+/* Define to enable Win32 WaveForm (used by waveformsink). */
+#undef HAVE_WAVEFORM
+
+/* Define to enable wavpack plug-in (used by wavpack). */
+#undef HAVE_WAVPACK
+
+/* Define to 1 if you have the <winsock2.h> header file. */
+#define HAVE_WINSOCK2_H 1
+
+/* Define to enable X libraries and plugins (used by ximagesrc). */
+#undef HAVE_X
+
+/* Define to enable X Shared Memory extension. */
+#undef HAVE_XSHM
+
+/* Define to enable X11 XVideo extensions. */
+#undef HAVE_XVIDEO
+
+/* Define to enable zlib support for qtdemux/matroska. */
+#undef HAVE_ZLIB
+
+/* the host CPU */
+#define HOST_CPU "i686"
+
+/* gettext locale dir */
+#define LOCALEDIR PREFIX "\\share\\locale"
+
+/* Define to the sub-directory in which libtool stores uninstalled libraries.
+   */
+#undef LT_OBJDIR
+
+/* Define to 1 if your C compiler doesn't accept -c and -o together. */
+#undef NO_MINUS_C_MINUS_O
+
+/* Name of package */
+#define PACKAGE "gst-plugins-good"
+
+/* Define to the address where bug reports for this package should be sent. */
+#define PACKAGE_BUGREPORT "http://bugzilla.gnome.org/enter_bug.cgi?product=GStreamer"
+
+/* Define to the full name of this package. */
+#define PACKAGE_NAME "GStreamer Good Plug-ins"
+
+/* Define to the full name and version of this package. */
+#define PACKAGE_STRING "GStreamer Good Plug-ins 0.10.31.1"
+
+/* Define to the one symbol short name of this package. */
+#define PACKAGE_TARNAME "gst-plugins-good"
+
+/* Define to the home page for this package. */
+#undef PACKAGE_URL
+
+/* Define to the version of this package. */
+#define PACKAGE_VERSION "0.10.31.1"
+
+/* directory where plugins are located */
+#ifdef _DEBUG
+#  define PLUGINDIR PREFIX "\\debug\\lib\\gstreamer-0.10"
+#else
+#  define PLUGINDIR PREFIX "\\lib\\gstreamer-0.10"
+#endif
+
+/* The size of `char', as computed by sizeof. */
+#undef SIZEOF_CHAR
+
+/* The size of `int', as computed by sizeof. */
+#undef SIZEOF_INT
+
+/* The size of `long', as computed by sizeof. */
+#undef SIZEOF_LONG
+
+/* The size of `short', as computed by sizeof. */
+#undef SIZEOF_SHORT
+
+/* The size of `void*', as computed by sizeof. */
+#undef SIZEOF_VOIDP
+
+/* defined if speex 1.0.x API detected */
+#undef SPEEX_1_0
+
+/* Define to 1 if you have the ANSI C header files. */
+#undef STDC_HEADERS
+
+/* the target CPU */
+#undef TARGET_CPU
+
+/* Version number of package */
+#define VERSION "0.10.31.1"
+
+/* old wavpack API */
+#undef WAVPACK_OLD_API
+
+/* Define WORDS_BIGENDIAN to 1 if your processor stores words with the most
+   significant byte first (like Motorola and SPARC, unlike Intel). */
+#if defined AC_APPLE_UNIVERSAL_BUILD
+# if defined __BIG_ENDIAN__
+#  define WORDS_BIGENDIAN 1
+# endif
+#else
+# ifndef WORDS_BIGENDIAN
+#  undef WORDS_BIGENDIAN
+# endif
+#endif
+
+/* Define to 1 if the X Window System is missing or not being used. */
+#undef X_DISPLAY_MISSING
-- 
1.8.1.4


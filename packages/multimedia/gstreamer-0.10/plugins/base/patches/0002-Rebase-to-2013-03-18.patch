From 7290a2f8653b05265400d501bafd60f8776f7577 Mon Sep 17 00:00:00 2001
From: Soeren Grunewald <soeren.grunewald@avionic-design.de>
Date: Thu, 11 Apr 2013 10:55:56 +0200
Subject: [PATCH 2/3] Rebase to 2013-03-18.

commit id is 3359117536a062af9a0e946a603fd45e4c49560e

Note that we excluded the docs directory and windows related stuff.
---
 ChangeLog                                      | 6429 +-----------------------
 LICENSE_readme                                 |  137 +
 MAINTAINERS                                    |   13 +
 Makefile.am                                    |    1 +
 Makefile.in                                    |  203 +-
 aclocal.m4                                     |  388 +-
 autogen.sh                                     |   19 +-
 autoregen.sh                                   |    2 +
 config.h.in                                    |   36 +-
 configure                                      |  935 ++--
 configure.ac                                   |   63 +-
 ext/Makefile.in                                |  147 +-
 ext/alsa/Makefile.in                           |  117 +-
 ext/alsa/gstalsa.c                             |   15 +-
 ext/alsa/gstalsa.h                             |   12 +-
 ext/alsa/gstalsadeviceprobe.c                  |    4 +
 ext/alsa/gstalsasink.c                         |  126 +-
 ext/alsa/gstalsasink.h                         |    5 +
 ext/alsa/gstalsasrc.c                          |    4 +-
 ext/cdparanoia/Makefile.in                     |  117 +-
 ext/cdparanoia/gstcdparanoiasrc.c              |   10 +-
 ext/gio/Makefile.in                            |  117 +-
 ext/gnomevfs/Makefile.in                       |  117 +-
 ext/libvisual/Makefile.in                      |  118 +-
 ext/libvisual/visual.c                         |    1 +
 ext/ogg/Makefile.in                            |  117 +-
 ext/ogg/gstoggdemux.c                          |   99 +-
 ext/ogg/gstoggdemux.h                          |    8 -
 ext/ogg/gstoggmux.c                            |   35 +-
 ext/ogg/gstoggstream.c                         |   27 +-
 ext/ogg/gstoggstream.h                         |    3 +
 ext/pango/Makefile.in                          |  117 +-
 ext/pango/gsttextoverlay.c                     |  118 +-
 ext/pango/gsttextoverlay.h                     |    1 +
 ext/pango/gsttextrender.c                      |    2 +-
 ext/theora/Makefile.in                         |  117 +-
 ext/theora/gsttheoradec.c                      | 1228 +----
 ext/theora/gsttheoradec.h                      |   44 +-
 ext/theora/gsttheoraenc.c                      |  974 ++--
 ext/theora/gsttheoraenc.h                      |   25 +-
 ext/theora/gsttheoraparse.c                    |    4 +
 ext/vorbis/Makefile.in                         |  117 +-
 ext/vorbis/gstvorbisdec.c                      |   62 +-
 ext/vorbis/gstvorbisdec.h                      |    2 -
 ext/vorbis/gstvorbisdeclib.h                   |   74 +-
 gst-libs/Makefile.in                           |  147 +-
 gst-libs/ext/Makefile.am                       |    2 +
 gst-libs/gst/Makefile.in                       |  147 +-
 gst-libs/gst/app/Makefile.am                   |    8 +-
 gst-libs/gst/app/Makefile.in                   |  117 +-
 gst-libs/gst/app/gstappsink.c                  |   26 +
 gst-libs/gst/app/gstappsrc.c                   |    2 +
 gst-libs/gst/audio/Makefile.am                 |    8 +-
 gst-libs/gst/audio/Makefile.in                 |  123 +-
 gst-libs/gst/audio/audio.c                     |    8 +-
 gst-libs/gst/audio/audio.h                     |    2 +-
 gst-libs/gst/audio/gstaudiodecoder.c           |   85 +-
 gst-libs/gst/audio/gstaudiodecoder.h           |   17 +-
 gst-libs/gst/audio/gstaudioencoder.c           |   55 +-
 gst-libs/gst/audio/gstaudioencoder.h           |   12 +-
 gst-libs/gst/audio/gstaudioiec61937.c          |    7 +-
 gst-libs/gst/audio/gstbaseaudiosink.c          |   11 +-
 gst-libs/gst/audio/gstringbuffer.c             |    1 +
 gst-libs/gst/audio/mixerutils.c                |    4 +
 gst-libs/gst/audio/multichannel.h              |    3 +-
 gst-libs/gst/cdda/Makefile.am                  |    8 +-
 gst-libs/gst/cdda/Makefile.in                  |  108 +-
 gst-libs/gst/fft/Makefile.am                   |    4 +-
 gst-libs/gst/fft/Makefile.in                   |  114 +-
 gst-libs/gst/floatcast/Makefile.in             |   63 +-
 gst-libs/gst/interfaces/Makefile.am            |    4 +-
 gst-libs/gst/interfaces/Makefile.in            |  119 +-
 gst-libs/gst/interfaces/colorbalance.c         |   11 +-
 gst-libs/gst/interfaces/colorbalance.h         |    7 +-
 gst-libs/gst/interfaces/mixer.c                |    9 +
 gst-libs/gst/interfaces/mixer.h                |    7 +-
 gst-libs/gst/interfaces/navigation.h           |    2 +-
 gst-libs/gst/interfaces/xoverlay.c             |   32 +-
 gst-libs/gst/netbuffer/Makefile.am             |    4 +-
 gst-libs/gst/netbuffer/Makefile.in             |  114 +-
 gst-libs/gst/pbutils/Makefile.am               |    6 +-
 gst-libs/gst/pbutils/Makefile.in               |  120 +-
 gst-libs/gst/pbutils/descriptions.c            |   11 +-
 gst-libs/gst/pbutils/gstdiscoverer.c           |  125 +-
 gst-libs/gst/pbutils/install-plugins.c         |    2 +-
 gst-libs/gst/riff/Makefile.am                  |    8 +-
 gst-libs/gst/riff/Makefile.in                  |  118 +-
 gst-libs/gst/riff/riff-ids.h                   |    5 +-
 gst-libs/gst/riff/riff-media.c                 |   21 +
 gst-libs/gst/riff/riff-read.c                  |   40 +-
 gst-libs/gst/rtp/Makefile.am                   |    8 +-
 gst-libs/gst/rtp/Makefile.in                   |  117 +-
 gst-libs/gst/rtsp/Makefile.am                  |    4 +-
 gst-libs/gst/rtsp/Makefile.in                  |  118 +-
 gst-libs/gst/rtsp/gstrtspconnection.c          |   90 +-
 gst-libs/gst/rtsp/gstrtspconnection.h          |    5 +
 gst-libs/gst/rtsp/gstrtspdefs.h                |    6 +-
 gst-libs/gst/sdp/Makefile.am                   |    4 +-
 gst-libs/gst/sdp/Makefile.in                   |  113 +-
 gst-libs/gst/tag/Makefile.am                   |    8 +-
 gst-libs/gst/tag/Makefile.in                   |  123 +-
 gst-libs/gst/tag/gstxmptag.c                   |    5 +-
 gst-libs/gst/tag/id3v2.3.0.txt                 | 1942 +++++++
 gst-libs/gst/tag/id3v2.4.0-frames.txt          | 1734 +++++++
 gst-libs/gst/tag/id3v2.4.0-structure.txt       |  733 +++
 gst-libs/gst/tag/lang.c                        |   28 +-
 gst-libs/gst/tag/tag.h                         |    2 +
 gst-libs/gst/video/Makefile.am                 |   17 +-
 gst-libs/gst/video/Makefile.in                 |  162 +-
 gst-libs/gst/video/TODO                        |   51 +
 gst-libs/gst/video/gstvideodecoder.c           | 3114 ++++++++++++
 gst-libs/gst/video/gstvideodecoder.h           |  374 ++
 gst-libs/gst/video/gstvideoencoder.c           | 1712 +++++++
 gst-libs/gst/video/gstvideoencoder.h           |  308 ++
 gst-libs/gst/video/gstvideoutils.c             |  207 +
 gst-libs/gst/video/gstvideoutils.h             |  278 +
 gst-libs/gst/video/video-blend.c               |  178 +-
 gst-libs/gst/video/video-blend.h               |    8 +-
 gst-libs/gst/video/video-overlay-composition.c |  414 +-
 gst-libs/gst/video/video-overlay-composition.h |   12 +-
 gst-libs/gst/video/video.c                     | 1475 ++++--
 gst-libs/gst/video/video.h                     |  482 +-
 gst-plugins-base.doap                          |   12 -
 gst-plugins-base.spec                          |  304 --
 gst/Makefile.in                                |  147 +-
 gst/adder/Makefile.in                          |   97 +-
 gst/adder/gstadder.c                           |  141 +-
 gst/adder/gstadder.h                           |    4 +-
 gst/app/Makefile.in                            |  118 +-
 gst/audioconvert/Makefile.in                   |   97 +-
 gst/audiorate/Makefile.in                      |  117 +-
 gst/audioresample/Makefile.in                  |  117 +-
 gst/audiotestsrc/Makefile.in                   |  117 +-
 gst/encoding/Makefile.in                       |  118 +-
 gst/encoding/gstencodebin.c                    |    2 +
 gst/ffmpegcolorspace/Makefile.in               |  117 +-
 gst/ffmpegcolorspace/avcodec.h                 |    6 +
 gst/ffmpegcolorspace/gstffmpegcodecmap.c       |   58 +
 gst/ffmpegcolorspace/gstffmpegcolorspace.c     |    2 +-
 gst/ffmpegcolorspace/imgconvert.c              | 1165 ++++-
 gst/gdp/Makefile.in                            |  117 +-
 gst/playback/Makefile.in                       |  118 +-
 gst/playback/gstdecodebin2.c                   |  103 +
 gst/playback/gstplay-enum.c                    |    2 +
 gst/playback/gstplay-enum.h                    |    3 +-
 gst/playback/gstplaybasebin.c                  |    4 +
 gst/playback/gstplaybin2.c                     |  530 +-
 gst/playback/gstplaysink.c                     | 1554 +++++-
 gst/playback/gstplaysink.h                     |    1 +
 gst/playback/gstplaysinkaudioconvert.c         |    1 -
 gst/playback/gstplaysinkconvertbin.c           |   24 +-
 gst/playback/gstplaysinkvideoconvert.c         |  147 +-
 gst/playback/gstplaysinkvideoconvert.h         |    4 +
 gst/playback/gststreamselector.c               |    2 +
 gst/playback/gstsubtitleoverlay.c              | 1038 ++--
 gst/playback/gsturidecodebin.c                 |   69 +-
 gst/subparse/Makefile.in                       |  117 +-
 gst/subparse/gstsubparse.c                     |    3 +-
 gst/tcp/Makefile.in                            |  118 +-
 gst/typefind/Makefile.in                       |  118 +-
 gst/typefind/gsttypefindfunctions.c            |   55 +-
 gst/videorate/Makefile.in                      |  117 +-
 gst/videoscale/Makefile.in                     |   97 +-
 gst/videoscale/gstvideoscale.c                 |  161 +-
 gst/videoscale/vs_image.c                      |  132 +-
 gst/videoscale/vs_image.h                      |    8 +
 gst/videoscale/vs_lanczos.c                    |  114 +-
 gst/videoscale/vs_scanline.c                   |   82 +
 gst/videoscale/vs_scanline.h                   |    5 +
 gst/videotestsrc/Makefile.am                   |    2 +-
 gst/videotestsrc/Makefile.in                   |  136 +-
 gst/volume/Makefile.in                         |   97 +-
 ltmain.sh                                      |   34 +-
 m4/Makefile.in                                 |   44 +-
 m4/glibc2.m4                                   |   30 +
 m4/intl.m4                                     |  285 ++
 m4/intldir.m4                                  |   19 +
 m4/intmax.m4                                   |   33 +
 m4/libtool.m4                                  |   84 +-
 m4/lock.m4                                     |  316 ++
 m4/longlong.m4                                 |  109 +
 m4/printf-posix.m4                             |   44 +
 m4/size_max.m4                                 |   68 +
 m4/visibility.m4                               |   52 +
 m4/wchar_t.m4                                  |   20 +
 m4/wint_t.m4                                   |   28 +
 m4/xsize.m4                                    |   13 +
 pkgconfig/Makefile.in                          |   49 +-
 po/Makevars.template                           |   41 +
 po/af.po                                       |    2 +-
 po/az.po                                       |    2 +-
 po/bg.po                                       |    2 +-
 po/ca.po                                       |  207 +-
 po/cs.po                                       |    2 +-
 po/da.po                                       |    2 +-
 po/de.po                                       |    2 +-
 po/el.po                                       |    2 +-
 po/en_GB.po                                    |    2 +-
 po/eo.po                                       |    2 +-
 po/es.po                                       |    2 +-
 po/eu.po                                       |    2 +-
 po/fi.po                                       |    2 +-
 po/fr.po                                       |    2 +-
 po/gl.po                                       |    2 +-
 po/gst-plugins-base-0.10.pot                   |  795 ---
 po/hu.po                                       |    2 +-
 po/id.po                                       |   86 +-
 po/it.po                                       |    2 +-
 po/ja.po                                       |    2 +-
 po/lt.po                                       |    2 +-
 po/lv.po                                       |    2 +-
 po/nb.po                                       |    2 +-
 po/nl.po                                       |    2 +-
 po/or.po                                       |    2 +-
 po/pl.po                                       |    2 +-
 po/pt_BR.po                                    |    2 +-
 po/ro.po                                       |    2 +-
 po/ru.po                                       |    2 +-
 po/sk.po                                       |    2 +-
 po/sl.po                                       |    2 +-
 po/sq.po                                       |    2 +-
 po/sr.po                                       |    2 +-
 po/sv.po                                       |    2 +-
 po/tr.po                                       |    2 +-
 po/uk.po                                       |    2 +-
 po/vi.po                                       |    2 +-
 po/zh_CN.po                                    |    2 +-
 stamp-h.in                                     |    1 +
 sys/Makefile.in                                |  147 +-
 sys/v4l/Makefile.in                            |  117 +-
 sys/v4l/gstv4ljpegsrc.c                        |  293 ++
 sys/v4l/gstv4lmjpegsink.c                      |  430 ++
 sys/v4l/gstv4lmjpegsrc.c                       |  867 ++++
 sys/v4l/gstv4lxoverlay.c                       |    1 +
 sys/v4l/v4l_calls.c                            |    1 +
 sys/v4l/v4lmjpegsink_calls.c                   |  525 ++
 sys/v4l/v4lmjpegsrc_calls.c                    |  577 +++
 sys/v4l/v4lsrc_calls.c                         |    1 +
 sys/ximage/Makefile.in                         |  117 +-
 sys/ximage/ximagesink.c                        |   27 +-
 sys/xvimage/Makefile.in                        |  117 +-
 sys/xvimage/xvimagesink.c                      |   34 +-
 tests/Makefile.in                              |  147 +-
 tests/check/Makefile.am                        |    3 +
 tests/check/Makefile.in                        |  158 +-
 tests/check/elements/adder.c                   |  299 +-
 tests/check/elements/alsa.c                    |    4 +
 tests/check/elements/appsrc.c                  |  152 +
 tests/check/elements/playbin.c                 |    4 +
 tests/check/elements/videoscale.c              |  159 +-
 tests/check/libs/audio.c                       |   36 +
 tests/check/libs/discoverer.c                  |  109 +-
 tests/check/libs/tag.c                         |   10 +
 tests/check/libs/video.c                       |  532 +-
 tests/check/pipelines/theoraenc.c              |  114 -
 tests/examples/Makefile.am                     |    8 +-
 tests/examples/Makefile.in                     |  152 +-
 tests/examples/app/Makefile.in                 |   78 +-
 tests/examples/audio/Makefile.in               |   78 +-
 tests/examples/audio/audiomix.c                |    3 +
 tests/examples/audio/volume.c                  |    3 +
 tests/examples/dynamic/Makefile.in             |   78 +-
 tests/examples/encoding/Makefile.in            |   78 +-
 tests/examples/fft/Makefile.in                 |   78 +-
 tests/examples/fft/fftrange.c                  |    2 +
 tests/examples/gio/Makefile.in                 |   78 +-
 tests/examples/overlay/Makefile.in             |   84 +-
 tests/examples/playback/Makefile.am            |    7 +
 tests/examples/playback/Makefile.in            |  760 +++
 tests/examples/playback/playback-test.c        | 3379 +++++++++++++
 tests/examples/playrec/Makefile.in             |   78 +-
 tests/examples/seek/Makefile.am                |    4 +-
 tests/examples/seek/Makefile.in                |  102 +-
 tests/examples/seek/jsseek.c                   |    3 +
 tests/examples/seek/scrubby.c                  |    6 +
 tests/examples/snapshot/Makefile.in            |   78 +-
 tests/examples/v4l/Makefile.in                 |   78 +-
 tests/examples/v4l/probe.c                     |    4 +
 tests/files/Makefile.in                        |   44 +-
 tests/icles/Makefile.in                        |  169 +-
 tests/icles/playback/Makefile.in               |   78 +-
 tests/icles/test-colorkey.c                    |    5 +
 tests/icles/test-xoverlay.c                    |    3 +
 tools/Makefile.in                              |  134 +-
 tools/README.filterstamp                       |   24 +
 tools/filterstamp.sh                           |   57 +
 tools/gst-launch-ext.1.in                      |   42 +
 win32/common/config.h-new                      |  436 ++
 288 files changed, 35296 insertions(+), 14131 deletions(-)
 create mode 100644 LICENSE_readme
 create mode 100644 MAINTAINERS
 create mode 100755 autoregen.sh
 create mode 100644 gst-libs/ext/Makefile.am
 create mode 100644 gst-libs/gst/tag/id3v2.3.0.txt
 create mode 100644 gst-libs/gst/tag/id3v2.4.0-frames.txt
 create mode 100644 gst-libs/gst/tag/id3v2.4.0-structure.txt
 create mode 100644 gst-libs/gst/video/TODO
 create mode 100644 gst-libs/gst/video/gstvideodecoder.c
 create mode 100644 gst-libs/gst/video/gstvideodecoder.h
 create mode 100644 gst-libs/gst/video/gstvideoencoder.c
 create mode 100644 gst-libs/gst/video/gstvideoencoder.h
 create mode 100644 gst-libs/gst/video/gstvideoutils.c
 create mode 100644 gst-libs/gst/video/gstvideoutils.h
 delete mode 100644 gst-plugins-base.spec
 create mode 100644 m4/glibc2.m4
 create mode 100644 m4/intl.m4
 create mode 100644 m4/intldir.m4
 create mode 100644 m4/intmax.m4
 create mode 100644 m4/lock.m4
 create mode 100644 m4/longlong.m4
 create mode 100644 m4/printf-posix.m4
 create mode 100644 m4/size_max.m4
 create mode 100644 m4/visibility.m4
 create mode 100644 m4/wchar_t.m4
 create mode 100644 m4/wint_t.m4
 create mode 100644 m4/xsize.m4
 create mode 100644 po/Makevars.template
 create mode 100644 stamp-h.in
 create mode 100644 sys/v4l/gstv4ljpegsrc.c
 create mode 100644 sys/v4l/gstv4lmjpegsink.c
 create mode 100644 sys/v4l/gstv4lmjpegsrc.c
 create mode 100644 sys/v4l/v4lmjpegsink_calls.c
 create mode 100644 sys/v4l/v4lmjpegsrc_calls.c
 create mode 100644 tests/examples/playback/Makefile.am
 create mode 100644 tests/examples/playback/Makefile.in
 create mode 100644 tests/examples/playback/playback-test.c
 create mode 100644 tools/README.filterstamp
 create mode 100755 tools/filterstamp.sh
 create mode 100644 tools/gst-launch-ext.1.in
 create mode 100644 win32/common/config.h-new

diff --git a/ChangeLog b/ChangeLog
index ac8629d..fe859b0 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,5994 +1,68 @@
-=== release 0.10.36 ===
-
-2012-02-20  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* configure.ac:
-	  releasing 0.10.36, "Better"
-
-2012-02-20 23:19:49 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* po/ca.po:
-	* po/id.po:
-	  po: update translations
-
-2012-02-17 15:08:36 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	* win32/common/libgstaudio.def:
-	  docs: add new audio base class API to docs and .def file
-
-2012-01-30 15:55:26 +0100  Ognyan Tonchev <ognyan@axis.com>
-
-	* gst-libs/gst/rtsp/gstrtspconnection.c:
-	  rtspconnection: only send new data immediately if there are no queued messages
-	  Even if watch->messages->length is 0 there may still be some
-	  data from a message that was only written partially at the
-	  previous attempt stored in watch->write_data, so check for
-	  that as well. We don't want to write data into the middle
-	  of another message, which could happen when there wasn't
-	  enough bandwidth.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=669039
-
-2012-02-16 12:19:20 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	* gst-libs/gst/audio/gstaudiodecoder.h:
-	  audiodecoder: add some properties to tweak baseclass behaviour
-	  ... so subclass can also rely upon never being bothered with some NULL buffer
-	  it can't do any interesting with, or with any data before it received
-	  any format configuration (and setup properly).
-
-2012-02-16 12:18:03 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	* gst-libs/gst/audio/gstaudioencoder.h:
-	  audioencoder: add some properties to tweak baseclass behaviour
-	  ... so subclass can also rely upon never being bothered with less data
-	  than it desires or with some NULL buffer it can't do any interesting with.
-
-2012-02-16 12:15:47 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	  audiodecoder: assert some more that subclass parsed frame has proper len
-
-2012-02-14 19:23:27 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  discoverer: try harder to obtain a duration if we don't get one right away
-	  If we don't get a duration right away, set the pipeline to playing
-	  and sleep a bit, then try again. This is ugly, but the least worst
-	  we can do right now. The alternative would be to make parsers etc.
-	  return some bogus duration estimate even after only having pushed
-	  a single frame, for example.
-	  Fixes discoverer showing 0 durations for some mp3 and aac files
-	  (e.g. soweto-adts.aac).
-
-2012-02-05 13:55:40 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* configure.ac:
-	* win32/common/_stdint.h:
-	* win32/common/config.h:
-	  0.10.35.3 pre-release
-
-2012-02-01 15:28:45 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	* ext/ogg/gstoggstream.c:
-	* ext/ogg/gstoggstream.h:
-	  oggdemux: fix granpos interpolation violating max keyframe distance
-	  In case many packets fit on a page, we may not see a granpos for
-	  a while, and granpos interpolation can wrap the 'frames since last
-	  keyframe' part of the granpos, generating a granpos which is smaller
-	  than what it should be.
-	  This is fixed by detecting keyframe packets (at least for Theora),
-	  and updating the last keyframe granpos from this.
-	  This may still be generating potentially wrong granpos for streams
-	  which have a Theora like granpos (keyframes, a max keyframe distance
-	  and a count of frames since last keyframe), and which allow implicit
-	  granules on packets. For these streams, a custom keyframe detection
-	  routine should be plugged into their GstOggStream mapper.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=669164
-
-2012-02-01 16:46:13 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/vorbis/gstvorbisparse.c:
-	  vorbisparse: pedantically recognize undefined headers too
-
-2012-02-01 16:32:24 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/vorbis/gstvorbisparse.c:
-	  vorbisparse: fix header detection
-	  It was matching non header packets.
-	  This fixes various leaks, where buffers would be pushed onto a headers
-	  list, but never popped.
-	  Might also fix corruption as those buffers were dropped from the output
-	  silently...
-	  https://bugzilla.gnome.org/show_bug.cgi?id=669167
-
-2012-01-23 09:28:18 -0800  David Schleef <ds@schleef.org>
-
-	* gst-libs/gst/interfaces/propertyprobe.c:
-	  propertyprobe: fix documentation
-
-2012-01-18 14:58:08 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstplaybin2.c:
-	  playbin2: do not try to deactivate an inactive group
-	  A group may have failed to activate due to an error (for instance,
-	  having set the URI to a non existent location in about-to-finish).
-	  https://bugzilla.gnome.org/show_bug.cgi?id=666395
-
-2012-01-17 16:05:41 +0200  Anssi Hannula <anssi.hannula@iki.fi>
-
-	* gst/playback/gstsubtitleoverlay.c:
-	  subtitleoverlay: fix state change stall on PAUSED->READY->PAUSED
-	  After a PAUSED->READY change the sink pads are currently not set to
-	  blocking state. When the element is set back to PAUSED, the change will
-	  be done asynchronously, but as the _pad_blocked_cb() callback is now not
-	  called, the state change never completes.
-	  Fix that by setting the sink pads to blocking state on a PAUSED->READY
-	  change, which ensures that the _pad_blocked_cb() is called when needed
-	  on any future READY->PAUSED change. The sink pads are already put to
-	  blocking state on NULL->READY change, so this behavior is consistent.
-	  Fixes bug #668097.
-
-2012-01-19 16:40:22 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/playback/gststreamsynchronizer.c:
-	  streamsynchronizer: avoid unlikely NULL dereference
-
-2012-01-19 16:35:54 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/videoscale/vs_fill_borders.c:
-	  videoscale: prevent implicit upgrade to integer type and sign extension
-
-2012-01-19 16:35:04 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* tools/gst-discoverer.c:
-	  gst-discoverer: remove extraneous variable
-
-2012-01-19 16:32:37 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/playback/gstplaysink.c:
-	  playsink: verify linking to overlay element
-
-2012-01-19 16:32:05 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/playback/gstplaysink.c:
-	  playsink: avoid finding sink in NULL bin in corner case
-
-2012-01-19 16:29:53 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstexiftag.c:
-	  tag: exif: add missing break
-
-2012-01-17 18:19:30 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/ogg/gstoggstream.c:
-	  oggstream: initialize variable
-	  ... to help out challenged compiler.
-
-2012-01-16 11:43:25 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/alsa/gstalsasink.c:
-	  alsasink: fix high sample rates being rejected
-	  An ALSA sink may select a different rate (as we use the _set_rate_near
-	  API, which is not guaranteed to set the exact target rate).
-	  The rest of the code seems to already handle this well, as output
-	  from a 88200 Hz file seems to have the correct pitch when selecting
-	  a 96 kHz rate.
-
-2012-01-16 11:40:47 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/alsa/gstalsasink.c:
-	  alsasink: fix rate match message mistaking error code for sample rate
-
-2012-01-13 16:57:15 -0300  Reynaldo H. Verdejo Pinochet <reynaldo@collabora.com>
-
-	* Android.mk:
-	  Android, Add explicit path for zlib
-	  This change fixes building gst-libs/gst/tag/ code with
-	  the Android buildsystem.
-
-2012-01-13 14:50:49 -0300  Reynaldo H. Verdejo Pinochet <reynaldo@collabora.com>
-
-	* ext/vorbis/gstvorbisdec.c:
-	  Fix wrong access to undefined struct member
-	  For the USE_TREMOLO case, GstVorbisDec doesn't have
-	  a vb member. Besides, Tremolo's vorbis_dsp_synthesis()
-	  expects a vorbis_dsp_state to be passed as first
-	  argument. Not a vorbis_block.
-
-2012-01-13 14:47:13 -0300  Reynaldo H. Verdejo Pinochet <reynaldo@collabora.com>
-
-	* ext/vorbis/gstvorbisdec.c:
-	  Fix TREMELO -> TREMOLO typo
-
-2012-01-12 16:24:01 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/theora/gsttheoraparse.c:
-	  theoraparse: fix array leak
-
-2012-01-12 14:26:05 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  discoverer: fix structure leak
-	  I hit the 'misc' one, but let's also make sure the topology
-	  one get freed as well, though I do not know if this can happen
-	  twice.
-
-2012-01-11 20:47:00 -0300  Reynaldo H. Verdejo Pinochet <reynaldo@collabora.com>
-
-	* gst-libs/gst/video/Makefile.am:
-	  Add missing DEFAULT_INCLUDES on androgenizer call
-	  Fix building of the libgstvideo module on Android by adding the
-	  missing and needed $(DEFAULT_INCLUDES) to CFLAGS for the
-	  androgenizer call on gst-libs/gst/video/Makefile.am
-	  Before this change, building was failing due to gst-plugins-base/
-	  and gst-plugins-base/gst-libs/gst/video being left out of the
-	  include path.
-
-2012-01-11 16:17:42 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: fix push mode chain leak
-	  When I first implemented push mode seeking, I removed the chain
-	  freeing there as it could be used later. The current code does not
-	  seem to do that though, so I'm restoring the previous freeing,
-	  which plugs the leak while apparently not reintroducing use of
-	  freed data with chained and normal files, both with gst-launch
-	  playbin2 and Totem.
-
-2012-01-11 12:52:17 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/gstdiscoverer-types.c:
-	  discoverer: fix leaks caused by some base class dtors not being called
-
-2012-01-11 12:16:28 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  discoverer: fix caps and discoverer object ref leaks
-
-2012-01-11 11:55:59 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  discoverer: add a few consts where appropriate
-
-2012-01-11 11:55:36 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  discoverer: fix pad leak
-
-2012-01-10 18:27:19 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  discoverer: use GST_TYPE_TAG_LIST for tag lists
-	  They may not be structures in 0.11/1.0.
-
-2012-01-10 18:07:19 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  discoverer: fix potential tag list leaks
-	  Not that I have ever seen these in practice, but if they
-	  can't happen we may just as well just assign the new tag
-	  list. Merge properly to be on the safe side, and also
-	  avoid a useless tag list copy in the normal case where
-	  there is no tag list yet.
-
-2012-01-10 17:48:44 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  discoverer: fix potential caps leak
-	  in last else chunk.
-
-2012-01-10 16:57:04 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggstream.c:
-	  oggstream: fix tag list leak
-
-2012-01-10 16:51:09 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: fix pad leak
-
-2012-01-10 16:14:29 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: fix hang on small truncated files
-	  A first hang was happening when trying to locate a page backwards,
-	  where we'd sync forever on the same page.
-	  With that fixed, a second hang would happen after preparing an EOS
-	  event, but with no chain created yet to send it to, the pipeline
-	  would stay idle forever.
-	  An element error is now emitted for this case.
-
-2012-01-09 12:31:02 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/playback/gstplay-enum.h:
-	  playback: document DEINTERLACE flag
-
-2011-12-16 15:27:24 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: assume live stream if byte size cannot be determined
-	  This prevents trying to seek and failing, then ending up unable
-	  to stream because we can't get back at the headers.
-	  A more robust way would be to find a good place to reinject the
-	  headers when a seek fails, but I can't seem to get this to work.
-
-2012-01-07 20:12:17 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/rtsp/gstrtspconnection.c:
-	  rtspconnection: make hostname lookup more thread-safe
-	  Don't write IP number string to return into a static
-	  array which is shared amongst all threads (note: of
-	  course a copy is returned).
-	  https://bugzilla.gnome.org/show_bug.cgi?id=666711
-
-2012-01-07 19:39:42 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  discoverer: make is_subtitle_caps thread-safe
-
-2011-11-01 17:57:59 +0100  Havard Graff <havard.graff@tandberg.com>
-
-	* gst-libs/gst/pbutils/gstdiscoverer-types.c:
-	* gst-libs/gst/tag/tags.c:
-	* gst/audiotestsrc/gstaudiotestsrc.c:
-	* gst/encoding/gstsmartencoder.c:
-	* gst/playback/gstplaysink.c:
-	* tools/gst-discoverer.c:
-	  Fix various unlikely, but still potential memoryleaks in error code paths
-	  https://bugzilla.gnome.org/show_bug.cgi?id=667311
-
-2011-10-22 16:41:23 +0200  Havard Graff <havard.graff@tandberg.com>
-
-	* gst-libs/gst/app/gstappsrc.c:
-	  appsrc: implement get_caps vfunc
-	  This allows downstream elements to query what caps are available.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=667312
-
-2012-01-05 12:23:08 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tools/gst-discoverer.c:
-	  tools: avoid unportable vararg macro construct in gst-discoverer
-	  https://bugzilla.gnome.org/show_bug.cgi?id=667306
-
-2012-01-01 20:44:08 +0100  Idar Tollefsen <itollefs@cisco.com>
-
-	* configure.ac:
-	  build: Run platform check for platform specific configuration.
-
-2011-10-12 11:28:10 +0200  Pascal Buhler <pabuhler@cisco.com>
-
-	* gst-libs/gst/rtp/gstrtcpbuffer.c:
-	  rtcpbuffer: prevent overflow of 16bit header length.
-	  RTCP header can be  (2^16 + 1) * 4 bytes long, so when validating a bogus
-	  packet it was possible to get a 16bit overflow resulting in a length of 0.
-	  This would put the gst_rtcp_buffer_validate_data function in a endless loop.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=667313
-
-2011-09-24 14:05:42 +0200  Havard Graff <havard.graff@tandberg.com>
-
-	* gst/videotestsrc/videotestsrc.c:
-	  videotestsrc: keep the calculation fixed-point
-	  https://bugzilla.gnome.org/show_bug.cgi?id=667315
-
-2011-08-04 11:30:05 +0200  Idar Tollefsen <itollefs@cisco.com>
-
-	* ext/pango/gstclockoverlay.c:
-	* ext/pango/gsttimeoverlay.c:
-	  pango: changes includes from brackets to quotes for local files
-	  https://bugzilla.gnome.org/show_bug.cgi?id=667316
-
-2012-01-04 19:39:28 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* common:
-	  Automatic update of common submodule
-	  From 63d592e to cb5da59
-
-2012-01-03 11:04:23 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/playback/gststreamsynchronizer.c:
-	  streamsynchronizer: force fallback buffer_alloc when other pad not available
-	  ... to avoid unnecessary spurious errors (upon e.g. shutdown).
-	  If a real error is applicable in this unusual circumstance (missing other pad),
-	  other (STREAM_LOCK protected) call paths can take care of that.
-
-2012-01-03 11:02:17 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/playback/gststreamsynchronizer.c:
-	  streamsynchronizer: avoid crashing when operating on released pad
-
-2011-12-27 14:37:26 -0300  Thiago Santos <thiago.sousa.santos@collabora.com>
-
-	* ext/ogg/gstoggmux.c:
-	  oggmux: fix leak when initializing pads
-	  Pads are initialized twice: when requesting pads and when
-	  initializing collectpads. Avoid double initialization by
-	  checking if collectpads are still going to be initialized when
-	  creating request pads.
-
-2011-12-23 22:51:59 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/theora/gsttheoraenc.c:
-	  theoraenc: fix template caps creation on big endian systems
-
-2011-12-23 22:24:44 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstexiftag.c:
-	* tests/check/libs/tag.c:
-	  tag: fix writing of Exif tag payloads <= 4 bytes
-	  When the payload for an Exif tag is less than or equal to 4 bytes,
-	  the data is simply put into the offset field. Fix writing these
-	  kinds of payloads on big endian systems (and possibly also on
-	  little endian systems). The caller will have already formatted
-	  the bytes in memory according to the writer's endianness, so just
-	  write out the bytes as they are in this case. Fixes tags unit test
-	  on big endian systems.
-
-2011-12-22 16:54:18 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: add a few more debug statements
-
-2011-12-22 16:53:49 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	* gst-libs/gst/audio/gstaudiodecoder.h:
-	  audiodecoder: tweak documentation
-
-2011-12-22 07:53:39 -0300  Thiago Santos <thiago.sousa.santos@collabora.com>
-
-	* gst-libs/gst/tag/gstxmptag.c:
-	* tests/check/libs/tag.c:
-	  tag: xmp: Keep compatibility with our old generated xmp
-	  We used to add a trailing \n to the end of generated xmp packets.
-	  Windows viewer was unhappy with it and we fixed it in
-	  96d2120c2bb0b29e1849098198f5fbef81939cdd
-	  The problem is that this caused xmp generated before this fix
-	  to not be recognized and parsed anymore. This patch makes it
-	  recognize xmp with the trailing \n and without, fixing the
-	  regression. Also adds tests for it.
-
-2011-12-14 16:34:39 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/video/video-blend.c:
-	  gstvideo: fix a RGB ordering mixup in colorspace conversion code
-
-2011-12-20 12:42:18 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	* gst-libs/gst/audio/gstaudiodecoder.h:
-	  audiodecoder: set a non-zero default maximum tolerated errors
-	  Whereas the previous default 0 was backwards compatible in that it lead
-	  to erroring out immediately upon any error, elements that are really
-	  ported and using the base class error macro can be assumed to intend to
-	  improve behaviour rather than maintaining the old one.  So, make it easy
-	  on those and any future one and tolerate some errors by default, as intended.
-	  Fixes #666579.
-
-2011-12-15 11:01:01 -0300  Thiago Santos <thiago.sousa.santos@collabora.com>
-
-	* gst-libs/gst/tag/gstexiftag.c:
-	  tag: exif: do not include \0 in size passed to g_convert
-	  When using g_convert, we should only pass the length
-	  of the string content (without the \0) as g_convert will
-	  only parse the real contents when changing formats. Including
-	  the \0 causes it to add another \0, increasing the string
-	  size when not needed.
-	  For example, when writting a North geo location ref entry, that should
-	  be a string with a single N letter, it would write:
-	  "N\0\0", causing the string to have size 3, instead of 2 as expected.
-	  In our case, we can pass -1 and let g_convert calculate the strlen as
-	  we don't use the length anywhere else.
-	  This fixes jifmux's tests on gst-plugins-bad.
-
-2011-10-03 14:51:56 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: tweak chain topology description
-	  ... to also properly indicate chain's endpad if no elements are in the
-	  chain (due to the endpad being a raw demuxer pad, or one setup without
-	  decoders since uridecodebin or higher up decided not to need those).
-
-2011-12-13 12:55:45 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	  baseaudiosink: fix late buffer leak
-
-2011-12-12 11:54:56 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst-libs/gst/glib-compat-private.h:
-	  glib-compat: Add license boilerplate for LGPL
-
-2011-12-10 02:08:49 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* configure.ac:
-	* win32/common/_stdint.h:
-	* win32/common/audio-enumtypes.c:
-	* win32/common/config.h:
-	* win32/common/gstrtsp-enumtypes.c:
-	  0.10.35.2 pre-release
-
-2011-12-10 01:36:14 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* po/LINGUAS:
-	* po/cs.po:
-	* po/eo.po:
-	* po/es.po:
-	* po/gl.po:
-	* po/lv.po:
-	* po/sr.po:
-	  po: update translations
-
-2011-12-09 15:39:12 +0000  Christian Fredrik Kalager Schaller <christian.schaller@collabora.co.uk>
-
-	* gst-plugins-base.spec.in:
-	  Add latest header file to spec file
-
-2011-12-09 01:31:20 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/typefind/gsttypefindfunctions.c:
-	  typefindfunctions: only typefind text with a BOM as text/utf16 or text/utf32
-	  We added the utf typefinder because the mp3 typefinder was a tad
-	  overzealous when it came to typefinding things as mp3, and replaced
-	  it with even more overzealous utf16/32 typefinders.
-	  Fixes unit test.
-
-2011-12-07 18:45:28 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/video/video-overlay-composition.c:
-	* gst-libs/gst/video/video-overlay-composition.h:
-	  video: make composition_blend() return a boolean
-	  Not that anyone will ever check that, and it's not clear what
-	  they're supposed to do if it fails, but at least it's there.
-
-2011-12-07 18:31:58 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-docs.sgml:
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/video/video-overlay-composition.c:
-	* gst-libs/gst/video/video-overlay-composition.h:
-	  docs: add new API to docs
-
-2011-12-07 17:57:08 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/video/video-overlay-composition.c:
-	* gst-libs/gst/video/video-overlay-composition.h:
-	* tests/check/libs/video.c:
-	* win32/common/libgstvideo.def:
-	  video: add seqnum getters for overlay compositions and rectangles
-	  API: gst_video_overlay_composition_get_seqnum()
-	  API: gst_video_overlay_rectangle_get_seqnum()
-
-2011-11-23 15:45:57 -0300  Thibault Saunier <thibault.saunier@collabora.com>
-
-	* gst-libs/gst/video/video.c:
-	  video: support any type of video in _parse_caps
-	  Slight change in semantics for convenience. Shouldn't cause any
-	  problems since this function is usually only used on pre-filtered
-	  caps and not random caps, and it's hard to imagine a situation
-	  where someone would want to rely on the previous behaviour.
-
-2011-12-06 21:57:32 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/videorate/gstvideorate.c:
-	  videorate: don't leak previous buffer when shutting down
-	  Implement stop vfunc after port to basetransform, so we
-	  can clean up properly. Fixes make elements/videorate.valgrind
-
-2011-12-06 20:30:55 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/libs/video.c:
-	  tests: fix calculation of last pixel offset in video unit test
-	  And check the right buffer (pix2) in one case.
-
-2011-12-06 15:01:05 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/examples/fft/Makefile.am:
-	  examples: fix build of fft example
-	  Should link against our own libgstfft-0.10.
-
-2011-12-06 14:55:38 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/video/video.c:
-	  video: fix leak in gst_video_format_new_template_caps()
-	  g_value_reset() is not the same as g_value_unset()
-
-2011-11-23 15:43:46 -0300  Thibault Saunier <thibault.saunier@collabora.com>
-
-	* gst/playback/gstsubtitleoverlay.c:
-	  subtitleoverlay: add suport for hardware accelerated videos
-	  Don't plug converters for non-raw video.
-
-2011-12-05 15:48:07 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/video/video-overlay-composition.c:
-	  video: don't use deprecated GStaticMutex with newer glib versions
-
-2011-12-05 15:34:42 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/examples/Makefile.am:
-	  examples: dist fft sub-directory
-
-2011-11-28 10:05:50 -0300  Thibault Saunier <thibault.saunier@collabora.com>
-
-	* ext/pango/gsttextoverlay.c:
-	  textoverlay: unpremultiply text image
-	  The GstVideoOverlayComposition only supports unpremultiplied ARGB
-	  (for now anyway, support for pre-multiplied alpha is planned.)
-
-2011-11-23 12:49:02 -0300  Thibault Saunier <thibault.saunier@collabora.com>
-
-	* ext/pango/gsttextoverlay.c:
-	* ext/pango/gsttextoverlay.h:
-	  textoverlay: Attach OverlayComposition to buffers when needed
-	  Add video/x-surface support in the caps
-	  We should then attach it whenever the sink supports it, but this
-	  is working for the time being
-
-2011-11-18 13:22:52 -0300  Thibault Saunier <thibault.saunier@collabora.com>
-
-	* ext/pango/gsttextoverlay.c:
-	* ext/pango/gsttextoverlay.h:
-	  textoverlay: Make the text_image data a buffer
-	  This way we won't free data that would be attached to some buffer.
-
-2011-11-18 11:04:47 -0300  Thibault Saunier <thibault.saunier@collabora.com>
-
-	* ext/pango/gsttextoverlay.c:
-	  textoverlay: Sync the caps with the new supported formats
-	  Thanks to the use of the new video composition library, we gain support to
-	  more colospaces and formats, let's state it.
-
-2011-11-16 17:54:43 -0300  Thibault Saunier <thibault.saunier@collabora.com>
-
-	* ext/pango/gsttextoverlay.c:
-	* ext/pango/gsttextoverlay.h:
-	  textoverlay: Make use of the new video blending utility
-
-2011-11-25 16:46:09 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/libs/video.c:
-	  tests: add basic unit test for video overlay composition and rectangles
-
-2011-11-12 14:59:35 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/video/Makefile.am:
-	* gst-libs/gst/video/video-overlay-composition.c:
-	* gst-libs/gst/video/video-overlay-composition.h:
-	* win32/common/libgstvideo.def:
-	  video: add video overlay composition API for subtitles
-	  Basic API to attach overlay rectangles to buffers,
-	  or blend them directly onto raw video buffers.
-	  To be used primarily for things like subtitles or
-	  logo overlays, not meant to replace videomixer.
-	  Allows us to associate subtitle overlays with
-	  non-raw video surface buffers, so that subtitles
-	  are not lost and can instead be rendered later
-	  when those surfaces are displayed or converted,
-	  whilst re-using all the existing overlay plugins
-	  and not having to teach them about our special
-	  video surfaces. Could also have been made part
-	  of the surface buffer abstraction of course, but
-	  a secondary goal was to consolidate the blending
-	  code for raw video into libgstvideo, and this
-	  kind of API allows us to do both in a way that's
-	  minimally invasive to existing elements, and at
-	  the same time is fairly intuitive.
-	  More features and extensions like the ability to
-	  pass the source data or text/markup directly will
-	  be added later.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=665080
-	  API: gst_video_buffer_get_overlay_composition()
-	  API: gst_video_buffer_set_overlay_composition()
-	  API: gst_video_overlay_composition_new()
-	  API: gst_video_overlay_composition_add_rectangle()
-	  API: gst_video_overlay_composition_n_rectangles()
-	  API: gst_video_overlay_composition_get_rectangle()
-	  API: gst_video_overlay_composition_make_writable()
-	  API: gst_video_overlay_composition_copy()
-	  API: gst_video_overlay_composition_ref()
-	  API: gst_video_overlay_composition_unref()
-	  API: gst_video_overlay_composition_blend()
-	  API: gst_video_overlay_rectangle_new_argb()
-	  API: gst_video_overlay_rectangle_get_pixels_argb()
-	  API: gst_video_overlay_rectangle_get_pixels_unscaled_argb()
-	  API: gst_video_overlay_rectangle_get_render_rectangle()
-	  API: gst_video_overlay_rectangle_set_render_rectangle()
-	  API: gst_video_overlay_rectangle_copy()
-	  API: gst_video_overlay_rectangle_ref()
-	  API: gst_video_overlay_rectangle_unref()
-
-2011-11-23 00:31:18 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/video/Makefile.am:
-	* gst-libs/gst/video/video-blend.h:
-	  video: hide private video-blend.[ch] from gobject-introspection
-	  And remove unused fields from helper structure.
-
-2011-11-15 18:00:00 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/video/videoblendorc-dist.c:
-	* gst-libs/gst/video/videoblendorc-dist.h:
-	  video: add fallbacks for compilation without orc
-
-2011-10-17 17:25:11 +0200  Thibault Saunier <thibault.saunier@collabora.com>
-
-	* gst-libs/gst/video/.gitignore:
-	* gst-libs/gst/video/Makefile.am:
-	* gst-libs/gst/video/video-blend.c:
-	* gst-libs/gst/video/video-blend.h:
-	* gst-libs/gst/video/videoblendorc.orc:
-	  video: add some internal helper functions for image blending
-	  This could be improved if we decide we don't need it to
-	  be this generic/flexible.
-
-2011-12-05 09:38:33 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst-libs/gst/interfaces/xoverlay.c:
-	  xoverlay: Fix mistakes in the sample code
-	  Fixes bug #665430.
-
-2011-12-04 20:50:25 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/alsa/gstalsamixer.c:
-	* ext/ogg/gstoggdemux.c:
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	* gst/playback/gstdecodebin.c:
-	* gst/playback/gstdecodebin2.c:
-	* gst/playback/gstplaybin2.c:
-	* gst/playback/gstplaysink.c:
-	* gst/playback/gststreamsynchronizer.c:
-	* gst/tcp/gstmultifdsink.c:
-	  Suppress deprecation warnings in selected files, for g_static_rec_mutex_* mostly
-	  GStaticRecMutex is part of our API/ABI, not much we can do here
-	  in 0.10 for most of these.
-
-2011-12-04 20:38:19 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/alsa/gstalsamixer.c:
-	* ext/alsa/gstalsamixer.h:
-	  alsamixer: use GRectMutext instead of GStaticRecMutex with newer glib versions
-
-2011-12-04 20:21:26 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/alsa/gstalsamixer.c:
-	* ext/alsa/gstalsamixer.h:
-	  alsamixer: embed static mutexes into the mixer structure
-	  instead of allocating them dynamically
-
-2011-12-04 17:02:39 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/examples/encoding/encoding.c:
-	* tests/examples/overlay/gtk-xoverlay.c:
-	* tests/examples/overlay/qt-xoverlay.cpp:
-	* tests/examples/seek/jsseek.c:
-	* tests/examples/seek/scrubby.c:
-	* tests/examples/seek/seek.c:
-	* tests/icles/stress-playbin.c:
-	* tests/icles/test-colorkey.c:
-	* tests/icles/test-xoverlay.c:
-	* tools/gst-discoverer.c:
-	  tools, tests: g_thread_init() is deprecated in glib master
-	  It's not needed any longer.
-
-2011-12-04 16:43:38 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/alsa/gstalsadeviceprobe.c:
-	* ext/alsa/gstalsamixer.c:
-	* ext/alsa/gstalsasink.c:
-	* ext/alsa/gstalsasrc.c:
-	* ext/ogg/gstoggdemux.c:
-	* ext/pango/gsttextoverlay.c:
-	* gst-libs/gst/Makefile.am:
-	* gst-libs/gst/app/gstappsink.c:
-	* gst-libs/gst/app/gstappsrc.c:
-	* gst-libs/gst/audio/gstaudiosink.c:
-	* gst-libs/gst/audio/gstaudiosrc.c:
-	* gst-libs/gst/audio/gstringbuffer.c:
-	* gst-libs/gst/glib-compat-private.h:
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	* gst-libs/gst/rtsp/gstrtspconnection.c:
-	* gst-libs/gst/video/convertframe.c:
-	* gst/encoding/gststreamcombiner.c:
-	* gst/encoding/gststreamsplitter.c:
-	* gst/playback/gstdecodebin.c:
-	* gst/playback/gstdecodebin2.c:
-	* gst/playback/gstplaybasebin.c:
-	* gst/playback/gstplaybin2.c:
-	* gst/playback/gstplaysinkconvertbin.c:
-	* gst/playback/gststreamsynchronizer.c:
-	* gst/playback/gstsubtitleoverlay.c:
-	* gst/playback/gsturidecodebin.c:
-	* gst/tcp/gstmultifdsink.c:
-	* sys/ximage/ximagesink.c:
-	* sys/xvimage/xvimagesink.c:
-	  Work around deprecated thread API in glib master
-	  Add private replacements for deprecated functions such as
-	  g_mutex_new(), g_mutex_free(), g_cond_new() etc., mostly
-	  to avoid the deprecation warnings. We'll change these
-	  over to the new API once we depend on glib >= 2.32.
-	  Replace g_thread_create() with g_thread_try_new().
-
-2011-12-04 15:23:21 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/xmpwriter.c:
-	  xmpwriter: update for thread API deprecations in glib master
-
-2011-12-04 13:43:06 +0100  Stefan Sauer <ensonic@users.sf.net>
-
-	* tests/examples/fft/Makefile.am:
-	  fft-example: re-add Makefile.am
-
-2011-12-02 23:35:50 +0100  Stefan Sauer <ensonic@users.sf.net>
-
-	* configure.ac:
-	  configure: trim trailing whitespace
-
-2011-12-02 23:34:47 +0100  Stefan Sauer <ensonic@users.sf.net>
-
-	* configure.ac:
-	* tests/examples/Makefile.am:
-	* tests/examples/fft/.gitignore:
-	* tests/examples/fft/fftrange.c:
-	  tests: add a test for fft result value-ranges
-	  Add a small example that uses ffts of various types and parameters and check the
-	  result value ranges.
-
-2011-09-13 21:10:43 +0200  Piotr Fusik <fox@scene.pl>
-
-	* docs/design/design-audiosinks.txt:
-	* docs/design/design-decodebin.txt:
-	* docs/design/design-encoding.txt:
-	* docs/design/design-orc-integration.txt:
-	* docs/design/draft-keyframe-force.txt:
-	* docs/design/draft-va.txt:
-	* ext/alsa/gstalsamixer.c:
-	* ext/libvisual/visual.c:
-	* ext/ogg/README:
-	* ext/ogg/gstoggdemux.c:
-	* ext/theora/gsttheoradec.c:
-	* ext/theora/gsttheoradec.h:
-	* ext/theora/gsttheoraparse.c:
-	* ext/vorbis/gstvorbisdec.c:
-	* gst-libs/gst/app/gstappsink.c:
-	* gst-libs/gst/app/gstappsrc.c:
-	* gst-libs/gst/app/gstappsrc.h:
-	* gst-libs/gst/audio/audio.c:
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	* gst-libs/gst/audio/gstbaseaudiosrc.c:
-	* gst-libs/gst/audio/gstringbuffer.c:
-	* gst-libs/gst/audio/multichannel.h:
-	* gst-libs/gst/fft/gstfftf32.c:
-	* gst-libs/gst/fft/gstfftf64.c:
-	* gst-libs/gst/fft/gstffts16.c:
-	* gst-libs/gst/fft/gstffts32.c:
-	* gst-libs/gst/interfaces/navigation.c:
-	* gst-libs/gst/interfaces/xoverlay.c:
-	* gst-libs/gst/netbuffer/gstnetbuffer.c:
-	* gst-libs/gst/pbutils/descriptions.c:
-	* gst-libs/gst/pbutils/encoding-profile.c:
-	* gst-libs/gst/pbutils/encoding-target.h:
-	* gst-libs/gst/pbutils/gstdiscoverer-types.c:
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	* gst-libs/gst/rtp/gstbasertpaudiopayload.c:
-	* gst-libs/gst/rtp/gstrtcpbuffer.c:
-	* gst-libs/gst/rtp/gstrtpbuffer.c:
-	* gst-libs/gst/rtsp/gstrtspconnection.c:
-	* gst-libs/gst/rtsp/gstrtsprange.c:
-	* gst-libs/gst/tag/gstexiftag.c:
-	* gst-libs/gst/tag/gstvorbistag.c:
-	* gst-libs/gst/tag/gstxmptag.c:
-	* gst-libs/gst/tag/id3v2.3.0.txt:
-	* gst-libs/gst/tag/id3v2.4.0-frames.txt:
-	* gst-libs/gst/tag/id3v2.4.0-structure.txt:
-	* gst/adder/gstadder.c:
-	* gst/audioconvert/audioconvert.c:
-	* gst/audiorate/gstaudiorate.c:
-	* gst/audioresample/gstaudioresample.c:
-	* gst/audioresample/resample.c:
-	* gst/encoding/gststreamsplitter.c:
-	* gst/ffmpegcolorspace/avcodec.h:
-	* gst/ffmpegcolorspace/gstffmpegcodecmap.c:
-	* gst/ffmpegcolorspace/imgconvert.c:
-	* gst/ffmpegcolorspace/imgconvert_template.h:
-	* gst/ffmpegcolorspace/mem.c:
-	* gst/playback/README:
-	* gst/playback/gstdecodebin.c:
-	* gst/playback/gstdecodebin2.c:
-	* gst/playback/gstplaybasebin.c:
-	* gst/playback/gstplaybasebin.h:
-	* gst/playback/gstplaybin.c:
-	* gst/playback/gstplaybin2.c:
-	* gst/playback/gstplaysink.c:
-	* gst/playback/gsturidecodebin.c:
-	* gst/tcp/gstmultifdsink.c:
-	* gst/tcp/gsttcp.c:
-	* gst/typefind/gsttypefindfunctions.c:
-	* gst/videotestsrc/gstvideotestsrc.c:
-	* m4/freetype2.m4:
-	* sys/v4l/v4lmjpegsrc_calls.c:
-	* sys/v4l/videodev_mjpeg.h:
-	* sys/ximage/ximagesink.c:
-	* sys/xvimage/xvimagesink.c:
-	* sys/xvimage/xvimagesink.h:
-	* tests/check/elements/adder.c:
-	* tests/check/elements/audioresample.c:
-	* tests/check/elements/gnomevfssink.c:
-	* tests/check/elements/textoverlay.c:
-	* tests/examples/encoding/encoding.c:
-	  various: typo fixes
-	  Fix typos in code and docs. Fixes. #658984
-
-2011-12-01 11:59:17 +0100  Stefan Sauer <ensonic@users.sf.net>
-
-	* gst/adder/gstadder.c:
-	  adder: be more graceful in the clipfunction
-	  Doing dynamic pipelines is hard in 0.10. As we don't have the sticky events in
-	  0.10 and sending such events in special elements like adder and tee was outvoted
-	  on last attempt, be graceful to the misbehaviour instead.
-
-2011-12-01 01:22:19 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/elements/audioresample.c:
-	  tests: fix caps leak in audioresample tests
-
-2011-12-01 01:07:26 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/pipelines/basetime.c:
-	  tests: fix memory leak in basetime test
-
-2011-11-30 23:58:19 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/playback/gstplaybin2.c:
-	  playbin2: tone down debug message about file URIs with spaces
-	  Complain a bit less loudly about URIs that have not been
-	  escaped properly.
-
-2011-11-30 23:15:35 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/alsa/gstalsasrc.c:
-	* ext/alsa/gstalsasrc.h:
-	  Revert "alsasrc: Improve timestamp accuracy"
-	  This reverts commit 0b774e0b7cf7a8ef1780fb6100228ca6e8ca8bcf.
-
-2011-11-30 23:15:22 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/alsa/gstalsasrc.c:
-	  Revert "alsasrc: Fix some compilation errors"
-	  This reverts commit 2b84f5bd74ddb50f7832917ea8b4dd38d005631b.
-
-2011-11-30 23:15:12 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/alsa/gstalsasrc.c:
-	  Revert "alsa: Remove unused but set variable"
-	  This reverts commit e9aed7f31c7e9e415f733e147140ce3ef2f57a61.
-
-2011-11-30 23:15:03 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/alsa/gstalsasrc.c:
-	* ext/alsa/gstalsasrc.h:
-	  Revert "alsasrc: fail gracefully when ALSA does not give timestamps"
-	  This reverts commit c7282a5718c7f31f84fb31b2c38fab0f9a38e2b0.
-
-2011-11-30 23:14:54 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/alsa/gstalsasrc.c:
-	  Revert "alsasrc: handle the case where the drivers don't supply timestamps"
-	  This reverts commit 8154b69112cdc4830cd6002ec6c1f2917d30437b.
-
-2011-11-28 10:55:39 +0100  Stefan Sauer <ensonic@google.com>
-
-	* ext/alsa/gstalsasrc.c:
-	  Revert "alsasrc: style fix"
-	  This reverts commit f70ca6d4cbfd2b672dcc7215814bf6b39ce2c3f8.
-
-2011-11-30 14:25:11 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsinkconvertbin: Don't send undefined NEWSEGMENT events to the internal elements
-	  This happens when the internal elements are added before any NEWSEGMENT
-	  event arrived and in that case we shouldn't send a NEWSEGMENT event
-	  to the internal elements at all. They will get the NEWSEGMENT event
-	  from upstream later.
-
-2011-11-29 14:15:45 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaybin2.c:
-	  playbin2: Fix decoder-sink compatibility check for raw audio/video formats
-	  If the sink supports raw audio/video, we first check
-	  if the decoder could output any raw audio/video format
-	  and assume it is compatible with the sink then. We don't
-	  do a complete compatibility check here if converters
-	  are plugged between the decoder and the sink because
-	  the converters will convert between raw formats and
-	  even if the decoder format is not supported by the decoder
-	  a converter will convert it.
-	  We assume here that the converters can convert between
-	  any raw format.
-	  Fixes bug #665120.
-
-2011-11-29 09:11:21 +0100  Alessandro Decina <alessandro.d@gmail.com>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: fix compiler warning
-
-2011-11-29 08:49:53 +0100  Alessandro Decina <alessandro.d@gmail.com>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/video/video.c:
-	* gst-libs/gst/video/video.h:
-	* win32/common/libgstvideo.def:
-	  libgstvideo: minor fixes to key unit events
-	  Make out args to gst_video_event_parse_{downstream|upstream}_force_key_unit
-	  optional, update libgstvideo.def and fix docs a bit.
-	  API: gst_video_event_new_upstream_force_key_unit
-	  API: gst_video_event_new_downstream_force_key_unit
-	  API: gst_video_event_is_force_key_unit
-	  API: gst_video_event_parse_upstream_force_key_unit
-	  API: gst_video_event_parse_downstream_force_key_unit
-	  https://bugzilla.gnome.org/show_bug.cgi?id=607742
-
-2011-06-05 01:49:38 +0200  Andoni Morales Alastruey <ylatuya@gmail.com>
-
-	* gst-libs/gst/video/video.c:
-	* gst-libs/gst/video/video.h:
-	  libgstvideo: Add force key unit events
-
-2011-11-28 20:11:09 +0100  Philippe Normand <philn@igalia.com>
-
-	* gst-libs/gst/fft/gstfft.h:
-	* gst-libs/gst/fft/gstfftf32.h:
-	* gst-libs/gst/fft/gstfftf64.h:
-	* gst-libs/gst/fft/gstffts16.h:
-	* gst-libs/gst/fft/gstffts32.h:
-	  fft: Bracket public headers
-	  This is especially needed if the gstfftw library is used from C++
-	  code.
-	  Fixes #665074
-
-2011-11-28 20:10:18 +0100  Philippe Normand <phil@base-art.net>
-
-	* gst/typefind/gsttypefindfunctions.c:
-	  typefindfunctions: Fix compiler warning
-
-2011-11-28 19:03:50 +0100  Alexey Fisher <bug-track@fisher-privat.net>
-
-	* gst/typefind/gsttypefindfunctions.c:
-	  typefind: fix build error
-	  fix build errors:
-	  gsttypefindfunctions.c:248:25: error: 'low' may be used uninitialized in this function [-Werror=uninitialized]
-	  gsttypefindfunctions.c:239:24: error: 'high' may be used uninitialized in this function [-Werror=uninitialized]
-	  Signed-off-by: Alexey Fisher <bug-track@fisher-privat.net>
-
-2011-11-28 19:06:57 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsinkconvertbin: Fix stupid mistake in last commit
-
-2011-11-28 19:03:54 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsinkconvertbin: Only return the converter caps if we actually have raw caps
-	  Fixes bug #664818 (hopefully).
-
-2011-11-28 17:59:32 +0100  Kipp Cannon <kcannon@cita.utoronto.ca>
-
-	* gst/audioresample/gstaudioresample.c:
-	  audioresample: Don't emit DISCONT buffers if no discontinuity happened
-	  audioresample is derived from GstBaseTransform, and one of
-	  GstBaseTransform's traits is that if the derived element does not
-	  produce an output buffer from some input buffer then the first output
-	  buffer after that gets flaged as a discontinuity, whether or not the
-	  buffer actually is discontinuous from the output buffer that preceded
-	  it. When downsampling, the audioresample element requires more than
-	  one input sample for each output sample, and if the ratio of input to
-	  output sample rates is high enough and the input buffers short enough
-	  it can come to pass that the resampler does not receive enough samples
-	  on its input to produce any output.  Currently the resampler returns
-	  GST_BASE_TRANSFORM_FLOW_DROPPED from the transform() method in this case,
-	  causing the next buffer to be flagged as a discontinuity. If subsequent
-	  elements in the pipeline reset themselves on disconts, this can cause
-	  clicks and other undesireable behaviour.
-	  Fixes bug #665004.
-
-2011-09-30 20:00:50 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/typefind/Makefile.am:
-	* gst/typefind/gsttypefindfunctions.c:
-	  typefind: typefind UTF-16 and UTF-32
-	  This avoids the MP3 typefinder from getting the highest score
-	  every time it thinks there's something it might possibly be
-	  able to parse.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=607619
-
-2011-11-28 13:27:29 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/theora/gsttheoradec.c:
-	* ext/theora/gsttheoradec.h:
-	  Revert "theoradec: move the QoS logic to libgstvideo"
-	  This reverts commit 149a4ce390a78e21309b210f7daba9db5d42afe6.
-	  *grumble* I managed to merge something I did not mean to.
-
-2011-11-28 13:26:53 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/video/video.c:
-	* gst-libs/gst/video/video.h:
-	* win32/common/libgstvideo.def:
-	  Revert "libgstvideo: add a new API to handle QoS events and dropping logic"
-	  This reverts commit eb03323fb683e06ed8e7f557037f13252f150c25.
-	  *grumble* I managed to merge something I did not mean to.
-
-2011-11-28 12:51:22 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/alsa/gstalsasink.c:
-	* ext/alsa/gstalsasrc.c:
-	* ext/gio/gstgiobasesink.c:
-	* ext/gio/gstgiobasesrc.c:
-	* ext/gnomevfs/gstgnomevfssink.c:
-	* ext/gnomevfs/gstgnomevfssrc.c:
-	* ext/libvisual/visual.c:
-	* ext/ogg/gstoggaviparse.c:
-	* ext/ogg/gstoggdemux.c:
-	* ext/ogg/gstoggmux.c:
-	* ext/ogg/gstoggparse.c:
-	* ext/ogg/gstogmparse.c:
-	* ext/pango/gsttextoverlay.c:
-	* ext/pango/gsttextrender.c:
-	* ext/theora/gsttheoradec.c:
-	* ext/theora/gsttheoraenc.c:
-	* ext/theora/gsttheoraparse.c:
-	* ext/vorbis/gstvorbisdec.c:
-	* ext/vorbis/gstvorbisenc.c:
-	* ext/vorbis/gstvorbisparse.c:
-	* gst-libs/gst/app/gstappsink.c:
-	* gst-libs/gst/app/gstappsrc.c:
-	* gst-libs/gst/cdda/gstcddabasesrc.c:
-	* gst-libs/gst/tag/gsttagdemux.c:
-	* gst/adder/gstadder.c:
-	* gst/audioconvert/gstaudioconvert.c:
-	* gst/audiorate/gstaudiorate.c:
-	* gst/audioresample/gstaudioresample.c:
-	* gst/audiotestsrc/gstaudiotestsrc.c:
-	* gst/encoding/gstencodebin.c:
-	* gst/encoding/gstsmartencoder.c:
-	* gst/encoding/gststreamcombiner.c:
-	* gst/encoding/gststreamsplitter.c:
-	* gst/ffmpegcolorspace/gstffmpegcolorspace.c:
-	* gst/gdp/gstgdpdepay.c:
-	* gst/gdp/gstgdppay.c:
-	* gst/playback/gstdecodebin.c:
-	* gst/playback/gstdecodebin2.c:
-	* gst/playback/gstplaysink.c:
-	* gst/playback/gststreamselector.c:
-	* gst/playback/gststreamsynchronizer.c:
-	* gst/playback/gstsubtitleoverlay.c:
-	* gst/playback/gsturidecodebin.c:
-	* gst/subparse/gstssaparse.c:
-	* gst/subparse/gstsubparse.c:
-	* gst/tcp/gstmultifdsink.c:
-	* gst/tcp/gsttcpclientsink.c:
-	* gst/tcp/gsttcpclientsrc.c:
-	* gst/tcp/gsttcpserversrc.c:
-	* gst/videorate/gstvideorate.c:
-	* gst/videoscale/gstvideoscale.c:
-	* gst/videotestsrc/gstvideotestsrc.c:
-	* sys/v4l/gstv4lmjpegsink.c:
-	* sys/v4l/gstv4lmjpegsrc.c:
-	* sys/v4l/gstv4lsrc.c:
-	* sys/ximage/ximagesink.c:
-	* sys/xvimage/xvimagesink.c:
-	* tests/check/elements/audiorate.c:
-	* tests/check/elements/decodebin.c:
-	* tests/check/elements/decodebin2.c:
-	* tests/check/elements/playbin.c:
-	* tests/check/elements/playbin2-compressed.c:
-	* tests/check/elements/playbin2.c:
-	* tests/check/elements/videoscale.c:
-	  various: fix pad template leaks
-	  https://bugzilla.gnome.org/show_bug.cgi?id=662664
-
-2011-09-07 16:04:14 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/theora/gsttheoradec.c:
-	* ext/theora/gsttheoradec.h:
-	  theoradec: move the QoS logic to libgstvideo
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658241
-
-2011-09-05 13:56:05 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/video/video.c:
-	* gst-libs/gst/video/video.h:
-	* win32/common/libgstvideo.def:
-	  libgstvideo: add a new API to handle QoS events and dropping logic
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658241
-
-2011-11-28 11:30:18 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	* gst-libs/gst/audio/gstaudioencoder.h:
-	  audioencoder: elaborate some documentation
-
-2011-11-28 11:28:06 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	* gst-libs/gst/audio/gstaudiodecoder.h:
-	  audiodecoder: add some documentation
-
-2011-11-21 14:26:54 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	  audiodecoder: really discard NULL decoded frame altogether
-	  ... including any timestamp, rather than having that one influence base_ts.
-
-2011-11-28 10:55:39 +0100  Stefan Sauer <ensonic@google.com>
-
-	* ext/alsa/gstalsasrc.c:
-	  alsasrc: style fix
-	  Use timestamp==0 instead of mixing it with !timestamp style checks.
-
-2011-11-28 09:12:37 +0100  Stefan Sauer <ensonic@users.sf.net>
-
-	* ext/alsa/gstalsasrc.c:
-	  alsasrc: handle the case where the drivers don't supply timestamps
-	  If highres-timestamp is 0, try lowres and if that fails fallback to system clock
-	  timestamps.
-
-2011-11-01 15:21:54 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggmux.c:
-	  oggmux: set collectpads2 not to wait on sparse streams
-	  https://bugzilla.gnome.org/show_bug.cgi?id=663174
-
-2011-11-25 15:35:39 +0100  Josep Torra <n770galaxy@gmail.com>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsinkconvertbin: make identiy silent
-
-2011-11-25 13:11:54 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/vorbis/Makefile.am:
-	* gst-libs/gst/audio/Makefile.am:
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	* gst-libs/gst/audio/gstaudiodecoder.h:
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	* gst-libs/gst/audio/gstaudioencoder.h:
-	  audio: remove unstable API guards from the audio decoder and encoder base classes
-
-2011-11-25 12:58:22 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/playback/gstplaybin2.c:
-	  docs: mention explicitly that playbin2 signals are emitted from a streaming thread
-
-2011-11-25 11:11:12 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Set the multiqueue limits to the playing limits after overrun too
-	  We don't expect any new pads anymore and prerolling is finished now.
-
-2011-11-25 11:08:58 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Cache the upstream seekability for demuxer decode chains and use it for the non-preroll multiqueue limits
-	  After preroll the multiqueue limits are still set to the preroll
-	  limits if use-buffering is set to TRUE. In that case we only want
-	  time limits on the multiqueue if upstream is seekable.
-
-2011-11-08 13:55:58 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: fix prerolling for low bitrate streams from hlsdemux
-	  Such streams were detected as seekable, as the query on the typefind
-	  element was testing the m3u8 file listing the actual streams, and
-	  not going through the demuxer(s).
-	  We now check for seekability for each multiqueue following a demuxer,
-	  so the query will flow through the elements which might prevent seeking.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=647769
-
-2011-10-24 11:46:05 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: minor cleanup
-
-2011-09-27 16:45:26 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/riff/riff-ids.h:
-	  libgstriff: add a couple tags that need skipping
-	  Found in a sample in the wild, appears to be ID3 tag.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=660249
-
-2011-11-24 14:41:13 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/videorate/gstvideorate.c:
-	  videorate: Rename ARG_ enums to PROP_
-	  This is more consistent with other code and these are
-	  properties anyway, not arguments
-
-2011-11-24 14:29:49 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/videorate/gstvideorate.c:
-	* gst/videorate/gstvideorate.h:
-	  videorate: Add property to force an output framerate
-	  API: GstVideoRate:force-fps
-	  Changing the framerate during playback is not possible
-	  with a capsfilter downstream if upstream is not using
-	  gst_pad_alloc_buffer(). In that case there's no way in
-	  0.10 to signal to videorate that the preferred framerate
-	  has changed.
-	  This new property will force the output framerate to
-	  a specific value and can be changed during playback.
-
-2011-11-24 12:38:54 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsinkconvertbin: Reconfigure if we switch from raw to incompatible raw caps
-	  We might need to add converters and worked in passthrough mode before.
-
-2011-11-24 12:37:58 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsinkconvertbin: Override acceptcaps function for the two ghostpads
-	  The ghostpad acceptcaps functions are not valid in this case because
-	  we don't only accept the caps accepted by the target but could also
-	  insert converters. Fixes bug #663892.
-
-2011-11-24 11:34:12 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysinkaudioconvert.c:
-	  playsinkaudioconvert: use-volume and use-converters are no construct-only properties anymore
-	  Fixes bug #663893.
-
-2011-10-22 20:29:26 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: skip the second bisection when possible
-	  If we already saw the keyframes that we need to find,
-	  we do not need to bisect to find them.
-	  This will always be the case for streams with audio only,
-	  where each frame acts as a keyframe, but will occasionally
-	  also happen for streams with video.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=662475
-
-2011-10-22 20:20:38 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	* ext/ogg/gstoggdemux.h:
-	  oggdemux: improve push time seeking
-	  Various tweaks to improve convergence, in particular for
-	  the worst case, which is now cut in about half.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=662475
-
-2011-10-21 19:38:19 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	* ext/ogg/gstoggdemux.h:
-	  oggdemux: gather some more stats about bisection
-	  https://bugzilla.gnome.org/show_bug.cgi?id=662475
-
-2011-11-23 16:09:13 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/vorbis/gstvorbisenc.c:
-	  vorbisenc: do not accept 256 channels, 255 is the max vorbis supports
-
-2011-11-22 13:29:10 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggstream.c:
-	  oggstream: extract opus comments if available
-
-2011-11-22 13:15:33 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggstream.c:
-	  oggstream: recognize opus headers from data, not packet count
-	  Opus streams outside of Ogg may not have headers, and oggstream
-	  may be used by oggmux to mux an Opus stream which does not come
-	  from Ogg - thus without headers.
-	  Determining headerness by packet count would strip the first two
-	  packets from such an Opus stream, leading to a very small amount
-	  of audio being clipped at the beginning of the stream.
-
-2011-11-22 13:01:35 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: add some more debug info when determining start time
-
-2011-11-22 12:55:56 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggstream.c:
-	  oggstream: fix opus duration calculation
-
-2011-11-22 12:00:58 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggstream.c:
-	  oggstream: early out on headers when determining packet duration
-
-2011-11-21 17:03:21 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggstream.c:
-	* ext/ogg/gstoggstream.h:
-	  oggstream: account for opus pre-skip in granpos/time mapping
-
-2011-11-22 10:04:12 +0100  René Stadler <rene.stadler@collabora.co.uk>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsinkconvertbin: avoid removing children from bin twice
-	  GstBin base class removes children in dispose, so we need to do the same.
-
-2011-11-19 16:06:09 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggmux.c:
-	* ext/ogg/gstoggstream.c:
-	  ogg: add opus support
-
-2011-11-16 19:00:44 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/vorbis/gstvorbisenc.c:
-	  vorbisenc: reset tag setter interface when appropriate
-
-2011-11-16 19:00:30 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: invalidate format info when setup negotiation failed
-	  ... which ensures nothing subsequently tries to slip past _chain
-	  and into a possibly improperly setup subclass.
-
-2011-11-15 13:29:31 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	  audiodecoder: accept dropped buffers before we know the format
-	  This allows flacdec to not emit audio for headers, while allowing
-	  the base audio decoder to keep its timestamps in sync.
-
-2011-11-14 12:45:31 +0100  Robert Swain <robert.swain@gmail.com>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	  audio: Remove some unused variables
-
-2011-08-30 18:27:09 -0400  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst-libs/gst/rtp/gstrtcpbuffer.h:
-	  rtcpbuffer: Add feedback message types from RFC 5104
-	  These are Codec Control messages (CCM)
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658419
-
-2011-10-19 16:30:27 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	  audiodecoder: improve reverse playback
-	  ... by doing some more (reverse) timestamp interpolating and
-	  refactoring downstream pushing.
-	  Fixes #661983.
-
-2011-11-13 13:18:16 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/audio.h:
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	  audio: add GST_AUDIO_INFO_IS_VALID macro and use in audio decoder base class
-	  API: GST_AUDIO_INFO_IS_VALID
-
-2011-11-12 15:51:52 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* configure.ac:
-	* tests/examples/seek/jsseek.c:
-	* tests/examples/seek/seek.c:
-	* tests/icles/test-colorkey.c:
-	* tests/icles/test-xoverlay.c:
-	  tests: require Gtk+ 3.0 for examples and Gtk-based test apps
-	  The Gtk+ dependency is entirely optional, we're just not
-	  supporting Gtk+ 2.x any longer.
-
-2011-11-07 17:36:44 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/Makefile.am:
-	  audio: fix order in LIBADD
-	  Local libs must come first.
-
-2011-11-11 13:32:23 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsinkconvertbin: fix visualisations again
-	  Make caps writable before merging other caps into them.
-
-2011-11-10 15:55:31 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	  baseaudiosink: make unsigned properties unsigned, not signed
-
-2011-11-09 00:36:51 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* common:
-	* configure.ac:
-	  configure: suppress warnings about unused variables if debugging system is disabled in core
-	  https://bugzilla.gnome.org/show_bug.cgi?id=662952
-
-2011-10-27 14:48:52 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/pango/gsttextoverlay.c:
-	  textoverlay: continue processing text when silent
-	  This prevents playback wegding when text buffers are
-	  left to pile up.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=662829
-
-2011-11-08 00:16:56 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* win32/common/libgstaudio.def:
-	  win32: update .def file for new audiosink API
-	  API: gst_base_audio_sink_get_alignment_threshold()
-	  API: gst_base_audio_sink_set_alignment_threshold()
-	  API: gst_base_audio_sink_get_discont_wait()
-	  API: gst_base_audio_sink_set_discont_wait()
-
-2011-11-07 23:41:33 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/examples/seek/seek.c:
-	  examples: sprinkle GST_DEBUG_BIN_TO_DOT_FILE_WITH_TS in seek test utility
-	  https://bugzilla.gnome.org/show_bug.cgi?id=630497
-
-2011-11-07 23:05:44 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/pango/gsttextoverlay.c:
-	* gst-libs/gst/audio/gstaudioiec61937.c:
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	* gst-libs/gst/audio/gstbaseaudiosink.h:
-	* gst-libs/gst/video/video.c:
-	  docs: fix up some Since: markers
-
-2011-11-04 10:34:27 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/theora/gsttheoraenc.c:
-	  theoraenc: fix speed level failure test
-	  It was testing the opposite of what it thought it was.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=663390
-
-2011-11-04 10:57:40 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/theora/gsttheoraenc.c:
-	  theoraenc: make logically static const data just so
-	  https://bugzilla.gnome.org/show_bug.cgi?id=663391
-
-2011-11-04 10:58:15 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/theora/gsttheoraenc.c:
-	  theoraenc: use th_packet_iskeyframe instead of peeking at bits
-	  https://bugzilla.gnome.org/show_bug.cgi?id=663391
-
-2011-11-04 10:59:00 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/theora/gsttheoraenc.c:
-	  theoraenc: trivial comment typos fixes
-	  https://bugzilla.gnome.org/show_bug.cgi?id=663391
-
-2011-11-04 10:59:12 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/theora/gsttheoraenc.c:
-	  theoraenc: warn when trying to set an ignored obsolete property
-	  https://bugzilla.gnome.org/show_bug.cgi?id=663391
-
-2011-11-04 11:10:46 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/theora/gsttheoraenc.c:
-	  theoraenc: refuse to get to READY if the encoder was disabled
-	  https://bugzilla.gnome.org/show_bug.cgi?id=663391
-
-2011-10-18 17:58:49 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: survive skeleton finding length behind our backs in push mode
-	  In push mode, we determine duration by doing a seek to the end of the
-	  stream. However, a skeleton stream with an index will cause the duration
-	  to be known already, and we end up never setting the push_time_duration
-	  variable which we use to know duration has been determined.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=662049
-
-2011-10-05 15:29:54 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* tests/check/gst-plugins-base.supp:
-	  valgrind: add ALSA leaks fixed by snd_config_update_free_global
-	  If they go when calling snd_config_update_free_global, they're
-	  not really bug leaks, but more like intentional ones we don't
-	  want to get told about.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=615342
-
-2011-05-02 13:05:28 +0300  Felipe Contreras <felipe.contreras@gmail.com>
-
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	* gst-libs/gst/audio/gstbaseaudiosink.h:
-	  baseaudiosink: make discont-wait configurable
-	  Now we can configure how much time to wait before deciding that a
-	  discont has happened.
-	  Also, adds getter and setter to allow derived implementations to set
-	  this value upon construction.
-	  Suggestions and several improvements by Havard Graff.
-	  Signed-off-by: Felipe Contreras <felipe.contreras@gmail.com>
-
-2011-11-07 11:31:47 +0100  Felipe Contreras <felipe.contreras@gmail.com>
-
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	  baseaudiosink: delay the resyncing of timestamp vs ringbuffertime
-	  A common problem for audio-playback is that the timestamps might not
-	  be completely linear. This is specially common when doing streaming over
-	  a network, where you can have jittery and/or bursty packettransmission,
-	  which again will often be reflected on the buffertimestamps.
-	  Now, the current implementation have a threshold that says how far the
-	  buffertimestamp is allowed o drift from the ideal aligned time in the
-	  ringbuffer. This was an instant reaction, and ment that if one buffer
-	  arrived with a timestamp that would breach the drift-tolerance, a resync
-	  would take place, and the result would be an audible gap for the
-	  listener.
-	  The annoying thing would be that in the case of a "timestamp-outlier",
-	  you would first resync one way, say +100ms, and then, if the next
-	  timestamp was "back on track", you would end up resyncing the other way
-	  (-100ms) So in fact, when you had only one buffer with slightly off
-	  timestamping, you would end up with *two* audible gaps. This is the
-	  problem this patch addresses.
-	  The way to "fix" this problem with the previous implementation, would
-	  have been to increase the "drift-tolerance" to a value that was greater
-	  than the largest timestamp-outlier one would normally expect.  The big
-	  problem with this approach, however, is that it will allow normal
-	  operations with a huge offset timestamp vs running-time, which is
-	  detrimental to lip-sync. If the drift-tolerance is set to 200ms, it
-	  basically means that lip-sync can easily end up being off by that much.
-	  This patch will basically start a timer when the first breach of
-	  drift-tolerance is detected. If any following timestamp for the next n
-	  nanoseconds gets "back on track" within the threshold, it has basically
-	  eliminated the effect of an outlier, and the timer is stopped.  If,
-	  however, all timestamps within this time-limit are breaching the
-	  threshold, we are probably facing a more permanent offset in the
-	  timestamps, and a resync is allowed to happen.
-	  So basically this patch offers something as rare as both higher
-	  accuracy, it terms of allowing smaller drift-tolerances, as well as much
-	  smoother, less glitchy playback!
-	  Commit message and improvments by Havard Graff.
-	  Fixes bug #640859.
-
-2011-11-07 11:18:34 +0100  Felipe Contreras <felipe.contreras@gmail.com>
-
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	  baseaudiosink: rename some variables
-
-2011-05-21 16:16:42 +0300  Felipe Contreras <felipe.contreras@gmail.com>
-
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	  baseaudiosink: use gst_util_uint64_scale_int when appropriate
-	  It's probably safer this way.
-
-2011-05-21 15:49:20 +0300  Felipe Contreras <felipe.contreras@gmail.com>
-
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	* gst-libs/gst/audio/gstbaseaudiosink.h:
-	  baseaudiosink: split drift-tolerance into alignment-threshold
-	  So that drift-tolerance is used for clock slaving resync, and
-	  alignment-threshold is for timestamp drift.
-
-2011-05-21 16:02:36 +0300  Felipe Contreras <felipe.contreras@gmail.com>
-
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	  baseaudiosink: trivial comment fixes
-	  Some found by Havard Graff.
-	  Signed-off-by: Felipe Contreras <felipe.contreras@gmail.com>
-
-2011-11-04 10:37:12 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstsubtitleoverlay.c:
-	  subtitleoverlay: Use gst_caps_merge() instead of gst_caps_union()
-	  This keeps the caps order and is more efficient.
-
-2011-11-04 10:36:51 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsinkconvertbin: Use gst_caps_merge() instead of gst_caps_union()
-	  This keeps the caps order and is more efficient.
-
-2011-11-03 21:35:38 -0300  Reynaldo H. Verdejo Pinochet <reynaldo@collabora.com>
-
-	* gst-libs/gst/tag/Makefile.am:
-	  Add missing default include paths to androgenizer call
-	  Fixes building tag/ with Android's NDK
-
-2011-11-03 14:10:31 +0200  Mart Raudsepp <mart.raudsepp@collabora.com>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Post all source pads in stream-topology messages as "element-srcpad" values
-	  This allows us to easily get ahold of all pads on a stream-topology message, including
-	  pre-decoder ones, while "pad" only gives us access to the raw pads (as used by discoverer).
-
-2011-10-20 13:04:52 +0300  Mart Raudsepp <mart.raudsepp@collabora.com>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Use existing "caps" quark for one of the structure sets
-
-2011-11-03 10:07:27 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsinkconvertbin: Don't add identity multiple times
-
-2011-10-19 14:13:39 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsink: send flush start/stop event when we switch elements
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661262
-
-2011-10-19 14:13:30 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstplaysinkaudioconvert.c:
-	* gst/playback/gstplaysinkconvertbin.c:
-	* gst/playback/gstplaysinkconvertbin.h:
-	  playsink: re-add identity where appropriate
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661262
-
-2011-10-19 14:12:01 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstplaysinkaudioconvert.c:
-	  playsink: lock the new {set,get}_property functions
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661262
-
-2011-10-17 23:14:54 +0000  Thiago Santos <thiago.sousa.santos@collabora.com>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsinkconvertbin: Be more consistent with ghostpad targets
-	  Set up targets on READY->PAUSED state change to passthrough by
-	  default. This prevents the targets from being unset on the
-	  first run, while the 'raw' variable would mean that some
-	  target is set.
-
-2011-10-17 22:41:49 +0000  Thiago Santos <thiago.sousa.santos@collabora.com>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsinkconvertbin: No need to remove the identity
-	  The identity element should be handled by the GstBin's cleanup,
-	  removing it on the remove_elements function might remove it
-	  too soon, as this function can be called directly from playsink
-
-2011-10-17 22:41:11 +0000  Thiago Santos <thiago.sousa.santos@collabora.com>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsinkconvertbin: Adding some debug messages
-	  Adds a couple debug messages and some g_assert to make debugging
-	  easier
-
-2011-10-17 22:02:03 +0000  Thiago Santos <thiago.sousa.santos@collabora.com>
-
-	* gst/playback/gstplaysinkvideoconvert.c:
-	  playsink-videoconvert: Fix warning on build
-	  Remove unused variable
-
-2011-10-17 21:05:30 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstplaysink.c:
-	* gst/playback/gstplaysinkaudioconvert.c:
-	* gst/playback/gstplaysinkaudioconvert.h:
-	* gst/playback/gstplaysinkconvertbin.c:
-	* gst/playback/gstplaysinkconvertbin.h:
-	* gst/playback/gstplaysinkvideoconvert.c:
-	* gst/playback/gstplaysinkvideoconvert.h:
-	  playsink: handle after-the-fact changes in converters/volume booleans
-	  The playsink was nastily poking a boolean in the structure.
-	  Make those booleans properties, so we are told when they change,
-	  and rebuild the conversion bin when they do.
-	  Some cleanup to go with it too.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661262
-
-2011-10-17 18:43:06 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsink: handle NULL cached caps in getcaps
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661262
-
-2011-10-17 18:06:00 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsink: consider both passthrough and converter caps in getcaps
-	  Since we can switch between both modes.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661262
-
-2011-10-17 17:54:27 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	* gst/playback/gstplaysinkconvertbin.h:
-	  playsink: cache inner converter bin caps
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661262
-
-2011-10-17 17:26:48 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsink: keep both raw and non raw pipelines at all times
-	  and switch between them as needed.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661262
-
-2011-10-17 17:29:50 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstplaysinkconvertbin.c:
-	  playsink: only compare against the media type we expect
-	  ie, audio/x-raw- for audio, video/x-raw- for video.
-	  Add a trailing - to be more specific. I doubt there's anything
-	  like audio/x-rawhide or something, but you never know.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661262
-
-2011-10-17 16:55:30 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/Makefile.am:
-	* gst/playback/gstplaysinkaudioconvert.c:
-	* gst/playback/gstplaysinkaudioconvert.h:
-	* gst/playback/gstplaysinkconvertbin.c:
-	* gst/playback/gstplaysinkconvertbin.h:
-	* gst/playback/gstplaysinkvideoconvert.c:
-	* gst/playback/gstplaysinkvideoconvert.h:
-	  playsink: refactor the converter bins since they are almost identical
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661262
-
-2011-10-17 13:00:05 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstplaysinkaudioconvert.c:
-	* gst/playback/gstplaysinkaudioconvert.h:
-	* gst/playback/gstplaysinkvideoconvert.c:
-	* gst/playback/gstplaysinkvideoconvert.h:
-	  playsink: fix passthrough mode (hopefully)
-	  The code was doing counterintuitive rewiring of pads when the
-	  bin did not contain any elements. We now add an identity element
-	  in that case, which makes it simpler, and should fix the AC3
-	  passthrough mode when using pulseaudio (but I don't see the bug
-	  here so can't test).
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661262
-
-2011-10-07 11:16:44 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstplaysinkaudioconvert.c:
-	* gst/playback/gstplaysinkvideoconvert.c:
-	  playsink: handle NULL ghost pad target
-	  For the src pad anyway.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661262
-
-2011-11-03 09:56:14 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysinkaudioconvert.c:
-	  Revert "playsinkaudioconvert: Fix warning when there is no target pad yet"
-	  This reverts commit f35c51c14915729f0fdf2b348f351ea7e81027cc.
-	  Better patch coming soon.
-
-2011-10-28 10:07:42 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* ext/ogg/gstoggmux.c:
-	  oggmux: Remove obsolete #include
-
-2011-11-02 23:33:18 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* docs/design/draft-subtitle-overlays.txt:
-	  docs: add draft for subtitle overlays to design docs
-	  Main purpose is to provide a generic way to make subtitles work on
-	  top of non-raw video (vaapi, vdpau, etc.).
-
-2011-11-02 15:31:11 -0400  Colin Walters <walters@verbum.org>
-
-	* common:
-	* configure.ac:
-	  configure: Allow setting GLIB_EXTRA_CFLAGS
-	  Similar to gstreamer commit bb2020b1e794210cf7d44c6626122f611016a620
-
-2011-10-30 20:00:47 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/playback/gstsubtitleoverlay.c:
-	  subtitleoverlay: don't use soon-to-be-deprecated gst_filter_run()
-
-2011-10-28 13:58:47 +0200  Mersad Jelacic <mersad@axis.com>
-
-	* gst-libs/gst/audio/gstaudiosink.c:
-	  audiosink: avoid deadlocking audioringbuffer thread
-	  ... when it goes into wait for ringbuffer starting just after such
-	  having been signalled.
-	  Fixes #661738.
-
-2011-04-26 22:20:29 +0200  Philip Jägenstedt <philipj@opera.com>
-
-	* gst/typefind/gsttypefindfunctions.c:
-	  typefind: extract SOF marker in jpeg typefinder
-	  The SOF types are defined by http://www.w3.org/Graphics/JPEG/itu-t81.pdf
-	  This is needed to make sure that we plug a jpeg decoder that
-	  can handle the type of JPEG we have (e.g. lossless JPEG)
-	  https://bugzilla.gnome.org/show_bug.cgi?id=556648
-
-2009-08-10 01:48:29 +0000  Thiago Santos <thiagoss@embedded.ufcg.edu.br>
-
-	* ext/ogg/gstoggmux.c:
-	* ext/ogg/gstoggmux.h:
-	  oggmux: port to gstcollectpads2
-
-2011-10-27 23:39:31 +1100  Jan Schmidt <thaytan@noraisin.net>
-
-	* tests/examples/Makefile.am:
-	  build: Fix build for moved volume subdir
-
-2011-10-27 09:51:46 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* Makefile.am:
-	* configure.ac:
-	* tests/examples/Makefile.am:
-	* tests/examples/audio/.gitignore:
-	* tests/examples/audio/Makefile.am:
-	* tests/examples/audio/volume.c:
-	* tests/examples/volume/.gitignore:
-	* tests/examples/volume/Makefile.am:
-	* tests/examples/volume/volume.c:
-	  volume: move volume example to audio
-
-2011-10-27 09:42:36 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* tests/examples/audio/Makefile.am:
-	  audio examples. fix the makefile
-
-2011-10-27 09:33:55 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* tests/examples/volume/volume.c:
-	  volume: make global vars static
-
-2011-10-27 09:33:01 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* tests/examples/audio/.gitignore:
-	* tests/examples/audio/Makefile.am:
-	* tests/examples/audio/audiomix.c:
-	  audiomix: add a simple audiomix example
-
-2011-10-25 20:04:06 +1100  Jan Schmidt <thaytan@noraisin.net>
-
-	* gst/playback/gstplaysinkaudioconvert.c:
-	  playsinkaudioconvert: Fix warning when there is no target pad yet
-
-2011-10-13 11:34:49 -0400  Nicolas Dufresne <nicolas.dufresne@collabora.com>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Link elements before testing if they can reach the READY state
-	  This is made possible by filtering errors. This is required to let
-	  harware accelerated element query the video context. The video context
-	  is used to determine if the HW is capable, and thus if the element is
-	  supported or not.
-	  Fixes bug #662330.
-
-2011-10-21 21:57:17 +0200  René Stadler <rene.stadler@collabora.co.uk>
-
-	* gst/playback/gstplaybasebin.c:
-	  playbasebin: remove avoidable call to gst_object_set_name
-
-2011-10-21 21:41:03 +0200  René Stadler <rene.stadler@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: remove avoidable call to gst_object_set_name
-
-2011-10-21 21:39:01 +0200  René Stadler <rene.stadler@collabora.co.uk>
-
-	* gst/audioconvert/Makefile.am:
-	* gst/audioconvert/channelmixtest.c:
-	  audioconvert: bury dead test program
-
-2011-10-20 10:13:46 -0300  Reynaldo H. Verdejo Pinochet <reynaldo@collabora.com>
-
-	* Android.mk:
-	  Disable ext/vorbis for the android ndk build
-	  It currently makes the build fail. Idea is to enable
-	  it back again once its building problems get sorted
-	  out.
-
-2011-10-19 19:44:06 +0200  René Stadler <rene.stadler@collabora.co.uk>
-
-	* gst/playback/gstsubtitleoverlay.c:
-	  subtitleoverlay: fix leaks of pad templates and internal proxy pads
-
-2011-10-19 19:37:07 +0200  René Stadler <rene.stadler@collabora.co.uk>
-
-	* gst/playback/gstsubtitleoverlay.c:
-	  subtitleoverlay: fix leak of element reference through pad block
-	  If the pad block never happens because there is no data flow at all, the
-	  callback is never fired and the reference is never released. This causes a
-	  reference cycle between the pad and element, so valgrind is not very vocal
-	  about it (memory is still reachable).
-
-2011-10-18 21:42:21 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	  audiodecoder: having gather queue contents implies some draining is in order
-	  ... which ensures e.g. processing and sending last fragment of reverse playback
-	  downstream at EOS.
-
-2011-10-19 15:28:44 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/vorbis/gstvorbisdec.c:
-	  vorbisdec: do not try to read past the buffer array
-	  https://bugzilla.gnome.org/show_bug.cgi?id=662108
-
-2011-10-18 21:40:54 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/vorbis/gstvorbisdec.c:
-	  vorbisdec: only finish header packet frame if received in-stream
-	  ... rather than scaring audiodecoder with a frame extracted from caps.
-	  Fixes #662108 (partially).
-
-2011-10-19 10:41:31 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* sys/ximage/ximagesink.c:
-	* sys/xvimage/xvimagesink.c:
-	  x(v)imagesink: make it more clean that "synchronous" props are not for avsync
-
-2011-10-19 00:32:13 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	  baseaudiosink: fix unused variable compiler warning if debugging in core is disabled
-	  https://bugzilla.gnome.org/show_bug.cgi?id=660150
-
-2011-10-18 13:00:29 +0200  René Stadler <rene.stadler@collabora.co.uk>
-
-	* gst/playback/gstsubtitleoverlay.c:
-	  subtitleoverlay: fix event unref in (rare) error case
-
-2011-10-07 17:41:32 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: fire drained signal where appropriate
-	  This will allow playbin2 to send its about-to-finish signal.
-	  Taken out (apparently by mistake) by the EOS rewrite in july.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661202
-
-2011-10-16 11:32:41 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: do not retry seeking indefinitely
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661897
-
-2011-10-10 13:11:59 +0200  Brian Cameron <brian.cameron@oracle.com>
-
-	* gst/videotestsrc/Makefile.am:
-	  videotestsrc: fix LDADD missing GST_LIBS
-
-2011-10-09 21:19:32 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/vorbis/gstvorbisenc.c:
-	* ext/vorbis/gstvorbisenc.h:
-	  vorbisenc: only push header buffers following initial events
-
-2011-10-09 16:48:18 +0200  Alessandro Decina <alessandro.d@gmail.com>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	  audioencoder: fix compile warning
-
-2011-10-08 20:17:43 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* tests/check/pipelines/vorbisenc.c:
-	  tests: vorbisenc: adjust discontinuity checking to audioencoder behaviour
-	  ... which still detects gaps and marks DISCONT, depending on configuration,
-	  but may come up with somewhat different timestamps when crossing the gap.
-
-2011-10-08 20:16:04 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* tests/check/pipelines/vorbisdec.c:
-	  tests: vorbisdec: properly configure audiodecoder when requiring perfect ts
-
-2011-10-08 20:14:27 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* tests/check/elements/vorbisdec.c:
-	  tests: vorbisdec: remove empty header buffer check
-	  ... as empty buffers are discarded, and header buffers are now
-	  also optionally retrieved from caps anyway.
-
-2011-10-08 20:13:11 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: only resync to upstream upon discont in perfect ts mode
-	  ... as documented, where discont is marked here if tolerance has been
-	  exceeded.
-
-2011-10-08 20:11:22 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	  audiodecoder: fix timestamp tolerance handling
-
-2011-10-08 20:09:09 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	  audiodecoder: handle empty input by discarding
-
-2011-10-07 14:52:33 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/vorbis/Makefile.am:
-	* ext/vorbis/gstvorbisdec.c:
-	* ext/vorbis/gstvorbisdec.h:
-	  vorbisdec: port to audiodecoder
-
-2011-10-07 14:33:04 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: make upstream queries MT-safe
-
-2011-10-07 14:32:33 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	  audiodecoder: make upstream queries and events MT-safe
-
-2011-10-05 15:43:35 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/vorbis/Makefile.am:
-	* ext/vorbis/gstvorbisenc.c:
-	* ext/vorbis/gstvorbisenc.h:
-	  vorbisenc: port to audioencoder
-
-2011-10-06 18:21:29 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* tests/check/elements/audiotestsrc.c:
-	  tests: actually test what we said we would
-	  All tests were testing the default sine wave
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661106
-
-2011-10-06 18:20:32 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/audiotestsrc/gstaudiotestsrc.c:
-	  audiotestsrc: add missing break
-	  And make violet noise usable
-	  https://bugzilla.gnome.org/show_bug.cgi?id=661105
-
-2011-10-06 15:38:49 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstplaysinkaudioconvert.c:
-	* gst/playback/gstplaysinkvideoconvert.c:
-	  playsink: fix caps negotiation through the new convenience bins
-	  The bins' getcaps was bypassing the inner elements, and thus
-	  failing to account for the caps transformations they allow,
-	  which caused YUV video pipelines to fail with ximagesink, which
-	  does not support YUV, even though the convenience bin includes
-	  a colorspace converter for just this purpose.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=660816
-
-2011-10-06 11:53:26 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/playback/gstplaybin2.c:
-	  playbin2: fix mismatch between video/ and video/x-dvd-subpicture
-	  The new code was checking for a prefix, and would find video/
-	  first. Check in two passes, first checking for a perfect match,
-	  and falling back to a prefix check if nothing was found.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657261
-
-2011-10-04 21:17:37 -0300  Thiago Santos <thiago.sousa.santos@collabora.com>
-
-	* gst/encoding/gstencodebin.c:
-	  encodebin: Re-enable parsers
-	  Re-enable parsers in encodebin to allow more passthrough scenarios
-	  to work. Specially the ones that require changing 'stream formats'.
-	  i.e. h264 in mkv to mpegts.
-
-2011-10-05 12:45:19 +0200  Robert Swain <robert.swain@collabora.co.uk>
-
-	* gst/playback/gstplaysink.c:
-	  playsink: Add audio- and text-sink props
-
-2011-10-04 23:09:42 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* gst/audiotestsrc/gstaudiotestsrc.c:
-	  auditestsrc: indent fix
-
-2011-10-04 16:22:55 +0200  Robert Swain <robert.swain@collabora.co.uk>
-
-	* gst/playback/gstplaysink.c:
-	  playsink: Add video-sink property
-	  The video-sink property allows manual specification via g_object_set ()
-	  of the video sink element to be used.
-
-2011-10-03 15:20:06 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaybin2.c:
-	  playbin2: Minor cleanup of decoder-sink compatibility checking code
-
-2011-09-30 12:29:34 -0300  Thibault Saunier <thibault.saunier@collabora.com>
-
-	* gst/playback/gstplaybin2.c:
-	  playbin2: Make sure that the decoders we plug are compatible with the fixed sink
-	  The fact that a decoder is not compatible with the fixed sink
-	  is currently happenning in the case where we have hardware accelerated
-	  video decoders on the system (especially vaapi elements that are actually plugged),
-	  and the user is providing a sink that doesn't support the surface.
-	  A simple example that shows how it used to crash on a system where gstreamer-vaapi
-	  is installed:
-	  gst-launch playbin2 video-sink=xvimagesink uri=/codec/supported/by/vaapi
-	  What we are now doing in this case, is avoid using the accelerated
-	  decoder and plug a "normal" decoder instead (if avalaible).
-	  This commit doesn't handle the case where we have hardware accelerated
-	  demuxing.
-
-2011-02-18 11:48:37 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/pbutils/encoding-profile.c:
-	* gst-libs/gst/pbutils/encoding-profile.h:
-	* win32/common/libgstpbutils.def:
-	  encoding-profile: add a function to create a profile from a discoverer info
-	  Only A/V streams are added at the moment, there does not seem to be
-	  a similar way to add other streams (eg, subtitles).
-	  https://bugzilla.gnome.org/show_bug.cgi?id=642878
-
-2011-09-27 00:26:29 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/alsa/gstalsasrc.c:
-	* ext/alsa/gstalsasrc.h:
-	  alsasrc: fail gracefully when ALSA does not give timestamps
-	  https://bugzilla.gnome.org/show_bug.cgi?id=660170
-
-2011-10-03 10:55:53 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Use a TIME limit for pre-rolling in live streams and not in non-live streams
-	  Fixes bug #647769 for real.
-
-2011-10-01 01:05:00 +0100  Vincent Penquerc'h <ogg.k.ogg.k@googlemail.com>
-
-	* ext/pango/gsttextoverlay.c:
-	  textoverlay: add YV12 support
-	  Basically the same as I420, just with chroma planes swapped.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=660604
-
-2011-09-30 09:44:12 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst/encoding/gstencodebin.c:
-	  encodebin: Fix typo on formatter adding condition
-	  The condition is if the muxer doesn't have tag setter *and* isn't
-	  a formatter itself. Any of those two conditions makes the muxer
-	  good enough to not need a formatter.
-
-2011-09-28 15:41:16 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	  audiodecoder: really push pending events
-
-2011-09-28 14:32:20 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: remove more tags from upstream tag events such as bitrate tags
-	  We want to remove all codec specific tags.
-
-2011-09-28 01:56:42 +0300  Raimo Järvi <raimo.jarvi@gmail.com>
-
-	* gst/videotestsrc/videotestsrc.c:
-	  videotestsrc: Fix compiler warning on 64 bit mingw-w64
-	  Fixes bug #660304.
-
-2011-09-28 01:11:30 +0300  Raimo Järvi <raimo.jarvi@gmail.com>
-
-	* gst/playback/gstplaybin2.c:
-	  playbin2: Fix compiler warnings on 64 bit mingw-w64
-	  Fixes bug #660301.
-
-2011-09-27 16:18:05 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: only got_data if we really got some
-	  ... which avoids going loopy with casual subclass.
-
-2011-09-27 16:57:45 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: really push pending events
-
-2011-09-27 16:16:54 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: send tag event after pending events
-	  ... which probably includes a pending newsegment event.
-
-2011-09-27 16:16:29 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: protect pending_events with proper lock
-
-2011-09-27 15:31:20 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: clean up some documentation
-
-2011-09-27 00:32:41 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	  docs: minor docs fix
-
-2011-09-26 16:36:56 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	  docs: Adjust for GstAudioEncoder API changes
-
-2011-09-26 16:36:22 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* win32/common/libgstaudio.def:
-	  win32: Adjust for GstAudioEncoder API changes
-
-2011-09-26 16:35:55 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: Improve set_frame_sample_{min,max} documentation
-
-2011-09-26 16:22:00 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	* gst-libs/gst/audio/gstaudiodecoder.h:
-	  audiodecoder: Fix thread safety issues if both pads have different streaming threads
-
-2011-09-26 16:19:42 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	  audiodecoder: Delay sending of serialized events to finish_frame()
-
-2011-09-26 16:02:51 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  Revert "audioencoder: Use GST_BOILERPLATE instead of custom GObject boilerplate code"
-	  This reverts commit 11e375486e07cfa0686a97b5cf6110909b3a828c.
-	  GST_BOILERPLATE() can't define an abstract type and
-	  G_DEFINE_ABSTRACT_TYPE() does not pass the class struct to
-	  the instance_init function and there's no way to get the
-	  class struct of the current type in instance_init().
-
-2011-09-26 15:59:22 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	* gst-libs/gst/audio/gstaudioencoder.h:
-	  audioencoder: Add support for requesting a minimum and maximum number of samples per frame
-	  This extends the special case of a fixed number of samples per frame
-	  that was supported before already.
-
-2011-09-26 15:45:40 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	* gst-libs/gst/audio/gstaudioencoder.h:
-	  audioencoder: Fix thread safety issues if both pads have different streaming threads
-
-2011-09-26 15:42:14 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: Delay sending of serialized events to finish_frame()
-	  This makes sure that the caps are already set before any serialized
-	  events are sent downstream.
-
-2011-09-26 15:34:54 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: Use GST_BOILERPLATE instead of custom GObject boilerplate code
-
-2011-09-26 15:14:41 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	* gst-libs/gst/audio/gstaudioencoder.h:
-	  audioencoder: add some tag handling convenience help
-
-2011-09-26 14:48:55 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: provide CODEC/AUDIO_CODEC handling
-
-2011-09-26 13:42:38 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: filter AUDIO_CODEC/CODEC tags from passing tag events
-
-2011-09-25 15:31:01 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/typefind/gsttypefindfunctions.c:
-	  typefindfunctions: backport some const-ifications from 0.11 branch
-	  To keep code identical as much as possible between the two branches,
-	  for easier merging.
-
-2011-09-25 15:24:56 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/typefind/gsttypefindfunctions.c:
-	  typefindfunctions: fix indentation
-
-2011-09-23 17:50:31 +0200  Robert Swain <robert.swain@collabora.co.uk>
-
-	* gst/encoding/gstencodebin.c:
-	  encodebin: Avoid unnecessary read only caps copy
-
-2011-09-22 15:38:51 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: proxy some more optional downstream caps fields to upstream
-
-2011-09-22 15:38:22 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: changed is verily the opposite of equal
-
-2011-09-22 15:37:07 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	  audioencoder: prevent crashing when comparing to a freshly inited GstAudioInfo
-
-2011-09-22 15:36:22 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/audio.h:
-	  audio: some more accessor macros for GstAudioInfo
-
-2011-09-22 15:34:41 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	  audiodecoder: fix documentation typo
-
-2011-09-19 18:32:26 +0100  Sjoerd Simons <sjoerd.simons@collabora.co.uk>
-
-	* tests/check/elements/videorate.c:
-	  videorate: Add tests for the max-rate case
-
-2011-09-19 18:31:07 +0100  Sjoerd Simons <sjoerd.simons@collabora.co.uk>
-
-	* tests/check/elements/videorate.c:
-	  videorate: Print which caps didn't match up
-
-2011-09-19 18:26:04 +0100  Sjoerd Simons <sjoerd.simons@collabora.co.uk>
-
-	* gst/videorate/gstvideorate.c:
-	* gst/videorate/gstvideorate.h:
-	  videorate: Add a max-rate property
-	  In various use-case you want to dynamically change the framerate (e.g.
-	  live streams where the available network bandwidth changes). Doing this
-	  via capsfilters in the pipeline tends to be very cumbersome and racy,
-	  using this property instead makes it very painless.
-
-2011-09-01 17:05:23 +0100  Sjoerd Simons <sjoerd.simons@collabora.co.uk>
-
-	* tests/check/elements/videorate.c:
-	  videorate: Add test for caps negotiation
-
-2011-09-01 16:47:49 +0100  Sjoerd Simons <sjoerd.simons@collabora.co.uk>
-
-	* gst/videorate/gstvideorate.c:
-	  videorate: Add more strict caps negotiation
-	  When in drop-only mode we can never provide a framerate that is higher
-	  then the input, so let the caps negotiation reflect this.
-
-2011-09-20 13:35:55 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/videorate/gstvideorate.c:
-	  videorate: don't unref event we don't own
-	  http://bugzilla.gnome.org/show_bug.cgi?id=659562
-
-2011-09-20 14:04:45 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Only check if this is a discarded type if we have fixed caps
-	  For unfixed caps we will get here again later when the caps are fixed.
-
-2011-09-20 14:03:47 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Only call autoplug-continue with fixed caps
-	  With unfixed caps we can't reliably decide if the final caps
-	  are going to be "raw" (e.g. supported by a sink) or not.
-	  We will get here again later when the caps are fixed.
-
-2011-09-20 13:45:55 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* tests/check/elements/decodebin2.c:
-	  decodebin2: Fix unit test by strictly implementing parser behaviour instead of relying on basetransform
-
-2011-01-13 15:35:30 +0000  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	* ext/ogg/gstoggstream.c:
-	  oggstream: only use information from skeleton if we have nothing better
-	  The codec setup headers are a lot more likely to have correct information,
-	  especially as it's easy to remux a skeleton in a file where streams don't
-	  have the same parameters (I've even seen a file with two skeletons).
-	  Still, this is useful in the case we have a codec we can't decode, so we
-	  can at least (theoretically) convert granpos to time, so we discard this
-	  information if the codec setup has already provided it.
-	  This fixes playback on (at lesat) the original archive.org encoding of
-	  "The Night of the Living Dead" (now replaced by another encoding).
-	  https://bugzilla.gnome.org/show_bug.cgi?id=612443
-
-2011-09-19 14:16:19 +0200  Age Bosma <agebosma@gmail.com>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.h:
-	  discoverer: Don't use gtk-doc /* < ... > */ style comments for signals
-	  The /*< ... >*/ style is only used for public|protected|private,
-	  signal comments use /* signals */. This prevents the some code
-	  parsers/binding generators to be confused by the comment.
-
-2011-09-19 14:02:00 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstsubtitleoverlay.c:
-	  subtitleoverlay: Get the target of the video sinkpad, not the target sinkpad in the video setcaps handler
-
-2011-08-18 15:13:23 +0000  Youness Alaoui <youness.alaoui@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Initialize variable correctly
-	  If subdrained isn't initialized to FALSE then a chain might think
-	  that its group is drained when in fact it's not and this can cause
-	  a switch too early or even cause a deadlock.
-
-2011-07-28 16:44:33 +0000  Edward Hervey <edward.hervey@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Rewrite EOS-handling code
-	  This is now really threadsafe and improves switching
-	  between different groups.
-
-2011-09-19 11:53:02 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Fix non-prerolling pipelines and not-linked errors if a parser is available but no decoder
-	  Fixes bug #658846.
-
-2011-08-01 07:54:02 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/rtsp/gstrtspdefs.c:
-	* gst-libs/gst/rtsp/gstrtspdefs.h:
-	  rtspdefs: add RTCP-Interval header
-
-2011-09-19 11:24:47 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstsubtitleoverlay.c:
-	  subtitleoverlay: Implement support for switching between raw and non-raw video streams
-
-2011-09-19 09:34:08 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* ext/pango/gsttextoverlay.c:
-	  textoverlay: Protect against accessing the NULL parent of the pads during shutdown
-	  Fixes bug #658901.
-
-2011-09-16 20:14:39 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: remove superfluous check in newsegment event handler
-	  If we get a newsegment event from upstream, we can be quite
-	  sure we're not operating pull-based.
-
-2011-09-16 20:11:56 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: minor printf format fix
-
-2011-09-14 12:23:19 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: fix wedge when seeking twice quickly in push mode
-	  This could happen when testing with navseek, and pressing
-	  right and left at roughly the same time. The current chain
-	  is temporarily moved away, and this caused the flush events
-	  not to be sent to the source pads, which would cause the
-	  data queues downstream to reject incoming data after the
-	  seek, and shut down, wedging the pipeline.
-	  Now, I can't really decide whether this is a nasty steaming
-	  hack or a good fix, but it certainly does fix the issue, and
-	  does not seem to break anything else so far.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=621897
-
-2011-08-13 14:18:56 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	* ext/ogg/gstoggdemux.h:
-	  oggdemux: implement push mode seeking
-	  This patch implements seeking in push mode (eg, over the net)
-	  in Ogg, using the double bisection method.
-	  As a side effect, it also fixes duration determination of network
-	  streams, by seeking to the end to check the actual duration.
-	  Known issues:
-	  - Getting an EOS while seeking stops the streaming task, I can't
-	  find a way to prevent this (eg, by issuing a seek in the event
-	  handler).
-	  - Seeking twice in a VERY short succession with playbin2 fails
-	  for streams with subtitles, we end up pushing in a dataqueue
-	  which is flushing. Rare in normal use AFAICT.
-	  - Seeking is slow on slow links - byte ranges guesses could be
-	  made better, decreasing the number of required requests
-	  - If no granule position is found in the last 64 KB of a stream,
-	  duration will be left unknown (should be pretty rare)
-	  https://bugzilla.gnome.org/show_bug.cgi?id=621897
-
-2011-09-15 22:04:56 +0200  Alessandro Decina <alessandro.d@gmail.com>
-
-	* gst/playback/gstplaybin2.c:
-	  playbin2: fix compiler warning
-	  Remove a check for gchar >= 128
-
-2011-09-15 16:47:26 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* gst/adder/gstadder.c:
-	  adder: don't access the event after pushing
-	  Fixes valgrind warnings.
-
-2011-09-15 14:27:35 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaybin2.c:
-	  Revert "playbin2: autoplug sink if stream is incompatible to the configured one"
-	  This reverts commit b0b4e286c8cde2e79a959a444a2c68e99c3f29c6.
-	  We agreed that the previous (pre-.35) behaviour is broken and a bug and the
-	  current behaviour is correct, deterministic and allows the application to
-	  handle stuff properly while the old behaviour can't be handled properly by
-	  applications and just worked in some applications by luck.
-	  The solution to the problem that was solved by relying on the old, broken
-	  behaviour would be, to make decodebin2/playbin2 more aware of decoders and
-	  improve the autoplugging of decoders by considering the caps supported by the
-	  sink instead of just using something with the highest rank.
-	  See bug #656923.
-
-2011-09-15 09:23:54 +0200  Josep Torra <n770galaxy@gmail.com>
-
-	* gst/playback/gstplaybin2.c:
-	  playbin2: autoplug sink if stream is incompatible to the configured one
-	  Fixes regression since 0.10.33 where sinks that can cope with non raw
-	  caps or custom caps are not autoplugged if there's a sink configured
-	  with the properties video-sink and audio-sink which cannot handle
-	  the stream. This change checks for compatibility on the configured one
-	  and use it if success. Otherwhise it tries with the found factories.
-
-2011-08-13 14:14:19 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: do not propagate discontinuities in sparse streams
-	  The first packet of a sparse stream may arrive after an initial
-	  delay in the stream. If ogg_stream_packetout reports a discontinuity
-	  in a sparse stream, do not propagate it to other streams in the
-	  chain unnecessarily.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=621897
-
-2011-09-12 15:48:59 +0200  Josep Torra <n770galaxy@gmail.com>
-
-	* gst/playback/gstplaysink.c:
-	  Revert "playsink: only add text overlay if vido sink also accepts raw caps"
-	  This reverts commit a22faad18a73a27a2a0c903748c1a355df4d8c13. Instead
-	  of disabling subtitles completelly when video stream have custom caps,
-	  just let the sutbtileoverlay cope with them as now it's able to.
-
-2011-09-12 15:46:46 +0200  Josep Torra <n770galaxy@gmail.com>
-
-	* gst/playback/gstsubtitleoverlay.c:
-	  subtitleoverlay: gracefully handle non raw video streams
-	  Implement handling of non raw video streams by avoiding colorspace
-	  elements and autoplugging a compatible renderer if available. Fallback
-	  to passthrough if no compatible renderer is found.
-
-2011-09-12 15:10:37 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/playback/gstplaybin2.c:
-	  playbin2: try to catch malformed URIs
-	  Only log in debug log for now, since the check is a bit
-	  half-hearted, its purpose is mostly to make sure people
-	  use gst_filename_to_uri() or g_filename_to_uri().
-	  https://bugzilla.gnome.org/show_bug.cgi?id=654673
-
-2011-09-12 19:53:51 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/tag.h:
-	  docs: minor addition to GST_TAG_ID3V2_HEADER_SIZE docs
-
-2011-09-11 14:22:59 -0400  Thomas Vander Stichele <thomas (at) apestaart (dot) org>
-
-	* ext/theora/gsttheoraenc.c:
-	  theoraenc: Fix descriptions of properties
-
-2011-09-10 18:30:55 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiosrc.c:
-	  baseaudiosrc: don't try to fixate "width" field for alaw/mulaw
-	  Fixes warning when trying to fixate e.g. pulsesrc ! audio/x-alaw ! fakesink.
-
-2011-09-09 13:10:13 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* docs/design/design-decodebin.txt:
-	  docs: fix some typos in the decodebin design document
-
-2011-09-09 13:07:57 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/interfaces/colorbalance.c:
-	  colorbalance: add some guards to interface methods
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658584
-
-2011-09-09 12:07:44 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/typefind/gsttypefindfunctions.c:
-	  typefind: recognize Asylum modules
-	  Note that there is already a AMF detection for a different
-	  magic, I'm not sure if that's a different format with the
-	  same initials or not. AMF is used for a few different formats
-	  (including video), so...
-	  This fixes playbin2 playing Asylum modules.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658514
-
-2011-08-31 20:51:17 -0400  Nicolas Dufresne <nicolas.dufresne@collabora.com>
-
-	* gst/subparse/gstsubparse.c:
-	  subparse: Improve subrip type check regex
-	  This patch prevents timestamp like "1 1:00:00", which would have been seen
-	  as hour 101 by our parser, and allow single digit hour, minute and seconds
-	  as it's already supported by the parser, and also by other implementation
-	  like in mplayer. This fixes bug 657872.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657872
-
-2011-09-08 14:46:23 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* docs/design/design-decodebin.txt:
-	  decodebin: Update design documentation about how Parser/Converter are handled
-
-2011-09-08 13:25:27 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  Revert "decodebin2: Do a subset check before actually using a factory"
-	  This reverts commit 50a88396ae6d54a83a10e7d2efd551d39033148e.
-	  See bug #658541.
-
-2011-09-07 16:44:04 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* tests/check/elements/decodebin2.c:
-	  decodebin2: Don't use bufferalloc in the test elements
-	  This will cause not-linked errors that usually don't happen
-	  because normal decoders/parsers will set srcpad caps before
-	  allocating buffers from downstream.
-
-2011-09-07 16:43:36 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Make sure to fixate Parser/Converter caps before continuing autoplugging
-
-2011-09-07 16:04:43 +0200  Josep Torra <n770galaxy@gmail.com>
-
-	* gst/playback/gstplaysink.c:
-	  playsink: only add text overlay if vido sink also accepts raw caps
-	  Fixes regression, pipeline fails with not negotiated, on media
-	  containing subtitles when decoder/sink with custom caps is used.
-
-2011-09-07 14:19:32 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Intersect the factory caps with the current caps for the capsfilter
-	  Otherwise we'll include many incompatible caps in the capsfilter that
-	  will only slow down negotiation.
-
-2011-09-07 14:07:00 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* docs/libs/Makefile.am:
-	* docs/plugins/Makefile.am:
-	  docs: cleanup makefiles
-	  Remove commented out parts that we don't need. Remove "the wingo addition" - no
-	  so useful after all. Narrow down file-globs for plugin docs.
-
-2011-09-07 14:04:10 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* gst/audiotestsrc/gstaudiotestsrc.h:
-	  docs: add two mising enum docs
-
-2011-09-07 14:10:46 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* tests/check/elements/audiorate.c:
-	  audiorate: Use complete audio caps, including the endianness field
-
-2011-09-07 12:32:01 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: fix element factory refcounting
-	  g_value_get_object() does not give us our own ref.
-	  Fixes "Trying to dispose object "flacparse", but it still has a parent "registry0".
-	  You need to let the parent manage the object instead of unreffing the object directly."
-	  and similar warnings.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658416
-
-2011-09-07 11:06:44 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/theora/gsttheoraenc.c:
-	  theoraenc: do not automatically override quality when using target bitrate
-	  If both quality and bitrate are set, libtheora will try to meet
-	  both constraints, causing it to prefer emitting a smaller number
-	  of good frames, to emitting the full number of frames that would
-	  not meet the requested quality. This causes a slideshow effect
-	  when the bitrate is low and the quality is high. And the default
-	  theoraenc is high (48/63).
-	  So only set quality when it is requested, and leave it unset
-	  otherwise.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658443
-
-2011-09-06 21:24:33 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* common:
-	  Automatic update of common submodule
-	  From a39eb83 to 11f0cd5
-
-2011-09-06 19:18:27 +0100  Christian Fredrik Kalager Schaller <christian.schaller@collabora.co.uk>
-
-	* gst-plugins-base.spec.in:
-	  Add latest files to spec file
-
-2011-09-06 20:13:30 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* docs/libs/Makefile.am:
-	  docs: activate overrides file to fix make distcheck
-
-2011-09-06 16:46:02 +0200  Wim Taymans <wim.taymans@collabora.co.uk>
-
-	* gst-libs/gst/audio/audio.h:
-	  audio: rename IS_LE/BE to _IS_LITTLE_ENDIAN/BIG_ENDIAN
-
-2011-09-06 15:46:45 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/audio.c:
-	  audio: update internal silent sample defines as well to match 0.11
-
-2011-09-06 15:16:15 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/audio/audio.c:
-	* gst-libs/gst/audio/audio.h:
-	  audio: update audio format enums to match changes in 0.11
-	  And add new audio format info stuff to docs.
-
-2011-09-06 15:40:02 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* common:
-	  Automatic update of common submodule
-	  From 605cd9a to a39eb83
-
-2011-09-06 14:16:10 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Do a subset check before actually using a factory
-	  This prevents autoplugging if the caps have a non-empty intersection
-	  but are not accepted by the next element's pad.
-
-2011-09-06 14:04:34 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstsubtitleoverlay.c:
-	  subtitleoverlay: Use subset check instead of non-empty-intersection check to check if pads are compatible
-
-2011-09-06 14:03:31 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaybin2.c:
-	  playbin2: Use subset check instead of non-empty-intersection check to check if pads are compatible
-
-2011-09-06 13:06:26 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Fix memory leak
-
-2011-09-06 12:14:33 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* tests/check/elements/decodebin2.c:
-	  decodebin2: Add unit test for correct parser/converter negotiation
-
-2011-06-26 15:40:17 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Correctly negotiate format for parsers that can convert different stream formats
-	  This is done by adding a capsfilter after every parser/converter that contains
-	  all possible caps supported by downstream elements. A capsfilter is necessary
-	  here because the decoder is only selected after the parser selected a format
-	  and the parser can't know what downstream would support otherwise.
-
-2011-09-05 15:19:42 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaybin2.c:
-	  playbin2: If a audio/video sink was already selected don't check caps of all other possible sinks
-
-2011-09-06 08:25:12 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* tests/check/elements/decodebin2.c:
-	  decodebin2: Add Tim as author for the parser test
-
-2011-09-06 10:07:33 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/audio/gstaudiodecoder.h:
-	* gst-libs/gst/audio/gstaudioencoder.h:
-	  docs: more docs clean-ups
-
-2011-09-05 23:00:30 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/videorate/gstvideorate.c:
-	  videorate: don't take the object lock twice in {set,get}_property
-	  https://bugzilla.gnome.org/show_bug.cgi?id=658294
-
-2011-09-05 22:51:38 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/audio.h:
-	  audio: fix GST_AUDIO_FORMAT_INFO_IS_*() macros to return a boolean
-
-2011-09-05 21:40:05 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* docs/libs/Makefile.am:
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	* gst-libs/gst/audio/gstaudiodecoder.h:
-	* gst-libs/gst/audio/gstaudioencoder.h:
-	  docs: some docs love
-
-2011-09-05 20:45:22 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-docs.sgml:
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* docs/libs/gst-plugins-base-libs.types:
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	* gst-libs/gst/audio/gstaudioencoder.h:
-	  docs: add GstAudioDecoder and GstAudioEncoder to documentation
-
-2011-09-05 15:01:09 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/Makefile.am:
-	* gst-libs/gst/audio/gstaudiodecoder.c:
-	* gst-libs/gst/audio/gstaudiodecoder.h:
-	* gst-libs/gst/audio/gstaudioencoder.c:
-	* gst-libs/gst/audio/gstaudioencoder.h:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.h:
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudioencoder.h:
-	* win32/common/libgstaudio.def:
-	  audio: rename GstBaseAudioDecoder/Encoder to GstAudioDecoder/Encoder
-	  API: gst_gst_audio_decoder_finish_frame()
-	  API: gst_gst_audio_decoder_get_audio_info()
-	  API: gst_gst_audio_decoder_get_byte_time()
-	  API: gst_gst_audio_decoder_get_delay()
-	  API: gst_gst_audio_decoder_get_latency()
-	  API: gst_gst_audio_decoder_get_max_errors()
-	  API: gst_gst_audio_decoder_get_min_latenc()y
-	  API: gst_gst_audio_decoder_get_parse_state()
-	  API: gst_gst_audio_decoder_get_plc()
-	  API: gst_gst_audio_decoder_get_plc_aware()
-	  API: gst_gst_audio_decoder_get_tolerance()
-	  API: gst_gst_audio_decoder_get_type()
-	  API: gst_gst_audio_decoder_set_byte_time()
-	  API: gst_gst_audio_decoder_set_latency()
-	  API: gst_gst_audio_decoder_set_max_errors()
-	  API: gst_gst_audio_decoder_set_min_latency()
-	  API: gst_gst_audio_decoder_set_plc()
-	  API: gst_gst_audio_decoder_set_plc_aware()
-	  API: gst_gst_audio_decoder_set_tolerance()
-	  API: gst_gst_audio_encoder_finish_frame()
-	  API: gst_gst_audio_encoder_get_audio_info()
-	  API: gst_gst_audio_encoder_get_frame_max()
-	  API: gst_gst_audio_encoder_get_frame_samples()
-	  API: gst_gst_audio_encoder_get_hard_resync()
-	  API: gst_gst_audio_encoder_get_latency()
-	  API: gst_gst_audio_encoder_get_lookahead()
-	  API: gst_gst_audio_encoder_get_mark_granule()
-	  API: gst_gst_audio_encoder_get_perfect_timestamp()
-	  API: gst_gst_audio_encoder_get_tolerance()
-	  API: gst_gst_audio_encoder_get_type()
-	  API: gst_gst_audio_encoder_proxy_getcaps()
-	  API: gst_gst_audio_encoder_set_frame_max()
-	  API: gst_gst_audio_encoder_set_frame_samples()
-	  API: gst_gst_audio_encoder_set_hard_resync()
-	  API: gst_gst_audio_encoder_set_latency()
-	  API: gst_gst_audio_encoder_set_lookahead()
-	  API: gst_gst_audio_encoder_set_mark_granule()
-	  API: gst_gst_audio_encoder_set_perfect_timestamp()
-	  API: gst_gst_audio_encoder_set_tolerance()
-	  https://bugzilla.gnome.org/show_bug.cgi?id=642690
-
-2011-08-03 13:31:59 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst/encoding/gstencodebin.c:
-	  encodebin: Select muxer further
-	  Sort muxers based on their caps and ranking before iterating to
-	  find one that fits the profile.
-	  Sorting is done by putting the elements that have a pad template
-	  that can produce the exact caps that is on the profile. For example:
-	  when asking for "video/quicktime, variant=iso", muxers that
-	  have this exact caps on their pad templates will be put first on
-	  the list than ones that have only "video/quicktime".
-	  https://bugzilla.gnome.org/show_bug.cgi?id=651496
-
-2011-09-05 20:31:04 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Actually iterate over the factories instead of only taking the first one
-
-2011-09-05 15:51:25 +0200  Stefan Sauer <ensonic@users.sf.net>
-
-	* tests/check/libs/profile.c:
-	* tests/check/libs/tag.c:
-	* tests/check/libs/video.c:
-	  tests: supress ERROR log output for some tests
-	  Be nice when we tests for correct error handling and don't spam stdout.
-
-2011-09-05 14:40:24 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/playback/gstplaysink.c:
-	  Revert "playsink: Try include 'pitch', if no other sink is provided"
-	  This reverts commit 105814e2c78f9867c61531b9e8166e4ae994296f.
-	  The general consensus seems to be that we should revert this for
-	  now. If such behaviour is desired, we should probably enable it
-	  via a flag. And maybe use the scaletempo plugin instead.
-
-2011-09-05 12:02:23 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysink.c:
-	  playsink: Don't leak the videochain ts-offset element
-	  Also don't leak the audiochain ts-offset element if one is
-	  found but the sink doesn't support volume settings.
-
-2011-09-05 11:55:59 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysink.c:
-	  playsink: Use gst_object_unref() instead of g_object_unref() for better debugging
-
-2011-03-17 19:13:58 -0700  David Schleef <ds@schleef.org>
-
-	* gst/videoscale/Makefile.am:
-	* gst/videoscale/gstvideoscale.c:
-	* gst/videoscale/gstvideoscale.h:
-	* gst/videoscale/vs_image.h:
-	* gst/videoscale/vs_lanczos.c:
-	  videoscale: Add modified Lanczos scaling method
-	  Adds a Lanczos-derived scaling method, which is rather slow, but very
-	  high quality.  Adds a few properties that can be used to tune various
-	  scaling properties: sharpness, sharpen, envelope, dither.  Not currently
-	  Orcified, but was designed with that in mind.
-
-2011-05-16 14:46:52 -0700  David Schleef <ds@schleef.org>
-
-	* gst/playback/Makefile.am:
-	* gst/playback/gstplaybin.c:
-	* gst/playback/gstplaysink.c:
-	* gst/playback/gstplaysinkvideoconvert.c:
-	* gst/playback/gstsubtitleoverlay.c:
-	  playback: Add define for colorspace element
-	  Single point of change if you want to switch from ffmpegcolorspace
-	  to colorspace.
-
-2011-08-25 15:14:58 +0100  Sjoerd Simons <sjoerd.simons@collabora.co.uk>
-
-	* gst/videorate/gstvideorate.c:
-	  videorate: fix dynamically changing average period
-	  The average_period_set variable can be accessed in different threads, so
-	  always lock it when reading. Furthermore when switching to averaging
-	  mode we should make sure we don't have cached buffers that aren't used
-	  in that mode. And any modeswitch will cause the latency to change, so we
-	  should post a NewLatency message
-
-2011-08-23 10:11:52 +0200  Sjoerd Simons <sjoerd.simons@collabora.co.uk>
-
-	* gst/videorate/Makefile.am:
-	* gst/videorate/gstvideorate.c:
-	* gst/videorate/gstvideorate.h:
-	  videorate: Port to basetransform
-
-2011-08-22 15:52:57 +0200  Sjoerd Simons <sjoerd.simons@collabora.co.uk>
-
-	* gst/videorate/gstvideorate.c:
-	  Correct added versions
-
-2011-08-31 14:45:08 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysink.c:
-	  playsink: Only unref ts_offset elements if they're not NULL
-
-2011-08-31 12:39:18 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Keep the chain mutex locked while connecting to the notify::caps signal
-
-2011-08-30 18:21:31 +1000  Jan Schmidt <thaytan@noraisin.net>
-
-	* tests/examples/seek/seek.c:
-	  seek: Accept pipeline descriptions for audiosink/videosink
-	  Make the element_factory_make_or_warn utility function try parsing
-	  the input string as a bin if element_factory_make() fails. This makes
-	  the --audiosink/--videosink commandline options accept a pipeline
-	  string.
-
-2011-08-30 18:21:31 +1000  Jan Schmidt <thaytan@noraisin.net>
-
-	* gst/playback/gstplaysink.c:
-	  playsink: Try include 'pitch', if no other sink is provided
-	  As a default, try the pipeline 'pitch ! audioconvert ! autoaudiosink'
-	  before trying plain autoaudiosink
-
-2011-08-27 14:57:41 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/Makefile.am:
-	* gst-libs/gst/pbutils/Makefile.am:
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  pbutils: don't depend on libgstvideo just to parse some caps
-	  Let's extract those ints and fractions ourselves and not depend
-	  on libgstvideo.
-
-2011-08-27 13:31:07 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/Makefile.am:
-	* gst-libs/gst/audio/Makefile.am:
-	* win32/common/libgstaudio.def:
-	  audio: add GstBaseAudioDecoder and GstBaseAudioEncoder to build
-	  However, libgstaudio now depends on libgstvideo (via pbutils).
-	  https://bugzilla.gnome.org/show_bug.cgi?id=642690
-	  API: gst_audio_info_clear()
-	  API: gst_audio_info_convert()
-	  API: gst_audio_info_copy()
-	  API: gst_audio_info_free()
-	  API: gst_audio_info_from_caps()
-	  API: gst_audio_info_init()
-	  API: gst_audio_info_to_caps()
-	  API: gst_base_audio_decoder_finish_frame()
-	  API: gst_base_audio_decoder_get_audio_info()
-	  API: gst_base_audio_decoder_get_byte_time()
-	  API: gst_base_audio_decoder_get_delay()
-	  API: gst_base_audio_decoder_get_latency()
-	  API: gst_base_audio_decoder_get_max_errors()
-	  API: gst_base_audio_decoder_get_min_latency()
-	  API: gst_base_audio_decoder_get_parse_state()
-	  API: gst_base_audio_decoder_get_plc()
-	  API: gst_base_audio_decoder_get_plc_aware()
-	  API: gst_base_audio_decoder_get_tolerance()
-	  API: gst_base_audio_decoder_get_type()
-	  API: gst_base_audio_decoder_set_byte_time()
-	  API: gst_base_audio_decoder_set_latency()
-	  API: gst_base_audio_decoder_set_max_errors()
-	  API: gst_base_audio_decoder_set_min_latency()
-	  API: gst_base_audio_decoder_set_plc()
-	  API: gst_base_audio_decoder_set_plc_aware()
-	  API: gst_base_audio_decoder_set_tolerance()
-	  API: gst_base_audio_encoder_finish_frame()
-	  API: gst_base_audio_encoder_get_audio_info()
-	  API: gst_base_audio_encoder_get_frame_max()
-	  API: gst_base_audio_encoder_get_frame_samples()
-	  API: gst_base_audio_encoder_get_hard_resync()
-	  API: gst_base_audio_encoder_get_latency()
-	  API: gst_base_audio_encoder_get_lookahead()
-	  API: gst_base_audio_encoder_get_mark_granule()
-	  API: gst_base_audio_encoder_get_perfect_timestamp()
-	  API: gst_base_audio_encoder_get_tolerance()
-	  API: gst_base_audio_encoder_get_type()
-	  API: gst_base_audio_encoder_proxy_getcaps()
-	  API: gst_base_audio_encoder_set_frame_max()
-	  API: gst_base_audio_encoder_set_frame_samples()
-	  API: gst_base_audio_encoder_set_hard_resync()
-	  API: gst_base_audio_encoder_set_latency()
-	  API: gst_base_audio_encoder_set_lookahead()
-	  API: gst_base_audio_encoder_set_mark_granule()
-	  API: gst_base_audio_encoder_set_perfect_timestamp()
-	  API: gst_base_audio_encoder_set_tolerance()
-
-2011-08-27 13:15:54 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.h:
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudioencoder.h:
-	  docs: add since markers to baseaudio{decoder,encoder} documentation
-
-2011-08-27 12:47:40 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	  baseaudiodecoder, baseaudioencoder: fix some compiler warnings
-	  Leaving the GST_USE_UNSTABLE_API guards in until some of the
-	  ported decoders have been updated and it's clear that I didn't
-	  mess up anywhere porting things to the new audio API.
-
-2011-08-27 12:41:28 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioutils.c:
-	* gst-libs/gst/audio/gstbaseaudioutils.h:
-	  baseaudioutils: remove, merged into or superseded by audio.c
-
-2011-08-27 12:39:50 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudioencoder.h:
-	  baseaudioencoder: port to new GstAudioInfo API
-
-2011-08-27 12:37:16 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.h:
-	  baseaudiodecoder: port to GstAudioInfo API
-
-2011-08-27 11:43:02 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/audio.c:
-	* gst-libs/gst/audio/audio.h:
-	  audio: add gst_audio_info_{init,clear} and gst_audio_info_{copy,free}
-
-2011-08-22 20:15:15 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/audio.c:
-	* gst-libs/gst/audio/audio.h:
-	* gst-libs/gst/audio/multichannel.c:
-	* gst-libs/gst/audio/multichannel.h:
-	  audio: add GstAudioFormat, GstAudioFormatInfo and GstAudioInfo
-	  Same as in 0.11, but with caps parsing/serialising for 0.10 style
-	  caps. Add setting default channel positions.
-
-2011-08-17 18:48:41 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	  baseaudioencoder: remove leftover experimental code
-
-2011-08-17 18:32:54 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudioutils.c:
-	* gst-libs/gst/audio/gstbaseaudioutils.h:
-	  audioutils: modify _parse, add GType support functions
-
-2011-08-16 21:11:42 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.h:
-	  baseaudiodecoder: move properties to private storage and add _get/_set
-
-2011-08-16 21:11:52 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	  baseaudiodecoder: rename property
-
-2011-08-16 20:39:07 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.h:
-	  baseaudiodecoder: replace context helper structure by various _get/_set
-
-2011-08-16 18:59:13 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudioencoder.h:
-	  baseaudioencoder: move properties to private storage and add _get/_set
-
-2011-08-16 18:25:43 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	  baseaudioencoder: rename some properties
-
-2011-08-16 18:23:14 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudioencoder.h:
-	  baseaudioencoder: replace context helper structure by various _get/_set
-
-2011-08-16 17:27:07 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.h:
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudioencoder.h:
-	* gst-libs/gst/audio/gstbaseaudioutils.c:
-	* gst-libs/gst/audio/gstbaseaudioutils.h:
-	  baseaudio: rename GstAudioState to GstAudioFormatInfo
-
-2011-06-17 11:54:08 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	  baseaudioencoder: TEMP; avoid some imperfect ts jitter ?
-	  ... even when not in perfect mode ?
-
-2011-04-28 12:01:43 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	  baseaudioencoder: debug format fixes
-
-2011-04-28 12:01:30 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	  baseaudiodecoder: debug format fix
-
-2011-03-31 14:03:11 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	  baseaudiodecoder: fixup documentation
-
-2011-03-29 15:51:40 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	  baseaudiodecoder: fix FLUSH_STOP actions
-
-2011-03-28 13:16:27 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	  baseaudiodecoder: preserve upstream seek event seqnum
-
-2011-03-22 11:09:56 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	  baseaudioencoder: use buffer running time for granule calculation
-
-2011-03-22 10:45:47 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	  baseaudiodecoder: minor fix in ts resync
-
-2011-03-21 11:40:31 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.h:
-	  baseaudiodecoder: improve glitch resilience
-	  Provide a replacement for GST_ELEMENT_ERROR to avoid aborting at the first
-	  atom out of place, while on the other hand not failing indefinitely.
-
-2011-03-17 12:09:47 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.h:
-	  baseaudiodecoder: add limited legacy seeking support
-
-2011-03-16 14:41:40 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	  baseaudiodecoder: cater for audio-codec tag
-
-2011-03-10 16:01:05 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.h:
-	  baseaudiodecoder: initial version
-
-2011-03-16 18:41:03 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	  baseaudioencoder: misc fixes
-
-2011-03-15 17:27:42 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudioencoder.h:
-	* gst-libs/gst/audio/gstbaseaudioutils.c:
-	* gst-libs/gst/audio/gstbaseaudioutils.h:
-	  baseaudio: add audioutils for caps and query handling helper utils
-
-2011-03-14 12:39:49 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.h:
-	  baseaudioencoder: mark unstable API
-
-2011-03-10 15:12:54 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	  baseaudioencoder: fix clearing context
-
-2011-03-10 15:12:19 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudioencoder.h:
-	  baseaudioencoder: simplify latency variable handling
-
-2011-03-10 14:28:48 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudioencoder.h:
-	  baseaudioencoder: minor fixes and code simplifications
-	  Also modify and elaborate a bit on pre_push (though currently unused to no harm).
-
-2011-03-09 12:44:36 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	  baseaudioencoder: additional documentation on granule semantics and configuration
-
-2011-03-09 12:24:34 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	  baseaudioencoder: elaborate property names
-
-2011-03-09 12:22:04 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudioencoder.h:
-	  baseaudioencoder: rename state field xint to is_int
-
-2011-03-09 12:18:56 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	  baseaudioencoder: gtk-doc syntax fixes
-
-2011-03-09 12:17:18 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudioencoder.h:
-	  baseaudioencoder: minor fix and cleanup
-
-2011-03-01 14:08:18 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.h:
-	  baseaudiocodec: ... and also rename to baseaudiodecoder
-
-2011-03-01 13:58:31 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.h:
-	  gst-libs/gst/audio: Remove baseaudiodecoder
-	  Adds little beyond baseaudiocodec (seeking, bit of query), and what it adds
-	  is mainly out-of-scope (e.g. decoder seeking, should be done by upstream
-	  demuxer/parser) and/or based on non-prime example (mad).
-
-2009-09-17 13:26:28 +0200  Iago Toral <itoral@igalia.com>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	  baseaudiodecoder: Return TRUE if we run into special conversion cases.
-
-2009-09-01 14:17:53 +0200  Iago Toral <itoral@igalia.com>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.h:
-	  audio: initial version of GstBaseAudioCodec
-	  Moved most of the code to GstBaseAudioCodec, GstBaseAudioDecode is
-	  now really small, maybe we do not really need it (or its encoder
-	  counterpart). Added more API for subclasses and documentation.
-
-2009-08-14 09:45:52 +0200  Iago Toral <itoral@igalia.com>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.h:
-	  Added src_queries to decoder class. Added handle_discont to decoder class. Reworked reset. Various other minor fixes.
-
-2009-08-06 15:28:00 +0200  Iago Toral <itoral@igalia.com>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.h:
-	  Added a draft implementation of gstbaseaudiodecoder
-
-2011-03-01 11:56:29 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiodecoder.c:
-	* gst-libs/gst/audio/gstbaseaudiodecoder.h:
-	  Added audio directory for audio codec base classes
-
-2011-02-18 16:38:37 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudioencoder.h:
-	  audioencoders: add streamheader helper utility
-
-2011-01-27 16:52:50 +0100  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudioencoder.c:
-	* gst-libs/gst/audio/gstbaseaudioencoder.h:
-	  audioencoders: baseaudioencoder and ported encoders
-
-2011-08-26 10:03:26 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* win32/common/libgstpbutils.def:
-	  win32: Add new discoverer API
-
-2011-08-26 10:03:17 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	  docs: Add new discoverer API
-
-2011-08-24 16:29:08 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/gstdiscoverer-types.c:
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	* gst-libs/gst/pbutils/gstdiscoverer.h:
-	* gst-libs/gst/pbutils/pbutils-private.h:
-	* tools/gst-discoverer.c:
-	  discoverer: retrieve audio track language from tags too
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657257
-
-2011-08-24 15:09:47 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  discoverer: consider subtitles as raw
-	  Otherwise, discoverer will generated an "inner" codec
-	  where there can be a tranformation (eg, kate -> DVD SPU,
-	  and various ->text/x-pango-markup).
-	  https://bugzilla.gnome.org/show_bug.cgi?id=639055
-
-2011-08-24 15:05:38 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  discoverer: add application/x-kate to subtitles caps
-	  https://bugzilla.gnome.org/show_bug.cgi?id=639055
-
-2011-08-24 14:59:38 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  discoverer: get language from other tags if we did not get it already
-	  https://bugzilla.gnome.org/show_bug.cgi?id=639055
-
-2011-08-24 15:04:50 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/gstdiscoverer-types.c:
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	* gst-libs/gst/pbutils/gstdiscoverer.h:
-	* gst-libs/gst/pbutils/pbutils-private.h:
-	* tools/gst-discoverer.c:
-	  discoverer: add subtitles API
-	  https://bugzilla.gnome.org/show_bug.cgi?id=639055
-
-2011-08-21 14:51:45 -0700  David Schleef <ds@schleef.org>
-
-	* gst/playback/gstplaysink.c:
-	  playback: reference count ts_offset
-	  Apparently this object is being used after it's freed.  This is one
-	  way to fix it, although perhaps not the best way.  Fixes: #656715.
-
-2011-08-25 14:55:14 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/theora/gsttheoraenc.c:
-	  theoraenc: fix caps leak
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657333
-
-2011-07-08 23:06:46 -0400  Olivier Crête <olivier.crete@collabora.com>
-
-	* gst-libs/gst/rtp/gstbasertppayload.c:
-	  basertppayload: Make perfect timestamps reproducible across element restart
-	  Without the perfect timestamp machinery, the RTP timestamp can be
-	  computed directly from the running time of a buffer, but the perfect
-	  timestamp patch broke that assumption. This patch restores it by
-	  having the first perfect timestamp be the running time of that buffer
-	  and counting from there.
-	  Fixes https://bugzilla.gnome.org/show_bug.cgi?id=654434
-
-2011-08-24 17:39:11 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggmux.c:
-	  oggmux: fix leaks in skeleton writing
-	  https://bugzilla.gnome.org/show_bug.cgi?id=563251
-
-2011-08-18 16:36:23 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggmux.c:
-	* ext/ogg/gstoggmux.h:
-	  oggmux: generate message headers from received tags
-	  Some message headers can be deduced from tags (eg, "Language").
-	  https://bugzilla.gnome.org/show_bug.cgi?id=563251
-
-2011-08-18 10:05:17 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	* ext/ogg/gstoggparse.c:
-	  ogg: use memory slices where appropriate
-	  While there, avoid zeroing newly allocated memory where unnecessary
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656775
-
-2011-08-24 14:05:27 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysinkaudioconvert.c:
-	* gst/playback/gstplaysinkvideoconvert.c:
-	  playsink{audio,video}convert: Send NEWSEGMENT events to sinkpads instead of pushing them
-
-2011-08-23 11:12:10 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: do not warn when reaching EOS while scanning for the end chain
-	  After all, we were asking for it.
-	  This gets rid of the last warning-about-expected-condition.
-	  w00t.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657151
-
-2011-08-23 11:08:25 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: add media type to chain information reports
-	  One more little step in making logs a little less abstruse.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657151
-
-2011-08-23 11:05:11 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggstream.c:
-	  oggstream: correctly identify skeleton EOS packet
-	  It is 0 byte, and was triggering the "bad packet" logic.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657151
-
-2011-08-23 10:58:20 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: do not warn about expected occurences
-	  In this case, finding a skeleton packet.
-	  Once upon a time, it used to be rare indeed, but no more.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657151
-
-2011-08-23 10:47:53 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: do not warn when finding a non BOS page
-	  After all, we do hope to find actual data for these streams.
-	  However, warn if we could not set up a chain when we find a
-	  non BOS page, as that means we don't have a valid Ogg stream.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657151
-
-2011-08-23 10:40:12 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: rename local variable for clarity
-	  While the casual reader might end up bewildered by just why this
-	  change might increase clarity, it just happens than, in the libogg
-	  and associated sources, op is the canonical name for an ogg_packet
-	  whlie og is the canonical name for an ogg_page, and reading this
-	  code confuses me.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657151
-
-2011-08-23 10:32:36 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: do not try to determine duration of header packets
-	  Headers are inherently durationless.
-	  Instead, set duration to 0 to avoid increasing tracked granpos,
-	  and do not warn about it, since it is totally expected.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657151
-
-2011-08-23 10:29:49 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggstream.c:
-	  oggstream: include stream type in warnings
-	  It makes it easier to work out what's going on.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657151
-
-2011-08-23 10:28:33 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggstream.c:
-	  oggstream: set skeleton stream media type to application/x-ogg-skeleton
-	  This is to match the typefinder, and to make logs clearer.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657151
-
-2011-08-17 17:09:44 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggmux.c:
-	* ext/ogg/gstoggmux.h:
-	  oggmux: add skeleton write support
-	  Version written is 3.0
-	  Base times are left empty for now.
-	  Content-Type should be the MIME type of the stream. It is set to
-	  the GStreamer media type for now, which is probably the same for
-	  the streams oggmux supports.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=563251
-
-2011-08-22 14:56:38 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: do not skip sparse streams when determining start times
-	  This fixes demuxing of streams containing only sparse streams,
-	  which would cause an infinite loop in _read_end_chain.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657062
-
-2011-08-22 14:55:59 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	  oggdemux: do not ignore sparse streams' start time
-	  But do not wait for them either, if we don't have a packet for them.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657062
-
-2011-07-21 17:16:26 -0400  Monty Montgomery <cmontgom@redhat.com>
-
-	* ext/vorbis/gstvorbisenc.c:
-	  vorbisenc: Relax overly-tight jitter tolerances in gstvobisenc
-	  vorbisenc currently reacts in a rater draconian fashion if input
-	  timestamps are more than 1/2 sample off what it considers ideal. If data
-	  is 'too late' it truncates buffers, if it is 'too soon' it completely
-	  shuts down encode and restarts it.  This is causingvorbisenc to produce
-	  corrupt output when encoding data produced by sources with bugs that
-	  produce a smple or two of jitter (eg, flacdec)
-
-2011-08-22 09:06:53 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/pango/gsttextoverlay.c:
-	  textoverlay: fix text buffer leak
-	  Make sure to always unref the input text buffer.
-	  Reported by bcxa.sz@gmail.com.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=657049
-
-2011-08-20 19:46:31 +0200  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/video/gstvideosink.h:
-	  docs: fix xref for the property
-
-2011-08-20 19:16:42 +0200  Stefan Kost <ensonic@users.sf.net>
-
-	* docs/libs/gst-plugins-base-libs-docs.sgml:
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/audio/gstaudiofilter.c:
-	* gst-libs/gst/interfaces/colorbalance.c:
-	* gst-libs/gst/interfaces/mixer.c:
-	* gst-libs/gst/interfaces/navigation.c:
-	* gst-libs/gst/interfaces/streamvolume.h:
-	* gst-libs/gst/interfaces/xoverlay.c:
-	* gst-libs/gst/pbutils/gstdiscoverer-types.c:
-	* gst-libs/gst/pbutils/install-plugins.h:
-	* gst-libs/gst/rtp/gstrtpbuffer.c:
-	* gst-libs/gst/rtsp/gstrtsptransport.c:
-	* gst-libs/gst/rtsp/gstrtspurl.c:
-	* gst-libs/gst/sdp/gstsdpmessage.c:
-	* gst-libs/gst/video/gstvideosink.h:
-	  docs: handle warnings emitted by gtk-doc
-	  This is useful and in most cases someone had put arbitrary markup into the docs,
-	  misspelled xref'ed symbols, forgot to add stuff to the docs etc..
-
-2011-08-20 17:53:11 +0200  Stefan Kost <ensonic@users.sf.net>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	  docs: partially revert my last commit
-	  Somehow this was already there, but I missed that commit.
-
-2011-08-20 14:11:11 +0200  Stefan Kost <ensonic@users.sf.net>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/tag/licenses.c:
-	  docs: add new taglicense docs and clean them up
-	  Avoid ugly docbook tags unless needed.
-
-2011-08-20 12:37:10 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* po/af.po:
-	* po/az.po:
-	* po/bg.po:
-	* po/ca.po:
-	* po/cs.po:
-	* po/da.po:
-	* po/de.po:
-	* po/el.po:
-	* po/en_GB.po:
-	* po/es.po:
-	* po/eu.po:
-	* po/fi.po:
-	* po/fr.po:
-	* po/gl.po:
-	* po/hu.po:
-	* po/id.po:
-	* po/it.po:
-	* po/ja.po:
-	* po/lt.po:
-	* po/lv.po:
-	* po/nb.po:
-	* po/nl.po:
-	* po/or.po:
-	* po/pl.po:
-	* po/pt_BR.po:
-	* po/ro.po:
-	* po/ru.po:
-	* po/sk.po:
-	* po/sl.po:
-	* po/sq.po:
-	* po/sr.po:
-	* po/sv.po:
-	* po/tr.po:
-	* po/uk.po:
-	* po/vi.po:
-	* po/zh_CN.po:
-	  po: update for new translatable string
-
-2011-08-20 12:36:20 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/Makefile.am:
-	  tag: fix distcheck issue
-	  Dist licenses dict.
-
-2011-08-18 16:20:57 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	* ext/ogg/gstoggparse.c:
-	  ogg: do not use 32 bit modifiers to print serial numbers
-	  If ints are 64 bits, 32 bits should get promoted in varargs anyway,
-	  and we don't care about 16 bit ints.
-	  This makes the code a lot more readable, and still gets us nice
-	  hexadecimal 32 bit serialnos.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656775
-
-2011-07-27 11:05:31 +0000  Edward Hervey <edward.hervey@collabora.co.uk>
-
-	* gst/playback/gstplaysink.c:
-	  playsink: Reconfigure when pads are added later
-	  Instead of just assuming all pads are created at the same time,
-	  remember which ones are actually new (via ->pending_blocked_pads).
-	  This allows the following use-case to properly work:
-	  * Upstream starts with audio-only
-	  * Only that pad gets data, blocks and a real audio sink is created
-	  * Upstream laters adds a video stream
-	  * A new pad is requested, blocks and reconfiguration kicks in in
-	  order to add a new real video sink
-
-2011-08-18 09:37:38 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/README:
-	  ogg: get the operator precedence right, even if only a doc
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656775
-
-2011-08-18 09:30:46 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggstream.c:
-	  oggstream: vorbis has a preroll of 2
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656775
-
-2011-08-17 19:40:08 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggstream.c:
-	* ext/ogg/gstoggstream.h:
-	  oggstream: new convenience function to get a stream's media type
-	  This will make logging a lot clearer, both in code and in output.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656775
-
-2011-08-17 18:48:54 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggmux.c:
-	* ext/ogg/gstoggmux.h:
-	* ext/ogg/gstoggstream.c:
-	* ext/ogg/gstoggstream.h:
-	  ogg: move the "always flush page" to oggstream
-	  It avoids checking for specific media types in the muxer.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656775
-
-2011-08-17 18:38:39 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggmux.c:
-	  oggmux: use oggstream to decide which BOS packets to place first
-	  Ogg recommends video BOS packets to be first.
-	  Use the "is_video" flag in oggstream to select those, rather than
-	  check for known mime types.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656775
-
-2011-08-17 18:03:16 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggdemux.c:
-	* ext/ogg/gstoggmux.c:
-	* ext/ogg/gstoggstream.h:
-	  ogg: rationalize serialno type to guint32
-	  It is a 32 bit unsigned number.
-	  Sure, the libogg API uses a long, but that's an unfortunate oversight.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656775
-
-2011-08-17 17:39:18 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggmux.c:
-	  oggmux: factor the header packet creation code
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656775
-
-2011-08-17 17:18:47 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* ext/ogg/gstoggmux.c:
-	  oggmux: headers should always have granpos 0
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656775
-
-2011-08-18 09:48:16 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/audioresample/resample.c:
-	  audioresample: fix build without orc
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656781
-
-2011-08-15 01:22:02 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstid3tag.c:
-	* tests/check/libs/tag.c:
-	  tag: id3: avoid some more relocations in genre table
-
-2011-08-12 12:07:32 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* tests/check/Makefile.am:
-	* tests/check/elements/audioresample.c:
-	  audioresample: add FFT based checks
-	  Send a few simple tones through audioresample and check
-	  that the main frequency spot is the same for the input and
-	  the resampled output.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656392
-
-2011-08-15 23:41:24 +0200  Alessandro Decina <alessandro.d@gmail.com>
-
-	* gst-libs/gst/rtsp/gstrtspconnection.c:
-	  rtspconnection: add OSX specific hack to detect when a connection is refused
-	  Unlike linux, OSX wakes up select with POLLOUT (instead of POLLERR) when
-	  connect() is done async and the connection is refused. Therefore always check
-	  for the socket error state using getsockopt (..., SO_ERROR, ...) after a
-	  connection attempt.
-
-2011-08-15 00:17:14 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-docs.sgml:
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	  docs: add new license API to docs
-
-2011-08-15 00:03:39 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* configure.ac:
-	  configure: try pkg-config first when looking for zlib
-
-2011-08-14 20:44:19 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/id3v2.3.0.txt:
-	* gst-libs/gst/tag/id3v2.4.0-frames.txt:
-	* gst-libs/gst/tag/id3v2.4.0-structure.txt:
-	  tag: id3v2: add specs to git for reference
-
-2011-08-14 13:32:12 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/id3v2.c:
-	  tag: id3v2: avoid some relocations, make table static
-
-2011-08-14 01:47:41 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/id3v2.c:
-	* gst-libs/gst/tag/id3v2.h:
-	* gst-libs/gst/tag/id3v2frames.c:
-	  tag: id3v2: add debug category for ID3 tag parsing
-
-2011-07-18 18:09:53 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* configure.ac:
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/tag/Makefile.am:
-	* gst-libs/gst/tag/id3v2.c:
-	* gst-libs/gst/tag/id3v2.h:
-	* gst-libs/gst/tag/id3v2frames.c:
-	* gst-libs/gst/tag/tag.h:
-	* gst-libs/gst/tag/tags.c:
-	* win32/common/libgsttag.def:
-	  tag: id3v2: add id3v2 tag parsing helpers
-	  https://bugzilla.gnome.org/show_bug.cgi?id=654388
-
-2011-02-22 15:19:00 +0200  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/tag/id3v2.c:
-	  tag: id3v2: return ID3TAGS_BROKEN_TAG for unsupported versions
-	  This prevents us for trying to work with a NULL taglist.
-
-2011-01-02 19:23:51 +0000  Erich Schubert <erich@debian.org>
-
-	* gst-libs/gst/tag/id3v2frames.c:
-	  tag: id3v2: fix parsing of ID3v2.4 genre frames with multiple genres
-	  We'd only extract the first genre (multiple times) instead of all
-	  genres.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=638535
-
-2010-09-24 15:19:15 +0200  Edward Hervey <bilboed@bilboed.com>
-
-	* gst-libs/gst/tag/id3v2.c:
-	  tag: id3v2: Sanitize id3 frame names
-	  This is similar to what is done in qtdemux. Avoids providing invalid
-	  structure/tags names
-
-2010-03-30 01:50:32 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/id3v2frames.c:
-	  tag: id3v2: fix parsing of unsynced frames with data length indicator
-	  Fixes bug #614158.
-
-2010-03-20 00:54:14 +0100  Benjamin Otte <otte@redhat.com>
-
-	* gst-libs/gst/tag/id3v2.c:
-	  Add -Wwrite-strings to the configure flags
-	  ... and fix all warnings
-
-2009-12-13 13:19:43 +0000  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/id3v2frames.c:
-	  tag: id3v2: prefer two letter ISO 639-1 code for extended comment
-
-2009-10-09 15:59:25 +0200  Josep Torra <n770galaxy@gmail.com>
-
-	* gst-libs/gst/tag/id3v2.c:
-	  tag: id3v2: fixes warnings building on macosx
-	  Another round on the formating of that debug line.
-
-2009-10-09 14:44:02 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/tag/id3v2.c:
-	  tag: id3v2: cast pointer math results to glong
-
-2009-10-09 13:38:17 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/tag/id3v2.c:
-	  tag: id3v2: don't cast, but use the right format specified instead
-	  This correct some of the previous macos fixes.
-
-2009-10-09 11:42:36 +0200  Josep Torra <n770galaxy@gmail.com>
-
-	* gst-libs/gst/tag/id3v2.c:
-	  tag: id3v2: fix printf warnings on macosx
-
-2009-10-07 14:03:20 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/tag/id3v2frames.c:
-	  tag: id3v2: fprintf, sprintf, sscanf need stdio.h
-
-2009-09-22 15:03:20 +0200  Alessandro Decina <alessandro.d@gmail.com>
-
-	* gst-libs/gst/tag/id3v2frames.c:
-	  tag: id3v2: Fix compile warnings with gcc 4.0.1.
-
-2009-08-09 12:52:17 +0200  LoneStar <lone@auvtech.com>
-
-	* gst-libs/gst/tag/id3v2frames.c:
-	  tag: id3v2: Try GST_*_TAG_ENCODING and locale encoding if tags are not UTF8
-	  Fixes bug #499242.
-
-2009-08-07 16:42:39 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/id3v2frames.c:
-	  tag: id3v2: sizes in ID3 v2.3 are unlikely to be sync-safe integers
-	  In ID3 v2.3 compressed frames will have a 4-byte data length indicator
-	  after the frame header to indicate the size of the decompressed data.
-	  This integer is unlikely to be a sync-safe integer for v2.3 tags,
-	  only in v2.4 it's sync-safe.
-
-2009-08-07 16:36:55 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/id3v2.c:
-	  tag: id3v2: fix typo in debug message
-
-2009-08-07 16:02:23 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/id3v2.c:
-	* gst-libs/gst/tag/id3v2.h:
-	* gst-libs/gst/tag/id3v2frames.c:
-	  tag: id3v2: fix parsing of unsync'ed ID3 v2.4 tags and frames
-	  Reversing the unsynchronisation seems to work slightly differently
-	  for ID3 v2.3 tags and v2.4 tags: v2.3 tags don't have syncsafe frame
-	  sizes in the frame header, so the unsynchronisation is applied to
-	  the whole frame data including all the frame headers. v2.4 frames
-	  have sync-safe sizes, however, so the unsynchronisation only needs
-	  to be applied to the actual frame data, and it seems that's what's
-	  being done as well. So we need to undo the unsynchronisation on a
-	  per-frame basis for v2.4 tags for things to work properly.
-	  Fixes extraction of coverart/images from APIC frames in ID3 v2.4
-	  tags (#588148).
-	  Add unit test for this as well.
-
-2009-04-24 01:51:35 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/id3v2.c:
-	  tag: id3v2: parse unsynchronised tags properly
-	  We didn't handle unsynchronization at all up to now, which might have
-	  caused frames to not be extracted - esp. frames after an APIC picture
-	  frame. Fixes #577468.
-
-2009-04-24 01:01:53 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/id3v2.c:
-	  tag: id3v2: pass the right size value for size of all frames to the parser
-	  Frame data size is tag size adjusted for size of the tag header and
-	  footer, not tag size including header and footer.
-
-2008-06-04 10:42:46 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: Use new utility functions in libgsttag to process coverart (#512333).
-	  Original commit message from CVS:
-	  * ext/flac/gstflacdec.c: (gst_flac_extract_picture_buffer):
-	  * gst-libs/gst/tag/id3v2frames.c: (parse_picture_frame):
-	  Use new utility functions in libgsttag to process coverart (#512333).
-
-2008-01-11 21:08:59 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: Generate the image-type values correctly. Leave them out of the caps when outputting a "preview image" tag, since it ...
-	  Original commit message from CVS:
-	  * ext/flac/gstflacdec.c: (gst_flac_extract_picture_buffer):
-	  * gst-libs/gst/tag/id3v2frames.c: (parse_picture_frame):
-	  Generate the image-type values correctly. Leave them out of the caps
-	  when outputting a "preview image" tag, since it only makes sense
-	  to have one of those - the type is irrelevant.
-	  * sys/sunaudio/gstsunaudiomixerctrl.c:
-	  (gst_sunaudiomixer_ctrl_open):
-	  If we can, mark the mixer multiple open when we use it, in case
-	  (for some reason) the process wants to open it again elsewhere.
-
-2008-01-09 15:20:19 +0000  Tommi Myöhänen <ext-tommi.myohanen@nokia.com>
-
-	  tag: id3v2: Make sure the ISO 639-X language code in ID3v2 COMM frames so we don't end up with non-UT...
-	  Original commit message from CVS:
-	  Based on patch by: Tommi Myöhänen <ext-tommi.myohanen nokia com>
-	  * gst-libs/gst/tag/id3v2frames.c: (parse_comment_frame):
-	  Make sure the ISO 639-X language code in ID3v2 COMM frames
-	  is actually valid UTF-8 (or rather: ASCII), so we don't end
-	  up with non-UTF8 strings in tags if there's garbage in the
-	  language field. Also make sure the language code is always
-	  lower case. Fixes: #508291.
-
-2007-12-14 10:17:10 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: Parse WOAF frames and put the result into GST_TAG_CONTACT, which is where it would end up...
-	  Original commit message from CVS:
-	  * tag: id3v2: (parse_url_link_frame):
-	  Parse WOAF frames and put the result into GST_TAG_CONTACT,
-	  which is where it would end up if the same information was
-	  put in a vorbis comment (don't think it's worth adding a
-	  new URI tag for this). Fixes #488112.
-
-2007-11-14 21:39:47 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: We don't want the same string multiple times in a tag list for the same tag ever, for any tag, not jus...
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2.c:
-	  * gst-libs/gst/tag/id3v2.h:
-	  * gst-libs/gst/tag/id3v2frames.c: (id3v2_tag_to_taglist):
-	  We don't want the same string multiple times in a tag list for the
-	  same tag ever, for any tag, not just for GST_TAG_GENRE, so make sure
-	  this doesn't happen and remove special-case code for GST_TAG_GENRE.
-
-2007-10-11 17:55:29 +0000  Jason Kivlighn <jkivlighn@gmail.com>
-
-	  tag: id3v2: Extract license/copyright URIs from ID3v2 WCOP frames (Fixes #447000).
-	  Original commit message from CVS:
-	  Based on patch by: Jason Kivlighn  <jkivlighn gmail com>
-	  * gst-libs/gst/tag/id3v2frames.c:
-	  Extract license/copyright URIs from ID3v2 WCOP frames
-	  (Fixes #447000).
-	  * tests/check/elements/id3demux.c:
-	  * tests/files/Makefile.am:
-	  * tests/files/id3-447000-wcop.tag:
-	  Add simple unit test.
-
-2007-10-06 16:13:14 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: Port ID3 tag demuxer over to the new GstTagDemux in -base (now would be a good time to test re-importi...
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/gstid3demux.c:
-	  * gst-libs/gst/tag/gstid3demux.h:
-	  * gst-libs/gst/tag/id3v2.c:
-	  * gst-libs/gst/tag/id3v2.h:
-	  * gst-libs/gst/tag/id3v2frames.c:
-	  Port ID3 tag demuxer over to the new GstTagDemux in -base
-	  (now would be a good time to test re-importing your music
-	  collection).
-
-2007-03-12 13:28:29 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: Fix parsing of ID3 v2.2.0 PIC frames. Only in version >= 2.3.0 is the image format a vari...
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (parse_picture_frame):
-	  Fix parsing of ID3 v2.2.0 PIC frames. Only in version >= 2.3.0 is
-	  the image format a variable-length NUL-terminated string; in
-	  versions before that the image format is a fixed-length string of
-	  3 characters (see #348644 for a sample tag).
-	  Also make supplied mime type lower-case and fix up 'jpg' to 'jpeg'.
-
-2007-03-06 18:16:49 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: Do not convert obsolete TDA/TDAT frames to TDRC frames, otherwise the four-digit number will be interp...
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2.c: (id3demux_id3v2_frames_to_tag_list):
-	  * gst-libs/gst/tag/id3v2.h:
-	  * gst-libs/gst/tag/id3v2frames.c: (id3demux_id3v2_parse_frame),
-	  (parse_obsolete_tdat_frame):
-	  Do not convert obsolete TDA/TDAT frames to TDRC frames, otherwise
-	  the four-digit number will be interpreted as a year, whereas it is
-	  month and day in DDMM format. Instead, parse TDAT frames and fix up
-	  the date in the GST_TAG_DATE tag later if we also extracted a year.
-	  Fixes #407349.
-
-2006-11-19 13:41:53 +0000  René Stadler <mail@renestadler.de>
-
-	  tag: id3v2: Make sure that g_free always gets called on the same pointer that was returned by g_mallo...
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (id3demux_id3v2_parse_frame):
-	  Make sure that g_free always gets called on the same pointer that was
-	  returned by g_malloc.  Fixes #376594.
-	  Do not leak memory if decompressed size is wrong.
-	  Remove unneeded check of return value of g_malloc.
-	  Patch by: René Stadler <mail@renestadler.de>
-
-2006-11-01 13:59:49 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: We require a -base more recent than 0.10.9, so it's safe to use
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (parse_picture_frame):
-	  We require a -base more recent than 0.10.9, so it's safe to use
-	  GST_TYPE_TAG_IMAGE_TYPE unconditionally now.
-	  * ext/dv/gstdvdec.c: (gst_dvdec_sink_event):
-	  * ext/jpeg/gstjpegdec.c: (gst_jpeg_dec_sink_event):
-	  Use _newsegment_full() now that we depend on a recent enough core.
-	  * gst/wavparse/gstwavparse.c:
-	  Remove cruft that we don't need any longer now that we depend on
-	  a recent enough -base.
-
-2006-10-05 16:37:33 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: Printf format fixes.
-	  Original commit message from CVS:
-	  * ext/cairo/gsttimeoverlay.c:
-	  (gst_cairo_time_overlay_update_font_height):
-	  * ext/gdk_pixbuf/pixbufscale.c: (gst_pixbufscale_transform_caps):
-	  * ext/jpeg/gstjpegdec.c: (gst_jpeg_dec_parse_image_data):
-	  * ext/jpeg/gstjpegenc.c: (gst_jpegenc_chain):
-	  * ext/jpeg/gstsmokedec.c: (gst_smokedec_chain):
-	  * ext/jpeg/gstsmokeenc.c: (gst_smokeenc_chain):
-	  * ext/libpng/gstpngdec.c: (user_endrow_callback):
-	  * gst/auparse/gstauparse.c: (gst_au_parse_parse_header):
-	  * gst/avi/gstavidemux.c: (gst_avi_demux_parse_superindex),
-	  (gst_avi_demux_parse_subindex), (gst_avi_demux_parse_stream),
-	  (gst_avi_demux_stream_data):
-	  * gst/cutter/gstcutter.c: (gst_cutter_chain):
-	  * gst/debug/efence.c: (gst_efence_buffer_alloc),
-	  (gst_fenced_buffer_copy):
-	  * gst-libs/gst/tag/id3v2frames.c: (id3demux_id3v2_parse_frame):
-	  * gst/matroska/matroska-demux.c: (gst_matroska_demux_add_stream):
-	  * gst/matroska/matroska-mux.c: (gst_matroska_mux_start):
-	  * gst/rtsp/gstrtspsrc.c: (gst_rtspsrc_send),
-	  (gst_rtspsrc_handle_message):
-	  * gst/wavparse/gstwavparse.c: (gst_wavparse_stream_headers):
-	  * sys/ximage/ximageutil.c: (ximageutil_xcontext_get):
-	  Printf format fixes.
-
-2006-08-22 13:53:34 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: If strings in text fields are marked ISO8859-1, but contain valid UTF-8 already, then han...
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (parse_text_identification_frame),
-	  (parse_insert_string_field):
-	  If strings in text fields are marked ISO8859-1, but contain
-	  valid UTF-8 already, then handle them as UTF-8 and ignore
-	  the encoding. (#351794)
-
-2006-08-16 13:01:32 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  configure.ac: Require CVS of GStreamer core and -base (for
-	  Original commit message from CVS:
-	  * configure.ac:
-	  Require CVS of GStreamer core and -base (for
-	  GST_TAG_EXTENDED_COMMENT and gst_tag_parse_extended_comment()).
-	  * ext/taglib/gstid3v2mux.cc:
-	  Write extended comment tags properly (#348762).
-	  * gst-libs/gst/tag/id3v2frames.c: (id3demux_id3v2_parse_frame),
-	  (parse_comment_frame):
-	  Extract COMM frames into extended comments, which makes it
-	  easier to properly retain the description bit of the tag
-	  and maintain this information when re-tagging (#348762).
-
-2006-07-25 16:47:04 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: Extract frames for ID3v2 versions prior to ID3v2.3.0 properly as well, and add the version to...
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2.c:
-	  (id3demux_add_id3v2_frame_blob_to_taglist):
-	  Extract frames for ID3v2 versions prior to ID3v2.3.0 properly as
-	  well, and add the version to the blob's buffer caps, since that
-	  information will be needed for deserialisation later on (#348644).
-
-2006-07-23 11:33:54 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: On second thought, it might be wiser and more efficient not to do tag registration from a streaming th...
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/gstid3demux.c: (plugin_init):
-	  * gst-libs/gst/tag/id3v2.c:
-	  (id3demux_add_id3v2_frame_blob_to_taglist):
-	  * gst-libs/gst/tag/id3v2.h:
-	  On second thought, it might be wiser and more efficient
-	  not to do tag registration from a streaming thread.
-
-2006-07-23 10:56:27 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: Put ID3v2 frames we can't parse as binary blobs into private tags, so that they are not lost ...
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2.c:
-	  (id3demux_add_id3v2_frame_blob_to_taglist),
-	  (id3demux_id3v2_frames_to_tag_list):
-	  Put ID3v2 frames we can't parse as binary blobs into private
-	  tags, so that they are not lost when retagging, at least once
-	  id3v2mux has been taught to re-inject those frames again.
-	  See bug #334375.
-
-2006-07-21 10:57:00 +0000  Wim Taymans <wim.taymans@gmail.com>
-
-	  tag: id3v2: Don't use \n in debug lines
-	  Original commit message from CVS:
-	  * gst/avi/gstavidemux.c: (gst_avi_demux_parse_stream),
-	  (gst_avi_demux_process_next_entry):
-	  Fix some leaks.
-	  * gst-libs/gst/tag/id3v2.c: (id3demux_id3v2_frames_to_tag_list):
-	  Don't use \n in debug lines.
-
-2006-06-22 12:17:13 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: Set image type from APIC frame as "image-type" field of GST_TAG_IMAGE buffer caps (#344605).
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (parse_picture_frame):
-	  Set image type from APIC frame as "image-type" field
-	  of GST_TAG_IMAGE buffer caps (#344605).
-
-2006-06-11 19:31:10 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: Extract images from ID3v2 tags (APIC frames). Fixes #339704.
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (id3demux_id3v2_parse_frame),
-	  (scan_encoded_string), (parse_picture_frame):
-	  Extract images from ID3v2 tags (APIC frames). Fixes #339704.
-	  * configure.ac:
-	  Require core >= 0.10.8 (for GST_TAG_IMAGE and
-	  GST_TAG_PPEVIEW_IMAGE used in the patch above).
-
-2006-05-28 10:05:47 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: A track/volume number or count of 0 does not make sense, just ignore it along with negati...
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (id3v2_tag_to_taglist):
-	  A track/volume number or count of 0 does not make sense,
-	  just ignore it along with negative numbers (a tag might
-	  only contain a track count without a track number).
-
-2006-05-19 14:05:53 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: Don't output any tag when we encounter a negative track number - the tag type is uint, so...
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (id3v2_tag_to_taglist):
-	  Don't output any tag when we encounter a negative track number - the
-	  tag type is uint, so we end up outputting huge positive numbers
-	  instead. (Fixes: #342029)
-
-2006-05-16 14:07:29 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: Rework string parsing to always walk over BOM markers in UTF16 strings, using the endianness indicated by the innermost one ...
-	  Original commit message from CVS:
-	  * gst/autodetect/gstautoaudiosink.c:
-	  (gst_auto_audio_sink_find_best):
-	  * gst/autodetect/gstautovideosink.c:
-	  (gst_auto_video_sink_find_best):
-	  Make the name of the child element be based on the name of the
-	  parent, so that debug output is more useful.
-	  * gst-libs/gst/tag/id3v2frames.c: (find_utf16_bom),
-	  (parse_insert_string_field), (parse_split_strings):
-	  Rework string parsing to always walk over BOM markers in UTF16
-	  strings, using the endianness indicated by the innermost one,
-	  then trying the opposite endianness if that fails to convert
-	  to valid UTF-8. Fixes #341774
-
-2006-05-12 08:21:37 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: Some more debug info. No need to check whether the string returned by g_convert() is real...
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (parse_insert_string_field):
-	  Some more debug info. No need to check whether the string
-	  returned by g_convert() is really UTF-8 - either it is or
-	  we get NULL returned.
-
-2006-05-10 13:51:01 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: Fix parsing of numeric genre strings some more, by ensuring that we only try and parse st...
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (id3v2_genre_fields_to_taglist):
-	  Fix parsing of numeric genre strings some more, by ensuring that
-	  we only try and parse strings that a) Start with '(' and b) Consist
-	  only of digits.
-	  Also, when finding an escaping '((' sequence, bust it back to '(' by
-	  swallowing the first parenthesis
-
-2006-04-28 11:37:22 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: Recognise and skip any byte order marker (BOM) in
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (has_utf16_bom),
-	  (parse_split_strings):
-	  Recognise and skip any byte order marker (BOM) in
-	  UTF-16 strings.
-
-2006-04-17 10:01:51 +0000  Alex Lancaster <alexlan@fedoraproject.org>
-
-	  tag: id3v2: Recognise TCO (Genre) tags in ID3v2.2
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2.c:
-	  Recognise TCO (Genre) tags in ID3v2.2. Patch by Alex Lancaster
-	  (Fixes #338713)
-
-2006-03-30 23:37:16 +0000  Sébastien Moutte <sebastien@moutte.net>
-
-	  tag: id3v2: use of GST_DEBUG instead of DEBUG(a...) for WIN32
-	  Original commit message from CVS:
-	  * ext\jpeg\smokecodec.c:
-	  use of GST_DEBUG instead of DEBUG(a...) for WIN32
-	  * ext\speex\gstspeexenc.c: (gst_speexenc_set_header_on_caps):
-	  move first instruction after all variables declarations
-	  * gst\alpha\gstalpha.c:
-	  * gst\effectv\gstshagadelic.c:
-	  * gst\smpte\paint.c:
-	  * gst\videofilter\gstvideobalance.c:
-	  define M_PI if it's not defined (it's not defined on WIN32)
-	  * gst\cutter\gstcutter.c: (gst_cutter_chain):
-	  * gst\id3demux\id3v2frames.c: (parse_relative_volume_adjustment_two):
-	  * gst\level\gstlevel.c: (gst_level_set_property), (gst_level_transform_ip):
-	  * gst\matroska\matroska-demux.c: (gst_matroska_demux_parse_info),
-	  (gst_matroska_demux_video_caps):
-	  * gst\matroska\matroska-mux.c: (gst_matroska_mux_start), (gst_matroska_mux_finish):
-	  * gst\wavparse\gstwavparse.c: (gst_wavparse_stream_data):
-	  use gst_guint64_to_gdouble for conversions
-	  * gst\goom\filters.c: (setPixelRGB_):
-	  fix a debug which was using undefined variable
-	  * gst\level\gstlevel.c: (gst_level_set_caps), (gst_level_transform_ip):
-	  * gst\matroska\ebml-read.c: (gst_ebml_read_sint):
-	  replace LL suffix with L suffix (LL isn't supported by MSVC6.0)
-	  * win32/vs6:
-	  add vs6 projects files for most of plugins-good
-
-2006-03-22 13:00:34 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: Don't attempt typefinding on too-short buffers that have been completely trimmed away.
-	  Original commit message from CVS:
-	  * gst/apetag/gsttagdemux.c: (gst_tag_demux_chain):
-	  * gst-libs/gst/tag/gstid3demux.c: (gst_id3demux_chain):
-	  Don't attempt typefinding on too-short buffers that have been
-	  completely trimmed away.
-	  * gst-libs/gst/tag/id3v2.c: (id3demux_read_id3v2_tag):
-	  Improve the debug output
-
-2006-03-16 16:06:22 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: We only care about gain and peak data for the master volume.
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c:
-	  (parse_relative_volume_adjustment_two):
-	  We only care about gain and peak data for the master volume.
-
-2006-03-16 13:22:28 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  tag: id3v2: Read replay gain tags
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (id3demux_id3v2_parse_frame),
-	  (parse_id_string), (parse_unique_file_identifier),
-	  (parse_relative_volume_adjustment_two), (id3v2_tag_to_taglist):
-	  Read replay gain tags (#323721).
-
-2006-03-14 17:56:02 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  configure.ac: Bump -base requirement to 0.10.5 for gst_tag_from_id3_user_tag(), used by id3demux.
-	  Original commit message from CVS:
-	  * configure.ac:
-	  Bump -base requirement to 0.10.5 for gst_tag_from_id3_user_tag(),
-	  used by id3demux.
-	  * gst-libs/gst/tag/gstid3demux.c: (plugin_init):
-	  * gst-libs/gst/tag/id3v2frames.c: (id3demux_id3v2_parse_frame),
-	  (parse_user_text_identification_frame),
-	  (parse_unique_file_identifier):
-	  Add support for UFID and TXXX frames and extract musicbrainz tags.
-
-2006-02-18 20:48:09 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: Handle 0 data size in otherwise valid frames.
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2.c: (id3demux_id3v2_frames_to_tag_list):
-	  * gst-libs/gst/tag/id3v2frames.c: (id3v2_genre_fields_to_taglist):
-	  Handle 0 data size in otherwise valid frames.
-	  Handle numeric strings in 2.4.0 even when not in parentheses
-
-2006-02-16 10:58:18 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: 3 2.3.0 used synch-safe integers for the tag size, but not for the frame size. (Fixes #331368)
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2.c: (id3demux_id3v2_frames_to_tag_list):
-	  ID3 2.3.0 used synch-safe integers for the tag size, but not for the
-	  frame size. (Fixes #331368)
-
-2006-02-13 12:00:51 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: Add more validation to ensure that a char encoding conversion produced a valid UTF-8 string.
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (parse_insert_string_field),
-	  (parse_split_strings):
-	  Add more validation to ensure that a char encoding conversion
-	  produced a valid UTF-8 string.
-
-2006-02-04 13:30:12 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: Adjust for data length indicators when parsing (Fixes #329810)
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (id3demux_id3v2_parse_frame),
-	  (parse_split_strings):
-	  Adjust for data length indicators when parsing (Fixes #329810)
-	  Fix stupid bug parsing UTF-8 tag text.
-	  Output tag strings with multiple fields as multiple tags, so the
-	  app gets all the data.
-
-2006-02-03 13:06:24 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: Never output a tag with a null contents string.
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (parse_text_identification_frame),
-	  (id3v2_tag_to_taglist), (id3v2_genre_string_to_taglist),
-	  (id3v2_genre_fields_to_taglist):
-	  Never output a tag with a null contents string.
-
-2006-01-30 23:13:05 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: Someone should kick my butt. Remove ID3v1 tags from the end of the file.
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/gstid3demux.c: (gst_id3demux_chain),
-	  (gst_id3demux_read_id3v1), (gst_id3demux_sink_activate),
-	  (gst_id3demux_send_tag_event):
-	  * gst-libs/gst/tag/id3v2.c: (id3demux_read_id3v1_tag):
-	  Someone should kick my butt. Remove ID3v1 tags from the end of the
-	  file.
-	  Improve error messages. Send the TAG message as soon as we complete
-	  typefinding, instead of waiting until we send the first buffer.
-	  Downstream tag event is still sent before the first buffer.
-
-2006-01-25 18:23:05 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: Never trust ANY information encoded in a media file, especially when it's giving you size...
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (id3demux_id3v2_parse_frame):
-	  Never trust ANY information encoded in a media file, especially
-	  when it's giving you sizes. (Fixes #328452)
-
-2006-01-23 14:32:47 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: Remove errant break statement, and fix compilation with older GCC.
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (id3v2_tag_to_taglist):
-	  Remove errant break statement, and fix compilation with
-	  older GCC.
-
-2006-01-23 09:22:17 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: Rewrite parsing of text tags to handle multiple NULL terminated strings. Parse numeric genre strings a...
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2.c: (id3demux_read_id3v2_tag):
-	  * gst-libs/gst/tag/id3v2.h:
-	  * gst-libs/gst/tag/id3v2frames.c: (id3demux_id3v2_parse_frame),
-	  (parse_comment_frame), (parse_text_identification_frame),
-	  (id3v2_tag_to_taglist), (id3v2_are_digits),
-	  (id3v2_genre_string_to_taglist), (id3v2_genre_fields_to_taglist),
-	  (parse_split_strings), (free_tag_strings):
-	  Rewrite parsing of text tags to handle multiple NULL terminated
-	  strings. Parse numeric genre strings and ID3v2 type
-	  "(3)(6)Alternative" style genre strings.
-	  Parse dates that are only YYYY or YYYY-mm format.
-
-2006-01-15 20:21:48 +0000  Sergey Scobich <sergey.scobich@gmail.com>
-
-	  tag: id3v2: Fix compilation of id3demux when zlib is not present.
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2frames.c: (id3demux_id3v2_parse_frame):
-	  Fix compilation of id3demux when zlib is not present.
-	  (Fixes #326602; patch by: Sergey Scobich)
-
-2006-01-06 11:46:53 +0000  Edward Hervey <bilboed@bilboed.com>
-
-	  tag: id3v2: Add gst_element_no_more_pads() for proper decodebin behaviour.
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/gstid3demux.c: (gst_id3demux_add_srcpad):
-	  Add gst_element_no_more_pads() for proper decodebin behaviour.
-	  * gst-libs/gst/tag/id3v2frames.c: (parse_comment_frame),
-	  (parse_text_identification_frame), (parse_split_strings):
-	  Failure to decode some tags is not a GST_ERROR() but a
-	  GST_WARNING()
-	  When iterating over a chunk of text, check that we haven't gone too
-	  far.
-
-2005-12-28 18:55:32 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: If a broken tag has 0 bytes payload, at least still skip the 10 byte header
-	  Original commit message from CVS:
-	  * gst-libs/gst/tag/id3v2.c: (id3demux_read_id3v2_tag):
-	  If a broken tag has 0 bytes payload, at least still skip
-	  the 10 byte header
-
-2005-12-18 15:14:44 +0000  Jan Schmidt <thaytan@mad.scientist.com>
-
-	  tag: id3v2: all new LGPL id3 demuxer, can use zlib for compressed frames
-	  Original commit message from CVS:
-	  * configure.ac:
-	  Check for optional dependency on zlib for id3demux
-	  * gst-libs/gst/tag/Makefile.am:
-	  * gst-libs/gst/tag/gstid3demux.c: (gst_gst_id3demux_get_type),
-	  (gst_id3demux_base_init), (gst_id3demux_class_init),
-	  (gst_id3demux_reset), (gst_id3demux_init), (gst_id3demux_dispose),
-	  (gst_id3demux_add_srcpad), (gst_id3demux_remove_srcpad),
-	  (gst_id3demux_trim_buffer), (gst_id3demux_chain),
-	  (gst_id3demux_set_property), (gst_id3demux_get_property),
-	  (id3demux_get_upstream_size), (gst_id3demux_srcpad_event),
-	  (gst_id3demux_read_id3v1), (gst_id3demux_read_id3v2),
-	  (gst_id3demux_sink_activate), (gst_id3demux_src_activate_pull),
-	  (gst_id3demux_src_checkgetrange), (gst_id3demux_read_range),
-	  (gst_id3demux_src_getrange), (gst_id3demux_change_state),
-	  (gst_id3demux_pad_query), (gst_id3demux_get_query_types),
-	  (simple_find_peek), (simple_find_suggest),
-	  (gst_id3demux_do_typefind), (gst_id3demux_send_tag_event),
-	  (plugin_init):
-	  * gst-libs/gst/tag/gstid3demux.h:
-	  * gst-libs/gst/tag/id3v2.c: (read_synch_uint),
-	  (id3demux_read_id3v1_tag), (id3demux_read_id3v2_tag),
-	  (id3demux_id3v2_frame_hdr_size), (convert_fid_to_v240),
-	  (id3demux_id3v2_frames_to_tag_list):
-	  * gst-libs/gst/tag/id3v2.h:
-	  * gst-libs/gst/tag/id3v2.4.0-frames.txt:
-	  * gst-libs/gst/tag/id3v2.4.0-structure.txt:
-	  * gst-libs/gst/tag/id3v2frames.c: (id3demux_id3v2_parse_frame),
-	  (parse_comment_frame), (parse_text_identification_frame),
-	  (id3v2_tag_to_taglist), (parse_split_strings):
-	  All new LGPL id3 demuxer. Can use zlib for compressed frames,
-	  otherwise it discards them. Works on my test files.
-	  * gst/wavparse/gstwavparse.c: (gst_wavparse_loop):
-	  Don't send EOS to a non-existing srcpad
-	  The debug category can be static
-
-2011-08-11 18:50:08 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/audioresample/gstaudioresample.c:
-	  audioresample: fix quality setting being ignored by the resampler state
-	  https://bugzilla.gnome.org/show_bug.cgi?id=636562
-
-2011-08-11 15:54:15 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* configure.ac:
-	* gst/audioresample/resample.c:
-	* gst/audioresample/resample_sse.h:
-	* gst/audioresample/speex_resampler_double.c:
-	* gst/audioresample/speex_resampler_float.c:
-	  audioresample: use SSE/SSE2 when possible
-	  Compile in the code on i386 and x86_64, and use ORC to determine
-	  when the runtime platform can run the code.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=636562
-
-2011-08-11 19:23:42 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/audioresample/resample_sse.h:
-	  audioresample: fix SSE2 building with double precision
-	  The full double implementation was missing.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=636562
-
-2011-08-11 12:12:07 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstexiftag.c:
-	  tag: exif: Check for utf8 before trying to convert
-	  If the string is already on utf8, there is no need to
-	  try to convert it, because it is useless and it might garble
-	  the string.
-
-2011-08-10 13:16:13 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* tests/check/libs/tag.c:
-	  tests: tag: exif: Add tests for 'non-trivial' chars
-	  Adds two new cases to check that characters are properly
-	  converted to ascii when writen to exif and parsed correctly
-	  back to utf8 when read.
-
-2011-08-09 16:02:28 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstexiftag.c:
-	  tag: exif: Exif strings should be ascii
-	  Use g_convert to turn all strings into extended ascii before writing
-	  to the exif buffer and converting back from ascii to utf8 when
-	  reading them.
-
-2011-08-10 15:57:02 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* win32/common/libgsttag.def:
-	  win32: update libgsttag.def for new API
-
-2011-08-10 15:21:41 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/Makefile.am:
-	  tag: don't build helper programs that generate/update data by default
-	  No point building these by default. Also, these generated files
-	  should go into the srcdir, not the builddir in this case, since
-	  they're version controlled.
-
-2011-08-10 15:20:37 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/mklicensestables.c:
-	  tag: fix stray printf in mklicensestables
-	  Don't dump debug output to stdout.
-
-2011-08-10 15:06:59 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/licenses.c:
-	  tag: fix compilation of new licenses code with GLib versions < 2.28
-	  Add local g_variant_lookup_value() fallback for now when compiling
-	  against older GLib versions.
-
-2011-08-10 14:57:14 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/tag/licenses.c:
-	* gst-libs/gst/tag/tag.h:
-	  tag: add GType for GstTagLicenseFlags
-	  API: gst_tag_license_flags_get_type()
-
-2011-08-10 10:49:38 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/subparse/gstsubparse.c:
-	  subparse: fix runtime warnings when doing position query
-	  Add missing 'break'.
-
-2011-07-15 13:19:38 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/Makefile.am:
-	* tests/check/libs/tag.c:
-	* tests/files/Makefile.am:
-	* tests/files/license-uris:
-	  tag: add unit test for new license API
-	  https://bugzilla.gnome.org/show_bug.cgi?id=646868
-
-2011-07-15 13:14:16 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* .gitignore:
-	* gst-libs/gst/tag/Makefile.am:
-	* gst-libs/gst/tag/mklicensestables.c:
-	  tag: add mklicensestables utility
-	  Add (uninstalled) tool to create licenses-table.dat from liblicense's
-	  RDF files. It's not very pretty and makes loats of assumptions about
-	  the input, but should work. If things change, we can fix it then.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=646868
-
-2011-07-15 13:07:55 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/Makefile.am:
-	* gst-libs/gst/tag/license-translations.dict:
-	* gst-libs/gst/tag/licenses-tables.dat:
-	* gst-libs/gst/tag/licenses.c:
-	* gst-libs/gst/tag/tag.h:
-	  tag: add convenience API to handle creative commons licenses
-	  Based on liblicense's RDF files.
-	  API: GstTagLicenseFlags
-	  API: gst_tag_get_licenses()
-	  API: gst_tag_get_license_flags()
-	  API: gst_tag_get_license_nick()
-	  API: gst_tag_get_license_title()
-	  API: gst_tag_get_license_version()
-	  API: gst_tag_get_license_description()
-	  API: gst_tag_get_license_jurisdiction()
-	  https://bugzilla.gnome.org/show_bug.cgi?id=646868
-
-2011-08-08 10:00:40 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/typefind/gsttypefindfunctions.c:
-	  typefind: bump probability if all frames we found are similar
-	  Similar meaning same layer, same bitrate, and same number of channels
-	  This fixes misdetection of (some MP3 files that have zero padding
-	  between the ID3 tag and the MP3 stream) as H.264 video.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656018
-
-2011-08-05 16:53:47 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstvorbistag.c:
-	  gstvorbistag: map ENCODER Vorbis comment to application-name
-	  What GStreamer calls encoder ("encoder used to encode this stream") is
-	  stored in the vendor string in Vorbis/Theora/Kate and possibly others.
-	  The Vorbis comment packet used in those streams uses ENCODER as the name
-	  of the encoding program, which GStreamer calls application-name.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656034
-
-2011-08-05 11:32:09 +0100  Vincent Penquerc'h <vincent.penquerch@collabora.co.uk>
-
-	* gst/volume/gstvolume.c:
-	  volume: fix sample depth typo
-	  https://bugzilla.gnome.org/show_bug.cgi?id=656022
-
-2011-08-05 13:05:43 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/volume/gstvolumeorc-dist.c:
-	  volume: Update disted ORC files
-
-2011-08-03 14:14:55 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst/encoding/gstencodebin.c:
-	  encodebin: Set queues to silent=true
-	  As encodebin doesn't connect to the queue signals, it can set
-	  queues to silent mode to make queue not emit them.
-	  Check https://bugzilla.gnome.org/show_bug.cgi?id=621299 for
-	  more info on queue's silent property.
-
-2011-08-03 13:40:19 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst/encoding/gstencodebin.c:
-	  encodebin: Fix typo on installing properties
-	  queue buffers and bytes properties have ids swapped, fix it.
-
-2011-08-03 10:18:29 +0200  Jonathan Liu <net147@gmail.com>
-
-	* ext/ogg/gstoggstream.c:
-	  oggstream: Fix crashes with 0-byte vorbis packets
-	  Fixes bug #655574.
-
-2011-07-28 14:43:53 +0200  Jens Georg <jensg@openismus.com>
-
-	* gst-libs/gst/pbutils/codec-utils.c:
-	  pbutils: Add SP levels 4a, 5 and 6
-	  https://bugzilla.gnome.org/show_bug.cgi?id=655503
-
-2011-07-26 16:10:17 +0200  Philip Jägenstedt <philipj@opera.com>
-
-	* ext/theora/gsttheoradec.c:
-	  theoradec: segfault on 0-byte ogg_packet in _chain_reverse
-
-2011-07-29 10:23:02 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/Makefile.am:
-	* win32/common/libgsttag.def:
-	  Add new GstTagMux base class
-	  Hook up new tag muxing base class to build system.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=555437
-	  API: GstTagMux
-
-2011-07-29 10:22:26 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-docs.sgml:
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/tag/gsttagmux.c:
-	* gst-libs/gst/tag/gsttagmux.h:
-	  docs: add documentation for GstTagMux
-
-2011-07-28 20:38:37 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/gsttagmux.c:
-	  tagmux: require subclass to install sink pad template
-	  Require the subclass to install both source and sink pad
-	  templates. Also, print some warnings if the subclass doesn't
-	  do that.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=555437
-
-2011-07-15 20:57:47 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/gsttagmux.h:
-	  tagmux: const-ify GstTagList argument of render vfuncs
-
-2011-07-15 20:39:20 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/gsttagmux.c:
-	* gst-libs/gst/tag/gsttagmux.h:
-	  tagmux: fix up private base class header so it can be made public
-	  Move private bits into a private struct, add some padding.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=555437
-
-2011-07-28 23:31:03 +0100  Michael Smith <msmith@songbirdnest.com>
-
-	* gst-libs/gst/tag/gsttagmux.c:
-	* gst-libs/gst/tag/gsttagmux.h:
-	  tagmux: add support for end tags
-	  Originally "id3tag: Add new id3 tagging plugin, supports v1, v2.3,
-	  and v2.4." from gst-plugins-bad. This is an artificial bridge commit.
-
-2010-06-06 18:00:22 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst-libs/gst/tag/gsttagmux.c:
-	  ext: Don't use GST_DEBUG_FUNCPTR for GObject vfuncs
-
-2007-11-20 11:41:13 +0000  Julien Moutte <julien@moutte.net>
-
-	  Fix build on Mac OS X 10.5
-	  Original commit message from CVS:
-	  2007-11-20  Julien MOUTTE  <julien@moutte.net>
-	  * gst-libs/gst/tag/gsttagmux.c: (gst_tag_lib_mux_render_tag),
-	  (gst_tag_lib_mux_adjust_event_offsets):
-	  * gst/qtdemux/qtdemux.c: (qtdemux_parse_theora_extension):
-	  * sys/osxaudio/Makefile.am:
-	  * sys/osxvideo/cocoawindow.h:
-	  * sys/osxvideo/cocoawindow.m: Fix build on Mac OS X 10.5
-
-2007-09-13 15:04:15 +0000  Sebastian Dröge <slomo@circular-chaos.org>
-
-	  Update my mail address.
-	  Original commit message from CVS:
-	  * ext/taglib/gstapev2mux.cc:
-	  * ext/taglib/gstapev2mux.h:
-	  * gst-libs/gst/tag/gsttagmux.c:
-	  * tests/check/elements/apev2mux.c:
-	  Update my mail address.
-
-2006-05-30 14:35:18 +0000  Sebastian Dröge <mail@slomosnail.de>
-
-	  Add apev2mux element (#343122).
-	  Original commit message from CVS:
-	  Patch by: Sebastian Dröge  <mail at slomosnail de >
-	  * docs/plugins/gst-plugins-good-plugins-docs.sgml:
-	  * docs/plugins/gst-plugins-good-plugins-sections.txt:
-	  * ext/taglib/Makefile.am:
-	  * ext/taglib/gstapev2mux.cc:
-	  * ext/taglib/gstapev2mux.h:
-	  * ext/taglib/gstid3v2mux.cc:
-	  * gst-libs/gst/tag/gsttagmux.c: (plugin_init):
-	  * gst-libs/gst/tag/gsttagmux.h:
-	  Add apev2mux element (#343122).
-	  * tests/check/Makefile.am:
-	  * tests/check/elements/apev2mux.c:
-	  (test_taglib_apev2mux_create_tags),
-	  (test_taglib_apev2mux_check_tags), (fill_mp3_buffer), (got_buffer),
-	  (demux_pad_added), (test_taglib_apev2mux_check_output_buffer),
-	  (test_taglib_apev2mux_with_tags), (GST_START_TEST),
-	  (apev2mux_suite), (main):
-	  Add unit test for apev2mux element.
-
-2006-05-18 12:46:08 +0000  James Doc Livingston <doclivingston@gmail.com>
-
-	  gst-libs/gst/tag/gsttagmux.c: Merge event tags and tag setter tags correctly (#339918). Also, don't leak taglist in case...
-	  Original commit message from CVS:
-	  Patch by: James "Doc" Livingston  <doclivingston gmail com>
-	  * gst-libs/gst/tag/gsttagmux.c: (gst_tag_lib_mux_render_tag):
-	  Merge event tags and tag setter tags correctly (#339918). Also,
-	  don't leak taglist in case of an error.
-
-2006-05-01 11:46:33 +0000  Thomas Vander Stichele <thomas@apestaart.org>
-
-	  docs/plugins/Makefile.am: also check .cc files for gtk-doc markup
-	  Original commit message from CVS:
-	  * docs/plugins/Makefile.am:
-	  also check .cc files for gtk-doc markup
-	  * configure.ac:
-	  * docs/plugins/gst-plugins-good-plugins-docs.sgml:
-	  * docs/plugins/gst-plugins-good-plugins-sections.txt:
-	  * tests/check/Makefile.am:
-	  * tests/check/elements/id3v2mux.c: (id3v2mux_suite), (main):
-	  * ext/Makefile.am:
-	  * ext/taglib/Makefile.am:
-	  * ext/taglib/gstid3v2mux.h:
-	  * gst-libs/gst/tag/gsttagmux.c:
-	  * gst-libs/gst/tag/gsttagmux.h:
-	  move taglib-based id3v2muxer to -good.  Fixes #336110.
-
-2006-04-30 16:16:59 +0000  Thomas Vander Stichele <thomas@apestaart.org>
-
-	* gst-libs/gst/tag/gsttagmux.c:
-	  small cleanups
-	  Original commit message from CVS:
-	  small cleanups
-
-2006-04-29 18:46:36 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  ext/taglib/gsttaglib.cc: Post an error message on the bus in the (extremely unlikely) case of an error.
-	  Original commit message from CVS:
-	  * ext/taglib/gsttaglib.cc:
-	  Post an error message on the bus in the (extremely unlikely)
-	  case of an error.
-
-2006-04-29 18:18:24 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  ext/taglib/: Split the actual ID3v2 tag rendering code into its own subclass.
-	  Original commit message from CVS:
-	  * ext/taglib/Makefile.am:
-	  * ext/taglib/gstid3v2mux.cc:
-	  * ext/taglib/gstid3v2mux.h:
-	  * ext/taglib/gsttaglib.cc:
-	  * ext/taglib/gsttaglib.h:
-	  Split the actual ID3v2 tag rendering code into
-	  its own subclass.
-
-2006-04-28 15:33:09 +0000  Thomas Vander Stichele <thomas@apestaart.org>
-
-	* gst-libs/gst/tag/gsttagmux.c:
-	* gst-libs/gst/tag/gsttagmux.h:
-	  pedantic cleanups
-	  Original commit message from CVS:
-	  pedantic cleanups
-
-2006-04-01 16:50:49 +0000  Thomas Vander Stichele <thomas@apestaart.org>
-
-	* gst-libs/gst/tag/gsttagmux.c:
-	  add taglib checks and docs
-	  Original commit message from CVS:
-	  add taglib checks and docs
-
-2006-03-26 19:56:37 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  ext/taglib/gsttaglib.*: Fix newsegment event handling a bit. We need to cache the first newsegment event, because we ...
-	  Original commit message from CVS:
-	  * ext/taglib/gsttaglib.cc:
-	  * ext/taglib/gsttaglib.h:
-	  Fix newsegment event handling a bit. We need to
-	  cache the first newsegment event, because we can't
-	  adjust offsets yet when we get it, as we don't
-	  know the size of the tag yet for sure at that point.
-	  Also do some minor cleaning up here and there and add
-	  some debug statements.
-
-2006-03-25 21:57:24 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  ext/taglib/gsttaglib.cc: We do not want to proxy the caps on the sink pad; our source pad should have application/x-i...
-	  Original commit message from CVS:
-	  * ext/taglib/gsttaglib.cc:
-	  We do not want to proxy the caps on the sink pad; our
-	  source pad should have application/x-id3 caps; also,
-	  don't use already-freed strings in debug messages;
-	  finally, adjust buffer offsets on buffers sent out.
-
-2006-03-20 08:59:29 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  ext/taglib/gsttaglib.h: Fix left-over gst_my_filter_get_type.
-	  Original commit message from CVS:
-	  * ext/taglib/gsttaglib.h:
-	  Fix left-over gst_my_filter_get_type.
-
-2006-03-13 17:22:19 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  ext/taglib/gsttaglib.cc: Add gtk-doc blurb (unused for the time being); match registered plugin name to the filename ...
-	  Original commit message from CVS:
-	  * ext/taglib/gsttaglib.cc:
-	  Add gtk-doc blurb (unused for the time being); match registered
-	  plugin name to the filename of the plugin (taglibmux => taglib)
-
-2006-03-12 15:02:02 +0000  Tim-Philipp Müller <tim@centricular.net>
-
-	  ext/taglib/: Add support for writing MusicBrainz IDs.
-	  Original commit message from CVS:
-	  * ext/taglib/Makefile.am:
-	  * ext/taglib/gsttaglib.cc:
-	  * ext/taglib/gsttaglib.h:
-	  Add support for writing MusicBrainz IDs.
-
-2006-03-11 10:58:08 +0000  Alex Lancaster <alexlan@fedoraproject.org>
-
-	  ext/taglib/gsttaglib.cc: and add support for TCOP (copyright)
-	  Original commit message from CVS:
-	  2006-03-11  Christophe Fergeau  <teuf@gnome.org>
-	  Patch by: Alex Lancaster
-	  * ext/taglib/gsttaglib.cc: fix writing of TPOS tags (album number),
-	  and add support for TCOP (copyright)
-
-2006-03-09 17:44:17 +0000  Christophe Fergeau <teuf@gnome.org>
-
-	  new id3v2 muxer based on TagLib
-	  Original commit message from CVS:
-	  2006-03-09  Christophe Fergeau  <teuf@gnome.org>
-	  reviewed by: Tim-Philipp Müller  <tim at centricular dot net>
-	  * configure.ac:
-	  * ext/Makefile.am:
-	  * ext/taglib/Makefile.am:
-	  * ext/taglib/gsttaglib.cc:
-	  * ext/taglib/gsttaglib.h: new id3v2 muxer based on TagLib
-
-2011-07-28 11:21:26 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst/encoding/gstencodebin.c:
-	  encodebin: rename flags names
-	  Rename flags names from native-audio/-video to
-	  no-audio/video-conversion to be more explicit on what it does
-
-2011-07-20 18:10:57 +0200  Stefan Sauer <ensonic@google.com>
-
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	  baseaudiosink: fix latency calculation for live elements
-	  Max_latency was computed on already adjusted min_latency. Introduce a new
-	  variable for clarity. Spotted by Blaise Gassend.
-	  Fixes #644284
-
-2011-07-28 11:44:20 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	  baseaudiosink: fix max latency calculation
-	  ... to allow infinite max, as also claimed by comment.
-
-2011-06-01 10:21:39 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	  baseaudiosink: drop samples that are too late
-	  ... rather than having all of them rendered at 0 or subsequently aligned,
-	  likely inevitably leading to repeated resyncing.
-
-2011-07-26 13:51:31 +0200  Stefan Sauer <ensonic@google.com>
-
-	* tests/check/pipelines/basetime.c:
-	  basetime: fix failing test
-	  Always use audiotestsrc as it seems to have been the intention according to the
-	  comment header. The test does not work with live-audiosources.
-
-2011-07-25 19:51:24 +0200  Stefan Kost <ensonic@users.sf.net>
-
-	* tests/check/elements/playbin2-compressed.c:
-	  tests: rename the test suite to match the binary
-	  This unbreaks determining the name for make elements/playbin2-compressed.check
-	  from the test output.
-
-2011-07-25 19:39:55 +0200  Stefan Kost <ensonic@users.sf.net>
-
-	* gst/adder/gstadder.c:
-	* gst/adder/gstadder.h:
-	  adder: rework pending event handling
-	  Use atomic ops on pending flags. Rename the segment_pending to
-	  new_segment_pending. Set new_segment_pending not when we received seek, but
-	  when we received the first upstream new_segment.
-
-2011-07-25 19:11:59 +0200  Stefan Kost <ensonic@users.sf.net>
-
-	* gst/adder/gstadder.c:
-	  adder: more debug logging for events
-
-2011-07-26 12:33:56 +0200  Edward Hervey <edward.hervey@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Allow all EOS to go through if we don't have a next group
-	  Only drop them if the current group isn't drained .. AND there is a
-	  next group to switch to.
-	  Should Fix #655268
-
-2011-07-25 18:37:15 +0200  Edward Hervey <edward.hervey@collabora.co.uk>
-
-	* gst/playback/gstplaybin2.c:
-	  playbin2: Avoid resetting playsink when not needed
-	  When we don't have specific {audio|video|text}-sink properties, don't
-	  set them on playsink when reconfiguring.
-	  If we do that, we end up setting the previous configured sink to
-	  GST_STATE_NULL resulting in any potentially pending push being returned
-	  with GST_FLOW_WRONG_STATE which will cause the upstream elements to
-	  silently stop.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=655279
-
-2011-07-25 12:04:02 +0200  Stefan Sauer <ensonic@google.com>
-
-	* ext/pango/gsttextoverlay.c:
-	  textoverlay: improve the example
-	  Mentioned that this is not ment to be used with subtitles and suggest alternatives.
-
-2011-07-25 10:41:04 +0200  Edward Hervey <edward.hervey@collabora.co.uk>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: Properly handle multi-stream chains
-	  When we have a multi-stream (i.e. audio and video) input and the demuxer
-	  adds/removes pads for a new stream (common in a mpeg-ts stream when the
-	  program stream mapping is updated), the algorithm for EOS handling was
-	  previously wrong (it would only drop the EOS of the *last* pad but would
-	  let the EOS on the other pads go through).
-	  The logic has only been changed a tiny bit for EOS handling resulting in:
-	  * If there is no next group, let the EOS go through
-	  * If there is a next group, but not all pads are drained in the active
-	  group, drop the EOS event
-	  * If there is a next group and all pads are drained, then the ghostpads
-	  will be removed and the EOS event will be dropped automatically.
-
-2011-07-23 14:21:27 +0200  Stefan Sauer <ensonic@google.com>
-
-	* ext/pango/gsttextoverlay.c:
-	  textoverlay: add example for feeding from stdin
-
-2011-07-23 13:46:31 +0200  Stefan Sauer <ensonic@google.com>
-
-	* tests/check/pipelines/basetime.c:
-	  test: print actual timestamp on failure
-
-2011-07-20 13:46:31 +0200  Stefan Sauer <ensonic@google.com>
-
-	* ext/pango/gsttextoverlay.c:
-	  textoverlay: keep untimestamped textbuffer until next one
-	  Instead of discarding untimestamped text-buffers immeditely after rendering,
-	  keep them until we receive the next text buffer.
-	  Fixes #654959
-
-2011-07-15 16:46:54 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/elements/decodebin2.c:
-	  tests: add decodebin2 test for parser autoplugging
-	  Make sure decodebin2 doesn't try to plug the same parser twice
-	  in a row.
-
-2011-07-06 19:40:48 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/elements/decodebin.c:
-	* tests/files/Makefile.am:
-	* tests/files/test.mp3:
-	  tests: add decodebin1 test for parser autoplugging
-	  Make sure decodebin1 doesn't try to plug the same parser twice
-	  in a row (so we can change all parsers to accept parsed input as
-	  well without breaking applications still using the old decodebin1
-	  element).
-
-2011-07-07 15:02:19 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/playback/gstdecodebin.c:
-	  decodebin: don't plug the same parser multiple times in a row
-	  This allows us to make parsers accept both parsed and unparsed input
-	  without decodebin plugging them in a loop until things blow up, ie.
-	  without affecting applications that still use the old playbin or the
-	  old decodebin.
-	  (Making parsers accept parsed input is useful for later when we want
-	  to use parsers to convert the stream-format into something the decoder
-	  can handle. It's also much more convenient for application authors
-	  who can plug parsers unconditionally in transcoding pipelines, for
-	  example).
-
-2011-07-14 13:56:02 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/pbutils/codec-utils.c:
-	* win32/common/libgstpbutils.def:
-	  docs: add Since marker to gtk-doc chunk for new codec utils API
-	  And add new API to .def file.
-	  API: gst_codec_utils_h264_get_level_idc()
-
-2011-03-07 17:55:48 -0500  Olivier Crête <olivier.crete@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/pbutils/codec-utils.c:
-	* gst-libs/gst/pbutils/codec-utils.h:
-	  codec-utils: Add method to convert H.264 text level in a level_idc
-
-2011-07-09 18:33:38 -0700  David Schleef <ds@schleef.org>
-
-	* ext/ogg/gstoggmux.c:
-	  oggmux: check for EOS on both current and best pad
-	  Oops, need both.  Fixes #654270.
-
-2011-07-09 18:24:26 -0700  David Schleef <ds@schleef.org>
-
-	* ext/ogg/gstoggmux.c:
-	  oggmux: check for EOS on current pad, not best
-	  Fixes #654270.
-
-2011-07-09 11:59:42 +0200  Piotr Fusik <fox@scene.pl>
-
-	* gst/typefind/gsttypefindfunctions.c:
-	  typefind: fixed detection of audio/x-sap
-	  Fixes: #654295.
-	  Signed-off-by: David Schleef <ds@schleef.org>
-
-2011-06-30 20:33:36 +0200  Luis de Bethencourt <luis@debethencourt.com>
-
-	* gst/encoding/gstencodebin.c:
-	  encodebin: fix compiler warning
-	  cspace and cspace2 may run uninitialized.
-
-2011-06-29 13:12:49 +0200  Robert Swain <robert.swain@collabora.co.uk>
-
-	* gst/encoding/gstencodebin.c:
-	  encodebin: Add flags to disable conversion elements
-	  Add a flags property and two flags to allow one to disable the
-	  conversion elements within encodebin. Doing so insists that the
-	  uncompressed input to encodebin for the appropriate stream type is
-	  sufficient to meet the caps requirements of the encoders, muxers and
-	  encodebin target.
-	  This is mostly beneficial to bypass slow caps negotiations in the
-	  conversion elements.
-
-2011-06-29 09:59:05 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstxmptag.c:
-	* tests/check/libs/tag.c:
-	  tag: xmp: Remove extra chars from end of xmp packet
-	  Windows picture viewer is unhappy with extra trailing chars at the
-	  end of the xmppacket footer. So remove them as they aren't needed.
-
-2011-06-29 11:30:51 +0200  Robert Swain <robert.swain@collabora.co.uk>
-
-	* gst/encoding/gststreamsplitter.c:
-	  streamsplitter: Fix getcaps src pad caps merge
-	  Caps returned from gst_pad_peer_get_caps_reffed () may not be writable.
-	  If they are not is should cause an assertion in gst_caps_merge (),
-	  however, sometimes assertions are disabled in binary builds of -base and
-	  it's safer to just be sure the caps are writable. Also, check that the
-	  reffed caps pointer is not NULL.
-
-2011-06-15 13:51:31 +0200  Philip Jägenstedt <philipj@opera.com>
-
-	* gst/typefind/gsttypefindfunctions.c:
-	  typefind: NULL check in degas_type_find
-	  The length check isn't sufficient, an source might
-	  report the correct length, but then still fail to
-	  read the requested number of bytes for some reason.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=652642
-
-2011-06-26 01:06:58 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* docs/design/design-decodebin.txt:
-	  docs: minor addition to decodebin2 design doc
-
-2011-06-26 01:06:19 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/libs/navigation.c:
-	  tests: the navigation interface isn't GstImplementsInterface-wrapped
-
-2011-06-26 00:49:46 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/interfaces/streamvolume.h:
-	  interfaces: GstStreamVolume isn't wrapped by GstImplementsInterface
-	  This interface depends on properties and isn't per-instance.
-
-2011-06-26 00:40:20 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/rtsp/gstrtspextension.h:
-	  rtsp: GstRTSPExtension isn't wrapped by GstImplementsInterface
-	  Fix copy'n'paste error in headers, GstRTSPExtension isn't
-	  something that's per-instance.
-
-2011-06-26 00:36:36 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/xmpwriter.h:
-	  tag: GstXmpWriter doesn't use the GstImplementsInterface
-	  No need for per-instance checking of interface implementation here,
-	  presumably just a copy'n'paste issue.
-
-2011-06-11 19:03:57 +1000  Jonathan Matthew <jonathan@d14n.org>
-
-	* gst-libs/gst/pbutils/encoding-target.c:
-	  encoding-target: set names on audio and video profiles
-	  https://bugzilla.gnome.org/show_bug.cgi?id=652342
-
-2011-06-23 11:28:04 -0700  David Schleef <ds@schleef.org>
-
-	* common:
-	  Automatic update of common submodule
-	  From 69b981f to 605cd9a
-
-2011-06-18 13:32:17 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	  Bump git version after unplanned 0.10.35 release
-	  Merge branch '0.10.35'
-	  Conflicts:
-	  configure.ac
-	  docs/plugins/inspect/plugin-adder.xml
-	  docs/plugins/inspect/plugin-alsa.xml
-	  docs/plugins/inspect/plugin-app.xml
-	  docs/plugins/inspect/plugin-audioconvert.xml
-	  docs/plugins/inspect/plugin-audiorate.xml
-	  docs/plugins/inspect/plugin-audioresample.xml
-	  docs/plugins/inspect/plugin-audiotestsrc.xml
-	  docs/plugins/inspect/plugin-cdparanoia.xml
-	  docs/plugins/inspect/plugin-decodebin.xml
-	  docs/plugins/inspect/plugin-encoding.xml
-	  docs/plugins/inspect/plugin-ffmpegcolorspace.xml
-	  docs/plugins/inspect/plugin-gdp.xml
-	  docs/plugins/inspect/plugin-gio.xml
-	  docs/plugins/inspect/plugin-gnomevfs.xml
-	  docs/plugins/inspect/plugin-libvisual.xml
-	  docs/plugins/inspect/plugin-ogg.xml
-	  docs/plugins/inspect/plugin-pango.xml
-	  docs/plugins/inspect/plugin-playback.xml
-	  docs/plugins/inspect/plugin-subparse.xml
-	  docs/plugins/inspect/plugin-tcp.xml
-	  docs/plugins/inspect/plugin-theora.xml
-	  docs/plugins/inspect/plugin-typefindfunctions.xml
-	  docs/plugins/inspect/plugin-uridecodebin.xml
-	  docs/plugins/inspect/plugin-videorate.xml
-	  docs/plugins/inspect/plugin-videoscale.xml
-	  docs/plugins/inspect/plugin-videotestsrc.xml
-	  docs/plugins/inspect/plugin-volume.xml
-	  docs/plugins/inspect/plugin-vorbis.xml
-	  docs/plugins/inspect/plugin-ximagesink.xml
-	  docs/plugins/inspect/plugin-xvimagesink.xml
-	  gst-libs/gst/audio/Makefile.am
-	  gst/subparse/gstsubparse.c
-	  win32/common/_stdint.h
-	  win32/common/config.h
-
-2011-06-18 11:16:19 +0200  Edward Hervey <bilboed@bilboed.com>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  discoverer: Allow GError* argument to be NULL
-	  This is how other methods taking GError* arguments behave.
-	  Fixes #652838
-
-=== release 0.10.35 ===
-
-2011-06-15 19:29:48 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	  Release 0.10.35
-	  This is an ad-hoc release that is almost identical to 0.10.34:
-	  * work around GLib atomic ops API change
-	  * don't use G_CONST_RETURN in public headers
-	  * subparse: typefinding fixes for subtitles in non-UTF8 charsets
-
-2011-06-15 15:08:32 +0100  Christian Fredrik Kalager Schaller <christian.schaller@collabora.co.uk>
-
-	* gst-plugins-base.spec.in:
-	  Add gobject introspection files to spec
-
-2011-06-15 14:53:56 +0100  Christian Fredrik Kalager Schaller <christian.schaller@collabora.co.uk>
-
-	* gst-plugins-base.spec.in:
-	  remove old v4l plugin from spec file
-
-2011-06-15 14:49:41 +0100  Christian Fredrik Kalager Schaller <christian.schaller@collabora.co.uk>
-
-	* tests/examples/Makefile.am:
-	  Add missing dist subdir
-
-2011-06-15 14:21:30 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/audio/Makefile.am:
-	  audio: link test program against libgstaudio
-
-2011-06-14 10:31:18 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst-libs/gst/pbutils/codec-utils.c:
-	  codec-utils: restore 7350 as a valid sampling frequency for AAC
-	  This was lost during c77f88cac675a1dbb89e40da8e3c28320523bfca.
-
-2011-06-09 18:30:33 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstid3tag.c:
-	* gst-libs/gst/tag/gstvorbistag.c:
-	* gst-libs/gst/tag/tag.h:
-	  libs: replace G_CONST_RETURN with 'const'
-	  G_CONST_RETURN will be deprecated soon.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=652211
-
-2011-05-31 22:14:09 -0700  David Schleef <ds@schleef.org>
-
-	* gst/audioresample/resample.c:
-	* gst/audiotestsrc/gstaudiotestsrc.c:
-	* gst/videoscale/vs_4tap.c:
-	* gst/videotestsrc/generate_sine_table.c:
-	* gst/videotestsrc/videotestsrc.c:
-	* tests/icles/test-xoverlay.c:
-	  convert M_PI to G_PI, for msvc
-
-2011-06-06 14:41:41 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/tag/gsttagdemux.c:
-	  tagdemux: no input data implies no type can be found
-	  ... and posting a proper error message to this effect is appropriately
-	  informative and prevents auto-plugging otherwise stalling.
-
-2011-06-04 13:36:55 -0700  David Schleef <ds@schleef.org>
-
-	* gst/adder/gstadder.c:
-	  adder: Work around changes in g_atomic API
-	  See #651514 for details.
-
-2011-05-31 20:38:56 -0700  David Schleef <ds@schleef.org>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  discoverer: fix c99-ism
-
-2011-05-23 16:02:34 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/subparse/gstsubparse.c:
-	  subparse: Try to typefind even if conversion to UTF8 failed
-	  Fixes bug #600043.
-
-2011-05-23 15:51:14 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/subparse/gstsubparse.c:
-	  subparse: Interprete typefind strings passed to GRegex as raw bytes instead of valid UTF8
-
-2011-05-20 10:48:39 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/tag/lang.c:
-	  lang: fix possible array overrun
-	  We where checking for i<G_N_ELEMENTS, but where accessing i+1.
-
-2011-06-14 10:31:18 +0530  Debarshi Ray <rishi@gnu.org>
-
-	* gst-libs/gst/pbutils/codec-utils.c:
-	  codec-utils: restore 7350 as a valid sampling frequency for AAC
-	  This was lost during c77f88cac675a1dbb89e40da8e3c28320523bfca.
-
-2011-05-31 22:14:09 -0700  David Schleef <ds@schleef.org>
-
-	* gst/audioresample/resample.c:
-	* gst/audiotestsrc/gstaudiotestsrc.c:
-	* gst/videoscale/vs_4tap.c:
-	* gst/videotestsrc/generate_sine_table.c:
-	* gst/videotestsrc/videotestsrc.c:
-	* tests/icles/test-xoverlay.c:
-	  convert M_PI to G_PI, for msvc
-
-2011-06-07 21:30:18 -0700  David Schleef <ds@schleef.org>
-
-	* ext/ogg/gstoggmux.c:
-	* ext/ogg/gstoggmux.h:
-	  oggmux: refactor how EOS is determined
-	  This decreases the number of buffers held on each pad by one,
-	  eliminating next_buffer.  Simplifies the logic by relying solely
-	  on CollectPads to let us know when a pad is in EOS.  As a side
-	  benefit, the collect pads related code is structured more like
-	  other CollectPad users.
-	  The previous code would occasionally mark the wrong pad as EOS,
-	  causing the code to get in a state where all the streams were
-	  finished, but EOS hadn't been sent to the source pad.
-
-2011-06-09 18:30:33 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstid3tag.c:
-	* gst-libs/gst/tag/gstvorbistag.c:
-	* gst-libs/gst/tag/tag.h:
-	  libs: replace G_CONST_RETURN with 'const'
-	  G_CONST_RETURN will be deprecated soon.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=652211
-
-2011-06-09 00:02:07 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstxmptag.c:
-	  tag: xmp: Fix LocationShown syntax
-	  According to the specification, the LocationShown requires its
-	  struct fields to be inside a Bag type.
-
-2011-06-08 14:21:40 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstxmptag.c:
-	  tag: xmp: Add room for extra namespace definitions
-	  Adds an extra field to the namespace definitions of the schemas
-	  so they can add the namespace of any array/struct fields they
-	  might use internally.
-
-2011-06-08 12:21:43 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/pango/Makefile.am:
-	* gst/audioresample/Makefile.am:
-	* tests/check/Makefile.am:
-	* tests/examples/v4l/Makefile.am:
-	  GST_PLUGINS_BASE_LIBS is not defined in -base.
-
-2011-06-08 11:33:07 +0200  Christophe Fergeau <cfergeau@redhat.com>
-
-	* tests/examples/audio/Makefile.am:
-	  examples: don't link testchannels example with system libgstaudio
-	  The testchannels audio test program is using -lgstaudio-0.10 to link
-	  with libgstaudio which won't use the gstaudio library that was just
-	  built but the one from the system. This is an issue since it means
-	  we won't be testing the code from the current source tree, and it
-	  also breaks the build when building on a system which don't have
-	  a libgstaudio yet.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=652100
-
-2011-06-08 11:11:05 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* docs/design/design-decodebin.txt:
-	  docs: add some text about parser/decoder autoplugging issues
-
-2011-06-06 14:41:41 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst-libs/gst/tag/gsttagdemux.c:
-	  tagdemux: no input data implies no type can be found
-	  ... and posting a proper error message to this effect is appropriately
-	  informative and prevents auto-plugging otherwise stalling.
-
-2011-06-06 12:48:23 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/ogg/gstoggmux.c:
-	* ext/ogg/gstoggmux.h:
-	  oggmux: determine granulepos metadata using stream mapper whenever possible
-	  ... which unfortunately is not the case for all types, but at least so for
-	  most common ones.
-
-2011-06-06 12:46:05 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/ogg/gstoggmux.c:
-	  oggmux: convert incoming buffer timestamp to running time
-	  ... so all subsequent manipulation can take place in the proper timeline
-	  without further ado.
-
-2011-06-01 20:48:44 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* ext/ogg/gstoggmux.c:
-	  oggmux: remove superfluous code
-	  ... since there is nothing in oggstream that cares (or even should)
-	  about granulepos for what is being asked from it.
-
-2011-06-04 13:36:55 -0700  David Schleef <ds@schleef.org>
-
-	* gst/adder/gstadder.c:
-	  adder: Work around changes in g_atomic API
-	  See #651514 for details.
-
-2011-05-31 20:38:56 -0700  David Schleef <ds@schleef.org>
-
-	* gst-libs/gst/pbutils/gstdiscoverer.c:
-	  discoverer: fix c99-ism
-
-2011-06-03 16:29:00 +0200  Luis de Bethencourt <luis.debethencourt@collabora.como>
-
-	* ext/theora/gsttheoraenc.c:
-	  theora: separate encode and push block in chain, into own function.
-
-2011-06-02 19:08:41 +0200  Luis de Bethencourt <luis.debethencourt@collabora.como>
-
-	* ext/theora/gsttheoraenc.c:
-	  theora: use fixed src cap pads
-
-2011-06-02 18:57:05 +0200  Luis de Bethencourt <luis.debethencourt@collabora.como>
-
-	* ext/theora/gsttheoraenc.c:
-	* ext/theora/gsttheoraenc.h:
-	  theora: set the width/height/par on the srcpad caps
-
-2011-06-02 17:29:53 +0200  Luis de Bethencourt <luis.debethencourt@collabora.como>
-
-	* ext/theora/gsttheoraenc.c:
-	  theora: get sink caps info from downstream element pad
-	  https://bugzilla.gnome.org/show_bug.cgi?id=651564
-
-2011-05-27 14:41:39 -0700  Patrick McCarty <patrick.mccarty@intel.com>
-
-	* gst-libs/gst/pbutils/descriptions.c:
-	  pbutils: add description for wbmp images.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=651294
-
-2011-06-02 00:55:41 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst/typefind/gsttypefindfunctions.c:
-	  typefinding: add typefinder for WAP WBMP bitmaps
-	  https://bugzilla.gnome.org/show_bug.cgi?id=651294
-
-2011-06-02 11:53:10 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysinkaudioconvert.c:
-	* gst/playback/gstplaysinkvideoconvert.c:
-	  playsink: Fix deadlock in the audio/video converter bins when linking fails
-
-2011-06-01 17:31:35 +0200  Edward Hervey <edward.hervey@collabora.co.uk>
-
-	* tests/check/Makefile.am:
-	  check: ... and don't forget to add the new arm header
-	  Forgot it in my previous commit
-
-2011-06-01 17:24:30 +0200  Edward Hervey <edward.hervey@collabora.co.uk>
-
-	* tests/check/libs/libsabi.c:
-	* tests/check/libs/struct_arm.h:
-	  libsabi: Add structure sizes for arm
-
-2011-05-31 19:57:57 -0700  David Schleef <ds@schleef.org>
-
-	* gst-libs/gst/fft/gstfftf32.c:
-	* gst-libs/gst/fft/gstfftf64.c:
-	* gst-libs/gst/fft/gstffts16.c:
-	* gst-libs/gst/fft/gstffts32.c:
-	  fft: s/M_PI/G_PI/ for MSVC
-
-2011-05-31 11:05:03 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/volume/gstvolume.c:
-	* gst/volume/gstvolumeorc.orc:
-	* tests/check/elements/volume.c:
-	  volume: Fix handling of volume>=4.0 for 8 and 16 bit integer formats
-	  Also add a unit test for this. Previously volumes bigger than 4.0
-	  would have resulted in overflows in the fixed point processing.
-	  Fixes bug #649642.
-
-2011-05-29 13:32:04 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/check/elements/adder.c:
-	* tests/check/elements/ffmpegcolorspace.c:
-	* tests/check/elements/vorbistag.c:
-	* tests/check/libs/rtp.c:
-	* tests/check/pipelines/theoraenc.c:
-	  tests: fix some more unused-but-set-variable warnings with gcc 4.6
-
-2011-05-28 16:14:23 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* win32/common/libgstvideo.def:
-	  win32: update .def file for new API
-
-2011-05-28 12:39:06 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* Makefile.am:
-	* tests/check/elements/.gitignore:
-	  Ignore new playbin2-compress test binary
-	  And add old testchannels binary to CRUFT_FILES.
-
-2011-05-27 23:31:27 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/video/video.h:
-	  video: sprinkle some G_GNUC_CONST
-	  Mark functions that have no effect besides their return value and
-	  only inspect their input arguments with G_GNUC_CONST. (We just
-	  ignore the g_return_val_if_fail() guards for this)
-
-2011-05-27 23:25:00 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* gst-libs/gst/video/video.h:
-	  video: clean up header file
-	  Sprinkle some spaces and newlines here and there.
-
-2011-05-27 15:03:19 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* configure.ac:
-	* gst-libs/gst/audio/.gitignore:
-	* gst-libs/gst/audio/Makefile.am:
-	* gst-libs/gst/audio/testchannels.c:
-	* tests/examples/Makefile.am:
-	* tests/examples/audio/.gitignore:
-	* tests/examples/audio/Makefile.am:
-	* tests/examples/audio/testchannels.c:
-	  audio: move testchannels example to 'tests/examples' dir
-	  Also fix it up a little to not include 'c' file but link to the libs instead.
-
-2011-05-27 11:39:21 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/pbutils/codec-utils.c:
-	  code-utile: fix level descriptions for fgs
-	  fgs levels range from 8-13 and are mapped to 0-5.
-
-2011-05-25 14:38:21 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/pbutils/codec-utils.c:
-	  codec-utils: fix mpeg4 level verification
-	  The current condition would never be true. As levels<6 are asp and levels>7 and
-	  <14 are fgs, we should return NULL for cases 6,7,14,15.
-
-2011-05-26 12:33:08 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* sys/xvimage/xvimagesink.c:
-	  xvimagesink: Fallback to non-XShm mode if allocating the XShm image failed
-	  Fixes bug #630442.
-
-2011-05-26 12:30:31 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* sys/ximage/ximagesink.c:
-	  ximagesink: Fallback to non-XShm mode if allocating the XShm image failed
-	  Fixes bug #630442.
-
-2011-05-26 11:41:50 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaybin2.c:
-	  playbin2: Let the input-selectors sync all streams to the running time
-	  This is especially needed when switching between a non-sparse and sparse
-	  video stream, see bug #537382. It also lowers the time needed for switching
-	  between streams a bit.
-
-2011-01-20 00:52:50 -0700  Lane Brooks <dirjud@gmail.com>
-
-	* ext/pango/gsttextoverlay.c:
-	* ext/pango/gsttextoverlay.h:
-	  textoverlay: added 'outline-color' parameter to control whether text gets a shadow
-
-2011-01-20 00:42:39 -0700  Lane Brooks <dirjud@gmail.com>
-
-	* ext/pango/gsttextoverlay.c:
-	* ext/pango/gsttextoverlay.h:
-	  textoverlay: added 'shadow' option to control whether text gets a shadow
-
-2011-05-26 10:48:05 +0200  Jindrich Makovicka <makovick@gmail.com>
-
-	* ext/pango/gsttextrender.c:
-	  textrender: Correctly negotiate with downstream instead of just using random caps
-	  Fixes bug #638897.
-
-2011-05-26 10:43:51 +0200  Jindrich Makovicka <makovick@gmail.com>
-
-	* ext/pango/gsttextrender.c:
-	  textrender: Add bound checks to not write outside the image area
-
-2011-05-26 10:42:46 +0200  Jindrich Makovicka <makovick@gmail.com>
-
-	* ext/pango/gsttextrender.c:
-	  textrender: Prevent double unref of caps if the caps can't be set on the srcpad
-
-2011-05-26 10:31:11 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* ext/gnomevfs/gstgnomevfssrc.c:
-	  gnomevfssrc: Keep track of interruptions during read with a flag
-
-2010-09-03 09:11:30 -0400  American Dynamics <GStreamer-Bugs@tycosp.com>
-
-	* ext/gnomevfs/gstgnomevfssrc.c:
-	* ext/gnomevfs/gstgnomevfssrc.h:
-	  gnomevfssrc: Add support for cancelling the read operations
-	  This allows the state change from PAUSED to READY to be faster.
-	  Fixes bug #628337.
-
-2011-05-25 14:14:46 +0300  Sreerenj Balachandran <sreerenj.balachandran@intel.com>
-
-	* sys/ximage/ximagesink.c:
-	  ximagesink: Remove g_assert from interface query
-
-2011-05-25 14:08:43 +0300  Sreerenj Balachandran <sreerenj.balachandran@intel.com>
-
-	* sys/xvimage/xvimagesink.c:
-	  xvimagesink: Remove the g_assert from interface query
-
-2011-05-26 00:17:40 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst/audiotestsrc/gstaudiotestsrc.c:
-	* gst/audiotestsrc/gstaudiotestsrc.h:
-	  audiotestsrc: add blue and violet noise by using spectral inversion
-	  Add blue and violet noise by spectral inversion of pink and red noise.
-	  Fixes #649969
-
-2011-05-25 23:40:26 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst/audiotestsrc/gstaudiotestsrc.c:
-	* gst/audiotestsrc/gstaudiotestsrc.h:
-	  audiotestsrc: add red (brownian) noise generator
-	  Add another noise generator which produces a quite dark noise color.
-	  Fixes parts of #649969.
-
-2010-09-27 13:32:31 +0400  Vladimir Eremeev <eremeev@atlantis.ru>
-
-	* tests/examples/seek/seek.c:
-	  seek: set selected/default audio/video sinks on playbin and playbin2
-	  https://bugzilla.gnome.org/show_bug.cgi?id=630322
-
-2011-05-25 19:03:44 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/examples/seek/seek.c:
-	  seek: add --audiosink and --videosink command line options
-
-2011-05-25 18:50:34 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/examples/seek/seek.c:
-	  seek: use the right GDK defines to differentiate between the backends
-
-2011-05-25 18:45:33 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* tests/examples/seek/seek.c:
-	  seek: use gst_filename_to_uri() to convert a filename to a uri
-
-2010-09-27 12:46:54 +0400  Vladimir Eremeev <eremeev@atlantis.ru>
-
-	* tests/examples/seek/seek.c:
-	  seek: make seek example work in win32
-	  https://bugzilla.gnome.org/show_bug.cgi?id=630322
-
-2011-05-25 16:08:54 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* configure.ac:
-	  configure: update GLib requirement to >= 2.24
-	  Same as core (make implicit requirement explicit).
-	  http://gstreamer.freedesktop.org/wiki/ReleasePlanning/GLibRequirement
-
-2011-05-25 15:24:33 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* ext/theora/gsttheoraenc.c:
-	  theoraenc: remove bogus <0 check for unsigned var
-	  bytes_written is a gsize which is unsigned and thus never < 0.
-
-2011-05-25 15:23:13 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* ext/theora/gsttheoraenc.c:
-	  theoraenc: fix variable type for bytes_consumed
-	  th_encode_ctl() returns an int. Using a gsize result in bogus <0 checks.
-
-2011-05-25 15:04:20 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/riff/riff-read.c:
-	  riff: remove the g_return_if_fail as we test it below
-	  We don't want to return without setting taglist=NULL if asserts are on and with
-	  setting taglist=NULL otherwise.
-
-2011-05-25 14:28:18 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst/volume/gstvolume.c:
-	  volume: use a flag for 'mute' using the controller
-	  Previously we checked mute_csource to determine wheter we need to premultiply
-	  volumes and mute values. That fails as we unrefs mute_csource and set it to
-	  NULL after. Use an extra flag instead.
-
-2011-05-25 14:12:50 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/tag/gstexiftag.c:
-	  exiftag: reflow the code
-	  Move the warning on unsupported units to the swicth-case. Move fetching the
-	  pending tags down to where we use them.
-
-2011-05-25 13:59:57 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/tag/gstexiftag.c:
-	  exiftag: set value=1 if we found the token
-	  Otherwise we never write the tag. This would also be consistent with the code in
-	  deserialize_scene_type().
-
-2011-05-25 12:30:51 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* sys/xvimage/xvimagesink.c:
-	  xvimagesink: run gst-indent
-
-2011-05-25 12:29:21 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* sys/xvimage/xvimagesink.c:
-	  xvimagesink: remove unneded !=NULL checks
-	  We check for matching_attr!=NULL right before already.
-
-2011-05-24 00:13:04 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	  docs: massage the section file more
-	  Add more symbols (from unused.txt). Move the whole bunch of riff-fourcc defines
-	  to std section too (no one is hoing to document them, right).
-
-2011-05-24 00:12:26 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/video/video.c:
-	  docs: add missing parameter docs
-
-2011-05-23 23:53:38 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	  docs: move the riff structure to std-section
-	  If someone intents to document them and the fields we can move them back.
-
-2011-05-23 23:53:06 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* docs/libs/gst-plugins-base-libs-docs.sgml:
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/pbutils/gstpluginsbaseversion.c:
-	  docs: move pluginbaseversion to separate section as we have section docs
-
-2011-05-23 23:51:15 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/rtsp/gstrtspdefs.h:
-	  docs: add minimal docblobs for status code and headers
-	  Use a trick to avoid documenting all 100 enums.
-
-2011-05-23 23:41:56 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/interfaces/xoverlay.c:
-	* gst-libs/gst/interfaces/xoverlay.h:
-	  docs: update xoverlay docs for api addition and deprecation
-
-2011-05-23 23:12:50 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/rtp/gstbasertpaudiopayload.c:
-	* gst-libs/gst/rtp/gstbasertpaudiopayload.h:
-	* gst-libs/gst/rtp/gstbasertpdepayload.c:
-	* gst-libs/gst/rtp/gstbasertpdepayload.h:
-	* gst-libs/gst/rtp/gstbasertppayload.c:
-	* gst-libs/gst/rtp/gstbasertppayload.h:
-	  docs: rtp library docs update
-
-2011-05-23 22:58:22 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/audio/gstringbuffer.h:
-	* gst-libs/gst/cdda/gstcddabasesrc.h:
-	* gst-libs/gst/interfaces/colorbalance.h:
-	* gst-libs/gst/interfaces/colorbalancechannel.h:
-	* gst-libs/gst/interfaces/mixer.h:
-	* gst-libs/gst/interfaces/mixeroptions.h:
-	* gst-libs/gst/interfaces/navigation.h:
-	* gst-libs/gst/interfaces/tuner.h:
-	* gst-libs/gst/video/gstvideofilter.h:
-	* gst-libs/gst/video/gstvideosink.h:
-	  docs: add missing documentation for various pieces
-
-2010-02-19 12:54:18 +0100  Thijs Vermeir <thijsvermeir@gmail.com>
-
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	  baseaudiosink: recalibrate clock on setcaps
-	  Because the spec for the ringbuffer can change when changing
-	  the caps, we must recalibrate the clock.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=610443
-
-2011-05-23 16:02:34 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/subparse/gstsubparse.c:
-	  subparse: Try to typefind even if conversion to UTF8 failed
-	  Fixes bug #600043.
-
-2011-05-23 16:02:20 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/subparse/gstsubparse.c:
-	  subparse: Compile the typefind regex with optimization to speed up matching
-
-2011-05-23 15:51:14 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/subparse/gstsubparse.c:
-	  subparse: Interprete typefind strings passed to GRegex as raw bytes instead of valid UTF8
-
-2011-05-23 15:21:59 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst-libs/gst/video/convertframe.c:
-	  convertframe: fix docs
-	  Fixup paramter mismatch between func and prototype. Add missing parameter docs.
+=== release 0.10.35 ===
 
-2011-05-23 15:08:24 +0300  Stefan Kost <ensonic@users.sf.net>
+2011-06-15  Tim-Philipp Müller <tim.muller@collabora.co.uk>
 
-	* gst-libs/gst/audio/gstaudioclock.h:
-	* gst-libs/gst/audio/gstaudiofilter.h:
-	* gst-libs/gst/audio/gstaudiosrc.h:
-	* gst-libs/gst/audio/multichannel.h:
-	  docs: fixup audio-library docs
+	* configure.ac:
+	  releasing 0.10.35, "Short Notice"
 
-2011-05-23 15:02:27 +0300  Stefan Kost <ensonic@users.sf.net>
+2011-06-15 14:21:30 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
 
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/app/gstappsink.c:
-	* gst-libs/gst/app/gstappsrc.c:
-	* gst/app/gstapp.c:
-	  docs: fixup appsrc/sink api docs
+	* gst-libs/gst/audio/Makefile.am:
+	  audio: link test program against libgstaudio
 
-2011-05-23 14:53:26 +0300  Stefan Kost <ensonic@users.sf.net>
+2011-06-14 10:31:18 +0530  Debarshi Ray <rishi@gnu.org>
 
-	* gst-libs/gst/audio/gstaudioiec61937.c:
-	* gst-libs/gst/audio/gstaudioiec61937.h:
-	  docs: fix docs for new api
-	  Some parameters where wrong, first line missed the ':' and return docs where
-	  broken.
+	* gst-libs/gst/pbutils/codec-utils.c:
+	  codec-utils: restore 7350 as a valid sampling frequency for AAC
+	  This was lost during c77f88cac675a1dbb89e40da8e3c28320523bfca.
 
-2011-05-23 14:45:23 +0300  Stefan Kost <ensonic@users.sf.net>
+2011-06-09 18:30:33 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
 
-	* docs/libs/gst-plugins-base-libs-docs.sgml:
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	  docs: update xmp api docs
-	  Add missing section. Add new section to main-sgml. Add missing function.
+	* gst-libs/gst/tag/gstid3tag.c:
+	* gst-libs/gst/tag/gstvorbistag.c:
+	* gst-libs/gst/tag/tag.h:
+	  libs: replace G_CONST_RETURN with 'const'
+	  G_CONST_RETURN will be deprecated soon.
+	  https://bugzilla.gnome.org/show_bug.cgi?id=652211
 
-2011-05-23 14:07:38 +0300  Stefan Kost <ensonic@users.sf.net>
+2011-05-31 22:14:09 -0700  David Schleef <ds@schleef.org>
 
-	* gst-libs/gst/tag/gstxmptag.c:
-	  xmptag: remove late check
-	  We deref the pointer two lines before already and besides this internal function
-	  should not be called with this parameter=NULL.
+	* gst/audioresample/resample.c:
+	* gst/audiotestsrc/gstaudiotestsrc.c:
+	* gst/videoscale/vs_4tap.c:
+	* gst/videotestsrc/generate_sine_table.c:
+	* gst/videotestsrc/videotestsrc.c:
+	* tests/icles/test-xoverlay.c:
+	  convert M_PI to G_PI, for msvc
 
-2011-05-23 14:01:29 +0300  Stefan Kost <ensonic@users.sf.net>
+2011-06-06 14:41:41 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
 
-	* gst-libs/gst/tag/gstxmptag.c:
-	  xmptag: have the default branch as the last one
+	* gst-libs/gst/tag/gsttagdemux.c:
+	  tagdemux: no input data implies no type can be found
+	  ... and posting a proper error message to this effect is appropriately
+	  informative and prevents auto-plugging otherwise stalling.
 
-2011-05-23 14:00:04 +0300  Stefan Kost <ensonic@users.sf.net>
+2011-06-04 13:36:55 -0700  David Schleef <ds@schleef.org>
 
-	* gst-libs/gst/tag/gstxmptag.c:
-	  xmptag: an uint value can't be <0
+	* gst/adder/gstadder.c:
+	  adder: Work around changes in g_atomic API
+	  See #651514 for details.
 
-2011-05-23 13:53:06 +0300  Stefan Kost <ensonic@users.sf.net>
+2011-05-31 20:38:56 -0700  David Schleef <ds@schleef.org>
 
-	* gst-libs/gst/video/video.c:
-	  whitespace: trim trailing whitespace
+	* gst-libs/gst/pbutils/gstdiscoverer.c:
+	  discoverer: fix c99-ism
 
-2011-05-23 13:50:59 +0300  Stefan Kost <ensonic@users.sf.net>
+2011-05-23 16:02:34 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
 
-	* gst-libs/gst/video/video.c:
-	  video.c: use a break and a final warning instead of early returns
-	  Use breaks for case branches instead of return 0. We don't expect these to
-	  happen anyway. Thus have a warning before the final return to make it easier to
-	  see when things go out of sync.
+	* gst/subparse/gstsubparse.c:
+	  subparse: Try to typefind even if conversion to UTF8 failed
+	  Fixes bug #600043.
 
-2011-05-23 13:49:01 +0300  Stefan Kost <ensonic@users.sf.net>
+2011-05-23 15:51:14 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
 
-	* gst-libs/gst/video/video.c:
-	  video.c: use g_assert_not_reached() for logical error here.
-	  This will help to detect them closer to the source if they ever happen.
+	* gst/subparse/gstsubparse.c:
+	  subparse: Interprete typefind strings passed to GRegex as raw bytes instead of valid UTF8
 
 2011-05-20 10:48:39 +0300  Stefan Kost <ensonic@users.sf.net>
 
@@ -5996,419 +70,6 @@
 	  lang: fix possible array overrun
 	  We where checking for i<G_N_ELEMENTS, but where accessing i+1.
 
-2011-05-19 23:41:08 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* gst/audioconvert/gstaudioconvert.c:
-	  audioconvert: cleanup helper code
-	  make_lossless_changes() returns the same structure that we're passing (probably
-	  to enable chaining). Instead of reusing s and making it point to s2 as well,
-	  keep using s2. Drop the assignment which in the 2nd case is a dead one anyway.
-
-2011-05-19 23:25:24 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* docs/plugins/gst-plugins-base-plugins.args:
-	* docs/plugins/gst-plugins-base-plugins.hierarchy:
-	* docs/plugins/gst-plugins-base-plugins.interfaces:
-	* docs/plugins/gst-plugins-base-plugins.prerequisites:
-	  docs: update plugin introspection data
-	  Now more files are merged and produced in a canonical fashion, which hopefully
-	  creates less or no delta in the future.
-
-2011-05-19 22:56:53 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* common:
-	  Automatic update of common submodule
-	  From 9e5bbd5 to 69b981f
-
-2011-05-19 13:40:29 +0100  Christian Fredrik Kalager Schaller <christian.schaller@collabora.co.uk>
-
-	* gst-plugins-base.spec.in:
-	  Add new header file
-
-2011-05-19 08:30:14 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst/encoding/gstencodebin.c:
-	  encodebin: Autoplug formatters
-	  Autoplug formatters for streams if a formatter with secondary or
-	  higher rank is found. Formatters are autoplugged when there is no
-	  muxer or when the muxer doesn't implement the tagsetter interface.
-	  Currently only the first formatter found is plugged, this might
-	  help in lots of cases, but it doesn't solve the
-	  'lamemp3 ! xingmux ! id3mux'
-	  case.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=649841
-
-2011-05-19 08:27:29 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst/encoding/gstencodebin.c:
-	  encodebin: fix typos
-
-2011-05-18 22:07:58 +0200  Aleix Conchillo Flaque <aleix@oblong.com>
-
-	* ext/vorbis/gstvorbisdec.c:
-	  vorbisdec: Handle headers in caps
-
-2011-05-18 16:09:47 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* common:
-	  Automatic update of common submodule
-	  From fd35073 to 9e5bbd5
-
-2011-05-18 13:18:15 +0200  Robert Swain <robert.swain@collabora.co.uk>
-
-	* gst-libs/gst/video/video.c:
-	* gst-libs/gst/video/video.h:
-	* tests/check/libs/video.c:
-	  gstvideo: Add gst_video_get_size_from_caps function
-	  gst_video_get_size_from_caps () allows easy calculation of the raw video
-	  buffer size from some fixed video caps.
-	  API: gst_video_get_size_from_caps()
-
-2011-05-18 12:24:02 +0300  Stefan Kost <ensonic@users.sf.net>
-
-	* common:
-	  Automatic update of common submodule
-	  From 46dfcea to fd35073
-
-2011-05-18 09:34:52 +0200  Robert Swain <robert.swain@collabora.co.uk>
-
-	* ext/alsa/gstalsasrc.c:
-	  alsa: Remove unused but set variable
-	  Unused but set variables cause warnings in GCC 4.6.x and newer.
-
-2011-05-17 10:20:36 +0200  Edward Hervey <edward.hervey@collabora.co.uk>
-
-	* gst-libs/gst/rtsp/gstrtspconnection.c:
-	  rtsp: Fix typo which broke the build
-
-2011-05-16 15:35:50 +0200  Miguel Angel Cabrera Moya <madmac2501@gmail.com>
-
-	* gst-libs/gst/rtsp/gstrtspconnection.c:
-	  rtspconnection: not enter in not controllable state unless it is necessary
-	  When closing rtspsrc the state change blocks until the polling in the
-	  connection timeouts. This is because the second time we loop to read a
-	  full message controllable is set to FALSE in the poll group, even though no
-	  message is half read.
-	  This can be avoided by not setting controllable to FALSE the poll group
-	  unless we had begin to read a message.
-	  Fixes #610916
-
-2010-05-30 13:21:00 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* ext/cdparanoia/gstcdparanoiasrc.c:
-	* ext/cdparanoia/gstcdparanoiasrc.h:
-	  cdparanoiasrc: fix build on OSX by #undef-ing VERSION before including system headers
-	  On OSX the cdparanoia headers include IOKit framework headers (in particular
-	  SCSICmds_INQUIRY_Definitions.h) which define a structure that has a member
-	  named VERSION, so we must #undef VERSION before including those for things
-	  to compile on OSX.
-	  Fixes #609918.
-
-2011-05-02 11:43:38 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/videorate/gstvideorate.c:
-	* gst/videorate/gstvideorate.h:
-	  videorate: optionally ensure maximum average output frame rate
-	  See #628764.
-
-2011-04-29 14:58:02 +0200  Alexey Fisher <bug-track@fisher-privat.net>
-
-	* gst/videorate/gstvideorate.c:
-	* gst/videorate/gstvideorate.h:
-	  videorate: optionally only drop frames to ensure maximum frame rate
-	  This adds option to arrange for maximal allowed variable frame rate.
-	  Fixes #628764.
-
-2011-04-26 13:37:51 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/playback/gsturidecodebin.c:
-	  uridecodebin: use bitrate to configure streaming buffer-duration default case
-	  In particular, in audio only cases whose (estimated) metadata provides bitrate
-	  information, the buffer-size based on such bitrate (and buffer-duration)
-	  will be much more reasonable than queue2 default buffer-size.
-
-2011-04-26 11:27:40 +0200  Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
-
-	* gst/playback/gsturidecodebin.c:
-	  uridecodebin: remove some dead code
-	  ... which was dead as pads were never added to the list, and need not be added,
-	  since removing them is handled by a pad callback.
-
-2011-04-29 11:48:02 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* tests/examples/encoding/Makefile.am:
-	  encodebin: examples: Add missing base libs to makefile
-
-2011-04-28 10:58:15 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst/encoding/gstencodebin.c:
-	  encodebin: Check for missing converters
-	  Adds checks for missing video and audio converter elements
-
-2011-04-27 22:05:55 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst-libs/gst/tag/xmpwriter.c:
-	  tag: xmpwriter: Rename documentation headers
-	  Fix some wrong documentation headers from the first name
-	  given to this interface.
-
-2011-04-19 08:41:53 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* tests/check/libs/tag.c:
-	  tests: xmp: New tests for the Iptc4xmpExt tags
-
-2011-04-18 23:28:13 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstxmptag.c:
-	  tag: xmp: Add Iptc4xmpExt schema support
-	  Adds Iptc4xmpExt schema with country, city and sublocation
-	  tags mapped
-
-2011-04-19 11:00:24 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstxmptag.c:
-	  tag: xmp: Add support for reading struct tags
-	  Adds a context variable that controls if the parsing is on
-	  'top level' tags or inside a struct tag.
-
-2011-04-18 16:54:54 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstxmptag.c:
-	  tag: xmp: Add struct xmp tag type support
-	  Adds support for writing the xmp struct tag type, it is a compound tag
-	  that has inner tags.
-
-2011-04-18 23:16:59 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstxmptag.c:
-	  tag: xmp: Fixing schema maps
-	  Do not forget to create a new schema for every supported schema
-	  instead of reusing the same object
-
-2011-04-18 10:20:00 -0300  Thiago Santos <thiago.sousa.santos@collabora.co.uk>
-
-	* gst-libs/gst/tag/gstxmptag.c:
-	  tag: xmp: Write the same tag to all schemas
-	  Instead of writing only the xmp tag for the first found entry
-	  that matches the gstreamer tag, look for all mappings to write
-	  the tag to different schemas.
-	  The rationale here is that some reader application might only
-	  be interested on a particular schema tags, so we should try
-	  to write as many tags for all schemas.
-
-2011-05-15 13:39:18 +0200  Edward Hervey <bilboed@bilboed.com>
-
-	* win32/common/libgstaudio.def:
-	  win32: Update libgstaudio.def for new symbols
-
-2011-05-14 17:27:30 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstringbuffer.c:
-	  baseaudiosink: Use g_str_equal() instead of strncmp()
-	  The strncmp is unnecessary anyway since one of the strings is a const
-	  string.
-
-2011-05-14 16:49:53 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	  baseaudiosink: Fix trivial indentation problems
-
-2011-03-07 20:49:16 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* docs/libs/gst-plugins-base-libs-docs.sgml:
-	* docs/libs/gst-plugins-base-libs-sections.txt:
-	* gst-libs/gst/audio/Makefile.am:
-	* gst-libs/gst/audio/gstaudioiec61937.c:
-	* gst-libs/gst/audio/gstaudioiec61937.h:
-	  audio: Add an IEC 61937 payloading library
-	  This can be used by sinks to take compressed formats, correctly payload
-	  these in IEC 61937 frames and feed these to sinks that support
-	  passthrough output over IEC 60958 (S/PDIF) or, in the case of MP3, over
-	  Bluetooth.
-	  Initial implementation includes AC3, E-AC3, MPEG-1, MPEG-2 (non-AAC),
-	  and DTS (type-I/II/II) payloading. More formats can be added as needed.
-	  API: gst_audio_iec61937_frame_size()
-	  API: gst_audio_iec61937_payload()
-	  https://bugzilla.gnome.org/show_bug.cgi?id=642730
-
-2011-03-09 11:12:39 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstbaseaudiosink.c:
-	* gst-libs/gst/audio/gstbaseaudiosink.h:
-	  baseaudiosink: Allow subclasses to provide payloaders
-	  This allows subclasses to provide a "payload" function to prepare
-	  buffers for consumption. The immediate use for this is for sinks that
-	  can handle compressed formats - parsers are directly connected to the
-	  sink, and for formats such as AC3, DTS, and MPEG, IEC 61937 patyloading
-	  might be used.
-	  API: GstBaseAudioSinkClass:payload()
-	  https://bugzilla.gnome.org/show_bug.cgi?id=642730
-
-2011-04-09 09:49:10 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstringbuffer.c:
-	  ringbuffer: Add support for E-AC3
-	  Adds support for pushing E-AC3 buffers and doing bytes-to-ms conversion
-	  correctly. The assumption (as with other formats) is that something like
-	  IEC 61937 payloading will be used. Correspondingly the ringbuffer spec
-	  is populated so that the data rate is 4x normal AC3.
-	  https://bugzilla.gnome.org/show_bug.cgi?id=642730
-
-2011-03-14 15:51:40 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstringbuffer.c:
-	  ringbuffer: Add support for MPEG audio buffers
-
-2011-03-14 15:49:57 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstringbuffer.h:
-	  ringbuffer: Add AAC format types
-	  These are meant to be used for buffers containing AAC data. Nothing uses
-	  this yet, but for now it serves to distinguish from GST_BUFTYPE_MPEG
-	  which represents non-AAC MPEG audio.
-	  API: GST_BUFTYPE_MPEG2_AAC
-	  API: GST_BUFTYPE_MPEG4_AAC
-
-2011-03-09 22:57:00 +0530  Arun Raghavan <arun.raghavan@collabora.co.uk>
-
-	* gst-libs/gst/audio/gstringbuffer.c:
-	  ringbuffer: Add support for DTS buffers
-
-2011-05-14 11:42:50 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* configure.ac:
-	  configure: Require core 0.10.34.1 for the new ghostpad API
-
-2011-05-09 22:20:23 +0200  Andoni Morales Alastruey <ylatuya@gmail.com>
-
-	* gst/playback/gstdecodebin2.c:
-	  decodebin2: fix preroll for streams at low bitrates
-	  For streams at low bitrates we need to set a limit in time because the limit
-	  in bytes might not reached too late, sometimes more than 30 seconds.
-	  This limit can only be set if upstream is seekable (see #584104)
-	  Closes #647769
-
-2011-05-09 13:11:00 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysink.c:
-	  playsink: Use new ghostpad/proxypad API to get the internal pad
-
-2011-05-09 12:59:22 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaysinkaudioconvert.c:
-	* gst/playback/gstplaysinkaudioconvert.h:
-	* gst/playback/gstplaysinkvideoconvert.c:
-	* gst/playback/gstplaysinkvideoconvert.h:
-	  playsink: Use new ghostpad/proxypad API
-
-2011-05-09 12:50:06 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* tests/check/elements/playbin2-compressed.c:
-	  playbin2: Disable some compressed stream tests that are racy without a stream-activate event
-
-2011-03-29 19:15:27 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* tests/check/elements/playbin2-compressed.c:
-	  playbin2: Reset buffer counter in playbin2-compressed tests every time when going to READY
-
-2011-03-25 08:26:00 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/Makefile.am:
-	* gst/playback/gstplaysink.c:
-	* gst/playback/gstplaysinkaudioconvert.c:
-	* gst/playback/gstplaysinkaudioconvert.h:
-	* gst/playback/gstplaysinkvideoconvert.c:
-	* gst/playback/gstplaysinkvideoconvert.h:
-	  playsink: Add audio and video converter convenience bins
-	  These reconfigure based on the caps and plugin in converters if
-	  necessary. This also makes switching between compressed and raw
-	  streams work flawlessly without loosing the states of any element
-	  somewhere or having running time problems.
-
-2011-03-15 12:51:04 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstplaybin2.c:
-	* gst/playback/gstplaysink.c:
-	* gst/playback/gstplaysink.h:
-	  playbin2/playsink: Decide if A/V caps are raw only inside playsink
-	  Before playbin2 would use different selectors for raw audio and
-	  compressed audio (and the same for video) and used different
-	  pads from playsink. This made the involved logic much more
-	  complex and was not implemented completely in playsink, which
-	  made it impossible to support files with a compressed and
-	  uncompressed stream that is support by the sink.
-	  playbin2 handles raw/non-raw streams the same now and the
-	  decision is left to playsink, which now can also handle
-	  caps changes from raw to non-raw and the other way around.
-	  Fixes bug #632788.
-
-2011-03-15 11:41:14 +0100  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* tests/check/Makefile.am:
-	* tests/check/elements/playbin2-compressed.c:
-	  playbin2: Add unit test for compressed stream support in playbin2/playsink
-
-2011-05-09 12:56:14 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* ext/alsa/gstalsasrc.c:
-	  alsasrc: Fix some compilation errors
-
-2011-05-09 11:50:05 +0200  Pontus Oldberg <pontus.oldberg@invector.se>
-
-	* ext/alsa/gstalsasrc.c:
-	* ext/alsa/gstalsasrc.h:
-	  alsasrc: Improve timestamp accuracy
-	  Fixes bug #635256.
-
-2011-05-06 17:01:53 +0200  Sebastian Dröge <sebastian.droege@collabora.co.uk>
-
-	* gst/playback/gstsubtitleoverlay.c:
-	* gst/playback/gstsubtitleoverlay.h:
-	  subtitleoverlay: Use new, public ghostpad functions
-
-2011-05-03 11:26:32 +0300  Sreerenj Balachandran <sreerenj.balachandran@nokia.com>
-
-	* sys/xvimage/xvimagesink.c:
-	  xvimagesink: Use GST_BOILERPLATE
-
-2011-05-14 09:41:58 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
-
-	* configure.ac:
-	* docs/plugins/gst-plugins-base-plugins.hierarchy:
-	* docs/plugins/inspect/plugin-adder.xml:
-	* docs/plugins/inspect/plugin-alsa.xml:
-	* docs/plugins/inspect/plugin-app.xml:
-	* docs/plugins/inspect/plugin-audioconvert.xml:
-	* docs/plugins/inspect/plugin-audiorate.xml:
-	* docs/plugins/inspect/plugin-audioresample.xml:
-	* docs/plugins/inspect/plugin-audiotestsrc.xml:
-	* docs/plugins/inspect/plugin-cdparanoia.xml:
-	* docs/plugins/inspect/plugin-decodebin.xml:
-	* docs/plugins/inspect/plugin-encoding.xml:
-	* docs/plugins/inspect/plugin-ffmpegcolorspace.xml:
-	* docs/plugins/inspect/plugin-gdp.xml:
-	* docs/plugins/inspect/plugin-gio.xml:
-	* docs/plugins/inspect/plugin-gnomevfs.xml:
-	* docs/plugins/inspect/plugin-libvisual.xml:
-	* docs/plugins/inspect/plugin-ogg.xml:
-	* docs/plugins/inspect/plugin-pango.xml:
-	* docs/plugins/inspect/plugin-playback.xml:
-	* docs/plugins/inspect/plugin-subparse.xml:
-	* docs/plugins/inspect/plugin-tcp.xml:
-	* docs/plugins/inspect/plugin-theora.xml:
-	* docs/plugins/inspect/plugin-typefindfunctions.xml:
-	* docs/plugins/inspect/plugin-uridecodebin.xml:
-	* docs/plugins/inspect/plugin-videorate.xml:
-	* docs/plugins/inspect/plugin-videoscale.xml:
-	* docs/plugins/inspect/plugin-videotestsrc.xml:
-	* docs/plugins/inspect/plugin-volume.xml:
-	* docs/plugins/inspect/plugin-vorbis.xml:
-	* docs/plugins/inspect/plugin-ximagesink.xml:
-	* docs/plugins/inspect/plugin-xvimagesink.xml:
-	* win32/common/_stdint.h:
-	* win32/common/config.h:
-	  Back to development
-
 === release 0.10.34 ===
 
 2011-05-14 01:00:38 +0100  Tim-Philipp Müller <tim.muller@collabora.co.uk>
diff --git a/LICENSE_readme b/LICENSE_readme
new file mode 100644
index 0000000..67fd312
--- /dev/null
+++ b/LICENSE_readme
@@ -0,0 +1,137 @@
+
+Disclaimer:  The GStreamer team makes a real effort to make sure that
+the information in this file is as up-to-date and accurate as possible.
+However, this file may contain errors and omissions.  Some dependant
+libraries change their licensing from version-to-version and some of 
+the libraries listed here as LGPL were under the GPL license in
+older releases.  Distributions which include GStreamer are responsible
+for ensuring that plugins are used in accordance with licensing terms
+and other laws.
+
+GStreamer is developed under the terms of the LGPL (see LICENSE file for details).
+Some of our plugins however rely on libraries which are available under other
+licenses. This means that if you are using an application which has a non-GPL
+compatible license, for instance a closed-source application with GStreamer
+you have to make sure not to use GPL linked or derived plugins.  When using
+GPL linked plugins GStreamer is for all practical reasons under the GPL itself. 
+
+The plugins which use a GPL library are as follows:
+
+a52dec           liba52           (http://liba52.sourceforge.net/)
+aasink           aalib            (http://sourceforge.net/projects/aa-project/)
+cdparanoia       libcdparanoia    (http://www.xiph.org/paranoia/)
+dtsdec           libdts           (http://www.videolan.org/dtsdec.html)
+dvdnavsrc        libdvdnav        (http://dvd.sourceforge.net/)
+dxr3                              (http://dxr3.sourceforge.net/)
+icecastsend      libshout         (http://www.icecast.org)
+mad              libmad           (http://www.mars.org/home/rob/proj/mpeg/)
+mpeg2dec         libmpeg2         (http://libmpeg2.sourceforge.net/)
+mpeg2enc         libmpeg2enc      (http://mjpeg.sourceforge.net/)
+mplex            libmplex         (http://mjpeg.sourceforge.net/)
+siddec           libsidplay 1.36  (http://www.geocities.com/SiliconValley/Lakes/5147/sidplay/,
+                                   http://sourceforge.net/projects/sidplay2/)
+trm              libmusicbrainz   (http://www.musicbrainz.org/)
+xine             libxine          (http://xinehq.de/)
+xvid             libxvidcore      (http://www.xvid.org/)
+
+Plugins derived from GPL code are as follows:
+
+dvdreadsrc       libdvdread       (http://www.dtek.chalmers.se/groups/dvd/)
+jack             libjack          (http://jackit.sourceforge.net/)
+                                   Note libjack is LGPL, but plugin is GPL.
+monoscope        None             (Algorithm by Ralph Loader, Joerg Walter,
+                                   Richard Boulton, and Andy Lo A Foe)
+rtjpeg           None             (Erik Walthinsen's algorithm)
+rtp              None             (http://www.linphone.org/ortp/)
+synaesthesia                      (http://www.logarithmic.net/pfh/synaesthesia)
+system_encode    None             (Algorithm by Chrisoph Moar, Wim Tayman's and
+                                   Erik Walthinsen)
+vbidec           None             (Algorithm by Billy Biggs, Doug Bell, 
+                                   Erik Walthinsen and David I. Lehn)
+
+Plugins which use a LGPL library are as follows:
+
+alsa             alsa             (http://alsa-project.org/)
+artsdsink        aRts             (http://arts-project.org/)
+cacasink         libcaca          (http://sam.zoy.org/projects/libcaca/)
+colorspacelcs    libcolorspace    
+dvdec            libdv            (http://libdv.sourceforge.net/)
+esdmon,esdsink   libesd           (ftp.gnome.org/pub/GNOME/stable/sources/esound/)
+faac             libfaac          (http://www.audiocoding.com/modules/mydownloads/)
+fameenc          libfame          (http://fame.sourceforge.net/)
+ffmpeg           ffmpeg           (http://ffmpeg.sourceforge.net/)
+gdkpixbuf        GTK+             (http://www.gtk.org/)
+gnomevfs         gnome-vfs        (ftp.gnome.org//pub/GNOME/stable/sources/gnome-vfs/)
+gst_arts         aRts             (http://arts-project.org/)
+gst1394          libraw1394       (http://www.linux1394.org/)
+gstaf            libaudiofile     (http://www.68k.org/~michael/audiofile/)
+gstsf            libsndfile       (http://www.mega-nerd.com/libsndfile/)
+hermescolorspace Hermes           (http://www.clanlib.org/hermes/)
+kio              KDE              (http://www.kde.org/)
+ladspa                            (http://www.ladspa.org/)
+lame             libmp3lame       (http://lame.sourceforge.net/)
+libvisual        libvisual        (http://libvisual.sourceforge.net/)
+matroska                          (http://www.matroska.org/)
+mikmod           libmikmod        (http://mikmod.raphnet.net/)
+ossaudio                          (http://www.opensound.com/)
+qcamsrc
+rfbenc           librfb
+sdlvideosink     libsdl           (http://www.libsdl.org/)
+shout2send       libshout2        (http://www.icecast.org)
+smoothwave      
+swfdec                            (http://swfdec.sourceforge.net/)
+tarkin                            (http://svn.xiph.org/trunk/tarkin/)
+textoverlay      pango            (http://www.pango.org/)
+dirac                             (http://www.bbc.co.uk/rd/projects/dirac/)
+effectv (Our ports was relicensed)(http://effectv.sourceforge.net/)
+musepack 			  (http://www.musepack.net/)
+
+Plugins which use a BSD covered library are as follows:
+
+ogg              libogg/libvorbis (http://www.xiph.org/ogg/vorbis/)
+vorbis           libogg/libvorbis (http://www.xiph.org/ogg/vorbis/)
+gsttheora        libtheora        (http://www.theora.org/)
+speex                             (http://www.speex.org/)
+flac             libFLAC          (http://flac.sourceforge.net/)
+
+Plugins based on libraries with other free licenses:
+
+ximagesink       libXv
+xvimagesink      libXv            
+ - license:      MIT X11 / X Consortium license
+
+gsm              libgsm           
+ - license       MIT license http://kbs.cs.tu-berlin.de/~jutta/toast.html
+
+festival                          (http://www.cstr.ed.ac.uk/projects/festival/)
+ - license:      http://www.cstr.ed.ac.uk/projects/festival/freecopyright.shtml
+
+jpeg                              (http://www.ijg.org/)
+ - license:      IJG license
+
+nas                               (http://radscan.com/nas.html)
+ - license:      NAS license
+
+snapshot         libpng           (http://www.libpng.org/pub/png/)
+ - license:      PNG license
+
+mngdec/mngenc	libmng	    	(http://gjuyn.xs4all.nl/libmng)
+ - license 	 PNG license
+
+Plugins using non-free libraries:
+divxdec, divxenc                        (http://www.divx.com/)
+osxaudio                                (http://www.apple.com/macosx/)
+sunaudiosink                            (http://www.sun.com/)
+
+Unsure:
+
+faad             libfaad          (http://www.audiocoding.com/)
+faad's license depends on its major version :
+  - for FAAD1 : it is LGPL
+  - for FAAD2 : it is GPL
+look at these pages for more information on licenses :
+http://www.audiocoding.com/modules/wiki/?page=FAAD2
+http://www.audiocoding.com/modules/wiki/?page=FAAC
+
+by default, GStreamer faad plugin would compile against FAAD2 if available.
+it falls back to FAAD1 if not.
diff --git a/MAINTAINERS b/MAINTAINERS
new file mode 100644
index 0000000..2412862
--- /dev/null
+++ b/MAINTAINERS
@@ -0,0 +1,13 @@
+GStreamer is currently maintained by the consensus of a number
+of people, including, but not limited to:
+
+  David Schleef <ds@schleef.org>
+  Jan Schmidt <thaytan@noraisin.net>
+  Wim Taymans <wim.taymans@gmail.com>
+  Tim-Philipp Müller <tim centricular net>
+
+Maintainer-related issues should be addressed to:
+
+  gstreamer-devel@lists.sourceforge.net
+
+
diff --git a/Makefile.am b/Makefile.am
index f96c417..e6c1331 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -56,6 +56,7 @@ endif
 
 WIN32_COPY = \
 	$(top_builddir)/gst-libs/gst/*/*-enumtypes.[ch] \
+	$(top_builddir)/gst-libs/gst/pbutils/gstpluginsbaseversion.h \
 	$(top_builddir)/_stdint.h
 
 win32-update:
diff --git a/Makefile.in b/Makefile.in
index 12dbf2e..d2ca811 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -26,6 +25,23 @@
 #
 # set CRUFT_FILES and/or CRUFT_DIRS in your Makefile.am when you include this
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -44,6 +60,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = README $(am__configure_deps) $(srcdir)/Makefile.am \
 	$(srcdir)/Makefile.in $(srcdir)/config.h.in \
 	$(srcdir)/gst-plugins-base.spec.in \
@@ -101,12 +118,18 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = config.h
 CONFIG_CLEAN_FILES = gst-plugins-base.spec
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
 RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
@@ -116,13 +139,19 @@ RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
 	$(RECURSIVE_CLEAN_TARGETS:-recursive=) tags TAGS ctags CTAGS \
-	distdir dist dist-all distcheck
+	cscope distdir dist dist-all distcheck
 ETAGS = etags
 CTAGS = ctags
+CSCOPE = cscope
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 distdir = $(PACKAGE)-$(VERSION)
 top_distdir = $(distdir)
@@ -132,6 +161,7 @@ am__remove_distdir = \
       && rm -rf "$(distdir)" \
       || { sleep 5 && rm -rf "$(distdir)"; }; \
   else :; fi
+am__post_remove_distdir = $(am__remove_distdir)
 am__relativize = \
   dir0=`pwd`; \
   sed_first='s,^\([^/]*\)/.*$$,\1,'; \
@@ -159,6 +189,7 @@ am__relativize = \
   reldir="$$dir2"
 DIST_ARCHIVES = $(distdir).tar.gz $(distdir).tar.bz2
 GZIP_ENV = --best
+DIST_TARGETS = dist-bzip2 dist-gzip
 distuninstallcheck_listfiles = find . -type f -print
 am__distuninstallcheck_listfiles = $(distuninstallcheck_listfiles) \
   | sed 's|^\./|$(prefix)/|' | grep -v '$(infodir)/dir$$'
@@ -451,7 +482,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -504,6 +539,7 @@ DISTCLEANFILES = _stdint.h
 AUTOMAKE_OPTIONS = dist-bzip2
 WIN32_COPY = \
 	$(top_builddir)/gst-libs/gst/*/*-enumtypes.[ch] \
+	$(top_builddir)/gst-libs/gst/pbutils/gstpluginsbaseversion.h \
 	$(top_builddir)/_stdint.h
 
 
@@ -582,12 +618,12 @@ distclean-libtool:
 	-rm -f libtool config.lt
 
 # This directory's subdirectories are mostly independent; you can cd
-# into them and run `make' without going through this Makefile.
-# To change the values of `make' variables: instead of editing Makefiles,
-# (1) if the variable is set in `config.status', edit `config.status'
-#     (which will cause the Makefiles to be regenerated when you run `make');
-# (2) otherwise, pass the desired values on the `make' command line.
-$(RECURSIVE_TARGETS):
+# into them and run 'make' without going through this Makefile.
+# To change the values of 'make' variables: instead of editing Makefiles,
+# (1) if the variable is set in 'config.status', edit 'config.status'
+#     (which will cause the Makefiles to be regenerated when you run 'make');
+# (2) otherwise, pass the desired values on the 'make' command line.
+$(RECURSIVE_TARGETS) $(RECURSIVE_CLEAN_TARGETS):
 	@fail= failcom='exit 1'; \
 	for f in x $$MAKEFLAGS; do \
 	  case $$f in \
@@ -597,7 +633,11 @@ $(RECURSIVE_TARGETS):
 	done; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
-	list='$(SUBDIRS)'; for subdir in $$list; do \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	for subdir in $$list; do \
 	  echo "Making $$target in $$subdir"; \
 	  if test "$$subdir" = "."; then \
 	    dot_seen=yes; \
@@ -611,37 +651,6 @@ $(RECURSIVE_TARGETS):
 	if test "$$dot_seen" = "no"; then \
 	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
 	fi; test -z "$$fail"
-
-$(RECURSIVE_CLEAN_TARGETS):
-	@fail= failcom='exit 1'; \
-	for f in x $$MAKEFLAGS; do \
-	  case $$f in \
-	    *=* | --[!k]*);; \
-	    *k*) failcom='fail=yes';; \
-	  esac; \
-	done; \
-	dot_seen=no; \
-	case "$@" in \
-	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
-	  *) list='$(SUBDIRS)' ;; \
-	esac; \
-	rev=''; for subdir in $$list; do \
-	  if test "$$subdir" = "."; then :; else \
-	    rev="$$subdir $$rev"; \
-	  fi; \
-	done; \
-	rev="$$rev ."; \
-	target=`echo $@ | sed s/-recursive//`; \
-	for subdir in $$rev; do \
-	  echo "Making $$target in $$subdir"; \
-	  if test "$$subdir" = "."; then \
-	    local_target="$$target-am"; \
-	  else \
-	    local_target="$$target"; \
-	  fi; \
-	  ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
-	  || eval $$failcom; \
-	done && test -z "$$fail"
 tags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
@@ -650,6 +659,10 @@ ctags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
 	done
+cscopelist-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) cscopelist); \
+	done
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -713,8 +726,32 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscope: cscope.files
+	test ! -s cscope.files \
+	  || $(CSCOPE) -b -q $(AM_CSCOPEFLAGS) $(CSCOPEFLAGS) -i cscope.files $(CSCOPE_ARGS)
+
+clean-cscope:
+	-rm -f cscope.files
+
+cscope.files: clean-cscope cscopelist-recursive cscopelist
+
+cscopelist: cscopelist-recursive $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
+	-rm -f cscope.out cscope.in.out cscope.po.out cscope.files
 
 distdir: $(DISTFILES)
 	$(am__remove_distdir)
@@ -750,13 +787,10 @@ distdir: $(DISTFILES)
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -788,40 +822,35 @@ distdir: $(DISTFILES)
 	|| chmod -R a+r "$(distdir)"
 dist-gzip: distdir
 	tardir=$(distdir) && $(am__tar) | GZIP=$(GZIP_ENV) gzip -c >$(distdir).tar.gz
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 dist-bzip2: distdir
 	tardir=$(distdir) && $(am__tar) | BZIP2=$${BZIP2--9} bzip2 -c >$(distdir).tar.bz2
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 
 dist-lzip: distdir
 	tardir=$(distdir) && $(am__tar) | lzip -c $${LZIP_OPT--9} >$(distdir).tar.lz
-	$(am__remove_distdir)
-
-dist-lzma: distdir
-	tardir=$(distdir) && $(am__tar) | lzma -9 -c >$(distdir).tar.lzma
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 
 dist-xz: distdir
 	tardir=$(distdir) && $(am__tar) | XZ_OPT=$${XZ_OPT--e} xz -c >$(distdir).tar.xz
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 
 dist-tarZ: distdir
 	tardir=$(distdir) && $(am__tar) | compress -c >$(distdir).tar.Z
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 
 dist-shar: distdir
 	shar $(distdir) | GZIP=$(GZIP_ENV) gzip -c >$(distdir).shar.gz
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 
 dist-zip: distdir
 	-rm -f $(distdir).zip
 	zip -rq $(distdir).zip $(distdir)
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 
-dist dist-all: distdir
-	tardir=$(distdir) && $(am__tar) | GZIP=$(GZIP_ENV) gzip -c >$(distdir).tar.gz
-	tardir=$(distdir) && $(am__tar) | BZIP2=$${BZIP2--9} bzip2 -c >$(distdir).tar.bz2
-	$(am__remove_distdir)
+dist dist-all:
+	$(MAKE) $(AM_MAKEFLAGS) $(DIST_TARGETS) am__post_remove_distdir='@:'
+	$(am__post_remove_distdir)
 
 # This target untars the dist file and tries a VPATH configuration.  Then
 # it guarantees that the distribution is self-contained by making another
@@ -832,8 +861,6 @@ distcheck: dist
 	  GZIP=$(GZIP_ENV) gzip -dc $(distdir).tar.gz | $(am__untar) ;;\
 	*.tar.bz2*) \
 	  bzip2 -dc $(distdir).tar.bz2 | $(am__untar) ;;\
-	*.tar.lzma*) \
-	  lzma -dc $(distdir).tar.lzma | $(am__untar) ;;\
 	*.tar.lz*) \
 	  lzip -dc $(distdir).tar.lz | $(am__untar) ;;\
 	*.tar.xz*) \
@@ -845,9 +872,9 @@ distcheck: dist
 	*.zip*) \
 	  unzip $(distdir).zip ;;\
 	esac
-	chmod -R a-w $(distdir); chmod a+w $(distdir)
-	mkdir $(distdir)/_build
-	mkdir $(distdir)/_inst
+	chmod -R a-w $(distdir)
+	chmod u+w $(distdir)
+	mkdir $(distdir)/_build $(distdir)/_inst
 	chmod a-w $(distdir)
 	test -d $(distdir)/_build || exit 0; \
 	dc_install_base=`$(am__cd) $(distdir)/_inst && pwd | sed -e 's,^[^:\\/]:[\\/],/,'` \
@@ -880,7 +907,7 @@ distcheck: dist
 	  && $(MAKE) $(AM_MAKEFLAGS) distcleancheck \
 	  && cd "$$am__cwd" \
 	  || exit 1
-	$(am__remove_distdir)
+	$(am__post_remove_distdir)
 	@(echo "$(distdir) archives ready for distribution: "; \
 	  list='$(DIST_ARCHIVES)'; for i in $$list; do echo $$i; done) | \
 	  sed -e 1h -e 1s/./=/g -e 1p -e 1x -e '$$p' -e '$$x'
@@ -1017,24 +1044,26 @@ ps-am:
 uninstall-am:
 
 .MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) all \
-	ctags-recursive install-am install-strip tags-recursive
+	cscopelist-recursive ctags-recursive install-am install-strip \
+	tags-recursive
 
 .PHONY: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) CTAGS GTAGS \
 	all all-am all-local am--refresh check check-am clean \
-	clean-generic clean-libtool ctags ctags-recursive dist \
-	dist-all dist-bzip2 dist-gzip dist-hook dist-lzip dist-lzma \
-	dist-shar dist-tarZ dist-xz dist-zip distcheck distclean \
-	distclean-generic distclean-hdr distclean-libtool \
-	distclean-tags distcleancheck distdir distuninstallcheck dvi \
-	dvi-am html html-am info info-am install install-am \
-	install-data install-data-am install-dvi install-dvi-am \
-	install-exec install-exec-am install-html install-html-am \
-	install-info install-info-am install-man install-pdf \
-	install-pdf-am install-ps install-ps-am install-strip \
-	installcheck installcheck-am installdirs installdirs-am \
-	maintainer-clean maintainer-clean-generic mostlyclean \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags tags-recursive uninstall uninstall-am
+	clean-cscope clean-generic clean-libtool cscope cscopelist \
+	cscopelist-recursive ctags ctags-recursive dist dist-all \
+	dist-bzip2 dist-gzip dist-hook dist-lzip dist-shar dist-tarZ \
+	dist-xz dist-zip distcheck distclean distclean-generic \
+	distclean-hdr distclean-libtool distclean-tags distcleancheck \
+	distdir distuninstallcheck dvi dvi-am html html-am info \
+	info-am install install-am install-data install-data-am \
+	install-dvi install-dvi-am install-exec install-exec-am \
+	install-html install-html-am install-info install-info-am \
+	install-man install-pdf install-pdf-am install-ps \
+	install-ps-am install-strip installcheck installcheck-am \
+	installdirs installdirs-am maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-generic \
+	mostlyclean-libtool pdf pdf-am ps ps-am tags tags-recursive \
+	uninstall uninstall-am
 
 
 win32-debug:
diff --git a/aclocal.m4 b/aclocal.m4
index 293c701..495dc95 100644
--- a/aclocal.m4
+++ b/aclocal.m4
@@ -1,8 +1,7 @@
-# generated automatically by aclocal 1.11.3 -*- Autoconf -*-
+# generated automatically by aclocal 1.12.6 -*- Autoconf -*-
+
+# Copyright (C) 1996-2012 Free Software Foundation, Inc.
 
-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
-# 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software Foundation,
-# Inc.
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -14,31 +13,28 @@
 
 m4_ifndef([AC_AUTOCONF_VERSION],
   [m4_copy([m4_PACKAGE_VERSION], [AC_AUTOCONF_VERSION])])dnl
-m4_if(m4_defn([AC_AUTOCONF_VERSION]), [2.68],,
-[m4_warning([this file was generated for autoconf 2.68.
+m4_if(m4_defn([AC_AUTOCONF_VERSION]), [2.69],,
+[m4_warning([this file was generated for autoconf 2.69.
 You have another version of autoconf.  It may work, but is not guaranteed to.
 If you have problems, you may need to regenerate the build system entirely.
-To do so, use the procedure documented by the package, typically `autoreconf'.])])
+To do so, use the procedure documented by the package, typically 'autoreconf'.])])
 
-# Copyright (C) 2002, 2003, 2005, 2006, 2007, 2008, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 2002-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 1
-
 # AM_AUTOMAKE_VERSION(VERSION)
 # ----------------------------
 # Automake X.Y traces this macro to ensure aclocal.m4 has been
 # generated from the m4 files accompanying Automake X.Y.
 # (This private macro should not be called outside this file.)
 AC_DEFUN([AM_AUTOMAKE_VERSION],
-[am__api_version='1.11'
+[am__api_version='1.12'
 dnl Some users find AM_AUTOMAKE_VERSION and mistake it for a way to
 dnl require some minimum version.  Point them to the right macro.
-m4_if([$1], [1.11.3], [],
+m4_if([$1], [1.12.6], [],
       [AC_FATAL([Do not call $0, use AM_INIT_AUTOMAKE([$1]).])])dnl
 ])
 
@@ -54,24 +50,22 @@ m4_define([_AM_AUTOCONF_VERSION], [])
 # Call AM_AUTOMAKE_VERSION and AM_AUTOMAKE_VERSION so they can be traced.
 # This function is AC_REQUIREd by AM_INIT_AUTOMAKE.
 AC_DEFUN([AM_SET_CURRENT_AUTOMAKE_VERSION],
-[AM_AUTOMAKE_VERSION([1.11.3])dnl
+[AM_AUTOMAKE_VERSION([1.12.6])dnl
 m4_ifndef([AC_AUTOCONF_VERSION],
   [m4_copy([m4_PACKAGE_VERSION], [AC_AUTOCONF_VERSION])])dnl
 _AM_AUTOCONF_VERSION(m4_defn([AC_AUTOCONF_VERSION]))])
 
 # AM_AUX_DIR_EXPAND                                         -*- Autoconf -*-
 
-# Copyright (C) 2001, 2003, 2005, 2011 Free Software Foundation, Inc.
+# Copyright (C) 2001-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 1
-
 # For projects using AC_CONFIG_AUX_DIR([foo]), Autoconf sets
-# $ac_aux_dir to `$srcdir/foo'.  In other projects, it is set to
-# `$srcdir', `$srcdir/..', or `$srcdir/../..'.
+# $ac_aux_dir to '$srcdir/foo'.  In other projects, it is set to
+# '$srcdir', '$srcdir/..', or '$srcdir/../..'.
 #
 # Of course, Automake must honor this variable whenever it calls a
 # tool from the auxiliary directory.  The problem is that $srcdir (and
@@ -90,7 +84,7 @@ _AM_AUTOCONF_VERSION(m4_defn([AC_AUTOCONF_VERSION]))])
 #
 # The reason of the latter failure is that $top_srcdir and $ac_aux_dir
 # are both prefixed by $srcdir.  In an in-source build this is usually
-# harmless because $srcdir is `.', but things will broke when you
+# harmless because $srcdir is '.', but things will broke when you
 # start a VPATH build or use an absolute $srcdir.
 #
 # So we could use something similar to $top_srcdir/$ac_aux_dir/missing,
@@ -116,22 +110,19 @@ am_aux_dir=`cd $ac_aux_dir && pwd`
 
 # AM_CONDITIONAL                                            -*- Autoconf -*-
 
-# Copyright (C) 1997, 2000, 2001, 2003, 2004, 2005, 2006, 2008
-# Free Software Foundation, Inc.
+# Copyright (C) 1997-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 9
-
 # AM_CONDITIONAL(NAME, SHELL-CONDITION)
 # -------------------------------------
 # Define a conditional.
 AC_DEFUN([AM_CONDITIONAL],
-[AC_PREREQ(2.52)dnl
- ifelse([$1], [TRUE],  [AC_FATAL([$0: invalid condition: $1])],
-	[$1], [FALSE], [AC_FATAL([$0: invalid condition: $1])])dnl
+[AC_PREREQ([2.52])dnl
+ m4_if([$1], [TRUE],  [AC_FATAL([$0: invalid condition: $1])],
+       [$1], [FALSE], [AC_FATAL([$0: invalid condition: $1])])dnl
 AC_SUBST([$1_TRUE])dnl
 AC_SUBST([$1_FALSE])dnl
 _AM_SUBST_NOTMAKE([$1_TRUE])dnl
@@ -150,16 +141,14 @@ AC_CONFIG_COMMANDS_PRE(
 Usually this means the macro was only invoked conditionally.]])
 fi])])
 
-# Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2009,
-# 2010, 2011 Free Software Foundation, Inc.
+# Copyright (C) 1999-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 12
 
-# There are a few dirty hacks below to avoid letting `AC_PROG_CC' be
+# There are a few dirty hacks below to avoid letting 'AC_PROG_CC' be
 # written in clear, in which case automake, when reading aclocal.m4,
 # will think it sees a *use*, and therefore will trigger all it's
 # C support machinery.  Also note that it means that autoscan, seeing
@@ -169,7 +158,7 @@ fi])])
 # _AM_DEPENDENCIES(NAME)
 # ----------------------
 # See how the compiler implements dependency checking.
-# NAME is "CC", "CXX", "GCJ", or "OBJC".
+# NAME is "CC", "CXX", "OBJC", "OBJCXX", "UPC", or "GJC".
 # We try a few techniques and use that to set a single cache variable.
 #
 # We don't AC_REQUIRE the corresponding AC_PROG_CC since the latter was
@@ -182,12 +171,13 @@ AC_REQUIRE([AM_OUTPUT_DEPENDENCY_COMMANDS])dnl
 AC_REQUIRE([AM_MAKE_INCLUDE])dnl
 AC_REQUIRE([AM_DEP_TRACK])dnl
 
-ifelse([$1], CC,   [depcc="$CC"   am_compiler_list=],
-       [$1], CXX,  [depcc="$CXX"  am_compiler_list=],
-       [$1], OBJC, [depcc="$OBJC" am_compiler_list='gcc3 gcc'],
-       [$1], UPC,  [depcc="$UPC"  am_compiler_list=],
-       [$1], GCJ,  [depcc="$GCJ"  am_compiler_list='gcc3 gcc'],
-                   [depcc="$$1"   am_compiler_list=])
+m4_if([$1], [CC],   [depcc="$CC"   am_compiler_list=],
+      [$1], [CXX],  [depcc="$CXX"  am_compiler_list=],
+      [$1], [OBJC], [depcc="$OBJC" am_compiler_list='gcc3 gcc'],
+      [$1], [OBJCXX], [depcc="$OBJCXX" am_compiler_list='gcc3 gcc'],
+      [$1], [UPC],  [depcc="$UPC"  am_compiler_list=],
+      [$1], [GCJ],  [depcc="$GCJ"  am_compiler_list='gcc3 gcc'],
+                    [depcc="$$1"   am_compiler_list=])
 
 AC_CACHE_CHECK([dependency style of $depcc],
                [am_cv_$1_dependencies_compiler_type],
@@ -195,8 +185,8 @@ AC_CACHE_CHECK([dependency style of $depcc],
   # We make a subdir and do the tests there.  Otherwise we can end up
   # making bogus files that we don't know about and never remove.  For
   # instance it was reported that on HP-UX the gcc test will end up
-  # making a dummy file named `D' -- because `-MD' means `put the output
-  # in D'.
+  # making a dummy file named 'D' -- because '-MD' means "put the output
+  # in D".
   rm -rf conftest.dir
   mkdir conftest.dir
   # Copy depcomp to subdir because otherwise we won't find it if we're
@@ -236,16 +226,16 @@ AC_CACHE_CHECK([dependency style of $depcc],
     : > sub/conftest.c
     for i in 1 2 3 4 5 6; do
       echo '#include "conftst'$i'.h"' >> sub/conftest.c
-      # Using `: > sub/conftst$i.h' creates only sub/conftst1.h with
-      # Solaris 8's {/usr,}/bin/sh.
-      touch sub/conftst$i.h
+      # Using ": > sub/conftst$i.h" creates only sub/conftst1.h with
+      # Solaris 10 /bin/sh.
+      echo '/* dummy */' > sub/conftst$i.h
     done
     echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
 
-    # We check with `-c' and `-o' for the sake of the "dashmstdout"
+    # We check with '-c' and '-o' for the sake of the "dashmstdout"
     # mode.  It turns out that the SunPro C++ compiler does not properly
-    # handle `-M -o', and we need to detect this.  Also, some Intel
-    # versions had trouble with output in subdirs
+    # handle '-M -o', and we need to detect this.  Also, some Intel
+    # versions had trouble with output in subdirs.
     am__obj=sub/conftest.${OBJEXT-o}
     am__minus_obj="-o $am__obj"
     case $depmode in
@@ -254,8 +244,8 @@ AC_CACHE_CHECK([dependency style of $depcc],
       test "$am__universal" = false || continue
       ;;
     nosideeffect)
-      # after this tag, mechanisms are not by side-effect, so they'll
-      # only be used when explicitly requested
+      # After this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested.
       if test "x$enable_dependency_tracking" = xyes; then
 	continue
       else
@@ -263,7 +253,7 @@ AC_CACHE_CHECK([dependency style of $depcc],
       fi
       ;;
     msvc7 | msvc7msys | msvisualcpp | msvcmsys)
-      # This compiler won't grok `-c -o', but also, the minuso test has
+      # This compiler won't grok '-c -o', but also, the minuso test has
       # not run yet.  These depmodes are late enough in the game, and
       # so weak that their functioning should not be impacted.
       am__obj=conftest.${OBJEXT-o}
@@ -311,7 +301,7 @@ AM_CONDITIONAL([am__fastdep$1], [
 # AM_SET_DEPDIR
 # -------------
 # Choose a directory name for dependency files.
-# This macro is AC_REQUIREd in _AM_DEPENDENCIES
+# This macro is AC_REQUIREd in _AM_DEPENDENCIES.
 AC_DEFUN([AM_SET_DEPDIR],
 [AC_REQUIRE([AM_SET_LEADING_DOT])dnl
 AC_SUBST([DEPDIR], ["${am__leading_dot}deps"])dnl
@@ -321,9 +311,13 @@ AC_SUBST([DEPDIR], ["${am__leading_dot}deps"])dnl
 # AM_DEP_TRACK
 # ------------
 AC_DEFUN([AM_DEP_TRACK],
-[AC_ARG_ENABLE(dependency-tracking,
-[  --disable-dependency-tracking  speeds up one-time build
-  --enable-dependency-tracking   do not reject slow dependency extractors])
+[AC_ARG_ENABLE([dependency-tracking], [dnl
+AS_HELP_STRING(
+  [--enable-dependency-tracking],
+  [do not reject slow dependency extractors])
+AS_HELP_STRING(
+  [--disable-dependency-tracking],
+  [speeds up one-time build])])
 if test "x$enable_dependency_tracking" != xno; then
   am_depcomp="$ac_aux_dir/depcomp"
   AMDEPBACKSLASH='\'
@@ -338,14 +332,12 @@ _AM_SUBST_NOTMAKE([am__nodep])dnl
 
 # Generate code to set up dependency tracking.              -*- Autoconf -*-
 
-# Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2008
-# Free Software Foundation, Inc.
+# Copyright (C) 1999-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-#serial 5
 
 # _AM_OUTPUT_DEPENDENCY_COMMANDS
 # ------------------------------
@@ -364,7 +356,7 @@ AC_DEFUN([_AM_OUTPUT_DEPENDENCY_COMMANDS],
     # Strip MF so we end up with the name of the file.
     mf=`echo "$mf" | sed -e 's/:.*$//'`
     # Check whether this is an Automake generated Makefile or not.
-    # We used to match only the files named `Makefile.in', but
+    # We used to match only the files named 'Makefile.in', but
     # some people rename them; so instead we look at the file content.
     # Grep'ing the first line is not enough: some people post-process
     # each Makefile.in and add a new line on top of each file to say so.
@@ -376,21 +368,19 @@ AC_DEFUN([_AM_OUTPUT_DEPENDENCY_COMMANDS],
       continue
     fi
     # Extract the definition of DEPDIR, am__include, and am__quote
-    # from the Makefile without running `make'.
+    # from the Makefile without running 'make'.
     DEPDIR=`sed -n 's/^DEPDIR = //p' < "$mf"`
     test -z "$DEPDIR" && continue
     am__include=`sed -n 's/^am__include = //p' < "$mf"`
     test -z "am__include" && continue
     am__quote=`sed -n 's/^am__quote = //p' < "$mf"`
-    # When using ansi2knr, U may be empty or an underscore; expand it
-    U=`sed -n 's/^U = //p' < "$mf"`
     # Find all dependency output files, they are included files with
     # $(DEPDIR) in their names.  We invoke sed twice because it is the
     # simplest approach to changing $(DEPDIR) to its actual value in the
     # expansion.
     for file in `sed -n "
       s/^$am__include $am__quote\(.*(DEPDIR).*\)$am__quote"'$/\1/p' <"$mf" | \
-	 sed -e 's/\$(DEPDIR)/'"$DEPDIR"'/g' -e 's/\$U/'"$U"'/g'`; do
+	 sed -e 's/\$(DEPDIR)/'"$DEPDIR"'/g'`; do
       # Make sure the directory exists.
       test -f "$dirpart/$file" && continue
       fdir=`AS_DIRNAME(["$file"])`
@@ -408,7 +398,7 @@ AC_DEFUN([_AM_OUTPUT_DEPENDENCY_COMMANDS],
 # This macro should only be invoked once -- use via AC_REQUIRE.
 #
 # This code is only required when automatic dependency tracking
-# is enabled.  FIXME.  This creates each `.P' file that we will
+# is enabled.  FIXME.  This creates each '.P' file that we will
 # need in order to bootstrap the dependency handling code.
 AC_DEFUN([AM_OUTPUT_DEPENDENCY_COMMANDS],
 [AC_CONFIG_COMMANDS([depfiles],
@@ -416,29 +406,14 @@ AC_DEFUN([AM_OUTPUT_DEPENDENCY_COMMANDS],
      [AMDEP_TRUE="$AMDEP_TRUE" ac_aux_dir="$ac_aux_dir"])
 ])
 
-# Copyright (C) 1996, 1997, 2000, 2001, 2003, 2005
-# Free Software Foundation, Inc.
-#
-# This file is free software; the Free Software Foundation
-# gives unlimited permission to copy and/or distribute it,
-# with or without modifications, as long as this notice is preserved.
-
-# serial 8
-
-# AM_CONFIG_HEADER is obsolete.  It has been replaced by AC_CONFIG_HEADERS.
-AU_DEFUN([AM_CONFIG_HEADER], [AC_CONFIG_HEADERS($@)])
-
 # Do all the work for Automake.                             -*- Autoconf -*-
 
-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
-# 2005, 2006, 2008, 2009 Free Software Foundation, Inc.
+# Copyright (C) 1996-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 16
-
 # This macro actually does too much.  Some checks are only needed if
 # your package does certain things.  But this isn't really a big deal.
 
@@ -483,31 +458,41 @@ AC_SUBST([CYGPATH_W])
 # Define the identity of the package.
 dnl Distinguish between old-style and new-style calls.
 m4_ifval([$2],
-[m4_ifval([$3], [_AM_SET_OPTION([no-define])])dnl
+[AC_DIAGNOSE([obsolete],
+[$0: two- and three-arguments forms are deprecated.  For more info, see:
+http://www.gnu.org/software/automake/manual/automake.html#Modernize-AM_INIT_AUTOMAKE-invocation])
+m4_ifval([$3], [_AM_SET_OPTION([no-define])])dnl
  AC_SUBST([PACKAGE], [$1])dnl
  AC_SUBST([VERSION], [$2])],
 [_AM_SET_OPTIONS([$1])dnl
 dnl Diagnose old-style AC_INIT with new-style AM_AUTOMAKE_INIT.
-m4_if(m4_ifdef([AC_PACKAGE_NAME], 1)m4_ifdef([AC_PACKAGE_VERSION], 1), 11,,
+m4_if(
+  m4_ifdef([AC_PACKAGE_NAME], [ok]):m4_ifdef([AC_PACKAGE_VERSION], [ok]),
+  [ok:ok],,
   [m4_fatal([AC_INIT should be called with package and version arguments])])dnl
  AC_SUBST([PACKAGE], ['AC_PACKAGE_TARNAME'])dnl
  AC_SUBST([VERSION], ['AC_PACKAGE_VERSION'])])dnl
 
 _AM_IF_OPTION([no-define],,
-[AC_DEFINE_UNQUOTED(PACKAGE, "$PACKAGE", [Name of package])
- AC_DEFINE_UNQUOTED(VERSION, "$VERSION", [Version number of package])])dnl
+[AC_DEFINE_UNQUOTED([PACKAGE], ["$PACKAGE"], [Name of package])
+ AC_DEFINE_UNQUOTED([VERSION], ["$VERSION"], [Version number of package])])dnl
 
 # Some tools Automake needs.
 AC_REQUIRE([AM_SANITY_CHECK])dnl
 AC_REQUIRE([AC_ARG_PROGRAM])dnl
-AM_MISSING_PROG(ACLOCAL, aclocal-${am__api_version})
-AM_MISSING_PROG(AUTOCONF, autoconf)
-AM_MISSING_PROG(AUTOMAKE, automake-${am__api_version})
-AM_MISSING_PROG(AUTOHEADER, autoheader)
-AM_MISSING_PROG(MAKEINFO, makeinfo)
+AM_MISSING_PROG([ACLOCAL], [aclocal-${am__api_version}])
+AM_MISSING_PROG([AUTOCONF], [autoconf])
+AM_MISSING_PROG([AUTOMAKE], [automake-${am__api_version}])
+AM_MISSING_PROG([AUTOHEADER], [autoheader])
+AM_MISSING_PROG([MAKEINFO], [makeinfo])
 AC_REQUIRE([AM_PROG_INSTALL_SH])dnl
 AC_REQUIRE([AM_PROG_INSTALL_STRIP])dnl
-AC_REQUIRE([AM_PROG_MKDIR_P])dnl
+AC_REQUIRE([AC_PROG_MKDIR_P])dnl
+# For better backward compatibility.  To be removed once Automake 1.9.x
+# dies out for good.  For more background, see:
+# <http://lists.gnu.org/archive/html/automake/2012-07/msg00001.html>
+# <http://lists.gnu.org/archive/html/automake/2012-07/msg00014.html>
+AC_SUBST([mkdir_p], ['$(MKDIR_P)'])
 # We need awk for the "check" target.  The system "awk" is bad on
 # some platforms.
 AC_REQUIRE([AC_PROG_AWK])dnl
@@ -518,28 +503,35 @@ _AM_IF_OPTION([tar-ustar], [_AM_PROG_TAR([ustar])],
 			     [_AM_PROG_TAR([v7])])])
 _AM_IF_OPTION([no-dependencies],,
 [AC_PROVIDE_IFELSE([AC_PROG_CC],
-		  [_AM_DEPENDENCIES(CC)],
-		  [define([AC_PROG_CC],
-			  defn([AC_PROG_CC])[_AM_DEPENDENCIES(CC)])])dnl
+		  [_AM_DEPENDENCIES([CC])],
+		  [m4_define([AC_PROG_CC],
+			     m4_defn([AC_PROG_CC])[_AM_DEPENDENCIES([CC])])])dnl
 AC_PROVIDE_IFELSE([AC_PROG_CXX],
-		  [_AM_DEPENDENCIES(CXX)],
-		  [define([AC_PROG_CXX],
-			  defn([AC_PROG_CXX])[_AM_DEPENDENCIES(CXX)])])dnl
+		  [_AM_DEPENDENCIES([CXX])],
+		  [m4_define([AC_PROG_CXX],
+			     m4_defn([AC_PROG_CXX])[_AM_DEPENDENCIES([CXX])])])dnl
 AC_PROVIDE_IFELSE([AC_PROG_OBJC],
-		  [_AM_DEPENDENCIES(OBJC)],
-		  [define([AC_PROG_OBJC],
-			  defn([AC_PROG_OBJC])[_AM_DEPENDENCIES(OBJC)])])dnl
+		  [_AM_DEPENDENCIES([OBJC])],
+		  [m4_define([AC_PROG_OBJC],
+			     m4_defn([AC_PROG_OBJC])[_AM_DEPENDENCIES([OBJC])])])dnl
+dnl Support for Objective C++ was only introduced in Autoconf 2.65,
+dnl but we still cater to Autoconf 2.62.
+m4_ifdef([AC_PROG_OBJCXX],
+[AC_PROVIDE_IFELSE([AC_PROG_OBJCXX],
+		  [_AM_DEPENDENCIES([OBJCXX])],
+		  [m4_define([AC_PROG_OBJCXX],
+			     m4_defn([AC_PROG_OBJCXX])[_AM_DEPENDENCIES([OBJCXX])])])])dnl
 ])
 _AM_IF_OPTION([silent-rules], [AC_REQUIRE([AM_SILENT_RULES])])dnl
-dnl The `parallel-tests' driver may need to know about EXEEXT, so add the
-dnl `am__EXEEXT' conditional if _AM_COMPILER_EXEEXT was seen.  This macro
+dnl The 'parallel-tests' driver may need to know about EXEEXT, so add the
+dnl 'am__EXEEXT' conditional if _AM_COMPILER_EXEEXT was seen.  This macro
 dnl is hooked onto _AC_COMPILER_EXEEXT early, see below.
 AC_CONFIG_COMMANDS_PRE(dnl
 [m4_provide_if([_AM_COMPILER_EXEEXT],
   [AM_CONDITIONAL([am__EXEEXT], [test -n "$EXEEXT"])])])dnl
 ])
 
-dnl Hook into `_AC_COMPILER_EXEEXT' early to learn its expansion.  Do not
+dnl Hook into '_AC_COMPILER_EXEEXT' early to learn its expansion.  Do not
 dnl add the conditional right here, as _AC_COMPILER_EXEEXT may be further
 dnl mangled by Autoconf and run in a shell conditional statement.
 m4_define([_AC_COMPILER_EXEEXT],
@@ -567,15 +559,12 @@ for _am_header in $config_headers :; do
 done
 echo "timestamp for $_am_arg" >`AS_DIRNAME(["$_am_arg"])`/stamp-h[]$_am_stamp_count])
 
-# Copyright (C) 2001, 2003, 2005, 2008, 2011 Free Software Foundation,
-# Inc.
+# Copyright (C) 2001-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 1
-
 # AM_PROG_INSTALL_SH
 # ------------------
 # Define $install_sh.
@@ -589,16 +578,14 @@ if test x"${install_sh}" != xset; then
     install_sh="\${SHELL} $am_aux_dir/install-sh"
   esac
 fi
-AC_SUBST(install_sh)])
+AC_SUBST([install_sh])])
 
-# Copyright (C) 2003, 2005  Free Software Foundation, Inc.
+# Copyright (C) 2003-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 2
-
 # Check whether the underlying file-system supports filenames
 # with a leading dot.  For instance MS-DOS doesn't.
 AC_DEFUN([AM_SET_LEADING_DOT],
@@ -615,20 +602,17 @@ AC_SUBST([am__leading_dot])])
 # Add --enable-maintainer-mode option to configure.         -*- Autoconf -*-
 # From Jim Meyering
 
-# Copyright (C) 1996, 1998, 2000, 2001, 2002, 2003, 2004, 2005, 2008,
-# 2011 Free Software Foundation, Inc.
+# Copyright (C) 1996-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 5
-
 # AM_MAINTAINER_MODE([DEFAULT-MODE])
 # ----------------------------------
 # Control maintainer-specific portions of Makefiles.
-# Default is to disable them, unless `enable' is passed literally.
-# For symmetry, `disable' may be passed as well.  Anyway, the user
+# Default is to disable them, unless 'enable' is passed literally.
+# For symmetry, 'disable' may be passed as well.  Anyway, the user
 # can override the default with the --enable/--disable switch.
 AC_DEFUN([AM_MAINTAINER_MODE],
 [m4_case(m4_default([$1], [disable]),
@@ -639,10 +623,11 @@ AC_DEFUN([AM_MAINTAINER_MODE],
 AC_MSG_CHECKING([whether to enable maintainer-specific portions of Makefiles])
   dnl maintainer-mode's default is 'disable' unless 'enable' is passed
   AC_ARG_ENABLE([maintainer-mode],
-[  --][am_maintainer_other][-maintainer-mode  am_maintainer_other make rules and dependencies not useful
-			  (and sometimes confusing) to the casual installer],
-      [USE_MAINTAINER_MODE=$enableval],
-      [USE_MAINTAINER_MODE=]m4_if(am_maintainer_other, [enable], [no], [yes]))
+    [AS_HELP_STRING([--]am_maintainer_other[-maintainer-mode],
+      am_maintainer_other[ make rules and dependencies not useful
+      (and sometimes confusing) to the casual installer])],
+    [USE_MAINTAINER_MODE=$enableval],
+    [USE_MAINTAINER_MODE=]m4_if(am_maintainer_other, [enable], [no], [yes]))
   AC_MSG_RESULT([$USE_MAINTAINER_MODE])
   AM_CONDITIONAL([MAINTAINER_MODE], [test $USE_MAINTAINER_MODE = yes])
   MAINT=$MAINTAINER_MODE_TRUE
@@ -654,14 +639,12 @@ AU_DEFUN([jm_MAINTAINER_MODE], [AM_MAINTAINER_MODE])
 
 # Check to see how 'make' treats includes.	            -*- Autoconf -*-
 
-# Copyright (C) 2001, 2002, 2003, 2005, 2009  Free Software Foundation, Inc.
+# Copyright (C) 2001-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 4
-
 # AM_MAKE_INCLUDE()
 # -----------------
 # Check to see how make treats includes.
@@ -679,7 +662,7 @@ am__quote=
 _am_result=none
 # First try GNU make style include.
 echo "include confinc" > confmf
-# Ignore all kinds of additional output from `make'.
+# Ignore all kinds of additional output from 'make'.
 case `$am_make -s -f confmf 2> /dev/null` in #(
 *the\ am__doit\ target*)
   am__include=include
@@ -704,15 +687,12 @@ AC_MSG_RESULT([$_am_result])
 rm -f confinc confmf
 ])
 
-# Copyright (C) 1999, 2000, 2001, 2003, 2004, 2005, 2008
-# Free Software Foundation, Inc.
+# Copyright (C) 1999-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 6
-
 # AM_PROG_CC_C_O
 # --------------
 # Like AC_PROG_CC_C_O, but changed for automake.
@@ -741,15 +721,12 @@ m4_define([AC_PROG_CC],
 
 # Fake the existence of programs that GNU maintainers use.  -*- Autoconf -*-
 
-# Copyright (C) 1997, 1999, 2000, 2001, 2003, 2004, 2005, 2008
-# Free Software Foundation, Inc.
+# Copyright (C) 1997-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 6
-
 # AM_MISSING_PROG(NAME, PROGRAM)
 # ------------------------------
 AC_DEFUN([AM_MISSING_PROG],
@@ -757,7 +734,6 @@ AC_DEFUN([AM_MISSING_PROG],
 $1=${$1-"${am_missing_run}$2"}
 AC_SUBST($1)])
 
-
 # AM_MISSING_HAS_RUN
 # ------------------
 # Define MISSING if not defined so far and test if it supports --run.
@@ -778,25 +754,27 @@ if eval "$MISSING --run true"; then
   am_missing_run="$MISSING --run "
 else
   am_missing_run=
-  AC_MSG_WARN([`missing' script is too old or missing])
+  AC_MSG_WARN(['missing' script is too old or missing])
 fi
 ])
 
-# Copyright (C) 2003, 2004, 2005, 2006, 2011 Free Software Foundation,
-# Inc.
+# Copyright (C) 2003-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 1
-
 # AM_PROG_MKDIR_P
 # ---------------
-# Check for `mkdir -p'.
+# Check for 'mkdir -p'.
 AC_DEFUN([AM_PROG_MKDIR_P],
 [AC_PREREQ([2.60])dnl
 AC_REQUIRE([AC_PROG_MKDIR_P])dnl
+dnl FIXME to be removed in Automake 1.13.
+AC_DIAGNOSE([obsolete],
+[$0: this macro is deprecated, and will soon be removed.
+You should use the Autoconf-provided 'AC][_PROG_MKDIR_P' macro instead,
+and use '$(MKDIR_P)' instead of '$(mkdir_p)'in your Makefile.am files.])
 dnl Automake 1.8 to 1.9.6 used to define mkdir_p.  We now use MKDIR_P,
 dnl while keeping a definition of mkdir_p for backward compatibility.
 dnl @MKDIR_P@ is magic: AC_OUTPUT adjusts its value for each Makefile.
@@ -813,15 +791,12 @@ esac
 
 # Helper functions for option handling.                     -*- Autoconf -*-
 
-# Copyright (C) 2001, 2002, 2003, 2005, 2008, 2010 Free Software
-# Foundation, Inc.
+# Copyright (C) 2001-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 5
-
 # _AM_MANGLE_OPTION(NAME)
 # -----------------------
 AC_DEFUN([_AM_MANGLE_OPTION],
@@ -831,7 +806,7 @@ AC_DEFUN([_AM_MANGLE_OPTION],
 # --------------------
 # Set option NAME.  Presently that only means defining a flag for this option.
 AC_DEFUN([_AM_SET_OPTION],
-[m4_define(_AM_MANGLE_OPTION([$1]), 1)])
+[m4_define(_AM_MANGLE_OPTION([$1]), [1])])
 
 # _AM_SET_OPTIONS(OPTIONS)
 # ------------------------
@@ -847,22 +822,16 @@ AC_DEFUN([_AM_IF_OPTION],
 
 # Check to make sure that the build environment is sane.    -*- Autoconf -*-
 
-# Copyright (C) 1996, 1997, 2000, 2001, 2003, 2005, 2008
-# Free Software Foundation, Inc.
+# Copyright (C) 1996-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 5
-
 # AM_SANITY_CHECK
 # ---------------
 AC_DEFUN([AM_SANITY_CHECK],
 [AC_MSG_CHECKING([whether build environment is sane])
-# Just in case
-sleep 1
-echo timestamp > conftest.file
 # Reject unsafe characters in $srcdir or the absolute working directory
 # name.  Accept space and tab only in the latter.
 am_lf='
@@ -873,32 +842,40 @@ case `pwd` in
 esac
 case $srcdir in
   *[[\\\"\#\$\&\'\`$am_lf\ \	]]*)
-    AC_MSG_ERROR([unsafe srcdir value: `$srcdir']);;
+    AC_MSG_ERROR([unsafe srcdir value: '$srcdir']);;
 esac
 
-# Do `set' in a subshell so we don't clobber the current shell's
+# Do 'set' in a subshell so we don't clobber the current shell's
 # arguments.  Must try -L first in case configure is actually a
 # symlink; some systems play weird games with the mod time of symlinks
 # (eg FreeBSD returns the mod time of the symlink's containing
 # directory).
 if (
-   set X `ls -Lt "$srcdir/configure" conftest.file 2> /dev/null`
-   if test "$[*]" = "X"; then
-      # -L didn't work.
-      set X `ls -t "$srcdir/configure" conftest.file`
-   fi
-   rm -f conftest.file
-   if test "$[*]" != "X $srcdir/configure conftest.file" \
-      && test "$[*]" != "X conftest.file $srcdir/configure"; then
-
-      # If neither matched, then we have a broken ls.  This can happen
-      # if, for instance, CONFIG_SHELL is bash and it inherits a
-      # broken ls alias from the environment.  This has actually
-      # happened.  Such a system could not be considered "sane".
-      AC_MSG_ERROR([ls -t appears to fail.  Make sure there is not a broken
-alias in your environment])
-   fi
-
+   am_has_slept=no
+   for am_try in 1 2; do
+     echo "timestamp, slept: $am_has_slept" > conftest.file
+     set X `ls -Lt "$srcdir/configure" conftest.file 2> /dev/null`
+     if test "$[*]" = "X"; then
+	# -L didn't work.
+	set X `ls -t "$srcdir/configure" conftest.file`
+     fi
+     if test "$[*]" != "X $srcdir/configure conftest.file" \
+	&& test "$[*]" != "X conftest.file $srcdir/configure"; then
+
+	# If neither matched, then we have a broken ls.  This can happen
+	# if, for instance, CONFIG_SHELL is bash and it inherits a
+	# broken ls alias from the environment.  This has actually
+	# happened.  Such a system could not be considered "sane".
+	AC_MSG_ERROR([ls -t appears to fail.  Make sure there is not a broken
+  alias in your environment])
+     fi
+     if test "$[2]" = conftest.file || test $am_try -eq 2; then
+       break
+     fi
+     # Just in case.
+     sleep 1
+     am_has_slept=yes
+   done
    test "$[2]" = conftest.file
    )
 then
@@ -908,31 +885,50 @@ else
    AC_MSG_ERROR([newly created file is older than distributed files!
 Check your system clock])
 fi
-AC_MSG_RESULT(yes)])
+AC_MSG_RESULT([yes])
+# If we didn't sleep, we still need to ensure time stamps of config.status and
+# generated files are strictly newer.
+am_sleep_pid=
+if grep 'slept: no' conftest.file >/dev/null 2>&1; then
+  ( sleep 1 ) &
+  am_sleep_pid=$!
+fi
+AC_CONFIG_COMMANDS_PRE(
+  [AC_MSG_CHECKING([that generated files are newer than configure])
+   if test -n "$am_sleep_pid"; then
+     # Hide warnings about reused PIDs.
+     wait $am_sleep_pid 2>/dev/null
+   fi
+   AC_MSG_RESULT([done])])
+rm -f conftest.file
+])
 
-# Copyright (C) 2009, 2011  Free Software Foundation, Inc.
+# Copyright (C) 2009-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 2
-
 # AM_SILENT_RULES([DEFAULT])
 # --------------------------
 # Enable less verbose build rules; with the default set to DEFAULT
-# (`yes' being less verbose, `no' or empty being verbose).
+# ("yes" being less verbose, "no" or empty being verbose).
 AC_DEFUN([AM_SILENT_RULES],
-[AC_ARG_ENABLE([silent-rules],
-[  --enable-silent-rules          less verbose build output (undo: `make V=1')
-  --disable-silent-rules         verbose build output (undo: `make V=0')])
-case $enable_silent_rules in
-yes) AM_DEFAULT_VERBOSITY=0;;
-no)  AM_DEFAULT_VERBOSITY=1;;
-*)   AM_DEFAULT_VERBOSITY=m4_if([$1], [yes], [0], [1]);;
+[AC_ARG_ENABLE([silent-rules], [dnl
+AS_HELP_STRING(
+  [--enable-silent-rules],
+  [less verbose build output (undo: "make V=1")])
+AS_HELP_STRING(
+  [--disable-silent-rules],
+  [verbose build output (undo: "make V=0")])dnl
+])
+case $enable_silent_rules in @%:@ (((
+  yes) AM_DEFAULT_VERBOSITY=0;;
+   no) AM_DEFAULT_VERBOSITY=1;;
+    *) AM_DEFAULT_VERBOSITY=m4_if([$1], [yes], [0], [1]);;
 esac
 dnl
-dnl A few `make' implementations (e.g., NonStop OS and NextStep)
+dnl A few 'make' implementations (e.g., NonStop OS and NextStep)
 dnl do not support nested variable expansions.
 dnl See automake bug#9928 and bug#10237.
 am_make=${MAKE-make}
@@ -950,7 +946,7 @@ else
   am_cv_make_support_nested_variables=no
 fi])
 if test $am_cv_make_support_nested_variables = yes; then
-  dnl Using `$V' instead of `$(V)' breaks IRIX make.
+  dnl Using '$V' instead of '$(V)' breaks IRIX make.
   AM_V='$(V)'
   AM_DEFAULT_V='$(AM_DEFAULT_VERBOSITY)'
 else
@@ -967,44 +963,40 @@ AC_SUBST([AM_BACKSLASH])dnl
 _AM_SUBST_NOTMAKE([AM_BACKSLASH])dnl
 ])
 
-# Copyright (C) 2001, 2003, 2005, 2011 Free Software Foundation, Inc.
+# Copyright (C) 2001-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 1
-
 # AM_PROG_INSTALL_STRIP
 # ---------------------
-# One issue with vendor `install' (even GNU) is that you can't
+# One issue with vendor 'install' (even GNU) is that you can't
 # specify the program used to strip binaries.  This is especially
 # annoying in cross-compiling environments, where the build's strip
 # is unlikely to handle the host's binaries.
 # Fortunately install-sh will honor a STRIPPROG variable, so we
-# always use install-sh in `make install-strip', and initialize
+# always use install-sh in "make install-strip", and initialize
 # STRIPPROG with the value of the STRIP variable (set by the user).
 AC_DEFUN([AM_PROG_INSTALL_STRIP],
 [AC_REQUIRE([AM_PROG_INSTALL_SH])dnl
-# Installed binaries are usually stripped using `strip' when the user
-# run `make install-strip'.  However `strip' might not be the right
+# Installed binaries are usually stripped using 'strip' when the user
+# run "make install-strip".  However 'strip' might not be the right
 # tool to use in cross-compilation environments, therefore Automake
-# will honor the `STRIP' environment variable to overrule this program.
-dnl Don't test for $cross_compiling = yes, because it might be `maybe'.
+# will honor the 'STRIP' environment variable to overrule this program.
+dnl Don't test for $cross_compiling = yes, because it might be 'maybe'.
 if test "$cross_compiling" != no; then
   AC_CHECK_TOOL([STRIP], [strip], :)
 fi
 INSTALL_STRIP_PROGRAM="\$(install_sh) -c -s"
 AC_SUBST([INSTALL_STRIP_PROGRAM])])
 
-# Copyright (C) 2006, 2008, 2010 Free Software Foundation, Inc.
+# Copyright (C) 2006-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 3
-
 # _AM_SUBST_NOTMAKE(VARIABLE)
 # ---------------------------
 # Prevent Automake from outputting VARIABLE = @VARIABLE@ in Makefile.in.
@@ -1018,18 +1010,16 @@ AC_DEFUN([AM_SUBST_NOTMAKE], [_AM_SUBST_NOTMAKE($@)])
 
 # Check how to create a tarball.                            -*- Autoconf -*-
 
-# Copyright (C) 2004, 2005, 2012 Free Software Foundation, Inc.
+# Copyright (C) 2004-2012 Free Software Foundation, Inc.
 #
 # This file is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
 
-# serial 2
-
 # _AM_PROG_TAR(FORMAT)
 # --------------------
 # Check how to create a tarball in format FORMAT.
-# FORMAT should be one of `v7', `ustar', or `pax'.
+# FORMAT should be one of 'v7', 'ustar', or 'pax'.
 #
 # Substitute a variable $(am__tar) that is a command
 # writing to stdout a FORMAT-tarball containing the directory
@@ -1052,7 +1042,7 @@ AC_MSG_CHECKING([how to create a $1 tar archive])
 _am_tools='gnutar m4_if([$1], [ustar], [plaintar]) pax cpio none'
 _am_tools=${am_cv_prog_tar_$1-$_am_tools}
 # Do not fold the above two line into one, because Tru64 sh and
-# Solaris sh will not grok spaces in the rhs of `-'.
+# Solaris sh will not grok spaces in the rhs of '-'.
 for _am_tool in $_am_tools
 do
   case $_am_tool in
diff --git a/autogen.sh b/autogen.sh
index 820a017..9b38463 100755
--- a/autogen.sh
+++ b/autogen.sh
@@ -1,6 +1,12 @@
 #!/bin/sh
 # Run this to generate all the initial makefiles, etc.
 
+test -n "$srcdir" || srcdir=`dirname "$0"`
+test -n "$srcdir" || srcdir=.
+
+olddir=`pwd`
+cd "$srcdir"
+
 DIE=0
 package=gst-plugins-base
 srcfile=gst/audiotestsrc/gstaudiotestsrc.c
@@ -29,6 +35,9 @@ then
     ln -s ../../common/hooks/pre-commit.hook .git/hooks/pre-commit
 fi
 
+# GNU gettext automake support doesn't get along with git.
+# https://bugzilla.gnome.org/show_bug.cgi?id=661128
+touch -t 200001010000 po/gst-plugins-base-0.10.pot
 
 CONFIGURE_DEF_OPT='--enable-maintainer-mode --enable-gtk-doc'
 
@@ -106,13 +115,15 @@ test -n "$NOCONFIGURE" && {
   exit 0
 }
 
+cd "$olddir"
+
 echo "+ running configure ... "
-test ! -z "$CONFIGURE_DEF_OPT" && echo "  ./configure default flags: $CONFIGURE_DEF_OPT"
-test ! -z "$CONFIGURE_EXT_OPT" && echo "  ./configure external flags: $CONFIGURE_EXT_OPT"
-test ! -z "$CONFIGURE_FILE_OPT" && echo "  ./configure enable/disable flags: $CONFIGURE_FILE_OPT"
+test ! -z "$CONFIGURE_DEF_OPT" && echo "  $srcdir/configure default flags: $CONFIGURE_DEF_OPT"
+test ! -z "$CONFIGURE_EXT_OPT" && echo "  $srcdir/configure external flags: $CONFIGURE_EXT_OPT"
+test ! -z "$CONFIGURE_FILE_OPT" && echo "  $srcdir/configure enable/disable flags: $CONFIGURE_FILE_OPT"
 echo
 
-./configure $CONFIGURE_DEF_OPT $CONFIGURE_EXT_OPT $CONFIGURE_FILE_OPT || {
+"$srcdir/configure" $CONFIGURE_DEF_OPT $CONFIGURE_EXT_OPT $CONFIGURE_FILE_OPT || {
         echo "  configure failed"
         exit 1
 }
diff --git a/autoregen.sh b/autoregen.sh
new file mode 100755
index 0000000..c67a299
--- /dev/null
+++ b/autoregen.sh
@@ -0,0 +1,2 @@
+#!/bin/sh
+./autogen.sh  $@
diff --git a/config.h.in b/config.h.in
index 30250fb..84dd1f0 100644
--- a/config.h.in
+++ b/config.h.in
@@ -103,46 +103,46 @@
    the CoreFoundation framework. */
 #undef HAVE_CFPREFERENCESCOPYAPPVALUE
 
-/* Define if the host CPU is an Alpha */
+/* Define if the target CPU is an Alpha */
 #undef HAVE_CPU_ALPHA
 
-/* Define if the host CPU is an ARM */
+/* Define if the target CPU is an ARM */
 #undef HAVE_CPU_ARM
 
-/* Define if the host CPU is a CRIS */
+/* Define if the target CPU is a CRIS */
 #undef HAVE_CPU_CRIS
 
-/* Define if the host CPU is a CRISv32 */
+/* Define if the target CPU is a CRISv32 */
 #undef HAVE_CPU_CRISV32
 
-/* Define if the host CPU is a HPPA */
+/* Define if the target CPU is a HPPA */
 #undef HAVE_CPU_HPPA
 
-/* Define if the host CPU is an x86 */
+/* Define if the target CPU is an x86 */
 #undef HAVE_CPU_I386
 
-/* Define if the host CPU is a IA64 */
+/* Define if the target CPU is a IA64 */
 #undef HAVE_CPU_IA64
 
-/* Define if the host CPU is a M68K */
+/* Define if the target CPU is a M68K */
 #undef HAVE_CPU_M68K
 
-/* Define if the host CPU is a MIPS */
+/* Define if the target CPU is a MIPS */
 #undef HAVE_CPU_MIPS
 
-/* Define if the host CPU is a PowerPC */
+/* Define if the target CPU is a PowerPC */
 #undef HAVE_CPU_PPC
 
-/* Define if the host CPU is a 64 bit PowerPC */
+/* Define if the target CPU is a 64 bit PowerPC */
 #undef HAVE_CPU_PPC64
 
-/* Define if the host CPU is a S390 */
+/* Define if the target CPU is a S390 */
 #undef HAVE_CPU_S390
 
-/* Define if the host CPU is a SPARC */
+/* Define if the target CPU is a SPARC */
 #undef HAVE_CPU_SPARC
 
-/* Define if the host CPU is a x86_64 */
+/* Define if the target CPU is a x86_64 */
 #undef HAVE_CPU_X86_64
 
 /* Define if the GNU dcgettext() function is already present or preinstalled.
@@ -387,6 +387,9 @@
 /* Define to 1 if you have the ANSI C header files. */
 #undef STDC_HEADERS
 
+/* the target CPU */
+#undef TARGET_CPU
+
 /* "Define if building for android" */
 #undef USE_TREMOLO
 
@@ -408,6 +411,11 @@
 /* Define to 1 if the X Window System is missing or not being used. */
 #undef X_DISPLAY_MISSING
 
+/* Enable large inode numbers on Mac OS X 10.5.  */
+#ifndef _DARWIN_USE_64_BIT_INODE
+# define _DARWIN_USE_64_BIT_INODE 1
+#endif
+
 /* Number of bits in a file offset, on hosts where this is settable. */
 #undef _FILE_OFFSET_BITS
 
diff --git a/configure b/configure
index 2f161b5..ae0ed74 100755
--- a/configure
+++ b/configure
@@ -1,13 +1,11 @@
 #! /bin/sh
 # Guess values for system-dependent variables and create Makefiles.
-# Generated by GNU Autoconf 2.68 for GStreamer Base Plug-ins 0.10.36.
+# Generated by GNU Autoconf 2.69 for GStreamer Base Plug-ins 0.10.36.1.
 #
 # Report bugs to <http://bugzilla.gnome.org/enter_bug.cgi?product=GStreamer>.
 #
 #
-# Copyright (C) 1992, 1993, 1994, 1995, 1996, 1998, 1999, 2000, 2001,
-# 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010 Free Software
-# Foundation, Inc.
+# Copyright (C) 1992-1996, 1998-2012 Free Software Foundation, Inc.
 #
 #
 # This configure script is free software; the Free Software Foundation
@@ -136,6 +134,31 @@ export LANGUAGE
 # CDPATH.
 (unset CDPATH) >/dev/null 2>&1 && unset CDPATH
 
+# Use a proper internal environment variable to ensure we don't fall
+  # into an infinite loop, continuously re-executing ourselves.
+  if test x"${_as_can_reexec}" != xno && test "x$CONFIG_SHELL" != x; then
+    _as_can_reexec=no; export _as_can_reexec;
+    # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+as_fn_exit 255
+  fi
+  # We don't want this to propagate to other subprocesses.
+          { _as_can_reexec=; unset _as_can_reexec;}
 if test "x$CONFIG_SHELL" = x; then
   as_bourne_compatible="if test -n \"\${ZSH_VERSION+set}\" && (emulate sh) >/dev/null 2>&1; then :
   emulate sh
@@ -169,7 +192,8 @@ if ( set x; as_fn_ret_success y && test x = \"\$1\" ); then :
 else
   exitcode=1; echo positional parameters were not saved.
 fi
-test x\$exitcode = x0 || exit 1"
+test x\$exitcode = x0 || exit 1
+test -x / || exit 1"
   as_suggested="  as_lineno_1=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_1a=\$LINENO
   as_lineno_2=";as_suggested=$as_suggested$LINENO;as_suggested=$as_suggested" as_lineno_2a=\$LINENO
   eval 'test \"x\$as_lineno_1'\$as_run'\" != \"x\$as_lineno_2'\$as_run'\" &&
@@ -222,21 +246,25 @@ IFS=$as_save_IFS
 
 
       if test "x$CONFIG_SHELL" != x; then :
-  # We cannot yet assume a decent shell, so we have to provide a
-	# neutralization value for shells without unset; and this also
-	# works around shells that cannot unset nonexistent variables.
-	# Preserve -v and -x to the replacement shell.
-	BASH_ENV=/dev/null
-	ENV=/dev/null
-	(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
-	export CONFIG_SHELL
-	case $- in # ((((
-	  *v*x* | *x*v* ) as_opts=-vx ;;
-	  *v* ) as_opts=-v ;;
-	  *x* ) as_opts=-x ;;
-	  * ) as_opts= ;;
-	esac
-	exec "$CONFIG_SHELL" $as_opts "$as_myself" ${1+"$@"}
+  export CONFIG_SHELL
+             # We cannot yet assume a decent shell, so we have to provide a
+# neutralization value for shells without unset; and this also
+# works around shells that cannot unset nonexistent variables.
+# Preserve -v and -x to the replacement shell.
+BASH_ENV=/dev/null
+ENV=/dev/null
+(unset BASH_ENV) >/dev/null 2>&1 && unset BASH_ENV ENV
+case $- in # ((((
+  *v*x* | *x*v* ) as_opts=-vx ;;
+  *v* ) as_opts=-v ;;
+  *x* ) as_opts=-x ;;
+  * ) as_opts= ;;
+esac
+exec $CONFIG_SHELL $as_opts "$as_myself" ${1+"$@"}
+# Admittedly, this is quite paranoid, since all the known shells bail
+# out after a failed `exec'.
+$as_echo "$0: could not re-execute with $CONFIG_SHELL" >&2
+exit 255
 fi
 
     if test x$as_have_required = xno; then :
@@ -340,6 +368,14 @@ $as_echo X"$as_dir" |
 
 
 } # as_fn_mkdir_p
+
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
 # as_fn_append VAR VALUE
 # ----------------------
 # Append the text in VALUE to the end of the definition contained in VAR. Take
@@ -461,6 +497,10 @@ as_cr_alnum=$as_cr_Letters$as_cr_digits
   chmod +x "$as_me.lineno" ||
     { $as_echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2; as_fn_exit 1; }
 
+  # If we had to re-execute with $CONFIG_SHELL, we're ensured to have
+  # already done that, so ensure we don't try to do so again and fall
+  # in an infinite loop.  This has already happened in practice.
+  _as_can_reexec=no; export _as_can_reexec
   # Don't try to exec as it changes $[0], causing all sort of problems
   # (the dirname of $[0] is not the place where we might find the
   # original and so on.  Autoconf is especially sensitive to this).
@@ -495,16 +535,16 @@ if (echo >conf$$.file) 2>/dev/null; then
     # ... but there are two gotchas:
     # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
     # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
+    # In both cases, we have to default to `cp -pR'.
     ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
+      as_ln_s='cp -pR'
   elif ln conf$$.file conf$$ 2>/dev/null; then
     as_ln_s=ln
   else
-    as_ln_s='cp -p'
+    as_ln_s='cp -pR'
   fi
 else
-  as_ln_s='cp -p'
+  as_ln_s='cp -pR'
 fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
@@ -516,28 +556,8 @@ else
   as_mkdir_p=false
 fi
 
-if test -x / >/dev/null 2>&1; then
-  as_test_x='test -x'
-else
-  if ls -dL / >/dev/null 2>&1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d "$1"; then
-	test -d "$1/.";
-      else
-	case $1 in #(
-	-*)set "./$1";;
-	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -571,8 +591,8 @@ MAKEFLAGS=
 # Identity of this package.
 PACKAGE_NAME='GStreamer Base Plug-ins'
 PACKAGE_TARNAME='gst-plugins-base'
-PACKAGE_VERSION='0.10.36'
-PACKAGE_STRING='GStreamer Base Plug-ins 0.10.36'
+PACKAGE_VERSION='0.10.36.1'
+PACKAGE_STRING='GStreamer Base Plug-ins 0.10.36.1'
 PACKAGE_BUGREPORT='http://bugzilla.gnome.org/enter_bug.cgi?product=GStreamer'
 PACKAGE_URL=''
 
@@ -977,14 +997,6 @@ AM_BACKSLASH
 AM_DEFAULT_VERBOSITY
 AM_DEFAULT_V
 AM_V
-host_os
-host_vendor
-host_cpu
-host
-build_os
-build_vendor
-build_cpu
-build
 MAINT
 MAINTAINER_MODE_FALSE
 MAINTAINER_MODE_TRUE
@@ -1016,6 +1028,18 @@ am__isrc
 INSTALL_DATA
 INSTALL_SCRIPT
 INSTALL_PROGRAM
+target_os
+target_vendor
+target_cpu
+target
+host_os
+host_vendor
+host_cpu
+host
+build_os
+build_vendor
+build_cpu
+build
 target_alias
 host_alias
 build_alias
@@ -1075,6 +1099,7 @@ enable_nls
 enable_rpath
 with_libiconv_prefix
 with_libintl_prefix
+enable_fatal_warnings
 enable_debug
 enable_profiling
 enable_valgrind
@@ -1668,8 +1693,6 @@ target=$target_alias
 if test "x$host_alias" != x; then
   if test "x$build_alias" = x; then
     cross_compiling=maybe
-    $as_echo "$as_me: WARNING: if you wanted to set the --build type, don't use --host.
-    If a cross compiler is detected then cross compile mode will be used" >&2
   elif test "x$build_alias" != "x$host_alias"; then
     cross_compiling=yes
   fi
@@ -1755,7 +1778,7 @@ if test "$ac_init_help" = "long"; then
   # Omit some internal or obsolete options to make the list less imposing.
   # This message is too long to be a string in the A/UX 3.1 sh.
   cat <<_ACEOF
-\`configure' configures GStreamer Base Plug-ins 0.10.36 to adapt to many kinds of systems.
+\`configure' configures GStreamer Base Plug-ins 0.10.36.1 to adapt to many kinds of systems.
 
 Usage: $0 [OPTION]... [VAR=VALUE]...
 
@@ -1825,12 +1848,13 @@ X features:
 System types:
   --build=BUILD     configure for building on BUILD [guessed]
   --host=HOST       cross-compile to build programs to run on HOST [BUILD]
+  --target=TARGET   configure for building compilers for TARGET [HOST]
 _ACEOF
 fi
 
 if test -n "$ac_init_help"; then
   case $ac_init_help in
-     short | recursive ) echo "Configuration of GStreamer Base Plug-ins 0.10.36:";;
+     short | recursive ) echo "Configuration of GStreamer Base Plug-ins 0.10.36.1:";;
    esac
   cat <<\_ACEOF
 
@@ -1838,19 +1862,24 @@ Optional Features:
   --disable-option-checking  ignore unrecognized --enable/--with options
   --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
   --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
-  --enable-maintainer-mode  enable make rules and dependencies not useful
-			  (and sometimes confusing) to the casual installer
-  --enable-silent-rules          less verbose build output (undo: `make V=1')
-  --disable-silent-rules         verbose build output (undo: `make V=0')
+  --enable-maintainer-mode
+                          enable make rules and dependencies not useful (and
+                          sometimes confusing) to the casual installer
+  --enable-silent-rules   less verbose build output (undo: "make V=1")
+  --disable-silent-rules  verbose build output (undo: "make V=0")
   --enable-shared[=PKGS]  build shared libraries [default=yes]
   --enable-static[=PKGS]  build static libraries [default=yes]
   --enable-fast-install[=PKGS]
                           optimize for fast installation [default=yes]
-  --disable-dependency-tracking  speeds up one-time build
-  --enable-dependency-tracking   do not reject slow dependency extractors
+  --enable-dependency-tracking
+                          do not reject slow dependency extractors
+  --disable-dependency-tracking
+                          speeds up one-time build
   --disable-libtool-lock  avoid locking (might break parallel builds)
   --disable-nls           do not use Native Language Support
   --disable-rpath         do not hardcode runtime library paths
+  --disable-fatal-warnings
+                          Don't turn compiler warnings into fatal errors
   --disable-debug         disable addition of -g debugging info
   --enable-profiling      adds -pg to compiler commandline, for profiling
   --disable-valgrind      disable run-time valgrind detection
@@ -2118,10 +2147,10 @@ fi
 test -n "$ac_init_help" && exit $ac_status
 if $ac_init_version; then
   cat <<\_ACEOF
-GStreamer Base Plug-ins configure 0.10.36
-generated by GNU Autoconf 2.68
+GStreamer Base Plug-ins configure 0.10.36.1
+generated by GNU Autoconf 2.69
 
-Copyright (C) 2010 Free Software Foundation, Inc.
+Copyright (C) 2012 Free Software Foundation, Inc.
 This configure script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it.
 _ACEOF
@@ -2197,7 +2226,7 @@ $as_echo "$ac_try_echo"; } >&5
 	 test ! -s conftest.err
        } && test -s conftest$ac_exeext && {
 	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
+	 test -x conftest$ac_exeext
        }; then :
   ac_retval=0
 else
@@ -2541,7 +2570,7 @@ $as_echo "$ac_try_echo"; } >&5
 	 test ! -s conftest.err
        } && test -s conftest$ac_exeext && {
 	 test "$cross_compiling" = yes ||
-	 $as_test_x conftest$ac_exeext
+	 test -x conftest$ac_exeext
        }; then :
   ac_retval=0
 else
@@ -2722,7 +2751,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(($2) >= 0)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2738,7 +2768,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(($2) <= $ac_mid)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2764,7 +2795,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(($2) < 0)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2780,7 +2812,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(($2) >= $ac_mid)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2814,7 +2847,8 @@ int
 main ()
 {
 static int test_array [1 - 2 * !(($2) <= $ac_mid)];
-test_array [0] = 0
+test_array [0] = 0;
+return test_array [0];
 
   ;
   return 0;
@@ -2886,8 +2920,8 @@ cat >config.log <<_ACEOF
 This file contains any messages produced by compilers while
 running configure, to aid debugging if configure makes a mistake.
 
-It was created by GStreamer Base Plug-ins $as_me 0.10.36, which was
-generated by GNU Autoconf 2.68.  Invocation command line was
+It was created by GStreamer Base Plug-ins $as_me 0.10.36.1, which was
+generated by GNU Autoconf 2.69.  Invocation command line was
 
   $ $0 $@
 
@@ -3236,12 +3270,6 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
 
 
-
-
-
-
-am__api_version='1.11'
-
 ac_aux_dir=
 for ac_dir in "$srcdir" "$srcdir/.." "$srcdir/../.."; do
   if test -f "$ac_dir/install-sh"; then
@@ -3271,6 +3299,122 @@ ac_config_sub="$SHELL $ac_aux_dir/config.sub"  # Please don't use this var.
 ac_configure="$SHELL $ac_aux_dir/configure"  # Please don't use this var.
 
 
+# Make sure we can run config.sub.
+$SHELL "$ac_aux_dir/config.sub" sun4 >/dev/null 2>&1 ||
+  as_fn_error $? "cannot run $SHELL $ac_aux_dir/config.sub" "$LINENO" 5
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking build system type" >&5
+$as_echo_n "checking build system type... " >&6; }
+if ${ac_cv_build+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  ac_build_alias=$build_alias
+test "x$ac_build_alias" = x &&
+  ac_build_alias=`$SHELL "$ac_aux_dir/config.guess"`
+test "x$ac_build_alias" = x &&
+  as_fn_error $? "cannot guess build type; you must specify one" "$LINENO" 5
+ac_cv_build=`$SHELL "$ac_aux_dir/config.sub" $ac_build_alias` ||
+  as_fn_error $? "$SHELL $ac_aux_dir/config.sub $ac_build_alias failed" "$LINENO" 5
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_build" >&5
+$as_echo "$ac_cv_build" >&6; }
+case $ac_cv_build in
+*-*-*) ;;
+*) as_fn_error $? "invalid value of canonical build" "$LINENO" 5;;
+esac
+build=$ac_cv_build
+ac_save_IFS=$IFS; IFS='-'
+set x $ac_cv_build
+shift
+build_cpu=$1
+build_vendor=$2
+shift; shift
+# Remember, the first character of IFS is used to create $*,
+# except with old shells:
+build_os=$*
+IFS=$ac_save_IFS
+case $build_os in *\ *) build_os=`echo "$build_os" | sed 's/ /-/g'`;; esac
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking host system type" >&5
+$as_echo_n "checking host system type... " >&6; }
+if ${ac_cv_host+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test "x$host_alias" = x; then
+  ac_cv_host=$ac_cv_build
+else
+  ac_cv_host=`$SHELL "$ac_aux_dir/config.sub" $host_alias` ||
+    as_fn_error $? "$SHELL $ac_aux_dir/config.sub $host_alias failed" "$LINENO" 5
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_host" >&5
+$as_echo "$ac_cv_host" >&6; }
+case $ac_cv_host in
+*-*-*) ;;
+*) as_fn_error $? "invalid value of canonical host" "$LINENO" 5;;
+esac
+host=$ac_cv_host
+ac_save_IFS=$IFS; IFS='-'
+set x $ac_cv_host
+shift
+host_cpu=$1
+host_vendor=$2
+shift; shift
+# Remember, the first character of IFS is used to create $*,
+# except with old shells:
+host_os=$*
+IFS=$ac_save_IFS
+case $host_os in *\ *) host_os=`echo "$host_os" | sed 's/ /-/g'`;; esac
+
+
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking target system type" >&5
+$as_echo_n "checking target system type... " >&6; }
+if ${ac_cv_target+:} false; then :
+  $as_echo_n "(cached) " >&6
+else
+  if test "x$target_alias" = x; then
+  ac_cv_target=$ac_cv_host
+else
+  ac_cv_target=`$SHELL "$ac_aux_dir/config.sub" $target_alias` ||
+    as_fn_error $? "$SHELL $ac_aux_dir/config.sub $target_alias failed" "$LINENO" 5
+fi
+
+fi
+{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_target" >&5
+$as_echo "$ac_cv_target" >&6; }
+case $ac_cv_target in
+*-*-*) ;;
+*) as_fn_error $? "invalid value of canonical target" "$LINENO" 5;;
+esac
+target=$ac_cv_target
+ac_save_IFS=$IFS; IFS='-'
+set x $ac_cv_target
+shift
+target_cpu=$1
+target_vendor=$2
+shift; shift
+# Remember, the first character of IFS is used to create $*,
+# except with old shells:
+target_os=$*
+IFS=$ac_save_IFS
+case $target_os in *\ *) target_os=`echo "$target_os" | sed 's/ /-/g'`;; esac
+
+
+# The aliases save the names the user supplied, while $host etc.
+# will get canonicalized.
+test -n "$target_alias" &&
+  test "$program_prefix$program_suffix$program_transform_name" = \
+    NONENONEs,x,x, &&
+  program_prefix=${target_alias}-
+
+
+
+
+am__api_version='1.12'
+
 # Find a good install program.  We prefer a C program (faster),
 # so one script is as good as another.  But avoid the broken or
 # incompatible versions:
@@ -3308,7 +3452,7 @@ case $as_dir/ in #((
     # by default.
     for ac_prog in ginstall scoinst install; do
       for ac_exec_ext in '' $ac_executable_extensions; do
-	if { test -f "$as_dir/$ac_prog$ac_exec_ext" && $as_test_x "$as_dir/$ac_prog$ac_exec_ext"; }; then
+	if as_fn_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
 	  if test $ac_prog = install &&
 	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
 	    # AIX install.  It has an incompatible calling convention.
@@ -3366,9 +3510,6 @@ test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
 
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether build environment is sane" >&5
 $as_echo_n "checking whether build environment is sane... " >&6; }
-# Just in case
-sleep 1
-echo timestamp > conftest.file
 # Reject unsafe characters in $srcdir or the absolute working directory
 # name.  Accept space and tab only in the latter.
 am_lf='
@@ -3379,32 +3520,40 @@ case `pwd` in
 esac
 case $srcdir in
   *[\\\"\#\$\&\'\`$am_lf\ \	]*)
-    as_fn_error $? "unsafe srcdir value: \`$srcdir'" "$LINENO" 5;;
+    as_fn_error $? "unsafe srcdir value: '$srcdir'" "$LINENO" 5;;
 esac
 
-# Do `set' in a subshell so we don't clobber the current shell's
+# Do 'set' in a subshell so we don't clobber the current shell's
 # arguments.  Must try -L first in case configure is actually a
 # symlink; some systems play weird games with the mod time of symlinks
 # (eg FreeBSD returns the mod time of the symlink's containing
 # directory).
 if (
-   set X `ls -Lt "$srcdir/configure" conftest.file 2> /dev/null`
-   if test "$*" = "X"; then
-      # -L didn't work.
-      set X `ls -t "$srcdir/configure" conftest.file`
-   fi
-   rm -f conftest.file
-   if test "$*" != "X $srcdir/configure conftest.file" \
-      && test "$*" != "X conftest.file $srcdir/configure"; then
-
-      # If neither matched, then we have a broken ls.  This can happen
-      # if, for instance, CONFIG_SHELL is bash and it inherits a
-      # broken ls alias from the environment.  This has actually
-      # happened.  Such a system could not be considered "sane".
-      as_fn_error $? "ls -t appears to fail.  Make sure there is not a broken
-alias in your environment" "$LINENO" 5
-   fi
-
+   am_has_slept=no
+   for am_try in 1 2; do
+     echo "timestamp, slept: $am_has_slept" > conftest.file
+     set X `ls -Lt "$srcdir/configure" conftest.file 2> /dev/null`
+     if test "$*" = "X"; then
+	# -L didn't work.
+	set X `ls -t "$srcdir/configure" conftest.file`
+     fi
+     if test "$*" != "X $srcdir/configure conftest.file" \
+	&& test "$*" != "X conftest.file $srcdir/configure"; then
+
+	# If neither matched, then we have a broken ls.  This can happen
+	# if, for instance, CONFIG_SHELL is bash and it inherits a
+	# broken ls alias from the environment.  This has actually
+	# happened.  Such a system could not be considered "sane".
+	as_fn_error $? "ls -t appears to fail.  Make sure there is not a broken
+  alias in your environment" "$LINENO" 5
+     fi
+     if test "$2" = conftest.file || test $am_try -eq 2; then
+       break
+     fi
+     # Just in case.
+     sleep 1
+     am_has_slept=yes
+   done
    test "$2" = conftest.file
    )
 then
@@ -3416,6 +3565,16 @@ Check your system clock" "$LINENO" 5
 fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
+# If we didn't sleep, we still need to ensure time stamps of config.status and
+# generated files are strictly newer.
+am_sleep_pid=
+if grep 'slept: no' conftest.file >/dev/null 2>&1; then
+  ( sleep 1 ) &
+  am_sleep_pid=$!
+fi
+
+rm -f conftest.file
+
 test "$program_prefix" != NONE &&
   program_transform_name="s&^&$program_prefix&;$program_transform_name"
 # Use a double $ so make ignores it.
@@ -3442,8 +3601,8 @@ if eval "$MISSING --run true"; then
   am_missing_run="$MISSING --run "
 else
   am_missing_run=
-  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: \`missing' script is too old or missing" >&5
-$as_echo "$as_me: WARNING: \`missing' script is too old or missing" >&2;}
+  { $as_echo "$as_me:${as_lineno-$LINENO}: WARNING: 'missing' script is too old or missing" >&5
+$as_echo "$as_me: WARNING: 'missing' script is too old or missing" >&2;}
 fi
 
 if test x"${install_sh}" != xset; then
@@ -3455,10 +3614,10 @@ if test x"${install_sh}" != xset; then
   esac
 fi
 
-# Installed binaries are usually stripped using `strip' when the user
-# run `make install-strip'.  However `strip' might not be the right
+# Installed binaries are usually stripped using 'strip' when the user
+# run "make install-strip".  However 'strip' might not be the right
 # tool to use in cross-compilation environments, therefore Automake
-# will honor the `STRIP' environment variable to overrule this program.
+# will honor the 'STRIP' environment variable to overrule this program.
 if test "$cross_compiling" != no; then
   if test -n "$ac_tool_prefix"; then
   # Extract the first word of "${ac_tool_prefix}strip", so it can be a program name with args.
@@ -3477,7 +3636,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_STRIP="${ac_tool_prefix}strip"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3517,7 +3676,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_STRIP="strip"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3568,7 +3727,7 @@ do
   test -z "$as_dir" && as_dir=.
     for ac_prog in mkdir gmkdir; do
 	 for ac_exec_ext in '' $ac_executable_extensions; do
-	   { test -f "$as_dir/$ac_prog$ac_exec_ext" && $as_test_x "$as_dir/$ac_prog$ac_exec_ext"; } || continue
+	   as_fn_executable_p "$as_dir/$ac_prog$ac_exec_ext" || continue
 	   case `"$as_dir/$ac_prog$ac_exec_ext" --version 2>&1` in #(
 	     'mkdir (GNU coreutils) '* | \
 	     'mkdir (coreutils) '* | \
@@ -3597,12 +3756,6 @@ fi
 { $as_echo "$as_me:${as_lineno-$LINENO}: result: $MKDIR_P" >&5
 $as_echo "$MKDIR_P" >&6; }
 
-mkdir_p="$MKDIR_P"
-case $mkdir_p in
-  [\\/$]* | ?:[\\/]*) ;;
-  */*) mkdir_p="\$(top_builddir)/$mkdir_p" ;;
-esac
-
 for ac_prog in gawk mawk nawk awk
 do
   # Extract the first word of "$ac_prog", so it can be a program name with args.
@@ -3621,7 +3774,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AWK="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -3707,7 +3860,7 @@ fi
 
 # Define the identity of the package.
  PACKAGE='gst-plugins-base'
- VERSION='0.10.36'
+ VERSION='0.10.36.1'
 
 
 cat >>confdefs.h <<_ACEOF
@@ -3735,6 +3888,12 @@ AUTOHEADER=${AUTOHEADER-"${am_missing_run}autoheader"}
 
 MAKEINFO=${MAKEINFO-"${am_missing_run}makeinfo"}
 
+# For better backward compatibility.  To be removed once Automake 1.9.x
+# dies out for good.  For more background, see:
+# <http://lists.gnu.org/archive/html/automake/2012-07/msg00001.html>
+# <http://lists.gnu.org/archive/html/automake/2012-07/msg00014.html>
+mkdir_p='$(MKDIR_P)'
+
 # We need awk for the "check" target.  The system "awk" is bad on
 # some platforms.
 # Always define AMTAR for backward compatibility.  Yes, it's still used
@@ -3749,9 +3908,9 @@ am__tar='$${TAR-tar} chof - "$$tardir"' am__untar='$${TAR-tar} xf -'
 
 
 
-  PACKAGE_VERSION_MAJOR=$(echo 0.10.36 | cut -d'.' -f1)
-  PACKAGE_VERSION_MINOR=$(echo 0.10.36 | cut -d'.' -f2)
-  PACKAGE_VERSION_MICRO=$(echo 0.10.36 | cut -d'.' -f3)
+  PACKAGE_VERSION_MAJOR=$(echo 0.10.36.1 | cut -d'.' -f1)
+  PACKAGE_VERSION_MINOR=$(echo 0.10.36.1 | cut -d'.' -f2)
+  PACKAGE_VERSION_MICRO=$(echo 0.10.36.1 | cut -d'.' -f3)
 
 
 
@@ -3762,7 +3921,7 @@ am__tar='$${TAR-tar} chof - "$$tardir"' am__untar='$${TAR-tar} xf -'
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking nano version" >&5
 $as_echo_n "checking nano version... " >&6; }
 
-  NANO=$(echo 0.10.36 | cut -d'.' -f4)
+  NANO=$(echo 0.10.36.1 | cut -d'.' -f4)
 
   if test x"$NANO" = x || test "x$NANO" = "x0" ; then
     { $as_echo "$as_me:${as_lineno-$LINENO}: result: 0 (release)" >&5
@@ -3814,76 +3973,6 @@ fi
 
 
 
-# Make sure we can run config.sub.
-$SHELL "$ac_aux_dir/config.sub" sun4 >/dev/null 2>&1 ||
-  as_fn_error $? "cannot run $SHELL $ac_aux_dir/config.sub" "$LINENO" 5
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking build system type" >&5
-$as_echo_n "checking build system type... " >&6; }
-if ${ac_cv_build+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  ac_build_alias=$build_alias
-test "x$ac_build_alias" = x &&
-  ac_build_alias=`$SHELL "$ac_aux_dir/config.guess"`
-test "x$ac_build_alias" = x &&
-  as_fn_error $? "cannot guess build type; you must specify one" "$LINENO" 5
-ac_cv_build=`$SHELL "$ac_aux_dir/config.sub" $ac_build_alias` ||
-  as_fn_error $? "$SHELL $ac_aux_dir/config.sub $ac_build_alias failed" "$LINENO" 5
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_build" >&5
-$as_echo "$ac_cv_build" >&6; }
-case $ac_cv_build in
-*-*-*) ;;
-*) as_fn_error $? "invalid value of canonical build" "$LINENO" 5;;
-esac
-build=$ac_cv_build
-ac_save_IFS=$IFS; IFS='-'
-set x $ac_cv_build
-shift
-build_cpu=$1
-build_vendor=$2
-shift; shift
-# Remember, the first character of IFS is used to create $*,
-# except with old shells:
-build_os=$*
-IFS=$ac_save_IFS
-case $build_os in *\ *) build_os=`echo "$build_os" | sed 's/ /-/g'`;; esac
-
-
-{ $as_echo "$as_me:${as_lineno-$LINENO}: checking host system type" >&5
-$as_echo_n "checking host system type... " >&6; }
-if ${ac_cv_host+:} false; then :
-  $as_echo_n "(cached) " >&6
-else
-  if test "x$host_alias" = x; then
-  ac_cv_host=$ac_cv_build
-else
-  ac_cv_host=`$SHELL "$ac_aux_dir/config.sub" $host_alias` ||
-    as_fn_error $? "$SHELL $ac_aux_dir/config.sub $host_alias failed" "$LINENO" 5
-fi
-
-fi
-{ $as_echo "$as_me:${as_lineno-$LINENO}: result: $ac_cv_host" >&5
-$as_echo "$ac_cv_host" >&6; }
-case $ac_cv_host in
-*-*-*) ;;
-*) as_fn_error $? "invalid value of canonical host" "$LINENO" 5;;
-esac
-host=$ac_cv_host
-ac_save_IFS=$IFS; IFS='-'
-set x $ac_cv_host
-shift
-host_cpu=$1
-host_vendor=$2
-shift; shift
-# Remember, the first character of IFS is used to create $*,
-# except with old shells:
-host_os=$*
-IFS=$ac_save_IFS
-case $host_os in *\ *) host_os=`echo "$host_os" | sed 's/ /-/g'`;; esac
-
 
 
 # Check whether --enable-silent-rules was given.
@@ -3891,10 +3980,10 @@ if test "${enable_silent_rules+set}" = set; then :
   enableval=$enable_silent_rules;
 fi
 
-case $enable_silent_rules in
-yes) AM_DEFAULT_VERBOSITY=0;;
-no)  AM_DEFAULT_VERBOSITY=1;;
-*)   AM_DEFAULT_VERBOSITY=0;;
+case $enable_silent_rules in # (((
+  yes) AM_DEFAULT_VERBOSITY=0;;
+   no) AM_DEFAULT_VERBOSITY=1;;
+    *) AM_DEFAULT_VERBOSITY=0;;
 esac
 am_make=${MAKE-make}
 { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether $am_make supports nested variables" >&5
@@ -3931,10 +4020,10 @@ GST_MAJORMINOR=0.10
 
 
 
-  GST_CURRENT=25
+  GST_CURRENT=26
   GST_REVISION=0
-  GST_AGE=25
-  GST_LIBVERSION=25:0:25
+  GST_AGE=26
+  GST_LIBVERSION=26:0:26
 
 
 
@@ -3975,7 +4064,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AS="${ac_tool_prefix}as"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4015,7 +4104,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_AS="as"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4067,7 +4156,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DLLTOOL="${ac_tool_prefix}dlltool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4107,7 +4196,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DLLTOOL="dlltool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4159,7 +4248,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OBJDUMP="${ac_tool_prefix}objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4199,7 +4288,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OBJDUMP="objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4370,7 +4459,7 @@ am__quote=
 _am_result=none
 # First try GNU make style include.
 echo "include confinc" > confmf
-# Ignore all kinds of additional output from `make'.
+# Ignore all kinds of additional output from 'make'.
 case `$am_make -s -f confmf 2> /dev/null` in #(
 *the\ am__doit\ target*)
   am__include=include
@@ -4436,7 +4525,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4476,7 +4565,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4529,7 +4618,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}cc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4570,7 +4659,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
@@ -4628,7 +4717,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -4672,7 +4761,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -5118,8 +5207,7 @@ cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
+struct stat;
 /* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
 struct buf { int x; };
 FILE * (*rcsopen) (struct buf *, struct stat *, int);
@@ -5215,8 +5303,8 @@ else
   # We make a subdir and do the tests there.  Otherwise we can end up
   # making bogus files that we don't know about and never remove.  For
   # instance it was reported that on HP-UX the gcc test will end up
-  # making a dummy file named `D' -- because `-MD' means `put the output
-  # in D'.
+  # making a dummy file named 'D' -- because '-MD' means "put the output
+  # in D".
   rm -rf conftest.dir
   mkdir conftest.dir
   # Copy depcomp to subdir because otherwise we won't find it if we're
@@ -5251,16 +5339,16 @@ else
     : > sub/conftest.c
     for i in 1 2 3 4 5 6; do
       echo '#include "conftst'$i'.h"' >> sub/conftest.c
-      # Using `: > sub/conftst$i.h' creates only sub/conftst1.h with
-      # Solaris 8's {/usr,}/bin/sh.
-      touch sub/conftst$i.h
+      # Using ": > sub/conftst$i.h" creates only sub/conftst1.h with
+      # Solaris 10 /bin/sh.
+      echo '/* dummy */' > sub/conftst$i.h
     done
     echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
 
-    # We check with `-c' and `-o' for the sake of the "dashmstdout"
+    # We check with '-c' and '-o' for the sake of the "dashmstdout"
     # mode.  It turns out that the SunPro C++ compiler does not properly
-    # handle `-M -o', and we need to detect this.  Also, some Intel
-    # versions had trouble with output in subdirs
+    # handle '-M -o', and we need to detect this.  Also, some Intel
+    # versions had trouble with output in subdirs.
     am__obj=sub/conftest.${OBJEXT-o}
     am__minus_obj="-o $am__obj"
     case $depmode in
@@ -5269,8 +5357,8 @@ else
       test "$am__universal" = false || continue
       ;;
     nosideeffect)
-      # after this tag, mechanisms are not by side-effect, so they'll
-      # only be used when explicitly requested
+      # After this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested.
       if test "x$enable_dependency_tracking" = xyes; then
 	continue
       else
@@ -5278,7 +5366,7 @@ else
       fi
       ;;
     msvc7 | msvc7msys | msvisualcpp | msvcmsys)
-      # This compiler won't grok `-c -o', but also, the minuso test has
+      # This compiler won't grok '-c -o', but also, the minuso test has
       # not run yet.  These depmodes are late enough in the game, and
       # so weak that their functioning should not be impacted.
       am__obj=conftest.${OBJEXT-o}
@@ -5354,7 +5442,7 @@ do
     for ac_prog in sed gsed; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_SED="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_SED" && $as_test_x "$ac_path_SED"; } || continue
+      as_fn_executable_p "$ac_path_SED" || continue
 # Check for GNU ac_path_SED and select it if it is found.
   # Check for GNU $ac_path_SED
 case `"$ac_path_SED" --version 2>&1` in
@@ -5430,7 +5518,7 @@ do
     for ac_prog in grep ggrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_GREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_GREP" && $as_test_x "$ac_path_GREP"; } || continue
+      as_fn_executable_p "$ac_path_GREP" || continue
 # Check for GNU ac_path_GREP and select it if it is found.
   # Check for GNU $ac_path_GREP
 case `"$ac_path_GREP" --version 2>&1` in
@@ -5496,7 +5584,7 @@ do
     for ac_prog in egrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_EGREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_EGREP" && $as_test_x "$ac_path_EGREP"; } || continue
+      as_fn_executable_p "$ac_path_EGREP" || continue
 # Check for GNU ac_path_EGREP and select it if it is found.
   # Check for GNU $ac_path_EGREP
 case `"$ac_path_EGREP" --version 2>&1` in
@@ -5563,7 +5651,7 @@ do
     for ac_prog in fgrep; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_FGREP="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_FGREP" && $as_test_x "$ac_path_FGREP"; } || continue
+      as_fn_executable_p "$ac_path_FGREP" || continue
 # Check for GNU ac_path_FGREP and select it if it is found.
   # Check for GNU $ac_path_FGREP
 case `"$ac_path_FGREP" --version 2>&1` in
@@ -5819,7 +5907,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DUMPBIN="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -5863,7 +5951,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DUMPBIN="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6287,7 +6375,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OBJDUMP="${ac_tool_prefix}objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6327,7 +6415,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OBJDUMP="objdump"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6496,7 +6584,7 @@ linux* | k*bsd*-gnu | kopensolaris*-gnu)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-netbsd* | netbsdelf*-gnu)
+netbsd*)
   if echo __ELF__ | $CC -E - | $GREP __ELF__ > /dev/null; then
     lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|_pic\.a)$'
   else
@@ -6630,7 +6718,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DLLTOOL="${ac_tool_prefix}dlltool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6670,7 +6758,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DLLTOOL="dlltool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6771,7 +6859,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_AR="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6815,7 +6903,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_AR="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6940,7 +7028,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_STRIP="${ac_tool_prefix}strip"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -6980,7 +7068,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_STRIP="strip"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7039,7 +7127,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7079,7 +7167,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_RANLIB="ranlib"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7728,7 +7816,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_MANIFEST_TOOL="${ac_tool_prefix}mt"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7768,7 +7856,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_MANIFEST_TOOL="mt"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7848,7 +7936,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_DSYMUTIL="${ac_tool_prefix}dsymutil"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7888,7 +7976,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_DSYMUTIL="dsymutil"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7940,7 +8028,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_NMEDIT="${ac_tool_prefix}nmedit"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -7980,7 +8068,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_NMEDIT="nmedit"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8032,7 +8120,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_LIPO="${ac_tool_prefix}lipo"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8072,7 +8160,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_LIPO="lipo"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8124,7 +8212,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OTOOL="${ac_tool_prefix}otool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8164,7 +8252,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OTOOL="otool"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8216,7 +8304,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_OTOOL64="${ac_tool_prefix}otool64"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -8256,7 +8344,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_OTOOL64="otool64"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -9890,9 +9978,6 @@ $as_echo_n "checking whether the $compiler linker ($LD) supports shared librarie
   openbsd*)
     with_gnu_ld=no
     ;;
-  linux* | k*bsd*-gnu | gnu*)
-    link_all_deplibs=no
-    ;;
   esac
 
   ld_shlibs=yes
@@ -10114,7 +10199,7 @@ _LT_EOF
       fi
       ;;
 
-    netbsd* | netbsdelf*-gnu)
+    netbsd*)
       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
 	archive_cmds='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
 	wlarc=
@@ -10291,7 +10376,6 @@ _LT_EOF
 	if test "$aix_use_runtimelinking" = yes; then
 	  shared_flag="$shared_flag "'${wl}-G'
 	fi
-	link_all_deplibs=no
       else
 	# not using gcc
 	if test "$host_cpu" = ia64; then
@@ -10745,7 +10829,7 @@ $as_echo "$lt_cv_irix_exported_symbol" >&6; }
       link_all_deplibs=yes
       ;;
 
-    netbsd* | netbsdelf*-gnu)
+    netbsd*)
       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
 	archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'  # a.out
       else
@@ -11773,18 +11857,6 @@ fi
   dynamic_linker='GNU/Linux ld.so'
   ;;
 
-netbsdelf*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='NetBSD ld.elf_so'
-  ;;
-
 netbsd*)
   version_type=sunos
   need_lib_prefix=no
@@ -12822,6 +12894,13 @@ ACLOCAL_AMFLAGS="-I m4 -I common/m4"
 
 
 
+mkdir_p="$MKDIR_P"
+case $mkdir_p in
+  [\\/$]* | ?:[\\/]*) ;;
+  */*) mkdir_p="\$(top_builddir)/$mkdir_p" ;;
+esac
+
+
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking whether NLS is requested" >&5
 $as_echo_n "checking whether NLS is requested... " >&6; }
     # Check whether --enable-nls was given.
@@ -12929,7 +13008,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_GMSGFMT="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -14774,6 +14853,21 @@ _ACEOF
 
 
 
+  # Check whether --enable-fatal-warnings was given.
+if test "${enable_fatal_warnings+set}" = set; then :
+  enableval=$enable_fatal_warnings;
+      case "${enableval}" in
+        yes) FATAL_WARNINGS=yes ;;
+        no)  FATAL_WARNINGS=no ;;
+        *)   as_fn_error $? "bad value ${enableval} for --disable-fatal-warnings" "$LINENO" 5 ;;
+      esac
+
+else
+  FATAL_WARNINGS=no
+fi
+
+
+
     # Check whether --enable-debug was given.
 if test "${enable_debug+set}" = set; then :
   enableval=$enable_debug;
@@ -14823,7 +14917,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -14866,7 +14960,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_ac_pt_PKG_CONFIG="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -15113,13 +15207,13 @@ _ACEOF
 
         if test "x$GST_GCOV_ENABLED" = "xyes"
     then
-      CFLAGS="-O0"
+      CFLAGS="$CFLAGS -O0"
 
-      CXXFLAGS="-O0"
+      CXXFLAGS="$CXXFLAGS -O0"
 
-      FFLAGS="-O0"
+      FFLAGS="$FFLAGS -O0"
 
-      CCASFLAGS="-O0"
+      CCASFLAGS="$CCASFLAGS -O0"
 
       { $as_echo "$as_me:${as_lineno-$LINENO}: gcov enabled, setting CFLAGS and friends to $CFLAGS" >&5
 $as_echo "$as_me: gcov enabled, setting CFLAGS and friends to $CFLAGS" >&6;}
@@ -15611,10 +15705,9 @@ rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 
 
 
-
-    case "x${host_cpu}" in
+    case "x${target_cpu}" in
     xi?86 | xk? | xi?86_64)
-      case $host_os in
+      case $target_os in
          solaris*)
             ac_fn_c_check_decl "$LINENO" "__i386" "ac_cv_have_decl___i386" "$ac_includes_default"
 if test "x$ac_cv_have_decl___i386" = xyes; then :
@@ -15650,7 +15743,7 @@ $as_echo "#define HAVE_CPU_X86_64 1" >>confdefs.h
 $as_echo "#define HAVE_CPU_I386 1" >>confdefs.h
 
 
-                                    case "x${host_cpu}" in
+                                    case "x${target_cpu}" in
               xi386 | xi486) ;;
             *)
 
@@ -16071,6 +16164,11 @@ cat >>confdefs.h <<_ACEOF
 _ACEOF
 
 
+cat >>confdefs.h <<_ACEOF
+#define TARGET_CPU "$target_cpu"
+_ACEOF
+
+
 
 # Check whether --enable-largefile was given.
 if test "${enable_largefile+set}" = set; then :
@@ -16268,6 +16366,8 @@ _ACEOF
 esac
 rm -rf conftest*
   fi
+
+
 fi
 
 
@@ -16294,7 +16394,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -16334,7 +16434,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="gcc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -16387,7 +16487,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="${ac_tool_prefix}cc"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -16428,7 +16528,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
        ac_prog_rejected=yes
        continue
@@ -16486,7 +16586,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -16530,7 +16630,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CC="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -16726,8 +16826,7 @@ cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
+struct stat;
 /* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
 struct buf { int x; };
 FILE * (*rcsopen) (struct buf *, struct stat *, int);
@@ -16823,8 +16922,8 @@ else
   # We make a subdir and do the tests there.  Otherwise we can end up
   # making bogus files that we don't know about and never remove.  For
   # instance it was reported that on HP-UX the gcc test will end up
-  # making a dummy file named `D' -- because `-MD' means `put the output
-  # in D'.
+  # making a dummy file named 'D' -- because '-MD' means "put the output
+  # in D".
   rm -rf conftest.dir
   mkdir conftest.dir
   # Copy depcomp to subdir because otherwise we won't find it if we're
@@ -16859,16 +16958,16 @@ else
     : > sub/conftest.c
     for i in 1 2 3 4 5 6; do
       echo '#include "conftst'$i'.h"' >> sub/conftest.c
-      # Using `: > sub/conftst$i.h' creates only sub/conftst1.h with
-      # Solaris 8's {/usr,}/bin/sh.
-      touch sub/conftst$i.h
+      # Using ": > sub/conftst$i.h" creates only sub/conftst1.h with
+      # Solaris 10 /bin/sh.
+      echo '/* dummy */' > sub/conftst$i.h
     done
     echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
 
-    # We check with `-c' and `-o' for the sake of the "dashmstdout"
+    # We check with '-c' and '-o' for the sake of the "dashmstdout"
     # mode.  It turns out that the SunPro C++ compiler does not properly
-    # handle `-M -o', and we need to detect this.  Also, some Intel
-    # versions had trouble with output in subdirs
+    # handle '-M -o', and we need to detect this.  Also, some Intel
+    # versions had trouble with output in subdirs.
     am__obj=sub/conftest.${OBJEXT-o}
     am__minus_obj="-o $am__obj"
     case $depmode in
@@ -16877,8 +16976,8 @@ else
       test "$am__universal" = false || continue
       ;;
     nosideeffect)
-      # after this tag, mechanisms are not by side-effect, so they'll
-      # only be used when explicitly requested
+      # After this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested.
       if test "x$enable_dependency_tracking" = xyes; then
 	continue
       else
@@ -16886,7 +16985,7 @@ else
       fi
       ;;
     msvc7 | msvc7msys | msvisualcpp | msvcmsys)
-      # This compiler won't grok `-c -o', but also, the minuso test has
+      # This compiler won't grok '-c -o', but also, the minuso test has
       # not run yet.  These depmodes are late enough in the game, and
       # so weak that their functioning should not be impacted.
       am__obj=conftest.${OBJEXT-o}
@@ -17090,7 +17189,7 @@ main ()
   return 0;
 }
 _ACEOF
-for ac_arg in '' -std=gnu99 -std=c99 -c99 -AC99 -xc99=all -qlanglvl=extc99
+for ac_arg in '' -std=gnu99 -std=c99 -c99 -AC99 -D_STDC_C99= -qlanglvl=extc99
 do
   CC="$ac_save_CC $ac_arg"
   if ac_fn_c_try_compile "$LINENO"; then :
@@ -17130,8 +17229,7 @@ cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 #include <stdarg.h>
 #include <stdio.h>
-#include <sys/types.h>
-#include <sys/stat.h>
+struct stat;
 /* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
 struct buf { int x; };
 FILE * (*rcsopen) (struct buf *, struct stat *, int);
@@ -17389,7 +17487,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_CXX="$ac_tool_prefix$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -17433,7 +17531,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_prog_ac_ct_CXX="$ac_prog"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -17629,8 +17727,8 @@ else
   # We make a subdir and do the tests there.  Otherwise we can end up
   # making bogus files that we don't know about and never remove.  For
   # instance it was reported that on HP-UX the gcc test will end up
-  # making a dummy file named `D' -- because `-MD' means `put the output
-  # in D'.
+  # making a dummy file named 'D' -- because '-MD' means "put the output
+  # in D".
   rm -rf conftest.dir
   mkdir conftest.dir
   # Copy depcomp to subdir because otherwise we won't find it if we're
@@ -17665,16 +17763,16 @@ else
     : > sub/conftest.c
     for i in 1 2 3 4 5 6; do
       echo '#include "conftst'$i'.h"' >> sub/conftest.c
-      # Using `: > sub/conftst$i.h' creates only sub/conftst1.h with
-      # Solaris 8's {/usr,}/bin/sh.
-      touch sub/conftst$i.h
+      # Using ": > sub/conftst$i.h" creates only sub/conftst1.h with
+      # Solaris 10 /bin/sh.
+      echo '/* dummy */' > sub/conftst$i.h
     done
     echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
 
-    # We check with `-c' and `-o' for the sake of the "dashmstdout"
+    # We check with '-c' and '-o' for the sake of the "dashmstdout"
     # mode.  It turns out that the SunPro C++ compiler does not properly
-    # handle `-M -o', and we need to detect this.  Also, some Intel
-    # versions had trouble with output in subdirs
+    # handle '-M -o', and we need to detect this.  Also, some Intel
+    # versions had trouble with output in subdirs.
     am__obj=sub/conftest.${OBJEXT-o}
     am__minus_obj="-o $am__obj"
     case $depmode in
@@ -17683,8 +17781,8 @@ else
       test "$am__universal" = false || continue
       ;;
     nosideeffect)
-      # after this tag, mechanisms are not by side-effect, so they'll
-      # only be used when explicitly requested
+      # After this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested.
       if test "x$enable_dependency_tracking" = xyes; then
 	continue
       else
@@ -17692,7 +17790,7 @@ else
       fi
       ;;
     msvc7 | msvc7msys | msvisualcpp | msvcmsys)
-      # This compiler won't grok `-c -o', but also, the minuso test has
+      # This compiler won't grok '-c -o', but also, the minuso test has
       # not run yet.  These depmodes are late enough in the game, and
       # so weak that their functioning should not be impacted.
       am__obj=conftest.${OBJEXT-o}
@@ -18135,8 +18233,13 @@ with_gnu_ld=$lt_cv_prog_gnu_ld
       # Check if GNU C++ uses GNU ld as the underlying linker, since the
       # archiving commands below assume that GNU ld is being used.
       if test "$with_gnu_ld" = yes; then
-        archive_cmds_CXX='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
-        archive_expsym_cmds_CXX='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+        if test "$cross_compiling" = yes; then
+          archive_cmds_CXX='$CC $pic_flag $compiler_flags -shared $libobjs $deplibs ${wl}-soname $wl$soname -o $lib'
+          archive_expsym_cmds_CXX='$CC $pic_flag $compiler_flags -shared $libobjs $deplibs ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+        else
+          archive_cmds_CXX='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
+          archive_expsym_cmds_CXX='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+        fi
 
         hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
         export_dynamic_flag_spec_CXX='${wl}--export-dynamic'
@@ -19256,23 +19359,27 @@ if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
        if test "$pre_test_object_deps_done" = no; then
 	 case ${prev} in
 	 -L | -R)
-	   # Internal compiler library paths should come after those
-	   # provided the user.  The postdeps already come after the
-	   # user supplied libs so there is no need to process them.
-	   if test -z "$compiler_lib_search_path_CXX"; then
-	     compiler_lib_search_path_CXX="${prev}${p}"
-	   else
-	     compiler_lib_search_path_CXX="${compiler_lib_search_path_CXX} ${prev}${p}"
+	   if test "$cross_compiling" != yes; then
+	     # Internal compiler library paths should come after those
+	     # provided the user.  The postdeps already come after the
+	     # user supplied libs so there is no need to process them.
+	     if test -z "$compiler_lib_search_path_CXX"; then
+	       compiler_lib_search_path_CXX="${prev}${p}"
+	     else
+	       compiler_lib_search_path_CXX="${compiler_lib_search_path_CXX} ${prev}${p}"
+	     fi
 	   fi
 	   ;;
 	 # The "-l" case would never come before the object being
 	 # linked, so don't bother handling this case.
 	 esac
        else
-	 if test -z "$postdeps_CXX"; then
-	   postdeps_CXX="${prev}${p}"
-	 else
-	   postdeps_CXX="${postdeps_CXX} ${prev}${p}"
+	 if test "$cross_compiling" != yes; then
+	   if test -z "$postdeps_CXX"; then
+	     postdeps_CXX="${prev}${p}"
+	   else
+	     postdeps_CXX="${postdeps_CXX} ${prev}${p}"
+	   fi
 	 fi
        fi
        prev=
@@ -19287,17 +19394,19 @@ if { { eval echo "\"\$as_me\":${as_lineno-$LINENO}: \"$ac_compile\""; } >&5
 	 continue
        fi
 
-       if test "$pre_test_object_deps_done" = no; then
-	 if test -z "$predep_objects_CXX"; then
-	   predep_objects_CXX="$p"
-	 else
-	   predep_objects_CXX="$predep_objects_CXX $p"
-	 fi
-       else
-	 if test -z "$postdep_objects_CXX"; then
-	   postdep_objects_CXX="$p"
+       if test "$cross_compiling" != yes; then
+	 if test "$pre_test_object_deps_done" = no; then
+	   if test -z "$predep_objects_CXX"; then
+	     predep_objects_CXX="$p"
+	   else
+	     predep_objects_CXX="$predep_objects_CXX $p"
+	   fi
 	 else
-	   postdep_objects_CXX="$postdep_objects_CXX $p"
+	   if test -z "$postdep_objects_CXX"; then
+	     postdep_objects_CXX="$p"
+	   else
+	     postdep_objects_CXX="$postdep_objects_CXX $p"
+	   fi
 	 fi
        fi
        ;;
@@ -19643,7 +19752,7 @@ lt_prog_compiler_static_CXX=
 	    ;;
 	esac
 	;;
-      netbsd* | netbsdelf*-gnu)
+      netbsd*)
 	;;
       *qnx* | *nto*)
         # QNX uses GNU C++, but need to define -shared option too, otherwise
@@ -20014,9 +20123,6 @@ $as_echo_n "checking whether the $compiler linker ($LD) supports shared librarie
       ;;
     esac
     ;;
-  linux* | k*bsd*-gnu | gnu*)
-    link_all_deplibs_CXX=no
-    ;;
   *)
     export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
     ;;
@@ -20642,18 +20748,6 @@ fi
   dynamic_linker='GNU/Linux ld.so'
   ;;
 
-netbsdelf*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='NetBSD ld.elf_so'
-  ;;
-
 netbsd*)
   version_type=sunos
   need_lib_prefix=no
@@ -21018,7 +21112,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_VALGRIND_PATH="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -21198,7 +21292,7 @@ do
     for ac_prog in sed gsed; do
     for ac_exec_ext in '' $ac_executable_extensions; do
       ac_path_SED="$as_dir/$ac_prog$ac_exec_ext"
-      { test -f "$ac_path_SED" && $as_test_x "$ac_path_SED"; } || continue
+      as_fn_executable_p "$ac_path_SED" || continue
 # Check for GNU ac_path_SED and select it if it is found.
   # Check for GNU $ac_path_SED
 case `"$ac_path_SED" --version 2>&1` in
@@ -21273,7 +21367,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_GTKDOC_CHECK="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -21355,7 +21449,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_PYTHON="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -21716,7 +21810,8 @@ fi
 
 for ac_header in malloc.h
 do :
-  ac_fn_c_check_header_mongrel "$LINENO" "malloc.h" "ac_cv_header_malloc_h" "$ac_includes_default"
+  ac_fn_c_check_header_compile "$LINENO" "malloc.h" "ac_cv_header_malloc_h" "$ac_includes_default
+"
 if test "x$ac_cv_header_malloc_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_MALLOC_H 1
@@ -21732,6 +21827,7 @@ CPPFLAGS="`$PKG_CONFIG --cflags libxml-2.0`"
 cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
+
 #include <libxml/HTMLparser.h>
 
 int
@@ -21747,9 +21843,13 @@ main ()
 }
 _ACEOF
 if ac_fn_c_try_compile "$LINENO"; then :
+
   HAVE_LIBXML_HTML="yes"
+
 else
+
   HAVE_LIBXML_HTML="no"
+
 fi
 rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 CPPFLAGS="$ac_cppflags_save"
@@ -21764,7 +21864,8 @@ fi
 
 for ac_header in sys/socket.h
 do :
-  ac_fn_c_check_header_mongrel "$LINENO" "sys/socket.h" "ac_cv_header_sys_socket_h" "$ac_includes_default"
+  ac_fn_c_check_header_compile "$LINENO" "sys/socket.h" "ac_cv_header_sys_socket_h" "$ac_includes_default
+"
 if test "x$ac_cv_header_sys_socket_h" = xyes; then :
   cat >>confdefs.h <<_ACEOF
 #define HAVE_SYS_SOCKET_H 1
@@ -21865,7 +21966,8 @@ LIBS="$save_libs"
 for ac_header in process.h sys/types.h sys/wait.h sys/stat.h
 do :
   as_ac_Header=`$as_echo "ac_cv_header_$ac_header" | $as_tr_sh`
-ac_fn_c_check_header_mongrel "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default"
+ac_fn_c_check_header_compile "$LINENO" "$ac_header" "$as_ac_Header" "$ac_includes_default
+"
 if eval test \"x\$"$as_ac_Header"\" = x"yes"; then :
   cat >>confdefs.h <<_ACEOF
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
@@ -22967,9 +23069,6 @@ fi
 
         GLIB_EXTRA_CFLAGS="$GLIB_EXTRA_CFLAGS -DG_THREADS_MANDATORY"
 
-    if test "x$PACKAGE_VERSION_NANO" = "x1"; then
-    GLIB_EXTRA_CFLAGS="$GLIB_EXTRA_CFLAGS -DG_DISABLE_DEPRECATED"
-  fi
 
   # Check whether --enable-gobject-cast-checks was given.
 if test "${enable_gobject_cast_checks+set}" = set; then :
@@ -24194,11 +24293,13 @@ int main (void) { return 0; }
 }
 _ACEOF
 if ac_fn_c_try_link "$LINENO"; then :
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
+
+                           { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
                            enable_Bsymbolic=yes
 else
-  { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
+
+                           { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
 $as_echo "no" >&6; }
                            enable_Bsymbolic=no
 fi
@@ -24359,6 +24460,7 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
+
       #include <gst/gstconfig.h>
       #ifdef GST_DISABLE_GST_DEBUG
       #error "debugging disabled, make compiler fail"
@@ -24545,7 +24647,7 @@ rm -f core conftest.err conftest.$ac_objext conftest.$ac_ext
 $as_echo "$flag_ok" >&6; }
 
 
-    if test "x$GST_GIT" != "xno"
+    if test "x$FATAL_WARNINGS" != "xno"
   then
 
   { $as_echo "$as_me:${as_lineno-$LINENO}: checking to see if compiler understands -Werror" >&5
@@ -24897,7 +24999,7 @@ ac_compiler_gnu=$ac_cv_c_compiler_gnu
 $as_echo "$flag_ok" >&6; }
 
 
-    if test "x$GST_GIT" != "xno"
+    if test "x$FATAL_WARNINGS" != "xno"
   then
 
 
@@ -27379,7 +27481,8 @@ fi
   CFLAGS="$CFLAGS $X_CFLAGS"
   CPPFLAGS="$CPPFLAGS $X_CFLAGS"
 
-    ac_fn_c_check_header_mongrel "$LINENO" "X11/Xlib.h" "ac_cv_header_X11_Xlib_h" "$ac_includes_default"
+    ac_fn_c_check_header_compile "$LINENO" "X11/Xlib.h" "ac_cv_header_X11_Xlib_h" "$ac_includes_default
+"
 if test "x$ac_cv_header_X11_Xlib_h" = xyes; then :
   HAVE_X="yes"
 else
@@ -30402,7 +30505,7 @@ if test x$USE_PANGO = xyes; then
   HAVE_PANGO=no
 
 
-  which="pango >= 1.16.0  pangocairo >= 1.16.0"
+  which="pango >= 1.22.0  pangocairo >= 1.22.0"
     required="no"
 
 
@@ -31081,6 +31184,7 @@ if test "x$HAVE_VORBIS" = "xyes"; then
   cat confdefs.h - <<_ACEOF >conftest.$ac_ext
 /* end confdefs.h.  */
 
+
 #include <vorbis/codec.h>
 
 int
@@ -31311,7 +31415,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_FT2_CONFIG="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -31513,7 +31617,7 @@ do
   IFS=$as_save_IFS
   test -z "$as_dir" && as_dir=.
     for ac_exec_ext in '' $ac_executable_extensions; do
-  if { test -f "$as_dir/$ac_word$ac_exec_ext" && $as_test_x "$as_dir/$ac_word$ac_exec_ext"; }; then
+  if as_fn_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
     ac_cv_path_FT2_CONFIG="$as_dir/$ac_word$ac_exec_ext"
     $as_echo "$as_me:${as_lineno-$LINENO}: found $as_dir/$ac_word$ac_exec_ext" >&5
     break 2
@@ -31721,7 +31825,7 @@ GST_PLUGIN_LDFLAGS="-module -avoid-version -export-symbols-regex '^_*gst_plugin_
 
 
 
-ac_config_files="$ac_config_files Makefile gst-plugins-base.spec gst/Makefile gst/adder/Makefile gst/app/Makefile gst/audioconvert/Makefile gst/audiorate/Makefile gst/audiotestsrc/Makefile gst/encoding/Makefile gst/ffmpegcolorspace/Makefile gst/gdp/Makefile gst/playback/Makefile gst/audioresample/Makefile gst/subparse/Makefile gst/tcp/Makefile gst/typefind/Makefile gst/videotestsrc/Makefile gst/videorate/Makefile gst/videoscale/Makefile gst/volume/Makefile sys/Makefile sys/ximage/Makefile sys/xvimage/Makefile sys/v4l/Makefile ext/Makefile ext/alsa/Makefile ext/cdparanoia/Makefile ext/gnomevfs/Makefile ext/gio/Makefile ext/libvisual/Makefile ext/ogg/Makefile ext/pango/Makefile ext/theora/Makefile ext/vorbis/Makefile gst-libs/Makefile gst-libs/gst/Makefile gst-libs/gst/audio/Makefile gst-libs/gst/app/Makefile gst-libs/gst/cdda/Makefile gst-libs/gst/fft/Makefile gst-libs/gst/floatcast/Makefile gst-libs/gst/interfaces/Makefile gst-libs/gst/netbuffer/Makefile gst-libs/gst/riff/Makefile gst-libs/gst/rtp/Makefile gst-libs/gst/rtsp/Makefile gst-libs/gst/sdp/Makefile gst-libs/gst/tag/Makefile gst-libs/gst/pbutils/Makefile gst-libs/gst/pbutils/gstpluginsbaseversion.h gst-libs/gst/video/Makefile tools/Makefile pkgconfig/Makefile pkgconfig/gstreamer-audio.pc pkgconfig/gstreamer-audio-uninstalled.pc pkgconfig/gstreamer-app.pc pkgconfig/gstreamer-app-uninstalled.pc pkgconfig/gstreamer-cdda.pc pkgconfig/gstreamer-cdda-uninstalled.pc pkgconfig/gstreamer-fft.pc pkgconfig/gstreamer-fft-uninstalled.pc pkgconfig/gstreamer-floatcast.pc pkgconfig/gstreamer-floatcast-uninstalled.pc pkgconfig/gstreamer-interfaces.pc pkgconfig/gstreamer-interfaces-uninstalled.pc pkgconfig/gstreamer-netbuffer.pc pkgconfig/gstreamer-netbuffer-uninstalled.pc pkgconfig/gstreamer-pbutils.pc pkgconfig/gstreamer-pbutils-uninstalled.pc pkgconfig/gstreamer-riff.pc pkgconfig/gstreamer-riff-uninstalled.pc pkgconfig/gstreamer-rtp.pc pkgconfig/gstreamer-rtp-uninstalled.pc pkgconfig/gstreamer-rtsp.pc pkgconfig/gstreamer-rtsp-uninstalled.pc pkgconfig/gstreamer-sdp.pc pkgconfig/gstreamer-sdp-uninstalled.pc pkgconfig/gstreamer-tag.pc pkgconfig/gstreamer-tag-uninstalled.pc pkgconfig/gstreamer-video.pc pkgconfig/gstreamer-video-uninstalled.pc pkgconfig/gstreamer-plugins-base.pc pkgconfig/gstreamer-plugins-base-uninstalled.pc tests/Makefile tests/check/Makefile tests/examples/Makefile tests/examples/app/Makefile tests/examples/audio/Makefile tests/examples/dynamic/Makefile tests/examples/encoding/Makefile tests/examples/fft/Makefile tests/examples/gio/Makefile tests/examples/overlay/Makefile tests/examples/seek/Makefile tests/examples/snapshot/Makefile tests/examples/playrec/Makefile tests/examples/v4l/Makefile tests/files/Makefile tests/icles/Makefile tests/icles/playback/Makefile docs/Makefile docs/design/Makefile docs/libs/Makefile docs/plugins/Makefile docs/version.entities po/Makefile.in common/Makefile common/m4/Makefile m4/Makefile"
+ac_config_files="$ac_config_files Makefile gst-plugins-base.spec gst/Makefile gst/adder/Makefile gst/app/Makefile gst/audioconvert/Makefile gst/audiorate/Makefile gst/audiotestsrc/Makefile gst/encoding/Makefile gst/ffmpegcolorspace/Makefile gst/gdp/Makefile gst/playback/Makefile gst/audioresample/Makefile gst/subparse/Makefile gst/tcp/Makefile gst/typefind/Makefile gst/videotestsrc/Makefile gst/videorate/Makefile gst/videoscale/Makefile gst/volume/Makefile sys/Makefile sys/ximage/Makefile sys/xvimage/Makefile sys/v4l/Makefile ext/Makefile ext/alsa/Makefile ext/cdparanoia/Makefile ext/gnomevfs/Makefile ext/gio/Makefile ext/libvisual/Makefile ext/ogg/Makefile ext/pango/Makefile ext/theora/Makefile ext/vorbis/Makefile gst-libs/Makefile gst-libs/gst/Makefile gst-libs/gst/audio/Makefile gst-libs/gst/app/Makefile gst-libs/gst/cdda/Makefile gst-libs/gst/fft/Makefile gst-libs/gst/floatcast/Makefile gst-libs/gst/interfaces/Makefile gst-libs/gst/netbuffer/Makefile gst-libs/gst/riff/Makefile gst-libs/gst/rtp/Makefile gst-libs/gst/rtsp/Makefile gst-libs/gst/sdp/Makefile gst-libs/gst/tag/Makefile gst-libs/gst/pbutils/Makefile gst-libs/gst/pbutils/gstpluginsbaseversion.h gst-libs/gst/video/Makefile tools/Makefile pkgconfig/Makefile pkgconfig/gstreamer-audio.pc pkgconfig/gstreamer-audio-uninstalled.pc pkgconfig/gstreamer-app.pc pkgconfig/gstreamer-app-uninstalled.pc pkgconfig/gstreamer-cdda.pc pkgconfig/gstreamer-cdda-uninstalled.pc pkgconfig/gstreamer-fft.pc pkgconfig/gstreamer-fft-uninstalled.pc pkgconfig/gstreamer-floatcast.pc pkgconfig/gstreamer-floatcast-uninstalled.pc pkgconfig/gstreamer-interfaces.pc pkgconfig/gstreamer-interfaces-uninstalled.pc pkgconfig/gstreamer-netbuffer.pc pkgconfig/gstreamer-netbuffer-uninstalled.pc pkgconfig/gstreamer-pbutils.pc pkgconfig/gstreamer-pbutils-uninstalled.pc pkgconfig/gstreamer-riff.pc pkgconfig/gstreamer-riff-uninstalled.pc pkgconfig/gstreamer-rtp.pc pkgconfig/gstreamer-rtp-uninstalled.pc pkgconfig/gstreamer-rtsp.pc pkgconfig/gstreamer-rtsp-uninstalled.pc pkgconfig/gstreamer-sdp.pc pkgconfig/gstreamer-sdp-uninstalled.pc pkgconfig/gstreamer-tag.pc pkgconfig/gstreamer-tag-uninstalled.pc pkgconfig/gstreamer-video.pc pkgconfig/gstreamer-video-uninstalled.pc pkgconfig/gstreamer-plugins-base.pc pkgconfig/gstreamer-plugins-base-uninstalled.pc tests/Makefile tests/check/Makefile tests/examples/Makefile tests/examples/app/Makefile tests/examples/audio/Makefile tests/examples/dynamic/Makefile tests/examples/encoding/Makefile tests/examples/fft/Makefile tests/examples/gio/Makefile tests/examples/overlay/Makefile tests/examples/seek/Makefile tests/examples/snapshot/Makefile tests/examples/playback/Makefile tests/examples/playrec/Makefile tests/examples/v4l/Makefile tests/files/Makefile tests/icles/Makefile tests/icles/playback/Makefile docs/Makefile docs/design/Makefile docs/libs/Makefile docs/plugins/Makefile docs/version.entities po/Makefile.in common/Makefile common/m4/Makefile m4/Makefile"
 
 
 sed \
@@ -31877,6 +31981,14 @@ LIBOBJS=$ac_libobjs
 LTLIBOBJS=$ac_ltlibobjs
 
 
+{ $as_echo "$as_me:${as_lineno-$LINENO}: checking that generated files are newer than configure" >&5
+$as_echo_n "checking that generated files are newer than configure... " >&6; }
+   if test -n "$am_sleep_pid"; then
+     # Hide warnings about reused PIDs.
+     wait $am_sleep_pid 2>/dev/null
+   fi
+   { $as_echo "$as_me:${as_lineno-$LINENO}: result: done" >&5
+$as_echo "done" >&6; }
  if test -n "$EXEEXT"; then
   am__EXEEXT_TRUE=
   am__EXEEXT_FALSE='#'
@@ -32540,16 +32652,16 @@ if (echo >conf$$.file) 2>/dev/null; then
     # ... but there are two gotchas:
     # 1) On MSYS, both `ln -s file dir' and `ln file dir' fail.
     # 2) DJGPP < 2.04 has no symlinks; `ln -s' creates a wrapper executable.
-    # In both cases, we have to default to `cp -p'.
+    # In both cases, we have to default to `cp -pR'.
     ln -s conf$$.file conf$$.dir 2>/dev/null && test ! -f conf$$.exe ||
-      as_ln_s='cp -p'
+      as_ln_s='cp -pR'
   elif ln conf$$.file conf$$ 2>/dev/null; then
     as_ln_s=ln
   else
-    as_ln_s='cp -p'
+    as_ln_s='cp -pR'
   fi
 else
-  as_ln_s='cp -p'
+  as_ln_s='cp -pR'
 fi
 rm -f conf$$ conf$$.exe conf$$.dir/conf$$.file conf$$.file
 rmdir conf$$.dir 2>/dev/null
@@ -32609,28 +32721,16 @@ else
   as_mkdir_p=false
 fi
 
-if test -x / >/dev/null 2>&1; then
-  as_test_x='test -x'
-else
-  if ls -dL / >/dev/null 2>&1; then
-    as_ls_L_option=L
-  else
-    as_ls_L_option=
-  fi
-  as_test_x='
-    eval sh -c '\''
-      if test -d "$1"; then
-	test -d "$1/.";
-      else
-	case $1 in #(
-	-*)set "./$1";;
-	esac;
-	case `ls -ld'$as_ls_L_option' "$1" 2>/dev/null` in #((
-	???[sx]*):;;*)false;;esac;fi
-    '\'' sh
-  '
-fi
-as_executable_p=$as_test_x
+
+# as_fn_executable_p FILE
+# -----------------------
+# Test if FILE is an executable regular file.
+as_fn_executable_p ()
+{
+  test -f "$1" && test -x "$1"
+} # as_fn_executable_p
+as_test_x='test -x'
+as_executable_p=as_fn_executable_p
 
 # Sed expression to map a string onto a valid CPP name.
 as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
@@ -32651,8 +32751,8 @@ cat >>$CONFIG_STATUS <<\_ACEOF || ac_write_fail=1
 # report actual input values of CONFIG_FILES etc. instead of their
 # values after options handling.
 ac_log="
-This file was extended by GStreamer Base Plug-ins $as_me 0.10.36, which was
-generated by GNU Autoconf 2.68.  Invocation command line was
+This file was extended by GStreamer Base Plug-ins $as_me 0.10.36.1, which was
+generated by GNU Autoconf 2.69.  Invocation command line was
 
   CONFIG_FILES    = $CONFIG_FILES
   CONFIG_HEADERS  = $CONFIG_HEADERS
@@ -32717,11 +32817,11 @@ _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 ac_cs_config="`$as_echo "$ac_configure_args" | sed 's/^ //; s/[\\""\`\$]/\\\\&/g'`"
 ac_cs_version="\\
-GStreamer Base Plug-ins config.status 0.10.36
-configured by $0, generated by GNU Autoconf 2.68,
+GStreamer Base Plug-ins config.status 0.10.36.1
+configured by $0, generated by GNU Autoconf 2.69,
   with options \\"\$ac_cs_config\\"
 
-Copyright (C) 2010 Free Software Foundation, Inc.
+Copyright (C) 2012 Free Software Foundation, Inc.
 This config.status script is free software; the Free Software Foundation
 gives unlimited permission to copy, distribute and modify it."
 
@@ -32812,7 +32912,7 @@ fi
 _ACEOF
 cat >>$CONFIG_STATUS <<_ACEOF || ac_write_fail=1
 if \$ac_cs_recheck; then
-  set X '$SHELL' '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
+  set X $SHELL '$0' $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
   shift
   \$as_echo "running CONFIG_SHELL=$SHELL \$*" >&6
   CONFIG_SHELL='$SHELL'
@@ -33348,6 +33448,7 @@ do
     "tests/examples/overlay/Makefile") CONFIG_FILES="$CONFIG_FILES tests/examples/overlay/Makefile" ;;
     "tests/examples/seek/Makefile") CONFIG_FILES="$CONFIG_FILES tests/examples/seek/Makefile" ;;
     "tests/examples/snapshot/Makefile") CONFIG_FILES="$CONFIG_FILES tests/examples/snapshot/Makefile" ;;
+    "tests/examples/playback/Makefile") CONFIG_FILES="$CONFIG_FILES tests/examples/playback/Makefile" ;;
     "tests/examples/playrec/Makefile") CONFIG_FILES="$CONFIG_FILES tests/examples/playrec/Makefile" ;;
     "tests/examples/v4l/Makefile") CONFIG_FILES="$CONFIG_FILES tests/examples/v4l/Makefile" ;;
     "tests/files/Makefile") CONFIG_FILES="$CONFIG_FILES tests/files/Makefile" ;;
@@ -33971,7 +34072,7 @@ $as_echo "$as_me: executing $ac_file commands" >&6;}
     # Strip MF so we end up with the name of the file.
     mf=`echo "$mf" | sed -e 's/:.*$//'`
     # Check whether this is an Automake generated Makefile or not.
-    # We used to match only the files named `Makefile.in', but
+    # We used to match only the files named 'Makefile.in', but
     # some people rename them; so instead we look at the file content.
     # Grep'ing the first line is not enough: some people post-process
     # each Makefile.in and add a new line on top of each file to say so.
@@ -34005,21 +34106,19 @@ $as_echo X"$mf" |
       continue
     fi
     # Extract the definition of DEPDIR, am__include, and am__quote
-    # from the Makefile without running `make'.
+    # from the Makefile without running 'make'.
     DEPDIR=`sed -n 's/^DEPDIR = //p' < "$mf"`
     test -z "$DEPDIR" && continue
     am__include=`sed -n 's/^am__include = //p' < "$mf"`
     test -z "am__include" && continue
     am__quote=`sed -n 's/^am__quote = //p' < "$mf"`
-    # When using ansi2knr, U may be empty or an underscore; expand it
-    U=`sed -n 's/^U = //p' < "$mf"`
     # Find all dependency output files, they are included files with
     # $(DEPDIR) in their names.  We invoke sed twice because it is the
     # simplest approach to changing $(DEPDIR) to its actual value in the
     # expansion.
     for file in `sed -n "
       s/^$am__include $am__quote\(.*(DEPDIR).*\)$am__quote"'$/\1/p' <"$mf" | \
-	 sed -e 's/\$(DEPDIR)/'"$DEPDIR"'/g' -e 's/\$U/'"$U"'/g'`; do
+	 sed -e 's/\$(DEPDIR)/'"$DEPDIR"'/g'`; do
       # Make sure the directory exists.
       test -f "$dirpart/$file" && continue
       fdir=`$as_dirname -- "$file" ||
diff --git a/configure.ac b/configure.ac
index 1901bcf..bca59c6 100644
--- a/configure.ac
+++ b/configure.ac
@@ -1,13 +1,11 @@
-AC_PREREQ(2.60)
+AC_PREREQ([2.60])
 
 dnl please read gstreamer/docs/random/autotools before changing this file
 
 dnl initialize autoconf
 dnl releases only do -Wall, git and prerelease does -Werror too
 dnl use a three digit version number for releases, and four for git/prerelease
-AC_INIT(GStreamer Base Plug-ins, 0.10.36,
-    http://bugzilla.gnome.org/enter_bug.cgi?product=GStreamer,
-    gst-plugins-base)
+AC_INIT([GStreamer Base Plug-ins],[0.10.36.1],[http://bugzilla.gnome.org/enter_bug.cgi?product=GStreamer],[gst-plugins-base])
 
 AG_GST_INIT
 
@@ -24,7 +22,7 @@ dnl can autoconf find the source ?
 AC_CONFIG_SRCDIR([gst/audiotestsrc/gstaudiotestsrc.c])
 
 dnl define the output header for config
-AM_CONFIG_HEADER([config.h])
+AC_CONFIG_HEADERS([config.h])
 
 dnl AM_MAINTAINER_MODE only provides the option to configure to enable it
 AM_MAINTAINER_MODE
@@ -49,7 +47,7 @@ dnl - interfaces added/removed/changed -> increment CURRENT, REVISION = 0
 dnl - interfaces added -> increment AGE
 dnl - interfaces removed -> AGE = 0
 dnl sets GST_LT_LDFLAGS
-AS_LIBTOOL(GST, 25, 0, 25)
+AS_LIBTOOL(GST, 26, 0, 26)
 
 dnl FIXME: this macro doesn't actually work;
 dnl the generated libtool script has no support for the listed tags.
@@ -78,6 +76,8 @@ AG_GST_GETTEXT([gst-plugins-base-$GST_MAJORMINOR])
 
 dnl *** check for arguments to configure ***
 
+AG_GST_ARG_DISABLE_FATAL_WARNINGS
+
 AG_GST_ARG_DEBUG
 AG_GST_ARG_PROFILING
 AG_GST_ARG_VALGRIND
@@ -93,8 +93,7 @@ AG_GST_PKG_CONFIG_PATH
 
 dnl let distro override plugin install helper path
 AC_ARG_WITH(install-plugins-helper,
-  AC_HELP_STRING([--with-install-plugins-helper],
-    [specify path of helper script to call to install plugins]),
+  AS_HELP_STRING([--with-install-plugins-helper],[specify path of helper script to call to install plugins]),
   [
     case "${withval}" in
       yes) AC_MSG_ERROR(bad value ${withval} for --with-install-plugins-helper) ;;
@@ -145,7 +144,7 @@ AC_PROG_CXX
 dnl CXX may be set to some default even if no c++ compiler is available
 dnl (thanks autotools!), so just try to compile some c++ code to make sure
 AC_LANG_PUSH([C++])
-AC_TRY_COMPILE([ class Foo { int bar; };], , working_cxx=yes, working_cxx=no)
+AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[ class Foo { int bar; };]], [[]])],[working_cxx=yes],[working_cxx=no])
 AC_LANG_POP([C++])
 AC_MSG_NOTICE([working c++ compiler found: $working_cxx])
 AM_CONDITIONAL(HAVE_CXX, test "x$working_cxx" = "xyes")
@@ -174,24 +173,28 @@ AC_HEADER_STDC
 
 dnl used in gst/ffmpegcolorspace/mem.c
 dnl FIXME: could be fixed by redefining av_malloc and av_free to GLib's
-AC_CHECK_HEADERS([malloc.h])
+AC_CHECK_HEADERS([malloc.h], [], [], [AC_INCLUDES_DEFAULT])
 
 ac_cppflags_save="$CPPFLAGS"
 CPPFLAGS="`$PKG_CONFIG --cflags libxml-2.0`"
-AC_COMPILE_IFELSE(
-  AC_LANG_PROGRAM([
+AC_COMPILE_IFELSE([
+  AC_LANG_PROGRAM([[
 #include <libxml/HTMLparser.h>
-                     ],[
+]],[[
 #ifndef LIBXML_HTML_ENABLED
 #error libxml2 has no HTML support
 #endif /* LIBXML_HTML_ENABLED */
-                   ]), HAVE_LIBXML_HTML="yes", HAVE_LIBXML_HTML="no")
+]])], [
+  HAVE_LIBXML_HTML="yes"
+], [
+  HAVE_LIBXML_HTML="no"
+])
 CPPFLAGS="$ac_cppflags_save"
 AM_CONDITIONAL(HAVE_LIBXML_HTML, test "x$HAVE_LIBXML_HTML" = "xyes")
 
 dnl used in gst/tcp
 AC_CHECK_HEADERS([sys/socket.h],
-  HAVE_SYS_SOCKET_H="yes", HAVE_SYS_SOCKET_H="no")
+  [HAVE_SYS_SOCKET_H="yes"], [HAVE_SYS_SOCKET_H="no"], [AC_INCLUDES_DEFAULT])
 AM_CONDITIONAL(HAVE_SYS_SOCKET_H, test "x$HAVE_SYS_SOCKET_H" = "xyes")
 
 dnl used in gst-libs/gst/rtsp
@@ -212,7 +215,7 @@ AC_SUBST(HSTRERROR_LIBS)
 LIBS="$save_libs"
 
 dnl used in gst-libs/gst/pbutils and associated unit test
-AC_CHECK_HEADERS([process.h sys/types.h sys/wait.h sys/stat.h])
+AC_CHECK_HEADERS([process.h sys/types.h sys/wait.h sys/stat.h], [], [], [AC_INCLUDES_DEFAULT])
 
 AC_CHECK_HEADERS([xmmintrin.h emmintrin.h])
 
@@ -332,16 +335,15 @@ AM_CONDITIONAL(HAVE_LINUX_JOYSTICK_HEADERS, test "x$HAVE_LINUX_JOYSTICK_HEADERS"
 dnl Check for -Bsymbolic-functions linker flag used to avoid
 dnl intra-library PLT jumps, if available.
 AC_ARG_ENABLE(Bsymbolic,
-              [AC_HELP_STRING([--disable-Bsymbolic],
-                              [avoid linking with -Bsymbolic])],,
+              [AS_HELP_STRING([--disable-Bsymbolic],[avoid linking with -Bsymbolic])],,
               [SAVED_LDFLAGS="${LDFLAGS}"
                AC_MSG_CHECKING([for -Bsymbolic-functions linker flag])
                LDFLAGS=-Wl,-Bsymbolic-functions
-               AC_TRY_LINK([], [int main (void) { return 0; }],
+               AC_LINK_IFELSE([AC_LANG_PROGRAM([[]], [[int main (void) { return 0; }]])],[
                            AC_MSG_RESULT(yes)
-                           enable_Bsymbolic=yes,
+                           enable_Bsymbolic=yes],[
                            AC_MSG_RESULT(no)
-                           enable_Bsymbolic=no)
+                           enable_Bsymbolic=no])
                LDFLAGS="${SAVED_LDFLAGS}"])
 
 
@@ -367,14 +369,14 @@ AG_GST_CHECK_GST_DEBUG_DISABLED([NO_WARNINGS="-Wno-unused"], [NO_WARNINGS=""])
 
 dnl define an ERROR_CFLAGS Makefile variable
 dnl -Wformat-nonliteral - see ext/pango/gstclockoverlay.c and http://gcc.gnu.org/bugzilla/show_bug.cgi?id=39438
-AG_GST_SET_ERROR_CFLAGS($GST_GIT, [
+AG_GST_SET_ERROR_CFLAGS($FATAL_WARNINGS, [
     -Wmissing-declarations -Wmissing-prototypes -Wredundant-decls -Wundef
     -Wwrite-strings -Wformat-nonliteral -Wformat-security
     -Winit-self -Wmissing-include-dirs -Waddress -Waggregate-return
     -Wno-multichar -Wnested-externs $NO_WARNINGS])
 
 dnl define an ERROR_CXXFLAGS Makefile variable
-AG_GST_SET_ERROR_CXXFLAGS($GST_GIT, [
+AG_GST_SET_ERROR_CXXFLAGS($FATAL_WARNINGS, [
     -Wmissing-declarations -Wredundant-decls -Wundef
     -Wwrite-strings -Wformat-nonliteral -Wformat-security
     -Winit-self -Wmissing-include-dirs -Waddress -Waggregate-return
@@ -450,7 +452,7 @@ fi
 
 dnl iso-codes is optional, used by libgsttag
 AC_ARG_ENABLE(iso-codes,
-AC_HELP_STRING([--enable-iso-codes],[use iso-codes if installed]),
+AS_HELP_STRING([--enable-iso-codes],[use iso-codes if installed]),
 [case "${enableval}" in
   yes) enable_iso_codes=yes ;;
   no)  enable_iso_codes=no ;;
@@ -529,7 +531,7 @@ AG_GST_CHECK_FEATURE(X, [X libraries and plugins],
   CPPFLAGS="$CPPFLAGS $X_CFLAGS"
 
   dnl now try to find the HEADER
-  AC_CHECK_HEADER(X11/Xlib.h, HAVE_X="yes", HAVE_X="no")
+  AC_CHECK_HEADER([X11/Xlib.h], [HAVE_X="yes"], [HAVE_X="no"], [AC_INCLUDES_DEFAULT])
 
   if test "x$HAVE_X" = "xno"
   then
@@ -787,7 +789,7 @@ AG_GST_CHECK_FEATURE(OGG, [Xiph Ogg library], ogg, [
 dnl *** pango ***
 translit(dnm, m, l) AM_CONDITIONAL(USE_PANGO, true)
 AG_GST_CHECK_FEATURE(PANGO, [Pango font rendering], pango, [
-  AG_GST_PKG_CHECK_MODULES(PANGO, pango >= 1.16.0  pangocairo >= 1.16.0)
+  AG_GST_PKG_CHECK_MODULES(PANGO, pango >= 1.22.0  pangocairo >= 1.22.0)
 ])
 
 dnl *** theora ***
@@ -810,14 +812,14 @@ AG_GST_CHECK_FEATURE(VORBIS, [Xiph Vorbis audio codec], vorbis, [
 
 if test "x$HAVE_VORBIS" = "xyes"; then
   ac_cflags_save="$CFLAGS"
-  AC_COMPILE_IFELSE(
-    AC_LANG_PROGRAM([
+  AC_COMPILE_IFELSE([
+    AC_LANG_PROGRAM([[
 #include <vorbis/codec.h>
-                     ],[
+                     ]],[[
 vorbis_dsp_state *v;
 
 vorbis_synthesis_restart (v);
-                     ]), HAVE_VSR=yes, HAVE_VSR=no)
+                     ]])], HAVE_VSR=yes, HAVE_VSR=no)
   if test "x$HAVE_VSR" = "xyes"; then
     AC_DEFINE_UNQUOTED(HAVE_VORBIS_SYNTHESIS_RESTART, 1,
                        [defined if vorbis_synthesis_restart is present])
@@ -1021,6 +1023,7 @@ tests/examples/gio/Makefile
 tests/examples/overlay/Makefile
 tests/examples/seek/Makefile
 tests/examples/snapshot/Makefile
+tests/examples/playback/Makefile
 tests/examples/playrec/Makefile
 tests/examples/v4l/Makefile
 tests/files/Makefile
diff --git a/ext/Makefile.in b/ext/Makefile.in
index e677f10..1bb9ff0 100644
--- a/ext/Makefile.in
+++ b/ext/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -20,6 +19,23 @@
 # descending into all subdirectories a second time, but only after the first
 # (parallel) run has finished, so it should go right through the second time.
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -38,6 +54,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
 	$(top_srcdir)/common/parallel-subdirs.mak
 subdir = ext
@@ -85,12 +102,18 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
 RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
@@ -100,6 +123,11 @@ RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
@@ -421,7 +449,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -508,12 +540,12 @@ clean-libtool:
 	-rm -rf .libs _libs
 
 # This directory's subdirectories are mostly independent; you can cd
-# into them and run `make' without going through this Makefile.
-# To change the values of `make' variables: instead of editing Makefiles,
-# (1) if the variable is set in `config.status', edit `config.status'
-#     (which will cause the Makefiles to be regenerated when you run `make');
-# (2) otherwise, pass the desired values on the `make' command line.
-$(RECURSIVE_TARGETS):
+# into them and run 'make' without going through this Makefile.
+# To change the values of 'make' variables: instead of editing Makefiles,
+# (1) if the variable is set in 'config.status', edit 'config.status'
+#     (which will cause the Makefiles to be regenerated when you run 'make');
+# (2) otherwise, pass the desired values on the 'make' command line.
+$(RECURSIVE_TARGETS) $(RECURSIVE_CLEAN_TARGETS):
 	@fail= failcom='exit 1'; \
 	for f in x $$MAKEFLAGS; do \
 	  case $$f in \
@@ -523,7 +555,11 @@ $(RECURSIVE_TARGETS):
 	done; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
-	list='$(SUBDIRS)'; for subdir in $$list; do \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	for subdir in $$list; do \
 	  echo "Making $$target in $$subdir"; \
 	  if test "$$subdir" = "."; then \
 	    dot_seen=yes; \
@@ -537,37 +573,6 @@ $(RECURSIVE_TARGETS):
 	if test "$$dot_seen" = "no"; then \
 	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
 	fi; test -z "$$fail"
-
-$(RECURSIVE_CLEAN_TARGETS):
-	@fail= failcom='exit 1'; \
-	for f in x $$MAKEFLAGS; do \
-	  case $$f in \
-	    *=* | --[!k]*);; \
-	    *k*) failcom='fail=yes';; \
-	  esac; \
-	done; \
-	dot_seen=no; \
-	case "$@" in \
-	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
-	  *) list='$(SUBDIRS)' ;; \
-	esac; \
-	rev=''; for subdir in $$list; do \
-	  if test "$$subdir" = "."; then :; else \
-	    rev="$$subdir $$rev"; \
-	  fi; \
-	done; \
-	rev="$$rev ."; \
-	target=`echo $@ | sed s/-recursive//`; \
-	for subdir in $$rev; do \
-	  echo "Making $$target in $$subdir"; \
-	  if test "$$subdir" = "."; then \
-	    local_target="$$target-am"; \
-	  else \
-	    local_target="$$target"; \
-	  fi; \
-	  ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
-	  || eval $$failcom; \
-	done && test -z "$$fail"
 tags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
@@ -576,6 +581,10 @@ ctags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
 	done
+cscopelist-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) cscopelist); \
+	done
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -639,6 +648,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist: cscopelist-recursive $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -674,13 +697,10 @@ distdir: $(DISTFILES)
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -801,22 +821,23 @@ ps-am:
 
 uninstall-am:
 
-.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) ctags-recursive \
-	install-am install-strip tags-recursive
+.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) \
+	cscopelist-recursive ctags-recursive install-am install-strip \
+	tags-recursive
 
 .PHONY: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) CTAGS GTAGS \
 	all all-am check check-am clean clean-generic clean-libtool \
-	ctags ctags-recursive distclean distclean-generic \
-	distclean-libtool distclean-tags distdir dvi dvi-am html \
-	html-am info info-am install install-am install-data \
-	install-data-am install-dvi install-dvi-am install-exec \
-	install-exec-am install-html install-html-am install-info \
-	install-info-am install-man install-pdf install-pdf-am \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs installdirs-am maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-generic \
-	mostlyclean-libtool pdf pdf-am ps ps-am tags tags-recursive \
-	uninstall uninstall-am
+	cscopelist cscopelist-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-libtool distclean-tags \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-dvi \
+	install-dvi-am install-exec install-exec-am install-html \
+	install-html-am install-info install-info-am install-man \
+	install-pdf install-pdf-am install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	mostlyclean mostlyclean-generic mostlyclean-libtool pdf pdf-am \
+	ps ps-am tags tags-recursive uninstall uninstall-am
 
 
 .PHONY: independent-subdirs $(SUBDIRS)
diff --git a/ext/alsa/Makefile.in b/ext/alsa/Makefile.in
index 82668c9..53b9951 100644
--- a/ext/alsa/Makefile.in
+++ b/ext/alsa/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/alsa
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -126,10 +143,23 @@ libgstalsa_la_OBJECTS = $(am_libgstalsa_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstalsa_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstalsa_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstalsa_la_CFLAGS) $(CFLAGS) \
 	$(libgstalsa_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -142,22 +172,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstalsa_la_SOURCES)
 DIST_SOURCES = $(libgstalsa_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -450,7 +481,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -526,7 +561,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -534,6 +568,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -549,12 +585,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstalsa.la: $(libgstalsa_la_OBJECTS) $(libgstalsa_la_DEPENDENCIES) $(EXTRA_libgstalsa_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstalsa_la_LINK) -rpath $(plugindir) $(libgstalsa_la_OBJECTS) $(libgstalsa_la_LIBADD) $(LIBS)
 
@@ -713,6 +751,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -857,18 +909,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/alsa/gstalsa.c b/ext/alsa/gstalsa.c
index 94ed44c..b5d6280 100644
--- a/ext/alsa/gstalsa.c
+++ b/ext/alsa/gstalsa.c
@@ -121,7 +121,7 @@ gst_alsa_detect_formats (GstObject * obj, snd_pcm_hw_params_t * hw_params,
 
     s = gst_caps_get_structure (in_caps, i);
     if (!gst_structure_has_name (s, "audio/x-raw-int")) {
-      GST_WARNING_OBJECT (obj, "skipping non-int format");
+      GST_DEBUG_OBJECT (obj, "skipping non-int format");
       continue;
     }
     if (!gst_structure_get_int (s, "width", &width) ||
@@ -361,7 +361,7 @@ max_chan_error:
 }
 
 snd_pcm_t *
-gst_alsa_open_iec958_pcm (GstObject * obj)
+gst_alsa_open_iec958_pcm (GstObject * obj, gchar * device)
 {
   char *iec958_pcm_name = NULL;
   snd_pcm_t *pcm = NULL;
@@ -380,7 +380,8 @@ gst_alsa_open_iec958_pcm (GstObject * obj)
    *    spdif:{AES0 0x2 AES1 0x82 AES2 0x0 AES3 0x2}
    */
   sprintf (devstr,
-      "iec958:{AES0 0x%02x AES1 0x%02x AES2 0x%02x AES3 0x%02x}",
+      "%s:{AES0 0x%02x AES1 0x%02x AES2 0x%02x AES3 0x%02x}",
+      device,
       IEC958_AES0_CON_EMPHASIS_NONE | IEC958_AES0_NONAUDIO,
       IEC958_AES1_CON_ORIGINAL | IEC958_AES1_CON_PCM_CODER,
       0, IEC958_AES3_CON_FS_48000);
@@ -408,8 +409,8 @@ gst_alsa_open_iec958_pcm (GstObject * obj)
  */
 
 GstCaps *
-gst_alsa_probe_supported_formats (GstObject * obj, snd_pcm_t * handle,
-    const GstCaps * template_caps)
+gst_alsa_probe_supported_formats (GstObject * obj, gchar * device,
+    snd_pcm_t * handle, const GstCaps * template_caps)
 {
   snd_pcm_hw_params_t *hw_params;
   snd_pcm_stream_t stream_type;
@@ -436,10 +437,10 @@ gst_alsa_probe_supported_formats (GstObject * obj, snd_pcm_t * handle,
   /* Try opening IEC958 device to see if we can support that format (playback
    * only for now but we could add SPDIF capture later) */
   if (stream_type == SND_PCM_STREAM_PLAYBACK) {
-    snd_pcm_t *pcm = gst_alsa_open_iec958_pcm (obj);
+    snd_pcm_t *pcm = gst_alsa_open_iec958_pcm (obj, device);
 
     if (G_LIKELY (pcm)) {
-      gst_caps_append (caps, gst_caps_new_simple ("audio/x-iec958", NULL));
+      gst_caps_append (caps, gst_caps_from_string (PASSTHROUGH_CAPS));
       snd_pcm_close (pcm);
     }
   }
diff --git a/ext/alsa/gstalsa.h b/ext/alsa/gstalsa.h
index 92466d2..9623c0e 100644
--- a/ext/alsa/gstalsa.h
+++ b/ext/alsa/gstalsa.h
@@ -38,12 +38,22 @@
      (SND_LIB_MAJOR == (major) && SND_LIB_MINOR == (minor) && \
       SND_LIB_SUBMINOR >= (micro)))
 
+#define PASSTHROUGH_CAPS \
+    "audio/x-ac3, framed = (boolean) true;" \
+    "audio/x-eac3, framed = (boolean) true; " \
+    "audio/x-dts, framed = (boolean) true, " \
+      "block-size = (int) { 512, 1024, 2048 }; " \
+    "audio/mpeg, mpegversion = (int) 1, " \
+      "mpegaudioversion = (int) [ 1, 2 ], parsed = (boolean) true;"
+
+
 GST_DEBUG_CATEGORY_EXTERN (alsa_debug);
 #define GST_CAT_DEFAULT alsa_debug
 
-snd_pcm_t * gst_alsa_open_iec958_pcm (GstObject * obj);
+snd_pcm_t * gst_alsa_open_iec958_pcm (GstObject * obj, gchar *device);
 
 GstCaps * gst_alsa_probe_supported_formats (GstObject      * obj,
+                                            gchar          * device,
                                             snd_pcm_t      * handle,
                                             const GstCaps  * template_caps);
 
diff --git a/ext/alsa/gstalsadeviceprobe.c b/ext/alsa/gstalsadeviceprobe.c
index 4b22d34..337c21b 100644
--- a/ext/alsa/gstalsadeviceprobe.c
+++ b/ext/alsa/gstalsadeviceprobe.c
@@ -19,6 +19,10 @@
  * Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
diff --git a/ext/alsa/gstalsasink.c b/ext/alsa/gstalsasink.c
index 53fd1c2..1600426 100644
--- a/ext/alsa/gstalsasink.c
+++ b/ext/alsa/gstalsasink.c
@@ -51,6 +51,7 @@
 #include "gstalsasink.h"
 #include "gstalsadeviceprobe.h"
 
+#include <gst/audio/gstaudioiec61937.h>
 #include <gst/gst-i18n-plugin.h>
 #include "gst/glib-compat-private.h"
 
@@ -91,6 +92,9 @@ static guint gst_alsasink_write (GstAudioSink * asink, gpointer data,
     guint length);
 static guint gst_alsasink_delay (GstAudioSink * asink);
 static void gst_alsasink_reset (GstAudioSink * asink);
+static gboolean gst_alsasink_acceptcaps (GstPad * pad, GstCaps * caps);
+static GstBuffer *gst_alsasink_payload (GstBaseAudioSink * sink,
+    GstBuffer * buf);
 
 static gint output_ref;         /* 0    */
 static snd_output_t *output;    /* NULL */
@@ -136,7 +140,7 @@ static GstStaticPadTemplate alsasink_sink_factory =
         "width = (int) 8, "
         "depth = (int) 8, "
         "rate = (int) [ 1, MAX ], " "channels = (int) [ 1, MAX ];"
-        "audio/x-iec958")
+        PASSTHROUGH_CAPS)
     );
 
 static void
@@ -146,6 +150,7 @@ gst_alsasink_finalise (GObject * object)
 
   g_free (sink->device);
   g_mutex_free (sink->alsa_lock);
+  g_mutex_free (sink->delay_lock);
 
   g_static_mutex_lock (&output_mutex);
   --output_ref;
@@ -182,10 +187,12 @@ gst_alsasink_class_init (GstAlsaSinkClass * klass)
 {
   GObjectClass *gobject_class;
   GstBaseSinkClass *gstbasesink_class;
+  GstBaseAudioSinkClass *gstbaseaudiosink_class;
   GstAudioSinkClass *gstaudiosink_class;
 
   gobject_class = (GObjectClass *) klass;
   gstbasesink_class = (GstBaseSinkClass *) klass;
+  gstbaseaudiosink_class = (GstBaseAudioSinkClass *) klass;
   gstaudiosink_class = (GstAudioSinkClass *) klass;
 
   parent_class = g_type_class_peek_parent (klass);
@@ -196,6 +203,8 @@ gst_alsasink_class_init (GstAlsaSinkClass * klass)
 
   gstbasesink_class->get_caps = GST_DEBUG_FUNCPTR (gst_alsasink_getcaps);
 
+  gstbaseaudiosink_class->payload = GST_DEBUG_FUNCPTR (gst_alsasink_payload);
+
   gstaudiosink_class->open = GST_DEBUG_FUNCPTR (gst_alsasink_open);
   gstaudiosink_class->prepare = GST_DEBUG_FUNCPTR (gst_alsasink_prepare);
   gstaudiosink_class->unprepare = GST_DEBUG_FUNCPTR (gst_alsasink_unprepare);
@@ -280,6 +289,7 @@ gst_alsasink_init (GstAlsaSink * alsasink, GstAlsaSinkClass * g_class)
   alsasink->handle = NULL;
   alsasink->cached_caps = NULL;
   alsasink->alsa_lock = g_mutex_new ();
+  alsasink->delay_lock = g_mutex_new ();
 
   g_static_mutex_lock (&output_mutex);
   if (output_ref == 0) {
@@ -287,12 +297,18 @@ gst_alsasink_init (GstAlsaSink * alsasink, GstAlsaSinkClass * g_class)
     ++output_ref;
   }
   g_static_mutex_unlock (&output_mutex);
+
+  gst_pad_set_acceptcaps_function (GST_BASE_SINK (alsasink)->sinkpad,
+      GST_DEBUG_FUNCPTR (gst_alsasink_acceptcaps));
+
 }
 
 #define CHECK(call, error) \
-G_STMT_START {                  \
-if ((err = call) < 0)           \
-  goto error;                   \
+G_STMT_START {             \
+  if ((err = call) < 0) {  \
+    GST_WARNING_OBJECT (alsa, "Error %d (%s) calling " #call, err, snd_strerror (err)); \
+    goto error;            \
+  }                        \
 } G_STMT_END;
 
 static GstCaps *
@@ -317,8 +333,8 @@ gst_alsasink_getcaps (GstBaseSink * bsink)
   pad_template = gst_element_class_get_pad_template (element_class, "sink");
   g_return_val_if_fail (pad_template != NULL, NULL);
 
-  caps = gst_alsa_probe_supported_formats (GST_OBJECT (sink), sink->handle,
-      gst_pad_template_get_caps (pad_template));
+  caps = gst_alsa_probe_supported_formats (GST_OBJECT (sink), sink->device,
+      sink->handle, gst_pad_template_get_caps (pad_template));
 
   if (caps) {
     sink->cached_caps = gst_caps_ref (caps);
@@ -329,6 +345,60 @@ gst_alsasink_getcaps (GstBaseSink * bsink)
   return caps;
 }
 
+static gboolean
+gst_alsasink_acceptcaps (GstPad * pad, GstCaps * caps)
+{
+  GstAlsaSink *alsa = GST_ALSA_SINK (gst_pad_get_parent_element (pad));
+  GstCaps *pad_caps;
+  GstStructure *st;
+  gboolean ret = FALSE;
+  GstRingBufferSpec spec = { 0 };
+
+  pad_caps = gst_pad_get_caps_reffed (pad);
+  if (pad_caps) {
+    ret = gst_caps_can_intersect (pad_caps, caps);
+    gst_caps_unref (pad_caps);
+    if (!ret)
+      goto done;
+  }
+
+  /* If we've not got fixed caps, creating a stream might fail, so let's just
+   * return from here with default acceptcaps behaviour */
+  if (!gst_caps_is_fixed (caps))
+    goto done;
+
+  /* parse helper expects this set, so avoid nasty warning
+   * will be set properly later on anyway  */
+  spec.latency_time = GST_SECOND;
+  if (!gst_ring_buffer_parse_caps (&spec, caps))
+    goto done;
+
+  /* Make sure input is framed (one frame per buffer) and can be payloaded */
+  switch (spec.type) {
+    case GST_BUFTYPE_AC3:
+    case GST_BUFTYPE_EAC3:
+    case GST_BUFTYPE_DTS:
+    case GST_BUFTYPE_MPEG:
+    {
+      gboolean framed = FALSE, parsed = FALSE;
+      st = gst_caps_get_structure (caps, 0);
+
+      gst_structure_get_boolean (st, "framed", &framed);
+      gst_structure_get_boolean (st, "parsed", &parsed);
+      if ((!framed && !parsed) || gst_audio_iec61937_frame_size (&spec) <= 0)
+        goto done;
+    }
+    default:{
+    }
+  }
+  ret = TRUE;
+
+done:
+  gst_caps_replace (&spec.caps, NULL);
+  gst_object_unref (alsa);
+  return ret;
+}
+
 static int
 set_hwparams (GstAlsaSink * alsa)
 {
@@ -640,7 +710,10 @@ alsasink_parse_spec (GstAlsaSink * alsa, GstRingBufferSpec * spec)
     case GST_BUFTYPE_MU_LAW:
       alsa->format = SND_PCM_FORMAT_MU_LAW;
       break;
-    case GST_BUFTYPE_IEC958:
+    case GST_BUFTYPE_AC3:
+    case GST_BUFTYPE_EAC3:
+    case GST_BUFTYPE_DTS:
+    case GST_BUFTYPE_MPEG:
       alsa->format = SND_PCM_FORMAT_S16_BE;
       alsa->iec958 = TRUE;
       break;
@@ -705,9 +778,9 @@ gst_alsasink_prepare (GstAudioSink * asink, GstRingBufferSpec * spec)
 
   alsa = GST_ALSA_SINK (asink);
 
-  if (spec->format == GST_IEC958) {
+  if (alsa->iec958) {
     snd_pcm_close (alsa->handle);
-    alsa->handle = gst_alsa_open_iec958_pcm (GST_OBJECT (alsa));
+    alsa->handle = gst_alsa_open_iec958_pcm (GST_OBJECT (alsa), alsa->device);
     if (G_UNLIKELY (!alsa->handle)) {
       goto no_iec958;
     }
@@ -858,7 +931,9 @@ gst_alsasink_write (GstAudioSink * asink, gpointer data, guint length)
     if (err < 0) {
       GST_DEBUG_OBJECT (asink, "wait error, %d", err);
     } else {
+      GST_DELAY_SINK_LOCK (asink);
       err = snd_pcm_writei (alsa->handle, ptr, cptr);
+      GST_DELAY_SINK_UNLOCK (asink);
     }
 
     GST_DEBUG_OBJECT (asink, "written %d frames out of %d", err, cptr);
@@ -895,7 +970,9 @@ gst_alsasink_delay (GstAudioSink * asink)
 
   alsa = GST_ALSA_SINK (asink);
 
+  GST_DELAY_SINK_LOCK (asink);
   res = snd_pcm_delay (alsa->handle, &delay);
+  GST_DELAY_SINK_UNLOCK (asink);
   if (G_UNLIKELY (res < 0)) {
     /* on errors, report 0 delay */
     GST_DEBUG_OBJECT (alsa, "snd_pcm_delay returned %d", res);
@@ -944,3 +1021,34 @@ prepare_error:
     return;
   }
 }
+
+static GstBuffer *
+gst_alsasink_payload (GstBaseAudioSink * sink, GstBuffer * buf)
+{
+  GstAlsaSink *alsa;
+
+  alsa = GST_ALSA_SINK (sink);
+
+  if (alsa->iec958) {
+    GstBuffer *out;
+    gint framesize;
+
+    framesize = gst_audio_iec61937_frame_size (&sink->ringbuffer->spec);
+    if (framesize <= 0)
+      return NULL;
+
+    out = gst_buffer_new_and_alloc (framesize);
+
+    if (!gst_audio_iec61937_payload (GST_BUFFER_DATA (buf),
+            GST_BUFFER_SIZE (buf), GST_BUFFER_DATA (out),
+            GST_BUFFER_SIZE (out), &sink->ringbuffer->spec)) {
+      gst_buffer_unref (out);
+      return NULL;
+    }
+
+    gst_buffer_copy_metadata (out, buf, GST_BUFFER_COPY_ALL);
+    return out;
+  }
+
+  return gst_buffer_ref (buf);
+}
diff --git a/ext/alsa/gstalsasink.h b/ext/alsa/gstalsasink.h
index 902dbf7..c1eea47 100644
--- a/ext/alsa/gstalsasink.h
+++ b/ext/alsa/gstalsasink.h
@@ -43,6 +43,10 @@ typedef struct _GstAlsaSinkClass GstAlsaSinkClass;
 #define GST_ALSA_SINK_LOCK(obj)	        (g_mutex_lock (GST_ALSA_SINK_GET_LOCK (obj)))
 #define GST_ALSA_SINK_UNLOCK(obj)	(g_mutex_unlock (GST_ALSA_SINK_GET_LOCK (obj)))
 
+#define GST_DELAY_SINK_GET_LOCK(obj)	(GST_ALSA_SINK_CAST (obj)->delay_lock)
+#define GST_DELAY_SINK_LOCK(obj)	(g_mutex_lock (GST_DELAY_SINK_GET_LOCK (obj)))
+#define GST_DELAY_SINK_UNLOCK(obj)	(g_mutex_unlock (GST_DELAY_SINK_GET_LOCK (obj)))
+
 /**
  * GstAlsaSink:
  *
@@ -73,6 +77,7 @@ struct _GstAlsaSink {
   GstCaps *cached_caps;
 
   GMutex *alsa_lock;
+  GMutex *delay_lock;
 };
 
 struct _GstAlsaSinkClass {
diff --git a/ext/alsa/gstalsasrc.c b/ext/alsa/gstalsasrc.c
index 917f0dc..f44baa5 100644
--- a/ext/alsa/gstalsasrc.c
+++ b/ext/alsa/gstalsasrc.c
@@ -329,8 +329,8 @@ gst_alsasrc_getcaps (GstBaseSrc * bsrc)
   pad_template = gst_element_class_get_pad_template (element_class, "src");
   g_return_val_if_fail (pad_template != NULL, NULL);
 
-  caps = gst_alsa_probe_supported_formats (GST_OBJECT (src), src->handle,
-      gst_pad_template_get_caps (pad_template));
+  caps = gst_alsa_probe_supported_formats (GST_OBJECT (src),
+      src->device, src->handle, gst_pad_template_get_caps (pad_template));
 
   if (caps) {
     src->cached_caps = gst_caps_ref (caps);
diff --git a/ext/cdparanoia/Makefile.in b/ext/cdparanoia/Makefile.in
index a60d024..d56f603 100644
--- a/ext/cdparanoia/Makefile.in
+++ b/ext/cdparanoia/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/cdparanoia
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -121,10 +138,23 @@ libgstcdparanoia_la_OBJECTS = $(am_libgstcdparanoia_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstcdparanoia_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstcdparanoia_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstcdparanoia_la_CFLAGS) $(CFLAGS) \
 	$(libgstcdparanoia_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -137,22 +167,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstcdparanoia_la_SOURCES)
 DIST_SOURCES = $(libgstcdparanoia_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -445,7 +476,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -502,7 +537,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -510,6 +544,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -525,12 +561,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstcdparanoia.la: $(libgstcdparanoia_la_OBJECTS) $(libgstcdparanoia_la_DEPENDENCIES) $(EXTRA_libgstcdparanoia_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstcdparanoia_la_LINK) -rpath $(plugindir) $(libgstcdparanoia_la_OBJECTS) $(libgstcdparanoia_la_LIBADD) $(LIBS)
 
@@ -625,6 +663,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -769,18 +821,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/cdparanoia/gstcdparanoiasrc.c b/ext/cdparanoia/gstcdparanoiasrc.c
index 864ebc7..4105575 100644
--- a/ext/cdparanoia/gstcdparanoiasrc.c
+++ b/ext/cdparanoia/gstcdparanoiasrc.c
@@ -147,8 +147,9 @@ gst_cd_paranoia_src_class_init (GstCdParanoiaSrcClass * klass)
           G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
   g_object_class_install_property (G_OBJECT_CLASS (klass), PROP_READ_SPEED,
       g_param_spec_int ("read-speed", "Read speed",
-          "Read from device at specified speed", -1, G_MAXINT,
-          DEFAULT_READ_SPEED, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+          "Read from device at specified speed (-1 and 0 = full speed)",
+          -1, G_MAXINT, DEFAULT_READ_SPEED,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
   g_object_class_install_property (G_OBJECT_CLASS (klass), PROP_PARANOIA_MODE,
       g_param_spec_flags ("paranoia-mode", "Paranoia mode",
           "Type of checking to perform", GST_TYPE_CD_PARANOIA_MODE,
@@ -232,9 +233,8 @@ gst_cd_paranoia_src_open (GstCddaBaseSrc * cddabasesrc, const gchar * device)
   if (cdda_open (src->d))
     goto open_failed;
 
-  if (src->read_speed != -1) {
-    cdda_speed_set (src->d, src->read_speed);
-  }
+  GST_INFO_OBJECT (src, "set read speed to %d", src->read_speed);
+  cdda_speed_set (src->d, src->read_speed);
 
   for (i = 1; i < src->d->tracks + 1; i++) {
     GstCddaBaseSrcTrack track = { 0, };
diff --git a/ext/gio/Makefile.in b/ext/gio/Makefile.in
index d836401..0098fa9 100644
--- a/ext/gio/Makefile.in
+++ b/ext/gio/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -19,6 +18,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -37,9 +53,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/gio
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -125,10 +142,23 @@ libgstgio_la_OBJECTS = $(am_libgstgio_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstgio_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstgio_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstgio_la_CFLAGS) $(CFLAGS) \
 	$(libgstgio_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -141,22 +171,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstgio_la_SOURCES)
 DIST_SOURCES = $(libgstgio_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -449,7 +480,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -516,7 +551,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -524,6 +558,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -539,12 +575,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstgio.la: $(libgstgio_la_OBJECTS) $(libgstgio_la_DEPENDENCIES) $(EXTRA_libgstgio_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstgio_la_LINK) -rpath $(plugindir) $(libgstgio_la_OBJECTS) $(libgstgio_la_LIBADD) $(LIBS)
 
@@ -687,6 +725,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -831,18 +883,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/gnomevfs/Makefile.in b/ext/gnomevfs/Makefile.in
index 5a8305d..c4f9d65 100644
--- a/ext/gnomevfs/Makefile.in
+++ b/ext/gnomevfs/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/gnomevfs
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -122,10 +139,23 @@ libgstgnomevfs_la_OBJECTS = $(am_libgstgnomevfs_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstgnomevfs_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstgnomevfs_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstgnomevfs_la_CFLAGS) $(CFLAGS) \
 	$(libgstgnomevfs_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -138,22 +168,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstgnomevfs_la_SOURCES)
 DIST_SOURCES = $(libgstgnomevfs_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -446,7 +477,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -508,7 +543,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -516,6 +550,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -531,12 +567,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstgnomevfs.la: $(libgstgnomevfs_la_OBJECTS) $(libgstgnomevfs_la_DEPENDENCIES) $(EXTRA_libgstgnomevfs_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstgnomevfs_la_LINK) -rpath $(plugindir) $(libgstgnomevfs_la_OBJECTS) $(libgstgnomevfs_la_LIBADD) $(LIBS)
 
@@ -655,6 +693,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -799,18 +851,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/libvisual/Makefile.in b/ext/libvisual/Makefile.in
index 38a95d1..d5cb2f9 100644
--- a/ext/libvisual/Makefile.in
+++ b/ext/libvisual/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,8 +50,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/libvisual
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -117,10 +135,23 @@ libgstlibvisual_la_OBJECTS = $(am_libgstlibvisual_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstlibvisual_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstlibvisual_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstlibvisual_la_CFLAGS) $(CFLAGS) \
 	$(libgstlibvisual_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -133,22 +164,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstlibvisual_la_SOURCES)
 DIST_SOURCES = $(libgstlibvisual_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -440,7 +472,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -486,7 +522,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -494,6 +529,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -509,12 +546,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstlibvisual.la: $(libgstlibvisual_la_OBJECTS) $(libgstlibvisual_la_DEPENDENCIES) $(EXTRA_libgstlibvisual_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstlibvisual_la_LINK) -rpath $(plugindir) $(libgstlibvisual_la_OBJECTS) $(libgstlibvisual_la_LIBADD) $(LIBS)
 
@@ -609,6 +648,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -753,18 +806,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/libvisual/visual.c b/ext/libvisual/visual.c
index 5630a21..c0ba5cf 100644
--- a/ext/libvisual/visual.c
+++ b/ext/libvisual/visual.c
@@ -26,6 +26,7 @@
 #include <gst/video/video.h>
 #include <gst/audio/audio.h>
 #include <libvisual/libvisual.h>
+#include <string.h>
 
 #define GST_TYPE_VISUAL (gst_visual_get_type())
 #define GST_IS_VISUAL(obj) (G_TYPE_CHECK_INSTANCE_TYPE((obj),GST_TYPE_VISUAL))
diff --git a/ext/ogg/Makefile.in b/ext/ogg/Makefile.in
index 012cf8d..e18298e 100644
--- a/ext/ogg/Makefile.in
+++ b/ext/ogg/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/ogg
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -125,10 +142,23 @@ libgstogg_la_OBJECTS = $(am_libgstogg_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstogg_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstogg_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstogg_la_CFLAGS) $(CFLAGS) \
 	$(libgstogg_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -141,22 +171,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstogg_la_SOURCES)
 DIST_SOURCES = $(libgstogg_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -449,7 +480,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -519,7 +554,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -527,6 +561,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -542,12 +578,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstogg.la: $(libgstogg_la_OBJECTS) $(libgstogg_la_DEPENDENCIES) $(EXTRA_libgstogg_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstogg_la_LINK) -rpath $(plugindir) $(libgstogg_la_OBJECTS) $(libgstogg_la_LIBADD) $(LIBS)
 
@@ -706,6 +744,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -850,18 +902,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/ext/ogg/gstoggdemux.c b/ext/ogg/gstoggdemux.c
index ac01b05..ff037b2 100644
--- a/ext/ogg/gstoggdemux.c
+++ b/ext/ogg/gstoggdemux.c
@@ -60,6 +60,10 @@
 /* stop duration checks within this much of EOS */
 #define EOS_AVOIDANCE_THRESHOLD 8192
 
+/* An Ogg page can not be larger than 255 segments of 255 bytes, plus
+   26 bytes of header */
+#define MAX_OGG_PAGE_SIZE (255 * 255 + 26)
+
 #define GST_FLOW_LIMIT GST_FLOW_CUSTOM_ERROR
 #define GST_FLOW_SKIP_PUSH GST_FLOW_CUSTOM_SUCCESS_1
 
@@ -183,8 +187,6 @@ gst_ogg_pad_init (GstOggPad * pad)
   gst_pad_set_query_function (GST_PAD (pad),
       GST_DEBUG_FUNCPTR (gst_ogg_pad_src_query));
 
-  pad->mode = GST_OGG_PAD_MODE_INIT;
-
   pad->current_granule = -1;
   pad->keyframe_granule = -1;
 
@@ -328,11 +330,23 @@ gst_ogg_pad_src_query (GstPad * pad, GstQuery * query)
         gboolean seekable = FALSE;
         gint64 stop = -1;
 
+        GST_CHAIN_LOCK (ogg);
         if (ogg->pullmode) {
           seekable = TRUE;
           stop = ogg->total_time;
         } else if (ogg->push_disable_seeking) {
           seekable = FALSE;
+        } else if (ogg->current_chain == NULL) {
+          GstQuery *squery;
+
+          /* assume we can seek if upstream is seekable in BYTES format */
+          GST_LOG_OBJECT (ogg, "no current chain, check upstream seekability");
+          squery = gst_query_new_seeking (GST_FORMAT_BYTES);
+          if (gst_pad_peer_query (ogg->sinkpad, squery))
+            gst_query_parse_seeking (squery, NULL, &seekable, NULL, NULL);
+          else
+            seekable = FALSE;
+          gst_query_unref (squery);
         } else if (ogg->current_chain->streams->len) {
           gint i;
 
@@ -361,6 +375,7 @@ gst_ogg_pad_src_query (GstPad * pad, GstQuery * query)
         }
 
         gst_query_set_seeking (query, GST_FORMAT_TIME, seekable, 0, stop);
+        GST_CHAIN_UNLOCK (ogg);
       } else {
         res = FALSE;
       }
@@ -572,8 +587,15 @@ gst_ogg_demux_chain_peer (GstOggPad * pad, ogg_packet * packet,
     out_offset_end = -1;
   } else {
     if (packet->granulepos != -1) {
-      pad->current_granule = gst_ogg_stream_granulepos_to_granule (&pad->map,
+      gint64 granule = gst_ogg_stream_granulepos_to_granule (&pad->map,
           packet->granulepos);
+      if (granule < 0) {
+        GST_ERROR_OBJECT (ogg,
+            "granulepos %" G_GINT64_FORMAT " yielded granule %" G_GINT64_FORMAT,
+            (gint64) packet->granulepos, (gint64) granule);
+        return GST_FLOW_ERROR;
+      }
+      pad->current_granule = granule;
       pad->keyframe_granule =
           gst_ogg_stream_granulepos_to_key_granule (&pad->map,
           packet->granulepos);
@@ -794,9 +816,8 @@ gst_ogg_demux_collect_sync_time (GstOggDemux * ogg, GstOggChain * chain)
   return sync_time;
 }
 
-/* submit a packet to the oggpad, this function will run the
- * typefind code for the pad if this is the first packet for this
- * stream 
+/* submit a packet to the oggpad, this function will run the type detection
+ * code for the pad if this is the first packet for this stream
  */
 static GstFlowReturn
 gst_ogg_pad_submit_packet (GstOggPad * pad, ogg_packet * packet)
@@ -883,6 +904,11 @@ gst_ogg_pad_submit_packet (GstOggPad * pad, ogg_packet * packet)
   if (granule != -1) {
     GST_DEBUG_OBJECT (ogg, "%p has granulepos %" G_GINT64_FORMAT, pad, granule);
     pad->current_granule = granule;
+  } else if (granule != -1) {
+    GST_ERROR_OBJECT (ogg,
+        "granulepos %" G_GINT64_FORMAT " yielded granule %" G_GINT64_FORMAT,
+        (gint64) packet->granulepos, (gint64) granule);
+    return GST_FLOW_ERROR;
   }
 
   /* restart header packet count when seeing a b_o_s page;
@@ -920,11 +946,23 @@ gst_ogg_pad_submit_packet (GstOggPad * pad, ogg_packet * packet)
 
         granule = gst_ogg_stream_granulepos_to_granule (&pad->map,
             packet->granulepos);
+        if (granule < 0) {
+          GST_ERROR_OBJECT (ogg,
+              "granulepos %" G_GINT64_FORMAT " yielded granule %"
+              G_GINT64_FORMAT, (gint64) packet->granulepos, (gint64) granule);
+          return GST_FLOW_ERROR;
+        }
 
-        if (granule > pad->map.accumulated_granule)
+        if (granule >= pad->map.accumulated_granule)
           start_granule = granule - pad->map.accumulated_granule;
-        else
-          start_granule = 0;
+        else {
+          if (pad->map.forbid_start_clamping) {
+            GST_ERROR_OBJECT (ogg, "Start of stream maps to negative time");
+            return GST_FLOW_ERROR;
+          } else {
+            start_granule = 0;
+          }
+        }
 
         pad->start_time = gst_ogg_stream_granule_to_time (&pad->map,
             start_granule);
@@ -2361,10 +2399,18 @@ gst_ogg_demux_get_prev_page (GstOggDemux * ogg, ogg_page * og, gint64 * offset)
      * start, we save it. It might not be the final page as there could be
      * another page after this one. */
     while (ogg->offset < end) {
-      gint64 new_offset;
-
-      ret =
-          gst_ogg_demux_get_next_page (ogg, og, end - ogg->offset, &new_offset);
+      gint64 new_offset, boundary;
+
+      /* An Ogg page cannot be more than a bit less than 64 KB, so we can
+         bound the boundary to that size when searching backwards if we
+         haven't found a page yet. So the most we have to look at is twice
+         the max page size, which is the worst case if we start scanning
+         just after a large page, after which also lies a large page. */
+      boundary = end - ogg->offset;
+      if (boundary > 2 * MAX_OGG_PAGE_SIZE)
+        boundary = 2 * MAX_OGG_PAGE_SIZE;
+
+      ret = gst_ogg_demux_get_next_page (ogg, og, boundary, &new_offset);
       /* we hit the upper limit, offset contains the last page start */
       if (ret == GST_FLOW_LIMIT) {
         GST_LOG_OBJECT (ogg, "hit limit");
@@ -3582,9 +3628,8 @@ done:
  * structure with the results. 
  * 
  * This function will also read N pages from each stream in the
- * chain and submit them to the decoders. When the decoder has
- * decoded the first buffer, we know the timestamp of the first
- * page in the chain.
+ * chain and submit them to the internal ogg stream parser/mapper
+ * until we know the timestamp of the first page in the chain.
  */
 static GstFlowReturn
 gst_ogg_demux_read_chain (GstOggDemux * ogg, GstOggChain ** res_chain)
@@ -3598,8 +3643,8 @@ gst_ogg_demux_read_chain (GstOggDemux * ogg, GstOggChain ** res_chain)
 
   GST_LOG_OBJECT (ogg, "reading chain at %" G_GINT64_FORMAT, offset);
 
-  /* first read the BOS pages, do typefind on them, create
-   * the decoders, send data to the decoders. */
+  /* first read the BOS pages, detect the stream types, create the internal
+   * stream mappers, send data to them. */
   while (TRUE) {
     GstOggPad *pad;
     guint32 serial;
@@ -3658,11 +3703,10 @@ gst_ogg_demux_read_chain (GstOggDemux * ogg, GstOggChain ** res_chain)
   }
 
   chain->have_bos = TRUE;
-  GST_LOG_OBJECT (ogg, "read bos pages, init decoder now");
+  GST_INFO_OBJECT (ogg, "read bos pages, ");
 
-  /* now read pages until we receive a buffer from each of the
-   * stream decoders, this will tell us the timestamp of the
-   * first packet in the chain then */
+  /* now read pages until each ogg stream mapper has figured out the
+   * timestamp of the first packet in the chain */
 
   /* save the offset to the first non bos page in the chain: if searching for
    * pad->first_time we read past the end of the chain, we'll seek back to this
@@ -3689,7 +3733,7 @@ gst_ogg_demux_read_chain (GstOggDemux * ogg, GstOggChain ** res_chain)
         known_serial = TRUE;
 
         /* submit the page now, this will fill in the start_time when the
-         * internal decoder finds it */
+         * internal stream mapper finds it */
         gst_ogg_pad_submit_page (pad, &og);
 
         if (!pad->map.is_skeleton && pad->start_time == -1
@@ -3725,15 +3769,6 @@ gst_ogg_demux_read_chain (GstOggDemux * ogg, GstOggChain ** res_chain)
     }
   }
   GST_LOG_OBJECT (ogg, "done reading chain");
-  /* now we can fill in the missing info using queries */
-  for (i = 0; i < chain->streams->len; i++) {
-    GstOggPad *pad = g_array_index (chain->streams, GstOggPad *, i);
-
-    if (pad->map.is_skeleton)
-      continue;
-
-    pad->mode = GST_OGG_PAD_MODE_STREAMING;
-  }
 
   if (res_chain)
     *res_chain = chain;
diff --git a/ext/ogg/gstoggdemux.h b/ext/ogg/gstoggdemux.h
index a8ac92b..8b9170a 100644
--- a/ext/ogg/gstoggdemux.h
+++ b/ext/ogg/gstoggdemux.h
@@ -74,20 +74,12 @@ struct _GstOggChain
                                    streams. */
 };
 
-/* different modes for the pad */
-typedef enum
-{
-  GST_OGG_PAD_MODE_INIT,        /* we are feeding our internal decoder to get info */
-  GST_OGG_PAD_MODE_STREAMING,   /* we are streaming buffers to the outside */
-} GstOggPadMode;
-
 /* all information needed for one ogg stream */
 struct _GstOggPad
 {
   GstPad pad;                   /* subclass GstPad */
 
   gboolean have_type;
-  GstOggPadMode mode;
 
   GstOggChain *chain;           /* the chain we are part of */
   GstOggDemux *ogg;             /* the ogg demuxer we are part of */
diff --git a/ext/ogg/gstoggmux.c b/ext/ogg/gstoggmux.c
index 7aeecc0..50b9458 100644
--- a/ext/ogg/gstoggmux.c
+++ b/ext/ogg/gstoggmux.c
@@ -520,9 +520,7 @@ wrong_template:
 static void
 gst_ogg_mux_release_pad (GstElement * element, GstPad * pad)
 {
-  GstOggMux *ogg_mux;
-
-  ogg_mux = GST_OGG_MUX (gst_pad_get_parent (pad));
+  GstOggMux *ogg_mux = GST_OGG_MUX (gst_pad_get_parent (pad));
 
   gst_collect_pads2_remove_pad (ogg_mux->collect, pad);
   gst_element_remove_pad (element, pad);
@@ -534,19 +532,31 @@ gst_ogg_mux_release_pad (GstElement * element, GstPad * pad)
 static gboolean
 gst_ogg_mux_handle_src_event (GstPad * pad, GstEvent * event)
 {
-  GstEventType type;
-
-  type = event ? GST_EVENT_TYPE (event) : GST_EVENT_UNKNOWN;
+  gboolean res = FALSE;
+  GstOggMux *ogg_mux = GST_OGG_MUX (gst_pad_get_parent (pad));
+  GstEventType type = event ? GST_EVENT_TYPE (event) : GST_EVENT_UNKNOWN;
 
   switch (type) {
-    case GST_EVENT_SEEK:
-      /* disable seeking for now */
-      return FALSE;
+    case GST_EVENT_SEEK:{
+      GstSeekFlags flags;
+
+      gst_event_parse_seek (event, NULL, NULL, &flags, NULL, NULL, NULL, NULL);
+      if (!ogg_mux->need_headers && (flags & GST_SEEK_FLAG_FLUSH) != 0) {
+        /* disable flushing seeks once we started */
+        gst_event_unref (event);
+        event = NULL;
+      }
+      break;
+    }
     default:
       break;
   }
 
-  return gst_pad_event_default (pad, event);
+  if (event != NULL)
+    res = gst_pad_event_default (pad, event);
+
+  gst_object_unref (ogg_mux);
+  return res;
 }
 
 static GstBuffer *
@@ -996,6 +1006,11 @@ gst_ogg_mux_queue_pads (GstOggMux * ogg_mux, gboolean * popped)
                 gst_collect_pads2_set_waiting (ogg_mux->collect,
                     (GstCollectData2 *) pad, FALSE);
               }
+
+              if (pad->map.is_video && ogg_mux->delta_pad == NULL) {
+                ogg_mux->delta_pad = pad;
+                GST_INFO_OBJECT (pad, "selected delta pad");
+              }
             }
           }
 
diff --git a/ext/ogg/gstoggstream.c b/ext/ogg/gstoggstream.c
index 3b267fa..777e1a5 100644
--- a/ext/ogg/gstoggstream.c
+++ b/ext/ogg/gstoggstream.c
@@ -1894,6 +1894,8 @@ setup_opus_mapper (GstOggStream * pad, ogg_packet * packet)
   pad->granulerate_d = 1;
   pad->granuleshift = 0;
   pad->n_header_packets = 2;
+  pad->first_granpos = -1;
+  pad->forbid_start_clamping = TRUE;
 
   /* pre-skip is in samples at 48000 Hz, which matches granule one for one */
   pad->granule_offset = -GST_READ_UINT16_LE (packet->packet + 10);
@@ -1912,6 +1914,29 @@ is_header_opus (GstOggStream * pad, ogg_packet * packet)
 }
 
 static gint64
+granulepos_to_granule_opus (GstOggStream * pad, gint64 granulepos)
+{
+  if (granulepos == -1)
+    return -1;
+
+  /* We must reject some particular cases for the first granpos */
+
+  if (pad->first_granpos < 0 || granulepos < pad->first_granpos)
+    pad->first_granpos = granulepos;
+
+  if (pad->first_granpos == granulepos) {
+    if (granulepos < -pad->granule_offset) {
+      GST_ERROR ("Invalid Opus stream: first granulepos (%" G_GINT64_FORMAT
+          ") less than preskip (%" G_GINT64_FORMAT ")", granulepos,
+          -pad->granule_offset);
+      return -1;
+    }
+  }
+
+  return granulepos;
+}
+
+static gint64
 packet_duration_opus (GstOggStream * pad, ogg_packet * packet)
 {
   static const guint64 durations[32] = {
@@ -2168,7 +2193,7 @@ const GstOggMap mappers[] = {
     "OpusHead", 8, 0,
     "audio/x-opus",
     setup_opus_mapper,
-    granulepos_to_granule_default,
+    granulepos_to_granule_opus,
     granule_to_granulepos_default,
     NULL,
     NULL,
diff --git a/ext/ogg/gstoggstream.h b/ext/ogg/gstoggstream.h
index c06bc51..b23dc58 100644
--- a/ext/ogg/gstoggstream.h
+++ b/ext/ogg/gstoggstream.h
@@ -70,6 +70,7 @@ struct _GstOggStream
   gint bitrate;
   guint64 total_time;
   gboolean is_sparse;
+  gboolean forbid_start_clamping;
 
   GstCaps *caps;
 
@@ -93,6 +94,8 @@ struct _GstOggStream
   gboolean theora_has_zero_keyoffset;
   /* VP8 stuff */
   gboolean is_vp8;
+  /* opus stuff */
+  gint64 first_granpos;
   /* OGM stuff */
   gboolean is_ogm;
   gboolean is_ogm_text;
diff --git a/ext/pango/Makefile.in b/ext/pango/Makefile.in
index f7ff7ae..3b948f1 100644
--- a/ext/pango/Makefile.in
+++ b/ext/pango/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/pango
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -123,10 +140,23 @@ libgstpango_la_OBJECTS = $(am_libgstpango_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstpango_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstpango_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstpango_la_CFLAGS) $(CFLAGS) \
 	$(libgstpango_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -139,22 +169,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstpango_la_SOURCES)
 DIST_SOURCES = $(libgstpango_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -447,7 +478,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -516,7 +551,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -524,6 +558,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -539,12 +575,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstpango.la: $(libgstpango_la_OBJECTS) $(libgstpango_la_DEPENDENCIES) $(EXTRA_libgstpango_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstpango_la_LINK) -rpath $(plugindir) $(libgstpango_la_OBJECTS) $(libgstpango_la_LIBADD) $(LIBS)
 
@@ -663,6 +701,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -807,18 +859,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/pango/gsttextoverlay.c b/ext/pango/gsttextoverlay.c
index a92659f..002468b 100644
--- a/ext/pango/gsttextoverlay.c
+++ b/ext/pango/gsttextoverlay.c
@@ -304,8 +304,11 @@ gst_text_overlay_line_align_get_type (void)
   return text_overlay_line_align_type;
 }
 
-#define GST_TEXT_OVERLAY_GET_COND(ov) (((GstTextOverlay *)ov)->cond)
-#define GST_TEXT_OVERLAY_WAIT(ov)     (g_cond_wait (GST_TEXT_OVERLAY_GET_COND (ov), GST_OBJECT_GET_LOCK (ov)))
+#define GST_TEXT_OVERLAY_GET_LOCK(ov) (GST_TEXT_OVERLAY (ov)->lock)
+#define GST_TEXT_OVERLAY_GET_COND(ov) (GST_TEXT_OVERLAY (ov)->cond)
+#define GST_TEXT_OVERLAY_LOCK(ov)     (g_mutex_lock (GST_TEXT_OVERLAY_GET_LOCK (ov)))
+#define GST_TEXT_OVERLAY_UNLOCK(ov)   (g_mutex_unlock (GST_TEXT_OVERLAY_GET_LOCK (ov)))
+#define GST_TEXT_OVERLAY_WAIT(ov)     (g_cond_wait (GST_TEXT_OVERLAY_GET_COND (ov), GST_TEXT_OVERLAY_GET_LOCK (ov)))
 #define GST_TEXT_OVERLAY_SIGNAL(ov)   (g_cond_signal (GST_TEXT_OVERLAY_GET_COND (ov)))
 #define GST_TEXT_OVERLAY_BROADCAST(ov)(g_cond_broadcast (GST_TEXT_OVERLAY_GET_COND (ov)))
 
@@ -375,7 +378,7 @@ gst_text_overlay_base_init (gpointer g_class)
     g_mutex_lock (klass->pango_lock);
   fontmap = pango_cairo_font_map_get_default ();
   klass->pango_context =
-      pango_cairo_font_map_create_context (PANGO_CAIRO_FONT_MAP (fontmap));
+      pango_font_map_create_context (PANGO_FONT_MAP (fontmap));
   if (klass->pango_lock)
     g_mutex_unlock (klass->pango_lock);
 }
@@ -597,6 +600,11 @@ gst_text_overlay_finalize (GObject * object)
     overlay->text_buffer = NULL;
   }
 
+  if (overlay->lock) {
+    g_mutex_free (overlay->lock);
+    overlay->lock = NULL;
+  }
+
   if (overlay->cond) {
     g_cond_free (overlay->cond);
     overlay->cond = NULL;
@@ -611,6 +619,9 @@ gst_text_overlay_init (GstTextOverlay * overlay, GstTextOverlayClass * klass)
   GstPadTemplate *template;
   PangoFontDescription *desc;
 
+  overlay->lock = g_mutex_new ();
+  overlay->cond = g_cond_new ();
+
   /* video sink */
   template = gst_static_pad_template_get (&video_sink_template_factory);
   overlay->video_sinkpad = gst_pad_new_from_template (template, "video_sink");
@@ -697,7 +708,6 @@ gst_text_overlay_init (GstTextOverlay * overlay, GstTextOverlayClass * klass)
 
   overlay->text_buffer = NULL;
   overlay->text_linked = FALSE;
-  overlay->cond = g_cond_new ();
   gst_segment_init (&overlay->segment, GST_FORMAT_TIME);
   g_mutex_unlock (GST_TEXT_OVERLAY_GET_CLASS (overlay)->pango_lock);
 }
@@ -743,7 +753,8 @@ gst_text_overlay_update_render_mode (GstTextOverlay * overlay)
   } else {
     pango_context_set_base_gravity (context, PANGO_GRAVITY_SOUTH);
     pango_context_set_matrix (context, &matrix);
-    pango_layout_set_alignment (overlay->layout, overlay->line_align);
+    pango_layout_set_alignment (overlay->layout,
+        (PangoAlignment) overlay->line_align);
   }
 }
 
@@ -802,7 +813,7 @@ gst_text_overlay_setcaps (GstPad * pad, GstCaps * caps)
   if (ret) {
     GstStructure *structure;
 
-    GST_OBJECT_LOCK (overlay);
+    GST_TEXT_OVERLAY_LOCK (overlay);
     g_mutex_lock (GST_TEXT_OVERLAY_GET_CLASS (overlay)->pango_lock);
 
     /* FIXME Use the query to the sink to do that when implemented */
@@ -816,7 +827,7 @@ gst_text_overlay_setcaps (GstPad * pad, GstCaps * caps)
 
     gst_text_overlay_update_wrap_mode (overlay);
     g_mutex_unlock (GST_TEXT_OVERLAY_GET_CLASS (overlay)->pango_lock);
-    GST_OBJECT_UNLOCK (overlay);
+    GST_TEXT_OVERLAY_UNLOCK (overlay);
   }
 
   gst_object_unref (overlay);
@@ -830,7 +841,7 @@ gst_text_overlay_set_property (GObject * object, guint prop_id,
 {
   GstTextOverlay *overlay = GST_TEXT_OVERLAY (object);
 
-  GST_OBJECT_LOCK (overlay);
+  GST_TEXT_OVERLAY_LOCK (overlay);
   switch (prop_id) {
     case PROP_TEXT:
       g_free (overlay->default_text);
@@ -957,7 +968,7 @@ gst_text_overlay_set_property (GObject * object, guint prop_id,
   }
 
   overlay->need_render = TRUE;
-  GST_OBJECT_UNLOCK (overlay);
+  GST_TEXT_OVERLAY_UNLOCK (overlay);
 }
 
 static void
@@ -966,7 +977,7 @@ gst_text_overlay_get_property (GObject * object, guint prop_id,
 {
   GstTextOverlay *overlay = GST_TEXT_OVERLAY (object);
 
-  GST_OBJECT_LOCK (overlay);
+  GST_TEXT_OVERLAY_LOCK (overlay);
   switch (prop_id) {
     case PROP_TEXT:
       g_value_set_string (value, overlay->default_text);
@@ -1031,7 +1042,7 @@ gst_text_overlay_get_property (GObject * object, guint prop_id,
   }
 
   overlay->need_render = TRUE;
-  GST_OBJECT_UNLOCK (overlay);
+  GST_TEXT_OVERLAY_UNLOCK (overlay);
 }
 
 static gboolean
@@ -1083,11 +1094,11 @@ gst_text_overlay_src_event (GstPad * pad, GstEvent * event)
         gst_pad_push_event (overlay->srcpad, gst_event_new_flush_start ());
 
       /* Mark ourself as flushing, unblock chains */
-      GST_OBJECT_LOCK (overlay);
+      GST_TEXT_OVERLAY_LOCK (overlay);
       overlay->video_flushing = TRUE;
       overlay->text_flushing = TRUE;
       gst_text_overlay_pop_text (overlay);
-      GST_OBJECT_UNLOCK (overlay);
+      GST_TEXT_OVERLAY_UNLOCK (overlay);
 
       /* Seek on each sink pad */
       gst_event_ref (event);
@@ -1626,6 +1637,7 @@ gst_text_overlay_push_frame (GstTextOverlay * overlay, GstBuffer * video_frame)
         break;
       case GST_VIDEO_FORMAT_AYUV:
       case GST_VIDEO_FORMAT_UYVY:
+      case GST_VIDEO_FORMAT_YUY2:
         gst_text_overlay_shade_packed_Y (overlay,
             GST_BUFFER_DATA (video_frame), xpos, xpos + overlay->image_width,
             ypos, ypos + overlay->image_height);
@@ -1748,12 +1760,12 @@ gst_text_overlay_text_event (GstPad * pad, GstEvent * event)
           &fmt, &cur, &stop, &time);
 
       if (fmt == GST_FORMAT_TIME) {
-        GST_OBJECT_LOCK (overlay);
+        GST_TEXT_OVERLAY_LOCK (overlay);
         gst_segment_set_newsegment_full (&overlay->text_segment, update, rate,
             applied_rate, GST_FORMAT_TIME, cur, stop, time);
         GST_DEBUG_OBJECT (overlay, "TEXT SEGMENT now: %" GST_SEGMENT_FORMAT,
             &overlay->text_segment);
-        GST_OBJECT_UNLOCK (overlay);
+        GST_TEXT_OVERLAY_UNLOCK (overlay);
       } else {
         GST_ELEMENT_WARNING (overlay, STREAM, MUX, (NULL),
             ("received non-TIME newsegment event on text input"));
@@ -1764,39 +1776,39 @@ gst_text_overlay_text_event (GstPad * pad, GstEvent * event)
 
       /* wake up the video chain, it might be waiting for a text buffer or
        * a text segment update */
-      GST_OBJECT_LOCK (overlay);
+      GST_TEXT_OVERLAY_LOCK (overlay);
       GST_TEXT_OVERLAY_BROADCAST (overlay);
-      GST_OBJECT_UNLOCK (overlay);
+      GST_TEXT_OVERLAY_UNLOCK (overlay);
       break;
     }
     case GST_EVENT_FLUSH_STOP:
-      GST_OBJECT_LOCK (overlay);
+      GST_TEXT_OVERLAY_LOCK (overlay);
       GST_INFO_OBJECT (overlay, "text flush stop");
       overlay->text_flushing = FALSE;
       overlay->text_eos = FALSE;
       gst_text_overlay_pop_text (overlay);
       gst_segment_init (&overlay->text_segment, GST_FORMAT_TIME);
-      GST_OBJECT_UNLOCK (overlay);
+      GST_TEXT_OVERLAY_UNLOCK (overlay);
       gst_event_unref (event);
       ret = TRUE;
       break;
     case GST_EVENT_FLUSH_START:
-      GST_OBJECT_LOCK (overlay);
+      GST_TEXT_OVERLAY_LOCK (overlay);
       GST_INFO_OBJECT (overlay, "text flush start");
       overlay->text_flushing = TRUE;
       GST_TEXT_OVERLAY_BROADCAST (overlay);
-      GST_OBJECT_UNLOCK (overlay);
+      GST_TEXT_OVERLAY_UNLOCK (overlay);
       gst_event_unref (event);
       ret = TRUE;
       break;
     case GST_EVENT_EOS:
-      GST_OBJECT_LOCK (overlay);
+      GST_TEXT_OVERLAY_LOCK (overlay);
       overlay->text_eos = TRUE;
       GST_INFO_OBJECT (overlay, "text EOS");
       /* wake up the video chain, it might be waiting for a text buffer or
        * a text segment update */
       GST_TEXT_OVERLAY_BROADCAST (overlay);
-      GST_OBJECT_UNLOCK (overlay);
+      GST_TEXT_OVERLAY_UNLOCK (overlay);
       gst_event_unref (event);
       ret = TRUE;
       break;
@@ -1852,27 +1864,27 @@ gst_text_overlay_video_event (GstPad * pad, GstEvent * event)
       break;
     }
     case GST_EVENT_EOS:
-      GST_OBJECT_LOCK (overlay);
+      GST_TEXT_OVERLAY_LOCK (overlay);
       GST_INFO_OBJECT (overlay, "video EOS");
       overlay->video_eos = TRUE;
-      GST_OBJECT_UNLOCK (overlay);
+      GST_TEXT_OVERLAY_UNLOCK (overlay);
       ret = gst_pad_event_default (pad, event);
       break;
     case GST_EVENT_FLUSH_START:
-      GST_OBJECT_LOCK (overlay);
+      GST_TEXT_OVERLAY_LOCK (overlay);
       GST_INFO_OBJECT (overlay, "video flush start");
       overlay->video_flushing = TRUE;
       GST_TEXT_OVERLAY_BROADCAST (overlay);
-      GST_OBJECT_UNLOCK (overlay);
+      GST_TEXT_OVERLAY_UNLOCK (overlay);
       ret = gst_pad_event_default (pad, event);
       break;
     case GST_EVENT_FLUSH_STOP:
-      GST_OBJECT_LOCK (overlay);
+      GST_TEXT_OVERLAY_LOCK (overlay);
       GST_INFO_OBJECT (overlay, "video flush stop");
       overlay->video_flushing = FALSE;
       overlay->video_eos = FALSE;
       gst_segment_init (&overlay->segment, GST_FORMAT_TIME);
-      GST_OBJECT_UNLOCK (overlay);
+      GST_TEXT_OVERLAY_UNLOCK (overlay);
       ret = gst_pad_event_default (pad, event);
       break;
     default:
@@ -1896,9 +1908,9 @@ gst_text_overlay_video_bufferalloc (GstPad * pad, guint64 offset, guint size,
   if (G_UNLIKELY (!overlay))
     return GST_FLOW_WRONG_STATE;
 
-  GST_OBJECT_LOCK (overlay);
+  GST_TEXT_OVERLAY_LOCK (overlay);
   allocpad = overlay->srcpad ? gst_object_ref (overlay->srcpad) : NULL;
-  GST_OBJECT_UNLOCK (overlay);
+  GST_TEXT_OVERLAY_UNLOCK (overlay);
 
   if (allocpad) {
     ret = gst_pad_alloc_buffer (allocpad, offset, size, caps, buffer);
@@ -1939,17 +1951,17 @@ gst_text_overlay_text_chain (GstPad * pad, GstBuffer * buffer)
 
   overlay = GST_TEXT_OVERLAY (GST_PAD_PARENT (pad));
 
-  GST_OBJECT_LOCK (overlay);
+  GST_TEXT_OVERLAY_LOCK (overlay);
 
   if (overlay->text_flushing) {
-    GST_OBJECT_UNLOCK (overlay);
+    GST_TEXT_OVERLAY_UNLOCK (overlay);
     ret = GST_FLOW_WRONG_STATE;
     GST_LOG_OBJECT (overlay, "text flushing");
     goto beach;
   }
 
   if (overlay->text_eos) {
-    GST_OBJECT_UNLOCK (overlay);
+    GST_TEXT_OVERLAY_UNLOCK (overlay);
     ret = GST_FLOW_UNEXPECTED;
     GST_LOG_OBJECT (overlay, "text EOS");
     goto beach;
@@ -1993,7 +2005,7 @@ gst_text_overlay_text_chain (GstPad * pad, GstBuffer * buffer)
         GST_TEXT_OVERLAY_WAIT (overlay);
         GST_DEBUG ("Pad %s:%s resuming", GST_DEBUG_PAD_NAME (pad));
         if (overlay->text_flushing) {
-          GST_OBJECT_UNLOCK (overlay);
+          GST_TEXT_OVERLAY_UNLOCK (overlay);
           ret = GST_FLOW_WRONG_STATE;
           goto beach;
         }
@@ -2012,7 +2024,7 @@ gst_text_overlay_text_chain (GstPad * pad, GstBuffer * buffer)
     GST_TEXT_OVERLAY_BROADCAST (overlay);
   }
 
-  GST_OBJECT_UNLOCK (overlay);
+  GST_TEXT_OVERLAY_UNLOCK (overlay);
 
 beach:
 
@@ -2091,7 +2103,7 @@ gst_text_overlay_video_chain (GstPad * pad, GstBuffer * buffer)
 
 wait_for_text_buf:
 
-  GST_OBJECT_LOCK (overlay);
+  GST_TEXT_OVERLAY_LOCK (overlay);
 
   if (overlay->video_flushing)
     goto flushing;
@@ -2100,7 +2112,7 @@ wait_for_text_buf:
     goto have_eos;
 
   if (overlay->silent && !overlay->text_linked) {
-    GST_OBJECT_UNLOCK (overlay);
+    GST_TEXT_OVERLAY_UNLOCK (overlay);
     ret = gst_pad_push (overlay->srcpad, buffer);
 
     /* Update last_stop */
@@ -2120,7 +2132,7 @@ wait_for_text_buf:
     GST_LOG_OBJECT (overlay, "Text pad not linked, rendering default "
         "text: '%s'", GST_STR_NULL (text));
 
-    GST_OBJECT_UNLOCK (overlay);
+    GST_TEXT_OVERLAY_UNLOCK (overlay);
 
     if (text != NULL && *text != '\0') {
       /* Render and push */
@@ -2182,16 +2194,16 @@ wait_for_text_buf:
         GST_LOG_OBJECT (overlay, "text buffer too old, popping");
         pop_text = FALSE;
         gst_text_overlay_pop_text (overlay);
-        GST_OBJECT_UNLOCK (overlay);
+        GST_TEXT_OVERLAY_UNLOCK (overlay);
         goto wait_for_text_buf;
       } else if (valid_text_time && vid_running_time_end <= text_running_time) {
         GST_LOG_OBJECT (overlay, "text in future, pushing video buf");
-        GST_OBJECT_UNLOCK (overlay);
+        GST_TEXT_OVERLAY_UNLOCK (overlay);
         /* Push the video frame */
         ret = gst_pad_push (overlay->srcpad, buffer);
       } else if (overlay->silent) {
         GST_LOG_OBJECT (overlay, "silent enabled, pushing video buf");
-        GST_OBJECT_UNLOCK (overlay);
+        GST_TEXT_OVERLAY_UNLOCK (overlay);
         /* Push the video frame */
         ret = gst_pad_push (overlay->srcpad, buffer);
       } else {
@@ -2237,7 +2249,7 @@ wait_for_text_buf:
         if (in_text != (gchar *) GST_BUFFER_DATA (overlay->text_buffer))
           g_free (in_text);
 
-        GST_OBJECT_UNLOCK (overlay);
+        GST_TEXT_OVERLAY_UNLOCK (overlay);
         ret = gst_text_overlay_push_frame (overlay, buffer);
 
         if (valid_text_time && text_running_time_end <= vid_running_time_end) {
@@ -2246,9 +2258,9 @@ wait_for_text_buf:
         }
       }
       if (pop_text) {
-        GST_OBJECT_LOCK (overlay);
+        GST_TEXT_OVERLAY_LOCK (overlay);
         gst_text_overlay_pop_text (overlay);
-        GST_OBJECT_UNLOCK (overlay);
+        GST_TEXT_OVERLAY_UNLOCK (overlay);
       }
     } else {
       gboolean wait_for_text_buf = TRUE;
@@ -2286,10 +2298,10 @@ wait_for_text_buf:
         GST_DEBUG_OBJECT (overlay, "no text buffer, need to wait for one");
         GST_TEXT_OVERLAY_WAIT (overlay);
         GST_DEBUG_OBJECT (overlay, "resuming");
-        GST_OBJECT_UNLOCK (overlay);
+        GST_TEXT_OVERLAY_UNLOCK (overlay);
         goto wait_for_text_buf;
       } else {
-        GST_OBJECT_UNLOCK (overlay);
+        GST_TEXT_OVERLAY_UNLOCK (overlay);
         GST_LOG_OBJECT (overlay, "no need to wait for a text buffer");
         ret = gst_pad_push (overlay->srcpad, buffer);
       }
@@ -2312,14 +2324,14 @@ missing_timestamp:
 
 flushing:
   {
-    GST_OBJECT_UNLOCK (overlay);
+    GST_TEXT_OVERLAY_UNLOCK (overlay);
     GST_DEBUG_OBJECT (overlay, "flushing, discarding buffer");
     gst_buffer_unref (buffer);
     return GST_FLOW_WRONG_STATE;
   }
 have_eos:
   {
-    GST_OBJECT_UNLOCK (overlay);
+    GST_TEXT_OVERLAY_UNLOCK (overlay);
     GST_DEBUG_OBJECT (overlay, "eos, discarding buffer");
     gst_buffer_unref (buffer);
     return GST_FLOW_UNEXPECTED;
@@ -2340,13 +2352,13 @@ gst_text_overlay_change_state (GstElement * element, GstStateChange transition)
 
   switch (transition) {
     case GST_STATE_CHANGE_PAUSED_TO_READY:
-      GST_OBJECT_LOCK (overlay);
+      GST_TEXT_OVERLAY_LOCK (overlay);
       overlay->text_flushing = TRUE;
       overlay->video_flushing = TRUE;
       /* pop_text will broadcast on the GCond and thus also make the video
        * chain exit if it's waiting for a text buffer */
       gst_text_overlay_pop_text (overlay);
-      GST_OBJECT_UNLOCK (overlay);
+      GST_TEXT_OVERLAY_UNLOCK (overlay);
       break;
     default:
       break;
@@ -2358,14 +2370,14 @@ gst_text_overlay_change_state (GstElement * element, GstStateChange transition)
 
   switch (transition) {
     case GST_STATE_CHANGE_READY_TO_PAUSED:
-      GST_OBJECT_LOCK (overlay);
+      GST_TEXT_OVERLAY_LOCK (overlay);
       overlay->text_flushing = FALSE;
       overlay->video_flushing = FALSE;
       overlay->video_eos = FALSE;
       overlay->text_eos = FALSE;
       gst_segment_init (&overlay->segment, GST_FORMAT_TIME);
       gst_segment_init (&overlay->text_segment, GST_FORMAT_TIME);
-      GST_OBJECT_UNLOCK (overlay);
+      GST_TEXT_OVERLAY_UNLOCK (overlay);
       break;
     default:
       break;
diff --git a/ext/pango/gsttextoverlay.h b/ext/pango/gsttextoverlay.h
index d36e476..f53e7ed 100644
--- a/ext/pango/gsttextoverlay.h
+++ b/ext/pango/gsttextoverlay.h
@@ -111,6 +111,7 @@ struct _GstTextOverlay {
     gboolean                    text_flushing;
     gboolean                    text_eos;
 
+    GMutex                     *lock;
     GCond                      *cond;  /* to signal removal of a queued text
                                      * buffer, arrival of a text buffer,
                                      * a text segment update, or a change
diff --git a/ext/pango/gsttextrender.c b/ext/pango/gsttextrender.c
index 38ea44a..6a9a29b 100644
--- a/ext/pango/gsttextrender.c
+++ b/ext/pango/gsttextrender.c
@@ -203,7 +203,7 @@ gst_text_render_class_init (GstTextRenderClass * klass)
 
   fontmap = pango_cairo_font_map_get_default ();
   klass->pango_context =
-      pango_cairo_font_map_create_context (PANGO_CAIRO_FONT_MAP (fontmap));
+      pango_font_map_create_context (PANGO_FONT_MAP (fontmap));
   g_object_class_install_property (G_OBJECT_CLASS (klass), PROP_FONT_DESC,
       g_param_spec_string ("font-desc", "font description",
           "Pango font description of font "
diff --git a/ext/theora/Makefile.in b/ext/theora/Makefile.in
index 223ac23..b20c4fd 100644
--- a/ext/theora/Makefile.in
+++ b/ext/theora/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = ext/theora
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -124,10 +141,23 @@ libgsttheora_la_OBJECTS = $(am_libgsttheora_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgsttheora_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgsttheora_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgsttheora_la_CFLAGS) $(CFLAGS) \
 	$(libgsttheora_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -140,22 +170,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgsttheora_la_SOURCES)
 DIST_SOURCES = $(libgsttheora_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -448,7 +479,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -508,7 +543,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -516,6 +550,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -531,12 +567,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgsttheora.la: $(libgsttheora_la_OBJECTS) $(libgsttheora_la_DEPENDENCIES) $(EXTRA_libgsttheora_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgsttheora_la_LINK) -rpath $(plugindir) $(libgsttheora_la_OBJECTS) $(libgsttheora_la_LIBADD) $(LIBS)
 
@@ -655,6 +693,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -799,18 +851,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/ext/theora/gsttheoradec.c b/ext/theora/gsttheoradec.c
index 5271109..ee4334e 100644
--- a/ext/theora/gsttheoradec.c
+++ b/ext/theora/gsttheoradec.c
@@ -1,5 +1,8 @@
 /* GStreamer
  * Copyright (C) 2004 Benjamin Otte <in7y118@public.uni-hamburg.de>
+ * Copyright (c) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
+ *      Author : Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
  *
  * This library is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Library General Public
@@ -81,31 +84,26 @@ GST_STATIC_PAD_TEMPLATE ("sink",
     GST_STATIC_CAPS ("video/x-theora")
     );
 
-GST_BOILERPLATE (GstTheoraDec, gst_theora_dec, GstElement, GST_TYPE_ELEMENT);
+GST_BOILERPLATE (GstTheoraDec, gst_theora_dec, GstVideoDecoder,
+    GST_TYPE_VIDEO_DECODER);
 
 static void theora_dec_get_property (GObject * object, guint prop_id,
     GValue * value, GParamSpec * pspec);
 static void theora_dec_set_property (GObject * object, guint prop_id,
     const GValue * value, GParamSpec * pspec);
 
-static gboolean theora_dec_sink_event (GstPad * pad, GstEvent * event);
-static gboolean theora_dec_setcaps (GstPad * pad, GstCaps * caps);
-static GstFlowReturn theora_dec_chain (GstPad * pad, GstBuffer * buffer);
-static GstStateChangeReturn theora_dec_change_state (GstElement * element,
-    GstStateChange transition);
-static gboolean theora_dec_src_event (GstPad * pad, GstEvent * event);
-static gboolean theora_dec_src_query (GstPad * pad, GstQuery * query);
-static gboolean theora_dec_src_convert (GstPad * pad,
-    GstFormat src_format, gint64 src_value,
-    GstFormat * dest_format, gint64 * dest_value);
-
-#if 0
-static const GstFormat *theora_get_formats (GstPad * pad);
-#endif
-#if 0
-static const GstEventMask *theora_get_event_masks (GstPad * pad);
-#endif
-static const GstQueryType *theora_get_query_types (GstPad * pad);
+static gboolean theora_dec_start (GstVideoDecoder * decoder);
+static gboolean theora_dec_stop (GstVideoDecoder * decoder);
+static gboolean theora_dec_set_format (GstVideoDecoder * decoder,
+    GstVideoCodecState * state);
+static gboolean theora_dec_reset (GstVideoDecoder * decoder, gboolean hard);
+static GstFlowReturn theora_dec_parse (GstVideoDecoder * decoder,
+    GstVideoCodecFrame * frame, GstAdapter * adapter, gboolean at_eos);
+static GstFlowReturn theora_dec_handle_frame (GstVideoDecoder * decoder,
+    GstVideoCodecFrame * frame);
+
+static GstFlowReturn theora_dec_decode_buffer (GstTheoraDec * dec,
+    GstBuffer * buf, GstVideoCodecFrame * frame);
 
 
 static void
@@ -113,10 +111,10 @@ gst_theora_dec_base_init (gpointer g_class)
 {
   GstElementClass *element_class = GST_ELEMENT_CLASS (g_class);
 
-  gst_element_class_add_static_pad_template (element_class,
-      &theora_dec_src_factory);
-  gst_element_class_add_static_pad_template (element_class,
-      &theora_dec_sink_factory);
+  gst_element_class_add_pad_template (element_class,
+      gst_static_pad_template_get (&theora_dec_src_factory));
+  gst_element_class_add_pad_template (element_class,
+      gst_static_pad_template_get (&theora_dec_sink_factory));
   gst_element_class_set_details_simple (element_class,
       "Theora video decoder", "Codec/Decoder/Video",
       "decode raw theora streams to raw YUV video",
@@ -134,7 +132,7 @@ static void
 gst_theora_dec_class_init (GstTheoraDecClass * klass)
 {
   GObjectClass *gobject_class = G_OBJECT_CLASS (klass);
-  GstElementClass *gstelement_class = GST_ELEMENT_CLASS (klass);
+  GstVideoDecoderClass *video_decoder_class = GST_VIDEO_DECODER_CLASS (klass);
 
   gobject_class->set_property = theora_dec_set_property;
   gobject_class->get_property = theora_dec_get_property;
@@ -188,7 +186,13 @@ gst_theora_dec_class_init (GstTheoraDecClass * klass)
             G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
   }
 
-  gstelement_class->change_state = theora_dec_change_state;
+  video_decoder_class->start = GST_DEBUG_FUNCPTR (theora_dec_start);
+  video_decoder_class->stop = GST_DEBUG_FUNCPTR (theora_dec_stop);
+  video_decoder_class->reset = GST_DEBUG_FUNCPTR (theora_dec_reset);
+  video_decoder_class->set_format = GST_DEBUG_FUNCPTR (theora_dec_set_format);
+  video_decoder_class->parse = GST_DEBUG_FUNCPTR (theora_dec_parse);
+  video_decoder_class->handle_frame =
+      GST_DEBUG_FUNCPTR (theora_dec_handle_frame);
 
   GST_DEBUG_CATEGORY_INIT (theoradec_debug, "theoradec", 0, "Theora decoder");
 }
@@ -196,567 +200,153 @@ gst_theora_dec_class_init (GstTheoraDecClass * klass)
 static void
 gst_theora_dec_init (GstTheoraDec * dec, GstTheoraDecClass * g_class)
 {
-  dec->sinkpad =
-      gst_pad_new_from_static_template (&theora_dec_sink_factory, "sink");
-  gst_pad_set_event_function (dec->sinkpad, theora_dec_sink_event);
-  gst_pad_set_setcaps_function (dec->sinkpad, theora_dec_setcaps);
-  gst_pad_set_chain_function (dec->sinkpad, theora_dec_chain);
-  gst_element_add_pad (GST_ELEMENT (dec), dec->sinkpad);
-
-  dec->srcpad =
-      gst_pad_new_from_static_template (&theora_dec_src_factory, "src");
-  gst_pad_set_event_function (dec->srcpad, theora_dec_src_event);
-  gst_pad_set_query_type_function (dec->srcpad, theora_get_query_types);
-  gst_pad_set_query_function (dec->srcpad, theora_dec_src_query);
-  gst_pad_use_fixed_caps (dec->srcpad);
-
-  gst_element_add_pad (GST_ELEMENT (dec), dec->srcpad);
-
   dec->crop = THEORA_DEF_CROP;
   dec->telemetry_mv = THEORA_DEF_TELEMETRY_MV;
   dec->telemetry_mbmode = THEORA_DEF_TELEMETRY_MBMODE;
   dec->telemetry_qi = THEORA_DEF_TELEMETRY_QI;
   dec->telemetry_bits = THEORA_DEF_TELEMETRY_BITS;
-  dec->gather = NULL;
-  dec->decode = NULL;
-  dec->queued = NULL;
-  dec->pendingevents = NULL;
+
+  /* input is packetized,
+   * but is not marked that way so data gets parsed and keyframes marked */
+  gst_video_decoder_set_packetized (GST_VIDEO_DECODER (dec), FALSE);
 }
 
 static void
 gst_theora_dec_reset (GstTheoraDec * dec)
 {
   dec->need_keyframe = TRUE;
-  dec->last_timestamp = -1;
-  dec->discont = TRUE;
-  dec->frame_nr = -1;
-  dec->seqnum = gst_util_seqnum_next ();
-  dec->dropped = 0;
-  dec->processed = 0;
-  gst_segment_init (&dec->segment, GST_FORMAT_TIME);
-
-  GST_OBJECT_LOCK (dec);
-  dec->proportion = 1.0;
-  dec->earliest_time = -1;
-  GST_OBJECT_UNLOCK (dec);
-
-  g_list_foreach (dec->queued, (GFunc) gst_mini_object_unref, NULL);
-  g_list_free (dec->queued);
-  dec->queued = NULL;
-  g_list_foreach (dec->gather, (GFunc) gst_mini_object_unref, NULL);
-  g_list_free (dec->gather);
-  dec->gather = NULL;
-  g_list_foreach (dec->decode, (GFunc) gst_mini_object_unref, NULL);
-  g_list_free (dec->decode);
-  dec->decode = NULL;
-  g_list_foreach (dec->pendingevents, (GFunc) gst_mini_object_unref, NULL);
-  g_list_free (dec->pendingevents);
-  dec->pendingevents = NULL;
-
-  if (dec->tags) {
-    gst_tag_list_free (dec->tags);
-    dec->tags = NULL;
-  }
 }
 
-#if 0
-static const GstFormat *
-theora_get_formats (GstPad * pad)
-{
-  static GstFormat src_formats[] = {
-    GST_FORMAT_DEFAULT,         /* frames in this case */
-    GST_FORMAT_TIME,
-    GST_FORMAT_BYTES,
-    0
-  };
-  static GstFormat sink_formats[] = {
-    GST_FORMAT_DEFAULT,
-    GST_FORMAT_TIME,
-    0
-  };
-
-  return (GST_PAD_IS_SRC (pad) ? src_formats : sink_formats);
-}
-#endif
-
-#if 0
-static const GstEventMask *
-theora_get_event_masks (GstPad * pad)
-{
-  static const GstEventMask theora_src_event_masks[] = {
-    {GST_EVENT_SEEK, GST_SEEK_METHOD_SET | GST_SEEK_FLAG_FLUSH},
-    {0,}
-  };
-
-  return theora_src_event_masks;
-}
-#endif
-
-static const GstQueryType *
-theora_get_query_types (GstPad * pad)
-{
-  static const GstQueryType theora_src_query_types[] = {
-    GST_QUERY_POSITION,
-    GST_QUERY_DURATION,
-    GST_QUERY_CONVERT,
-    0
-  };
-
-  return theora_src_query_types;
-}
-
-
 static gboolean
-theora_dec_src_convert (GstPad * pad,
-    GstFormat src_format, gint64 src_value,
-    GstFormat * dest_format, gint64 * dest_value)
+theora_dec_start (GstVideoDecoder * decoder)
 {
-  gboolean res = TRUE;
-  GstTheoraDec *dec;
-  guint64 scale = 1;
+  GstTheoraDec *dec = GST_THEORA_DEC (decoder);
 
-  if (src_format == *dest_format) {
-    *dest_value = src_value;
-    return TRUE;
-  }
+  GST_DEBUG_OBJECT (dec, "start");
+  th_info_clear (&dec->info);
+  th_comment_clear (&dec->comment);
+  GST_DEBUG_OBJECT (dec, "Setting have_header to FALSE");
+  dec->have_header = FALSE;
+  gst_theora_dec_reset (dec);
 
-  dec = GST_THEORA_DEC (gst_pad_get_parent (pad));
-
-  /* we need the info part before we can done something */
-  if (!dec->have_header)
-    goto no_header;
-
-  switch (src_format) {
-    case GST_FORMAT_BYTES:
-      switch (*dest_format) {
-        case GST_FORMAT_DEFAULT:
-          *dest_value = gst_util_uint64_scale_int (src_value, 8,
-              dec->info.pic_height * dec->info.pic_width * dec->output_bpp);
-          break;
-        case GST_FORMAT_TIME:
-          /* seems like a rather silly conversion, implement me if you like */
-        default:
-          res = FALSE;
-      }
-      break;
-    case GST_FORMAT_TIME:
-      switch (*dest_format) {
-        case GST_FORMAT_BYTES:
-          scale =
-              dec->output_bpp * (dec->info.pic_width * dec->info.pic_height) /
-              8;
-        case GST_FORMAT_DEFAULT:
-          *dest_value = scale * gst_util_uint64_scale (src_value,
-              dec->info.fps_numerator, dec->info.fps_denominator * GST_SECOND);
-          break;
-        default:
-          res = FALSE;
-      }
-      break;
-    case GST_FORMAT_DEFAULT:
-      switch (*dest_format) {
-        case GST_FORMAT_TIME:
-          *dest_value = gst_util_uint64_scale (src_value,
-              GST_SECOND * dec->info.fps_denominator, dec->info.fps_numerator);
-          break;
-        case GST_FORMAT_BYTES:
-          *dest_value = gst_util_uint64_scale_int (src_value,
-              dec->output_bpp * dec->info.pic_width * dec->info.pic_height, 8);
-          break;
-        default:
-          res = FALSE;
-      }
-      break;
-    default:
-      res = FALSE;
-  }
-done:
-  gst_object_unref (dec);
-  return res;
-
-  /* ERRORS */
-no_header:
-  {
-    GST_DEBUG_OBJECT (dec, "no header yet, cannot convert");
-    res = FALSE;
-    goto done;
-  }
+  return TRUE;
 }
 
-#if 0
 static gboolean
-theora_dec_sink_convert (GstPad * pad,
-    GstFormat src_format, gint64 src_value,
-    GstFormat * dest_format, gint64 * dest_value)
+theora_dec_stop (GstVideoDecoder * decoder)
 {
-  gboolean res = TRUE;
-  GstTheoraDec *dec;
-
-  if (src_format == *dest_format) {
-    *dest_value = src_value;
-    return TRUE;
+  GstTheoraDec *dec = GST_THEORA_DEC (decoder);
+
+  GST_DEBUG_OBJECT (dec, "stop");
+  th_info_clear (&dec->info);
+  th_comment_clear (&dec->comment);
+  th_setup_free (dec->setup);
+  dec->setup = NULL;
+  th_decode_free (dec->decoder);
+  dec->decoder = NULL;
+  gst_theora_dec_reset (dec);
+  if (dec->tags) {
+    gst_tag_list_free (dec->tags);
+    dec->tags = NULL;
   }
-
-  dec = GST_THEORA_DEC (gst_pad_get_parent (pad));
-
-  /* we need the info part before we can done something */
-  if (!dec->have_header)
-    goto no_header;
-
-  switch (src_format) {
-    case GST_FORMAT_DEFAULT:
-      switch (*dest_format) {
-        case GST_FORMAT_TIME:
-          *dest_value = _theora_granule_start_time (dec, src_value);
-          break;
-        default:
-          res = FALSE;
-      }
-      break;
-    case GST_FORMAT_TIME:
-      switch (*dest_format) {
-        case GST_FORMAT_DEFAULT:
-        {
-          guint rest;
-
-          /* framecount */
-          *dest_value = gst_util_uint64_scale (src_value,
-              dec->info.fps_numerator, GST_SECOND * dec->info.fps_denominator);
-
-          /* funny way of calculating granulepos in theora */
-          rest = *dest_value / dec->info.keyframe_granule_shift;
-          *dest_value -= rest;
-          *dest_value <<= dec->granule_shift;
-          *dest_value += rest;
-          break;
-        }
-        default:
-          res = FALSE;
-          break;
-      }
-      break;
-    default:
-      res = FALSE;
+  if (dec->input_state) {
+    gst_video_codec_state_unref (dec->input_state);
+    dec->input_state = NULL;
   }
-done:
-  gst_object_unref (dec);
-  return res;
-
-  /* ERRORS */
-no_header:
-  {
-    GST_DEBUG_OBJECT (dec, "no header yet, cannot convert");
-    res = FALSE;
-    goto done;
+  if (dec->output_state) {
+    gst_video_codec_state_unref (dec->output_state);
+    dec->output_state = NULL;
   }
-}
-#endif
 
-static gboolean
-theora_dec_src_query (GstPad * pad, GstQuery * query)
-{
-  GstTheoraDec *dec;
-
-  gboolean res = FALSE;
-
-  dec = GST_THEORA_DEC (gst_pad_get_parent (pad));
-
-  switch (GST_QUERY_TYPE (query)) {
-    case GST_QUERY_POSITION:
-    {
-      gint64 value;
-      GstFormat format;
-      gint64 time;
-
-      /* parse format */
-      gst_query_parse_position (query, &format, NULL);
-
-      time = dec->last_timestamp;
-      time = gst_segment_to_stream_time (&dec->segment, GST_FORMAT_TIME, time);
-
-      GST_LOG_OBJECT (dec,
-          "query %p: our time: %" GST_TIME_FORMAT, query, GST_TIME_ARGS (time));
-
-      if (!(res =
-              theora_dec_src_convert (pad, GST_FORMAT_TIME, time, &format,
-                  &value)))
-        goto error;
-
-      gst_query_set_position (query, format, value);
-
-      GST_LOG_OBJECT (dec,
-          "query %p: we return %" G_GINT64_FORMAT " (format %u)", query, value,
-          format);
-      break;
-    }
-    case GST_QUERY_DURATION:
-    {
-      /* forward to peer for total */
-      res = gst_pad_peer_query (dec->sinkpad, query);
-      if (!res)
-        goto error;
-
-      break;
-    }
-    case GST_QUERY_CONVERT:
-    {
-      GstFormat src_fmt, dest_fmt;
-      gint64 src_val, dest_val;
-
-      gst_query_parse_convert (query, &src_fmt, &src_val, &dest_fmt, &dest_val);
-      if (!(res =
-              theora_dec_src_convert (pad, src_fmt, src_val, &dest_fmt,
-                  &dest_val)))
-        goto error;
-
-      gst_query_set_convert (query, src_fmt, src_val, dest_fmt, dest_val);
-      break;
-    }
-    default:
-      res = gst_pad_query_default (pad, query);
-      break;
-  }
-done:
-  gst_object_unref (dec);
-
-  return res;
-
-  /* ERRORS */
-error:
-  {
-    GST_DEBUG_OBJECT (dec, "query failed");
-    goto done;
-  }
+  return TRUE;
 }
 
+/* FIXME : Do we want to handle hard resets differently ? */
 static gboolean
-theora_dec_src_event (GstPad * pad, GstEvent * event)
+theora_dec_reset (GstVideoDecoder * bdec, gboolean hard)
 {
-  gboolean res = TRUE;
-  GstTheoraDec *dec;
-
-  dec = GST_THEORA_DEC (gst_pad_get_parent (pad));
-
-  switch (GST_EVENT_TYPE (event)) {
-    case GST_EVENT_SEEK:
-    {
-      GstFormat format, tformat;
-      gdouble rate;
-      GstEvent *real_seek;
-      GstSeekFlags flags;
-      GstSeekType cur_type, stop_type;
-      gint64 cur, stop;
-      gint64 tcur, tstop;
-      guint32 seqnum;
-
-      gst_event_parse_seek (event, &rate, &format, &flags, &cur_type, &cur,
-          &stop_type, &stop);
-      seqnum = gst_event_get_seqnum (event);
-      gst_event_unref (event);
-
-      /* we have to ask our peer to seek to time here as we know
-       * nothing about how to generate a granulepos from the src
-       * formats or anything.
-       * 
-       * First bring the requested format to time 
-       */
-      tformat = GST_FORMAT_TIME;
-      if (!(res = theora_dec_src_convert (pad, format, cur, &tformat, &tcur)))
-        goto convert_error;
-      if (!(res = theora_dec_src_convert (pad, format, stop, &tformat, &tstop)))
-        goto convert_error;
-
-      /* then seek with time on the peer */
-      real_seek = gst_event_new_seek (rate, GST_FORMAT_TIME,
-          flags, cur_type, tcur, stop_type, tstop);
-      gst_event_set_seqnum (real_seek, seqnum);
-
-      res = gst_pad_push_event (dec->sinkpad, real_seek);
-      break;
-    }
-    case GST_EVENT_QOS:
-    {
-      gdouble proportion;
-      GstClockTimeDiff diff;
-      GstClockTime timestamp;
-
-      gst_event_parse_qos (event, &proportion, &diff, &timestamp);
-
-      /* we cannot randomly skip frame decoding since we don't have
-       * B frames. we can however use the timestamp and diff to not
-       * push late frames. This would at least save us the time to
-       * crop/memcpy the data. */
-      GST_OBJECT_LOCK (dec);
-      dec->proportion = proportion;
-      dec->earliest_time = timestamp + diff;
-      GST_OBJECT_UNLOCK (dec);
-
-      GST_DEBUG_OBJECT (dec, "got QoS %" GST_TIME_FORMAT ", %" G_GINT64_FORMAT,
-          GST_TIME_ARGS (timestamp), diff);
-
-      res = gst_pad_push_event (dec->sinkpad, event);
-      break;
-    }
-    default:
-      res = gst_pad_push_event (dec->sinkpad, event);
-      break;
-  }
-done:
-  gst_object_unref (dec);
-
-  return res;
-
-  /* ERRORS */
-convert_error:
-  {
-    GST_DEBUG_OBJECT (dec, "could not convert format");
-    goto done;
-  }
+  gst_theora_dec_reset (GST_THEORA_DEC (bdec));
+  return TRUE;
 }
 
-static gboolean
-theora_dec_sink_event (GstPad * pad, GstEvent * event)
+static GstFlowReturn
+theora_dec_parse (GstVideoDecoder * decoder,
+    GstVideoCodecFrame * frame, GstAdapter * adapter, gboolean at_eos)
 {
-  gboolean ret = FALSE;
-  GstTheoraDec *dec;
+  gint av;
+  const guint8 *data;
 
-  dec = GST_THEORA_DEC (gst_pad_get_parent (pad));
+  av = gst_adapter_available (adapter);
 
-  GST_LOG_OBJECT (dec, "handling event");
-  switch (GST_EVENT_TYPE (event)) {
-    case GST_EVENT_FLUSH_START:
-      ret = gst_pad_push_event (dec->srcpad, event);
-      break;
-    case GST_EVENT_FLUSH_STOP:
-      gst_theora_dec_reset (dec);
-      ret = gst_pad_push_event (dec->srcpad, event);
-      break;
-    case GST_EVENT_EOS:
-      ret = gst_pad_push_event (dec->srcpad, event);
-      break;
-    case GST_EVENT_NEWSEGMENT:
-    {
-      gboolean update;
-      GstFormat format;
-      gdouble rate, arate;
-      gint64 start, stop, time;
-
-      gst_event_parse_new_segment_full (event, &update, &rate, &arate, &format,
-          &start, &stop, &time);
-
-      /* we need TIME format */
-      if (format != GST_FORMAT_TIME)
-        goto newseg_wrong_format;
-
-      GST_DEBUG_OBJECT (dec,
-          "newsegment: update %d, rate %g, arate %g, start %" GST_TIME_FORMAT
-          ", stop %" GST_TIME_FORMAT ", time %" GST_TIME_FORMAT,
-          update, rate, arate, GST_TIME_ARGS (start), GST_TIME_ARGS (stop),
-          GST_TIME_ARGS (time));
-
-      /* now configure the values */
-      gst_segment_set_newsegment_full (&dec->segment, update,
-          rate, arate, format, start, stop, time);
-      dec->seqnum = gst_event_get_seqnum (event);
-
-      /* We don't forward this unless/until the decoder is initialised */
-      if (dec->have_header) {
-        ret = gst_pad_push_event (dec->srcpad, event);
-      } else {
-        dec->pendingevents = g_list_append (dec->pendingevents, event);
-        ret = TRUE;
-      }
-      break;
-    }
-    case GST_EVENT_TAG:
-    {
-      if (dec->have_header)
-        /* and forward */
-        ret = gst_pad_push_event (dec->srcpad, event);
-      else {
-        /* store it to send once we're initialized */
-        dec->pendingevents = g_list_append (dec->pendingevents, event);
-        ret = TRUE;
-      }
-      break;
-    }
-    default:
-      ret = gst_pad_push_event (dec->srcpad, event);
-      break;
+  data = gst_adapter_peek (adapter, 1);
+  /* check for keyframe; must not be header packet */
+  if (!(data[0] & 0x80) && (data[0] & 0x40) == 0) {
+    GST_DEBUG_OBJECT (decoder, "Found keyframe, frame %p", frame);
+    GST_VIDEO_CODEC_FRAME_SET_SYNC_POINT (frame);
   }
-done:
-  gst_object_unref (dec);
 
-  return ret;
-
-  /* ERRORS */
-newseg_wrong_format:
-  {
-    GST_DEBUG_OBJECT (dec, "received non TIME newsegment");
-    gst_event_unref (event);
-    goto done;
-  }
+  /* and pass along all */
+  gst_video_decoder_add_to_frame (decoder, av);
+  return gst_video_decoder_have_frame (decoder);
 }
 
+
 static gboolean
-theora_dec_setcaps (GstPad * pad, GstCaps * caps)
+theora_dec_set_format (GstVideoDecoder * bdec, GstVideoCodecState * state)
 {
   GstTheoraDec *dec;
-  GstStructure *s;
-  const GValue *codec_data;
-
-  dec = GST_THEORA_DEC (gst_pad_get_parent (pad));
 
-  s = gst_caps_get_structure (caps, 0);
+  dec = GST_THEORA_DEC (bdec);
 
-  /* parse the par, this overrides the encoded par */
-  dec->have_par = gst_structure_get_fraction (s, "pixel-aspect-ratio",
-      &dec->par_num, &dec->par_den);
+  /* Keep a copy of the input state */
+  if (dec->input_state)
+    gst_video_codec_state_unref (dec->input_state);
+  dec->input_state = gst_video_codec_state_ref (state);
 
-  if ((codec_data = gst_structure_get_value (s, "codec_data"))) {
-    if (G_VALUE_TYPE (codec_data) == GST_TYPE_BUFFER) {
-      GstBuffer *buffer;
-      guint8 *data;
-      guint size;
-      guint offset;
+  /* FIXME : Interesting, we always accept any kind of caps ? */
+  if (state->codec_data) {
+    GstBuffer *buffer;
+    guint8 *data;
+    guint size;
+    guint offset;
 
-      buffer = gst_value_get_buffer (codec_data);
+    buffer = state->codec_data;
 
-      offset = 0;
-      size = GST_BUFFER_SIZE (buffer);
-      data = GST_BUFFER_DATA (buffer);
+    offset = 0;
+    size = GST_BUFFER_SIZE (buffer);
+    data = GST_BUFFER_DATA (buffer);
 
-      while (size > 2) {
-        guint psize;
-        GstBuffer *buf;
+    while (size > 2) {
+      guint psize;
+      GstBuffer *buf;
 
-        psize = (data[0] << 8) | data[1];
-        /* skip header */
-        data += 2;
-        size -= 2;
-        offset += 2;
+      psize = (data[0] << 8) | data[1];
+      /* skip header */
+      data += 2;
+      size -= 2;
+      offset += 2;
 
-        /* make sure we don't read too much */
-        psize = MIN (psize, size);
+      /* make sure we don't read too much */
+      psize = MIN (psize, size);
 
-        buf = gst_buffer_create_sub (buffer, offset, psize);
+      buf = gst_buffer_create_sub (buffer, offset, psize);
 
-        /* first buffer is a discont buffer */
-        if (offset == 2)
-          GST_BUFFER_FLAG_SET (buf, GST_BUFFER_FLAG_DISCONT);
+      /* first buffer is a discont buffer */
+      if (offset == 2)
+        GST_BUFFER_FLAG_SET (buf, GST_BUFFER_FLAG_DISCONT);
 
-        /* now feed it to the decoder we can ignore the error */
-        theora_dec_chain (pad, buf);
+      /* now feed it to the decoder we can ignore the error */
+      theora_dec_decode_buffer (dec, buf, NULL);
+      gst_buffer_unref (buf);
 
-        /* skip the data */
-        size -= psize;
-        data += psize;
-        offset += psize;
-      }
+      /* skip the data */
+      size -= psize;
+      data += psize;
+      offset += psize;
     }
   }
 
-  gst_object_unref (dec);
+  GST_DEBUG_OBJECT (dec, "Done");
 
   return TRUE;
 }
@@ -799,6 +389,8 @@ theora_handle_comment_packet (GstTheoraDec * dec, ogg_packet * packet)
         GST_TAG_NOMINAL_BITRATE, dec->info.target_bitrate, NULL);
   }
 
+  if (dec->tags)
+    gst_tag_list_free (dec->tags);
   dec->tags = list;
 
   return GST_FLOW_OK;
@@ -807,11 +399,11 @@ theora_handle_comment_packet (GstTheoraDec * dec, ogg_packet * packet)
 static GstFlowReturn
 theora_handle_type_packet (GstTheoraDec * dec, ogg_packet * packet)
 {
-  GstCaps *caps;
   gint par_num, par_den;
   GstFlowReturn ret = GST_FLOW_OK;
-  GList *walk;
-  guint32 fourcc;
+  GstVideoCodecState *state;
+  GstVideoFormat fmt;
+  GstVideoInfo *info = &dec->input_state->info;
 
   GST_DEBUG_OBJECT (dec, "fps %d/%d, PAR %d/%d",
       dec->info.fps_numerator, dec->info.fps_denominator,
@@ -821,19 +413,15 @@ theora_handle_type_packet (GstTheoraDec * dec, ogg_packet * packet)
    * the info.aspect_* values reflect PAR;
    * 0:x and x:0 are allowed and can be interpreted as 1:1.
    */
-  if (dec->have_par) {
-    /* we had a par on the sink caps, override the encoded par */
-    GST_DEBUG_OBJECT (dec, "overriding with input PAR");
-    par_num = dec->par_num;
-    par_den = dec->par_den;
-  } else {
-    /* take encoded par */
+  par_num = GST_VIDEO_INFO_PAR_N (info);
+  par_den = GST_VIDEO_INFO_PAR_D (info);
+
+  /* If we have a default PAR, see if the decoder specified a different one */
+  if (par_num == 1 && par_den == 1 &&
+      (dec->info.aspect_numerator != 0 && dec->info.aspect_denominator != 0)) {
     par_num = dec->info.aspect_numerator;
     par_den = dec->info.aspect_denominator;
   }
-  if (par_num == 0 || par_den == 0) {
-    par_num = par_den = 1;
-  }
   /* theora has:
    *
    *  width/height : dimension of the encoded frame 
@@ -846,23 +434,23 @@ theora_handle_type_packet (GstTheoraDec * dec, ogg_packet * packet)
       dec->info.pic_width, dec->info.pic_height,
       dec->info.pic_x, dec->info.pic_y);
 
-  if (dec->info.pixel_fmt == TH_PF_420) {
-    dec->output_bpp = 12;       /* Average bits per pixel. */
-    fourcc = GST_MAKE_FOURCC ('I', '4', '2', '0');
-  } else if (dec->info.pixel_fmt == TH_PF_422) {
-    dec->output_bpp = 16;
-    fourcc = GST_MAKE_FOURCC ('Y', '4', '2', 'B');
-  } else if (dec->info.pixel_fmt == TH_PF_444) {
-    dec->output_bpp = 24;
-    fourcc = GST_MAKE_FOURCC ('Y', '4', '4', '4');
-  } else {
-    GST_ERROR_OBJECT (dec, "Invalid pixel format %d", dec->info.pixel_fmt);
-    return GST_FLOW_ERROR;
+  switch (dec->info.pixel_fmt) {
+    case TH_PF_420:
+      fmt = GST_VIDEO_FORMAT_I420;
+      break;
+    case TH_PF_422:
+      fmt = GST_VIDEO_FORMAT_Y42B;
+      break;
+    case TH_PF_444:
+      fmt = GST_VIDEO_FORMAT_Y444;
+      break;
+    default:
+      goto unsupported_format;
   }
 
   if (dec->crop) {
-    dec->width = dec->info.pic_width;
-    dec->height = dec->info.pic_height;
+    GST_VIDEO_INFO_WIDTH (info) = dec->info.pic_width;
+    GST_VIDEO_INFO_HEIGHT (info) = dec->info.pic_height;
     dec->offset_x = dec->info.pic_x;
     dec->offset_y = dec->info.pic_y;
     /* Ensure correct offsets in chroma for formats that need it
@@ -870,22 +458,22 @@ theora_handle_type_packet (GstTheoraDec * dec, ogg_packet * packet)
      * so no need to handle them ourselves. */
     if (dec->offset_x & 1 && dec->info.pixel_fmt != TH_PF_444) {
       dec->offset_x--;
-      dec->width++;
+      GST_VIDEO_INFO_WIDTH (info)++;
     }
     if (dec->offset_y & 1 && dec->info.pixel_fmt == TH_PF_420) {
       dec->offset_y--;
-      dec->height++;
+      GST_VIDEO_INFO_HEIGHT (info)++;
     }
   } else {
     /* no cropping, use the encoded dimensions */
-    dec->width = dec->info.frame_width;
-    dec->height = dec->info.frame_height;
+    GST_VIDEO_INFO_WIDTH (info) = dec->info.frame_width;
+    GST_VIDEO_INFO_HEIGHT (info) = dec->info.frame_height;
     dec->offset_x = 0;
     dec->offset_y = 0;
   }
 
   GST_DEBUG_OBJECT (dec, "after fixup frame dimension %dx%d, offset %d:%d",
-      dec->width, dec->height, dec->offset_x, dec->offset_y);
+      info->width, info->height, dec->offset_x, dec->offset_y);
 
   /* done */
   dec->decoder = th_decode_alloc (&dec->info, dec->setup);
@@ -907,33 +495,39 @@ theora_handle_type_packet (GstTheoraDec * dec, ogg_packet * packet)
     GST_WARNING_OBJECT (dec, "Could not enable BITS mode visualisation");
   }
 
-  caps = gst_caps_new_simple ("video/x-raw-yuv",
-      "format", GST_TYPE_FOURCC, fourcc,
-      "framerate", GST_TYPE_FRACTION,
-      dec->info.fps_numerator, dec->info.fps_denominator,
-      "pixel-aspect-ratio", GST_TYPE_FRACTION, par_num, par_den,
-      "width", G_TYPE_INT, dec->width, "height", G_TYPE_INT, dec->height,
-      "color-matrix", G_TYPE_STRING, "sdtv",
-      "chroma-site", G_TYPE_STRING, "jpeg", NULL);
-  gst_pad_set_caps (dec->srcpad, caps);
-  gst_caps_unref (caps);
+  /* Create the output state */
+  dec->output_state = state =
+      gst_video_decoder_set_output_state (GST_VIDEO_DECODER (dec), fmt,
+      info->width, info->height, dec->input_state);
 
-  dec->have_header = TRUE;
+  /* FIXME : Do we still need to set fps/par now that we pass the reference input stream ? */
+  state->info.fps_n = dec->info.fps_numerator;
+  state->info.fps_d = dec->info.fps_denominator;
+  state->info.par_n = par_num;
+  state->info.par_d = par_den;
 
-  if (dec->pendingevents) {
-    for (walk = dec->pendingevents; walk; walk = g_list_next (walk))
-      gst_pad_push_event (dec->srcpad, GST_EVENT_CAST (walk->data));
-    g_list_free (dec->pendingevents);
-    dec->pendingevents = NULL;
-  }
+  state->info.chroma_site = GST_VIDEO_CHROMA_SITE_JPEG;
+  /* FIXME : Need to specify SDTV color-matrix ... once it's handled
+   * with the backported GstVideoInfo */
+
+  dec->have_header = TRUE;
 
+  /* FIXME : Put this on the next outgoing frame */
+  /* FIXME :  */
   if (dec->tags) {
-    gst_element_found_tags_for_pad (GST_ELEMENT_CAST (dec), dec->srcpad,
-        dec->tags);
+    gst_element_found_tags_for_pad (GST_ELEMENT_CAST (dec),
+        GST_VIDEO_DECODER_SRC_PAD (dec), dec->tags);
     dec->tags = NULL;
   }
 
   return ret;
+
+  /* ERRORS */
+unsupported_format:
+  {
+    GST_ERROR_OBJECT (dec, "Invalid pixel format %d", dec->info.pixel_fmt);
+    return GST_FLOW_ERROR;
+  }
 }
 
 static GstFlowReturn
@@ -974,125 +568,45 @@ header_read_error:
   }
 }
 
-/* returns TRUE if buffer is within segment, else FALSE.
- * if Buffer is on segment border, it's timestamp and duration will be clipped */
-static gboolean
-clip_buffer (GstTheoraDec * dec, GstBuffer * buf)
-{
-  gboolean res = TRUE;
-  GstClockTime in_ts, in_dur, stop;
-  gint64 cstart, cstop;
-
-  in_ts = GST_BUFFER_TIMESTAMP (buf);
-  in_dur = GST_BUFFER_DURATION (buf);
-
-  GST_LOG_OBJECT (dec,
-      "timestamp:%" GST_TIME_FORMAT " , duration:%" GST_TIME_FORMAT,
-      GST_TIME_ARGS (in_ts), GST_TIME_ARGS (in_dur));
-
-  /* can't clip without TIME segment */
-  if (dec->segment.format != GST_FORMAT_TIME)
-    goto beach;
-
-  /* we need a start time */
-  if (!GST_CLOCK_TIME_IS_VALID (in_ts))
-    goto beach;
-
-  /* generate valid stop, if duration unknown, we have unknown stop */
-  stop =
-      GST_CLOCK_TIME_IS_VALID (in_dur) ? (in_ts + in_dur) : GST_CLOCK_TIME_NONE;
-
-  /* now clip */
-  if (!(res = gst_segment_clip (&dec->segment, GST_FORMAT_TIME,
-              in_ts, stop, &cstart, &cstop)))
-    goto beach;
-
-  /* update timestamp and possibly duration if the clipped stop time is
-   * valid */
-  GST_BUFFER_TIMESTAMP (buf) = cstart;
-  if (GST_CLOCK_TIME_IS_VALID (cstop))
-    GST_BUFFER_DURATION (buf) = cstop - cstart;
-
-beach:
-  GST_LOG_OBJECT (dec, "%sdropping", (res ? "not " : ""));
-  return res;
-}
-
-static GstFlowReturn
-theora_dec_push_forward (GstTheoraDec * dec, GstBuffer * buf)
-{
-  GstFlowReturn result = GST_FLOW_OK;
-
-  if (clip_buffer (dec, buf)) {
-    if (dec->discont) {
-      GST_LOG_OBJECT (dec, "setting DISCONT");
-      GST_BUFFER_FLAG_SET (buf, GST_BUFFER_FLAG_DISCONT);
-      dec->discont = FALSE;
-    }
-    result = gst_pad_push (dec->srcpad, buf);
-  } else {
-    gst_buffer_unref (buf);
-  }
-
-  return result;
-}
-
-static GstFlowReturn
-theora_dec_push_reverse (GstTheoraDec * dec, GstBuffer * buf)
-{
-  GstFlowReturn result = GST_FLOW_OK;
-
-  dec->queued = g_list_prepend (dec->queued, buf);
-
-  return result;
-}
-
 /* Allocate buffer and copy image data into Y444 format */
 static GstFlowReturn
-theora_handle_image (GstTheoraDec * dec, th_ycbcr_buffer buf, GstBuffer ** out)
+theora_handle_image (GstTheoraDec * dec, th_ycbcr_buffer buf,
+    GstVideoCodecFrame * frame)
 {
+  GstVideoDecoder *decoder = GST_VIDEO_DECODER (dec);
+  GstVideoInfo *info;
   gint width, height, stride;
   GstFlowReturn result;
   int i, plane;
-  GstVideoFormat format;
   guint8 *dest, *src;
+  GstBuffer *out;
 
-  switch (dec->info.pixel_fmt) {
-    case TH_PF_444:
-      format = GST_VIDEO_FORMAT_Y444;
-      break;
-    case TH_PF_420:
-      format = GST_VIDEO_FORMAT_I420;
-      break;
-    case TH_PF_422:
-      format = GST_VIDEO_FORMAT_Y42B;
-      break;
-    default:
-      g_assert_not_reached ();
-  }
+  result = gst_video_decoder_alloc_output_frame (decoder, frame);
 
-  result =
-      gst_pad_alloc_buffer_and_set_caps (dec->srcpad, GST_BUFFER_OFFSET_NONE,
-      gst_video_format_get_size (format, dec->width, dec->height),
-      GST_PAD_CAPS (dec->srcpad), out);
   if (G_UNLIKELY (result != GST_FLOW_OK)) {
     GST_DEBUG_OBJECT (dec, "could not get buffer, reason: %s",
         gst_flow_get_name (result));
     return result;
   }
 
+  out = frame->output_buffer;
+  info = &dec->output_state->info;
+
+  /* FIXME : Use GstVideoInfo */
   for (plane = 0; plane < 3; plane++) {
-    width = gst_video_format_get_component_width (format, plane, dec->width);
-    height = gst_video_format_get_component_height (format, plane, dec->height);
-    stride = gst_video_format_get_row_stride (format, plane, dec->width);
+    width = GST_VIDEO_INFO_COMP_WIDTH (info, plane);
+    height = GST_VIDEO_INFO_COMP_HEIGHT (info, plane);
+    stride = GST_VIDEO_INFO_COMP_STRIDE (info, plane);
 
-    dest =
-        GST_BUFFER_DATA (*out) + gst_video_format_get_component_offset (format,
-        plane, dec->width, dec->height);
+    dest = GST_BUFFER_DATA (out) + GST_VIDEO_INFO_COMP_OFFSET (info, plane);
     src = buf[plane].data;
-    src += ((height == dec->height) ? dec->offset_y : dec->offset_y / 2)
+    src +=
+        ((height ==
+            GST_VIDEO_INFO_HEIGHT (info)) ? dec->offset_y : dec->offset_y / 2)
         * buf[plane].stride;
-    src += (width == dec->width) ? dec->offset_x : dec->offset_x / 2;
+    src +=
+        (width ==
+        GST_VIDEO_INFO_WIDTH (info)) ? dec->offset_x : dec->offset_x / 2;
 
     for (i = 0; i < height; i++) {
       memcpy (dest, src, width);
@@ -1107,11 +621,10 @@ theora_handle_image (GstTheoraDec * dec, th_ycbcr_buffer buf, GstBuffer ** out)
 
 static GstFlowReturn
 theora_handle_data_packet (GstTheoraDec * dec, ogg_packet * packet,
-    GstClockTime outtime, GstClockTime outdur)
+    GstVideoCodecFrame * frame)
 {
   /* normal data packet */
   th_ycbcr_buffer buf;
-  GstBuffer *out;
   gboolean keyframe;
   GstFlowReturn result;
   ogg_int64_t gp;
@@ -1119,17 +632,6 @@ theora_handle_data_packet (GstTheoraDec * dec, ogg_packet * packet,
   if (G_UNLIKELY (!dec->have_header))
     goto not_initialized;
 
-  /* get timestamp and durations */
-  if (outtime == -1)
-    outtime = dec->last_timestamp;
-  if (outdur == -1)
-    outdur = gst_util_uint64_scale_int (GST_SECOND, dec->info.fps_denominator,
-        dec->info.fps_numerator);
-
-  /* calculate expected next timestamp */
-  if (outtime != -1 && outdur != -1)
-    dec->last_timestamp = outtime + outdur;
-
   /* the second most significant bit of the first data byte is cleared 
    * for keyframes. We can only check it if it's not a zero-length packet. */
   keyframe = packet->bytes && ((packet->packet[0] & 0x40) == 0);
@@ -1146,50 +648,10 @@ theora_handle_data_packet (GstTheoraDec * dec, ogg_packet * packet,
   if (G_UNLIKELY (th_decode_packetin (dec->decoder, packet, &gp) < 0))
     goto decode_error;
 
-  if (outtime != -1) {
-    gboolean need_skip;
-    GstClockTime running_time;
-    GstClockTime earliest_time;
-    gdouble proportion;
-
-    /* qos needs to be done on running time */
-    running_time = gst_segment_to_running_time (&dec->segment, GST_FORMAT_TIME,
-        outtime);
-
-    GST_OBJECT_LOCK (dec);
-    proportion = dec->proportion;
-    earliest_time = dec->earliest_time;
-    /* check for QoS, don't perform the last steps of getting and
-     * pushing the buffers that are known to be late. */
-    need_skip = earliest_time != -1 && running_time <= earliest_time;
-    GST_OBJECT_UNLOCK (dec);
-
-    if (need_skip) {
-      GstMessage *qos_msg;
-      guint64 stream_time;
-      gint64 jitter;
-
-      GST_DEBUG_OBJECT (dec, "skipping decoding: qostime %"
-          GST_TIME_FORMAT " <= %" GST_TIME_FORMAT,
-          GST_TIME_ARGS (running_time), GST_TIME_ARGS (earliest_time));
-
-      dec->dropped++;
-
-      stream_time =
-          gst_segment_to_stream_time (&dec->segment, GST_FORMAT_TIME, outtime);
-      jitter = GST_CLOCK_DIFF (running_time, earliest_time);
-
-      qos_msg =
-          gst_message_new_qos (GST_OBJECT_CAST (dec), FALSE, running_time,
-          stream_time, outtime, outdur);
-      gst_message_set_qos_values (qos_msg, jitter, proportion, 1000000);
-      gst_message_set_qos_stats (qos_msg, GST_FORMAT_BUFFERS,
-          dec->processed, dec->dropped);
-      gst_element_post_message (GST_ELEMENT_CAST (dec), qos_msg);
-
-      goto dropping_qos;
-    }
-  }
+  if (frame &&
+      (gst_video_decoder_get_max_decode_time (GST_VIDEO_DECODER (dec),
+              frame) < 0))
+    goto dropping_qos;
 
   /* this does postprocessing and set up the decoded frame
    * pointers in our yuv variable */
@@ -1200,24 +662,7 @@ theora_handle_data_packet (GstTheoraDec * dec, ogg_packet * packet,
           || (buf[0].height != dec->info.frame_height)))
     goto wrong_dimensions;
 
-  result = theora_handle_image (dec, buf, &out);
-  if (result != GST_FLOW_OK)
-    return result;
-
-  GST_BUFFER_OFFSET (out) = dec->frame_nr;
-  if (dec->frame_nr != -1)
-    dec->frame_nr++;
-  GST_BUFFER_OFFSET_END (out) = dec->frame_nr;
-
-  GST_BUFFER_TIMESTAMP (out) = outtime;
-  GST_BUFFER_DURATION (out) = outdur;
-
-  dec->processed++;
-
-  if (dec->segment.rate >= 0.0)
-    result = theora_dec_push_forward (dec, out);
-  else
-    result = theora_dec_push_reverse (dec, out);
+  result = theora_handle_image (dec, buf, frame);
 
   return result;
 
@@ -1231,16 +676,12 @@ not_initialized:
 dropping:
   {
     GST_WARNING_OBJECT (dec, "dropping frame because we need a keyframe");
-    dec->discont = TRUE;
-    return GST_FLOW_OK;
+    return GST_VIDEO_DECODER_FLOW_NEED_DATA;
   }
 dropping_qos:
   {
-    if (dec->frame_nr != -1)
-      dec->frame_nr++;
-    dec->discont = TRUE;
     GST_WARNING_OBJECT (dec, "dropping frame because of QoS");
-    return GST_FLOW_OK;
+    return GST_VIDEO_DECODER_FLOW_DROPPED;
   }
 decode_error:
   {
@@ -1263,11 +704,11 @@ wrong_dimensions:
 }
 
 static GstFlowReturn
-theora_dec_decode_buffer (GstTheoraDec * dec, GstBuffer * buf)
+theora_dec_decode_buffer (GstTheoraDec * dec, GstBuffer * buf,
+    GstVideoCodecFrame * frame)
 {
   ogg_packet packet;
   GstFlowReturn result = GST_FLOW_OK;
-  GstClockTime timestamp, duration;
 
   /* make ogg_packet out of the buffer */
   packet.packet = GST_BUFFER_DATA (buf);
@@ -1280,13 +721,7 @@ theora_dec_decode_buffer (GstTheoraDec * dec, GstBuffer * buf)
 
   GST_LOG_OBJECT (dec, "decode buffer of size %ld", packet.bytes);
 
-  /* save last seem timestamp for interpolating the next timestamps using the
-   * framerate when we need to */
-  timestamp = GST_BUFFER_TIMESTAMP (buf);
-  duration = GST_BUFFER_DURATION (buf);
-
-  GST_DEBUG_OBJECT (dec, "header=%02x, outtime=%" GST_TIME_FORMAT,
-      packet.bytes ? packet.packet[0] : -1, GST_TIME_ARGS (timestamp));
+  GST_DEBUG_OBJECT (dec, "header=%02x", packet.bytes ? packet.packet[0] : -1);
 
   /* switch depending on packet type. A zero byte packet is always a data
    * packet; we don't dereference it in that case. */
@@ -1296,252 +731,42 @@ theora_dec_decode_buffer (GstTheoraDec * dec, GstBuffer * buf)
       goto done;
     }
     result = theora_handle_header_packet (dec, &packet);
+    /* header packets are not meant to be displayed */
+    /* FIXME : This is a temporary hack. The proper fix would be to
+     * not call _finish_frame() for these types of packets */
+    GST_VIDEO_CODEC_FRAME_FLAG_SET (frame,
+        GST_VIDEO_CODEC_FRAME_FLAG_DECODE_ONLY);
   } else {
-    result = theora_handle_data_packet (dec, &packet, timestamp, duration);
+    result = theora_handle_data_packet (dec, &packet, frame);
   }
 
 done:
   return result;
 }
 
-/* For reverse playback we use a technique that can be used for
- * any keyframe based video codec.
- *
- * Input:
- *  Buffer decoding order:  7  8  9  4  5  6  1  2  3  EOS
- *  Keyframe flag:                      K        K
- *  Discont flag:           D        D        D
- *
- * - Each Discont marks a discont in the decoding order.
- * - The keyframes mark where we can start decoding.
- *
- * First we prepend incomming buffers to the gather queue, whenever we receive
- * a discont, we flush out the gather queue.
- *
- * The above data will be accumulated in the gather queue like this:
- *
- *   gather queue:  9  8  7
- *                        D
- *
- * Whe buffer 4 is received (with a DISCONT), we flush the gather queue like
- * this:
- *
- *   while (gather)
- *     take head of queue and prepend to decode queue.
- *     if we copied a keyframe, decode the decode queue.
- *
- * After we flushed the gather queue, we add 4 to the (now empty) gather queue.
- * We get the following situation:
- *
- *  gather queue:    4
- *  decode queue:    7  8  9
- *
- * After we received 5 (Keyframe) and 6:
- *
- *  gather queue:    6  5  4
- *  decode queue:    7  8  9
- *
- * When we receive 1 (DISCONT) which triggers a flush of the gather queue:
- *
- *   Copy head of the gather queue (6) to decode queue:
- *
- *    gather queue:    5  4
- *    decode queue:    6  7  8  9
- *
- *   Copy head of the gather queue (5) to decode queue. This is a keyframe so we
- *   can start decoding.
- *
- *    gather queue:    4
- *    decode queue:    5  6  7  8  9
- *
- *   Decode frames in decode queue, store raw decoded data in output queue, we
- *   can take the head of the decode queue and prepend the decoded result in the
- *   output queue:
- *
- *    gather queue:    4
- *    decode queue:    
- *    output queue:    9  8  7  6  5
- *
- *   Now output all the frames in the output queue, picking a frame from the
- *   head of the queue.
- *
- *   Copy head of the gather queue (4) to decode queue, we flushed the gather
- *   queue and can now store input buffer in the gather queue:
- *
- *    gather queue:    1
- *    decode queue:    4
- *
- *  When we receive EOS, the queue looks like:
- *
- *    gather queue:    3  2  1
- *    decode queue:    4
- *
- *  Fill decode queue, first keyframe we copy is 2:
- *
- *    gather queue:    1
- *    decode queue:    2  3  4
- *
- *  Decoded output:
- *
- *    gather queue:    1
- *    decode queue:    
- *    output queue:    4  3  2
- *
- *  Leftover buffer 1 cannot be decoded and must be discarded.
- */
 static GstFlowReturn
-theora_dec_flush_decode (GstTheoraDec * dec)
-{
-  GstFlowReturn res = GST_FLOW_OK;
-
-  while (dec->decode) {
-    GstBuffer *buf = GST_BUFFER_CAST (dec->decode->data);
-
-    GST_DEBUG_OBJECT (dec, "decoding buffer %p, ts %" GST_TIME_FORMAT,
-        buf, GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (buf)));
-
-    /* decode buffer, prepend to output queue */
-    res = theora_dec_decode_buffer (dec, buf);
-
-    /* don't need it anymore now */
-    gst_buffer_unref (buf);
-
-    dec->decode = g_list_delete_link (dec->decode, dec->decode);
-  }
-  while (dec->queued) {
-    GstBuffer *buf = GST_BUFFER_CAST (dec->queued->data);
-
-    /* iterate output queue an push downstream */
-    res = gst_pad_push (dec->srcpad, buf);
-
-    dec->queued = g_list_delete_link (dec->queued, dec->queued);
-  }
-
-  return res;
-}
-
-static GstFlowReturn
-theora_dec_chain_reverse (GstTheoraDec * dec, gboolean discont, GstBuffer * buf)
-{
-  GstFlowReturn res = GST_FLOW_OK;
-
-  /* if we have a discont, move buffers to the decode list */
-  if (G_UNLIKELY (discont)) {
-    GST_DEBUG_OBJECT (dec, "received discont,gathering buffers");
-    while (dec->gather) {
-      GstBuffer *gbuf;
-      guint8 *data;
-
-      gbuf = GST_BUFFER_CAST (dec->gather->data);
-      /* remove from the gather list */
-      dec->gather = g_list_delete_link (dec->gather, dec->gather);
-      /* copy to decode queue */
-      dec->decode = g_list_prepend (dec->decode, gbuf);
-
-      /* if we copied a keyframe, flush and decode the decode queue */
-      data = GST_BUFFER_DATA (gbuf);
-      if (data && (data[0] & 0x40) == 0) {
-        GST_DEBUG_OBJECT (dec, "copied keyframe");
-        res = theora_dec_flush_decode (dec);
-      }
-    }
-  }
-
-  /* add buffer to gather queue */
-  GST_DEBUG_OBJECT (dec, "gathering buffer %p, size %u", buf,
-      GST_BUFFER_SIZE (buf));
-  dec->gather = g_list_prepend (dec->gather, buf);
-
-  return res;
-}
-
-static GstFlowReturn
-theora_dec_chain_forward (GstTheoraDec * dec, gboolean discont,
-    GstBuffer * buffer)
-{
-  GstFlowReturn result;
-
-  result = theora_dec_decode_buffer (dec, buffer);
-
-  gst_buffer_unref (buffer);
-
-  return result;
-}
-
-static GstFlowReturn
-theora_dec_chain (GstPad * pad, GstBuffer * buf)
+theora_dec_handle_frame (GstVideoDecoder * bdec, GstVideoCodecFrame * frame)
 {
   GstTheoraDec *dec;
   GstFlowReturn res;
-  gboolean discont;
-
-  dec = GST_THEORA_DEC (gst_pad_get_parent (pad));
-
-  /* peel of DISCONT flag */
-  discont = GST_BUFFER_IS_DISCONT (buf);
-
-  /* resync on DISCONT */
-  if (G_UNLIKELY (discont)) {
-    GST_DEBUG_OBJECT (dec, "received DISCONT buffer");
-    dec->need_keyframe = TRUE;
-    dec->last_timestamp = -1;
-    dec->discont = TRUE;
-  }
-
-  if (dec->segment.rate > 0.0)
-    res = theora_dec_chain_forward (dec, discont, buf);
-  else
-    res = theora_dec_chain_reverse (dec, discont, buf);
-
-  gst_object_unref (dec);
-
-  return res;
-}
 
-static GstStateChangeReturn
-theora_dec_change_state (GstElement * element, GstStateChange transition)
-{
-  GstTheoraDec *dec = GST_THEORA_DEC (element);
-  GstStateChangeReturn ret;
+  dec = GST_THEORA_DEC (bdec);
 
-  switch (transition) {
-    case GST_STATE_CHANGE_NULL_TO_READY:
+  res = theora_dec_decode_buffer (dec, frame->input_buffer, frame);
+  switch (res) {
+    case GST_FLOW_OK:
+      res = gst_video_decoder_finish_frame (bdec, frame);
       break;
-    case GST_STATE_CHANGE_READY_TO_PAUSED:
-      th_info_clear (&dec->info);
-      th_comment_clear (&dec->comment);
-      GST_DEBUG_OBJECT (dec, "Setting have_header to FALSE in READY->PAUSED");
-      dec->have_header = FALSE;
-      dec->have_par = FALSE;
-      gst_theora_dec_reset (dec);
-      break;
-    case GST_STATE_CHANGE_PAUSED_TO_PLAYING:
+    case GST_VIDEO_DECODER_FLOW_DROPPED:
+    case GST_VIDEO_DECODER_FLOW_NEED_DATA:
+      res = gst_video_decoder_drop_frame (bdec, frame);
       break;
     default:
+      gst_video_codec_frame_unref (frame);
       break;
   }
 
-  ret = parent_class->change_state (element, transition);
-
-  switch (transition) {
-    case GST_STATE_CHANGE_PLAYING_TO_PAUSED:
-      break;
-    case GST_STATE_CHANGE_PAUSED_TO_READY:
-      th_info_clear (&dec->info);
-      th_comment_clear (&dec->comment);
-      th_setup_free (dec->setup);
-      dec->setup = NULL;
-      th_decode_free (dec->decoder);
-      dec->decoder = NULL;
-      gst_theora_dec_reset (dec);
-      break;
-    case GST_STATE_CHANGE_READY_TO_NULL:
-      break;
-    default:
-      break;
-  }
-
-  return ret;
+  return res;
 }
 
 static void
@@ -1599,3 +824,10 @@ theora_dec_get_property (GObject * object, guint prop_id,
       break;
   }
 }
+
+gboolean
+gst_theora_dec_register (GstPlugin * plugin)
+{
+  return gst_element_register (plugin, "theoradec",
+      GST_RANK_PRIMARY, GST_TYPE_THEORA_DEC);
+}
diff --git a/ext/theora/gsttheoradec.h b/ext/theora/gsttheoradec.h
index 34578ce..c66eed8 100644
--- a/ext/theora/gsttheoradec.h
+++ b/ext/theora/gsttheoradec.h
@@ -1,5 +1,8 @@
 /* GStreamer
  * Copyright (C) 2004 Benjamin Otte <in7y118@public.uni-hamburg.de>
+ * Copyright (c) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
+ *      Author : Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
  *
  * This library is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Library General Public
@@ -25,6 +28,7 @@
 #endif
 
 #include <gst/gst.h>
+#include <gst/video/gstvideodecoder.h>
 #include <theora/theoradec.h>
 #include <string.h>
 
@@ -51,11 +55,7 @@ typedef struct _GstTheoraDecClass GstTheoraDecClass;
  */
 struct _GstTheoraDec
 {
-  GstElement element;
-
-  /* Pads */
-  GstPad *sinkpad;
-  GstPad *srcpad;
+  GstVideoDecoder element;
 
   /* theora decoder state */
   th_dec_ctx *decoder;
@@ -66,14 +66,12 @@ struct _GstTheoraDec
 
   gboolean have_header;
 
-  GstClockTime last_timestamp;
-  guint64 frame_nr;
   gboolean need_keyframe;
-  gint width, height;
+  GstVideoCodecState *input_state;
+  GstVideoCodecState *output_state;
   gint offset_x, offset_y;
-  gint output_bpp;
 
-  /* telemetry debugging options */
+  /* telemetry debuging options */
   gint telemetry_mv;
   gint telemetry_mbmode;
   gint telemetry_qi;
@@ -81,39 +79,17 @@ struct _GstTheoraDec
 
   gboolean crop;
 
-  /* list of buffers that need timestamps */
-  GList *queued;
-  /* list of raw output buffers */
-  GList *output;
-  /* gather/decode queues for reverse playback */
-  GList *gather;
-  GList *decode;
-  GList *pendingevents;
-
   GstTagList *tags;
 
-  /* segment info */ /* with STREAM_LOCK */
-  GstSegment segment;
-  gboolean discont;
-  guint32 seqnum;
-
-  /* QoS stuff */ /* with LOCK*/
-  gdouble proportion;
-  GstClockTime earliest_time;
-  guint64 processed;
-  guint64 dropped;
-
-  gboolean have_par;
-  gint par_num;
-  gint par_den;
 };
 
 struct _GstTheoraDecClass
 {
-  GstElementClass parent_class;
+  GstVideoDecoderClass parent_class;
 };
 
 GType gst_theora_dec_get_type (void);
+gboolean gst_theora_dec_register (GstPlugin * plugin);
 
 G_END_DECLS
 
diff --git a/ext/theora/gsttheoraenc.c b/ext/theora/gsttheoraenc.c
index f468439..4c4dc4b 100644
--- a/ext/theora/gsttheoraenc.c
+++ b/ext/theora/gsttheoraenc.c
@@ -1,5 +1,8 @@
 /* GStreamer
  * Copyright (C) 2004 Wim Taymans <wim@fluendo.com>
+ * Copyright (c) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
+ *      Author : Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
  *
  * This library is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Library General Public
@@ -175,57 +178,6 @@ granulepos_to_timestamp (GstTheoraEnc * theoraenc, ogg_int64_t granulepos)
       theoraenc->info.fps_numerator);
 }
 
-/* Generate a dummy encoder context for use in th_encode_ctl queries
-   Release with th_encode_free()
-   This and the next routine from theora/examples/libtheora_info.c */
-static th_enc_ctx *
-dummy_encode_ctx (void)
-{
-  th_enc_ctx *ctx;
-  th_info info;
-
-  /* set the minimal video parameters */
-  th_info_init (&info);
-  info.frame_width = 320;
-  info.frame_height = 240;
-  info.fps_numerator = 1;
-  info.fps_denominator = 1;
-
-  /* allocate and initialize a context object */
-  ctx = th_encode_alloc (&info);
-  if (!ctx)
-    GST_WARNING ("Failed to allocate dummy encoder context.");
-
-  /* clear the info struct */
-  th_info_clear (&info);
-
-  return ctx;
-}
-
-/* Query the current and maximum values for the 'speed level' setting.
-   This can be used to ask the encoder to trade off encoding quality
-   vs. performance cost, for example to adapt to realtime constraints. */
-static int
-check_speed_level (th_enc_ctx * ctx, int *current, int *max)
-{
-  int ret;
-
-  /* query the current speed level */
-  ret = th_encode_ctl (ctx, TH_ENCCTL_GET_SPLEVEL, current, sizeof (int));
-  if (ret) {
-    GST_WARNING ("Error %d getting current speed level.", ret);
-    return ret;
-  }
-  /* query the maximum speed level, which varies by encoder version */
-  ret = th_encode_ctl (ctx, TH_ENCCTL_GET_SPLEVEL_MAX, max, sizeof (int));
-  if (ret) {
-    GST_WARNING ("Error %d getting maximum speed level.", ret);
-    return ret;
-  }
-
-  return 0;
-}
-
 static GstStaticPadTemplate theora_enc_sink_factory =
 GST_STATIC_PAD_TEMPLATE ("sink",
     GST_PAD_SINK,
@@ -243,31 +195,20 @@ GST_STATIC_PAD_TEMPLATE ("src",
     GST_STATIC_CAPS ("video/x-theora")
     );
 
-static GstCaps *theora_enc_src_caps;
-
-static void
-_do_init (GType object_type)
-{
-  const GInterfaceInfo preset_interface_info = {
-    NULL,                       /* interface_init */
-    NULL,                       /* interface_finalize */
-    NULL                        /* interface_data */
-  };
-
-  g_type_add_interface_static (object_type, GST_TYPE_PRESET,
-      &preset_interface_info);
-}
+GST_BOILERPLATE (GstTheoraEnc, gst_theora_enc, GstVideoEncoder,
+    GST_TYPE_VIDEO_ENCODER);
 
-GST_BOILERPLATE_FULL (GstTheoraEnc, gst_theora_enc, GstElement,
-    GST_TYPE_ELEMENT, _do_init);
+static gboolean theora_enc_start (GstVideoEncoder * enc);
+static gboolean theora_enc_stop (GstVideoEncoder * enc);
+static gboolean theora_enc_set_format (GstVideoEncoder * enc,
+    GstVideoCodecState * state);
+static GstFlowReturn theora_enc_handle_frame (GstVideoEncoder * enc,
+    GstVideoCodecFrame * frame);
+static GstFlowReturn theora_enc_pre_push (GstVideoEncoder * benc,
+    GstVideoCodecFrame * frame);
+static GstFlowReturn theora_enc_finish (GstVideoEncoder * enc);
 
-static gboolean theora_enc_sink_event (GstPad * pad, GstEvent * event);
-static gboolean theora_enc_src_event (GstPad * pad, GstEvent * event);
-static GstFlowReturn theora_enc_chain (GstPad * pad, GstBuffer * buffer);
-static GstStateChangeReturn theora_enc_change_state (GstElement * element,
-    GstStateChange transition);
 static GstCaps *theora_enc_sink_getcaps (GstPad * pad);
-static gboolean theora_enc_sink_setcaps (GstPad * pad, GstCaps * caps);
 static void theora_enc_get_property (GObject * object, guint prop_id,
     GValue * value, GParamSpec * pspec);
 static void theora_enc_set_property (GObject * object, guint prop_id,
@@ -277,17 +218,15 @@ static void theora_enc_finalize (GObject * object);
 static gboolean theora_enc_write_multipass_cache (GstTheoraEnc * enc,
     gboolean begin, gboolean eos);
 
-static char *theora_enc_get_supported_formats (void);
-
 static void
 gst_theora_enc_base_init (gpointer g_class)
 {
   GstElementClass *element_class = GST_ELEMENT_CLASS (g_class);
 
-  gst_element_class_add_static_pad_template (element_class,
-      &theora_enc_src_factory);
-  gst_element_class_add_static_pad_template (element_class,
-      &theora_enc_sink_factory);
+  gst_element_class_add_pad_template (element_class,
+      gst_static_pad_template_get (&theora_enc_src_factory));
+  gst_element_class_add_pad_template (element_class,
+      gst_static_pad_template_get (&theora_enc_sink_factory));
   gst_element_class_set_details_simple (element_class,
       "Theora video encoder", "Codec/Encoder/Video",
       "encode raw YUV video to a theora stream",
@@ -298,28 +237,22 @@ static void
 gst_theora_enc_class_init (GstTheoraEncClass * klass)
 {
   GObjectClass *gobject_class = (GObjectClass *) klass;
-  GstElementClass *gstelement_class = GST_ELEMENT_CLASS (klass);
-  char *caps_string;
-
-  /* query runtime encoder properties */
-  th_enc_ctx *th_ctx;
-  int default_speed_level = THEORA_DEF_SPEEDLEVEL;
-  int max_speed_level = default_speed_level;
-
-  GST_DEBUG_CATEGORY_INIT (theoraenc_debug, "theoraenc", 0, "Theora encoder");
-
-  th_ctx = dummy_encode_ctx ();
-  if (th_ctx) {
-    if (check_speed_level (th_ctx, &default_speed_level, &max_speed_level))
-      GST_WARNING
-          ("Failed to determine settings for the speed-level property.");
-    th_encode_free (th_ctx);
-  }
+  GstVideoEncoderClass *gstvideo_encoder_class =
+      GST_VIDEO_ENCODER_CLASS (klass);
 
   gobject_class->set_property = theora_enc_set_property;
   gobject_class->get_property = theora_enc_get_property;
   gobject_class->finalize = theora_enc_finalize;
 
+  gstvideo_encoder_class->start = GST_DEBUG_FUNCPTR (theora_enc_start);
+  gstvideo_encoder_class->stop = GST_DEBUG_FUNCPTR (theora_enc_stop);
+  gstvideo_encoder_class->set_format =
+      GST_DEBUG_FUNCPTR (theora_enc_set_format);
+  gstvideo_encoder_class->handle_frame =
+      GST_DEBUG_FUNCPTR (theora_enc_handle_frame);
+  gstvideo_encoder_class->pre_push = GST_DEBUG_FUNCPTR (theora_enc_pre_push);
+  gstvideo_encoder_class->finish = GST_DEBUG_FUNCPTR (theora_enc_finish);
+
   g_object_class_install_property (gobject_class, PROP_CENTER,
       g_param_spec_boolean ("center", "Center",
           "ignored and kept for API compat only", TRUE,
@@ -375,38 +308,40 @@ gst_theora_enc_class_init (GstTheoraEncClass * klass)
           (GParamFlags) G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
   g_object_class_install_property (gobject_class, PROP_SPEEDLEVEL,
       g_param_spec_int ("speed-level", "Speed level",
-          "Controls the amount of analysis performed when encoding."
-          " Higher values trade compression quality for speed."
-          " This property requires libtheora version >= 1.0"
-          ", and the maximum value may vary based on encoder version.",
-          0, max_speed_level, default_speed_level,
-          (GParamFlags) G_PARAM_READWRITE | G_PARAM_CONSTRUCT |
-          G_PARAM_STATIC_STRINGS));
+          "Controls the amount of motion vector searching done while "
+          "encoding.  This property requires libtheora version >= 1.0",
+          0, 3, THEORA_DEF_SPEEDLEVEL,
+          (GParamFlags) G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
   g_object_class_install_property (gobject_class, PROP_VP3_COMPATIBLE,
       g_param_spec_boolean ("vp3-compatible", "VP3 Compatible",
-          "Disables non-VP3 compatible features",
+          "Disables non-VP3 compatible features."
+          "  This property requires libtheora version >= 1.1",
           THEORA_DEF_VP3_COMPATIBLE,
           (GParamFlags) G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
   g_object_class_install_property (gobject_class, PROP_DROP_FRAMES,
-      g_param_spec_boolean ("drop-frames", "Drop Frames",
-          "Allow or disallow frame dropping",
+      g_param_spec_boolean ("drop-frames", "VP3 Compatible",
+          "Allow or disallow frame dropping."
+          "  This property requires libtheora version >= 1.1",
           THEORA_DEF_DROP_FRAMES,
           (GParamFlags) G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
   g_object_class_install_property (gobject_class, PROP_CAP_OVERFLOW,
-      g_param_spec_boolean ("cap-overflow", "Cap Overflow",
-          "Enable capping of bit reservoir overflows",
+      g_param_spec_boolean ("cap-overflow", "VP3 Compatible",
+          "Enable capping of bit reservoir overflows."
+          "  This property requires libtheora version >= 1.1",
           THEORA_DEF_CAP_OVERFLOW,
           (GParamFlags) G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
   g_object_class_install_property (gobject_class, PROP_CAP_UNDERFLOW,
-      g_param_spec_boolean ("cap-underflow", "Cap Underflow",
-          "Enable capping of bit reservoir underflows",
+      g_param_spec_boolean ("cap-underflow", "VP3 Compatible",
+          "Enable capping of bit reservoir underflows."
+          "  This property requires libtheora version >= 1.1",
           THEORA_DEF_CAP_UNDERFLOW,
           (GParamFlags) G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
   g_object_class_install_property (gobject_class, PROP_RATE_BUFFER,
       g_param_spec_int ("rate-buffer", "Rate Control Buffer",
           "Sets the size of the rate control buffer, in units of frames.  "
           "The default value of 0 instructs the encoder to automatically "
-          "select an appropriate value",
+          "select an appropriate value."
+          "  This property requires libtheora version >= 1.1",
           0, 1000, THEORA_DEF_RATE_BUFFER,
           (GParamFlags) G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
   g_object_class_install_property (gobject_class, PROP_MULTIPASS_CACHE_FILE,
@@ -419,35 +354,14 @@ gst_theora_enc_class_init (GstTheoraEncClass * klass)
           THEORA_DEF_MULTIPASS_MODE,
           (GParamFlags) G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
-  caps_string = g_strdup_printf ("video/x-raw-yuv, "
-      "format = (fourcc) { %s }, "
-      "framerate = (fraction) [1/MAX, MAX], "
-      "width = (int) [ 1, MAX ], " "height = (int) [ 1, MAX ]",
-      theora_enc_get_supported_formats ());
-  theora_enc_src_caps = gst_caps_from_string (caps_string);
-  g_free (caps_string);
-
-  gstelement_class->change_state = theora_enc_change_state;
+  GST_DEBUG_CATEGORY_INIT (theoraenc_debug, "theoraenc", 0, "Theora encoder");
 }
 
 static void
 gst_theora_enc_init (GstTheoraEnc * enc, GstTheoraEncClass * g_class)
 {
-  enc->sinkpad =
-      gst_pad_new_from_static_template (&theora_enc_sink_factory, "sink");
-  gst_pad_set_chain_function (enc->sinkpad, theora_enc_chain);
-  gst_pad_set_event_function (enc->sinkpad, theora_enc_sink_event);
-  gst_pad_set_getcaps_function (enc->sinkpad, theora_enc_sink_getcaps);
-  gst_pad_set_setcaps_function (enc->sinkpad, theora_enc_sink_setcaps);
-  gst_element_add_pad (GST_ELEMENT (enc), enc->sinkpad);
-
-  enc->srcpad =
-      gst_pad_new_from_static_template (&theora_enc_src_factory, "src");
-  gst_pad_set_event_function (enc->srcpad, theora_enc_src_event);
-  gst_pad_use_fixed_caps (enc->srcpad);
-  gst_element_add_pad (GST_ELEMENT (enc), enc->srcpad);
-
-  gst_segment_init (&enc->segment, GST_FORMAT_UNDEFINED);
+  gst_pad_set_getcaps_function (GST_VIDEO_ENCODER_SINK_PAD (enc),
+      GST_DEBUG_FUNCPTR (theora_enc_sink_getcaps));
 
   enc->video_bitrate = THEORA_DEF_BITRATE;
   enc->video_quality = THEORA_DEF_QUALITY;
@@ -455,9 +369,7 @@ gst_theora_enc_init (GstTheoraEnc * enc, GstTheoraEncClass * g_class)
   enc->keyframe_freq = THEORA_DEF_KEYFRAME_FREQ;
   enc->keyframe_force = THEORA_DEF_KEYFRAME_FREQ_FORCE;
 
-  enc->expected_ts = GST_CLOCK_TIME_NONE;
-
-  /* enc->speed_level is set to the libtheora default by the constructor */
+  enc->speed_level = THEORA_DEF_SPEEDLEVEL;
   enc->vp3_compatible = THEORA_DEF_VP3_COMPATIBLE;
   enc->drop_frames = THEORA_DEF_DROP_FRAMES;
   enc->cap_overflow = THEORA_DEF_CAP_OVERFLOW;
@@ -497,6 +409,9 @@ theora_enc_finalize (GObject * object)
 
   theora_enc_clear_multipass_cache (enc);
 
+  if (enc->input_state)
+    gst_video_codec_state_unref (enc->input_state);
+
   G_OBJECT_CLASS (parent_class)->finalize (object);
 }
 
@@ -508,13 +423,7 @@ theora_enc_reset (GstTheoraEnc * enc)
 
   GST_OBJECT_LOCK (enc);
   enc->info.target_bitrate = enc->video_bitrate;
-  if (enc->quality_changed) {
-    enc->info.quality = enc->video_quality;
-  } else {
-    if (enc->video_bitrate == 0) {
-      enc->info.quality = enc->video_quality;
-    }
-  }
+  enc->info.quality = enc->video_quality;
   enc->bitrate_changed = FALSE;
   enc->quality_changed = FALSE;
   GST_OBJECT_UNLOCK (enc);
@@ -557,17 +466,63 @@ theora_enc_reset (GstTheoraEnc * enc)
     theora_enc_write_multipass_cache (enc, TRUE, FALSE);
 }
 
-static void
-theora_enc_clear (GstTheoraEnc * enc)
+static gboolean
+theora_enc_start (GstVideoEncoder * benc)
 {
+  GstTheoraEnc *enc;
+
+  GST_DEBUG_OBJECT (benc, "start: init theora");
+  enc = GST_THEORA_ENC (benc);
+
+  th_info_init (&enc->info);
+  th_comment_init (&enc->comment);
   enc->packetno = 0;
-  enc->bytes_out = 0;
-  enc->granulepos_offset = 0;
-  enc->timestamp_offset = 0;
 
-  enc->next_ts = GST_CLOCK_TIME_NONE;
-  enc->next_discont = FALSE;
-  enc->expected_ts = GST_CLOCK_TIME_NONE;
+  if (enc->multipass_mode >= MULTIPASS_MODE_FIRST_PASS) {
+    GError *err = NULL;
+
+    if (!enc->multipass_cache_file) {
+      GST_ELEMENT_ERROR (enc, LIBRARY, SETTINGS, (NULL), (NULL));
+      return FALSE;
+    }
+    enc->multipass_cache_fd =
+        g_io_channel_new_file (enc->multipass_cache_file,
+        (enc->multipass_mode == MULTIPASS_MODE_FIRST_PASS ? "w" : "r"), &err);
+
+    if (enc->multipass_mode == MULTIPASS_MODE_SECOND_PASS)
+      enc->multipass_cache_adapter = gst_adapter_new ();
+
+    if (!enc->multipass_cache_fd) {
+      GST_ELEMENT_ERROR (enc, RESOURCE, OPEN_READ, (NULL),
+          ("Failed to open multipass cache file: %s", err->message));
+      g_error_free (err);
+      return FALSE;
+    }
+
+    g_io_channel_set_encoding (enc->multipass_cache_fd, NULL, NULL);
+  }
+
+  return TRUE;
+}
+
+static gboolean
+theora_enc_stop (GstVideoEncoder * benc)
+{
+  GstTheoraEnc *enc;
+
+  GST_DEBUG_OBJECT (benc, "stop: clearing theora state");
+  enc = GST_THEORA_ENC (benc);
+
+  if (enc->encoder) {
+    th_encode_free (enc->encoder);
+    enc->encoder = NULL;
+  }
+  th_comment_clear (&enc->comment);
+  th_info_clear (&enc->info);
+
+  enc->initialised = FALSE;
+
+  return TRUE;
 }
 
 static char *
@@ -575,10 +530,10 @@ theora_enc_get_supported_formats (void)
 {
   th_enc_ctx *encoder;
   th_info info;
-  static const struct
+  struct
   {
     th_pixel_fmt pixelformat;
-    const char fourcc[5];
+    const char *fourcc;
   } formats[] = {
     {
     TH_PF_420, "I420"}, {
@@ -618,68 +573,36 @@ theora_enc_get_supported_formats (void)
 static GstCaps *
 theora_enc_sink_getcaps (GstPad * pad)
 {
-  GstTheoraEnc *encoder;
-  GstPad *peer;
   GstCaps *caps;
+  char *supported_formats, *caps_string;
 
-  /* If we already have caps return them */
-  if (GST_PAD_CAPS (pad))
-    return gst_caps_ref (GST_PAD_CAPS (pad));
-
-  encoder = GST_THEORA_ENC (gst_pad_get_parent (pad));
-  if (!encoder)
+  supported_formats = theora_enc_get_supported_formats ();
+  if (!supported_formats) {
+    GST_WARNING ("no supported formats found. Encoder disabled?");
     return gst_caps_new_empty ();
-
-  peer = gst_pad_get_peer (encoder->srcpad);
-  if (peer) {
-    const GstCaps *templ_caps;
-    GstCaps *peer_caps, *tmp_caps;
-    GstStructure *s;
-    guint i, n;
-
-    peer_caps = gst_pad_get_caps (peer);
-
-    /* Translate peercaps to YUV */
-    peer_caps = gst_caps_make_writable (peer_caps);
-    n = gst_caps_get_size (peer_caps);
-    for (i = 0; i < n; i++) {
-      s = gst_caps_get_structure (peer_caps, i);
-
-      gst_structure_set_name (s, "video/x-raw-yuv");
-      gst_structure_remove_field (s, "streamheader");
-    }
-
-    templ_caps = gst_pad_get_pad_template_caps (pad);
-
-    tmp_caps = gst_caps_intersect (peer_caps, templ_caps);
-    caps = gst_caps_intersect (tmp_caps, theora_enc_src_caps);
-    gst_caps_unref (tmp_caps);
-    gst_caps_unref (peer_caps);
-    gst_object_unref (peer);
-    peer = NULL;
-  } else {
-    caps = gst_caps_ref (theora_enc_src_caps);
   }
 
-  gst_object_unref (encoder);
+  caps_string = g_strdup_printf ("video/x-raw-yuv, "
+      "format = (fourcc) { %s }, "
+      "framerate = (fraction) [1/MAX, MAX], "
+      "width = (int) [ 1, MAX ], " "height = (int) [ 1, MAX ]",
+      supported_formats);
+  caps = gst_caps_from_string (caps_string);
+  g_free (caps_string);
+  g_free (supported_formats);
+  GST_DEBUG ("Supported caps: %" GST_PTR_FORMAT, caps);
 
   return caps;
 }
 
 static gboolean
-theora_enc_sink_setcaps (GstPad * pad, GstCaps * caps)
+theora_enc_set_format (GstVideoEncoder * benc, GstVideoCodecState * state)
 {
-  GstStructure *structure = gst_caps_get_structure (caps, 0);
-  GstTheoraEnc *enc = GST_THEORA_ENC (gst_pad_get_parent (pad));
-  guint32 fourcc;
-  const GValue *par;
-  gint fps_n, fps_d;
-
-  gst_structure_get_fourcc (structure, "format", &fourcc);
-  gst_structure_get_int (structure, "width", &enc->width);
-  gst_structure_get_int (structure, "height", &enc->height);
-  gst_structure_get_fraction (structure, "framerate", &fps_n, &fps_d);
-  par = gst_structure_get_value (structure, "pixel-aspect-ratio");
+  GstTheoraEnc *enc = GST_THEORA_ENC (benc);
+  GstVideoInfo *info = &state->info;
+
+  enc->width = GST_VIDEO_INFO_WIDTH (info);
+  enc->height = GST_VIDEO_INFO_HEIGHT (info);
 
   th_info_clear (&enc->info);
   th_info_init (&enc->info);
@@ -689,38 +612,32 @@ theora_enc_sink_setcaps (GstPad * pad, GstCaps * caps)
   enc->info.frame_height = GST_ROUND_UP_16 (enc->height);
   enc->info.pic_width = enc->width;
   enc->info.pic_height = enc->height;
-  switch (fourcc) {
-    case GST_MAKE_FOURCC ('I', '4', '2', '0'):
+  switch (GST_VIDEO_INFO_FORMAT (info)) {
+    case GST_VIDEO_FORMAT_I420:
       enc->info.pixel_fmt = TH_PF_420;
       break;
-    case GST_MAKE_FOURCC ('Y', '4', '2', 'B'):
+    case GST_VIDEO_FORMAT_Y42B:
       enc->info.pixel_fmt = TH_PF_422;
       break;
-    case GST_MAKE_FOURCC ('Y', '4', '4', '4'):
+    case GST_VIDEO_FORMAT_Y444:
       enc->info.pixel_fmt = TH_PF_444;
       break;
     default:
       g_assert_not_reached ();
   }
 
-  enc->info.fps_numerator = enc->fps_n = fps_n;
-  enc->info.fps_denominator = enc->fps_d = fps_d;
-  if (par) {
-    enc->info.aspect_numerator = gst_value_get_fraction_numerator (par);
-    enc->par_n = gst_value_get_fraction_numerator (par);
-    enc->info.aspect_denominator = gst_value_get_fraction_denominator (par);
-    enc->par_d = gst_value_get_fraction_denominator (par);
-  } else {
-    /* setting them to 0 indicates that the decoder can chose a good aspect
-     * ratio, defaulting to 1/1 */
-    enc->info.aspect_numerator = 0;
-    enc->par_n = 1;
-    enc->info.aspect_denominator = 0;
-    enc->par_d = 1;
-  }
+  enc->info.fps_numerator = enc->fps_n = GST_VIDEO_INFO_FPS_N (info);
+  enc->info.fps_denominator = enc->fps_d = GST_VIDEO_INFO_FPS_D (info);
+  enc->info.aspect_numerator = GST_VIDEO_INFO_PAR_N (info);
+  enc->info.aspect_denominator = GST_VIDEO_INFO_PAR_D (info);
 
   enc->info.colorspace = TH_CS_UNSPECIFIED;
 
+  /* Save input state */
+  if (enc->input_state)
+    gst_video_codec_state_unref (enc->input_state);
+  enc->input_state = gst_video_codec_state_ref (state);
+
   /* as done in theora */
   enc->info.keyframe_granule_shift = _ilog (enc->keyframe_force - 1);
   GST_DEBUG_OBJECT (enc,
@@ -730,31 +647,40 @@ theora_enc_sink_setcaps (GstPad * pad, GstCaps * caps)
   theora_enc_reset (enc);
   enc->initialised = TRUE;
 
-  gst_object_unref (enc);
-
   return TRUE;
 }
 
-static guint64
-granulepos_add (guint64 granulepos, guint64 addend, gint shift)
+static GstFlowReturn
+theora_enc_pre_push (GstVideoEncoder * benc, GstVideoCodecFrame * frame)
 {
-  guint64 iframe, pframe;
+  GstTheoraEnc *enc = GST_THEORA_ENC (benc);
+  guint64 pfn;
 
-  iframe = granulepos >> shift;
-  pframe = granulepos - (iframe << shift);
-  iframe += addend;
-
-  return (iframe << shift) + pframe;
+  /* see ext/ogg/README; OFFSET_END takes "our" granulepos, OFFSET its
+   * time representation */
+  /* granulepos from sync frame */
+  pfn = frame->presentation_frame_number - frame->distance_from_sync;
+  /* correct to correspond to linear running time */
+  pfn -= enc->pfn_offset;
+  pfn += enc->granulepos_offset + 1;
+  /* granulepos */
+  GST_BUFFER_OFFSET_END (frame->output_buffer) =
+      (pfn << enc->info.keyframe_granule_shift) + frame->distance_from_sync;
+  GST_BUFFER_OFFSET (frame->output_buffer) = granulepos_to_timestamp (enc,
+      GST_BUFFER_OFFSET_END (frame->output_buffer));
+
+  return GST_FLOW_OK;
 }
 
-/* prepare a buffer for transmission by passing data through libtheora */
 static GstFlowReturn
-theora_buffer_from_packet (GstTheoraEnc * enc, ogg_packet * packet,
-    GstClockTime timestamp, GstClockTime running_time,
-    GstClockTime duration, GstBuffer ** buffer)
+theora_push_packet (GstTheoraEnc * enc, ogg_packet * packet)
 {
+  GstVideoEncoder *benc;
   GstBuffer *buf;
-  GstFlowReturn ret = GST_FLOW_OK;
+  GstFlowReturn ret;
+  GstVideoCodecFrame *frame;
+
+  benc = GST_VIDEO_ENCODER (enc);
 
   buf = gst_buffer_new_and_alloc (packet->bytes);
   if (!buf) {
@@ -764,73 +690,33 @@ theora_buffer_from_packet (GstTheoraEnc * enc, ogg_packet * packet,
   }
 
   memcpy (GST_BUFFER_DATA (buf), packet->packet, packet->bytes);
-  gst_buffer_set_caps (buf, GST_PAD_CAPS (enc->srcpad));
-  /* see ext/ogg/README; OFFSET_END takes "our" granulepos, OFFSET its
-   * time representation */
-  GST_BUFFER_OFFSET_END (buf) =
-      granulepos_add (packet->granulepos, enc->granulepos_offset,
-      enc->info.keyframe_granule_shift);
-  GST_BUFFER_OFFSET (buf) = granulepos_to_timestamp (enc,
-      GST_BUFFER_OFFSET_END (buf));
-
-  GST_BUFFER_TIMESTAMP (buf) = timestamp;
-  GST_BUFFER_DURATION (buf) = duration;
-
-  if (enc->next_discont) {
-    GST_BUFFER_FLAG_SET (buf, GST_BUFFER_FLAG_DISCONT);
-    enc->next_discont = FALSE;
-  }
 
-  /* th_packet_iskeyframe returns positive for keyframes */
-  if (th_packet_iskeyframe (packet) > 0) {
-    GST_BUFFER_FLAG_UNSET (buf, GST_BUFFER_FLAG_DELTA_UNIT);
+  frame = gst_video_encoder_get_oldest_frame (benc);
+  frame->output_buffer = buf;
+
+  /* the second most significant bit of the first data byte is cleared
+   * for keyframes */
+  if (packet->bytes > 0 && (packet->packet[0] & 0x40) == 0) {
+    GST_VIDEO_CODEC_FRAME_SET_SYNC_POINT (frame);
   } else {
-    GST_BUFFER_FLAG_SET (buf, GST_BUFFER_FLAG_DELTA_UNIT);
+    GST_VIDEO_CODEC_FRAME_UNSET_SYNC_POINT (frame);
   }
   enc->packetno++;
 
-done:
-  *buffer = buf;
-  return ret;
-}
-
-/* push out the buffer and do internal bookkeeping */
-static GstFlowReturn
-theora_push_buffer (GstTheoraEnc * enc, GstBuffer * buffer)
-{
-  GstFlowReturn ret;
-
-  enc->bytes_out += GST_BUFFER_SIZE (buffer);
-
-  ret = gst_pad_push (enc->srcpad, buffer);
-
-  return ret;
-}
-
-static GstFlowReturn
-theora_push_packet (GstTheoraEnc * enc, ogg_packet * packet,
-    GstClockTime timestamp, GstClockTime running_time, GstClockTime duration)
-{
-  GstBuffer *buf;
-  GstFlowReturn ret;
-
-  ret =
-      theora_buffer_from_packet (enc, packet, timestamp, running_time, duration,
-      &buf);
-  if (ret == GST_FLOW_OK)
-    ret = theora_push_buffer (enc, buf);
+  ret = gst_video_encoder_finish_frame (benc, frame);
 
+done:
   return ret;
 }
 
 static GstCaps *
-theora_set_header_on_caps (GstCaps * caps, GSList * buffers)
+theora_set_header_on_caps (GstCaps * caps, GList * buffers)
 {
   GstStructure *structure;
   GValue array = { 0 };
   GValue value = { 0 };
   GstBuffer *buffer;
-  GSList *walk;
+  GList *walk;
 
   caps = gst_caps_make_writable (caps);
   structure = gst_caps_get_structure (caps, 0);
@@ -864,154 +750,6 @@ theora_set_header_on_caps (GstCaps * caps, GSList * buffers)
 }
 
 static void
-theora_enc_force_keyframe (GstTheoraEnc * enc)
-{
-  GstClockTime next_ts;
-
-  /* make sure timestamps increment after resetting the decoder */
-  next_ts = enc->next_ts + enc->timestamp_offset;
-
-  theora_enc_reset (enc);
-  enc->granulepos_offset =
-      gst_util_uint64_scale (next_ts, enc->fps_n, GST_SECOND * enc->fps_d);
-  enc->timestamp_offset = next_ts;
-  enc->next_ts = 0;
-}
-
-static gboolean
-theora_enc_sink_event (GstPad * pad, GstEvent * event)
-{
-  GstTheoraEnc *enc;
-  ogg_packet op;
-  gboolean res;
-
-  enc = GST_THEORA_ENC (GST_PAD_PARENT (pad));
-
-  switch (GST_EVENT_TYPE (event)) {
-    case GST_EVENT_NEWSEGMENT:
-    {
-      gboolean update;
-      gdouble rate, applied_rate;
-      GstFormat format;
-      gint64 start, stop, time;
-
-      gst_event_parse_new_segment_full (event, &update, &rate, &applied_rate,
-          &format, &start, &stop, &time);
-
-      gst_segment_set_newsegment_full (&enc->segment, update, rate,
-          applied_rate, format, start, stop, time);
-
-      res = gst_pad_push_event (enc->srcpad, event);
-      break;
-    }
-    case GST_EVENT_EOS:
-      if (enc->initialised) {
-        /* push last packet with eos flag, should not be called */
-        while (th_encode_packetout (enc->encoder, 1, &op)) {
-          GstClockTime next_time =
-              th_granule_time (enc->encoder, op.granulepos) * GST_SECOND;
-
-          theora_push_packet (enc, &op, GST_CLOCK_TIME_NONE, enc->next_ts,
-              next_time - enc->next_ts);
-          enc->next_ts = next_time;
-        }
-      }
-      if (enc->initialised && enc->multipass_cache_fd
-          && enc->multipass_mode == MULTIPASS_MODE_FIRST_PASS)
-        theora_enc_write_multipass_cache (enc, TRUE, TRUE);
-
-      theora_enc_clear_multipass_cache (enc);
-
-      res = gst_pad_push_event (enc->srcpad, event);
-      break;
-    case GST_EVENT_FLUSH_STOP:
-      gst_segment_init (&enc->segment, GST_FORMAT_UNDEFINED);
-      res = gst_pad_push_event (enc->srcpad, event);
-      break;
-    case GST_EVENT_CUSTOM_DOWNSTREAM:
-    {
-      const GstStructure *s;
-
-      s = gst_event_get_structure (event);
-
-      if (gst_structure_has_name (s, "GstForceKeyUnit"))
-        theora_enc_force_keyframe (enc);
-      res = gst_pad_push_event (enc->srcpad, event);
-      break;
-    }
-    default:
-      res = gst_pad_push_event (enc->srcpad, event);
-      break;
-  }
-  return res;
-}
-
-static gboolean
-theora_enc_src_event (GstPad * pad, GstEvent * event)
-{
-  GstTheoraEnc *enc;
-  gboolean res = TRUE;
-
-  enc = GST_THEORA_ENC (GST_PAD_PARENT (pad));
-
-  switch (GST_EVENT_TYPE (event)) {
-    case GST_EVENT_CUSTOM_UPSTREAM:
-    {
-      const GstStructure *s;
-
-      s = gst_event_get_structure (event);
-
-      if (gst_structure_has_name (s, "GstForceKeyUnit")) {
-        GST_OBJECT_LOCK (enc);
-        enc->force_keyframe = TRUE;
-        GST_OBJECT_UNLOCK (enc);
-        /* consume the event */
-        res = TRUE;
-        gst_event_unref (event);
-      } else {
-        res = gst_pad_push_event (enc->sinkpad, event);
-      }
-      break;
-    }
-    default:
-      res = gst_pad_push_event (enc->sinkpad, event);
-      break;
-  }
-
-  return res;
-}
-
-static gboolean
-theora_enc_is_discontinuous (GstTheoraEnc * enc, GstClockTime timestamp,
-    GstClockTime duration)
-{
-  GstClockTimeDiff max_diff;
-  gboolean ret = FALSE;
-
-  /* Allow 3/4 a frame off */
-  max_diff = (enc->info.fps_denominator * GST_SECOND * 3) /
-      (enc->info.fps_numerator * 4);
-
-  if (timestamp != GST_CLOCK_TIME_NONE
-      && enc->expected_ts != GST_CLOCK_TIME_NONE) {
-    if ((GstClockTimeDiff) (timestamp - enc->expected_ts) > max_diff) {
-      GST_DEBUG_OBJECT (enc, "Incoming TS %" GST_TIME_FORMAT
-          " exceeds expected value %" GST_TIME_FORMAT
-          " by too much, marking discontinuity",
-          GST_TIME_ARGS (timestamp), GST_TIME_ARGS (enc->expected_ts));
-      ret = TRUE;
-    }
-  }
-
-  if (GST_CLOCK_TIME_IS_VALID (duration))
-    enc->expected_ts = timestamp + duration;
-  else
-    enc->expected_ts = GST_CLOCK_TIME_NONE;
-
-  return ret;
-}
-
-static void
 theora_enc_init_buffer (th_ycbcr_buffer buf, th_info * info, guint8 * data)
 {
   GstVideoFormat format;
@@ -1057,8 +795,7 @@ theora_enc_read_multipass_cache (GstTheoraEnc * enc)
 {
   GstBuffer *cache_buf;
   const guint8 *cache_data;
-  gsize bytes_read = 0;
-  gint bytes_consumed = 0;
+  gsize bytes_read = 0, bytes_consumed = 0;
   GIOStatus stat = G_IO_STATUS_NORMAL;
   gboolean done = FALSE;
 
@@ -1127,7 +864,7 @@ theora_enc_write_multipass_cache (GstTheoraEnc * enc, gboolean begin,
 
   }
 
-  if (stat == G_IO_STATUS_ERROR || bytes_read < 0) {
+  if (stat == G_IO_STATUS_ERROR || bytes_read < 0 || bytes_written < 0) {
     if (begin) {
       if (eos)
         GST_ELEMENT_WARNING (enc, RESOURCE, WRITE, (NULL),
@@ -1149,112 +886,57 @@ theora_enc_write_multipass_cache (GstTheoraEnc * enc, gboolean begin,
   return TRUE;
 }
 
-static GstFlowReturn
-theora_enc_encode_and_push (GstTheoraEnc * enc, ogg_packet op,
-    GstClockTime timestamp, GstClockTime running_time,
-    GstClockTime duration, GstBuffer * buffer)
+static void
+theora_enc_reset_ts (GstTheoraEnc * enc, GstClockTime running_time, gint pfn)
 {
-  GstFlowReturn ret;
-  th_ycbcr_buffer ycbcr;
-  gint res;
-
-  theora_enc_init_buffer (ycbcr, &enc->info, GST_BUFFER_DATA (buffer));
-
-  if (theora_enc_is_discontinuous (enc, running_time, duration)) {
-    theora_enc_reset (enc);
-    enc->granulepos_offset =
-        gst_util_uint64_scale (running_time, enc->fps_n,
-        GST_SECOND * enc->fps_d);
-    enc->timestamp_offset = running_time;
-    enc->next_ts = 0;
-    enc->next_discont = TRUE;
-  }
-
-  if (enc->multipass_cache_fd
-      && enc->multipass_mode == MULTIPASS_MODE_SECOND_PASS) {
-    if (!theora_enc_read_multipass_cache (enc)) {
-      ret = GST_FLOW_ERROR;
-      goto multipass_read_failed;
-    }
-  }
-
-  res = th_encode_ycbcr_in (enc->encoder, ycbcr);
-  /* none of the failure cases can happen here */
-  g_assert (res == 0);
-
-  if (enc->multipass_cache_fd
-      && enc->multipass_mode == MULTIPASS_MODE_FIRST_PASS) {
-    if (!theora_enc_write_multipass_cache (enc, FALSE, FALSE)) {
-      ret = GST_FLOW_ERROR;
-      goto multipass_write_failed;
-    }
-  }
-
-  ret = GST_FLOW_OK;
-  while (th_encode_packetout (enc->encoder, 0, &op)) {
-    GstClockTime next_time;
-
-    next_time = th_granule_time (enc->encoder, op.granulepos) * GST_SECOND;
-
-    ret =
-        theora_push_packet (enc, &op, timestamp, enc->next_ts,
-        next_time - enc->next_ts);
-
-    enc->next_ts = next_time;
-    if (ret != GST_FLOW_OK)
-      goto data_push;
-  }
-  gst_buffer_unref (buffer);
-
-  return ret;
+  enc->granulepos_offset =
+      gst_util_uint64_scale (running_time, enc->fps_n, GST_SECOND * enc->fps_d);
+  enc->timestamp_offset = running_time;
+  enc->pfn_offset = pfn;
+}
 
-  /* ERRORS */
-multipass_read_failed:
-  {
-    gst_buffer_unref (buffer);
-    return ret;
-  }
-multipass_write_failed:
-  {
-    gst_buffer_unref (buffer);
-    return ret;
-  }
-data_push:
-  {
-    gst_buffer_unref (buffer);
-    return ret;
-  }
+static GstBuffer *
+theora_enc_buffer_from_header_packet (GstTheoraEnc * enc, ogg_packet * packet)
+{
+  GstBuffer *outbuf;
+
+  outbuf = gst_buffer_new_and_alloc (packet->bytes);
+  memcpy (GST_BUFFER_DATA (outbuf), packet->packet, packet->bytes);
+  GST_BUFFER_OFFSET (outbuf) = 0;
+  GST_BUFFER_OFFSET_END (outbuf) = 0;
+  GST_BUFFER_TIMESTAMP (outbuf) = GST_CLOCK_TIME_NONE;
+  GST_BUFFER_DURATION (outbuf) = GST_CLOCK_TIME_NONE;
+
+  GST_DEBUG ("created header packet buffer, %d bytes",
+      GST_BUFFER_SIZE (outbuf));
+  return outbuf;
 }
 
 static GstFlowReturn
-theora_enc_chain (GstPad * pad, GstBuffer * buffer)
+theora_enc_handle_frame (GstVideoEncoder * benc, GstVideoCodecFrame * frame)
 {
   GstTheoraEnc *enc;
   ogg_packet op;
-  GstClockTime timestamp, duration, running_time;
+  GstClockTime timestamp, running_time;
   GstFlowReturn ret;
   gboolean force_keyframe;
 
-  enc = GST_THEORA_ENC (GST_PAD_PARENT (pad));
+  enc = GST_THEORA_ENC (benc);
 
   /* we keep track of two timelines.
-   * - The timestamps from the incoming buffers, which we copy to the outgoing
+   * - The timestamps from the incomming buffers, which we copy to the outgoing
    *   encoded buffers as-is. We need to do this as we simply forward the
    *   newsegment events.
    * - The running_time of the buffers, which we use to construct the granulepos
    *   in the packets.
    */
-  timestamp = GST_BUFFER_TIMESTAMP (buffer);
-  duration = GST_BUFFER_DURATION (buffer);
+  timestamp = frame->pts;
 
+  /* incoming buffers are clipped, so this should be positive */
   running_time =
-      gst_segment_to_running_time (&enc->segment, GST_FORMAT_TIME, timestamp);
-  if ((gint64) running_time < 0) {
-    GST_DEBUG_OBJECT (enc, "Dropping buffer, timestamp: %" GST_TIME_FORMAT,
-        GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (buffer)));
-    gst_buffer_unref (buffer);
-    return GST_FLOW_OK;
-  }
+      gst_segment_to_running_time (&GST_VIDEO_ENCODER_INPUT_SEGMENT (enc),
+      GST_FORMAT_TIME, timestamp);
+  g_return_val_if_fail (running_time >= 0 || timestamp < 0, GST_FLOW_ERROR);
 
   GST_OBJECT_LOCK (enc);
   if (enc->bitrate_changed) {
@@ -1274,40 +956,16 @@ theora_enc_chain (GstPad * pad, GstBuffer * buffer)
   }
 
   /* see if we need to schedule a keyframe */
-  force_keyframe = enc->force_keyframe;
-  enc->force_keyframe = FALSE;
+  force_keyframe = GST_VIDEO_CODEC_FRAME_IS_FORCE_KEYFRAME (frame);
   GST_OBJECT_UNLOCK (enc);
 
-  if (force_keyframe) {
-    GstClockTime stream_time;
-    GstStructure *s;
-
-    stream_time = gst_segment_to_stream_time (&enc->segment,
-        GST_FORMAT_TIME, timestamp);
-
-    s = gst_structure_new ("GstForceKeyUnit",
-        "timestamp", G_TYPE_UINT64, timestamp,
-        "stream-time", G_TYPE_UINT64, stream_time,
-        "running-time", G_TYPE_UINT64, running_time, NULL);
-
-    theora_enc_force_keyframe (enc);
-
-    gst_pad_push_event (enc->srcpad,
-        gst_event_new_custom (GST_EVENT_CUSTOM_DOWNSTREAM, s));
-  }
-
-  /* make sure we copy the discont flag to the next outgoing buffer when it's
-   * set on the incoming buffer */
-  if (GST_BUFFER_IS_DISCONT (buffer)) {
-    enc->next_discont = TRUE;
-  }
-
   if (enc->packetno == 0) {
     /* no packets written yet, setup headers */
     GstCaps *caps;
     GstBuffer *buf;
-    GSList *buffers = NULL;
+    GList *buffers = NULL;
     int result;
+    GstVideoCodecState *state;
 
     enc->granulepos_offset = 0;
     enc->timestamp_offset = 0;
@@ -1326,162 +984,116 @@ theora_enc_chain (GstPad * pad, GstBuffer * buffer)
 
     while ((result =
             th_encode_flushheader (enc->encoder, &enc->comment, &op)) > 0) {
-      ret =
-          theora_buffer_from_packet (enc, &op, GST_CLOCK_TIME_NONE,
-          GST_CLOCK_TIME_NONE, GST_CLOCK_TIME_NONE, &buf);
-      if (ret != GST_FLOW_OK) {
-        goto header_buffer_alloc;
-      }
-      buffers = g_slist_prepend (buffers, buf);
+      buf = theora_enc_buffer_from_header_packet (enc, &op);
+      buffers = g_list_prepend (buffers, buf);
     }
     if (result < 0) {
-      g_slist_foreach (buffers, (GFunc) gst_buffer_unref, NULL);
-      g_slist_free (buffers);
+      g_list_foreach (buffers, (GFunc) gst_buffer_unref, NULL);
+      g_list_free (buffers);
       goto encoder_disabled;
     }
 
-    buffers = g_slist_reverse (buffers);
+    buffers = g_list_reverse (buffers);
 
     /* mark buffers and put on caps */
-    caps = gst_caps_new_simple ("video/x-theora",
-        "width", G_TYPE_INT, enc->width,
-        "height", G_TYPE_INT, enc->height,
-        "framerate", GST_TYPE_FRACTION, enc->fps_n, enc->fps_d,
-        "pixel-aspect-ratio", GST_TYPE_FRACTION, enc->par_n, enc->par_d, NULL);
+    caps = gst_caps_new_simple ("video/x-theora", NULL);
     caps = theora_set_header_on_caps (caps, buffers);
-    GST_DEBUG ("here are the caps: %" GST_PTR_FORMAT, caps);
-    gst_pad_set_caps (enc->srcpad, caps);
+    state = gst_video_encoder_set_output_state (benc, caps, enc->input_state);
+
+    GST_DEBUG ("here are the caps: %" GST_PTR_FORMAT, state->caps);
+
+    gst_video_codec_state_unref (state);
 
-    g_slist_foreach (buffers, (GFunc) gst_buffer_set_caps, caps);
+    gst_video_encoder_set_headers (benc, buffers);
 
-    gst_caps_unref (caps);
+    theora_enc_reset_ts (enc, running_time, frame->presentation_frame_number);
+  }
+
+  {
+    th_ycbcr_buffer ycbcr;
+    gint res;
 
-    /* push out the header buffers */
-    while (buffers) {
-      buf = buffers->data;
-      buffers = g_slist_delete_link (buffers, buffers);
-      if ((ret = theora_push_buffer (enc, buf)) != GST_FLOW_OK) {
-        g_slist_foreach (buffers, (GFunc) gst_buffer_unref, NULL);
-        g_slist_free (buffers);
-        goto header_push;
+    theora_enc_init_buffer (ycbcr, &enc->info,
+        GST_BUFFER_DATA (frame->input_buffer));
+
+    if (force_keyframe) {
+      theora_enc_reset (enc);
+      theora_enc_reset_ts (enc, running_time, frame->presentation_frame_number);
+    }
+
+    if (enc->multipass_cache_fd
+        && enc->multipass_mode == MULTIPASS_MODE_SECOND_PASS) {
+      if (!theora_enc_read_multipass_cache (enc)) {
+        ret = GST_FLOW_ERROR;
+        goto multipass_read_failed;
       }
     }
 
-    enc->granulepos_offset =
-        gst_util_uint64_scale (running_time, enc->fps_n,
-        GST_SECOND * enc->fps_d);
-    enc->timestamp_offset = running_time;
-    enc->next_ts = 0;
-  }
+    res = th_encode_ycbcr_in (enc->encoder, ycbcr);
+    /* none of the failure cases can happen here */
+    g_assert (res == 0);
 
-  ret = theora_enc_encode_and_push (enc, op, timestamp, running_time, duration,
-      buffer);
+    if (enc->multipass_cache_fd
+        && enc->multipass_mode == MULTIPASS_MODE_FIRST_PASS) {
+      if (!theora_enc_write_multipass_cache (enc, FALSE, FALSE)) {
+        ret = GST_FLOW_ERROR;
+        goto multipass_write_failed;
+      }
+    }
 
+    ret = GST_FLOW_OK;
+    while (th_encode_packetout (enc->encoder, 0, &op)) {
+      ret = theora_push_packet (enc, &op);
+      if (ret != GST_FLOW_OK)
+        goto beach;
+    }
+  }
+
+beach:
+  gst_video_codec_frame_unref (frame);
   return ret;
 
   /* ERRORS */
-header_buffer_alloc:
+multipass_read_failed:
   {
-    gst_buffer_unref (buffer);
+    gst_video_codec_frame_unref (frame);
     return ret;
   }
-header_push:
+multipass_write_failed:
   {
-    gst_buffer_unref (buffer);
+    gst_video_codec_frame_unref (frame);
     return ret;
   }
 encoder_disabled:
   {
+    gst_video_codec_frame_unref (frame);
     GST_ELEMENT_ERROR (enc, STREAM, ENCODE, (NULL),
         ("libtheora has been compiled with the encoder disabled"));
-    gst_buffer_unref (buffer);
     return GST_FLOW_ERROR;
   }
 }
 
-static GstStateChangeReturn
-theora_enc_change_state (GstElement * element, GstStateChange transition)
+static gboolean
+theora_enc_finish (GstVideoEncoder * benc)
 {
   GstTheoraEnc *enc;
-  GstStateChangeReturn ret;
-  th_enc_ctx *th_ctx;
-
-  enc = GST_THEORA_ENC (element);
-
-  switch (transition) {
-    case GST_STATE_CHANGE_NULL_TO_READY:
-      th_ctx = dummy_encode_ctx ();
-      if (!th_ctx) {
-        GST_ELEMENT_ERROR (enc, STREAM, ENCODE, (NULL),
-            ("libtheora has been compiled with the encoder disabled"));
-        return GST_STATE_CHANGE_FAILURE;
-      }
-      th_encode_free (th_ctx);
-      break;
-    case GST_STATE_CHANGE_READY_TO_PAUSED:
-      GST_DEBUG_OBJECT (enc, "READY->PAUSED Initing theora state");
-      th_info_init (&enc->info);
-      th_comment_init (&enc->comment);
-      enc->packetno = 0;
-      enc->force_keyframe = FALSE;
-
-      if (enc->multipass_mode >= MULTIPASS_MODE_FIRST_PASS) {
-        GError *err = NULL;
-
-        if (!enc->multipass_cache_file) {
-          ret = GST_STATE_CHANGE_FAILURE;
-          GST_ELEMENT_ERROR (enc, LIBRARY, SETTINGS, (NULL), (NULL));
-          return ret;
-        }
-        enc->multipass_cache_fd =
-            g_io_channel_new_file (enc->multipass_cache_file,
-            (enc->multipass_mode == MULTIPASS_MODE_FIRST_PASS ? "w" : "r"),
-            &err);
-
-        if (enc->multipass_mode == MULTIPASS_MODE_SECOND_PASS)
-          enc->multipass_cache_adapter = gst_adapter_new ();
-
-        if (!enc->multipass_cache_fd) {
-          ret = GST_STATE_CHANGE_FAILURE;
-          GST_ELEMENT_ERROR (enc, RESOURCE, OPEN_READ, (NULL),
-              ("Failed to open multipass cache file: %s", err->message));
-          g_error_free (err);
-          return ret;
-        }
-
-        g_io_channel_set_encoding (enc->multipass_cache_fd, NULL, NULL);
-      }
-      break;
-    case GST_STATE_CHANGE_PAUSED_TO_PLAYING:
-      break;
-    default:
-      break;
-  }
-
-  ret = parent_class->change_state (element, transition);
+  ogg_packet op;
 
-  switch (transition) {
-    case GST_STATE_CHANGE_PLAYING_TO_PAUSED:
-      break;
-    case GST_STATE_CHANGE_PAUSED_TO_READY:
-      GST_DEBUG_OBJECT (enc, "PAUSED->READY Clearing theora state");
-      if (enc->encoder) {
-        th_encode_free (enc->encoder);
-        enc->encoder = NULL;
-      }
-      th_comment_clear (&enc->comment);
-      th_info_clear (&enc->info);
+  enc = GST_THEORA_ENC (benc);
 
-      theora_enc_clear (enc);
-      enc->initialised = FALSE;
-      break;
-    case GST_STATE_CHANGE_READY_TO_NULL:
-      break;
-    default:
-      break;
+  if (enc->initialised) {
+    /* push last packet with eos flag, should not be called */
+    while (th_encode_packetout (enc->encoder, 1, &op)) {
+      theora_push_packet (enc, &op);
+    }
   }
+  if (enc->initialised && enc->multipass_cache_fd
+      && enc->multipass_mode == MULTIPASS_MODE_FIRST_PASS)
+    theora_enc_write_multipass_cache (enc, TRUE, TRUE);
 
-  return ret;
+  theora_enc_clear_multipass_cache (enc);
+
+  return TRUE;
 }
 
 static void
@@ -1499,18 +1111,17 @@ theora_enc_set_property (GObject * object, guint prop_id,
     case PROP_NOISE_SENSITIVITY:
     case PROP_SHARPNESS:
       /* kept for API compat, but ignored */
-      GST_WARNING_OBJECT (object, "Obsolete property '%s' ignored",
-          pspec->name);
       break;
     case PROP_BITRATE:
       GST_OBJECT_LOCK (enc);
       enc->video_bitrate = g_value_get_int (value) * 1000;
+      enc->video_quality = 0;
       enc->bitrate_changed = TRUE;
       GST_OBJECT_UNLOCK (enc);
       break;
     case PROP_QUALITY:
       GST_OBJECT_LOCK (enc);
-      if (GST_STATE (enc) >= GST_STATE_PAUSED && enc->video_bitrate > 0) {
+      if (GST_STATE (enc) >= GST_STATE_PAUSED && enc->video_quality == 0) {
         GST_WARNING_OBJECT (object, "Can't change from bitrate to quality mode"
             " while playing");
       } else {
@@ -1531,10 +1142,6 @@ theora_enc_set_property (GObject * object, guint prop_id,
       break;
     case PROP_SPEEDLEVEL:
       enc->speed_level = g_value_get_int (value);
-      if (enc->encoder) {
-        th_encode_ctl (enc->encoder, TH_ENCCTL_SET_SPLEVEL, &enc->speed_level,
-            sizeof (enc->speed_level));
-      }
       break;
     case PROP_VP3_COMPATIBLE:
       enc->vp3_compatible = g_value_get_boolean (value);
@@ -1639,3 +1246,10 @@ theora_enc_get_property (GObject * object, guint prop_id,
       break;
   }
 }
+
+gboolean
+gst_theora_enc_register (GstPlugin * plugin)
+{
+  return gst_element_register (plugin, "theoraenc",
+      GST_RANK_PRIMARY, GST_TYPE_THEORA_ENC);
+}
diff --git a/ext/theora/gsttheoraenc.h b/ext/theora/gsttheoraenc.h
index 69d4050..92d943d 100644
--- a/ext/theora/gsttheoraenc.h
+++ b/ext/theora/gsttheoraenc.h
@@ -1,5 +1,8 @@
 /* GStreamer
  * Copyright (C) 2004 Wim Taymans <wim@fluendo.com>
+ * Copyright (c) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
+ *      Author : Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>
  *
  * This library is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Library General Public
@@ -22,6 +25,7 @@
 
 #include <gst/gst.h>
 #include <gst/base/gstadapter.h>
+#include <gst/video/gstvideoencoder.h>
 #include <theora/theoraenc.h>
 
 G_BEGIN_DECLS
@@ -77,12 +81,7 @@ typedef enum
  */
 struct _GstTheoraEnc
 {
-  GstElement element;
-
-  GstPad *sinkpad;
-  GstPad *srcpad;
-
-  GstSegment segment;
+  GstVideoEncoder element;
 
   ogg_stream_state to;
 
@@ -99,21 +98,16 @@ struct _GstTheoraEnc
   gint keyframe_freq;
   gint keyframe_force;
 
-  gint info_width, info_height;
+  GstVideoCodecState *input_state;
+
   gint width, height;
   gint fps_n, fps_d;
-  gint par_n, par_d;
-  GstClockTime next_ts;
-
-  GstClockTime expected_ts;
-  gboolean next_discont;
-
-  gboolean force_keyframe;
 
   guint packetno;
   guint64 bytes_out;
   guint64 granulepos_offset;
   guint64 timestamp_offset;
+  guint64 pfn_offset;
 
   gint speed_level;
   gboolean vp3_compatible;
@@ -130,10 +124,11 @@ struct _GstTheoraEnc
 
 struct _GstTheoraEncClass
 {
-  GstElementClass parent_class;
+  GstVideoEncoderClass parent_class;
 };
 
 GType gst_theora_enc_get_type (void);
+gboolean gst_theora_enc_register (GstPlugin * plugin);
 
 G_END_DECLS
 
diff --git a/ext/theora/gsttheoraparse.c b/ext/theora/gsttheoraparse.c
index 4e356c6..ed5e934 100644
--- a/ext/theora/gsttheoraparse.c
+++ b/ext/theora/gsttheoraparse.c
@@ -56,6 +56,10 @@
  * Last reviewed on 2008-05-28 (0.10.20)
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #  include "config.h"
 #endif
diff --git a/ext/vorbis/Makefile.in b/ext/vorbis/Makefile.in
index d98ae76..6b27631 100644
--- a/ext/vorbis/Makefile.in
+++ b/ext/vorbis/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,11 +51,12 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 @USE_VORBIS_TRUE@am__append_1 = libgstvorbis.la
 @USE_IVORBIS_TRUE@am__append_2 = libgstivorbisdec.la
 subdir = ext/vorbis
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -128,6 +145,7 @@ libgstivorbisdec_la_OBJECTS = $(am_libgstivorbisdec_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstivorbisdec_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstivorbisdec_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstivorbisdec_la_CFLAGS) $(CFLAGS) \
@@ -154,6 +172,18 @@ libgstvorbis_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(CCLD) $(libgstvorbis_la_CFLAGS) $(CFLAGS) \
 	$(libgstvorbis_la_LDFLAGS) $(LDFLAGS) -o $@
 @USE_VORBIS_TRUE@am_libgstvorbis_la_rpath = -rpath $(plugindir)
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -166,23 +196,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstivorbisdec_la_SOURCES) $(libgstvorbis_la_SOURCES)
 DIST_SOURCES = $(am__libgstivorbisdec_la_SOURCES_DIST) \
 	$(am__libgstvorbis_la_SOURCES_DIST)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -475,7 +506,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -556,7 +591,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -564,6 +598,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -579,12 +615,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstivorbisdec.la: $(libgstivorbisdec_la_OBJECTS) $(libgstivorbisdec_la_DEPENDENCIES) $(EXTRA_libgstivorbisdec_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstivorbisdec_la_LINK) $(am_libgstivorbisdec_la_rpath) $(libgstivorbisdec_la_OBJECTS) $(libgstivorbisdec_la_LIBADD) $(LIBS)
 libgstvorbis.la: $(libgstvorbis_la_OBJECTS) $(libgstvorbis_la_DEPENDENCIES) $(EXTRA_libgstvorbis_la_DEPENDENCIES) 
@@ -761,6 +799,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -905,18 +957,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/ext/vorbis/gstvorbisdec.c b/ext/vorbis/gstvorbisdec.c
index f476d45..99df68d 100644
--- a/ext/vorbis/gstvorbisdec.c
+++ b/ext/vorbis/gstvorbisdec.c
@@ -128,14 +128,6 @@ vorbis_dec_finalize (GObject * object)
   G_OBJECT_CLASS (parent_class)->finalize (object);
 }
 
-static void
-gst_vorbis_dec_reset (GstVorbisDec * dec)
-{
-  if (dec->taglist)
-    gst_tag_list_free (dec->taglist);
-  dec->taglist = NULL;
-}
-
 static gboolean
 vorbis_dec_start (GstAudioDecoder * dec)
 {
@@ -145,7 +137,6 @@ vorbis_dec_start (GstAudioDecoder * dec)
   vorbis_info_init (&vd->vi);
   vorbis_comment_init (&vd->vc);
   vd->initialized = FALSE;
-  gst_vorbis_dec_reset (vd);
 
   return TRUE;
 }
@@ -163,7 +154,6 @@ vorbis_dec_stop (GstAudioDecoder * dec)
   vorbis_dsp_clear (&vd->vd);
   vorbis_comment_clear (&vd->vc);
   vorbis_info_clear (&vd->vi);
-  gst_vorbis_dec_reset (vd);
 
   return TRUE;
 }
@@ -308,7 +298,7 @@ vorbis_handle_comment_packet (GstVorbisDec * vd, ogg_packet * packet)
 {
   guint bitrate = 0;
   gchar *encoder = NULL;
-  GstTagList *list, *old_list;
+  GstTagList *list;
   GstBuffer *buf;
 
   GST_DEBUG_OBJECT (vd, "parsing comment packet");
@@ -321,58 +311,53 @@ vorbis_handle_comment_packet (GstVorbisDec * vd, ogg_packet * packet)
       gst_tag_list_from_vorbiscomment_buffer (buf, (guint8 *) "\003vorbis", 7,
       &encoder);
 
-  old_list = vd->taglist;
-  vd->taglist = gst_tag_list_merge (vd->taglist, list, GST_TAG_MERGE_REPLACE);
+  if (!list) {
+    GST_ERROR_OBJECT (vd, "couldn't decode comments");
+    list = gst_tag_list_new ();
+  }
 
-  if (old_list)
-    gst_tag_list_free (old_list);
-  gst_tag_list_free (list);
   gst_buffer_unref (buf);
 
-  if (!vd->taglist) {
-    GST_ERROR_OBJECT (vd, "couldn't decode comments");
-    vd->taglist = gst_tag_list_new ();
-  }
   if (encoder) {
     if (encoder[0])
-      gst_tag_list_add (vd->taglist, GST_TAG_MERGE_REPLACE,
+      gst_tag_list_add (list, GST_TAG_MERGE_REPLACE,
           GST_TAG_ENCODER, encoder, NULL);
     g_free (encoder);
   }
-  gst_tag_list_add (vd->taglist, GST_TAG_MERGE_REPLACE,
+  gst_tag_list_add (list, GST_TAG_MERGE_REPLACE,
       GST_TAG_ENCODER_VERSION, vd->vi.version,
       GST_TAG_AUDIO_CODEC, "Vorbis", NULL);
   if (vd->vi.bitrate_nominal > 0 && vd->vi.bitrate_nominal <= 0x7FFFFFFF) {
-    gst_tag_list_add (vd->taglist, GST_TAG_MERGE_REPLACE,
+    gst_tag_list_add (list, GST_TAG_MERGE_REPLACE,
         GST_TAG_NOMINAL_BITRATE, (guint) vd->vi.bitrate_nominal, NULL);
     bitrate = vd->vi.bitrate_nominal;
   }
   if (vd->vi.bitrate_upper > 0 && vd->vi.bitrate_upper <= 0x7FFFFFFF) {
-    gst_tag_list_add (vd->taglist, GST_TAG_MERGE_REPLACE,
+    gst_tag_list_add (list, GST_TAG_MERGE_REPLACE,
         GST_TAG_MAXIMUM_BITRATE, (guint) vd->vi.bitrate_upper, NULL);
     if (!bitrate)
       bitrate = vd->vi.bitrate_upper;
   }
   if (vd->vi.bitrate_lower > 0 && vd->vi.bitrate_lower <= 0x7FFFFFFF) {
-    gst_tag_list_add (vd->taglist, GST_TAG_MERGE_REPLACE,
+    gst_tag_list_add (list, GST_TAG_MERGE_REPLACE,
         GST_TAG_MINIMUM_BITRATE, (guint) vd->vi.bitrate_lower, NULL);
     if (!bitrate)
       bitrate = vd->vi.bitrate_lower;
   }
   if (bitrate) {
-    gst_tag_list_add (vd->taglist, GST_TAG_MERGE_REPLACE,
+    gst_tag_list_add (list, GST_TAG_MERGE_REPLACE,
         GST_TAG_BITRATE, (guint) bitrate, NULL);
   }
 
+  gst_audio_decoder_merge_tags (GST_AUDIO_DECODER_CAST (vd), list,
+      GST_TAG_MERGE_REPLACE);
   if (vd->initialized) {
-    gst_element_found_tags_for_pad (GST_ELEMENT_CAST (vd),
-        GST_AUDIO_DECODER_SRC_PAD (vd), vd->taglist);
-    vd->taglist = NULL;
+    gst_tag_list_free (list);
   } else {
     /* Only post them as messages for the time being. *
      * They will be pushed on the pad once the decoder is initialized */
     gst_element_post_message (GST_ELEMENT_CAST (vd),
-        gst_message_new_tag (GST_OBJECT (vd), gst_tag_list_copy (vd->taglist)));
+        gst_message_new_tag (GST_OBJECT (vd), list));
   }
 
   return GST_FLOW_OK;
@@ -398,12 +383,6 @@ vorbis_handle_type_packet (GstVorbisDec * vd)
 
   vd->initialized = TRUE;
 
-  if (vd->taglist) {
-    /* The tags have already been sent on the bus as messages. */
-    gst_pad_push_event (GST_AUDIO_DECODER_SRC_PAD (vd),
-        gst_event_new_tag (vd->taglist));
-    vd->taglist = NULL;
-  }
   return GST_FLOW_OK;
 
   /* ERRORS */
@@ -540,7 +519,7 @@ vorbis_handle_data_packet (GstVorbisDec * vd, ogg_packet * packet,
 #endif
   guint sample_count;
   GstBuffer *out = NULL;
-  GstFlowReturn result;
+  GstFlowReturn result, newresult;
   gint size;
 
   if (G_UNLIKELY (!vd->initialized)) {
@@ -611,7 +590,9 @@ vorbis_handle_data_packet (GstVorbisDec * vd, ogg_packet * packet,
 
 done:
   /* whether or not data produced, consume one frame and advance time */
-  result = gst_audio_decoder_finish_frame (GST_AUDIO_DECODER (vd), out, 1);
+  newresult = gst_audio_decoder_finish_frame (GST_AUDIO_DECODER (vd), out, 1);
+  if (G_UNLIKELY (newresult != GST_FLOW_OK))
+    result = newresult;
 
 #ifdef USE_TREMOLO
   vorbis_dsp_read (&vd->vd, sample_count);
@@ -723,12 +704,9 @@ empty_header:
 static void
 vorbis_dec_flush (GstAudioDecoder * dec, gboolean hard)
 {
+#ifdef HAVE_VORBIS_SYNTHESIS_RESTART
   GstVorbisDec *vd = GST_VORBIS_DEC (dec);
 
-#ifdef HAVE_VORBIS_SYNTHESIS_RESTART
   vorbis_synthesis_restart (&vd->vd);
 #endif
-
-  if (hard)
-    gst_vorbis_dec_reset (vd);
 }
diff --git a/ext/vorbis/gstvorbisdec.h b/ext/vorbis/gstvorbisdec.h
index 56f9ca4..712e50e 100644
--- a/ext/vorbis/gstvorbisdec.h
+++ b/ext/vorbis/gstvorbisdec.h
@@ -64,8 +64,6 @@ struct _GstVorbisDec {
   gboolean          initialized;
   guint             width;
 
-  GstTagList       *taglist;
-
   CopySampleFunc    copy_samples;
 };
 
diff --git a/ext/vorbis/gstvorbisdeclib.h b/ext/vorbis/gstvorbisdeclib.h
index ca00af9..ffb10bc 100644
--- a/ext/vorbis/gstvorbisdeclib.h
+++ b/ext/vorbis/gstvorbisdeclib.h
@@ -29,11 +29,6 @@
 
 #ifndef TREMOR
 
-#include <vorbis/codec.h>
-
-typedef float                          vorbis_sample_t;
-typedef ogg_packet                     ogg_packet_wrapper;
-
 #define GST_VORBIS_DEC_DESCRIPTION "decode raw vorbis streams to float audio"
 
 #define GST_VORBIS_DEC_SRC_CAPS \
@@ -45,7 +40,38 @@ typedef ogg_packet                     ogg_packet_wrapper;
 
 #define GST_VORBIS_DEC_DEFAULT_SAMPLE_WIDTH           (32)
 
-#define GST_VORBIS_DEC_GLIB_TYPE_NAME      GstVorbisDec
+#else /* TREMOR */
+
+#define GST_VORBIS_DEC_DESCRIPTION "decode raw vorbis streams to integer audio"
+
+#define GST_VORBIS_DEC_SRC_CAPS \
+    GST_STATIC_CAPS ("audio/x-raw-int, "   \
+        "rate = (int) [ 1, MAX ], "        \
+        "channels = (int) [ 1, 6 ], "      \
+        "endianness = (int) BYTE_ORDER, "  \
+        "width = (int) { 16, 32 }, "       \
+        "depth = (int) 16, "               \
+        "signed = (boolean) true")
+
+#define GST_VORBIS_DEC_DEFAULT_SAMPLE_WIDTH           (16)
+
+/* we need a different type name here */
+#define GstVorbisDec GstIVorbisDec
+#define GstVorbisDecClass GstIVorbisDecClass
+
+#endif /* TREMOR */
+
+#ifndef USE_TREMOLO
+
+#ifdef TREMOR
+ #include <tremor/ivorbiscodec.h>
+ typedef ogg_int32_t                    vorbis_sample_t;
+#else
+ #include <vorbis/codec.h>
+ typedef float                          vorbis_sample_t;
+#endif
+
+typedef ogg_packet                     ogg_packet_wrapper;
 
 static inline guint8 *
 gst_ogg_packet_data (ogg_packet * p)
@@ -72,17 +98,11 @@ gst_ogg_packet_from_wrapper (ogg_packet_wrapper * packet)
   return packet;
 }
 
-#else
-
-#ifdef USE_TREMOLO
-  #include <Tremolo/ivorbiscodec.h>
-  #include <Tremolo/codec_internal.h>
-  typedef ogg_int16_t                    vorbis_sample_t;
-#else
-  #include <tremor/ivorbiscodec.h>
-  typedef ogg_int32_t                    vorbis_sample_t;
-#endif
+#else /* USE_TREMOLO */
 
+#include <Tremolo/ivorbiscodec.h>
+#include <Tremolo/codec_internal.h>
+typedef ogg_int16_t                    vorbis_sample_t;
 typedef struct _ogg_packet_wrapper     ogg_packet_wrapper;
 
 struct _ogg_packet_wrapper {
@@ -91,26 +111,6 @@ struct _ogg_packet_wrapper {
   ogg_buffer          buf;
 };
 
-#define GST_VORBIS_DEC_DESCRIPTION "decode raw vorbis streams to integer audio"
-
-#define GST_VORBIS_DEC_SRC_CAPS \
-    GST_STATIC_CAPS ("audio/x-raw-int, "   \
-        "rate = (int) [ 1, MAX ], "        \
-        "channels = (int) [ 1, 6 ], "      \
-        "endianness = (int) BYTE_ORDER, "  \
-        "width = (int) { 16, 32 }, "       \
-        "depth = (int) 16, "               \
-        "signed = (boolean) true")
-
-#define GST_VORBIS_DEC_DEFAULT_SAMPLE_WIDTH           (16)
-
-/* we need a different type name here */
-#define GST_VORBIS_DEC_GLIB_TYPE_NAME      GstIVorbisDec
-
-/* and still have it compile */
-typedef struct _GstVorbisDec               GstIVorbisDec;
-typedef struct _GstVorbisDecClass          GstIVorbisDecClass;
-
 /* compensate minor variation */
 #define vorbis_synthesis(a, b)             vorbis_synthesis (a, b, 1)
 
@@ -154,7 +154,7 @@ gst_ogg_packet_from_wrapper (ogg_packet_wrapper * packet)
   return &(packet->packet);
 }
 
-#endif
+#endif /* USE_TREMOLO */
 
 typedef void (*CopySampleFunc)(vorbis_sample_t *out, vorbis_sample_t **in,
                            guint samples, gint channels, gint width);
diff --git a/gst-libs/Makefile.in b/gst-libs/Makefile.in
index 8de9d65..6d09c63 100644
--- a/gst-libs/Makefile.in
+++ b/gst-libs/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,6 +14,23 @@
 
 @SET_MAKE@
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -33,6 +49,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst-libs
 DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
@@ -79,12 +96,18 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
 RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
@@ -94,6 +117,11 @@ RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
@@ -416,7 +444,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -462,12 +494,12 @@ clean-libtool:
 	-rm -rf .libs _libs
 
 # This directory's subdirectories are mostly independent; you can cd
-# into them and run `make' without going through this Makefile.
-# To change the values of `make' variables: instead of editing Makefiles,
-# (1) if the variable is set in `config.status', edit `config.status'
-#     (which will cause the Makefiles to be regenerated when you run `make');
-# (2) otherwise, pass the desired values on the `make' command line.
-$(RECURSIVE_TARGETS):
+# into them and run 'make' without going through this Makefile.
+# To change the values of 'make' variables: instead of editing Makefiles,
+# (1) if the variable is set in 'config.status', edit 'config.status'
+#     (which will cause the Makefiles to be regenerated when you run 'make');
+# (2) otherwise, pass the desired values on the 'make' command line.
+$(RECURSIVE_TARGETS) $(RECURSIVE_CLEAN_TARGETS):
 	@fail= failcom='exit 1'; \
 	for f in x $$MAKEFLAGS; do \
 	  case $$f in \
@@ -477,7 +509,11 @@ $(RECURSIVE_TARGETS):
 	done; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
-	list='$(SUBDIRS)'; for subdir in $$list; do \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	for subdir in $$list; do \
 	  echo "Making $$target in $$subdir"; \
 	  if test "$$subdir" = "."; then \
 	    dot_seen=yes; \
@@ -491,37 +527,6 @@ $(RECURSIVE_TARGETS):
 	if test "$$dot_seen" = "no"; then \
 	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
 	fi; test -z "$$fail"
-
-$(RECURSIVE_CLEAN_TARGETS):
-	@fail= failcom='exit 1'; \
-	for f in x $$MAKEFLAGS; do \
-	  case $$f in \
-	    *=* | --[!k]*);; \
-	    *k*) failcom='fail=yes';; \
-	  esac; \
-	done; \
-	dot_seen=no; \
-	case "$@" in \
-	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
-	  *) list='$(SUBDIRS)' ;; \
-	esac; \
-	rev=''; for subdir in $$list; do \
-	  if test "$$subdir" = "."; then :; else \
-	    rev="$$subdir $$rev"; \
-	  fi; \
-	done; \
-	rev="$$rev ."; \
-	target=`echo $@ | sed s/-recursive//`; \
-	for subdir in $$rev; do \
-	  echo "Making $$target in $$subdir"; \
-	  if test "$$subdir" = "."; then \
-	    local_target="$$target-am"; \
-	  else \
-	    local_target="$$target"; \
-	  fi; \
-	  ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
-	  || eval $$failcom; \
-	done && test -z "$$fail"
 tags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
@@ -530,6 +535,10 @@ ctags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
 	done
+cscopelist-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) cscopelist); \
+	done
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -593,6 +602,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist: cscopelist-recursive $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -628,13 +651,10 @@ distdir: $(DISTFILES)
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -755,22 +775,23 @@ ps-am:
 
 uninstall-am:
 
-.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) ctags-recursive \
-	install-am install-strip tags-recursive
+.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) \
+	cscopelist-recursive ctags-recursive install-am install-strip \
+	tags-recursive
 
 .PHONY: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) CTAGS GTAGS \
 	all all-am check check-am clean clean-generic clean-libtool \
-	ctags ctags-recursive distclean distclean-generic \
-	distclean-libtool distclean-tags distdir dvi dvi-am html \
-	html-am info info-am install install-am install-data \
-	install-data-am install-dvi install-dvi-am install-exec \
-	install-exec-am install-html install-html-am install-info \
-	install-info-am install-man install-pdf install-pdf-am \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs installdirs-am maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-generic \
-	mostlyclean-libtool pdf pdf-am ps ps-am tags tags-recursive \
-	uninstall uninstall-am
+	cscopelist cscopelist-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-libtool distclean-tags \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-dvi \
+	install-dvi-am install-exec install-exec-am install-html \
+	install-html-am install-info install-info-am install-man \
+	install-pdf install-pdf-am install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	mostlyclean mostlyclean-generic mostlyclean-libtool pdf pdf-am \
+	ps ps-am tags tags-recursive uninstall uninstall-am
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/gst-libs/ext/Makefile.am b/gst-libs/ext/Makefile.am
new file mode 100644
index 0000000..f9beb01
--- /dev/null
+++ b/gst-libs/ext/Makefile.am
@@ -0,0 +1,2 @@
+SUBDIRS =
+DIST_SUBDIRS =
diff --git a/gst-libs/gst/Makefile.in b/gst-libs/gst/Makefile.in
index bd29d8b..bc2b09e 100644
--- a/gst-libs/gst/Makefile.in
+++ b/gst-libs/gst/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,6 +50,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst-libs/gst
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
 	$(srcdir)/Makefile.in
@@ -81,12 +98,18 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
 RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
@@ -96,6 +119,11 @@ RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
@@ -419,7 +447,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -489,12 +521,12 @@ clean-libtool:
 	-rm -rf .libs _libs
 
 # This directory's subdirectories are mostly independent; you can cd
-# into them and run `make' without going through this Makefile.
-# To change the values of `make' variables: instead of editing Makefiles,
-# (1) if the variable is set in `config.status', edit `config.status'
-#     (which will cause the Makefiles to be regenerated when you run `make');
-# (2) otherwise, pass the desired values on the `make' command line.
-$(RECURSIVE_TARGETS):
+# into them and run 'make' without going through this Makefile.
+# To change the values of 'make' variables: instead of editing Makefiles,
+# (1) if the variable is set in 'config.status', edit 'config.status'
+#     (which will cause the Makefiles to be regenerated when you run 'make');
+# (2) otherwise, pass the desired values on the 'make' command line.
+$(RECURSIVE_TARGETS) $(RECURSIVE_CLEAN_TARGETS):
 	@fail= failcom='exit 1'; \
 	for f in x $$MAKEFLAGS; do \
 	  case $$f in \
@@ -504,7 +536,11 @@ $(RECURSIVE_TARGETS):
 	done; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
-	list='$(SUBDIRS)'; for subdir in $$list; do \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	for subdir in $$list; do \
 	  echo "Making $$target in $$subdir"; \
 	  if test "$$subdir" = "."; then \
 	    dot_seen=yes; \
@@ -518,37 +554,6 @@ $(RECURSIVE_TARGETS):
 	if test "$$dot_seen" = "no"; then \
 	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
 	fi; test -z "$$fail"
-
-$(RECURSIVE_CLEAN_TARGETS):
-	@fail= failcom='exit 1'; \
-	for f in x $$MAKEFLAGS; do \
-	  case $$f in \
-	    *=* | --[!k]*);; \
-	    *k*) failcom='fail=yes';; \
-	  esac; \
-	done; \
-	dot_seen=no; \
-	case "$@" in \
-	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
-	  *) list='$(SUBDIRS)' ;; \
-	esac; \
-	rev=''; for subdir in $$list; do \
-	  if test "$$subdir" = "."; then :; else \
-	    rev="$$subdir $$rev"; \
-	  fi; \
-	done; \
-	rev="$$rev ."; \
-	target=`echo $@ | sed s/-recursive//`; \
-	for subdir in $$rev; do \
-	  echo "Making $$target in $$subdir"; \
-	  if test "$$subdir" = "."; then \
-	    local_target="$$target-am"; \
-	  else \
-	    local_target="$$target"; \
-	  fi; \
-	  ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
-	  || eval $$failcom; \
-	done && test -z "$$fail"
 tags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
@@ -557,6 +562,10 @@ ctags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
 	done
+cscopelist-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) cscopelist); \
+	done
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -620,6 +629,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist: cscopelist-recursive $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -655,13 +678,10 @@ distdir: $(DISTFILES)
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -782,22 +802,23 @@ ps-am:
 
 uninstall-am:
 
-.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) ctags-recursive \
-	install-am install-strip tags-recursive
+.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) \
+	cscopelist-recursive ctags-recursive install-am install-strip \
+	tags-recursive
 
 .PHONY: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) CTAGS GTAGS \
 	all all-am check check-am clean clean-generic clean-libtool \
-	ctags ctags-recursive distclean distclean-generic \
-	distclean-libtool distclean-tags distdir dvi dvi-am html \
-	html-am info info-am install install-am install-data \
-	install-data-am install-dvi install-dvi-am install-exec \
-	install-exec-am install-html install-html-am install-info \
-	install-info-am install-man install-pdf install-pdf-am \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs installdirs-am maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-generic \
-	mostlyclean-libtool pdf pdf-am ps ps-am tags tags-recursive \
-	uninstall uninstall-am
+	cscopelist cscopelist-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-libtool distclean-tags \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-dvi \
+	install-dvi-am install-exec install-exec-am install-html \
+	install-html-am install-info install-info-am install-man \
+	install-pdf install-pdf-am install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	mostlyclean mostlyclean-generic mostlyclean-libtool pdf pdf-am \
+	ps ps-am tags tags-recursive uninstall uninstall-am
 
 
 # dependencies:
diff --git a/gst-libs/gst/app/Makefile.am b/gst-libs/gst/app/Makefile.am
index bbd3df7..5c683c8 100644
--- a/gst-libs/gst/app/Makefile.am
+++ b/gst-libs/gst/app/Makefile.am
@@ -48,8 +48,8 @@ GstApp-@GST_MAJORMINOR@.gir: $(INTROSPECTION_SCANNER) libgstapp-@GST_MAJORMINOR@
 		$(gir_cincludes) \
 		-I$(top_srcdir)/gst-libs \
 		-I$(top_builddir)/gst-libs \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 		--library=libgstapp-@GST_MAJORMINOR@.la \
 		--include=Gst-@GST_MAJORMINOR@ \
 		--include=GstBase-@GST_MAJORMINOR@ \
@@ -76,8 +76,8 @@ typelibs_DATA = $(BUILT_GIRSOURCES:.gir=.typelib)
 		$(INTROSPECTION_COMPILER) \
 		--includedir=$(srcdir) \
 		--includedir=$(builddir) \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 CLEANFILES += $(BUILT_GIRSOURCES) $(typelibs_DATA)
diff --git a/gst-libs/gst/app/Makefile.in b/gst-libs/gst/app/Makefile.in
index cdca26a..93c4497 100644
--- a/gst-libs/gst/app/Makefile.in
+++ b/gst-libs/gst/app/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -26,6 +25,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -44,9 +60,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(libgstapp_@GST_MAJORMINOR@include_HEADERS) \
 	$(srcdir)/Makefile.am $(srcdir)/Makefile.in \
-	$(top_srcdir)/common/gst-glib-gen.mak
+	$(top_srcdir)/common/gst-glib-gen.mak $(top_srcdir)/depcomp
 @HAVE_INTROSPECTION_TRUE@am__append_1 = $(BUILT_GIRSOURCES) $(typelibs_DATA)
 subdir = gst-libs/gst/app
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
@@ -138,11 +155,24 @@ libgstapp_@GST_MAJORMINOR@_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstapp_@GST_MAJORMINOR@_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstapp_@GST_MAJORMINOR@_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstapp_@GST_MAJORMINOR@_la_CFLAGS) \
 	$(CFLAGS) $(libgstapp_@GST_MAJORMINOR@_la_LDFLAGS) $(LDFLAGS) \
 	-o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -155,23 +185,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstapp_@GST_MAJORMINOR@_la_SOURCES) \
 	$(nodist_libgstapp_@GST_MAJORMINOR@_la_SOURCES)
 DIST_SOURCES = $(libgstapp_@GST_MAJORMINOR@_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DATA = $(gir_DATA) $(typelibs_DATA)
 HEADERS = $(libgstapp_@GST_MAJORMINOR@include_HEADERS)
 ETAGS = etags
@@ -465,7 +496,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -547,7 +582,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(MKDIR_P) "$(DESTDIR)$(libdir)"
 	@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -555,6 +589,8 @@ install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libdir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(libdir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(libdir)"; \
 	}
@@ -570,12 +606,14 @@ uninstall-libLTLIBRARIES:
 
 clean-libLTLIBRARIES:
 	-test -z "$(lib_LTLIBRARIES)" || rm -f $(lib_LTLIBRARIES)
-	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(lib_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstapp-@GST_MAJORMINOR@.la: $(libgstapp_@GST_MAJORMINOR@_la_OBJECTS) $(libgstapp_@GST_MAJORMINOR@_la_DEPENDENCIES) $(EXTRA_libgstapp_@GST_MAJORMINOR@_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstapp_@GST_MAJORMINOR@_la_LINK) -rpath $(libdir) $(libgstapp_@GST_MAJORMINOR@_la_OBJECTS) $(libgstapp_@GST_MAJORMINOR@_la_LIBADD) $(LIBS)
 
@@ -646,8 +684,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-girDATA: $(gir_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(girdir)" || $(MKDIR_P) "$(DESTDIR)$(girdir)"
 	@list='$(gir_DATA)'; test -n "$(girdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(girdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(girdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -664,8 +705,11 @@ uninstall-girDATA:
 	dir='$(DESTDIR)$(girdir)'; $(am__uninstall_files_from_dir)
 install-typelibsDATA: $(typelibs_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(typelibsdir)" || $(MKDIR_P) "$(DESTDIR)$(typelibsdir)"
 	@list='$(typelibs_DATA)'; test -n "$(typelibsdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(typelibsdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(typelibsdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -682,8 +726,11 @@ uninstall-typelibsDATA:
 	dir='$(DESTDIR)$(typelibsdir)'; $(am__uninstall_files_from_dir)
 install-libgstapp_@GST_MAJORMINOR@includeHEADERS: $(libgstapp_@GST_MAJORMINOR@include_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstapp_@GST_MAJORMINOR@includedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstapp_@GST_MAJORMINOR@includedir)"
 	@list='$(libgstapp_@GST_MAJORMINOR@include_HEADERS)'; test -n "$(libgstapp_@GST_MAJORMINOR@includedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstapp_@GST_MAJORMINOR@includedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstapp_@GST_MAJORMINOR@includedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -748,6 +795,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -900,7 +961,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libLTLIBRARIES clean-libtool ctags distclean \
+	clean-libLTLIBRARIES clean-libtool cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
@@ -964,8 +1025,8 @@ $(glib_gen_basename)-enumtypes.c: $(glib_enum_headers)
 @HAVE_INTROSPECTION_TRUE@		$(gir_cincludes) \
 @HAVE_INTROSPECTION_TRUE@		-I$(top_srcdir)/gst-libs \
 @HAVE_INTROSPECTION_TRUE@		-I$(top_builddir)/gst-libs \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		--library=libgstapp-@GST_MAJORMINOR@.la \
 @HAVE_INTROSPECTION_TRUE@		--include=Gst-@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--include=GstBase-@GST_MAJORMINOR@ \
@@ -983,8 +1044,8 @@ $(glib_gen_basename)-enumtypes.c: $(glib_enum_headers)
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(srcdir) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir) \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst-libs/gst/app/gstappsink.c b/gst-libs/gst/app/gstappsink.c
index 9a891b6..871d6f0 100644
--- a/gst-libs/gst/app/gstappsink.c
+++ b/gst-libs/gst/app/gstappsink.c
@@ -158,6 +158,7 @@ static gboolean gst_app_sink_unlock_stop (GstBaseSink * bsink);
 static gboolean gst_app_sink_start (GstBaseSink * psink);
 static gboolean gst_app_sink_stop (GstBaseSink * psink);
 static gboolean gst_app_sink_event (GstBaseSink * sink, GstEvent * event);
+static gboolean gst_app_sink_query (GstBaseSink * bsink, GstQuery * query);
 static GstFlowReturn gst_app_sink_preroll (GstBaseSink * psink,
     GstBuffer * buffer);
 static GstFlowReturn gst_app_sink_render_common (GstBaseSink * psink,
@@ -436,6 +437,7 @@ gst_app_sink_class_init (GstAppSinkClass * klass)
   basesink_class->render = gst_app_sink_render;
   basesink_class->render_list = gst_app_sink_render_list;
   basesink_class->get_caps = gst_app_sink_getcaps;
+  basesink_class->query = gst_app_sink_query;
 
   klass->pull_preroll = gst_app_sink_pull_preroll;
   klass->pull_buffer = gst_app_sink_pull_buffer;
@@ -875,6 +877,30 @@ gst_app_sink_getcaps (GstBaseSink * psink)
   return caps;
 }
 
+static gboolean
+gst_app_sink_query (GstBaseSink * bsink, GstQuery * query)
+{
+  gboolean ret;
+
+  switch (GST_QUERY_TYPE (query)) {
+    case GST_QUERY_SEEKING:{
+      GstFormat fmt;
+
+      /* we don't supporting seeking */
+      gst_query_parse_seeking (query, &fmt, NULL, NULL, NULL);
+      gst_query_set_seeking (query, fmt, FALSE, 0, -1);
+      ret = TRUE;
+      break;
+    }
+
+    default:
+      ret = GST_BASE_SINK_CLASS (parent_class)->query (bsink, query);
+      break;
+  }
+
+  return ret;
+}
+
 static GstMiniObject *
 gst_app_sink_pull_object (GstAppSink * appsink)
 {
diff --git a/gst-libs/gst/app/gstappsrc.c b/gst-libs/gst/app/gstappsrc.c
index 24686b9..e74a3a3 100644
--- a/gst-libs/gst/app/gstappsrc.c
+++ b/gst-libs/gst/app/gstappsrc.c
@@ -752,6 +752,7 @@ gst_app_src_stop (GstBaseSrc * bsrc)
   priv->flushing = TRUE;
   priv->started = FALSE;
   gst_app_src_flush_queued (appsrc);
+  g_cond_broadcast (priv->cond);
   g_mutex_unlock (priv->mutex);
 
   return TRUE;
@@ -974,6 +975,7 @@ gst_app_src_create (GstBaseSrc * bsrc, guint64 offset, guint size,
         goto seek_error;
 
       priv->offset = offset;
+      priv->is_eos = FALSE;
     }
   }
 
diff --git a/gst-libs/gst/audio/Makefile.am b/gst-libs/gst/audio/Makefile.am
index 6e89c47..00fef8a 100644
--- a/gst-libs/gst/audio/Makefile.am
+++ b/gst-libs/gst/audio/Makefile.am
@@ -81,8 +81,8 @@ GstAudio-@GST_MAJORMINOR@.gir: $(INTROSPECTION_SCANNER) libgstaudio-@GST_MAJORMI
 		-I$(top_builddir)/gst-libs \
 		$(gir_cincludes) \
 		--add-include-path=$(builddir)/../interfaces \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 		--library=libgstaudio-@GST_MAJORMINOR@.la \
 		--include=Gst-@GST_MAJORMINOR@ \
 		--include=GstBase-@GST_MAJORMINOR@ \
@@ -112,8 +112,8 @@ typelibs_DATA = $(BUILT_GIRSOURCES:.gir=.typelib)
 		--includedir=$(srcdir) \
 		--includedir=$(builddir) \
 		--includedir=$(builddir)/../interfaces \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 CLEANFILES += $(BUILT_GIRSOURCES) $(typelibs_DATA)
diff --git a/gst-libs/gst/audio/Makefile.in b/gst-libs/gst/audio/Makefile.in
index 5b19b05..712cf3c 100644
--- a/gst-libs/gst/audio/Makefile.in
+++ b/gst-libs/gst/audio/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -26,6 +25,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -44,9 +60,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(libgstaudio_@GST_MAJORMINOR@include_HEADERS) \
 	$(srcdir)/Makefile.am $(srcdir)/Makefile.in \
-	$(top_srcdir)/common/gst-glib-gen.mak TODO
+	$(top_srcdir)/common/gst-glib-gen.mak $(top_srcdir)/depcomp \
+	TODO
 @HAVE_INTROSPECTION_TRUE@am__append_1 = $(BUILT_GIRSOURCES) $(typelibs_DATA)
 subdir = gst-libs/gst/audio
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
@@ -153,10 +171,23 @@ libgstaudio_@GST_MAJORMINOR@_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstaudio_@GST_MAJORMINOR@_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(libgstaudio_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) \
 	$(libgstaudio_@GST_MAJORMINOR@_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -169,23 +200,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstaudio_@GST_MAJORMINOR@_la_SOURCES) \
 	$(nodist_libgstaudio_@GST_MAJORMINOR@_la_SOURCES)
 DIST_SOURCES = $(libgstaudio_@GST_MAJORMINOR@_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DATA = $(gir_DATA) $(typelibs_DATA)
 HEADERS = $(libgstaudio_@GST_MAJORMINOR@include_HEADERS) \
 	$(nodist_libgstaudio_@GST_MAJORMINOR@include_HEADERS)
@@ -480,7 +512,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -603,7 +639,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(MKDIR_P) "$(DESTDIR)$(libdir)"
 	@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -611,6 +646,8 @@ install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libdir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(libdir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(libdir)"; \
 	}
@@ -626,12 +663,14 @@ uninstall-libLTLIBRARIES:
 
 clean-libLTLIBRARIES:
 	-test -z "$(lib_LTLIBRARIES)" || rm -f $(lib_LTLIBRARIES)
-	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(lib_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstaudio-@GST_MAJORMINOR@.la: $(libgstaudio_@GST_MAJORMINOR@_la_OBJECTS) $(libgstaudio_@GST_MAJORMINOR@_la_DEPENDENCIES) $(EXTRA_libgstaudio_@GST_MAJORMINOR@_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstaudio_@GST_MAJORMINOR@_la_LINK) -rpath $(libdir) $(libgstaudio_@GST_MAJORMINOR@_la_OBJECTS) $(libgstaudio_@GST_MAJORMINOR@_la_LIBADD) $(LIBS)
 
@@ -782,8 +821,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-girDATA: $(gir_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(girdir)" || $(MKDIR_P) "$(DESTDIR)$(girdir)"
 	@list='$(gir_DATA)'; test -n "$(girdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(girdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(girdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -800,8 +842,11 @@ uninstall-girDATA:
 	dir='$(DESTDIR)$(girdir)'; $(am__uninstall_files_from_dir)
 install-typelibsDATA: $(typelibs_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(typelibsdir)" || $(MKDIR_P) "$(DESTDIR)$(typelibsdir)"
 	@list='$(typelibs_DATA)'; test -n "$(typelibsdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(typelibsdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(typelibsdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -818,8 +863,11 @@ uninstall-typelibsDATA:
 	dir='$(DESTDIR)$(typelibsdir)'; $(am__uninstall_files_from_dir)
 install-libgstaudio_@GST_MAJORMINOR@includeHEADERS: $(libgstaudio_@GST_MAJORMINOR@include_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstaudio_@GST_MAJORMINOR@includedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstaudio_@GST_MAJORMINOR@includedir)"
 	@list='$(libgstaudio_@GST_MAJORMINOR@include_HEADERS)'; test -n "$(libgstaudio_@GST_MAJORMINOR@includedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstaudio_@GST_MAJORMINOR@includedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstaudio_@GST_MAJORMINOR@includedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -836,8 +884,11 @@ uninstall-libgstaudio_@GST_MAJORMINOR@includeHEADERS:
 	dir='$(DESTDIR)$(libgstaudio_@GST_MAJORMINOR@includedir)'; $(am__uninstall_files_from_dir)
 install-nodist_libgstaudio_@GST_MAJORMINOR@includeHEADERS: $(nodist_libgstaudio_@GST_MAJORMINOR@include_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstaudio_@GST_MAJORMINOR@includedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstaudio_@GST_MAJORMINOR@includedir)"
 	@list='$(nodist_libgstaudio_@GST_MAJORMINOR@include_HEADERS)'; test -n "$(libgstaudio_@GST_MAJORMINOR@includedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstaudio_@GST_MAJORMINOR@includedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstaudio_@GST_MAJORMINOR@includedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -902,6 +953,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -1056,7 +1121,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libLTLIBRARIES clean-libtool ctags distclean \
+	clean-libLTLIBRARIES clean-libtool cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
@@ -1123,8 +1188,8 @@ $(glib_gen_basename)-enumtypes.c: $(glib_enum_headers)
 @HAVE_INTROSPECTION_TRUE@		-I$(top_builddir)/gst-libs \
 @HAVE_INTROSPECTION_TRUE@		$(gir_cincludes) \
 @HAVE_INTROSPECTION_TRUE@		--add-include-path=$(builddir)/../interfaces \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		--library=libgstaudio-@GST_MAJORMINOR@.la \
 @HAVE_INTROSPECTION_TRUE@		--include=Gst-@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--include=GstBase-@GST_MAJORMINOR@ \
@@ -1145,8 +1210,8 @@ $(glib_gen_basename)-enumtypes.c: $(glib_enum_headers)
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(srcdir) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir)/../interfaces \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst-libs/gst/audio/audio.c b/gst-libs/gst/audio/audio.c
index d2d15c3..1044bb0 100644
--- a/gst-libs/gst/audio/audio.c
+++ b/gst-libs/gst/audio/audio.c
@@ -340,7 +340,7 @@ static GstAudioFormatInfo formats[] = {
 static GstAudioFormat
 gst_audio_format_from_caps_structure (const GstStructure * s)
 {
-  gint endianness, width, depth;
+  gint endianness = 0, width, depth;
   guint i;
 
   if (gst_structure_has_name (s, "audio/x-raw-int")) {
@@ -349,15 +349,15 @@ gst_audio_format_from_caps_structure (const GstStructure * s)
     if (!gst_structure_get_boolean (s, "signed", &sign))
       goto missing_field_signed;
 
-    if (!gst_structure_get_int (s, "endianness", &endianness))
-      goto missing_field_endianness;
-
     if (!gst_structure_get_int (s, "width", &width))
       goto missing_field_width;
 
     if (!gst_structure_get_int (s, "depth", &depth))
       goto missing_field_depth;
 
+    if (width > 8 && !gst_structure_get_int (s, "endianness", &endianness))
+      goto missing_field_endianness;
+
     for (i = 0; i < G_N_ELEMENTS (formats); i++) {
       if (GST_AUDIO_FORMAT_INFO_IS_INTEGER (&formats[i]) &&
           sign == GST_AUDIO_FORMAT_INFO_IS_SIGNED (&formats[i]) &&
diff --git a/gst-libs/gst/audio/audio.h b/gst-libs/gst/audio/audio.h
index ed282fa..34c1dd9 100644
--- a/gst-libs/gst/audio/audio.h
+++ b/gst-libs/gst/audio/audio.h
@@ -262,7 +262,7 @@ struct _GstAudioInfo {
 #define GST_AUDIO_INFO_IS_FLOAT(i)           (GST_AUDIO_FORMAT_INFO_IS_FLOAT((i)->finfo))
 #define GST_AUDIO_INFO_IS_SIGNED(i)          (GST_AUDIO_FORMAT_INFO_IS_SIGNED((i)->finfo))
 
-#define GST_AUDIO_INFO_ENDIANNESS(i)         (GST_AUDIO_FORMAT_INFO_ENDIANNES((i)->finfo))
+#define GST_AUDIO_INFO_ENDIANNESS(i)         (GST_AUDIO_FORMAT_INFO_ENDIANNESS((i)->finfo))
 #define GST_AUDIO_INFO_IS_LITTLE_ENDIAN(i)   (GST_AUDIO_FORMAT_INFO_IS_LITTLE_ENDIAN((i)->finfo))
 #define GST_AUDIO_INFO_IS_BIG_ENDIAN(i)      (GST_AUDIO_FORMAT_INFO_IS_BIG_ENDIAN((i)->finfo))
 
diff --git a/gst-libs/gst/audio/gstaudiodecoder.c b/gst-libs/gst/audio/gstaudiodecoder.c
index e35779e..b3a54ad 100644
--- a/gst-libs/gst/audio/gstaudiodecoder.c
+++ b/gst-libs/gst/audio/gstaudiodecoder.c
@@ -220,6 +220,7 @@ struct _GstAudioDecoderPrivate
   GstAdapter *adapter;
   /* tracking input ts for changes */
   GstClockTime prev_ts;
+  guint64 prev_distance;
   /* frames obtained from input */
   GQueue frames;
   /* collected output data */
@@ -323,7 +324,8 @@ gst_audio_decoder_class_init (GstAudioDecoderClass * klass)
   gobject_class->get_property = gst_audio_decoder_get_property;
   gobject_class->finalize = gst_audio_decoder_finalize;
 
-  element_class->change_state = gst_audio_decoder_change_state;
+  element_class->change_state =
+      GST_DEBUG_FUNCPTR (gst_audio_decoder_change_state);
 
   /* Properties */
   g_object_class_install_property (gobject_class, PROP_LATENCY,
@@ -444,6 +446,7 @@ gst_audio_decoder_reset (GstAudioDecoder * dec, gboolean full)
   dec->priv->out_ts = GST_CLOCK_TIME_NONE;
   dec->priv->out_dur = 0;
   dec->priv->prev_ts = GST_CLOCK_TIME_NONE;
+  dec->priv->prev_distance = 0;
   dec->priv->drained = TRUE;
   dec->priv->base_ts = GST_CLOCK_TIME_NONE;
   dec->priv->samples = 0;
@@ -779,7 +782,7 @@ gst_audio_decoder_finish_frame (GstAudioDecoder * dec, GstBuffer * buf,
 
   GST_AUDIO_DECODER_STREAM_LOCK (dec);
 
-  if (priv->pending_events) {
+  if (buf && priv->pending_events) {
     GList *pending_events, *l;
 
     pending_events = priv->pending_events;
@@ -895,11 +898,12 @@ gst_audio_decoder_finish_frame (GstAudioDecoder * dec, GstBuffer * buf,
 
   /* we got data, so note things are looking up */
   if (G_UNLIKELY (dec->priv->error_count))
-    dec->priv->error_count--;
+    dec->priv->error_count = 0;
 
-exit:
   ret = gst_audio_decoder_output (dec, buf);
 
+exit:
+
   GST_AUDIO_DECODER_STREAM_UNLOCK (dec);
 
   return ret;
@@ -976,6 +980,7 @@ gst_audio_decoder_push_buffers (GstAudioDecoder * dec, gboolean force)
     if (G_LIKELY (av)) {
       gint len;
       GstClockTime ts;
+      guint64 distance;
 
       /* parse if needed */
       if (klass->parse) {
@@ -990,7 +995,7 @@ gst_audio_decoder_push_buffers (GstAudioDecoder * dec, gboolean force)
         g_assert (offset <= av);
         if (offset) {
           /* jumped a bit */
-          GST_DEBUG_OBJECT (dec, "setting DISCONT");
+          GST_DEBUG_OBJECT (dec, "skipped %d; setting DISCONT", offset);
           gst_adapter_flush (priv->adapter, offset);
           flush = offset;
           /* avoid parsing indefinitely */
@@ -1015,17 +1020,19 @@ gst_audio_decoder_push_buffers (GstAudioDecoder * dec, gboolean force)
         len = av;
       }
       /* track upstream ts, but do not get stuck if nothing new upstream */
-      ts = gst_adapter_prev_timestamp (priv->adapter, NULL);
-      if (ts == priv->prev_ts) {
+      ts = gst_adapter_prev_timestamp (priv->adapter, &distance);
+      if (ts != priv->prev_ts || distance <= priv->prev_distance) {
+        priv->prev_ts = ts;
+        priv->prev_distance = distance;
+      } else {
         GST_LOG_OBJECT (dec, "ts == prev_ts; discarding");
         ts = GST_CLOCK_TIME_NONE;
-      } else {
-        priv->prev_ts = ts;
       }
       buffer = gst_adapter_take_buffer (priv->adapter, len);
       buffer = gst_buffer_make_metadata_writable (buffer);
       GST_BUFFER_TIMESTAMP (buffer) = ts;
       flush += len;
+      priv->force = FALSE;
     } else {
       if (!force)
         break;
@@ -1034,6 +1041,7 @@ gst_audio_decoder_push_buffers (GstAudioDecoder * dec, gboolean force)
         break;
       }
       buffer = NULL;
+      priv->force = TRUE;
     }
 
     ret = gst_audio_decoder_handle_frame (dec, klass, buffer);
@@ -2069,12 +2077,18 @@ static GstStateChangeReturn
 gst_audio_decoder_change_state (GstElement * element, GstStateChange transition)
 {
   GstAudioDecoder *codec;
+  GstAudioDecoderClass *klass;
   GstStateChangeReturn ret;
 
   codec = GST_AUDIO_DECODER (element);
+  klass = GST_AUDIO_DECODER_GET_CLASS (codec);
 
   switch (transition) {
     case GST_STATE_CHANGE_NULL_TO_READY:
+      if (klass->open) {
+        if (!klass->open (codec))
+          goto open_failed;
+      }
       break;
     case GST_STATE_CHANGE_READY_TO_PAUSED:
       if (!gst_audio_decoder_start (codec)) {
@@ -2098,6 +2112,10 @@ gst_audio_decoder_change_state (GstElement * element, GstStateChange transition)
       }
       break;
     case GST_STATE_CHANGE_READY_TO_NULL:
+      if (klass->close) {
+        if (!klass->close (codec))
+          goto close_failed;
+      }
       break;
     default:
       break;
@@ -2115,6 +2133,16 @@ stop_failed:
     GST_ELEMENT_ERROR (codec, LIBRARY, INIT, (NULL), ("Failed to stop codec"));
     return GST_STATE_CHANGE_FAILURE;
   }
+open_failed:
+  {
+    GST_ELEMENT_ERROR (codec, LIBRARY, INIT, (NULL), ("Failed to open codec"));
+    return GST_STATE_CHANGE_FAILURE;
+  }
+close_failed:
+  {
+    GST_ELEMENT_ERROR (codec, LIBRARY, INIT, (NULL), ("Failed to close codec"));
+    return GST_STATE_CHANGE_FAILURE;
+  }
 }
 
 GstFlowReturn
@@ -2133,6 +2161,8 @@ _gst_audio_decoder_error (GstAudioDecoder * dec, gint weight,
         domain, code, txt, dbg, file, function, line);
     return GST_FLOW_ERROR;
   } else {
+    g_free (txt);
+    g_free (dbg);
     return GST_FLOW_OK;
   }
 }
@@ -2584,3 +2614,40 @@ gst_audio_decoder_get_needs_format (GstAudioDecoder * dec)
 
   return result;
 }
+
+/**
+ * gst_audio_decoder_merge_tags:
+ * @dec: a #GstAudioDecoder
+ * @tags: a #GstTagList to merge
+ * @mode: the #GstTagMergeMode to use
+ *
+ * Adds tags to so-called pending tags, which will be processed
+ * before pushing out data downstream.
+ *
+ * Note that this is provided for convenience, and the subclass is
+ * not required to use this and can still do tag handling on its own,
+ * although it should be aware that baseclass already takes care
+ * of the usual CODEC/AUDIO_CODEC tags.
+ *
+ * MT safe.
+ *
+ * Since: 0.10.37
+ */
+void
+gst_audio_decoder_merge_tags (GstAudioDecoder * dec,
+    const GstTagList * tags, GstTagMergeMode mode)
+{
+  GstTagList *otags;
+
+  g_return_if_fail (GST_IS_AUDIO_DECODER (dec));
+  g_return_if_fail (tags == NULL || GST_IS_TAG_LIST (tags));
+
+  GST_AUDIO_DECODER_STREAM_LOCK (dec);
+  if (tags)
+    GST_DEBUG_OBJECT (dec, "merging tags %" GST_PTR_FORMAT, tags);
+  otags = dec->priv->taglist;
+  dec->priv->taglist = gst_tag_list_merge (dec->priv->taglist, tags, mode);
+  if (otags)
+    gst_tag_list_free (otags);
+  GST_AUDIO_DECODER_STREAM_UNLOCK (dec);
+}
diff --git a/gst-libs/gst/audio/gstaudiodecoder.h b/gst-libs/gst/audio/gstaudiodecoder.h
index ba4fff3..bf1c44e 100644
--- a/gst-libs/gst/audio/gstaudiodecoder.h
+++ b/gst-libs/gst/audio/gstaudiodecoder.h
@@ -41,6 +41,8 @@ G_BEGIN_DECLS
   (G_TYPE_CHECK_INSTANCE_TYPE((obj),GST_TYPE_AUDIO_DECODER))
 #define GST_IS_AUDIO_DECODER_CLASS(obj) \
   (G_TYPE_CHECK_CLASS_TYPE((klass),GST_TYPE_AUDIO_DECODER))
+#define GST_AUDIO_DECODER_CAST(obj) \
+  ((GstAudioDecoder *)(obj))
 
 /**
  * GST_AUDIO_DECODER_SINK_NAME:
@@ -199,6 +201,12 @@ struct _GstAudioDecoder
  *                  Called just prior to pushing (encoded data) buffer downstream.
  *                  Subclass has full discretionary access to buffer,
  *                  and a not OK flow return will abort downstream pushing.
+ * @open:           Optional.
+ *                  Called when the element changes to GST_STATE_READY.
+ *                  Allows opening external resources. Since: 0.10.37.
+ * @close:          Optional.
+ *                  Called when the element changes to GST_STATE_NULL.
+ *                  Allows closing external resources. Since: 0.10.37.
  *
  * Subclasses can override any of the available virtual methods or not, as
  * needed. At minimum @handle_frame (and likely @set_format) needs to be
@@ -235,8 +243,12 @@ struct _GstAudioDecoderClass
   gboolean      (*event)              (GstAudioDecoder *dec,
                                        GstEvent *event);
 
+  gboolean      (*open)               (GstAudioDecoder *dec);
+  
+  gboolean      (*close)              (GstAudioDecoder *dec);
+
   /*< private >*/
-  gpointer       _gst_reserved[GST_PADDING_LARGE];
+  gpointer       _gst_reserved[GST_PADDING_LARGE-2];
 };
 
 GType             gst_audio_decoder_get_type (void);
@@ -303,6 +315,9 @@ void              gst_audio_decoder_set_needs_format (GstAudioDecoder * dec,
 
 gboolean          gst_audio_decoder_get_needs_format (GstAudioDecoder * dec);
 
+void              gst_audio_decoder_merge_tags (GstAudioDecoder * dec,
+                                                const GstTagList * tags, GstTagMergeMode mode);
+
 G_END_DECLS
 
 #endif /* _GST_AUDIO_DECODER_H_ */
diff --git a/gst-libs/gst/audio/gstaudioencoder.c b/gst-libs/gst/audio/gstaudioencoder.c
index b915ae7..0608f9a 100644
--- a/gst-libs/gst/audio/gstaudioencoder.c
+++ b/gst-libs/gst/audio/gstaudioencoder.c
@@ -301,6 +301,9 @@ static void gst_audio_encoder_set_property (GObject * object,
 static void gst_audio_encoder_get_property (GObject * object,
     guint prop_id, GValue * value, GParamSpec * pspec);
 
+static GstStateChangeReturn gst_audio_encoder_change_state (GstElement *
+    element, GstStateChange transition);
+
 static gboolean gst_audio_encoder_sink_activate_push (GstPad * pad,
     gboolean active);
 
@@ -317,8 +320,10 @@ static void
 gst_audio_encoder_class_init (GstAudioEncoderClass * klass)
 {
   GObjectClass *gobject_class;
+  GstElementClass *gstelement_class;
 
   gobject_class = G_OBJECT_CLASS (klass);
+  gstelement_class = GST_ELEMENT_CLASS (klass);
   parent_class = g_type_class_peek_parent (klass);
 
   GST_DEBUG_CATEGORY_INIT (gst_audio_encoder_debug, "audioencoder", 0,
@@ -349,6 +354,9 @@ gst_audio_encoder_class_init (GstAudioEncoderClass * klass)
           "Consider discontinuity if timestamp jitter/imperfection exceeds tolerance (ns)",
           0, G_MAXINT64, DEFAULT_TOLERANCE,
           G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
+  gstelement_class->change_state =
+      GST_DEBUG_FUNCPTR (gst_audio_encoder_change_state);
 }
 
 static void
@@ -460,6 +468,49 @@ gst_audio_encoder_finalize (GObject * object)
   G_OBJECT_CLASS (parent_class)->finalize (object);
 }
 
+static GstStateChangeReturn
+gst_audio_encoder_change_state (GstElement * element, GstStateChange transition)
+{
+  GstStateChangeReturn ret = GST_STATE_CHANGE_SUCCESS;
+  GstAudioEncoder *enc = GST_AUDIO_ENCODER (element);
+  GstAudioEncoderClass *klass = GST_AUDIO_ENCODER_GET_CLASS (enc);
+
+  switch (transition) {
+    case GST_STATE_CHANGE_NULL_TO_READY:
+      if (klass->open) {
+        if (!klass->open (enc))
+          goto open_failed;
+      }
+    default:
+      break;
+  }
+
+  ret = GST_ELEMENT_CLASS (parent_class)->change_state (element, transition);
+
+  switch (transition) {
+    case GST_STATE_CHANGE_READY_TO_NULL:
+      if (klass->close) {
+        if (!klass->close (enc))
+          goto close_failed;
+      }
+    default:
+      break;
+  }
+
+  return ret;
+
+open_failed:
+  {
+    GST_ELEMENT_ERROR (enc, LIBRARY, INIT, (NULL), ("Failed to open codec"));
+    return GST_STATE_CHANGE_FAILURE;
+  }
+close_failed:
+  {
+    GST_ELEMENT_ERROR (enc, LIBRARY, INIT, (NULL), ("Failed to close codec"));
+    return GST_STATE_CHANGE_FAILURE;
+  }
+}
+
 /**
  * gst_audio_encoder_finish_frame:
  * @enc: a #GstAudioEncoder
@@ -1032,8 +1083,8 @@ audio_info_is_equal (GstAudioInfo * from, GstAudioInfo * to)
     return FALSE;
   if (GST_AUDIO_INFO_CHANNELS (from) > 64)
     return TRUE;
-  return memcmp (from->position, to->position,
-      GST_AUDIO_INFO_CHANNELS (from) * sizeof (to->position[0]));
+  return (memcmp (from->position, to->position,
+          GST_AUDIO_INFO_CHANNELS (from) * sizeof (to->position[0])) == 0);
 }
 
 static gboolean
diff --git a/gst-libs/gst/audio/gstaudioencoder.h b/gst-libs/gst/audio/gstaudioencoder.h
index aa40677..2db19ab 100644
--- a/gst-libs/gst/audio/gstaudioencoder.h
+++ b/gst-libs/gst/audio/gstaudioencoder.h
@@ -151,6 +151,12 @@ struct _GstAudioEncoder {
  *                  for multichannel input specification).  If not implemented,
  *                  default returns gst_audio_encoder_proxy_getcaps
  *                  applied to sink template caps.
+ * @open:           Optional.
+ *                  Called when the element changes to GST_STATE_READY.
+ *                  Allows opening external resources. Since: 0.10.37.
+ * @close:          Optional.
+ *                  Called when the element changes to GST_STATE_NULL.
+ *                  Allows closing external resources. Since: 0.10.37.
  *
  * Subclasses can override any of the available virtual methods or not, as
  * needed. At minimum @set_format and @handle_frame needs to be overridden.
@@ -183,8 +189,12 @@ struct _GstAudioEncoderClass {
 
   GstCaps *     (*getcaps)            (GstAudioEncoder *enc);
 
+  gboolean      (*open)               (GstAudioEncoder *enc);
+
+  gboolean      (*close)              (GstAudioEncoder *enc);
+
   /*< private >*/
-  gpointer       _gst_reserved[GST_PADDING_LARGE];
+  gpointer       _gst_reserved[GST_PADDING_LARGE-2];
 };
 
 GType           gst_audio_encoder_get_type         (void);
diff --git a/gst-libs/gst/audio/gstaudioiec61937.c b/gst-libs/gst/audio/gstaudioiec61937.c
index b6a3266..af0e0f0 100644
--- a/gst-libs/gst/audio/gstaudioiec61937.c
+++ b/gst-libs/gst/audio/gstaudioiec61937.c
@@ -236,9 +236,10 @@ gst_audio_iec61937_payload (const guint8 * src, guint src_n, guint8 * dst,
        *     bit  0-4  - data type (11 = type I, 12 = type II,
        *                            13 = type III) */
       dst[five] = 11 + (blocksize / 1024);
-      /* Pd: bit 15-0  - frame size in bytes */
-      dst[six] = ((guint16) src_n) >> 8;
-      dst[seven] = ((guint16) src_n) & 0xff;
+      /* Pd: bit 15-0  - frame size, in bits (for type I-III) */
+      tmp = src_n * 8;
+      dst[six] = ((guint16) tmp) >> 8;
+      dst[seven] = ((guint16) tmp) & 0xff;
       break;
     }
 
diff --git a/gst-libs/gst/audio/gstbaseaudiosink.c b/gst-libs/gst/audio/gstbaseaudiosink.c
index e7ff30d..fe89c9d 100644
--- a/gst-libs/gst/audio/gstbaseaudiosink.c
+++ b/gst-libs/gst/audio/gstbaseaudiosink.c
@@ -921,6 +921,12 @@ gst_base_audio_sink_setcaps (GstBaseSink * bsink, GstCaps * caps)
   if (!gst_ring_buffer_acquire (sink->ringbuffer, spec))
     goto acquire_error;
 
+  /* We need to resync since the ringbuffer restarted */
+  sink->priv->avg_skew = -1;
+  sink->next_sample = -1;
+  sink->priv->eos_time = -1;
+  sink->priv->discont_time = -1;
+
   if (bsink->pad_mode == GST_ACTIVATE_PUSH) {
     GST_DEBUG_OBJECT (sink, "activate ringbuffer");
     gst_ring_buffer_activate (sink->ringbuffer, TRUE);
@@ -1654,7 +1660,7 @@ gst_base_audio_sink_render (GstBaseSink * bsink, GstBuffer * buf)
         GST_BUFFER_SIZE (buf), render_start);
     /* we don't have a start so we don't know stop either */
     stop = -1;
-    goto no_sync;
+    goto no_align;
   }
 
   /* let's calc stop based on the number of samples in the buffer instead
@@ -1730,7 +1736,7 @@ gst_base_audio_sink_render (GstBaseSink * bsink, GstBuffer * buf)
     render_stop = render_start + samples;
     GST_DEBUG_OBJECT (sink,
         "no sync needed. Using render_start=%" G_GUINT64_FORMAT, render_start);
-    goto no_sync;
+    goto no_align;
   }
 
   /* bring buffer start and stop times to running time */
@@ -1856,7 +1862,6 @@ no_align:
   /* number of target samples is difference between start and stop */
   out_samples = render_stop - render_start;
 
-no_sync:
   /* we render the first or last sample first, depending on the rate */
   if (bsink->segment.rate >= 0.0)
     sample_offset = render_start;
diff --git a/gst-libs/gst/audio/gstringbuffer.c b/gst-libs/gst/audio/gstringbuffer.c
index 5069304..b68760b 100644
--- a/gst-libs/gst/audio/gstringbuffer.c
+++ b/gst-libs/gst/audio/gstringbuffer.c
@@ -924,6 +924,7 @@ gst_ring_buffer_release (GstRingBuffer * buf)
 
   g_free (buf->empty_seg);
   buf->empty_seg = NULL;
+  gst_caps_replace (&buf->spec.caps, NULL);
   GST_DEBUG_OBJECT (buf, "released device");
 
 done:
diff --git a/gst-libs/gst/audio/mixerutils.c b/gst-libs/gst/audio/mixerutils.c
index 94cdde3..f500497 100644
--- a/gst-libs/gst/audio/mixerutils.c
+++ b/gst-libs/gst/audio/mixerutils.c
@@ -31,6 +31,10 @@
  * </refsect2>
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
diff --git a/gst-libs/gst/audio/multichannel.h b/gst-libs/gst/audio/multichannel.h
index 8bf92d7..df2aa96 100644
--- a/gst-libs/gst/audio/multichannel.h
+++ b/gst-libs/gst/audio/multichannel.h
@@ -77,8 +77,7 @@ typedef enum {
    * are defined or all positions are undefined, but can't mix'n'match  */
   GST_AUDIO_CHANNEL_POSITION_NONE,
 
-  /*< private >*/
-  /* don't use - counter */
+  /* don't use - counter (private) */
   GST_AUDIO_CHANNEL_POSITION_NUM
 } GstAudioChannelPosition;
 
diff --git a/gst-libs/gst/cdda/Makefile.am b/gst-libs/gst/cdda/Makefile.am
index 26706f4..b5bd1fa 100644
--- a/gst-libs/gst/cdda/Makefile.am
+++ b/gst-libs/gst/cdda/Makefile.am
@@ -30,8 +30,8 @@ GstCdda-@GST_MAJORMINOR@.gir: $(INTROSPECTION_SCANNER) libgstcdda-@GST_MAJORMINO
 		--strip-prefix=Gst \
 		$(gir_cincludes) \
 		--add-include-path=$(builddir)/../tag \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 		--library=libgstcdda-@GST_MAJORMINOR@.la \
 		--include=Gst-@GST_MAJORMINOR@ \
 		--include=GstBase-@GST_MAJORMINOR@ \
@@ -61,8 +61,8 @@ typelibs_DATA = $(BUILT_GIRSOURCES:.gir=.typelib)
 		--includedir=$(srcdir) \
 		--includedir=$(builddir) \
 		--includedir=$(builddir)/../tag \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 CLEANFILES = $(BUILT_GIRSOURCES) $(typelibs_DATA)
diff --git a/gst-libs/gst/cdda/Makefile.in b/gst-libs/gst/cdda/Makefile.in
index c4da1ce..9a88edc 100644
--- a/gst-libs/gst/cdda/Makefile.in
+++ b/gst-libs/gst/cdda/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst-libs/gst/cdda
 DIST_COMMON = $(libgstcdda_@GST_MAJORMINOR@include_HEADERS) \
-	$(srcdir)/Makefile.am $(srcdir)/Makefile.in
+	$(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -123,10 +141,23 @@ libgstcdda_@GST_MAJORMINOR@_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstcdda_@GST_MAJORMINOR@_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(libgstcdda_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) \
 	$(libgstcdda_@GST_MAJORMINOR@_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -139,22 +170,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstcdda_@GST_MAJORMINOR@_la_SOURCES)
 DIST_SOURCES = $(libgstcdda_@GST_MAJORMINOR@_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(libgstcdda_@GST_MAJORMINOR@include_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -447,7 +479,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -500,7 +536,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(MKDIR_P) "$(DESTDIR)$(libdir)"
 	@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -508,6 +543,8 @@ install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libdir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(libdir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(libdir)"; \
 	}
@@ -523,12 +560,14 @@ uninstall-libLTLIBRARIES:
 
 clean-libLTLIBRARIES:
 	-test -z "$(lib_LTLIBRARIES)" || rm -f $(lib_LTLIBRARIES)
-	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(lib_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstcdda-@GST_MAJORMINOR@.la: $(libgstcdda_@GST_MAJORMINOR@_la_OBJECTS) $(libgstcdda_@GST_MAJORMINOR@_la_DEPENDENCIES) $(EXTRA_libgstcdda_@GST_MAJORMINOR@_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstcdda_@GST_MAJORMINOR@_la_LINK) -rpath $(libdir) $(libgstcdda_@GST_MAJORMINOR@_la_OBJECTS) $(libgstcdda_@GST_MAJORMINOR@_la_LIBADD) $(LIBS)
 
@@ -575,8 +614,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-libgstcdda_@GST_MAJORMINOR@includeHEADERS: $(libgstcdda_@GST_MAJORMINOR@include_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstcdda_@GST_MAJORMINOR@includedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstcdda_@GST_MAJORMINOR@includedir)"
 	@list='$(libgstcdda_@GST_MAJORMINOR@include_HEADERS)'; test -n "$(libgstcdda_@GST_MAJORMINOR@includedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstcdda_@GST_MAJORMINOR@includedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstcdda_@GST_MAJORMINOR@includedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -641,6 +683,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -786,7 +842,7 @@ uninstall-am: uninstall-libLTLIBRARIES \
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libLTLIBRARIES clean-libtool ctags distclean \
+	clean-libLTLIBRARIES clean-libtool cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
@@ -811,8 +867,8 @@ uninstall-am: uninstall-libLTLIBRARIES \
 #		--strip-prefix=Gst \
 #		$(gir_cincludes) \
 #		--add-include-path=$(builddir)/../tag \
-#		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-#		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+#		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+#		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 #		--library=libgstcdda-@GST_MAJORMINOR@.la \
 #		--include=Gst-@GST_MAJORMINOR@ \
 #		--include=GstBase-@GST_MAJORMINOR@ \
@@ -833,8 +889,8 @@ uninstall-am: uninstall-libLTLIBRARIES \
 #		--includedir=$(srcdir) \
 #		--includedir=$(builddir) \
 #		--includedir=$(builddir)/../tag \
-#		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-#		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+#		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+#		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 #		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/gst-libs/gst/fft/Makefile.am b/gst-libs/gst/fft/Makefile.am
index 68606a5..fa878cf 100644
--- a/gst-libs/gst/fft/Makefile.am
+++ b/gst-libs/gst/fft/Makefile.am
@@ -58,7 +58,7 @@ GstFft-@GST_MAJORMINOR@.gir: $(INTROSPECTION_SCANNER) libgstfft-@GST_MAJORMINOR@
 		--nsversion=@GST_MAJORMINOR@ \
 		--strip-prefix=Gst \
 		$(gir_cincludes) \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 		--library=libgstfft-@GST_MAJORMINOR@.la \
 		--include=Gst-@GST_MAJORMINOR@ \
 		--libtool="$(top_builddir)/libtool" \
@@ -82,7 +82,7 @@ typelibs_DATA = $(BUILT_GIRSOURCES:.gir=.typelib)
 		$(INTROSPECTION_COMPILER) \
 		--includedir=$(srcdir) \
 		--includedir=$(builddir) \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 CLEANFILES = $(BUILT_GIRSOURCES) $(typelibs_DATA)
diff --git a/gst-libs/gst/fft/Makefile.in b/gst-libs/gst/fft/Makefile.in
index 3301da4..3692e96 100644
--- a/gst-libs/gst/fft/Makefile.in
+++ b/gst-libs/gst/fft/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -18,6 +17,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -36,9 +52,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst-libs/gst/fft
 DIST_COMMON = $(libgstfft_@GST_MAJORMINOR@_include_HEADERS) \
-	$(noinst_HEADERS) $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+	$(noinst_HEADERS) $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -136,10 +154,23 @@ libgstfft_@GST_MAJORMINOR@_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstfft_@GST_MAJORMINOR@_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(libgstfft_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) \
 	$(libgstfft_@GST_MAJORMINOR@_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -152,22 +183,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstfft_@GST_MAJORMINOR@_la_SOURCES)
 DIST_SOURCES = $(libgstfft_@GST_MAJORMINOR@_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DATA = $(gir_DATA) $(typelibs_DATA)
 HEADERS = $(libgstfft_@GST_MAJORMINOR@_include_HEADERS) \
 	$(noinst_HEADERS)
@@ -462,7 +494,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -556,7 +592,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(MKDIR_P) "$(DESTDIR)$(libdir)"
 	@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -564,6 +599,8 @@ install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libdir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(libdir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(libdir)"; \
 	}
@@ -579,12 +616,14 @@ uninstall-libLTLIBRARIES:
 
 clean-libLTLIBRARIES:
 	-test -z "$(lib_LTLIBRARIES)" || rm -f $(lib_LTLIBRARIES)
-	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(lib_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstfft-@GST_MAJORMINOR@.la: $(libgstfft_@GST_MAJORMINOR@_la_OBJECTS) $(libgstfft_@GST_MAJORMINOR@_la_DEPENDENCIES) $(EXTRA_libgstfft_@GST_MAJORMINOR@_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstfft_@GST_MAJORMINOR@_la_LINK) -rpath $(libdir) $(libgstfft_@GST_MAJORMINOR@_la_OBJECTS) $(libgstfft_@GST_MAJORMINOR@_la_LIBADD) $(LIBS)
 
@@ -727,8 +766,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-girDATA: $(gir_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(girdir)" || $(MKDIR_P) "$(DESTDIR)$(girdir)"
 	@list='$(gir_DATA)'; test -n "$(girdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(girdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(girdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -745,8 +787,11 @@ uninstall-girDATA:
 	dir='$(DESTDIR)$(girdir)'; $(am__uninstall_files_from_dir)
 install-typelibsDATA: $(typelibs_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(typelibsdir)" || $(MKDIR_P) "$(DESTDIR)$(typelibsdir)"
 	@list='$(typelibs_DATA)'; test -n "$(typelibsdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(typelibsdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(typelibsdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -763,8 +808,11 @@ uninstall-typelibsDATA:
 	dir='$(DESTDIR)$(typelibsdir)'; $(am__uninstall_files_from_dir)
 install-libgstfft_@GST_MAJORMINOR@_includeHEADERS: $(libgstfft_@GST_MAJORMINOR@_include_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstfft_@GST_MAJORMINOR@_includedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstfft_@GST_MAJORMINOR@_includedir)"
 	@list='$(libgstfft_@GST_MAJORMINOR@_include_HEADERS)'; test -n "$(libgstfft_@GST_MAJORMINOR@_includedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstfft_@GST_MAJORMINOR@_includedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstfft_@GST_MAJORMINOR@_includedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -829,6 +877,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -978,7 +1040,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libLTLIBRARIES clean-libtool ctags distclean \
+	clean-libLTLIBRARIES clean-libtool cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
@@ -1004,7 +1066,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 @HAVE_INTROSPECTION_TRUE@		--nsversion=@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--strip-prefix=Gst \
 @HAVE_INTROSPECTION_TRUE@		$(gir_cincludes) \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		--library=libgstfft-@GST_MAJORMINOR@.la \
 @HAVE_INTROSPECTION_TRUE@		--include=Gst-@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--libtool="$(top_builddir)/libtool" \
@@ -1019,7 +1081,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(srcdir) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir) \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 Android.mk: Makefile.am
diff --git a/gst-libs/gst/floatcast/Makefile.in b/gst-libs/gst/floatcast/Makefile.in
index b4229bb..0cb1d9a 100644
--- a/gst-libs/gst/floatcast/Makefile.in
+++ b/gst-libs/gst/floatcast/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,6 +50,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst-libs/gst/floatcast
 DIST_COMMON = $(floatcastinclude_HEADERS) $(srcdir)/Makefile.am \
 	$(srcdir)/Makefile.in
@@ -81,14 +98,25 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
 am__vpath_adj = case $$p in \
     $(srcdir)/*) f=`echo "$$p" | sed "s|^$$srcdirstrip/||"`;; \
@@ -409,7 +437,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -456,8 +488,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-floatcastincludeHEADERS: $(floatcastinclude_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(floatcastincludedir)" || $(MKDIR_P) "$(DESTDIR)$(floatcastincludedir)"
 	@list='$(floatcastinclude_HEADERS)'; test -n "$(floatcastincludedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(floatcastincludedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(floatcastincludedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -522,6 +557,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -661,7 +710,7 @@ uninstall-am: uninstall-floatcastincludeHEADERS
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool ctags distclean distclean-generic \
+	clean-libtool cscopelist ctags distclean distclean-generic \
 	distclean-libtool distclean-tags distdir dvi dvi-am html \
 	html-am info info-am install install-am install-data \
 	install-data-am install-dvi install-dvi-am install-exec \
diff --git a/gst-libs/gst/interfaces/Makefile.am b/gst-libs/gst/interfaces/Makefile.am
index a51b029..ca600c2 100644
--- a/gst-libs/gst/interfaces/Makefile.am
+++ b/gst-libs/gst/interfaces/Makefile.am
@@ -89,7 +89,7 @@ GstInterfaces-@GST_MAJORMINOR@.gir: $(INTROSPECTION_SCANNER) libgstinterfaces-@G
 		$(gir_cincludes) \
 		-I$(top_srcdir)/gst-libs \
 		-I$(top_builddir)/gst-libs \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 		--library=libgstinterfaces-@GST_MAJORMINOR@.la \
 		--include=Gst-@GST_MAJORMINOR@ \
 		--libtool="$(top_builddir)/libtool" \
@@ -114,7 +114,7 @@ typelibs_DATA = $(BUILT_GIRSOURCES:.gir=.typelib)
 		$(INTROSPECTION_COMPILER) \
 		--includedir=$(srcdir) \
 		--includedir=$(builddir) \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 CLEANFILES += $(BUILT_GIRSOURCES) $(typelibs_DATA)
diff --git a/gst-libs/gst/interfaces/Makefile.in b/gst-libs/gst/interfaces/Makefile.in
index 84ff57b..91b65a8 100644
--- a/gst-libs/gst/interfaces/Makefile.in
+++ b/gst-libs/gst/interfaces/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -26,6 +25,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -44,8 +60,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(libgstinterfacesinclude_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/gst-glib-gen.mak
+	$(srcdir)/Makefile.in $(top_srcdir)/common/gst-glib-gen.mak \
+	$(top_srcdir)/depcomp
 @HAVE_INTROSPECTION_TRUE@am__append_1 = $(BUILT_GIRSOURCES) $(typelibs_DATA)
 subdir = gst-libs/gst/interfaces
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
@@ -152,11 +170,24 @@ libgstinterfaces_@GST_MAJORMINOR@_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstinterfaces_@GST_MAJORMINOR@_la_LINK = $(LIBTOOL) $(AM_V_lt) \
 	--tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstinterfaces_@GST_MAJORMINOR@_la_CFLAGS) \
 	$(CFLAGS) $(libgstinterfaces_@GST_MAJORMINOR@_la_LDFLAGS) \
 	$(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -169,23 +200,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstinterfaces_@GST_MAJORMINOR@_la_SOURCES) \
 	$(nodist_libgstinterfaces_@GST_MAJORMINOR@_la_SOURCES)
 DIST_SOURCES = $(libgstinterfaces_@GST_MAJORMINOR@_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DATA = $(gir_DATA) $(typelibs_DATA)
 HEADERS = $(libgstinterfacesinclude_HEADERS) \
 	$(nodist_libgstinterfacesinclude_HEADERS)
@@ -480,7 +512,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -610,7 +646,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(MKDIR_P) "$(DESTDIR)$(libdir)"
 	@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -618,6 +653,8 @@ install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libdir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(libdir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(libdir)"; \
 	}
@@ -633,12 +670,14 @@ uninstall-libLTLIBRARIES:
 
 clean-libLTLIBRARIES:
 	-test -z "$(lib_LTLIBRARIES)" || rm -f $(lib_LTLIBRARIES)
-	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(lib_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstinterfaces-@GST_MAJORMINOR@.la: $(libgstinterfaces_@GST_MAJORMINOR@_la_OBJECTS) $(libgstinterfaces_@GST_MAJORMINOR@_la_DEPENDENCIES) $(EXTRA_libgstinterfaces_@GST_MAJORMINOR@_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstinterfaces_@GST_MAJORMINOR@_la_LINK) -rpath $(libdir) $(libgstinterfaces_@GST_MAJORMINOR@_la_OBJECTS) $(libgstinterfaces_@GST_MAJORMINOR@_la_LIBADD) $(LIBS)
 
@@ -797,8 +836,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-girDATA: $(gir_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(girdir)" || $(MKDIR_P) "$(DESTDIR)$(girdir)"
 	@list='$(gir_DATA)'; test -n "$(girdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(girdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(girdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -815,8 +857,11 @@ uninstall-girDATA:
 	dir='$(DESTDIR)$(girdir)'; $(am__uninstall_files_from_dir)
 install-typelibsDATA: $(typelibs_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(typelibsdir)" || $(MKDIR_P) "$(DESTDIR)$(typelibsdir)"
 	@list='$(typelibs_DATA)'; test -n "$(typelibsdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(typelibsdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(typelibsdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -833,8 +878,11 @@ uninstall-typelibsDATA:
 	dir='$(DESTDIR)$(typelibsdir)'; $(am__uninstall_files_from_dir)
 install-libgstinterfacesincludeHEADERS: $(libgstinterfacesinclude_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstinterfacesincludedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstinterfacesincludedir)"
 	@list='$(libgstinterfacesinclude_HEADERS)'; test -n "$(libgstinterfacesincludedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstinterfacesincludedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstinterfacesincludedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -851,8 +899,11 @@ uninstall-libgstinterfacesincludeHEADERS:
 	dir='$(DESTDIR)$(libgstinterfacesincludedir)'; $(am__uninstall_files_from_dir)
 install-nodist_libgstinterfacesincludeHEADERS: $(nodist_libgstinterfacesinclude_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstinterfacesincludedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstinterfacesincludedir)"
 	@list='$(nodist_libgstinterfacesinclude_HEADERS)'; test -n "$(libgstinterfacesincludedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstinterfacesincludedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstinterfacesincludedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -917,6 +968,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -1071,7 +1136,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libLTLIBRARIES clean-libtool ctags distclean \
+	clean-libLTLIBRARIES clean-libtool cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
@@ -1136,7 +1201,7 @@ $(glib_gen_basename)-enumtypes.c: $(glib_enum_headers)
 @HAVE_INTROSPECTION_TRUE@		$(gir_cincludes) \
 @HAVE_INTROSPECTION_TRUE@		-I$(top_srcdir)/gst-libs \
 @HAVE_INTROSPECTION_TRUE@		-I$(top_builddir)/gst-libs \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		--library=libgstinterfaces-@GST_MAJORMINOR@.la \
 @HAVE_INTROSPECTION_TRUE@		--include=Gst-@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--libtool="$(top_builddir)/libtool" \
@@ -1152,7 +1217,7 @@ $(glib_gen_basename)-enumtypes.c: $(glib_enum_headers)
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(srcdir) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir) \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst-libs/gst/interfaces/colorbalance.c b/gst-libs/gst/interfaces/colorbalance.c
index 0bf52a9..464d737 100644
--- a/gst-libs/gst/interfaces/colorbalance.c
+++ b/gst-libs/gst/interfaces/colorbalance.c
@@ -102,13 +102,15 @@ gst_color_balance_class_init (GstColorBalanceClass * klass)
 
     initialized = TRUE;
   }
-
+#ifndef GST_REMOVE_DEPRECATED
   klass->balance_type = GST_COLOR_BALANCE_SOFTWARE;
+#endif
 
   /* default virtual functions */
   klass->list_channels = NULL;
   klass->set_value = NULL;
   klass->get_value = NULL;
+  klass->get_balance_type = NULL;
 }
 
 /**
@@ -212,7 +214,14 @@ gst_color_balance_get_balance_type (GstColorBalance * balance)
 
   klass = GST_COLOR_BALANCE_GET_CLASS (balance);
 
+  if (klass->get_balance_type)
+    return klass->get_balance_type (balance);
+
+#ifndef GST_REMOVE_DEPRECATED
   return klass->balance_type;
+#else
+  g_return_val_if_reached (GST_COLOR_BALANCE_SOFTWARE);
+#endif
 }
 
 /**
diff --git a/gst-libs/gst/interfaces/colorbalance.h b/gst-libs/gst/interfaces/colorbalance.h
index 62771b5..9f0a1cd 100644
--- a/gst-libs/gst/interfaces/colorbalance.h
+++ b/gst-libs/gst/interfaces/colorbalance.h
@@ -80,7 +80,10 @@ typedef enum
 struct _GstColorBalanceClass {
   GTypeInterface klass;
 
+/* FIXME 0.11: Remove this */
+#ifndef GST_REMOVE_DEPRECATED
   GstColorBalanceType balance_type;
+#endif
 
   /* virtual functions */
   const GList * (* list_channels) (GstColorBalance        *balance);
@@ -96,8 +99,10 @@ struct _GstColorBalanceClass {
                           GstColorBalanceChannel *channel,
                           gint                    value);
 
+  GstColorBalanceType (*get_balance_type)  (GstColorBalance *balance);
+
   /*< private >*/
-  gpointer _gst_reserved[GST_PADDING];
+  gpointer _gst_reserved[GST_PADDING-1];
 };
 
 GType   gst_color_balance_get_type      (void);
diff --git a/gst-libs/gst/interfaces/mixer.c b/gst-libs/gst/interfaces/mixer.c
index 0c6abf0..5b8aeed 100644
--- a/gst-libs/gst/interfaces/mixer.c
+++ b/gst-libs/gst/interfaces/mixer.c
@@ -134,7 +134,9 @@ gst_mixer_class_init (GstMixerClass * klass)
   }
 #endif
 
+#ifndef GST_REMOVE_DEPRECATED
   klass->mixer_type = GST_MIXER_SOFTWARE;
+#endif
 
   /* default virtual functions */
   klass->list_tracks = NULL;
@@ -355,7 +357,14 @@ gst_mixer_get_mixer_type (GstMixer * mixer)
 {
   GstMixerClass *klass = GST_MIXER_GET_CLASS (mixer);
 
+  if (klass->get_mixer_type)
+    return klass->get_mixer_type (mixer);
+
+#ifndef GST_REMOVE_DEPRECATED
   return klass->mixer_type;
+#else
+  g_return_if_reached (GST_MIXER_TYPE_SOFTWARE);
+#endif
 }
 
 /**
diff --git a/gst-libs/gst/interfaces/mixer.h b/gst-libs/gst/interfaces/mixer.h
index 71c8f75..491c14c 100644
--- a/gst-libs/gst/interfaces/mixer.h
+++ b/gst-libs/gst/interfaces/mixer.h
@@ -117,7 +117,10 @@ typedef enum
 struct _GstMixerClass {
   GTypeInterface klass;
 
+/* FIXME 0.11: Remove this */
+#ifndef GST_REMOVE_DEPRECATED
   GstMixerType mixer_type;
+#endif
 
   /* virtual functions */
   const GList *  (* list_tracks)   (GstMixer      *mixer);
@@ -166,8 +169,10 @@ struct _GstMixerClass {
 
   GstMixerFlags (* get_mixer_flags) (GstMixer *mixer);
 
+  GstMixerType  (* get_mixer_type)  (GstMixer *mixer);
+
   /*< private >*/
-  gpointer _gst_reserved[GST_PADDING-1];
+  gpointer _gst_reserved[GST_PADDING-2];
 };
 
 GType           gst_mixer_get_type      (void);
diff --git a/gst-libs/gst/interfaces/navigation.h b/gst-libs/gst/interfaces/navigation.h
index b4eaca5..4b21441 100644
--- a/gst-libs/gst/interfaces/navigation.h
+++ b/gst-libs/gst/interfaces/navigation.h
@@ -44,7 +44,7 @@ typedef struct _GstNavigationInterface GstNavigationInterface;
  * @g_iface: the parent interface
  * @send_event: sending a navigation event
  *
- * Color-balance interface.
+ * Navigation interface.
  */
 struct _GstNavigationInterface {
   GTypeInterface g_iface;
diff --git a/gst-libs/gst/interfaces/xoverlay.c b/gst-libs/gst/interfaces/xoverlay.c
index 77c9e75..a5d9d60 100644
--- a/gst-libs/gst/interfaces/xoverlay.c
+++ b/gst-libs/gst/interfaces/xoverlay.c
@@ -148,8 +148,11 @@
  * #ifdef GDK_WINDOWING_X11
  * #include &lt;gdk/gdkx.h&gt;  // for GDK_WINDOW_XID
  * #endif
+ * #ifdef GDK_WINDOWING_WIN32
+ * #include &lt;gdk/gdkwin32.h&gt;  // for GDK_WINDOW_HWND
+ * #endif
  * ...
- * static gulong video_window_xid = 0;
+ * static guintptr video_window_handle = 0;
  * ...
  * static GstBusSyncReply
  * bus_sync_handler (GstBus * bus, GstMessage * message, gpointer user_data)
@@ -160,14 +163,14 @@
  *  if (!gst_structure_has_name (message-&gt;structure, "prepare-xwindow-id"))
  *    return GST_BUS_PASS;
  *
- *  if (video_window_xid != 0) {
+ *  if (video_window_handle != 0) {
  *    GstXOverlay *xoverlay;
  *
  *    // GST_MESSAGE_SRC (message) will be the video sink element
  *    xoverlay = GST_X_OVERLAY (GST_MESSAGE_SRC (message));
- *    gst_x_overlay_set_window_handle (xoverlay, video_window_xid);
+ *    gst_x_overlay_set_window_handle (xoverlay, video_window_handle);
  *  } else {
- *    g_warning ("Should have obtained video_window_xid by now!");
+ *    g_warning ("Should have obtained video_window_handle by now!");
  *  }
  *
  *  gst_message_unref (message);
@@ -178,6 +181,8 @@
  * video_widget_realize_cb (GtkWidget * widget, gpointer data)
  * {
  * #if GTK_CHECK_VERSION(2,18,0)
+ *   // Tell Gtk+/Gdk to create a native window for this widget instead of
+ *   // drawing onto the parent widget.
  *   // This is here just for pedagogical purposes, GDK_WINDOW_XID will call
  *   // it as well in newer Gtk versions
  *   if (!gdk_window_ensure_native (widget->window))
@@ -185,7 +190,16 @@
  * #endif
  *
  * #ifdef GDK_WINDOWING_X11
- *   video_window_xid = GDK_WINDOW_XID (gtk_widget_get_window (video_window));
+ *   {
+ *     gulong xid = GDK_WINDOW_XID (gtk_widget_get_window (video_window));
+ *     video_window_handle = xid;
+ *   }
+ * #endif
+ * #ifdef GDK_WINDOWING_WIN32
+ *   {
+ *     HWND wnd = GDK_WINDOW_HWND (gtk_widget_get_window (video_window));
+ *     video_window_handle = (guintptr) wnd;
+ *   }
  * #endif
  * }
  * ...
@@ -211,12 +225,12 @@
  *   gtk_widget_show_all (app_window);
  *
  *   // realize window now so that the video window gets created and we can
- *   // obtain its XID before the pipeline is started up and the videosink
- *   // asks for the XID of the window to render onto
+ *   // obtain its XID/HWND before the pipeline is started up and the videosink
+ *   // asks for the XID/HWND of the window to render onto
  *   gtk_widget_realize (video_window);
  *
- *   // we should have the XID now
- *   g_assert (video_window_xid != 0);
+ *   // we should have the XID/HWND now
+ *   g_assert (video_window_handle != 0);
  *   ...
  *   // set up sync handler for setting the xid once the pipeline is started
  *   bus = gst_pipeline_get_bus (GST_PIPELINE (pipeline));
diff --git a/gst-libs/gst/netbuffer/Makefile.am b/gst-libs/gst/netbuffer/Makefile.am
index 086a86b..15017a7 100644
--- a/gst-libs/gst/netbuffer/Makefile.am
+++ b/gst-libs/gst/netbuffer/Makefile.am
@@ -23,7 +23,7 @@ GstNetbuffer-@GST_MAJORMINOR@.gir: $(INTROSPECTION_SCANNER) libgstnetbuffer-@GST
 		--nsversion=@GST_MAJORMINOR@ \
 		--strip-prefix=Gst \
 		$(gir_cincludes) \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 		--library=libgstnetbuffer-@GST_MAJORMINOR@.la \
 		--include=Gst-@GST_MAJORMINOR@ \
 		--libtool="$(top_builddir)/libtool" \
@@ -48,7 +48,7 @@ typelibs_DATA = $(BUILT_GIRSOURCES:.gir=.typelib)
 		$(INTROSPECTION_COMPILER) \
 		--includedir=$(srcdir) \
 		--includedir=$(builddir) \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 CLEANFILES = $(BUILT_GIRSOURCES) $(typelibs_DATA)
diff --git a/gst-libs/gst/netbuffer/Makefile.in b/gst-libs/gst/netbuffer/Makefile.in
index 80684ff..b50857d 100644
--- a/gst-libs/gst/netbuffer/Makefile.in
+++ b/gst-libs/gst/netbuffer/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -18,6 +17,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -36,9 +52,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst-libs/gst/netbuffer
 DIST_COMMON = README $(libgstnetbufferinclude_HEADERS) \
-	$(srcdir)/Makefile.am $(srcdir)/Makefile.in
+	$(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -124,11 +142,24 @@ libgstnetbuffer_@GST_MAJORMINOR@_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstnetbuffer_@GST_MAJORMINOR@_la_LINK = $(LIBTOOL) $(AM_V_lt) \
 	--tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstnetbuffer_@GST_MAJORMINOR@_la_CFLAGS) \
 	$(CFLAGS) $(libgstnetbuffer_@GST_MAJORMINOR@_la_LDFLAGS) \
 	$(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -141,22 +172,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstnetbuffer_@GST_MAJORMINOR@_la_SOURCES)
 DIST_SOURCES = $(libgstnetbuffer_@GST_MAJORMINOR@_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DATA = $(gir_DATA) $(typelibs_DATA)
 HEADERS = $(libgstnetbufferinclude_HEADERS)
 ETAGS = etags
@@ -450,7 +482,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -509,7 +545,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(MKDIR_P) "$(DESTDIR)$(libdir)"
 	@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -517,6 +552,8 @@ install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libdir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(libdir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(libdir)"; \
 	}
@@ -532,12 +569,14 @@ uninstall-libLTLIBRARIES:
 
 clean-libLTLIBRARIES:
 	-test -z "$(lib_LTLIBRARIES)" || rm -f $(lib_LTLIBRARIES)
-	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(lib_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstnetbuffer-@GST_MAJORMINOR@.la: $(libgstnetbuffer_@GST_MAJORMINOR@_la_OBJECTS) $(libgstnetbuffer_@GST_MAJORMINOR@_la_DEPENDENCIES) $(EXTRA_libgstnetbuffer_@GST_MAJORMINOR@_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstnetbuffer_@GST_MAJORMINOR@_la_LINK) -rpath $(libdir) $(libgstnetbuffer_@GST_MAJORMINOR@_la_OBJECTS) $(libgstnetbuffer_@GST_MAJORMINOR@_la_LIBADD) $(LIBS)
 
@@ -584,8 +623,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-girDATA: $(gir_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(girdir)" || $(MKDIR_P) "$(DESTDIR)$(girdir)"
 	@list='$(gir_DATA)'; test -n "$(girdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(girdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(girdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -602,8 +644,11 @@ uninstall-girDATA:
 	dir='$(DESTDIR)$(girdir)'; $(am__uninstall_files_from_dir)
 install-typelibsDATA: $(typelibs_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(typelibsdir)" || $(MKDIR_P) "$(DESTDIR)$(typelibsdir)"
 	@list='$(typelibs_DATA)'; test -n "$(typelibsdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(typelibsdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(typelibsdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -620,8 +665,11 @@ uninstall-typelibsDATA:
 	dir='$(DESTDIR)$(typelibsdir)'; $(am__uninstall_files_from_dir)
 install-libgstnetbufferincludeHEADERS: $(libgstnetbufferinclude_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstnetbufferincludedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstnetbufferincludedir)"
 	@list='$(libgstnetbufferinclude_HEADERS)'; test -n "$(libgstnetbufferincludedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstnetbufferincludedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstnetbufferincludedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -686,6 +734,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -833,7 +895,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libLTLIBRARIES clean-libtool ctags distclean \
+	clean-libLTLIBRARIES clean-libtool cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
@@ -857,7 +919,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 @HAVE_INTROSPECTION_TRUE@		--nsversion=@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--strip-prefix=Gst \
 @HAVE_INTROSPECTION_TRUE@		$(gir_cincludes) \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		--library=libgstnetbuffer-@GST_MAJORMINOR@.la \
 @HAVE_INTROSPECTION_TRUE@		--include=Gst-@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--libtool="$(top_builddir)/libtool" \
@@ -873,7 +935,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(srcdir) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir) \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst-libs/gst/pbutils/Makefile.am b/gst-libs/gst/pbutils/Makefile.am
index 1ed49ab..fd676c8 100644
--- a/gst-libs/gst/pbutils/Makefile.am
+++ b/gst-libs/gst/pbutils/Makefile.am
@@ -81,9 +81,9 @@ GstPbutils-@GST_MAJORMINOR@.gir: $(INTROSPECTION_SCANNER) libgstpbutils-@GST_MAJ
 		$(gir_cincludes) \
 		-I$(top_srcdir)/gst-libs \
 		-I$(top_builddir)/gst-libs \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 		--library=libgstpbutils-@GST_MAJORMINOR@.la \
-		--library-path=`$(PKG_CONFIG) --variable=libdir gstreamer-@GST_MAJORMINOR@` \
+		--library-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=libdir gstreamer-@GST_MAJORMINOR@` \
 		--library=gstreamer-@GST_MAJORMINOR@ \
 		--include=Gst-@GST_MAJORMINOR@ \
 		--libtool="$(top_builddir)/libtool" \
@@ -108,7 +108,7 @@ typelibs_DATA = $(BUILT_GIRSOURCES:.gir=.typelib)
 		$(INTROSPECTION_COMPILER) \
 		--includedir=$(srcdir) \
 		--includedir=$(builddir) \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 CLEANFILES += $(BUILT_GIRSOURCES) $(typelibs_DATA)
diff --git a/gst-libs/gst/pbutils/Makefile.in b/gst-libs/gst/pbutils/Makefile.in
index 3c716c0..6f7a0c5 100644
--- a/gst-libs/gst/pbutils/Makefile.in
+++ b/gst-libs/gst/pbutils/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -26,6 +25,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -44,10 +60,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(libgstpbutils_@GST_MAJORMINOR@include_HEADERS) \
 	$(noinst_HEADERS) $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
 	$(srcdir)/gstpluginsbaseversion.h.in \
-	$(top_srcdir)/common/gst-glib-gen.mak
+	$(top_srcdir)/common/gst-glib-gen.mak $(top_srcdir)/depcomp
 @HAVE_INTROSPECTION_TRUE@am__append_1 = $(BUILT_GIRSOURCES) $(typelibs_DATA)
 subdir = gst-libs/gst/pbutils
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
@@ -149,10 +166,23 @@ libgstpbutils_@GST_MAJORMINOR@_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstpbutils_@GST_MAJORMINOR@_la_LINK = $(LIBTOOL) $(AM_V_lt) \
 	--tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstpbutils_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) \
 	$(libgstpbutils_@GST_MAJORMINOR@_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -165,23 +195,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstpbutils_@GST_MAJORMINOR@_la_SOURCES) \
 	$(nodist_libgstpbutils_@GST_MAJORMINOR@_la_SOURCES)
 DIST_SOURCES = $(libgstpbutils_@GST_MAJORMINOR@_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DATA = $(gir_DATA) $(typelibs_DATA)
 HEADERS = $(libgstpbutils_@GST_MAJORMINOR@include_HEADERS) \
 	$(nodist_libgstpbutils_@GST_MAJORMINOR@include_HEADERS) \
@@ -477,7 +508,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -603,7 +638,6 @@ gstpluginsbaseversion.h: $(top_builddir)/config.status $(srcdir)/gstpluginsbasev
 	cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(MKDIR_P) "$(DESTDIR)$(libdir)"
 	@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -611,6 +645,8 @@ install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libdir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(libdir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(libdir)"; \
 	}
@@ -626,12 +662,14 @@ uninstall-libLTLIBRARIES:
 
 clean-libLTLIBRARIES:
 	-test -z "$(lib_LTLIBRARIES)" || rm -f $(lib_LTLIBRARIES)
-	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(lib_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstpbutils-@GST_MAJORMINOR@.la: $(libgstpbutils_@GST_MAJORMINOR@_la_OBJECTS) $(libgstpbutils_@GST_MAJORMINOR@_la_DEPENDENCIES) $(EXTRA_libgstpbutils_@GST_MAJORMINOR@_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstpbutils_@GST_MAJORMINOR@_la_LINK) -rpath $(libdir) $(libgstpbutils_@GST_MAJORMINOR@_la_OBJECTS) $(libgstpbutils_@GST_MAJORMINOR@_la_LIBADD) $(LIBS)
 
@@ -766,8 +804,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-girDATA: $(gir_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(girdir)" || $(MKDIR_P) "$(DESTDIR)$(girdir)"
 	@list='$(gir_DATA)'; test -n "$(girdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(girdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(girdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -784,8 +825,11 @@ uninstall-girDATA:
 	dir='$(DESTDIR)$(girdir)'; $(am__uninstall_files_from_dir)
 install-typelibsDATA: $(typelibs_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(typelibsdir)" || $(MKDIR_P) "$(DESTDIR)$(typelibsdir)"
 	@list='$(typelibs_DATA)'; test -n "$(typelibsdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(typelibsdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(typelibsdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -802,8 +846,11 @@ uninstall-typelibsDATA:
 	dir='$(DESTDIR)$(typelibsdir)'; $(am__uninstall_files_from_dir)
 install-libgstpbutils_@GST_MAJORMINOR@includeHEADERS: $(libgstpbutils_@GST_MAJORMINOR@include_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstpbutils_@GST_MAJORMINOR@includedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstpbutils_@GST_MAJORMINOR@includedir)"
 	@list='$(libgstpbutils_@GST_MAJORMINOR@include_HEADERS)'; test -n "$(libgstpbutils_@GST_MAJORMINOR@includedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstpbutils_@GST_MAJORMINOR@includedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstpbutils_@GST_MAJORMINOR@includedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -820,8 +867,11 @@ uninstall-libgstpbutils_@GST_MAJORMINOR@includeHEADERS:
 	dir='$(DESTDIR)$(libgstpbutils_@GST_MAJORMINOR@includedir)'; $(am__uninstall_files_from_dir)
 install-nodist_libgstpbutils_@GST_MAJORMINOR@includeHEADERS: $(nodist_libgstpbutils_@GST_MAJORMINOR@include_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstpbutils_@GST_MAJORMINOR@includedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstpbutils_@GST_MAJORMINOR@includedir)"
 	@list='$(nodist_libgstpbutils_@GST_MAJORMINOR@include_HEADERS)'; test -n "$(libgstpbutils_@GST_MAJORMINOR@includedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstpbutils_@GST_MAJORMINOR@includedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstpbutils_@GST_MAJORMINOR@includedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -886,6 +936,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -1041,7 +1105,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libLTLIBRARIES clean-libtool ctags distclean \
+	clean-libLTLIBRARIES clean-libtool cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
@@ -1108,9 +1172,9 @@ $(glib_gen_basename)-enumtypes.c: $(glib_enum_headers)
 @HAVE_INTROSPECTION_TRUE@		$(gir_cincludes) \
 @HAVE_INTROSPECTION_TRUE@		-I$(top_srcdir)/gst-libs \
 @HAVE_INTROSPECTION_TRUE@		-I$(top_builddir)/gst-libs \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		--library=libgstpbutils-@GST_MAJORMINOR@.la \
-@HAVE_INTROSPECTION_TRUE@		--library-path=`$(PKG_CONFIG) --variable=libdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--library-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=libdir gstreamer-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		--library=gstreamer-@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--include=Gst-@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--libtool="$(top_builddir)/libtool" \
@@ -1126,7 +1190,7 @@ $(glib_gen_basename)-enumtypes.c: $(glib_enum_headers)
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(srcdir) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir) \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst-libs/gst/pbutils/descriptions.c b/gst-libs/gst/pbutils/descriptions.c
index 63f5aa6..bb33de3 100644
--- a/gst-libs/gst/pbutils/descriptions.c
+++ b/gst-libs/gst/pbutils/descriptions.c
@@ -109,6 +109,7 @@ static const FormatInfo formats[] = {
   {"audio/x-dts", "DTS", 0},
   {"audio/x-private1-dts", "DTS", 0},
   {"audio/x-dv", "DV Audio", 0},
+  {"audio/x-eac3", "E-AC-3 (ATSC A/52B)", 0},
   {"audio/x-flac", N_("Free Lossless Audio Codec (FLAC)"), 0},
   {"audio/x-gsm", "GSM", 0},
   {"audio/x-iec958", "S/PDIF IEC958", 0},       /* TODO: check description */
@@ -234,13 +235,19 @@ static const FormatInfo formats[] = {
   {"image/vnd.wap.wbmp", "Wireless Bitmap", 0},
 
   /* subtitle formats with static descriptions */
-  {"application/x-ass", "ASS", 0},
+  {"application/x-ssa", "SubStation Alpha", 0},
+  {"application/x-ass", "Advanced SubStation Alpha", 0},
+  /* FIXME: add variant field to typefinder? */
+  {"application/x-subtitle", N_("Subtitle"), 0},
+  {"application/x-subtitle-mpl2", N_("MPL2 subtitle format"), 0},
+  {"application/x-subtitle-dks", N_("DKS subtitle format"), 0},
+  {"application/x-subtitle-qttext", N_("QTtext subtitle format"), 0},
   {"application/x-subtitle-sami", N_("Sami subtitle format"), 0},
   {"application/x-subtitle-tmplayer", N_("TMPlayer subtitle format"), 0},
   {"application/x-kate", "Kate", 0},
   {"subtitle/x-kate", N_("Kate subtitle format"), 0},
   {"subpicture/x-dvb", "DVB subtitles", 0},
-  /* add variant field to typefinder? { "application/x-subtitle", N_("subtitle"), 0}, */
+  {"subpicture/x-pgs", "PGS subtitles", 0},
 
   /* non-audio/video/container formats */
   {"hdv/aux-v", "HDV AUX-V", 0},
diff --git a/gst-libs/gst/pbutils/gstdiscoverer.c b/gst-libs/gst/pbutils/gstdiscoverer.c
index ba02cdb..eba78ef 100644
--- a/gst-libs/gst/pbutils/gstdiscoverer.c
+++ b/gst-libs/gst/pbutils/gstdiscoverer.c
@@ -69,6 +69,12 @@ typedef struct
   GstTagList *tags;
 } PrivateStream;
 
+typedef struct
+{
+  GstPad *pad;
+  gulong id;
+} PadWithId;
+
 struct _GstDiscovererPrivate
 {
   gboolean async;
@@ -87,6 +93,9 @@ struct _GstDiscovererPrivate
   /* TRUE if discoverer has been started */
   gboolean running;
 
+  /* TRUE if ASYNC_DONE has been received (need to check for subtitle tags) */
+  gboolean async_done;
+
   /* current items */
   GstDiscovererInfo *current_info;
   GError *current_error;
@@ -95,6 +104,9 @@ struct _GstDiscovererPrivate
   /* List of private streams */
   GList *streams;
 
+  /* List of these sinks and their handler IDs (to remove the probe) */
+  GList *pending_subtitle_pads;
+
   /* Global elements */
   GstBin *pipeline;
   GstElement *uridecodebin;
@@ -259,9 +271,12 @@ gst_discoverer_init (GstDiscoverer * dc)
 
   dc->priv->timeout = DEFAULT_PROP_TIMEOUT;
   dc->priv->async = FALSE;
+  dc->priv->async_done = FALSE;
 
   dc->priv->lock = g_mutex_new ();
 
+  dc->priv->pending_subtitle_pads = NULL;
+
   GST_LOG ("Creating pipeline");
   dc->priv->pipeline = (GstBin *) gst_pipeline_new ("Discoverer");
   GST_LOG_OBJECT (dc, "Creating uridecodebin");
@@ -457,6 +472,57 @@ is_subtitle_caps (const GstCaps * caps)
 }
 
 static void
+free_pad_id (PadWithId * d)
+{
+
+  gst_pad_remove_data_probe (d->pad, d->id);
+  gst_object_unref (d->pad);
+  g_slice_free (PadWithId, d);
+
+}
+
+static void
+got_subtitle_data (GstPad * pad, GstMiniObject * obj, GstDiscoverer * dc)
+{
+
+  GList *item = NULL;
+  gboolean update;
+  gboolean is_event;
+
+  is_event = GST_IS_EVENT (obj);
+
+  if (!(GST_IS_BUFFER (obj) || (is_event
+              && GST_EVENT_TYPE ((GstEvent *) obj) == GST_EVENT_NEWSEGMENT)))
+    return;
+
+  if (is_event) {
+    gst_event_parse_new_segment ((GstEvent *) obj, &update, NULL, NULL, NULL,
+        NULL, NULL);
+    if (!update)
+      return;
+  }
+
+  DISCO_LOCK (dc);
+  for (item = dc->priv->pending_subtitle_pads; item; item = item->next) {
+    PadWithId *pad_id = (PadWithId *) item->data;
+    if (pad_id->pad == pad) {
+      dc->priv->pending_subtitle_pads =
+          g_list_remove_link (dc->priv->pending_subtitle_pads, item);
+      free_pad_id (pad_id);
+      break;
+    }
+  }
+
+  if (dc->priv->pending_subtitle_pads == NULL) {
+    GstMessage *msg = gst_message_new_application (NULL,
+        gst_structure_empty_new ("DiscovererDone"));
+    gst_element_post_message ((GstElement *) dc->priv->pipeline, msg);
+  }
+  DISCO_UNLOCK (dc);
+
+}
+
+static void
 uridecodebin_pad_added_cb (GstElement * uridecodebin, GstPad * pad,
     GstDiscoverer * dc)
 {
@@ -481,10 +547,23 @@ uridecodebin_pad_added_cb (GstElement * uridecodebin, GstPad * pad,
 
   caps = gst_pad_get_caps_reffed (pad);
 
+  sinkpad = gst_element_get_static_pad (ps->queue, "sink");
+  if (sinkpad == NULL)
+    goto error;
+
   if (is_subtitle_caps (caps)) {
     /* Subtitle streams are sparse and may not provide any information - don't
      * wait for data to preroll */
+    PadWithId *pad_id;
+    pad_id = g_slice_new0 (PadWithId);
+    pad_id->pad = GST_PAD_CAST (gst_object_ref (sinkpad));
+    pad_id->id =
+        gst_pad_add_data_probe (sinkpad, (GCallback) got_subtitle_data, dc);
     g_object_set (ps->sink, "async", FALSE, NULL);
+    DISCO_LOCK (dc);
+    dc->priv->pending_subtitle_pads =
+        g_list_prepend (dc->priv->pending_subtitle_pads, pad_id);
+    DISCO_UNLOCK (dc);
   }
 
   gst_caps_unref (caps);
@@ -499,9 +578,6 @@ uridecodebin_pad_added_cb (GstElement * uridecodebin, GstPad * pad,
   if (!gst_element_sync_state_with_parent (ps->queue))
     goto error;
 
-  sinkpad = gst_element_get_static_pad (ps->queue, "sink");
-  if (sinkpad == NULL)
-    goto error;
   if (gst_pad_link_full (pad, sinkpad,
           GST_PAD_LINK_CHECK_NOTHING) != GST_PAD_LINK_OK)
     goto error;
@@ -1088,8 +1164,8 @@ discoverer_collect (GstDiscoverer * dc)
           gst_caps_get_structure (dc->priv->current_info->stream_info->caps, 0);
 
       if (g_str_has_prefix (gst_structure_get_name (st), "image/"))
-        ((GstDiscovererVideoInfo *) dc->priv->current_info->stream_info)->
-            is_image = TRUE;
+        ((GstDiscovererVideoInfo *) dc->priv->current_info->
+            stream_info)->is_image = TRUE;
     }
   }
 
@@ -1158,8 +1234,15 @@ handle_message (GstDiscoverer * dc, GstMessage * msg)
       /* We need to stop */
       done = TRUE;
 
-      GST_DEBUG ("Setting result to ERROR");
-      dc->priv->current_info->result = GST_DISCOVERER_ERROR;
+      /* Don't override missing plugin result code for missing plugin errors */
+      if (dc->priv->current_info->result != GST_DISCOVERER_MISSING_PLUGINS ||
+          (!g_error_matches (gerr, GST_CORE_ERROR,
+                  GST_CORE_ERROR_MISSING_PLUGIN) &&
+              !g_error_matches (gerr, GST_STREAM_ERROR,
+                  GST_STREAM_ERROR_CODEC_NOT_FOUND))) {
+        GST_DEBUG ("Setting result to ERROR");
+        dc->priv->current_info->result = GST_DISCOVERER_ERROR;
+      }
     }
       break;
 
@@ -1168,10 +1251,30 @@ handle_message (GstDiscoverer * dc, GstMessage * msg)
       done = TRUE;
       break;
 
+    case GST_MESSAGE_APPLICATION:{
+      const gchar *name;
+      gboolean async_done;
+      name = gst_structure_get_name (gst_message_get_structure (msg));
+      /* Maybe ASYNC_DONE is received & we're just waiting for subtitle tags */
+      DISCO_LOCK (dc);
+      async_done = dc->priv->async_done;
+      DISCO_UNLOCK (dc);
+      if (g_str_equal (name, "DiscovererDone") && async_done)
+        return TRUE;
+      break;
+    }
+
     case GST_MESSAGE_ASYNC_DONE:
       if (GST_MESSAGE_SRC (msg) == (GstObject *) dc->priv->pipeline) {
         GST_DEBUG ("Finished changing state asynchronously");
-        done = TRUE;
+        DISCO_LOCK (dc);
+        if (dc->priv->pending_subtitle_pads == NULL) {
+          done = TRUE;
+        } else {
+          /* Remember that ASYNC_DONE has been received, wait for subtitles */
+          dc->priv->async_done = TRUE;
+        }
+        DISCO_UNLOCK (dc);
 
       }
       break;
@@ -1222,7 +1325,6 @@ handle_message (GstDiscoverer * dc, GstMessage * msg)
   return done;
 }
 
-
 static void
 handle_current_sync (GstDiscoverer * dc)
 {
@@ -1309,6 +1411,11 @@ discoverer_cleanup (GstDiscoverer * dc)
 
   dc->priv->current_info = NULL;
 
+  g_list_foreach (dc->priv->pending_subtitle_pads, (GFunc) free_pad_id, NULL);
+  g_list_free (dc->priv->pending_subtitle_pads);
+  dc->priv->pending_subtitle_pads = NULL;
+  dc->priv->async_done = FALSE;
+
   /* Try popping the next uri */
   if (dc->priv->async) {
     if (dc->priv->pending_uris != NULL) {
diff --git a/gst-libs/gst/pbutils/install-plugins.c b/gst-libs/gst/pbutils/install-plugins.c
index 9b5f45e..93965de 100644
--- a/gst-libs/gst/pbutils/install-plugins.c
+++ b/gst-libs/gst/pbutils/install-plugins.c
@@ -569,7 +569,7 @@ gst_install_plugins_return_from_status (gint status)
     ret = (GstInstallPluginsReturn) WEXITSTATUS (status);
 
     /* did the helper return an invalid status code? */
-    if ((ret < 0 || ret >= GST_INSTALL_PLUGINS_STARTED_OK) &&
+    if (((guint) ret) >= GST_INSTALL_PLUGINS_STARTED_OK &&
         ret != GST_INSTALL_PLUGINS_INTERNAL_FAILURE) {
       ret = GST_INSTALL_PLUGINS_INVALID;
     }
diff --git a/gst-libs/gst/riff/Makefile.am b/gst-libs/gst/riff/Makefile.am
index b22fcde..f9d6040 100644
--- a/gst-libs/gst/riff/Makefile.am
+++ b/gst-libs/gst/riff/Makefile.am
@@ -36,8 +36,8 @@ GstRiff-@GST_MAJORMINOR@.gir: $(INTROSPECTION_SCANNER) libgstriff-@GST_MAJORMINO
 		--add-include-path=$(builddir)/../tag \
 		--add-include-path=$(builddir)/../audio \
 		--add-include-path=$(builddir)/../interfaces \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 		--library=libgstriff-@GST_MAJORMINOR@.la \
 		--include=GstAudio-@GST_MAJORMINOR@ \
 		--include=GstTag-@GST_MAJORMINOR@ \
@@ -70,8 +70,8 @@ typelibs_DATA = $(BUILT_GIRSOURCES:.gir=.typelib)
 		--includedir=$(builddir)/../tag \
 		--includedir=$(builddir)/../audio \
 		--includedir=$(builddir)/../interfaces \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 CLEANFILES = $(BUILT_GIRSOURCES) $(typelibs_DATA)
diff --git a/gst-libs/gst/riff/Makefile.in b/gst-libs/gst/riff/Makefile.in
index b358c13..b1b4644 100644
--- a/gst-libs/gst/riff/Makefile.in
+++ b/gst-libs/gst/riff/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -18,6 +17,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -36,9 +52,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst-libs/gst/riff
 DIST_COMMON = $(libgstriff_@GST_MAJORMINOR@include_HEADERS) \
-	$(srcdir)/Makefile.am $(srcdir)/Makefile.in
+	$(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -127,10 +145,23 @@ libgstriff_@GST_MAJORMINOR@_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstriff_@GST_MAJORMINOR@_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(libgstriff_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) \
 	$(libgstriff_@GST_MAJORMINOR@_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -143,22 +174,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstriff_@GST_MAJORMINOR@_la_SOURCES)
 DIST_SOURCES = $(libgstriff_@GST_MAJORMINOR@_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DATA = $(gir_DATA) $(typelibs_DATA)
 HEADERS = $(libgstriff_@GST_MAJORMINOR@include_HEADERS)
 ETAGS = etags
@@ -452,7 +484,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -523,7 +559,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(MKDIR_P) "$(DESTDIR)$(libdir)"
 	@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -531,6 +566,8 @@ install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libdir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(libdir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(libdir)"; \
 	}
@@ -546,12 +583,14 @@ uninstall-libLTLIBRARIES:
 
 clean-libLTLIBRARIES:
 	-test -z "$(lib_LTLIBRARIES)" || rm -f $(lib_LTLIBRARIES)
-	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(lib_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstriff-@GST_MAJORMINOR@.la: $(libgstriff_@GST_MAJORMINOR@_la_OBJECTS) $(libgstriff_@GST_MAJORMINOR@_la_DEPENDENCIES) $(EXTRA_libgstriff_@GST_MAJORMINOR@_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstriff_@GST_MAJORMINOR@_la_LINK) -rpath $(libdir) $(libgstriff_@GST_MAJORMINOR@_la_OBJECTS) $(libgstriff_@GST_MAJORMINOR@_la_LIBADD) $(LIBS)
 
@@ -614,8 +653,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-girDATA: $(gir_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(girdir)" || $(MKDIR_P) "$(DESTDIR)$(girdir)"
 	@list='$(gir_DATA)'; test -n "$(girdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(girdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(girdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -632,8 +674,11 @@ uninstall-girDATA:
 	dir='$(DESTDIR)$(girdir)'; $(am__uninstall_files_from_dir)
 install-typelibsDATA: $(typelibs_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(typelibsdir)" || $(MKDIR_P) "$(DESTDIR)$(typelibsdir)"
 	@list='$(typelibs_DATA)'; test -n "$(typelibsdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(typelibsdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(typelibsdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -650,8 +695,11 @@ uninstall-typelibsDATA:
 	dir='$(DESTDIR)$(typelibsdir)'; $(am__uninstall_files_from_dir)
 install-libgstriff_@GST_MAJORMINOR@includeHEADERS: $(libgstriff_@GST_MAJORMINOR@include_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstriff_@GST_MAJORMINOR@includedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstriff_@GST_MAJORMINOR@includedir)"
 	@list='$(libgstriff_@GST_MAJORMINOR@include_HEADERS)'; test -n "$(libgstriff_@GST_MAJORMINOR@includedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstriff_@GST_MAJORMINOR@includedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstriff_@GST_MAJORMINOR@includedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -716,6 +764,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -865,7 +927,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libLTLIBRARIES clean-libtool ctags distclean \
+	clean-libLTLIBRARIES clean-libtool cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
@@ -894,8 +956,8 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 @HAVE_INTROSPECTION_TRUE@		--add-include-path=$(builddir)/../tag \
 @HAVE_INTROSPECTION_TRUE@		--add-include-path=$(builddir)/../audio \
 @HAVE_INTROSPECTION_TRUE@		--add-include-path=$(builddir)/../interfaces \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		--library=libgstriff-@GST_MAJORMINOR@.la \
 @HAVE_INTROSPECTION_TRUE@		--include=GstAudio-@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--include=GstTag-@GST_MAJORMINOR@ \
@@ -919,8 +981,8 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir)/../tag \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir)/../audio \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir)/../interfaces \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 Android.mk: Makefile.am
diff --git a/gst-libs/gst/riff/riff-ids.h b/gst-libs/gst/riff/riff-ids.h
index 106f71a..9442018 100644
--- a/gst-libs/gst/riff/riff-ids.h
+++ b/gst-libs/gst/riff/riff-ids.h
@@ -96,7 +96,7 @@ G_BEGIN_DECLS
 #define GST_RIFF_INFO_IMED GST_MAKE_FOURCC ('I','M','E','D') /* medium */
 #define GST_RIFF_INFO_INAM GST_MAKE_FOURCC ('I','N','A','M') /* name */
 #define GST_RIFF_INFO_IPLT GST_MAKE_FOURCC ('I','P','L','T') /* palette setting */
-#define GST_RIFF_INFO_IPRD GST_MAKE_FOURCC ('I','P','R','D') /* product */
+#define GST_RIFF_INFO_IPRD GST_MAKE_FOURCC ('I','P','R','D') /* product (album) */
 #define GST_RIFF_INFO_ISBJ GST_MAKE_FOURCC ('I','S','B','J') /* subject */
 #define GST_RIFF_INFO_ISFT GST_MAKE_FOURCC ('I','S','F','T') /* software */
 #define GST_RIFF_INFO_ISHP GST_MAKE_FOURCC ('I','S','H','P') /* sharpness */
@@ -104,6 +104,9 @@ G_BEGIN_DECLS
 #define GST_RIFF_INFO_ISRF GST_MAKE_FOURCC ('I','S','R','F') /* source form */
 #define GST_RIFF_INFO_ITCH GST_MAKE_FOURCC ('I','T','C','H') /* technician(s) */
 
+#define GST_RIFF_INFO_IAAR GST_MAKE_FOURCC ('I','A','A','R') /* album artist */
+#define GST_RIFF_INFO_ITRK GST_MAKE_FOURCC ('I','T','R','K') /* track number */
+
 /*********Chunk Names***************/
 #define GST_RIFF_FF00 GST_MAKE_FOURCC (0xFF,0xFF,0x00,0x00)
 #define GST_RIFF_00   GST_MAKE_FOURCC ('0', '0',0x00,0x00)
diff --git a/gst-libs/gst/riff/riff-media.c b/gst-libs/gst/riff/riff-media.c
index 40b2bf6..53d9c88 100644
--- a/gst-libs/gst/riff/riff-media.c
+++ b/gst-libs/gst/riff/riff-media.c
@@ -104,6 +104,19 @@ gst_riff_create_video_caps (guint32 codec_fcc,
       }
       break;
     }
+    case GST_MAKE_FOURCC ('r', '2', '1', '0'):
+      caps = gst_caps_new_simple ("video/x-raw-rgb",
+          "endianness", G_TYPE_INT, G_BIG_ENDIAN, "depth", G_TYPE_INT, 30,
+          "bpp", G_TYPE_INT, 32,
+          "endianness", G_TYPE_INT, G_BIG_ENDIAN,
+          "red_mask", G_TYPE_INT, 0x3ff00000,
+          "green_mask", G_TYPE_INT, 0x000ffc00,
+          "blue_mask", G_TYPE_INT, 0x000003ff, NULL);
+
+      if (codec_name)
+        *codec_name = g_strdup ("Uncompressed packed RGB 10-bit 4:4:4");
+      break;
+
     case GST_MAKE_FOURCC ('I', '4', '2', '0'):
       caps = gst_caps_new_simple ("video/x-raw-yuv",
           "format", GST_TYPE_FOURCC, codec_fcc, NULL);
@@ -142,6 +155,12 @@ gst_riff_create_video_caps (guint32 codec_fcc,
       if (codec_name)
         *codec_name = g_strdup ("Uncompressed packed YVU 4:2:2");
       break;
+    case GST_MAKE_FOURCC ('v', '2', '1', '0'):
+      caps = gst_caps_new_simple ("video/x-raw-yuv",
+          "format", GST_TYPE_FOURCC, codec_fcc, NULL);
+      if (codec_name)
+        *codec_name = g_strdup ("Uncompressed packed 10-bit YUV 4:2:2");
+      break;
 
     case GST_MAKE_FOURCC ('M', 'J', 'P', 'G'): /* YUY2 MJPEG */
     case GST_MAKE_FOURCC ('A', 'V', 'R', 'n'):
@@ -1828,6 +1847,8 @@ gst_riff_create_video_template_caps (void)
     GST_MAKE_FOURCC ('Y', 'V', '1', '2'),
     GST_MAKE_FOURCC ('L', 'O', 'C', 'O'),
     GST_MAKE_FOURCC ('Z', 'M', 'B', 'V'),
+    GST_MAKE_FOURCC ('v', '2', '1', '0'),
+    GST_MAKE_FOURCC ('r', '2', '1', '0'),
     /* FILL ME */
   };
   guint i;
diff --git a/gst-libs/gst/riff/riff-read.c b/gst-libs/gst/riff/riff-read.c
index 314c19f..746ad93 100644
--- a/gst-libs/gst/riff/riff-read.c
+++ b/gst-libs/gst/riff/riff-read.c
@@ -620,6 +620,9 @@ gst_riff_parse_info (GstElement * element,
   while (size > 8) {
     tag = GST_READ_UINT32_LE (data);
     tsize = GST_READ_UINT32_LE (data + 4);
+
+    GST_MEMDUMP_OBJECT (element, "tag chunk", data, MIN (tsize + 8, size));
+
     size -= 8;
     data += 8;
 
@@ -632,11 +635,17 @@ gst_riff_parse_info (GstElement * element,
       tsize = size;
     }
 
+    /* make uppercase */
+    tag = tag & 0xDFDFDFDF;
+
     /* find out the type of metadata */
     switch (tag) {
       case GST_RIFF_INFO_IARL:
         type = GST_TAG_LOCATION;
         break;
+      case GST_RIFF_INFO_IAAR:
+        type = GST_TAG_ALBUM_ARTIST;
+        break;
       case GST_RIFF_INFO_IART:
         type = GST_TAG_ARTIST;
         break;
@@ -683,10 +692,10 @@ gst_riff_parse_info (GstElement * element,
         type = NULL;            /*"Palette"; */
         break;
       case GST_RIFF_INFO_IPRD:
-        type = NULL;            /*"Product"; */
+        type = GST_TAG_ALBUM;
         break;
       case GST_RIFF_INFO_ISBJ:
-        type = NULL;            /*"Subject"; */
+        type = GST_TAG_ALBUM_ARTIST;
         break;
       case GST_RIFF_INFO_ISFT:
         type = GST_TAG_ENCODER;
@@ -703,6 +712,9 @@ gst_riff_parse_info (GstElement * element,
       case GST_RIFF_INFO_ITCH:
         type = NULL;            /*"Technician"; */
         break;
+      case GST_RIFF_INFO_ITRK:
+        type = GST_TAG_TRACK_NUMBER;
+        break;
       default:
         type = NULL;
         GST_WARNING_OBJECT (element,
@@ -715,12 +727,31 @@ gst_riff_parse_info (GstElement * element,
       static const gchar *env_vars[] = { "GST_AVI_TAG_ENCODING",
         "GST_RIFF_TAG_ENCODING", "GST_TAG_ENCODING", NULL
       };
+      GType tag_type;
       gchar *val;
 
+      GST_DEBUG_OBJECT (element, "mapped tag %" GST_FOURCC_FORMAT " to tag %s",
+          GST_FOURCC_ARGS (tag), type);
+
+      tag_type = gst_tag_get_type (type);
       val = gst_tag_freeform_string_to_utf8 ((gchar *) data, tsize, env_vars);
 
-      if (val) {
-        gst_tag_list_add (taglist, GST_TAG_MERGE_APPEND, type, val, NULL);
+      if (val != NULL) {
+        if (tag_type == G_TYPE_STRING) {
+          gst_tag_list_add (taglist, GST_TAG_MERGE_APPEND, type, val, NULL);
+        } else {
+          GValue tag_val = { 0, };
+
+          g_value_init (&tag_val, tag_type);
+          if (gst_value_deserialize (&tag_val, val)) {
+            gst_tag_list_add_value (taglist, GST_TAG_MERGE_APPEND, type,
+                &tag_val);
+          } else {
+            GST_WARNING_OBJECT (element, "could not deserialize '%s' into a "
+                "tag %s of type %s", val, type, g_type_name (tag_type));
+          }
+          g_value_unset (&tag_val);
+        }
         g_free (val);
       } else {
         GST_WARNING_OBJECT (element, "could not extract %s tag", type);
@@ -738,6 +769,7 @@ gst_riff_parse_info (GstElement * element,
   }
 
   if (!gst_tag_list_is_empty (taglist)) {
+    GST_INFO_OBJECT (element, "extracted tags: %" GST_PTR_FORMAT, taglist);
     *_taglist = taglist;
   } else {
     *_taglist = NULL;
diff --git a/gst-libs/gst/rtp/Makefile.am b/gst-libs/gst/rtp/Makefile.am
index 5e327ae..b0df750 100644
--- a/gst-libs/gst/rtp/Makefile.am
+++ b/gst-libs/gst/rtp/Makefile.am
@@ -35,8 +35,8 @@ GstRtp-@GST_MAJORMINOR@.gir: $(INTROSPECTION_SCANNER) libgstrtp-@GST_MAJORMINOR@
 		--strip-prefix=Gst \
 		$(gir_cincludes) \
 		-I$(top_srcdir)/gst-libs \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 		--library=libgstrtp-@GST_MAJORMINOR@.la \
 		--include=Gst-@GST_MAJORMINOR@ \
 		--include=GstBase-@GST_MAJORMINOR@ \
@@ -63,8 +63,8 @@ typelibs_DATA = $(BUILT_GIRSOURCES:.gir=.typelib)
 		$(INTROSPECTION_COMPILER) \
 		--includedir=$(srcdir) \
 		--includedir=$(builddir) \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 CLEANFILES = $(BUILT_GIRSOURCES) $(typelibs_DATA)
diff --git a/gst-libs/gst/rtp/Makefile.in b/gst-libs/gst/rtp/Makefile.in
index b83d9c7..d1509ac 100644
--- a/gst-libs/gst/rtp/Makefile.in
+++ b/gst-libs/gst/rtp/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -18,6 +17,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -36,9 +52,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst-libs/gst/rtp
 DIST_COMMON = README $(libgstrtpinclude_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -128,10 +145,23 @@ libgstrtp_@GST_MAJORMINOR@_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstrtp_@GST_MAJORMINOR@_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(libgstrtp_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) \
 	$(libgstrtp_@GST_MAJORMINOR@_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -144,22 +174,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstrtp_@GST_MAJORMINOR@_la_SOURCES)
 DIST_SOURCES = $(libgstrtp_@GST_MAJORMINOR@_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DATA = $(gir_DATA) $(typelibs_DATA)
 HEADERS = $(libgstrtpinclude_HEADERS)
 ETAGS = etags
@@ -453,7 +484,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -524,7 +559,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(MKDIR_P) "$(DESTDIR)$(libdir)"
 	@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -532,6 +566,8 @@ install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libdir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(libdir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(libdir)"; \
 	}
@@ -547,12 +583,14 @@ uninstall-libLTLIBRARIES:
 
 clean-libLTLIBRARIES:
 	-test -z "$(lib_LTLIBRARIES)" || rm -f $(lib_LTLIBRARIES)
-	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(lib_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstrtp-@GST_MAJORMINOR@.la: $(libgstrtp_@GST_MAJORMINOR@_la_OBJECTS) $(libgstrtp_@GST_MAJORMINOR@_la_DEPENDENCIES) $(EXTRA_libgstrtp_@GST_MAJORMINOR@_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstrtp_@GST_MAJORMINOR@_la_LINK) -rpath $(libdir) $(libgstrtp_@GST_MAJORMINOR@_la_OBJECTS) $(libgstrtp_@GST_MAJORMINOR@_la_LIBADD) $(LIBS)
 
@@ -639,8 +677,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-girDATA: $(gir_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(girdir)" || $(MKDIR_P) "$(DESTDIR)$(girdir)"
 	@list='$(gir_DATA)'; test -n "$(girdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(girdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(girdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -657,8 +698,11 @@ uninstall-girDATA:
 	dir='$(DESTDIR)$(girdir)'; $(am__uninstall_files_from_dir)
 install-typelibsDATA: $(typelibs_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(typelibsdir)" || $(MKDIR_P) "$(DESTDIR)$(typelibsdir)"
 	@list='$(typelibs_DATA)'; test -n "$(typelibsdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(typelibsdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(typelibsdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -675,8 +719,11 @@ uninstall-typelibsDATA:
 	dir='$(DESTDIR)$(typelibsdir)'; $(am__uninstall_files_from_dir)
 install-libgstrtpincludeHEADERS: $(libgstrtpinclude_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstrtpincludedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstrtpincludedir)"
 	@list='$(libgstrtpinclude_HEADERS)'; test -n "$(libgstrtpincludedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstrtpincludedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstrtpincludedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -741,6 +788,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -888,7 +949,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libLTLIBRARIES clean-libtool ctags distclean \
+	clean-libLTLIBRARIES clean-libtool cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
@@ -913,8 +974,8 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 @HAVE_INTROSPECTION_TRUE@		--strip-prefix=Gst \
 @HAVE_INTROSPECTION_TRUE@		$(gir_cincludes) \
 @HAVE_INTROSPECTION_TRUE@		-I$(top_srcdir)/gst-libs \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		--library=libgstrtp-@GST_MAJORMINOR@.la \
 @HAVE_INTROSPECTION_TRUE@		--include=Gst-@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--include=GstBase-@GST_MAJORMINOR@ \
@@ -932,8 +993,8 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(srcdir) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir) \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst-libs/gst/rtsp/Makefile.am b/gst-libs/gst/rtsp/Makefile.am
index bd27a40..5e42427 100644
--- a/gst-libs/gst/rtsp/Makefile.am
+++ b/gst-libs/gst/rtsp/Makefile.am
@@ -69,7 +69,7 @@ GstRtsp-@GST_MAJORMINOR@.gir: $(INTROSPECTION_SCANNER) libgstrtsp-@GST_MAJORMINO
 		-I$(top_builddir)/gst-libs \
 		-I$(top_srcdir)/gst-libs \
 		--add-include-path=$(builddir)/../sdp \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 		--library=libgstrtsp-@GST_MAJORMINOR@.la \
 		--include=Gst-@GST_MAJORMINOR@ \
 		--include=GstSdp-@GST_MAJORMINOR@ \
@@ -97,7 +97,7 @@ typelibs_DATA = $(BUILT_GIRSOURCES:.gir=.typelib)
 		--includedir=$(srcdir) \
 		--includedir=$(builddir) \
 		--includedir=$(builddir)/../sdp \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 CLEANFILES += $(BUILT_GIRSOURCES) $(typelibs_DATA)
diff --git a/gst-libs/gst/rtsp/Makefile.in b/gst-libs/gst/rtsp/Makefile.in
index 0cd7652..ef779ee 100644
--- a/gst-libs/gst/rtsp/Makefile.in
+++ b/gst-libs/gst/rtsp/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -26,6 +25,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -44,9 +60,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(libgstrtspinclude_HEADERS) $(noinst_HEADERS) \
 	$(srcdir)/Makefile.am $(srcdir)/Makefile.in \
-	$(top_srcdir)/common/gst-glib-gen.mak
+	$(top_srcdir)/common/gst-glib-gen.mak $(top_srcdir)/depcomp
 @HAVE_INTROSPECTION_TRUE@am__append_1 = $(BUILT_GIRSOURCES) $(typelibs_DATA)
 subdir = gst-libs/gst/rtsp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
@@ -145,10 +162,23 @@ libgstrtsp_@GST_MAJORMINOR@_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstrtsp_@GST_MAJORMINOR@_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(libgstrtsp_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) \
 	$(libgstrtsp_@GST_MAJORMINOR@_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -161,23 +191,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstrtsp_@GST_MAJORMINOR@_la_SOURCES) \
 	$(nodist_libgstrtsp_@GST_MAJORMINOR@_la_SOURCES)
 DIST_SOURCES = $(libgstrtsp_@GST_MAJORMINOR@_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DATA = $(gir_DATA) $(typelibs_DATA)
 HEADERS = $(libgstrtspinclude_HEADERS) \
 	$(nodist_libgstrtspinclude_HEADERS) $(noinst_HEADERS)
@@ -472,7 +503,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -576,7 +611,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(MKDIR_P) "$(DESTDIR)$(libdir)"
 	@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -584,6 +618,8 @@ install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libdir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(libdir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(libdir)"; \
 	}
@@ -599,12 +635,14 @@ uninstall-libLTLIBRARIES:
 
 clean-libLTLIBRARIES:
 	-test -z "$(lib_LTLIBRARIES)" || rm -f $(lib_LTLIBRARIES)
-	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(lib_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstrtsp-@GST_MAJORMINOR@.la: $(libgstrtsp_@GST_MAJORMINOR@_la_OBJECTS) $(libgstrtsp_@GST_MAJORMINOR@_la_DEPENDENCIES) $(EXTRA_libgstrtsp_@GST_MAJORMINOR@_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstrtsp_@GST_MAJORMINOR@_la_LINK) -rpath $(libdir) $(libgstrtsp_@GST_MAJORMINOR@_la_OBJECTS) $(libgstrtsp_@GST_MAJORMINOR@_la_LIBADD) $(LIBS)
 
@@ -723,8 +761,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-girDATA: $(gir_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(girdir)" || $(MKDIR_P) "$(DESTDIR)$(girdir)"
 	@list='$(gir_DATA)'; test -n "$(girdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(girdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(girdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -741,8 +782,11 @@ uninstall-girDATA:
 	dir='$(DESTDIR)$(girdir)'; $(am__uninstall_files_from_dir)
 install-typelibsDATA: $(typelibs_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(typelibsdir)" || $(MKDIR_P) "$(DESTDIR)$(typelibsdir)"
 	@list='$(typelibs_DATA)'; test -n "$(typelibsdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(typelibsdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(typelibsdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -759,8 +803,11 @@ uninstall-typelibsDATA:
 	dir='$(DESTDIR)$(typelibsdir)'; $(am__uninstall_files_from_dir)
 install-libgstrtspincludeHEADERS: $(libgstrtspinclude_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstrtspincludedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstrtspincludedir)"
 	@list='$(libgstrtspinclude_HEADERS)'; test -n "$(libgstrtspincludedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstrtspincludedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstrtspincludedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -777,8 +824,11 @@ uninstall-libgstrtspincludeHEADERS:
 	dir='$(DESTDIR)$(libgstrtspincludedir)'; $(am__uninstall_files_from_dir)
 install-nodist_libgstrtspincludeHEADERS: $(nodist_libgstrtspinclude_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstrtspincludedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstrtspincludedir)"
 	@list='$(nodist_libgstrtspinclude_HEADERS)'; test -n "$(libgstrtspincludedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstrtspincludedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstrtspincludedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -843,6 +893,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -995,7 +1059,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libLTLIBRARIES clean-libtool ctags distclean \
+	clean-libLTLIBRARIES clean-libtool cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
@@ -1060,7 +1124,7 @@ $(glib_gen_basename)-enumtypes.c: $(glib_enum_headers)
 @HAVE_INTROSPECTION_TRUE@		-I$(top_builddir)/gst-libs \
 @HAVE_INTROSPECTION_TRUE@		-I$(top_srcdir)/gst-libs \
 @HAVE_INTROSPECTION_TRUE@		--add-include-path=$(builddir)/../sdp \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		--library=libgstrtsp-@GST_MAJORMINOR@.la \
 @HAVE_INTROSPECTION_TRUE@		--include=Gst-@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--include=GstSdp-@GST_MAJORMINOR@ \
@@ -1079,7 +1143,7 @@ $(glib_gen_basename)-enumtypes.c: $(glib_enum_headers)
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(srcdir) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir)/../sdp \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst-libs/gst/rtsp/gstrtspconnection.c b/gst-libs/gst/rtsp/gstrtspconnection.c
index 731add3..a76dc6b 100644
--- a/gst-libs/gst/rtsp/gstrtspconnection.c
+++ b/gst-libs/gst/rtsp/gstrtspconnection.c
@@ -77,7 +77,6 @@
 #endif
 #include <winsock2.h>
 #include <ws2tcpip.h>
-#define EINPROGRESS WSAEINPROGRESS
 #else
 #include <sys/ioctl.h>
 #include <netdb.h>
@@ -3063,10 +3062,13 @@ struct _GstRTSPWatch
   guint id;
   GMutex *mutex;
   GQueue *messages;
+  gsize messages_bytes;
   guint8 *write_data;
   guint write_off;
   guint write_size;
   guint write_id;
+  gsize max_bytes;
+  guint max_messages;
 
   GstRTSPWatchFuncs funcs;
 
@@ -3214,6 +3216,8 @@ gst_rtsp_source_dispatch (GSource * source, GSourceFunc callback G_GNUC_UNUSED,
         if (rec == NULL)
           break;
 
+        watch->messages_bytes -= rec->size;
+
         watch->write_off = 0;
         watch->write_data = rec->data;
         watch->write_size = rec->size;
@@ -3318,6 +3322,7 @@ gst_rtsp_source_finalize (GSource * source)
   g_queue_foreach (watch->messages, (GFunc) gst_rtsp_rec_free, NULL);
   g_queue_free (watch->messages);
   watch->messages = NULL;
+  watch->messages_bytes = 0;
   g_free (watch->write_data);
 
   g_mutex_free (watch->mutex);
@@ -3455,9 +3460,63 @@ gst_rtsp_watch_unref (GstRTSPWatch * watch)
 }
 
 /**
+ * gst_rtsp_watch_set_send_backlog:
+ * @watch: a #GstRTSPWatch
+ * @bytes: maximum bytes
+ * @messages: maximum messages
+ *
+ * Set the maximum amount of bytes and messages that will be queued in @watch.
+ * When the maximum amounts are exceeded, gst_rtsp_watch_write_data() and
+ * gst_rtsp_watch_send_message() will return #GST_RTSP_ENOMEM.
+ *
+ * A value of 0 for @bytes or @messages means no limits.
+ *
+ * Since: 0.10.37
+ */
+void
+gst_rtsp_watch_set_send_backlog (GstRTSPWatch * watch,
+    gsize bytes, guint messages)
+{
+  g_return_if_fail (watch != NULL);
+
+  g_mutex_lock (watch->mutex);
+  watch->max_bytes = bytes;
+  watch->max_messages = messages;
+  g_mutex_unlock (watch->mutex);
+
+  GST_DEBUG ("set backlog to bytes %" G_GSIZE_FORMAT ", messages %u",
+      bytes, messages);
+}
+
+/**
+ * gst_rtsp_watch_get_send_backlog:
+ * @watch: a #GstRTSPWatch
+ * @bytes: (out) (allow-none): maximum bytes
+ * @messages: (out) (allow-none): maximum messages
+ *
+ * Get the maximum amount of bytes and messages that will be queued in @watch.
+ * See gst_rtsp_watch_set_send_backlog().
+ *
+ * Since: 0.10.37
+ */
+void
+gst_rtsp_watch_get_send_backlog (GstRTSPWatch * watch,
+    gsize * bytes, guint * messages)
+{
+  g_return_if_fail (watch != NULL);
+
+  g_mutex_lock (watch->mutex);
+  if (bytes)
+    *bytes = watch->max_bytes;
+  if (messages)
+    *messages = watch->max_messages;
+  g_mutex_unlock (watch->mutex);
+}
+
+/**
  * gst_rtsp_watch_write_data:
  * @watch: a #GstRTSPWatch
- * @data: the data to queue
+ * @data: (array length=size) (transfer full): the data to queue
  * @size: the size of @data
  * @id: location for a message ID or %NULL
  *
@@ -3470,7 +3529,12 @@ gst_rtsp_watch_unref (GstRTSPWatch * watch)
  *
  * This function will take ownership of @data and g_free() it after use.
  *
- * Returns: #GST_RTSP_OK on success.
+ * If the amount of queued data exceeds the limits set with
+ * gst_rtsp_watch_set_send_backlog(), this function will return
+ * #GST_RTSP_ENOMEM.
+ *
+ * Returns: #GST_RTSP_OK on success. #GST_RTSP_ENOMEM when the backlog limits
+ * are reached.
  *
  * Since: 0.10.25
  */
@@ -3500,6 +3564,12 @@ gst_rtsp_watch_write_data (GstRTSPWatch * watch, const guint8 * data,
     }
   }
 
+  /* check limits */
+  if ((watch->max_bytes != 0 && watch->messages_bytes >= watch->max_bytes) ||
+      (watch->max_messages != 0
+          && watch->messages->length >= watch->max_messages))
+    goto too_much_backlog;
+
   /* make a record with the data and id for sending async */
   rec = g_slice_new (GstRTSPRec);
   if (off == 0) {
@@ -3516,8 +3586,9 @@ gst_rtsp_watch_write_data (GstRTSPWatch * watch, const guint8 * data,
     rec->id = ++watch->id;
   } while (G_UNLIKELY (rec->id == 0));
 
-  /* add the record to a queue. FIXME we would like to have an upper limit here */
+  /* add the record to a queue. */
   g_queue_push_head (watch->messages, rec);
+  watch->messages_bytes += rec->size;
 
   /* make sure the main context will now also check for writability on the
    * socket */
@@ -3537,6 +3608,17 @@ done:
     g_main_context_wakeup (context);
 
   return res;
+
+  /* ERRORS */
+too_much_backlog:
+  {
+    GST_WARNING ("too much backlog: max_bytes %" G_GSIZE_FORMAT ", current %"
+        G_GSIZE_FORMAT ", max_messages %u, current %u", watch->max_bytes,
+        watch->messages_bytes, watch->max_messages, watch->messages->length);
+    g_mutex_unlock (watch->mutex);
+    g_free ((gpointer) data);
+    return GST_RTSP_ENOMEM;
+  }
 }
 
 /**
diff --git a/gst-libs/gst/rtsp/gstrtspconnection.h b/gst-libs/gst/rtsp/gstrtspconnection.h
index 2a34abd..2ecd325 100644
--- a/gst-libs/gst/rtsp/gstrtspconnection.h
+++ b/gst-libs/gst/rtsp/gstrtspconnection.h
@@ -189,6 +189,11 @@ void               gst_rtsp_watch_unref              (GstRTSPWatch *watch);
 guint              gst_rtsp_watch_attach             (GstRTSPWatch *watch,
                                                       GMainContext *context);
 
+void               gst_rtsp_watch_set_send_backlog  (GstRTSPWatch *watch,
+                                                     gsize bytes, guint messages);
+void               gst_rtsp_watch_get_send_backlog  (GstRTSPWatch *watch,
+                                                     gsize *bytes, guint *messages);
+
 GstRTSPResult      gst_rtsp_watch_write_data         (GstRTSPWatch *watch,
                                                       const guint8 *data,
                                                       guint size, guint *id);
diff --git a/gst-libs/gst/rtsp/gstrtspdefs.h b/gst-libs/gst/rtsp/gstrtspdefs.h
index 3727bf2..aab8d3e 100644
--- a/gst-libs/gst/rtsp/gstrtspdefs.h
+++ b/gst-libs/gst/rtsp/gstrtspdefs.h
@@ -228,10 +228,9 @@ typedef enum {
 /**
  * GstRTSPHeaderField:
  *
- * Enumeration of rtsp header fields.
+ * Enumeration of rtsp header fields
  */
 typedef enum {
-  /*< protected >*/
   GST_RTSP_HDR_INVALID,
 
   /*
@@ -342,10 +341,9 @@ typedef enum {
 /**
  * GstRTSPStatusCode:
  *
- * Enumeration of rtsp status codes.
+ * Enumeration of rtsp status codes
  */
 typedef enum {
-  /*< protected >*/
   GST_RTSP_STS_INVALID                              = 0,
   GST_RTSP_STS_CONTINUE                             = 100,
   GST_RTSP_STS_OK                                   = 200,
diff --git a/gst-libs/gst/sdp/Makefile.am b/gst-libs/gst/sdp/Makefile.am
index 5ad8080..241550e 100644
--- a/gst-libs/gst/sdp/Makefile.am
+++ b/gst-libs/gst/sdp/Makefile.am
@@ -26,7 +26,7 @@ GstSdp-@GST_MAJORMINOR@.gir: $(INTROSPECTION_SCANNER) libgstsdp-@GST_MAJORMINOR@
 		--strip-prefix=Gst \
 		$(gir_cincludes) \
 		-I$(top_srcdir)/gst-libs \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 		--library=libgstsdp-@GST_MAJORMINOR@.la \
 		--include=Gst-@GST_MAJORMINOR@ \
 		--libtool="$(top_builddir)/libtool" \
@@ -50,7 +50,7 @@ typelibs_DATA = $(BUILT_GIRSOURCES:.gir=.typelib)
 		$(INTROSPECTION_COMPILER) \
 		--includedir=$(srcdir) \
 		--includedir=$(builddir) \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 CLEANFILES = $(BUILT_GIRSOURCES) $(typelibs_DATA)
diff --git a/gst-libs/gst/sdp/Makefile.in b/gst-libs/gst/sdp/Makefile.in
index 131ddd3..5edcc47 100644
--- a/gst-libs/gst/sdp/Makefile.in
+++ b/gst-libs/gst/sdp/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -18,6 +17,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -36,9 +52,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst-libs/gst/sdp
 DIST_COMMON = $(libgstsdpinclude_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -123,10 +140,23 @@ libgstsdp_@GST_MAJORMINOR@_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstsdp_@GST_MAJORMINOR@_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(libgstsdp_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) \
 	$(libgstsdp_@GST_MAJORMINOR@_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -139,22 +169,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstsdp_@GST_MAJORMINOR@_la_SOURCES)
 DIST_SOURCES = $(libgstsdp_@GST_MAJORMINOR@_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DATA = $(gir_DATA) $(typelibs_DATA)
 HEADERS = $(libgstsdpinclude_HEADERS)
 ETAGS = etags
@@ -448,7 +479,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -509,7 +544,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(MKDIR_P) "$(DESTDIR)$(libdir)"
 	@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -517,6 +551,8 @@ install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libdir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(libdir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(libdir)"; \
 	}
@@ -532,12 +568,14 @@ uninstall-libLTLIBRARIES:
 
 clean-libLTLIBRARIES:
 	-test -z "$(lib_LTLIBRARIES)" || rm -f $(lib_LTLIBRARIES)
-	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(lib_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstsdp-@GST_MAJORMINOR@.la: $(libgstsdp_@GST_MAJORMINOR@_la_OBJECTS) $(libgstsdp_@GST_MAJORMINOR@_la_DEPENDENCIES) $(EXTRA_libgstsdp_@GST_MAJORMINOR@_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstsdp_@GST_MAJORMINOR@_la_LINK) -rpath $(libdir) $(libgstsdp_@GST_MAJORMINOR@_la_OBJECTS) $(libgstsdp_@GST_MAJORMINOR@_la_LIBADD) $(LIBS)
 
@@ -584,8 +622,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-girDATA: $(gir_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(girdir)" || $(MKDIR_P) "$(DESTDIR)$(girdir)"
 	@list='$(gir_DATA)'; test -n "$(girdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(girdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(girdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -602,8 +643,11 @@ uninstall-girDATA:
 	dir='$(DESTDIR)$(girdir)'; $(am__uninstall_files_from_dir)
 install-typelibsDATA: $(typelibs_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(typelibsdir)" || $(MKDIR_P) "$(DESTDIR)$(typelibsdir)"
 	@list='$(typelibs_DATA)'; test -n "$(typelibsdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(typelibsdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(typelibsdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -620,8 +664,11 @@ uninstall-typelibsDATA:
 	dir='$(DESTDIR)$(typelibsdir)'; $(am__uninstall_files_from_dir)
 install-libgstsdpincludeHEADERS: $(libgstsdpinclude_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstsdpincludedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstsdpincludedir)"
 	@list='$(libgstsdpinclude_HEADERS)'; test -n "$(libgstsdpincludedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstsdpincludedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstsdpincludedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -686,6 +733,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -833,7 +894,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libLTLIBRARIES clean-libtool ctags distclean \
+	clean-libLTLIBRARIES clean-libtool cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
@@ -858,7 +919,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 @HAVE_INTROSPECTION_TRUE@		--strip-prefix=Gst \
 @HAVE_INTROSPECTION_TRUE@		$(gir_cincludes) \
 @HAVE_INTROSPECTION_TRUE@		-I$(top_srcdir)/gst-libs \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		--library=libgstsdp-@GST_MAJORMINOR@.la \
 @HAVE_INTROSPECTION_TRUE@		--include=Gst-@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--libtool="$(top_builddir)/libtool" \
@@ -873,7 +934,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(srcdir) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir) \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst-libs/gst/tag/Makefile.am b/gst-libs/gst/tag/Makefile.am
index 858d145..6d24d51 100644
--- a/gst-libs/gst/tag/Makefile.am
+++ b/gst-libs/gst/tag/Makefile.am
@@ -37,8 +37,8 @@ GstTag-@GST_MAJORMINOR@.gir: $(INTROSPECTION_SCANNER) libgsttag-@GST_MAJORMINOR@
 		--nsversion=@GST_MAJORMINOR@ \
 		--strip-prefix=Gst \
 		$(gir_cincludes) \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 		--library=libgsttag-@GST_MAJORMINOR@.la \
 		--include=Gst-@GST_MAJORMINOR@ \
 		--include=GstBase-@GST_MAJORMINOR@ \
@@ -65,8 +65,8 @@ typelibs_DATA = $(BUILT_GIRSOURCES:.gir=.typelib)
 		$(INTROSPECTION_COMPILER) \
 		--includedir=$(srcdir) \
 		--includedir=$(builddir) \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 CLEANFILES = $(BUILT_GIRSOURCES) $(typelibs_DATA)
diff --git a/gst-libs/gst/tag/Makefile.in b/gst-libs/gst/tag/Makefile.in
index ff383cb..036cf17 100644
--- a/gst-libs/gst/tag/Makefile.in
+++ b/gst-libs/gst/tag/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -18,6 +17,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -36,10 +52,12 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 EXTRA_PROGRAMS = mklangtables$(EXEEXT) mklicensestables$(EXEEXT)
 subdir = gst-libs/gst/tag
 DIST_COMMON = $(libgsttaginclude_HEADERS) $(noinst_HEADERS) \
-	$(srcdir)/Makefile.am $(srcdir)/Makefile.in
+	$(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -138,6 +156,7 @@ libgsttag_@GST_MAJORMINOR@_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgsttag_@GST_MAJORMINOR@_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(libgsttag_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) \
@@ -156,6 +175,18 @@ mklicensestables_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(mklicensestables_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) \
 	-o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -168,24 +199,25 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgsttag_@GST_MAJORMINOR@_la_SOURCES) \
 	$(mklangtables_SOURCES) $(mklicensestables_SOURCES)
 DIST_SOURCES = $(libgsttag_@GST_MAJORMINOR@_la_SOURCES) \
 	$(mklangtables_SOURCES) $(mklicensestables_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DATA = $(gir_DATA) $(licensetrans_DATA) $(typelibs_DATA)
 HEADERS = $(libgsttaginclude_HEADERS) $(noinst_HEADERS)
 ETAGS = etags
@@ -479,7 +511,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -572,7 +608,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(MKDIR_P) "$(DESTDIR)$(libdir)"
 	@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -580,6 +615,8 @@ install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libdir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(libdir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(libdir)"; \
 	}
@@ -595,12 +632,14 @@ uninstall-libLTLIBRARIES:
 
 clean-libLTLIBRARIES:
 	-test -z "$(lib_LTLIBRARIES)" || rm -f $(lib_LTLIBRARIES)
-	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(lib_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgsttag-@GST_MAJORMINOR@.la: $(libgsttag_@GST_MAJORMINOR@_la_OBJECTS) $(libgsttag_@GST_MAJORMINOR@_la_DEPENDENCIES) $(EXTRA_libgsttag_@GST_MAJORMINOR@_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgsttag_@GST_MAJORMINOR@_la_LINK) -rpath $(libdir) $(libgsttag_@GST_MAJORMINOR@_la_OBJECTS) $(libgsttag_@GST_MAJORMINOR@_la_LIBADD) $(LIBS)
 mklangtables$(EXEEXT): $(mklangtables_OBJECTS) $(mklangtables_DEPENDENCIES) $(EXTRA_mklangtables_DEPENDENCIES) 
@@ -779,8 +818,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-girDATA: $(gir_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(girdir)" || $(MKDIR_P) "$(DESTDIR)$(girdir)"
 	@list='$(gir_DATA)'; test -n "$(girdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(girdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(girdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -797,8 +839,11 @@ uninstall-girDATA:
 	dir='$(DESTDIR)$(girdir)'; $(am__uninstall_files_from_dir)
 install-licensetransDATA: $(licensetrans_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(licensetransdir)" || $(MKDIR_P) "$(DESTDIR)$(licensetransdir)"
 	@list='$(licensetrans_DATA)'; test -n "$(licensetransdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(licensetransdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(licensetransdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -815,8 +860,11 @@ uninstall-licensetransDATA:
 	dir='$(DESTDIR)$(licensetransdir)'; $(am__uninstall_files_from_dir)
 install-typelibsDATA: $(typelibs_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(typelibsdir)" || $(MKDIR_P) "$(DESTDIR)$(typelibsdir)"
 	@list='$(typelibs_DATA)'; test -n "$(typelibsdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(typelibsdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(typelibsdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -833,8 +881,11 @@ uninstall-typelibsDATA:
 	dir='$(DESTDIR)$(typelibsdir)'; $(am__uninstall_files_from_dir)
 install-libgsttagincludeHEADERS: $(libgsttaginclude_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgsttagincludedir)" || $(MKDIR_P) "$(DESTDIR)$(libgsttagincludedir)"
 	@list='$(libgsttaginclude_HEADERS)'; test -n "$(libgsttagincludedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgsttagincludedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgsttagincludedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -899,6 +950,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -1047,7 +1112,7 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libLTLIBRARIES clean-libtool ctags distclean \
+	clean-libLTLIBRARIES clean-libtool cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
@@ -1072,8 +1137,8 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 @HAVE_INTROSPECTION_TRUE@		--nsversion=@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--strip-prefix=Gst \
 @HAVE_INTROSPECTION_TRUE@		$(gir_cincludes) \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		--library=libgsttag-@GST_MAJORMINOR@.la \
 @HAVE_INTROSPECTION_TRUE@		--include=Gst-@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--include=GstBase-@GST_MAJORMINOR@ \
@@ -1091,8 +1156,8 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(srcdir) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir) \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 update-isocodes: mklangtables
diff --git a/gst-libs/gst/tag/gstxmptag.c b/gst-libs/gst/tag/gstxmptag.c
index 1fb7f39..5a51f62 100644
--- a/gst-libs/gst/tag/gstxmptag.c
+++ b/gst-libs/gst/tag/gstxmptag.c
@@ -173,8 +173,11 @@ xmp_tag_type_get_name (GstXmpTagType tagtype)
     case GstXmpTagTypeBag:
       return "rdf:Bag";
     default:
-      g_assert_not_reached ();
+      break;
   }
+
+  /* Make compiler happy */
+  g_return_val_if_reached ("");
 }
 
 struct _PendingXmpTag
diff --git a/gst-libs/gst/tag/id3v2.3.0.txt b/gst-libs/gst/tag/id3v2.3.0.txt
new file mode 100644
index 0000000..5b57850
--- /dev/null
+++ b/gst-libs/gst/tag/id3v2.3.0.txt
@@ -0,0 +1,1942 @@
+* id3v2.3.0
+
+Informal Standard
+Document: id3v2.3
+M. Nilsson
+3rd February 1999
+
+
+1. ID3 tag version 2.3.0
+
+
+1.1. Status of this document
+
+This document is an informal standard and replaces the id3v2.2.0 standard. The
+informal standard is released so that implementors could have a set standard
+before a formal standard is set. The formal standard will use another version
+or revision number if not identical to what is described in this document. The
+contents in this document may change for clarifications but never for added or
+altered functionallity.
+Distribution of this document is unlimited.
+
+1.2. Abstract
+
+This document describes the ID3v2.3.0 standard, which is a more developed
+version of the ID3v2 informal standard (version [:id3v2-00: 2.2.0]), evolved
+from the ID3 tagging system. The ID3v2 offers a flexible way of storing
+information about an audio file within itself to determine its origin and
+contents. The information may be technical information, such as equalisation
+curves, as well as related meta information, such as title, performer,
+copyright etc.
+Contents
+
+  1. ID3_tag_version_2.3.0
+
+       1. Status_of_this_document
+       2. Abstract
+
+  2. Conventions_in_this_document
+  3. ID3v2_overview
+
+       1. ID3v2_header
+       2. ID3v2_extended_header
+       3. ID3v2_frame_overview
+
+            1. Frame_header_flags
+
+       4. Default_flags
+
+  4. Declared_ID3v2_frames
+
+       1. Unique_file_identifier
+       2. Text_information_frames
+
+            1. Text_information_frames_-_details
+            2. User_defined_text_information_frame
+
+       3. URL_link_frames
+
+            1. URL_link_frames_-_details
+            2. User_defined_URL_link_frame
+
+       4. Involved_people_list
+       5. Music_CD_identifier
+       6. Event_timing_codes
+       7. MPEG_location_lookup_table
+       8. Synchronised_tempo_codes
+       9. Unsychronised_lyrics/text_transcription
+      10. Synchronised_lyrics/text
+      11. Comments
+      12. Relative_volume_adjustment
+      13. Equalisation
+      14. Reverb
+      15. Attached_picture
+      16. General_encapsulated_object
+      17. Play_counter
+      18. Popularimeter
+      19. Recommended_buffer_size
+      20. Audio_encryption
+      21. Linked_information
+      22. Position_synchronisation_frame
+      23. Terms_of_use_frame
+      24. Ownership_frame
+      25. Commercial_frame
+      26. Encryption_method_registration
+      27. Group_identification_registration
+      28. Private_frame
+
+  5. The_unsynchronisation_scheme
+  6. Copyright
+  7. References
+  8. Appendix
+
+       1. Appendix_A_-_Genre_List_from_ID3v1
+
+  9. Author's_Address
+
+
+
+2. Conventions in this document
+
+In the examples, text within "" is a text string exactly as it appears in a
+file. Numbers preceded with $ are hexadecimal and numbers preceded with % are
+binary. $xx is used to indicate a byte with unknown content. %x is used to
+indicate a bit with unknown content. The most significant bit (MSB) of a byte
+is called 'bit 7' and the least significant bit (LSB) is called 'bit 0'.
+A tag is the whole tag described in this document. A frame is a block of
+information in the tag. The tag consists of a header, frames and optional
+padding. A field is a piece of information; one value, a string etc. A numeric
+string is a string that consists of the characters 0-9 only.
+
+
+3. ID3v2 overview
+
+The two biggest design goals were to be able to implement ID3v2 without
+disturbing old software too much and that ID3v2 should be as flexible and
+expandable as possible.
+The first criterion is met by the simple fact that the MPEG decoding software
+uses a syncsignal, embedded in the audiostream, to 'lock on to' the audio.
+Since the ID3v2 tag doesn't contain a valid syncsignal, no software will
+attempt to play the tag. If, for any reason, coincidence make a syncsignal
+appear within the tag it will be taken care of by the 'unsynchronisation
+scheme' described in section_5.
+The second criterion has made a more noticeable impact on the design of the
+ID3v2 tag. It is constructed as a container for several information blocks,
+called frames, whose format need not be known to the software that encounters
+them. At the start of every frame there is an identifier that explains the
+frames' format and content, and a size descriptor that allows software to skip
+unknown frames.
+If a total revision of the ID3v2 tag should be needed, there is a version
+number and a size descriptor in the ID3v2 header.
+The ID3 tag described in this document is mainly targeted at files encoded with
+MPEG-1/2 layer I, MPEG-1/2 layer II, MPEG-1/2 layer III and MPEG-2.5, but may
+work with other types of encoded audio.
+The bitorder in ID3v2 is most significant bit first (MSB). The byteorder in
+multibyte numbers is most significant byte first (e.g. $12345678 would be
+encoded $12 34 56 78).
+It is permitted to include padding after all the final frame (at the end of the
+ID3 tag), making the size of all the frames together smaller than the size
+given in the head of the tag. A possible purpose of this padding is to allow
+for adding a few additional frames or enlarge existing frames within the tag
+without having to rewrite the entire file. The value of the padding bytes must
+be $00.
+
+3.1. ID3v2 header
+
+The ID3v2 tag header, which should be the first information in the file, is 10
+bytes as follows:
+
+  ID3v2/file identifier   "ID3"
+  ID3v2 version           $03 00
+  ID3v2 flags             %abc00000
+  ID3v2 size              4 * %0xxxxxxx
+
+The first three bytes of the tag are always "ID3" to indicate that this is an
+ID3v2 tag, directly followed by the two version bytes. The first byte of ID3v2
+version is it's major version, while the second byte is its revision number. In
+this case this is ID3v2.3.0. All revisions are backwards compatible while major
+versions are not. If software with ID3v2.2.0 and below support should encounter
+version three or higher it should simply ignore the whole tag. Version and
+revision will never be $FF.
+The version is followed by one the ID3v2 flags field, of which currently only
+three flags are used.
+
+
+  a - Unsynchronisation
+      Bit 7 in the 'ID3v2 flags' indicates whether or not unsynchronisation is
+      used (see section_5 for details); a set bit indicates usage.
+
+  b - Extended header
+      The second bit (bit 6) indicates whether or not the header is followed by
+      an extended header. The extended header is described in section_3.2.
+
+  c - Experimental indicator
+      The third bit (bit 5) should be used as an 'experimental indicator'. This
+      flag should always be set when the tag is in an experimental stage.
+
+All the other flags should be cleared. If one of these undefined flags are set
+that might mean that the tag is not readable for a parser that does not know
+the flags function.
+The ID3v2 tag size is encoded with four bytes where the most significant bit
+(bit 7) is set to zero in every byte, making a total of 28 bits. The zeroed
+bits are ignored, so a 257 bytes long tag is represented as $00 00 02 01.
+The ID3v2 tag size is the size of the complete tag after unsychronisation,
+including padding, excluding the header but not excluding the extended header
+(total tag size - 10). Only 28 bits (representing up to 256MB) are used in the
+size description to avoid the introduction of 'false syncsignals'.
+An ID3v2 tag can be detected with the following pattern:
+
+  $49 44 33 yy yy xx zz zz zz zz
+
+Where yy is less than $FF, xx is the 'flags' byte and zz is less than $80.
+
+3.2. ID3v2 extended header
+
+The extended header contains information that is not vital to the correct
+parsing of the tag information, hence the extended header is optional.
+
+  Extended header size   $xx xx xx xx
+  Extended Flags         $xx xx
+  Size of padding        $xx xx xx xx
+
+Where the 'Extended header size', currently 6 or 10 bytes, excludes itself. The
+'Size of padding' is simply the total tag size excluding the frames and the
+headers, in other words the padding. The extended header is considered separate
+from the header proper, and as such is subject to unsynchronisation.
+The extended flags are a secondary flag set which describes further attributes
+of the tag. These attributes are currently defined as follows
+
+  %x0000000 00000000
+
+
+
+  x - CRC data present
+      If this flag is set four bytes of CRC-32 data is appended to the extended
+      header. The CRC should be calculated before unsynchronisation on the data
+      between the extended header and the padding, i.e. the frames and only the
+      frames.
+
+        Total frame CRC    $xx xx xx xx
+
+
+
+3.3. ID3v2 frame overview
+
+As the tag consists of a tag header and a tag body with one or more frames, all
+the frames consists of a frame header followed by one or more fields containing
+the actual information. The layout of the frame header:
+
+  Frame ID       $xx xx xx xx (four characters)
+  Size           $xx xx xx xx
+  Flags          $xx xx
+
+The frame ID made out of the characters capital A-Z and 0-9. Identifiers
+beginning with "X", "Y" and "Z" are for experimental use and free for everyone
+to use, without the need to set the experimental bit in the tag header. Have in
+mind that someone else might have used the same identifier as you. All other
+identifiers are either used or reserved for future use.
+The frame ID is followed by a size descriptor, making a total header size of
+ten bytes in every frame. The size is calculated as frame size excluding frame
+header (frame size - 10).
+In the frame header the size descriptor is followed by two flags bytes. These
+flags are described in section_3.3.1.
+There is no fixed order of the frames' appearance in the tag, although it is
+desired that the frames are arranged in order of significance concerning the
+recognition of the file. An example of such order: UFID, TIT2, MCDI, TRCK ...
+A tag must contain at least one frame. A frame must be at least 1 byte big,
+excluding the header.
+If nothing else is said a string is represented as ISO-8859-1 characters in the
+range $20 - $FF. Such strings are represented as <text string>, or <full text
+string> if newlines are allowed, in the frame descriptions. All Unicode strings
+use 16-bit unicode 2.0 (ISO/IEC 10646-1:1993, UCS-2). Unicode strings must
+begin with the Unicode BOM ($FF FE or $FE FF) to identify the byte order.
+All numeric strings and URLs are always encoded as ISO-8859-1. Terminated
+strings are terminated with $00 if encoded with ISO-8859-1 and $00 00 if
+encoded as unicode. If nothing else is said newline character is forbidden. In
+ISO-8859-1 a new line is represented, when allowed, with $0A only. Frames that
+allow different types of text encoding have a text encoding description byte
+directly after the frame size. If ISO-8859-1 is used this byte should be $00,
+if Unicode is used it should be $01. Strings dependent on encoding is
+represented as <text string according to encoding>, or <full text string
+according to encoding> if newlines are allowed. Any empty Unicode strings which
+are NULL-terminated may have the Unicode BOM followed by a Unicode NULL ($FF FE
+00 00 or $FE FF 00 00).
+The three byte language field is used to describe the language of the frame's
+content, according to ISO-639-2.
+All URLs may be relative, e.g. "picture.png", "../doc.txt".
+If a frame is longer than it should be, e.g. having more fields than specified
+in this document, that indicates that additions to the frame have been made in
+a later version of the ID3v2 standard. This is reflected by the revision number
+in the header of the tag.
+
+3.3.1. Frame header flags
+
+In the frame header the size descriptor is followed by two flags bytes. All
+unused flags must be cleared. The first byte is for 'status messages' and the
+second byte is for encoding purposes. If an unknown flag is set in the first
+byte the frame may not be changed without the bit cleared. If an unknown flag
+is set in the second byte it is likely to not be readable. The flags field is
+defined as follows.
+
+  %abc00000 %ijk00000
+
+
+
+  a - Tag alter preservation
+      This flag tells the software what to do with this frame if it is unknown
+      and the tag is altered in any way. This applies to all kinds of
+      alterations, including adding more padding and reordering the frames.
+
+        0    Frame should be preserved.
+        1    Frame should be discarded.
+
+
+  b - File alter preservation
+      This flag tells the software what to do with this frame if it is unknown
+      and the file, excluding the tag, is altered. This does not apply when the
+      audio is completely replaced with other audio data.
+
+        0    Frame should be preserved.
+        1    Frame should be discarded.
+
+
+  c - Read only
+      This flag, if set, tells the software that the contents of this frame is
+      intended to be read only. Changing the contents might break something,
+      e.g. a signature. If the contents are changed, without knowledge in why
+      the frame was flagged read only and without taking the proper means to
+      compensate, e.g. recalculating the signature, the bit should be cleared.
+
+  i - Compression
+      This flag indicates whether or not the frame is compressed.
+
+        0    Frame is not compressed.
+        1    Frame is compressed using [#ZLIB zlib] with 4 bytes for
+        'decompressed size' appended to the frame header.
+
+
+  j - Encryption
+      This flag indicates wether or not the frame is enrypted. If set one byte
+      indicating with which method it was encrypted will be appended to the
+      frame header. See section_4.26. for more information about encryption
+      method registration.
+
+        0    Frame is not encrypted.
+        1    Frame is encrypted.
+
+
+  k - Grouping identity
+      This flag indicates whether or not this frame belongs in a group with
+      other frames. If set a group identifier byte is added to the frame
+      header. Every frame with the same group identifier belongs to the same
+      group.
+
+        0    Frame does not contain group information
+        1    Frame contains group information
+
+
+Some flags indicates that the frame header is extended with additional
+information. This information will be added to the frame header in the same
+order as the flags indicating the additions. I.e. the four bytes of
+decompressed size will preceed the encryption method byte. These additions to
+the frame header, while not included in the frame header size but are included
+in the 'frame size' field, are not subject to encryption or compression.
+
+3.4. Default flags
+
+The default settings for the frames described in this document can be divided
+into the following classes. The flags may be set differently if found more
+suitable by the software.
+
+  1. Discarded if tag is altered, discarded if file is altered.
+
+     o None.
+
+  2. Discarded if tag is altered, preserved if file is altered.
+
+     o None.
+
+  3. Preserved if tag is altered, discarded if file is altered.
+
+     o AENC, ETCO, EQUA, MLLT, POSS, SYLT, SYTC, RVAD, TENC, TLEN, TSIZ
+
+  4. Preserved if tag is altered, preserved if file is altered.
+
+     o The rest of the frames.
+
+
+
+
+4. Declared ID3v2 frames
+
+The following frames are declared in this draft.
+
+  4.20    AENC    [#sec4.20 Audio encryption]
+  4.15    APIC    [#sec4.15 Attached picture]
+  4.11    COMM    [#sec4.11 Comments]
+  4.25    COMR    [#sec4.25 Commercial frame]
+  4.26    ENCR    [#sec4.26 Encryption method registration]
+  4.13    EQUA    [#sec4.13 Equalization]
+  4.6     ETCO    [#sec4.6 Event timing codes]
+  4.16    GEOB    [#sec4.16 General encapsulated object]
+  4.27    GRID    [#sec4.27 Group identification registration]
+  4.4     IPLS    [#sec4.4 Involved people list]
+  4.21    LINK    [#sec4.21 Linked information]
+  4.5     MCDI    [#sec4.5 Music CD identifier]
+  4.7     MLLT    [#sec4.7 MPEG location lookup table]
+  4.24    OWNE    [#sec4.24 Ownership frame]
+  4.28    PRIV    [#sec4.28 Private frame]
+  4.17    PCNT    [#sec4.17 Play counter]
+  4.18    POPM    [#sec4.18 Popularimeter]
+  4.22    POSS    [#sec4.22 Position synchronisation frame]
+  4.19    RBUF    [#sec4.19 Recommended buffer size]
+  4.12    RVAD    [#sec4.12 Relative volume adjustment]
+  4.14    RVRB    [#sec4.14 Reverb]
+  4.10    SYLT    [#sec4.10 Synchronized lyric/text]
+  4.8     SYTC    [#sec4.8 Synchronized tempo codes]
+  4.2.1   TALB    [#TALB Album/Movie/Show title]
+  4.2.1   TBPM    [#TBPM BPM (beats per minute)]
+  4.2.1   TCOM    [#TCOM Composer]
+  4.2.1   TCON    [#TCON Content type]
+  4.2.1   TCOP    [#TCOP Copyright message]
+  4.2.1   TDAT    [#TDAT Date]
+  4.2.1   TDLY    [#TDLY Playlist delay]
+  4.2.1   TENC    [#TENC Encoded by]
+  4.2.1   TEXT    [#TEXT Lyricist/Text writer]
+  4.2.1   TFLT    [#TFLT File type]
+  4.2.1   TIME    [#TIME Time]
+  4.2.1   TIT1    [#TIT1 Content group description]
+  4.2.1   TIT2    [#TIT2 Title/songname/content description]
+  4.2.1   TIT3    [#TIT3 Subtitle/Description refinement]
+  4.2.1   TKEY    [#TKEY Initial key]
+  4.2.1   TLAN    [#TLAN Language(s)]
+  4.2.1   TLEN    [#TLEN Length]
+  4.2.1   TMED    [#TMED Media type]
+  4.2.1   TOAL    [#TOAL Original album/movie/show title]
+  4.2.1   TOFN    [#TOFN Original filename]
+  4.2.1   TOLY    [#TOLY Original lyricist(s)/text writer(s)]
+  4.2.1   TOPE    [#TOPE Original artist(s)/performer(s)]
+  4.2.1   TORY    [#TORY Original release year]
+  4.2.1   TOWN    [#TOWN File owner/licensee]
+  4.2.1   TPE1    [#TPE1 Lead performer(s)/Soloist(s)]
+  4.2.1   TPE2    [#TPE2 Band/orchestra/accompaniment]
+  4.2.1   TPE3    [#TPE3 Conductor/performer refinement]
+  4.2.1   TPE4    [#TPE4 Interpreted, remixed, or otherwise modified by]
+  4.2.1   TPOS    [#TPOS Part of a set]
+  4.2.1   TPUB    [#TPUB Publisher]
+  4.2.1   TRCK    [#TRCK Track number/Position in set]
+  4.2.1   TRDA    [#TRDA Recording dates]
+  4.2.1   TRSN    [#TRSN Internet radio station name]
+  4.2.1   TRSO    [#TRSO Internet radio station owner]
+  4.2.1   TSIZ    [#TSIZ Size]
+  4.2.1   TSRC    [#TSRC ISRC (international standard recording code)]
+  4.2.1   TSSE    [#TSEE Software/Hardware and settings used for encoding]
+  4.2.1   TYER    [#TYER Year]
+  4.2.2   TXXX    [#TXXX User defined text information frame]
+  4.1     UFID    [#sec4.1 Unique file identifier]
+  4.23    USER    [#sec4.23 Terms of use]
+  4.9     USLT    [#sec4.9 Unsychronized lyric/text transcription]
+  4.3.1   WCOM    [#WCOM Commercial information]
+  4.3.1   WCOP    [#WCOP Copyright/Legal information]
+  4.3.1   WOAF    [#WOAF Official audio file webpage]
+  4.3.1   WOAR    [#WOAR Official artist/performer webpage]
+  4.3.1   WOAS    [#WOAS Official audio source webpage]
+  4.3.1   WORS    [#WORS Official internet radio station homepage]
+  4.3.1   WPAY    [#WPAY Payment]
+  4.3.1   WPUB    [#WPUB Publishers official webpage]
+  4.3.2   WXXX    [#WXXX User defined URL link frame]
+
+
+4.1. Unique file identifier
+
+This frame's purpose is to be able to identify the audio file in a database
+that may contain more information relevant to the content. Since
+standardisation of such a database is beyond this document, all frames begin
+with a null-terminated string with a URL containing an email address, or a link
+to a location where an email address can be found, that belongs to the
+organisation responsible for this specific database implementation. Questions
+regarding the database should be sent to the indicated email address. The URL
+should not be used for the actual database queries. The string "http://
+www.id3.org/dummy/ufid.html" should be used for tests. Software that isn't told
+otherwise may safely remove such frames. The 'Owner identifier' must be non-
+empty (more than just a termination). The 'Owner identifier' is then followed
+by the actual identifier, which may be up to 64 bytes. There may be more than
+one "UFID" frame in a tag, but only one with the same 'Owner identifier'.
+
+  <Header for 'Unique file identifier', ID: "UFID">
+  Owner identifier    <text string> $00
+  Identifier    <up to 64 bytes binary data>
+
+
+4.2. Text information frames
+
+The text information frames are the most important frames, containing
+information like artist, album and more. There may only be one text information
+frame of its kind in an tag. If the textstring is followed by a termination
+($00 (00)) all the following information should be ignored and not be
+displayed. All text frame identifiers begin with "T". Only text frame
+identifiers begin with "T", with the exception of the "TXXX" frame. All the
+text information frames have the following format:
+
+  <Header for 'Text information frame', ID: "T000" - "TZZZ", excluding "TXXX"
+  described in 4.2.2.>
+  Text encoding    $xx
+  Information    <text string according to encoding>
+
+
+4.2.1. Text information frames - details
+
+
+
+  TALB
+      The 'Album/Movie/Show title' frame is intended for the title of the
+      recording(/source of sound) which the audio in the file is taken from.
+
+
+
+  TBPM
+      The 'BPM' frame contains the number of beats per minute in the mainpart
+      of the audio. The BPM is an integer and represented as a numerical
+      string.
+
+
+
+  TCOM
+      The 'Composer(s)' frame is intended for the name of the composer(s). They
+      are seperated with the "/" character.
+
+
+
+  TCON
+      The 'Content type', which previously was stored as a one byte numeric
+      value only, is now a numeric string. You may use one or several of the
+      types as ID3v1.1 did or, since the category list would be impossible to
+      maintain with accurate and up to date categories, define your own.
+
+      References to the ID3v1 genres can be made by, as first byte, enter "("
+      followed by a number from the genres list (appendix A) and ended with a
+      ")" character. This is optionally followed by a refinement, e.g. "(21)"
+      or "(4)Eurodisco". Several references can be made in the same frame, e.g.
+      "(51)(39)". If the refinement should begin with a "(" character it should
+      be replaced with "((", e.g. "((I can figure out any genre)" or "(55)((I
+      think...)". The following new content types is defined in ID3v2 and is
+      implemented in the same way as the numerig content types, e.g. "(RX)".
+
+        RX    Remix
+        CR    Cover
+
+
+
+
+  TCOP
+      The 'Copyright message' frame, which must begin with a year and a space
+      character (making five characters), is intended for the copyright holder
+      of the original sound, not the audio file itself. The absence of this
+      frame means only that the copyright information is unavailable or has
+      been removed, and must not be interpreted to mean that the sound is
+      public domain. Every time this field is displayed the field must be
+      preceded with "Copyright © ".
+
+
+
+  TDAT
+      The 'Date' frame is a numeric string in the DDMM format containing the
+      date for the recording. This field is always four characters long.
+
+
+
+  TDLY
+      The 'Playlist delay' defines the numbers of milliseconds of silence
+      between every song in a playlist. The player should use the "ETC" frame,
+      if present, to skip initial silence and silence at the end of the audio
+      to match the 'Playlist delay' time. The time is represented as a numeric
+      string.
+
+
+
+  TENC
+      The 'Encoded by' frame contains the name of the person or organisation
+      that encoded the audio file. This field may contain a copyright message,
+      if the audio file also is copyrighted by the encoder.
+
+
+
+  TEXT
+      The 'Lyricist(s)/Text writer(s)' frame is intended for the writer(s) of
+      the text or lyrics in the recording. They are seperated with the "/
+      " character.
+
+
+
+  TFLT
+      The 'File type' frame indicates which type of audio this tag defines. The
+      following type and refinements are defined:
+
+        MPG       MPEG Audio
+        /1        MPEG 1/2 layer I
+        /2        MPEG 1/2 layer II
+        /3        MPEG 1/2 layer III
+        /2.5      MPEG 2.5
+         /AAC     Advanced audio compression
+        VQF       Transform-domain Weighted Interleave Vector Quantization
+        PCM       Pulse Code Modulated audio
+
+
+but other types may be used, not for these types though. This is used in a
+similar way to the predefined types in the "TMED" frame, but without
+parentheses. If this frame is not present audio type is assumed to be "MPG".
+
+
+  TIME
+      The 'Time' frame is a numeric string in the HHMM format containing the
+      time for the recording. This field is always four characters long.
+
+
+
+  TIT1
+      The 'Content group description' frame is used if the sound belongs to a
+      larger category of sounds/music. For example, classical music is often
+      sorted in different musical sections (e.g. "Piano Concerto", "Weather -
+      Hurricane").
+
+
+
+  TIT2
+      The 'Title/Songname/Content description' frame is the actual name of the
+      piece (e.g. "Adagio", "Hurricane Donna").
+
+
+
+  TIT3
+      The 'Subtitle/Description refinement' frame is used for information
+      directly related to the contents title (e.g. "Op. 16" or "Performed live
+      at Wembley").
+
+
+
+  TKEY
+      The 'Initial key' frame contains the musical key in which the sound
+      starts. It is represented as a string with a maximum length of three
+      characters. The ground keys are represented with "A","B","C","D","E", "F"
+      and "G" and halfkeys represented with "b" and "#". Minor is represented
+      as "m". Example "Cbm". Off key is represented with an "o" only.
+
+
+
+  TLAN
+      The 'Language(s)' frame should contain the languages of the text or
+      lyrics spoken or sung in the audio. The language is represented with
+      three characters according to ISO-639-2. If more than one language is
+      used in the text their language codes should follow according to their
+      usage.
+
+
+
+  TLEN
+      The 'Length' frame contains the length of the audiofile in milliseconds,
+      represented as a numeric string.
+
+
+
+  TMED
+      The 'Media type' frame describes from which media the sound originated.
+      This may be a text string or a reference to the predefined media types
+      found in the list below. References are made within "(" and ")" and are
+      optionally followed by a text refinement, e.g. "(MC) with four channels".
+      If a text refinement should begin with a "(" character it should be
+      replaced with "((" in the same way as in the "TCO" frame. Predefined
+      refinements is appended after the media type, e.g. "(CD/A)" or "(VID/PAL/
+      VHS)".
+
+        DIG     Other digital media
+            /A  Analog transfer from media
+
+        ANA     Other analog media
+           /WAC Wax cylinder
+           /8CA 8-track tape cassette
+
+        CD      CD
+             /A Analog transfer from media
+            /DD DDD
+            /AD ADD
+            /AA AAD
+
+        LD      Laserdisc
+             /A Analog transfer from media
+
+        TT      Turntable records
+            /33 33.33 rpm
+            /45 45 rpm
+            /71 71.29 rpm
+            /76 76.59 rpm
+            /78 78.26 rpm
+            /80 80 rpm
+
+        MD      MiniDisc
+             /A Analog transfer from media
+
+        DAT     DAT
+             /A Analog transfer from media
+             /1 standard, 48 kHz/16 bits, linear
+             /2 mode 2, 32 kHz/16 bits, linear
+             /3 mode 3, 32 kHz/12 bits, nonlinear, low speed
+             /4 mode 4, 32 kHz/12 bits, 4 channels
+             /5 mode 5, 44.1 kHz/16 bits, linear
+             /6 mode 6, 44.1 kHz/16 bits, 'wide track' play
+
+        DCC     DCC
+             /A Analog transfer from media
+
+        DVD     DVD
+             /A Analog transfer from media
+
+        TV      Television
+           /PAL PAL
+          /NTSC NTSC
+         /SECAM SECAM
+
+        VID     Video
+           /PAL PAL
+          /NTSC NTSC
+         /SECAM SECAM
+           /VHS VHS
+          /SVHS S-VHS
+          /BETA BETAMAX
+
+        RAD     Radio
+            /FM FM
+            /AM AM
+            /LW LW
+            /MW MW
+
+        TEL     Telephone
+             /I ISDN
+
+        MC      MC (normal cassette)
+             /4 4.75 cm/s (normal speed for a two sided cassette)
+             /9 9.5 cm/s
+             /I Type I cassette (ferric/normal)
+            /II Type II cassette (chrome)
+           /III Type III cassette (ferric chrome)
+            /IV Type IV cassette (metal)
+
+        REE     Reel
+             /9 9.5 cm/s
+            /19 19 cm/s
+            /38 38 cm/s
+            /76 76 cm/s
+             /I Type I cassette (ferric/normal)
+            /II Type II cassette (chrome)
+           /III Type III cassette (ferric chrome)
+            /IV Type IV cassette (metal)
+
+
+
+
+  TOAL
+      The 'Original album/movie/show title' frame is intended for the title of
+      the original recording (or source of sound), if for example the music in
+      the file should be a cover of a previously released song.
+
+
+
+  TOFN
+      The 'Original filename' frame contains the preferred filename for the
+      file, since some media doesn't allow the desired length of the filename.
+      The filename is case sensitive and includes its suffix.
+
+
+
+  TOLY
+      The 'Original lyricist(s)/text writer(s)' frame is intended for the text
+      writer(s) of the original recording, if for example the music in the file
+      should be a cover of a previously released song. The text writers are
+      seperated with the "/" character.
+
+
+
+  TOPE
+      The 'Original artist(s)/performer(s)' frame is intended for the performer
+      (s) of the original recording, if for example the music in the file
+      should be a cover of a previously released song. The performers are
+      seperated with the "/" character.
+
+
+
+  TORY
+      The 'Original release year' frame is intended for the year when the
+      original recording, if for example the music in the file should be a
+      cover of a previously released song, was released. The field is formatted
+      as in the "TYER" frame.
+
+
+
+  TOWN
+      The 'File owner/licensee' frame contains the name of the owner or
+      licensee of the file and it's contents.
+
+
+
+  TPE1
+      The 'Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group' is
+      used for the main artist(s). They are seperated with the "/" character.
+
+
+
+  TPE2
+      The 'Band/Orchestra/Accompaniment' frame is used for additional
+      information about the performers in the recording.
+
+
+
+  TPE3
+      The 'Conductor' frame is used for the name of the conductor.
+
+
+
+  TPE4
+      The 'Interpreted, remixed, or otherwise modified by' frame contains more
+      information about the people behind a remix and similar interpretations
+      of another existing piece.
+
+
+
+  TPOS
+      The 'Part of a set' frame is a numeric string that describes which part
+      of a set the audio came from. This frame is used if the source described
+      in the "TALB" frame is divided into several mediums, e.g. a double CD.
+      The value may be extended with a "/" character and a numeric string
+      containing the total number of parts in the set. E.g. "1/2".
+
+
+
+  TPUB
+      The 'Publisher' frame simply contains the name of the label or publisher.
+
+
+
+  TRCK
+      The 'Track number/Position in set' frame is a numeric string containing
+      the order number of the audio-file on its original recording. This may be
+      extended with a "/" character and a numeric string containing the total
+      numer of tracks/elements on the original recording. E.g. "4/9".
+
+
+
+  TRDA
+      The 'Recording dates' frame is a intended to be used as complement to the
+      "TYER", "TDAT" and "TIME" frames. E.g. "4th-7th June, 12th June" in
+      combination with the "TYER" frame.
+
+
+
+  TRSN
+      The 'Internet radio station name' frame contains the name of the internet
+      radio station from which the audio is streamed.
+
+
+
+  TRSO
+      The 'Internet radio station owner' frame contains the name of the owner
+      of the internet radio station from which the audio is streamed.
+
+
+
+  TSIZ
+      The 'Size' frame contains the size of the audiofile in bytes, excluding
+      the ID3v2 tag, represented as a numeric string.
+
+
+
+  TSRC
+      The 'ISRC' frame should contain the International Standard Recording Code
+      (ISRC) (12 characters).
+
+
+
+  TSSE
+      The 'Software/Hardware and settings used for encoding' frame includes the
+      used audio encoder and its settings when the file was encoded. Hardware
+      refers to hardware encoders, not the computer on which a program was run.
+
+
+
+  TYER
+      The 'Year' frame is a numeric string with a year of the recording. This
+      frames is always four characters long (until the year 10000).
+
+
+4.2.2. User defined text information frame
+
+This frame is intended for one-string text information concerning the audiofile
+in a similar way to the other "T"-frames. The frame body consists of a
+description of the string, represented as a terminated string, followed by the
+actual string. There may be more than one "TXXX" frame in each tag, but only
+one with the same description.
+
+  <Header for 'User defined text information frame', ID: "TXXX">
+  Text encoding    $xx
+  Description    <text string according to encoding> $00 (00)
+  Value    <text string according to encoding>
+
+
+4.3. URL link frames
+
+With these frames dynamic data such as webpages with touring information, price
+information or plain ordinary news can be added to the tag. There may only be
+one URL link frame of its kind in an tag, except when stated otherwise in the
+frame description. If the textstring is followed by a termination ($00 (00))
+all the following information should be ignored and not be displayed. All URL
+link frame identifiers begins with "W". Only URL link frame identifiers begins
+with "W". All URL link frames have the following format:
+
+  <Header for 'URL link frame', ID: "W000" - "WZZZ", excluding "WXXX" described
+  in 4.3.2.>
+  URL <text string>
+
+
+4.3.1. URL link frames - details
+
+
+
+  WCOM
+      The 'Commercial information' frame is a URL pointing at a webpage with
+      information such as where the album can be bought. There may be more than
+      one "WCOM" frame in a tag, but not with the same content.
+
+
+
+  WCOP
+      The 'Copyright/Legal information' frame is a URL pointing at a webpage
+      where the terms of use and ownership of the file is described.
+
+
+
+  WOAF
+      The 'Official audio file webpage' frame is a URL pointing at a file
+      specific webpage.
+
+
+
+  WOAR
+      The 'Official artist/performer webpage' frame is a URL pointing at the
+      artists official webpage. There may be more than one "WOAR" frame in a
+      tag if the audio contains more than one performer, but not with the same
+      content.
+
+
+
+  WOAS
+      The 'Official audio source webpage' frame is a URL pointing at the
+      official webpage for the source of the audio file, e.g. a movie.
+
+
+
+  WORS
+      The 'Official internet radio station homepage' contains a URL pointing at
+      the homepage of the internet radio station.
+
+
+
+  WPAY
+      The 'Payment' frame is a URL pointing at a webpage that will handle the
+      process of paying for this file.
+
+
+
+  WPUB
+      The 'Publishers official webpage' frame is a URL pointing at the official
+      wepage for the publisher.
+
+
+4.3.2. User defined URL link frame
+
+This frame is intended for URL links concerning the audiofile in a similar way
+to the other "W"-frames. The frame body consists of a description of the
+string, represented as a terminated string, followed by the actual URL. The URL
+is always encoded with ISO-8859-1. There may be more than one "WXXX" frame in
+each tag, but only one with the same description.
+
+  <Header for 'User defined URL link frame', ID: "WXXX">
+  Text encoding    $xx
+  Description    <text string according to encoding> $00 (00)
+  URL    <text string>
+
+
+4.4. Involved people list
+
+Since there might be a lot of people contributing to an audio file in various
+ways, such as musicians and technicians, the 'Text information frames' are
+often insufficient to list everyone involved in a project. The 'Involved people
+list' is a frame containing the names of those involved, and how they were
+involved. The body simply contains a terminated string with the involvement
+directly followed by a terminated string with the involvee followed by a new
+involvement and so on. There may only be one "IPLS" frame in each tag.
+
+  <Header for 'Involved people list', ID: "IPLS">
+  Text encoding    $xx
+  People list strings    <text strings according to encoding>
+
+
+4.5. Music CD identifier
+
+This frame is intended for music that comes from a CD, so that the CD can be
+identified in databases such as the CDDB. The frame consists of a binary dump
+of the Table Of Contents, TOC, from the CD, which is a header of 4 bytes and
+then 8 bytes/track on the CD plus 8 bytes for the 'lead out' making a maximum
+of 804 bytes. The offset to the beginning of every track on the CD should be
+described with a four bytes absolute CD-frame address per track, and not with
+absolute time. This frame requires a present and valid "TRCK" frame, even if
+the CD's only got one track. There may only be one "MCDI" frame in each tag.
+
+  <Header for 'Music CD identifier', ID: "MCDI">
+  CD TOC <binary data>
+
+
+4.6. Event timing codes
+
+This frame allows synchronisation with key events in a song or sound. The
+header is:
+
+  <Header for 'Event timing codes', ID: "ETCO">
+  Time stamp format    $xx
+
+Where time stamp format is:
+
+  $01 Absolute time, 32 bit sized, using MPEG frames as unit
+  $02 Absolute time, 32 bit sized, using milliseconds as unit
+
+Absolute time means that every stamp contains the time from the beginning of the
+file.
+Followed by a list of key events in the following format:
+
+  Type of event   $xx
+  Time stamp      $xx (xx ...)
+
+The 'Time stamp' is set to zero if directly at the beginning of the sound or
+after the previous event. All events should be sorted in chronological order.
+The type of event is as follows:
+
+  $00     padding (has no meaning)
+  $01     end of initial silence
+  $02     intro start
+  $03     mainpart start
+  $04     outro start
+  $05     outro end
+  $06     verse start
+  $07     refrain start
+  $08     interlude start
+  $09     theme start
+  $0A     variation start
+  $0B     key change
+  $0C     time change
+  $0D     momentary unwanted noise (Snap, Crackle &amp; Pop)
+  $0E     sustained noise
+  $0F     sustained noise end
+  $10     intro end
+  $11     mainpart end
+  $12     verse end
+  $13     refrain end
+  $14     theme end
+  $15-$DF reserved for future use
+  $E0-$EF not predefined sync 0-F
+  $F0-$FC reserved for future use
+  $FD     audio end (start of silence)
+  $FE     audio file ends
+  $FF     one more byte of events follows (all the following bytes with the
+  value $FF have the same function)
+
+Terminating the start events such as "intro start" is not required. The 'Not
+predefined sync's ($E0-EF) are for user events. You might want to synchronise
+your music to something, like setting of an explosion on-stage, turning on your
+screensaver etc.
+There may only be one "ETCO" frame in each tag.
+
+4.7. MPEG location lookup table
+
+To increase performance and accuracy of jumps within a MPEG audio file, frames
+with timecodes in different locations in the file might be useful. The ID3v2
+frame includes references that the software can use to calculate positions in
+the file. After the frame header is a descriptor of how much the 'frame
+counter' should increase for every reference. If this value is two then the
+first reference points out the second frame, the 2nd reference the 4th frame,
+the 3rd reference the 6th frame etc. In a similar way the 'bytes between
+reference' and 'milliseconds between reference' points out bytes and
+milliseconds respectively.
+Each reference consists of two parts; a certain number of bits, as defined in
+'bits for bytes deviation', that describes the difference between what is said
+in 'bytes between reference' and the reality and a certain number of bits, as
+defined in 'bits for milliseconds deviation', that describes the difference
+between what is said in 'milliseconds between reference' and the reality. The
+number of bits in every reference, i.e. 'bits for bytes deviation'+'bits for
+milliseconds deviation', must be a multiple of four. There may only be one
+"MLLT" frame in each tag.
+
+  <Header for 'Location lookup table', ID: "MLLT">
+  MPEG frames between reference   $xx xx
+  Bytes between reference         $xx xx xx
+  Milliseconds between reference  $xx xx xx
+  Bits for bytes deviation        $xx
+  Bits for milliseconds dev.      $xx
+
+Then for every reference the following data is included;
+
+  Deviation in bytes         %xxx....
+  Deviation in milliseconds  %xxx....
+
+
+4.8. Synchronised tempo codes
+
+For a more accurate description of the tempo of a musical piece this frame
+might be used. After the header follows one byte describing which time stamp
+format should be used. Then follows one or more tempo codes. Each tempo code
+consists of one tempo part and one time part. The tempo is in BPM described
+with one or two bytes. If the first byte has the value $FF, one more byte
+follows, which is added to the first giving a range from 2 - 510 BPM, since $00
+and $01 is reserved. $00 is used to describe a beat-free time period, which is
+not the same as a music-free time period. $01 is used to indicate one single
+beat-stroke followed by a beat-free period.
+The tempo descriptor is followed by a time stamp. Every time the tempo in the
+music changes, a tempo descriptor may indicate this for the player. All tempo
+descriptors should be sorted in chronological order. The first beat-stroke in a
+time-period is at the same time as the beat description occurs. There may only
+be one "SYTC" frame in each tag.
+
+  <Header for 'Synchronised tempo codes', ID: "SYTC">
+  Time stamp format    $xx
+  Tempo data           <binary data>
+
+Where time stamp format is:
+
+  $01 Absolute time, 32 bit sized, using MPEG frames as unit
+  $02 Absolute time, 32 bit sized, using milliseconds as unit
+
+Absolute time means that every stamp contains the time from the beginning of the
+file.
+
+4.9. Unsychronised lyrics/text transcription
+
+This frame contains the lyrics of the song or a text transcription of other
+vocal activities. The head includes an encoding descriptor and a content
+descriptor. The body consists of the actual text. The 'Content descriptor' is a
+terminated string. If no descriptor is entered, 'Content descriptor' is $00
+(00) only. Newline characters are allowed in the text. There may be more than
+one 'Unsynchronised lyrics/text transcription' frame in each tag, but only one
+with the same language and content descriptor.
+
+  <Header for 'Unsynchronised lyrics/text transcription', ID: "USLT">
+  Text encoding       $xx
+  Language            $xx xx xx
+  Content descriptor  <text string according to encoding> $00 (00)
+  Lyrics/text         <full text string according to encoding>
+
+
+4.10. Synchronised lyrics/text
+
+This is another way of incorporating the words, said or sung lyrics, in the
+audio file as text, this time, however, in sync with the audio. It might also
+be used to describing events e.g. occurring on a stage or on the screen in sync
+with the audio. The header includes a content descriptor, represented with as
+terminated textstring. If no descriptor is entered, 'Content descriptor' is $00
+(00) only.
+
+  <Header for 'Synchronised lyrics/text', ID: "SYLT">
+  Text encoding       $xx
+  Language            $xx xx xx
+  Time stamp format   $xx
+  Content type        $xx
+  Content descriptor  <text string according to encoding> $00 (00)
+
+Encoding:
+
+  $00     ISO-8859-1 character set is used => $00 is sync identifier.
+  $01     Unicode character set is used => $00 00 is sync identifier.
+
+Content type:
+
+  $00     is other
+  $01     is lyrics
+  $02     is text transcription
+  $03     is movement/part name (e.g. "Adagio")
+  $04     is events (e.g. "Don Quijote enters the stage")
+  $05     is chord (e.g. "Bb F Fsus")
+  $06     is trivia/'pop up' information
+
+Time stamp format is:
+
+  $01 Absolute time, 32 bit sized, using MPEG frames as unit
+  $02 Absolute time, 32 bit sized, using milliseconds as unit
+
+Absolute time means that every stamp contains the time from the beginning of the
+file.
+The text that follows the frame header differs from that of the unsynchronised
+lyrics/text transcription in one major way. Each syllable (or whatever size of
+text is considered to be convenient by the encoder) is a null terminated string
+followed by a time stamp denoting where in the sound file it belongs. Each sync
+thus has the following structure:
+
+  Terminated text to be synced (typically a syllable)
+  Sync identifier (terminator to above string)    $00 (00)
+  Time stamp      $xx (xx ...)
+
+The 'time stamp' is set to zero or the whole sync is omitted if located
+directly at the beginning of the sound. All time stamps should be sorted in
+chronological order. The sync can be considered as a validator of the
+subsequent string.
+Newline ($0A) characters are allowed in all "SYLT" frames and should be used
+after every entry (name, event etc.) in a frame with the content type $03 -
+$04.
+A few considerations regarding whitespace characters: Whitespace separating
+words should mark the beginning of a new word, thus occurring in front of the
+first syllable of a new word. This is also valid for new line characters. A
+syllable followed by a comma should not be broken apart with a sync (both the
+syllable and the comma should be before the sync).
+An example: The "USLT" passage
+
+  "Strangers in the night" $0A "Exchanging glances"
+
+would be "SYLT" encoded as:
+
+  "Strang" $00 xx xx "ers" $00 xx xx " in" $00 xx xx " the" $00
+  xx xx " night" $00 xx xx 0A "Ex" $00 xx xx "chang" $00 xx xx
+  "ing" $00 xx xx "glan" $00 xx xx "ces" $00 xx xx
+
+There may be more than one "SYLT" frame in each tag, but only one with the same
+language and content descriptor.
+
+4.11. Comments
+
+This frame is indended for any kind of full text information that does not fit
+in any other frame. It consists of a frame header followed by encoding,
+language and content descriptors and is ended with the actual comment as a text
+string. Newline characters are allowed in the comment text string. There may be
+more than one comment frame in each tag, but only one with the same language
+and content descriptor.
+
+  <Header for 'Comment', ID: "COMM">
+  Text encoding           $xx
+  Language                $xx xx xx
+  Short content descrip.  <text string according to encoding> $00 (00)
+  The actual text         <full text string according to encoding>
+
+
+4.12. Relative volume adjustment
+
+This is a more subjective function than the previous ones. It allows the user
+to say how much he wants to increase/decrease the volume on each channel while
+the file is played. The purpose is to be able to align all files to a reference
+volume, so that you don't have to change the volume constantly. This frame may
+also be used to balance adjust the audio. If the volume peak levels are known
+then this could be described with the 'Peak volume right' and 'Peak volume
+left' field. If Peakvolume is not known these fields could be left zeroed or,
+if no other data follows, be completely omitted. There may only be one "RVAD"
+frame in each tag.
+
+  <Header for 'Relative volume adjustment', ID: "RVAD">
+  Increment/decrement             %00xxxxxx
+  Bits used for volume descr.     $xx
+  Relative volume change, right   $xx xx (xx ...)
+  Relative volume change, left    $xx xx (xx ...)
+  Peak volume right               $xx xx (xx ...)
+  Peak volume left                $xx xx (xx ...)
+
+In the increment/decrement field bit 0 is used to indicate the right channel
+and bit 1 is used to indicate the left channel. 1 is increment and 0 is
+decrement.
+The 'bits used for volume description' field is normally $10 (16 bits) for MPEG
+2 layer I, II and III and MPEG 2.5. This value may not be $00. The volume is
+always represented with whole bytes, padded in the beginning (highest bits)
+when 'bits used for volume description' is not a multiple of eight.
+This datablock is then optionally followed by a volume definition for the left
+and right back channels. If this information is appended to the frame the first
+two channels will be treated as front channels. In the increment/decrement
+field bit 2 is used to indicate the right back channel and bit 3 for the left
+back channel.
+
+  Relative volume change, right back      $xx xx (xx ...)
+  Relative volume change, left back       $xx xx (xx ...)
+  Peak volume right back                  $xx xx (xx ...)
+  Peak volume left back                   $xx xx (xx ...)
+
+If the center channel adjustment is present the following is appended to the
+existing frame, after the left and right back channels. The center channel is
+represented by bit 4 in the increase/decrease field.
+
+  Relative volume change, center  $xx xx (xx ...)
+  Peak volume center              $xx xx (xx ...)
+
+If the bass channel adjustment is present the following is appended to the
+existing frame, after the center channel. The bass channel is represented by
+bit 5 in the increase/decrease field.
+
+  Relative volume change, bass    $xx xx (xx ...)
+  Peak volume bass                $xx xx (xx ...)
+
+
+4.13. Equalisation
+
+This is another subjective, alignment frame. It allows the user to predefine an
+equalisation curve within the audio file. There may only be one "EQUA" frame in
+each tag.
+
+  <Header of 'Equalisation', ID: "EQUA">
+  Adjustment bits $xx
+
+The 'adjustment bits' field defines the number of bits used for representation
+of the adjustment. This is normally $10 (16 bits) for MPEG 2 layer I, II and
+III and MPEG 2.5. This value may not be $00.
+This is followed by 2 bytes + ('adjustment bits' rounded up to the nearest
+byte) for every equalisation band in the following format, giving a frequency
+range of 0 - 32767Hz:
+
+  Increment/decrement     %x (MSB of the Frequency)
+  Frequency               (lower 15 bits)
+  Adjustment              $xx (xx ...)
+
+The increment/decrement bit is 1 for increment and 0 for decrement. The
+equalisation bands should be ordered increasingly with reference to frequency.
+All frequencies don't have to be declared. The equalisation curve in the
+reading software should be interpolated between the values in this frame. Three
+equal adjustments for three subsequent frequencies. A frequency should only be
+described once in the frame.
+
+4.14. Reverb
+
+Yet another subjective one. You may here adjust echoes of different kinds.
+Reverb left/right is the delay between every bounce in ms. Reverb bounces left/
+right is the number of bounces that should be made. $FF equals an infinite
+number of bounces. Feedback is the amount of volume that should be returned to
+the next echo bounce. $00 is 0%, $FF is 100%. If this value were $7F, there
+would be 50% volume reduction on the first bounce, 50% of that on the second
+and so on. Left to left means the sound from the left bounce to be played in
+the left speaker, while left to right means sound from the left bounce to be
+played in the right speaker.
+'Premix left to right' is the amount of left sound to be mixed in the right
+before any reverb is applied, where $00 id 0% and $FF is 100%. 'Premix right to
+left' does the same thing, but right to left. Setting both premix to $FF would
+result in a mono output (if the reverb is applied symmetric). There may only be
+one "RVRB" frame in each tag.
+
+  <Header for 'Reverb', ID: "RVRB">
+  Reverb left (ms)                $xx xx
+  Reverb right (ms)               $xx xx
+  Reverb bounces, left            $xx
+  Reverb bounces, right           $xx
+  Reverb feedback, left to left   $xx
+  Reverb feedback, left to right  $xx
+  Reverb feedback, right to right $xx
+  Reverb feedback, right to left  $xx
+  Premix left to right            $xx
+  Premix right to left            $xx
+
+
+4.15. Attached picture
+
+This frame contains a picture directly related to the audio file. Image format
+is the MIME type and subtype for the image. In the event that the MIME media
+type name is omitted, "image/" will be implied. The "image/png" or "image/jpeg"
+picture format should be used when interoperability is wanted. Description is a
+short description of the picture, represented as a terminated textstring. The
+description has a maximum length of 64 characters, but may be empty. There may
+be several pictures attached to one file, each in their individual "APIC"
+frame, but only one with the same content descriptor. There may only be one
+picture with the picture type declared as picture type $01 and $02
+respectively. There is the possibility to put only a link to the image file by
+using the 'MIME type' "-->" and having a complete URL instead of picture data.
+The use of linked files should however be used sparingly since there is the
+risk of separation of files.
+
+  <Header for 'Attached picture', ID: "APIC">
+  Text encoding   $xx
+  MIME type       <text string> $00
+  Picture type    $xx
+  Description     <text string according to encoding> $00 (00)
+  Picture data    <binary data>
+
+Picture type:
+
+  $00     Other
+  $01     32x32 pixels 'file icon' (PNG only)
+  $02     Other file icon
+  $03     Cover (front)
+  $04     Cover (back)
+  $05     Leaflet page
+  $06     Media (e.g. lable side of CD)
+  $07     Lead artist/lead performer/soloist
+  $08     Artist/performer
+  $09     Conductor
+  $0A     Band/Orchestra
+  $0B     Composer
+  $0C     Lyricist/text writer
+  $0D     Recording Location
+  $0E     During recording
+  $0F     During performance
+  $10     Movie/video screen capture
+  $11     A bright coloured fish
+  $12     Illustration
+  $13     Band/artist logotype
+  $14     Publisher/Studio logotype
+
+
+4.16. General encapsulated object
+
+In this frame any type of file can be encapsulated. After the header, 'Frame
+size' and 'Encoding' follows 'MIME type' represented as as a terminated string
+encoded with ISO-8859-1. The filename is case sensitive and is encoded as
+'Encoding'. Then follows a content description as terminated string, encoded as
+'Encoding'. The last thing in the frame is the actual object. The first two
+strings may be omitted, leaving only their terminations. There may be more than
+one "GEOB" frame in each tag, but only one with the same content descriptor.
+
+  <Header for 'General encapsulated object', ID: "GEOB">
+  Text encoding           $xx
+  MIME type               <text string> $00
+  Filename                <text string according to encoding> $00 (00)
+  Content description     $00 (00)
+  Encapsulated object     <binary data>
+
+
+4.17. Play counter
+
+This is simply a counter of the number of times a file has been played. The
+value is increased by one every time the file begins to play. There may only be
+one "PCNT" frame in each tag. When the counter reaches all one's, one byte is
+inserted in front of the counter thus making the counter eight bits bigger. The
+counter must be at least 32-bits long to begin with.
+
+  <Header for 'Play counter', ID: "PCNT">
+  Counter         $xx xx xx xx (xx ...)
+
+
+4.18. Popularimeter
+
+The purpose of this frame is to specify how good an audio file is. Many
+interesting applications could be found to this frame such as a playlist that
+features better audiofiles more often than others or it could be used to
+profile a person's taste and find other 'good' files by comparing people's
+profiles. The frame is very simple. It contains the email address to the user,
+one rating byte and a four byte play counter, intended to be increased with one
+for every time the file is played. The email is a terminated string. The rating
+is 1-255 where 1 is worst and 255 is best. 0 is unknown. If no personal counter
+is wanted it may be omitted. When the counter reaches all one's, one byte is
+inserted in front of the counter thus making the counter eight bits bigger in
+the same away as the play counter ("PCNT"). There may be more than one "POPM"
+frame in each tag, but only one with the same email address.
+
+  <Header for 'Popularimeter', ID: "POPM">
+  Email to user   <text string> $00
+  Rating          $xx
+  Counter         $xx xx xx xx (xx ...)
+
+
+4.19. Recommended buffer size
+
+Sometimes the server from which a audio file is streamed is aware of
+transmission or coding problems resulting in interruptions in the audio stream.
+In these cases, the size of the buffer can be recommended by the server using
+this frame. If the 'embedded info flag' is true (1) then this indicates that an
+ID3 tag with the maximum size described in 'Buffer size' may occur in the
+audiostream. In such case the tag should reside between two MPEG frames, if the
+audio is MPEG encoded. If the position of the next tag is known, 'offset to
+next tag' may be used. The offset is calculated from the end of tag in which
+this frame resides to the first byte of the header in the next. This field may
+be omitted. Embedded tags are generally not recommended since this could render
+unpredictable behaviour from present software/hardware.
+For applications like streaming audio it might be an idea to embed tags into
+the audio stream though. If the clients connects to individual connections like
+HTTP and there is a possibility to begin every transmission with a tag, then
+this tag should include a 'recommended buffer size' frame. If the client is
+connected to a arbitrary point in the stream, such as radio or multicast, then
+the 'recommended buffer size' frame should be included in every tag. Every tag
+that is picked up after the initial/first tag is to be considered as an update
+of the previous one. E.g. if there is a "TIT2" frame in the first received tag
+and one in the second tag, then the first should be 'replaced' with the second.
+The 'Buffer size' should be kept to a minimum. There may only be one "RBUF"
+frame in each tag.
+
+  <Header for 'Recommended buffer size', ID: "RBUF">
+  Buffer size             $xx xx xx
+  Embedded info flag      %0000000x
+  Offset to next tag      $xx xx xx xx
+
+
+4.20. Audio encryption
+
+This frame indicates if the actual audio stream is encrypted, and by whom.
+Since standardisation of such encryption scheme is beyond this document, all
+"AENC" frames begin with a terminated string with a URL containing an email
+address, or a link to a location where an email address can be found, that
+belongs to the organisation responsible for this specific encrypted audio file.
+Questions regarding the encrypted audio should be sent to the email address
+specified. If a $00 is found directly after the 'Frame size' and the audiofile
+indeed is encrypted, the whole file may be considered useless.
+After the 'Owner identifier', a pointer to an unencrypted part of the audio can
+be specified. The 'Preview start' and 'Preview length' is described in frames.
+If no part is unencrypted, these fields should be left zeroed. After the
+'preview length' field follows optionally a datablock required for decryption
+of the audio. There may be more than one "AENC" frames in a tag, but only one
+with the same 'Owner identifier'.
+
+  <Header for 'Audio encryption', ID: "AENC">
+  Owner identifier        <text string> $00
+  Preview start           $xx xx
+  Preview length          $xx xx
+  Encryption info         <binary data>
+
+
+4.21. Linked information
+
+To keep space waste as low as possible this frame may be used to link
+information from another ID3v2 tag that might reside in another audio file or
+alone in a binary file. It is recommended that this method is only used when
+the files are stored on a CD-ROM or other circumstances when the risk of file
+seperation is low. The frame contains a frame identifier, which is the frame
+that should be linked into this tag, a URL field, where a reference to the file
+where the frame is given, and additional ID data, if needed. Data should be
+retrieved from the first tag found in the file to which this link points. There
+may be more than one "LINK" frame in a tag, but only one with the same
+contents. A linked frame is to be considered as part of the tag and has the
+same restrictions as if it was a physical part of the tag (i.e. only one "RVRB"
+frame allowed, whether it's linked or not).
+
+  <Header for 'Linked information', ID: "LINK">
+  Frame identifier        $xx xx xx
+  URL                     <text string> $00
+  ID and additional data  <text string(s)>
+
+Frames that may be linked and need no additional data are "IPLS", "MCID",
+"ETCO", "MLLT", "SYTC", "RVAD", "EQUA", "RVRB", "RBUF", the text information
+frames and the URL link frames.
+The "TXXX", "APIC", "GEOB" and "AENC" frames may be linked with the content
+descriptor as additional ID data.
+The "COMM", "SYLT" and "USLT" frames may be linked with three bytes of language
+descriptor directly followed by a content descriptor as additional ID data.
+
+4.22. Position synchronisation frame
+
+This frame delivers information to the listener of how far into the audio
+stream he picked up; in effect, it states the time offset of the first frame in
+the stream. The frame layout is:
+
+  <Head for 'Position synchronisation', ID: "POSS">
+  Time stamp format   $xx
+  Position            $xx (xx ...)
+
+Where time stamp format is:
+
+  $01 Absolute time, 32 bit sized, using MPEG frames as unit
+  $02 Absolute time, 32 bit sized, using milliseconds as unit
+
+and position is where in the audio the listener starts to receive, i.e. the
+beginning of the next frame. If this frame is used in the beginning of a file
+the value is always 0. There may only be one "POSS" frame in each tag.
+
+4.23. Terms of use frame
+
+This frame contains a brief description of the terms of use and ownership of
+the file. More detailed information concerning the legal terms might be
+available through the "WCOP" frame. Newlines are allowed in the text. There may
+only be one "USER" frame in a tag.
+
+  <Header for 'Terms of use frame', ID: "USER">
+  Text encoding   $xx
+  Language        $xx xx xx
+  The actual text <text string according to encoding>
+
+
+4.24. Ownership frame
+
+The ownership frame might be used as a reminder of a made transaction or, if
+signed, as proof. Note that the "USER" and "TOWN" frames are good to use in
+conjunction with this one. The frame begins, after the frame ID, size and
+encoding fields, with a 'price payed' field. The first three characters of this
+field contains the currency used for the transaction, encoded according to ISO-
+4217 alphabetic currency code. Concatenated to this is the actual price payed,
+as a numerical string using "." as the decimal separator. Next is an 8
+character date string (YYYYMMDD) followed by a string with the name of the
+seller as the last field in the frame. There may only be one "OWNE" frame in a
+tag.
+
+  <Header for 'Ownership frame', ID: "OWNE">
+  Text encoding   $xx
+  Price payed     <text string> $00
+  Date of purch.  <text string>
+  Seller          <text string according to encoding>
+
+
+4.25. Commercial frame
+
+This frame enables several competing offers in the same tag by bundling all
+needed information. That makes this frame rather complex but it's an easier
+solution than if one tries to achieve the same result with several frames. The
+frame begins, after the frame ID, size and encoding fields, with a price string
+field. A price is constructed by one three character currency code, encoded
+according to ISO-4217 alphabetic currency code, followed by a numerical value
+where "." is used as decimal seperator. In the price string several prices may
+be concatenated, seperated by a "/" character, but there may only be one
+currency of each type.
+The price string is followed by an 8 character date string in the format
+YYYYMMDD, describing for how long the price is valid. After that is a contact
+URL, with which the user can contact the seller, followed by a one byte
+'received as' field. It describes how the audio is delivered when bought
+according to the following list:
+
+  $00     Other
+  $01     Standard CD album with other songs
+  $02     Compressed audio on CD
+  $03     File over the Internet
+  $04     Stream over the Internet
+  $05     As note sheets
+  $06     As note sheets in a book with other sheets
+  $07     Music on other media
+  $08     Non-musical merchandise
+
+Next follows a terminated string with the name of the seller followed by a
+terminated string with a short description of the product. The last thing is
+the ability to include a company logotype. The first of them is the 'Picture
+MIME type' field containing information about which picture format is used. In
+the event that the MIME media type name is omitted, "image/" will be implied.
+Currently only "image/png" and "image/jpeg" are allowed. This format string is
+followed by the binary picture data. This two last fields may be omitted if no
+picture is to attach.
+
+  <Header for 'Commercial frame', ID: "COMR">
+  Text encoding     $xx
+  Price string      <text string> $00
+  Valid until       <text string>
+  Contact URL       <text string> $00
+  Received as       $xx
+  Name of seller    <text string according to encoding> $00 (00)
+  Description       <text string according to encoding> $00 (00)
+  Picture MIME type <string> $00
+  Seller logo       <binary data>
+
+
+4.26. Encryption method registration
+
+To identify with which method a frame has been encrypted the encryption method
+must be registered in the tag with this frame. The 'Owner identifier' is a
+null-terminated string with a URL containing an email address, or a link to a
+location where an email address can be found, that belongs to the organisation
+responsible for this specific encryption method. Questions regarding the
+encryption method should be sent to the indicated email address. The 'Method
+symbol' contains a value that is associated with this method throughout the
+whole tag. Values below $80 are reserved. The 'Method symbol' may optionally be
+followed by encryption specific data. There may be several "ENCR" frames in a
+tag but only one containing the same symbol and only one containing the same
+owner identifier. The method must be used somewhere in the tag. See section
+3.3.1, flag j for more information.
+
+  <Header for 'Encryption method registration', ID: "ENCR">
+  Owner identifier    <text string> $00
+  Method symbol       $xx
+  Encryption data     <binary data>
+
+
+4.27. Group identification registration
+
+This frame enables grouping of otherwise unrelated frames. This can be used
+when some frames are to be signed. To identify which frames belongs to a set of
+frames a group identifier must be registered in the tag with this frame. The
+'Owner identifier' is a null-terminated string with a URL containing an email
+address, or a link to a location where an email address can be found, that
+belongs to the organisation responsible for this grouping. Questions regarding
+the grouping should be sent to the indicated email address. The 'Group symbol'
+contains a value that associates the frame with this group throughout the whole
+tag. Values below $80 are reserved. The 'Group symbol' may optionally be
+followed by some group specific data, e.g. a digital signature. There may be
+several "GRID" frames in a tag but only one containing the same symbol and only
+one containing the same owner identifier. The group symbol must be used
+somewhere in the tag. See section_3.3.1, flag j for more information.
+
+  <Header for 'Group ID registration', ID: "GRID">
+  Owner identifier     <text string> $00
+  Group symbol         $xx
+  Group dependent data <binary data>
+
+
+4.28. Private frame
+
+This frame is used to contain information from a software producer that its
+program uses and does not fit into the other frames. The frame consists of an
+'Owner identifier' string and the binary data. The 'Owner identifier' is a
+null-terminated string with a URL containing an email address, or a link to a
+location where an email address can be found, that belongs to the organisation
+responsible for the frame. Questions regarding the frame should be sent to the
+indicated email address. The tag may contain more than one "PRIV" frame but
+only with different contents. It is recommended to keep the number of "PRIV"
+frames as low as possible.
+
+  <Header for 'Private frame', ID: "PRIV">
+  Owner identifier        <text string> $00
+  The private data        <binary data>
+
+
+
+5. The unsynchronisation scheme
+
+The only purpose of the 'unsynchronisation scheme' is to make the ID3v2 tag as
+compatible as possible with existing software. There is no use in
+'unsynchronising' tags if the file is only to be processed by new software.
+Unsynchronisation may only be made with MPEG 2 layer I, II and III and MPEG 2.5
+files.
+Whenever a false synchronisation is found within the tag, one zeroed byte is
+inserted after the first false synchronisation byte. The format of a correct
+sync that should be altered by ID3 encoders is as follows:
+
+  %11111111 111xxxxx
+
+And should be replaced with:
+
+  %11111111 00000000 111xxxxx
+
+This has the side effect that all $FF 00 combinations have to be altered, so
+they won't be affected by the decoding process. Therefore all the $FF 00
+combinations have to be replaced with the $FF 00 00 combination during the
+unsynchronisation.
+To indicate usage of the unsynchronisation, the first bit in 'ID3 flags' should
+be set. This bit should only be set if the tag contains a, now corrected, false
+synchronisation. The bit should only be clear if the tag does not contain any
+false synchronisations.
+Do bear in mind, that if a compression scheme is used by the encoder, the
+unsynchronisation scheme should be applied *afterwards*. When decoding a
+compressed, 'unsynchronised' file, the 'unsynchronisation scheme' should be
+parsed first, decompression afterwards.
+If the last byte in the tag is $FF, and there is a need to eliminate false
+synchronisations in the tag, at least one byte of padding should be added.
+
+
+6. Copyright
+
+Copyright © Martin Nilsson 1998. All Rights Reserved.
+This document and translations of it may be copied and furnished to others, and
+derivative works that comment on or otherwise explain it or assist in its
+implementation may be prepared, copied, published and distributed, in whole or
+in part, without restriction of any kind, provided that a reference to this
+document is included on all such copies and derivative works. However, this
+document itself may not be modified in any way and reissued as the original
+document.
+The limited permissions granted above are perpetual and will not be revoked.
+This document and the information contained herein is provided on an "AS IS"
+basis and THE AUTHORS DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
+BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION HEREIN WILL NOT
+INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR
+A PARTICULAR PURPOSE.
+
+
+7. References
+
+[CDDB] Compact Disc Data Base http://www.cddb.com
+
+[ID3v2] Martin Nilsson, "ID3v2_informal_standard".
+
+ [ISO-639-2] ISO/FDIS 639-2. Codes for the representation of names of
+languages, Part 2: Alpha-3 code. Technical committee / subcommittee: TC 37 / SC
+2
+
+ [ISO-4217] ISO 4217:1995. Codes for the representation of currencies and
+funds. Technical committee / subcommittee: TC 68
+
+ [ISO-8859-1] ISO/IEC DIS 8859-1. 8-bit single-byte coded graphic character
+sets, Part 1: Latin alphabet No. 1. Technical committee / subcommittee: JTC 1 /
+SC 2
+
+ [ISRC] ISO 3901:1986 International Standard Recording Code (ISRC). Technical
+committee / subcommittee: TC 46 / SC 9
+
+ [JFIF] JPEG File Interchange Format, version 1.02, http://www.w3.org/Graphics/
+JPEG/jfif.txt
+
+ [MIME] Freed, N. and N. Borenstein, "Multipurpose Internet Mail Extensions
+(MIME) Part One: Format of Internet Message Bodies", RFC 2045, November 1996.,
+ftp://ftp.isi.edu/in-notes/rfc2045.txt
+
+ [MPEG] ISO/IEC 11172-3:1993. Coding of moving pictures and associated audio
+for digital storage media at up to about 1,5 Mbit/s, Part 3: Audio. Technical
+committee / subcommittee: JTC 1 / SC 29 and ISO/IEC 13818-3:1995 Generic coding
+of moving pictures and associated audio information, Part 3: Audio. Technical
+committee / subcommittee: JTC 1 / SC 29 and ISO/IEC DIS 13818-3 Generic coding
+of moving pictures and associated audio information, Part 3: Audio (Revision of
+ISO/IEC 13818-3:1995)
+
+ [PNG] Portable Network Graphics, version 1.0, http://www.w3.org/TR/REC-png-
+multi.html
+
+ [UNICODE] ISO/IEC 10646-1:1993. Universal Multiple-Octet Coded Character Set
+(UCS), Part 1: Architecture and Basic Multilingual Plane. Technical committee /
+subcommittee: JTC 1 / SC 2, http://www.unicode.org
+
+ [URL] T. Berners-Lee, L. Masinter &amp; M. McCahill, "Uniform Resource
+Locators (URL).", RFC 1738, December 1994., ftp://ftp.isi.edu/in-notes/
+rfc1738.txt
+
+ [ZLIB] P. Deutsch, Aladdin Enterprises &amp; J-L. Gailly, "ZLIB Compressed
+Data Format Specification version 3.3", RFC 1950, May 1996., url:ftp://
+ftp.isi.edu/in-notes/rfc1950.txt
+
+
+
+8. Appendix
+
+
+8.1. Appendix A - Genre List from ID3v1
+
+The following genres is defined in ID3v1
+
+   0. Blues
+    1. Classic Rock
+    2. Country
+    3. Dance
+    4. Disco
+    5. Funk
+    6. Grunge
+    7. Hip-Hop
+    8. Jazz
+    9. Metal
+   10. New Age
+   11. Oldies
+   12. Other
+   13. Pop
+   14. R&amp;B
+   15. Rap
+   16. Reggae
+   17. Rock
+   18. Techno
+   19. Industrial
+   20. Alternative
+   21. Ska
+   22. Death Metal
+   23. Pranks
+   24. Soundtrack
+   25. Euro-Techno
+   26. Ambient
+   27. Trip-Hop
+   28. Vocal
+   29. Jazz+Funk
+   30. Fusion
+   31. Trance
+   32. Classical
+   33. Instrumental
+   34. Acid
+   35. House
+   36. Game
+   37. Sound Clip
+   38. Gospel
+   39. Noise
+   40. AlternRock
+   41. Bass
+   42. Soul
+   43. Punk
+   44. Space
+   45. Meditative
+   46. Instrumental Pop
+   47. Instrumental Rock
+   48. Ethnic
+   49. Gothic
+   50. Darkwave
+   51. Techno-Industrial
+   52. Electronic
+   53. Pop-Folk
+   54. Eurodance
+   55. Dream
+   56. Southern Rock
+   57. Comedy
+   58. Cult
+   59. Gangsta
+   60. Top 40
+   61. Christian Rap
+   62. Pop/Funk
+   63. Jungle
+   64. Native American
+   65. Cabaret
+   66. New Wave
+   67. Psychadelic
+   68. Rave
+   69. Showtunes
+   70. Trailer
+   71. Lo-Fi
+   72. Tribal
+   73. Acid Punk
+   74. Acid Jazz
+   75. Polka
+   76. Retro
+   77. Musical
+   78. Rock &amp; Roll
+   79. Hard Rock
+
+The following genres are Winamp extensions
+
+   80. Folk
+   81. Folk-Rock
+   82. National Folk
+   83. Swing
+   84. Fast Fusion
+   85. Bebob
+   86. Latin
+   87. Revival
+   88. Celtic
+   89. Bluegrass
+   90. Avantgarde
+   91. Gothic Rock
+   92. Progressive Rock
+   93. Psychedelic Rock
+   94. Symphonic Rock
+   95. Slow Rock
+   96. Big Band
+   97. Chorus
+   98. Easy Listening
+   99. Acoustic
+  100. Humour
+  101. Speech
+  102. Chanson
+  103. Opera
+  104. Chamber Music
+  105. Sonata
+  106. Symphony
+  107. Booty Bass
+  108. Primus
+  109. Porn Groove
+  110. Satire
+  111. Slow Jam
+  112. Club
+  113. Tango
+  114. Samba
+  115. Folklore
+  116. Ballad
+  117. Power Ballad
+  118. Rhythmic Soul
+  119. Freestyle
+  120. Duet
+  121. Punk Rock
+  122. Drum Solo
+  123. A capella
+  124. Euro-House
+  125. Dance Hall
+
+
+
+9. Author's Address
+
+Written by
+Martin Nilsson
+Rydsven 246 C. 30
+S-584 34 Linkoping
+Sweden
+
+Email: nilsson at id3.org
+
+Edited by
+Dirk Mahoney
+57 Pechey Street
+Chermside Q
+Australia 4032
+
+Email: dirk at id3.org
+
+Johan Sundstrom
+Alsttersgatan 5 A. 34
+S-584 35 Linkoping
+Sweden
+
+Email: johan at id3.org
+id3v2.3.0 (last edited 2006-12-18 06:25:16 by DanONeill)
diff --git a/gst-libs/gst/tag/id3v2.4.0-frames.txt b/gst-libs/gst/tag/id3v2.4.0-frames.txt
new file mode 100644
index 0000000..d27b516
--- /dev/null
+++ b/gst-libs/gst/tag/id3v2.4.0-frames.txt
@@ -0,0 +1,1734 @@
+$Id$
+
+Informal standard                                             M. Nilsson
+Document: id3v2.4.0-frames.txt                         1st November 2000
+
+
+                  ID3 tag version 2.4.0 - Native Frames
+
+Status of this document
+
+   This document is an informal standard and replaces the ID3v2.3.0
+   standard [ID3v2]. A formal standard will use another revision number
+   even if the content is identical to document. The contents in this
+   document may change for clarifications but never for added or altered
+   functionallity.
+
+   Distribution of this document is unlimited.
+
+
+Abstract
+
+   This document describes the frames natively supported by ID3v2.4.0,
+   which is a revised version of the ID3v2 informal standard [ID3v2.3.0]
+   version 2.3.0. The ID3v2 offers a flexible way of storing audio meta
+   information within audio file itself. The information may be
+   technical information, such as equalisation curves, as well as title,
+   performer, copyright etc.
+
+   ID3v2.4.0 is meant to be as close as possible to ID3v2.3.0 in order
+   to allow for implementations to be revised as easily as possible.
+
+
+1.   Table of contents
+
+   2.   Conventions in this document
+   3.   Default flags
+   4.   Declared ID3v2 frames
+     4.1.   Unique file identifier
+     4.2.   Text information frames
+       4.2.1.   Identification frames
+       4.2.2.   Involved persons frames
+       4.2.3.   Derived and subjective properties frames
+       4.2.4.   Rights and license frames
+       4.2.5.   Other text frames
+       4.2.6.   User defined text information frame
+     4.3.   URL link frames
+       4.3.1.   URL link frames - details
+       4.3.2.   User defined URL link frame
+     4.4.   Music CD Identifier
+     4.5.   Event timing codes
+     4.6.   MPEG location lookup table
+     4.7.   Synced tempo codes
+     4.8.   Unsynchronised lyrics/text transcription
+     4.9.  Synchronised lyrics/text
+     4.10.  Comments
+     4.11.  Relative volume adjustment (2)
+     4.12.  Equalisation (2)
+     4.13.  Reverb
+     4.14.  Attached picture
+     4.15.  General encapsulated object
+     4.16.  Play counter
+     4.17.  Popularimeter
+     4.18.  Recommended buffer size
+     4.19.  Audio encryption
+     4.20.  Linked information
+     4.21.  Position synchronisation frame
+     4.22.  Terms of use
+     4.23.  Ownership frame
+     4.24.  Commercial frame
+     4.25.  Encryption method registration
+     4.26.  Group identification registration
+     4.27.  Private frame
+     4.28.  Signature frame
+     4.29.  Seek frame
+     4.30.  Audio seek point index
+   5.   Copyright
+   6.   References
+   7.   Appendix
+     A.   Appendix A - Genre List from ID3v1
+   8.   Author's Address
+
+
+2.   Conventions in this document
+
+   Text within "" is a text string exactly as it appears in a tag.
+   Numbers preceded with $ are hexadecimal and numbers preceded with %
+   are binary. $xx is used to indicate a byte with unknown content. %x
+   is used to indicate a bit with unknown content. The most significant
+   bit (MSB) of a byte is called 'bit 7' and the least significant bit
+   (LSB) is called 'bit 0'.
+
+   A tag is the whole tag described the ID3v2 main structure document
+   [ID3v2-strct]. A frame is a block of information in the tag. The tag
+   consists of a header, frames and optional padding. A field is a piece
+   of information; one value, a string etc. A numeric string is a string
+   that consists of the characters "0123456789" only.
+
+   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
+   "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this
+   document are to be interpreted as described in RFC 2119 [KEYWORDS].
+
+
+3.   Default flags
+
+   The default settings for the frames described in this document can be
+   divided into the following classes. The flags may be set differently
+   if found more suitable by the software.
+
+    1. Discarded if tag is altered, discarded if file is altered.
+
+       None.
+
+    2. Discarded if tag is altered, preserved if file is altered.
+
+       None.
+
+    3. Preserved if tag is altered, discarded if file is altered.
+
+       ASPI, AENC, ETCO, EQU2, MLLT, POSS, SEEK, SYLT, SYTC, RVA2, TENC,
+       TLEN
+
+    4. Preserved if tag is altered, preserved if file is altered.
+
+       The rest of the frames.
+
+
+4.   Declared ID3v2 frames
+
+   The following frames are declared in this draft.
+
+  4.19  AENC Audio encryption
+  4.14  APIC Attached picture
+  4.30  ASPI Audio seek point index
+
+  4.10  COMM Comments
+  4.24  COMR Commercial frame
+
+  4.25  ENCR Encryption method registration
+  4.12  EQU2 Equalisation (2)
+  4.5   ETCO Event timing codes
+
+  4.15  GEOB General encapsulated object
+  4.26  GRID Group identification registration
+
+  4.20  LINK Linked information
+
+  4.4   MCDI Music CD identifier
+  4.6   MLLT MPEG location lookup table
+
+  4.23  OWNE Ownership frame
+
+  4.27  PRIV Private frame
+  4.16  PCNT Play counter
+  4.17  POPM Popularimeter
+  4.21  POSS Position synchronisation frame
+
+  4.18  RBUF Recommended buffer size
+  4.11  RVA2 Relative volume adjustment (2)
+  4.13  RVRB Reverb
+
+  4.29  SEEK Seek frame
+  4.28  SIGN Signature frame
+  4.9   SYLT Synchronised lyric/text
+  4.7   SYTC Synchronised tempo codes
+
+  4.2.1 TALB Album/Movie/Show title
+  4.2.3 TBPM BPM (beats per minute)
+  4.2.2 TCOM Composer
+  4.2.3 TCON Content type
+  4.2.4 TCOP Copyright message
+  4.2.5 TDEN Encoding time
+  4.2.5 TDLY Playlist delay
+  4.2.5 TDOR Original release time
+  4.2.5 TDRC Recording time
+  4.2.5 TDRL Release time
+  4.2.5 TDTG Tagging time
+  4.2.2 TENC Encoded by
+  4.2.2 TEXT Lyricist/Text writer
+  4.2.3 TFLT File type
+  4.2.2 TIPL Involved people list
+  4.2.1 TIT1 Content group description
+  4.2.1 TIT2 Title/songname/content description
+  4.2.1 TIT3 Subtitle/Description refinement
+  4.2.3 TKEY Initial key
+  4.2.3 TLAN Language(s)
+  4.2.3 TLEN Length
+  4.2.2 TMCL Musician credits list
+  4.2.3 TMED Media type
+  4.2.3 TMOO Mood
+  4.2.1 TOAL Original album/movie/show title
+  4.2.5 TOFN Original filename
+  4.2.2 TOLY Original lyricist(s)/text writer(s)
+  4.2.2 TOPE Original artist(s)/performer(s)
+  4.2.4 TOWN File owner/licensee
+  4.2.2 TPE1 Lead performer(s)/Soloist(s)
+  4.2.2 TPE2 Band/orchestra/accompaniment
+  4.2.2 TPE3 Conductor/performer refinement
+  4.2.2 TPE4 Interpreted, remixed, or otherwise modified by
+  4.2.1 TPOS Part of a set
+  4.2.4 TPRO Produced notice
+  4.2.4 TPUB Publisher
+  4.2.1 TRCK Track number/Position in set
+  4.2.4 TRSN Internet radio station name
+  4.2.4 TRSO Internet radio station owner
+  4.2.5 TSOA Album sort order
+  4.2.5 TSOP Performer sort order
+  4.2.5 TSOT Title sort order
+  4.2.1 TSRC ISRC (international standard recording code)
+  4.2.5 TSSE Software/Hardware and settings used for encoding
+  4.2.1 TSST Set subtitle
+  4.2.2 TXXX User defined text information frame
+
+  4.1   UFID Unique file identifier
+  4.22  USER Terms of use
+  4.8   USLT Unsynchronised lyric/text transcription
+
+  4.3.1 WCOM Commercial information
+  4.3.1 WCOP Copyright/Legal information
+  4.3.1 WOAF Official audio file webpage
+  4.3.1 WOAR Official artist/performer webpage
+  4.3.1 WOAS Official audio source webpage
+  4.3.1 WORS Official Internet radio station homepage
+  4.3.1 WPAY Payment
+  4.3.1 WPUB Publishers official webpage
+  4.3.2 WXXX User defined URL link frame
+
+
+4.1.   Unique file identifier
+
+   This frame's purpose is to be able to identify the audio file in a
+   database, that may provide more information relevant to the content.
+   Since standardisation of such a database is beyond this document, all
+   UFID frames begin with an 'owner identifier' field. It is a null-
+   terminated string with a URL [URL] containing an email address, or a
+   link to a location where an email address can be found, that belongs
+   to the organisation responsible for this specific database
+   implementation. Questions regarding the database should be sent to
+   the indicated email address. The URL should not be used for the
+   actual database queries. The string
+   "http://www.id3.org/dummy/ufid.html" should be used for tests. The
+   'Owner identifier' must be non-empty (more than just a termination).
+   The 'Owner identifier' is then followed by the actual identifier,
+   which may be up to 64 bytes. There may be more than one "UFID" frame
+   in a tag, but only one with the same 'Owner identifier'.
+
+     <Header for 'Unique file identifier', ID: "UFID">
+     Owner identifier        <text string> $00
+     Identifier              <up to 64 bytes binary data>
+
+
+4.2.   Text information frames
+
+   The text information frames are often the most important frames,
+   containing information like artist, album and more. There may only be
+   one text information frame of its kind in an tag. All text
+   information frames supports multiple strings, stored as a null
+   separated list, where null is reperesented by the termination code
+   for the character encoding. All text frame identifiers begin with "T".
+   Only text frame identifiers begin with "T", with the exception of the
+   "TXXX" frame. All the text information frames have the following
+   format:
+
+     <Header for 'Text information frame', ID: "T000" - "TZZZ",
+     excluding "TXXX" described in 4.2.6.>
+     Text encoding                $xx
+     Information                  <text string(s) according to encoding>
+
+
+4.2.1.   Identification frames
+
+  TIT1
+   The 'Content group description' frame is used if the sound belongs to
+   a larger category of sounds/music. For example, classical music is
+   often sorted in different musical sections (e.g. "Piano Concerto",
+   "Weather - Hurricane").
+
+  TIT2
+   The 'Title/Songname/Content description' frame is the actual name of
+   the piece (e.g. "Adagio", "Hurricane Donna").
+
+  TIT3
+   The 'Subtitle/Description refinement' frame is used for information
+   directly related to the contents title (e.g. "Op. 16" or "Performed
+   live at Wembley").
+
+  TALB
+   The 'Album/Movie/Show title' frame is intended for the title of the
+   recording (or source of sound) from which the audio in the file is
+   taken.
+
+  TOAL
+   The 'Original album/movie/show title' frame is intended for the title
+   of the original recording (or source of sound), if for example the
+   music in the file should be a cover of a previously released song.
+
+  TRCK
+   The 'Track number/Position in set' frame is a numeric string
+   containing the order number of the audio-file on its original
+   recording. This MAY be extended with a "/" character and a numeric
+   string containing the total number of tracks/elements on the original
+   recording. E.g. "4/9".
+
+  TPOS
+   The 'Part of a set' frame is a numeric string that describes which
+   part of a set the audio came from. This frame is used if the source
+   described in the "TALB" frame is divided into several mediums, e.g. a
+   double CD. The value MAY be extended with a "/" character and a
+   numeric string containing the total number of parts in the set. E.g.
+   "1/2".
+
+  TSST
+   The 'Set subtitle' frame is intended for the subtitle of the part of
+   a set this track belongs to.
+
+  TSRC
+   The 'ISRC' frame should contain the International Standard Recording
+   Code [ISRC] (12 characters).
+
+
+4.2.2.   Involved persons frames
+
+  TPE1
+   The 'Lead artist/Lead performer/Soloist/Performing group' is
+   used for the main artist.
+
+  TPE2
+   The 'Band/Orchestra/Accompaniment' frame is used for additional
+   information about the performers in the recording.
+
+  TPE3
+   The 'Conductor' frame is used for the name of the conductor.
+
+  TPE4
+   The 'Interpreted, remixed, or otherwise modified by' frame contains
+   more information about the people behind a remix and similar
+   interpretations of another existing piece.
+
+  TOPE
+   The 'Original artist/performer' frame is intended for the performer
+   of the original recording, if for example the music in the file
+   should be a cover of a previously released song.
+
+  TEXT
+   The 'Lyricist/Text writer' frame is intended for the writer of the
+   text or lyrics in the recording.
+
+  TOLY
+   The 'Original lyricist/text writer' frame is intended for the
+   text writer of the original recording, if for example the music in
+   the file should be a cover of a previously released song.
+
+  TCOM
+   The 'Composer' frame is intended for the name of the composer.
+
+  TMCL
+   The 'Musician credits list' is intended as a mapping between
+   instruments and the musician that played it. Every odd field is an
+   instrument and every even is an artist or a comma delimited list of
+   artists.
+
+  TIPL
+   The 'Involved people list' is very similar to the musician credits
+   list, but maps between functions, like producer, and names.
+
+  TENC
+   The 'Encoded by' frame contains the name of the person or
+   organisation that encoded the audio file. This field may contain a
+   copyright message, if the audio file also is copyrighted by the
+   encoder.
+
+
+4.2.3.   Derived and subjective properties frames
+
+  TBPM
+   The 'BPM' frame contains the number of beats per minute in the
+   main part of the audio. The BPM is an integer and represented as a
+   numerical string.
+
+  TLEN
+   The 'Length' frame contains the length of the audio file in
+   milliseconds, represented as a numeric string.
+
+  TKEY
+   The 'Initial key' frame contains the musical key in which the sound
+   starts. It is represented as a string with a maximum length of three
+   characters. The ground keys are represented with "A","B","C","D","E",
+   "F" and "G" and halfkeys represented with "b" and "#". Minor is
+   represented as "m", e.g. "Dbm" $00. Off key is represented with an
+   "o" only.
+
+  TLAN
+   The 'Language' frame should contain the languages of the text or
+   lyrics spoken or sung in the audio. The language is represented with
+   three characters according to ISO-639-2 [ISO-639-2]. If more than one
+   language is used in the text their language codes should follow
+   according to the amount of their usage, e.g. "eng" $00 "sve" $00.
+
+  TCON
+   The 'Content type', which ID3v1 was stored as a one byte numeric
+   value only, is now a string. You may use one or several of the ID3v1
+   types as numerical strings, or, since the category list would be
+   impossible to maintain with accurate and up to date categories,
+   define your own. Example: "21" $00 "Eurodisco" $00
+
+   You may also use any of the following keywords:
+   
+     RX  Remix
+     CR  Cover
+
+  TFLT
+   The 'File type' frame indicates which type of audio this tag defines.
+   The following types and refinements are defined:
+
+     MIME   MIME type follows
+     MPG    MPEG Audio
+       /1     MPEG 1/2 layer I
+       /2     MPEG 1/2 layer II
+       /3     MPEG 1/2 layer III
+       /2.5   MPEG 2.5
+       /AAC   Advanced audio compression
+     VQF    Transform-domain Weighted Interleave Vector Quantisation
+     PCM    Pulse Code Modulated audio
+
+   but other types may be used, but not for these types though. This is
+   used in a similar way to the predefined types in the "TMED" frame,
+   but without parentheses. If this frame is not present audio type is
+   assumed to be "MPG".
+
+  TMED
+   The 'Media type' frame describes from which media the sound
+   originated. This may be a text string or a reference to the
+   predefined media types found in the list below. Example:
+   "VID/PAL/VHS" $00.
+
+    DIG    Other digital media
+      /A    Analogue transfer from media
+
+    ANA    Other analogue media
+      /WAC  Wax cylinder
+      /8CA  8-track tape cassette
+
+    CD     CD
+      /A    Analogue transfer from media
+      /DD   DDD
+      /AD   ADD
+      /AA   AAD
+
+    LD     Laserdisc
+
+    TT     Turntable records
+      /33    33.33 rpm
+      /45    45 rpm
+      /71    71.29 rpm
+      /76    76.59 rpm
+      /78    78.26 rpm
+      /80    80 rpm
+
+    MD     MiniDisc
+      /A    Analogue transfer from media
+
+    DAT    DAT
+      /A    Analogue transfer from media
+      /1    standard, 48 kHz/16 bits, linear
+      /2    mode 2, 32 kHz/16 bits, linear
+      /3    mode 3, 32 kHz/12 bits, non-linear, low speed
+      /4    mode 4, 32 kHz/12 bits, 4 channels
+      /5    mode 5, 44.1 kHz/16 bits, linear
+      /6    mode 6, 44.1 kHz/16 bits, 'wide track' play
+
+    DCC    DCC
+      /A    Analogue transfer from media
+
+    DVD    DVD
+      /A    Analogue transfer from media
+
+    TV     Television
+      /PAL    PAL
+      /NTSC   NTSC
+      /SECAM  SECAM
+
+    VID    Video
+      /PAL    PAL
+      /NTSC   NTSC
+      /SECAM  SECAM
+      /VHS    VHS
+      /SVHS   S-VHS
+      /BETA   BETAMAX
+
+    RAD    Radio
+      /FM   FM
+      /AM   AM
+      /LW   LW
+      /MW   MW
+
+    TEL    Telephone
+      /I    ISDN
+
+    MC     MC (normal cassette)
+      /4    4.75 cm/s (normal speed for a two sided cassette)
+      /9    9.5 cm/s
+      /I    Type I cassette (ferric/normal)
+      /II   Type II cassette (chrome)
+      /III  Type III cassette (ferric chrome)
+      /IV   Type IV cassette (metal)
+
+    REE    Reel
+      /9    9.5 cm/s
+      /19   19 cm/s
+      /38   38 cm/s
+      /76   76 cm/s
+      /I    Type I cassette (ferric/normal)
+      /II   Type II cassette (chrome)
+      /III  Type III cassette (ferric chrome)
+      /IV   Type IV cassette (metal)
+
+  TMOO
+   The 'Mood' frame is intended to reflect the mood of the audio with a
+   few keywords, e.g. "Romantic" or "Sad".
+
+
+4.2.4.   Rights and license frames
+
+  TCOP
+   The 'Copyright message' frame, in which the string must begin with a
+   year and a space character (making five characters), is intended for
+   the copyright holder of the original sound, not the audio file
+   itself. The absence of this frame means only that the copyright
+   information is unavailable or has been removed, and must not be
+   interpreted to mean that the audio is public domain. Every time this
+   field is displayed the field must be preceded with "Copyright " (C) "
+   ", where (C) is one character showing a C in a circle.
+
+  TPRO
+   The 'Produced notice' frame, in which the string must begin with a
+   year and a space character (making five characters), is intended for
+   the production copyright holder of the original sound, not the audio
+   file itself. The absence of this frame means only that the production
+   copyright information is unavailable or has been removed, and must
+   not be interpreted to mean that the audio is public domain. Every
+   time this field is displayed the field must be preceded with
+   "Produced " (P) " ", where (P) is one character showing a P in a
+   circle.
+
+  TPUB
+   The 'Publisher' frame simply contains the name of the label or
+   publisher.
+
+  TOWN
+   The 'File owner/licensee' frame contains the name of the owner or
+   licensee of the file and it's contents.
+
+  TRSN
+   The 'Internet radio station name' frame contains the name of the
+   internet radio station from which the audio is streamed.
+
+  TRSO
+   The 'Internet radio station owner' frame contains the name of the
+   owner of the internet radio station from which the audio is
+   streamed.
+
+4.2.5.   Other text frames
+
+  TOFN
+   The 'Original filename' frame contains the preferred filename for the
+   file, since some media doesn't allow the desired length of the
+   filename. The filename is case sensitive and includes its suffix.
+
+  TDLY
+   The 'Playlist delay' defines the numbers of milliseconds of silence
+   that should be inserted before this audio. The value zero indicates
+   that this is a part of a multifile audio track that should be played
+   continuously.
+
+  TDEN
+   The 'Encoding time' frame contains a timestamp describing when the
+   audio was encoded. Timestamp format is described in the ID3v2
+   structure document [ID3v2-strct].
+
+  TDOR
+   The 'Original release time' frame contains a timestamp describing
+   when the original recording of the audio was released. Timestamp
+   format is described in the ID3v2 structure document [ID3v2-strct].
+
+  TDRC
+   The 'Recording time' frame contains a timestamp describing when the
+   audio was recorded. Timestamp format is described in the ID3v2
+   structure document [ID3v2-strct].
+
+  TDRL
+   The 'Release time' frame contains a timestamp describing when the
+   audio was first released. Timestamp format is described in the ID3v2
+   structure document [ID3v2-strct].
+
+  TDTG
+   The 'Tagging time' frame contains a timestamp describing then the
+   audio was tagged. Timestamp format is described in the ID3v2
+   structure document [ID3v2-strct].
+
+  TSSE
+   The 'Software/Hardware and settings used for encoding' frame
+   includes the used audio encoder and its settings when the file was
+   encoded. Hardware refers to hardware encoders, not the computer on
+   which a program was run.
+
+  TSOA
+   The 'Album sort order' frame defines a string which should be used
+   instead of the album name (TALB) for sorting purposes. E.g. an album
+   named "A Soundtrack" might preferably be sorted as "Soundtrack".
+
+  TSOP
+   The 'Performer sort order' frame defines a string which should be
+   used instead of the performer (TPE2) for sorting purposes.
+
+  TSOT
+   The 'Title sort order' frame defines a string which should be used
+   instead of the title (TIT2) for sorting purposes.
+
+
+4.2.6.   User defined text information frame
+
+   This frame is intended for one-string text information concerning the
+   audio file in a similar way to the other "T"-frames. The frame body
+   consists of a description of the string, represented as a terminated
+   string, followed by the actual string. There may be more than one
+   "TXXX" frame in each tag, but only one with the same description.
+
+     <Header for 'User defined text information frame', ID: "TXXX">
+     Text encoding     $xx
+     Description       <text string according to encoding> $00 (00)
+     Value             <text string according to encoding>
+
+
+4.3.   URL link frames
+
+   With these frames dynamic data such as webpages with touring
+   information, price information or plain ordinary news can be added to
+   the tag. There may only be one URL [URL] link frame of its kind in an
+   tag, except when stated otherwise in the frame description. If the
+   text string is followed by a string termination, all the following
+   information should be ignored and not be displayed. All URL link
+   frame identifiers begins with "W". Only URL link frame identifiers
+   begins with "W", except for "WXXX". All URL link frames have the
+   following format:
+
+     <Header for 'URL link frame', ID: "W000" - "WZZZ", excluding "WXXX"
+     described in 4.3.2.>
+     URL              <text string>
+
+
+4.3.1.   URL link frames - details
+
+  WCOM
+   The 'Commercial information' frame is a URL pointing at a webpage
+   with information such as where the album can be bought. There may be
+   more than one "WCOM" frame in a tag, but not with the same content.
+
+  WCOP
+   The 'Copyright/Legal information' frame is a URL pointing at a
+   webpage where the terms of use and ownership of the file is
+   described.
+
+  WOAF
+   The 'Official audio file webpage' frame is a URL pointing at a file
+   specific webpage.
+
+  WOAR
+   The 'Official artist/performer webpage' frame is a URL pointing at
+   the artists official webpage. There may be more than one "WOAR" frame
+   in a tag if the audio contains more than one performer, but not with
+   the same content.
+
+  WOAS
+   The 'Official audio source webpage' frame is a URL pointing at the
+   official webpage for the source of the audio file, e.g. a movie.
+
+  WORS
+   The 'Official Internet radio station homepage' contains a URL
+   pointing at the homepage of the internet radio station.
+
+  WPAY
+   The 'Payment' frame is a URL pointing at a webpage that will handle
+   the process of paying for this file.
+
+  WPUB
+   The 'Publishers official webpage' frame is a URL pointing at the
+   official webpage for the publisher.
+
+
+4.3.2.   User defined URL link frame
+
+   This frame is intended for URL [URL] links concerning the audio file
+   in a similar way to the other "W"-frames. The frame body consists
+   of a description of the string, represented as a terminated string,
+   followed by the actual URL. The URL is always encoded with ISO-8859-1
+   [ISO-8859-1]. There may be more than one "WXXX" frame in each tag,
+   but only one with the same description.
+
+     <Header for 'User defined URL link frame', ID: "WXXX">
+     Text encoding     $xx
+     Description       <text string according to encoding> $00 (00)
+     URL               <text string>
+
+
+4.4.   Music CD identifier
+
+   This frame is intended for music that comes from a CD, so that the CD
+   can be identified in databases such as the CDDB [CDDB]. The frame
+   consists of a binary dump of the Table Of Contents, TOC, from the CD,
+   which is a header of 4 bytes and then 8 bytes/track on the CD plus 8
+   bytes for the 'lead out', making a maximum of 804 bytes. The offset
+   to the beginning of every track on the CD should be described with a
+   four bytes absolute CD-frame address per track, and not with absolute
+   time. When this frame is used the presence of a valid "TRCK" frame is
+   REQUIRED, even if the CD's only got one track. It is recommended that
+   this frame is always added to tags originating from CDs. There may
+   only be one "MCDI" frame in each tag.
+
+     <Header for 'Music CD identifier', ID: "MCDI">
+     CD TOC                <binary data>
+
+
+4.5.   Event timing codes
+
+   This frame allows synchronisation with key events in the audio. The
+   header is:
+
+     <Header for 'Event timing codes', ID: "ETCO">
+     Time stamp format    $xx
+
+   Where time stamp format is:
+
+     $01  Absolute time, 32 bit sized, using MPEG [MPEG] frames as unit
+     $02  Absolute time, 32 bit sized, using milliseconds as unit
+
+   Absolute time means that every stamp contains the time from the
+   beginning of the file.
+
+   Followed by a list of key events in the following format:
+
+     Type of event   $xx
+     Time stamp      $xx (xx ...)
+
+   The 'Time stamp' is set to zero if directly at the beginning of the
+   sound or after the previous event. All events MUST be sorted in
+   chronological order. The type of event is as follows:
+
+     $00  padding (has no meaning)
+     $01  end of initial silence
+     $02  intro start
+     $03  main part start
+     $04  outro start
+     $05  outro end
+     $06  verse start
+     $07  refrain start
+     $08  interlude start
+     $09  theme start
+     $0A  variation start
+     $0B  key change
+     $0C  time change
+     $0D  momentary unwanted noise (Snap, Crackle & Pop)
+     $0E  sustained noise
+     $0F  sustained noise end
+     $10  intro end
+     $11  main part end
+     $12  verse end
+     $13  refrain end
+     $14  theme end
+     $15  profanity
+     $16  profanity end
+
+     $17-$DF  reserved for future use
+
+     $E0-$EF  not predefined synch 0-F
+
+     $F0-$FC  reserved for future use
+
+     $FD  audio end (start of silence)
+     $FE  audio file ends
+     $FF  one more byte of events follows (all the following bytes with
+          the value $FF have the same function)
+
+   Terminating the start events such as "intro start" is OPTIONAL. The
+   'Not predefined synch's ($E0-EF) are for user events. You might want
+   to synchronise your music to something, like setting off an explosion
+   on-stage, activating a screensaver etc.
+
+   There may only be one "ETCO" frame in each tag.
+
+
+4.6.   MPEG location lookup table
+
+   To increase performance and accuracy of jumps within a MPEG [MPEG]
+   audio file, frames with time codes in different locations in the file
+   might be useful. This ID3v2 frame includes references that the
+   software can use to calculate positions in the file. After the frame
+   header follows a descriptor of how much the 'frame counter' should be
+   increased for every reference. If this value is two then the first
+   reference points out the second frame, the 2nd reference the 4th
+   frame, the 3rd reference the 6th frame etc. In a similar way the
+   'bytes between reference' and 'milliseconds between reference' points
+   out bytes and milliseconds respectively.
+
+   Each reference consists of two parts; a certain number of bits, as
+   defined in 'bits for bytes deviation', that describes the difference
+   between what is said in 'bytes between reference' and the reality and
+   a certain number of bits, as defined in 'bits for milliseconds
+   deviation', that describes the difference between what is said in
+   'milliseconds between reference' and the reality. The number of bits
+   in every reference, i.e. 'bits for bytes deviation'+'bits for
+   milliseconds deviation', must be a multiple of four. There may only
+   be one "MLLT" frame in each tag.
+
+     <Header for 'Location lookup table', ID: "MLLT">
+     MPEG frames between reference  $xx xx
+     Bytes between reference        $xx xx xx
+     Milliseconds between reference $xx xx xx
+     Bits for bytes deviation       $xx
+     Bits for milliseconds dev.     $xx
+
+   Then for every reference the following data is included;
+
+     Deviation in bytes         %xxx....
+     Deviation in milliseconds  %xxx....
+
+
+4.7.   Synchronised tempo codes
+
+   For a more accurate description of the tempo of a musical piece, this
+   frame might be used. After the header follows one byte describing
+   which time stamp format should be used. Then follows one or more
+   tempo codes. Each tempo code consists of one tempo part and one time
+   part. The tempo is in BPM described with one or two bytes. If the
+   first byte has the value $FF, one more byte follows, which is added
+   to the first giving a range from 2 - 510 BPM, since $00 and $01 is
+   reserved. $00 is used to describe a beat-free time period, which is
+   not the same as a music-free time period. $01 is used to indicate one
+   single beat-stroke followed by a beat-free period.
+
+   The tempo descriptor is followed by a time stamp. Every time the
+   tempo in the music changes, a tempo descriptor may indicate this for
+   the player. All tempo descriptors MUST be sorted in chronological
+   order. The first beat-stroke in a time-period is at the same time as
+   the beat description occurs. There may only be one "SYTC" frame in
+   each tag.
+
+     <Header for 'Synchronised tempo codes', ID: "SYTC">
+     Time stamp format   $xx
+     Tempo data          <binary data>
+
+   Where time stamp format is:
+
+     $01  Absolute time, 32 bit sized, using MPEG [MPEG] frames as unit
+     $02  Absolute time, 32 bit sized, using milliseconds as unit
+
+   Absolute time means that every stamp contains the time from the
+   beginning of the file.
+
+
+4.8.   Unsynchronised lyrics/text transcription
+
+   This frame contains the lyrics of the song or a text transcription of
+   other vocal activities. The head includes an encoding descriptor and
+   a content descriptor. The body consists of the actual text. The
+   'Content descriptor' is a terminated string. If no descriptor is
+   entered, 'Content descriptor' is $00 (00) only. Newline characters
+   are allowed in the text. There may be more than one 'Unsynchronised
+   lyrics/text transcription' frame in each tag, but only one with the
+   same language and content descriptor.
+
+     <Header for 'Unsynchronised lyrics/text transcription', ID: "USLT">
+     Text encoding        $xx
+     Language             $xx xx xx
+     Content descriptor   <text string according to encoding> $00 (00)
+     Lyrics/text          <full text string according to encoding>
+
+
+4.9.   Synchronised lyrics/text
+
+   This is another way of incorporating the words, said or sung lyrics,
+   in the audio file as text, this time, however, in sync with the
+   audio. It might also be used to describing events e.g. occurring on a
+   stage or on the screen in sync with the audio. The header includes a
+   content descriptor, represented with as terminated text string. If no
+   descriptor is entered, 'Content descriptor' is $00 (00) only.
+
+     <Header for 'Synchronised lyrics/text', ID: "SYLT">
+     Text encoding        $xx
+     Language             $xx xx xx
+     Time stamp format    $xx
+     Content type         $xx
+     Content descriptor   <text string according to encoding> $00 (00)
+
+   Content type:   $00 is other
+                   $01 is lyrics
+                   $02 is text transcription
+                   $03 is movement/part name (e.g. "Adagio")
+                   $04 is events (e.g. "Don Quijote enters the stage")
+                   $05 is chord (e.g. "Bb F Fsus")
+                   $06 is trivia/'pop up' information
+                   $07 is URLs to webpages
+                   $08 is URLs to images
+
+   Time stamp format:
+
+     $01  Absolute time, 32 bit sized, using MPEG [MPEG] frames as unit
+     $02  Absolute time, 32 bit sized, using milliseconds as unit
+
+   Absolute time means that every stamp contains the time from the
+   beginning of the file.
+
+   The text that follows the frame header differs from that of the
+   unsynchronised lyrics/text transcription in one major way. Each
+   syllable (or whatever size of text is considered to be convenient by
+   the encoder) is a null terminated string followed by a time stamp
+   denoting where in the sound file it belongs. Each sync thus has the
+   following structure:
+
+     Terminated text to be synced (typically a syllable)
+     Sync identifier (terminator to above string)   $00 (00)
+     Time stamp                                     $xx (xx ...)
+
+   The 'time stamp' is set to zero or the whole sync is omitted if
+   located directly at the beginning of the sound. All time stamps
+   should be sorted in chronological order. The sync can be considered
+   as a validator of the subsequent string.
+
+   Newline characters are allowed in all "SYLT" frames and MUST be used
+   after every entry (name, event etc.) in a frame with the content type
+   $03 - $04.
+
+   A few considerations regarding whitespace characters: Whitespace
+   separating words should mark the beginning of a new word, thus
+   occurring in front of the first syllable of a new word. This is also
+   valid for new line characters. A syllable followed by a comma should
+   not be broken apart with a sync (both the syllable and the comma
+   should be before the sync).
+
+   An example: The "USLT" passage
+
+     "Strangers in the night" $0A "Exchanging glances"
+
+   would be "SYLT" encoded as:
+
+     "Strang" $00 xx xx "ers" $00 xx xx " in" $00 xx xx " the" $00 xx xx
+     " night" $00 xx xx 0A "Ex" $00 xx xx "chang" $00 xx xx "ing" $00 xx
+     xx "glan" $00 xx xx "ces" $00 xx xx
+
+   There may be more than one "SYLT" frame in each tag, but only one
+   with the same language and content descriptor.
+
+
+4.10.   Comments
+
+   This frame is intended for any kind of full text information that
+   does not fit in any other frame. It consists of a frame header
+   followed by encoding, language and content descriptors and is ended
+   with the actual comment as a text string. Newline characters are
+   allowed in the comment text string. There may be more than one
+   comment frame in each tag, but only one with the same language and
+   content descriptor.
+
+     <Header for 'Comment', ID: "COMM">
+     Text encoding          $xx
+     Language               $xx xx xx
+     Short content descrip. <text string according to encoding> $00 (00)
+     The actual text        <full text string according to encoding>
+
+
+4.11.   Relative volume adjustment (2)
+
+   This is a more subjective frame than the previous ones. It allows the
+   user to say how much he wants to increase/decrease the volume on each
+   channel when the file is played. The purpose is to be able to align
+   all files to a reference volume, so that you don't have to change the
+   volume constantly. This frame may also be used to balance adjust the
+   audio. The volume adjustment is encoded as a fixed point decibel
+   value, 16 bit signed integer representing (adjustment*512), giving
+   +/- 64 dB with a precision of 0.001953125 dB. E.g. +2 dB is stored as
+   $04 00 and -2 dB is $FC 00. There may be more than one "RVA2" frame
+   in each tag, but only one with the same identification string.
+
+     <Header for 'Relative volume adjustment (2)', ID: "RVA2">
+     Identification          <text string> $00
+
+   The 'identification' string is used to identify the situation and/or
+   device where this adjustment should apply. The following is then
+   repeated for every channel
+
+     Type of channel         $xx
+     Volume adjustment       $xx xx
+     Bits representing peak  $xx
+     Peak volume             $xx (xx ...)
+
+
+   Type of channel:  $00  Other
+                     $01  Master volume
+                     $02  Front right
+                     $03  Front left
+                     $04  Back right
+                     $05  Back left
+                     $06  Front centre
+                     $07  Back centre
+                     $08  Subwoofer
+
+   Bits representing peak can be any number between 0 and 255. 0 means
+   that there is no peak volume field. The peak volume field is always
+   padded to whole bytes, setting the most significant bits to zero.
+
+
+4.12.   Equalisation (2)
+
+   This is another subjective, alignment frame. It allows the user to
+   predefine an equalisation curve within the audio file. There may be
+   more than one "EQU2" frame in each tag, but only one with the same
+   identification string.
+
+     <Header of 'Equalisation (2)', ID: "EQU2">
+     Interpolation method  $xx
+     Identification        <text string> $00
+
+   The 'interpolation method' describes which method is preferred when
+   an interpolation between the adjustment point that follows. The
+   following methods are currently defined:
+
+     $00  Band
+          No interpolation is made. A jump from one adjustment level to
+          another occurs in the middle between two adjustment points.
+     $01  Linear
+          Interpolation between adjustment points is linear.
+
+   The 'identification' string is used to identify the situation and/or
+   device where this adjustment should apply. The following is then
+   repeated for every adjustment point
+
+     Frequency          $xx xx
+     Volume adjustment  $xx xx
+
+   The frequency is stored in units of 1/2 Hz, giving it a range from 0
+   to 32767 Hz.
+
+   The volume adjustment is encoded as a fixed point decibel value, 16
+   bit signed integer representing (adjustment*512), giving +/- 64 dB
+   with a precision of 0.001953125 dB. E.g. +2 dB is stored as $04 00
+   and -2 dB is $FC 00.
+
+   Adjustment points should be ordered by frequency and one frequency
+   should only be described once in the frame.
+
+
+4.13.   Reverb
+
+   Yet another subjective frame, with which you can adjust echoes of
+   different kinds. Reverb left/right is the delay between every bounce
+   in ms. Reverb bounces left/right is the number of bounces that should
+   be made. $FF equals an infinite number of bounces. Feedback is the
+   amount of volume that should be returned to the next echo bounce. $00
+   is 0%, $FF is 100%. If this value were $7F, there would be 50% volume
+   reduction on the first bounce, 50% of that on the second and so on.
+   Left to left means the sound from the left bounce to be played in the
+   left speaker, while left to right means sound from the left bounce to
+   be played in the right speaker.
+
+   'Premix left to right' is the amount of left sound to be mixed in the
+   right before any reverb is applied, where $00 id 0% and $FF is 100%.
+   'Premix right to left' does the same thing, but right to left.
+   Setting both premix to $FF would result in a mono output (if the
+   reverb is applied symmetric). There may only be one "RVRB" frame in
+   each tag.
+
+     <Header for 'Reverb', ID: "RVRB">
+     Reverb left (ms)                 $xx xx
+     Reverb right (ms)                $xx xx
+     Reverb bounces, left             $xx
+     Reverb bounces, right            $xx
+     Reverb feedback, left to left    $xx
+     Reverb feedback, left to right   $xx
+     Reverb feedback, right to right  $xx
+     Reverb feedback, right to left   $xx
+     Premix left to right             $xx
+     Premix right to left             $xx
+
+
+4.14.   Attached picture
+
+   This frame contains a picture directly related to the audio file.
+   Image format is the MIME type and subtype [MIME] for the image. In
+   the event that the MIME media type name is omitted, "image/" will be
+   implied. The "image/png" [PNG] or "image/jpeg" [JFIF] picture format
+   should be used when interoperability is wanted. Description is a
+   short description of the picture, represented as a terminated
+   text string. There may be several pictures attached to one file, each
+   in their individual "APIC" frame, but only one with the same content
+   descriptor. There may only be one picture with the picture type
+   declared as picture type $01 and $02 respectively. There is the
+   possibility to put only a link to the image file by using the 'MIME
+   type' "-->" and having a complete URL [URL] instead of picture data.
+   The use of linked files should however be used sparingly since there
+   is the risk of separation of files.
+
+     <Header for 'Attached picture', ID: "APIC">
+     Text encoding      $xx
+     MIME type          <text string> $00
+     Picture type       $xx
+     Description        <text string according to encoding> $00 (00)
+     Picture data       <binary data>
+
+
+   Picture type:  $00  Other
+                  $01  32x32 pixels 'file icon' (PNG only)
+                  $02  Other file icon
+                  $03  Cover (front)
+                  $04  Cover (back)
+                  $05  Leaflet page
+                  $06  Media (e.g. label side of CD)
+                  $07  Lead artist/lead performer/soloist
+                  $08  Artist/performer
+                  $09  Conductor
+                  $0A  Band/Orchestra
+                  $0B  Composer
+                  $0C  Lyricist/text writer
+                  $0D  Recording Location
+                  $0E  During recording
+                  $0F  During performance
+                  $10  Movie/video screen capture
+                  $11  A bright coloured fish
+                  $12  Illustration
+                  $13  Band/artist logotype
+                  $14  Publisher/Studio logotype
+
+
+4.15.   General encapsulated object
+
+   In this frame any type of file can be encapsulated. After the header,
+   'Frame size' and 'Encoding' follows 'MIME type' [MIME] represented as
+   as a terminated string encoded with ISO 8859-1 [ISO-8859-1]. The
+   filename is case sensitive and is encoded as 'Encoding'. Then follows
+   a content description as terminated string, encoded as 'Encoding'.
+   The last thing in the frame is the actual object. The first two
+   strings may be omitted, leaving only their terminations. MIME type is
+   always an ISO-8859-1 text string. There may be more than one "GEOB"
+   frame in each tag, but only one with the same content descriptor.
+
+     <Header for 'General encapsulated object', ID: "GEOB">
+     Text encoding          $xx
+     MIME type              <text string> $00
+     Filename               <text string according to encoding> $00 (00)
+     Content description    <text string according to encoding> $00 (00)
+     Encapsulated object    <binary data>
+
+
+4.16.   Play counter
+
+   This is simply a counter of the number of times a file has been
+   played. The value is increased by one every time the file begins to
+   play. There may only be one "PCNT" frame in each tag. When the
+   counter reaches all one's, one byte is inserted in front of the
+   counter thus making the counter eight bits bigger.  The counter must
+   be at least 32-bits long to begin with.
+
+     <Header for 'Play counter', ID: "PCNT">
+     Counter        $xx xx xx xx (xx ...)
+
+
+4.17.   Popularimeter
+
+   The purpose of this frame is to specify how good an audio file is.
+   Many interesting applications could be found to this frame such as a
+   playlist that features better audio files more often than others or
+   it could be used to profile a person's taste and find other 'good'
+   files by comparing people's profiles. The frame contains the email
+   address to the user, one rating byte and a four byte play counter,
+   intended to be increased with one for every time the file is played.
+   The email is a terminated string. The rating is 1-255 where 1 is
+   worst and 255 is best. 0 is unknown. If no personal counter is wanted
+   it may be omitted. When the counter reaches all one's, one byte is
+   inserted in front of the counter thus making the counter eight bits
+   bigger in the same away as the play counter ("PCNT"). There may be
+   more than one "POPM" frame in each tag, but only one with the same
+   email address.
+
+     <Header for 'Popularimeter', ID: "POPM">
+     Email to user   <text string> $00
+     Rating          $xx
+     Counter         $xx xx xx xx (xx ...)
+
+
+4.18.   Recommended buffer size
+
+   Sometimes the server from which an audio file is streamed is aware of
+   transmission or coding problems resulting in interruptions in the
+   audio stream. In these cases, the size of the buffer can be
+   recommended by the server using this frame. If the 'embedded info
+   flag' is true (1) then this indicates that an ID3 tag with the
+   maximum size described in 'Buffer size' may occur in the audio
+   stream. In such case the tag should reside between two MPEG [MPEG]
+   frames, if the audio is MPEG encoded. If the position of the next tag
+   is known, 'offset to next tag' may be used. The offset is calculated
+   from the end of tag in which this frame resides to the first byte of
+   the header in the next. This field may be omitted. Embedded tags are
+   generally not recommended since this could render unpredictable
+   behaviour from present software/hardware.
+
+   For applications like streaming audio it might be an idea to embed
+   tags into the audio stream though. If the clients connects to
+   individual connections like HTTP and there is a possibility to begin
+   every transmission with a tag, then this tag should include a
+   'recommended buffer size' frame. If the client is connected to a
+   arbitrary point in the stream, such as radio or multicast, then the
+   'recommended buffer size' frame SHOULD be included in every tag.
+
+   The 'Buffer size' should be kept to a minimum. There may only be one
+   "RBUF" frame in each tag.
+
+     <Header for 'Recommended buffer size', ID: "RBUF">
+     Buffer size               $xx xx xx
+     Embedded info flag        %0000000x
+     Offset to next tag        $xx xx xx xx
+
+
+4.19.   Audio encryption
+
+   This frame indicates if the actual audio stream is encrypted, and by
+   whom. Since standardisation of such encryption scheme is beyond this
+   document, all "AENC" frames begin with a terminated string with a
+   URL containing an email address, or a link to a location where an
+   email address can be found, that belongs to the organisation
+   responsible for this specific encrypted audio file. Questions
+   regarding the encrypted audio should be sent to the email address
+   specified. If a $00 is found directly after the 'Frame size' and the
+   audio file indeed is encrypted, the whole file may be considered
+   useless.
+
+   After the 'Owner identifier', a pointer to an unencrypted part of the
+   audio can be specified. The 'Preview start' and 'Preview length' is
+   described in frames. If no part is unencrypted, these fields should
+   be left zeroed. After the 'preview length' field follows optionally a
+   data block required for decryption of the audio. There may be more
+   than one "AENC" frames in a tag, but only one with the same 'Owner
+   identifier'.
+
+     <Header for 'Audio encryption', ID: "AENC">
+     Owner identifier   <text string> $00
+     Preview start      $xx xx
+     Preview length     $xx xx
+     Encryption info    <binary data>
+
+
+4.20.   Linked information
+
+   To keep information duplication as low as possible this frame may be
+   used to link information from another ID3v2 tag that might reside in
+   another audio file or alone in a binary file. It is RECOMMENDED that
+   this method is only used when the files are stored on a CD-ROM or
+   other circumstances when the risk of file separation is low. The
+   frame contains a frame identifier, which is the frame that should be
+   linked into this tag, a URL [URL] field, where a reference to the
+   file where the frame is given, and additional ID data, if needed.
+   Data should be retrieved from the first tag found in the file to
+   which this link points. There may be more than one "LINK" frame in a
+   tag, but only one with the same contents. A linked frame is to be
+   considered as part of the tag and has the same restrictions as if it
+   was a physical part of the tag (i.e. only one "RVRB" frame allowed,
+   whether it's linked or not).
+
+     <Header for 'Linked information', ID: "LINK">
+     Frame identifier        $xx xx xx xx
+     URL                     <text string> $00
+     ID and additional data  <text string(s)>
+
+   Frames that may be linked and need no additional data are "ASPI",
+   "ETCO", "EQU2", "MCID", "MLLT", "OWNE", "RVA2", "RVRB", "SYTC", the
+   text information frames and the URL link frames.
+
+   The "AENC", "APIC", "GEOB" and "TXXX" frames may be linked with
+   the content descriptor as additional ID data.
+
+   The "USER" frame may be linked with the language field as additional
+   ID data.
+   
+   The "PRIV" frame may be linked with the owner identifier as
+   additional ID data.
+
+   The "COMM", "SYLT" and "USLT" frames may be linked with three bytes
+   of language descriptor directly followed by a content descriptor as
+   additional ID data.
+
+
+4.21.   Position synchronisation frame
+
+   This frame delivers information to the listener of how far into the
+   audio stream he picked up; in effect, it states the time offset from
+   the first frame in the stream. The frame layout is:
+
+     <Head for 'Position synchronisation', ID: "POSS">
+     Time stamp format         $xx
+     Position                  $xx (xx ...)
+
+   Where time stamp format is:
+
+     $01  Absolute time, 32 bit sized, using MPEG frames as unit
+     $02  Absolute time, 32 bit sized, using milliseconds as unit
+
+   and position is where in the audio the listener starts to receive,
+   i.e. the beginning of the next frame. If this frame is used in the
+   beginning of a file the value is always 0. There may only be one
+   "POSS" frame in each tag.
+
+
+4.22.   Terms of use frame
+
+   This frame contains a brief description of the terms of use and
+   ownership of the file. More detailed information concerning the legal
+   terms might be available through the "WCOP" frame. Newlines are
+   allowed in the text. There may be more than one 'Terms of use' frame
+   in a tag, but only one with the same 'Language'.
+
+     <Header for 'Terms of use frame', ID: "USER">
+     Text encoding        $xx
+     Language             $xx xx xx
+     The actual text      <text string according to encoding>
+
+
+4.23.   Ownership frame
+
+   The ownership frame might be used as a reminder of a made transaction
+   or, if signed, as proof. Note that the "USER" and "TOWN" frames are
+   good to use in conjunction with this one. The frame begins, after the
+   frame ID, size and encoding fields, with a 'price paid' field. The
+   first three characters of this field contains the currency used for
+   the transaction, encoded according to ISO 4217 [ISO-4217] alphabetic
+   currency code. Concatenated to this is the actual price paid, as a
+   numerical string using "." as the decimal separator. Next is an 8
+   character date string (YYYYMMDD) followed by a string with the name
+   of the seller as the last field in the frame. There may only be one
+   "OWNE" frame in a tag.
+
+     <Header for 'Ownership frame', ID: "OWNE">
+     Text encoding     $xx
+     Price paid        <text string> $00
+     Date of purch.    <text string>
+     Seller            <text string according to encoding>
+
+
+4.24.   Commercial frame
+
+   This frame enables several competing offers in the same tag by
+   bundling all needed information. That makes this frame rather complex
+   but it's an easier solution than if one tries to achieve the same
+   result with several frames. The frame begins, after the frame ID,
+   size and encoding fields, with a price string field. A price is
+   constructed by one three character currency code, encoded according
+   to ISO 4217 [ISO-4217] alphabetic currency code, followed by a
+   numerical value where "." is used as decimal separator. In the price
+   string several prices may be concatenated, separated by a "/"
+   character, but there may only be one currency of each type.
+
+   The price string is followed by an 8 character date string in the
+   format YYYYMMDD, describing for how long the price is valid. After
+   that is a contact URL, with which the user can contact the seller,
+   followed by a one byte 'received as' field. It describes how the
+   audio is delivered when bought according to the following list:
+
+        $00  Other
+        $01  Standard CD album with other songs
+        $02  Compressed audio on CD
+        $03  File over the Internet
+        $04  Stream over the Internet
+        $05  As note sheets
+        $06  As note sheets in a book with other sheets
+        $07  Music on other media
+        $08  Non-musical merchandise
+
+   Next follows a terminated string with the name of the seller followed
+   by a terminated string with a short description of the product. The
+   last thing is the ability to include a company logotype. The first of
+   them is the 'Picture MIME type' field containing information about
+   which picture format is used. In the event that the MIME media type
+   name is omitted, "image/" will be implied. Currently only "image/png"
+   and "image/jpeg" are allowed. This format string is followed by the
+   binary picture data. This two last fields may be omitted if no
+   picture is attached. There may be more than one 'commercial frame' in
+   a tag, but no two may be identical.
+
+     <Header for 'Commercial frame', ID: "COMR">
+     Text encoding      $xx
+     Price string       <text string> $00
+     Valid until        <text string>
+     Contact URL        <text string> $00
+     Received as        $xx
+     Name of seller     <text string according to encoding> $00 (00)
+     Description        <text string according to encoding> $00 (00)
+     Picture MIME type  <string> $00
+     Seller logo        <binary data>
+
+
+4.25.   Encryption method registration
+
+   To identify with which method a frame has been encrypted the
+   encryption method must be registered in the tag with this frame. The
+   'Owner identifier' is a null-terminated string with a URL [URL]
+   containing an email address, or a link to a location where an email
+   address can be found, that belongs to the organisation responsible
+   for this specific encryption method. Questions regarding the
+   encryption method should be sent to the indicated email address. The
+   'Method symbol' contains a value that is associated with this method
+   throughout the whole tag, in the range $80-F0. All other values are
+   reserved. The 'Method symbol' may optionally be followed by
+   encryption specific data. There may be several "ENCR" frames in a tag
+   but only one containing the same symbol and only one containing the
+   same owner identifier. The method must be used somewhere in the tag.
+   See the description of the frame encryption flag in the ID3v2
+   structure document [ID3v2-strct] for more information.
+
+     <Header for 'Encryption method registration', ID: "ENCR">
+     Owner identifier    <text string> $00
+     Method symbol       $xx
+     Encryption data     <binary data>
+
+
+4.26.   Group identification registration
+
+   This frame enables grouping of otherwise unrelated frames. This can
+   be used when some frames are to be signed. To identify which frames
+   belongs to a set of frames a group identifier must be registered in
+   the tag with this frame. The 'Owner identifier' is a null-terminated
+   string with a URL [URL] containing an email address, or a link to a
+   location where an email address can be found, that belongs to the
+   organisation responsible for this grouping. Questions regarding the
+   grouping should be sent to the indicated email address. The 'Group
+   symbol' contains a value that associates the frame with this group
+   throughout the whole tag, in the range $80-F0. All other values are
+   reserved. The 'Group symbol' may optionally be followed by some group
+   specific data, e.g. a digital signature. There may be several "GRID"
+   frames in a tag but only one containing the same symbol and only one
+   containing the same owner identifier. The group symbol must be used
+   somewhere in the tag. See the description of the frame grouping flag
+   in the ID3v2 structure document [ID3v2-strct] for more information.
+
+     <Header for 'Group ID registration', ID: "GRID">
+     Owner identifier      <text string> $00
+     Group symbol          $xx
+     Group dependent data  <binary data>
+
+
+4.27.   Private frame
+
+   This frame is used to contain information from a software producer
+   that its program uses and does not fit into the other frames. The
+   frame consists of an 'Owner identifier' string and the binary data.
+   The 'Owner identifier' is a null-terminated string with a URL [URL]
+   containing an email address, or a link to a location where an email
+   address can be found, that belongs to the organisation responsible
+   for the frame. Questions regarding the frame should be sent to the
+   indicated email address. The tag may contain more than one "PRIV"
+   frame but only with different contents.
+
+     <Header for 'Private frame', ID: "PRIV">
+     Owner identifier      <text string> $00
+     The private data      <binary data>
+
+
+4.28.   Signature frame
+
+   This frame enables a group of frames, grouped with the 'Group
+   identification registration', to be signed. Although signatures can
+   reside inside the registration frame, it might be desired to store
+   the signature elsewhere, e.g. in watermarks. There may be more than
+   one 'signature frame' in a tag, but no two may be identical.
+
+     <Header for 'Signature frame', ID: "SIGN">
+     Group symbol      $xx
+     Signature         <binary data>
+
+
+4.29.   Seek frame
+
+   This frame indicates where other tags in a file/stream can be found.
+   The 'minimum offset to next tag' is calculated from the end of this
+   tag to the beginning of the next. There may only be one 'seek frame'
+   in a tag.
+
+   <Header for 'Seek frame', ID: "SEEK">
+   Minimum offset to next tag       $xx xx xx xx
+
+
+4.30.   Audio seek point index
+
+   Audio files with variable bit rates are intrinsically difficult to
+   deal with in the case of seeking within the file. The ASPI frame
+   makes seeking easier by providing a list a seek points within the
+   audio file. The seek points are a fractional offset within the audio
+   data, providing a starting point from which to find an appropriate
+   point to start decoding. The presence of an ASPI frame requires the
+   existence of a TLEN frame, indicating the duration of the file in
+   milliseconds. There may only be one 'audio seek point index' frame in
+   a tag.
+
+     <Header for 'Seek Point Index', ID: "ASPI">
+     Indexed data start (S)         $xx xx xx xx
+     Indexed data length (L)        $xx xx xx xx
+     Number of index points (N)     $xx xx
+     Bits per index point (b)       $xx
+
+   Then for every index point the following data is included;
+
+     Fraction at index (Fi)          $xx (xx)
+
+   'Indexed data start' is a byte offset from the beginning of the file.
+   'Indexed data length' is the byte length of the audio data being
+   indexed. 'Number of index points' is the number of index points, as
+   the name implies. The recommended number is 100. 'Bits per index
+   point' is 8 or 16, depending on the chosen precision. 8 bits works
+   well for short files (less than 5 minutes of audio), while 16 bits is
+   advantageous for long files. 'Fraction at index' is the numerator of
+   the fraction representing a relative position in the data. The
+   denominator is 2 to the power of b.
+
+   Here are the algorithms to be used in the calculation. The known data
+   must be the offset of the start of the indexed data (S), the offset
+   of the end of the indexed data (E), the number of index points (N),
+   the offset at index i (Oi). We calculate the fraction at index i
+   (Fi).
+
+   Oi is the offset of the frame whose start is soonest after the point
+   for which the time offset is (i/N * duration).
+
+   The frame data should be calculated as follows:
+
+     Fi = Oi/L * 2^b    (rounded down to the nearest integer)
+
+   Offset calculation should be calculated as follows from data in the
+   frame:
+
+     Oi = (Fi/2^b)*L    (rounded up to the nearest integer)
+
+
+5.  Copyright
+
+   Copyright (C) Martin Nilsson 2000. All Rights Reserved.
+
+   This document and translations of it may be copied and furnished to
+   others, and derivative works that comment on or otherwise explain it
+   or assist in its implementation may be prepared, copied, published
+   and distributed, in whole or in part, without restriction of any
+   kind, provided that a reference to this document is included on all
+   such copies and derivative works. However, this document itself may
+   not be modified in any way and reissued as the original document.
+
+   The limited permissions granted above are perpetual and will not be
+   revoked.
+
+   This document and the information contained herein is provided on an
+   "AS IS" basis and THE AUTHORS DISCLAIMS ALL WARRANTIES, EXPRESS OR
+   IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
+   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
+   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.
+
+
+6.   References
+
+   [CDDB] Compact Disc Data Base
+
+      <url:http://www.cddb.com>
+
+   [ID3v2.3.0] Martin Nilsson, "ID3v2 informal standard".
+
+      <url:http://www.id3.org/id3v2.3.0.txt>
+
+   [ID3v2-strct] Martin Nilsson,
+   "ID3 tag version 2.4.0 - Main Structure"
+   
+      <url:http//www.id3.org/id3v2.4.0-structure.txt>
+
+   [ISO-639-2] ISO/FDIS 639-2.
+   Codes for the representation of names of languages, Part 2: Alpha-3
+   code. Technical committee / subcommittee: TC 37 / SC 2
+
+   [ISO-4217] ISO 4217:1995.
+   Codes for the representation of currencies and funds.
+   Technical committee / subcommittee: TC 68
+
+   [ISO-8859-1] ISO/IEC DIS 8859-1.
+   8-bit single-byte coded graphic character sets, Part 1: Latin
+   alphabet No. 1. Technical committee / subcommittee: JTC 1 / SC 2
+
+   [ISRC] ISO 3901:1986
+   International Standard Recording Code (ISRC).
+   Technical committee / subcommittee: TC 46 / SC 9
+
+   [JFIF] JPEG File Interchange Format, version 1.02
+
+      <url:http://www.w3.org/Graphics/JPEG/jfif.txt>
+
+   [KEYWORDS] S. Bradner, 'Key words for use in RFCs to Indicate
+   Requirement Levels', RFC 2119, March 1997.
+
+      <url:ftp://ftp.isi.edu/in-notes/rfc2119.txt>
+
+   [MIME] Freed, N.  and N. Borenstein,  "Multipurpose Internet Mail
+   Extensions (MIME) Part One: Format of Internet Message Bodies",
+   RFC 2045, November 1996.
+
+      <url:ftp://ftp.isi.edu/in-notes/rfc2045.txt>
+
+   [MPEG] ISO/IEC 11172-3:1993.
+   Coding of moving pictures and associated audio for digital storage
+   media at up to about 1,5 Mbit/s, Part 3: Audio.
+   Technical committee / subcommittee: JTC 1 / SC 29
+    and
+   ISO/IEC 13818-3:1995
+   Generic coding of moving pictures and associated audio information,
+   Part 3: Audio.
+   Technical committee / subcommittee: JTC 1 / SC 29
+    and
+   ISO/IEC DIS 13818-3
+   Generic coding of moving pictures and associated audio information,
+   Part 3: Audio (Revision of ISO/IEC 13818-3:1995)
+
+
+   [PNG] Portable Network Graphics, version 1.0
+
+      <url:http://www.w3.org/TR/REC-png-multi.html>
+
+   [URL] T. Berners-Lee, L. Masinter & M. McCahill, "Uniform Resource
+   Locators (URL).", RFC 1738, December 1994.
+
+      <url:ftp://ftp.isi.edu/in-notes/rfc1738.txt>
+
+   [ZLIB] P. Deutsch, Aladdin Enterprises & J-L. Gailly, "ZLIB
+   Compressed
+   Data Format Specification version 3.3", RFC 1950, May 1996.
+
+      <url:ftp://ftp.isi.edu/in-notes/rfc1950.txt>
+
+
+7.   Appendix
+
+
+A.   Appendix A - Genre List from ID3v1
+
+   The following genres is defined in ID3v1
+
+      0.Blues
+      1.Classic Rock
+      2.Country
+      3.Dance
+      4.Disco
+      5.Funk
+      6.Grunge
+      7.Hip-Hop
+      8.Jazz
+      9.Metal
+     10.New Age
+     11.Oldies
+     12.Other
+     13.Pop
+     14.R&B
+     15.Rap
+     16.Reggae
+     17.Rock
+     18.Techno
+     19.Industrial
+     20.Alternative
+     21.Ska
+     22.Death Metal
+     23.Pranks
+     24.Soundtrack
+     25.Euro-Techno
+     26.Ambient
+     27.Trip-Hop
+     28.Vocal
+     29.Jazz+Funk
+     30.Fusion
+     31.Trance
+     32.Classical
+     33.Instrumental
+     34.Acid
+     35.House
+     36.Game
+     37.Sound Clip
+     38.Gospel
+     39.Noise
+     40.AlternRock
+     41.Bass
+     42.Soul
+     43.Punk
+     44.Space
+     45.Meditative
+     46.Instrumental Pop
+     47.Instrumental Rock
+     48.Ethnic
+     49.Gothic
+     50.Darkwave
+     51.Techno-Industrial
+     52.Electronic
+     53.Pop-Folk
+     54.Eurodance
+     55.Dream
+     56.Southern Rock
+     57.Comedy
+     58.Cult
+     59.Gangsta
+     60.Top 40
+     61.Christian Rap
+     62.Pop/Funk
+     63.Jungle
+     64.Native American
+     65.Cabaret
+     66.New Wave
+     67.Psychadelic
+     68.Rave
+     69.Showtunes
+     70.Trailer
+     71.Lo-Fi
+     72.Tribal
+     73.Acid Punk
+     74.Acid Jazz
+     75.Polka
+     76.Retro
+     77.Musical
+     78.Rock & Roll
+     79.Hard Rock
+
+
+8.   Author's Address
+
+   Written by
+
+     Martin Nilsson
+     Rydsvgen 246 C. 30
+     SE-584 34 Linkping
+     Sweden
+
+     Email: nilsson@id3.org
diff --git a/gst-libs/gst/tag/id3v2.4.0-structure.txt b/gst-libs/gst/tag/id3v2.4.0-structure.txt
new file mode 100644
index 0000000..5d3a614
--- /dev/null
+++ b/gst-libs/gst/tag/id3v2.4.0-structure.txt
@@ -0,0 +1,733 @@
+
+Informal standard                                             M. Nilsson
+Document: id3v2.4.0-structure.txt                      16 September 2001
+
+
+                 ID3 tag version 2.4.0 - Main Structure
+
+Status of this document
+
+   This document is an informal standard and replaces the ID3v2.3.0
+   standard [ID3v2]. A formal standard will use another revision number
+   even if the content is identical to document. The contents in this
+   document may change for clarifications but never for added or altered
+   functionallity.
+
+   Distribution of this document is unlimited.
+
+
+Abstract
+
+   This document describes the main structure of ID3v2.4.0, which is a
+   revised version of the ID3v2 informal standard [ID3v2] version
+   2.3.0. The ID3v2 offers a flexible way of storing audio meta
+   information within the audio file itself. The information may be
+   technical information, such as equalisation curves, as well as
+   title, performer, copyright etc.
+
+   ID3v2.4.0 is meant to be as close as possible to ID3v2.3.0 in order
+   to allow for implementations to be revised as easily as possible.
+
+
+1.   Table of contents
+
+        Status of this document
+        Abstract
+   1.   Table of contents
+   2.   Conventions in this document
+   2.   Standard overview
+   3.   ID3v2 overview
+     3.1.   ID3v2 header
+     3.2.   ID3v2 extended header
+     3.3.   Padding
+     3.4.   ID3v2 footer
+   4.   ID3v2 frames overview
+     4.1.   Frame header flags
+       4.1.1. Frame status flags
+       4.1.2. Frame format flags
+   5.   Tag location
+   6.   Unsynchronisation
+     6.1.   The unsynchronisation scheme
+     6.2.   Synchsafe integers
+   7.   Copyright
+   8.   References
+   9.   Author's Address
+
+
+2.   Conventions in this document
+
+   Text within "" is a text string exactly as it appears in a tag.
+   Numbers preceded with $ are hexadecimal and numbers preceded with %
+   are binary. $xx is used to indicate a byte with unknown content. %x
+   is used to indicate a bit with unknown content. The most significant
+   bit (MSB) of a byte is called 'bit 7' and the least significant bit
+   (LSB) is called 'bit 0'.
+
+   A tag is the whole tag described in this document. A frame is a block
+   of information in the tag. The tag consists of a header, frames and
+   optional padding. A field is a piece of information; one value, a
+   string etc. A numeric string is a string that consists of the
+   characters "0123456789" only.
+
+   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
+   "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this
+   document are to be interpreted as described in RFC 2119 [KEYWORDS].
+
+
+3.   ID3v2 overview
+
+   ID3v2 is a general tagging format for audio, which makes it possible
+   to store meta data about the audio inside the audio file itself. The
+   ID3 tag described in this document is mainly targeted at files
+   encoded with MPEG-1/2 layer I, MPEG-1/2 layer II, MPEG-1/2 layer III
+   and MPEG-2.5, but may work with other types of encoded audio or as a
+   stand alone format for audio meta data.
+
+   ID3v2 is designed to be as flexible and expandable as possible to
+   meet new meta information needs that might arise. To achieve that
+   ID3v2 is constructed as a container for several information blocks,
+   called frames, whose format need not be known to the software that
+   encounters them. At the start of every frame is an unique and
+   predefined identifier, a size descriptor that allows software to skip
+   unknown frames and a flags field. The flags describes encoding
+   details and if the frame should remain in the tag, should it be
+   unknown to the software, if the file is altered.
+
+   The bitorder in ID3v2 is most significant bit first (MSB). The
+   byteorder in multibyte numbers is most significant byte first (e.g.
+   $12345678 would be encoded $12 34 56 78), also known as big endian
+   and network byte order.
+
+   Overall tag structure:
+
+     +-----------------------------+
+     |      Header (10 bytes)      |
+     +-----------------------------+
+     |       Extended Header       |
+     | (variable length, OPTIONAL) |
+     +-----------------------------+
+     |   Frames (variable length)  |
+     +-----------------------------+
+     |           Padding           |
+     | (variable length, OPTIONAL) |
+     +-----------------------------+
+     | Footer (10 bytes, OPTIONAL) |
+     +-----------------------------+
+
+   In general, padding and footer are mutually exclusive. See details in
+   sections 3.3, 3.4 and 5.
+
+
+3.1.   ID3v2 header
+
+   The first part of the ID3v2 tag is the 10 byte tag header, laid out
+   as follows:
+
+     ID3v2/file identifier      "ID3"
+     ID3v2 version              $04 00
+     ID3v2 flags                %abcd0000
+     ID3v2 size             4 * %0xxxxxxx
+
+   The first three bytes of the tag are always "ID3", to indicate that
+   this is an ID3v2 tag, directly followed by the two version bytes. The
+   first byte of ID3v2 version is its major version, while the second
+   byte is its revision number. In this case this is ID3v2.4.0. All
+   revisions are backwards compatible while major versions are not. If
+   software with ID3v2.4.0 and below support should encounter version
+   five or higher it should simply ignore the whole tag. Version or
+   revision will never be $FF.
+
+   The version is followed by the ID3v2 flags field, of which currently
+   four flags are used.
+
+
+   a - Unsynchronisation
+
+     Bit 7 in the 'ID3v2 flags' indicates whether or not
+     unsynchronisation is applied on all frames (see section 6.1 for
+     details); a set bit indicates usage.
+
+
+   b - Extended header
+
+     The second bit (bit 6) indicates whether or not the header is
+     followed by an extended header. The extended header is described in
+     section 3.2. A set bit indicates the presence of an extended
+     header.
+
+
+   c - Experimental indicator
+
+     The third bit (bit 5) is used as an 'experimental indicator'. This
+     flag SHALL always be set when the tag is in an experimental stage.
+
+
+   d - Footer present
+
+     Bit 4 indicates that a footer (section 3.4) is present at the very
+     end of the tag. A set bit indicates the presence of a footer.
+
+
+   All the other flags MUST be cleared. If one of these undefined flags
+   are set, the tag might not be readable for a parser that does not
+   know the flags function.
+
+   The ID3v2 tag size is stored as a 32 bit synchsafe integer (section
+   6.2), making a total of 28 effective bits (representing up to 256MB).
+
+   The ID3v2 tag size is the sum of the byte length of the extended
+   header, the padding and the frames after unsynchronisation. If a
+   footer is present this equals to ('total size' - 20) bytes, otherwise
+   ('total size' - 10) bytes.
+
+   An ID3v2 tag can be detected with the following pattern:
+     $49 44 33 yy yy xx zz zz zz zz
+   Where yy is less than $FF, xx is the 'flags' byte and zz is less than
+   $80.
+
+
+3.2. Extended header
+
+   The extended header contains information that can provide further
+   insight in the structure of the tag, but is not vital to the correct
+   parsing of the tag information; hence the extended header is
+   optional.
+
+     Extended header size   4 * %0xxxxxxx
+     Number of flag bytes       $01
+     Extended Flags             $xx
+
+   Where the 'Extended header size' is the size of the whole extended
+   header, stored as a 32 bit synchsafe integer. An extended header can
+   thus never have a size of fewer than six bytes.
+
+   The extended flags field, with its size described by 'number of flag
+   bytes', is defined as:
+
+     %0bcd0000
+
+   Each flag that is set in the extended header has data attached, which
+   comes in the order in which the flags are encountered (i.e. the data
+   for flag 'b' comes before the data for flag 'c'). Unset flags cannot
+   have any attached data. All unknown flags MUST be unset and their
+   corresponding data removed when a tag is modified.
+
+   Every set flag's data starts with a length byte, which contains a
+   value between 0 and 127 ($00 - $7f), followed by data that has the
+   field length indicated by the length byte. If a flag has no attached
+   data, the value $00 is used as length byte.
+
+
+   b - Tag is an update
+
+     If this flag is set, the present tag is an update of a tag found
+     earlier in the present file or stream. If frames defined as unique
+     are found in the present tag, they are to override any
+     corresponding ones found in the earlier tag. This flag has no
+     corresponding data.
+
+         Flag data length      $00
+
+   c - CRC data present
+
+     If this flag is set, a CRC-32 [ISO-3309] data is included in the
+     extended header. The CRC is calculated on all the data between the
+     header and footer as indicated by the header's tag length field,
+     minus the extended header. Note that this includes the padding (if
+     there is any), but excludes the footer. The CRC-32 is stored as an
+     35 bit synchsafe integer, leaving the upper four bits always
+     zeroed.
+
+        Flag data length       $05
+        Total frame CRC    5 * %0xxxxxxx
+
+   d - Tag restrictions
+
+     For some applications it might be desired to restrict a tag in more
+     ways than imposed by the ID3v2 specification. Note that the
+     presence of these restrictions does not affect how the tag is
+     decoded, merely how it was restricted before encoding. If this flag
+     is set the tag is restricted as follows:
+
+        Flag data length       $01
+        Restrictions           %ppqrrstt
+
+     p - Tag size restrictions
+
+       00   No more than 128 frames and 1 MB total tag size.
+       01   No more than 64 frames and 128 KB total tag size.
+       10   No more than 32 frames and 40 KB total tag size.
+       11   No more than 32 frames and 4 KB total tag size.
+
+     q - Text encoding restrictions
+
+       0    No restrictions
+       1    Strings are only encoded with ISO-8859-1 [ISO-8859-1] or
+            UTF-8 [UTF-8].
+
+     r - Text fields size restrictions
+
+       00   No restrictions
+       01   No string is longer than 1024 characters.
+       10   No string is longer than 128 characters.
+       11   No string is longer than 30 characters.
+
+       Note that nothing is said about how many bytes is used to
+       represent those characters, since it is encoding dependent. If a
+       text frame consists of more than one string, the sum of the
+       strungs is restricted as stated.
+
+     s - Image encoding restrictions
+
+       0   No restrictions
+       1   Images are encoded only with PNG [PNG] or JPEG [JFIF].
+
+     t - Image size restrictions
+
+       00  No restrictions
+       01  All images are 256x256 pixels or smaller.
+       10  All images are 64x64 pixels or smaller.
+       11  All images are exactly 64x64 pixels, unless required
+           otherwise.
+
+
+3.3.   Padding
+
+   It is OPTIONAL to include padding after the final frame (at the end
+   of the ID3 tag), making the size of all the frames together smaller
+   than the size given in the tag header. A possible purpose of this
+   padding is to allow for adding a few additional frames or enlarge
+   existing frames within the tag without having to rewrite the entire
+   file. The value of the padding bytes must be $00. A tag MUST NOT have
+   any padding between the frames or between the tag header and the
+   frames. Furthermore it MUST NOT have any padding when a tag footer is
+   added to the tag.
+
+
+3.4.   ID3v2 footer
+
+   To speed up the process of locating an ID3v2 tag when searching from
+   the end of a file, a footer can be added to the tag. It is REQUIRED
+   to add a footer to an appended tag, i.e. a tag located after all
+   audio data. The footer is a copy of the header, but with a different
+   identifier.
+
+     ID3v2 identifier           "3DI"
+     ID3v2 version              $04 00
+     ID3v2 flags                %abcd0000
+     ID3v2 size             4 * %0xxxxxxx
+
+
+4.   ID3v2 frame overview
+
+   All ID3v2 frames consists of one frame header followed by one or more
+   fields containing the actual information. The header is always 10
+   bytes and laid out as follows:
+
+     Frame ID      $xx xx xx xx  (four characters)
+     Size      4 * %0xxxxxxx
+     Flags         $xx xx
+
+   The frame ID is made out of the characters capital A-Z and 0-9.
+   Identifiers beginning with "X", "Y" and "Z" are for experimental
+   frames and free for everyone to use, without the need to set the
+   experimental bit in the tag header. Bear in mind that someone else
+   might have used the same identifier as you. All other identifiers are
+   either used or reserved for future use.
+
+   The frame ID is followed by a size descriptor containing the size of
+   the data in the final frame, after encryption, compression and
+   unsynchronisation. The size is excluding the frame header ('total
+   frame size' - 10 bytes) and stored as a 32 bit synchsafe integer.
+
+   In the frame header the size descriptor is followed by two flag
+   bytes. These flags are described in section 4.1.
+
+   There is no fixed order of the frames' appearance in the tag,
+   although it is desired that the frames are arranged in order of
+   significance concerning the recognition of the file. An example of
+   such order: UFID, TIT2, MCDI, TRCK ...
+
+   A tag MUST contain at least one frame. A frame must be at least 1
+   byte big, excluding the header.
+
+   If nothing else is said, strings, including numeric strings and URLs
+   [URL], are represented as ISO-8859-1 [ISO-8859-1] characters in the
+   range $20 - $FF. Such strings are represented in frame descriptions
+   as <text string>, or <full text string> if newlines are allowed. If
+   nothing else is said newline character is forbidden. In ISO-8859-1 a
+   newline is represented, when allowed, with $0A only.
+
+   Frames that allow different types of text encoding contains a text
+   encoding description byte. Possible encodings:
+
+     $00   ISO-8859-1 [ISO-8859-1]. Terminated with $00.
+     $01   UTF-16 [UTF-16] encoded Unicode [UNICODE] with BOM. All
+           strings in the same frame SHALL have the same byteorder.
+           Terminated with $00 00.
+     $02   UTF-16BE [UTF-16] encoded Unicode [UNICODE] without BOM.
+           Terminated with $00 00.
+     $03   UTF-8 [UTF-8] encoded Unicode [UNICODE]. Terminated with $00.
+
+   Strings dependent on encoding are represented in frame descriptions
+   as <text string according to encoding>, or <full text string
+   according to encoding> if newlines are allowed. Any empty strings of
+   type $01 which are NULL-terminated may have the Unicode BOM followed
+   by a Unicode NULL ($FF FE 00 00 or $FE FF 00 00).
+
+   The timestamp fields are based on a subset of ISO 8601. When being as
+   precise as possible the format of a time string is
+   yyyy-MM-ddTHH:mm:ss (year, "-", month, "-", day, "T", hour (out of
+   24), ":", minutes, ":", seconds), but the precision may be reduced by
+   removing as many time indicators as wanted. Hence valid timestamps
+   are
+   yyyy, yyyy-MM, yyyy-MM-dd, yyyy-MM-ddTHH, yyyy-MM-ddTHH:mm and
+   yyyy-MM-ddTHH:mm:ss. All time stamps are UTC. For durations, use
+   the slash character as described in 8601, and for multiple non-
+   contiguous dates, use multiple strings, if allowed by the frame
+   definition.
+
+   The three byte language field, present in several frames, is used to
+   describe the language of the frame's content, according to ISO-639-2
+   [ISO-639-2]. The language should be represented in lower case. If the
+   language is not known the string "XXX" should be used.
+
+   All URLs [URL] MAY be relative, e.g. "picture.png", "../doc.txt".
+
+   If a frame is longer than it should be, e.g. having more fields than
+   specified in this document, that indicates that additions to the
+   frame have been made in a later version of the ID3v2 standard. This
+   is reflected by the revision number in the header of the tag.
+
+
+4.1.   Frame header flags
+
+   In the frame header the size descriptor is followed by two flag
+   bytes. All unused flags MUST be cleared. The first byte is for
+   'status messages' and the second byte is a format description. If an
+   unknown flag is set in the first byte the frame MUST NOT be changed
+   without that bit cleared. If an unknown flag is set in the second
+   byte the frame is likely to not be readable. Some flags in the second
+   byte indicates that extra information is added to the header. These
+   fields of extra information is ordered as the flags that indicates
+   them. The flags field is defined as follows (l and o left out because
+   their resemblence to one and zero):
+
+     %0abc0000 %0h00kmnp
+
+   Some frame format flags indicate that additional information fields
+   are added to the frame. This information is added after the frame
+   header and before the frame data in the same order as the flags that
+   indicates them. I.e. the four bytes of decompressed size will precede
+   the encryption method byte. These additions affects the 'frame size'
+   field, but are not subject to encryption or compression.
+   
+   The default status flags setting for a frame is, unless stated
+   otherwise, 'preserved if tag is altered' and 'preserved if file is
+   altered', i.e. %00000000.
+
+
+4.1.1. Frame status flags
+
+   a - Tag alter preservation
+
+     This flag tells the tag parser what to do with this frame if it is
+     unknown and the tag is altered in any way. This applies to all
+     kinds of alterations, including adding more padding and reordering
+     the frames.
+
+     0     Frame should be preserved.
+     1     Frame should be discarded.
+
+
+   b - File alter preservation
+
+     This flag tells the tag parser what to do with this frame if it is
+     unknown and the file, excluding the tag, is altered. This does not
+     apply when the audio is completely replaced with other audio data.
+
+     0     Frame should be preserved.
+     1     Frame should be discarded.
+
+
+   c - Read only
+
+      This flag, if set, tells the software that the contents of this
+      frame are intended to be read only. Changing the contents might
+      break something, e.g. a signature. If the contents are changed,
+      without knowledge of why the frame was flagged read only and
+      without taking the proper means to compensate, e.g. recalculating
+      the signature, the bit MUST be cleared.
+
+
+4.1.2. Frame format flags
+
+   h - Grouping identity
+
+      This flag indicates whether or not this frame belongs in a group
+      with other frames. If set, a group identifier byte is added to the
+      frame. Every frame with the same group identifier belongs to the
+      same group.
+
+      0     Frame does not contain group information
+      1     Frame contains group information
+
+
+   k - Compression
+
+      This flag indicates whether or not the frame is compressed.
+      A 'Data Length Indicator' byte MUST be included in the frame.
+
+      0     Frame is not compressed.
+      1     Frame is compressed using zlib [zlib] deflate method.
+            If set, this requires the 'Data Length Indicator' bit
+            to be set as well.
+
+
+   m - Encryption
+   
+      This flag indicates whether or not the frame is encrypted. If set,
+      one byte indicating with which method it was encrypted will be
+      added to the frame. See description of the ENCR frame for more
+      information about encryption method registration. Encryption
+      should be done after compression. Whether or not setting this flag
+      requires the presence of a 'Data Length Indicator' depends on the
+      specific algorithm used.
+
+      0     Frame is not encrypted.
+      1     Frame is encrypted.
+
+   n - Unsynchronisation
+
+      This flag indicates whether or not unsynchronisation was applied
+      to this frame. See section 6 for details on unsynchronisation.
+      If this flag is set all data from the end of this header to the
+      end of this frame has been unsynchronised. Although desirable, the
+      presence of a 'Data Length Indicator' is not made mandatory by
+      unsynchronisation.
+
+      0     Frame has not been unsynchronised.
+      1     Frame has been unsyrchronised.
+
+   p - Data length indicator
+
+      This flag indicates that a data length indicator has been added to
+      the frame. The data length indicator is the value one would write
+      as the 'Frame length' if all of the frame format flags were
+      zeroed, represented as a 32 bit synchsafe integer.
+
+      0      There is no Data Length Indicator.
+      1      A data length Indicator has been added to the frame.
+
+
+5.   Tag location
+
+   The default location of an ID3v2 tag is prepended to the audio so
+   that players can benefit from the information when the data is
+   streamed. It is however possible to append the tag, or make a
+   prepend/append combination. When deciding upon where an unembedded
+   tag should be located, the following order of preference SHOULD be
+   considered.
+   
+     1. Prepend the tag.
+
+     2. Prepend a tag with all vital information and add a second tag at 
+        the end of the file, before tags from other tagging systems. The
+        first tag is required to have a SEEK frame.
+      
+     3. Add a tag at the end of the file, before tags from other tagging
+        systems.
+      
+   In case 2 and 3 the tag can simply be appended if no other known tags
+   are present. The suggested method to find ID3v2 tags are:
+   
+     1. Look for a prepended tag using the pattern found in section 3.1.
+
+     2. If a SEEK frame was found, use its values to guide further
+        searching.
+
+     3. Look for a tag footer, scanning from the back of the file.
+
+   For every new tag that is found, the old tag should be discarded
+   unless the update flag in the extended header (section 3.2) is set.
+   
+
+6.   Unsynchronisation
+
+   The only purpose of unsynchronisation is to make the ID3v2 tag as
+   compatible as possible with existing software and hardware. There is
+   no use in 'unsynchronising' tags if the file is only to be processed
+   only by ID3v2 aware software and hardware. Unsynchronisation is only
+   useful with tags in MPEG 1/2 layer I, II and III, MPEG 2.5 and AAC
+   files.
+
+
+6.1.   The unsynchronisation scheme
+
+   Whenever a false synchronisation is found within the tag, one zeroed
+   byte is inserted after the first false synchronisation byte. The
+   format of synchronisations that should be altered by ID3 encoders is
+   as follows:
+
+         %11111111 111xxxxx
+
+   and should be replaced with:
+
+         %11111111 00000000 111xxxxx
+
+   This has the side effect that all $FF 00 combinations have to be
+   altered, so they will not be affected by the decoding process.
+   Therefore all the $FF 00 combinations have to be replaced with the
+   $FF 00 00 combination during the unsynchronisation.
+
+   To indicate usage of the unsynchronisation, the unsynchronisation
+   flag in the frame header should be set. This bit MUST be set if the
+   frame was altered by the unsynchronisation and SHOULD NOT be set if
+   unaltered. If all frames in the tag are unsynchronised the
+   unsynchronisation flag in the tag header SHOULD be set. It MUST NOT
+   be set if the tag has a frame which is not unsynchronised.
+
+   Assume the first byte of the audio to be $FF. The special case when
+   the last byte of the last frame is $FF and no padding nor footer is
+   used will then introduce a false synchronisation. This can be solved
+   by adding a footer, adding padding or unsynchronising the frame and
+   add $00 to the end of the frame data, thus adding more byte to the
+   frame size than a normal unsynchronisation would. Although not
+   preferred, it is allowed to apply the last method on all frames
+   ending with $FF.
+
+   It is preferred that the tag is either completely unsynchronised or
+   not unsynchronised at all. A completely unsynchronised tag has no 
+   false synchonisations in it, as defined above, and does not end with
+   $FF. A completely non-unsynchronised tag contains no unsynchronised
+   frames, and thus the unsynchronisation flag in the header is cleared.
+
+   Do bear in mind, that if compression or encryption is used, the
+   unsynchronisation scheme MUST be applied afterwards. When decoding an
+   unsynchronised frame, the unsynchronisation scheme MUST be reversed
+   first, encryption and decompression afterwards.
+
+
+6.2.   Synchsafe integers
+
+   In some parts of the tag it is inconvenient to use the
+   unsychronisation scheme because the size of unsynchronised data is
+   not known in advance, which is particularly problematic with size
+   descriptors. The solution in ID3v2 is to use synchsafe integers, in
+   which there can never be any false synchs. Synchsafe integers are
+   integers that keep its highest bit (bit 7) zeroed, making seven bits
+   out of eight available. Thus a 32 bit synchsafe integer can store 28
+   bits of information.
+   
+   Example:
+   
+     255 (%11111111) encoded as a 16 bit synchsafe integer is 383
+     (%00000001 01111111).
+
+
+7.   Copyright
+
+   Copyright (C) Martin Nilsson 2000. All Rights Reserved.
+
+   This document and translations of it may be copied and furnished to
+   others, and derivative works that comment on or otherwise explain it
+   or assist in its implementation may be prepared, copied, published
+   and distributed, in whole or in part, without restriction of any
+   kind, provided that a reference to this document is included on all
+   such copies and derivative works. However, this document itself may
+   not be modified in any way and reissued as the original document.
+
+   The limited permissions granted above are perpetual and will not be
+   revoked.
+
+   This document and the information contained herein is provided on an
+   'AS IS' basis and THE AUTHORS DISCLAIMS ALL WARRANTIES, EXPRESS OR
+   IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
+   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
+   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.
+
+
+8.   References
+
+   [ID3v2] Martin Nilsson, 'ID3v2 informal standard'.
+
+      <url:http://www.id3.org/id3v2.3.0.txt>
+
+   [ISO-639-2] ISO/FDIS 639-2.
+   'Codes for the representation of names of languages, Part 2: Alpha-3
+   code.' Technical committee / subcommittee: TC 37 / SC 2
+
+   [ISO-3309] ISO 3309
+   'Information Processing Systems--Data Communication High-Level Data
+   Link Control Procedure--Frame Structure', IS 3309, October 1984, 3rd
+   Edition.
+
+   [ISO-8859-1] ISO/IEC DIS 8859-1.
+   '8-bit single-byte coded graphic character sets, Part 1: Latin
+   alphabet No. 1.' Technical committee / subcommittee: JTC 1 / SC 2
+
+   [JFIF] 'JPEG File Interchange Format, version 1.02'
+
+      <url:http://www.w3.org/Graphics/JPEG/jfif.txt>
+
+   [KEYWORDS] S. Bradner, 'Key words for use in RFCs to Indicate
+   Requirement Levels', RFC 2119, March 1997.
+
+      <url:ftp://ftp.isi.edu/in-notes/rfc2119.txt>
+
+   [MPEG] ISO/IEC 11172-3:1993.
+   'Coding of moving pictures and associated audio for digital storage
+   media at up to about 1,5 Mbit/s, Part 3: Audio.'
+   Technical committee / subcommittee: JTC 1 / SC 29
+    and
+   ISO/IEC 13818-3:1995
+   'Generic coding of moving pictures and associated audio information,
+   Part 3: Audio.'
+   Technical committee / subcommittee: JTC 1 / SC 29
+    and
+   ISO/IEC DIS 13818-3
+   'Generic coding of moving pictures and associated audio information,
+   Part 3: Audio (Revision of ISO/IEC 13818-3:1995)'
+
+   [PNG] 'Portable Network Graphics, version 1.0'
+
+      <url:http://www.w3.org/TR/REC-png-multi.html>
+
+   [UNICODE] The Unicode Consortium,
+   'The Unicode Standard Version 3.0', ISBN 0-201-61633-5.
+
+   <url:http://www.unicode.org/unicode/standard/versions/Unicode3.0.htm>
+
+   [URL] T. Berners-Lee, L. Masinter & M. McCahill, 'Uniform Resource
+   Locators (URL)', RFC 1738, December 1994.
+
+      <url:ftp://ftp.isi.edu/in-notes/rfc1738.txt>
+
+   [UTF-8] F. Yergeau, 'UTF-8, a transformation format of ISO 10646',
+   RFC 2279, January 1998.
+   
+      <url:ftp://ftp.isi.edu/in-notes/rfc2279.txt>
+
+   [UTF-16] F. Yergeau, 'UTF-16, an encoding of ISO 10646', RFC 2781,
+   February 2000.
+   
+      <url:ftp://ftp.isi.edu/in-notes/rfc2781.txt>
+   
+   [ZLIB] P. Deutsch, Aladdin Enterprises & J-L. Gailly, 'ZLIB
+   Compressed Data Format Specification version 3.3', RFC 1950,
+   May 1996.
+
+      <url:ftp://ftp.isi.edu/in-notes/rfc1950.txt>
+
+
+9.   Author's Address
+
+   Written by
+
+     Martin Nilsson
+     Rydsvgen 246 C. 30
+     SE-584 34 Linkping
+     Sweden
+
+     Email: nilsson@id3.org
+
diff --git a/gst-libs/gst/tag/lang.c b/gst-libs/gst/tag/lang.c
index a0838fe..c37366e 100644
--- a/gst-libs/gst/tag/lang.c
+++ b/gst-libs/gst/tag/lang.c
@@ -30,8 +30,6 @@
  * </refsect2>
  */
 
-/* FIXME 0.11: maybe switch to ISO-639-2 everywhere incl. GST_TAG_LANGUAGE? */
-
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
@@ -311,8 +309,8 @@ gst_tag_get_language_codes (void)
  * gst_tag_get_language_name:
  * @language_code: two or three-letter ISO-639 language code
  *
- * Returns the name of the language given an ISO-639 language code, such
- * as often found in a GST_TAG_LANGUAGE tag. The name will be translated
+ * Returns the name of the language given an ISO-639 language code as
+ * found in a GST_TAG_LANGUAGE_CODE tag. The name will be translated
  * according to the current locale (if the library was built against the
  * iso-codes package, otherwise the English name will be returned).
  *
@@ -492,3 +490,25 @@ gst_tag_get_language_code_iso_639_2B (const gchar * lang_code)
 
   return c;
 }
+
+/**
+ * gst_tag_check_language_code:
+ * @lang_code: ISO-639 language code (e.g. "deu" or "ger" or "de")
+ *
+ * Check if a given string contains a known ISO 639 language code.
+ *
+ * This is useful in situations where it's not clear whether a given
+ * string is a language code (which should be put into a #GST_TAG_LANGUAGE_CODE
+ * tag) or a free-form language name descriptor (which should be put into a
+ * #GST_TAG_LANGUAGE_NAME tag instead).
+ *
+ * Returns: TRUE if the two- or three-letter language code in @lang_code
+ *     is a valid ISO-639 language code.
+ *
+ * Since: 0.10.37
+ */
+gboolean
+gst_tag_check_language_code (const gchar * lang_code)
+{
+  return (gst_tag_get_language_code_iso_639_1 (lang_code) != NULL);
+}
diff --git a/gst-libs/gst/tag/tag.h b/gst-libs/gst/tag/tag.h
index 057378c..074f81e 100644
--- a/gst-libs/gst/tag/tag.h
+++ b/gst-libs/gst/tag/tag.h
@@ -551,6 +551,8 @@ const gchar *  gst_tag_get_language_code_iso_639_2B (const gchar * lang_code);
 
 const gchar *  gst_tag_get_language_code_iso_639_2T (const gchar * lang_code);
 
+gboolean       gst_tag_check_language_code          (const gchar * lang_code);
+
 /**
  * gst_tag_get_language_code:
  * @lang_code: ISO-639 language code (e.g. "deu" or "ger" or "de")
diff --git a/gst-libs/gst/video/Makefile.am b/gst-libs/gst/video/Makefile.am
index 7306995..1f3a72c 100644
--- a/gst-libs/gst/video/Makefile.am
+++ b/gst-libs/gst/video/Makefile.am
@@ -20,13 +20,17 @@ CLEANFILES = $(BUILT_SOURCES)
 # video-blend.h should be disted but not installed into the includedir
 libgstvideo_@GST_MAJORMINOR@_la_SOURCES = \
 	video.c gstvideosink.c gstvideofilter.c convertframe.c \
-	video-blend.c video-blend.h video-overlay-composition.c
+	video-blend.c video-blend.h video-overlay-composition.c \
+	gstvideodecoder.c gstvideoencoder.c \
+	gstvideoutils.c
 nodist_libgstvideo_@GST_MAJORMINOR@_la_SOURCES = \
 	$(built_sources) $(built_headers) \
 	$(ORC_NODIST_SOURCES)
 libgstvideo_@GST_MAJORMINOR@includedir = $(includedir)/gstreamer-@GST_MAJORMINOR@/gst/video
 libgstvideo_@GST_MAJORMINOR@include_HEADERS = \
-	video.h gstvideosink.h gstvideofilter.h video-overlay-composition.h
+	video.h gstvideosink.h gstvideofilter.h video-overlay-composition.h \
+	gstvideodecoder.h gstvideoencoder.h \
+	gstvideoutils.h
 nodist_libgstvideo_@GST_MAJORMINOR@include_HEADERS = $(built_headers)
 
 libgstvideo_@GST_MAJORMINOR@_la_CFLAGS = \
@@ -63,11 +67,12 @@ GstVideo-@GST_MAJORMINOR@.gir: $(INTROSPECTION_SCANNER) libgstvideo-@GST_MAJORMI
 		$(INTROSPECTION_SCANNER) -v --namespace GstVideo \
 		--nsversion=@GST_MAJORMINOR@ \
 		--strip-prefix=Gst \
+		--warn-all \
 		$(gir_cincludes) \
 		-I$(top_srcdir)/gst-libs \
 		-I$(top_builddir)/gst-libs \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 		--library=libgstvideo-@GST_MAJORMINOR@.la \
 		--include=Gst-@GST_MAJORMINOR@ \
 		--include=GstBase-@GST_MAJORMINOR@ \
@@ -94,8 +99,8 @@ typelibs_DATA = $(BUILT_GIRSOURCES:.gir=.typelib)
 		$(INTROSPECTION_COMPILER) \
 		--includedir=$(srcdir) \
 		--includedir=$(builddir) \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 CLEANFILES += $(BUILT_GIRSOURCES) $(typelibs_DATA)
diff --git a/gst-libs/gst/video/Makefile.in b/gst-libs/gst/video/Makefile.in
index 33f707e..7e71338 100644
--- a/gst-libs/gst/video/Makefile.in
+++ b/gst-libs/gst/video/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -48,6 +47,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -66,10 +82,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(libgstvideo_@GST_MAJORMINOR@include_HEADERS) \
 	$(srcdir)/Makefile.am $(srcdir)/Makefile.in \
 	$(top_srcdir)/common/gst-glib-gen.mak \
-	$(top_srcdir)/common/orc.mak
+	$(top_srcdir)/common/orc.mak $(top_srcdir)/depcomp TODO
 @HAVE_INTROSPECTION_TRUE@am__append_1 = $(BUILT_GIRSOURCES) $(typelibs_DATA)
 subdir = gst-libs/gst/video
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
@@ -157,7 +174,10 @@ am_libgstvideo_@GST_MAJORMINOR@_la_OBJECTS =  \
 	libgstvideo_@GST_MAJORMINOR@_la-gstvideofilter.lo \
 	libgstvideo_@GST_MAJORMINOR@_la-convertframe.lo \
 	libgstvideo_@GST_MAJORMINOR@_la-video-blend.lo \
-	libgstvideo_@GST_MAJORMINOR@_la-video-overlay-composition.lo
+	libgstvideo_@GST_MAJORMINOR@_la-video-overlay-composition.lo \
+	libgstvideo_@GST_MAJORMINOR@_la-gstvideodecoder.lo \
+	libgstvideo_@GST_MAJORMINOR@_la-gstvideoencoder.lo \
+	libgstvideo_@GST_MAJORMINOR@_la-gstvideoutils.lo
 am__objects_1 = libgstvideo_@GST_MAJORMINOR@_la-video-enumtypes.lo
 am__objects_2 =
 am__objects_3 = libgstvideo_@GST_MAJORMINOR@_la-tmp-orc.lo
@@ -169,10 +189,23 @@ libgstvideo_@GST_MAJORMINOR@_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstvideo_@GST_MAJORMINOR@_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(libgstvideo_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) \
 	$(libgstvideo_@GST_MAJORMINOR@_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -185,23 +218,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstvideo_@GST_MAJORMINOR@_la_SOURCES) \
 	$(nodist_libgstvideo_@GST_MAJORMINOR@_la_SOURCES)
 DIST_SOURCES = $(libgstvideo_@GST_MAJORMINOR@_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DATA = $(gir_DATA) $(typelibs_DATA)
 HEADERS = $(libgstvideo_@GST_MAJORMINOR@include_HEADERS) \
 	$(nodist_libgstvideo_@GST_MAJORMINOR@include_HEADERS)
@@ -496,7 +530,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -527,7 +565,9 @@ CLEANFILES = $(BUILT_SOURCES) $(am__append_1)
 # video-blend.h should be disted but not installed into the includedir
 libgstvideo_@GST_MAJORMINOR@_la_SOURCES = \
 	video.c gstvideosink.c gstvideofilter.c convertframe.c \
-	video-blend.c video-blend.h video-overlay-composition.c
+	video-blend.c video-blend.h video-overlay-composition.c \
+	gstvideodecoder.c gstvideoencoder.c \
+	gstvideoutils.c
 
 nodist_libgstvideo_@GST_MAJORMINOR@_la_SOURCES = \
 	$(built_sources) $(built_headers) \
@@ -535,7 +575,9 @@ nodist_libgstvideo_@GST_MAJORMINOR@_la_SOURCES = \
 
 libgstvideo_@GST_MAJORMINOR@includedir = $(includedir)/gstreamer-@GST_MAJORMINOR@/gst/video
 libgstvideo_@GST_MAJORMINOR@include_HEADERS = \
-	video.h gstvideosink.h gstvideofilter.h video-overlay-composition.h
+	video.h gstvideosink.h gstvideofilter.h video-overlay-composition.h \
+	gstvideodecoder.h gstvideoencoder.h \
+	gstvideoutils.h
 
 nodist_libgstvideo_@GST_MAJORMINOR@include_HEADERS = $(built_headers)
 libgstvideo_@GST_MAJORMINOR@_la_CFLAGS = \
@@ -613,7 +655,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(libdir)" || $(MKDIR_P) "$(DESTDIR)$(libdir)"
 	@list='$(lib_LTLIBRARIES)'; test -n "$(libdir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -621,6 +662,8 @@ install-libLTLIBRARIES: $(lib_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libdir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(libdir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(libdir)"; \
 	}
@@ -636,12 +679,14 @@ uninstall-libLTLIBRARIES:
 
 clean-libLTLIBRARIES:
 	-test -z "$(lib_LTLIBRARIES)" || rm -f $(lib_LTLIBRARIES)
-	@list='$(lib_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(lib_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstvideo-@GST_MAJORMINOR@.la: $(libgstvideo_@GST_MAJORMINOR@_la_OBJECTS) $(libgstvideo_@GST_MAJORMINOR@_la_DEPENDENCIES) $(EXTRA_libgstvideo_@GST_MAJORMINOR@_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstvideo_@GST_MAJORMINOR@_la_LINK) -rpath $(libdir) $(libgstvideo_@GST_MAJORMINOR@_la_OBJECTS) $(libgstvideo_@GST_MAJORMINOR@_la_LIBADD) $(LIBS)
 
@@ -652,8 +697,11 @@ distclean-compile:
 	-rm -f *.tab.c
 
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-convertframe.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-gstvideodecoder.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-gstvideoencoder.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-gstvideofilter.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-gstvideosink.Plo@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-gstvideoutils.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-tmp-orc.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-video-blend.Plo@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-video-enumtypes.Plo@am__quote@
@@ -723,6 +771,27 @@ libgstvideo_@GST_MAJORMINOR@_la-video-overlay-composition.lo: video-overlay-comp
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstvideo_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) -c -o libgstvideo_@GST_MAJORMINOR@_la-video-overlay-composition.lo `test -f 'video-overlay-composition.c' || echo '$(srcdir)/'`video-overlay-composition.c
 
+libgstvideo_@GST_MAJORMINOR@_la-gstvideodecoder.lo: gstvideodecoder.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstvideo_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) -MT libgstvideo_@GST_MAJORMINOR@_la-gstvideodecoder.lo -MD -MP -MF $(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-gstvideodecoder.Tpo -c -o libgstvideo_@GST_MAJORMINOR@_la-gstvideodecoder.lo `test -f 'gstvideodecoder.c' || echo '$(srcdir)/'`gstvideodecoder.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-gstvideodecoder.Tpo $(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-gstvideodecoder.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='gstvideodecoder.c' object='libgstvideo_@GST_MAJORMINOR@_la-gstvideodecoder.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstvideo_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) -c -o libgstvideo_@GST_MAJORMINOR@_la-gstvideodecoder.lo `test -f 'gstvideodecoder.c' || echo '$(srcdir)/'`gstvideodecoder.c
+
+libgstvideo_@GST_MAJORMINOR@_la-gstvideoencoder.lo: gstvideoencoder.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstvideo_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) -MT libgstvideo_@GST_MAJORMINOR@_la-gstvideoencoder.lo -MD -MP -MF $(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-gstvideoencoder.Tpo -c -o libgstvideo_@GST_MAJORMINOR@_la-gstvideoencoder.lo `test -f 'gstvideoencoder.c' || echo '$(srcdir)/'`gstvideoencoder.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-gstvideoencoder.Tpo $(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-gstvideoencoder.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='gstvideoencoder.c' object='libgstvideo_@GST_MAJORMINOR@_la-gstvideoencoder.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstvideo_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) -c -o libgstvideo_@GST_MAJORMINOR@_la-gstvideoencoder.lo `test -f 'gstvideoencoder.c' || echo '$(srcdir)/'`gstvideoencoder.c
+
+libgstvideo_@GST_MAJORMINOR@_la-gstvideoutils.lo: gstvideoutils.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstvideo_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) -MT libgstvideo_@GST_MAJORMINOR@_la-gstvideoutils.lo -MD -MP -MF $(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-gstvideoutils.Tpo -c -o libgstvideo_@GST_MAJORMINOR@_la-gstvideoutils.lo `test -f 'gstvideoutils.c' || echo '$(srcdir)/'`gstvideoutils.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-gstvideoutils.Tpo $(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-gstvideoutils.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='gstvideoutils.c' object='libgstvideo_@GST_MAJORMINOR@_la-gstvideoutils.lo' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstvideo_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) -c -o libgstvideo_@GST_MAJORMINOR@_la-gstvideoutils.lo `test -f 'gstvideoutils.c' || echo '$(srcdir)/'`gstvideoutils.c
+
 libgstvideo_@GST_MAJORMINOR@_la-video-enumtypes.lo: video-enumtypes.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(libgstvideo_@GST_MAJORMINOR@_la_CFLAGS) $(CFLAGS) -MT libgstvideo_@GST_MAJORMINOR@_la-video-enumtypes.lo -MD -MP -MF $(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-video-enumtypes.Tpo -c -o libgstvideo_@GST_MAJORMINOR@_la-video-enumtypes.lo `test -f 'video-enumtypes.c' || echo '$(srcdir)/'`video-enumtypes.c
 @am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-video-enumtypes.Tpo $(DEPDIR)/libgstvideo_@GST_MAJORMINOR@_la-video-enumtypes.Plo
@@ -744,8 +813,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-girDATA: $(gir_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(girdir)" || $(MKDIR_P) "$(DESTDIR)$(girdir)"
 	@list='$(gir_DATA)'; test -n "$(girdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(girdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(girdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -762,8 +834,11 @@ uninstall-girDATA:
 	dir='$(DESTDIR)$(girdir)'; $(am__uninstall_files_from_dir)
 install-typelibsDATA: $(typelibs_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(typelibsdir)" || $(MKDIR_P) "$(DESTDIR)$(typelibsdir)"
 	@list='$(typelibs_DATA)'; test -n "$(typelibsdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(typelibsdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(typelibsdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -780,8 +855,11 @@ uninstall-typelibsDATA:
 	dir='$(DESTDIR)$(typelibsdir)'; $(am__uninstall_files_from_dir)
 install-libgstvideo_@GST_MAJORMINOR@includeHEADERS: $(libgstvideo_@GST_MAJORMINOR@include_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstvideo_@GST_MAJORMINOR@includedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstvideo_@GST_MAJORMINOR@includedir)"
 	@list='$(libgstvideo_@GST_MAJORMINOR@include_HEADERS)'; test -n "$(libgstvideo_@GST_MAJORMINOR@includedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstvideo_@GST_MAJORMINOR@includedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstvideo_@GST_MAJORMINOR@includedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -798,8 +876,11 @@ uninstall-libgstvideo_@GST_MAJORMINOR@includeHEADERS:
 	dir='$(DESTDIR)$(libgstvideo_@GST_MAJORMINOR@includedir)'; $(am__uninstall_files_from_dir)
 install-nodist_libgstvideo_@GST_MAJORMINOR@includeHEADERS: $(nodist_libgstvideo_@GST_MAJORMINOR@include_HEADERS)
 	@$(NORMAL_INSTALL)
-	test -z "$(libgstvideo_@GST_MAJORMINOR@includedir)" || $(MKDIR_P) "$(DESTDIR)$(libgstvideo_@GST_MAJORMINOR@includedir)"
 	@list='$(nodist_libgstvideo_@GST_MAJORMINOR@include_HEADERS)'; test -n "$(libgstvideo_@GST_MAJORMINOR@includedir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(libgstvideo_@GST_MAJORMINOR@includedir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(libgstvideo_@GST_MAJORMINOR@includedir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -864,6 +945,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -1021,8 +1116,8 @@ uninstall-am: uninstall-girDATA uninstall-libLTLIBRARIES \
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libLTLIBRARIES clean-libtool clean-local ctags dist-hook \
-	distclean distclean-compile distclean-generic \
+	clean-libLTLIBRARIES clean-libtool clean-local cscopelist \
+	ctags dist-hook distclean distclean-compile distclean-generic \
 	distclean-libtool distclean-tags distdir dvi dvi-am html \
 	html-am info info-am install install-am install-data \
 	install-data-am install-dvi install-dvi-am install-exec \
@@ -1120,11 +1215,12 @@ $(glib_gen_basename)-enumtypes.c: $(glib_enum_headers)
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_SCANNER) -v --namespace GstVideo \
 @HAVE_INTROSPECTION_TRUE@		--nsversion=@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--strip-prefix=Gst \
+@HAVE_INTROSPECTION_TRUE@		--warn-all \
 @HAVE_INTROSPECTION_TRUE@		$(gir_cincludes) \
 @HAVE_INTROSPECTION_TRUE@		-I$(top_srcdir)/gst-libs \
 @HAVE_INTROSPECTION_TRUE@		-I$(top_builddir)/gst-libs \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-@HAVE_INTROSPECTION_TRUE@		--add-include-path=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--add-include-path=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		--library=libgstvideo-@GST_MAJORMINOR@.la \
 @HAVE_INTROSPECTION_TRUE@		--include=Gst-@GST_MAJORMINOR@ \
 @HAVE_INTROSPECTION_TRUE@		--include=GstBase-@GST_MAJORMINOR@ \
@@ -1142,8 +1238,8 @@ $(glib_gen_basename)-enumtypes.c: $(glib_enum_headers)
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(srcdir) \
 @HAVE_INTROSPECTION_TRUE@		--includedir=$(builddir) \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
-@HAVE_INTROSPECTION_TRUE@		--includedir=`$(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-@GST_MAJORMINOR@` \
+@HAVE_INTROSPECTION_TRUE@		--includedir=`PKG_CONFIG_PATH="$(GST_PKG_CONFIG_PATH)" $(PKG_CONFIG) --variable=girdir gstreamer-base-@GST_MAJORMINOR@` \
 @HAVE_INTROSPECTION_TRUE@		$(INTROSPECTION_COMPILER_OPTS) $< -o $(@F)
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst-libs/gst/video/TODO b/gst-libs/gst/video/TODO
new file mode 100644
index 0000000..4770de1
--- /dev/null
+++ b/gst-libs/gst/video/TODO
@@ -0,0 +1,51 @@
+Base Video Classes TODO
+
+Main goal:
+
+ Make the video encoder/decoder base classes more consistent with the
+other GStreamer API, especially with the audio encoder/decoder base
+classes.
+
+API:
+
+ The API should be named similar, the base classes should be used
+similar by the sub-classes, the behaviour of the base classes should
+be similar.
+ Currently there are many, mostly small, differences between the audio
+and video base classes API. Things like GstVideoState should be merged
+with the stuff we have in 0.11 to make the API the same in 0.11 and
+0.10 as far as possible, things like GstVideoInfo might make sense to
+be backported (at least partially).
+
+
+Specifics:
+ * Use a GInstancePrivate for extensability.
+
+ * Try to move more common video objects to video.[ch]
+
+Known bugs:
+ https://bugzilla.gnome.org/show_bug.cgi?id=664127
+  [basevideodecoder] Add separate drain vfunc and differentiate
+    between hard/soft reset in reset vfunc
+
+ https://bugzilla.gnome.org/show_bug.cgi?id=660770
+  Doesn't support handling of "partial" frames
+
+ https://bugzilla.gnome.org/show_bug.cgi?id=654294
+  Impossible to flush pending frames in ::set_format
+
+ https://bugzilla.gnome.org/show_bug.cgi?id=658241
+  add API to handle QoS events and dropping logic
+
+ https://bugzilla.gnome.org/show_bug.cgi?id=667653
+  Autodetect multicore/multithread processors
+
+ https://bugzilla.gnome.org/show_bug.cgi?id=617021
+  Add support for QoS messages to -bad decoders and other elements
+
+
+Peripheral issues
+ https://bugzilla.gnome.org/show_bug.cgi?id=663262
+  theoraenc: spurious encoder resets due to unstable upstream
+  timestamps cause quality issues
+  => Investigate how to specify/handle variable framerates.
diff --git a/gst-libs/gst/video/gstvideodecoder.c b/gst-libs/gst/video/gstvideodecoder.c
new file mode 100644
index 0000000..cbc4569
--- /dev/null
+++ b/gst-libs/gst/video/gstvideodecoder.c
@@ -0,0 +1,3114 @@
+/* GStreamer
+ * Copyright (C) 2008 David Schleef <ds@schleef.org>
+ * Copyright (C) 2011 Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>.
+ * Copyright (C) 2011 Nokia Corporation. All rights reserved.
+ *   Contact: Stefan Kost <stefan.kost@nokia.com>
+ * Copyright (C) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+/**
+ * SECTION:gstvideodecoder
+ * @short_description: Base class for video decoders
+ * @see_also: 
+ *
+ * This base class is for video decoders turning encoded data into raw video
+ * frames.
+ *
+ * The GstVideoDecoder base class and derived subclasses should cooperate as follows:
+ * <orderedlist>
+ * <listitem>
+ *   <itemizedlist><title>Configuration</title>
+ *   <listitem><para>
+ *     Initially, GstVideoDecoder calls @start when the decoder element
+ *     is activated, which allows the subclass to perform any global setup.
+ *   </para></listitem>
+ *   <listitem><para>
+ *     GstVideoDecoder calls @set_format to inform the subclass of caps
+ *     describing input video data that it is about to receive, including
+ *     possibly configuration data.
+ *     While unlikely, it might be called more than once, if changing input
+ *     parameters require reconfiguration.
+ *   </para></listitem>
+ *   <listitem><para>
+ *     Incoming data buffers are processed as needed, described in Data Processing below.
+ *   </para></listitem>
+ *   <listitem><para>
+ *     GstVideoDecoder calls @stop at end of all processing.
+ *   </para></listitem>
+ *   </itemizedlist>
+ * </listitem>
+ * <listitem>
+ *   <itemizedlist>
+ *   <title>Data processing</title>
+ *     <listitem><para>
+ *       The base class gathers input data, and optionally allows subclass
+ *       to parse this into subsequently manageable chunks, typically
+ *       corresponding to and referred to as 'frames'.
+ *     </para></listitem>
+ *     <listitem><para>
+ *       Each input frame is provided in turn to the subclass' @handle_frame callback.
+ *       The ownership of the frame is given to the @handle_frame callback.
+ *     </para></listitem>
+ *     <listitem><para>
+ *       If codec processing results in decoded data, the subclass should call
+ *       @gst_video_decoder_finish_frame to have decoded data pushed.
+ *       downstream. Otherwise, the subclass must call @gst_video_decoder_drop_frame, to
+ *       allow the base class to do timestamp and offset tracking, and possibly to
+ *       requeue the frame for a later attempt in the case of reverse playback.
+ *     </para></listitem>
+ *   </itemizedlist>
+ * </listitem>
+ * <listitem>
+ *   <itemizedlist><title>Shutdown phase</title>
+ *   <listitem><para>
+ *     The GstVideoDecoder class calls @stop to inform the subclass that data
+ *     parsing will be stopped.
+ *   </para></listitem>
+ *   </itemizedlist>
+ * </listitem>
+ * <listitem>
+ *   <itemizedlist><title>Additional Notes</title>
+ *   <listitem>
+ *     <itemizedlist><title>Seeking/Flushing</title>
+ *     <listitem><para>
+ *   When the pipeline is seeked or otherwise flushed, the subclass is informed via a call
+ *   to its @reset callback, with the hard parameter set to true. This indicates the
+ *   subclass should drop any internal data queues and timestamps and prepare for a fresh
+ *   set of buffers to arrive for parsing and decoding.
+ *     </para></listitem>
+ *     </itemizedlist>
+ *   </listitem>
+ *   <listitem>
+ *     <itemizedlist><title>End Of Stream</title>
+ *     <listitem><para>
+ *   At end-of-stream, the subclass @parse function may be called some final times with the 
+ *   at_eos parameter set to true, indicating that the element should not expect any more data
+ *   to be arriving, and it should parse and remaining frames and call
+ *   gst_video_decoder_have_frame() if possible.
+ *     </para></listitem>
+ *     </itemizedlist>
+ *   </listitem>
+ *   </itemizedlist>
+ * </listitem>
+ * </orderedlist>
+ *
+ * Subclass is responsible for providing pad template caps for
+ * source and sink pads. The pads need to be named "sink" and "src". It also
+ * needs to set the fixed caps on srcpad, when the format is ensured.  This
+ * is typically when base class calls subclass' @set_format function, though
+ * it might be delayed until calling @gst_video_decoder_finish_frame.
+ *
+ * The subclass is also responsible for providing (presentation) timestamps
+ * (likely based on corresponding input ones).  If that is not applicable
+ * or possible, the base class provides limited framerate based interpolation.
+ *
+ * Similarly, the base class provides some limited (legacy) seeking support
+ * if specifically requested by the subclass, as full-fledged support
+ * should rather be left to upstream demuxer, parser or alike.  This simple
+ * approach caters for seeking and duration reporting using estimated input
+ * bitrates. To enable it, a subclass should call
+ * @gst_video_decoder_set_estimate_rate to enable handling of incoming byte-streams.
+ *
+ * The base class provides some support for reverse playback, in particular
+ * in case incoming data is not packetized or upstream does not provide
+ * fragments on keyframe boundaries.  However, the subclass should then be prepared
+ * for the parsing and frame processing stage to occur separately (in normal
+ * forward processing, the latter immediately follows the former),
+ * The subclass also needs to ensure the parsing stage properly marks keyframes,
+ * unless it knows the upstream elements will do so properly for incoming data.
+ *
+ * The bare minimum that a functional subclass needs to implement is:
+ * <itemizedlist>
+ *   <listitem><para>Provide pad templates</para></listitem>
+ *   <listitem><para>
+ *      Set source pad caps when appropriate
+ *   </para></listitem>
+ *   <listitem><para>
+ *      Parse input data, if it is not considered packetized from upstream
+ *      Data will be provided to @parse which should invoke @gst_video_decoder_add_to_frame and
+ *      @gst_video_decoder_have_frame to separate the data belonging to each video frame.
+ *   </para></listitem>
+ *   <listitem><para>
+ *      Accept data in @handle_frame and provide decoded results to
+ *      @gst_video_decoder_finish_frame, or call @gst_video_decoder_drop_frame.
+ *   </para></listitem>
+ * </itemizedlist>
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+/* TODO
+ *
+ * * Add a flag/boolean for I-frame-only/image decoders so we can do extra
+ *   features, like applying QoS on input (as opposed to after the frame is
+ *   decoded).
+ * * Add a flag/boolean for decoders that require keyframes, so the base
+ *   class can automatically discard non-keyframes before one has arrived
+ * * Support for GstIndex (or shall we not care ?)
+ * * Calculate actual latency based on input/output timestamp/frame_number
+ *   and if it exceeds the recorded one, save it and emit a GST_MESSAGE_LATENCY
+ * * Emit latency message when it changes
+ *
+ */
+
+/* Implementation notes:
+ * The Video Decoder base class operates in 2 primary processing modes, depending
+ * on whether forward or reverse playback is requested.
+ *
+ * Forward playback:
+ *   * Incoming buffer -> @parse() -> add_to_frame()/have_frame() -> handle_frame() -> 
+ *     push downstream
+ *
+ * Reverse playback is more complicated, since it involves gathering incoming data regions
+ * as we loop backwards through the upstream data. The processing concept (using incoming
+ * buffers as containing one frame each to simplify things) is:
+ *
+ * Upstream data we want to play:
+ *  Buffer encoded order:  1  2  3  4  5  6  7  8  9  EOS
+ *  Keyframe flag:            K        K        
+ *  Groupings:             AAAAAAA  BBBBBBB  CCCCCCC
+ *
+ * Input:
+ *  Buffer reception order:  7  8  9  4  5  6  1  2  3  EOS
+ *  Keyframe flag:                       K        K
+ *  Discont flag:            D        D        D
+ *
+ * - Each Discont marks a discont in the decoding order.
+ * - The keyframes mark where we can start decoding.
+ *
+ * Initially, we prepend incoming buffers to the gather queue. Whenever the
+ * discont flag is set on an incoming buffer, the gather queue is flushed out
+ * before the new buffer is collected.
+ *
+ * The above data will be accumulated in the gather queue like this:
+ *
+ *   gather queue:  9  8  7
+ *                        D
+ *
+ * Whe buffer 4 is received (with a DISCONT), we flush the gather queue like
+ * this:
+ *
+ *   while (gather)
+ *     take head of queue and prepend to parse queue (this reverses the sequence,
+ *     so parse queue is 7 -> 8 -> 9)
+ *
+ *   Next, we process the parse queue, which now contains all un-parsed packets (including
+ *   any leftover ones from the previous decode section)
+ *
+ *   for each buffer now in the parse queue:
+ *     Call the subclass parse function, prepending each resulting frame to
+ *     the parse_gather queue. Buffers which precede the first one that
+ *     produces a parsed frame are retained in the parse queue for re-processing on
+ *     the next cycle of parsing.
+ *
+ *   The parse_gather queue now contains frame objects ready for decoding, in reverse order.
+ *   parse_gather: 9 -> 8 -> 7
+ *
+ *   while (parse_gather)
+ *     Take the head of the queue and prepend it to the decode queue
+ *     If the frame was a keyframe, process the decode queue
+ *   decode is now 7-8-9
+ *
+ *  Processing the decode queue results in frames with attached output buffers
+ *  stored in the 'output_queue' ready for outputting in reverse order.
+ *
+ * After we flushed the gather queue and parsed it, we add 4 to the (now empty) gather queue.
+ * We get the following situation:
+ *
+ *  gather queue:    4
+ *  decode queue:    7  8  9
+ *
+ * After we received 5 (Keyframe) and 6:
+ *
+ *  gather queue:    6  5  4
+ *  decode queue:    7  8  9
+ *
+ * When we receive 1 (DISCONT) which triggers a flush of the gather queue:
+ *
+ *   Copy head of the gather queue (6) to decode queue:
+ *
+ *    gather queue:    5  4
+ *    decode queue:    6  7  8  9
+ *
+ *   Copy head of the gather queue (5) to decode queue. This is a keyframe so we
+ *   can start decoding.
+ *
+ *    gather queue:    4
+ *    decode queue:    5  6  7  8  9
+ *
+ *   Decode frames in decode queue, store raw decoded data in output queue, we
+ *   can take the head of the decode queue and prepend the decoded result in the
+ *   output queue:
+ *
+ *    gather queue:    4
+ *    decode queue:    
+ *    output queue:    9  8  7  6  5
+ *
+ *   Now output all the frames in the output queue, picking a frame from the
+ *   head of the queue.
+ *
+ *   Copy head of the gather queue (4) to decode queue, we flushed the gather
+ *   queue and can now store input buffer in the gather queue:
+ *
+ *    gather queue:    1
+ *    decode queue:    4
+ *
+ *  When we receive EOS, the queue looks like:
+ *
+ *    gather queue:    3  2  1
+ *    decode queue:    4
+ *
+ *  Fill decode queue, first keyframe we copy is 2:
+ *
+ *    gather queue:    1
+ *    decode queue:    2  3  4
+ *
+ *  Decoded output:
+ *
+ *    gather queue:    1
+ *    decode queue:    
+ *    output queue:    4  3  2
+ *
+ *  Leftover buffer 1 cannot be decoded and must be discarded.
+ */
+
+/* FIXME 0.11: suppress warnings for deprecated API such as GStaticRecMutex
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
+#include "gstvideodecoder.h"
+#include "gstvideoutils.h"
+
+#include <string.h>
+
+GST_DEBUG_CATEGORY (videodecoder_debug);
+#define GST_CAT_DEFAULT videodecoder_debug
+
+#define GST_VIDEO_DECODER_GET_PRIVATE(obj)  \
+    (G_TYPE_INSTANCE_GET_PRIVATE ((obj), GST_TYPE_VIDEO_DECODER, \
+        GstVideoDecoderPrivate))
+
+/* FIXME : I really hope we never see streams that go over this */
+#define MAX_DTS_PTS_REORDER_DEPTH 36
+
+struct _GstVideoDecoderPrivate
+{
+  /* FIXME introduce a context ? */
+
+  /* parse tracking */
+  /* input data */
+  GstAdapter *input_adapter;
+  /* assembles current frame */
+  GstAdapter *output_adapter;
+
+  /* Whether we attempt to convert newsegment from bytes to
+   * time using a bitrate estimation */
+  gboolean do_estimate_rate;
+
+  /* Whether input is considered packetized or not */
+  gboolean packetized;
+
+  /* Error handling */
+  gint max_errors;
+  gint error_count;
+
+  /* ... being tracked here;
+   * only available during parsing */
+  GstVideoCodecFrame *current_frame;
+  /* events that should apply to the current frame */
+  GList *current_frame_events;
+
+  /* relative offset of input data */
+  guint64 input_offset;
+  /* relative offset of frame */
+  guint64 frame_offset;
+  /* tracking ts and offsets */
+  GList *timestamps;
+
+  /* last incoming and outgoing ts */
+  GstClockTime last_timestamp_in;
+  GstClockTime last_timestamp_out;
+
+  /* last outgoing system frame number (used to detect reordering) */
+  guint last_out_frame_number;
+
+  /* TRUE if input timestamp is not monotonically increasing */
+  gboolean reordered_input;
+
+  /* TRUE if frames come out in a different order than they were inputted */
+  gboolean reordered_output;
+
+  /* reverse playback */
+  /* collect input */
+  GList *gather;
+  /* to-be-parsed */
+  GList *parse;
+  /* collected parsed frames */
+  GList *parse_gather;
+  /* frames to be handled == decoded */
+  GList *decode;
+  /* collected output - of buffer objects, not frames */
+  GList *output_queued;
+
+
+  /* base_picture_number is the picture number of the reference picture */
+  guint64 base_picture_number;
+  /* combine with base_picture_number, framerate and calcs to yield (presentation) ts */
+  GstClockTime base_timestamp;
+
+  /* FIXME : reorder_depth is never set */
+  int reorder_depth;
+  int distance_from_sync;
+
+  guint32 system_frame_number;
+  guint32 decode_frame_number;
+
+  GList *frames;                /* Protected with OBJECT_LOCK */
+  GstVideoCodecState *input_state;
+  GstVideoCodecState *output_state;     /* OBJECT_LOCK and STREAM_LOCK */
+  gboolean output_state_changed;
+
+  /* QoS properties */
+  gdouble proportion;           /* OBJECT_LOCK */
+  GstClockTime earliest_time;   /* OBJECT_LOCK */
+  GstClockTime qos_frame_duration;      /* OBJECT_LOCK */
+  gboolean discont;
+  /* qos messages: frames dropped/processed */
+  guint dropped;
+  guint processed;
+
+  /* Outgoing byte size ? */
+  gint64 bytes_out;
+  gint64 time;
+
+  gint64 min_latency;
+  gint64 max_latency;
+
+  /* Handle incoming buffers with DTS instead of PTS as timestamps */
+  GstClockTime incoming_timestamps[MAX_DTS_PTS_REORDER_DEPTH];
+  guint reorder_idx_in;
+  guint reorder_idx_out;
+};
+
+static void gst_video_decoder_finalize (GObject * object);
+
+static gboolean gst_video_decoder_sink_setcaps (GstPad * pad, GstCaps * caps);
+static gboolean gst_video_decoder_sink_event (GstPad * pad, GstEvent * event);
+static gboolean gst_video_decoder_src_event (GstPad * pad, GstEvent * event);
+static GstFlowReturn gst_video_decoder_chain (GstPad * pad, GstBuffer * buf);
+static gboolean gst_video_decoder_sink_query (GstPad * pad, GstQuery * query);
+static GstStateChangeReturn
+gst_video_decoder_change_state (GstElement * element,
+    GstStateChange transition);
+static const GstQueryType *gst_video_decoder_get_query_types (GstPad * pad);
+static gboolean gst_video_decoder_src_query (GstPad * pad, GstQuery * query);
+static void gst_video_decoder_reset (GstVideoDecoder * decoder, gboolean full);
+
+static GstFlowReturn gst_video_decoder_decode_frame (GstVideoDecoder * decoder,
+    GstVideoCodecFrame * frame);
+
+static void gst_video_decoder_release_frame (GstVideoDecoder * dec,
+    GstVideoCodecFrame * frame);
+static GstClockTime gst_video_decoder_get_frame_duration (GstVideoDecoder *
+    decoder, GstVideoCodecFrame * frame);
+static GstVideoCodecFrame *gst_video_decoder_new_frame (GstVideoDecoder *
+    decoder);
+static GstFlowReturn gst_video_decoder_clip_and_push_buf (GstVideoDecoder *
+    decoder, GstBuffer * buf);
+static GstFlowReturn gst_video_decoder_flush_parse (GstVideoDecoder * dec,
+    gboolean at_eos);
+
+static void gst_video_decoder_clear_queues (GstVideoDecoder * dec);
+
+static GstFlowReturn gst_video_decoder_parse_available (GstVideoDecoder * dec,
+    gboolean at_eos);
+
+GST_BOILERPLATE (GstVideoDecoder, gst_video_decoder,
+    GstElement, GST_TYPE_ELEMENT);
+
+static void
+gst_video_decoder_base_init (gpointer g_class)
+{
+  GST_DEBUG_CATEGORY_INIT (videodecoder_debug, "videodecoder", 0,
+      "Base Video Decoder");
+}
+
+static void
+gst_video_decoder_class_init (GstVideoDecoderClass * klass)
+{
+  GObjectClass *gobject_class;
+  GstElementClass *gstelement_class;
+
+  gobject_class = G_OBJECT_CLASS (klass);
+  gstelement_class = GST_ELEMENT_CLASS (klass);
+
+  g_type_class_add_private (klass, sizeof (GstVideoDecoderPrivate));
+
+  gobject_class->finalize = gst_video_decoder_finalize;
+
+  gstelement_class->change_state =
+      GST_DEBUG_FUNCPTR (gst_video_decoder_change_state);
+}
+
+static void
+gst_video_decoder_init (GstVideoDecoder * decoder, GstVideoDecoderClass * klass)
+{
+  GstPadTemplate *pad_template;
+  GstPad *pad;
+
+  GST_DEBUG_OBJECT (decoder, "gst_video_decoder_init");
+
+  decoder->priv = GST_VIDEO_DECODER_GET_PRIVATE (decoder);
+
+  pad_template =
+      gst_element_class_get_pad_template (GST_ELEMENT_CLASS (klass), "sink");
+  g_return_if_fail (pad_template != NULL);
+
+  decoder->sinkpad = pad = gst_pad_new_from_template (pad_template, "sink");
+
+  gst_pad_set_chain_function (pad, GST_DEBUG_FUNCPTR (gst_video_decoder_chain));
+  gst_pad_set_event_function (pad,
+      GST_DEBUG_FUNCPTR (gst_video_decoder_sink_event));
+  gst_pad_set_setcaps_function (pad,
+      GST_DEBUG_FUNCPTR (gst_video_decoder_sink_setcaps));
+  gst_pad_set_query_function (pad,
+      GST_DEBUG_FUNCPTR (gst_video_decoder_sink_query));
+  gst_element_add_pad (GST_ELEMENT (decoder), decoder->sinkpad);
+
+  pad_template =
+      gst_element_class_get_pad_template (GST_ELEMENT_CLASS (klass), "src");
+  g_return_if_fail (pad_template != NULL);
+
+  decoder->srcpad = pad = gst_pad_new_from_template (pad_template, "src");
+
+  gst_pad_set_event_function (pad,
+      GST_DEBUG_FUNCPTR (gst_video_decoder_src_event));
+  gst_pad_set_query_type_function (pad,
+      GST_DEBUG_FUNCPTR (gst_video_decoder_get_query_types));
+  gst_pad_set_query_function (pad,
+      GST_DEBUG_FUNCPTR (gst_video_decoder_src_query));
+  gst_pad_use_fixed_caps (pad);
+  gst_element_add_pad (GST_ELEMENT (decoder), decoder->srcpad);
+
+  gst_segment_init (&decoder->input_segment, GST_FORMAT_TIME);
+  gst_segment_init (&decoder->output_segment, GST_FORMAT_TIME);
+
+  g_static_rec_mutex_init (&decoder->stream_lock);
+
+  decoder->priv->input_adapter = gst_adapter_new ();
+  decoder->priv->output_adapter = gst_adapter_new ();
+  decoder->priv->packetized = TRUE;
+
+  gst_video_decoder_reset (decoder, TRUE);
+}
+
+static gboolean
+gst_video_rawvideo_convert (GstVideoCodecState * state,
+    GstFormat src_format, gint64 src_value,
+    GstFormat * dest_format, gint64 * dest_value)
+{
+  gboolean res = FALSE;
+  guint vidsize;
+  guint fps_n, fps_d;
+
+  g_return_val_if_fail (dest_format != NULL, FALSE);
+  g_return_val_if_fail (dest_value != NULL, FALSE);
+
+  if (src_format == *dest_format || src_value == 0 || src_value == -1) {
+    *dest_value = src_value;
+    return TRUE;
+  }
+
+  vidsize = GST_VIDEO_INFO_SIZE (&state->info);
+  fps_n = GST_VIDEO_INFO_FPS_N (&state->info);
+  fps_d = GST_VIDEO_INFO_FPS_D (&state->info);
+
+  if (src_format == GST_FORMAT_BYTES &&
+      *dest_format == GST_FORMAT_DEFAULT && vidsize) {
+    /* convert bytes to frames */
+    *dest_value = gst_util_uint64_scale_int (src_value, 1, vidsize);
+    res = TRUE;
+  } else if (src_format == GST_FORMAT_DEFAULT &&
+      *dest_format == GST_FORMAT_BYTES && vidsize) {
+    /* convert bytes to frames */
+    *dest_value = src_value * vidsize;
+    res = TRUE;
+  } else if (src_format == GST_FORMAT_DEFAULT &&
+      *dest_format == GST_FORMAT_TIME && fps_n) {
+    /* convert frames to time */
+    /* FIXME add segment time? */
+    *dest_value = gst_util_uint64_scale (src_value, GST_SECOND * fps_d, fps_n);
+    res = TRUE;
+  } else if (src_format == GST_FORMAT_TIME &&
+      *dest_format == GST_FORMAT_DEFAULT && fps_d) {
+    /* convert time to frames */
+    /* FIXME subtract segment time? */
+    *dest_value = gst_util_uint64_scale (src_value, fps_n, GST_SECOND * fps_d);
+    res = TRUE;
+  } else if (src_format == GST_FORMAT_TIME &&
+      *dest_format == GST_FORMAT_BYTES && fps_d && vidsize) {
+    /* convert time to frames */
+    /* FIXME subtract segment time? */
+    *dest_value = gst_util_uint64_scale (src_value,
+        fps_n * vidsize, GST_SECOND * fps_d);
+    res = TRUE;
+  } else if (src_format == GST_FORMAT_BYTES &&
+      *dest_format == GST_FORMAT_TIME && fps_n && vidsize) {
+    /* convert frames to time */
+    /* FIXME add segment time? */
+    *dest_value = gst_util_uint64_scale (src_value,
+        GST_SECOND * fps_d, fps_n * vidsize);
+    res = TRUE;
+  }
+
+  return res;
+}
+
+static gboolean
+gst_video_encoded_video_convert (gint64 bytes, gint64 time,
+    GstFormat src_format, gint64 src_value, GstFormat * dest_format,
+    gint64 * dest_value)
+{
+  gboolean res = FALSE;
+
+  g_return_val_if_fail (dest_format != NULL, FALSE);
+  g_return_val_if_fail (dest_value != NULL, FALSE);
+
+  if (G_UNLIKELY (src_format == *dest_format || src_value == 0 ||
+          src_value == -1)) {
+    if (dest_value)
+      *dest_value = src_value;
+    return TRUE;
+  }
+
+  if (bytes <= 0 || time <= 0) {
+    GST_DEBUG ("not enough metadata yet to convert");
+    goto exit;
+  }
+
+  switch (src_format) {
+    case GST_FORMAT_BYTES:
+      switch (*dest_format) {
+        case GST_FORMAT_TIME:
+          *dest_value = gst_util_uint64_scale (src_value, time, bytes);
+          res = TRUE;
+          break;
+        default:
+          res = FALSE;
+      }
+      break;
+    case GST_FORMAT_TIME:
+      switch (*dest_format) {
+        case GST_FORMAT_BYTES:
+          *dest_value = gst_util_uint64_scale (src_value, bytes, time);
+          res = TRUE;
+          break;
+        default:
+          res = FALSE;
+      }
+      break;
+    default:
+      GST_DEBUG ("unhandled conversion from %d to %d", src_format,
+          *dest_format);
+      res = FALSE;
+  }
+
+exit:
+  return res;
+}
+
+static GstVideoCodecState *
+_new_input_state (GstCaps * caps)
+{
+  GstVideoCodecState *state;
+  GstStructure *structure;
+  const GValue *codec_data;
+
+  state = g_slice_new0 (GstVideoCodecState);
+  state->ref_count = 1;
+  gst_video_info_init (&state->info);
+  if (G_UNLIKELY (!gst_video_info_from_caps (&state->info, caps)))
+    goto parse_fail;
+  state->caps = gst_caps_ref (caps);
+
+  structure = gst_caps_get_structure (caps, 0);
+
+  codec_data = gst_structure_get_value (structure, "codec_data");
+  if (codec_data && G_VALUE_TYPE (codec_data) == GST_TYPE_BUFFER)
+    state->codec_data = GST_BUFFER (gst_value_dup_mini_object (codec_data));
+
+  return state;
+
+parse_fail:
+  {
+    g_slice_free (GstVideoCodecState, state);
+    return NULL;
+  }
+}
+
+static GstVideoCodecState *
+_new_output_state (GstVideoFormat fmt, guint width, guint height,
+    GstVideoCodecState * reference)
+{
+  GstVideoCodecState *state;
+
+  state = g_slice_new0 (GstVideoCodecState);
+  state->ref_count = 1;
+  gst_video_info_init (&state->info);
+  gst_video_info_set_format (&state->info, fmt, width, height);
+
+  if (reference) {
+    GstVideoInfo *tgt, *ref;
+
+    tgt = &state->info;
+    ref = &reference->info;
+
+    /* Copy over extra fields from reference state */
+    tgt->interlace_mode = ref->interlace_mode;
+    tgt->flags = ref->flags;
+    tgt->chroma_site = ref->chroma_site;
+    tgt->colorimetry = ref->colorimetry;
+    GST_DEBUG ("reference par %d/%d fps %d/%d",
+        ref->par_n, ref->par_d, ref->fps_n, ref->fps_d);
+    tgt->par_n = ref->par_n;
+    tgt->par_d = ref->par_d;
+    tgt->fps_n = ref->fps_n;
+    tgt->fps_d = ref->fps_d;
+  }
+
+  GST_DEBUG ("reference par %d/%d fps %d/%d",
+      state->info.par_n, state->info.par_d,
+      state->info.fps_n, state->info.fps_d);
+
+  return state;
+}
+
+static gboolean
+gst_video_decoder_sink_setcaps (GstPad * pad, GstCaps * caps)
+{
+  GstVideoDecoder *decoder;
+  GstVideoDecoderClass *decoder_class;
+  GstVideoCodecState *state;
+  gboolean ret = TRUE;
+
+  decoder = GST_VIDEO_DECODER (gst_pad_get_parent (pad));
+  decoder_class = GST_VIDEO_DECODER_GET_CLASS (decoder);
+
+  GST_DEBUG_OBJECT (decoder, "setcaps %" GST_PTR_FORMAT, caps);
+
+  state = _new_input_state (caps);
+
+  if (G_UNLIKELY (state == NULL))
+    goto parse_fail;
+
+  GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+
+  if (decoder_class->set_format)
+    ret = decoder_class->set_format (decoder, state);
+
+  if (!ret)
+    goto refused_format;
+
+  if (decoder->priv->input_state)
+    gst_video_codec_state_unref (decoder->priv->input_state);
+  decoder->priv->input_state = state;
+
+  GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+  gst_object_unref (decoder);
+
+  return ret;
+
+  /* ERRORS */
+
+parse_fail:
+  {
+    GST_WARNING_OBJECT (decoder, "Failed to parse caps");
+    gst_object_unref (decoder);
+    return FALSE;
+  }
+
+refused_format:
+  {
+    GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+    GST_WARNING_OBJECT (decoder, "Subclass refused caps");
+    gst_video_codec_state_unref (state);
+    gst_object_unref (decoder);
+    return FALSE;
+  }
+}
+
+static void
+gst_video_decoder_finalize (GObject * object)
+{
+  GstVideoDecoder *decoder;
+
+  decoder = GST_VIDEO_DECODER (object);
+
+  GST_DEBUG_OBJECT (object, "finalize");
+
+  g_static_rec_mutex_free (&decoder->stream_lock);
+
+  if (decoder->priv->input_adapter) {
+    g_object_unref (decoder->priv->input_adapter);
+    decoder->priv->input_adapter = NULL;
+  }
+  if (decoder->priv->output_adapter) {
+    g_object_unref (decoder->priv->output_adapter);
+    decoder->priv->output_adapter = NULL;
+  }
+
+  if (decoder->priv->input_state)
+    gst_video_codec_state_unref (decoder->priv->input_state);
+  if (decoder->priv->output_state)
+    gst_video_codec_state_unref (decoder->priv->output_state);
+
+  G_OBJECT_CLASS (parent_class)->finalize (object);
+}
+
+/* hard == FLUSH, otherwise discont */
+static GstFlowReturn
+gst_video_decoder_flush (GstVideoDecoder * dec, gboolean hard)
+{
+  GstVideoDecoderClass *klass;
+  GstVideoDecoderPrivate *priv = dec->priv;
+  GstFlowReturn ret = GST_FLOW_OK;
+
+  klass = GST_VIDEO_DECODER_GET_CLASS (dec);
+
+  GST_LOG_OBJECT (dec, "flush hard %d", hard);
+
+  /* Inform subclass */
+  if (klass->reset)
+    klass->reset (dec, hard);
+
+  /* FIXME make some more distinction between hard and soft,
+   * but subclass may not be prepared for that */
+  /* FIXME perhaps also clear pending frames ?,
+   * but again, subclass may still come up with one of those */
+  if (!hard) {
+    /* TODO ? finish/drain some stuff */
+  } else {
+    gst_segment_init (&dec->input_segment, GST_FORMAT_UNDEFINED);
+    gst_segment_init (&dec->output_segment, GST_FORMAT_UNDEFINED);
+    gst_video_decoder_clear_queues (dec);
+    priv->error_count = 0;
+    g_list_foreach (priv->current_frame_events, (GFunc) gst_event_unref, NULL);
+    g_list_free (priv->current_frame_events);
+    priv->current_frame_events = NULL;
+  }
+  /* and get (re)set for the sequel */
+  gst_video_decoder_reset (dec, FALSE);
+
+  return ret;
+}
+
+static GstFlowReturn
+gst_video_decoder_parse_available (GstVideoDecoder * dec, gboolean at_eos)
+{
+  GstVideoDecoderClass *decoder_class = GST_VIDEO_DECODER_GET_CLASS (dec);
+  GstVideoDecoderPrivate *priv = dec->priv;
+  GstFlowReturn ret = GST_FLOW_OK;
+  gsize start_size, available;
+
+  available = gst_adapter_available (priv->input_adapter);
+  start_size = 0;
+
+  while (ret == GST_FLOW_OK && available && start_size != available) {
+    /* current frame may have been parsed and handled,
+     * so we need to set up a new one when asking subclass to parse */
+    if (priv->current_frame == NULL)
+      priv->current_frame = gst_video_decoder_new_frame (dec);
+
+    start_size = available;
+    ret = decoder_class->parse (dec, priv->current_frame,
+        priv->input_adapter, at_eos);
+    available = gst_adapter_available (priv->input_adapter);
+  }
+
+  return ret;
+}
+
+static GstFlowReturn
+gst_video_decoder_drain_out (GstVideoDecoder * dec, gboolean at_eos)
+{
+  GstVideoDecoderClass *decoder_class = GST_VIDEO_DECODER_GET_CLASS (dec);
+  GstVideoDecoderPrivate *priv = dec->priv;
+  GstFlowReturn ret = GST_FLOW_OK;
+
+  GST_VIDEO_DECODER_STREAM_LOCK (dec);
+
+  if (dec->input_segment.rate > 0.0) {
+    /* Forward mode, if unpacketized, give the child class
+     * a final chance to flush out packets */
+    if (!priv->packetized) {
+      ret = gst_video_decoder_parse_available (dec, TRUE);
+    }
+  } else {
+    /* Reverse playback mode */
+    ret = gst_video_decoder_flush_parse (dec, TRUE);
+  }
+
+  if (at_eos) {
+    if (decoder_class->finish)
+      ret = decoder_class->finish (dec);
+  }
+
+  GST_VIDEO_DECODER_STREAM_UNLOCK (dec);
+
+  return ret;
+}
+
+static gboolean
+gst_video_decoder_sink_eventfunc (GstVideoDecoder * decoder, GstEvent * event)
+{
+  GstVideoDecoderPrivate *priv;
+  gboolean handled = FALSE;
+
+  priv = decoder->priv;
+
+  switch (GST_EVENT_TYPE (event)) {
+    case GST_EVENT_EOS:
+    {
+      GstFlowReturn flow_ret = GST_FLOW_OK;
+
+      flow_ret = gst_video_decoder_drain_out (decoder, TRUE);
+      handled = (flow_ret == GST_VIDEO_DECODER_FLOW_DROPPED);
+
+      break;
+    }
+    case GST_EVENT_NEWSEGMENT:
+    {
+      gboolean update;
+      double rate, arate;
+      GstFormat format;
+      gint64 start;
+      gint64 stop;
+      gint64 pos;
+      GstSegment *segment = &decoder->input_segment;
+
+      GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+      gst_event_parse_new_segment_full (event, &update, &rate,
+          &arate, &format, &start, &stop, &pos);
+
+      if (format == GST_FORMAT_TIME) {
+        GST_DEBUG_OBJECT (decoder,
+            "received TIME NEW_SEGMENT %" GST_TIME_FORMAT
+            " -- %" GST_TIME_FORMAT ", pos %" GST_TIME_FORMAT
+            ", rate %g, applied_rate %g",
+            GST_TIME_ARGS (start), GST_TIME_ARGS (stop), GST_TIME_ARGS (pos),
+            rate, arate);
+      } else {
+        GstFormat dformat = GST_FORMAT_TIME;
+
+        GST_DEBUG_OBJECT (decoder,
+            "received NEW_SEGMENT %" G_GINT64_FORMAT
+            " -- %" G_GINT64_FORMAT ", time %" G_GINT64_FORMAT
+            ", rate %g, applied_rate %g", start, stop, pos, rate, arate);
+
+        /* handle newsegment as a result from our legacy simple seeking */
+        /* note that initial 0 should convert to 0 in any case */
+        if (priv->do_estimate_rate &&
+            gst_pad_query_convert (decoder->sinkpad, GST_FORMAT_BYTES, start,
+                &dformat, &start)) {
+          /* best attempt convert */
+          /* as these are only estimates, stop is kept open-ended to avoid
+           * premature cutting */
+          GST_DEBUG_OBJECT (decoder,
+              "converted to TIME start %" GST_TIME_FORMAT,
+              GST_TIME_ARGS (start));
+          pos = start;
+          stop = GST_CLOCK_TIME_NONE;
+          /* replace event */
+          gst_event_unref (event);
+          event = gst_event_new_new_segment_full (update, rate, arate,
+              GST_FORMAT_TIME, start, stop, pos);
+        } else {
+          GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+          goto newseg_wrong_format;
+        }
+      }
+
+      if (!update) {
+        gst_video_decoder_flush (decoder, FALSE);
+      }
+
+      priv->base_timestamp = GST_CLOCK_TIME_NONE;
+      priv->base_picture_number = 0;
+
+      gst_segment_set_newsegment_full (segment,
+          update, rate, arate, format, start, stop, pos);
+
+      GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+      break;
+    }
+    case GST_EVENT_FLUSH_STOP:
+    {
+      GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+      /* well, this is kind of worse than a DISCONT */
+      gst_video_decoder_flush (decoder, TRUE);
+      GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+      break;
+    }
+    default:
+      break;
+  }
+
+  return handled;
+
+newseg_wrong_format:
+  {
+    GST_DEBUG_OBJECT (decoder, "received non TIME newsegment");
+    gst_event_unref (event);
+    /* SWALLOW EVENT */
+    /* FIXME : Ideally we'd like to return FALSE in the event handler */
+    return TRUE;
+  }
+}
+
+static gboolean
+gst_video_decoder_push_event (GstVideoDecoder * decoder, GstEvent * event)
+{
+  switch (GST_EVENT_TYPE (event)) {
+    case GST_EVENT_NEWSEGMENT:
+    {
+      gboolean update;
+      double rate;
+      double applied_rate;
+      GstFormat format;
+      gint64 start;
+      gint64 stop;
+      gint64 position;
+
+      GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+      gst_event_parse_new_segment_full (event, &update, &rate, &applied_rate,
+          &format, &start, &stop, &position);
+
+      GST_DEBUG_OBJECT (decoder, "newseg rate %g, applied rate %g, "
+          "format %d, start = %" GST_TIME_FORMAT ", stop = %" GST_TIME_FORMAT
+          ", pos = %" GST_TIME_FORMAT, rate, applied_rate, format,
+          GST_TIME_ARGS (start), GST_TIME_ARGS (stop),
+          GST_TIME_ARGS (position));
+
+      if (format != GST_FORMAT_TIME) {
+        GST_DEBUG_OBJECT (decoder, "received non TIME newsegment");
+        GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+        break;
+      }
+
+      gst_segment_set_newsegment_full (&decoder->output_segment, update, rate,
+          applied_rate, format, start, stop, position);
+      GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+      break;
+    }
+    default:
+      break;
+  }
+
+  return gst_pad_push_event (decoder->srcpad, event);
+}
+
+static gboolean
+gst_video_decoder_sink_event (GstPad * pad, GstEvent * event)
+{
+  GstVideoDecoder *decoder;
+  GstVideoDecoderClass *decoder_class;
+  gboolean ret = FALSE;
+  gboolean handled = FALSE;
+
+  decoder = GST_VIDEO_DECODER (gst_pad_get_parent (pad));
+  decoder_class = GST_VIDEO_DECODER_GET_CLASS (decoder);
+
+  GST_DEBUG_OBJECT (decoder, "received event %d, %s", GST_EVENT_TYPE (event),
+      GST_EVENT_TYPE_NAME (event));
+
+  if (decoder_class->sink_event)
+    handled = decoder_class->sink_event (decoder, event);
+
+  if (!handled)
+    handled = gst_video_decoder_sink_eventfunc (decoder, event);
+
+  if (!handled) {
+    /* Forward non-serialized events and EOS/FLUSH_STOP immediately.
+     * For EOS this is required because no buffer or serialized event
+     * will come after EOS and nothing could trigger another
+     * _finish_frame() call.   *
+     * If the subclass handles sending of EOS manually it can return
+     * _DROPPED from ::finish() and all other subclasses should have
+     * decoded/flushed all remaining data before this
+     *
+     * For FLUSH_STOP this is required because it is expected
+     * to be forwarded immediately and no buffers are queued anyway.
+     */
+    if (!GST_EVENT_IS_SERIALIZED (event)
+        || GST_EVENT_TYPE (event) == GST_EVENT_EOS
+        || GST_EVENT_TYPE (event) == GST_EVENT_FLUSH_STOP) {
+      ret = gst_video_decoder_push_event (decoder, event);
+    } else {
+      GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+      decoder->priv->current_frame_events =
+          g_list_prepend (decoder->priv->current_frame_events, event);
+      GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+      ret = TRUE;
+    }
+  }
+
+  gst_object_unref (decoder);
+  return ret;
+
+}
+
+/* perform upstream byte <-> time conversion (duration, seeking)
+ * if subclass allows and if enough data for moderately decent conversion */
+static inline gboolean
+gst_video_decoder_do_byte (GstVideoDecoder * dec)
+{
+  return dec->priv->do_estimate_rate && (dec->priv->bytes_out > 0)
+      && (dec->priv->time > GST_SECOND);
+}
+
+static gboolean
+gst_video_decoder_do_seek (GstVideoDecoder * dec, GstEvent * event)
+{
+  GstFormat format;
+  GstSeekFlags flags;
+  GstSeekType start_type, end_type;
+  gdouble rate;
+  gint64 start, start_time, end_time;
+  GstSegment seek_segment;
+  guint32 seqnum;
+
+  gst_event_parse_seek (event, &rate, &format, &flags, &start_type,
+      &start_time, &end_type, &end_time);
+
+  /* we'll handle plain open-ended flushing seeks with the simple approach */
+  if (rate != 1.0) {
+    GST_DEBUG_OBJECT (dec, "unsupported seek: rate");
+    return FALSE;
+  }
+
+  if (start_type != GST_SEEK_TYPE_SET) {
+    GST_DEBUG_OBJECT (dec, "unsupported seek: start time");
+    return FALSE;
+  }
+
+  if (end_type != GST_SEEK_TYPE_NONE ||
+      (end_type == GST_SEEK_TYPE_SET && end_time != GST_CLOCK_TIME_NONE)) {
+    GST_DEBUG_OBJECT (dec, "unsupported seek: end time");
+    return FALSE;
+  }
+
+  if (!(flags & GST_SEEK_FLAG_FLUSH)) {
+    GST_DEBUG_OBJECT (dec, "unsupported seek: not flushing");
+    return FALSE;
+  }
+
+  memcpy (&seek_segment, &dec->output_segment, sizeof (seek_segment));
+  gst_segment_set_seek (&seek_segment, rate, format, flags, start_type,
+      start_time, end_type, end_time, NULL);
+  start_time = seek_segment.last_stop;
+
+  format = GST_FORMAT_BYTES;
+  if (!gst_pad_query_convert (dec->sinkpad, GST_FORMAT_TIME, start_time,
+          &format, &start)) {
+    GST_DEBUG_OBJECT (dec, "conversion failed");
+    return FALSE;
+  }
+
+  seqnum = gst_event_get_seqnum (event);
+  event = gst_event_new_seek (1.0, GST_FORMAT_BYTES, flags,
+      GST_SEEK_TYPE_SET, start, GST_SEEK_TYPE_NONE, -1);
+  gst_event_set_seqnum (event, seqnum);
+
+  GST_DEBUG_OBJECT (dec, "seeking to %" GST_TIME_FORMAT " at byte offset %"
+      G_GINT64_FORMAT, GST_TIME_ARGS (start_time), start);
+
+  return gst_pad_push_event (dec->sinkpad, event);
+}
+
+static gboolean
+gst_video_decoder_src_eventfunc (GstVideoDecoder * decoder, GstEvent * event)
+{
+  GstVideoDecoderPrivate *priv;
+  gboolean res = FALSE;
+
+  priv = decoder->priv;
+
+  GST_DEBUG_OBJECT (decoder,
+      "received event %d, %s", GST_EVENT_TYPE (event),
+      GST_EVENT_TYPE_NAME (event));
+
+  switch (GST_EVENT_TYPE (event)) {
+    case GST_EVENT_SEEK:
+    {
+      GstFormat format, tformat;
+      gdouble rate;
+      GstSeekFlags flags;
+      GstSeekType cur_type, stop_type;
+      gint64 cur, stop;
+      gint64 tcur, tstop;
+      guint32 seqnum;
+
+      gst_event_parse_seek (event, &rate, &format, &flags, &cur_type, &cur,
+          &stop_type, &stop);
+      seqnum = gst_event_get_seqnum (event);
+
+      /* upstream gets a chance first */
+      if ((res = gst_pad_push_event (decoder->sinkpad, event)))
+        break;
+
+      /* if upstream fails for a time seek, maybe we can help if allowed */
+      if (format == GST_FORMAT_TIME) {
+        if (gst_video_decoder_do_byte (decoder))
+          res = gst_video_decoder_do_seek (decoder, event);
+        break;
+      }
+
+      /* ... though a non-time seek can be aided as well */
+      /* First bring the requested format to time */
+      tformat = GST_FORMAT_TIME;
+      if (!(res =
+              gst_pad_query_convert (decoder->srcpad, format, cur, &tformat,
+                  &tcur)))
+        goto convert_error;
+      if (!(res =
+              gst_pad_query_convert (decoder->srcpad, format, stop, &tformat,
+                  &tstop)))
+        goto convert_error;
+
+      /* then seek with time on the peer */
+      event = gst_event_new_seek (rate, GST_FORMAT_TIME,
+          flags, cur_type, tcur, stop_type, tstop);
+      gst_event_set_seqnum (event, seqnum);
+
+      res = gst_pad_push_event (decoder->sinkpad, event);
+      break;
+    }
+    case GST_EVENT_QOS:
+    {
+      gdouble proportion;
+      GstClockTimeDiff diff;
+      GstClockTime timestamp;
+
+      gst_event_parse_qos (event, &proportion, &diff, &timestamp);
+
+      GST_OBJECT_LOCK (decoder);
+      priv->proportion = proportion;
+      if (G_LIKELY (GST_CLOCK_TIME_IS_VALID (timestamp))) {
+        if (G_UNLIKELY (diff > 0)) {
+          priv->earliest_time = timestamp + 2 * diff + priv->qos_frame_duration;
+        } else {
+          priv->earliest_time = timestamp + diff;
+        }
+      } else {
+        priv->earliest_time = GST_CLOCK_TIME_NONE;
+      }
+      GST_OBJECT_UNLOCK (decoder);
+
+      GST_DEBUG_OBJECT (decoder,
+          "got QoS %" GST_TIME_FORMAT ", %" G_GINT64_FORMAT ", %g",
+          GST_TIME_ARGS (timestamp), diff, proportion);
+
+      res = gst_pad_push_event (decoder->sinkpad, event);
+      break;
+    }
+    default:
+      res = gst_pad_push_event (decoder->sinkpad, event);
+      break;
+  }
+done:
+  return res;
+
+convert_error:
+  GST_DEBUG_OBJECT (decoder, "could not convert format");
+  goto done;
+}
+
+static gboolean
+gst_video_decoder_src_event (GstPad * pad, GstEvent * event)
+{
+  GstVideoDecoder *decoder;
+  GstVideoDecoderClass *decoder_class;
+  gboolean ret = TRUE;
+  gboolean handled = FALSE;
+
+  decoder = GST_VIDEO_DECODER (gst_pad_get_parent (pad));
+  decoder_class = GST_VIDEO_DECODER_GET_CLASS (decoder);
+
+  GST_DEBUG_OBJECT (decoder, "received event %d, %s", GST_EVENT_TYPE (event),
+      GST_EVENT_TYPE_NAME (event));
+
+  if (decoder_class->src_event)
+    handled = decoder_class->src_event (decoder, event);
+
+  if (!handled)
+    handled = gst_video_decoder_src_eventfunc (decoder, event);
+
+  gst_object_unref (decoder);
+
+  return ret;
+}
+
+static const GstQueryType *
+gst_video_decoder_get_query_types (GstPad * pad)
+{
+  static const GstQueryType query_types[] = {
+    GST_QUERY_POSITION,
+    GST_QUERY_DURATION,
+    GST_QUERY_CONVERT,
+    GST_QUERY_LATENCY,
+    0
+  };
+
+  return query_types;
+}
+
+static gboolean
+gst_video_decoder_src_query (GstPad * pad, GstQuery * query)
+{
+  GstVideoDecoder *dec;
+  gboolean res = TRUE;
+
+  dec = GST_VIDEO_DECODER (gst_pad_get_parent (pad));
+
+  GST_LOG_OBJECT (dec, "handling query: %" GST_PTR_FORMAT, query);
+
+  switch (GST_QUERY_TYPE (query)) {
+    case GST_QUERY_POSITION:
+    {
+      GstFormat format;
+      gint64 time, value;
+
+      /* upstream gets a chance first */
+      if ((res = gst_pad_peer_query (dec->sinkpad, query))) {
+        GST_LOG_OBJECT (dec, "returning peer response");
+        break;
+      }
+
+      /* we start from the last seen time */
+      time = dec->priv->last_timestamp_out;
+      /* correct for the segment values */
+      time = gst_segment_to_stream_time (&dec->output_segment,
+          GST_FORMAT_TIME, time);
+
+      GST_LOG_OBJECT (dec,
+          "query %p: our time: %" GST_TIME_FORMAT, query, GST_TIME_ARGS (time));
+
+      /* and convert to the final format */
+      gst_query_parse_position (query, &format, NULL);
+      if (!(res = gst_pad_query_convert (pad, GST_FORMAT_TIME, time,
+                  &format, &value)))
+        break;
+
+      gst_query_set_position (query, format, value);
+
+      GST_LOG_OBJECT (dec,
+          "query %p: we return %" G_GINT64_FORMAT " (format %u)", query, value,
+          format);
+      break;
+    }
+    case GST_QUERY_DURATION:
+    {
+      GstFormat format;
+
+      /* upstream in any case */
+      if ((res = gst_pad_query_default (pad, query)))
+        break;
+
+      gst_query_parse_duration (query, &format, NULL);
+      /* try answering TIME by converting from BYTE if subclass allows  */
+      if (format == GST_FORMAT_TIME && gst_video_decoder_do_byte (dec)) {
+        gint64 value;
+
+        format = GST_FORMAT_BYTES;
+        if (gst_pad_query_peer_duration (dec->sinkpad, &format, &value)) {
+          GST_LOG_OBJECT (dec, "upstream size %" G_GINT64_FORMAT, value);
+          format = GST_FORMAT_TIME;
+          if (gst_pad_query_convert (dec->sinkpad,
+                  GST_FORMAT_BYTES, value, &format, &value)) {
+            gst_query_set_duration (query, GST_FORMAT_TIME, value);
+            res = TRUE;
+          }
+        }
+      }
+      break;
+    }
+    case GST_QUERY_CONVERT:
+    {
+      GstFormat src_fmt, dest_fmt;
+      gint64 src_val, dest_val;
+
+      GST_DEBUG_OBJECT (dec, "convert query");
+
+      gst_query_parse_convert (query, &src_fmt, &src_val, &dest_fmt, &dest_val);
+      GST_OBJECT_LOCK (dec);
+      if (dec->priv->output_state != NULL)
+        res = gst_video_rawvideo_convert (dec->priv->output_state,
+            src_fmt, src_val, &dest_fmt, &dest_val);
+      else
+        res = FALSE;
+      GST_OBJECT_UNLOCK (dec);
+      if (!res)
+        goto error;
+      gst_query_set_convert (query, src_fmt, src_val, dest_fmt, dest_val);
+      break;
+    }
+    case GST_QUERY_LATENCY:
+    {
+      gboolean live;
+      GstClockTime min_latency, max_latency;
+
+      res = gst_pad_peer_query (dec->sinkpad, query);
+      if (res) {
+        gst_query_parse_latency (query, &live, &min_latency, &max_latency);
+        GST_DEBUG_OBJECT (dec, "Peer qlatency: live %d, min %"
+            GST_TIME_FORMAT " max %" GST_TIME_FORMAT, live,
+            GST_TIME_ARGS (min_latency), GST_TIME_ARGS (max_latency));
+
+        GST_OBJECT_LOCK (dec);
+        min_latency += dec->priv->min_latency;
+        if (dec->priv->max_latency == GST_CLOCK_TIME_NONE) {
+          max_latency = GST_CLOCK_TIME_NONE;
+        } else if (max_latency != GST_CLOCK_TIME_NONE) {
+          max_latency += dec->priv->max_latency;
+        }
+        GST_OBJECT_UNLOCK (dec);
+
+        gst_query_set_latency (query, live, min_latency, max_latency);
+      }
+    }
+      break;
+    default:
+      res = gst_pad_query_default (pad, query);
+  }
+  gst_object_unref (dec);
+  return res;
+
+error:
+  GST_ERROR_OBJECT (dec, "query failed");
+  gst_object_unref (dec);
+  return res;
+}
+
+static gboolean
+gst_video_decoder_sink_query (GstPad * pad, GstQuery * query)
+{
+  GstVideoDecoder *decoder;
+  GstVideoDecoderPrivate *priv;
+  gboolean res = FALSE;
+
+  decoder = GST_VIDEO_DECODER (gst_pad_get_parent (pad));
+  priv = decoder->priv;
+
+  GST_LOG_OBJECT (decoder, "handling query: %" GST_PTR_FORMAT, query);
+
+  switch (GST_QUERY_TYPE (query)) {
+    case GST_QUERY_CONVERT:
+    {
+      GstFormat src_fmt, dest_fmt;
+      gint64 src_val, dest_val;
+
+      gst_query_parse_convert (query, &src_fmt, &src_val, &dest_fmt, &dest_val);
+      res =
+          gst_video_encoded_video_convert (priv->bytes_out, priv->time, src_fmt,
+          src_val, &dest_fmt, &dest_val);
+      if (!res)
+        goto error;
+      gst_query_set_convert (query, src_fmt, src_val, dest_fmt, dest_val);
+      break;
+    }
+    default:
+      res = gst_pad_query_default (pad, query);
+      break;
+  }
+done:
+  gst_object_unref (decoder);
+
+  return res;
+error:
+  GST_DEBUG_OBJECT (decoder, "query failed");
+  goto done;
+}
+
+typedef struct _Timestamp Timestamp;
+struct _Timestamp
+{
+  guint64 offset;
+  GstClockTime timestamp;
+  GstClockTime duration;
+};
+
+static void
+timestamp_free (Timestamp * ts)
+{
+  g_slice_free (Timestamp, ts);
+}
+
+static void
+gst_video_decoder_add_timestamp (GstVideoDecoder * decoder, GstBuffer * buffer)
+{
+  GstVideoDecoderPrivate *priv = decoder->priv;
+  Timestamp *ts;
+
+  ts = g_slice_new (Timestamp);
+
+  GST_LOG_OBJECT (decoder,
+      "adding timestamp %" GST_TIME_FORMAT " (offset:%" G_GUINT64_FORMAT ")",
+      GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (buffer)), priv->input_offset);
+
+  ts->offset = priv->input_offset;
+  ts->timestamp = GST_BUFFER_TIMESTAMP (buffer);
+  ts->duration = GST_BUFFER_DURATION (buffer);
+
+  priv->timestamps = g_list_append (priv->timestamps, ts);
+}
+
+static void
+gst_video_decoder_get_timestamp_at_offset (GstVideoDecoder *
+    decoder, guint64 offset, GstClockTime * timestamp, GstClockTime * duration)
+{
+#ifndef GST_DISABLE_GST_DEBUG
+  guint64 got_offset = 0;
+#endif
+  Timestamp *ts;
+  GList *g;
+
+  *timestamp = GST_CLOCK_TIME_NONE;
+  *duration = GST_CLOCK_TIME_NONE;
+
+  g = decoder->priv->timestamps;
+  while (g) {
+    ts = g->data;
+    if (ts->offset <= offset) {
+#ifndef GST_DISABLE_GST_DEBUG
+      got_offset = ts->offset;
+#endif
+      *timestamp = ts->timestamp;
+      *duration = ts->duration;
+      timestamp_free (ts);
+      g = g->next;
+      decoder->priv->timestamps = g_list_remove (decoder->priv->timestamps, ts);
+    } else {
+      break;
+    }
+  }
+
+  GST_LOG_OBJECT (decoder,
+      "got timestamp %" GST_TIME_FORMAT " @ offs %" G_GUINT64_FORMAT
+      " (wanted offset:%" G_GUINT64_FORMAT ")", GST_TIME_ARGS (*timestamp),
+      got_offset, offset);
+}
+
+static void
+gst_video_decoder_clear_queues (GstVideoDecoder * dec)
+{
+  GstVideoDecoderPrivate *priv = dec->priv;
+
+  g_list_foreach (priv->output_queued, (GFunc) gst_mini_object_unref, NULL);
+  g_list_free (priv->output_queued);
+  priv->output_queued = NULL;
+
+  g_list_foreach (priv->gather, (GFunc) gst_mini_object_unref, NULL);
+  g_list_free (priv->gather);
+  priv->gather = NULL;
+  g_list_foreach (priv->decode, (GFunc) gst_video_codec_frame_unref, NULL);
+  g_list_free (priv->decode);
+  priv->decode = NULL;
+  g_list_foreach (priv->parse, (GFunc) gst_mini_object_unref, NULL);
+  g_list_free (priv->parse);
+  priv->parse = NULL;
+  g_list_foreach (priv->parse_gather, (GFunc) gst_video_codec_frame_unref,
+      NULL);
+  g_list_free (priv->parse_gather);
+  priv->parse_gather = NULL;
+  g_list_foreach (priv->frames, (GFunc) gst_video_codec_frame_unref, NULL);
+  g_list_free (priv->frames);
+  priv->frames = NULL;
+}
+
+static void
+gst_video_decoder_reset (GstVideoDecoder * decoder, gboolean full)
+{
+  GstVideoDecoderPrivate *priv = decoder->priv;
+
+  GST_DEBUG_OBJECT (decoder, "reset full %d", full);
+
+  GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+
+  if (full) {
+    gst_segment_init (&decoder->input_segment, GST_FORMAT_UNDEFINED);
+    gst_segment_init (&decoder->output_segment, GST_FORMAT_UNDEFINED);
+    gst_video_decoder_clear_queues (decoder);
+    priv->error_count = 0;
+    priv->max_errors = GST_VIDEO_DECODER_MAX_ERRORS;
+    if (priv->input_state)
+      gst_video_codec_state_unref (priv->input_state);
+    priv->input_state = NULL;
+    GST_OBJECT_LOCK (decoder);
+    if (priv->output_state)
+      gst_video_codec_state_unref (priv->output_state);
+    priv->output_state = NULL;
+
+    priv->qos_frame_duration = 0;
+    GST_OBJECT_UNLOCK (decoder);
+
+    priv->min_latency = 0;
+    priv->max_latency = 0;
+  }
+
+  priv->discont = TRUE;
+
+  priv->base_timestamp = GST_CLOCK_TIME_NONE;
+  priv->last_timestamp_in = GST_CLOCK_TIME_NONE;
+  priv->last_timestamp_out = GST_CLOCK_TIME_NONE;
+  priv->last_out_frame_number = (guint) (-1);
+  priv->reordered_output = FALSE;
+  priv->reordered_input = FALSE;
+
+  priv->input_offset = 0;
+  priv->frame_offset = 0;
+  gst_adapter_clear (priv->input_adapter);
+  gst_adapter_clear (priv->output_adapter);
+  g_list_foreach (priv->timestamps, (GFunc) timestamp_free, NULL);
+  g_list_free (priv->timestamps);
+  priv->timestamps = NULL;
+
+  if (priv->current_frame) {
+    gst_video_codec_frame_unref (priv->current_frame);
+    priv->current_frame = NULL;
+  }
+
+  priv->dropped = 0;
+  priv->processed = 0;
+
+  priv->decode_frame_number = 0;
+  priv->base_picture_number = 0;
+
+  g_list_foreach (priv->frames, (GFunc) gst_video_codec_frame_unref, NULL);
+  g_list_free (priv->frames);
+  priv->frames = NULL;
+
+  priv->bytes_out = 0;
+  priv->time = 0;
+
+  GST_OBJECT_LOCK (decoder);
+  priv->earliest_time = GST_CLOCK_TIME_NONE;
+  priv->proportion = 0.5;
+  GST_OBJECT_UNLOCK (decoder);
+
+  priv->reorder_idx_out = priv->reorder_idx_in = 0;
+
+  GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+}
+
+static GstFlowReturn
+gst_video_decoder_chain_forward (GstVideoDecoder * decoder,
+    GstBuffer * buf, gboolean at_eos)
+{
+  GstVideoDecoderPrivate *priv;
+  GstVideoDecoderClass *klass;
+  GstFlowReturn ret = GST_FLOW_OK;
+
+  klass = GST_VIDEO_DECODER_GET_CLASS (decoder);
+  priv = decoder->priv;
+
+  g_return_val_if_fail (priv->packetized || klass->parse, GST_FLOW_ERROR);
+
+  if (priv->current_frame == NULL)
+    priv->current_frame = gst_video_decoder_new_frame (decoder);
+
+  if (GST_BUFFER_TIMESTAMP_IS_VALID (buf) && !priv->packetized) {
+    gst_video_decoder_add_timestamp (decoder, buf);
+  }
+  priv->input_offset += GST_BUFFER_SIZE (buf);
+
+  if (priv->packetized) {
+    if (!GST_BUFFER_FLAG_IS_SET (buf, GST_BUFFER_FLAG_DELTA_UNIT)) {
+      GST_VIDEO_CODEC_FRAME_SET_SYNC_POINT (priv->current_frame);
+    }
+
+    priv->current_frame->input_buffer = buf;
+
+    if (decoder->input_segment.rate < 0.0) {
+      priv->parse_gather =
+          g_list_prepend (priv->parse_gather, priv->current_frame);
+    } else {
+      ret = gst_video_decoder_decode_frame (decoder, priv->current_frame);
+    }
+    priv->current_frame = NULL;
+  } else {
+    gst_adapter_push (priv->input_adapter, buf);
+
+    ret = gst_video_decoder_parse_available (decoder, at_eos);
+  }
+
+  if (ret == GST_VIDEO_DECODER_FLOW_NEED_DATA)
+    return GST_FLOW_OK;
+
+  return ret;
+}
+
+static GstFlowReturn
+gst_video_decoder_flush_decode (GstVideoDecoder * dec)
+{
+  GstVideoDecoderPrivate *priv = dec->priv;
+  GstFlowReturn res = GST_FLOW_OK;
+  GList *walk;
+
+  GST_DEBUG_OBJECT (dec, "flushing buffers to decode");
+
+  /* clear buffer and decoder state */
+  gst_video_decoder_flush (dec, FALSE);
+
+  walk = priv->decode;
+  while (walk) {
+    GList *next;
+    GstVideoCodecFrame *frame = (GstVideoCodecFrame *) (walk->data);
+
+    GST_DEBUG_OBJECT (dec, "decoding frame %p buffer %p, ts %" GST_TIME_FORMAT,
+        frame, frame->input_buffer,
+        GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (frame->input_buffer)));
+
+    next = walk->next;
+
+    priv->decode = g_list_delete_link (priv->decode, walk);
+
+    /* decode buffer, resulting data prepended to queue */
+    res = gst_video_decoder_decode_frame (dec, frame);
+    if (res != GST_FLOW_OK)
+      break;
+
+    walk = next;
+  }
+
+  return res;
+}
+
+/* gst_video_decoder_flush_parse is called from the
+ * chain_reverse() function when a buffer containing
+ * a DISCONT - indicating that reverse playback
+ * looped back to the next data block, and therefore
+ * all available data should be fed through the
+ * decoder and frames gathered for reversed output
+ */
+static GstFlowReturn
+gst_video_decoder_flush_parse (GstVideoDecoder * dec, gboolean at_eos)
+{
+  GstVideoDecoderPrivate *priv = dec->priv;
+  GstFlowReturn res = GST_FLOW_OK;
+  GList *walk;
+
+  GST_DEBUG_OBJECT (dec, "flushing buffers to parsing");
+
+  /* Reverse the gather list, and prepend it to the parse list,
+   * then flush to parse whatever we can */
+  priv->gather = g_list_reverse (priv->gather);
+  priv->parse = g_list_concat (priv->gather, priv->parse);
+  priv->gather = NULL;
+
+  /* clear buffer and decoder state */
+  gst_video_decoder_flush (dec, FALSE);
+
+  walk = priv->parse;
+  while (walk) {
+    GstBuffer *buf = GST_BUFFER_CAST (walk->data);
+    GList *next = walk->next;
+
+    GST_DEBUG_OBJECT (dec, "parsing buffer %p, ts %" GST_TIME_FORMAT,
+        buf, GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (buf)));
+
+    /* parse buffer, resulting frames prepended to parse_gather queue */
+    gst_buffer_ref (buf);
+    res = gst_video_decoder_chain_forward (dec, buf, at_eos);
+
+    /* if we generated output, we can discard the buffer, else we
+     * keep it in the queue */
+    if (priv->parse_gather) {
+      GST_DEBUG_OBJECT (dec, "parsed buffer to %p", priv->parse_gather->data);
+      priv->parse = g_list_delete_link (priv->parse, walk);
+      gst_buffer_unref (buf);
+    } else {
+      GST_DEBUG_OBJECT (dec, "buffer did not decode, keeping");
+    }
+    walk = next;
+  }
+
+  /* now we can process frames. Start by moving each frame from the parse_gather
+   * to the decode list, reverse the order as we go, and stopping when/if we
+   * copy a keyframe. */
+  GST_DEBUG_OBJECT (dec, "checking parsed frames for a keyframe to decode");
+  walk = priv->parse_gather;
+  while (walk) {
+    GstVideoCodecFrame *frame = (GstVideoCodecFrame *) (walk->data);
+
+    /* remove from the gather list */
+    priv->parse_gather = g_list_remove_link (priv->parse_gather, walk);
+
+    /* move it to the front of the decode queue */
+    priv->decode = g_list_concat (walk, priv->decode);
+
+    /* if we copied a keyframe, flush and decode the decode queue */
+    if (GST_VIDEO_CODEC_FRAME_IS_SYNC_POINT (frame)) {
+      GST_DEBUG_OBJECT (dec, "found keyframe %p with PTS %" GST_TIME_FORMAT,
+          frame, GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (frame->input_buffer)));
+      res = gst_video_decoder_flush_decode (dec);
+      if (res != GST_FLOW_OK)
+        goto done;
+    }
+
+    walk = priv->parse_gather;
+  }
+
+  /* now send queued data downstream */
+  walk = priv->output_queued;
+  while (walk) {
+    GstBuffer *buf = GST_BUFFER_CAST (walk->data);
+
+    if (G_LIKELY (res == GST_FLOW_OK)) {
+      /* avoid stray DISCONT from forward processing,
+       * which have no meaning in reverse pushing */
+      GST_BUFFER_FLAG_UNSET (buf, GST_BUFFER_FLAG_DISCONT);
+
+      /* Last chance to calculate a timestamp as we loop backwards
+       * through the list */
+      if (GST_BUFFER_TIMESTAMP (buf) != GST_CLOCK_TIME_NONE)
+        priv->last_timestamp_out = GST_BUFFER_TIMESTAMP (buf);
+      else if (priv->last_timestamp_out != GST_CLOCK_TIME_NONE &&
+          GST_BUFFER_DURATION (buf) != GST_CLOCK_TIME_NONE) {
+        GST_BUFFER_TIMESTAMP (buf) =
+            priv->last_timestamp_out - GST_BUFFER_DURATION (buf);
+        priv->last_timestamp_out = GST_BUFFER_TIMESTAMP (buf);
+        GST_LOG_OBJECT (dec,
+            "Calculated TS %" GST_TIME_FORMAT " working backwards. Duration %"
+            GST_TIME_FORMAT, GST_TIME_ARGS (priv->last_timestamp_out),
+            GST_TIME_ARGS (GST_BUFFER_DURATION (buf)));
+      }
+
+      res = gst_video_decoder_clip_and_push_buf (dec, buf);
+    } else {
+      gst_buffer_unref (buf);
+    }
+
+    priv->output_queued =
+        g_list_delete_link (priv->output_queued, priv->output_queued);
+    walk = priv->output_queued;
+  }
+
+done:
+  return res;
+}
+
+static GstFlowReturn
+gst_video_decoder_chain_reverse (GstVideoDecoder * dec, GstBuffer * buf)
+{
+  GstVideoDecoderPrivate *priv = dec->priv;
+  GstFlowReturn result = GST_FLOW_OK;
+
+  /* if we have a discont, move buffers to the decode list */
+  if (!buf || GST_BUFFER_IS_DISCONT (buf)) {
+    GST_DEBUG_OBJECT (dec, "received discont");
+
+    /* parse and decode stuff in the gather and parse queues */
+    gst_video_decoder_flush_parse (dec, FALSE);
+  }
+
+  if (G_LIKELY (buf)) {
+    GST_DEBUG_OBJECT (dec, "gathering buffer %p of size %u, "
+        "time %" GST_TIME_FORMAT ", dur %" GST_TIME_FORMAT, buf,
+        GST_BUFFER_SIZE (buf), GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (buf)),
+        GST_TIME_ARGS (GST_BUFFER_DURATION (buf)));
+
+    /* add buffer to gather queue */
+    priv->gather = g_list_prepend (priv->gather, buf);
+  }
+
+  return result;
+}
+
+static GstFlowReturn
+gst_video_decoder_chain (GstPad * pad, GstBuffer * buf)
+{
+  GstVideoDecoder *decoder;
+  GstFlowReturn ret = GST_FLOW_OK;
+
+  decoder = GST_VIDEO_DECODER (GST_PAD_PARENT (pad));
+
+  GST_LOG_OBJECT (decoder,
+      "chain %" GST_TIME_FORMAT " duration %" GST_TIME_FORMAT " size %d",
+      GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (buf)),
+      GST_TIME_ARGS (GST_BUFFER_DURATION (buf)), GST_BUFFER_SIZE (buf));
+
+  GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+
+  /* NOTE:
+   * requiring the pad to be negotiated makes it impossible to use
+   * oggdemux or filesrc ! decoder */
+
+  if (decoder->input_segment.format == GST_FORMAT_UNDEFINED) {
+    GstEvent *event;
+
+    GST_WARNING_OBJECT (decoder,
+        "Received buffer without a new-segment. "
+        "Assuming timestamps start from 0.");
+
+    gst_segment_set_newsegment_full (&decoder->input_segment, FALSE, 1.0, 1.0,
+        GST_FORMAT_TIME, 0, GST_CLOCK_TIME_NONE, 0);
+
+    event = gst_event_new_new_segment (FALSE, 1.0, GST_FORMAT_TIME, 0,
+        GST_CLOCK_TIME_NONE, 0);
+
+    decoder->priv->current_frame_events =
+        g_list_prepend (decoder->priv->current_frame_events, event);
+  }
+
+  if (decoder->input_segment.rate > 0.0)
+    ret = gst_video_decoder_chain_forward (decoder, buf, FALSE);
+  else
+    ret = gst_video_decoder_chain_reverse (decoder, buf);
+
+  GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+  return ret;
+}
+
+static GstStateChangeReturn
+gst_video_decoder_change_state (GstElement * element, GstStateChange transition)
+{
+  GstVideoDecoder *decoder;
+  GstVideoDecoderClass *decoder_class;
+  GstStateChangeReturn ret;
+
+  decoder = GST_VIDEO_DECODER (element);
+  decoder_class = GST_VIDEO_DECODER_GET_CLASS (element);
+
+  switch (transition) {
+    case GST_STATE_CHANGE_NULL_TO_READY:
+      /* open device/library if needed */
+      if (decoder_class->open && !decoder_class->open (decoder))
+        goto open_failed;
+      break;
+    case GST_STATE_CHANGE_READY_TO_PAUSED:
+      /* Initialize device/library if needed */
+      if (decoder_class->start && !decoder_class->start (decoder))
+        goto start_failed;
+      break;
+    default:
+      break;
+  }
+
+  ret = GST_ELEMENT_CLASS (parent_class)->change_state (element, transition);
+
+  switch (transition) {
+    case GST_STATE_CHANGE_PAUSED_TO_READY:
+      if (decoder_class->stop && !decoder_class->stop (decoder))
+        goto stop_failed;
+
+      GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+      gst_video_decoder_reset (decoder, TRUE);
+      g_list_foreach (decoder->priv->current_frame_events,
+          (GFunc) gst_event_unref, NULL);
+      g_list_free (decoder->priv->current_frame_events);
+      decoder->priv->current_frame_events = NULL;
+      GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+      break;
+    case GST_STATE_CHANGE_READY_TO_NULL:
+      /* close device/library if needed */
+      if (decoder_class->close && !decoder_class->close (decoder))
+        goto close_failed;
+      break;
+    default:
+      break;
+  }
+
+  return ret;
+
+  /* Errors */
+open_failed:
+  {
+    GST_ELEMENT_ERROR (decoder, LIBRARY, INIT, (NULL),
+        ("Failed to open decoder"));
+    return GST_STATE_CHANGE_FAILURE;
+  }
+
+start_failed:
+  {
+    GST_ELEMENT_ERROR (decoder, LIBRARY, INIT, (NULL),
+        ("Failed to start decoder"));
+    return GST_STATE_CHANGE_FAILURE;
+  }
+
+stop_failed:
+  {
+    GST_ELEMENT_ERROR (decoder, LIBRARY, INIT, (NULL),
+        ("Failed to stop decoder"));
+    return GST_STATE_CHANGE_FAILURE;
+  }
+
+close_failed:
+  {
+    GST_ELEMENT_ERROR (decoder, LIBRARY, INIT, (NULL),
+        ("Failed to close decoder"));
+    return GST_STATE_CHANGE_FAILURE;
+  }
+}
+
+static GstVideoCodecFrame *
+gst_video_decoder_new_frame (GstVideoDecoder * decoder)
+{
+  GstVideoDecoderPrivate *priv = decoder->priv;
+  GstVideoCodecFrame *frame;
+
+  frame = g_slice_new0 (GstVideoCodecFrame);
+
+  frame->ref_count = 1;
+
+  GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+  frame->system_frame_number = priv->system_frame_number;
+  priv->system_frame_number++;
+  frame->decode_frame_number = priv->decode_frame_number;
+  priv->decode_frame_number++;
+
+  frame->dts = GST_CLOCK_TIME_NONE;
+  frame->pts = GST_CLOCK_TIME_NONE;
+  frame->duration = GST_CLOCK_TIME_NONE;
+  frame->events = priv->current_frame_events;
+  priv->current_frame_events = NULL;
+  GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+
+  GST_LOG_OBJECT (decoder, "Created new frame %p (sfn:%d)",
+      frame, frame->system_frame_number);
+
+  return frame;
+}
+
+static void
+gst_video_decoder_prepare_finish_frame (GstVideoDecoder *
+    decoder, GstVideoCodecFrame * frame, gboolean dropping)
+{
+  GstVideoDecoderPrivate *priv = decoder->priv;
+  GList *l, *events = NULL;
+  GstClockTime reorder_pts;
+
+#ifndef GST_DISABLE_GST_DEBUG
+  GST_LOG_OBJECT (decoder, "n %d in %d out %d",
+      g_list_length (priv->frames),
+      gst_adapter_available (priv->input_adapter),
+      gst_adapter_available (priv->output_adapter));
+#endif
+
+  reorder_pts = priv->incoming_timestamps[priv->reorder_idx_out];
+  priv->reorder_idx_out =
+      (priv->reorder_idx_out + 1) % MAX_DTS_PTS_REORDER_DEPTH;
+
+  if (!priv->reordered_output && frame->system_frame_number &&
+      priv->last_out_frame_number != (guint) (-1) &&
+      frame->system_frame_number != (priv->last_out_frame_number + 1)) {
+    GST_DEBUG_OBJECT (decoder, "Detected reordered output");
+    priv->reordered_output = TRUE;
+  }
+
+  GST_LOG_OBJECT (decoder,
+      "finish frame %p (#%d) sync:%d pts:%" GST_TIME_FORMAT " dts:%"
+      GST_TIME_FORMAT " reorder_pts:%" GST_TIME_FORMAT,
+      frame, frame->system_frame_number,
+      GST_VIDEO_CODEC_FRAME_IS_SYNC_POINT (frame), GST_TIME_ARGS (frame->pts),
+      GST_TIME_ARGS (frame->dts), GST_TIME_ARGS (reorder_pts));
+
+  /* Push all pending events that arrived before this frame */
+  for (l = priv->frames; l; l = l->next) {
+    GstVideoCodecFrame *tmp = l->data;
+
+    if (tmp->events) {
+      events = g_list_concat (events, tmp->events);
+      tmp->events = NULL;
+    }
+
+    if (tmp == frame)
+      break;
+  }
+
+  for (l = g_list_last (events); l; l = g_list_previous (l)) {
+    GST_LOG_OBJECT (decoder, "pushing %s event", GST_EVENT_TYPE_NAME (l->data));
+    gst_video_decoder_push_event (decoder, l->data);
+  }
+  g_list_free (events);
+
+  /* Check if the data should not be displayed. For example altref/invisible
+   * frame in vp8. In this case we should not update the timestamps. */
+  if (GST_VIDEO_CODEC_FRAME_IS_DECODE_ONLY (frame))
+    return;
+
+  /* If the frame is meant to be output but we don't have an output_buffer
+   * we have a problem :) */
+  if (G_UNLIKELY ((frame->output_buffer == NULL) && !dropping))
+    goto no_output_buffer;
+
+  if (GST_CLOCK_TIME_IS_VALID (frame->pts)) {
+    if (frame->pts != priv->base_timestamp) {
+      GST_DEBUG_OBJECT (decoder,
+          "sync timestamp %" GST_TIME_FORMAT " diff %" GST_TIME_FORMAT,
+          GST_TIME_ARGS (frame->pts),
+          GST_TIME_ARGS (frame->pts - decoder->output_segment.start));
+      priv->base_timestamp = frame->pts;
+      priv->base_picture_number = frame->decode_frame_number;
+    }
+  }
+
+  if (frame->duration == GST_CLOCK_TIME_NONE) {
+    frame->duration = gst_video_decoder_get_frame_duration (decoder, frame);
+    GST_LOG_OBJECT (decoder,
+        "Guessing duration %" GST_TIME_FORMAT " for frame...",
+        GST_TIME_ARGS (frame->duration));
+  }
+
+  if (frame->pts == GST_CLOCK_TIME_NONE) {
+    /* Last ditch timestamp guess: Just add the duration to the previous
+     * frame */
+    if (priv->last_timestamp_out != GST_CLOCK_TIME_NONE &&
+        frame->duration != GST_CLOCK_TIME_NONE) {
+      frame->pts = priv->last_timestamp_out + frame->duration;
+      GST_LOG_OBJECT (decoder,
+          "Guessing timestamp %" GST_TIME_FORMAT " for frame...",
+          GST_TIME_ARGS (frame->pts));
+    }
+  }
+
+  /* Fix buffers that came in with DTS and were reordered */
+  if (!priv->reordered_input && priv->reordered_output
+      && GST_CLOCK_TIME_IS_VALID (reorder_pts)) {
+    GST_DEBUG_OBJECT (decoder,
+        "Correcting PTS, input buffers had DTS on their timestamps");
+    frame->pts = reorder_pts;
+  }
+
+  if (GST_CLOCK_TIME_IS_VALID (priv->last_timestamp_out)) {
+    if (frame->pts < priv->last_timestamp_out) {
+      GST_WARNING_OBJECT (decoder,
+          "decreasing timestamp (%" GST_TIME_FORMAT " < %"
+          GST_TIME_FORMAT ")",
+          GST_TIME_ARGS (frame->pts), GST_TIME_ARGS (priv->last_timestamp_out));
+      frame->pts = reorder_pts;
+    }
+  }
+
+  if (GST_CLOCK_TIME_IS_VALID (frame->pts)) {
+    priv->last_timestamp_out = frame->pts;
+    priv->last_out_frame_number = frame->system_frame_number;
+  }
+
+  return;
+
+  /* ERRORS */
+no_output_buffer:
+  {
+    GST_ERROR_OBJECT (decoder, "No buffer to output !");
+  }
+}
+
+static void
+gst_video_decoder_release_frame (GstVideoDecoder * dec,
+    GstVideoCodecFrame * frame)
+{
+  GList *link;
+
+  /* unref once from the list */
+  link = g_list_find (dec->priv->frames, frame);
+  if (link) {
+    gst_video_codec_frame_unref (frame);
+    dec->priv->frames = g_list_delete_link (dec->priv->frames, link);
+  }
+
+  /* unref because this function takes ownership */
+  gst_video_codec_frame_unref (frame);
+}
+
+/**
+ * gst_video_decoder_drop_frame:
+ * @dec: a #GstVideoDecoder
+ * @frame: (transfer full): the #GstVideoCodecFrame to drop
+ *
+ * Similar to gst_video_decoder_finish_frame(), but drops @frame in any
+ * case and posts a QoS message with the frame's details on the bus.
+ * In any case, the frame is considered finished and released.
+ *
+ * Returns: a #GstFlowReturn, usually GST_FLOW_OK.
+ *
+ * Since: 0.10.37
+ */
+GstFlowReturn
+gst_video_decoder_drop_frame (GstVideoDecoder * dec, GstVideoCodecFrame * frame)
+{
+  GstClockTime stream_time, jitter, earliest_time, qostime, timestamp;
+  GstSegment *segment;
+  GstMessage *qos_msg;
+  gdouble proportion;
+
+  GST_LOG_OBJECT (dec, "drop frame %p", frame);
+
+  GST_VIDEO_DECODER_STREAM_LOCK (dec);
+
+  gst_video_decoder_prepare_finish_frame (dec, frame, TRUE);
+
+  GST_DEBUG_OBJECT (dec, "dropping frame %" GST_TIME_FORMAT,
+      GST_TIME_ARGS (frame->pts));
+
+  dec->priv->dropped++;
+
+  /* post QoS message */
+  GST_OBJECT_LOCK (dec);
+  proportion = dec->priv->proportion;
+  earliest_time = dec->priv->earliest_time;
+  GST_OBJECT_UNLOCK (dec);
+
+  timestamp = frame->pts;
+  segment = &dec->output_segment;
+  stream_time =
+      gst_segment_to_stream_time (segment, GST_FORMAT_TIME, timestamp);
+  qostime = gst_segment_to_running_time (segment, GST_FORMAT_TIME, timestamp);
+  jitter = GST_CLOCK_DIFF (qostime, earliest_time);
+  qos_msg =
+      gst_message_new_qos (GST_OBJECT_CAST (dec), FALSE, qostime, stream_time,
+      timestamp, GST_CLOCK_TIME_NONE);
+  gst_message_set_qos_values (qos_msg, jitter, proportion, 1000000);
+  gst_message_set_qos_stats (qos_msg, GST_FORMAT_BUFFERS,
+      dec->priv->processed, dec->priv->dropped);
+  gst_element_post_message (GST_ELEMENT_CAST (dec), qos_msg);
+
+  /* now free the frame */
+  gst_video_decoder_release_frame (dec, frame);
+
+  GST_VIDEO_DECODER_STREAM_UNLOCK (dec);
+
+  return GST_FLOW_OK;
+}
+
+/**
+ * gst_video_decoder_finish_frame:
+ * @decoder: a #GstVideoDecoder
+ * @frame: (transfer full): a decoded #GstVideoCodecFrame
+ *
+ * @frame should have a valid decoded data buffer, whose metadata fields
+ * are then appropriately set according to frame data and pushed downstream.
+ * If no output data is provided, @frame is considered skipped.
+ * In any case, the frame is considered finished and released.
+ *
+ * Returns: a #GstFlowReturn resulting from sending data downstream
+ *
+ * Since: 0.10.37
+ */
+GstFlowReturn
+gst_video_decoder_finish_frame (GstVideoDecoder * decoder,
+    GstVideoCodecFrame * frame)
+{
+  GstFlowReturn ret = GST_FLOW_OK;
+  GstVideoDecoderPrivate *priv = decoder->priv;
+  GstVideoCodecState *state;
+  GstBuffer *output_buffer;
+
+  GST_LOG_OBJECT (decoder, "finish frame %p", frame);
+
+  GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+
+  if (G_UNLIKELY (priv->output_state_changed))
+    gst_video_decoder_negotiate (decoder);
+
+  state = priv->output_state;
+
+  gst_video_decoder_prepare_finish_frame (decoder, frame, FALSE);
+  priv->processed++;
+
+  /* no buffer data means this frame is skipped */
+  if (!frame->output_buffer || GST_VIDEO_CODEC_FRAME_IS_DECODE_ONLY (frame)) {
+    GST_DEBUG_OBJECT (decoder, "skipping frame %" GST_TIME_FORMAT,
+        GST_TIME_ARGS (frame->pts));
+    goto done;
+  }
+
+  /* A reference always needs to be owned by the frame on the buffer.
+   * For that reason, we use a complete sub-buffer (zero-cost) to push
+   * downstream.
+   * The original buffer will be free-ed only when downstream AND the
+   * current implementation are done with the frame. */
+  output_buffer =
+      gst_buffer_create_sub (frame->output_buffer, 0,
+      GST_BUFFER_SIZE (frame->output_buffer));
+
+  GST_BUFFER_FLAG_UNSET (output_buffer, GST_BUFFER_FLAG_DELTA_UNIT);
+  if (GST_VIDEO_INFO_IS_INTERLACED (&state->info)) {
+    if (GST_VIDEO_CODEC_FRAME_FLAG_IS_SET (frame,
+            GST_VIDEO_CODEC_FRAME_FLAG_TFF)) {
+      GST_BUFFER_FLAG_SET (output_buffer, GST_VIDEO_BUFFER_TFF);
+    } else {
+      GST_BUFFER_FLAG_UNSET (output_buffer, GST_VIDEO_BUFFER_TFF);
+    }
+    if (GST_VIDEO_CODEC_FRAME_FLAG_IS_SET (frame,
+            GST_VIDEO_CODEC_FRAME_FLAG_RFF)) {
+      GST_BUFFER_FLAG_SET (output_buffer, GST_VIDEO_BUFFER_RFF);
+    } else {
+      GST_BUFFER_FLAG_UNSET (output_buffer, GST_VIDEO_BUFFER_RFF);
+    }
+    if (GST_VIDEO_CODEC_FRAME_FLAG_IS_SET (frame,
+            GST_VIDEO_CODEC_FRAME_FLAG_ONEFIELD)) {
+      GST_BUFFER_FLAG_SET (output_buffer, GST_VIDEO_BUFFER_ONEFIELD);
+    } else {
+      GST_BUFFER_FLAG_UNSET (output_buffer, GST_VIDEO_BUFFER_ONEFIELD);
+    }
+  }
+
+  GST_BUFFER_TIMESTAMP (output_buffer) = frame->pts;
+  GST_BUFFER_DURATION (output_buffer) = frame->duration;
+
+  GST_BUFFER_OFFSET (output_buffer) = GST_BUFFER_OFFSET_NONE;
+  GST_BUFFER_OFFSET_END (output_buffer) = GST_BUFFER_OFFSET_NONE;
+
+  if (priv->discont) {
+    GST_BUFFER_FLAG_SET (output_buffer, GST_BUFFER_FLAG_DISCONT);
+    priv->discont = FALSE;
+  }
+
+  if (decoder->output_segment.rate < 0.0) {
+    GST_LOG_OBJECT (decoder, "queued frame");
+    priv->output_queued = g_list_prepend (priv->output_queued, output_buffer);
+  } else {
+    ret = gst_video_decoder_clip_and_push_buf (decoder, output_buffer);
+  }
+
+done:
+  gst_video_decoder_release_frame (decoder, frame);
+  GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+  return ret;
+}
+
+
+/* With stream lock, takes the frame reference */
+static GstFlowReturn
+gst_video_decoder_clip_and_push_buf (GstVideoDecoder * decoder, GstBuffer * buf)
+{
+  GstFlowReturn ret = GST_FLOW_OK;
+  GstVideoDecoderPrivate *priv = decoder->priv;
+  gint64 start, stop;
+  gint64 cstart, cstop;
+  GstSegment *segment;
+  GstClockTime duration;
+
+  /* Check for clipping */
+  start = GST_BUFFER_TIMESTAMP (buf);
+  duration = GST_BUFFER_DURATION (buf);
+
+  stop = GST_CLOCK_TIME_NONE;
+
+  if (GST_CLOCK_TIME_IS_VALID (start) && GST_CLOCK_TIME_IS_VALID (duration)) {
+    stop = start + duration;
+  }
+
+  segment = &decoder->output_segment;
+  if (gst_segment_clip (segment, GST_FORMAT_TIME, start, stop, &cstart, &cstop)) {
+
+    GST_BUFFER_TIMESTAMP (buf) = cstart;
+
+    if (stop != GST_CLOCK_TIME_NONE)
+      GST_BUFFER_DURATION (buf) = cstop - cstart;
+
+    GST_LOG_OBJECT (decoder,
+        "accepting buffer inside segment: %" GST_TIME_FORMAT " %"
+        GST_TIME_FORMAT " seg %" GST_TIME_FORMAT " to %" GST_TIME_FORMAT
+        " time %" GST_TIME_FORMAT,
+        GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (buf)),
+        GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (buf) +
+            GST_BUFFER_DURATION (buf)),
+        GST_TIME_ARGS (segment->start), GST_TIME_ARGS (segment->stop),
+        GST_TIME_ARGS (segment->time));
+  } else {
+    GST_LOG_OBJECT (decoder,
+        "dropping buffer outside segment: %" GST_TIME_FORMAT
+        " %" GST_TIME_FORMAT
+        " seg %" GST_TIME_FORMAT " to %" GST_TIME_FORMAT
+        " time %" GST_TIME_FORMAT,
+        GST_TIME_ARGS (start), GST_TIME_ARGS (stop),
+        GST_TIME_ARGS (segment->start),
+        GST_TIME_ARGS (segment->stop), GST_TIME_ARGS (segment->time));
+    gst_buffer_unref (buf);
+    goto done;
+  }
+
+  /* update rate estimate */
+  priv->bytes_out += GST_BUFFER_SIZE (buf);
+  if (GST_CLOCK_TIME_IS_VALID (duration)) {
+    priv->time += duration;
+  } else {
+    /* FIXME : Use difference between current and previous outgoing
+     * timestamp, and relate to difference between current and previous
+     * bytes */
+    /* better none than nothing valid */
+    priv->time = GST_CLOCK_TIME_NONE;
+  }
+
+  gst_buffer_set_caps (buf, GST_PAD_CAPS (decoder->srcpad));
+
+  GST_LOG_OBJECT (decoder, "pushing buffer %p of size %u ts %" GST_TIME_FORMAT
+      ", duration %" GST_TIME_FORMAT, buf, GST_BUFFER_SIZE (buf),
+      GST_TIME_ARGS (GST_BUFFER_TIMESTAMP (buf)),
+      GST_TIME_ARGS (GST_BUFFER_DURATION (buf)));
+
+  /* we got data, so note things are looking up again, reduce
+   * the error count, if there is one */
+  if (G_UNLIKELY (priv->error_count))
+    priv->error_count = 0;
+
+  ret = gst_pad_push (decoder->srcpad, buf);
+
+done:
+  return ret;
+}
+
+/**
+ * gst_video_decoder_add_to_frame:
+ * @decoder: a #GstVideoDecoder
+ * @n_bytes: the number of bytes to add
+ *
+ * Removes next @n_bytes of input data and adds it to currently parsed frame.
+ *
+ * Since: 0.10.37
+ */
+void
+gst_video_decoder_add_to_frame (GstVideoDecoder * decoder, int n_bytes)
+{
+  GstVideoDecoderPrivate *priv = decoder->priv;
+  GstBuffer *buf;
+
+  GST_LOG_OBJECT (decoder, "add %d bytes to frame", n_bytes);
+
+  if (n_bytes == 0)
+    return;
+
+  GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+  if (gst_adapter_available (priv->output_adapter) == 0) {
+    priv->frame_offset =
+        priv->input_offset - gst_adapter_available (priv->input_adapter);
+  }
+  buf = gst_adapter_take_buffer (priv->input_adapter, n_bytes);
+
+  gst_adapter_push (priv->output_adapter, buf);
+  GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+}
+
+static guint64
+gst_video_decoder_get_frame_duration (GstVideoDecoder * decoder,
+    GstVideoCodecFrame * frame)
+{
+  GstVideoCodecState *state = decoder->priv->output_state;
+  gint fields;
+
+  /* it's possible that we don't have a state yet when we are dropping the
+   * initial buffers */
+  if (state == NULL)
+    return GST_CLOCK_TIME_NONE;
+
+  if (state->info.fps_d == 0 || state->info.fps_n == 0) {
+    return GST_CLOCK_TIME_NONE;
+  }
+
+  if (GST_VIDEO_CODEC_FRAME_FLAG_IS_SET (frame, GST_VIDEO_CODEC_FRAME_FLAG_RFF))
+    fields = 3;
+  else if (GST_VIDEO_CODEC_FRAME_FLAG_IS_SET (frame,
+          GST_VIDEO_CODEC_FRAME_FLAG_ONEFIELD))
+    fields = 1;
+  else
+    fields = 2;
+
+  return gst_util_uint64_scale (fields * GST_SECOND, state->info.fps_d,
+      state->info.fps_n * 2);
+}
+
+/**
+ * gst_video_decoder_have_frame:
+ * @decoder: a #GstVideoDecoder
+ *
+ * Gathers all data collected for currently parsed frame, gathers corresponding
+ * metadata and passes it along for further processing, i.e. @handle_frame.
+ *
+ * Returns: a #GstFlowReturn
+ *
+ * Since: 0.10.37
+ */
+GstFlowReturn
+gst_video_decoder_have_frame (GstVideoDecoder * decoder)
+{
+  GstVideoDecoderPrivate *priv = decoder->priv;
+  GstBuffer *buffer;
+  int n_available;
+  GstClockTime timestamp;
+  GstClockTime duration;
+  GstFlowReturn ret = GST_FLOW_OK;
+
+  GST_LOG_OBJECT (decoder, "have_frame");
+
+  GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+
+  n_available = gst_adapter_available (priv->output_adapter);
+  if (n_available) {
+    buffer = gst_adapter_take_buffer (priv->output_adapter, n_available);
+  } else {
+    buffer = gst_buffer_new_and_alloc (0);
+  }
+
+  priv->current_frame->input_buffer = buffer;
+
+  gst_video_decoder_get_timestamp_at_offset (decoder,
+      priv->frame_offset, &timestamp, &duration);
+
+  GST_BUFFER_TIMESTAMP (buffer) = timestamp;
+  GST_BUFFER_DURATION (buffer) = duration;
+
+  GST_LOG_OBJECT (decoder, "collected frame size %d, "
+      "ts %" GST_TIME_FORMAT ", dur %" GST_TIME_FORMAT,
+      n_available, GST_TIME_ARGS (timestamp), GST_TIME_ARGS (duration));
+
+  /* In reverse playback, just capture and queue frames for later processing */
+  if (decoder->output_segment.rate < 0.0) {
+    priv->parse_gather =
+        g_list_prepend (priv->parse_gather, priv->current_frame);
+  } else {
+    /* Otherwise, decode the frame, which gives away our ref */
+    ret = gst_video_decoder_decode_frame (decoder, priv->current_frame);
+  }
+  /* Current frame is gone now, either way */
+  priv->current_frame = NULL;
+
+  GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+
+  return ret;
+}
+
+/* Pass the frame in priv->current_frame through the
+ * handle_frame() callback for decoding and passing to gvd_finish_frame(), 
+ * or dropping by passing to gvd_drop_frame() */
+static GstFlowReturn
+gst_video_decoder_decode_frame (GstVideoDecoder * decoder,
+    GstVideoCodecFrame * frame)
+{
+  GstVideoDecoderPrivate *priv = decoder->priv;
+  GstVideoDecoderClass *decoder_class;
+  GstFlowReturn ret = GST_FLOW_OK;
+
+  decoder_class = GST_VIDEO_DECODER_GET_CLASS (decoder);
+
+  /* FIXME : This should only have to be checked once (either the subclass has an 
+   * implementation, or it doesn't) */
+  g_return_val_if_fail (decoder_class->handle_frame != NULL, GST_FLOW_ERROR);
+
+  frame->distance_from_sync = priv->distance_from_sync;
+  priv->distance_from_sync++;
+  frame->pts = GST_BUFFER_TIMESTAMP (frame->input_buffer);
+  frame->duration = GST_BUFFER_DURATION (frame->input_buffer);
+
+  /* For keyframes, DTS = PTS */
+  if (GST_VIDEO_CODEC_FRAME_IS_SYNC_POINT (frame))
+    frame->dts = frame->pts;
+
+  GST_LOG_OBJECT (decoder, "pts %" GST_TIME_FORMAT, GST_TIME_ARGS (frame->pts));
+  GST_LOG_OBJECT (decoder, "dts %" GST_TIME_FORMAT, GST_TIME_ARGS (frame->dts));
+  GST_LOG_OBJECT (decoder, "dist %d", frame->distance_from_sync);
+
+  gst_video_codec_frame_ref (frame);
+  priv->frames = g_list_append (priv->frames, frame);
+
+  if (g_list_length (priv->frames) > 10) {
+    GST_WARNING_OBJECT (decoder, "decoder frame list getting long: %d frames,"
+        "possible internal leaking?", g_list_length (priv->frames));
+  }
+
+  frame->deadline =
+      gst_segment_to_running_time (&decoder->input_segment, GST_FORMAT_TIME,
+      frame->pts);
+
+  /* Store pts */
+  if (GST_CLOCK_TIME_IS_VALID (frame->pts)
+      && GST_CLOCK_TIME_IS_VALID (priv->last_timestamp_in)
+      && frame->pts < priv->last_timestamp_in) {
+    GST_DEBUG_OBJECT (decoder, "Incoming timestamps are out of order");
+    priv->reordered_input = TRUE;
+  }
+  priv->last_timestamp_in = frame->pts;
+  priv->incoming_timestamps[priv->reorder_idx_in] = frame->pts;
+  priv->reorder_idx_in = (priv->reorder_idx_in + 1) % MAX_DTS_PTS_REORDER_DEPTH;
+
+  /* do something with frame */
+  ret = decoder_class->handle_frame (decoder, frame);
+  if (ret != GST_FLOW_OK)
+    GST_DEBUG_OBJECT (decoder, "flow error %s", gst_flow_get_name (ret));
+
+  /* the frame has either been added to parse_gather or sent to
+     handle frame so there is no need to unref it */
+  return ret;
+}
+
+
+/**
+ * gst_video_decoder_get_output_state:
+ * @decoder: a #GstVideoDecoder
+ *
+ * Get the #GstVideoCodecState currently describing the output stream.
+ *
+ * Returns: (transfer full): #GstVideoCodecState describing format of video data.
+ *
+ * Since: 0.10.37
+ */
+GstVideoCodecState *
+gst_video_decoder_get_output_state (GstVideoDecoder * decoder)
+{
+  GstVideoCodecState *state = NULL;
+
+  GST_OBJECT_LOCK (decoder);
+  if (decoder->priv->output_state)
+    state = gst_video_codec_state_ref (decoder->priv->output_state);
+  GST_OBJECT_UNLOCK (decoder);
+
+  return state;
+}
+
+/**
+ * gst_video_decoder_set_output_state:
+ * @decoder: a #GstVideoDecoder
+ * @fmt: a #GstVideoFormat
+ * @width: The width in pixels
+ * @height: The height in pixels
+ * @reference: (allow-none) (transfer none): An optional reference #GstVideoCodecState
+ *
+ * Creates a new #GstVideoCodecState with the specified @fmt, @width and @height
+ * as the output state for the decoder.
+ * Any previously set output state on @decoder will be replaced by the newly
+ * created one.
+ *
+ * If the subclass wishes to copy over existing fields (like pixel aspec ratio,
+ * or framerate) from an existing #GstVideoCodecState, it can be provided as a
+ * @reference.
+ *
+ * If the subclass wishes to override some fields from the output state (like
+ * pixel-aspect-ratio or framerate) it can do so on the returned #GstVideoCodecState.
+ *
+ * The new output state will only take effect (set on pads and buffers) starting
+ * from the next call to #gst_video_decoder_finish_frame().
+ *
+ * Returns: (transfer full): the newly configured output state.
+ *
+ * Since: 0.10.37
+ */
+GstVideoCodecState *
+gst_video_decoder_set_output_state (GstVideoDecoder * decoder,
+    GstVideoFormat fmt, guint width, guint height,
+    GstVideoCodecState * reference)
+{
+  GstVideoDecoderPrivate *priv = decoder->priv;
+  GstVideoCodecState *state;
+
+  GST_DEBUG_OBJECT (decoder, "fmt:%d, width:%d, height:%d, reference:%p",
+      fmt, width, height, reference);
+
+  /* Create the new output state */
+  state = _new_output_state (fmt, width, height, reference);
+
+  GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+
+  GST_OBJECT_LOCK (decoder);
+  /* Replace existing output state by new one */
+  if (priv->output_state)
+    gst_video_codec_state_unref (priv->output_state);
+  priv->output_state = gst_video_codec_state_ref (state);
+
+  if (priv->output_state != NULL && priv->output_state->info.fps_n > 0) {
+    priv->qos_frame_duration =
+        gst_util_uint64_scale (GST_SECOND, priv->output_state->info.fps_d,
+        priv->output_state->info.fps_n);
+  } else {
+    priv->qos_frame_duration = 0;
+  }
+  priv->output_state_changed = TRUE;
+  GST_OBJECT_UNLOCK (decoder);
+
+  GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+
+  return state;
+}
+
+
+/**
+ * gst_video_decoder_get_oldest_frame:
+ * @decoder: a #GstVideoDecoder
+ *
+ * Get the oldest pending unfinished #GstVideoCodecFrame
+ *
+ * Returns: (transfer full): oldest pending unfinished #GstVideoCodecFrame.
+ *
+ * Since: 0.10.37
+ */
+GstVideoCodecFrame *
+gst_video_decoder_get_oldest_frame (GstVideoDecoder * decoder)
+{
+  GstVideoCodecFrame *frame = NULL;
+
+  GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+  if (decoder->priv->frames)
+    frame = gst_video_codec_frame_ref (decoder->priv->frames->data);
+  GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+
+  return (GstVideoCodecFrame *) frame;
+}
+
+/**
+ * gst_video_decoder_get_frame:
+ * @decoder: a #GstVideoDecoder
+ * @frame_number: system_frame_number of a frame
+ *
+ * Get a pending unfinished #GstVideoCodecFrame
+ * 
+ * Returns: (transfer full): pending unfinished #GstVideoCodecFrame identified by @frame_number.
+ *
+ * Since: 0.10.37
+ */
+GstVideoCodecFrame *
+gst_video_decoder_get_frame (GstVideoDecoder * decoder, int frame_number)
+{
+  GList *g;
+  GstVideoCodecFrame *frame = NULL;
+
+  GST_DEBUG_OBJECT (decoder, "frame_number : %d", frame_number);
+
+  GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+  for (g = decoder->priv->frames; g; g = g->next) {
+    GstVideoCodecFrame *tmp = g->data;
+
+    if (tmp->system_frame_number == frame_number) {
+      frame = gst_video_codec_frame_ref (tmp);
+      break;
+    }
+  }
+  GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+
+  return frame;
+}
+
+/**
+ * gst_video_decoder_get_frames:
+ * @decoder: a #GstVideoDecoder
+ *
+ * Get all pending unfinished #GstVideoCodecFrame
+ * 
+ * Returns: (transfer full) (element-type GstVideoCodecFrame): pending unfinished #GstVideoCodecFrame.
+ */
+GList *
+gst_video_decoder_get_frames (GstVideoDecoder * decoder)
+{
+  GList *frames;
+
+  GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+  frames = g_list_copy (decoder->priv->frames);
+  g_list_foreach (frames, (GFunc) gst_video_codec_frame_ref, NULL);
+  GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+
+  return frames;
+}
+
+/**
+ * gst_video_decoder_negotiate:
+ * @decoder: a #GstVideoDecoder
+ *
+ * Negotiate with downstreame elements to currently configured #GstVideoCodecState.
+ *
+ * Returns: #TRUE if the caps were accepted downstream, else #FALSE.
+ *
+ * Since: 0.10.37
+ */
+gboolean
+gst_video_decoder_negotiate (GstVideoDecoder * decoder)
+{
+  GstVideoCodecState *state = decoder->priv->output_state;
+  gboolean ret;
+
+  g_return_val_if_fail (GST_VIDEO_INFO_WIDTH (&state->info) != 0, FALSE);
+  g_return_val_if_fail (GST_VIDEO_INFO_HEIGHT (&state->info) != 0, FALSE);
+
+  GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+
+  GST_DEBUG_OBJECT (decoder, "output_state par %d/%d fps %d/%d",
+      state->info.par_n, state->info.par_d,
+      state->info.fps_n, state->info.fps_d);
+
+  if (state->caps == NULL)
+    state->caps = gst_video_info_to_caps (&state->info);
+
+  GST_DEBUG_OBJECT (decoder, "setting caps %" GST_PTR_FORMAT, state->caps);
+
+  ret = gst_pad_set_caps (decoder->srcpad, state->caps);
+  decoder->priv->output_state_changed = FALSE;
+
+  GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+
+  return ret;
+}
+
+/**
+ * gst_video_decoder_alloc_output_buffer:
+ * @decoder: a #GstVideoDecoder
+ *
+ * Helper function that uses @gst_pad_alloc_buffer_and_set_caps()
+ * to allocate a buffer to hold a video frame for @decoder's
+ * current #GstVideoCodecState.
+ *
+ * Returns: (transfer full): allocated buffer
+ *
+ * Since: 0.10.37
+ */
+GstBuffer *
+gst_video_decoder_alloc_output_buffer (GstVideoDecoder * decoder)
+{
+  GstBuffer *buffer = NULL;
+  GstFlowReturn flow_ret;
+  GstVideoCodecState *state = decoder->priv->output_state;
+  int num_bytes = GST_VIDEO_INFO_SIZE (&state->info);
+
+  GST_DEBUG ("alloc src buffer caps=%" GST_PTR_FORMAT,
+      GST_PAD_CAPS (decoder->srcpad));
+
+  GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+  if (G_UNLIKELY (decoder->priv->output_state_changed))
+    gst_video_decoder_negotiate (decoder);
+
+  flow_ret =
+      gst_pad_alloc_buffer_and_set_caps (decoder->srcpad,
+      GST_BUFFER_OFFSET_NONE, num_bytes, GST_PAD_CAPS (decoder->srcpad),
+      &buffer);
+
+  GST_DEBUG ("alloc returned %d buffer %" GST_PTR_FORMAT, flow_ret, buffer);
+
+  /* TODO need to check that the buffer size matches and properly attempt
+   * a renegotiation if the videodecoder is able to handle it */
+  if (flow_ret != GST_FLOW_OK || GST_BUFFER_SIZE (buffer) != num_bytes ||
+      !gst_caps_is_equal_fixed (GST_PAD_CAPS (decoder->srcpad),
+          GST_BUFFER_CAPS (buffer))) {
+    buffer = gst_buffer_new_and_alloc (num_bytes);
+    gst_buffer_set_caps (buffer, GST_PAD_CAPS (decoder->srcpad));
+  }
+
+  GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+
+  return buffer;
+}
+
+/**
+ * gst_video_decoder_alloc_output_frame:
+ * @decoder: a #GstVideoDecoder
+ * @frame: a #GstVideoCodecFrame
+ *
+ * Helper function that uses @gst_pad_alloc_buffer_and_set_caps()
+ * to allocate a buffer to hold a video frame for @decoder's
+ * current #GstVideoCodecState.  Subclass should already have configured video state
+ * and set src pad caps.
+ *
+ * Returns: result from pad alloc call
+ *
+ * Since: 0.10.37
+ */
+GstFlowReturn
+gst_video_decoder_alloc_output_frame (GstVideoDecoder *
+    decoder, GstVideoCodecFrame * frame)
+{
+  GstFlowReturn flow_ret;
+  GstVideoCodecState *state;
+  int num_bytes;
+
+  g_return_val_if_fail (frame->output_buffer == NULL, GST_FLOW_ERROR);
+
+  GST_VIDEO_DECODER_STREAM_LOCK (decoder);
+
+  state = decoder->priv->output_state;
+  if (state == NULL) {
+    g_warning ("Output state should be set before allocating frame");
+    goto error;
+  }
+  num_bytes = GST_VIDEO_INFO_SIZE (&state->info);
+  if (num_bytes == 0) {
+    g_warning ("Frame size should not be 0");
+    goto error;
+  }
+
+  if (G_UNLIKELY (decoder->priv->output_state_changed))
+    gst_video_decoder_negotiate (decoder);
+
+  g_return_val_if_fail (GST_PAD_CAPS (decoder->srcpad) != NULL, GST_FLOW_ERROR);
+
+  GST_LOG_OBJECT (decoder, "alloc buffer size %d", num_bytes);
+
+  flow_ret =
+      gst_pad_alloc_buffer_and_set_caps (decoder->srcpad,
+      GST_BUFFER_OFFSET_NONE, num_bytes, GST_PAD_CAPS (decoder->srcpad),
+      &frame->output_buffer);
+
+  if (flow_ret != GST_FLOW_OK) {
+    GST_WARNING_OBJECT (decoder, "failed to get buffer %s",
+        gst_flow_get_name (flow_ret));
+  }
+
+  GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+
+  return flow_ret;
+
+error:
+  GST_VIDEO_DECODER_STREAM_UNLOCK (decoder);
+  return GST_FLOW_ERROR;
+}
+
+/**
+ * gst_video_decoder_get_max_decode_time:
+ * @decoder: a #GstVideoDecoder
+ * @frame: a #GstVideoCodecFrame
+ *
+ * Determines maximum possible decoding time for @frame that will
+ * allow it to decode and arrive in time (as determined by QoS events).
+ * In particular, a negative result means decoding in time is no longer possible
+ * and should therefore occur as soon/skippy as possible.
+ *
+ * Returns: max decoding time.
+ *
+ * Since: 0.10.37
+ */
+GstClockTimeDiff
+gst_video_decoder_get_max_decode_time (GstVideoDecoder *
+    decoder, GstVideoCodecFrame * frame)
+{
+  GstClockTimeDiff deadline;
+  GstClockTime earliest_time;
+
+  GST_OBJECT_LOCK (decoder);
+  earliest_time = decoder->priv->earliest_time;
+  if (GST_CLOCK_TIME_IS_VALID (earliest_time)
+      && GST_CLOCK_TIME_IS_VALID (frame->deadline))
+    deadline = GST_CLOCK_DIFF (earliest_time, frame->deadline);
+  else
+    deadline = G_MAXINT64;
+
+  GST_LOG_OBJECT (decoder, "earliest %" GST_TIME_FORMAT
+      ", frame deadline %" GST_TIME_FORMAT ", deadline %" GST_TIME_FORMAT,
+      GST_TIME_ARGS (earliest_time), GST_TIME_ARGS (frame->deadline),
+      GST_TIME_ARGS (deadline));
+
+  GST_OBJECT_UNLOCK (decoder);
+
+  return deadline;
+}
+
+/**
+ * gst_video_decoder_get_qos_proportion:
+ * @decoder: a #GstVideoDecoder
+ *     current QoS proportion, or %NULL
+ *
+ * Returns: The current QoS proportion.
+ *
+ * Since: 1.0.3
+ */
+gdouble
+gst_video_decoder_get_qos_proportion (GstVideoDecoder * decoder)
+{
+  gdouble proportion;
+
+  g_return_val_if_fail (GST_IS_VIDEO_DECODER (decoder), 1.0);
+
+  GST_OBJECT_LOCK (decoder);
+  proportion = decoder->priv->proportion;
+  GST_OBJECT_UNLOCK (decoder);
+
+  return proportion;
+}
+
+GstFlowReturn
+_gst_video_decoder_error (GstVideoDecoder * dec, gint weight,
+    GQuark domain, gint code, gchar * txt, gchar * dbg, const gchar * file,
+    const gchar * function, gint line)
+{
+  if (txt)
+    GST_WARNING_OBJECT (dec, "error: %s", txt);
+  if (dbg)
+    GST_WARNING_OBJECT (dec, "error: %s", dbg);
+  dec->priv->error_count += weight;
+  dec->priv->discont = TRUE;
+  if (dec->priv->max_errors < dec->priv->error_count) {
+    gst_element_message_full (GST_ELEMENT (dec), GST_MESSAGE_ERROR,
+        domain, code, txt, dbg, file, function, line);
+    return GST_FLOW_ERROR;
+  } else {
+    g_free (txt);
+    g_free (dbg);
+    return GST_FLOW_OK;
+  }
+}
+
+/**
+ * gst_video_decoder_set_max_errors:
+ * @dec: a #GstVideoDecoder
+ * @num: max tolerated errors
+ *
+ * Sets numbers of tolerated decoder errors, where a tolerated one is then only
+ * warned about, but more than tolerated will lead to fatal error.  Default
+ * is set to GST_VIDEO_DECODER_MAX_ERRORS.
+ *
+ * Since: 0.10.37
+ */
+void
+gst_video_decoder_set_max_errors (GstVideoDecoder * dec, gint num)
+{
+  g_return_if_fail (GST_IS_VIDEO_DECODER (dec));
+
+  dec->priv->max_errors = num;
+}
+
+/**
+ * gst_video_decoder_get_max_errors:
+ * @dec: a #GstVideoDecoder
+ *
+ * Returns: currently configured decoder tolerated error count.
+ *
+ * Since: 0.10.37
+ */
+gint
+gst_video_decoder_get_max_errors (GstVideoDecoder * dec)
+{
+  g_return_val_if_fail (GST_IS_VIDEO_DECODER (dec), 0);
+
+  return dec->priv->max_errors;
+}
+
+/**
+ * gst_video_decoder_set_packetized:
+ * @decoder: a #GstVideoDecoder
+ * @packetized: whether the input data should be considered as packetized.
+ *
+ * Allows baseclass to consider input data as packetized or not. If the
+ * input is packetized, then the @parse method will not be called.
+ *
+ * Since: 0.10.37
+ */
+void
+gst_video_decoder_set_packetized (GstVideoDecoder * decoder,
+    gboolean packetized)
+{
+  decoder->priv->packetized = packetized;
+}
+
+/**
+ * gst_video_decoder_get_packetized:
+ * @decoder: a #GstVideoDecoder
+ *
+ * Queries whether input data is considered packetized or not by the
+ * base class.
+ *
+ * Returns: TRUE if input data is considered packetized.
+ *
+ * Since: 0.10.37
+ */
+gboolean
+gst_video_decoder_get_packetized (GstVideoDecoder * decoder)
+{
+  return decoder->priv->packetized;
+}
+
+/**
+ * gst_video_decoder_set_estimate_rate:
+ * @dec: a #GstVideoDecoder
+ * @enabled: whether to enable byte to time conversion
+ *
+ * Allows baseclass to perform byte to time estimated conversion.
+ *
+ * Since: 0.10.37
+ */
+void
+gst_video_decoder_set_estimate_rate (GstVideoDecoder * dec, gboolean enabled)
+{
+  g_return_if_fail (GST_IS_VIDEO_DECODER (dec));
+
+  dec->priv->do_estimate_rate = enabled;
+}
+
+/**
+ * gst_video_decoder_get_estimate_rate:
+ * @dec: a #GstVideoDecoder
+ *
+ * Returns: currently configured byte to time conversion setting
+ *
+ * Since: 0.10.37
+ */
+gboolean
+gst_video_decoder_get_estimate_rate (GstVideoDecoder * dec)
+{
+  g_return_val_if_fail (GST_IS_VIDEO_DECODER (dec), 0);
+
+  return dec->priv->do_estimate_rate;
+}
+
+/**
+ * gst_video_decoder_set_latency:
+ * @decoder: a #GstVideoDecoder
+ * @min_latency: minimum latency
+ * @max_latency: maximum latency
+ *
+ * Lets #GstVideoDecoder sub-classes tell the baseclass what the decoder
+ * latency is. Will also post a LATENCY message on the bus so the pipeline
+ * can reconfigure its global latency.
+ *
+ * Since: 0.10.37
+ */
+void
+gst_video_decoder_set_latency (GstVideoDecoder * decoder,
+    GstClockTime min_latency, GstClockTime max_latency)
+{
+  g_return_if_fail (GST_CLOCK_TIME_IS_VALID (min_latency));
+  g_return_if_fail (max_latency >= min_latency);
+
+  GST_OBJECT_LOCK (decoder);
+  decoder->priv->min_latency = min_latency;
+  decoder->priv->max_latency = max_latency;
+  GST_OBJECT_UNLOCK (decoder);
+
+  gst_element_post_message (GST_ELEMENT_CAST (decoder),
+      gst_message_new_latency (GST_OBJECT_CAST (decoder)));
+}
+
+/**
+ * gst_video_decoder_get_latency:
+ * @decoder: a #GstVideoDecoder
+ * @min_latency: (out) (allow-none): address of variable in which to store the
+ *     configured minimum latency, or %NULL
+ * @max_latency: (out) (allow-none): address of variable in which to store the
+ *     configured mximum latency, or %NULL
+ *
+ * Query the configured decoder latency. Results will be returned via
+ * @min_latency and @max_latency.
+ *
+ * Since: 0.10.37
+ */
+void
+gst_video_decoder_get_latency (GstVideoDecoder * decoder,
+    GstClockTime * min_latency, GstClockTime * max_latency)
+{
+  GST_OBJECT_LOCK (decoder);
+  if (min_latency)
+    *min_latency = decoder->priv->min_latency;
+  if (max_latency)
+    *max_latency = decoder->priv->max_latency;
+  GST_OBJECT_UNLOCK (decoder);
+}
diff --git a/gst-libs/gst/video/gstvideodecoder.h b/gst-libs/gst/video/gstvideodecoder.h
new file mode 100644
index 0000000..db19480
--- /dev/null
+++ b/gst-libs/gst/video/gstvideodecoder.h
@@ -0,0 +1,374 @@
+/* GStreamer
+ * Copyright (C) 2008 David Schleef <ds@schleef.org>
+ * Copyright (C) 2011 Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>.
+ * Copyright (C) 2011 Nokia Corporation. All rights reserved.
+ *   Contact: Stefan Kost <stefan.kost@nokia.com>
+ * Copyright (C) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifndef _GST_VIDEO_DECODER_H_
+#define _GST_VIDEO_DECODER_H_
+
+#include <gst/base/gstadapter.h>
+#include <gst/video/gstvideoutils.h>
+
+G_BEGIN_DECLS
+
+#define GST_TYPE_VIDEO_DECODER \
+  (gst_video_decoder_get_type())
+#define GST_VIDEO_DECODER(obj) \
+  (G_TYPE_CHECK_INSTANCE_CAST((obj),GST_TYPE_VIDEO_DECODER,GstVideoDecoder))
+#define GST_VIDEO_DECODER_CLASS(klass) \
+  (G_TYPE_CHECK_CLASS_CAST((klass),GST_TYPE_VIDEO_DECODER,GstVideoDecoderClass))
+#define GST_VIDEO_DECODER_GET_CLASS(obj) \
+  (G_TYPE_INSTANCE_GET_CLASS((obj),GST_TYPE_VIDEO_DECODER,GstVideoDecoderClass))
+#define GST_IS_VIDEO_DECODER(obj) \
+  (G_TYPE_CHECK_INSTANCE_TYPE((obj),GST_TYPE_VIDEO_DECODER))
+#define GST_IS_VIDEO_DECODER_CLASS(obj) \
+  (G_TYPE_CHECK_CLASS_TYPE((klass),GST_TYPE_VIDEO_DECODER))
+
+/**
+ * GST_VIDEO_DECODER_SINK_NAME:
+ *
+ * The name of the templates for the sink pad.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_DECODER_SINK_NAME    "sink"
+/**
+ * GST_VIDEO_DECODER_SRC_NAME:
+ *
+ * The name of the templates for the source pad.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_DECODER_SRC_NAME     "src"
+
+/**
+ * GST_VIDEO_DECODER_SRC_PAD:
+ * @obj: a #GstVideoDecoder
+ *
+ * Gives the pointer to the source #GstPad object of the element.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_DECODER_SRC_PAD(obj)         (((GstVideoDecoder *) (obj))->srcpad)
+
+/**
+ * GST_VIDEO_DECODER_SINK_PAD:
+ * @obj: a #GstVideoDecoder
+ *
+ * Gives the pointer to the sink #GstPad object of the element.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_DECODER_SINK_PAD(obj)        (((GstVideoDecoder *) (obj))->sinkpad)
+/**
+ * GST_VIDEO_DECODER_FLOW_NEED_DATA:
+ *
+ * Returned while parsing to indicate more data is needed.
+ *
+ * Since: 0.10.37
+ **/
+#define GST_VIDEO_DECODER_FLOW_NEED_DATA GST_FLOW_CUSTOM_SUCCESS
+
+/**
+ * GST_VIDEO_DECODER_FLOW_DROPPED:
+ *
+ * Returned when the event/buffer should be dropped.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_DECODER_FLOW_DROPPED GST_FLOW_CUSTOM_SUCCESS_1
+
+/**
+ * GST_VIDEO_DECODER_INPUT_SEGMENT:
+ * @obj: base decoder instance
+ *
+ * Gives the segment of the element.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_DECODER_INPUT_SEGMENT(obj)     (GST_VIDEO_DECODER_CAST (obj)->input_segment)
+
+/**
+ * GST_VIDEO_DECODER_OUTPUT_SEGMENT:
+ * @obj: base decoder instance
+ *
+ * Gives the segment of the element.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_DECODER_OUTPUT_SEGMENT(obj)     (GST_VIDEO_DECODER_CAST (obj)->output_segment)
+
+/**
+ * GST_VIDEO_DECODER_STREAM_LOCK:
+ * @decoder: video decoder instance
+ *
+ * Obtain a lock to protect the decoder function from concurrent access.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_DECODER_STREAM_LOCK(decoder) g_static_rec_mutex_lock (&GST_VIDEO_DECODER (decoder)->stream_lock)
+
+/**
+ * GST_VIDEO_DECODER_STREAM_UNLOCK:
+ * @decoder: video decoder instance
+ *
+ * Release the lock that protects the decoder function from concurrent access.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_DECODER_STREAM_UNLOCK(decoder) g_static_rec_mutex_unlock (&GST_VIDEO_DECODER (decoder)->stream_lock)
+
+typedef struct _GstVideoDecoder GstVideoDecoder;
+typedef struct _GstVideoDecoderClass GstVideoDecoderClass;
+typedef struct _GstVideoDecoderPrivate GstVideoDecoderPrivate;
+
+
+/* do not use this one, use macro below */
+GstFlowReturn _gst_video_decoder_error (GstVideoDecoder *dec, gint weight,
+                                             GQuark domain, gint code,
+                                             gchar *txt, gchar *debug,
+                                             const gchar *file, const gchar *function,
+                                             gint line);
+
+/**
+ * GST_VIDEO_DECODER_ERROR:
+ * @el:     the base video decoder element that generates the error
+ * @weight: element defined weight of the error, added to error count
+ * @domain: like CORE, LIBRARY, RESOURCE or STREAM (see #gstreamer-GstGError)
+ * @code:   error code defined for that domain (see #gstreamer-GstGError)
+ * @text:   the message to display (format string and args enclosed in
+ *          parentheses)
+ * @debug:  debugging information for the message (format string and args
+ *          enclosed in parentheses)
+ * @ret:    variable to receive return value
+ *
+ * Utility function that video decoder elements can use in case they encountered
+ * a data processing error that may be fatal for the current "data unit" but
+ * need not prevent subsequent decoding.  Such errors are counted and if there
+ * are too many, as configured in the context's max_errors, the pipeline will
+ * post an error message and the application will be requested to stop further
+ * media processing.  Otherwise, it is considered a "glitch" and only a warning
+ * is logged. In either case, @ret is set to the proper value to
+ * return to upstream/caller (indicating either GST_FLOW_ERROR or GST_FLOW_OK).
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_DECODER_ERROR(el, w, domain, code, text, debug, ret) \
+G_STMT_START {                                                              \
+  gchar *__txt = _gst_element_error_printf text;                            \
+  gchar *__dbg = _gst_element_error_printf debug;                           \
+  GstVideoDecoder *dec = GST_VIDEO_DECODER (el);                   \
+  ret = _gst_video_decoder_error (dec, w, GST_ ## domain ## _ERROR,    \
+      GST_ ## domain ## _ERROR_ ## code, __txt, __dbg, __FILE__,            \
+      GST_FUNCTION, __LINE__);                                              \
+} G_STMT_END
+
+/**
+ * GST_VIDEO_DECODER_MAX_ERRORS:
+ *
+ * Default maximum number of errors tolerated before signaling error.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_DECODER_MAX_ERRORS     10
+
+
+/**
+ * GstVideoDecoder:
+ *
+ * The opaque #GstVideoDecoder data structure.
+ *
+ * Since: 0.10.37
+ */
+struct _GstVideoDecoder
+{
+  /*< private >*/
+  GstElement     element;
+
+  /*< protected >*/
+  GstPad         *sinkpad;
+  GstPad         *srcpad;
+
+  /* protects all data processing, i.e. is locked
+   * in the chain function, finish_frame and when
+   * processing serialized events */
+  GStaticRecMutex stream_lock;
+
+  /* MT-protected (with STREAM_LOCK) */
+  GstSegment      input_segment;
+  GstSegment      output_segment;
+
+  GstVideoDecoderPrivate *priv;
+
+  /*< private >*/
+  gpointer        _gst_reserved[GST_PADDING_LARGE];
+};
+
+/**
+ * GstVideoDecoderClass:
+ * @open:           Optional.
+ *                  Called when the element changes to GST_STATE_READY.
+ *                  Allows opening external resources.
+ * @close:          Optional.
+ *                  Called when the element changes to GST_STATE_NULL.
+ *                  Allows closing external resources.
+ * @start:          Optional.
+ *                  Called when the element starts processing.
+ *                  Allows opening external resources.
+ * @stop:           Optional.
+ *                  Called when the element stops processing.
+ *                  Allows closing external resources.
+ * @set_format:     Notifies subclass of incoming data format (caps).
+ * @parse:          Required for non-packetized input.
+ *                  Allows chopping incoming data into manageable units (frames)
+ *                  for subsequent decoding.
+ * @reset:          Optional.
+ *                  Allows subclass (decoder) to perform post-seek semantics reset.
+ * @handle_frame:   Provides input data frame to subclass.
+ * @finish:         Optional.
+ *                  Called to request subclass to dispatch any pending remaining
+ *                  data (e.g. at EOS).
+ * @sink_event:     Optional.
+ *                  Event handler on the sink pad. This function should return
+ *                  TRUE if the event was handled and should be discarded
+ *                  (i.e. not unref'ed).
+ * @src_event:      Optional.
+ *                  Event handler on the source pad. This function should return
+ *                  TRUE if the event was handled and should be discarded
+ *                  (i.e. not unref'ed).
+ *
+ * Subclasses can override any of the available virtual methods or not, as
+ * needed. At minimum @handle_frame needs to be overridden, and @set_format
+ * and likely as well.  If non-packetized input is supported or expected,
+ * @parse needs to be overridden as well.
+ *
+ * Since: 0.10.37
+ */
+struct _GstVideoDecoderClass
+{
+  /*< private >*/
+  GstElementClass element_class;
+
+  /*< public >*/
+  gboolean      (*open)           (GstVideoDecoder *decoder);
+
+  gboolean      (*close)          (GstVideoDecoder *decoder);
+
+  gboolean      (*start)          (GstVideoDecoder *decoder);
+
+  gboolean      (*stop)           (GstVideoDecoder *decoder);
+
+  GstFlowReturn (*parse)          (GstVideoDecoder *decoder,
+				   GstVideoCodecFrame *frame,
+				   GstAdapter *adapter,
+				   gboolean at_eos);
+
+  gboolean      (*set_format)     (GstVideoDecoder *decoder,
+				   GstVideoCodecState * state);
+
+  gboolean      (*reset)          (GstVideoDecoder *decoder,
+				   gboolean hard);
+
+  GstFlowReturn (*finish)         (GstVideoDecoder *decoder);
+
+  GstFlowReturn (*handle_frame)   (GstVideoDecoder *decoder,
+				   GstVideoCodecFrame *frame);
+
+  gboolean      (*sink_event)     (GstVideoDecoder *decoder,
+				   GstEvent *event);
+
+  gboolean      (*src_event)      (GstVideoDecoder *decoder,
+				   GstEvent *event);
+
+
+  /*< private >*/
+  gpointer       _gst_reserved[GST_PADDING_LARGE];
+};
+
+GType    gst_video_decoder_get_type (void);
+
+/* Context parameters */
+void     gst_video_decoder_set_packetized (GstVideoDecoder * decoder,
+					   gboolean packetized);
+
+gboolean gst_video_decoder_get_packetized (GstVideoDecoder * decoder);
+
+void     gst_video_decoder_set_estimate_rate (GstVideoDecoder * dec,
+					      gboolean          enabled);
+
+gint     gst_video_decoder_get_estimate_rate (GstVideoDecoder * dec);
+
+void     gst_video_decoder_set_max_errors (GstVideoDecoder * dec,
+					   gint              num);
+
+gint     gst_video_decoder_get_max_errors (GstVideoDecoder * dec);
+
+void     gst_video_decoder_set_latency (GstVideoDecoder *decoder,
+					GstClockTime min_latency,
+					GstClockTime max_latency);
+void     gst_video_decoder_get_latency (GstVideoDecoder *decoder,
+					GstClockTime *min_latency,
+					GstClockTime *max_latency);
+
+
+/* Object methods */
+
+GstVideoCodecFrame *gst_video_decoder_get_frame        (GstVideoDecoder *decoder,
+						        int frame_number);
+
+GstVideoCodecFrame *gst_video_decoder_get_oldest_frame (GstVideoDecoder *decoder);
+
+GList *             gst_video_decoder_get_frames       (GstVideoDecoder *decoder);
+
+/* Parsing related methods */
+void           gst_video_decoder_add_to_frame     (GstVideoDecoder *decoder,
+						   int n_bytes);
+GstFlowReturn  gst_video_decoder_have_frame       (GstVideoDecoder *decoder);
+
+GstBuffer     *gst_video_decoder_alloc_output_buffer (GstVideoDecoder * decoder);
+
+GstFlowReturn  gst_video_decoder_alloc_output_frame  (GstVideoDecoder *decoder,
+						      GstVideoCodecFrame *frame);
+
+GstVideoCodecState *gst_video_decoder_set_output_state (GstVideoDecoder *decoder,
+							GstVideoFormat fmt, guint width, guint height,
+							GstVideoCodecState *reference);
+
+GstVideoCodecState *gst_video_decoder_get_output_state (GstVideoDecoder *decoder);
+
+gboolean         gst_video_decoder_negotiate           (GstVideoDecoder * decoder);
+
+GstClockTimeDiff gst_video_decoder_get_max_decode_time (GstVideoDecoder *decoder,
+							GstVideoCodecFrame *frame);
+
+gdouble          gst_video_decoder_get_qos_proportion (GstVideoDecoder * decoder);
+
+GstFlowReturn    gst_video_decoder_finish_frame (GstVideoDecoder *decoder,
+						 GstVideoCodecFrame *frame);
+
+GstFlowReturn    gst_video_decoder_drop_frame (GstVideoDecoder *dec,
+					       GstVideoCodecFrame *frame);
+
+G_END_DECLS
+
+#endif
+
diff --git a/gst-libs/gst/video/gstvideoencoder.c b/gst-libs/gst/video/gstvideoencoder.c
new file mode 100644
index 0000000..7ca6aab
--- /dev/null
+++ b/gst-libs/gst/video/gstvideoencoder.c
@@ -0,0 +1,1712 @@
+/* GStreamer
+ * Copyright (C) 2008 David Schleef <ds@schleef.org>
+ * Copyright (C) 2011 Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>.
+ * Copyright (C) 2011 Nokia Corporation. All rights reserved.
+ *   Contact: Stefan Kost <stefan.kost@nokia.com>
+ * Copyright (C) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+/**
+ * SECTION:gstvideoencoder
+ * @short_description: Base class for video encoders
+ * @see_also:
+ *
+ * This base class is for video encoders turning raw video into
+ * encoded video data.
+ *
+ * GstVideoEncoder and subclass should cooperate as follows.
+ * <orderedlist>
+ * <listitem>
+ *   <itemizedlist><title>Configuration</title>
+ *   <listitem><para>
+ *     Initially, GstVideoEncoder calls @start when the encoder element
+ *     is activated, which allows subclass to perform any global setup.
+ *   </para></listitem>
+ *   <listitem><para>
+ *     GstVideoEncoder calls @set_format to inform subclass of the format
+ *     of input video data that it is about to receive.  Subclass should
+ *     setup for encoding and configure base class as appropriate
+ *     (e.g. latency). While unlikely, it might be called more than once,
+ *     if changing input parameters require reconfiguration.  Baseclass
+ *     will ensure that processing of current configuration is finished.
+ *   </para></listitem>
+ *   <listitem><para>
+ *     GstVideoEncoder calls @stop at end of all processing.
+ *   </para></listitem>
+ *   </itemizedlist>
+ * </listitem>
+ * <listitem>
+ *   <itemizedlist>
+ *   <title>Data processing</title>
+ *     <listitem><para>
+ *       Base class collects input data and metadata into a frame and hands
+ *       this to subclass' @handle_frame.
+ *     </para></listitem>
+ *     <listitem><para>
+ *       If codec processing results in encoded data, subclass should call
+ *       @gst_video_encoder_finish_frame to have encoded data pushed
+ *       downstream.
+ *     </para></listitem>
+ *     <listitem><para>
+ *       If implemented, baseclass calls subclass @pre_push just prior to
+ *       pushing to allow subclasses to modify some metadata on the buffer.
+ *       If it returns GST_FLOW_OK, the buffer is pushed downstream.
+ *     </para></listitem>
+ *     <listitem><para>
+ *       GstVideoEncoderClass will handle both srcpad and sinkpad events.
+ *       Sink events will be passed to subclass if @event callback has been
+ *       provided.
+ *     </para></listitem>
+ *   </itemizedlist>
+ * </listitem>
+ * <listitem>
+ *   <itemizedlist><title>Shutdown phase</title>
+ *   <listitem><para>
+ *     GstVideoEncoder class calls @stop to inform the subclass that data
+ *     parsing will be stopped.
+ *   </para></listitem>
+ *   </itemizedlist>
+ * </listitem>
+ * </orderedlist>
+ *
+ * Subclass is responsible for providing pad template caps for
+ * source and sink pads. The pads need to be named "sink" and "src". It should
+ * also be able to provide fixed src pad caps in @getcaps by the time it calls
+ * @gst_video_encoder_finish_frame.
+ *
+ * Things that subclass need to take care of:
+ * <itemizedlist>
+ *   <listitem><para>Provide pad templates</para></listitem>
+ *   <listitem><para>
+ *      Provide source pad caps before pushing the first buffer
+ *   </para></listitem>
+ *   <listitem><para>
+ *      Accept data in @handle_frame and provide encoded results to
+ *      @gst_video_encoder_finish_frame.
+ *   </para></listitem>
+ * </itemizedlist>
+ *
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+/* TODO
+ *
+ * * Change _set_output_format() to steal the reference of the provided caps
+ * * Calculate actual latency based on input/output timestamp/frame_number
+ *   and if it exceeds the recorded one, save it and emit a GST_MESSAGE_LATENCY
+ */
+
+/* FIXME 0.11: suppress warnings for deprecated API such as GStaticRecMutex
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
+#include "gstvideoencoder.h"
+#include "gstvideoutils.h"
+
+#include <string.h>
+
+GST_DEBUG_CATEGORY (videoencoder_debug);
+#define GST_CAT_DEFAULT videoencoder_debug
+
+#define GST_VIDEO_ENCODER_GET_PRIVATE(obj)  \
+    (G_TYPE_INSTANCE_GET_PRIVATE ((obj), GST_TYPE_VIDEO_ENCODER, \
+        GstVideoEncoderPrivate))
+
+struct _GstVideoEncoderPrivate
+{
+  guint64 presentation_frame_number;
+  int distance_from_sync;
+
+  /* FIXME : (and introduce a context ?) */
+  gboolean drained;
+  gboolean at_eos;
+
+  gint64 min_latency;
+  gint64 max_latency;
+
+  GList *current_frame_events;
+
+  GList *headers;
+  gboolean new_headers;         /* Whether new headers were just set */
+
+  GList *force_key_unit;        /* List of pending forced keyunits */
+
+  guint32 system_frame_number;
+
+  GList *frames;                /* Protected with OBJECT_LOCK */
+  GstVideoCodecState *input_state;
+  GstVideoCodecState *output_state;
+  gboolean output_state_changed;
+
+  gint64 bytes;
+  gint64 time;
+};
+
+typedef struct _ForcedKeyUnitEvent ForcedKeyUnitEvent;
+struct _ForcedKeyUnitEvent
+{
+  GstClockTime running_time;
+  gboolean pending;             /* TRUE if this was requested already */
+  gboolean all_headers;
+  guint count;
+};
+
+static void
+forced_key_unit_event_free (ForcedKeyUnitEvent * evt)
+{
+  g_slice_free (ForcedKeyUnitEvent, evt);
+}
+
+static ForcedKeyUnitEvent *
+forced_key_unit_event_new (GstClockTime running_time, gboolean all_headers,
+    guint count)
+{
+  ForcedKeyUnitEvent *evt = g_slice_new0 (ForcedKeyUnitEvent);
+
+  evt->running_time = running_time;
+  evt->all_headers = all_headers;
+  evt->count = count;
+
+  return evt;
+}
+
+static void gst_video_encoder_finalize (GObject * object);
+
+static gboolean gst_video_encoder_sink_setcaps (GstPad * pad, GstCaps * caps);
+static GstCaps *gst_video_encoder_sink_getcaps (GstPad * pad);
+static gboolean gst_video_encoder_src_event (GstPad * pad, GstEvent * event);
+static gboolean gst_video_encoder_sink_event (GstPad * pad, GstEvent * event);
+static GstFlowReturn gst_video_encoder_chain (GstPad * pad, GstBuffer * buf);
+static GstStateChangeReturn gst_video_encoder_change_state (GstElement *
+    element, GstStateChange transition);
+static const GstQueryType *gst_video_encoder_get_query_types (GstPad * pad);
+static gboolean gst_video_encoder_src_query (GstPad * pad, GstQuery * query);
+static GstVideoCodecFrame *gst_video_encoder_new_frame (GstVideoEncoder *
+    encoder, GstBuffer * buf, GstClockTime timestamp, GstClockTime duration);
+
+static void
+_do_init (GType object_type)
+{
+  const GInterfaceInfo preset_interface_info = {
+    NULL,                       /* interface_init */
+    NULL,                       /* interface_finalize */
+    NULL                        /* interface_data */
+  };
+
+  g_type_add_interface_static (object_type, GST_TYPE_PRESET,
+      &preset_interface_info);
+}
+
+GST_BOILERPLATE_FULL (GstVideoEncoder, gst_video_encoder,
+    GstElement, GST_TYPE_ELEMENT, _do_init);
+
+static void
+gst_video_encoder_base_init (gpointer g_class)
+{
+  GST_DEBUG_CATEGORY_INIT (videoencoder_debug, "videoencoder", 0,
+      "Base Video Encoder");
+}
+
+static void
+gst_video_encoder_class_init (GstVideoEncoderClass * klass)
+{
+  GObjectClass *gobject_class;
+  GstElementClass *gstelement_class;
+
+  gobject_class = G_OBJECT_CLASS (klass);
+  gstelement_class = GST_ELEMENT_CLASS (klass);
+
+  g_type_class_add_private (klass, sizeof (GstVideoEncoderPrivate));
+
+  gobject_class->finalize = gst_video_encoder_finalize;
+
+  gstelement_class->change_state =
+      GST_DEBUG_FUNCPTR (gst_video_encoder_change_state);
+}
+
+static void
+gst_video_encoder_reset (GstVideoEncoder * encoder)
+{
+  GstVideoEncoderPrivate *priv = encoder->priv;
+  GList *g;
+
+  GST_VIDEO_ENCODER_STREAM_LOCK (encoder);
+
+  priv->presentation_frame_number = 0;
+  priv->distance_from_sync = 0;
+
+  g_list_foreach (priv->force_key_unit, (GFunc) forced_key_unit_event_free,
+      NULL);
+  g_list_free (priv->force_key_unit);
+  priv->force_key_unit = NULL;
+
+  priv->drained = TRUE;
+  priv->min_latency = 0;
+  priv->max_latency = 0;
+
+  g_list_foreach (priv->headers, (GFunc) gst_event_unref, NULL);
+  g_list_free (priv->headers);
+  priv->headers = NULL;
+  priv->new_headers = FALSE;
+
+  g_list_foreach (priv->current_frame_events, (GFunc) gst_event_unref, NULL);
+  g_list_free (priv->current_frame_events);
+  priv->current_frame_events = NULL;
+
+  for (g = priv->frames; g; g = g->next) {
+    gst_video_codec_frame_unref ((GstVideoCodecFrame *) g->data);
+  }
+  g_list_free (priv->frames);
+  priv->frames = NULL;
+
+  priv->bytes = 0;
+  priv->time = 0;
+
+  if (priv->input_state)
+    gst_video_codec_state_unref (priv->input_state);
+  priv->input_state = NULL;
+  if (priv->output_state)
+    gst_video_codec_state_unref (priv->output_state);
+  priv->output_state = NULL;
+
+  GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+}
+
+static void
+gst_video_encoder_init (GstVideoEncoder * encoder, GstVideoEncoderClass * klass)
+{
+  GstVideoEncoderPrivate *priv;
+  GstPadTemplate *pad_template;
+  GstPad *pad;
+
+  GST_DEBUG_OBJECT (encoder, "gst_video_encoder_init");
+
+  priv = encoder->priv = GST_VIDEO_ENCODER_GET_PRIVATE (encoder);
+
+  pad_template =
+      gst_element_class_get_pad_template (GST_ELEMENT_CLASS (klass), "sink");
+  g_return_if_fail (pad_template != NULL);
+
+  encoder->sinkpad = pad = gst_pad_new_from_template (pad_template, "sink");
+
+  gst_pad_set_chain_function (pad, GST_DEBUG_FUNCPTR (gst_video_encoder_chain));
+  gst_pad_set_event_function (pad,
+      GST_DEBUG_FUNCPTR (gst_video_encoder_sink_event));
+  gst_pad_set_setcaps_function (pad,
+      GST_DEBUG_FUNCPTR (gst_video_encoder_sink_setcaps));
+  gst_pad_set_getcaps_function (pad,
+      GST_DEBUG_FUNCPTR (gst_video_encoder_sink_getcaps));
+  gst_element_add_pad (GST_ELEMENT (encoder), encoder->sinkpad);
+
+  pad_template =
+      gst_element_class_get_pad_template (GST_ELEMENT_CLASS (klass), "src");
+  g_return_if_fail (pad_template != NULL);
+
+  encoder->srcpad = pad = gst_pad_new_from_template (pad_template, "src");
+
+  gst_pad_set_query_type_function (pad,
+      GST_DEBUG_FUNCPTR (gst_video_encoder_get_query_types));
+  gst_pad_set_query_function (pad,
+      GST_DEBUG_FUNCPTR (gst_video_encoder_src_query));
+  gst_pad_set_event_function (pad,
+      GST_DEBUG_FUNCPTR (gst_video_encoder_src_event));
+  gst_element_add_pad (GST_ELEMENT (encoder), encoder->srcpad);
+
+  gst_segment_init (&encoder->input_segment, GST_FORMAT_TIME);
+  gst_segment_init (&encoder->output_segment, GST_FORMAT_TIME);
+
+  g_static_rec_mutex_init (&encoder->stream_lock);
+
+  priv->at_eos = FALSE;
+  priv->headers = NULL;
+  priv->new_headers = FALSE;
+
+  gst_video_encoder_reset (encoder);
+}
+
+static gboolean
+gst_video_encoded_video_convert (gint64 bytes, gint64 time,
+    GstFormat src_format, gint64 src_value, GstFormat * dest_format,
+    gint64 * dest_value)
+{
+  gboolean res = FALSE;
+
+  g_return_val_if_fail (dest_format != NULL, FALSE);
+  g_return_val_if_fail (dest_value != NULL, FALSE);
+
+  if (G_UNLIKELY (src_format == *dest_format || src_value == 0 ||
+          src_value == -1)) {
+    if (dest_value)
+      *dest_value = src_value;
+    return TRUE;
+  }
+
+  if (bytes <= 0 || time <= 0) {
+    GST_DEBUG ("not enough metadata yet to convert");
+    goto exit;
+  }
+
+  switch (src_format) {
+    case GST_FORMAT_BYTES:
+      switch (*dest_format) {
+        case GST_FORMAT_TIME:
+          *dest_value = gst_util_uint64_scale (src_value, time, bytes);
+          res = TRUE;
+          break;
+        default:
+          res = FALSE;
+      }
+      break;
+    case GST_FORMAT_TIME:
+      switch (*dest_format) {
+        case GST_FORMAT_BYTES:
+          *dest_value = gst_util_uint64_scale (src_value, bytes, time);
+          res = TRUE;
+          break;
+        default:
+          res = FALSE;
+      }
+      break;
+    default:
+      GST_DEBUG ("unhandled conversion from %d to %d", src_format,
+          *dest_format);
+      res = FALSE;
+  }
+
+exit:
+  return res;
+}
+
+/**
+ * gst_video_encoder_set_headers:
+ * @encoder: a #GstVideoEncoder
+ * @headers: (transfer full) (element-type GstBuffer): a list of #GstBuffer containing the codec header
+ *
+ * Set the codec headers to be sent downstream whenever requested.
+ *
+ * Since: 0.10.37
+ */
+void
+gst_video_encoder_set_headers (GstVideoEncoder * video_encoder, GList * headers)
+{
+  GST_VIDEO_ENCODER_STREAM_LOCK (video_encoder);
+
+  GST_DEBUG_OBJECT (video_encoder, "new headers %p", headers);
+  if (video_encoder->priv->headers) {
+    g_list_foreach (video_encoder->priv->headers, (GFunc) gst_buffer_unref,
+        NULL);
+    g_list_free (video_encoder->priv->headers);
+  }
+  video_encoder->priv->headers = headers;
+  video_encoder->priv->new_headers = TRUE;
+
+  GST_VIDEO_ENCODER_STREAM_UNLOCK (video_encoder);
+}
+
+static gboolean
+gst_video_encoder_drain (GstVideoEncoder * enc)
+{
+  GstVideoEncoderPrivate *priv;
+  GstVideoEncoderClass *enc_class;
+  gboolean ret = TRUE;
+
+  enc_class = GST_VIDEO_ENCODER_GET_CLASS (enc);
+  priv = enc->priv;
+
+  GST_DEBUG_OBJECT (enc, "draining");
+
+  if (priv->drained) {
+    GST_DEBUG_OBJECT (enc, "already drained");
+    return TRUE;
+  }
+
+  if (enc_class->reset) {
+    GST_DEBUG_OBJECT (enc, "requesting subclass to finish");
+    ret = enc_class->reset (enc, TRUE);
+  }
+  /* everything should be away now */
+  if (priv->frames) {
+    /* not fatal/impossible though if subclass/enc eats stuff */
+    g_list_foreach (priv->frames, (GFunc) gst_video_codec_frame_unref, NULL);
+    g_list_free (priv->frames);
+    priv->frames = NULL;
+  }
+
+  return ret;
+}
+
+static GstVideoCodecState *
+_new_output_state (GstCaps * caps, GstVideoCodecState * reference)
+{
+  GstVideoCodecState *state;
+
+  state = g_slice_new0 (GstVideoCodecState);
+  state->ref_count = 1;
+  gst_video_info_init (&state->info);
+  gst_video_info_set_format (&state->info, GST_VIDEO_FORMAT_ENCODED, 0, 0);
+
+  state->caps = caps;
+
+  if (reference) {
+    GstVideoInfo *tgt, *ref;
+
+    tgt = &state->info;
+    ref = &reference->info;
+
+    /* Copy over extra fields from reference state */
+    tgt->interlace_mode = ref->interlace_mode;
+    tgt->flags = ref->flags;
+    tgt->width = ref->width;
+    tgt->height = ref->height;
+    tgt->chroma_site = ref->chroma_site;
+    tgt->colorimetry = ref->colorimetry;
+    tgt->par_n = ref->par_n;
+    tgt->par_d = ref->par_d;
+    tgt->fps_n = ref->fps_n;
+    tgt->fps_d = ref->fps_d;
+  }
+
+  return state;
+}
+
+static GstVideoCodecState *
+_new_input_state (GstCaps * caps)
+{
+  GstVideoCodecState *state;
+
+  state = g_slice_new0 (GstVideoCodecState);
+  state->ref_count = 1;
+  gst_video_info_init (&state->info);
+  if (G_UNLIKELY (!gst_video_info_from_caps (&state->info, caps)))
+    goto parse_fail;
+  state->caps = gst_caps_ref (caps);
+
+  return state;
+
+parse_fail:
+  {
+    g_slice_free (GstVideoCodecState, state);
+    return NULL;
+  }
+}
+
+static gboolean
+gst_video_encoder_sink_setcaps (GstPad * pad, GstCaps * caps)
+{
+  GstVideoEncoder *encoder;
+  GstVideoEncoderClass *encoder_class;
+  GstVideoCodecState *state;
+  gboolean ret;
+  gboolean samecaps = FALSE;
+
+  encoder = GST_VIDEO_ENCODER (gst_pad_get_parent (pad));
+  encoder_class = GST_VIDEO_ENCODER_GET_CLASS (encoder);
+
+  /* subclass should do something here ... */
+  g_return_val_if_fail (encoder_class->set_format != NULL, FALSE);
+
+  GST_DEBUG_OBJECT (encoder, "setcaps %" GST_PTR_FORMAT, caps);
+
+  state = _new_input_state (caps);
+  if (G_UNLIKELY (!state))
+    goto parse_fail;
+
+  GST_VIDEO_ENCODER_STREAM_LOCK (encoder);
+
+  if (encoder->priv->input_state)
+    samecaps =
+        gst_video_info_is_equal (&state->info,
+        &encoder->priv->input_state->info);
+
+  if (!samecaps) {
+    /* arrange draining pending frames */
+    gst_video_encoder_drain (encoder);
+
+    /* and subclass should be ready to configure format at any time around */
+    ret = encoder_class->set_format (encoder, state);
+    if (ret) {
+      if (encoder->priv->input_state)
+        gst_video_codec_state_unref (encoder->priv->input_state);
+      encoder->priv->input_state = state;
+    } else
+      gst_video_codec_state_unref (state);
+  } else {
+    /* no need to stir things up */
+    GST_DEBUG_OBJECT (encoder,
+        "new video format identical to configured format");
+    gst_video_codec_state_unref (state);
+    ret = TRUE;
+  }
+
+  GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+
+  if (!ret)
+    GST_WARNING_OBJECT (encoder, "rejected caps %" GST_PTR_FORMAT, caps);
+
+  gst_object_unref (encoder);
+
+  return ret;
+
+parse_fail:
+  {
+    GST_WARNING_OBJECT (encoder, "Failed to parse caps");
+    gst_object_unref (encoder);
+    return FALSE;
+  }
+}
+
+/**
+ * gst_video_encoder_proxy_getcaps:
+ * @enc: a #GstVideoEncoder
+ * @caps: initial caps
+ *
+ * Returns caps that express @caps (or sink template caps if @caps == NULL)
+ * restricted to resolution/format/... combinations supported by downstream
+ * elements (e.g. muxers).
+ *
+ * Returns: a #GstCaps owned by caller
+ *
+ * Since: 0.10.37
+ */
+GstCaps *
+gst_video_encoder_proxy_getcaps (GstVideoEncoder * encoder, GstCaps * caps)
+{
+  const GstCaps *templ_caps;
+  GstCaps *allowed;
+  GstCaps *fcaps, *filter_caps;
+  gint i, j;
+
+  /* Allow downstream to specify width/height/framerate/PAR constraints
+   * and forward them upstream for video converters to handle
+   */
+  templ_caps = caps ? caps : gst_pad_get_pad_template_caps (encoder->sinkpad);
+  allowed = gst_pad_get_allowed_caps (encoder->srcpad);
+
+  if (!allowed || gst_caps_is_empty (allowed) || gst_caps_is_any (allowed)) {
+    fcaps = gst_caps_copy (templ_caps);
+    goto done;
+  }
+
+  GST_LOG_OBJECT (encoder, "template caps %" GST_PTR_FORMAT, templ_caps);
+  GST_LOG_OBJECT (encoder, "allowed caps %" GST_PTR_FORMAT, allowed);
+
+  filter_caps = gst_caps_new_empty ();
+
+  for (i = 0; i < gst_caps_get_size (templ_caps); i++) {
+    GQuark q_name =
+        gst_structure_get_name_id (gst_caps_get_structure (templ_caps, i));
+
+    for (j = 0; j < gst_caps_get_size (allowed); j++) {
+      const GstStructure *allowed_s = gst_caps_get_structure (allowed, j);
+      const GValue *val;
+      GstStructure *s;
+
+      s = gst_structure_id_empty_new (q_name);
+      if ((val = gst_structure_get_value (allowed_s, "width")))
+        gst_structure_set_value (s, "width", val);
+      if ((val = gst_structure_get_value (allowed_s, "height")))
+        gst_structure_set_value (s, "height", val);
+      if ((val = gst_structure_get_value (allowed_s, "framerate")))
+        gst_structure_set_value (s, "framerate", val);
+      if ((val = gst_structure_get_value (allowed_s, "pixel-aspect-ratio")))
+        gst_structure_set_value (s, "pixel-aspect-ratio", val);
+
+      gst_caps_merge_structure (filter_caps, s);
+    }
+  }
+
+  fcaps = gst_caps_intersect (filter_caps, templ_caps);
+  gst_caps_unref (filter_caps);
+
+done:
+  gst_caps_replace (&allowed, NULL);
+
+  GST_LOG_OBJECT (encoder, "proxy caps %" GST_PTR_FORMAT, fcaps);
+
+  return fcaps;
+}
+
+static GstCaps *
+gst_video_encoder_sink_getcaps (GstPad * pad)
+{
+  GstVideoEncoder *encoder;
+  GstVideoEncoderClass *klass;
+  GstCaps *caps;
+
+  encoder = GST_VIDEO_ENCODER (gst_pad_get_parent (pad));
+  klass = GST_VIDEO_ENCODER_GET_CLASS (encoder);
+
+  if (klass->getcaps)
+    caps = klass->getcaps (encoder);
+  else
+    caps = gst_video_encoder_proxy_getcaps (encoder, NULL);
+
+  GST_LOG_OBJECT (encoder, "Returning caps %" GST_PTR_FORMAT, caps);
+
+  gst_object_unref (encoder);
+
+  return caps;
+}
+
+static void
+gst_video_encoder_finalize (GObject * object)
+{
+  GstVideoEncoder *encoder;
+
+  GST_DEBUG_OBJECT (object, "finalize");
+
+  encoder = GST_VIDEO_ENCODER (object);
+  if (encoder->priv->headers) {
+    g_list_foreach (encoder->priv->headers, (GFunc) gst_buffer_unref, NULL);
+    g_list_free (encoder->priv->headers);
+  }
+  g_static_rec_mutex_free (&encoder->stream_lock);
+
+  G_OBJECT_CLASS (parent_class)->finalize (object);
+}
+
+static gboolean
+gst_video_encoder_push_event (GstVideoEncoder * encoder, GstEvent * event)
+{
+  switch (GST_EVENT_TYPE (event)) {
+    case GST_EVENT_NEWSEGMENT:
+    {
+      gboolean update;
+      double rate;
+      double applied_rate;
+      GstFormat format;
+      gint64 start;
+      gint64 stop;
+      gint64 position;
+
+      GST_VIDEO_ENCODER_STREAM_LOCK (encoder);
+      gst_event_parse_new_segment_full (event, &update, &rate, &applied_rate,
+          &format, &start, &stop, &position);
+
+      GST_DEBUG_OBJECT (encoder, "newseg rate %g, applied rate %g, "
+          "format %d, start = %" GST_TIME_FORMAT ", stop = %" GST_TIME_FORMAT
+          ", pos = %" GST_TIME_FORMAT, rate, applied_rate, format,
+          GST_TIME_ARGS (start), GST_TIME_ARGS (stop),
+          GST_TIME_ARGS (position));
+
+      if (format != GST_FORMAT_TIME) {
+        GST_DEBUG_OBJECT (encoder, "received non TIME newsegment");
+        GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+        break;
+      }
+
+      gst_segment_set_newsegment_full (&encoder->output_segment, update, rate,
+          applied_rate, format, start, stop, position);
+      GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+      break;
+    }
+    default:
+      break;
+  }
+
+  return gst_pad_push_event (encoder->srcpad, event);
+}
+
+static gboolean
+gst_video_encoder_sink_eventfunc (GstVideoEncoder * encoder, GstEvent * event)
+{
+  GstVideoEncoderClass *encoder_class;
+  gboolean ret = FALSE;
+
+  encoder_class = GST_VIDEO_ENCODER_GET_CLASS (encoder);
+
+  switch (GST_EVENT_TYPE (event)) {
+    case GST_EVENT_EOS:
+    {
+      GstFlowReturn flow_ret;
+
+      GST_VIDEO_ENCODER_STREAM_LOCK (encoder);
+      encoder->priv->at_eos = TRUE;
+
+      if (encoder_class->finish) {
+        flow_ret = encoder_class->finish (encoder);
+      } else {
+        flow_ret = GST_FLOW_OK;
+      }
+
+      ret = (flow_ret == GST_VIDEO_ENCODER_FLOW_DROPPED);
+      GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+      break;
+    }
+    case GST_EVENT_NEWSEGMENT:
+    {
+      gboolean update;
+      double rate;
+      double applied_rate;
+      GstFormat format;
+      gint64 start;
+      gint64 stop;
+      gint64 position;
+
+      GST_VIDEO_ENCODER_STREAM_LOCK (encoder);
+      gst_event_parse_new_segment_full (event, &update, &rate, &applied_rate,
+          &format, &start, &stop, &position);
+
+      GST_DEBUG_OBJECT (encoder, "newseg rate %g, applied rate %g, "
+          "format %d, start = %" GST_TIME_FORMAT ", stop = %" GST_TIME_FORMAT
+          ", pos = %" GST_TIME_FORMAT, rate, applied_rate, format,
+          GST_TIME_ARGS (start), GST_TIME_ARGS (stop),
+          GST_TIME_ARGS (position));
+
+      if (format != GST_FORMAT_TIME) {
+        GST_DEBUG_OBJECT (encoder, "received non TIME newsegment");
+        GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+        break;
+      }
+
+      encoder->priv->at_eos = FALSE;
+
+      gst_segment_set_newsegment_full (&encoder->input_segment, update, rate,
+          applied_rate, format, start, stop, position);
+      GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+      break;
+    }
+    case GST_EVENT_CUSTOM_DOWNSTREAM:
+    {
+      if (gst_video_event_is_force_key_unit (event)) {
+        GstClockTime running_time;
+        gboolean all_headers;
+        guint count;
+
+        if (gst_video_event_parse_downstream_force_key_unit (event,
+                NULL, NULL, &running_time, &all_headers, &count)) {
+          ForcedKeyUnitEvent *fevt;
+
+          GST_OBJECT_LOCK (encoder);
+          fevt = forced_key_unit_event_new (running_time, all_headers, count);
+          encoder->priv->force_key_unit =
+              g_list_append (encoder->priv->force_key_unit, fevt);
+          GST_OBJECT_UNLOCK (encoder);
+
+          GST_DEBUG_OBJECT (encoder,
+              "force-key-unit event: running-time %" GST_TIME_FORMAT
+              ", all_headers %d, count %u",
+              GST_TIME_ARGS (running_time), all_headers, count);
+        }
+        gst_event_unref (event);
+        ret = TRUE;
+      }
+      break;
+    }
+    default:
+      break;
+  }
+
+  return ret;
+}
+
+static gboolean
+gst_video_encoder_sink_event (GstPad * pad, GstEvent * event)
+{
+  GstVideoEncoder *enc;
+  GstVideoEncoderClass *klass;
+  gboolean handled = FALSE;
+  gboolean ret = TRUE;
+
+  enc = GST_VIDEO_ENCODER (gst_pad_get_parent (pad));
+  klass = GST_VIDEO_ENCODER_GET_CLASS (enc);
+
+  GST_DEBUG_OBJECT (enc, "received event %d, %s", GST_EVENT_TYPE (event),
+      GST_EVENT_TYPE_NAME (event));
+
+  if (klass->sink_event)
+    handled = klass->sink_event (enc, event);
+
+  if (!handled)
+    handled = gst_video_encoder_sink_eventfunc (enc, event);
+
+  if (!handled) {
+    /* Forward non-serialized events and EOS/FLUSH_STOP immediately.
+     * For EOS this is required because no buffer or serialized event
+     * will come after EOS and nothing could trigger another
+     * _finish_frame() call.   *
+     * If the subclass handles sending of EOS manually it can return
+     * _DROPPED from ::finish() and all other subclasses should have
+     * decoded/flushed all remaining data before this
+     *
+     * For FLUSH_STOP this is required because it is expected
+     * to be forwarded immediately and no buffers are queued anyway.
+     */
+    if (!GST_EVENT_IS_SERIALIZED (event)
+        || GST_EVENT_TYPE (event) == GST_EVENT_EOS
+        || GST_EVENT_TYPE (event) == GST_EVENT_FLUSH_STOP) {
+      ret = gst_video_encoder_push_event (enc, event);
+    } else {
+      GST_VIDEO_ENCODER_STREAM_LOCK (enc);
+      enc->priv->current_frame_events =
+          g_list_prepend (enc->priv->current_frame_events, event);
+      GST_VIDEO_ENCODER_STREAM_UNLOCK (enc);
+      ret = TRUE;
+    }
+  }
+
+  GST_DEBUG_OBJECT (enc, "event handled");
+
+  gst_object_unref (enc);
+  return ret;
+}
+
+static gboolean
+gst_video_encoder_src_eventfunc (GstVideoEncoder * encoder, GstEvent * event)
+{
+  gboolean handled = FALSE;
+
+  switch (GST_EVENT_TYPE (event)) {
+    case GST_EVENT_CUSTOM_UPSTREAM:
+    {
+      if (gst_video_event_is_force_key_unit (event)) {
+        GstClockTime running_time;
+        gboolean all_headers;
+        guint count;
+
+        if (gst_video_event_parse_upstream_force_key_unit (event,
+                &running_time, &all_headers, &count)) {
+          ForcedKeyUnitEvent *fevt;
+
+          GST_OBJECT_LOCK (encoder);
+          fevt = forced_key_unit_event_new (running_time, all_headers, count);
+          encoder->priv->force_key_unit =
+              g_list_append (encoder->priv->force_key_unit, fevt);
+          GST_OBJECT_UNLOCK (encoder);
+
+          GST_DEBUG_OBJECT (encoder,
+              "force-key-unit event: running-time %" GST_TIME_FORMAT
+              ", all_headers %d, count %u",
+              GST_TIME_ARGS (running_time), all_headers, count);
+        }
+        gst_event_unref (event);
+        handled = TRUE;
+      }
+      break;
+    }
+    default:
+      break;
+  }
+
+  return handled;
+}
+
+static gboolean
+gst_video_encoder_src_event (GstPad * pad, GstEvent * event)
+{
+  GstVideoEncoder *encoder;
+  GstVideoEncoderClass *klass;
+  gboolean ret = FALSE;
+  gboolean handled = FALSE;
+
+  encoder = GST_VIDEO_ENCODER (gst_pad_get_parent (pad));
+  klass = GST_VIDEO_ENCODER_GET_CLASS (encoder);
+
+  GST_LOG_OBJECT (encoder, "handling event: %" GST_PTR_FORMAT, event);
+
+  if (klass->src_event)
+    handled = klass->src_event (encoder, event);
+
+  if (!handled)
+    handled = gst_video_encoder_src_eventfunc (encoder, event);
+
+  if (!handled)
+    ret = gst_pad_event_default (pad, event);
+
+  gst_object_unref (encoder);
+
+  return ret;
+}
+
+static const GstQueryType *
+gst_video_encoder_get_query_types (GstPad * pad)
+{
+  static const GstQueryType query_types[] = {
+    GST_QUERY_CONVERT,
+    GST_QUERY_LATENCY,
+    0
+  };
+
+  return query_types;
+}
+
+static gboolean
+gst_video_encoder_src_query (GstPad * pad, GstQuery * query)
+{
+  GstVideoEncoderPrivate *priv;
+  GstVideoEncoder *enc;
+  gboolean res;
+  GstPad *peerpad;
+
+  enc = GST_VIDEO_ENCODER (gst_pad_get_parent (pad));
+  priv = enc->priv;
+  peerpad = gst_pad_get_peer (enc->sinkpad);
+
+  GST_LOG_OBJECT (enc, "handling query: %" GST_PTR_FORMAT, query);
+
+  switch (GST_QUERY_TYPE (query)) {
+    case GST_QUERY_CONVERT:
+    {
+      GstFormat src_fmt, dest_fmt;
+      gint64 src_val, dest_val;
+
+      gst_query_parse_convert (query, &src_fmt, &src_val, &dest_fmt, &dest_val);
+      res =
+          gst_video_encoded_video_convert (priv->bytes, priv->time, src_fmt,
+          src_val, &dest_fmt, &dest_val);
+      if (!res)
+        goto error;
+      gst_query_set_convert (query, src_fmt, src_val, dest_fmt, dest_val);
+      break;
+    }
+    case GST_QUERY_LATENCY:
+    {
+      gboolean live;
+      GstClockTime min_latency, max_latency;
+
+      res = gst_pad_query (peerpad, query);
+      if (res) {
+        gst_query_parse_latency (query, &live, &min_latency, &max_latency);
+        GST_DEBUG_OBJECT (enc, "Peer latency: live %d, min %"
+            GST_TIME_FORMAT " max %" GST_TIME_FORMAT, live,
+            GST_TIME_ARGS (min_latency), GST_TIME_ARGS (max_latency));
+
+        GST_OBJECT_LOCK (enc);
+        min_latency += priv->min_latency;
+        if (enc->priv->max_latency == GST_CLOCK_TIME_NONE) {
+          max_latency = GST_CLOCK_TIME_NONE;
+        } else if (max_latency != GST_CLOCK_TIME_NONE) {
+          max_latency += enc->priv->max_latency;
+        }
+        GST_OBJECT_UNLOCK (enc);
+
+        gst_query_set_latency (query, live, min_latency, max_latency);
+      }
+    }
+      break;
+    default:
+      res = gst_pad_query_default (pad, query);
+  }
+  gst_object_unref (peerpad);
+  gst_object_unref (enc);
+  return res;
+
+error:
+  GST_DEBUG_OBJECT (enc, "query failed");
+  gst_object_unref (peerpad);
+  gst_object_unref (enc);
+  return res;
+}
+
+static GstVideoCodecFrame *
+gst_video_encoder_new_frame (GstVideoEncoder * encoder, GstBuffer * buf,
+    GstClockTime timestamp, GstClockTime duration)
+{
+  GstVideoEncoderPrivate *priv = encoder->priv;
+  GstVideoCodecFrame *frame;
+
+  frame = g_slice_new0 (GstVideoCodecFrame);
+
+  frame->ref_count = 1;
+
+  GST_VIDEO_ENCODER_STREAM_LOCK (encoder);
+  frame->system_frame_number = priv->system_frame_number;
+  priv->system_frame_number++;
+
+  frame->presentation_frame_number = priv->presentation_frame_number;
+  priv->presentation_frame_number++;
+  GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+
+  frame->events = priv->current_frame_events;
+  priv->current_frame_events = NULL;
+  frame->input_buffer = buf;
+  frame->pts = timestamp;
+  frame->duration = duration;
+
+  if (GST_VIDEO_INFO_IS_INTERLACED (&encoder->priv->input_state->info)) {
+    if (GST_BUFFER_FLAG_IS_SET (buf, GST_VIDEO_BUFFER_TFF)) {
+      GST_VIDEO_CODEC_FRAME_FLAG_SET (frame, GST_VIDEO_CODEC_FRAME_FLAG_TFF);
+    } else {
+      GST_VIDEO_CODEC_FRAME_FLAG_UNSET (frame, GST_VIDEO_CODEC_FRAME_FLAG_TFF);
+    }
+    if (GST_BUFFER_FLAG_IS_SET (buf, GST_VIDEO_BUFFER_RFF)) {
+      GST_VIDEO_CODEC_FRAME_FLAG_SET (frame, GST_VIDEO_CODEC_FRAME_FLAG_RFF);
+    } else {
+      GST_VIDEO_CODEC_FRAME_FLAG_UNSET (frame, GST_VIDEO_CODEC_FRAME_FLAG_RFF);
+    }
+    if (GST_BUFFER_FLAG_IS_SET (buf, GST_VIDEO_BUFFER_ONEFIELD)) {
+      GST_VIDEO_CODEC_FRAME_FLAG_SET (frame,
+          GST_VIDEO_CODEC_FRAME_FLAG_ONEFIELD);
+    } else {
+      GST_VIDEO_CODEC_FRAME_FLAG_UNSET (frame,
+          GST_VIDEO_CODEC_FRAME_FLAG_ONEFIELD);
+    }
+  }
+
+  return frame;
+}
+
+
+static GstFlowReturn
+gst_video_encoder_chain (GstPad * pad, GstBuffer * buf)
+{
+  GstVideoEncoder *encoder;
+  GstVideoEncoderPrivate *priv;
+  GstVideoEncoderClass *klass;
+  GstVideoCodecFrame *frame;
+  GstFlowReturn ret = GST_FLOW_OK;
+  gint64 start, stop = GST_CLOCK_TIME_NONE, cstart, cstop;
+
+  encoder = GST_VIDEO_ENCODER (gst_pad_get_parent (pad));
+  priv = encoder->priv;
+  klass = GST_VIDEO_ENCODER_GET_CLASS (encoder);
+
+  g_return_val_if_fail (klass->handle_frame != NULL, GST_FLOW_ERROR);
+
+  GST_VIDEO_ENCODER_STREAM_LOCK (encoder);
+
+  /* .... ?? */
+  if (!GST_PAD_CAPS (pad)) {
+    ret = GST_FLOW_NOT_NEGOTIATED;
+    goto done;
+  }
+
+  start = GST_BUFFER_TIMESTAMP (buf);
+  if (GST_CLOCK_TIME_IS_VALID (GST_BUFFER_DURATION (buf)))
+    stop = start + GST_BUFFER_DURATION (buf);
+
+  GST_LOG_OBJECT (encoder,
+      "received buffer of size %d with ts %" GST_TIME_FORMAT
+      ", duration %" GST_TIME_FORMAT, GST_BUFFER_SIZE (buf),
+      GST_TIME_ARGS (start), GST_TIME_ARGS (GST_BUFFER_DURATION (buf)));
+
+  if (priv->at_eos) {
+    ret = GST_FLOW_UNEXPECTED;
+    goto done;
+  }
+
+  /* Drop buffers outside of segment */
+  if (!gst_segment_clip (&encoder->input_segment,
+          GST_FORMAT_TIME, start, stop, &cstart, &cstop)) {
+    GST_DEBUG_OBJECT (encoder, "clipping to segment dropped frame");
+    gst_buffer_unref (buf);
+    goto done;
+  }
+
+  frame = gst_video_encoder_new_frame (encoder, buf, cstart, cstop - cstart);
+
+  GST_OBJECT_LOCK (encoder);
+  if (priv->force_key_unit) {
+    ForcedKeyUnitEvent *fevt = NULL;
+    GstClockTime running_time;
+    GList *l;
+
+    running_time =
+        gst_segment_to_running_time (&encoder->output_segment, GST_FORMAT_TIME,
+        GST_BUFFER_TIMESTAMP (buf));
+
+    for (l = priv->force_key_unit; l; l = l->next) {
+      ForcedKeyUnitEvent *tmp = l->data;
+
+      /* Skip pending keyunits */
+      if (tmp->pending)
+        continue;
+
+      /* Simple case, keyunit ASAP */
+      if (tmp->running_time == GST_CLOCK_TIME_NONE) {
+        fevt = tmp;
+        break;
+      }
+
+      /* Event for before this frame */
+      if (tmp->running_time <= running_time) {
+        fevt = tmp;
+        break;
+      }
+    }
+
+    if (fevt) {
+      GST_DEBUG_OBJECT (encoder,
+          "Forcing a key unit at running time %" GST_TIME_FORMAT,
+          GST_TIME_ARGS (running_time));
+      GST_VIDEO_CODEC_FRAME_SET_FORCE_KEYFRAME (frame);
+      if (fevt->all_headers)
+        GST_VIDEO_CODEC_FRAME_SET_FORCE_KEYFRAME_HEADERS (frame);
+      fevt->pending = TRUE;
+    }
+  }
+  GST_OBJECT_UNLOCK (encoder);
+
+  priv->frames = g_list_append (priv->frames, frame);
+
+  /* new data, more finish needed */
+  priv->drained = FALSE;
+
+  GST_LOG_OBJECT (encoder, "passing frame pfn %d to subclass",
+      frame->presentation_frame_number);
+
+  gst_video_codec_frame_ref (frame);
+  ret = klass->handle_frame (encoder, frame);
+
+done:
+  GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+
+  gst_object_unref (encoder);
+
+  return ret;
+}
+
+static GstStateChangeReturn
+gst_video_encoder_change_state (GstElement * element, GstStateChange transition)
+{
+  GstVideoEncoder *encoder;
+  GstVideoEncoderClass *encoder_class;
+  GstStateChangeReturn ret;
+
+  encoder = GST_VIDEO_ENCODER (element);
+  encoder_class = GST_VIDEO_ENCODER_GET_CLASS (element);
+
+  switch (transition) {
+    case GST_STATE_CHANGE_NULL_TO_READY:
+      /* open device/library if needed */
+      if (encoder_class->open && !encoder_class->open (encoder))
+        goto open_failed;
+      break;
+    case GST_STATE_CHANGE_READY_TO_PAUSED:
+      /* Initialize device/library if needed */
+      if (encoder_class->start && !encoder_class->start (encoder))
+        goto start_failed;
+      break;
+    default:
+      break;
+  }
+
+  ret = GST_ELEMENT_CLASS (parent_class)->change_state (element, transition);
+
+  switch (transition) {
+    case GST_STATE_CHANGE_PAUSED_TO_READY:
+      gst_video_encoder_reset (encoder);
+      if (encoder_class->stop && !encoder_class->stop (encoder))
+        goto stop_failed;
+      break;
+    case GST_STATE_CHANGE_READY_TO_NULL:
+      /* close device/library if needed */
+      if (encoder_class->close && !encoder_class->close (encoder))
+        goto close_failed;
+      break;
+    default:
+      break;
+  }
+
+  return ret;
+
+  /* Errors */
+
+open_failed:
+  {
+    GST_ELEMENT_ERROR (encoder, LIBRARY, INIT, (NULL),
+        ("Failed to open encoder"));
+    return GST_STATE_CHANGE_FAILURE;
+  }
+
+start_failed:
+  {
+    GST_ELEMENT_ERROR (encoder, LIBRARY, INIT, (NULL),
+        ("Failed to start encoder"));
+    return GST_STATE_CHANGE_FAILURE;
+  }
+
+stop_failed:
+  {
+    GST_ELEMENT_ERROR (encoder, LIBRARY, INIT, (NULL),
+        ("Failed to stop encoder"));
+    return GST_STATE_CHANGE_FAILURE;
+  }
+
+close_failed:
+  {
+    GST_ELEMENT_ERROR (encoder, LIBRARY, INIT, (NULL),
+        ("Failed to close encoder"));
+    return GST_STATE_CHANGE_FAILURE;
+  }
+}
+
+static gboolean
+gst_video_encoder_set_src_caps (GstVideoEncoder * encoder)
+{
+  gboolean ret;
+  GstVideoCodecState *state = encoder->priv->output_state;
+  GstVideoInfo *info = &state->info;
+
+  g_return_val_if_fail (state->caps != NULL, FALSE);
+
+  if (encoder->priv->output_state_changed) {
+    state->caps = gst_caps_make_writable (state->caps);
+
+    /* Fill caps */
+    gst_caps_set_simple (state->caps, "width", G_TYPE_INT, info->width,
+        "height", G_TYPE_INT, info->height,
+        "pixel-aspect-ratio", GST_TYPE_FRACTION,
+        info->par_n, info->par_d, NULL);
+    if (info->flags & GST_VIDEO_FLAG_VARIABLE_FPS && info->fps_n != 0) {
+      /* variable fps with a max-framerate */
+      gst_caps_set_simple (state->caps, "framerate", GST_TYPE_FRACTION, 0, 1,
+          "max-framerate", GST_TYPE_FRACTION, info->fps_n, info->fps_d, NULL);
+    } else {
+      /* no variable fps or no max-framerate */
+      gst_caps_set_simple (state->caps, "framerate", GST_TYPE_FRACTION,
+          info->fps_n, info->fps_d, NULL);
+    }
+    if (state->codec_data)
+      gst_caps_set_simple (state->caps, "codec_data", GST_TYPE_BUFFER,
+          state->codec_data, NULL);
+    encoder->priv->output_state_changed = FALSE;
+  }
+
+  ret = gst_pad_set_caps (encoder->srcpad, state->caps);
+
+  return ret;
+}
+
+/**
+ * gst_video_encoder_finish_frame:
+ * @encoder: a #GstVideoEncoder
+ * @frame: (transfer full): an encoded #GstVideoCodecFrame 
+ *
+ * @frame must have a valid encoded data buffer, whose metadata fields
+ * are then appropriately set according to frame data or no buffer at
+ * all if the frame should be dropped.
+ * It is subsequently pushed downstream or provided to @pre_push.
+ * In any case, the frame is considered finished and released.
+ *
+ * Returns: a #GstFlowReturn resulting from sending data downstream
+ *
+ * Since: 0.10.37
+ */
+GstFlowReturn
+gst_video_encoder_finish_frame (GstVideoEncoder * encoder,
+    GstVideoCodecFrame * frame)
+{
+  GstVideoEncoderPrivate *priv = encoder->priv;
+  GstFlowReturn ret = GST_FLOW_OK;
+  GstVideoEncoderClass *encoder_class;
+  GList *l;
+  gboolean send_headers = FALSE;
+  gboolean discont = (frame->presentation_frame_number == 0);
+
+  encoder_class = GST_VIDEO_ENCODER_GET_CLASS (encoder);
+
+  GST_LOG_OBJECT (encoder,
+      "finish frame fpn %d", frame->presentation_frame_number);
+
+  GST_LOG_OBJECT (encoder, "frame PTS %" GST_TIME_FORMAT
+      ", DTS %" GST_TIME_FORMAT, GST_TIME_ARGS (frame->pts),
+      GST_TIME_ARGS (frame->dts));
+
+  GST_VIDEO_ENCODER_STREAM_LOCK (encoder);
+
+  if (G_UNLIKELY (priv->output_state_changed))
+    gst_video_encoder_set_src_caps (encoder);
+
+  if (G_UNLIKELY (priv->output_state == NULL))
+    goto no_output_state;
+
+  /* Push all pending events that arrived before this frame */
+  for (l = priv->frames; l; l = l->next) {
+    GstVideoCodecFrame *tmp = l->data;
+
+    if (tmp->events) {
+      GList *k;
+
+      for (k = g_list_last (tmp->events); k; k = k->prev)
+        gst_video_encoder_push_event (encoder, k->data);
+      g_list_free (tmp->events);
+      tmp->events = NULL;
+    }
+
+    if (tmp == frame)
+      break;
+  }
+
+  /* no buffer data means this frame is skipped/dropped */
+  if (!frame->output_buffer) {
+    GST_DEBUG_OBJECT (encoder, "skipping frame %" GST_TIME_FORMAT,
+        GST_TIME_ARGS (frame->pts));
+    goto done;
+  }
+
+  if (GST_VIDEO_CODEC_FRAME_IS_SYNC_POINT (frame) && priv->force_key_unit) {
+    GstClockTime stream_time, running_time;
+    GstEvent *ev;
+    ForcedKeyUnitEvent *fevt = NULL;
+    GList *l;
+
+    running_time =
+        gst_segment_to_running_time (&encoder->output_segment, GST_FORMAT_TIME,
+        frame->pts);
+
+    GST_OBJECT_LOCK (encoder);
+    for (l = priv->force_key_unit; l; l = l->next) {
+      ForcedKeyUnitEvent *tmp = l->data;
+
+      /* Skip non-pending keyunits */
+      if (!tmp->pending)
+        continue;
+
+      /* Simple case, keyunit ASAP */
+      if (tmp->running_time == GST_CLOCK_TIME_NONE) {
+        fevt = tmp;
+        break;
+      }
+
+      /* Event for before this frame */
+      if (tmp->running_time <= running_time) {
+        fevt = tmp;
+        break;
+      }
+    }
+
+    if (fevt) {
+      priv->force_key_unit = g_list_remove (priv->force_key_unit, fevt);
+    }
+    GST_OBJECT_UNLOCK (encoder);
+
+    if (fevt) {
+      stream_time =
+          gst_segment_to_stream_time (&encoder->output_segment, GST_FORMAT_TIME,
+          frame->pts);
+
+      ev = gst_video_event_new_downstream_force_key_unit
+          (frame->pts, stream_time, running_time,
+          fevt->all_headers, fevt->count);
+
+      gst_video_encoder_push_event (encoder, ev);
+
+      if (fevt->all_headers)
+        send_headers = TRUE;
+
+      GST_DEBUG_OBJECT (encoder,
+          "Forced key unit: running-time %" GST_TIME_FORMAT
+          ", all_headers %d, count %u",
+          GST_TIME_ARGS (running_time), fevt->all_headers, fevt->count);
+      forced_key_unit_event_free (fevt);
+    }
+  }
+
+  if (GST_VIDEO_CODEC_FRAME_IS_SYNC_POINT (frame)) {
+    priv->distance_from_sync = 0;
+    GST_BUFFER_FLAG_UNSET (frame->output_buffer, GST_BUFFER_FLAG_DELTA_UNIT);
+    /* For keyframes, DTS = PTS */
+    if (!GST_CLOCK_TIME_IS_VALID (frame->dts)) {
+      frame->dts = frame->pts;
+    } else if (GST_CLOCK_TIME_IS_VALID (frame->pts) && frame->pts != frame->dts) {
+      GST_WARNING_OBJECT (encoder, "keyframe PTS != DTS");
+    }
+  } else {
+    GST_BUFFER_FLAG_SET (frame->output_buffer, GST_BUFFER_FLAG_DELTA_UNIT);
+  }
+
+  frame->distance_from_sync = priv->distance_from_sync;
+  priv->distance_from_sync++;
+
+  GST_BUFFER_TIMESTAMP (frame->output_buffer) = frame->pts;
+  GST_BUFFER_DURATION (frame->output_buffer) = frame->duration;
+
+  /* update rate estimate */
+  priv->bytes += GST_BUFFER_SIZE (frame->output_buffer);
+  if (GST_CLOCK_TIME_IS_VALID (frame->duration)) {
+    priv->time += frame->duration;
+  } else {
+    /* better none than nothing valid */
+    priv->time = GST_CLOCK_TIME_NONE;
+  }
+
+  if (G_UNLIKELY (send_headers || priv->new_headers)) {
+    GList *tmp, *copy = NULL;
+
+    GST_DEBUG_OBJECT (encoder, "Sending headers");
+
+    /* First make all buffers metadata-writable */
+    for (tmp = priv->headers; tmp; tmp = tmp->next) {
+      GstBuffer *tmpbuf = GST_BUFFER (tmp->data);
+
+      copy = g_list_append (copy, gst_buffer_make_metadata_writable (tmpbuf));
+    }
+    g_list_free (priv->headers);
+    priv->headers = copy;
+
+    for (tmp = priv->headers; tmp; tmp = tmp->next) {
+      GstBuffer *tmpbuf = GST_BUFFER (tmp->data);
+
+      gst_buffer_set_caps (tmpbuf, GST_PAD_CAPS (encoder->srcpad));
+      gst_buffer_ref (tmpbuf);
+      priv->bytes += GST_BUFFER_SIZE (tmpbuf);
+      if (G_UNLIKELY (discont)) {
+        GST_LOG_OBJECT (encoder, "marking discont");
+        GST_BUFFER_FLAG_SET (tmpbuf, GST_BUFFER_FLAG_DISCONT);
+        discont = FALSE;
+      }
+
+      gst_pad_push (encoder->srcpad, tmpbuf);
+    }
+    priv->new_headers = FALSE;
+  }
+
+  if (G_UNLIKELY (discont)) {
+    GST_LOG_OBJECT (encoder, "marking discont");
+    GST_BUFFER_FLAG_SET (frame->output_buffer, GST_BUFFER_FLAG_DISCONT);
+  }
+
+  gst_buffer_set_caps (GST_BUFFER (frame->output_buffer),
+      GST_PAD_CAPS (encoder->srcpad));
+
+  if (encoder_class->pre_push)
+    ret = encoder_class->pre_push (encoder, frame);
+
+  if (ret == GST_FLOW_OK)
+    ret = gst_pad_push (encoder->srcpad, frame->output_buffer);
+
+  frame->output_buffer = NULL;
+
+done:
+  /* handed out */
+
+  /* unref once from the list */
+  l = g_list_find (priv->frames, frame);
+  if (l) {
+    gst_video_codec_frame_unref (frame);
+    priv->frames = g_list_delete_link (priv->frames, l);
+  }
+  /* unref because this function takes ownership */
+  gst_video_codec_frame_unref (frame);
+
+  GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+
+  return ret;
+
+  /* ERRORS */
+no_output_state:
+  {
+    GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+    GST_ERROR_OBJECT (encoder, "Output state was not configured");
+    return GST_FLOW_ERROR;
+  }
+}
+
+/**
+ * gst_video_encoder_get_output_state:
+ * @encoder: a #GstVideoEncoder
+ *
+ * Get the current #GstVideoCodecState
+ *
+ * Returns: (transfer full): #GstVideoCodecState describing format of video data.
+ *
+ * Since: 0.10.37
+ */
+GstVideoCodecState *
+gst_video_encoder_get_output_state (GstVideoEncoder * encoder)
+{
+  GstVideoCodecState *state;
+
+  GST_VIDEO_ENCODER_STREAM_LOCK (encoder);
+  state = gst_video_codec_state_ref (encoder->priv->output_state);
+  GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+
+  return state;
+}
+
+/**
+ * gst_video_encoder_set_output_state:
+ * @encoder: a #GstVideoEncoder
+ * @caps: (transfer full): the #GstCaps to use for the output
+ * @reference: (allow-none) (transfer none): An optional reference @GstVideoCodecState
+ *
+ * Creates a new #GstVideoCodecState with the specified caps as the output state
+ * for the encoder.
+ * Any previously set output state on @decoder will be replaced by the newly
+ * created one.
+ *
+ * The specified @caps should not contain any resolution, pixel-aspect-ratio,
+ * framerate, codec-data, .... Those should be specified instead in the returned
+ * #GstVideoCodecState.
+ *
+ * If the subclass wishes to copy over existing fields (like pixel aspect ratio,
+ * or framerate) from an existing #GstVideoCodecState, it can be provided as a
+ * @reference.
+ *
+ * If the subclass wishes to override some fields from the output state (like
+ * pixel-aspect-ratio or framerate) it can do so on the returned #GstVideoCodecState.
+ *
+ * The new output state will only take effect (set on pads and buffers) starting
+ * from the next call to #gst_video_encoder_finish_frame().
+ *
+ * Returns: (transfer full): the newly configured output state.
+ *
+ * Since: 0.10.37
+ */
+GstVideoCodecState *
+gst_video_encoder_set_output_state (GstVideoEncoder * encoder, GstCaps * caps,
+    GstVideoCodecState * reference)
+{
+  GstVideoEncoderPrivate *priv = encoder->priv;
+  GstVideoCodecState *state;
+
+  g_return_val_if_fail (caps != NULL, NULL);
+
+  state = _new_output_state (caps, reference);
+
+  GST_VIDEO_ENCODER_STREAM_LOCK (encoder);
+  if (priv->output_state)
+    gst_video_codec_state_unref (priv->output_state);
+  priv->output_state = gst_video_codec_state_ref (state);
+
+  priv->output_state_changed = TRUE;
+  GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+
+  return state;
+}
+
+/**
+ * gst_video_encoder_set_latency:
+ * @encoder: a #GstVideoEncoder
+ * @min_latency: minimum latency
+ * @max_latency: maximum latency
+ *
+ * Informs baseclass of encoding latency.
+ *
+ * Since: 0.10.37
+ */
+void
+gst_video_encoder_set_latency (GstVideoEncoder * encoder,
+    GstClockTime min_latency, GstClockTime max_latency)
+{
+  g_return_if_fail (GST_CLOCK_TIME_IS_VALID (min_latency));
+  g_return_if_fail (max_latency >= min_latency);
+
+  GST_OBJECT_LOCK (encoder);
+  encoder->priv->min_latency = min_latency;
+  encoder->priv->max_latency = max_latency;
+  GST_OBJECT_UNLOCK (encoder);
+
+  gst_element_post_message (GST_ELEMENT_CAST (encoder),
+      gst_message_new_latency (GST_OBJECT_CAST (encoder)));
+}
+
+/**
+ * gst_video_encoder_get_latency:
+ * @encoder: a #GstVideoEncoder
+ * @min_latency: (out) (allow-none): the configured minimum latency
+ * @max_latency: (out) (allow-none): the configured maximum latency
+ *
+ * Returns the configured encoding latency.
+ *
+ * Since: 0.10.37
+ */
+void
+gst_video_encoder_get_latency (GstVideoEncoder * encoder,
+    GstClockTime * min_latency, GstClockTime * max_latency)
+{
+  GST_OBJECT_LOCK (encoder);
+  if (min_latency)
+    *min_latency = encoder->priv->min_latency;
+  if (max_latency)
+    *max_latency = encoder->priv->max_latency;
+  GST_OBJECT_UNLOCK (encoder);
+}
+
+/**
+ * gst_video_encoder_get_oldest_frame:
+ * @encoder: a #GstVideoEncoder
+ *
+ * Get the oldest unfinished pending #GstVideoCodecFrame
+ *
+ * Returns: (transfer full): oldest unfinished pending #GstVideoCodecFrame
+ *
+ * Since: 0.10.37
+ */
+GstVideoCodecFrame *
+gst_video_encoder_get_oldest_frame (GstVideoEncoder * encoder)
+{
+  GstVideoCodecFrame *frame = NULL;
+
+  GST_VIDEO_ENCODER_STREAM_LOCK (encoder);
+  if (encoder->priv->frames)
+    frame = gst_video_codec_frame_ref (encoder->priv->frames->data);
+  GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+
+  return (GstVideoCodecFrame *) frame;
+}
+
+/**
+ * gst_video_encoder_get_frame:
+ * @encoder: a #GstVideoEnccoder
+ * @frame_number: system_frame_number of a frame
+ *
+ * Get a pending unfinished #GstVideoCodecFrame
+ * 
+ * Returns: (transfer full): pending unfinished #GstVideoCodecFrame identified by @frame_number.
+ *
+ * Since: 0.10.37
+ */
+GstVideoCodecFrame *
+gst_video_encoder_get_frame (GstVideoEncoder * encoder, int frame_number)
+{
+  GList *g;
+  GstVideoCodecFrame *frame = NULL;
+
+  GST_DEBUG_OBJECT (encoder, "frame_number : %d", frame_number);
+
+  GST_VIDEO_ENCODER_STREAM_LOCK (encoder);
+  for (g = encoder->priv->frames; g; g = g->next) {
+    GstVideoCodecFrame *tmp = g->data;
+
+    if (tmp->system_frame_number == frame_number) {
+      frame = tmp;
+      gst_video_codec_frame_ref (frame);
+      break;
+    }
+  }
+  GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+
+  return frame;
+}
+
+/**
+ * gst_video_encoder_get_frames:
+ * @encoder: a #GstVideoEncoder
+ *
+ * Get all pending unfinished #GstVideoCodecFrame
+ * 
+ * Returns: (transfer full) (element-type GstVideoCodecFrame): pending unfinished #GstVideoCodecFrame.
+ */
+GList *
+gst_video_encoder_get_frames (GstVideoEncoder * encoder)
+{
+  GList *frames;
+
+  GST_VIDEO_ENCODER_STREAM_LOCK (encoder);
+  frames = g_list_copy (encoder->priv->frames);
+  g_list_foreach (frames, (GFunc) gst_video_codec_frame_ref, NULL);
+  GST_VIDEO_ENCODER_STREAM_UNLOCK (encoder);
+
+  return frames;
+}
diff --git a/gst-libs/gst/video/gstvideoencoder.h b/gst-libs/gst/video/gstvideoencoder.h
new file mode 100644
index 0000000..9ae3516
--- /dev/null
+++ b/gst-libs/gst/video/gstvideoencoder.h
@@ -0,0 +1,308 @@
+/* GStreamer
+ * Copyright (C) 2008 David Schleef <ds@schleef.org>
+ * Copyright (C) 2011 Mark Nauwelaerts <mark.nauwelaerts@collabora.co.uk>.
+ * Copyright (C) 2011 Nokia Corporation. All rights reserved.
+ *   Contact: Stefan Kost <stefan.kost@nokia.com>
+ * Copyright (C) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifndef _GST_VIDEO_ENCODER_H_
+#define _GST_VIDEO_ENCODER_H_
+
+#include <gst/video/gstvideoutils.h>
+
+G_BEGIN_DECLS
+
+#define GST_TYPE_VIDEO_ENCODER \
+  (gst_video_encoder_get_type())
+#define GST_VIDEO_ENCODER(obj) \
+  (G_TYPE_CHECK_INSTANCE_CAST((obj),GST_TYPE_VIDEO_ENCODER,GstVideoEncoder))
+#define GST_VIDEO_ENCODER_CLASS(klass) \
+  (G_TYPE_CHECK_CLASS_CAST((klass),GST_TYPE_VIDEO_ENCODER,GstVideoEncoderClass))
+#define GST_VIDEO_ENCODER_GET_CLASS(obj) \
+  (G_TYPE_INSTANCE_GET_CLASS((obj),GST_TYPE_VIDEO_ENCODER,GstVideoEncoderClass))
+#define GST_IS_VIDEO_ENCODER(obj) \
+  (G_TYPE_CHECK_INSTANCE_TYPE((obj),GST_TYPE_VIDEO_ENCODER))
+#define GST_IS_VIDEO_ENCODER_CLASS(obj) \
+  (G_TYPE_CHECK_CLASS_TYPE((klass),GST_TYPE_VIDEO_ENCODER))
+#define GST_VIDEO_ENCODER_CAST(enc) ((GstVideoEncoder*)enc)
+
+/**
+ * GST_VIDEO_ENCODER_SINK_NAME:
+ *
+ * The name of the templates for the sink pad.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_ENCODER_SINK_NAME    "sink"
+/**
+ * GST_VIDEO_ENCODER_SRC_NAME:
+ *
+ * The name of the templates for the source pad.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_ENCODER_SRC_NAME     "src"
+
+/**
+ * GST_VIDEO_ENCODER_FLOW_DROPPED:
+ *
+ * Returned when the event/buffer should be dropped.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_ENCODER_FLOW_DROPPED GST_FLOW_CUSTOM_SUCCESS_1
+
+/**
+ * GST_VIDEO_ENCODER_SRC_PAD:
+ * @obj: a #GstVideoEncoder
+ *
+ * Gives the pointer to the source #GstPad object of the element.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_ENCODER_SRC_PAD(obj)         (((GstVideoEncoder *) (obj))->srcpad)
+
+/**
+ * GST_VIDEO_ENCODER_SINK_PAD:
+ * @obj: a #GstVideoEncoder
+ *
+ * Gives the pointer to the sink #GstPad object of the element.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_ENCODER_SINK_PAD(obj)        (((GstVideoEncoder *) (obj))->sinkpad)
+
+/**
+ * GST_VIDEO_ENCODER_FLOW_NEED_DATA:
+ *
+ * Returned while parsing to indicate more data is needed.
+ *
+ * Since: 0.10.37
+ **/
+#define GST_VIDEO_ENCODER_FLOW_NEED_DATA GST_FLOW_CUSTOM_SUCCESS
+
+/**
+ * GST_VIDEO_ENCODER_FLOW_DROPPED:
+ *
+ * Returned when the event/buffer should be dropped.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_ENCODER_FLOW_DROPPED GST_FLOW_CUSTOM_SUCCESS_1
+
+/**
+ * GST_VIDEO_ENCODER_INPUT_SEGMENT:
+ * @obj: base parse instance
+ *
+ * Gives the segment of the element.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_ENCODER_INPUT_SEGMENT(obj)     (GST_VIDEO_ENCODER_CAST (obj)->input_segment)
+
+/**
+ * GST_VIDEO_ENCODER_OUTPUT_SEGMENT:
+ * @obj: base parse instance
+ *
+ * Gives the segment of the element.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_ENCODER_OUTPUT_SEGMENT(obj)     (GST_VIDEO_ENCODER_CAST (obj)->output_segment)
+
+/**
+ * GST_VIDEO_ENCODER_STREAM_LOCK:
+ * @encoder: video encoder instance
+ *
+ * Obtain a lock to protect the encoder function from concurrent access.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_ENCODER_STREAM_LOCK(encoder) g_static_rec_mutex_lock (&GST_VIDEO_ENCODER (encoder)->stream_lock)
+
+/**
+ * GST_VIDEO_ENCODER_STREAM_UNLOCK:
+ * @encoder: video encoder instance
+ *
+ * Release the lock that protects the encoder function from concurrent access.
+ *
+ * Since: 0.10.37
+ */
+#define GST_VIDEO_ENCODER_STREAM_UNLOCK(encoder) g_static_rec_mutex_unlock (&GST_VIDEO_ENCODER (encoder)->stream_lock)
+
+typedef struct _GstVideoEncoder GstVideoEncoder;
+typedef struct _GstVideoEncoderPrivate GstVideoEncoderPrivate;
+typedef struct _GstVideoEncoderClass GstVideoEncoderClass;
+
+/**
+ * GstVideoEncoder:
+ *
+ * The opaque #GstVideoEncoder data structure.
+ *
+ * Since: 0.10.37
+ */
+struct _GstVideoEncoder
+{
+  /*< private >*/
+  GstElement    element;
+
+  /*< protected >*/
+  GstPad         *sinkpad;
+  GstPad         *srcpad;
+
+  /* protects all data processing, i.e. is locked
+   * in the chain function, finish_frame and when
+   * processing serialized events */
+  GStaticRecMutex stream_lock;
+
+  /* MT-protected (with STREAM_LOCK) */
+  GstSegment      input_segment;
+  GstSegment      output_segment;
+
+  GstVideoEncoderPrivate *priv;
+
+  /*< private >*/
+  gpointer        _gst_reserved[GST_PADDING_LARGE];
+};
+
+/**
+ * GstVideoEncoderClass:
+ * @open:           Optional.
+ *                  Called when the element changes to GST_STATE_READY.
+ *                  Allows opening external resources. Since: 0.10.37.
+ * @close:          Optional.
+ *                  Called when the element changes to GST_STATE_NULL.
+ *                  Allows closing external resources. Since: 0.10.37.
+ * @start:          Optional.
+ *                  Called when the element starts processing.
+ *                  Allows opening external resources.
+ * @stop:           Optional.
+ *                  Called when the element stops processing.
+ *                  Allows closing external resources.
+ * @set_format:     Optional.
+ *                  Notifies subclass of incoming data format.
+ *                  GstVideoCodecState fields have already been
+ *                  set according to provided caps.
+ * @handle_frame:   Provides input frame to subclass.
+ * @reset:          Optional.
+ *                  Allows subclass (encoder) to perform post-seek semantics reset.
+ * @finish:         Optional.
+ *                  Called to request subclass to dispatch any pending remaining
+ *                  data (e.g. at EOS).
+ * @pre_push:   Optional.
+ *                  Allows subclass to push frame downstream in whatever
+ *                  shape or form it deems appropriate.  If not provided,
+ *                  provided encoded frame data is simply pushed downstream.
+ * @getcaps:        Optional.
+ *                  Allows for a custom sink getcaps implementation (e.g.
+ *                  for multichannel input specification).  If not implemented,
+ *                  default returns gst_video_encoder_proxy_getcaps
+ *                  applied to sink template caps.
+ * @sink_event:     Optional.
+ *                  Event handler on the sink pad. This function should return
+ *                  TRUE if the event was handled and should be discarded
+ *                  (i.e. not unref'ed).
+ * @src_event:      Optional.
+ *                  Event handler on the source pad. This function should return
+ *                  TRUE if the event was handled and should be discarded
+ *                  (i.e. not unref'ed).
+ *
+ * Subclasses can override any of the available virtual methods or not, as
+ * needed. At minimum @handle_frame needs to be overridden, and @set_format
+ * and @get_caps are likely needed as well.
+ *
+ * Since: 0.10.37
+ */
+struct _GstVideoEncoderClass
+{
+  /*< private >*/
+  GstElementClass  element_class;
+
+  /*< public >*/
+  /* virtual methods for subclasses */
+  gboolean      (*open)         (GstVideoEncoder *encoder);
+
+  gboolean      (*close)        (GstVideoEncoder *encoder);
+
+  gboolean      (*start)        (GstVideoEncoder *encoder);
+
+  gboolean      (*stop)         (GstVideoEncoder *encoder);
+
+  gboolean      (*set_format)   (GstVideoEncoder *encoder,
+				 GstVideoCodecState *state);
+
+  GstFlowReturn (*handle_frame) (GstVideoEncoder *encoder,
+				 GstVideoCodecFrame *frame);
+
+  gboolean      (*reset)        (GstVideoEncoder *encoder,
+				 gboolean hard);
+
+  GstFlowReturn (*finish)       (GstVideoEncoder *encoder);
+
+  GstFlowReturn (*pre_push)     (GstVideoEncoder *encoder,
+				 GstVideoCodecFrame *frame);
+
+  GstCaps *     (*getcaps)      (GstVideoEncoder *enc);
+
+  gboolean      (*sink_event)   (GstVideoEncoder *encoder,
+				 GstEvent *event);
+
+  gboolean      (*src_event)    (GstVideoEncoder *encoder,
+				 GstEvent *event);
+
+  /*< private >*/
+  gpointer       _gst_reserved[GST_PADDING_LARGE];
+};
+
+GType                gst_video_encoder_get_type (void);
+
+GstVideoCodecState*  gst_video_encoder_get_output_state (GstVideoEncoder *encoder);
+
+GstVideoCodecState*  gst_video_encoder_set_output_state (GstVideoEncoder * encoder,
+							 GstCaps * caps,
+							 GstVideoCodecState * reference);
+
+GstVideoCodecFrame*  gst_video_encoder_get_frame        (GstVideoEncoder *encoder,
+						         int frame_number);
+GstVideoCodecFrame*  gst_video_encoder_get_oldest_frame (GstVideoEncoder *encoder);
+
+GList *              gst_video_encoder_get_frames       (GstVideoEncoder *encoder);
+
+GstFlowReturn        gst_video_encoder_finish_frame (GstVideoEncoder *encoder,
+						     GstVideoCodecFrame *frame);
+
+GstCaps *            gst_video_encoder_proxy_getcaps (GstVideoEncoder * enc,
+						      GstCaps         * caps);
+void                 gst_video_encoder_set_discont (GstVideoEncoder *encoder);
+gboolean             gst_video_encoder_get_discont (GstVideoEncoder *encoder);
+
+void                 gst_video_encoder_set_latency (GstVideoEncoder *encoder,
+						    GstClockTime min_latency,
+						    GstClockTime max_latency);
+void		     gst_video_encoder_get_latency (GstVideoEncoder *encoder,
+						    GstClockTime *min_latency,
+						    GstClockTime *max_latency);
+
+void                 gst_video_encoder_set_headers (GstVideoEncoder *encoder,
+						    GList *headers);
+G_END_DECLS
+
+#endif
+
diff --git a/gst-libs/gst/video/gstvideoutils.c b/gst-libs/gst/video/gstvideoutils.c
new file mode 100644
index 0000000..51a4e39
--- /dev/null
+++ b/gst-libs/gst/video/gstvideoutils.c
@@ -0,0 +1,207 @@
+/* GStreamer
+ * Copyright (C) 2008 David Schleef <ds@schleef.org>
+ * Copyright (C) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+
+#include "gstvideoutils.h"
+
+#include <string.h>
+
+GType
+gst_video_codec_frame_get_type (void)
+{
+  static volatile gsize type = 0;
+
+  if (g_once_init_enter (&type)) {
+    GType _type;
+
+    _type = g_boxed_type_register_static ("GstVideoCodecFrame",
+        (GBoxedCopyFunc) gst_video_codec_frame_ref,
+        (GBoxedFreeFunc) gst_video_codec_frame_unref);
+    g_once_init_leave (&type, _type);
+  }
+  return (GType) type;
+}
+
+
+
+static void
+_gst_video_codec_frame_free (GstVideoCodecFrame * frame)
+{
+  g_return_if_fail (frame != NULL);
+
+  GST_DEBUG ("free frame %p", frame);
+
+  if (frame->input_buffer) {
+    gst_buffer_unref (frame->input_buffer);
+  }
+
+  if (frame->output_buffer) {
+    gst_buffer_unref (frame->output_buffer);
+  }
+
+  g_list_foreach (frame->events, (GFunc) gst_event_unref, NULL);
+  g_list_free (frame->events);
+
+  if (frame->user_data_destroy_notify)
+    frame->user_data_destroy_notify (frame->user_data);
+
+  g_slice_free (GstVideoCodecFrame, frame);
+}
+
+/**
+ * gst_video_codec_frame_set_user_data:
+ * @frame: a #GstVideoCodecFrame
+ * @user_data: private data
+ * @notify: (closure user_data): a #GDestroyNotify
+ *
+ * Sets @user_data on the frame and the #GDestroyNotify that will be called when
+ * the frame is freed. Allows to attach private data by the subclass to frames.
+ *
+ * If a @user_data was previously set, then the previous set @notify will be called
+ * before the @user_data is replaced.
+ */
+void
+gst_video_codec_frame_set_user_data (GstVideoCodecFrame * frame,
+    gpointer user_data, GDestroyNotify notify)
+{
+  if (frame->user_data_destroy_notify)
+    frame->user_data_destroy_notify (frame->user_data);
+
+  frame->user_data = user_data;
+  frame->user_data_destroy_notify = notify;
+}
+
+/**
+ * gst_video_codec_frame_get_user_data:
+ * @frame: a #GstVideoCodecFrame
+ *
+ * Gets private data set on the frame by the subclass via
+ * gst_video_codec_frame_set_user_data() previously.
+ *
+ * Returns: (transfer none): The previously set user_data
+ */
+gpointer
+gst_video_codec_frame_get_user_data (GstVideoCodecFrame * frame)
+{
+  return frame->user_data;
+}
+
+/**
+ * gst_video_codec_frame_ref:
+ * @frame: a #GstVideoCodecFrame
+ *
+ * Increases the refcount of the given frame by one.
+ *
+ * Returns: @buf
+ */
+GstVideoCodecFrame *
+gst_video_codec_frame_ref (GstVideoCodecFrame * frame)
+{
+  g_return_val_if_fail (frame != NULL, NULL);
+
+  g_atomic_int_inc (&frame->ref_count);
+
+  return frame;
+}
+
+/**
+ * gst_video_codec_frame_unref:
+ * @frame: a #GstVideoCodecFrame
+ *
+ * Decreases the refcount of the frame. If the refcount reaches 0, the frame
+ * will be freed.
+ */
+void
+gst_video_codec_frame_unref (GstVideoCodecFrame * frame)
+{
+  g_return_if_fail (frame != NULL);
+  g_return_if_fail (frame->ref_count > 0);
+
+  if (g_atomic_int_dec_and_test (&frame->ref_count)) {
+    _gst_video_codec_frame_free (frame);
+  }
+}
+
+
+/**
+ * gst_video_codec_state_ref:
+ * @state: a #GstVideoCodecState
+ *
+ * Increases the refcount of the given state by one.
+ *
+ * Returns: @buf
+ */
+GstVideoCodecState *
+gst_video_codec_state_ref (GstVideoCodecState * state)
+{
+  g_return_val_if_fail (state != NULL, NULL);
+
+  g_atomic_int_inc (&state->ref_count);
+
+  return state;
+}
+
+static void
+_gst_video_codec_state_free (GstVideoCodecState * state)
+{
+  if (state->caps)
+    gst_caps_unref (state->caps);
+  if (state->codec_data)
+    gst_buffer_unref (state->codec_data);
+  g_slice_free (GstVideoCodecState, state);
+}
+
+/**
+ * gst_video_codec_state_unref:
+ * @state: a #GstVideoCodecState
+ *
+ * Decreases the refcount of the state. If the refcount reaches 0, the state
+ * will be freed.
+ */
+void
+gst_video_codec_state_unref (GstVideoCodecState * state)
+{
+  g_return_if_fail (state != NULL);
+  g_return_if_fail (state->ref_count > 0);
+
+  if (g_atomic_int_dec_and_test (&state->ref_count)) {
+    _gst_video_codec_state_free (state);
+  }
+}
+
+GType
+gst_video_codec_state_get_type (void)
+{
+  static volatile gsize type = 0;
+
+  if (g_once_init_enter (&type)) {
+    GType _type;
+
+    _type = g_boxed_type_register_static ("GstVideoCodecState",
+        (GBoxedCopyFunc) gst_video_codec_state_ref,
+        (GBoxedFreeFunc) gst_video_codec_state_unref);
+    g_once_init_leave (&type, _type);
+  }
+  return (GType) type;
+}
diff --git a/gst-libs/gst/video/gstvideoutils.h b/gst-libs/gst/video/gstvideoutils.h
new file mode 100644
index 0000000..b474ce4
--- /dev/null
+++ b/gst-libs/gst/video/gstvideoutils.h
@@ -0,0 +1,278 @@
+/* GStreamer
+ * Copyright (C) 2008 David Schleef <ds@schleef.org>
+ * Copyright (C) 2012 Collabora Ltd.
+ *	Author : Edward Hervey <edward@collabora.com>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifndef _GST_VIDEO_UTILS_H_
+#define _GST_VIDEO_UTILS_H_
+
+#include <gst/gst.h>
+#include <gst/video/video.h>
+
+G_BEGIN_DECLS
+#define GST_TYPE_VIDEO_CODEC_STATE \
+  (gst_video_codec_state_get_type())
+
+#define GST_TYPE_VIDEO_CODEC_FRAME \
+  (gst_video_codec_frame_get_type())
+
+typedef struct _GstVideoCodecState GstVideoCodecState;
+typedef struct _GstVideoCodecFrame GstVideoCodecFrame;
+
+/**
+ * GstVideoCodecState:
+ * @info: The #GstVideoInfo describing the stream
+ * @caps: The #GstCaps
+ * @codec_data: (optional) a #GstBuffer corresponding to the
+ *     'codec_data' field of a stream.
+ *
+ * Structure representing the state of an incoming or outgoing video
+ * stream for encoders and decoders.
+ *
+ * Decoders and encoders will receive such a state through their
+ * respective @set_format vmethods.
+ *
+ * Decoders and encoders can set the downstream state, by using the
+ * @gst_video_decoder_set_output_state() or
+ * @gst_video_encoder_set_output_state() methods.
+ */
+struct _GstVideoCodecState
+{
+  /*< private >*/
+  gint ref_count;
+
+  /*< public >*/
+  GstVideoInfo info;
+
+  GstCaps *caps;
+
+  GstBuffer *codec_data;
+
+  /*< private >*/
+  void         *padding[GST_PADDING_LARGE];
+};
+
+/**
+ * GstVideoCodecFrameFlags:
+ * @GST_VIDEO_CODEC_FRAME_FLAG_DECODE_ONLY: is the frame only meant to be decoded
+ * @GST_VIDEO_CODEC_FRAME_FLAG_SYNC_POINT: is the frame a synchronization point (keyframe)
+ * @GST_VIDEO_CODEC_FRAME_FLAG_FORCE_KEYFRAME: should the output frame be made a keyframe
+ * @GST_VIDEO_CODEC_FRAME_FLAG_FORCE_KEYFRAME_HEADERS: should the encoder output stream headers
+ * @GST_VIDEO_CODEC_FRAME_FLAG_TFF: top-field first
+ * @GST_VIDEO_CODEC_FRAME_FLAG_RFF: the field is repeated
+ * @GST_VIDEO_CODEC_FRAME_FLAG_ONEFIELD: only one field is present
+ *
+ * Flags for #GstVideoCodecFrame
+ */
+typedef enum
+{
+  GST_VIDEO_CODEC_FRAME_FLAG_DECODE_ONLY            = (1<<0),
+  GST_VIDEO_CODEC_FRAME_FLAG_SYNC_POINT             = (1<<1),
+  GST_VIDEO_CODEC_FRAME_FLAG_FORCE_KEYFRAME         = (1<<2),
+  GST_VIDEO_CODEC_FRAME_FLAG_FORCE_KEYFRAME_HEADERS = (1<<3),
+  GST_VIDEO_CODEC_FRAME_FLAG_TFF                    = (1<<4),
+  GST_VIDEO_CODEC_FRAME_FLAG_RFF                    = (1<<5),
+  GST_VIDEO_CODEC_FRAME_FLAG_ONEFIELD               = (1<<6)
+} GstVideoCodecFrameFlags;
+
+/**
+ * GST_VIDEO_CODEC_FRAME_FLAGS:
+ * @frame: a #GstVideoCodecFrame
+ *
+ * The entire set of flags for the @frame
+ */
+#define GST_VIDEO_CODEC_FRAME_FLAGS(frame) ((frame)->flags)
+
+/**
+ * GST_VIDEO_CODEC_FRAME_FLAG_IS_SET:
+ * @frame: a #GstVideoCodecFrame
+ * @flag: a flag to check for
+ *
+ * Checks whether the given @flag is set
+ */
+#define GST_VIDEO_CODEC_FRAME_FLAG_IS_SET(frame,flag)   !!(GST_VIDEO_CODEC_FRAME_FLAGS(frame) & (flag))
+
+/**
+ * GST_VIDEO_CODEC_FRAME_FLAG_SET:
+ * @frame: a #GstVideoCodecFrame
+ * @flag: Flag to set, can be any number of bits in guint32.
+ *
+ * This macro sets the given bits
+ */
+#define GST_VIDEO_CODEC_FRAME_FLAG_SET(frame,flag)     (GST_VIDEO_CODEC_FRAME_FLAGS(frame) |= (flag))
+
+/**
+ * GST_VIDEO_CODEC_FRAME_FLAG_UNSET:
+ * @frame: a #GstVideoCodecFrame
+ * @flag: Flag to unset
+ *
+ * This macro usets the given bits.
+ */
+#define GST_VIDEO_CODEC_FRAME_FLAG_UNSET(frame,flag)   (GST_VIDEO_CODEC_FRAME_FLAGS(frame) &= ~(flag))
+
+/**
+ * GST_VIDEO_CODEC_FRAME_IS_DECODE_ONLY:
+ * @frame: a #GstVideoCodecFrame
+ *
+ * Tests if the buffer should only be decoded but not sent downstream.
+ */
+#define GST_VIDEO_CODEC_FRAME_IS_DECODE_ONLY(frame)     (GST_VIDEO_CODEC_FRAME_FLAG_IS_SET(frame, GST_VIDEO_CODEC_FRAME_FLAG_DECODE_ONLY))
+
+/**
+ * GST_VIDEO_CODEC_FRAME_SET_DECODE_ONLY:
+ * @frame: a #GstVideoCodecFrame
+ *
+ * Sets the buffer to not be sent downstream.
+ *
+ * Decoder implementation can use this if they have frames that
+ * are not meant to be displayed.
+ *
+ * Encoder implementation can safely ignore this field.
+ */
+#define GST_VIDEO_CODEC_FRAME_SET_DECODE_ONLY(frame)    (GST_VIDEO_CODEC_FRAME_FLAG_SET(frame, GST_VIDEO_CODEC_FRAME_FLAG_DECODE_ONLY))
+
+/**
+ * GST_VIDEO_CODEC_FRAME_IS_SYNC_POINT:
+ * @frame: a #GstVideoCodecFrame
+ *
+ * Tests if the frame is a synchronization point (like a keyframe).
+ *
+ * Decoder implementations can use this to detect keyframes.
+ */
+#define GST_VIDEO_CODEC_FRAME_IS_SYNC_POINT(frame)      (GST_VIDEO_CODEC_FRAME_FLAG_IS_SET(frame, GST_VIDEO_CODEC_FRAME_FLAG_SYNC_POINT))
+
+/**
+ * GST_VIDEO_CODEC_FRAME_SET_SYNC_POINT:
+ * @frame: a #GstVideoCodecFrame
+ *
+ * Sets the frame to be a synchronization point (like a keyframe).
+ *
+ * Encoder implementations should set this accordingly.
+ *
+ * Decoder implementing parsing features should set this when they
+ * detect such a synchronization point.
+ */
+#define GST_VIDEO_CODEC_FRAME_SET_SYNC_POINT(frame)     (GST_VIDEO_CODEC_FRAME_FLAG_SET(frame, GST_VIDEO_CODEC_FRAME_FLAG_SYNC_POINT))
+#define GST_VIDEO_CODEC_FRAME_UNSET_SYNC_POINT(frame)   (GST_VIDEO_CODEC_FRAME_FLAG_UNSET(frame, GST_VIDEO_CODEC_FRAME_FLAG_SYNC_POINT))
+
+
+/**
+ * GST_VIDEO_CODEC_FRAME_IS_FORCE_KEYFRAME:
+ * @frame: a #GstVideoCodecFrame
+ *
+ * Tests if the frame must be encoded as a keyframe. Applies only to
+ * frames provided to encoders. Decoders can safely ignore this field.
+ */
+#define GST_VIDEO_CODEC_FRAME_IS_FORCE_KEYFRAME(frame)      (GST_VIDEO_CODEC_FRAME_FLAG_IS_SET(frame, GST_VIDEO_CODEC_FRAME_FLAG_FORCE_KEYFRAME))
+#define GST_VIDEO_CODEC_FRAME_SET_FORCE_KEYFRAME(frame)     (GST_VIDEO_CODEC_FRAME_FLAG_SET(frame, GST_VIDEO_CODEC_FRAME_FLAG_FORCE_KEYFRAME))
+#define GST_VIDEO_CODEC_FRAME_UNSET_FORCE_KEYFRAME(frame)   (GST_VIDEO_CODEC_FRAME_FLAG_UNSET(frame, GST_VIDEO_CODEC_FRAME_FLAG_FORCE_KEYFRAME))
+
+/**
+ * GST_VIDEO_CODEC_FRAME_IS_FORCE_KEYFRAME_HEADERS:
+ * @frame: a #GstVideoCodecFrame
+ *
+ * Tests if encoder should output stream headers before outputting the
+ * resulting encoded buffer for the given frame.
+ *
+ * Applies only to frames provided to encoders. Decoders can safely
+ * ignore this field.
+ */
+#define GST_VIDEO_CODEC_FRAME_IS_FORCE_KEYFRAME_HEADERS(frame)      (GST_VIDEO_CODEC_FRAME_FLAG_IS_SET(frame, GST_VIDEO_CODEC_FRAME_FLAG_FORCE_KEYFRAME_HEADERS))
+#define GST_VIDEO_CODEC_FRAME_SET_FORCE_KEYFRAME_HEADERS(frame)     (GST_VIDEO_CODEC_FRAME_FLAG_SET(frame, GST_VIDEO_CODEC_FRAME_FLAG_FORCE_KEYFRAME_HEADERS))
+#define GST_VIDEO_CODEC_FRAME_UNSET_FORCE_KEYFRAME_HEADERS(frame)   (GST_VIDEO_CODEC_FRAME_FLAG_UNSET(frame, GST_VIDEO_CODEC_FRAME_FLAG_FORCE_KEYFRAME_HEADERS))
+
+/**
+ * GstVideoCodecFrame:
+ * @pts: Presentation timestamp
+ * @dts: Decoding timestamp
+ * @duration: Duration of the frame
+ * @system_frame_number: Unique identifier for the frame. Use this if you need
+ *       to get hold of the frame later (like when data is being decoded).
+ *       Typical usage in decoders is to set this on the opaque value provided
+ *       to the library and get back the frame using gst_video_decoder_get_frame()
+ * @distance_from_sync: Distance in frames from the last synchronization point.
+ * @input_buffer: the input #GstBuffer that created this frame.
+ * @output_buffer: the output #GstBuffer. Implementations should set this either
+ *           directly, or by using the @gst_video_decoder_alloc_output_frame() or
+ *           @gst_video_decoder_alloc_output_buffer() methods.
+ * @field_index:
+ * @n_fields: number of fields in the frame (default 2). Decoders can change
+ *       this if the frame contains a different number of fields. 
+ * @deadline: Running time when the frame will be used.
+ * @events: Events that will be pushed downstream before this frame is pushed.
+ *
+ * A #GstVideoCodecFrame represents a video frame both in raw and
+ * encoded form.
+ */
+struct _GstVideoCodecFrame
+{
+  /*< private >*/
+  gint ref_count;
+
+  guint32 flags;
+
+  /*< public >*/
+  guint32 system_frame_number;	/* ED */
+  guint32 decode_frame_number;	/* ED */
+  guint32 presentation_frame_number; /* ED */
+
+  GstClockTime dts;       /* ED */
+  GstClockTime pts;       /* ED */
+  GstClockTime duration;  /* ED */
+
+  int distance_from_sync;	/* ED */
+
+  GstBuffer *input_buffer;	/* ED */
+  GstBuffer *output_buffer;	/* ED */
+
+  GstClockTime deadline;	/* D */
+
+  /*< private >*/
+
+  /* Events that should be pushed downstream *before*
+   * the next output_buffer */
+  GList *events;		/* ED */
+
+  gpointer       user_data;
+  GDestroyNotify user_data_destroy_notify;
+
+  void         *padding[GST_PADDING_LARGE];
+};
+
+/* GstVideoCodecState */
+GType           gst_video_codec_state_get_type (void);
+
+GstVideoCodecState *gst_video_codec_state_ref (GstVideoCodecState * state);
+
+void                gst_video_codec_state_unref (GstVideoCodecState * state);
+
+
+/* GstVideoCodecFrame */
+GType                gst_video_codec_frame_get_type (void);
+
+GstVideoCodecFrame  *gst_video_codec_frame_ref (GstVideoCodecFrame * frame);
+void                 gst_video_codec_frame_unref (GstVideoCodecFrame * frame);
+void                 gst_video_codec_frame_set_user_data (GstVideoCodecFrame *frame,
+						          gpointer user_data,
+				                          GDestroyNotify notify);
+gpointer             gst_video_codec_frame_get_user_data (GstVideoCodecFrame *frame);
+
+G_END_DECLS
+
+#endif
diff --git a/gst-libs/gst/video/video-blend.c b/gst-libs/gst/video/video-blend.c
index 8dc21c3..2d47073 100644
--- a/gst-libs/gst/video/video-blend.c
+++ b/gst-libs/gst/video/video-blend.c
@@ -231,7 +231,41 @@ fill_planes (GstBlendVideoFormatInfo * info)
       info->offset[1] = info->offset[2] +
           info->stride[1] * (GST_ROUND_UP_4 (height) / 4);
       break;
+    case GST_VIDEO_FORMAT_I420_10LE:
+    case GST_VIDEO_FORMAT_I420_10BE:
+      info->stride[0] = GST_ROUND_UP_4 (width * 2);
+      info->stride[1] = GST_ROUND_UP_4 (width);
+      info->stride[2] = info->stride[1];
+      info->offset[0] = 0;
+      info->offset[1] = info->stride[0] * GST_ROUND_UP_2 (height);
+      info->offset[2] = info->offset[1] +
+          info->stride[1] * (GST_ROUND_UP_2 (height) / 2);
+      info->size = info->offset[2] +
+          info->stride[2] * (GST_ROUND_UP_2 (height) / 2);
+      break;
+    case GST_VIDEO_FORMAT_I422_10LE:
+    case GST_VIDEO_FORMAT_I422_10BE:
+      info->stride[0] = GST_ROUND_UP_4 (width * 2);
+      info->stride[1] = GST_ROUND_UP_4 (width);
+      info->stride[2] = info->stride[1];
+      info->offset[0] = 0;
+      info->offset[1] = info->stride[0] * GST_ROUND_UP_2 (height);
+      info->offset[2] = info->offset[1] +
+          info->stride[1] * GST_ROUND_UP_2 (height);
+      info->size = info->offset[2] + info->stride[2] * GST_ROUND_UP_2 (height);
+      break;
+    case GST_VIDEO_FORMAT_Y444_10LE:
+    case GST_VIDEO_FORMAT_Y444_10BE:
+      info->stride[0] = GST_ROUND_UP_4 (width * 2);
+      info->stride[1] = info->stride[0];
+      info->stride[2] = info->stride[0];
+      info->offset[0] = 0;
+      info->offset[1] = info->stride[0] * height;
+      info->offset[2] = info->offset[1] * 2;
+      info->size = info->stride[0] * height * 3;
+      break;
     case GST_VIDEO_FORMAT_UNKNOWN:
+    default:
       GST_ERROR ("invalid format");
       g_warning ("invalid format");
       break;
@@ -1156,6 +1190,34 @@ matrix_identity (guint8 * tmpline, guint width)
 }
 
 static void
+matrix_prea_rgb_to_yuv (guint8 * tmpline, guint width)
+{
+  int i;
+  int a, r, g, b;
+  int y, u, v;
+
+  for (i = 0; i < width; i++) {
+    a = tmpline[i * 4 + 0];
+    r = tmpline[i * 4 + 1];
+    g = tmpline[i * 4 + 2];
+    b = tmpline[i * 4 + 3];
+    if (a) {
+      r = (r * 255 + a / 2) / a;
+      g = (g * 255 + a / 2) / a;
+      b = (b * 255 + a / 2) / a;
+    }
+
+    y = (47 * r + 157 * g + 16 * b + 4096) >> 8;
+    u = (-26 * r - 87 * g + 112 * b + 32768) >> 8;
+    v = (112 * r - 102 * g - 10 * b + 32768) >> 8;
+
+    tmpline[i * 4 + 1] = CLAMP (y, 0, 255);
+    tmpline[i * 4 + 2] = CLAMP (u, 0, 255);
+    tmpline[i * 4 + 3] = CLAMP (v, 0, 255);
+  }
+}
+
+static void
 matrix_rgb_to_yuv (guint8 * tmpline, guint width)
 {
   int i;
@@ -1221,15 +1283,22 @@ lookup_getput (GetPutLine * getput, GstVideoFormat fmt)
   return FALSE;
 }
 
-#define BLEND(ret, alpha, v0, v1) \
-{ \
+#define BLEND00(ret, alpha, v0, v1) \
+G_STMT_START { \
   ret = (v0 * alpha + v1 * (255 - alpha)) / 255; \
-}
+} G_STMT_END
+
+#define BLEND10(ret, alpha, v0, v1) \
+G_STMT_START { \
+  ret = v0 + (v1 * (255 - alpha)) / 255; \
+} G_STMT_END
 
+/* returns newly-allocated pixels in src->pixels, which caller must g_free() */
 void
 video_blend_scale_linear_RGBA (GstBlendVideoFormatInfo * src,
     gint dest_height, gint dest_width)
 {
+  const guint8 *src_pixels;
   int acc;
   int y_increment;
   int x_increment;
@@ -1260,8 +1329,10 @@ video_blend_scale_linear_RGBA (GstBlendVideoFormatInfo * src,
 
 #define LINE(x) ((tmpbuf) + (dest_size)*((x)&1))
 
+  src_pixels = src->pixels;
+
   acc = 0;
-  orc_resample_bilinear_u32 (LINE (0), src->pixels, 0, x_increment, dest_width);
+  orc_resample_bilinear_u32 (LINE (0), src_pixels, 0, x_increment, dest_width);
   y1 = 0;
   for (i = 0; i < dest_height; i++) {
     j = acc >> 16;
@@ -1272,12 +1343,12 @@ video_blend_scale_linear_RGBA (GstBlendVideoFormatInfo * src,
     } else {
       if (j > y1) {
         orc_resample_bilinear_u32 (LINE (j),
-            src->pixels + j * src_stride, 0, x_increment, dest_width);
+            src_pixels + j * src_stride, 0, x_increment, dest_width);
         y1++;
       }
       if (j >= y1) {
         orc_resample_bilinear_u32 (LINE (j + 1),
-            src->pixels + (j + 1) * src_stride, 0, x_increment, dest_width);
+            src_pixels + (j + 1) * src_stride, 0, x_increment, dest_width);
         y1++;
       }
       orc_merge_linear_u8 (dest_pixels + i * dest_stride,
@@ -1289,7 +1360,7 @@ video_blend_scale_linear_RGBA (GstBlendVideoFormatInfo * src,
 
   /* Update src, our reference to the old src->pixels is lost */
   video_blend_format_info_init (src, dest_pixels, dest_height, dest_width,
-      src->fmt);
+      src->fmt, src->premultiplied_alpha);
 
   g_free (tmpbuf);
 }
@@ -1300,20 +1371,34 @@ video_blend_scale_linear_RGBA (GstBlendVideoFormatInfo * src,
  * @dest
  * @x: The x offset in pixel where the @src image should be blended
  * @y: the y offset in pixel where the @src image should be blended
+ * @global_alpha: the global_alpha each per-pixel alpha value is multiplied
+ *                with
  *
  * Lets you blend the @src image into the @dest image
  */
 gboolean
 video_blend (GstBlendVideoFormatInfo * dest,
-    GstBlendVideoFormatInfo * src, guint x, guint y)
+    GstBlendVideoFormatInfo * src, gint x, gint y, gfloat global_alpha)
 {
-  guint i, j;
-  guint8 alpha;
+  guint i, j, global_alpha_val, src_width, src_height;
   GetPutLine getputdest, getputsrc;
+  gint src_stride;
+  guint8 *tmpdestline = NULL, *tmpsrcline = NULL;
+  gboolean src_premultiplied_alpha;
+
+  g_assert (dest != NULL);
+  g_assert (src != NULL);
+
+  global_alpha_val = 256.0 * global_alpha;
+
+  /* we do no support writing to premultiplied alpha, though that should
+     just be a matter of adding blenders below (BLEND01 and BLEND11) */
+  g_return_val_if_fail (!dest->premultiplied_alpha, FALSE);
+  src_premultiplied_alpha = src->premultiplied_alpha;
 
-  gint src_stride = src->width * 4;
-  guint8 *tmpdestline = g_malloc (sizeof (guint8) * (dest->width + 8) * 4);
-  guint8 *tmpsrcline = g_malloc (sizeof (guint8) * (dest->width + 8) * 4);
+  src_stride = src->width * 4;
+  tmpdestline = g_malloc (sizeof (guint8) * (dest->width + 8) * 4);
+  tmpsrcline = g_malloc (sizeof (guint8) * (dest->width + 8) * 4);
 
   ensure_debug_category ();
 
@@ -1324,9 +1409,18 @@ video_blend (GstBlendVideoFormatInfo * dest,
   if (!lookup_getput (&getputsrc, src->fmt))
     goto failed;
 
-  if (gst_video_format_is_rgb (src->fmt) != gst_video_format_is_rgb (dest->fmt))
-    getputsrc.matrix = gst_video_format_is_rgb (src->fmt) ?
-        matrix_rgb_to_yuv : matrix_yuv_to_rgb;
+  if (gst_video_format_is_rgb (src->fmt) != gst_video_format_is_rgb (dest->fmt)) {
+    if (gst_video_format_is_rgb (src->fmt)) {
+      if (src_premultiplied_alpha) {
+        getputsrc.matrix = matrix_prea_rgb_to_yuv;
+        src_premultiplied_alpha = FALSE;
+      } else {
+        getputsrc.matrix = matrix_rgb_to_yuv;
+      }
+    } else {
+      getputsrc.matrix = matrix_yuv_to_rgb;
+    }
+  }
 
   /* adjust src pointers for negative sizes */
   if (x < 0) {
@@ -1348,24 +1442,56 @@ video_blend (GstBlendVideoFormatInfo * dest,
   if (y + src->height > dest->height)
     src->height = dest->height - y;
 
+  src_width = src->width;
+  src_height = src->height;
+
   /* Mainloop doing the needed conversions, and blending */
-  for (i = y; i < y + src->height; i++) {
+  for (i = y; i < y + src_height; i++) {
 
     getputdest.getline (tmpdestline, dest, x, i);
     getputsrc.getline (tmpsrcline, src, 0, (i - y));
 
-    getputsrc.matrix (tmpsrcline, src->width);
+    getputsrc.matrix (tmpsrcline, src_width);
 
     /* Here dest and src are both either in AYUV or ARGB
      * TODO: Make the orc version working properly*/
-    for (j = 0; j < src->width * 4; j += 4) {
-      alpha = tmpsrcline[j];
-
-      BLEND (tmpdestline[j + 1], alpha, tmpsrcline[j + 1], tmpdestline[j + 1]);
-      BLEND (tmpdestline[j + 2], alpha, tmpsrcline[j + 2], tmpdestline[j + 2]);
-      BLEND (tmpdestline[j + 3], alpha, tmpsrcline[j + 3], tmpdestline[j + 3]);
+#define BLENDLOOP(blender,alpha_val,alpha_scale)                                  \
+  do {                                                                            \
+    for (j = 0; j < src_width * 4; j += 4) {                                      \
+      guint8 alpha;                                                               \
+                                                                                  \
+      alpha = (tmpsrcline[j] * alpha_val) / alpha_scale;                          \
+                                                                                  \
+      blender (tmpdestline[j + 1], alpha, tmpsrcline[j + 1], tmpdestline[j + 1]); \
+      blender (tmpdestline[j + 2], alpha, tmpsrcline[j + 2], tmpdestline[j + 2]); \
+      blender (tmpdestline[j + 3], alpha, tmpsrcline[j + 3], tmpdestline[j + 3]); \
+    }                                                                             \
+  } while(0)
+
+    if (G_LIKELY (global_alpha == 1.0)) {
+      if (src_premultiplied_alpha && dest->premultiplied_alpha) {
+        /* BLENDLOOP (BLEND11, 1, 1); */
+      } else if (!src_premultiplied_alpha && dest->premultiplied_alpha) {
+        /* BLENDLOOP (BLEND01, 1, 1); */
+      } else if (src_premultiplied_alpha && !dest->premultiplied_alpha) {
+        BLENDLOOP (BLEND10, 1, 1);
+      } else {
+        BLENDLOOP (BLEND00, 1, 1);
+      }
+    } else {
+      if (src_premultiplied_alpha && dest->premultiplied_alpha) {
+        /* BLENDLOOP (BLEND11, global_alpha_val, 256); */
+      } else if (!src_premultiplied_alpha && dest->premultiplied_alpha) {
+        /* BLENDLOOP (BLEND01, global_alpha_val, 256); */
+      } else if (src_premultiplied_alpha && !dest->premultiplied_alpha) {
+        BLENDLOOP (BLEND10, global_alpha_val, 256);
+      } else {
+        BLENDLOOP (BLEND00, global_alpha_val, 256);
+      }
     }
 
+#undef BLENDLOOP
+
     /* FIXME
      * #if G_BYTE_ORDER == LITTLE_ENDIAN
      * orc_blend_little (tmpdestline, tmpsrcline, dest->width);
@@ -1403,7 +1529,8 @@ failed:
  */
 void
 video_blend_format_info_init (GstBlendVideoFormatInfo * info,
-    guint8 * pixels, guint height, guint width, GstVideoFormat fmt)
+    guint8 * pixels, guint height, guint width, GstVideoFormat fmt,
+    gboolean premultiplied_alpha)
 {
   guint nb_component = gst_video_format_has_alpha (fmt) ? 4 : 3;
 
@@ -1417,6 +1544,7 @@ video_blend_format_info_init (GstBlendVideoFormatInfo * info,
   info->height = height;
   info->pixels = pixels;
   info->fmt = fmt;
+  info->premultiplied_alpha = premultiplied_alpha;
   info->size = gst_video_format_get_size (fmt, height, width);
 
   fill_planes (info);
diff --git a/gst-libs/gst/video/video-blend.h b/gst-libs/gst/video/video-blend.h
index 3f5e0cd..ded5962 100644
--- a/gst-libs/gst/video/video-blend.h
+++ b/gst-libs/gst/video/video-blend.h
@@ -53,6 +53,8 @@ struct _GstBlendVideoFormatInfo
     guint8        * pixels;
     gsize           size;
 
+    gboolean        premultiplied_alpha;
+
     /* YUV components: Y=0, U=1, V=2, A=3
      * RGB components: R=0, G=1, B=2, A=3 */
     gint            offset[MAX_VIDEO_PLANES];
@@ -61,13 +63,15 @@ struct _GstBlendVideoFormatInfo
 
 void       video_blend_format_info_init   (GstBlendVideoFormatInfo * info,
                                            guint8 *pixels, guint height,
-                                           guint width, GstVideoFormat fmt);
+                                           guint width, GstVideoFormat fmt,
+                                           gboolean premultiplied_alpha);
 
 void       video_blend_scale_linear_RGBA  (GstBlendVideoFormatInfo * src,
                                            gint dest_height, gint dest_width);
 
 gboolean   video_blend                    (GstBlendVideoFormatInfo * dest,
                                            GstBlendVideoFormatInfo * src,
-                                           guint x, guint y);
+                                           gint x, gint y,
+                                           gfloat global_alpha);
 
 #endif
diff --git a/gst-libs/gst/video/video-overlay-composition.c b/gst-libs/gst/video/video-overlay-composition.c
index 3bfbad1..f9f90c5 100644
--- a/gst-libs/gst/video/video-overlay-composition.c
+++ b/gst-libs/gst/video/video-overlay-composition.c
@@ -69,6 +69,7 @@
 
 #include "video-overlay-composition.h"
 #include "video-blend.h"
+#include <string.h>
 
 struct _GstVideoOverlayComposition
 {
@@ -108,6 +109,9 @@ struct _GstVideoOverlayRectangle
   /* The format of the data in pixels */
   GstVideoFormat format;
 
+  /* The flags associated to this rectangle */
+  GstVideoOverlayFormatFlags flags;
+
   /* Refcounted blob of memory, no caps or timestamps */
   GstBuffer *pixels;
 
@@ -131,6 +135,19 @@ struct _GstVideoOverlayRectangle
    * rectangles have expired. */
   guint seq_num;
 
+  /* global alpha: global alpha value of the rectangle. Each each per-pixel
+   * alpha value of image-data will be multiplied with the global alpha value
+   * during blending.
+   * Can be used for efficient fading in/out of overlay rectangles.
+   * GstElements that render OverlayCompositions and don't support global alpha
+   * should simply ignore it.*/
+  gfloat global_alpha;
+
+  /* track alpha-values already applied: */
+  gfloat applied_global_alpha;
+  /* store initial per-pixel alpha values: */
+  guint8 *initial_alpha;
+
   /* FIXME: we may also need a (private) way to cache converted/scaled
    * pixel blobs */
 #if !GLIB_CHECK_VERSION (2, 31, 0)
@@ -501,7 +518,7 @@ gst_video_overlay_composition_blend (GstVideoOverlayComposition * comp,
   }
 
   video_blend_format_info_init (&video_info, GST_BUFFER_DATA (video_buf),
-      h, w, fmt);
+      h, w, fmt, FALSE);
 
   num = comp->num_rectangles;
   GST_LOG ("Blending composition %p with %u rectangles onto video buffer %p "
@@ -518,7 +535,8 @@ gst_video_overlay_composition_blend (GstVideoOverlayComposition * comp,
 
     video_blend_format_info_init (&rectangle_info,
         GST_BUFFER_DATA (rect->pixels), rect->height, rect->width,
-        rect->format);
+        rect->format,
+        ! !(rect->flags & GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA));
 
     needs_scaling = gst_video_overlay_rectangle_needs_scaling (rect);
     if (needs_scaling) {
@@ -526,7 +544,8 @@ gst_video_overlay_composition_blend (GstVideoOverlayComposition * comp,
           rect->render_width);
     }
 
-    ret = video_blend (&video_info, &rectangle_info, rect->x, rect->y);
+    ret = video_blend (&video_info, &rectangle_info, rect->x, rect->y,
+        rect->global_alpha);
     if (!ret) {
       GST_WARNING ("Could not blend overlay rectangle onto video buffer");
     }
@@ -679,6 +698,8 @@ gst_video_overlay_rectangle_finalize (GstMiniObject * mini_obj)
     rect->scaled_rectangles =
         g_list_delete_link (rect->scaled_rectangles, rect->scaled_rectangles);
   }
+
+  g_free (rect->initial_alpha);
 #if !GLIB_CHECK_VERSION (2, 31, 0)
   g_static_mutex_free (&rect->lock);
 #else
@@ -706,6 +727,23 @@ gst_video_overlay_rectangle_instance_init (GstMiniObject * mini_obj)
 #endif
 }
 
+static inline gboolean
+gst_video_overlay_rectangle_check_flags (GstVideoOverlayFormatFlags flags)
+{
+  /* Check flags only contains flags we know about */
+  return (flags & ~(GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA |
+          GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA)) == 0;
+}
+
+static gboolean
+gst_video_overlay_rectangle_is_same_alpha_type (GstVideoOverlayFormatFlags
+    flags1, GstVideoOverlayFormatFlags flags2)
+{
+  return ((flags1 ^ flags2) & GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA)
+      == 0;
+}
+
+
 /**
  * gst_video_overlay_rectangle_new_argb:
  * @pixels: (transfer none): a #GstBuffer pointing to the pixel memory
@@ -718,7 +756,7 @@ gst_video_overlay_rectangle_instance_init (GstMiniObject * mini_obj)
  *     overlay rectangle should be rendered to
  * @render_width: the render width of this rectangle on the video
  * @render_height: the render height of this rectangle on the video
- * @flags: flags (currently unused)
+ * @flags: flags
  *
  * Creates a new video overlay rectangle with ARGB pixel data. The layout
  * of the components in memory is B-G-R-A on little-endian platforms
@@ -726,9 +764,9 @@ gst_video_overlay_rectangle_instance_init (GstMiniObject * mini_obj)
  * platforms (corresponding to #GST_VIDEO_FORMAT_ARGB). In other words,
  * pixels are treated as 32-bit words and the lowest 8 bits then contain
  * the blue component value and the highest 8 bits contain the alpha
- * component value. The RGB values are non-premultiplied. This is the
- * format that is used by most hardware, and also many rendering libraries
- * such as Cairo, for example.
+ * component value. Unless specified in the flags, the RGB values are
+ * non-premultiplied. This is the format that is used by most hardware,
+ * and also many rendering libraries such as Cairo, for example.
  *
  * Returns: (transfer full): a new #GstVideoOverlayRectangle. Unref with
  *     gst_video_overlay_rectangle_unref() when no longer needed.
@@ -748,7 +786,7 @@ gst_video_overlay_rectangle_new_argb (GstBuffer * pixels,
   g_return_val_if_fail (stride >= (4 * width), NULL);
   g_return_val_if_fail (height > 0 && width > 0, NULL);
   g_return_val_if_fail (render_height > 0 && render_width > 0, NULL);
-  g_return_val_if_fail (flags == 0, NULL);
+  g_return_val_if_fail (gst_video_overlay_rectangle_check_flags (flags), NULL);
 
   rect = (GstVideoOverlayRectangle *)
       gst_mini_object_new (GST_TYPE_VIDEO_OVERLAY_RECTANGLE);
@@ -758,6 +796,7 @@ gst_video_overlay_rectangle_new_argb (GstBuffer * pixels,
 #else
   rect->format = GST_VIDEO_FORMAT_ARGB;
 #endif
+
   rect->pixels = gst_buffer_ref (pixels);
 
   rect->width = width;
@@ -769,11 +808,18 @@ gst_video_overlay_rectangle_new_argb (GstBuffer * pixels,
   rect->render_width = render_width;
   rect->render_height = render_height;
 
+  rect->global_alpha = 1.0;
+  rect->applied_global_alpha = 1.0;
+  rect->initial_alpha = NULL;
+
+  rect->flags = flags;
+
   rect->seq_num = gst_video_overlay_get_seqnum ();
 
   GST_LOG ("new rectangle %p: %ux%u => %ux%u @ %u,%u, seq_num %u, format %u, "
-      "pixels %p", rect, width, height, render_width, render_height, render_x,
-      render_y, rect->seq_num, rect->format, pixels);
+      "flags %x, pixels %p, global_alpha=%f", rect, width, height, render_width,
+      render_height, render_x, render_y, rect->seq_num, rect->format,
+      rect->flags, pixels, rect->global_alpha);
 
   return rect;
 }
@@ -846,39 +892,158 @@ gst_video_overlay_rectangle_set_render_rectangle (GstVideoOverlayRectangle *
   rectangle->render_height = render_height;
 }
 
-/**
- * gst_video_overlay_rectangle_get_pixels_argb:
- * @rectangle: a #GstVideoOverlayRectangle
- * @stride: (out) (allow-none): address of guint variable where to store the
- *    row stride of the ARGB pixel data in the buffer
- * @flags: flags (unused)
- *
- * Returns: (transfer none): a #GstBuffer holding the ARGB pixel data with
- *    row stride @stride and width and height of the render dimensions as per
- *    gst_video_overlay_rectangle_get_render_rectangle(). This function does
- *    not return a reference, the caller should obtain a reference of her own
- *    with gst_buffer_ref() if needed.
- *
- * Since: 0.10.36
- */
-GstBuffer *
-gst_video_overlay_rectangle_get_pixels_argb (GstVideoOverlayRectangle *
-    rectangle, guint * stride, GstVideoOverlayFormatFlags flags)
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+# define ARGB_A 3
+# define ARGB_R 2
+# define ARGB_G 1
+# define ARGB_B 0
+#else
+# define ARGB_A 0
+# define ARGB_R 1
+# define ARGB_G 2
+# define ARGB_B 3
+#endif
+
+/* FIXME: orc-ify */
+static void
+gst_video_overlay_rectangle_premultiply (GstBlendVideoFormatInfo * info)
+{
+  int i, j;
+  for (j = 0; j < info->height; ++j) {
+    guint8 *line = info->pixels + info->stride[0] * j;
+    for (i = 0; i < info->width; ++i) {
+      int a = line[ARGB_A];
+      line[ARGB_R] = line[ARGB_R] * a / 255;
+      line[ARGB_G] = line[ARGB_G] * a / 255;
+      line[ARGB_B] = line[ARGB_B] * a / 255;
+      line += 4;
+    }
+  }
+}
+
+/* FIXME: orc-ify */
+static void
+gst_video_overlay_rectangle_unpremultiply (GstBlendVideoFormatInfo * info)
+{
+  int i, j;
+  for (j = 0; j < info->height; ++j) {
+    guint8 *line = info->pixels + info->stride[0] * j;
+    for (i = 0; i < info->width; ++i) {
+      int a = line[ARGB_A];
+      if (a) {
+        line[ARGB_R] = MIN ((line[ARGB_R] * 255 + a / 2) / a, 255);
+        line[ARGB_G] = MIN ((line[ARGB_G] * 255 + a / 2) / a, 255);
+        line[ARGB_B] = MIN ((line[ARGB_B] * 255 + a / 2) / a, 255);
+      }
+      line += 4;
+    }
+  }
+}
+
+
+static void
+gst_video_overlay_rectangle_extract_alpha (GstVideoOverlayRectangle * rect)
+{
+  guint8 *src, *dst;
+  int offset = 0;
+  int alpha_size = rect->stride * rect->height / 4;
+
+  g_free (rect->initial_alpha);
+  rect->initial_alpha = NULL;
+
+  rect->initial_alpha = g_malloc (alpha_size);
+  src = GST_BUFFER_DATA (rect->pixels);
+  dst = rect->initial_alpha;
+  /* FIXME we're accessing possibly uninitialised bytes from the row padding */
+  while (offset < alpha_size) {
+    dst[offset] = src[offset * 4 + ARGB_A];
+    ++offset;
+  }
+}
+
+
+static void
+gst_video_overlay_rectangle_apply_global_alpha (GstVideoOverlayRectangle * rect,
+    float global_alpha)
 {
+  guint8 *src, *dst;
+  guint offset = 0;
+
+  g_assert (!(rect->applied_global_alpha != 1.0
+          && rect->initial_alpha == NULL));
+
+  if (global_alpha == rect->applied_global_alpha)
+    return;
+
+  if (rect->initial_alpha == NULL)
+    gst_video_overlay_rectangle_extract_alpha (rect);
+
+  src = rect->initial_alpha;
+  rect->pixels = gst_buffer_make_writable (rect->pixels);
+  dst = GST_BUFFER_DATA (rect->pixels);
+  while (offset < (rect->height * rect->stride / 4)) {
+    guint doff = offset * 4;
+    guint8 na = (guint8) src[offset] * global_alpha;
+    if (! !(rect->flags & GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA)) {
+      dst[doff + ARGB_R] =
+          (guint8) ((double) (dst[doff + ARGB_R] * 255) / (double) dst[doff +
+              ARGB_A]) * na / 255;
+      dst[doff + ARGB_G] =
+          (guint8) ((double) (dst[doff + ARGB_G] * 255) / (double) dst[doff +
+              ARGB_A]) * na / 255;
+      dst[doff + ARGB_B] =
+          (guint8) ((double) (dst[doff + ARGB_B] * 255) / (double) dst[doff +
+              ARGB_A]) * na / 255;
+    }
+    dst[doff + ARGB_A] = na;
+    ++offset;
+  }
+
+  rect->applied_global_alpha = global_alpha;
+}
+
+static GstBuffer *
+gst_video_overlay_rectangle_get_pixels_argb_internal (GstVideoOverlayRectangle *
+    rectangle, guint * stride, GstVideoOverlayFormatFlags flags,
+    gboolean unscaled)
+{
+  GstVideoOverlayFormatFlags new_flags;
   GstVideoOverlayRectangle *scaled_rect = NULL;
   GstBlendVideoFormatInfo info;
   GstBuffer *buf;
   GList *l;
+  guint wanted_width = unscaled ? rectangle->width : rectangle->render_width;
+  guint wanted_height = unscaled ? rectangle->height : rectangle->render_height;
+  gboolean apply_global_alpha;
+  gboolean revert_global_alpha;
 
   g_return_val_if_fail (GST_IS_VIDEO_OVERLAY_RECTANGLE (rectangle), NULL);
-  g_return_val_if_fail (flags == 0, NULL);
   g_return_val_if_fail (stride != NULL, NULL);
+  g_return_val_if_fail (gst_video_overlay_rectangle_check_flags (flags), NULL);
+
+  apply_global_alpha =
+      (! !(rectangle->flags & GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA)
+      && !(flags & GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA));
+  revert_global_alpha =
+      (! !(rectangle->flags & GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA)
+      && ! !(flags & GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA));
 
   /* This assumes we don't need to adjust the format */
-  if (rectangle->render_width == rectangle->width &&
-      rectangle->render_height == rectangle->height) {
-    *stride = rectangle->stride;
-    return rectangle->pixels;
+  if (wanted_width == rectangle->width &&
+      wanted_height == rectangle->height &&
+      gst_video_overlay_rectangle_is_same_alpha_type (rectangle->flags,
+          flags)) {
+    /* don't need to apply/revert global-alpha either: */
+    if ((!apply_global_alpha
+            || rectangle->applied_global_alpha == rectangle->global_alpha)
+        && (!revert_global_alpha || rectangle->applied_global_alpha == 1.0)) {
+      *stride = rectangle->stride;
+      return rectangle->pixels;
+    } else {
+      /* only apply/revert global-alpha */
+      scaled_rect = rectangle;
+      goto done;
+    }
   }
 
   /* see if we've got one cached already */
@@ -886,8 +1051,9 @@ gst_video_overlay_rectangle_get_pixels_argb (GstVideoOverlayRectangle *
   for (l = rectangle->scaled_rectangles; l != NULL; l = l->next) {
     GstVideoOverlayRectangle *r = l->data;
 
-    if (r->width == rectangle->render_width &&
-        r->height == rectangle->render_height) {
+    if (r->width == wanted_width &&
+        r->height == wanted_height &&
+        gst_video_overlay_rectangle_is_same_alpha_type (r->flags, flags)) {
       /* we'll keep these rectangles around until finalize, so it's ok not
        * to take our own ref here */
       scaled_rect = r;
@@ -899,12 +1065,31 @@ gst_video_overlay_rectangle_get_pixels_argb (GstVideoOverlayRectangle *
   if (scaled_rect != NULL)
     goto done;
 
-  /* not cached yet, do the scaling and put the result into our cache */
+  /* not cached yet, do the preprocessing and put the result into our cache */
   video_blend_format_info_init (&info, GST_BUFFER_DATA (rectangle->pixels),
-      rectangle->height, rectangle->width, rectangle->format);
+      rectangle->height, rectangle->width, rectangle->format,
+      ! !(rectangle->flags &
+          GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA));
+
+  if (wanted_width != rectangle->width || wanted_height != rectangle->height) {
+    /* we could check the cache for a scaled rect with global_alpha == 1 here */
+    video_blend_scale_linear_RGBA (&info, wanted_height, wanted_width);
+  } else {
+    /* if we don't have to scale, we have to modify the alpha values, so we
+     * need to make a copy of the pixel memory (and we take ownership below) */
+    info.pixels = g_memdup (info.pixels, info.size);
+  }
 
-  video_blend_scale_linear_RGBA (&info, rectangle->render_height,
-      rectangle->render_width);
+  new_flags = rectangle->flags;
+  if (!gst_video_overlay_rectangle_is_same_alpha_type (rectangle->flags, flags)) {
+    if (rectangle->flags & GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA) {
+      gst_video_overlay_rectangle_unpremultiply (&info);
+      new_flags &= ~GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA;
+    } else {
+      gst_video_overlay_rectangle_premultiply (&info);
+      new_flags |= GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA;
+    }
+  }
 
   buf = gst_buffer_new ();
   GST_BUFFER_DATA (buf) = info.pixels;
@@ -912,9 +1097,11 @@ gst_video_overlay_rectangle_get_pixels_argb (GstVideoOverlayRectangle *
   GST_BUFFER_SIZE (buf) = info.size;
 
   scaled_rect = gst_video_overlay_rectangle_new_argb (buf,
-      rectangle->render_width, rectangle->render_height, info.stride[0],
-      0, 0, rectangle->render_width, rectangle->render_height, 0);
-
+      wanted_width, wanted_height, info.stride[0],
+      0, 0, wanted_width, wanted_height, new_flags);
+  if (rectangle->global_alpha != 1.0)
+    gst_video_overlay_rectangle_set_global_alpha (scaled_rect,
+        rectangle->global_alpha);
   gst_buffer_unref (buf);
 
   GST_RECTANGLE_LOCK (rectangle);
@@ -924,10 +1111,50 @@ gst_video_overlay_rectangle_get_pixels_argb (GstVideoOverlayRectangle *
 
 done:
 
+  GST_RECTANGLE_LOCK (rectangle);
+  if (apply_global_alpha
+      && scaled_rect->applied_global_alpha != rectangle->global_alpha) {
+    gst_video_overlay_rectangle_apply_global_alpha (scaled_rect,
+        rectangle->global_alpha);
+    gst_video_overlay_rectangle_set_global_alpha (scaled_rect,
+        rectangle->global_alpha);
+  } else if (revert_global_alpha && scaled_rect->applied_global_alpha != 1.0) {
+    gst_video_overlay_rectangle_apply_global_alpha (scaled_rect, 1.0);
+  }
+  GST_RECTANGLE_UNLOCK (rectangle);
+
   *stride = scaled_rect->stride;
   return scaled_rect->pixels;
 }
 
+
+/**
+ * gst_video_overlay_rectangle_get_pixels_argb:
+ * @rectangle: a #GstVideoOverlayRectangle
+ * @stride: (out) (allow-none): address of guint variable where to store the
+ *    row stride of the ARGB pixel data in the buffer
+ * @flags: flags
+ *    If a global_alpha value != 1 is set for the rectangle, the caller
+ *    should set the #GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA flag
+ *    if he wants to apply global-alpha himself. If the flag is not set
+ *    global_alpha is applied internally before returning the pixel-data.
+ *
+ * Returns: (transfer none): a #GstBuffer holding the ARGB pixel data with
+ *    row stride @stride and width and height of the render dimensions as per
+ *    gst_video_overlay_rectangle_get_render_rectangle(). This function does
+ *    not return a reference, the caller should obtain a reference of her own
+ *    with gst_buffer_ref() if needed.
+ *
+ * Since: 0.10.36
+ */
+GstBuffer *
+gst_video_overlay_rectangle_get_pixels_argb (GstVideoOverlayRectangle *
+    rectangle, guint * stride, GstVideoOverlayFormatFlags flags)
+{
+  return gst_video_overlay_rectangle_get_pixels_argb_internal (rectangle,
+      stride, flags, FALSE);
+}
+
 /**
  * gst_video_overlay_rectangle_get_pixels_unscaled_argb:
  * @rectangle: a #GstVideoOverlayRectangle
@@ -937,7 +1164,11 @@ done:
  *    rectangle in pixels
  * @stride: (out): address of guint variable where to store the row
  *    stride of the ARGB pixel data in the buffer
- * @flags: flags for future use (unused)
+ * @flags: flags.
+ *    If a global_alpha value != 1 is set for the rectangle, the caller
+ *    should set the #GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA flag
+ *    if he wants to apply global-alpha himself. If the flag is not set
+ *    global_alpha is applied internally before returning the pixel-data.
  *
  * Retrieves the pixel data as it is. This is useful if the caller can
  * do the scaling itself when handling the overlaying. The rectangle will
@@ -959,13 +1190,89 @@ gst_video_overlay_rectangle_get_pixels_unscaled_argb (GstVideoOverlayRectangle *
   g_return_val_if_fail (width != NULL, NULL);
   g_return_val_if_fail (height != NULL, NULL);
   g_return_val_if_fail (stride != NULL, NULL);
-  g_return_val_if_fail (flags == 0, NULL);
 
   *width = rectangle->width;
   *height = rectangle->height;
-  *stride = rectangle->stride;
+  return gst_video_overlay_rectangle_get_pixels_argb_internal (rectangle,
+      stride, flags, TRUE);
+}
+
+/**
+ * gst_video_overlay_rectangle_get_flags:
+ * @rectangle: a #GstVideoOverlayRectangle
+ *
+ * Retrieves the flags associated with a #GstVideoOverlayRectangle.
+ * This is useful if the caller can handle both premultiplied alpha and
+ * non premultiplied alpha, for example. By knowing whether the rectangle
+ * uses premultiplied or not, it can request the pixel data in the format
+ * it is stored in, to avoid unnecessary conversion.
+ *
+ * Returns: the #GstVideoOverlayFormatFlags associated with the rectangle.
+ *
+ * Since: 0.10.37
+ */
+GstVideoOverlayFormatFlags
+gst_video_overlay_rectangle_get_flags (GstVideoOverlayRectangle * rectangle)
+{
+  g_return_val_if_fail (GST_IS_VIDEO_OVERLAY_RECTANGLE (rectangle),
+      GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE);
+
+  return rectangle->flags;
+}
+
+/**
+ * gst_video_overlay_rectangle_get_global_alpha:
+ * @rectangle: a #GstVideoOverlayRectangle
+ *
+ * Retrieves the global-alpha value associated with a #GstVideoOverlayRectangle.
+ *
+ * Returns: the global-alpha value associated with the rectangle.
+ *
+ * Since: 0.10.37
+ */
+gfloat
+gst_video_overlay_rectangle_get_global_alpha (GstVideoOverlayRectangle *
+    rectangle)
+{
+  g_return_val_if_fail (GST_IS_VIDEO_OVERLAY_RECTANGLE (rectangle), -1);
 
-  return rectangle->pixels;
+  return rectangle->global_alpha;
+}
+
+/**
+ * gst_video_overlay_rectangle_set_global_alpha:
+ * @rectangle: a #GstVideoOverlayRectangle
+ *
+ * Sets the global alpha value associated with a #GstVideoOverlayRectangle. Per-
+ * pixel alpha values are multiplied with this value. Valid
+ * values: 0 <= global_alpha <= 1; 1 to deactivate.
+ *
+ # @rectangle must be writable, meaning its refcount must be 1. You can
+ * make the rectangles inside a #GstVideoOverlayComposition writable using
+ * gst_video_overlay_composition_make_writable() or
+ * gst_video_overlay_composition_copy().
+ *
+ * Since: 0.10.37
+ */
+void
+gst_video_overlay_rectangle_set_global_alpha (GstVideoOverlayRectangle *
+    rectangle, gfloat global_alpha)
+{
+  g_return_if_fail (GST_IS_VIDEO_OVERLAY_RECTANGLE (rectangle));
+  g_return_if_fail (global_alpha >= 0 && global_alpha <= 1);
+
+  if (rectangle->global_alpha != global_alpha) {
+    rectangle->global_alpha = global_alpha;
+    if (global_alpha != 1)
+      rectangle->flags |= GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA;
+    else
+      rectangle->flags &= ~GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA;
+    /* update seq_num automatically to signal the consumer, that data has changed
+     * note, that this might mislead renderers, that can handle global-alpha
+     * themselves, because what they want to know is whether the actual pixel data
+     * has changed. */
+    rectangle->seq_num = gst_video_overlay_get_seqnum ();
+  }
 }
 
 /**
@@ -992,7 +1299,10 @@ gst_video_overlay_rectangle_copy (GstVideoOverlayRectangle * rectangle)
   copy = gst_video_overlay_rectangle_new_argb (rectangle->pixels,
       rectangle->width, rectangle->height, rectangle->stride,
       rectangle->x, rectangle->y,
-      rectangle->render_width, rectangle->render_height, 0);
+      rectangle->render_width, rectangle->render_height, rectangle->flags);
+  if (rectangle->global_alpha != 1)
+    gst_video_overlay_rectangle_set_global_alpha (copy,
+        rectangle->global_alpha);
 
   return copy;
 }
@@ -1006,6 +1316,16 @@ gst_video_overlay_rectangle_copy (GstVideoOverlayRectangle * rectangle)
  * (meaning there will never be a rectangle with the same sequence number as
  * a composition).
  *
+ * Using the sequence number of a rectangle as an indicator for changed
+ * pixel-data of a rectangle is dangereous. Some API calls, like e.g.
+ * gst_video_overlay_rectangle_set_global_alpha(), automatically update
+ * the per rectangle sequence number, which is misleading for renderers/
+ * consumers, that handle global-alpha themselves. For them  the
+ * pixel-data returned by gst_video_overlay_rectangle_get_pixels_*()
+ * wont be different for different global-alpha values. In this case a
+ * renderer could also use the GstBuffer pointers as a hint for changed
+ * pixel-data.
+ *
  * Returns: the sequence number of @rectangle
  *
  * Since: 0.10.36
diff --git a/gst-libs/gst/video/video-overlay-composition.h b/gst-libs/gst/video/video-overlay-composition.h
index 5ff7ce3..65538e4 100644
--- a/gst-libs/gst/video/video-overlay-composition.h
+++ b/gst-libs/gst/video/video-overlay-composition.h
@@ -95,13 +95,17 @@ gst_video_overlay_rectangle_unref (GstVideoOverlayRectangle * comp)
 /**
  * GstVideoOverlayFormatFlags:
  * @GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE: no flags
+ * @GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA: RGB are premultiplied by A/255. Since: 0.10.37
+ * @GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA: a global-alpha value != 1 is set. Since: 0.10.37
  *
  * Overlay format flags.
  *
  * Since: 0.10.36
  */
 typedef enum {
-  GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE = 0
+  GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE = 0,
+  GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA = 1,
+  GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA = 2
 } GstVideoOverlayFormatFlags;
 
 GType                        gst_video_overlay_rectangle_get_type (void);
@@ -138,6 +142,12 @@ GstBuffer *                  gst_video_overlay_rectangle_get_pixels_unscaled_arg
                                                                                    guint                     * stride,
                                                                                    GstVideoOverlayFormatFlags  flags);
 
+GstVideoOverlayFormatFlags   gst_video_overlay_rectangle_get_flags                (GstVideoOverlayRectangle  * rectangle);
+
+gfloat                       gst_video_overlay_rectangle_get_global_alpha         (GstVideoOverlayRectangle  * rectangle);
+void                         gst_video_overlay_rectangle_set_global_alpha         (GstVideoOverlayRectangle  * rectangle,
+                                                                                   gfloat                      global_alpha);
+
 /**
  * GstVideoOverlayComposition:
  *
diff --git a/gst-libs/gst/video/video.c b/gst-libs/gst/video/video.c
index f22ff4c..712926e 100644
--- a/gst-libs/gst/video/video.c
+++ b/gst-libs/gst/video/video.c
@@ -23,6 +23,7 @@
 #  include "config.h"
 #endif
 
+#include <string.h>
 #include "video.h"
 
 /**
@@ -47,6 +48,247 @@ static GstVideoFormat gst_video_format_from_rgb16_masks (int red_mask,
     int green_mask, int blue_mask);
 
 
+static int fill_planes (GstVideoInfo * info);
+
+typedef struct
+{
+  guint32 fourcc;
+  GstVideoFormatInfo info;
+} VideoFormat;
+
+/* depths: bits, n_components, shift, depth */
+#define DPTH0            0, 0, { 0, 0, 0, 0 }, { 0, 0, 0, 0 }
+#define DPTH8            8, 1, { 0, 0, 0, 0 }, { 8, 0, 0, 0 }
+#define DPTH888          8, 3, { 0, 0, 0, 0 }, { 8, 8, 8, 0 }
+#define DPTH8888         8, 4, { 0, 0, 0, 0 }, { 8, 8, 8, 8 }
+#define DPTH10_10_10     10, 3, { 0, 0, 0, 0 }, { 10, 10, 10, 0 }
+#define DPTH16           16, 1, { 0, 0, 0, 0 }, { 16, 0, 0, 0 }
+#define DPTH16_16_16     16, 3, { 0, 0, 0, 0 }, { 16, 16, 16, 0 }
+#define DPTH16_16_16_16  16, 4, { 0, 0, 0, 0 }, { 16, 16, 16, 16 }
+#define DPTH555          16, 3, { 10, 5, 0, 0 }, { 5, 5, 5, 0 }
+#define DPTH565          16, 3, { 11, 5, 0, 0 }, { 5, 6, 5, 0 }
+
+/* pixel strides */
+#define PSTR0             { 0, 0, 0, 0 }
+#define PSTR1             { 1, 0, 0, 0 }
+#define PSTR111           { 1, 1, 1, 0 }
+#define PSTR1111          { 1, 1, 1, 1 }
+#define PSTR122           { 1, 2, 2, 0 }
+#define PSTR2             { 2, 0, 0, 0 }
+#define PSTR222           { 2, 2, 2, 0 }
+#define PSTR244           { 2, 4, 4, 0 }
+#define PSTR444           { 4, 4, 4, 0 }
+#define PSTR4444          { 4, 4, 4, 4 }
+#define PSTR333           { 3, 3, 3, 0 }
+#define PSTR488           { 4, 8, 8, 0 }
+#define PSTR8888          { 8, 8, 8, 8 }
+
+/* planes */
+#define PLANE_NA          0, { 0, 0, 0, 0 }
+#define PLANE0            1, { 0, 0, 0, 0 }
+#define PLANE011          2, { 0, 1, 1, 0 }
+#define PLANE012          3, { 0, 1, 2, 0 }
+#define PLANE0123         4, { 0, 1, 2, 3 }
+#define PLANE021          3, { 0, 2, 1, 0 }
+
+/* offsets */
+#define OFFS0             { 0, 0, 0, 0 }
+#define OFFS013           { 0, 1, 3, 0 }
+#define OFFS102           { 1, 0, 2, 0 }
+#define OFFS1230          { 1, 2, 3, 0 }
+#define OFFS012           { 0, 1, 2, 0 }
+#define OFFS210           { 2, 1, 0, 0 }
+#define OFFS123           { 1, 2, 3, 0 }
+#define OFFS321           { 3, 2, 1, 0 }
+#define OFFS0123          { 0, 1, 2, 3 }
+#define OFFS2103          { 2, 1, 0, 3 }
+#define OFFS3210          { 3, 2, 1, 0 }
+#define OFFS031           { 0, 3, 1, 0 }
+#define OFFS026           { 0, 2, 6, 0 }
+#define OFFS001           { 0, 0, 1, 0 }
+#define OFFS010           { 0, 1, 0, 0 }
+#define OFFS104           { 1, 0, 4, 0 }
+#define OFFS2460          { 2, 4, 6, 0 }
+
+/* subsampling */
+#define SUB410            { 0, 2, 2, 0 }, { 0, 2, 2, 0 }
+#define SUB411            { 0, 2, 2, 0 }, { 0, 0, 0, 0 }
+#define SUB420            { 0, 1, 1, 0 }, { 0, 1, 1, 0 }
+#define SUB422            { 0, 1, 1, 0 }, { 0, 0, 0, 0 }
+#define SUB4              { 0, 0, 0, 0 }, { 0, 0, 0, 0 }
+#define SUB444            { 0, 0, 0, 0 }, { 0, 0, 0, 0 }
+#define SUB4444           { 0, 0, 0, 0 }, { 0, 0, 0, 0 }
+#define SUB4204           { 0, 1, 1, 0 }, { 0, 1, 1, 0 }
+
+#define MAKE_YUV_FORMAT(name, desc, fourcc, depth, pstride, plane, offs, sub ) \
+ { fourcc, {GST_VIDEO_FORMAT_ ##name, G_STRINGIFY(name), desc, GST_VIDEO_FORMAT_FLAG_YUV, depth, pstride, plane, offs, sub } }
+#define MAKE_YUVA_FORMAT(name, desc, fourcc, depth, pstride, plane, offs, sub) \
+ { fourcc, {GST_VIDEO_FORMAT_ ##name, G_STRINGIFY(name), desc, GST_VIDEO_FORMAT_FLAG_YUV | GST_VIDEO_FORMAT_FLAG_ALPHA, depth, pstride, plane, offs, sub } }
+
+#define MAKE_YUVA_LE_FORMAT(name, desc, fourcc, depth, pstride, plane, offs, sub) \
+ { fourcc, {GST_VIDEO_FORMAT_ ##name, G_STRINGIFY(name), desc, GST_VIDEO_FORMAT_FLAG_YUV | GST_VIDEO_FORMAT_FLAG_ALPHA | GST_VIDEO_FORMAT_FLAG_LE, depth, pstride, plane, offs, sub } }
+
+#define MAKE_RGB_FORMAT(name, desc, depth, pstride, plane, offs, sub) \
+ { 0x00000000, {GST_VIDEO_FORMAT_ ##name, G_STRINGIFY(name), desc, GST_VIDEO_FORMAT_FLAG_RGB, depth, pstride, plane, offs, sub } }
+#define MAKE_RGB_LE_FORMAT(name, desc, depth, pstride, plane, offs, sub) \
+ { 0x00000000, {GST_VIDEO_FORMAT_ ##name, G_STRINGIFY(name), desc, GST_VIDEO_FORMAT_FLAG_RGB | GST_VIDEO_FORMAT_FLAG_LE, depth, pstride, plane, offs, sub } }
+#define MAKE_RGBA_FORMAT(name, desc, depth, pstride, plane, offs, sub) \
+ { 0x00000000, {GST_VIDEO_FORMAT_ ##name, G_STRINGIFY(name), desc, GST_VIDEO_FORMAT_FLAG_RGB | GST_VIDEO_FORMAT_FLAG_ALPHA, depth, pstride, plane, offs, sub } }
+#define MAKE_RGBA_LE_FORMAT(name, desc, depth, pstride, plane, offs, sub) \
+ { 0x00000000, {GST_VIDEO_FORMAT_ ##name, G_STRINGIFY(name), desc, GST_VIDEO_FORMAT_FLAG_RGB | GST_VIDEO_FORMAT_FLAG_ALPHA | GST_VIDEO_FORMAT_FLAG_LE, depth, pstride, plane, offs, sub } }
+
+#define MAKE_GRAY_FORMAT(name, desc, depth, pstride, plane, offs, sub) \
+ { 0x00000000, {GST_VIDEO_FORMAT_ ##name, G_STRINGIFY(name), desc, GST_VIDEO_FORMAT_FLAG_GRAY, depth, pstride, plane, offs, sub } }
+#define MAKE_GRAY_LE_FORMAT(name, desc, depth, pstride, plane, offs, sub) \
+ { 0x00000000, {GST_VIDEO_FORMAT_ ##name, G_STRINGIFY(name), desc, GST_VIDEO_FORMAT_FLAG_GRAY | GST_VIDEO_FORMAT_FLAG_LE, depth, pstride, plane, offs, sub } }
+
+static VideoFormat formats[] = {
+  {0x00000000, {GST_VIDEO_FORMAT_UNKNOWN, "UNKNOWN", "unknown video", 0, DPTH0,
+              PSTR0, PLANE_NA,
+          OFFS0}},
+  MAKE_YUV_FORMAT (I420, "raw video", GST_MAKE_FOURCC ('I', '4', '2', '0'),
+      DPTH888, PSTR111,
+      PLANE012, OFFS0, SUB420),
+  MAKE_YUV_FORMAT (YV12, "raw video", GST_MAKE_FOURCC ('Y', 'V', '1', '2'),
+      DPTH888, PSTR111,
+      PLANE021, OFFS0, SUB420),
+  MAKE_YUV_FORMAT (YUY2, "raw video", GST_MAKE_FOURCC ('Y', 'U', 'Y', '2'),
+      DPTH888, PSTR244,
+      PLANE0, OFFS013, SUB422),
+  MAKE_YUV_FORMAT (UYVY, "raw video", GST_MAKE_FOURCC ('U', 'Y', 'V', 'Y'),
+      DPTH888, PSTR244,
+      PLANE0, OFFS102, SUB422),
+  MAKE_YUVA_FORMAT (AYUV, "raw video", GST_MAKE_FOURCC ('A', 'Y', 'U', 'V'),
+      DPTH8888,
+      PSTR4444, PLANE0, OFFS1230, SUB4444),
+  MAKE_RGB_FORMAT (RGBx, "raw video", DPTH888, PSTR444, PLANE0, OFFS012,
+      SUB444),
+  MAKE_RGB_FORMAT (BGRx, "raw video", DPTH888, PSTR444, PLANE0, OFFS210,
+      SUB444),
+  MAKE_RGB_FORMAT (xRGB, "raw video", DPTH888, PSTR444, PLANE0, OFFS123,
+      SUB444),
+  MAKE_RGB_FORMAT (xBGR, "raw video", DPTH888, PSTR444, PLANE0, OFFS321,
+      SUB444),
+  MAKE_RGBA_FORMAT (RGBA, "raw video", DPTH8888, PSTR4444, PLANE0, OFFS0123,
+      SUB4444),
+  MAKE_RGBA_FORMAT (BGRA, "raw video", DPTH8888, PSTR4444, PLANE0, OFFS2103,
+      SUB4444),
+  MAKE_RGBA_FORMAT (ARGB, "raw video", DPTH8888, PSTR4444, PLANE0, OFFS1230,
+      SUB4444),
+  MAKE_RGBA_FORMAT (ABGR, "raw video", DPTH8888, PSTR4444, PLANE0, OFFS3210,
+      SUB4444),
+  MAKE_RGB_FORMAT (RGB, "raw video", DPTH888, PSTR333, PLANE0, OFFS012, SUB444),
+  MAKE_RGB_FORMAT (BGR, "raw video", DPTH888, PSTR333, PLANE0, OFFS210, SUB444),
+
+  MAKE_YUV_FORMAT (Y41B, "raw video", GST_MAKE_FOURCC ('Y', '4', '1', 'B'),
+      DPTH888, PSTR111,
+      PLANE012, OFFS0, SUB411),
+  MAKE_YUV_FORMAT (Y42B, "raw video", GST_MAKE_FOURCC ('Y', '4', '2', 'B'),
+      DPTH888, PSTR111,
+      PLANE012, OFFS0, SUB422),
+  MAKE_YUV_FORMAT (YVYU, "raw video", GST_MAKE_FOURCC ('Y', 'V', 'Y', 'U'),
+      DPTH888, PSTR244,
+      PLANE0, OFFS031, SUB422),
+  MAKE_YUV_FORMAT (Y444, "raw video", GST_MAKE_FOURCC ('Y', '4', '4', '4'),
+      DPTH888, PSTR111,
+      PLANE012, OFFS0, SUB444),
+  MAKE_YUV_FORMAT (v210, "raw video", GST_MAKE_FOURCC ('v', '2', '1', '0'),
+      DPTH10_10_10,
+      PSTR0, PLANE0, OFFS0, SUB422),
+  MAKE_YUV_FORMAT (v216, "raw video", GST_MAKE_FOURCC ('v', '2', '1', '6'),
+      DPTH16_16_16,
+      PSTR488, PLANE0, OFFS026, SUB422),
+  MAKE_YUV_FORMAT (NV12, "raw video", GST_MAKE_FOURCC ('N', 'V', '1', '2'),
+      DPTH888, PSTR122,
+      PLANE011, OFFS001, SUB420),
+  MAKE_YUV_FORMAT (NV21, "raw video", GST_MAKE_FOURCC ('N', 'V', '2', '1'),
+      DPTH888, PSTR122,
+      PLANE011, OFFS010, SUB420),
+
+  MAKE_GRAY_FORMAT (GRAY8, "raw video", DPTH8, PSTR1, PLANE0, OFFS0, SUB4),
+  MAKE_GRAY_FORMAT (GRAY16_BE, "raw video", DPTH16, PSTR2, PLANE0, OFFS0, SUB4),
+  MAKE_GRAY_LE_FORMAT (GRAY16_LE, "raw video", DPTH16, PSTR2, PLANE0, OFFS0,
+      SUB4),
+
+  MAKE_YUV_FORMAT (v308, "raw video", GST_MAKE_FOURCC ('v', '3', '0', '8'),
+      DPTH888, PSTR333,
+      PLANE0, OFFS012, SUB444),
+  MAKE_YUV_FORMAT (Y800, "raw video", GST_MAKE_FOURCC ('Y', '8', '0', '0'),
+      DPTH8, PSTR1,
+      PLANE0, OFFS0, SUB4),
+  MAKE_YUV_FORMAT (Y16, "raw video", GST_MAKE_FOURCC ('Y', '1', '6', ' '),
+      DPTH16, PSTR2,
+      PLANE0, OFFS0, SUB4),
+
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  MAKE_RGB_LE_FORMAT (RGB16, "raw video", DPTH565, PSTR222, PLANE0, OFFS0,
+      SUB444),
+  MAKE_RGB_LE_FORMAT (BGR16, "raw video", DPTH565, PSTR222, PLANE0, OFFS0,
+      SUB444),
+  MAKE_RGB_LE_FORMAT (RGB15, "raw video", DPTH555, PSTR222, PLANE0, OFFS0,
+      SUB444),
+  MAKE_RGB_LE_FORMAT (BGR15, "raw video", DPTH555, PSTR222, PLANE0, OFFS0,
+      SUB444),
+#else
+  MAKE_RGB_FORMAT (RGB16, "raw video", DPTH565, PSTR222, PLANE0, OFFS0, SUB444),
+  MAKE_RGB_FORMAT (BGR16, "raw video", DPTH565, PSTR222, PLANE0, OFFS0, SUB444),
+  MAKE_RGB_FORMAT (RGB15, "raw video", DPTH555, PSTR222, PLANE0, OFFS0, SUB444),
+  MAKE_RGB_FORMAT (BGR15, "raw video", DPTH555, PSTR222, PLANE0, OFFS0, SUB444),
+#endif
+
+  MAKE_YUV_FORMAT (UYVP, "raw video", GST_MAKE_FOURCC ('U', 'Y', 'V', 'P'),
+      DPTH10_10_10,
+      PSTR0, PLANE0, OFFS0, SUB422),
+  MAKE_YUVA_FORMAT (A420, "raw video", GST_MAKE_FOURCC ('A', '4', '2', '0'),
+      DPTH8888,
+      PSTR1111, PLANE0123, OFFS0, SUB4204),
+  MAKE_RGBA_FORMAT (RGB8_PALETTED, "raw video", DPTH8888, PSTR1111, PLANE0,
+      OFFS0, SUB4444),
+  MAKE_YUV_FORMAT (YUV9, "raw video", GST_MAKE_FOURCC ('Y', 'U', 'V', '9'),
+      DPTH888, PSTR111,
+      PLANE012, OFFS0, SUB410),
+  MAKE_YUV_FORMAT (YVU9, "raw video", GST_MAKE_FOURCC ('Y', 'V', 'U', '9'),
+      DPTH888, PSTR111,
+      PLANE021, OFFS0, SUB410),
+  MAKE_YUV_FORMAT (IYU1, "raw video", GST_MAKE_FOURCC ('I', 'Y', 'U', '1'),
+      DPTH888, PSTR0,
+      PLANE0, OFFS104, SUB411),
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  MAKE_RGBA_LE_FORMAT (ARGB64, "raw video", DPTH16_16_16_16, PSTR8888,
+      PLANE0, OFFS2460, SUB444),
+  MAKE_YUVA_LE_FORMAT (AYUV64, "raw video", 0x00000000, DPTH16_16_16_16,
+      PSTR8888, PLANE0, OFFS2460, SUB444),
+#else
+  MAKE_RGBA_FORMAT (ARGB64, "raw video", DPTH16_16_16_16, PSTR8888, PLANE0,
+      OFFS2460,
+      SUB444),
+  MAKE_YUVA_FORMAT (AYUV64, "raw video", 0x00000000, DPTH16_16_16_16, PSTR8888,
+      PLANE0, OFFS2460, SUB444),
+#endif
+  MAKE_RGB_FORMAT (r210, "raw video", DPTH10_10_10, PSTR444, PLANE0, OFFS0,
+      SUB444),
+  {0x00000000, {GST_VIDEO_FORMAT_ENCODED, "ENCODED", "encoded video",
+          GST_VIDEO_FORMAT_FLAG_COMPLEX, DPTH0, PSTR0, PLANE_NA, OFFS0}},
+  MAKE_YUV_FORMAT (I420_10BE, "raw video", GST_MAKE_FOURCC ('D', '4', '2', '0'),
+      DPTH10_10_10, PSTR222,
+      PLANE012, OFFS0, SUB420),
+  MAKE_YUV_FORMAT (I420_10LE, "raw video", GST_MAKE_FOURCC ('d', '4', '2', '0'),
+      DPTH10_10_10, PSTR222,
+      PLANE012, OFFS0, SUB420),
+  MAKE_YUV_FORMAT (I422_10BE, "raw video", GST_MAKE_FOURCC ('D', '4', '2', '2'),
+      DPTH10_10_10, PSTR222,
+      PLANE012, OFFS0, SUB422),
+  MAKE_YUV_FORMAT (I422_10LE, "raw video", GST_MAKE_FOURCC ('d', '4', '2', '2'),
+      DPTH10_10_10, PSTR222,
+      PLANE012, OFFS0, SUB422),
+  MAKE_YUV_FORMAT (Y444_10BE, "raw video", GST_MAKE_FOURCC ('D', '4', '4', '4'),
+      DPTH10_10_10, PSTR222,
+      PLANE012, OFFS0, SUB444),
+  MAKE_YUV_FORMAT (Y444_10LE, "raw video", GST_MAKE_FOURCC ('d', '4', '4', '4'),
+      DPTH10_10_10, PSTR222,
+      PLANE012, OFFS0, SUB444)
+};
+
 /**
  * gst_video_frame_rate:
  * @pad: pointer to a #GstPad
@@ -673,7 +915,7 @@ gst_video_format_new_caps_raw (GstVideoFormat format)
 
     if (bpp != 8) {
       gst_caps_set_simple (caps,
-          "endianness", G_TYPE_INT, G_BIG_ENDIAN,
+          "endianness", G_TYPE_INT, bpp == 16 ? G_BYTE_ORDER : G_BIG_ENDIAN,
           "red_mask", G_TYPE_INT, red_mask,
           "green_mask", G_TYPE_INT, green_mask,
           "blue_mask", G_TYPE_INT, blue_mask, NULL);
@@ -877,6 +1119,18 @@ gst_video_format_from_fourcc (guint32 fourcc)
       return GST_VIDEO_FORMAT_IYU1;
     case GST_MAKE_FOURCC ('A', 'Y', '6', '4'):
       return GST_VIDEO_FORMAT_AYUV64;
+    case GST_MAKE_FOURCC ('D', '4', '2', '0'):
+      return GST_VIDEO_FORMAT_I420_10BE;
+    case GST_MAKE_FOURCC ('d', '4', '2', '0'):
+      return GST_VIDEO_FORMAT_I420_10LE;
+    case GST_MAKE_FOURCC ('D', '4', '2', '2'):
+      return GST_VIDEO_FORMAT_I422_10BE;
+    case GST_MAKE_FOURCC ('d', '4', '2', '2'):
+      return GST_VIDEO_FORMAT_I422_10LE;
+    case GST_MAKE_FOURCC ('D', '4', '4', '4'):
+      return GST_VIDEO_FORMAT_Y444_10BE;
+    case GST_MAKE_FOURCC ('d', '4', '4', '4'):
+      return GST_VIDEO_FORMAT_Y444_10LE;
     default:
       return GST_VIDEO_FORMAT_UNKNOWN;
   }
@@ -897,56 +1151,733 @@ gst_video_format_from_fourcc (guint32 fourcc)
 guint32
 gst_video_format_to_fourcc (GstVideoFormat format)
 {
-  g_return_val_if_fail (format != GST_VIDEO_FORMAT_UNKNOWN, 0);
+  if (format == GST_VIDEO_FORMAT_UNKNOWN || format >= G_N_ELEMENTS (formats))
+    return 0;
 
-  switch (format) {
-    case GST_VIDEO_FORMAT_I420:
-      return GST_MAKE_FOURCC ('I', '4', '2', '0');
-    case GST_VIDEO_FORMAT_YV12:
-      return GST_MAKE_FOURCC ('Y', 'V', '1', '2');
+  return formats[format].fourcc;
+}
+
+/**
+ * gst_video_format_to_string:
+ * @format: a #GstVideoFormat video format
+ *
+ * Returns: a short string that describes @format, or #NULL
+ *
+ * Since: 0.10.37
+ */
+const gchar *
+gst_video_format_to_string (GstVideoFormat format)
+{
+  if (format >= G_N_ELEMENTS (formats))
+    return NULL;
+
+  return GST_VIDEO_FORMAT_INFO_NAME (&formats[format].info);
+}
+
+/**
+ * gst_video_format_get_info:
+ * @format: a #GstVideoFormat
+ *
+ * Get the #GstVideoFormatInfo for @format
+ *
+ * Returns: The #GstVideoFormatInfo for @format.
+ *
+ * Since: 0.10.37
+ */
+const GstVideoFormatInfo *
+gst_video_format_get_info (GstVideoFormat format)
+{
+  g_return_val_if_fail (format != GST_VIDEO_FORMAT_UNKNOWN, NULL);
+  g_return_val_if_fail (format < G_N_ELEMENTS (formats), NULL);
+
+  return &formats[format].info;
+}
+
+/**
+ * gst_video_info_init:
+ * @info: a #GstVideoInfo
+ *
+ * Initialize @info with default values.
+ *
+ * Since: 0.10.37
+ */
+void
+gst_video_info_init (GstVideoInfo * info)
+{
+  g_return_if_fail (info != NULL);
+
+  memset (info, 0, sizeof (GstVideoInfo));
+
+  info->finfo = &formats[GST_VIDEO_FORMAT_UNKNOWN].info;
+
+  /* arrange for sensible defaults, e.g. if turned into caps */
+  info->fps_n = 0;
+  info->fps_d = 1;
+  info->par_n = 1;
+  info->par_d = 1;
+}
+
+/**
+ * gst_video_info_set_format:
+ * @info: a #GstVideoInfo
+ * @format: the format
+ * @width: a width
+ * @height: a height
+ *
+ * Set the default info for a video frame of @format and @width and @height.
+ *
+ * Since: 0.10.37
+ */
+void
+gst_video_info_set_format (GstVideoInfo * info, GstVideoFormat format,
+    guint width, guint height)
+{
+  const GstVideoFormatInfo *finfo;
+
+  g_return_if_fail (info != NULL);
+  g_return_if_fail (format != GST_VIDEO_FORMAT_UNKNOWN);
+
+  finfo = &formats[format].info;
+
+  info->flags = 0;
+  info->finfo = finfo;
+  info->width = width;
+  info->height = height;
+
+  fill_planes (info);
+}
+
+#if 0
+static const gchar *interlace_mode[] = {
+  "progressive",
+  "interleaved",
+  "mixed",
+  "fields"
+};
+
+static const gchar *
+gst_interlace_mode_to_string (GstVideoInterlaceMode mode)
+{
+  if (mode < 0 || mode >= G_N_ELEMENTS (interlace_mode))
+    return NULL;
+
+  return interlace_mode[mode];
+}
+
+static GstVideoInterlaceMode
+gst_interlace_mode_from_string (const gchar * mode)
+{
+  gint i;
+  for (i = 0; i < G_N_ELEMENTS (interlace_mode); i++) {
+    if (g_str_equal (interlace_mode[i], mode))
+      return i;
+  }
+  return GST_VIDEO_INTERLACE_MODE_PROGRESSIVE;
+}
+#endif
+
+typedef struct
+{
+  const gchar *name;
+  GstVideoChromaSite site;
+} ChromaSiteInfo;
+
+static const ChromaSiteInfo chromasite[] = {
+  {"jpeg", GST_VIDEO_CHROMA_SITE_JPEG},
+  {"mpeg2", GST_VIDEO_CHROMA_SITE_MPEG2},
+  {"dv", GST_VIDEO_CHROMA_SITE_DV}
+};
+
+static GstVideoChromaSite
+gst_video_chroma_from_string (const gchar * s)
+{
+  gint i;
+  for (i = 0; i < G_N_ELEMENTS (chromasite); i++) {
+    if (g_str_equal (chromasite[i].name, s))
+      return chromasite[i].site;
+  }
+  return GST_VIDEO_CHROMA_SITE_UNKNOWN;
+}
+
+static const gchar *
+gst_video_chroma_to_string (GstVideoChromaSite site)
+{
+  gint i;
+  for (i = 0; i < G_N_ELEMENTS (chromasite); i++) {
+    if (chromasite[i].site == site)
+      return chromasite[i].name;
+  }
+  return NULL;
+}
+
+typedef struct
+{
+  const gchar *name;
+  GstVideoColorimetry color;
+} ColorimetryInfo;
+
+#define MAKE_COLORIMETRY(n,r,m,t,p) { GST_VIDEO_COLORIMETRY_ ##n, \
+  { GST_VIDEO_COLOR_RANGE ##r, GST_VIDEO_COLOR_MATRIX_ ##m, \
+  GST_VIDEO_TRANSFER_ ##t, GST_VIDEO_COLOR_PRIMARIES_ ##p } }
+
+static const ColorimetryInfo colorimetry[] = {
+  MAKE_COLORIMETRY (BT601, _16_235, BT601, BT709, BT470M),
+  MAKE_COLORIMETRY (BT709, _16_235, BT709, BT709, BT709),
+  MAKE_COLORIMETRY (SMPTE240M, _16_235, SMPTE240M, SMPTE240M, SMPTE240M),
+};
+
+static const ColorimetryInfo *
+gst_video_get_colorimetry (const gchar * s)
+{
+  gint i;
+
+  for (i = 0; i < G_N_ELEMENTS (colorimetry); i++) {
+    if (g_str_equal (colorimetry[i].name, s))
+      return &colorimetry[i];
+  }
+  return NULL;
+}
+
+#define IS_EQUAL(ci,i) (((ci)->color.range == (i)->range) && \
+                        ((ci)->color.matrix == (i)->matrix) && \
+                        ((ci)->color.transfer == (i)->transfer) && \
+                        ((ci)->color.primaries == (i)->primaries))
+
+
+/**
+ * gst_video_colorimetry_from_string
+ * @cinfo: a #GstVideoColorimetry
+ * @color: a colorimetry string
+ *
+ * Parse the colorimetry string and update @cinfo with the parsed
+ * values.
+ *
+ * Returns: #TRUE if @color points to valid colorimetry info.
+ *
+ * Since: 0.10.37
+ */
+gboolean
+gst_video_colorimetry_from_string (GstVideoColorimetry * cinfo,
+    const gchar * color)
+{
+  const ColorimetryInfo *ci;
+
+  if ((ci = gst_video_get_colorimetry (color))) {
+    *cinfo = ci->color;
+  } else {
+    /* FIXME, split and parse */
+    cinfo->range = GST_VIDEO_COLOR_RANGE_16_235;
+    cinfo->matrix = GST_VIDEO_COLOR_MATRIX_BT601;
+    cinfo->transfer = GST_VIDEO_TRANSFER_BT709;
+    cinfo->primaries = GST_VIDEO_COLOR_PRIMARIES_BT709;
+  }
+  return TRUE;
+}
+
+static void
+gst_video_caps_set_colorimetry (GstCaps * caps, GstVideoColorimetry * cinfo)
+{
+  gint i;
+
+  for (i = 0; i < G_N_ELEMENTS (colorimetry); i++) {
+    if (IS_EQUAL (&colorimetry[i], cinfo)) {
+      gst_caps_set_simple (caps, "colorimetry", G_TYPE_STRING,
+          colorimetry[i].name, NULL);
+      return;
+    }
+  }
+  /* FIXME, construct colorimetry */
+}
+
+/**
+ * gst_video_colorimetry_matches:
+ * @cinfo: a #GstVideoInfo
+ * @color: a colorimetry string
+ *
+ * Check if the colorimetry information in @cinfo matches that of the
+ * string @color.
+ *
+ * Returns: #TRUE if @color conveys the same colorimetry info as the color
+ * information in @info.
+ *
+ * Since: 0.10.37
+ */
+gboolean
+gst_video_colorimetry_matches (GstVideoColorimetry * cinfo, const gchar * color)
+{
+  const ColorimetryInfo *ci;
+
+  if ((ci = gst_video_get_colorimetry (color)))
+    return IS_EQUAL (ci, cinfo);
+
+  return FALSE;
+}
+
+/**
+ * gst_video_info_from_caps:
+ * @info: a #GstVideoInfo
+ * @caps: a #GstCaps
+ *
+ * Parse @caps and update @info.
+ *
+ * Returns: TRUE if @caps could be parsed
+ *
+ * Since: 0.10.37
+ */
+gboolean
+gst_video_info_from_caps (GstVideoInfo * info, const GstCaps * caps)
+{
+  GstStructure *structure;
+  const gchar *s;
+  GstVideoFormat format = GST_VIDEO_FORMAT_UNKNOWN;
+  gint width = 0, height = 0;
+  gint fps_n, fps_d;
+  gint par_n, par_d;
+  gboolean interlaced;
+
+  g_return_val_if_fail (info != NULL, FALSE);
+  g_return_val_if_fail (caps != NULL, FALSE);
+  g_return_val_if_fail (gst_caps_is_fixed (caps), FALSE);
+
+  GST_DEBUG ("parsing caps %" GST_PTR_FORMAT, caps);
+
+  structure = gst_caps_get_structure (caps, 0);
+
+  if (gst_structure_has_name (structure, "video/x-raw-yuv")) {
+    guint32 fourcc;
+
+    if (!gst_structure_get_fourcc (structure, "format", &fourcc))
+      goto no_format;
+
+    format = gst_video_format_from_fourcc (fourcc);
+  } else if (gst_structure_has_name (structure, "video/x-raw-rgb")) {
+    int depth;
+    int bpp;
+    int endianness = 0;
+    int red_mask = 0;
+    int green_mask = 0;
+    int blue_mask = 0;
+    int alpha_mask = 0;
+
+    if (!gst_structure_get_int (structure, "depth", &depth) ||
+        !gst_structure_get_int (structure, "bpp", &bpp))
+      goto no_bpp_depth;
+
+    if (bpp != 8) {
+      gst_structure_get_int (structure, "endianness", &endianness);
+      gst_structure_get_int (structure, "red_mask", &red_mask);
+      gst_structure_get_int (structure, "green_mask", &green_mask);
+      gst_structure_get_int (structure, "blue_mask", &blue_mask);
+    }
+    gst_structure_get_int (structure, "alpha_mask", &alpha_mask);
+    format = gst_video_format_from_masks (depth, bpp, endianness,
+        red_mask, green_mask, blue_mask, alpha_mask);
+  } else if (gst_structure_has_name (structure, "video/x-raw-gray")) {
+    int depth;
+    int bpp;
+    int endianness;
+
+    if (!gst_structure_get_int (structure, "depth", &depth) ||
+        !gst_structure_get_int (structure, "bpp", &bpp))
+      goto no_bpp_depth;
+
+    /* endianness is mandatory for bpp > 8 */
+    if (bpp > 8 &&
+        !gst_structure_get_int (structure, "endianness", &endianness))
+      goto no_endianess;
+
+    if (depth == 8 && bpp == 8) {
+      format = GST_VIDEO_FORMAT_GRAY8;
+    } else if (depth == 16 && bpp == 16 && endianness == G_BIG_ENDIAN) {
+      format = GST_VIDEO_FORMAT_GRAY16_BE;
+    } else if (depth == 16 && bpp == 16 && endianness == G_LITTLE_ENDIAN) {
+      format = GST_VIDEO_FORMAT_GRAY16_LE;
+    }
+  } else if (g_str_has_prefix (gst_structure_get_name (structure), "video/") ||
+      g_str_has_prefix (gst_structure_get_name (structure), "image/"))
+    format = GST_VIDEO_FORMAT_ENCODED;
+
+  if (format == GST_VIDEO_FORMAT_UNKNOWN)
+    goto unknown_format;
+
+  /* width and height are mandatory, except for non-raw-formats */
+  if (!gst_structure_get_int (structure, "width", &width) &&
+      format != GST_VIDEO_FORMAT_ENCODED)
+    goto no_width;
+  if (!gst_structure_get_int (structure, "height", &height) &&
+      format != GST_VIDEO_FORMAT_ENCODED)
+    goto no_height;
+
+  gst_video_info_set_format (info, format, width, height);
+
+  if (gst_structure_get_fraction (structure, "framerate", &fps_n, &fps_d)) {
+    if (fps_n == 0) {
+      /* variable framerate */
+      info->flags |= GST_VIDEO_FLAG_VARIABLE_FPS;
+      /* see if we have a max-framerate */
+      gst_structure_get_fraction (structure, "max-framerate", &fps_n, &fps_d);
+    }
+    info->fps_n = fps_n;
+    info->fps_d = fps_d;
+  } else {
+    /* unspecified is variable framerate */
+    info->fps_n = 0;
+    info->fps_d = 1;
+  }
+
+  if (gst_structure_get_boolean (structure, "interlaced", &interlaced)
+      && interlaced)
+    info->interlace_mode = GST_VIDEO_INTERLACE_MODE_INTERLEAVED;
+  else
+    info->interlace_mode = GST_VIDEO_INTERLACE_MODE_PROGRESSIVE;
+
+  if ((s = gst_structure_get_string (structure, "chroma-site")))
+    info->chroma_site = gst_video_chroma_from_string (s);
+  else
+    info->chroma_site = GST_VIDEO_CHROMA_SITE_UNKNOWN;
+
+  if ((s = gst_structure_get_string (structure, "colorimetry")))
+    gst_video_colorimetry_from_string (&info->colorimetry, s);
+  else
+    memset (&info->colorimetry, 0, sizeof (GstVideoColorimetry));
+
+  if (gst_structure_get_fraction (structure, "pixel-aspect-ratio",
+          &par_n, &par_d)) {
+    info->par_n = par_n;
+    info->par_d = par_d;
+  } else {
+    info->par_n = 1;
+    info->par_d = 1;
+  }
+  return TRUE;
+
+  /* ERROR */
+no_format:
+  {
+    GST_ERROR ("no format given");
+    return FALSE;
+  }
+unknown_format:
+  {
+    GST_ERROR ("unknown format");
+    return FALSE;
+  }
+no_width:
+  {
+    GST_ERROR ("no width property given");
+    return FALSE;
+  }
+no_height:
+  {
+    GST_ERROR ("no height property given");
+    return FALSE;
+  }
+
+no_bpp_depth:
+  {
+    GST_ERROR ("no bpp or depth given");
+    return FALSE;
+  }
+
+no_endianess:
+  {
+    GST_ERROR ("no endianness given");
+    return FALSE;
+  }
+}
+
+/**
+ * gst_video_info_is_equal:
+ * @info: a #GstVideoInfo
+ * @other: a #GstVideoInfo
+ *
+ * Compares two #GstVideoInfo and returns whether they are equal or not
+ *
+ * Returns: %TRUE if @info and @other are equal, else %FALSE.
+ *
+ * Since: 0.10.37
+ */
+gboolean
+gst_video_info_is_equal (const GstVideoInfo * info, const GstVideoInfo * other)
+{
+  if (GST_VIDEO_INFO_FORMAT (info) != GST_VIDEO_INFO_FORMAT (other))
+    return FALSE;
+  if (GST_VIDEO_INFO_INTERLACE_MODE (info) !=
+      GST_VIDEO_INFO_INTERLACE_MODE (other))
+    return FALSE;
+  if (GST_VIDEO_INFO_FLAGS (info) != GST_VIDEO_INFO_FLAGS (other))
+    return FALSE;
+  if (GST_VIDEO_INFO_WIDTH (info) != GST_VIDEO_INFO_WIDTH (other))
+    return FALSE;
+  if (GST_VIDEO_INFO_HEIGHT (info) != GST_VIDEO_INFO_HEIGHT (other))
+    return FALSE;
+  if (GST_VIDEO_INFO_SIZE (info) != GST_VIDEO_INFO_SIZE (other))
+    return FALSE;
+  if (GST_VIDEO_INFO_PAR_N (info) != GST_VIDEO_INFO_PAR_N (other))
+    return FALSE;
+  if (GST_VIDEO_INFO_PAR_D (info) != GST_VIDEO_INFO_PAR_D (other))
+    return FALSE;
+  if (GST_VIDEO_INFO_FPS_N (info) != GST_VIDEO_INFO_FPS_N (other))
+    return FALSE;
+  if (GST_VIDEO_INFO_FPS_D (info) != GST_VIDEO_INFO_FPS_D (other))
+    return FALSE;
+  return TRUE;
+}
+
+/**
+ * gst_video_info_to_caps:
+ * @info: a #GstVideoInfo
+ *
+ * Convert the values of @info into a #GstCaps.
+ *
+ * Returns: a new #GstCaps containing the info of @info.
+ *
+ * Since: 0.10.37
+ */
+GstCaps *
+gst_video_info_to_caps (GstVideoInfo * info)
+{
+  GstCaps *caps;
+
+  g_return_val_if_fail (info != NULL, NULL);
+  g_return_val_if_fail (info->finfo != NULL, NULL);
+  g_return_val_if_fail (info->finfo->format != GST_VIDEO_FORMAT_UNKNOWN, NULL);
+
+  caps = gst_video_format_new_caps_raw (GST_VIDEO_INFO_FORMAT (info));
+
+  gst_caps_set_simple (caps,
+      "width", G_TYPE_INT, info->width,
+      "height", G_TYPE_INT, info->height,
+      "pixel-aspect-ratio", GST_TYPE_FRACTION, info->par_n, info->par_d, NULL);
+
+  gst_caps_set_simple (caps, "interlaced", G_TYPE_BOOLEAN,
+      GST_VIDEO_INFO_IS_INTERLACED (info), NULL);
+
+  if (info->chroma_site != GST_VIDEO_CHROMA_SITE_UNKNOWN)
+    gst_caps_set_simple (caps, "chroma-site", G_TYPE_STRING,
+        gst_video_chroma_to_string (info->chroma_site), NULL);
+
+  gst_video_caps_set_colorimetry (caps, &info->colorimetry);
+
+  if (info->flags & GST_VIDEO_FLAG_VARIABLE_FPS && info->fps_n != 0) {
+    /* variable fps with a max-framerate */
+    gst_caps_set_simple (caps, "framerate", GST_TYPE_FRACTION, 0, 1,
+        "max-framerate", GST_TYPE_FRACTION, info->fps_n, info->fps_d, NULL);
+  } else {
+    /* no variable fps or no max-framerate */
+    gst_caps_set_simple (caps, "framerate", GST_TYPE_FRACTION,
+        info->fps_n, info->fps_d, NULL);
+  }
+
+  return caps;
+}
+
+
+static int
+fill_planes (GstVideoInfo * info)
+{
+  gint width, height;
+
+  width = info->width;
+  height = info->height;
+
+  switch (info->finfo->format) {
     case GST_VIDEO_FORMAT_YUY2:
-      return GST_MAKE_FOURCC ('Y', 'U', 'Y', '2');
     case GST_VIDEO_FORMAT_YVYU:
-      return GST_MAKE_FOURCC ('Y', 'V', 'Y', 'U');
     case GST_VIDEO_FORMAT_UYVY:
-      return GST_MAKE_FOURCC ('U', 'Y', 'V', 'Y');
+      info->stride[0] = GST_ROUND_UP_4 (width * 2);
+      info->offset[0] = 0;
+      info->size = info->stride[0] * height;
+      break;
     case GST_VIDEO_FORMAT_AYUV:
-      return GST_MAKE_FOURCC ('A', 'Y', 'U', 'V');
-    case GST_VIDEO_FORMAT_Y41B:
-      return GST_MAKE_FOURCC ('Y', '4', '1', 'B');
-    case GST_VIDEO_FORMAT_Y42B:
-      return GST_MAKE_FOURCC ('Y', '4', '2', 'B');
-    case GST_VIDEO_FORMAT_Y444:
-      return GST_MAKE_FOURCC ('Y', '4', '4', '4');
+    case GST_VIDEO_FORMAT_RGBx:
+    case GST_VIDEO_FORMAT_RGBA:
+    case GST_VIDEO_FORMAT_BGRx:
+    case GST_VIDEO_FORMAT_BGRA:
+    case GST_VIDEO_FORMAT_xRGB:
+    case GST_VIDEO_FORMAT_ARGB:
+    case GST_VIDEO_FORMAT_xBGR:
+    case GST_VIDEO_FORMAT_ABGR:
+    case GST_VIDEO_FORMAT_r210:
+      info->stride[0] = width * 4;
+      info->offset[0] = 0;
+      info->size = info->stride[0] * height;
+      break;
+    case GST_VIDEO_FORMAT_RGB16:
+    case GST_VIDEO_FORMAT_BGR16:
+    case GST_VIDEO_FORMAT_RGB15:
+    case GST_VIDEO_FORMAT_BGR15:
+      info->stride[0] = GST_ROUND_UP_4 (width * 2);
+      info->offset[0] = 0;
+      info->size = info->stride[0] * height;
+      break;
+    case GST_VIDEO_FORMAT_RGB:
+    case GST_VIDEO_FORMAT_BGR:
+    case GST_VIDEO_FORMAT_v308:
+      info->stride[0] = GST_ROUND_UP_4 (width * 3);
+      info->offset[0] = 0;
+      info->size = info->stride[0] * height;
+      break;
     case GST_VIDEO_FORMAT_v210:
-      return GST_MAKE_FOURCC ('v', '2', '1', '0');
+      info->stride[0] = ((width + 47) / 48) * 128;
+      info->offset[0] = 0;
+      info->size = info->stride[0] * height;
+      break;
     case GST_VIDEO_FORMAT_v216:
-      return GST_MAKE_FOURCC ('v', '2', '1', '6');
-    case GST_VIDEO_FORMAT_NV12:
-      return GST_MAKE_FOURCC ('N', 'V', '1', '2');
-    case GST_VIDEO_FORMAT_NV21:
-      return GST_MAKE_FOURCC ('N', 'V', '2', '1');
-    case GST_VIDEO_FORMAT_v308:
-      return GST_MAKE_FOURCC ('v', '3', '0', '8');
+      info->stride[0] = GST_ROUND_UP_8 (width * 4);
+      info->offset[0] = 0;
+      info->size = info->stride[0] * height;
+      break;
+    case GST_VIDEO_FORMAT_GRAY8:
     case GST_VIDEO_FORMAT_Y800:
-      return GST_MAKE_FOURCC ('Y', '8', '0', '0');
+      info->stride[0] = GST_ROUND_UP_4 (width);
+      info->offset[0] = 0;
+      info->size = info->stride[0] * height;
+      break;
+    case GST_VIDEO_FORMAT_GRAY16_BE:
+    case GST_VIDEO_FORMAT_GRAY16_LE:
     case GST_VIDEO_FORMAT_Y16:
-      return GST_MAKE_FOURCC ('Y', '1', '6', ' ');
+      info->stride[0] = GST_ROUND_UP_4 (width * 2);
+      info->offset[0] = 0;
+      info->size = info->stride[0] * height;
+      break;
     case GST_VIDEO_FORMAT_UYVP:
-      return GST_MAKE_FOURCC ('U', 'Y', 'V', 'P');
+      info->stride[0] = GST_ROUND_UP_4 ((width * 2 * 5 + 3) / 4);
+      info->offset[0] = 0;
+      info->size = info->stride[0] * height;
+      break;
+    case GST_VIDEO_FORMAT_RGB8_PALETTED:
+      info->stride[0] = GST_ROUND_UP_4 (width);
+      info->offset[0] = 0;
+      info->size = info->stride[0] * height;
+      break;
+    case GST_VIDEO_FORMAT_IYU1:
+      info->stride[0] = GST_ROUND_UP_4 (GST_ROUND_UP_4 (width) +
+          GST_ROUND_UP_4 (width) / 2);
+      info->offset[0] = 0;
+      info->size = info->stride[0] * height;
+      break;
+    case GST_VIDEO_FORMAT_ARGB64:
+    case GST_VIDEO_FORMAT_AYUV64:
+      info->stride[0] = width * 8;
+      info->offset[0] = 0;
+      info->size = info->stride[0] * height;
+      break;
+    case GST_VIDEO_FORMAT_I420:
+    case GST_VIDEO_FORMAT_YV12:        /* same as I420, but plane 1+2 swapped */
+      info->stride[0] = GST_ROUND_UP_4 (width);
+      info->stride[1] = GST_ROUND_UP_4 (GST_ROUND_UP_2 (width) / 2);
+      info->stride[2] = info->stride[1];
+      info->offset[0] = 0;
+      info->offset[1] = info->stride[0] * GST_ROUND_UP_2 (height);
+      info->offset[2] = info->offset[1] +
+          info->stride[1] * (GST_ROUND_UP_2 (height) / 2);
+      info->size = info->offset[2] +
+          info->stride[2] * (GST_ROUND_UP_2 (height) / 2);
+      break;
+    case GST_VIDEO_FORMAT_Y41B:
+      info->stride[0] = GST_ROUND_UP_4 (width);
+      info->stride[1] = GST_ROUND_UP_16 (width) / 4;
+      info->stride[2] = info->stride[1];
+      info->offset[0] = 0;
+      info->offset[1] = info->stride[0] * height;
+      info->offset[2] = info->offset[1] + info->stride[1] * height;
+      /* simplification of ROUNDUP4(w)*h + 2*((ROUNDUP16(w)/4)*h */
+      info->size = (info->stride[0] + (GST_ROUND_UP_16 (width) / 2)) * height;
+      break;
+    case GST_VIDEO_FORMAT_Y42B:
+      info->stride[0] = GST_ROUND_UP_4 (width);
+      info->stride[1] = GST_ROUND_UP_8 (width) / 2;
+      info->stride[2] = info->stride[1];
+      info->offset[0] = 0;
+      info->offset[1] = info->stride[0] * height;
+      info->offset[2] = info->offset[1] + info->stride[1] * height;
+      /* simplification of ROUNDUP4(w)*h + 2*(ROUNDUP8(w)/2)*h */
+      info->size = (info->stride[0] + GST_ROUND_UP_8 (width)) * height;
+      break;
+    case GST_VIDEO_FORMAT_Y444:
+      info->stride[0] = GST_ROUND_UP_4 (width);
+      info->stride[1] = info->stride[0];
+      info->stride[2] = info->stride[0];
+      info->offset[0] = 0;
+      info->offset[1] = info->stride[0] * height;
+      info->offset[2] = info->offset[1] * 2;
+      info->size = info->stride[0] * height * 3;
+      break;
+    case GST_VIDEO_FORMAT_NV12:
+    case GST_VIDEO_FORMAT_NV21:
+      info->stride[0] = GST_ROUND_UP_4 (width);
+      info->stride[1] = info->stride[0];
+      info->offset[0] = 0;
+      info->offset[1] = info->stride[0] * GST_ROUND_UP_2 (height);
+      info->size = info->stride[0] * GST_ROUND_UP_2 (height) * 3 / 2;
+      break;
     case GST_VIDEO_FORMAT_A420:
-      return GST_MAKE_FOURCC ('A', '4', '2', '0');
+      info->stride[0] = GST_ROUND_UP_4 (width);
+      info->stride[1] = GST_ROUND_UP_4 (GST_ROUND_UP_2 (width) / 2);
+      info->stride[2] = info->stride[1];
+      info->stride[3] = info->stride[0];
+      info->offset[0] = 0;
+      info->offset[1] = info->stride[0] * GST_ROUND_UP_2 (height);
+      info->offset[2] = info->offset[1] +
+          info->stride[1] * (GST_ROUND_UP_2 (height) / 2);
+      info->offset[3] = info->offset[2] +
+          info->stride[2] * (GST_ROUND_UP_2 (height) / 2);
+      info->size = info->offset[3] + info->stride[0];
+      break;
     case GST_VIDEO_FORMAT_YUV9:
-      return GST_MAKE_FOURCC ('Y', 'U', 'V', '9');
     case GST_VIDEO_FORMAT_YVU9:
-      return GST_MAKE_FOURCC ('Y', 'V', 'U', '9');
-    case GST_VIDEO_FORMAT_IYU1:
-      return GST_MAKE_FOURCC ('I', 'Y', 'U', '1');
-    case GST_VIDEO_FORMAT_AYUV64:
-      return GST_MAKE_FOURCC ('A', 'Y', '6', '4');
+      info->stride[0] = GST_ROUND_UP_4 (width);
+      info->stride[1] = GST_ROUND_UP_4 (GST_ROUND_UP_4 (width) / 4);
+      info->stride[2] = info->stride[1];
+      info->offset[0] = 0;
+      info->offset[1] = info->stride[0] * height;
+      info->offset[2] = info->offset[1] +
+          info->stride[1] * (GST_ROUND_UP_4 (height) / 4);
+      info->size = info->offset[2] +
+          info->stride[2] * (GST_ROUND_UP_4 (height) / 4);
+      break;
+    case GST_VIDEO_FORMAT_I420_10LE:
+    case GST_VIDEO_FORMAT_I420_10BE:
+      info->stride[0] = GST_ROUND_UP_4 (width * 2);
+      info->stride[1] = GST_ROUND_UP_4 (width);
+      info->stride[2] = info->stride[1];
+      info->offset[0] = 0;
+      info->offset[1] = info->stride[0] * GST_ROUND_UP_2 (height);
+      info->offset[2] = info->offset[1] +
+          info->stride[1] * (GST_ROUND_UP_2 (height) / 2);
+      info->size = info->offset[2] +
+          info->stride[2] * (GST_ROUND_UP_2 (height) / 2);
+      break;
+    case GST_VIDEO_FORMAT_I422_10LE:
+    case GST_VIDEO_FORMAT_I422_10BE:
+      info->stride[0] = GST_ROUND_UP_4 (width * 2);
+      info->stride[1] = GST_ROUND_UP_4 (width);
+      info->stride[2] = info->stride[1];
+      info->offset[0] = 0;
+      info->offset[1] = info->stride[0] * GST_ROUND_UP_2 (height);
+      info->offset[2] = info->offset[1] +
+          info->stride[1] * GST_ROUND_UP_2 (height);
+      info->size = info->offset[2] + info->stride[2] * GST_ROUND_UP_2 (height);
+      break;
+    case GST_VIDEO_FORMAT_Y444_10LE:
+    case GST_VIDEO_FORMAT_Y444_10BE:
+      info->stride[0] = GST_ROUND_UP_4 (width * 2);
+      info->stride[1] = info->stride[0];
+      info->stride[2] = info->stride[0];
+      info->offset[0] = 0;
+      info->offset[1] = info->stride[0] * height;
+      info->offset[2] = info->offset[1] * 2;
+      info->size = info->stride[0] * height * 3;
+      break;
     default:
-      return 0;
+      if (GST_VIDEO_FORMAT_INFO_IS_COMPLEX (info->finfo))
+        break;
+      GST_ERROR ("invalid format");
+      g_warning ("invalid format");
+      break;
   }
+  return 0;
 }
 
 /*
@@ -1050,61 +1981,90 @@ gst_video_format_from_rgb16_masks (int red_mask, int green_mask, int blue_mask)
 }
 
 /**
- * gst_video_format_is_rgb:
- * @format: a #GstVideoFormat
- *
- * Determine whether the video format is an RGB format.
- *
- * Since: 0.10.16
- *
- * Returns: TRUE if @format represents RGB video
+ * gst_video_format_from_masks:
+ * @depth: the amount of bits used for a pixel
+ * @bpp: the amount of bits used to store a pixel. This value is bigger than
+ *   @depth
+ * @endianness: the endianness of the masks
+ * @red_mask: the red mask
+ * @green_mask: the green mask
+ * @blue_mask: the blue mask
+ * @alpha_mask: the optional alpha mask
+ *
+ * Find the #GstVideoFormat for the given parameters.
+ *
+ * Returns: a #GstVideoFormat or GST_VIDEO_FORMAT_UNKNOWN when the parameters to
+ * not specify a known format.
  */
-gboolean
-gst_video_format_is_rgb (GstVideoFormat format)
+GstVideoFormat
+gst_video_format_from_masks (gint depth, gint bpp, gint endianness,
+    gint red_mask, gint green_mask, gint blue_mask, gint alpha_mask)
 {
-  switch (format) {
-    case GST_VIDEO_FORMAT_I420:
-    case GST_VIDEO_FORMAT_YV12:
-    case GST_VIDEO_FORMAT_YUY2:
-    case GST_VIDEO_FORMAT_YVYU:
-    case GST_VIDEO_FORMAT_UYVY:
-    case GST_VIDEO_FORMAT_AYUV:
-    case GST_VIDEO_FORMAT_Y41B:
-    case GST_VIDEO_FORMAT_Y42B:
-    case GST_VIDEO_FORMAT_Y444:
-    case GST_VIDEO_FORMAT_v210:
-    case GST_VIDEO_FORMAT_v216:
-    case GST_VIDEO_FORMAT_NV12:
-    case GST_VIDEO_FORMAT_NV21:
-    case GST_VIDEO_FORMAT_v308:
-    case GST_VIDEO_FORMAT_UYVP:
-    case GST_VIDEO_FORMAT_A420:
-    case GST_VIDEO_FORMAT_YUV9:
-    case GST_VIDEO_FORMAT_YVU9:
-    case GST_VIDEO_FORMAT_IYU1:
-    case GST_VIDEO_FORMAT_AYUV64:
-      return FALSE;
-    case GST_VIDEO_FORMAT_RGBx:
-    case GST_VIDEO_FORMAT_BGRx:
-    case GST_VIDEO_FORMAT_xRGB:
-    case GST_VIDEO_FORMAT_xBGR:
-    case GST_VIDEO_FORMAT_RGBA:
-    case GST_VIDEO_FORMAT_BGRA:
-    case GST_VIDEO_FORMAT_ARGB:
-    case GST_VIDEO_FORMAT_ABGR:
-    case GST_VIDEO_FORMAT_RGB:
-    case GST_VIDEO_FORMAT_BGR:
-    case GST_VIDEO_FORMAT_RGB16:
-    case GST_VIDEO_FORMAT_BGR16:
-    case GST_VIDEO_FORMAT_RGB15:
-    case GST_VIDEO_FORMAT_BGR15:
-    case GST_VIDEO_FORMAT_RGB8_PALETTED:
-    case GST_VIDEO_FORMAT_ARGB64:
-    case GST_VIDEO_FORMAT_r210:
-      return TRUE;
-    default:
-      return FALSE;
+  GstVideoFormat format;
+
+  /* our caps system handles 24/32bpp RGB as big-endian. */
+  if ((bpp == 24 || bpp == 32) && endianness == G_LITTLE_ENDIAN) {
+    red_mask = GUINT32_TO_BE (red_mask);
+    green_mask = GUINT32_TO_BE (green_mask);
+    blue_mask = GUINT32_TO_BE (blue_mask);
+    endianness = G_BIG_ENDIAN;
+    if (bpp == 24) {
+      red_mask >>= 8;
+      green_mask >>= 8;
+      blue_mask >>= 8;
+    }
+  }
+
+  if (depth == 30 && bpp == 32) {
+    format = GST_VIDEO_FORMAT_r210;
+  } else if (depth == 24 && bpp == 32) {
+    format = gst_video_format_from_rgb32_masks (red_mask, green_mask,
+        blue_mask);
+  } else if (depth == 32 && bpp == 32 && alpha_mask) {
+    format = gst_video_format_from_rgba32_masks (red_mask, green_mask,
+        blue_mask, alpha_mask);
+  } else if (depth == 24 && bpp == 24) {
+    format = gst_video_format_from_rgb24_masks (red_mask, green_mask,
+        blue_mask);
+  } else if ((depth == 15 || depth == 16) && bpp == 16 &&
+      endianness == G_BYTE_ORDER) {
+    format = gst_video_format_from_rgb16_masks (red_mask, green_mask,
+        blue_mask);
+  } else if (depth == 8 && bpp == 8) {
+    format = GST_VIDEO_FORMAT_RGB8_PALETTED;
+  } else if (depth == 64 && bpp == 64) {
+    format = gst_video_format_from_rgba32_masks (red_mask, green_mask,
+        blue_mask, alpha_mask);
+    if (format == GST_VIDEO_FORMAT_ARGB) {
+      format = GST_VIDEO_FORMAT_ARGB64;
+    } else {
+      format = GST_VIDEO_FORMAT_UNKNOWN;
+    }
+  } else {
+    format = GST_VIDEO_FORMAT_UNKNOWN;
   }
+  return format;
+}
+
+/**
+ * gst_video_format_is_rgb:
+ * @format: a #GstVideoFormat
+ *
+ * Determine whether the video format is an RGB format.
+ *
+ * Since: 0.10.16
+ *
+ * Deprecated: Use #GstVideoFormatInfo and #GST_VIDEO_FORMAT_INFO_IS_RGB
+ *
+ * Returns: TRUE if @format represents RGB video
+ */
+gboolean
+gst_video_format_is_rgb (GstVideoFormat format)
+{
+  if (format == GST_VIDEO_FORMAT_UNKNOWN || format >= G_N_ELEMENTS (formats))
+    return FALSE;
+
+  return GST_VIDEO_FORMAT_INFO_IS_RGB (&formats[format].info);
 }
 
 /**
@@ -1115,56 +2075,17 @@ gst_video_format_is_rgb (GstVideoFormat format)
  *
  * Since: 0.10.16
  *
+ * Deprecated: Use #GstVideoFormatInfo and #GST_VIDEO_FORMAT_INFO_IS_YUV
+ *
  * Returns: TRUE if @format represents YUV video
  */
 gboolean
 gst_video_format_is_yuv (GstVideoFormat format)
 {
-  switch (format) {
-    case GST_VIDEO_FORMAT_I420:
-    case GST_VIDEO_FORMAT_YV12:
-    case GST_VIDEO_FORMAT_YUY2:
-    case GST_VIDEO_FORMAT_YVYU:
-    case GST_VIDEO_FORMAT_UYVY:
-    case GST_VIDEO_FORMAT_AYUV:
-    case GST_VIDEO_FORMAT_Y41B:
-    case GST_VIDEO_FORMAT_Y42B:
-    case GST_VIDEO_FORMAT_Y444:
-    case GST_VIDEO_FORMAT_v210:
-    case GST_VIDEO_FORMAT_v216:
-    case GST_VIDEO_FORMAT_NV12:
-    case GST_VIDEO_FORMAT_NV21:
-    case GST_VIDEO_FORMAT_v308:
-    case GST_VIDEO_FORMAT_Y800:
-    case GST_VIDEO_FORMAT_Y16:
-    case GST_VIDEO_FORMAT_UYVP:
-    case GST_VIDEO_FORMAT_A420:
-    case GST_VIDEO_FORMAT_YUV9:
-    case GST_VIDEO_FORMAT_YVU9:
-    case GST_VIDEO_FORMAT_IYU1:
-    case GST_VIDEO_FORMAT_AYUV64:
-      return TRUE;
-    case GST_VIDEO_FORMAT_RGBx:
-    case GST_VIDEO_FORMAT_BGRx:
-    case GST_VIDEO_FORMAT_xRGB:
-    case GST_VIDEO_FORMAT_xBGR:
-    case GST_VIDEO_FORMAT_RGBA:
-    case GST_VIDEO_FORMAT_BGRA:
-    case GST_VIDEO_FORMAT_ARGB:
-    case GST_VIDEO_FORMAT_ABGR:
-    case GST_VIDEO_FORMAT_RGB:
-    case GST_VIDEO_FORMAT_BGR:
-    case GST_VIDEO_FORMAT_RGB16:
-    case GST_VIDEO_FORMAT_BGR16:
-    case GST_VIDEO_FORMAT_RGB15:
-    case GST_VIDEO_FORMAT_BGR15:
-    case GST_VIDEO_FORMAT_RGB8_PALETTED:
-    case GST_VIDEO_FORMAT_ARGB64:
-    case GST_VIDEO_FORMAT_r210:
-      return FALSE;
-    default:
-      return FALSE;
-  }
+  if (format == GST_VIDEO_FORMAT_UNKNOWN || format >= G_N_ELEMENTS (formats))
+    return FALSE;
+
+  return GST_VIDEO_FORMAT_INFO_IS_YUV (&formats[format].info);
 }
 
 /**
@@ -1175,21 +2096,17 @@ gst_video_format_is_yuv (GstVideoFormat format)
  *
  * Since: 0.10.29
  *
+ * Deprecated: Use #GstVideoFormatInfo and #GST_VIDEO_FORMAT_INFO_IS_GRAY
+ *
  * Returns: TRUE if @format represents grayscale video
  */
 gboolean
 gst_video_format_is_gray (GstVideoFormat format)
 {
-  switch (format) {
-    case GST_VIDEO_FORMAT_GRAY8:
-    case GST_VIDEO_FORMAT_GRAY16_BE:
-    case GST_VIDEO_FORMAT_GRAY16_LE:
-    case GST_VIDEO_FORMAT_Y800:
-    case GST_VIDEO_FORMAT_Y16:
-      return TRUE;
-    default:
-      return FALSE;
-  }
+  if (format == GST_VIDEO_FORMAT_UNKNOWN || format >= G_N_ELEMENTS (formats))
+    return FALSE;
+
+  return GST_VIDEO_FORMAT_INFO_IS_GRAY (&formats[format].info);
 }
 
 /**
@@ -1201,57 +2118,17 @@ gst_video_format_is_gray (GstVideoFormat format)
  *
  * Since: 0.10.16
  *
+ * Deprecated: Use #GstVideoFormatInfo and #GST_VIDEO_FORMAT_INFO_HAS_ALPHA
+ *
  * Returns: TRUE if @format has an alpha channel
  */
 gboolean
 gst_video_format_has_alpha (GstVideoFormat format)
 {
-  switch (format) {
-    case GST_VIDEO_FORMAT_I420:
-    case GST_VIDEO_FORMAT_YV12:
-    case GST_VIDEO_FORMAT_YUY2:
-    case GST_VIDEO_FORMAT_YVYU:
-    case GST_VIDEO_FORMAT_UYVY:
-    case GST_VIDEO_FORMAT_Y41B:
-    case GST_VIDEO_FORMAT_Y42B:
-    case GST_VIDEO_FORMAT_Y444:
-    case GST_VIDEO_FORMAT_v210:
-    case GST_VIDEO_FORMAT_v216:
-    case GST_VIDEO_FORMAT_NV12:
-    case GST_VIDEO_FORMAT_NV21:
-    case GST_VIDEO_FORMAT_v308:
-    case GST_VIDEO_FORMAT_Y800:
-    case GST_VIDEO_FORMAT_Y16:
-    case GST_VIDEO_FORMAT_UYVP:
-    case GST_VIDEO_FORMAT_YUV9:
-    case GST_VIDEO_FORMAT_YVU9:
-    case GST_VIDEO_FORMAT_IYU1:
-      return FALSE;
-    case GST_VIDEO_FORMAT_AYUV:
-    case GST_VIDEO_FORMAT_RGBA:
-    case GST_VIDEO_FORMAT_BGRA:
-    case GST_VIDEO_FORMAT_ARGB:
-    case GST_VIDEO_FORMAT_ABGR:
-    case GST_VIDEO_FORMAT_A420:
-    case GST_VIDEO_FORMAT_RGB8_PALETTED:
-    case GST_VIDEO_FORMAT_ARGB64:
-    case GST_VIDEO_FORMAT_AYUV64:
-      return TRUE;
-    case GST_VIDEO_FORMAT_RGBx:
-    case GST_VIDEO_FORMAT_BGRx:
-    case GST_VIDEO_FORMAT_xRGB:
-    case GST_VIDEO_FORMAT_xBGR:
-    case GST_VIDEO_FORMAT_RGB:
-    case GST_VIDEO_FORMAT_BGR:
-    case GST_VIDEO_FORMAT_RGB16:
-    case GST_VIDEO_FORMAT_BGR16:
-    case GST_VIDEO_FORMAT_RGB15:
-    case GST_VIDEO_FORMAT_BGR15:
-    case GST_VIDEO_FORMAT_r210:
-      return FALSE;
-    default:
-      return FALSE;
-  }
+  if (format == GST_VIDEO_FORMAT_UNKNOWN || format >= G_N_ELEMENTS (formats))
+    return FALSE;
+
+  return GST_VIDEO_FORMAT_INFO_HAS_ALPHA (&formats[format].info);
 }
 
 /**
@@ -1270,59 +2147,10 @@ gst_video_format_has_alpha (GstVideoFormat format)
 int
 gst_video_format_get_component_depth (GstVideoFormat format, int component)
 {
-  if (component == 3 && !gst_video_format_has_alpha (format))
-    return 0;
-
-  switch (format) {
-    case GST_VIDEO_FORMAT_RGB16:
-    case GST_VIDEO_FORMAT_BGR16:
-      if (component == 1)
-        return 6;
-      return 5;
-    case GST_VIDEO_FORMAT_RGB15:
-    case GST_VIDEO_FORMAT_BGR15:
-      return 5;
-    case GST_VIDEO_FORMAT_I420:
-    case GST_VIDEO_FORMAT_YV12:
-    case GST_VIDEO_FORMAT_YUY2:
-    case GST_VIDEO_FORMAT_YVYU:
-    case GST_VIDEO_FORMAT_UYVY:
-    case GST_VIDEO_FORMAT_Y41B:
-    case GST_VIDEO_FORMAT_Y42B:
-    case GST_VIDEO_FORMAT_Y444:
-    case GST_VIDEO_FORMAT_NV12:
-    case GST_VIDEO_FORMAT_NV21:
-    case GST_VIDEO_FORMAT_v308:
-    case GST_VIDEO_FORMAT_Y800:
-    case GST_VIDEO_FORMAT_YUV9:
-    case GST_VIDEO_FORMAT_YVU9:
-    case GST_VIDEO_FORMAT_IYU1:
-    case GST_VIDEO_FORMAT_AYUV:
-    case GST_VIDEO_FORMAT_RGBA:
-    case GST_VIDEO_FORMAT_BGRA:
-    case GST_VIDEO_FORMAT_ARGB:
-    case GST_VIDEO_FORMAT_ABGR:
-    case GST_VIDEO_FORMAT_A420:
-    case GST_VIDEO_FORMAT_RGB8_PALETTED:
-    case GST_VIDEO_FORMAT_RGBx:
-    case GST_VIDEO_FORMAT_BGRx:
-    case GST_VIDEO_FORMAT_xRGB:
-    case GST_VIDEO_FORMAT_xBGR:
-    case GST_VIDEO_FORMAT_RGB:
-    case GST_VIDEO_FORMAT_BGR:
-    default:
-      return 8;
-    case GST_VIDEO_FORMAT_v210:
-    case GST_VIDEO_FORMAT_UYVP:
-    case GST_VIDEO_FORMAT_r210:
-      return 10;
-    case GST_VIDEO_FORMAT_Y16:
-    case GST_VIDEO_FORMAT_v216:
-    case GST_VIDEO_FORMAT_ARGB64:
-    case GST_VIDEO_FORMAT_AYUV64:
-      return 16;
-  }
+  if (format == GST_VIDEO_FORMAT_UNKNOWN || format >= G_N_ELEMENTS (formats))
+    return 8;
 
+  return GST_VIDEO_FORMAT_INFO_DEPTH (&formats[format].info, component);
 }
 
 /**
@@ -1434,6 +2262,23 @@ gst_video_format_get_row_stride (GstVideoFormat format, int component,
     case GST_VIDEO_FORMAT_ARGB64:
     case GST_VIDEO_FORMAT_AYUV64:
       return width * 8;
+    case GST_VIDEO_FORMAT_I420_10BE:
+    case GST_VIDEO_FORMAT_I420_10LE:
+      if (component == 0) {
+        return GST_ROUND_UP_4 (2 * width);
+      } else {
+        return GST_ROUND_UP_4 (width);
+      }
+    case GST_VIDEO_FORMAT_I422_10BE:
+    case GST_VIDEO_FORMAT_I422_10LE:
+      if (component == 0) {
+        return GST_ROUND_UP_4 (2 * width);
+      } else {
+        return GST_ROUND_UP_4 (width);
+      }
+    case GST_VIDEO_FORMAT_Y444_10BE:
+    case GST_VIDEO_FORMAT_Y444_10LE:
+      return GST_ROUND_UP_4 (2 * width);
     default:
       return 0;
   }
@@ -1459,82 +2304,10 @@ gst_video_format_get_pixel_stride (GstVideoFormat format, int component)
   g_return_val_if_fail (format != GST_VIDEO_FORMAT_UNKNOWN, 0);
   g_return_val_if_fail (component >= 0 && component <= 3, 0);
 
-  switch (format) {
-    case GST_VIDEO_FORMAT_I420:
-    case GST_VIDEO_FORMAT_YV12:
-    case GST_VIDEO_FORMAT_Y41B:
-    case GST_VIDEO_FORMAT_Y42B:
-    case GST_VIDEO_FORMAT_Y444:
-    case GST_VIDEO_FORMAT_A420:
-    case GST_VIDEO_FORMAT_YUV9:
-    case GST_VIDEO_FORMAT_YVU9:
-      return 1;
-    case GST_VIDEO_FORMAT_YUY2:
-    case GST_VIDEO_FORMAT_YVYU:
-    case GST_VIDEO_FORMAT_UYVY:
-      if (component == 0) {
-        return 2;
-      } else {
-        return 4;
-      }
-    case GST_VIDEO_FORMAT_IYU1:
-      /* doesn't make much sense for IYU1 because it's 1 or 3
-       * for luma depending on position */
-      return 0;
-    case GST_VIDEO_FORMAT_AYUV:
-    case GST_VIDEO_FORMAT_RGBx:
-    case GST_VIDEO_FORMAT_BGRx:
-    case GST_VIDEO_FORMAT_xRGB:
-    case GST_VIDEO_FORMAT_xBGR:
-    case GST_VIDEO_FORMAT_RGBA:
-    case GST_VIDEO_FORMAT_BGRA:
-    case GST_VIDEO_FORMAT_ARGB:
-    case GST_VIDEO_FORMAT_ABGR:
-    case GST_VIDEO_FORMAT_r210:
-      return 4;
-    case GST_VIDEO_FORMAT_RGB16:
-    case GST_VIDEO_FORMAT_BGR16:
-    case GST_VIDEO_FORMAT_RGB15:
-    case GST_VIDEO_FORMAT_BGR15:
-      return 2;
-    case GST_VIDEO_FORMAT_RGB:
-    case GST_VIDEO_FORMAT_BGR:
-    case GST_VIDEO_FORMAT_v308:
-      return 3;
-    case GST_VIDEO_FORMAT_v210:
-      /* v210 is packed at the bit level, so pixel stride doesn't make sense */
-      return 0;
-    case GST_VIDEO_FORMAT_v216:
-      if (component == 0) {
-        return 4;
-      } else {
-        return 8;
-      }
-    case GST_VIDEO_FORMAT_NV12:
-    case GST_VIDEO_FORMAT_NV21:
-      if (component == 0) {
-        return 1;
-      } else {
-        return 2;
-      }
-    case GST_VIDEO_FORMAT_GRAY8:
-    case GST_VIDEO_FORMAT_Y800:
-      return 1;
-    case GST_VIDEO_FORMAT_GRAY16_BE:
-    case GST_VIDEO_FORMAT_GRAY16_LE:
-    case GST_VIDEO_FORMAT_Y16:
-      return 2;
-    case GST_VIDEO_FORMAT_UYVP:
-      /* UYVP is packed at the bit level, so pixel stride doesn't make sense */
-      return 0;
-    case GST_VIDEO_FORMAT_RGB8_PALETTED:
-      return 1;
-    case GST_VIDEO_FORMAT_ARGB64:
-    case GST_VIDEO_FORMAT_AYUV64:
-      return 8;
-    default:
-      return 0;
-  }
+  if (format >= G_N_ELEMENTS (formats))
+    return 0;
+
+  return GST_VIDEO_FORMAT_INFO_PSTRIDE (&formats[format].info, component);
 }
 
 /**
@@ -1571,6 +2344,10 @@ gst_video_format_get_component_width (GstVideoFormat format,
     case GST_VIDEO_FORMAT_NV12:
     case GST_VIDEO_FORMAT_NV21:
     case GST_VIDEO_FORMAT_UYVP:
+    case GST_VIDEO_FORMAT_I422_10BE:
+    case GST_VIDEO_FORMAT_I422_10LE:
+    case GST_VIDEO_FORMAT_I420_10BE:
+    case GST_VIDEO_FORMAT_I420_10LE:
       if (component == 0) {
         return width;
       } else {
@@ -1610,6 +2387,8 @@ gst_video_format_get_component_width (GstVideoFormat format,
     case GST_VIDEO_FORMAT_RGB8_PALETTED:
     case GST_VIDEO_FORMAT_ARGB64:
     case GST_VIDEO_FORMAT_AYUV64:
+    case GST_VIDEO_FORMAT_Y444_10BE:
+    case GST_VIDEO_FORMAT_Y444_10LE:
     case GST_VIDEO_FORMAT_r210:
       return width;
     case GST_VIDEO_FORMAT_A420:
@@ -1650,6 +2429,8 @@ gst_video_format_get_component_height (GstVideoFormat format,
     case GST_VIDEO_FORMAT_YV12:
     case GST_VIDEO_FORMAT_NV12:
     case GST_VIDEO_FORMAT_NV21:
+    case GST_VIDEO_FORMAT_I420_10BE:
+    case GST_VIDEO_FORMAT_I420_10LE:
       if (component == 0) {
         return height;
       } else {
@@ -1690,6 +2471,10 @@ gst_video_format_get_component_height (GstVideoFormat format,
     case GST_VIDEO_FORMAT_ARGB64:
     case GST_VIDEO_FORMAT_AYUV64:
     case GST_VIDEO_FORMAT_r210:
+    case GST_VIDEO_FORMAT_Y444_10BE:
+    case GST_VIDEO_FORMAT_Y444_10LE:
+    case GST_VIDEO_FORMAT_I422_10BE:
+    case GST_VIDEO_FORMAT_I422_10LE:
       return height;
     case GST_VIDEO_FORMAT_A420:
       if (component == 0 || component == 3) {
@@ -1969,10 +2754,35 @@ gst_video_format_get_component_offset (GstVideoFormat format,
       if (component == 3)
         return 0;
       break;
+    case GST_VIDEO_FORMAT_I420_10BE:
+    case GST_VIDEO_FORMAT_I420_10LE:
+      if (component == 0)
+        return 0;
+      if (component == 1)
+        return GST_ROUND_UP_4 (2 * width) * GST_ROUND_UP_2 (height);
+      if (component == 2) {
+        return GST_ROUND_UP_4 (2 * width) * GST_ROUND_UP_2 (height) +
+            GST_ROUND_UP_4 (width) * (GST_ROUND_UP_2 (height) / 2);
+      }
+    case GST_VIDEO_FORMAT_I422_10BE:
+    case GST_VIDEO_FORMAT_I422_10LE:
+      if (component == 0)
+        return 0;
+      if (component == 1)
+        return GST_ROUND_UP_4 (2 * width) * GST_ROUND_UP_2 (height);
+      if (component == 2) {
+        return GST_ROUND_UP_4 (2 * width) * GST_ROUND_UP_2 (height) +
+            GST_ROUND_UP_4 (width) * GST_ROUND_UP_2 (height);
+      }
+      break;
+    case GST_VIDEO_FORMAT_Y444_10BE:
+    case GST_VIDEO_FORMAT_Y444_10LE:
+      return GST_ROUND_UP_4 (2 * width) * height * component;
     default:
       break;
   }
-  GST_WARNING ("unhandled format %d or component %d", format, component);
+  GST_WARNING ("unhandled format %s or component %d",
+      gst_video_format_to_string (format), component);
   return 0;
 }
 
@@ -2070,6 +2880,19 @@ gst_video_format_get_size (GstVideoFormat format, int width, int height)
     case GST_VIDEO_FORMAT_ARGB64:
     case GST_VIDEO_FORMAT_AYUV64:
       return width * 8 * height;
+    case GST_VIDEO_FORMAT_I420_10BE:
+    case GST_VIDEO_FORMAT_I420_10LE:
+      size = GST_ROUND_UP_4 (2 * width) * GST_ROUND_UP_2 (height);
+      size += GST_ROUND_UP_4 (width) * (GST_ROUND_UP_2 (height) / 2) * 2;
+      return size;
+    case GST_VIDEO_FORMAT_I422_10BE:
+    case GST_VIDEO_FORMAT_I422_10LE:
+      size = GST_ROUND_UP_4 (2 * width) * GST_ROUND_UP_2 (height);
+      size += GST_ROUND_UP_4 (width) * GST_ROUND_UP_2 (height) * 2;
+      return size;
+    case GST_VIDEO_FORMAT_Y444_10BE:
+    case GST_VIDEO_FORMAT_Y444_10LE:
+      return 2 * GST_ROUND_UP_4 (width) * height * 3;
     default:
       return 0;
   }
@@ -2475,15 +3298,15 @@ gst_video_event_parse_downstream_force_key_unit (GstEvent * event,
     return FALSE;
 
   if (!gst_structure_get_clock_time (s, "timestamp", &ev_timestamp))
-    return FALSE;               /* Not a force key unit event */
+    ev_timestamp = GST_CLOCK_TIME_NONE;
   if (!gst_structure_get_clock_time (s, "stream-time", &ev_stream_time))
-    return FALSE;               /* Not a force key unit event */
+    ev_stream_time = GST_CLOCK_TIME_NONE;
   if (!gst_structure_get_clock_time (s, "running-time", &ev_running_time))
-    return FALSE;               /* Not a force key unit event */
+    ev_running_time = GST_CLOCK_TIME_NONE;
   if (!gst_structure_get_boolean (s, "all-headers", &ev_all_headers))
-    return FALSE;               /* Not a force key unit event */
+    ev_all_headers = FALSE;
   if (!gst_structure_get_uint (s, "count", &ev_count))
-    return FALSE;               /* Not a force key unit event */
+    ev_count = 0;
 
   if (timestamp)
     *timestamp = ev_timestamp;
@@ -2539,11 +3362,11 @@ gst_video_event_parse_upstream_force_key_unit (GstEvent * event,
     return FALSE;
 
   if (!gst_structure_get_clock_time (s, "running-time", &ev_running_time))
-    return FALSE;               /* Not a force key unit event */
+    ev_running_time = GST_CLOCK_TIME_NONE;
   if (!gst_structure_get_boolean (s, "all-headers", &ev_all_headers))
-    return FALSE;               /* Not a force key unit event */
+    ev_all_headers = FALSE;
   if (!gst_structure_get_uint (s, "count", &ev_count))
-    return FALSE;               /* Not a force key unit event */
+    ev_count = 0;
 
   if (running_time)
     *running_time = ev_running_time;
diff --git a/gst-libs/gst/video/video.h b/gst-libs/gst/video/video.h
index 36750e9..876aab5 100644
--- a/gst-libs/gst/video/video.h
+++ b/gst-libs/gst/video/video.h
@@ -30,6 +30,7 @@ G_BEGIN_DECLS
 /**
  * GstVideoFormat:
  * @GST_VIDEO_FORMAT_UNKNOWN: Unknown or unset video format id
+ * @GST_VIDEO_FORMAT_ENCODED: Encoded video format
  * @GST_VIDEO_FORMAT_I420: planar 4:2:0 YUV
  * @GST_VIDEO_FORMAT_YV12: planar 4:2:0 YVU (like I420 but UV planes swapped)
  * @GST_VIDEO_FORMAT_YUY2: packed 4:2:2 YUV (Y0-U0-Y1-V0 Y2-U2-Y3-V2 Y4 ...)
@@ -72,6 +73,12 @@ G_BEGIN_DECLS
  * @GST_VIDEO_FORMAT_ARGB64: rgb with alpha channel first, 16 bits per channel (Since: 0.10.33)
  * @GST_VIDEO_FORMAT_AYUV64: packed 4:4:4 YUV with alpha channel, 16 bits per channel (A0-Y0-U0-V0 ...) (Since: 0.10.33)
  * @GST_VIDEO_FORMAT_r210: packed 4:4:4 RGB, 10 bits per channel (Since: 0.10.33)
+ * @GST_VIDEO_FORMAT_I420_10BE: planar 4:2:0 YUV, 10 bits per channel
+ * @GST_VIDEO_FORMAT_I420_10LE: planar 4:2:0 YUV, 10 bits per channel
+ * @GST_VIDEO_FORMAT_I422_10BE: planar 4:2:2 YUV, 10 bits per channel
+ * @GST_VIDEO_FORMAT_I422_10LE: planar 4:2:2 YUV, 10 bits per channel
+ * @GST_VIDEO_FORMAT_Y444_10BE: planar 4:4:4 YUV, 10 bits per channel
+ * @GST_VIDEO_FORMAT_Y444_10LE: planar 4:4:4 YUV, 10 bits per channel
  *
  * Enum value describing the most common video formats.
  */
@@ -118,7 +125,14 @@ typedef enum {
   GST_VIDEO_FORMAT_IYU1,
   GST_VIDEO_FORMAT_ARGB64,
   GST_VIDEO_FORMAT_AYUV64,
-  GST_VIDEO_FORMAT_r210
+  GST_VIDEO_FORMAT_r210,
+  GST_VIDEO_FORMAT_ENCODED,
+  GST_VIDEO_FORMAT_I420_10BE,
+  GST_VIDEO_FORMAT_I420_10LE,
+  GST_VIDEO_FORMAT_I422_10BE,
+  GST_VIDEO_FORMAT_I422_10LE,
+  GST_VIDEO_FORMAT_Y444_10BE,
+  GST_VIDEO_FORMAT_Y444_10LE
 } GstVideoFormat;
 
 #define GST_VIDEO_BYTE1_MASK_32  "0xFF000000"
@@ -435,6 +449,466 @@ typedef enum {
  */
 #define GST_VIDEO_BUFFER_PROGRESSIVE GST_BUFFER_FLAG_MEDIA4
 
+/* Backported from 0.11 */
+
+#define GST_VIDEO_MAX_PLANES 4
+#define GST_VIDEO_MAX_COMPONENTS 4
+
+typedef struct _GstVideoFormatInfo GstVideoFormatInfo;
+
+/**
+ * GstVideoFormatFlags:
+ * @GST_VIDEO_FORMAT_FLAG_YUV: The video format is YUV, components are numbered
+ *   0=Y, 1=U, 2=V.
+ * @GST_VIDEO_FORMAT_FLAG_RGB: The video format is RGB, components are numbered
+ *   0=R, 1=G, 2=B.
+ * @GST_VIDEO_FORMAT_FLAG_GRAY: The video is gray, there is one gray component
+ *   with index 0.
+ * @GST_VIDEO_FORMAT_FLAG_ALPHA: The video format has an alpha components with
+ *   the number 3.
+ * @GST_VIDEO_FORMAT_FLAG_LE: The video format has data stored in little
+ *   endianness.
+ * @GST_VIDEO_FORMAT_FLAG_PALETTE: The video format has a palette.
+ * @GST_VIDEO_FORMAT_FLAG_COMPLEX: The video format has a complex layout that
+ *   can't be described with the usual information in the #GstVideoFormatInfo.
+ *
+ * The different video flags that a format info can have.
+ */
+typedef enum
+{
+  GST_VIDEO_FORMAT_FLAG_YUV      = (1 << 0),
+  GST_VIDEO_FORMAT_FLAG_RGB      = (1 << 1),
+  GST_VIDEO_FORMAT_FLAG_GRAY     = (1 << 2),
+  GST_VIDEO_FORMAT_FLAG_ALPHA    = (1 << 3),
+  GST_VIDEO_FORMAT_FLAG_LE       = (1 << 4),
+  GST_VIDEO_FORMAT_FLAG_PALETTE  = (1 << 5),
+  GST_VIDEO_FORMAT_FLAG_COMPLEX  = (1 << 6)
+} GstVideoFormatFlags;
+
+#define GST_VIDEO_COMP_Y  0
+#define GST_VIDEO_COMP_U  1
+#define GST_VIDEO_COMP_V  2
+
+#define GST_VIDEO_COMP_R  0
+#define GST_VIDEO_COMP_G  1
+#define GST_VIDEO_COMP_B  2
+
+#define GST_VIDEO_COMP_A  3
+
+/**
+ * GstVideoFormatUnpack:
+ * @info: a #GstVideoFormatInfo
+ * @dest: a destination array
+ * @data: pointers to the data planes
+ * @stride: strides of the planes
+ * @x: the x position in the image to start from
+ * @y: the y position in the image to start from
+ * @width: the amount of pixels to unpack.
+ *
+ * Unpacks @width pixels from the given planes and strides containing data of
+ * format @info. The pixels will be unpacked into @dest which each component
+ * interleaved. @dest should at least be big enough to hold @width *
+ * n_components * size(unpack_format) bytes.
+ */
+typedef void (*GstVideoFormatUnpack)         (GstVideoFormatInfo *info, gpointer dest,
+                                              const gpointer data[GST_VIDEO_MAX_PLANES],
+                                              const gint stride[GST_VIDEO_MAX_PLANES],
+                                              gint x, gint y, gint width);
+/**
+ * GstVideoFormatPack:
+ * @info: a #GstVideoFormatInfo
+ * @src: a source array
+ * @data: pointers to the destination data planes
+ * @stride: strides of the destination planes
+ * @x: the x position in the image to pack to
+ * @y: the y position in the image to pack to
+ * @width: the amount of pixels to pack.
+ *
+ * Packs @width pixels from @src to the given planes and strides in the
+ * format @info. The pixels from source have each component interleaved
+ * and will be packed into the planes in @data.
+ */
+typedef void (*GstVideoFormatPack)           (GstVideoFormatInfo *info, const gpointer src,
+                                              gpointer data[GST_VIDEO_MAX_PLANES],
+                                              const gint stride[GST_VIDEO_MAX_PLANES],
+                                              gint x, gint y, gint width);
+
+/**
+ * GstVideoFormatInfo:
+ * @format: #GstVideoFormat
+ * @name: string representation of the format
+ * @description: use readable description of the format
+ * @flags: #GstVideoFormatFlags
+ * @bits: The number of bits used to pack data items. This can be less than 8
+ *    when multiple pixels are stored in a byte. for values > 8 multiple bytes
+ *    should be read according to the endianness flag before applying the shift
+ *    and mask.
+ * @n_components: the number of components in the video format.
+ * @shift: the number of bits to shift away to get the component data
+ * @depth: the depth in bits for each component
+ * @pixel_stride: the pixel stride of each component. This is the amount of
+ *    bytes to the pixel immediately to the right. When bits < 8, the stride is
+ *    expressed in bits.
+ * @n_planes: the number of planes for this format. The number of planes can be
+ *    less than the amount of components when multiple components are packed into
+ *    one plane.
+ * @plane: the plane number where a component can be found
+ * @poffset: the offset in the plane where the first pixel of the components
+ *    can be found. If bits < 8 the amount is specified in bits.
+ * @w_sub: subsampling factor of the width for the component. Use
+ *     GST_VIDEO_SUB_SCALE to scale a width.
+ * @h_sub: subsampling factor of the height for the component. Use
+ *     GST_VIDEO_SUB_SCALE to scale a height.
+ * @unpack_format: the format of the unpacked pixels.
+ * @unpack_func: an unpack function for this format
+ * @pack_func: an pack function for this format
+ *
+ * Information for a video format.
+ */
+struct _GstVideoFormatInfo {
+  GstVideoFormat format;
+  const gchar *name;
+  const gchar *description;
+  GstVideoFormatFlags flags;
+  guint bits;
+  guint n_components;
+  guint shift[GST_VIDEO_MAX_COMPONENTS];
+  guint depth[GST_VIDEO_MAX_COMPONENTS];
+  gint  pixel_stride[GST_VIDEO_MAX_COMPONENTS];
+  guint n_planes;
+  guint plane[GST_VIDEO_MAX_COMPONENTS];
+  guint poffset[GST_VIDEO_MAX_COMPONENTS];
+  guint w_sub[GST_VIDEO_MAX_COMPONENTS];
+  guint h_sub[GST_VIDEO_MAX_COMPONENTS];
+
+  GstVideoFormat unpack_format;
+  GstVideoFormatUnpack unpack_func;
+  GstVideoFormatPack pack_func;
+};
+
+#define GST_VIDEO_FORMAT_INFO_FORMAT(info)       ((info)->format)
+#define GST_VIDEO_FORMAT_INFO_NAME(info)         ((info)->name)
+#define GST_VIDEO_FORMAT_INFO_FLAGS(info)        ((info)->flags)
+
+#define GST_VIDEO_FORMAT_INFO_IS_YUV(info)       ((info)->flags & GST_VIDEO_FORMAT_FLAG_YUV)
+#define GST_VIDEO_FORMAT_INFO_IS_RGB(info)       ((info)->flags & GST_VIDEO_FORMAT_FLAG_RGB)
+#define GST_VIDEO_FORMAT_INFO_IS_GRAY(info)      ((info)->flags & GST_VIDEO_FORMAT_FLAG_GRAY)
+#define GST_VIDEO_FORMAT_INFO_HAS_ALPHA(info)    ((info)->flags & GST_VIDEO_FORMAT_FLAG_ALPHA)
+#define GST_VIDEO_FORMAT_INFO_IS_LE(info)        ((info)->flags & GST_VIDEO_FORMAT_FLAG_LE)
+#define GST_VIDEO_FORMAT_INFO_HAS_PALETTE(info)  ((info)->flags & GST_VIDEO_FORMAT_FLAG_PALETTE)
+#define GST_VIDEO_FORMAT_INFO_IS_COMPLEX(info)   ((info)->flags & GST_VIDEO_FORMAT_FLAG_COMPLEX)
+
+#define GST_VIDEO_FORMAT_INFO_BITS(info)         ((info)->bits)
+#define GST_VIDEO_FORMAT_INFO_N_COMPONENTS(info) ((info)->n_components)
+#define GST_VIDEO_FORMAT_INFO_SHIFT(info,c)      ((info)->shift[c])
+#define GST_VIDEO_FORMAT_INFO_DEPTH(info,c)      ((info)->depth[c])
+#define GST_VIDEO_FORMAT_INFO_PSTRIDE(info,c)    ((info)->pixel_stride[c])
+#define GST_VIDEO_FORMAT_INFO_N_PLANES(info)     ((info)->n_planes)
+#define GST_VIDEO_FORMAT_INFO_PLANE(info,c)      ((info)->plane[c])
+#define GST_VIDEO_FORMAT_INFO_POFFSET(info,c)    ((info)->poffset[c])
+#define GST_VIDEO_FORMAT_INFO_W_SUB(info,c)      ((info)->w_sub[c])
+#define GST_VIDEO_FORMAT_INFO_H_SUB(info,c)      ((info)->h_sub[c])
+
+#define GST_VIDEO_SUB_SCALE(scale,val)   (-((-((gint)val))>>(scale)))
+
+#define GST_VIDEO_FORMAT_INFO_SCALE_WIDTH(info,c,w)  GST_VIDEO_SUB_SCALE ((info)->w_sub[(c)],(w))
+#define GST_VIDEO_FORMAT_INFO_SCALE_HEIGHT(info,c,h) GST_VIDEO_SUB_SCALE ((info)->h_sub[(c)],(h))
+
+#define GST_VIDEO_FORMAT_INFO_DATA(info,planes,comp) \
+  (((guint8*)(planes)[info->plane[comp]]) + info->poffset[comp])
+#define GST_VIDEO_FORMAT_INFO_STRIDE(info,strides,comp) ((strides)[info->plane[comp]])
+#define GST_VIDEO_FORMAT_INFO_OFFSET(info,offsets,comp) \
+  (((offsets)[info->plane[comp]]) + info->poffset[comp])
+
+typedef struct _GstVideoInfo GstVideoInfo;
+
+const GstVideoFormatInfo *
+               gst_video_format_get_info             (GstVideoFormat format) G_GNUC_CONST;
+/**
+ * GstVideoInterlaceMode:
+ * @GST_VIDEO_INTERLACE_MODE_PROGRESSIVE: all frames are progressive
+ * @GST_VIDEO_INTERLACE_MODE_INTERLEAVED: video is interlaced and all fields
+ *     are interlaced in one frame.
+ * @GST_VIDEO_INTERLACE_MODE_MIXED: video contains both interlaced and
+ *     progressive frames, the buffer flags describe the frame and fields.
+ *
+ * The possible values of the #GstVideoInterlaceMode describing the interlace
+ * mode of the stream.
+ */
+typedef enum {
+  GST_VIDEO_INTERLACE_MODE_PROGRESSIVE = 0,
+  GST_VIDEO_INTERLACE_MODE_INTERLEAVED,
+  GST_VIDEO_INTERLACE_MODE_MIXED
+} GstVideoInterlaceMode;
+
+/**
+ * GstVideoFlags:
+ * @GST_VIDEO_FLAG_NONE: no flags
+ * @GST_VIDEO_FLAG_VARIABLE_FPS: a variable fps is selected, fps_n and fps_d
+ * denote the maximum fps of the video
+ *
+ * Extra video flags
+ */
+typedef enum {
+  GST_VIDEO_FLAG_NONE         = 0,
+  GST_VIDEO_FLAG_VARIABLE_FPS = (1 << 1)
+} GstVideoFlags;
+
+/**
+ * GstVideoChroma:
+ * @GST_VIDEO_CHROMA_SITE_UNKNOWN: unknown cositing
+ * @GST_VIDEO_CHROMA_SITE_NONE: no cositing
+ * @GST_VIDEO_CHROMA_SITE_H_COSITED: chroma is horizontally cosited
+ * @GST_VIDEO_CHROMA_SITE_V_COSITED: chroma is vertically cosited
+ * @GST_VIDEO_CHROMA_SITE_ALT_LINE: choma samples are sited on alternate lines
+ * @GST_VIDEO_CHROMA_SITE_COSITED: chroma samples cosited with luma samples
+ * @GST_VIDEO_CHROMA_SITE_JPEG: jpeg style cositing, also for mpeg1 and mjpeg
+ * @GST_VIDEO_CHROMA_SITE_MPEG2: mpeg2 style cositing
+ * @GST_VIDEO_CHROMA_SITE_DV: DV style cositing
+ *
+ * Various Chroma sitings.
+ */
+typedef enum {
+  GST_VIDEO_CHROMA_SITE_UNKNOWN   =  0,
+  GST_VIDEO_CHROMA_SITE_NONE      = (1 << 0),
+  GST_VIDEO_CHROMA_SITE_H_COSITED = (1 << 1),
+  GST_VIDEO_CHROMA_SITE_V_COSITED = (1 << 2),
+  GST_VIDEO_CHROMA_SITE_ALT_LINE  = (1 << 3),
+  /* some common chroma cositing */
+  GST_VIDEO_CHROMA_SITE_COSITED   = (GST_VIDEO_CHROMA_SITE_H_COSITED | GST_VIDEO_CHROMA_SITE_V_COSITED),
+  GST_VIDEO_CHROMA_SITE_JPEG      = (GST_VIDEO_CHROMA_SITE_NONE),
+  GST_VIDEO_CHROMA_SITE_MPEG2     = (GST_VIDEO_CHROMA_SITE_H_COSITED),
+  GST_VIDEO_CHROMA_SITE_DV        = (GST_VIDEO_CHROMA_SITE_COSITED | GST_VIDEO_CHROMA_SITE_ALT_LINE),
+} GstVideoChromaSite;
+
+
+/**
+ * GstVideoColorRange:
+ * @GST_VIDEO_COLOR_RANGE_UNKNOWN: unknown range
+ * @GST_VIDEO_COLOR_RANGE_0_255: [0..255] for 8 bit components
+ * @GST_VIDEO_COLOR_RANGE_16_235: [16..235] for 8 bit components. Chroma has
+ *                 [16..240] range.
+ *
+ * Possible color range values. These constants are defined for 8 bit color
+ * values and can be scaled for other bit depths.
+ */
+typedef enum {
+  GST_VIDEO_COLOR_RANGE_UNKNOWN = 0,
+  GST_VIDEO_COLOR_RANGE_0_255,
+  GST_VIDEO_COLOR_RANGE_16_235
+} GstVideoColorRange;
+
+/**
+ * GstVideoColorMatrix:
+ * @GST_VIDEO_COLOR_MATRIX_UNKNOWN: unknown matrix
+ * @GST_VIDEO_COLOR_MATRIX_RGB: identity matrix
+ * @GST_VIDEO_COLOR_MATRIX_FCC: FCC color matrix
+ * @GST_VIDEO_COLOR_MATRIX_BT709: ITU-R BT.709 color matrix
+ * @GST_VIDEO_COLOR_MATRIX_BT601: ITU-R BT.601 color matrix
+ * @GST_VIDEO_COLOR_MATRIX_SMPTE240M: SMPTE 240M color matrix
+ *
+ * The color matrix is used to convert between Y'PbPr and
+ * non-linear RGB (R'G'B')
+ */
+typedef enum {
+  GST_VIDEO_COLOR_MATRIX_UNKNOWN = 0,
+  GST_VIDEO_COLOR_MATRIX_RGB,
+  GST_VIDEO_COLOR_MATRIX_FCC,
+  GST_VIDEO_COLOR_MATRIX_BT709,
+  GST_VIDEO_COLOR_MATRIX_BT601,
+  GST_VIDEO_COLOR_MATRIX_SMPTE240M
+} GstVideoColorMatrix;
+
+/**
+ * GstVideoTransferFunction:
+ * @GST_VIDEO_TRANSFER_UNKNOWN: unknown transfer function
+ * @GST_VIDEO_TRANSFER_GAMMA10: linear RGB, gamma 1.0 curve
+ * @GST_VIDEO_TRANSFER_GAMMA18: Gamma 1.8 curve
+ * @GST_VIDEO_TRANSFER_GAMMA20: Gamma 2.0 curve
+ * @GST_VIDEO_TRANSFER_GAMMA22: Gamma 2.2 curve
+ * @GST_VIDEO_TRANSFER_BT709: Gamma 2.2 curve with a linear segment in the lower
+ *                           range
+ * @GST_VIDEO_TRANSFER_SMPTE240M: Gamma 2.2 curve with a linear segment in the
+ *                               lower range
+ * @GST_VIDEO_TRANSFER_SRGB: Gamma 2.4 curve with a linear segment in the lower
+ *                          range
+ * @GST_VIDEO_TRANSFER_GAMMA28: Gamma 2.8 curve
+ * @GST_VIDEO_TRANSFER_LOG100: Logarithmic transfer characteristic
+ *                             100:1 range
+ * @GST_VIDEO_TRANSFER_LOG316: Logarithmic transfer characteristic
+ *                             316.22777:1 range
+ *
+ * The video transfer function defines the formula for converting between
+ * non-linear RGB (R'G'B') and linear RGB
+ */
+typedef enum {
+  GST_VIDEO_TRANSFER_UNKNOWN = 0,
+  GST_VIDEO_TRANSFER_GAMMA10,
+  GST_VIDEO_TRANSFER_GAMMA18,
+  GST_VIDEO_TRANSFER_GAMMA20,
+  GST_VIDEO_TRANSFER_GAMMA22,
+  GST_VIDEO_TRANSFER_BT709,
+  GST_VIDEO_TRANSFER_SMPTE240M,
+  GST_VIDEO_TRANSFER_SRGB,
+  GST_VIDEO_TRANSFER_GAMMA28,
+  GST_VIDEO_TRANSFER_LOG100,
+  GST_VIDEO_TRANSFER_LOG316
+} GstVideoTransferFunction;
+
+/**
+ * GstVideoColorPrimaries:
+ * @GST_VIDEO_COLOR_PRIMARIES_UNKNOWN: unknown color primaries
+ * @GST_VIDEO_COLOR_PRIMARIES_BT709: BT709 primaries
+ * @GST_VIDEO_COLOR_PRIMARIES_BT470M: BT470M primaries
+ * @GST_VIDEO_COLOR_PRIMARIES_BT470BG: BT470BG primaries
+ * @GST_VIDEO_COLOR_PRIMARIES_SMPTE170M: SMPTE170M primaries
+ * @GST_VIDEO_COLOR_PRIMARIES_SMPTE240M: SMPTE240M primaries
+ *
+ * The color primaries define the how to transform linear RGB values to and from
+ * the CIE XYZ colorspace.
+ */
+typedef enum {
+  GST_VIDEO_COLOR_PRIMARIES_UNKNOWN = 0,
+  GST_VIDEO_COLOR_PRIMARIES_BT709,
+  GST_VIDEO_COLOR_PRIMARIES_BT470M,
+  GST_VIDEO_COLOR_PRIMARIES_BT470BG,
+  GST_VIDEO_COLOR_PRIMARIES_SMPTE170M,
+  GST_VIDEO_COLOR_PRIMARIES_SMPTE240M
+} GstVideoColorPrimaries;
+
+/**
+ * GstVideoColorimetry:
+ * @range: the color range. This is the valid range for the samples.
+ *         It is used to convert the samples to Y'PbPr values.
+ * @matrix: the color matrix. Used to convert between Y'PbPr and
+ *          non-linear RGB (R'G'B')
+ * @transfer: the transfer function. used to convert between R'G'B' and RGB
+ * @primaries: color primaries. used to convert between R'G'B' and CIE XYZ
+ *
+ * Structure describing the color info.
+ */
+typedef struct {
+  GstVideoColorRange        range;
+  GstVideoColorMatrix       matrix;
+  GstVideoTransferFunction  transfer;
+  GstVideoColorPrimaries    primaries;
+} GstVideoColorimetry;
+
+/* predefined colorimetry */
+#define GST_VIDEO_COLORIMETRY_BT601       "bt601"
+#define GST_VIDEO_COLORIMETRY_BT709       "bt709"
+#define GST_VIDEO_COLORIMETRY_SMPTE240M   "smpte240m"
+
+gboolean     gst_video_colorimetry_matches     (GstVideoColorimetry *cinfo, const gchar *color);
+gboolean     gst_video_colorimetry_from_string (GstVideoColorimetry *cinfo, const gchar *color);
+gchar *      gst_video_colorimetry_to_string   (GstVideoColorimetry *cinfo);
+
+/**
+ * GstVideoInfo:
+ * @finfo: the format info of the video
+ * @interlace_mode: the interlace mode
+ * @flags: additional video flags
+ * @width: the width of the video
+ * @height: the height of the video
+ * @size: the default size of one frame
+ * @chroma_site: a #GstVideoChromaSite.
+ * @colorimetry: the colorimetry info
+ * @palette: a buffer with palette data
+ * @par_n: the pixel-aspect-ratio numerator
+ * @par_d: the pixel-aspect-ratio demnominator
+ * @fps_n: the framerate numerator
+ * @fps_d: the framerate demnominator
+ * @offset: offsets of the planes
+ * @stride: strides of the planes
+ *
+ * Information describing image properties. This information can be filled
+ * in from GstCaps with gst_video_info_from_caps(). The information is also used
+ * to store the specific video info when mapping a video frame with
+ * gst_video_frame_map().
+ *
+ * Use the provided macros to access the info in this structure.
+ */
+struct _GstVideoInfo {
+  const GstVideoFormatInfo *finfo;
+
+  GstVideoInterlaceMode     interlace_mode;
+  GstVideoFlags             flags;
+  gint                      width;
+  gint                      height;
+  gsize                     size;
+
+  GstVideoChromaSite        chroma_site;
+  GstVideoColorimetry       colorimetry;
+
+  GstBuffer                *palette;
+
+  gint                      par_n;
+  gint                      par_d;
+  gint                      fps_n;
+  gint                      fps_d;
+
+  gsize                     offset[GST_VIDEO_MAX_PLANES];
+  gint                      stride[GST_VIDEO_MAX_PLANES];
+};
+
+/* general info */
+#define GST_VIDEO_INFO_FORMAT(i)         (GST_VIDEO_FORMAT_INFO_FORMAT((i)->finfo))
+#define GST_VIDEO_INFO_NAME(i)           (GST_VIDEO_FORMAT_INFO_NAME((i)->finfo))
+#define GST_VIDEO_INFO_IS_YUV(i)         (GST_VIDEO_FORMAT_INFO_IS_YUV((i)->finfo))
+#define GST_VIDEO_INFO_IS_RGB(i)         (GST_VIDEO_FORMAT_INFO_IS_RGB((i)->finfo))
+#define GST_VIDEO_INFO_IS_GRAY(i)        (GST_VIDEO_FORMAT_INFO_IS_GRAY((i)->finfo))
+#define GST_VIDEO_INFO_HAS_ALPHA(i)      (GST_VIDEO_FORMAT_INFO_HAS_ALPHA((i)->finfo))
+
+#define GST_VIDEO_INFO_INTERLACE_MODE(i) ((i)->interlace_mode)
+#define GST_VIDEO_INFO_IS_INTERLACED(i)  ((i)->interlace_mode != GST_VIDEO_INTERLACE_MODE_PROGRESSIVE)
+#define GST_VIDEO_INFO_FLAGS(i)          ((i)->flags)
+#define GST_VIDEO_INFO_WIDTH(i)          ((i)->width)
+#define GST_VIDEO_INFO_HEIGHT(i)         ((i)->height)
+#define GST_VIDEO_INFO_SIZE(i)           ((i)->size)
+#define GST_VIDEO_INFO_PAR_N(i)          ((i)->par_n)
+#define GST_VIDEO_INFO_PAR_D(i)          ((i)->par_d)
+#define GST_VIDEO_INFO_FPS_N(i)          ((i)->fps_n)
+#define GST_VIDEO_INFO_FPS_D(i)          ((i)->fps_d)
+
+/* dealing with GstVideoInfo flags */
+#define GST_VIDEO_INFO_FLAG_IS_SET(i,flag) ((GST_VIDEO_INFO_FLAGS(i) & (flag)) == (flag))
+#define GST_VIDEO_INFO_FLAG_SET(i,flag)    (GST_VIDEO_INFO_FLAGS(i) |= (flag))
+#define GST_VIDEO_INFO_FLAG_UNSET(i,flag)  (GST_VIDEO_INFO_FLAGS(i) &= ~(flag))
+
+/* dealing with planes */
+#define GST_VIDEO_INFO_N_PLANES(i)       (GST_VIDEO_FORMAT_INFO_N_PLANES((i)->finfo))
+#define GST_VIDEO_INFO_PLANE_OFFSET(i,p) ((i)->offset[p])
+#define GST_VIDEO_INFO_PLANE_STRIDE(i,p) ((i)->stride[p])
+
+/* dealing with components */
+#define GST_VIDEO_INFO_N_COMPONENTS(i)   GST_VIDEO_FORMAT_INFO_N_COMPONENTS((i)->finfo)
+#define GST_VIDEO_INFO_COMP_DEPTH(i,c)   GST_VIDEO_FORMAT_INFO_DEPTH((i)->finfo,c)
+#define GST_VIDEO_INFO_COMP_BITS(i,c)    GST_VIDEO_FORMAT_INFO_BITS((i)->finfo,c)
+#define GST_VIDEO_INFO_COMP_DATA(i,d,c)  GST_VIDEO_FORMAT_INFO_DATA((i)->finfo,d,c)
+#define GST_VIDEO_INFO_COMP_OFFSET(i,c)  GST_VIDEO_FORMAT_INFO_OFFSET((i)->finfo,(i)->offset,c)
+#define GST_VIDEO_INFO_COMP_STRIDE(i,c)  GST_VIDEO_FORMAT_INFO_STRIDE((i)->finfo,(i)->stride,c)
+#define GST_VIDEO_INFO_COMP_WIDTH(i,c)   GST_VIDEO_FORMAT_INFO_SCALE_WIDTH((i)->finfo,c,(i)->width)
+#define GST_VIDEO_INFO_COMP_HEIGHT(i,c)  GST_VIDEO_FORMAT_INFO_SCALE_HEIGHT((i)->finfo,c,(i)->height)
+#define GST_VIDEO_INFO_COMP_PLANE(i,c)   GST_VIDEO_FORMAT_INFO_PLANE((i)->finfo,c)
+#define GST_VIDEO_INFO_COMP_PSTRIDE(i,c) GST_VIDEO_FORMAT_INFO_PSTRIDE((i)->finfo,c)
+#define GST_VIDEO_INFO_COMP_POFFSET(i,c) GST_VIDEO_FORMAT_INFO_POFFSET((i)->finfo,c)
+
+void         gst_video_info_init        (GstVideoInfo *info);
+
+void         gst_video_info_set_format  (GstVideoInfo *info, GstVideoFormat format,
+                                         guint width, guint height);
+
+gboolean     gst_video_info_from_caps   (GstVideoInfo *info, const GstCaps  * caps);
+
+GstCaps *    gst_video_info_to_caps     (GstVideoInfo *info);
+
+gboolean     gst_video_info_convert     (GstVideoInfo *info,
+                                         GstFormat     src_format,
+                                         gint64        src_value,
+                                         GstFormat     dest_format,
+                                         gint64       *dest_value);
+gboolean     gst_video_info_is_equal    (const GstVideoInfo *info,
+					 const GstVideoInfo *other);
 /* functions */
 
 const GValue * gst_video_frame_rate (GstPad * pad);
@@ -493,11 +967,17 @@ GstCaps *      gst_video_format_new_caps_interlaced (GstVideoFormat format,
 GstCaps *      gst_video_format_new_template_caps (GstVideoFormat format);
 
 /* format properties */
+GstVideoFormat gst_video_format_from_masks (gint depth, gint bpp, gint endianness,
+					    gint red_mask, gint green_mask,
+					    gint blue_mask, gint alpha_mask) G_GNUC_CONST;
+
 
 GstVideoFormat gst_video_format_from_fourcc (guint32 fourcc) G_GNUC_CONST;
 
 guint32        gst_video_format_to_fourcc (GstVideoFormat format) G_GNUC_CONST;
 
+const gchar *  gst_video_format_to_string (GstVideoFormat format) G_GNUC_CONST;
+
 gboolean       gst_video_format_is_rgb    (GstVideoFormat format) G_GNUC_CONST;
 
 gboolean       gst_video_format_is_yuv    (GstVideoFormat format) G_GNUC_CONST;
diff --git a/gst-plugins-base.doap b/gst-plugins-base.doap
index 08bd57e..4f0ff3a 100644
--- a/gst-plugins-base.doap
+++ b/gst-plugins-base.doap
@@ -36,18 +36,6 @@ A wide range of video and audio decoders, encoders, and filters are included.
 
  <release>
   <Version>
-   <revision>0.10.36</revision>
-   <branch>0.10</branch>
-   <name>Better</name>
-   <created>2012-02-20</created>
-   <file-release rdf:resource="http://gstreamer.freedesktop.org/src/gst-plugins-base/gst-plugins-base-0.10.36.tar.bz2" />
-   <file-release rdf:resource="http://gstreamer.freedesktop.org/src/gst-plugins-base/gst-plugins-base-0.10.36.tar.gz" />
-   <file-release rdf:resource="http://gstreamer.freedesktop.org/src/gst-plugins-base/gst-plugins-base-0.10.36.tar.xz" />
-  </Version>
- </release>
-
- <release>
-  <Version>
    <revision>0.10.35</revision>
    <branch>0.10</branch>
    <name>Short Notice</name>
diff --git a/gst-plugins-base.spec b/gst-plugins-base.spec
deleted file mode 100644
index a2818e5..0000000
--- a/gst-plugins-base.spec
+++ /dev/null
@@ -1,304 +0,0 @@
-%define majorminor  0.10
-%define gstreamer   gstreamer
-
-%define gst_minver  0.10.0
-
-Name: 		%{gstreamer}-plugins-base
-Version: 	0.10.36
-Release: 	1.gst
-Summary: 	GStreamer streaming media framework plug-ins
-
-Group: 		Applications/Multimedia
-License: 	LGPL
-URL:		http://gstreamer.freedesktop.org/
-Vendor:         GStreamer Backpackers Team <package@gstreamer.freedesktop.org>
-Source:         http://gstreamer.freedesktop.org/src/gst-plugins-base/gst-plugins-base-%{version}.tar.gz
-BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
-
-Requires: 	  %{gstreamer} >= %{gst_minver}
-BuildRequires: 	  %{gstreamer}-devel >= %{gst_minver}
-
-BuildRequires:  gcc-c++
-BuildRequires:  gtk-doc >= 1.3
-BuildRequires:  orc-devel
-Requires:       orc
-
-Requires:      gnome-vfs2 > 1.9.4.00
-BuildRequires: gnome-vfs2-devel > 1.9.4.00
-Requires:      libogg >= 1.0
-Requires:      libvorbis >= 1.0
-BuildRequires: libogg-devel >= 1.0
-BuildRequires: libvorbis-devel >= 1.0
-BuildRequires:  libXv-devel
-Requires:       libXv-devel
-BuildRequires: alsa-lib-devel
-Requires:      alsa-lib
-BuildRequires: cdparanoia-devel
-Requires:      cdparanoia
-BuildRequires: libvisual-devel
-Requires:      libvisual
-BuildRequires: pango-devel
-Requires: pango
-BuildRequires: libtheora-devel >= 1.0
-Requires:      libtheora >= 1.0
-
-%description
-GStreamer is a streaming media framework, based on graphs of filters which
-operate on media data. Applications using this library can do anything
-from real-time sound processing to playing videos, and just about anything
-else media-related.  Its plugin-based architecture means that new data
-types or processing capabilities can be added simply by installing new
-plug-ins.
-
-%prep
-%setup -q -n gst-plugins-base-%{version}
-export DOCS_ARE_INCOMPLETE_PLEASE_FIXME=0
-%build
-%configure \
-  --enable-gtk-doc --enable-introspection=yes
-
-make %{?_smp_mflags}
-                                                                                
-%install
-rm -rf $RPM_BUILD_ROOT
-
-%makeinstall
-
-# Clean out files that should not be part of the rpm.
-rm -f $RPM_BUILD_ROOT%{_libdir}/gstreamer-%{majorminor}/*.la
-rm -f $RPM_BUILD_ROOT%{_libdir}/gstreamer-%{majorminor}/*.a
-rm -f $RPM_BUILD_ROOT%{_libdir}/*.a
-rm -f $RPM_BUILD_ROOT%{_libdir}/*.la
-
-%find_lang gst-plugins-base-%{majorminor}
-
-%clean
-rm -rf $RPM_BUILD_ROOT
-
-%files -f gst-plugins-base-%{majorminor}.lang
-%defattr(-, root, root)
-%doc AUTHORS COPYING README REQUIREMENTS gst-plugins-base.doap
-
-# helper programs
-%{_bindir}/gst-visualise-%{majorminor}
-%{_bindir}/gst-discoverer-%{majorminor}
-%{_mandir}/man1/gst-visualise-%{majorminor}*
-
-# libraries
-%{_libdir}/libgstaudio-%{majorminor}.so.*
-%{_libdir}/libgstcdda-%{majorminor}.so*
-%{_libdir}/libgstinterfaces-%{majorminor}.so.*
-%{_libdir}/libgstnetbuffer-%{majorminor}.so*
-%{_libdir}/libgstpbutils-%{majorminor}.so*
-%{_libdir}/libgstriff-%{majorminor}.so.*
-%{_libdir}/libgstrtp-%{majorminor}.so*
-%{_libdir}/libgsttag-%{majorminor}.so.*
-%{_libdir}/libgstvideo-%{majorminor}.so.*
-%{_libdir}/libgstfft-%{majorminor}.so.*
-%{_libdir}/libgstrtsp-%{majorminor}.so.*
-%{_libdir}/libgstsdp-%{majorminor}.so.*
-%{_libdir}/libgstapp-%{majorminor}.so.*
-
-# base plugins without external dependencies
-%{_libdir}/gstreamer-%{majorminor}/libgstadder.so
-%{_libdir}/gstreamer-%{majorminor}/libgstaudioconvert.so
-%{_libdir}/gstreamer-%{majorminor}/libgstffmpegcolorspace.so
-%{_libdir}/gstreamer-%{majorminor}/libgstdecodebin.so
-%{_libdir}/gstreamer-%{majorminor}/libgstdecodebin2.so
-%{_libdir}/gstreamer-%{majorminor}/libgstplaybin.so
-%{_libdir}/gstreamer-%{majorminor}/libgsttypefindfunctions.so
-%{_libdir}/gstreamer-%{majorminor}/libgstvideotestsrc.so
-%{_libdir}/gstreamer-%{majorminor}/libgstaudiorate.so
-%{_libdir}/gstreamer-%{majorminor}/libgstsubparse.so
-%{_libdir}/gstreamer-%{majorminor}/libgstvolume.so
-%{_libdir}/gstreamer-%{majorminor}/libgstvideorate.so
-%{_libdir}/gstreamer-%{majorminor}/libgstvideoscale.so
-%{_libdir}/gstreamer-%{majorminor}/libgsttcp.so
-%{_libdir}/gstreamer-%{majorminor}/libgstaudioresample.so
-%{_libdir}/gstreamer-%{majorminor}/libgstaudiotestsrc.so
-%{_libdir}/gstreamer-%{majorminor}/libgstgdp.so
-%{_libdir}/gstreamer-%{majorminor}/libgstapp.so
-%{_libdir}/gstreamer-%{majorminor}/libgstencodebin.so
-
-# Here are packages not in the base plugins package but not dependant
-# on an external lib
-
-# @USE_GST_V4L2_TRUE@%{_libdir}/gstreamer-%{majorminor}/libgstvideo4linux2.so
-
-# base plugins with dependencies
-%{_libdir}/gstreamer-%{majorminor}/libgstalsa.so
-%{_libdir}/gstreamer-%{majorminor}/libgsttheora.so
-%{_libdir}/gstreamer-%{majorminor}/libgstgnomevfs.so
-%{_libdir}/gstreamer-%{majorminor}/libgstvorbis.so
-%{_libdir}/gstreamer-%{majorminor}/libgstogg.so
-%{_libdir}/gstreamer-%{majorminor}/libgstximage*.so
-%{_libdir}/gstreamer-%{majorminor}/libgstxvimagesink.so
-%{_libdir}/gstreamer-%{majorminor}/libgstlibvisual.so
-%{_libdir}/gstreamer-%{majorminor}/libgstpango.so
-%{_libdir}/gstreamer-%{majorminor}/libgstcdparanoia.so
-%{_libdir}/gstreamer-%{majorminor}/libgstgio.so
-# @USE_SCHRO_TRUE@%{_libdir}/gstreamer-%{majorminor}/libgstschro.so                                                                     
-%package devel
-Summary: 	GStreamer Plugin Library Headers
-Group: 		Development/Libraries
-Requires: 	%{gstreamer}-plugins-base = %{version}
-
-%description devel
-GStreamer Plugins Base library development and header files.
-
-%files devel
-%defattr(-, root, root)
-# plugin helper library headers
-%{_includedir}/gstreamer-%{majorminor}/gst/audio/audio.h
-%{_includedir}/gstreamer-%{majorminor}/gst/audio/gstaudiofilter.h
-%{_includedir}/gstreamer-%{majorminor}/gst/audio/multichannel.h
-%{_includedir}/gstreamer-%{majorminor}/gst/floatcast/floatcast.h
-%{_includedir}/gstreamer-%{majorminor}/gst/riff/riff-ids.h
-%{_includedir}/gstreamer-%{majorminor}/gst/riff/riff-media.h
-%{_includedir}/gstreamer-%{majorminor}/gst/riff/riff-read.h
-%{_includedir}/gstreamer-%{majorminor}/gst/video/video.h
-%{_includedir}/gstreamer-%{majorminor}/gst/interfaces/colorbalance.h
-%{_includedir}/gstreamer-%{majorminor}/gst/interfaces/colorbalancechannel.h
-%{_includedir}/gstreamer-%{majorminor}/gst/interfaces/interfaces-enumtypes.h
-%{_includedir}/gstreamer-%{majorminor}/gst/interfaces/mixer.h
-%{_includedir}/gstreamer-%{majorminor}/gst/interfaces/mixeroptions.h
-%{_includedir}/gstreamer-%{majorminor}/gst/interfaces/mixertrack.h
-%{_includedir}/gstreamer-%{majorminor}/gst/interfaces/navigation.h
-%{_includedir}/gstreamer-%{majorminor}/gst/interfaces/propertyprobe.h
-%{_includedir}/gstreamer-%{majorminor}/gst/interfaces/tuner.h
-%{_includedir}/gstreamer-%{majorminor}/gst/interfaces/tunerchannel.h
-%{_includedir}/gstreamer-%{majorminor}/gst/interfaces/tunernorm.h
-%{_includedir}/gstreamer-%{majorminor}/gst/interfaces/xoverlay.h
-%{_includedir}/gstreamer-%{majorminor}/gst/audio/gstaudiosrc.h
-%{_includedir}/gstreamer-%{majorminor}/gst/audio/gstbaseaudiosrc.h
-%{_includedir}/gstreamer-%{majorminor}/gst/rtp/gstbasertpaudiopayload.h
-%{_includedir}/gstreamer-%{majorminor}/gst/rtp/gstbasertpdepayload.h
-%{_includedir}/gstreamer-%{majorminor}/gst/rtp/gstrtpbuffer.h
-%{_includedir}/gstreamer-%{majorminor}/gst/audio/gstaudioclock.h
-%{_includedir}/gstreamer-%{majorminor}/gst/audio/gstaudiosink.h
-%{_includedir}/gstreamer-%{majorminor}/gst/audio/gstbaseaudiosink.h
-%{_includedir}/gstreamer-%{majorminor}/gst/audio/gstringbuffer.h
-%{_includedir}/gstreamer-%{majorminor}/gst/tag/tag.h
-%{_includedir}/gstreamer-%{majorminor}/gst/rtp/gstbasertppayload.h
-%{_includedir}/gstreamer-%{majorminor}/gst/video/gstvideofilter.h
-%{_includedir}/gstreamer-%{majorminor}/gst/video/gstvideosink.h
-%{_includedir}/gstreamer-%{majorminor}/gst/netbuffer/gstnetbuffer.h
-%{_includedir}/gstreamer-%{majorminor}/gst/cdda/gstcddabasesrc.h
-%{_includedir}/gstreamer-%{majorminor}/gst/audio/mixerutils.h
-%{_includedir}/gstreamer-%{majorminor}/gst/interfaces/videoorientation.h
-%{_includedir}/gstreamer-%{majorminor}/gst/pbutils/descriptions.h
-%{_includedir}/gstreamer-%{majorminor}/gst/pbutils/install-plugins.h
-%{_includedir}/gstreamer-%{majorminor}/gst/pbutils/missing-plugins.h
-%{_includedir}/gstreamer-%{majorminor}/gst/pbutils/pbutils.h
-%{_includedir}/gstreamer-%{majorminor}/gst/rtp/gstrtcpbuffer.h
-%{_includedir}/gstreamer-%{majorminor}/gst/fft/gstfft.h
-%{_includedir}/gstreamer-%{majorminor}/gst/fft/gstfftf32.h
-%{_includedir}/gstreamer-%{majorminor}/gst/fft/gstfftf64.h
-%{_includedir}/gstreamer-%{majorminor}/gst/fft/gstffts16.h
-%{_includedir}/gstreamer-%{majorminor}/gst/fft/gstffts32.h
-%{_includedir}/gstreamer-%{majorminor}/gst/rtsp/gstrtsp-enumtypes.h
-%{_includedir}/gstreamer-%{majorminor}/gst/rtsp/gstrtspbase64.h
-%{_includedir}/gstreamer-%{majorminor}/gst/rtsp/gstrtspconnection.h
-%{_includedir}/gstreamer-%{majorminor}/gst/rtsp/gstrtspdefs.h
-%{_includedir}/gstreamer-%{majorminor}/gst/rtsp/gstrtspextension.h
-%{_includedir}/gstreamer-%{majorminor}/gst/rtsp/gstrtspmessage.h
-%{_includedir}/gstreamer-%{majorminor}/gst/rtsp/gstrtsprange.h
-%{_includedir}/gstreamer-%{majorminor}/gst/rtsp/gstrtsptransport.h
-%{_includedir}/gstreamer-%{majorminor}/gst/rtsp/gstrtspurl.h
-%{_includedir}/gstreamer-%{majorminor}/gst/sdp/gstsdp.h
-%{_includedir}/gstreamer-%{majorminor}/gst/sdp/gstsdpmessage.h
-%{_includedir}/gstreamer-%{majorminor}/gst/rtp/gstrtppayloads.h
-%{_includedir}/gstreamer-%{majorminor}/gst/tag/gsttagdemux.h
-%{_includedir}/gstreamer-%{majorminor}/gst/pbutils/pbutils-enumtypes.h
-%{_includedir}/gstreamer-%{majorminor}/gst/app/gstappbuffer.h
-%{_includedir}/gstreamer-%{majorminor}/gst/app/gstappsink.h
-%{_includedir}/gstreamer-%{majorminor}/gst/app/gstappsrc.h
-%{_includedir}/gstreamer-%{majorminor}/gst/audio/audio-enumtypes.h
-%{_includedir}/gstreamer-%{majorminor}/gst/video/video-enumtypes.h
-%{_includedir}/gstreamer-%{majorminor}/gst/interfaces/streamvolume.h
-%{_includedir}/gstreamer-%{majorminor}/gst/pbutils/codec-utils.h
-%{_includedir}/gstreamer-%{majorminor}/gst/pbutils/encoding-profile.h
-%{_includedir}/gstreamer-%{majorminor}/gst/pbutils/encoding-target.h
-%{_includedir}/gstreamer-%{majorminor}/gst/pbutils/gstdiscoverer.h
-%{_includedir}/gstreamer-%{majorminor}/gst/pbutils/gstpluginsbaseversion.h
-%{_includedir}/gstreamer-%{majorminor}/gst/tag/xmpwriter.h
-%{_includedir}/gstreamer-%{majorminor}/gst/audio/gstaudioiec61937.h
-%{_includedir}/gstreamer-%{majorminor}/gst/audio/gstaudiodecoder.h
-%{_includedir}/gstreamer-%{majorminor}/gst/audio/gstaudioencoder.h
-%{_includedir}/gstreamer-%{majorminor}/gst/tag/gsttagmux.h
-%{_includedir}/gstreamer-%{majorminor}/gst/video/video-overlay-composition.h
-
-%{_libdir}/libgstfft-%{majorminor}.so
-%{_libdir}/libgstrtsp-%{majorminor}.so
-%{_libdir}/libgstsdp-%{majorminor}.so
-%{_libdir}/libgstaudio-%{majorminor}.so
-%{_libdir}/libgstriff-%{majorminor}.so
-%{_libdir}/libgsttag-%{majorminor}.so
-%{_libdir}/libgstvideo-%{majorminor}.so
-%{_libdir}/libgstrtp-%{majorminor}.so
-%{_libdir}/libgstinterfaces-%{majorminor}.so
-%{_libdir}/libgstnetbuffer-%{majorminor}.so
-%{_libdir}/libgstpbutils-%{majorminor}.so
-%{_libdir}/libgstcdda-%{majorminor}.so
-%{_libdir}/libgstapp-%{majorminor}.so
-
-# pkg-config files
-%{_libdir}/pkgconfig/gstreamer-plugins-base-%{majorminor}.pc
-%{_libdir}/pkgconfig/gstreamer-audio-%{majorminor}.pc
-%{_libdir}/pkgconfig/gstreamer-cdda-%{majorminor}.pc
-%{_libdir}/pkgconfig/gstreamer-fft-%{majorminor}.pc
-%{_libdir}/pkgconfig/gstreamer-floatcast-%{majorminor}.pc
-%{_libdir}/pkgconfig/gstreamer-interfaces-%{majorminor}.pc
-%{_libdir}/pkgconfig/gstreamer-netbuffer-%{majorminor}.pc
-%{_libdir}/pkgconfig/gstreamer-pbutils-%{majorminor}.pc
-%{_libdir}/pkgconfig/gstreamer-riff-%{majorminor}.pc
-%{_libdir}/pkgconfig/gstreamer-rtp-%{majorminor}.pc
-%{_libdir}/pkgconfig/gstreamer-rtsp-%{majorminor}.pc
-%{_libdir}/pkgconfig/gstreamer-sdp-%{majorminor}.pc
-%{_libdir}/pkgconfig/gstreamer-tag-%{majorminor}.pc
-%{_libdir}/pkgconfig/gstreamer-video-%{majorminor}.pc
-%{_libdir}/pkgconfig/gstreamer-app-%{majorminor}.pc
-
-%{_libdir}/girepository-1.0/GstApp-0.10.typelib
-%{_libdir}/girepository-1.0/GstAudio-0.10.typelib
-%{_libdir}/girepository-1.0/GstFft-0.10.typelib
-%{_libdir}/girepository-1.0/GstInterfaces-0.10.typelib
-%{_libdir}/girepository-1.0/GstNetbuffer-0.10.typelib
-%{_libdir}/girepository-1.0/GstPbutils-0.10.typelib
-%{_libdir}/girepository-1.0/GstRiff-0.10.typelib
-%{_libdir}/girepository-1.0/GstRtp-0.10.typelib
-%{_libdir}/girepository-1.0/GstRtsp-0.10.typelib
-%{_libdir}/girepository-1.0/GstSdp-0.10.typelib
-%{_libdir}/girepository-1.0/GstTag-0.10.typelib
-%{_libdir}/girepository-1.0/GstVideo-0.10.typelib
-%{_datadir}/gir-1.0/GstApp-0.10.gir
-%{_datadir}/gir-1.0/GstAudio-0.10.gir
-%{_datadir}/gir-1.0/GstFft-0.10.gir
-%{_datadir}/gir-1.0/GstInterfaces-0.10.gir
-%{_datadir}/gir-1.0/GstNetbuffer-0.10.gir
-%{_datadir}/gir-1.0/GstPbutils-0.10.gir
-%{_datadir}/gir-1.0/GstRiff-0.10.gir
-%{_datadir}/gir-1.0/GstRtp-0.10.gir
-%{_datadir}/gir-1.0/GstRtsp-0.10.gir
-%{_datadir}/gir-1.0/GstSdp-0.10.gir
-%{_datadir}/gir-1.0/GstTag-0.10.gir
-%{_datadir}/gir-1.0/GstVideo-0.10.gir
-
-# gtk-doc documentation
-%doc %{_datadir}/gtk-doc/html/gst-plugins-base-libs-%{majorminor}
-%doc %{_datadir}/gtk-doc/html/gst-plugins-base-plugins-%{majorminor}
-%doc %{_datadir}/gst-plugins-base/license-translations.dict
-
-%changelog
-* Fri Dec 15 2006 Thomas Vander Stichele <thomas at apestaart dot org>
-- add doap file
-- cleanups
-
-* Fri Sep 02 2005 Thomas Vander Stichele <thomas at apestaart dot org>
-- clean up a little
-
-* Fri May 6 2005 Christian Schaller <christian at fluendo dot com>
-- Added libgstaudiorate and libgstsubparse to spec file
-
-* Thu May 5 2005 Christian Schaller <christian at fluendo dot com>
-- first attempt at spec file for gst-plugins-base
diff --git a/gst/Makefile.in b/gst/Makefile.in
index c852ed3..86d0833 100644
--- a/gst/Makefile.in
+++ b/gst/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -20,6 +19,23 @@
 # descending into all subdirectories a second time, but only after the first
 # (parallel) run has finished, so it should go right through the second time.
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -38,6 +54,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
 	$(top_srcdir)/common/parallel-subdirs.mak
 subdir = gst
@@ -85,12 +102,18 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
 RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
@@ -100,6 +123,11 @@ RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
@@ -421,7 +449,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -469,12 +501,12 @@ clean-libtool:
 	-rm -rf .libs _libs
 
 # This directory's subdirectories are mostly independent; you can cd
-# into them and run `make' without going through this Makefile.
-# To change the values of `make' variables: instead of editing Makefiles,
-# (1) if the variable is set in `config.status', edit `config.status'
-#     (which will cause the Makefiles to be regenerated when you run `make');
-# (2) otherwise, pass the desired values on the `make' command line.
-$(RECURSIVE_TARGETS):
+# into them and run 'make' without going through this Makefile.
+# To change the values of 'make' variables: instead of editing Makefiles,
+# (1) if the variable is set in 'config.status', edit 'config.status'
+#     (which will cause the Makefiles to be regenerated when you run 'make');
+# (2) otherwise, pass the desired values on the 'make' command line.
+$(RECURSIVE_TARGETS) $(RECURSIVE_CLEAN_TARGETS):
 	@fail= failcom='exit 1'; \
 	for f in x $$MAKEFLAGS; do \
 	  case $$f in \
@@ -484,7 +516,11 @@ $(RECURSIVE_TARGETS):
 	done; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
-	list='$(SUBDIRS)'; for subdir in $$list; do \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	for subdir in $$list; do \
 	  echo "Making $$target in $$subdir"; \
 	  if test "$$subdir" = "."; then \
 	    dot_seen=yes; \
@@ -498,37 +534,6 @@ $(RECURSIVE_TARGETS):
 	if test "$$dot_seen" = "no"; then \
 	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
 	fi; test -z "$$fail"
-
-$(RECURSIVE_CLEAN_TARGETS):
-	@fail= failcom='exit 1'; \
-	for f in x $$MAKEFLAGS; do \
-	  case $$f in \
-	    *=* | --[!k]*);; \
-	    *k*) failcom='fail=yes';; \
-	  esac; \
-	done; \
-	dot_seen=no; \
-	case "$@" in \
-	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
-	  *) list='$(SUBDIRS)' ;; \
-	esac; \
-	rev=''; for subdir in $$list; do \
-	  if test "$$subdir" = "."; then :; else \
-	    rev="$$subdir $$rev"; \
-	  fi; \
-	done; \
-	rev="$$rev ."; \
-	target=`echo $@ | sed s/-recursive//`; \
-	for subdir in $$rev; do \
-	  echo "Making $$target in $$subdir"; \
-	  if test "$$subdir" = "."; then \
-	    local_target="$$target-am"; \
-	  else \
-	    local_target="$$target"; \
-	  fi; \
-	  ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
-	  || eval $$failcom; \
-	done && test -z "$$fail"
 tags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
@@ -537,6 +542,10 @@ ctags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
 	done
+cscopelist-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) cscopelist); \
+	done
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -600,6 +609,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist: cscopelist-recursive $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -635,13 +658,10 @@ distdir: $(DISTFILES)
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -762,22 +782,23 @@ ps-am:
 
 uninstall-am:
 
-.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) ctags-recursive \
-	install-am install-strip tags-recursive
+.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) \
+	cscopelist-recursive ctags-recursive install-am install-strip \
+	tags-recursive
 
 .PHONY: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) CTAGS GTAGS \
 	all all-am check check-am clean clean-generic clean-libtool \
-	ctags ctags-recursive distclean distclean-generic \
-	distclean-libtool distclean-tags distdir dvi dvi-am html \
-	html-am info info-am install install-am install-data \
-	install-data-am install-dvi install-dvi-am install-exec \
-	install-exec-am install-html install-html-am install-info \
-	install-info-am install-man install-pdf install-pdf-am \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs installdirs-am maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-generic \
-	mostlyclean-libtool pdf pdf-am ps ps-am tags tags-recursive \
-	uninstall uninstall-am
+	cscopelist cscopelist-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-libtool distclean-tags \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-dvi \
+	install-dvi-am install-exec install-exec-am install-html \
+	install-html-am install-info install-info-am install-man \
+	install-pdf install-pdf-am install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	mostlyclean mostlyclean-generic mostlyclean-libtool pdf pdf-am \
+	ps ps-am tags tags-recursive uninstall uninstall-am
 
 
 .PHONY: independent-subdirs $(SUBDIRS)
diff --git a/gst/adder/Makefile.in b/gst/adder/Makefile.in
index 60daf6c..cd112c5 100644
--- a/gst/adder/Makefile.in
+++ b/gst/adder/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -39,6 +38,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -57,8 +73,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak
+	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak \
+	$(top_srcdir)/depcomp
 subdir = gst/adder
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
@@ -145,10 +163,23 @@ libgstadder_la_OBJECTS = $(am_libgstadder_la_OBJECTS) \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstadder_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstadder_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstadder_la_CFLAGS) $(CFLAGS) \
 	$(libgstadder_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -161,22 +192,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstadder_la_SOURCES) $(nodist_libgstadder_la_SOURCES)
 DIST_SOURCES = $(libgstadder_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -469,7 +501,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -532,7 +568,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -540,6 +575,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -555,12 +592,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstadder.la: $(libgstadder_la_OBJECTS) $(libgstadder_la_DEPENDENCIES) $(EXTRA_libgstadder_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstadder_la_LINK) -rpath $(plugindir) $(libgstadder_la_OBJECTS) $(libgstadder_la_LIBADD) $(LIBS)
 
@@ -663,6 +702,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -813,8 +866,8 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-local clean-pluginLTLIBRARIES ctags \
-	dist-hook distclean distclean-compile distclean-generic \
+	clean-libtool clean-local clean-pluginLTLIBRARIES cscopelist \
+	ctags dist-hook distclean distclean-compile distclean-generic \
 	distclean-libtool distclean-tags distdir dvi dvi-am html \
 	html-am info info-am install install-am install-data \
 	install-data-am install-dvi install-dvi-am install-exec \
diff --git a/gst/adder/gstadder.c b/gst/adder/gstadder.c
index 9f6895f..8910d6c 100644
--- a/gst/adder/gstadder.c
+++ b/gst/adder/gstadder.c
@@ -43,6 +43,11 @@
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
+
+/* FIXME 0.11: suppress warnings for deprecated API such as GStaticRecMutex
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #include "gstadder.h"
 #include <gst/audio/audio.h>
 #include <string.h>             /* strcmp */
@@ -127,7 +132,8 @@ static void gst_adder_get_property (GObject * object, guint prop_id,
 static gboolean gst_adder_setcaps (GstPad * pad, GstCaps * caps);
 static gboolean gst_adder_query (GstPad * pad, GstQuery * query);
 static gboolean gst_adder_src_event (GstPad * pad, GstEvent * event);
-static gboolean gst_adder_sink_event (GstPad * pad, GstEvent * event);
+static gboolean gst_adder_sink_event (GstCollectPads2 * pads,
+    GstCollectData2 * pad, GstEvent * event, gpointer user_data);
 
 static GstPad *gst_adder_request_new_pad (GstElement * element,
     GstPadTemplate * temp, const gchar * unused);
@@ -136,9 +142,10 @@ static void gst_adder_release_pad (GstElement * element, GstPad * pad);
 static GstStateChangeReturn gst_adder_change_state (GstElement * element,
     GstStateChange transition);
 
-static GstBuffer *gst_adder_do_clip (GstCollectPads * pads,
-    GstCollectData * data, GstBuffer * buffer, gpointer user_data);
-static GstFlowReturn gst_adder_collected (GstCollectPads * pads,
+static GstFlowReturn gst_adder_do_clip (GstCollectPads2 * pads,
+    GstCollectData2 * data, GstBuffer * buffer, GstBuffer ** out,
+    gpointer user_data);
+static GstFlowReturn gst_adder_collected (GstCollectPads2 * pads,
     gpointer user_data);
 
 /* non-clipping versions (for float) */
@@ -537,6 +544,8 @@ gst_adder_query (GstPad * pad, GstQuery * query)
   return res;
 }
 
+/* event handling */
+
 typedef struct
 {
   GstEvent *event;
@@ -627,8 +636,8 @@ gst_adder_src_event (GstPad * pad, GstEvent * event)
 
   adder = GST_ADDER (gst_pad_get_parent (pad));
 
-  GST_DEBUG_OBJECT (pad, "Got %s event on src pad",
-      GST_EVENT_TYPE_NAME (event));
+  GST_DEBUG_OBJECT (pad, "Got %s event on src pad from %s",
+      GST_EVENT_TYPE_NAME (event), GST_OBJECT_NAME (GST_EVENT_SRC (event)));
 
   switch (GST_EVENT_TYPE (event)) {
     case GST_EVENT_SEEK:
@@ -659,12 +668,14 @@ gst_adder_src_event (GstPad * pad, GstEvent * event)
 
       /* check if we are flushing */
       if (flush) {
-        /* make sure we accept nothing anymore and return WRONG_STATE */
-        gst_collect_pads_set_flushing (adder->collect, TRUE);
-
         /* flushing seek, start flush downstream, the flush will be done
-         * when all pads received a FLUSH_STOP. */
+         * when all pads received a FLUSH_STOP.
+         * Make sure we accept nothing anymore and return WRONG_STATE.
+         * We send a flush-start before, to ensure no streaming is done
+         * as we need to take the stream lock.
+         */
         gst_pad_push_event (adder->srcpad, gst_event_new_flush_start ());
+        gst_collect_pads2_set_flushing (adder->collect, TRUE);
 
         /* We can't send FLUSH_STOP here since upstream could start pushing data
          * after we unlock adder->collect.
@@ -679,7 +690,7 @@ gst_adder_src_event (GstPad * pad, GstEvent * event)
       /* now wait for the collected to be finished and mark a new
        * segment. After we have the lock, no collect function is running and no
        * new collect function will be called for as long as we're flushing. */
-      GST_OBJECT_LOCK (adder->collect);
+      GST_COLLECT_PADS2_STREAM_LOCK (adder->collect);
       if (curtype == GST_SEEK_TYPE_SET)
         adder->segment_start = cur;
       else
@@ -691,9 +702,9 @@ gst_adder_src_event (GstPad * pad, GstEvent * event)
       if (flush) {
         /* Yes, we need to call _set_flushing again *WHEN* the streaming threads
          * have stopped so that the cookie gets properly updated. */
-        gst_collect_pads_set_flushing (adder->collect, TRUE);
+        gst_collect_pads2_set_flushing (adder->collect, TRUE);
       }
-      GST_OBJECT_UNLOCK (adder->collect);
+      GST_COLLECT_PADS2_STREAM_UNLOCK (adder->collect);
       GST_DEBUG_OBJECT (adder, "forwarding seek event: %" GST_PTR_FORMAT,
           event);
 
@@ -735,42 +746,47 @@ done:
 }
 
 static gboolean
-gst_adder_sink_event (GstPad * pad, GstEvent * event)
+gst_adder_sink_event (GstCollectPads2 * pads, GstCollectData2 * pad,
+    GstEvent * event, gpointer user_data)
 {
-  GstAdder *adder;
-  gboolean ret = TRUE;
+  GstAdder *adder = GST_ADDER (user_data);
+  gboolean res = FALSE;
 
-  adder = GST_ADDER (gst_pad_get_parent (pad));
-
-  GST_DEBUG_OBJECT (pad, "Got %s event on sink pad",
-      GST_EVENT_TYPE_NAME (event));
+  GST_DEBUG_OBJECT (pad->pad, "Got %s event on sink pad from %s",
+      GST_EVENT_TYPE_NAME (event), GST_OBJECT_NAME (GST_EVENT_SRC (event)));
 
   switch (GST_EVENT_TYPE (event)) {
+    case GST_EVENT_FLUSH_START:
+      /* drop flush start events, as we forwarded one already when handing the
+       * flushing seek on the sink pad */
+      gst_event_unref (event);
+      res = TRUE;
+      break;
     case GST_EVENT_FLUSH_STOP:
-      /* we received a flush-stop. The collect_event function will push the
-       * event past our element. We simply forward all flush-stop events, even
-       * when no flush-stop was pending, this is required because collectpads
-       * does not provide an API to handle-but-not-forward the flush-stop.
-       * We unset the pending flush-stop flag so that we don't send anymore
-       * flush-stop from the collect function later.
+      /* we received a flush-stop. We will only forward it when
+       * flush_stop_pending is set, and we will unset it then.
        */
-      GST_OBJECT_LOCK (adder->collect);
-      g_atomic_int_set (&adder->new_segment_pending, TRUE);
-      g_atomic_int_set (&adder->flush_stop_pending, FALSE);
+      if (g_atomic_int_compare_and_exchange (&adder->flush_stop_pending,
+              TRUE, FALSE)) {
+        g_atomic_int_set (&adder->new_segment_pending, TRUE);
+        GST_DEBUG_OBJECT (pad->pad, "forwarding flush stop");
+      } else {
+        gst_event_unref (event);
+        res = TRUE;
+        GST_DEBUG_OBJECT (pad->pad, "eating flush stop");
+      }
       /* Clear pending tags */
       if (adder->pending_events) {
         g_list_foreach (adder->pending_events, (GFunc) gst_event_unref, NULL);
         g_list_free (adder->pending_events);
         adder->pending_events = NULL;
       }
-      GST_OBJECT_UNLOCK (adder->collect);
       break;
     case GST_EVENT_TAG:
-      GST_OBJECT_LOCK (adder->collect);
       /* collect tags here so we can push them out when we collect data */
       adder->pending_events = g_list_append (adder->pending_events, event);
-      GST_OBJECT_UNLOCK (adder->collect);
-      goto beach;
+      res = TRUE;
+      break;
     case GST_EVENT_NEWSEGMENT:
       if (g_atomic_int_compare_and_exchange (&adder->wait_for_new_segment,
               TRUE, FALSE)) {
@@ -778,17 +794,13 @@ gst_adder_sink_event (GstPad * pad, GstEvent * event)
          * see FIXME in gst_adder_collected() */
         g_atomic_int_set (&adder->new_segment_pending, TRUE);
       }
+      gst_event_unref (event);
+      res = TRUE;
       break;
     default:
       break;
   }
-
-  /* now GstCollectPads can take care of the rest, e.g. EOS */
-  ret = adder->collect_event (pad, event);
-
-beach:
-  gst_object_unref (adder);
-  return ret;
+  return res;
 }
 
 static void
@@ -860,11 +872,13 @@ gst_adder_init (GstAdder * adder, GstAdderClass * klass)
   adder->filter_caps = NULL;
 
   /* keep track of the sinkpads requested */
-  adder->collect = gst_collect_pads_new ();
-  gst_collect_pads_set_function (adder->collect,
+  adder->collect = gst_collect_pads2_new ();
+  gst_collect_pads2_set_function (adder->collect,
       GST_DEBUG_FUNCPTR (gst_adder_collected), adder);
-  gst_collect_pads_set_clip_function (adder->collect,
+  gst_collect_pads2_set_clip_function (adder->collect,
       GST_DEBUG_FUNCPTR (gst_adder_do_clip), adder);
+  gst_collect_pads2_set_event_function (adder->collect,
+      GST_DEBUG_FUNCPTR (gst_adder_sink_event), adder);
 }
 
 static void
@@ -968,13 +982,7 @@ gst_adder_request_new_pad (GstElement * element, GstPadTemplate * templ,
   gst_pad_set_getcaps_function (newpad,
       GST_DEBUG_FUNCPTR (gst_adder_sink_getcaps));
   gst_pad_set_setcaps_function (newpad, GST_DEBUG_FUNCPTR (gst_adder_setcaps));
-  gst_collect_pads_add_pad (adder->collect, newpad, sizeof (GstCollectData));
-
-  /* FIXME: hacked way to override/extend the event function of
-   * GstCollectPads; because it sets its own event function giving the
-   * element no access to events */
-  adder->collect_event = (GstPadEventFunction) GST_PAD_EVENTFUNC (newpad);
-  gst_pad_set_event_function (newpad, GST_DEBUG_FUNCPTR (gst_adder_sink_event));
+  gst_collect_pads2_add_pad (adder->collect, newpad, sizeof (GstCollectData2));
 
   /* takes ownership of the pad */
   if (!gst_element_add_pad (GST_ELEMENT (adder), newpad))
@@ -991,7 +999,7 @@ not_sink:
 could_not_add:
   {
     GST_DEBUG_OBJECT (adder, "could not add pad");
-    gst_collect_pads_remove_pad (adder->collect, newpad);
+    gst_collect_pads2_remove_pad (adder->collect, newpad);
     gst_object_unref (newpad);
     return NULL;
   }
@@ -1006,13 +1014,13 @@ gst_adder_release_pad (GstElement * element, GstPad * pad)
 
   GST_DEBUG_OBJECT (adder, "release pad %s:%s", GST_DEBUG_PAD_NAME (pad));
 
-  gst_collect_pads_remove_pad (adder->collect, pad);
+  gst_collect_pads2_remove_pad (adder->collect, pad);
   gst_element_remove_pad (element, pad);
 }
 
-static GstBuffer *
-gst_adder_do_clip (GstCollectPads * pads, GstCollectData * data,
-    GstBuffer * buffer, gpointer user_data)
+static GstFlowReturn
+gst_adder_do_clip (GstCollectPads2 * pads, GstCollectData2 * data,
+    GstBuffer * buffer, GstBuffer ** out, gpointer user_data)
 {
   GstAdder *adder = GST_ADDER (user_data);
 
@@ -1025,11 +1033,12 @@ gst_adder_do_clip (GstCollectPads * pads, GstCollectData * data,
         adder->bps);
   }
 
-  return buffer;
+  *out = buffer;
+  return GST_FLOW_OK;
 }
 
 static GstFlowReturn
-gst_adder_collected (GstCollectPads * pads, gpointer user_data)
+gst_adder_collected (GstCollectPads2 * pads, gpointer user_data)
 {
   /*
    * combine streams by adding data values
@@ -1070,7 +1079,7 @@ gst_adder_collected (GstCollectPads * pads, gpointer user_data)
 
   /* get available bytes for reading, this can be 0 which could mean empty
    * buffers or EOS, which we will catch when we loop over the pads. */
-  outsize = gst_collect_pads_available (pads);
+  outsize = gst_collect_pads2_available (pads);
   /* can only happen when no pads to collect or all EOS */
   if (outsize == 0)
     goto eos;
@@ -1080,18 +1089,18 @@ gst_adder_collected (GstCollectPads * pads, gpointer user_data)
       outsize, adder->bps);
 
   for (collected = pads->data; collected; collected = next) {
-    GstCollectData *collect_data;
+    GstCollectData2 *collect_data;
     GstBuffer *inbuf;
     gboolean is_gap;
 
     /* take next to see if this is the last collectdata */
     next = g_slist_next (collected);
 
-    collect_data = (GstCollectData *) collected->data;
+    collect_data = (GstCollectData2 *) collected->data;
 
     /* get a buffer of size bytes, if we get a buffer, it is at least outsize
      * bytes big. */
-    inbuf = gst_collect_pads_take_buffer (pads, collect_data, outsize);
+    inbuf = gst_collect_pads2_take_buffer (pads, collect_data, outsize);
     /* NULL means EOS or an empty buffer so we still need to flush in
      * case of an empty buffer. */
     if (inbuf == NULL) {
@@ -1192,7 +1201,7 @@ gst_adder_collected (GstCollectPads * pads, gpointer user_data)
 
     if (event) {
       if (!gst_pad_push_event (adder->srcpad, event)) {
-        GST_WARNING_OBJECT (adder->srcpad, "Sending event failed");
+        GST_WARNING_OBJECT (adder->srcpad, "Sending new segment event failed");
       }
     } else {
       GST_WARNING_OBJECT (adder->srcpad, "Creating new segment event for "
@@ -1266,6 +1275,7 @@ eos:
   }
 }
 
+
 static GstStateChangeReturn
 gst_adder_change_state (GstElement * element, GstStateChange transition)
 {
@@ -1287,14 +1297,14 @@ gst_adder_change_state (GstElement * element, GstStateChange transition)
       adder->segment_end = GST_CLOCK_TIME_NONE;
       adder->segment_rate = 1.0;
       gst_segment_init (&adder->segment, GST_FORMAT_UNDEFINED);
-      gst_collect_pads_start (adder->collect);
+      gst_collect_pads2_start (adder->collect);
       break;
     case GST_STATE_CHANGE_PAUSED_TO_PLAYING:
       break;
     case GST_STATE_CHANGE_PAUSED_TO_READY:
-      /* need to unblock the collectpads before calling the
+      /* need to unblock the collectpads2 before calling the
        * parent change_state so that streaming can finish */
-      gst_collect_pads_stop (adder->collect);
+      gst_collect_pads2_stop (adder->collect);
       break;
     default:
       break;
@@ -1310,7 +1320,6 @@ gst_adder_change_state (GstElement * element, GstStateChange transition)
   return ret;
 }
 
-
 static gboolean
 plugin_init (GstPlugin * plugin)
 {
diff --git a/gst/adder/gstadder.h b/gst/adder/gstadder.h
index 7fbdde6..3895118 100644
--- a/gst/adder/gstadder.h
+++ b/gst/adder/gstadder.h
@@ -24,7 +24,7 @@
 #define __GST_ADDER_H__
 
 #include <gst/gst.h>
-#include <gst/base/gstcollectpads.h>
+#include <gst/base/gstcollectpads2.h>
 
 G_BEGIN_DECLS
 
@@ -56,7 +56,7 @@ struct _GstAdder {
   GstElement      element;
 
   GstPad         *srcpad;
-  GstCollectPads *collect;
+  GstCollectPads2 *collect;
   /* pad counter, used for creating unique request pads */
   gint            padcount;
 
diff --git a/gst/app/Makefile.in b/gst/app/Makefile.in
index cf6f35e..c1dd27f 100644
--- a/gst/app/Makefile.in
+++ b/gst/app/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,8 +50,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/app
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -117,10 +135,23 @@ libgstapp_la_OBJECTS = $(am_libgstapp_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstapp_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstapp_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstapp_la_CFLAGS) $(CFLAGS) \
 	$(libgstapp_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -133,22 +164,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstapp_la_SOURCES)
 DIST_SOURCES = $(libgstapp_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -440,7 +472,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -486,7 +522,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -494,6 +529,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -509,12 +546,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstapp.la: $(libgstapp_la_OBJECTS) $(libgstapp_la_DEPENDENCIES) $(EXTRA_libgstapp_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstapp_la_LINK) -rpath $(plugindir) $(libgstapp_la_OBJECTS) $(libgstapp_la_LIBADD) $(LIBS)
 
@@ -609,6 +648,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -753,18 +806,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/audioconvert/Makefile.in b/gst/audioconvert/Makefile.in
index f5efb0e..64c80e1 100644
--- a/gst/audioconvert/Makefile.in
+++ b/gst/audioconvert/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -39,6 +38,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -57,8 +73,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak
+	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak \
+	$(top_srcdir)/depcomp
 subdir = gst/audioconvert
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
@@ -150,10 +168,23 @@ libgstaudioconvert_la_OBJECTS = $(am_libgstaudioconvert_la_OBJECTS) \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstaudioconvert_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstaudioconvert_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstaudioconvert_la_CFLAGS) $(CFLAGS) \
 	$(libgstaudioconvert_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -166,23 +197,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstaudioconvert_la_SOURCES) \
 	$(nodist_libgstaudioconvert_la_SOURCES)
 DIST_SOURCES = $(libgstaudioconvert_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -475,7 +507,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -551,7 +587,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -559,6 +594,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -574,12 +611,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstaudioconvert.la: $(libgstaudioconvert_la_OBJECTS) $(libgstaudioconvert_la_DEPENDENCIES) $(EXTRA_libgstaudioconvert_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstaudioconvert_la_LINK) -rpath $(plugindir) $(libgstaudioconvert_la_OBJECTS) $(libgstaudioconvert_la_LIBADD) $(LIBS)
 
@@ -714,6 +753,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -864,8 +917,8 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-local clean-pluginLTLIBRARIES ctags \
-	dist-hook distclean distclean-compile distclean-generic \
+	clean-libtool clean-local clean-pluginLTLIBRARIES cscopelist \
+	ctags dist-hook distclean distclean-compile distclean-generic \
 	distclean-libtool distclean-tags distdir dvi dvi-am html \
 	html-am info info-am install install-am install-data \
 	install-data-am install-dvi install-dvi-am install-exec \
diff --git a/gst/audiorate/Makefile.in b/gst/audiorate/Makefile.in
index cae6f42..3047916 100644
--- a/gst/audiorate/Makefile.in
+++ b/gst/audiorate/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/audiorate
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -118,10 +135,23 @@ libgstaudiorate_la_OBJECTS = $(am_libgstaudiorate_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstaudiorate_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstaudiorate_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstaudiorate_la_CFLAGS) $(CFLAGS) \
 	$(libgstaudiorate_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -134,22 +164,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstaudiorate_la_SOURCES)
 DIST_SOURCES = $(libgstaudiorate_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -442,7 +473,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -489,7 +524,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -497,6 +531,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -512,12 +548,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstaudiorate.la: $(libgstaudiorate_la_OBJECTS) $(libgstaudiorate_la_DEPENDENCIES) $(EXTRA_libgstaudiorate_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstaudiorate_la_LINK) -rpath $(plugindir) $(libgstaudiorate_la_OBJECTS) $(libgstaudiorate_la_LIBADD) $(LIBS)
 
@@ -612,6 +650,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -756,18 +808,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/audioresample/Makefile.in b/gst/audioresample/Makefile.in
index b4a2979..f665c6c 100644
--- a/gst/audioresample/Makefile.in
+++ b/gst/audioresample/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/audioresample
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -124,10 +141,23 @@ libgstaudioresample_la_OBJECTS = $(am_libgstaudioresample_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstaudioresample_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstaudioresample_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstaudioresample_la_CFLAGS) $(CFLAGS) \
 	$(libgstaudioresample_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -140,22 +170,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstaudioresample_la_SOURCES)
 DIST_SOURCES = $(libgstaudioresample_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -448,7 +479,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -526,7 +561,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -534,6 +568,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -549,12 +585,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstaudioresample.la: $(libgstaudioresample_la_OBJECTS) $(libgstaudioresample_la_DEPENDENCIES) $(EXTRA_libgstaudioresample_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstaudioresample_la_LINK) -rpath $(plugindir) $(libgstaudioresample_la_OBJECTS) $(libgstaudioresample_la_LIBADD) $(LIBS)
 
@@ -673,6 +711,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -817,18 +869,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/audiotestsrc/Makefile.in b/gst/audiotestsrc/Makefile.in
index de0f757..1f58cca 100644
--- a/gst/audiotestsrc/Makefile.in
+++ b/gst/audiotestsrc/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/audiotestsrc
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -121,10 +138,23 @@ libgstaudiotestsrc_la_OBJECTS = $(am_libgstaudiotestsrc_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstaudiotestsrc_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstaudiotestsrc_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstaudiotestsrc_la_CFLAGS) $(CFLAGS) \
 	$(libgstaudiotestsrc_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -137,22 +167,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstaudiotestsrc_la_SOURCES)
 DIST_SOURCES = $(libgstaudiotestsrc_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -445,7 +476,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -492,7 +527,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -500,6 +534,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -515,12 +551,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstaudiotestsrc.la: $(libgstaudiotestsrc_la_OBJECTS) $(libgstaudiotestsrc_la_DEPENDENCIES) $(EXTRA_libgstaudiotestsrc_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstaudiotestsrc_la_LINK) -rpath $(plugindir) $(libgstaudiotestsrc_la_OBJECTS) $(libgstaudiotestsrc_la_LIBADD) $(LIBS)
 
@@ -615,6 +653,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -759,18 +811,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/encoding/Makefile.in b/gst/encoding/Makefile.in
index 23269c7..f5d8653 100644
--- a/gst/encoding/Makefile.in
+++ b/gst/encoding/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -25,6 +24,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -43,8 +59,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/gst-glib-gen.mak
+	$(srcdir)/Makefile.in $(top_srcdir)/common/gst-glib-gen.mak \
+	$(top_srcdir)/depcomp
 subdir = gst/encoding
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
@@ -133,10 +151,23 @@ libgstencodebin_la_OBJECTS = $(am_libgstencodebin_la_OBJECTS) \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstencodebin_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstencodebin_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstencodebin_la_CFLAGS) $(CFLAGS) \
 	$(libgstencodebin_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -149,23 +180,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstencodebin_la_SOURCES) \
 	$(nodist_libgstencodebin_la_SOURCES)
 DIST_SOURCES = $(libgstencodebin_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -458,7 +490,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -532,7 +568,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -540,6 +575,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -555,12 +592,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstencodebin.la: $(libgstencodebin_la_OBJECTS) $(libgstencodebin_la_DEPENDENCIES) $(EXTRA_libgstencodebin_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstencodebin_la_LINK) -rpath $(plugindir) $(libgstencodebin_la_OBJECTS) $(libgstencodebin_la_LIBADD) $(LIBS)
 
@@ -687,6 +726,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -835,18 +888,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # these are all the rules generating the relevant files
diff --git a/gst/encoding/gstencodebin.c b/gst/encoding/gstencodebin.c
index 17610cb..66b4c06 100644
--- a/gst/encoding/gstencodebin.c
+++ b/gst/encoding/gstencodebin.c
@@ -500,6 +500,7 @@ gst_encode_bin_init (GstEncodeBin * encode_bin)
   tmpl = gst_static_pad_template_get (&muxer_src_template);
   encode_bin->srcpad = gst_ghost_pad_new_no_target_from_template ("src", tmpl);
   gst_object_unref (tmpl);
+  gst_pad_set_active (encode_bin->srcpad, TRUE);
   gst_element_add_pad (GST_ELEMENT_CAST (encode_bin), encode_bin->srcpad);
 }
 
@@ -1682,6 +1683,7 @@ create_elements_and_pads (GstEncodeBin * ebin)
           goto stream_error;
       }
     }
+    gst_element_sync_state_with_parent (muxer);
   } else {
     if (G_UNLIKELY (_create_stream_group (ebin, ebin->profile, NULL,
                 NULL) == NULL))
diff --git a/gst/ffmpegcolorspace/Makefile.in b/gst/ffmpegcolorspace/Makefile.in
index 02c25ad..eb9888c 100644
--- a/gst/ffmpegcolorspace/Makefile.in
+++ b/gst/ffmpegcolorspace/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/ffmpegcolorspace
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -126,11 +143,24 @@ libgstffmpegcolorspace_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstffmpegcolorspace_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstffmpegcolorspace_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstffmpegcolorspace_la_CFLAGS) \
 	$(CFLAGS) $(libgstffmpegcolorspace_la_LDFLAGS) $(LDFLAGS) -o \
 	$@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -143,22 +173,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstffmpegcolorspace_la_SOURCES)
 DIST_SOURCES = $(libgstffmpegcolorspace_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -451,7 +482,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -514,7 +549,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -522,6 +556,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -537,12 +573,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstffmpegcolorspace.la: $(libgstffmpegcolorspace_la_OBJECTS) $(libgstffmpegcolorspace_la_DEPENDENCIES) $(EXTRA_libgstffmpegcolorspace_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstffmpegcolorspace_la_LINK) -rpath $(plugindir) $(libgstffmpegcolorspace_la_OBJECTS) $(libgstffmpegcolorspace_la_LIBADD) $(LIBS)
 
@@ -677,6 +715,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -821,18 +873,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/ffmpegcolorspace/avcodec.h b/gst/ffmpegcolorspace/avcodec.h
index 6067aed..ebfaa2d 100644
--- a/gst/ffmpegcolorspace/avcodec.h
+++ b/gst/ffmpegcolorspace/avcodec.h
@@ -94,6 +94,12 @@ enum PixelFormat {
 
     PIX_FMT_AYUV4444,  ///< Packed pixel, A0 Y0 Cb Cr
     PIX_FMT_YUVA420P,   ///< Planar YUV 4:4:2:0 (1 Cr & Cb sample per 2x2 Y & A samples) (A420)
+    PIX_FMT_YUV420P10BE,///< planar YUV 4:2:0, 15bpp, (1 Cr & Cb sample per 2x2 Y samples), big-endian
+    PIX_FMT_YUV420P10LE,///< planar YUV 4:2:0, 15bpp, (1 Cr & Cb sample per 2x2 Y samples), little-endian
+    PIX_FMT_YUV422P10BE,///< planar YUV 4:2:2, 20bpp, (1 Cr & Cb sample per 2x1 Y samples), big-endian
+    PIX_FMT_YUV422P10LE,///< planar YUV 4:2:2, 20bpp, (1 Cr & Cb sample per 2x1 Y samples), little-endian
+    PIX_FMT_YUV444P10BE,///< planar YUV 4:4:4, 30bpp, (1 Cr & Cb sample per 1x1 Y samples), big-endian
+    PIX_FMT_YUV444P10LE,///< planar YUV 4:4:4, 30bpp, (1 Cr & Cb sample per 1x1 Y samples), little-en
     PIX_FMT_NB
 };
 
diff --git a/gst/ffmpegcolorspace/gstffmpegcodecmap.c b/gst/ffmpegcolorspace/gstffmpegcodecmap.c
index 97052cb..99ac045 100644
--- a/gst/ffmpegcolorspace/gstffmpegcodecmap.c
+++ b/gst/ffmpegcolorspace/gstffmpegcodecmap.c
@@ -404,6 +404,24 @@ gst_ffmpeg_pixfmt_to_caps (enum PixelFormat pix_fmt, AVCodecContext * context)
           "bpp", G_TYPE_INT, bpp, "depth", G_TYPE_INT, depth,
           "endianness", G_TYPE_INT, G_BIG_ENDIAN, NULL);
       break;
+    case PIX_FMT_YUV420P10BE:
+      fmt = GST_MAKE_FOURCC ('D', '4', '2', '0');
+      break;
+    case PIX_FMT_YUV420P10LE:
+      fmt = GST_MAKE_FOURCC ('d', '4', '2', '0');
+      break;
+    case PIX_FMT_YUV422P10BE:
+      fmt = GST_MAKE_FOURCC ('D', '4', '2', '2');
+      break;
+    case PIX_FMT_YUV422P10LE:
+      fmt = GST_MAKE_FOURCC ('d', '4', '2', '2');
+      break;
+    case PIX_FMT_YUV444P10BE:
+      fmt = GST_MAKE_FOURCC ('D', '4', '4', '4');
+      break;
+    case PIX_FMT_YUV444P10LE:
+      fmt = GST_MAKE_FOURCC ('d', '4', '4', '4');
+      break;
     default:
       /* give up ... */
       break;
@@ -680,6 +698,24 @@ gst_ffmpeg_caps_to_pixfmt (const GstCaps * caps,
         case GST_MAKE_FOURCC ('Y', '1', '6', ' '):
           context->pix_fmt = PIX_FMT_Y16;
           break;
+        case GST_MAKE_FOURCC ('D', '4', '2', '0'):
+          context->pix_fmt = PIX_FMT_YUV420P10BE;
+          break;
+        case GST_MAKE_FOURCC ('d', '4', '2', '0'):
+          context->pix_fmt = PIX_FMT_YUV420P10LE;
+          break;
+        case GST_MAKE_FOURCC ('D', '4', '2', '2'):
+          context->pix_fmt = PIX_FMT_YUV422P10BE;
+          break;
+        case GST_MAKE_FOURCC ('d', '4', '2', '2'):
+          context->pix_fmt = PIX_FMT_YUV422P10LE;
+          break;
+        case GST_MAKE_FOURCC ('D', '4', '4', '4'):
+          context->pix_fmt = PIX_FMT_YUV444P10BE;
+          break;
+        case GST_MAKE_FOURCC ('d', '4', '4', '4'):
+          context->pix_fmt = PIX_FMT_YUV444P10LE;
+          break;
       }
     }
   } else if (gst_structure_has_name (structure, "video/x-raw-rgb")) {
@@ -1004,6 +1040,28 @@ gst_ffmpegcsp_avpicture_fill (AVPicture * picture,
       picture->linesize[0] = stride;
       picture->linesize[1] = 4;
       return size + 256 * 4;
+
+    case PIX_FMT_YUV420P10BE:
+    case PIX_FMT_YUV420P10LE:
+    case PIX_FMT_YUV422P10BE:
+    case PIX_FMT_YUV422P10LE:
+    case PIX_FMT_YUV444P10BE:
+    case PIX_FMT_YUV444P10LE:
+      stride = GST_ROUND_UP_4 (width * 2);
+      h2 = ROUND_UP_X (height, pinfo->y_chroma_shift);
+      size = stride * h2;
+      w2 = DIV_ROUND_UP_X (width, pinfo->x_chroma_shift);
+      stride2 = GST_ROUND_UP_4 (w2 * 2);
+      h2 = DIV_ROUND_UP_X (height, pinfo->y_chroma_shift);
+      size2 = stride2 * h2;
+      picture->data[0] = ptr;
+      picture->data[1] = picture->data[0] + size;
+      picture->data[2] = picture->data[1] + size2;
+      picture->linesize[0] = stride;
+      picture->linesize[1] = stride2;
+      picture->linesize[2] = stride2;
+      return size + 2 * size2;
+
     default:
       picture->data[0] = NULL;
       picture->data[1] = NULL;
diff --git a/gst/ffmpegcolorspace/gstffmpegcolorspace.c b/gst/ffmpegcolorspace/gstffmpegcolorspace.c
index c8805b3..8158485 100644
--- a/gst/ffmpegcolorspace/gstffmpegcolorspace.c
+++ b/gst/ffmpegcolorspace/gstffmpegcolorspace.c
@@ -47,7 +47,7 @@ GST_DEBUG_CATEGORY (ffmpegcolorspace_performance);
 #define FFMPEGCSP_VIDEO_CAPS						\
   "video/x-raw-yuv, width = "GST_VIDEO_SIZE_RANGE" , "			\
   "height="GST_VIDEO_SIZE_RANGE",framerate="GST_VIDEO_FPS_RANGE","	\
-  "format= (fourcc) { I420 , NV12 , NV21 , YV12 , YUY2 , Y42B , Y444 , YUV9 , YVU9 , Y41B , Y800 , Y8 , GREY , Y16 , UYVY , YVYU , IYU1 , v308 , AYUV, A420} ;" \
+  "format= (fourcc) { I420 , NV12 , NV21 , YV12 , YUY2 , Y42B , Y444 , YUV9 , YVU9 , Y41B , Y800 , Y8 , GREY , Y16 , UYVY , YVYU , IYU1 , v308 , AYUV, A420, D420, d420, D422, d422, D444, d444} ;" \
   GST_VIDEO_CAPS_RGB";"							\
   GST_VIDEO_CAPS_BGR";"							\
   GST_VIDEO_CAPS_RGBx";"						\
diff --git a/gst/ffmpegcolorspace/imgconvert.c b/gst/ffmpegcolorspace/imgconvert.c
index c670e25..c72ab00 100644
--- a/gst/ffmpegcolorspace/imgconvert.c
+++ b/gst/ffmpegcolorspace/imgconvert.c
@@ -488,7 +488,73 @@ static PixFmtInfo pix_fmt_info[PIX_FMT_NB] = {
         /* .x_chroma_shift = */ 1,
         /* .y_chroma_shift = */ 1,
         /* .depth          = */ 8,
-      }
+      },
+  /* [PIX_FMT_YUV420P10BE] = */ {
+        /* .format         = */ PIX_FMT_YUV420P10BE,
+        /* .name           = */ "yuv420p10be",
+        /* .nb_channels    = */ 3,
+        /* .color_type     = */ FF_COLOR_YUV,
+        /* .pixel_type     = */ FF_PIXEL_PLANAR,
+        /* .is_alpha       = */ 0,
+        /* .x_chroma_shift = */ 1,
+        /* .y_chroma_shift = */ 1,
+        /* .depth          = */ 10,
+      },
+  /* [PIX_FMT_YUV420P10LE] = */ {
+        /* .format         = */ PIX_FMT_YUV420P10LE,
+        /* .name           = */ "yuv420p10le",
+        /* .nb_channels    = */ 3,
+        /* .color_type     = */ FF_COLOR_YUV,
+        /* .pixel_type     = */ FF_PIXEL_PLANAR,
+        /* .is_alpha       = */ 0,
+        /* .x_chroma_shift = */ 1,
+        /* .y_chroma_shift = */ 1,
+        /* .depth          = */ 10,
+      },
+  /* [PIX_FMT_YUV422P10BE] = */ {
+        /* .format         = */ PIX_FMT_YUV422P10BE,
+        /* .name           = */ "yuv422p10be",
+        /* .nb_channels    = */ 3,
+        /* .color_type     = */ FF_COLOR_YUV,
+        /* .pixel_type     = */ FF_PIXEL_PLANAR,
+        /* .is_alpha       = */ 0,
+        /* .x_chroma_shift = */ 1,
+        /* .y_chroma_shift = */ 0,
+        /* .depth          = */ 10,
+      },
+  /* [PIX_FMT_YUV422P10LE] = */ {
+        /* .format         = */ PIX_FMT_YUV422P10LE,
+        /* .name           = */ "yuv422p10le",
+        /* .nb_channels    = */ 3,
+        /* .color_type     = */ FF_COLOR_YUV,
+        /* .pixel_type     = */ FF_PIXEL_PLANAR,
+        /* .is_alpha       = */ 0,
+        /* .x_chroma_shift = */ 1,
+        /* .y_chroma_shift = */ 0,
+        /* .depth          = */ 10,
+      },
+  /* [PIX_FMT_YUV444P10BE] = */ {
+        /* .format         = */ PIX_FMT_YUV444P10BE,
+        /* .name           = */ "yuv444p10be",
+        /* .nb_channels    = */ 3,
+        /* .color_type     = */ FF_COLOR_YUV,
+        /* .pixel_type     = */ FF_PIXEL_PLANAR,
+        /* .is_alpha       = */ 0,
+        /* .x_chroma_shift = */ 0,
+        /* .y_chroma_shift = */ 0,
+        /* .depth          = */ 10,
+      },
+  /* [PIX_FMT_YUV444P10LE] = */ {
+        /* .format         = */ PIX_FMT_YUV444P10LE,
+        /* .name           = */ "yuv444p10le",
+        /* .nb_channels    = */ 3,
+        /* .color_type     = */ FF_COLOR_YUV,
+        /* .pixel_type     = */ FF_PIXEL_PLANAR,
+        /* .is_alpha       = */ 0,
+        /* .x_chroma_shift = */ 0,
+        /* .y_chroma_shift = */ 0,
+        /* .depth          = */ 10,
+      },
 };
 
 /* returns NULL if not found */
@@ -1555,6 +1621,41 @@ nv12_to_yuv444p (AVPicture * dst, const AVPicture * src, int width, int height)
   }
 }
 
+static void
+nv12_to_yuv420p (AVPicture * dst, const AVPicture * src, int width, int height)
+{
+  uint8_t *src_c = src->data[1];
+  uint8_t *dst_cb = dst->data[1];
+  uint8_t *dst_cr = dst->data[2];
+  int src_c_wrap, dst_cb_wrap, dst_cr_wrap;
+  int c_width, c_height, w, h;
+
+  /* Compute Cb/Cr width and height including odd cases */
+  c_width = width / 2 + (width & 1);
+  c_height = height / 2 + (height & 1);
+
+  /* Compute extra padding per line */
+  src_c_wrap = src->linesize[1] - c_width * 2;
+  dst_cb_wrap = dst->linesize[1] - c_width;
+  dst_cr_wrap = dst->linesize[2] - c_width;
+
+  /* Copy Y plane */
+  memcpy (dst->data[0], src->data[0], src->linesize[0] * height);
+
+  /* Split UY plane to seperate U and V planes */
+  for (h = c_height; h--;) {
+    for (w = c_width; w--;) {
+      *dst_cb++ = *src_c++;
+      *dst_cr++ = *src_c++;
+    }
+
+    /* Skip to next line */
+    src_c += src_c_wrap;
+    dst_cb += dst_cb_wrap;
+    dst_cr += dst_cr_wrap;
+  }
+}
+
 #define nv21_to_nv12 nv12_to_nv21
 
 static void
@@ -1642,6 +1743,41 @@ nv21_to_yuv444p (AVPicture * dst, const AVPicture * src, int width, int height)
 }
 
 static void
+nv21_to_yuv420p (AVPicture * dst, const AVPicture * src, int width, int height)
+{
+  uint8_t *src_c = src->data[1];
+  uint8_t *dst_cb = dst->data[1];
+  uint8_t *dst_cr = dst->data[2];
+  int src_c_wrap, dst_cb_wrap, dst_cr_wrap;
+  int c_width, c_height, w, h;
+
+  /* Compute Cb/Cr width and height including odd cases */
+  c_width = width / 2 + (width & 1);
+  c_height = height / 2 + (height & 1);
+
+  /* Compute extra padding per line */
+  src_c_wrap = src->linesize[1] - c_width * 2;
+  dst_cb_wrap = dst->linesize[1] - c_width;
+  dst_cr_wrap = dst->linesize[2] - c_width;
+
+  /* Copy Y plane */
+  memcpy (dst->data[0], src->data[0], src->linesize[0] * height);
+
+  /* Split UY plane to seperate U and V planes */
+  for (h = c_height; h--;) {
+    for (w = c_width; w--;) {
+      *dst_cr++ = *src_c++;
+      *dst_cb++ = *src_c++;
+    }
+
+    /* Skip to next line */
+    src_c += src_c_wrap;
+    dst_cb += dst_cb_wrap;
+    dst_cr += dst_cr_wrap;
+  }
+}
+
+static void
 yuva420p_to_yuv420p (AVPicture * dst, const AVPicture * src, int width,
     int height)
 {
@@ -1711,6 +1847,1016 @@ yuva420p_to_yuv422 (AVPicture * dst, const AVPicture * src,
   }
 }
 
+static void
+yuv420p10be_to_yuv444p (AVPicture * dst, const AVPicture * src, int width,
+    int height)
+{
+  int w, h;
+  uint8_t *dst_lum1, *dst_lum2, *dst_line = dst->data[0];
+  uint8_t *dst_cb1, *dst_cb2, *dst_cb_line = dst->data[1];
+  uint8_t *dst_cr1, *dst_cr2, *dst_cr_line = dst->data[2];
+  uint16_t *lum1, *lum2, *src_lum_line = (uint16_t *) src->data[0];
+  uint16_t *src_cb1, *src_cb_line = (uint16_t *) src->data[1];
+  uint16_t *src_cr1, *src_cr_line = (uint16_t *) src->data[2];
+  uint16_t y1, y2, cb, cr;
+
+  for (h = height / 2; h--;) {
+    dst_lum1 = dst_line;
+    dst_lum2 = dst_line + dst->linesize[0];
+
+    dst_cb1 = dst_cb_line;
+    dst_cb2 = dst_cb_line + dst->linesize[1];
+    dst_cr1 = dst_cr_line;
+    dst_cr2 = dst_cr_line + dst->linesize[2];
+
+    lum1 = src_lum_line;
+    lum2 = src_lum_line + src->linesize[0] / 2;
+
+    src_cb1 = src_cb_line;
+    src_cr1 = src_cr_line;
+
+    for (w = width / 2; w--;) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      y2 = *lum2++;
+      cb = GUINT16_FROM_BE (cb) >> 2;
+      cr = GUINT16_FROM_BE (cr) >> 2;
+      y1 = GUINT16_FROM_BE (y1) >> 2;
+      y2 = GUINT16_FROM_BE (y2) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_lum2++ = y2;
+      *dst_cb1++ = *dst_cb2++ = cb;
+      *dst_cr1++ = *dst_cr2++ = cr;
+
+      y1 = *lum1++;
+      y2 = *lum2++;
+      y1 = GUINT16_FROM_BE (y1) >> 2;
+      y2 = GUINT16_FROM_BE (y2) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_lum2++ = y2;
+      *dst_cb1++ = *dst_cb2++ = cb;
+      *dst_cr1++ = *dst_cr2++ = cr;
+    }
+    /* odd width */
+    if (width % 2 != 0) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      y2 = *lum2++;
+      cb = GUINT16_FROM_BE (cb) >> 2;
+      cr = GUINT16_FROM_BE (cr) >> 2;
+      y1 = GUINT16_FROM_BE (y1) >> 2;
+      y2 = GUINT16_FROM_BE (y2) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_lum2++ = y2;
+      *dst_cb1++ = *dst_cb2++ = cb;
+      *dst_cr1++ = *dst_cr2++ = cr;
+    }
+
+    dst_line += dst->linesize[0] * 2;
+    dst_cb_line += dst->linesize[1] * 2;
+    dst_cr_line += dst->linesize[2] * 2;
+    src_lum_line += src->linesize[0];
+    src_cb_line += src->linesize[1] / 2;
+    src_cr_line += src->linesize[2] / 2;
+  }
+
+  /* odd height */
+  if (height % 2 != 0) {
+    dst_lum1 = dst_line;
+    lum1 = src_lum_line;
+    src_cb1 = src_cb_line;
+    src_cr1 = src_cr_line;
+    dst_cb1 = dst_cb_line;
+    dst_cr1 = dst_cr_line;
+
+    for (w = width / 2; w--;) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      cb = GUINT16_FROM_BE (cb) >> 2;
+      cr = GUINT16_FROM_BE (cr) >> 2;
+      y1 = GUINT16_FROM_BE (y1) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_cb1++ = cb;
+      *dst_cr1++ = cr;
+
+      y1 = *lum1++;
+      y1 = GUINT16_FROM_BE (y1) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_cb1++ = cb >> 2;
+      *dst_cr1++ = cr >> 2;
+    }
+    /* odd width */
+    if (width % 2 != 0) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      cb = GUINT16_FROM_BE (cb) >> 2;
+      cr = GUINT16_FROM_BE (cr) >> 2;
+      y1 = GUINT16_FROM_BE (y1) >> 2;
+      *dst_lum1++ = y1;
+      *dst_cb1++ = cb;
+      *dst_cr1++ = cr;
+    }
+  }
+}
+
+static void
+yuv420p10le_to_yuv444p (AVPicture * dst, const AVPicture * src, int width,
+    int height)
+{
+  int w, h;
+  uint8_t *dst_lum1, *dst_lum2, *dst_line = dst->data[0];
+  uint8_t *dst_cb1, *dst_cb2, *dst_cb_line = dst->data[1];
+  uint8_t *dst_cr1, *dst_cr2, *dst_cr_line = dst->data[2];
+  uint16_t *lum1, *lum2, *src_lum_line = (uint16_t *) src->data[0];
+  uint16_t *src_cb1, *src_cb_line = (uint16_t *) src->data[1];
+  uint16_t *src_cr1, *src_cr_line = (uint16_t *) src->data[2];
+  uint16_t y1, y2, cb, cr;
+
+  for (h = height / 2; h--;) {
+    dst_lum1 = dst_line;
+    dst_lum2 = dst_line + dst->linesize[0];
+
+    dst_cb1 = dst_cb_line;
+    dst_cb2 = dst_cb_line + dst->linesize[1];
+    dst_cr1 = dst_cr_line;
+    dst_cr2 = dst_cr_line + dst->linesize[2];
+
+    lum1 = src_lum_line;
+    lum2 = src_lum_line + src->linesize[0] / 2;
+
+    src_cb1 = src_cb_line;
+    src_cr1 = src_cr_line;
+
+    for (w = width / 2; w--;) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      y2 = *lum2++;
+      cb = GUINT16_FROM_LE (cb) >> 2;
+      cr = GUINT16_FROM_LE (cr) >> 2;
+      y1 = GUINT16_FROM_LE (y1) >> 2;
+      y2 = GUINT16_FROM_LE (y2) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_lum2++ = y2;
+      *dst_cb1++ = *dst_cb2++ = cb;
+      *dst_cr1++ = *dst_cr2++ = cr;
+
+      y1 = *lum1++;
+      y2 = *lum2++;
+      y1 = GUINT16_FROM_LE (y1) >> 2;
+      y2 = GUINT16_FROM_LE (y2) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_lum2++ = y2;
+      *dst_cb1++ = *dst_cb2++ = cb;
+      *dst_cr1++ = *dst_cr2++ = cr;
+    }
+    /* odd width */
+    if (width % 2 != 0) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      y2 = *lum2++;
+      cb = GUINT16_FROM_LE (cb) >> 2;
+      cr = GUINT16_FROM_LE (cr) >> 2;
+      y1 = GUINT16_FROM_LE (y1) >> 2;
+      y2 = GUINT16_FROM_LE (y2) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_lum2++ = y2;
+      *dst_cb1++ = *dst_cb2++ = cb;
+      *dst_cr1++ = *dst_cr2++ = cr;
+    }
+
+    dst_line += dst->linesize[0] * 2;
+    dst_cb_line += dst->linesize[1] * 2;
+    dst_cr_line += dst->linesize[2] * 2;
+    src_lum_line += src->linesize[0];
+    src_cb_line += src->linesize[1] / 2;
+    src_cr_line += src->linesize[2] / 2;
+  }
+
+  /* odd height */
+  if (height % 2 != 0) {
+    dst_lum1 = dst_line;
+    lum1 = src_lum_line;
+    src_cb1 = src_cb_line;
+    src_cr1 = src_cr_line;
+    dst_cb1 = dst_cb_line;
+    dst_cr1 = dst_cr_line;
+
+    for (w = width / 2; w--;) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      cb = GUINT16_FROM_LE (cb) >> 2;
+      cr = GUINT16_FROM_LE (cr) >> 2;
+      y1 = GUINT16_FROM_LE (y1) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_cb1++ = cb;
+      *dst_cr1++ = cr;
+
+      y1 = *lum1++;
+      y1 = GUINT16_FROM_LE (y1) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_cb1++ = cb >> 6;
+      *dst_cr1++ = cr >> 6;
+    }
+    /* odd width */
+    if (width % 2 != 0) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      cb = GUINT16_FROM_LE (cb) >> 2;
+      cr = GUINT16_FROM_LE (cr) >> 2;
+      y1 = GUINT16_FROM_LE (y1) >> 2;
+      *dst_lum1++ = y1;
+      *dst_cb1++ = cb;
+      *dst_cr1++ = cr;
+    }
+  }
+}
+
+static void
+yuv444p_to_yuv420p10be (AVPicture * dst, const AVPicture * src, int width,
+    int height)
+{
+  int w, h;
+  uint16_t *dst_lum1, *dst_lum2, *dst_line = (uint16_t *) dst->data[0];
+  uint16_t *dst_cb1, *dst_cb_line = (uint16_t *) dst->data[1];
+  uint16_t *dst_cr1, *dst_cr_line = (uint16_t *) dst->data[2];
+  uint8_t *lum1, *lum2, *src_lum_line = src->data[0];
+  uint8_t *src_cb1, *src_cb2, *src_cb_line = src->data[1];
+  uint8_t *src_cr1, *src_cr2, *src_cr_line = src->data[2];
+  uint16_t y1, y2, cb, cr;
+
+  for (h = height / 2; h--;) {
+    dst_lum1 = dst_line;
+    dst_lum2 = dst_line + dst->linesize[0] / 2;
+
+    dst_cb1 = dst_cb_line;
+    dst_cr1 = dst_cr_line;
+
+    lum1 = src_lum_line;
+    lum2 = src_lum_line + src->linesize[0];
+
+    src_cb1 = src_cb_line;
+    src_cb2 = src_cb_line + src->linesize[1];
+    src_cr1 = src_cr_line;
+    src_cr2 = src_cr_line + src->linesize[2];
+
+    for (w = width / 2; w--;) {
+      cb = *src_cb1++;
+      cb += *src_cb1++;
+      cb += *src_cb2++;
+      cb += *src_cb2++;
+      cr = *src_cr1++;
+      cr += *src_cr1++;
+      cr += *src_cr2++;
+      cr += *src_cr2++;
+      y1 = *lum1++;
+      y2 = *lum1++;
+      cb = cb << 0;
+      cr = cr << 0;
+      y1 = y1 << 2;
+      y2 = y2 << 2;
+
+      *dst_lum1++ = GUINT16_TO_BE (y1);
+      *dst_lum1++ = GUINT16_TO_BE (y2);
+      *dst_cb1++ = GUINT16_TO_BE (cb);
+      *dst_cr1++ = GUINT16_TO_BE (cr);
+
+      y1 = *lum2++;
+      y2 = *lum2++;
+      y1 = y1 << 2;
+      y2 = y2 << 2;
+
+      *dst_lum2++ = GUINT16_TO_BE (y1);
+      *dst_lum2++ = GUINT16_TO_BE (y2);
+    }
+
+    /* odd width */
+    if (width % 2 != 0) {
+      cb = *src_cb1++;
+      cb += *src_cb2++;
+      cr = *src_cr1++;
+      cr += *src_cr2++;
+      y1 = *lum1++;
+
+      cb = cb << 1;
+      cr = cr << 1;
+      y1 = y1 << 2;
+
+      *dst_lum1++ = GUINT16_TO_BE (y1);
+      *dst_cb1++ = GUINT16_TO_BE (cb);
+      *dst_cr1++ = GUINT16_TO_BE (cr);
+    }
+
+    dst_line += dst->linesize[0];
+    dst_cb_line += dst->linesize[1] / 2;
+    dst_cr_line += dst->linesize[2] / 2;
+    src_lum_line += src->linesize[0] * 2;
+    src_cb_line += src->linesize[1] * 2;
+    src_cr_line += src->linesize[2] * 2;
+  }
+
+  /* odd height */
+  if (height % 2 != 0) {
+    dst_lum1 = dst_line;
+    lum1 = src_lum_line;
+    src_cb1 = src_cb_line;
+    src_cr1 = src_cr_line;
+    dst_cb1 = dst_cb_line;
+    dst_cr1 = dst_cr_line;
+
+    for (w = width / 2; w--;) {
+      cb = *src_cb1++;
+      cb += *src_cb1++;
+      cr = *src_cr1++;
+      cr += *src_cr1++;
+      y1 = *lum1++;
+      y2 = *lum1++;
+      cb = cb << 1;
+      cr = cr << 1;
+      y1 = y1 << 2;
+      y2 = y2 << 2;
+
+      *dst_lum1++ = GUINT16_TO_BE (y1);
+      *dst_lum1++ = GUINT16_TO_BE (y2);
+      *dst_cb1++ = GUINT16_TO_BE (cb);
+      *dst_cr1++ = GUINT16_TO_BE (cr);
+    }
+
+    /* odd width */
+    if (width % 2 != 0) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+
+      cb = cb << 2;
+      cr = cr << 2;
+      y1 = y1 << 2;
+
+      *dst_lum1++ = GUINT16_TO_BE (y1);
+      *dst_cb1++ = GUINT16_TO_BE (cb);
+      *dst_cr1++ = GUINT16_TO_BE (cr);
+    }
+  }
+}
+
+static void
+yuv444p_to_yuv420p10le (AVPicture * dst, const AVPicture * src, int width,
+    int height)
+{
+  int w, h;
+  uint16_t *dst_lum1, *dst_lum2, *dst_line = (uint16_t *) dst->data[0];
+  uint16_t *dst_cb1, *dst_cb_line = (uint16_t *) dst->data[1];
+  uint16_t *dst_cr1, *dst_cr_line = (uint16_t *) dst->data[2];
+  uint8_t *lum1, *lum2, *src_lum_line = src->data[0];
+  uint8_t *src_cb1, *src_cb2, *src_cb_line = src->data[1];
+  uint8_t *src_cr1, *src_cr2, *src_cr_line = src->data[2];
+  uint16_t y1, y2, cb, cr;
+
+  for (h = height / 2; h--;) {
+    dst_lum1 = dst_line;
+    dst_lum2 = dst_line + dst->linesize[0] / 2;
+
+    dst_cb1 = dst_cb_line;
+    dst_cr1 = dst_cr_line;
+
+    lum1 = src_lum_line;
+    lum2 = src_lum_line + src->linesize[0];
+
+    src_cb1 = src_cb_line;
+    src_cb2 = src_cb_line + src->linesize[1];
+    src_cr1 = src_cr_line;
+    src_cr2 = src_cr_line + src->linesize[2];
+
+    for (w = width / 2; w--;) {
+      cb = *src_cb1++;
+      cb += *src_cb1++;
+      cb += *src_cb2++;
+      cb += *src_cb2++;
+      cr = *src_cr1++;
+      cr += *src_cr1++;
+      cr += *src_cr2++;
+      cr += *src_cr2++;
+      y1 = *lum1++;
+      y2 = *lum1++;
+      cb = cb << 0;
+      cr = cr << 0;
+      y1 = y1 << 2;
+      y2 = y2 << 2;
+
+      *dst_lum1++ = GUINT16_TO_LE (y1);
+      *dst_lum1++ = GUINT16_TO_LE (y2);
+      *dst_cb1++ = GUINT16_TO_LE (cb);
+      *dst_cr1++ = GUINT16_TO_LE (cr);
+
+      y1 = *lum2++;
+      y2 = *lum2++;
+      y1 = y1 << 2;
+      y2 = y2 << 2;
+
+      *dst_lum2++ = GUINT16_TO_LE (y1);
+      *dst_lum2++ = GUINT16_TO_LE (y2);
+    }
+
+    /* odd width */
+    if (width % 2 != 0) {
+      cb = *src_cb1++;
+      cb += *src_cb2++;
+      cr = *src_cr1++;
+      cr += *src_cr2++;
+      y1 = *lum1++;
+
+      cb = cb << 1;
+      cr = cr << 1;
+      y1 = y1 << 2;
+
+      *dst_lum1++ = GUINT16_TO_LE (y1);
+      *dst_cb1++ = GUINT16_TO_LE (cb);
+      *dst_cr1++ = GUINT16_TO_LE (cr);
+    }
+
+    dst_line += dst->linesize[0];
+    dst_cb_line += dst->linesize[1] / 2;
+    dst_cr_line += dst->linesize[2] / 2;
+    src_lum_line += src->linesize[0] * 2;
+    src_cb_line += src->linesize[1] * 2;
+    src_cr_line += src->linesize[2] * 2;
+  }
+
+  /* odd height */
+  if (height % 2 != 0) {
+    dst_lum1 = dst_line;
+    lum1 = src_lum_line;
+    src_cb1 = src_cb_line;
+    src_cr1 = src_cr_line;
+    dst_cb1 = dst_cb_line;
+    dst_cr1 = dst_cr_line;
+
+    for (w = width / 2; w--;) {
+      cb = *src_cb1++;
+      cb += *src_cb1++;
+      cr = *src_cr1++;
+      cr += *src_cr1++;
+      y1 = *lum1++;
+      y2 = *lum1++;
+      cb = cb << 1;
+      cr = cr << 1;
+      y1 = y1 << 2;
+      y2 = y2 << 2;
+
+      *dst_lum1++ = GUINT16_TO_LE (y1);
+      *dst_lum1++ = GUINT16_TO_LE (y2);
+      *dst_cb1++ = GUINT16_TO_LE (cb);
+      *dst_cr1++ = GUINT16_TO_LE (cr);
+    }
+
+    /* odd width */
+    if (width % 2 != 0) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+
+      cb = cb << 2;
+      cr = cr << 2;
+      y1 = y1 << 2;
+
+      *dst_lum1++ = GUINT16_TO_LE (y1);
+      *dst_cb1++ = GUINT16_TO_LE (cb);
+      *dst_cr1++ = GUINT16_TO_LE (cr);
+    }
+  }
+}
+
+static void
+yuv422p10be_to_yuv444p (AVPicture * dst, const AVPicture * src, int width,
+    int height)
+{
+  int w, h;
+  uint8_t *dst_lum1, *dst_line = dst->data[0];
+  uint8_t *dst_cb1, *dst_cb_line = dst->data[1];
+  uint8_t *dst_cr1, *dst_cr_line = dst->data[2];
+  uint16_t *lum1, *src_lum_line = (uint16_t *) src->data[0];
+  uint16_t *src_cb1, *src_cb_line = (uint16_t *) src->data[1];
+  uint16_t *src_cr1, *src_cr_line = (uint16_t *) src->data[2];
+  uint16_t y1, cb, cr;
+
+  for (h = height; h--;) {
+    dst_lum1 = dst_line;
+
+    dst_cb1 = dst_cb_line;
+    dst_cr1 = dst_cr_line;
+
+    lum1 = src_lum_line;
+
+    src_cb1 = src_cb_line;
+    src_cr1 = src_cr_line;
+
+    for (w = width / 2; w--;) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      cb = GUINT16_FROM_BE (cb) >> 2;
+      cr = GUINT16_FROM_BE (cr) >> 2;
+      y1 = GUINT16_FROM_BE (y1) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_cb1++ = cb;
+      *dst_cr1++ = cr;
+
+      y1 = *lum1++;
+      y1 = GUINT16_FROM_BE (y1) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_cb1++ = cb;
+      *dst_cr1++ = cr;
+    }
+    /* odd width */
+    if (width % 2 != 0) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      cb = GUINT16_FROM_BE (cb) >> 2;
+      cr = GUINT16_FROM_BE (cr) >> 2;
+      y1 = GUINT16_FROM_BE (y1) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_cb1++ = cb;
+      *dst_cr1++ = cr;
+    }
+
+    dst_line += dst->linesize[0];
+    dst_cb_line += dst->linesize[1];
+    dst_cr_line += dst->linesize[2];
+    src_lum_line += src->linesize[0] / 2;
+    src_cb_line += src->linesize[1] / 2;
+    src_cr_line += src->linesize[2] / 2;
+  }
+}
+
+static void
+yuv422p10le_to_yuv444p (AVPicture * dst, const AVPicture * src, int width,
+    int height)
+{
+  int w, h;
+  uint8_t *dst_lum1, *dst_line = dst->data[0];
+  uint8_t *dst_cb1, *dst_cb_line = dst->data[1];
+  uint8_t *dst_cr1, *dst_cr_line = dst->data[2];
+  uint16_t *lum1, *src_lum_line = (uint16_t *) src->data[0];
+  uint16_t *src_cb1, *src_cb_line = (uint16_t *) src->data[1];
+  uint16_t *src_cr1, *src_cr_line = (uint16_t *) src->data[2];
+  uint16_t y1, cb, cr;
+
+  for (h = height; h--;) {
+    dst_lum1 = dst_line;
+
+    dst_cb1 = dst_cb_line;
+    dst_cr1 = dst_cr_line;
+
+    lum1 = src_lum_line;
+
+    src_cb1 = src_cb_line;
+    src_cr1 = src_cr_line;
+
+    for (w = width / 2; w--;) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      cb = GUINT16_FROM_LE (cb) >> 2;
+      cr = GUINT16_FROM_LE (cr) >> 2;
+      y1 = GUINT16_FROM_LE (y1) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_cb1++ = cb;
+      *dst_cr1++ = cr;
+
+      y1 = *lum1++;
+      y1 = GUINT16_FROM_LE (y1) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_cb1++ = cb;
+      *dst_cr1++ = cr;
+    }
+    /* odd width */
+    if (width % 2 != 0) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      cb = GUINT16_FROM_LE (cb) >> 2;
+      cr = GUINT16_FROM_LE (cr) >> 2;
+      y1 = GUINT16_FROM_LE (y1) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_cb1++ = cb;
+      *dst_cr1++ = cr;
+    }
+
+    dst_line += dst->linesize[0];
+    dst_cb_line += dst->linesize[1];
+    dst_cr_line += dst->linesize[2];
+    src_lum_line += src->linesize[0] / 2;
+    src_cb_line += src->linesize[1] / 2;
+    src_cr_line += src->linesize[2] / 2;
+  }
+}
+
+static void
+yuv422p10le_to_yuv422 (AVPicture * dst, const AVPicture * src, int width,
+    int height)
+{
+  int w, h;
+  uint8_t *dst_pix, *dst_line = dst->data[0];
+  uint16_t *lum1, *src_lum_line = (uint16_t *) src->data[0];
+  uint16_t *src_cb1, *src_cb_line = (uint16_t *) src->data[1];
+  uint16_t *src_cr1, *src_cr_line = (uint16_t *) src->data[2];
+  uint16_t y1, y2, cb, cr;
+
+  g_debug ("h: %d w: %d src ln0: %d ln1: %d ln2: %d dst ln0: %d",
+      height, width, src->linesize[0], src->linesize[1], src->linesize[2],
+      dst->linesize[0]);
+
+  for (h = height; h--;) {
+    dst_pix = dst_line;
+
+    lum1 = src_lum_line;
+
+    src_cb1 = src_cb_line;
+    src_cr1 = src_cr_line;
+
+    for (w = width / 2; w--;) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      y2 = *lum1++;
+
+      cb = GUINT16_FROM_LE (cb) >> 2;
+      cr = GUINT16_FROM_LE (cr) >> 2;
+      y1 = GUINT16_FROM_LE (y1) >> 2;
+      y2 = GUINT16_FROM_LE (y2) >> 2;
+
+      *dst_pix++ = y1;
+      *dst_pix++ = cb;
+      *dst_pix++ = y2;
+      *dst_pix++ = cr;
+    }
+    /* odd width */
+    if (width % 2 != 0) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      cb = GUINT16_FROM_LE (cb) >> 2;
+      cr = GUINT16_FROM_LE (cr) >> 2;
+      y1 = GUINT16_FROM_LE (y1) >> 2;
+
+      *dst_pix++ = y1;
+      *dst_pix++ = cb;
+      *dst_pix++ = y1;
+      *dst_pix++ = cr;
+    }
+
+    src_lum_line += src->linesize[0] / 2;
+    src_cb_line += src->linesize[1] / 2;
+    src_cr_line += src->linesize[2] / 2;
+    dst_line += dst->linesize[0];
+  }
+}
+
+static void
+yuv444p_to_yuv422p10be (AVPicture * dst, const AVPicture * src, int width,
+    int height)
+{
+  int w, h;
+  uint16_t *dst_lum1, *dst_line = (uint16_t *) dst->data[0];
+  uint16_t *dst_cb1, *dst_cb_line = (uint16_t *) dst->data[1];
+  uint16_t *dst_cr1, *dst_cr_line = (uint16_t *) dst->data[2];
+  uint8_t *lum1, *src_lum_line = src->data[0];
+  uint8_t *src_cb1, *src_cb_line = src->data[1];
+  uint8_t *src_cr1, *src_cr_line = src->data[2];
+  uint16_t y1, y2, cb, cr;
+
+  for (h = height; h--;) {
+    dst_lum1 = dst_line;
+
+    dst_cb1 = dst_cb_line;
+    dst_cr1 = dst_cr_line;
+
+    lum1 = src_lum_line;
+
+    src_cb1 = src_cb_line;
+    src_cr1 = src_cr_line;
+
+    for (w = width / 2; w--;) {
+      cb = *src_cb1++;
+      cb += *src_cb1++;
+      cr = *src_cr1++;
+      cr += *src_cr1++;
+      y1 = *lum1++;
+      y2 = *lum1++;
+      cb = cb << 1;
+      cr = cr << 1;
+      y1 = y1 << 2;
+      y2 = y2 << 2;
+
+      *dst_lum1++ = GUINT16_TO_BE (y1);
+      *dst_lum1++ = GUINT16_TO_BE (y2);
+      *dst_cb1++ = GUINT16_TO_BE (cb);
+      *dst_cr1++ = GUINT16_TO_BE (cr);
+    }
+
+    /* odd width */
+    if (width % 2 != 0) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+
+      cb = cb << 2;
+      cr = cr << 2;
+      y1 = y1 << 2;
+
+      *dst_lum1++ = GUINT16_TO_BE (y1);
+      *dst_cb1++ = GUINT16_TO_BE (cb);
+      *dst_cr1++ = GUINT16_TO_BE (cr);
+    }
+
+    dst_line += dst->linesize[0] / 2;
+    dst_cb_line += dst->linesize[1] / 2;
+    dst_cr_line += dst->linesize[2] / 2;
+    src_lum_line += src->linesize[0];
+    src_cb_line += src->linesize[1];
+    src_cr_line += src->linesize[2];
+  }
+}
+
+static void
+yuv444p_to_yuv422p10le (AVPicture * dst, const AVPicture * src, int width,
+    int height)
+{
+  int w, h;
+  uint16_t *dst_lum1, *dst_line = (uint16_t *) dst->data[0];
+  uint16_t *dst_cb1, *dst_cb_line = (uint16_t *) dst->data[1];
+  uint16_t *dst_cr1, *dst_cr_line = (uint16_t *) dst->data[2];
+  uint8_t *lum1, *src_lum_line = src->data[0];
+  uint8_t *src_cb1, *src_cb_line = src->data[1];
+  uint8_t *src_cr1, *src_cr_line = src->data[2];
+  uint16_t y1, y2, cb, cr;
+
+  for (h = height; h--;) {
+    dst_lum1 = dst_line;
+
+    dst_cb1 = dst_cb_line;
+    dst_cr1 = dst_cr_line;
+
+    lum1 = src_lum_line;
+
+    src_cb1 = src_cb_line;
+    src_cr1 = src_cr_line;
+
+    for (w = width / 2; w--;) {
+      cb = *src_cb1++;
+      cb += *src_cb1++;
+      cr = *src_cr1++;
+      cr += *src_cr1++;
+      y1 = *lum1++;
+      y2 = *lum1++;
+      cb = cb << 1;
+      cr = cr << 1;
+      y1 = y1 << 2;
+      y2 = y2 << 2;
+
+      *dst_lum1++ = GUINT16_TO_LE (y1);
+      *dst_lum1++ = GUINT16_TO_LE (y2);
+      *dst_cb1++ = GUINT16_TO_LE (cb);
+      *dst_cr1++ = GUINT16_TO_LE (cr);
+    }
+
+    /* odd width */
+    if (width % 2 != 0) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+
+      cb = cb << 2;
+      cr = cr << 2;
+      y1 = y1 << 2;
+
+      *dst_lum1++ = GUINT16_TO_LE (y1);
+      *dst_cb1++ = GUINT16_TO_LE (cb);
+      *dst_cr1++ = GUINT16_TO_LE (cr);
+    }
+
+    dst_line += dst->linesize[0] / 2;
+    dst_cb_line += dst->linesize[1] / 2;
+    dst_cr_line += dst->linesize[2] / 2;
+    src_lum_line += src->linesize[0];
+    src_cb_line += src->linesize[1];
+    src_cr_line += src->linesize[2];
+  }
+}
+
+static void
+yuv444p10be_to_yuv444p (AVPicture * dst, const AVPicture * src, int width,
+    int height)
+{
+  int w, h;
+  uint8_t *dst_lum1, *dst_line = dst->data[0];
+  uint8_t *dst_cb1, *dst_cb_line = dst->data[1];
+  uint8_t *dst_cr1, *dst_cr_line = dst->data[2];
+  uint16_t *lum1, *src_lum_line = (uint16_t *) src->data[0];
+  uint16_t *src_cb1, *src_cb_line = (uint16_t *) src->data[1];
+  uint16_t *src_cr1, *src_cr_line = (uint16_t *) src->data[2];
+  uint16_t y1, cb, cr;
+
+  for (h = height; h--;) {
+    dst_lum1 = dst_line;
+
+    dst_cb1 = dst_cb_line;
+    dst_cr1 = dst_cr_line;
+
+    lum1 = src_lum_line;
+
+    src_cb1 = src_cb_line;
+    src_cr1 = src_cr_line;
+
+    for (w = width; w--;) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      cb = GUINT16_FROM_BE (cb) >> 2;
+      cr = GUINT16_FROM_BE (cr) >> 2;
+      y1 = GUINT16_FROM_BE (y1) >> 2;
+
+      *dst_lum1++ = y1;
+      *dst_cb1++ = cb;
+      *dst_cr1++ = cr;
+    }
+
+    dst_line += dst->linesize[0];
+    dst_cb_line += dst->linesize[1];
+    dst_cr_line += dst->linesize[2];
+    src_lum_line += src->linesize[0] / 2;
+    src_cb_line += src->linesize[1] / 2;
+    src_cr_line += src->linesize[2] / 2;
+  }
+}
+
+static void
+yuv444p10le_to_yuv444p (AVPicture * dst, const AVPicture * src, int width,
+    int height)
+{
+  int w, h;
+  uint8_t *dst_lum1, *dst_line = dst->data[0];
+  uint8_t *dst_cb1, *dst_cb_line = dst->data[1];
+  uint8_t *dst_cr1, *dst_cr_line = dst->data[2];
+  uint16_t *lum1, *src_lum_line = (uint16_t *) src->data[0];
+  uint16_t *src_cb1, *src_cb_line = (uint16_t *) src->data[1];
+  uint16_t *src_cr1, *src_cr_line = (uint16_t *) src->data[2];
+  uint16_t y1, cb, cr;
+
+  for (h = height; h--;) {
+    dst_lum1 = dst_line;
+
+    dst_cb1 = dst_cb_line;
+    dst_cr1 = dst_cr_line;
+
+    lum1 = src_lum_line;
+
+    src_cb1 = src_cb_line;
+    src_cr1 = src_cr_line;
+
+    for (w = width; w--;) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+
+      cb = GUINT16_FROM_LE (cb);
+      cr = GUINT16_FROM_LE (cr);
+      y1 = GUINT16_FROM_LE (y1);
+
+      y1 >>= 2;
+      cb >>= 2;
+      cr >>= 2;
+
+      *dst_lum1++ = y1;
+      *dst_cb1++ = cb;
+      *dst_cr1++ = cr;
+    }
+
+    dst_line += dst->linesize[0];
+    dst_cb_line += dst->linesize[1];
+    dst_cr_line += dst->linesize[2];
+    src_lum_line += src->linesize[0] / 2;
+    src_cb_line += src->linesize[1] / 2;
+    src_cr_line += src->linesize[2] / 2;
+  }
+}
+
+static void
+yuv444p_to_yuv444p10be (AVPicture * dst, const AVPicture * src, int width,
+    int height)
+{
+  int w, h;
+  uint16_t *dst_lum1, *dst_line = (uint16_t *) dst->data[0];
+  uint16_t *dst_cb1, *dst_cb_line = (uint16_t *) dst->data[1];
+  uint16_t *dst_cr1, *dst_cr_line = (uint16_t *) dst->data[2];
+  uint8_t *lum1, *src_lum_line = src->data[0];
+  uint8_t *src_cb1, *src_cb_line = src->data[1];
+  uint8_t *src_cr1, *src_cr_line = src->data[2];
+  uint16_t y1, cb, cr;
+
+  for (h = height; h--;) {
+    dst_lum1 = dst_line;
+
+    dst_cb1 = dst_cb_line;
+    dst_cr1 = dst_cr_line;
+
+    lum1 = src_lum_line;
+
+    src_cb1 = src_cb_line;
+    src_cr1 = src_cr_line;
+
+    for (w = width; w--;) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      cb = cb << 2;
+      cr = cr << 2;
+      y1 = y1 << 2;
+
+      *dst_lum1++ = GUINT16_TO_BE (y1);
+      *dst_cb1++ = GUINT16_TO_BE (cb);
+      *dst_cr1++ = GUINT16_TO_BE (cr);
+    }
+
+    dst_line += dst->linesize[0] / 2;
+    dst_cb_line += dst->linesize[1] / 2;
+    dst_cr_line += dst->linesize[2] / 2;
+    src_lum_line += src->linesize[0];
+    src_cb_line += src->linesize[1];
+    src_cr_line += src->linesize[2];
+  }
+}
+
+static void
+yuv444p_to_yuv444p10le (AVPicture * dst, const AVPicture * src, int width,
+    int height)
+{
+  int w, h;
+  uint16_t *dst_lum1, *dst_line = (uint16_t *) dst->data[0];
+  uint16_t *dst_cb1, *dst_cb_line = (uint16_t *) dst->data[1];
+  uint16_t *dst_cr1, *dst_cr_line = (uint16_t *) dst->data[2];
+  uint8_t *lum1, *src_lum_line = src->data[0];
+  uint8_t *src_cb1, *src_cb_line = src->data[1];
+  uint8_t *src_cr1, *src_cr_line = src->data[2];
+  uint16_t y1, cb, cr;
+
+  for (h = height; h--;) {
+    dst_lum1 = dst_line;
+
+    dst_cb1 = dst_cb_line;
+    dst_cr1 = dst_cr_line;
+
+    lum1 = src_lum_line;
+
+    src_cb1 = src_cb_line;
+    src_cr1 = src_cr_line;
+
+    for (w = width; w--;) {
+      cb = *src_cb1++;
+      cr = *src_cr1++;
+      y1 = *lum1++;
+      cb = cb << 2;
+      cr = cr << 2;
+      y1 = y1 << 2;
+
+      *dst_lum1++ = GUINT16_TO_LE (y1);
+      *dst_cb1++ = GUINT16_TO_LE (cb);
+      *dst_cr1++ = GUINT16_TO_LE (cr);
+    }
+
+    dst_line += dst->linesize[0] / 2;
+    dst_cb_line += dst->linesize[1] / 2;
+    dst_cr_line += dst->linesize[2] / 2;
+    src_lum_line += src->linesize[0];
+    src_cb_line += src->linesize[1];
+    src_cr_line += src->linesize[2];
+  }
+}
+
 #define SCALEBITS 10
 #define ONE_HALF  (1 << (SCALEBITS - 1))
 #define FIX(x)    ((int) ((x) * (1<<SCALEBITS) + 0.5))
@@ -3125,6 +4271,7 @@ static ConvertEntry convert_table[] = {
   {PIX_FMT_NV12, PIX_FMT_ABGR32, nv12_to_abgr32},
   {PIX_FMT_NV12, PIX_FMT_NV21, nv12_to_nv21},
   {PIX_FMT_NV12, PIX_FMT_YUV444P, nv12_to_yuv444p},
+  {PIX_FMT_NV12, PIX_FMT_YUV420P, nv12_to_yuv420p},
 
   {PIX_FMT_NV21, PIX_FMT_RGB555, nv21_to_rgb555},
   {PIX_FMT_NV21, PIX_FMT_RGB565, nv21_to_rgb565},
@@ -3140,6 +4287,7 @@ static ConvertEntry convert_table[] = {
   {PIX_FMT_NV21, PIX_FMT_ABGR32, nv21_to_abgr32},
   {PIX_FMT_NV21, PIX_FMT_YUV444P, nv21_to_yuv444p},
   {PIX_FMT_NV21, PIX_FMT_NV12, nv21_to_nv12},
+  {PIX_FMT_NV21, PIX_FMT_YUV420P, nv21_to_yuv420p},
 
   {PIX_FMT_YUV422P, PIX_FMT_YUV422, yuv422p_to_yuv422},
   {PIX_FMT_YUV422P, PIX_FMT_UYVY422, yuv422p_to_uyvy422},
@@ -3499,6 +4647,21 @@ static ConvertEntry convert_table[] = {
   {PIX_FMT_YUVA420P, PIX_FMT_BGRA32, yuva420p_to_bgra32},
   {PIX_FMT_YUVA420P, PIX_FMT_ARGB32, yuva420p_to_argb32},
   {PIX_FMT_YUVA420P, PIX_FMT_ABGR32, yuva420p_to_abgr32},
+
+  {PIX_FMT_YUV420P10BE, PIX_FMT_YUV444P, yuv420p10be_to_yuv444p},
+  {PIX_FMT_YUV420P10LE, PIX_FMT_YUV444P, yuv420p10le_to_yuv444p},
+  {PIX_FMT_YUV422P10BE, PIX_FMT_YUV444P, yuv422p10be_to_yuv444p},
+  {PIX_FMT_YUV422P10LE, PIX_FMT_YUV422, yuv422p10le_to_yuv422},
+  {PIX_FMT_YUV422P10LE, PIX_FMT_YUV444P, yuv422p10le_to_yuv444p},
+  {PIX_FMT_YUV444P10BE, PIX_FMT_YUV444P, yuv444p10be_to_yuv444p},
+  {PIX_FMT_YUV444P10LE, PIX_FMT_YUV444P, yuv444p10le_to_yuv444p},
+
+  {PIX_FMT_YUV444P, PIX_FMT_YUV420P10BE, yuv444p_to_yuv420p10be},
+  {PIX_FMT_YUV444P, PIX_FMT_YUV420P10LE, yuv444p_to_yuv420p10le},
+  {PIX_FMT_YUV444P, PIX_FMT_YUV422P10BE, yuv444p_to_yuv422p10be},
+  {PIX_FMT_YUV444P, PIX_FMT_YUV422P10LE, yuv444p_to_yuv422p10le},
+  {PIX_FMT_YUV444P, PIX_FMT_YUV444P10BE, yuv444p_to_yuv444p10be},
+  {PIX_FMT_YUV444P, PIX_FMT_YUV444P10LE, yuv444p_to_yuv444p10le},
 };
 
 static ConvertEntry *
diff --git a/gst/gdp/Makefile.in b/gst/gdp/Makefile.in
index 973d158..d27bd5a 100644
--- a/gst/gdp/Makefile.in
+++ b/gst/gdp/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/gdp
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -120,10 +137,23 @@ libgstgdp_la_OBJECTS = $(am_libgstgdp_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstgdp_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstgdp_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstgdp_la_CFLAGS) $(CFLAGS) \
 	$(libgstgdp_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -136,22 +166,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstgdp_la_SOURCES)
 DIST_SOURCES = $(libgstgdp_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -444,7 +475,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -498,7 +533,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -506,6 +540,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -521,12 +557,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstgdp.la: $(libgstgdp_la_OBJECTS) $(libgstgdp_la_DEPENDENCIES) $(EXTRA_libgstgdp_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstgdp_la_LINK) -rpath $(plugindir) $(libgstgdp_la_OBJECTS) $(libgstgdp_la_LIBADD) $(LIBS)
 
@@ -637,6 +675,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -781,18 +833,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/playback/Makefile.in b/gst/playback/Makefile.in
index eb84daf..3a9a2ba 100644
--- a/gst/playback/Makefile.in
+++ b/gst/playback/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -25,6 +24,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -43,8 +59,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/gst-glib-gen.mak
+	$(srcdir)/Makefile.in $(top_srcdir)/common/gst-glib-gen.mak \
+	$(top_srcdir)/depcomp
 subdir = gst/playback
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
@@ -130,6 +148,7 @@ libgstdecodebin_la_OBJECTS = $(am_libgstdecodebin_la_OBJECTS) \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstdecodebin_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstdecodebin_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstdecodebin_la_CFLAGS) $(CFLAGS) \
@@ -171,6 +190,18 @@ libgstplaybin_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstplaybin_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstplaybin_la_CFLAGS) $(CFLAGS) \
 	$(libgstplaybin_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -183,20 +214,16 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstdecodebin_la_SOURCES) \
 	$(nodist_libgstdecodebin_la_SOURCES) \
 	$(libgstdecodebin2_la_SOURCES) \
@@ -204,6 +231,11 @@ SOURCES = $(libgstdecodebin_la_SOURCES) \
 	$(libgstplaybin_la_SOURCES) $(nodist_libgstplaybin_la_SOURCES)
 DIST_SOURCES = $(libgstdecodebin_la_SOURCES) \
 	$(libgstdecodebin2_la_SOURCES) $(libgstplaybin_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -496,7 +528,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -608,7 +644,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -616,6 +651,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -631,12 +668,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstdecodebin.la: $(libgstdecodebin_la_OBJECTS) $(libgstdecodebin_la_DEPENDENCIES) $(EXTRA_libgstdecodebin_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstdecodebin_la_LINK) -rpath $(plugindir) $(libgstdecodebin_la_OBJECTS) $(libgstdecodebin_la_LIBADD) $(LIBS)
 libgstdecodebin2.la: $(libgstdecodebin2_la_OBJECTS) $(libgstdecodebin2_la_DEPENDENCIES) $(EXTRA_libgstdecodebin2_la_DEPENDENCIES) 
@@ -887,6 +926,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -1035,18 +1088,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # these are all the rules generating the relevant files
diff --git a/gst/playback/gstdecodebin2.c b/gst/playback/gstdecodebin2.c
index 8bcadde..384f308 100644
--- a/gst/playback/gstdecodebin2.c
+++ b/gst/playback/gstdecodebin2.c
@@ -102,6 +102,9 @@
 
 #include "gst/glib-compat-private.h"
 
+/* Also used by gsturidecodebin.c */
+gint _decode_bin_compare_factories_func (gconstpointer p1, gconstpointer p2);
+
 /* generic templates */
 static GstStaticPadTemplate decoder_bin_sink_template =
 GST_STATIC_PAD_TEMPLATE ("sink",
@@ -154,6 +157,7 @@ struct _GstDecodeBin
   guint max_size_buffers;
   guint64 max_size_time;
   gboolean post_stream_topology;
+  guint connection_speed;
 
   GstElement *typefind;         /* this holds the typefind object */
 
@@ -248,6 +252,7 @@ enum
 #define DEFAULT_MAX_SIZE_TIME     0
 #define DEFAULT_POST_STREAM_TOPOLOGY FALSE
 #define DEFAULT_EXPOSE_ALL_STREAMS  TRUE
+#define DEFAULT_CONNECTION_SPEED    0
 
 /* Properties */
 enum
@@ -264,6 +269,7 @@ enum
   PROP_MAX_SIZE_TIME,
   PROP_POST_STREAM_TOPOLOGY,
   PROP_EXPOSE_ALL_STREAMS,
+  PROP_CONNECTION_SPEED,
   PROP_LAST
 };
 
@@ -927,6 +933,19 @@ gst_decode_bin_class_init (GstDecodeBinClass * klass)
           DEFAULT_EXPOSE_ALL_STREAMS,
           G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
+  /**
+   * GstDecodeBin2::connection-speed
+   *
+   * Network connection speed in kbps (0 = unknownw)
+   *
+   * Since: 0.10.XX
+   */
+  g_object_class_install_property (gobject_klass, PROP_CONNECTION_SPEED,
+      g_param_spec_uint ("connection-speed", "Connection Speed",
+          "Network connection speed in kbps (0 = unknown)",
+          0, G_MAXUINT / 1000, DEFAULT_CONNECTION_SPEED,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
 
 
   klass->autoplug_continue =
@@ -952,6 +971,42 @@ gst_decode_bin_class_init (GstDecodeBinClass * klass)
 
   gstbin_klass->handle_message =
       GST_DEBUG_FUNCPTR (gst_decode_bin_handle_message);
+
+  g_type_class_ref (GST_TYPE_DECODE_PAD);
+}
+
+gint
+_decode_bin_compare_factories_func (gconstpointer p1, gconstpointer p2)
+{
+  GstPluginFeature *f1, *f2;
+  gint diff;
+  gboolean is_parser1, is_parser2;
+
+  f1 = (GstPluginFeature *) p1;
+  f2 = (GstPluginFeature *) p2;
+
+  is_parser1 = gst_element_factory_list_is_type (GST_ELEMENT_FACTORY_CAST (f1),
+      GST_ELEMENT_FACTORY_TYPE_PARSER);
+  is_parser2 = gst_element_factory_list_is_type (GST_ELEMENT_FACTORY_CAST (f2),
+      GST_ELEMENT_FACTORY_TYPE_PARSER);
+
+
+  /* We want all parsers first as we always want to plug parsers
+   * before decoders */
+  if (is_parser1 && !is_parser2)
+    return -1;
+  else if (!is_parser1 && is_parser2)
+    return 1;
+
+  /* And if it's a both a parser we first sort by rank
+   * and then by factory name */
+  diff = gst_plugin_feature_get_rank (f2) - gst_plugin_feature_get_rank (f1);
+  if (diff != 0)
+    return diff;
+
+  diff = strcmp (GST_OBJECT_NAME (f2), GST_OBJECT_NAME (f1));
+
+  return diff;
 }
 
 /* Must be called with factories lock! */
@@ -966,6 +1021,8 @@ gst_decode_bin_update_factories_list (GstDecodeBin * dbin)
     dbin->factories =
         gst_element_factory_list_get_elements
         (GST_ELEMENT_FACTORY_TYPE_DECODABLE, GST_RANK_MARGINAL);
+    dbin->factories =
+        g_list_sort (dbin->factories, _decode_bin_compare_factories_func);
     dbin->factories_cookie = gst_default_registry_get_feature_list_cookie ();
   }
 }
@@ -1032,7 +1089,9 @@ gst_decode_bin_init (GstDecodeBin * decode_bin)
   decode_bin->max_size_buffers = DEFAULT_MAX_SIZE_BUFFERS;
   decode_bin->max_size_time = DEFAULT_MAX_SIZE_TIME;
 
+  decode_bin->post_stream_topology = DEFAULT_POST_STREAM_TOPOLOGY;
   decode_bin->expose_allstreams = DEFAULT_EXPOSE_ALL_STREAMS;
+  decode_bin->connection_speed = DEFAULT_CONNECTION_SPEED;
 }
 
 static void
@@ -1228,6 +1287,11 @@ gst_decode_bin_set_property (GObject * object, guint prop_id,
     case PROP_EXPOSE_ALL_STREAMS:
       dbin->expose_allstreams = g_value_get_boolean (value);
       break;
+    case PROP_CONNECTION_SPEED:
+      GST_OBJECT_LOCK (dbin);
+      dbin->connection_speed = g_value_get_uint (value) * 1000;
+      GST_OBJECT_UNLOCK (dbin);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
@@ -1275,6 +1339,11 @@ gst_decode_bin_get_property (GObject * object, guint prop_id,
     case PROP_EXPOSE_ALL_STREAMS:
       g_value_set_boolean (value, dbin->expose_allstreams);
       break;
+    case PROP_CONNECTION_SPEED:
+      GST_OBJECT_LOCK (dbin);
+      g_value_set_uint (value, dbin->connection_speed / 1000);
+      GST_OBJECT_UNLOCK (dbin);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
@@ -1942,6 +2011,40 @@ connect_pad (GstDecodeBin * dbin, GstElement * src, GstDecodePad * dpad,
     chain->demuxer = is_demuxer_element (element);
     CHAIN_MUTEX_UNLOCK (chain);
 
+    /* Set connection-speed property if needed */
+    if (chain->demuxer == TRUE) {
+      GParamSpec *pspec;
+
+      if ((pspec = g_object_class_find_property (G_OBJECT_GET_CLASS (element),
+                  "connection-speed"))) {
+        guint speed = dbin->connection_speed / 1000;
+        gboolean wrong_type = FALSE;
+
+        if (G_PARAM_SPEC_TYPE (pspec) == G_TYPE_PARAM_UINT) {
+          GParamSpecUInt *pspecuint = G_PARAM_SPEC_UINT (pspec);
+
+          speed = CLAMP (speed, pspecuint->minimum, pspecuint->maximum);
+        } else if (G_PARAM_SPEC_TYPE (pspec) == G_TYPE_PARAM_INT) {
+          GParamSpecInt *pspecint = G_PARAM_SPEC_INT (pspec);
+
+          speed = CLAMP (speed, pspecint->minimum, pspecint->maximum);
+        } else {
+          GST_WARNING_OBJECT (dbin,
+              "The connection speed property %i of type %s"
+              " is not usefull not setting it", speed,
+              g_type_name (G_PARAM_SPEC_TYPE (pspec)));
+          wrong_type = TRUE;
+        }
+
+        if (wrong_type == FALSE) {
+          GST_DEBUG_OBJECT (dbin, "setting connection-speed=%d to demuxer"
+              " element", speed);
+
+          g_object_set (element, "connection-speed", speed, NULL);
+        }
+      }
+    }
+
     /* link this element further */
     connect_element (dbin, element, chain);
 
diff --git a/gst/playback/gstplay-enum.c b/gst/playback/gstplay-enum.c
index e337fdf..4fe137d 100644
--- a/gst/playback/gstplay-enum.c
+++ b/gst/playback/gstplay-enum.c
@@ -65,6 +65,8 @@ gst_play_flags_get_type (void)
         "buffering"},
     {C_FLAGS (GST_PLAY_FLAG_DEINTERLACE), "Deinterlace video if necessary",
         "deinterlace"},
+    {C_FLAGS (GST_PLAY_FLAG_SOFT_COLORBALANCE), "Use software color balance",
+        "soft-colorbalance"},
     {0, NULL, NULL}
   };
   static volatile GType id = 0;
diff --git a/gst/playback/gstplay-enum.h b/gst/playback/gstplay-enum.h
index 77a34cf..457d90c 100644
--- a/gst/playback/gstplay-enum.h
+++ b/gst/playback/gstplay-enum.h
@@ -70,7 +70,8 @@ typedef enum {
   GST_PLAY_FLAG_NATIVE_VIDEO  = (1 << 6),
   GST_PLAY_FLAG_DOWNLOAD      = (1 << 7),
   GST_PLAY_FLAG_BUFFERING     = (1 << 8),
-  GST_PLAY_FLAG_DEINTERLACE   = (1 << 9)
+  GST_PLAY_FLAG_DEINTERLACE   = (1 << 9),
+  GST_PLAY_FLAG_SOFT_COLORBALANCE = (1 << 10)
 } GstPlayFlags;
 
 #define GST_TYPE_PLAY_FLAGS (gst_play_flags_get_type())
diff --git a/gst/playback/gstplaybasebin.c b/gst/playback/gstplaybasebin.c
index 7ab2c29..a89d649 100644
--- a/gst/playback/gstplaybasebin.c
+++ b/gst/playback/gstplaybasebin.c
@@ -17,6 +17,10 @@
  * Boston, MA 02111-1307, USA.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
diff --git a/gst/playback/gstplaybin2.c b/gst/playback/gstplaybin2.c
index e01ff6c..aa6e72e 100644
--- a/gst/playback/gstplaybin2.c
+++ b/gst/playback/gstplaybin2.c
@@ -178,13 +178,15 @@
  * <refsect2>
  * <title>Specifying which CD/DVD device to use</title>
  * The device to use for CDs/DVDs needs to be set on the source element
- * playbin creates before it is opened. The only way to do this at the moment
- * is to connect to playbin's "notify::source" signal, which will be emitted
- * by playbin when it has created the source element for a particular URI.
- * In the signal callback you can check if the source element has a "device"
- * property and set it appropriately. In future ways might be added to specify
- * the device as part of the URI, but at the time of writing this is not
- * possible yet.
+ * playbin creates before it is opened. The most generic way of doing this
+ * is to connect to playbin's "source-setup" (or "notify::source") signal,
+ * which will be emitted by playbin2 when it has created the source element
+ * for a particular URI. In the signal callback you can check if the source
+ * element has a "device" property and set it appropriately. In some cases
+ * the device can also be set as part of the URI, but it depends on the
+ * elements involved if this will work or not. For example, for DVD menu
+ * playback, the following syntax might work (if the resindvd plugin is used):
+ * dvd://[/path/to/device]
  * </refsect2>
  * <refsect2>
  * <title>Handling redirects</title>
@@ -199,19 +201,19 @@
  * <refsect2>
  * <title>Examples</title>
  * |[
- * gst-launch -v playbin uri=file:///path/to/somefile.avi
+ * gst-launch -v playbin2 uri=file:///path/to/somefile.avi
  * ]| This will play back the given AVI video file, given that the video and
  * audio decoders required to decode the content are installed. Since no
  * special audio sink or video sink is supplied (not possible via gst-launch),
  * playbin will try to find a suitable audio and video sink automatically
  * using the autoaudiosink and autovideosink elements.
  * |[
- * gst-launch -v playbin uri=cdda://4
+ * gst-launch -v playbin2 uri=cdda://4
  * ]| This will play back track 4 on an audio CD in your disc drive (assuming
  * the drive is detected automatically by the plugin).
  * |[
- * gst-launch -v playbin uri=dvd://1
- * ]| This will play back title 1 of a DVD in your disc drive (assuming
+ * gst-launch -v playbin2 uri=dvd://
+ * ]| This will play back the DVD in your disc drive (assuming
  * the drive is detected automatically by the plugin).
  * </refsect2>
  */
@@ -230,6 +232,9 @@
 #include <gst/gst-i18n-plugin.h>
 #include <gst/pbutils/pbutils.h>
 #include <gst/interfaces/streamvolume.h>
+#include <gst/interfaces/xoverlay.h>
+#include <gst/interfaces/navigation.h>
+#include <gst/interfaces/colorbalance.h>
 
 #include "gstplay-enum.h"
 #include "gstplay-marshal.h"
@@ -333,6 +338,10 @@ struct _GstSourceGroup
   GMutex *stream_changed_pending_lock;
   GList *stream_changed_pending;
 
+  /* to prevent that suburidecodebin seek flushes disrupt playback */
+  GMutex *suburi_flushes_to_drop_lock;
+  GSList *suburi_flushes_to_drop;
+
   /* selectors for different streams */
   GstSourceSelect selector[PLAYBIN_STREAM_LAST];
 };
@@ -385,6 +394,7 @@ struct _GstPlayBin
 
   guint64 buffer_duration;      /* When buffering, the max buffer duration (ns) */
   guint buffer_size;            /* When buffering, the max buffer size (bytes) */
+  gboolean force_aspect_ratio;
 
   /* our play sink */
   GstPlaySink *playsink;
@@ -405,6 +415,16 @@ struct _GstPlayBin
                                  * input-selector, so that we only post a
                                  * warning once */
 
+  gboolean video_pending_flush_finish;  /* whether we are pending to send a custom
+                                         * custom-video-flush-finish event
+                                         * on pad activation */
+  gboolean audio_pending_flush_finish;  /* whether we are pending to send a custom
+                                         * custom-audio-flush-finish event
+                                         * on pad activation */
+  gboolean text_pending_flush_finish;   /* whether we are pending to send a custom
+                                         * custom-subtitle-flush-finish event
+                                         * on pad activation */
+
   GstElement *audio_sink;       /* configured audio sink, or NULL      */
   GstElement *video_sink;       /* configured video sink, or NULL      */
   GstElement *text_sink;        /* configured text sink, or NULL       */
@@ -456,7 +476,7 @@ struct _GstPlayBinClass
 #define DEFAULT_SUBURI            NULL
 #define DEFAULT_SOURCE            NULL
 #define DEFAULT_FLAGS             GST_PLAY_FLAG_AUDIO | GST_PLAY_FLAG_VIDEO | GST_PLAY_FLAG_TEXT | \
-                                  GST_PLAY_FLAG_SOFT_VOLUME
+                                  GST_PLAY_FLAG_SOFT_VOLUME | GST_PLAY_FLAG_SOFT_COLORBALANCE
 #define DEFAULT_N_VIDEO           0
 #define DEFAULT_CURRENT_VIDEO     -1
 #define DEFAULT_N_AUDIO           0
@@ -504,6 +524,7 @@ enum
   PROP_BUFFER_DURATION,
   PROP_AV_OFFSET,
   PROP_RING_BUFFER_MAX_SIZE,
+  PROP_FORCE_ASPECT_RATIO,
   PROP_LAST
 };
 
@@ -565,8 +586,7 @@ static void pad_removed_cb (GstElement * decodebin, GstPad * pad,
 
 static void gst_play_bin_suburidecodebin_block (GstElement * suburidecodebin,
     gboolean block);
-static void gst_play_bin_suburidecodebin_seek_to_start (GstElement *
-    suburidecodebin);
+static void gst_play_bin_suburidecodebin_seek_to_start (GstSourceGroup * group);
 
 static GstElementClass *parent_class;
 
@@ -578,6 +598,15 @@ if (id) {                                \
   id = 0;                                \
 }
 
+static void gst_play_bin_implements_interface_init (gpointer g_iface,
+    gpointer g_iface_data);
+static void gst_play_bin_xoverlay_init (gpointer g_iface,
+    gpointer g_iface_data);
+static void gst_play_bin_navigation_init (gpointer g_iface,
+    gpointer g_iface_data);
+static void gst_play_bin_colorbalance_init (gpointer g_iface,
+    gpointer g_iface_data);
+
 static GType
 gst_play_bin_get_type (void)
 {
@@ -596,15 +625,39 @@ gst_play_bin_get_type (void)
       (GInstanceInitFunc) gst_play_bin_init,
       NULL
     };
+    static const GInterfaceInfo impl_info = {
+      gst_play_bin_implements_interface_init,
+      NULL, NULL
+    };
     static const GInterfaceInfo svol_info = {
       NULL, NULL, NULL
     };
+    static const GInterfaceInfo xov_info = {
+      gst_play_bin_xoverlay_init,
+      NULL, NULL
+    };
+    static const GInterfaceInfo nav_info = {
+      gst_play_bin_navigation_init,
+      NULL, NULL
+    };
+    static const GInterfaceInfo col_info = {
+      gst_play_bin_colorbalance_init,
+      NULL, NULL
+    };
 
     gst_play_bin_type = g_type_register_static (GST_TYPE_PIPELINE,
         "GstPlayBin2", &gst_play_bin_info, 0);
 
+    g_type_add_interface_static (gst_play_bin_type,
+        GST_TYPE_IMPLEMENTS_INTERFACE, &impl_info);
     g_type_add_interface_static (gst_play_bin_type, GST_TYPE_STREAM_VOLUME,
         &svol_info);
+    g_type_add_interface_static (gst_play_bin_type, GST_TYPE_X_OVERLAY,
+        &xov_info);
+    g_type_add_interface_static (gst_play_bin_type, GST_TYPE_NAVIGATION,
+        &nav_info);
+    g_type_add_interface_static (gst_play_bin_type, GST_TYPE_COLOR_BALANCE,
+        &col_info);
   }
 
   return gst_play_bin_type;
@@ -742,7 +795,7 @@ gst_play_bin_class_init (GstPlayBinClass * klass)
           GST_TYPE_ELEMENT, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
   g_object_class_install_property (gobject_klass, PROP_TEXT_SINK,
       g_param_spec_object ("text-sink", "Text plugin",
-          "the text output element to use (NULL = default textoverlay)",
+          "the text output element to use (NULL = default subtitleoverlay)",
           GST_TYPE_ELEMENT, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
   /**
@@ -811,7 +864,7 @@ gst_play_bin_class_init (GstPlayBinClass * klass)
           G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
   /**
-   * GstQueue2:ring-buffer-max-size
+   * GstPlayBin2::ring-buffer-max-size
    *
    * The maximum size of the ring buffer in bytes. If set to 0, the ring
    * buffer is disabled. Default 0.
@@ -826,6 +879,18 @@ gst_play_bin_class_init (GstPlayBinClass * klass)
           G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
   /**
+   * GstPlayBin2::force-aspect-ratio:
+   *
+   * Requests the video sink to enforce the video display aspect ratio.
+   *
+   * Since: 0.10.37
+   */
+  g_object_class_install_property (gobject_klass, PROP_FORCE_ASPECT_RATIO,
+      g_param_spec_boolean ("force-aspect-ratio", "Force Aspect Ratio",
+          "When enabled, scaling will respect original aspect ratio", TRUE,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
+  /**
    * GstPlayBin2::about-to-finish
    * @playbin: a #GstPlayBin2
    *
@@ -1200,6 +1265,13 @@ free_group (GstPlayBin * playbin, GstSourceGroup * group)
   if (group->stream_changed_pending_lock)
     g_mutex_free (group->stream_changed_pending_lock);
   group->stream_changed_pending_lock = NULL;
+
+  g_slist_free (group->suburi_flushes_to_drop);
+  group->suburi_flushes_to_drop = NULL;
+
+  if (group->suburi_flushes_to_drop_lock)
+    g_mutex_free (group->suburi_flushes_to_drop_lock);
+  group->suburi_flushes_to_drop_lock = NULL;
 }
 
 static void
@@ -1214,6 +1286,58 @@ notify_mute_cb (GObject * selector, GParamSpec * pspec, GstPlayBin * playbin)
   g_object_notify (G_OBJECT (playbin), "mute");
 }
 
+static void
+colorbalance_value_changed_cb (GstColorBalance * balance,
+    GstColorBalanceChannel * channel, gint value, GstPlayBin * playbin)
+{
+  gst_color_balance_value_changed (GST_COLOR_BALANCE (playbin), channel, value);
+}
+
+static gint
+compare_factories_func (gconstpointer p1, gconstpointer p2)
+{
+  GstPluginFeature *f1, *f2;
+  gint diff;
+  gboolean is_sink1, is_sink2;
+  gboolean is_parser1, is_parser2;
+
+  f1 = (GstPluginFeature *) p1;
+  f2 = (GstPluginFeature *) p2;
+
+  is_sink1 = gst_element_factory_list_is_type (GST_ELEMENT_FACTORY_CAST (f1),
+      GST_ELEMENT_FACTORY_TYPE_SINK);
+  is_sink2 = gst_element_factory_list_is_type (GST_ELEMENT_FACTORY_CAST (f2),
+      GST_ELEMENT_FACTORY_TYPE_SINK);
+  is_parser1 = gst_element_factory_list_is_type (GST_ELEMENT_FACTORY_CAST (f1),
+      GST_ELEMENT_FACTORY_TYPE_PARSER);
+  is_parser2 = gst_element_factory_list_is_type (GST_ELEMENT_FACTORY_CAST (f2),
+      GST_ELEMENT_FACTORY_TYPE_PARSER);
+
+  /* First we want all sinks as we prefer a sink if it directly
+   * supports the current caps */
+  if (is_sink1 && !is_sink2)
+    return -1;
+  else if (!is_sink1 && is_sink2)
+    return 1;
+
+  /* Then we want all parsers as we always want to plug parsers
+   * before decoders */
+  if (is_parser1 && !is_parser2)
+    return -1;
+  else if (!is_parser1 && is_parser2)
+    return 1;
+
+  /* And if it's a both a parser or sink we first sort by rank
+   * and then by factory name */
+  diff = gst_plugin_feature_get_rank (f2) - gst_plugin_feature_get_rank (f1);
+  if (diff != 0)
+    return diff;
+
+  diff = strcmp (f2->name, f1->name);
+
+  return diff;
+}
+
 /* Must be called with elements lock! */
 static void
 gst_play_bin_update_elements_list (GstPlayBin * playbin)
@@ -1232,8 +1356,7 @@ gst_play_bin_update_elements_list (GstPlayBin * playbin)
         gst_element_factory_list_get_elements
         (GST_ELEMENT_FACTORY_TYPE_AUDIOVIDEO_SINKS, GST_RANK_MARGINAL);
     playbin->elements = g_list_concat (res, tmp);
-    playbin->elements =
-        g_list_sort (playbin->elements, gst_plugin_feature_rank_compare_func);
+    playbin->elements = g_list_sort (playbin->elements, compare_factories_func);
     playbin->elements_cookie = gst_default_registry_get_feature_list_cookie ();
   }
 }
@@ -1257,7 +1380,9 @@ gst_play_bin_init (GstPlayBin * playbin)
   playbin->elements_lock = g_mutex_new ();
 
   /* add sink */
-  playbin->playsink = g_object_new (GST_TYPE_PLAY_SINK, NULL);
+  playbin->playsink =
+      g_object_new (GST_TYPE_PLAY_SINK, "name", "playsink", "send-event-mode",
+      1, NULL);
   gst_bin_add (GST_BIN_CAST (playbin), GST_ELEMENT_CAST (playbin->playsink));
   gst_play_sink_set_flags (playbin->playsink, DEFAULT_FLAGS);
   /* Connect to notify::volume and notify::mute signals for proxying */
@@ -1265,6 +1390,8 @@ gst_play_bin_init (GstPlayBin * playbin)
       G_CALLBACK (notify_volume_cb), playbin);
   g_signal_connect (playbin->playsink, "notify::mute",
       G_CALLBACK (notify_mute_cb), playbin);
+  g_signal_connect (playbin->playsink, "value-changed",
+      G_CALLBACK (colorbalance_value_changed_cb), playbin);
 
   playbin->current_video = DEFAULT_CURRENT_VIDEO;
   playbin->current_audio = DEFAULT_CURRENT_AUDIO;
@@ -1273,6 +1400,8 @@ gst_play_bin_init (GstPlayBin * playbin)
   playbin->buffer_duration = DEFAULT_BUFFER_DURATION;
   playbin->buffer_size = DEFAULT_BUFFER_SIZE;
   playbin->ring_buffer_max_size = DEFAULT_RING_BUFFER_MAX_SIZE;
+
+  playbin->force_aspect_ratio = TRUE;
 }
 
 static void
@@ -1567,6 +1696,28 @@ get_current_stream_number (GstPlayBin * playbin, GPtrArray * channels)
 }
 
 static gboolean
+gst_playbin2_send_custom_event (GstObject * selector, const gchar * event_name)
+{
+  GstPad *src;
+  GstPad *peer;
+  GstStructure *s;
+  GstEvent *event;
+  gboolean ret = FALSE;
+
+  src = gst_element_get_static_pad (GST_ELEMENT_CAST (selector), "src");
+  peer = gst_pad_get_peer (src);
+  if (peer) {
+    s = gst_structure_empty_new (event_name);
+    event = gst_event_new_custom (GST_EVENT_CUSTOM_DOWNSTREAM_OOB, s);
+    gst_pad_send_event (peer, event);
+    gst_object_unref (peer);
+    ret = TRUE;
+  }
+  gst_object_unref (src);
+  return ret;
+}
+
+static gboolean
 gst_play_bin_set_current_video_stream (GstPlayBin * playbin, gint stream)
 {
   GstSourceGroup *group;
@@ -1597,8 +1748,19 @@ gst_play_bin_set_current_video_stream (GstPlayBin * playbin, gint stream)
     GstObject *selector;
 
     if ((selector = gst_pad_get_parent (sinkpad))) {
-      /* activate the selected pad */
-      g_object_set (selector, "active-pad", sinkpad, NULL);
+      GstPad *old_sinkpad;
+
+      g_object_get (selector, "active-pad", &old_sinkpad, NULL);
+
+      if (old_sinkpad != sinkpad) {
+        if (gst_playbin2_send_custom_event (selector,
+                "playsink-custom-video-flush"))
+          playbin->video_pending_flush_finish = TRUE;
+
+        /* activate the selected pad */
+        g_object_set (selector, "active-pad", sinkpad, NULL);
+      }
+
       gst_object_unref (selector);
     }
     gst_object_unref (sinkpad);
@@ -1644,8 +1806,18 @@ gst_play_bin_set_current_audio_stream (GstPlayBin * playbin, gint stream)
     GstObject *selector;
 
     if ((selector = gst_pad_get_parent (sinkpad))) {
-      /* activate the selected pad */
-      g_object_set (selector, "active-pad", sinkpad, NULL);
+      GstPad *old_sinkpad;
+
+      g_object_get (selector, "active-pad", &old_sinkpad, NULL);
+
+      if (old_sinkpad != sinkpad) {
+        if (gst_playbin2_send_custom_event (selector,
+                "playsink-custom-audio-flush"))
+          playbin->audio_pending_flush_finish = TRUE;
+
+        /* activate the selected pad */
+        g_object_set (selector, "active-pad", sinkpad, NULL);
+      }
       gst_object_unref (selector);
     }
     gst_object_unref (sinkpad);
@@ -1667,24 +1839,43 @@ _suburidecodebin_blocked_cb (GstPad * pad, gboolean blocked, gpointer user_data)
 }
 
 static void
-gst_play_bin_suburidecodebin_seek_to_start (GstElement * suburidecodebin)
+gst_play_bin_suburidecodebin_seek_to_start (GstSourceGroup * group)
 {
+  GstElement *suburidecodebin = group->suburidecodebin;
   GstIterator *it = gst_element_iterate_src_pads (suburidecodebin);
   GstPad *sinkpad;
 
   if (it && gst_iterator_next (it, (gpointer) & sinkpad) == GST_ITERATOR_OK
       && sinkpad) {
     GstEvent *event;
+    guint32 seqnum;
 
     event =
-        gst_event_new_seek (1.0, GST_FORMAT_BYTES, GST_SEEK_FLAG_NONE,
+        gst_event_new_seek (1.0, GST_FORMAT_BYTES, GST_SEEK_FLAG_FLUSH,
         GST_SEEK_TYPE_SET, 0, GST_SEEK_TYPE_NONE, -1);
+    seqnum = gst_event_get_seqnum (event);
+
+    /* store the seqnum to drop flushes from this seek later */
+    g_mutex_lock (group->suburi_flushes_to_drop_lock);
+    group->suburi_flushes_to_drop =
+        g_slist_append (group->suburi_flushes_to_drop,
+        GUINT_TO_POINTER (seqnum));
+    g_mutex_unlock (group->suburi_flushes_to_drop_lock);
+
     if (!gst_pad_send_event (sinkpad, event)) {
       event =
-          gst_event_new_seek (1.0, GST_FORMAT_TIME, GST_SEEK_FLAG_NONE,
+          gst_event_new_seek (1.0, GST_FORMAT_TIME, GST_SEEK_FLAG_FLUSH,
           GST_SEEK_TYPE_SET, 0, GST_SEEK_TYPE_NONE, -1);
-      if (!gst_pad_send_event (sinkpad, event))
+      gst_event_set_seqnum (event, seqnum);
+      if (!gst_pad_send_event (sinkpad, event)) {
         GST_DEBUG_OBJECT (suburidecodebin, "Seeking to the beginning failed!");
+
+        g_mutex_lock (group->suburi_flushes_to_drop_lock);
+        group->suburi_flushes_to_drop =
+            g_slist_remove (group->suburi_flushes_to_drop,
+            GUINT_TO_POINTER (seqnum));
+        g_mutex_unlock (group->suburi_flushes_to_drop_lock);
+      }
     }
 
     gst_object_unref (sinkpad);
@@ -1765,7 +1956,7 @@ gst_play_bin_set_current_text_stream (GstPlayBin * playbin, gint stream)
 
       if (old_sinkpad != sinkpad) {
         gboolean need_unblock, need_block, need_seek;
-        GstPad *src, *peer = NULL, *oldpeer = NULL;
+        GstPad *peer = NULL, *oldpeer = NULL;
         GstElement *parent_element = NULL, *old_parent_element = NULL;
 
         /* Now check if we need to seek the suburidecodebin to the beginning
@@ -1801,32 +1992,20 @@ gst_play_bin_set_current_text_stream (GstPlayBin * playbin, gint stream)
         if (need_block)
           gst_play_bin_suburidecodebin_block (group->suburidecodebin, TRUE);
 
+        if (gst_playbin2_send_custom_event (selector,
+                "playsink-custom-subtitle-flush"))
+          playbin->text_pending_flush_finish = TRUE;
+
         /* activate the selected pad */
         g_object_set (selector, "active-pad", sinkpad, NULL);
 
-        src = gst_element_get_static_pad (GST_ELEMENT_CAST (selector), "src");
-        peer = gst_pad_get_peer (src);
-        if (peer) {
-          GstStructure *s;
-          GstEvent *event;
-          /* Flush the subtitle renderer to remove any
-           * currently displayed subtitles. This event will
-           * never travel outside subtitleoverlay!
-           */
-          s = gst_structure_empty_new ("subtitleoverlay-flush-subtitle");
-          event = gst_event_new_custom (GST_EVENT_CUSTOM_DOWNSTREAM_OOB, s);
-          gst_pad_send_event (peer, event);
-          gst_object_unref (peer);
-        }
-        gst_object_unref (src);
-
         /* Unblock pads if necessary */
         if (need_unblock)
           gst_play_bin_suburidecodebin_block (group->suburidecodebin, FALSE);
 
         /* seek to the beginning */
         if (need_seek)
-          gst_play_bin_suburidecodebin_seek_to_start (group->suburidecodebin);
+          gst_play_bin_suburidecodebin_seek_to_start (group);
       }
       gst_object_unref (selector);
 
@@ -1959,6 +2138,10 @@ gst_play_bin_set_property (GObject * object, guint prop_id,
     case PROP_RING_BUFFER_MAX_SIZE:
       playbin->ring_buffer_max_size = g_value_get_uint64 (value);
       break;
+    case PROP_FORCE_ASPECT_RATIO:
+      g_object_set (playbin->playsink, "force-aspect-ratio",
+          g_value_get_boolean (value), NULL);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
@@ -2134,6 +2317,13 @@ gst_play_bin_get_property (GObject * object, guint prop_id, GValue * value,
     case PROP_RING_BUFFER_MAX_SIZE:
       g_value_set_uint64 (value, playbin->ring_buffer_max_size);
       break;
+    case PROP_FORCE_ASPECT_RATIO:{
+      gboolean v;
+
+      g_object_get (playbin->playsink, "force-aspect-ratio", &v, NULL);
+      g_value_set_boolean (value, v);
+      break;
+    }
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
       break;
@@ -2417,23 +2607,48 @@ selector_active_pad_changed (GObject * selector, GParamSpec * pspec,
       property = "current-video";
       playbin->current_video = get_current_stream_number (playbin,
           group->video_channels);
+
+      if (playbin->video_pending_flush_finish) {
+        playbin->video_pending_flush_finish = FALSE;
+        GST_PLAY_BIN_UNLOCK (playbin);
+        gst_playbin2_send_custom_event (GST_OBJECT (selector),
+            "playsink-custom-video-flush-finish");
+        goto notify;
+      }
       break;
     case GST_PLAY_SINK_TYPE_AUDIO:
     case GST_PLAY_SINK_TYPE_AUDIO_RAW:
       property = "current-audio";
       playbin->current_audio = get_current_stream_number (playbin,
           group->audio_channels);
+
+      if (playbin->audio_pending_flush_finish) {
+        playbin->audio_pending_flush_finish = FALSE;
+        GST_PLAY_BIN_UNLOCK (playbin);
+        gst_playbin2_send_custom_event (GST_OBJECT (selector),
+            "playsink-custom-audio-flush-finish");
+        goto notify;
+      }
       break;
     case GST_PLAY_SINK_TYPE_TEXT:
       property = "current-text";
       playbin->current_text = get_current_stream_number (playbin,
           group->text_channels);
+
+      if (playbin->text_pending_flush_finish) {
+        playbin->text_pending_flush_finish = FALSE;
+        GST_PLAY_BIN_UNLOCK (playbin);
+        gst_playbin2_send_custom_event (GST_OBJECT (selector),
+            "playsink-custom-subtitle-flush-finish");
+        goto notify;
+      }
       break;
     default:
       property = NULL;
   }
   GST_PLAY_BIN_UNLOCK (playbin);
 
+notify:
   if (property)
     g_object_notify (G_OBJECT (playbin), property);
 }
@@ -2478,6 +2693,33 @@ stream_changed_data_probe (GstPad * pad, GstMiniObject * object, gpointer data)
   }
 }
 
+static gboolean
+_suburidecodebin_event_probe (GstPad * pad, GstEvent * event, gpointer udata)
+{
+  gboolean ret = TRUE;
+  GstSourceGroup *group = udata;
+
+  switch (GST_EVENT_TYPE (event)) {
+    case GST_EVENT_FLUSH_START:
+    case GST_EVENT_FLUSH_STOP:
+    {
+      guint32 seqnum = gst_event_get_seqnum (event);
+      GSList *item = g_slist_find (group->suburi_flushes_to_drop,
+          GUINT_TO_POINTER (seqnum));
+      if (item) {
+        ret = FALSE;            /* this is from subtitle seek only, drop it */
+        if (GST_EVENT_TYPE (event) == GST_EVENT_FLUSH_STOP) {
+          group->suburi_flushes_to_drop =
+              g_slist_delete_link (group->suburi_flushes_to_drop, item);
+        }
+      }
+    }
+    default:
+      break;
+  }
+  return ret;
+}
+
 /* helper function to lookup stuff in lists */
 static gboolean
 array_has_value (const gchar * values[], const gchar * value, gboolean exact)
@@ -2598,7 +2840,12 @@ pad_added_cb (GstElement * decodebin, GstPad * pad, GstSourceGroup * group)
           (_("Missing element '%s' - check your GStreamer installation."),
               "input-selector"), (NULL));
     } else {
-      g_object_set (select->selector, "sync-streams", TRUE, NULL);
+      /* sync-mode=1, use clock */
+      if (select->type == GST_PLAY_SINK_TYPE_TEXT)
+        g_object_set (select->selector, "sync-streams", TRUE,
+            "sync-mode", 1, "cache-buffers", TRUE, NULL);
+      else
+        g_object_set (select->selector, "sync-streams", TRUE, NULL);
 
       g_signal_connect (select->selector, "notify::active-pad",
           G_CALLBACK (selector_active_pad_changed), playbin);
@@ -2673,9 +2920,18 @@ pad_added_cb (GstElement * decodebin, GstPad * pad, GstSourceGroup * group)
      * the sink. */
     changed = FALSE;
     sinkpad = NULL;
+
+    /* store the selector for the pad */
+    g_object_set_data (G_OBJECT (pad), "playbin2.select", select);
   }
   GST_SOURCE_GROUP_UNLOCK (group);
 
+  if (decodebin == group->suburidecodebin) {
+    /* to avoid propagating flushes from suburi specific seeks */
+    gst_pad_add_event_probe (pad, (GCallback) _suburidecodebin_event_probe,
+        group);
+  }
+
   if (changed) {
     int signal;
     gboolean always_ok = (decodebin == group->suburidecodebin);
@@ -2745,6 +3001,15 @@ pad_removed_cb (GstElement * decodebin, GstPad * pad, GstSourceGroup * group)
       "pad %s:%s removed from group %p", GST_DEBUG_PAD_NAME (pad), group);
 
   GST_SOURCE_GROUP_LOCK (group);
+
+  if ((select = g_object_get_data (G_OBJECT (pad), "playbin2.select"))) {
+    g_assert (select->selector == NULL);
+    g_assert (select->srcpad == pad);
+    gst_object_unref (pad);
+    select->srcpad = NULL;
+    goto exit;
+  }
+
   /* get the selector sinkpad */
   if (!(peer = g_object_get_data (G_OBJECT (pad), "playbin2.sinkpad")))
     goto not_linked;
@@ -2762,6 +3027,16 @@ pad_removed_cb (GstElement * decodebin, GstPad * pad, GstSourceGroup * group)
     /* remove the pad from the array */
     g_ptr_array_remove (select->channels, peer);
     GST_DEBUG_OBJECT (playbin, "pad %p removed from array", peer);
+
+    if (!select->channels->len && select->selector) {
+      GST_DEBUG_OBJECT (playbin, "all selector sinkpads removed");
+      GST_DEBUG_OBJECT (playbin, "removing selector %p", select->selector);
+      gst_object_unref (select->srcpad);
+      select->srcpad = NULL;
+      gst_element_set_state (select->selector, GST_STATE_NULL);
+      gst_bin_remove (GST_BIN_CAST (playbin), select->selector);
+      select->selector = NULL;
+    }
   }
 
   /* unlink the pad now (can fail, the pad is unlinked before it's removed) */
@@ -2781,6 +3056,7 @@ pad_removed_cb (GstElement * decodebin, GstPad * pad, GstSourceGroup * group)
   gst_object_unref (peer);
 
   gst_object_unref (selector);
+exit:
   GST_SOURCE_GROUP_UNLOCK (group);
 
   return;
@@ -2835,7 +3111,17 @@ no_more_pads_cb (GstElement * decodebin, GstSourceGroup * group)
       GST_DEBUG_OBJECT (playbin, "requesting new sink pad %d", select->type);
       select->sinkpad =
           gst_play_sink_request_pad (playbin->playsink, select->type);
-
+    } else if (select->srcpad && select->sinkpad) {
+      GST_DEBUG_OBJECT (playbin, "refreshing new sink pad %d", select->type);
+      gst_play_sink_refresh_pad (playbin->playsink, select->sinkpad,
+          select->type);
+    } else if (select->sinkpad && select->srcpad == NULL) {
+      GST_DEBUG_OBJECT (playbin, "releasing sink pad %d", select->type);
+      gst_play_sink_release_pad (playbin->playsink, select->sinkpad);
+      select->sinkpad = NULL;
+    }
+    if (select->sinkpad && select->srcpad &&
+        !gst_pad_is_linked (select->srcpad)) {
       res = gst_pad_link (select->srcpad, select->sinkpad);
       GST_DEBUG_OBJECT (playbin, "linked type %s, result: %d",
           select->media_list[0], res);
@@ -3130,7 +3416,6 @@ autoplug_continue_cb (GstElement * element, GstPad * pad, GstCaps * caps,
   GstElement *sink;
   GstPad *sinkpad = NULL;
 
-  GST_PLAY_BIN_LOCK (group->playbin);
   GST_SOURCE_GROUP_LOCK (group);
 
   if ((sink = group->playbin->text_sink))
@@ -3207,7 +3492,6 @@ autoplug_continue_cb (GstElement * element, GstPad * pad, GstCaps * caps,
 
 done:
   GST_SOURCE_GROUP_UNLOCK (group);
-  GST_PLAY_BIN_UNLOCK (group->playbin);
 
   GST_DEBUG_OBJECT (group->playbin,
       "continue autoplugging group %p for %s:%s, %" GST_PTR_FORMAT ": %d",
@@ -3489,11 +3773,19 @@ activate_group (GstPlayBin * playbin, GstSourceGroup * group, GstState target)
   if (!group->stream_changed_pending_lock)
     group->stream_changed_pending_lock = g_mutex_new ();
 
+  g_slist_free (group->suburi_flushes_to_drop);
+  group->suburi_flushes_to_drop = NULL;
+  if (!group->suburi_flushes_to_drop_lock)
+    group->suburi_flushes_to_drop_lock = g_mutex_new ();
+
   if (group->uridecodebin) {
     GST_DEBUG_OBJECT (playbin, "reusing existing uridecodebin");
     uridecodebin = group->uridecodebin;
     gst_element_set_state (uridecodebin, GST_STATE_READY);
-    gst_bin_add (GST_BIN_CAST (playbin), gst_object_ref (uridecodebin));
+    /* no need to take extra ref, we already have one
+     * and the bin will add one since it is no longer floating,
+     * as it was at least added once before (below) */
+    gst_bin_add (GST_BIN_CAST (playbin), uridecodebin);
   } else {
     GST_DEBUG_OBJECT (playbin, "making new uridecodebin");
     uridecodebin = gst_element_factory_make ("uridecodebin", NULL);
@@ -3556,7 +3848,10 @@ activate_group (GstPlayBin * playbin, GstSourceGroup * group, GstState target)
       GST_DEBUG_OBJECT (playbin, "reusing existing suburidecodebin");
       suburidecodebin = group->suburidecodebin;
       gst_element_set_state (suburidecodebin, GST_STATE_READY);
-      gst_bin_add (GST_BIN_CAST (playbin), gst_object_ref (suburidecodebin));
+      /* no need to take extra ref, we already have one
+       * and the bin will add one since it is no longer floating,
+       * as it was at least added once before (below) */
+      gst_bin_add (GST_BIN_CAST (playbin), suburidecodebin);
     } else {
       GST_DEBUG_OBJECT (playbin, "making new suburidecodebin");
       suburidecodebin = gst_element_factory_make ("uridecodebin", NULL);
@@ -3679,6 +3974,8 @@ uridecodebin_failure:
     }
     group->video_sink = NULL;
 
+    gst_bin_remove (GST_BIN_CAST (playbin), uridecodebin);
+
     GST_DEBUG_OBJECT (playbin, "failed state change of uridecodebin");
     return FALSE;
   }
@@ -4017,6 +4314,137 @@ failure:
   }
 }
 
+static void
+gst_play_bin_xoverlay_expose (GstXOverlay * overlay)
+{
+  GstPlayBin *playbin = GST_PLAY_BIN (overlay);
+
+  gst_x_overlay_expose (GST_X_OVERLAY (playbin->playsink));
+}
+
+static void
+gst_play_bin_xoverlay_handle_events (GstXOverlay * overlay,
+    gboolean handle_events)
+{
+  GstPlayBin *playbin = GST_PLAY_BIN (overlay);
+
+  gst_x_overlay_handle_events (GST_X_OVERLAY (playbin->playsink),
+      handle_events);
+}
+
+static void
+gst_play_bin_xoverlay_set_render_rectangle (GstXOverlay * overlay, gint x,
+    gint y, gint width, gint height)
+{
+  GstPlayBin *playbin = GST_PLAY_BIN (overlay);
+
+  gst_x_overlay_set_render_rectangle (GST_X_OVERLAY (playbin->playsink), x, y,
+      width, height);
+}
+
+static void
+gst_play_bin_xoverlay_set_window_handle (GstXOverlay * overlay, guintptr handle)
+{
+  GstPlayBin *playbin = GST_PLAY_BIN (overlay);
+
+  gst_x_overlay_set_window_handle (GST_X_OVERLAY (playbin->playsink), handle);
+}
+
+static void
+gst_play_bin_xoverlay_init (gpointer g_iface, gpointer g_iface_data)
+{
+  GstXOverlayClass *iface = (GstXOverlayClass *) g_iface;
+  iface->expose = gst_play_bin_xoverlay_expose;
+  iface->handle_events = gst_play_bin_xoverlay_handle_events;
+  iface->set_render_rectangle = gst_play_bin_xoverlay_set_render_rectangle;
+  iface->set_window_handle = gst_play_bin_xoverlay_set_window_handle;
+}
+
+static gboolean
+gst_play_bin_implements_interface_supported (GstImplementsInterface * iface,
+    GType type)
+{
+  if (type == GST_TYPE_X_OVERLAY || type == GST_TYPE_STREAM_VOLUME ||
+      type == GST_TYPE_NAVIGATION || type == GST_TYPE_COLOR_BALANCE)
+    return TRUE;
+  else
+    return FALSE;
+}
+
+static void
+gst_play_bin_implements_interface_init (gpointer g_iface, gpointer g_iface_data)
+{
+  GstImplementsInterfaceClass *iface = (GstImplementsInterfaceClass *) g_iface;
+  iface->supported = gst_play_bin_implements_interface_supported;
+}
+
+static void
+gst_play_bin_navigation_send_event (GstNavigation * navigation,
+    GstStructure * structure)
+{
+  GstPlayBin *playbin = GST_PLAY_BIN (navigation);
+
+  gst_navigation_send_event (GST_NAVIGATION (playbin->playsink), structure);
+}
+
+static void
+gst_play_bin_navigation_init (gpointer g_iface, gpointer g_iface_data)
+{
+  GstNavigationInterface *iface = (GstNavigationInterface *) g_iface;
+
+  iface->send_event = gst_play_bin_navigation_send_event;
+}
+
+static const GList *
+gst_play_bin_colorbalance_list_channels (GstColorBalance * balance)
+{
+  GstPlayBin *playbin = GST_PLAY_BIN (balance);
+
+  return
+      gst_color_balance_list_channels (GST_COLOR_BALANCE (playbin->playsink));
+}
+
+static void
+gst_play_bin_colorbalance_set_value (GstColorBalance * balance,
+    GstColorBalanceChannel * channel, gint value)
+{
+  GstPlayBin *playbin = GST_PLAY_BIN (balance);
+
+  gst_color_balance_set_value (GST_COLOR_BALANCE (playbin->playsink), channel,
+      value);
+}
+
+static gint
+gst_play_bin_colorbalance_get_value (GstColorBalance * balance,
+    GstColorBalanceChannel * channel)
+{
+  GstPlayBin *playbin = GST_PLAY_BIN (balance);
+
+  return gst_color_balance_get_value (GST_COLOR_BALANCE (playbin->playsink),
+      channel);
+}
+
+static GstColorBalanceType
+gst_play_bin_colorbalance_get_balance_type (GstColorBalance * balance)
+{
+  GstPlayBin *playbin = GST_PLAY_BIN (balance);
+
+  return
+      gst_color_balance_get_balance_type (GST_COLOR_BALANCE
+      (playbin->playsink));
+}
+
+static void
+gst_play_bin_colorbalance_init (gpointer g_iface, gpointer g_iface_data)
+{
+  GstColorBalanceClass *iface = (GstColorBalanceClass *) g_iface;
+
+  iface->list_channels = gst_play_bin_colorbalance_list_channels;
+  iface->set_value = gst_play_bin_colorbalance_set_value;
+  iface->get_value = gst_play_bin_colorbalance_get_value;
+  iface->get_balance_type = gst_play_bin_colorbalance_get_balance_type;
+}
+
 gboolean
 gst_play_bin2_plugin_init (GstPlugin * plugin)
 {
diff --git a/gst/playback/gstplaysink.c b/gst/playback/gstplaysink.c
index d02ec60..fd922df 100644
--- a/gst/playback/gstplaysink.c
+++ b/gst/playback/gstplaysink.c
@@ -32,6 +32,10 @@
 #include <gst/gst-i18n-plugin.h>
 #include <gst/pbutils/pbutils.h>
 #include <gst/video/video.h>
+#include <gst/interfaces/streamvolume.h>
+#include <gst/interfaces/colorbalance.h>
+#include <gst/interfaces/xoverlay.h>
+#include <gst/interfaces/navigation.h>
 
 #include "gstplaysink.h"
 #include "gststreamsynchronizer.h"
@@ -44,10 +48,45 @@ GST_DEBUG_CATEGORY_STATIC (gst_play_sink_debug);
 #define VOLUME_MAX_DOUBLE 10.0
 
 #define DEFAULT_FLAGS             GST_PLAY_FLAG_AUDIO | GST_PLAY_FLAG_VIDEO | GST_PLAY_FLAG_TEXT | \
-                                  GST_PLAY_FLAG_SOFT_VOLUME
+                                  GST_PLAY_FLAG_SOFT_VOLUME | GST_PLAY_FLAG_SOFT_COLORBALANCE
 
 #define GST_PLAY_CHAIN(c) ((GstPlayChain *)(c))
 
+/* enum types */
+/**
+ * GstPlaySinkSendEventMode:
+ * @MODE_DEFAULT: default GstBin's send_event handling
+ * @MODE_FIRST: send event only to the first sink that return true
+ *
+ * Send event handling to use
+ */
+typedef enum
+{
+  MODE_DEFAULT = 0,
+  MODE_FIRST = 1
+} GstPlaySinkSendEventMode;
+
+
+#define GST_TYPE_PLAY_SINK_SEND_EVENT_MODE (gst_play_sink_send_event_mode_get_type ())
+static GType
+gst_play_sink_send_event_mode_get_type (void)
+{
+  static GType gtype = 0;
+
+  if (gtype == 0) {
+    static const GEnumValue values[] = {
+      {MODE_DEFAULT, "Default GstBin's send_event handling (default)",
+          "default"},
+      {MODE_FIRST, "Sends the event to sinks until the first one handles it",
+          "first"},
+      {0, NULL, NULL}
+    };
+
+    gtype = g_enum_register_static ("GstPlaySinkSendEventMode", values);
+  }
+  return gtype;
+}
+
 /* holds the common data fields for the audio and video pipelines. We keep them
  * in a structure to more easily have all the info available. */
 typedef struct
@@ -203,6 +242,41 @@ struct _GstPlaySink
   gboolean volume_changed;      /* volume/mute changed while no audiochain */
   gboolean mute_changed;        /* ... has been created yet */
   gint64 av_offset;
+  GstPlaySinkSendEventMode send_event_mode;
+  gboolean force_aspect_ratio;
+
+  /* xoverlay proxy interface */
+  GstXOverlay *xoverlay_element;        /* protected with LOCK */
+  gboolean xoverlay_handle_set;
+  guintptr xoverlay_handle;
+  gboolean xoverlay_render_rectangle_set;
+  gint xoverlay_x, xoverlay_y, xoverlay_width, xoverlay_height;
+  gboolean xoverlay_handle_events_set;
+  gboolean xoverlay_handle_events;
+
+  /* colorbalance proxy interface */
+  GstColorBalance *colorbalance_element;
+  GList *colorbalance_channels; /* CONTRAST, BRIGHTNESS, HUE, SATURATION */
+  gint colorbalance_values[4];
+
+  /* sending audio/video flushes break stream changes when the pipeline
+   * is paused and played again in 0.10 */
+#if 0
+  GstSegment video_segment;
+  gboolean video_custom_flush_finished;
+  gboolean video_ignore_wrong_state;
+  gboolean video_pending_flush;
+
+  GstSegment audio_segment;
+  gboolean audio_custom_flush_finished;
+  gboolean audio_ignore_wrong_state;
+  gboolean audio_pending_flush;
+#endif
+
+  GstSegment text_segment;
+  gboolean text_custom_flush_finished;
+  gboolean text_ignore_wrong_state;
+  gboolean text_pending_flush;
 };
 
 struct _GstPlaySinkClass
@@ -258,6 +332,8 @@ enum
   PROP_VIDEO_SINK,
   PROP_AUDIO_SINK,
   PROP_TEXT_SINK,
+  PROP_SEND_EVENT_MODE,
+  PROP_FORCE_ASPECT_RATIO,
   PROP_LAST
 };
 
@@ -285,6 +361,20 @@ static GstStateChangeReturn gst_play_sink_change_state (GstElement * element,
 
 static void gst_play_sink_handle_message (GstBin * bin, GstMessage * message);
 
+/* sending audio/video flushes break stream changes when the pipeline
+ * is paused and played again in 0.10 */
+#if 0
+static gboolean gst_play_sink_video_sink_event (GstPad * pad, GstEvent * event);
+static GstFlowReturn gst_play_sink_video_sink_chain (GstPad * pad,
+    GstBuffer * buffer);
+static gboolean gst_play_sink_audio_sink_event (GstPad * pad, GstEvent * event);
+static GstFlowReturn gst_play_sink_audio_sink_chain (GstPad * pad,
+    GstBuffer * buffer);
+#endif
+static gboolean gst_play_sink_text_sink_event (GstPad * pad, GstEvent * event);
+static GstFlowReturn gst_play_sink_text_sink_chain (GstPad * pad,
+    GstBuffer * buffer);
+
 static void notify_volume_cb (GObject * object, GParamSpec * pspec,
     GstPlaySink * playsink);
 static void notify_mute_cb (GObject * object, GParamSpec * pspec,
@@ -292,6 +382,12 @@ static void notify_mute_cb (GObject * object, GParamSpec * pspec,
 
 static void update_av_offset (GstPlaySink * playsink);
 
+static gboolean gst_play_sink_do_reconfigure (GstPlaySink * playsink);
+static void sinkpad_blocked_cb (GstPad * blockedpad, gboolean blocked,
+    gpointer user_data);
+
+static GQuark _playsink_reset_segment_event_marker_id = 0;
+
 void
 gst_play_marshal_BUFFER__BOXED (GClosure * closure,
     GValue * return_value G_GNUC_UNUSED,
@@ -325,7 +421,47 @@ gst_play_marshal_BUFFER__BOXED (GClosure * closure,
 
 /* static guint gst_play_sink_signals[LAST_SIGNAL] = { 0 }; */
 
-G_DEFINE_TYPE (GstPlaySink, gst_play_sink, GST_TYPE_BIN);
+static void gst_play_sink_implements_interface_init (gpointer g_iface,
+    gpointer g_iface_data);
+static void gst_play_sink_xoverlay_init (gpointer g_iface,
+    gpointer g_iface_data);
+static void gst_play_sink_navigation_init (gpointer g_iface,
+    gpointer g_iface_data);
+static void gst_play_sink_colorbalance_init (gpointer g_iface,
+    gpointer g_iface_data);
+
+static void
+_do_init (GType type)
+{
+  static const GInterfaceInfo impl_info = {
+    gst_play_sink_implements_interface_init,
+    NULL, NULL
+  };
+  static const GInterfaceInfo svol_info = {
+    NULL, NULL, NULL
+  };
+  static const GInterfaceInfo xov_info = {
+    gst_play_sink_xoverlay_init,
+    NULL, NULL
+  };
+  static const GInterfaceInfo nav_info = {
+    gst_play_sink_navigation_init,
+    NULL, NULL
+  };
+  static const GInterfaceInfo col_info = {
+    gst_play_sink_colorbalance_init,
+    NULL, NULL
+  };
+
+  g_type_add_interface_static (type, GST_TYPE_IMPLEMENTS_INTERFACE, &impl_info);
+  g_type_add_interface_static (type, GST_TYPE_STREAM_VOLUME, &svol_info);
+  g_type_add_interface_static (type, GST_TYPE_X_OVERLAY, &xov_info);
+  g_type_add_interface_static (type, GST_TYPE_NAVIGATION, &nav_info);
+  g_type_add_interface_static (type, GST_TYPE_COLOR_BALANCE, &col_info);
+}
+
+G_DEFINE_TYPE_WITH_CODE (GstPlaySink, gst_play_sink, GST_TYPE_BIN,
+    _do_init (g_define_type_id));
 
 static void
 gst_play_sink_class_init (GstPlaySinkClass * klass)
@@ -437,6 +573,7 @@ gst_play_sink_class_init (GstPlaySinkClass * klass)
       g_param_spec_object ("audio-sink", "Audio Sink",
           "the audio output element to use (NULL = default sink)",
           GST_TYPE_ELEMENT, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
   /**
    * GstPlaySink:text-sink:
    *
@@ -447,9 +584,35 @@ gst_play_sink_class_init (GstPlaySinkClass * klass)
    */
   g_object_class_install_property (gobject_klass, PROP_TEXT_SINK,
       g_param_spec_object ("text-sink", "Text sink",
-          "the text output element to use (NULL = default textoverlay)",
+          "the text output element to use (NULL = default subtitleoverlay)",
           GST_TYPE_ELEMENT, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
+  /**
+   * GstPlaySink::send-event-mode:
+   *
+   * Sets the handling method used for events received from send_event
+   * function. The default is %MODE_DEFAULT, that uses %GstBin's default
+   * handling (push the event to all internal sinks).
+   *
+   * Since: 0.10.37
+   */
+  g_object_class_install_property (gobject_klass, PROP_SEND_EVENT_MODE,
+      g_param_spec_enum ("send-event-mode", "Send event mode",
+          "How to send events received in send_event function",
+          GST_TYPE_PLAY_SINK_SEND_EVENT_MODE, MODE_DEFAULT,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
+  /**
+   * GstPlaySink::force-aspect-ratio:
+   *
+   * Requests the video sink to enforce the video display aspect ratio.
+   *
+   * Since: 0.10.37
+   */
+  g_object_class_install_property (gobject_klass, PROP_FORCE_ASPECT_RATIO,
+      g_param_spec_boolean ("force-aspect-ratio", "Force Aspect Ratio",
+          "When enabled, scaling will respect original aspect ratio", TRUE,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
 
   g_signal_new ("reconfigure", G_TYPE_FROM_CLASS (klass),
       G_SIGNAL_RUN_LAST | G_SIGNAL_ACTION, G_STRUCT_OFFSET (GstPlaySinkClass,
@@ -479,14 +642,11 @@ gst_play_sink_class_init (GstPlaySinkClass * klass)
 
   gst_element_class_add_static_pad_template (gstelement_klass,
       &audiorawtemplate);
-  gst_element_class_add_static_pad_template (gstelement_klass,
-      &audiotemplate);
+  gst_element_class_add_static_pad_template (gstelement_klass, &audiotemplate);
   gst_element_class_add_static_pad_template (gstelement_klass,
       &videorawtemplate);
-  gst_element_class_add_static_pad_template (gstelement_klass,
-      &videotemplate);
-  gst_element_class_add_static_pad_template (gstelement_klass,
-      &texttemplate);
+  gst_element_class_add_static_pad_template (gstelement_klass, &videotemplate);
+  gst_element_class_add_static_pad_template (gstelement_klass, &texttemplate);
   gst_element_class_set_details_simple (gstelement_klass, "Player Sink",
       "Generic/Bin/Sink",
       "Convenience sink for multiple streams",
@@ -505,11 +665,19 @@ gst_play_sink_class_init (GstPlaySinkClass * klass)
 
   klass->reconfigure = GST_DEBUG_FUNCPTR (gst_play_sink_reconfigure);
   klass->convert_frame = GST_DEBUG_FUNCPTR (gst_play_sink_convert_frame);
+
+  _playsink_reset_segment_event_marker_id =
+      g_quark_from_static_string ("gst-playsink-reset-segment-event-marker");
+
+  g_type_class_ref (GST_TYPE_STREAM_SYNCHRONIZER);
+  g_type_class_ref (GST_TYPE_COLOR_BALANCE_CHANNEL);
 }
 
 static void
 gst_play_sink_init (GstPlaySink * playsink)
 {
+  GstColorBalanceChannel *channel;
+
   /* init groups */
   playsink->video_sink = NULL;
   playsink->audio_sink = NULL;
@@ -519,6 +687,8 @@ gst_play_sink_init (GstPlaySink * playsink)
   playsink->font_desc = NULL;
   playsink->subtitle_encoding = NULL;
   playsink->flags = DEFAULT_FLAGS;
+  playsink->send_event_mode = MODE_DEFAULT;
+  playsink->force_aspect_ratio = TRUE;
 
   playsink->stream_synchronizer =
       g_object_new (GST_TYPE_STREAM_SYNCHRONIZER, NULL);
@@ -527,6 +697,46 @@ gst_play_sink_init (GstPlaySink * playsink)
 
   g_static_rec_mutex_init (&playsink->lock);
   GST_OBJECT_FLAG_SET (playsink, GST_ELEMENT_IS_SINK);
+
+  channel =
+      GST_COLOR_BALANCE_CHANNEL (g_object_new (GST_TYPE_COLOR_BALANCE_CHANNEL,
+          NULL));
+  channel->label = g_strdup ("CONTRAST");
+  channel->min_value = -1000;
+  channel->max_value = 1000;
+  playsink->colorbalance_channels =
+      g_list_append (playsink->colorbalance_channels, channel);
+  playsink->colorbalance_values[0] = 0;
+
+  channel =
+      GST_COLOR_BALANCE_CHANNEL (g_object_new (GST_TYPE_COLOR_BALANCE_CHANNEL,
+          NULL));
+  channel->label = g_strdup ("BRIGHTNESS");
+  channel->min_value = -1000;
+  channel->max_value = 1000;
+  playsink->colorbalance_channels =
+      g_list_append (playsink->colorbalance_channels, channel);
+  playsink->colorbalance_values[1] = 0;
+
+  channel =
+      GST_COLOR_BALANCE_CHANNEL (g_object_new (GST_TYPE_COLOR_BALANCE_CHANNEL,
+          NULL));
+  channel->label = g_strdup ("HUE");
+  channel->min_value = -1000;
+  channel->max_value = 1000;
+  playsink->colorbalance_channels =
+      g_list_append (playsink->colorbalance_channels, channel);
+  playsink->colorbalance_values[2] = 0;
+
+  channel =
+      GST_COLOR_BALANCE_CHANNEL (g_object_new (GST_TYPE_COLOR_BALANCE_CHANNEL,
+          NULL));
+  channel->label = g_strdup ("SATURATION");
+  channel->min_value = -1000;
+  channel->max_value = 1000;
+  playsink->colorbalance_channels =
+      g_list_append (playsink->colorbalance_channels, channel);
+  playsink->colorbalance_values[3] = 0;
 }
 
 static void
@@ -618,6 +828,11 @@ gst_play_sink_dispose (GObject * object)
 
   playsink->stream_synchronizer = NULL;
 
+  g_list_foreach (playsink->colorbalance_channels, (GFunc) gst_object_unref,
+      NULL);
+  g_list_free (playsink->colorbalance_channels);
+  playsink->colorbalance_channels = NULL;
+
   G_OBJECT_CLASS (gst_play_sink_parent_class)->dispose (object);
 }
 
@@ -1240,6 +1455,152 @@ link_failed:
   }
 }
 
+static gboolean
+is_valid_color_balance_element (GstElement * element)
+{
+  GstColorBalance *bal = GST_COLOR_BALANCE (element);
+  gboolean have_brightness = FALSE;
+  gboolean have_contrast = FALSE;
+  gboolean have_hue = FALSE;
+  gboolean have_saturation = FALSE;
+  const GList *channels, *l;
+
+  channels = gst_color_balance_list_channels (bal);
+  for (l = channels; l; l = l->next) {
+    GstColorBalanceChannel *ch = l->data;
+
+    if (g_strrstr (ch->label, "BRIGHTNESS"))
+      have_brightness = TRUE;
+    else if (g_strrstr (ch->label, "CONTRAST"))
+      have_contrast = TRUE;
+    else if (g_strrstr (ch->label, "HUE"))
+      have_hue = TRUE;
+    else if (g_strrstr (ch->label, "SATURATION"))
+      have_saturation = TRUE;
+  }
+
+  return have_brightness && have_contrast && have_hue && have_saturation;
+}
+
+static void
+iterate_color_balance_elements (gpointer data, gpointer user_data)
+{
+  gboolean valid = is_valid_color_balance_element (data);
+  GstColorBalance **cb_out = user_data;
+
+  if (valid) {
+    if (*cb_out
+        && gst_color_balance_get_balance_type (*cb_out) ==
+        GST_COLOR_BALANCE_SOFTWARE) {
+      gst_object_unref (*cb_out);
+      *cb_out = GST_COLOR_BALANCE (gst_object_ref (data));
+    } else if (!*cb_out) {
+      *cb_out = GST_COLOR_BALANCE (gst_object_ref (data));
+    }
+  }
+
+  gst_object_unref (data);
+}
+
+static GstColorBalance *
+find_color_balance_element (GstElement * element)
+{
+  GstIterator *it;
+  GstColorBalance *cb = NULL;
+
+  if (GST_IS_COLOR_BALANCE (element)
+      && is_valid_color_balance_element (element))
+    return GST_COLOR_BALANCE (gst_object_ref (element));
+  else if (!GST_IS_BIN (element))
+    return FALSE;
+
+  it = gst_bin_iterate_all_by_interface (GST_BIN (element),
+      GST_TYPE_COLOR_BALANCE);
+  while (gst_iterator_foreach (it, iterate_color_balance_elements,
+          &cb) == GST_ITERATOR_RESYNC)
+    gst_iterator_resync (it);
+  gst_iterator_free (it);
+
+  return cb;
+}
+
+static void
+colorbalance_value_changed_cb (GstColorBalance * balance,
+    GstColorBalanceChannel * channel, gint value, GstPlaySink * playsink)
+{
+  GList *l;
+  gint i;
+
+  for (i = 0, l = playsink->colorbalance_channels; l; l = l->next, i++) {
+    GstColorBalanceChannel *proxy = l->data;
+
+    if (g_strrstr (channel->label, proxy->label)) {
+      gdouble new_val;
+
+      /* Convert to [0, 1] range */
+      new_val =
+          ((gdouble) value -
+          (gdouble) channel->min_value) / ((gdouble) channel->max_value -
+          (gdouble) channel->min_value);
+      /* Convert to proxy range */
+      new_val =
+          proxy->min_value + new_val * ((gdouble) proxy->max_value -
+          (gdouble) proxy->min_value);
+      playsink->colorbalance_values[i] = (gint) (0.5 + new_val);
+
+      gst_color_balance_value_changed (GST_COLOR_BALANCE (playsink), proxy,
+          playsink->colorbalance_values[i]);
+      break;
+    }
+  }
+}
+
+static void
+update_colorbalance (GstPlaySink * playsink)
+{
+  GstColorBalance *balance = NULL;
+  GList *l;
+  gint i;
+
+  GST_OBJECT_LOCK (playsink);
+  if (playsink->colorbalance_element) {
+    balance =
+        GST_COLOR_BALANCE (gst_object_ref (playsink->colorbalance_element));
+  }
+  GST_OBJECT_UNLOCK (playsink);
+  if (!balance)
+    return;
+
+  g_signal_handlers_block_by_func (balance,
+      G_CALLBACK (colorbalance_value_changed_cb), playsink);
+
+  for (i = 0, l = playsink->colorbalance_channels; l; l = l->next, i++) {
+    GstColorBalanceChannel *proxy = l->data;
+    GstColorBalanceChannel *channel = NULL;
+    const GList *channels, *k;
+
+    channels = gst_color_balance_list_channels (balance);
+    for (k = channels; k; k = k->next) {
+      GstColorBalanceChannel *tmp = k->data;
+
+      if (g_strrstr (tmp->label, proxy->label)) {
+        channel = tmp;
+        break;
+      }
+    }
+
+    g_assert (channel);
+
+    gst_color_balance_set_value (balance, channel,
+        playsink->colorbalance_values[i]);
+  }
+
+  g_signal_handlers_unblock_by_func (balance,
+      G_CALLBACK (colorbalance_value_changed_cb), playsink);
+
+  gst_object_unref (balance);
+}
+
 /* make the element (bin) that contains the elements needed to perform
  * video display.
  *
@@ -1307,6 +1668,14 @@ gen_video_chain (GstPlaySink * playsink, gboolean raw, gboolean async)
     chain->async = TRUE;
   }
 
+  /* Make sure the aspect ratio is kept */
+  elem =
+      gst_play_sink_find_property_sinks (playsink, chain->sink,
+      "force-aspect-ratio", G_TYPE_BOOLEAN);
+  if (elem)
+    g_object_set (elem, "force-aspect-ratio", playsink->force_aspect_ratio,
+        NULL);
+
   /* find ts-offset element */
   gst_object_replace ((GstObject **) & chain->ts_offset, (GstObject *)
       gst_play_sink_find_property_sinks (playsink, chain->sink, "ts-offset",
@@ -1319,6 +1688,34 @@ gen_video_chain (GstPlaySink * playsink, gboolean raw, gboolean async)
   gst_object_ref_sink (bin);
   gst_bin_add (bin, chain->sink);
 
+  /* Get the XOverlay element */
+  {
+    GstXOverlay *xoverlay = NULL;
+
+    GST_OBJECT_LOCK (playsink);
+    if (playsink->xoverlay_element)
+      gst_object_unref (playsink->xoverlay_element);
+    playsink->xoverlay_element =
+        GST_X_OVERLAY (gst_bin_get_by_interface (GST_BIN (chain->chain.bin),
+            GST_TYPE_X_OVERLAY));
+    if (playsink->xoverlay_element)
+      xoverlay = GST_X_OVERLAY (gst_object_ref (playsink->xoverlay_element));
+    GST_OBJECT_UNLOCK (playsink);
+
+    if (xoverlay) {
+      if (playsink->xoverlay_handle_set)
+        gst_x_overlay_set_window_handle (xoverlay, playsink->xoverlay_handle);
+      if (playsink->xoverlay_handle_events_set)
+        gst_x_overlay_handle_events (xoverlay,
+            playsink->xoverlay_handle_events);
+      if (playsink->xoverlay_render_rectangle_set)
+        gst_x_overlay_set_render_rectangle (xoverlay,
+            playsink->xoverlay_x, playsink->xoverlay_y,
+            playsink->xoverlay_width, playsink->xoverlay_height);
+      gst_object_unref (xoverlay);
+    }
+  }
+
   /* decouple decoder from sink, this improves playback quite a lot since the
    * decoder can continue while the sink blocks for synchronisation. We don't
    * need a lot of buffers as this consumes a lot of memory and we don't want
@@ -1338,10 +1735,38 @@ gen_video_chain (GstPlaySink * playsink, gboolean raw, gboolean async)
     head = prev = chain->queue;
   }
 
-  if (!(playsink->flags & GST_PLAY_FLAG_NATIVE_VIDEO)) {
+  GST_OBJECT_LOCK (playsink);
+  if (playsink->colorbalance_element) {
+    g_signal_handlers_disconnect_by_func (playsink->colorbalance_element,
+        G_CALLBACK (colorbalance_value_changed_cb), playsink);
+    gst_object_unref (playsink->colorbalance_element);
+  }
+  playsink->colorbalance_element = find_color_balance_element (chain->sink);
+  if (playsink->colorbalance_element) {
+    g_signal_connect (playsink->colorbalance_element, "value-changed",
+        G_CALLBACK (colorbalance_value_changed_cb), playsink);
+  }
+  GST_OBJECT_UNLOCK (playsink);
+
+  if (!(playsink->flags & GST_PLAY_FLAG_NATIVE_VIDEO)
+      || (!playsink->colorbalance_element
+          && (playsink->flags & GST_PLAY_FLAG_SOFT_COLORBALANCE))) {
+    gboolean use_converters = !(playsink->flags & GST_PLAY_FLAG_NATIVE_VIDEO);
+    gboolean use_balance = !playsink->colorbalance_element
+        && (playsink->flags & GST_PLAY_FLAG_SOFT_COLORBALANCE);
+
     GST_DEBUG_OBJECT (playsink, "creating videoconverter");
     chain->conv =
-        g_object_new (GST_TYPE_PLAY_SINK_VIDEO_CONVERT, "name", "vconv", NULL);
+        g_object_new (GST_TYPE_PLAY_SINK_VIDEO_CONVERT, "name", "vconv",
+        "use-converters", use_converters, "use-balance", use_balance, NULL);
+
+    GST_OBJECT_LOCK (playsink);
+    if (use_balance && GST_PLAY_SINK_VIDEO_CONVERT (chain->conv)->balance)
+      playsink->colorbalance_element =
+          GST_COLOR_BALANCE (gst_object_ref (GST_PLAY_SINK_VIDEO_CONVERT
+              (chain->conv)->balance));
+    GST_OBJECT_UNLOCK (playsink);
+
     gst_bin_add (bin, chain->conv);
     if (prev) {
       if (!gst_element_link_pads_full (prev, "src", chain->conv, "sink",
@@ -1353,6 +1778,8 @@ gen_video_chain (GstPlaySink * playsink, gboolean raw, gboolean async)
     prev = chain->conv;
   }
 
+  update_colorbalance (playsink);
+
   if (prev) {
     GST_DEBUG_OBJECT (playsink, "linking to sink");
     if (!gst_element_link_pads_full (prev, "src", chain->sink, NULL,
@@ -1362,8 +1789,17 @@ gen_video_chain (GstPlaySink * playsink, gboolean raw, gboolean async)
 
   pad = gst_element_get_static_pad (head, "sink");
   chain->sinkpad = gst_ghost_pad_new ("sink", pad);
-  gst_object_unref (pad);
 
+  /* sending audio/video flushes break stream changes when the pipeline
+   * is paused and played again in 0.10 */
+#if 0
+  gst_pad_set_event_function (chain->sinkpad,
+      GST_DEBUG_FUNCPTR (gst_play_sink_video_sink_event));
+  gst_pad_set_chain_function (chain->sinkpad,
+      GST_DEBUG_FUNCPTR (gst_play_sink_video_sink_chain));
+#endif
+
+  gst_object_unref (pad);
   gst_element_add_pad (chain->chain.bin, chain->sinkpad);
 
   return chain;
@@ -1399,6 +1835,7 @@ no_sinks:
     free_chain ((GstPlayChain *) chain);
     return NULL;
   }
+
 link_failed:
   {
     GST_ELEMENT_ERROR (playsink, CORE, PAD,
@@ -1432,8 +1869,35 @@ setup_video_chain (GstPlaySink * playsink, gboolean raw, gboolean async)
   if (ret == GST_STATE_CHANGE_FAILURE)
     return FALSE;
 
-  /* find ts-offset element */
+  /* Get the XOverlay element */
+  {
+    GstXOverlay *xoverlay = NULL;
+
+    GST_OBJECT_LOCK (playsink);
+    if (playsink->xoverlay_element)
+      gst_object_unref (playsink->xoverlay_element);
+    playsink->xoverlay_element =
+        GST_X_OVERLAY (gst_bin_get_by_interface (GST_BIN (chain->chain.bin),
+            GST_TYPE_X_OVERLAY));
+    if (playsink->xoverlay_element)
+      xoverlay = GST_X_OVERLAY (gst_object_ref (playsink->xoverlay_element));
+    GST_OBJECT_UNLOCK (playsink);
+
+    if (xoverlay) {
+      if (playsink->xoverlay_handle_set)
+        gst_x_overlay_set_window_handle (xoverlay, playsink->xoverlay_handle);
+      if (playsink->xoverlay_handle_events_set)
+        gst_x_overlay_handle_events (xoverlay,
+            playsink->xoverlay_handle_events);
+      if (playsink->xoverlay_render_rectangle_set)
+        gst_x_overlay_set_render_rectangle (xoverlay,
+            playsink->xoverlay_x, playsink->xoverlay_y,
+            playsink->xoverlay_width, playsink->xoverlay_height);
+      gst_object_unref (xoverlay);
+    }
+  }
 
+  /* find ts-offset element */
   gst_object_replace ((GstObject **) & chain->ts_offset, (GstObject *)
       gst_play_sink_find_property_sinks (playsink, chain->sink, "ts-offset",
           G_TYPE_INT64));
@@ -1452,9 +1916,384 @@ setup_video_chain (GstPlaySink * playsink, gboolean raw, gboolean async)
     GST_DEBUG_OBJECT (playsink, "no async property on the sink");
     chain->async = TRUE;
   }
+
+  /* Make sure the aspect ratio is kept */
+  elem =
+      gst_play_sink_find_property_sinks (playsink, chain->sink,
+      "force-aspect-ratio", G_TYPE_BOOLEAN);
+  if (elem)
+    g_object_set (elem, "force-aspect-ratio", playsink->force_aspect_ratio,
+        NULL);
+
+  GST_OBJECT_LOCK (playsink);
+  if (playsink->colorbalance_element) {
+    g_signal_handlers_disconnect_by_func (playsink->colorbalance_element,
+        G_CALLBACK (colorbalance_value_changed_cb), playsink);
+    gst_object_unref (playsink->colorbalance_element);
+  }
+  playsink->colorbalance_element = find_color_balance_element (chain->sink);
+  if (playsink->colorbalance_element) {
+    g_signal_connect (playsink->colorbalance_element, "value-changed",
+        G_CALLBACK (colorbalance_value_changed_cb), playsink);
+  }
+  GST_OBJECT_UNLOCK (playsink);
+
+  if (chain->conv) {
+    gboolean use_balance = !playsink->colorbalance_element
+        && (playsink->flags & GST_PLAY_FLAG_SOFT_COLORBALANCE);
+
+    g_object_set (chain->conv, "use-balance", use_balance, NULL);
+
+    GST_OBJECT_LOCK (playsink);
+    if (use_balance && GST_PLAY_SINK_VIDEO_CONVERT (chain->conv)->balance)
+      playsink->colorbalance_element =
+          GST_COLOR_BALANCE (gst_object_ref (GST_PLAY_SINK_VIDEO_CONVERT
+              (chain->conv)->balance));
+    GST_OBJECT_UNLOCK (playsink);
+  }
+
+  update_colorbalance (playsink);
+
   return TRUE;
 }
 
+static void
+gst_play_sink_generate_update_newsegment_event (GstPad * pad,
+    GstSegment * segment, GstEvent ** event1, GstEvent ** event2)
+{
+  GstEvent *event;
+
+  *event1 = NULL;
+  *event2 = NULL;
+
+  event = gst_event_new_new_segment_full (FALSE, segment->rate,
+      segment->applied_rate, segment->format, 0, GST_CLOCK_TIME_NONE, 0);
+  gst_structure_id_set (event->structure,
+      _playsink_reset_segment_event_marker_id, G_TYPE_BOOLEAN, TRUE, NULL);
+  *event1 = event;
+
+  event = gst_event_new_new_segment_full (FALSE, segment->rate,
+      segment->applied_rate, segment->format,
+      segment->start, segment->stop, segment->time);
+  gst_structure_id_set (event->structure,
+      _playsink_reset_segment_event_marker_id, G_TYPE_BOOLEAN, TRUE, NULL);
+  *event2 = event;
+}
+
+static gboolean
+gst_play_sink_sink_event (GstPad * pad, GstEvent * event,
+    const gchar * sink_type,
+    gboolean * sink_ignore_wrong_state,
+    gboolean * sink_custom_flush_finished,
+    gboolean * sink_pending_flush, GstSegment * sink_segment)
+{
+  GstBin *tbin = GST_BIN_CAST (gst_pad_get_parent (pad));
+  GstPlaySink *playsink = GST_PLAY_SINK_CAST (gst_pad_get_parent (tbin));
+  gboolean ret;
+
+  if (GST_EVENT_TYPE (event) == GST_EVENT_CUSTOM_DOWNSTREAM_OOB &&
+      event->structure) {
+    gchar *custom_flush;
+    gchar *custom_flush_finish;
+
+    custom_flush = g_strdup_printf ("playsink-custom-%s-flush", sink_type);
+    custom_flush_finish =
+        g_strdup_printf ("playsink-custom-%s-flush-finish", sink_type);
+    if (strcmp (gst_structure_get_name (event->structure), custom_flush) == 0) {
+      GST_DEBUG_OBJECT (pad,
+          "Custom %s flush event received, marking to flush %s", sink_type,
+          sink_type);
+      GST_PLAY_SINK_LOCK (playsink);
+      *sink_ignore_wrong_state = TRUE;
+      *sink_custom_flush_finished = FALSE;
+      GST_PLAY_SINK_UNLOCK (playsink);
+    } else if (strcmp (gst_structure_get_name (event->structure),
+            custom_flush_finish) == 0) {
+      GST_DEBUG_OBJECT (pad, "Custom %s flush finish event received",
+          sink_type);
+      GST_PLAY_SINK_LOCK (playsink);
+      *sink_pending_flush = TRUE;
+      *sink_custom_flush_finished = TRUE;
+      GST_PLAY_SINK_UNLOCK (playsink);
+    }
+
+    g_free (custom_flush);
+    g_free (custom_flush_finish);
+  } else if (GST_EVENT_TYPE (event) == GST_EVENT_FLUSH_STOP) {
+    GST_PLAY_SINK_LOCK (playsink);
+    GST_DEBUG_OBJECT (pad, "Resetting %s segment because of flush-stop event",
+        sink_type);
+    gst_segment_init (sink_segment, GST_FORMAT_UNDEFINED);
+    GST_PLAY_SINK_UNLOCK (playsink);
+  }
+
+  GST_DEBUG_OBJECT (pad, "Forwarding event %" GST_PTR_FORMAT, event);
+  ret = gst_proxy_pad_event_default (pad, gst_event_ref (event));
+
+  if (GST_EVENT_TYPE (event) == GST_EVENT_NEWSEGMENT) {
+    gboolean update;
+    gdouble rate, applied_rate;
+    GstFormat format;
+    gint64 start, stop, position;
+
+    GST_DEBUG_OBJECT (pad, "Newsegment event: %" GST_PTR_FORMAT,
+        event->structure);
+    gst_event_parse_new_segment_full (event, &update, &rate, &applied_rate,
+        &format, &start, &stop, &position);
+
+    GST_PLAY_SINK_LOCK (playsink);
+    if (sink_segment->format != format) {
+      GST_DEBUG_OBJECT (pad, "%s segment format changed: %s -> %s",
+          sink_type,
+          gst_format_get_name (sink_segment->format),
+          gst_format_get_name (format));
+      gst_segment_init (sink_segment, format);
+    }
+
+    GST_DEBUG_OBJECT (pad, "Old %s segment: %" GST_SEGMENT_FORMAT,
+        sink_type, sink_segment);
+    gst_segment_set_newsegment_full (sink_segment, update, rate,
+        applied_rate, format, start, stop, position);
+    GST_DEBUG_OBJECT (pad, "New %s segment: %" GST_SEGMENT_FORMAT,
+        sink_type, sink_segment);
+    GST_PLAY_SINK_UNLOCK (playsink);
+  }
+
+  gst_event_unref (event);
+  gst_object_unref (playsink);
+  gst_object_unref (tbin);
+  return ret;
+}
+
+static GstFlowReturn
+gst_play_sink_sink_chain (GstPad * pad, GstBuffer * buffer,
+    const gchar * sink_type,
+    gboolean * sink_ignore_wrong_state,
+    gboolean * sink_custom_flush_finished,
+    gboolean * sink_pending_flush, GstSegment * sink_segment)
+{
+  GstBin *tbin = GST_BIN_CAST (gst_pad_get_parent (pad));
+  GstPlaySink *playsink = GST_PLAY_SINK_CAST (gst_pad_get_parent (tbin));
+  GstFlowReturn ret;
+
+  GST_PLAY_SINK_LOCK (playsink);
+
+  if (*sink_pending_flush) {
+    GstSegment segment_copy;
+    GstEvent *event;
+
+    *sink_pending_flush = FALSE;
+
+    /* sink_segment will be updated in flush */
+    segment_copy = *sink_segment;
+
+    GST_PLAY_SINK_UNLOCK (playsink);
+
+    /* make the bin drop all cached data.
+     * This event will be dropped on the src pad, if any. */
+    event = gst_event_new_flush_start ();
+    if (!event->structure) {
+      event->structure =
+          gst_structure_id_empty_new (_playsink_reset_segment_event_marker_id);
+      gst_structure_set_parent_refcount (event->structure,
+          &event->mini_object.refcount);
+    }
+    gst_structure_id_set (event->structure,
+        _playsink_reset_segment_event_marker_id, G_TYPE_BOOLEAN, TRUE, NULL);
+
+    GST_DEBUG_OBJECT (pad,
+        "Pushing %s flush-start event with reset segment marker set: %"
+        GST_PTR_FORMAT, sink_type, event);
+    gst_pad_send_event (pad, event);
+
+    event = gst_event_new_flush_stop ();
+    if (!event->structure) {
+      event->structure =
+          gst_structure_id_empty_new (_playsink_reset_segment_event_marker_id);
+      gst_structure_set_parent_refcount (event->structure,
+          &event->mini_object.refcount);
+    }
+    gst_structure_id_set (event->structure,
+        _playsink_reset_segment_event_marker_id, G_TYPE_BOOLEAN, TRUE, NULL);
+
+    GST_DEBUG_OBJECT (pad,
+        "Pushing %s flush-stop event with reset segment marker set: %"
+        GST_PTR_FORMAT, sink_type, event);
+    gst_pad_send_event (pad, event);
+
+    /* Re-sync queue segment info after flush.
+     * This event will be dropped on the src pad, if any. */
+    if (segment_copy.format != GST_FORMAT_UNDEFINED) {
+      GstEvent *event1, *event2;
+
+      gst_play_sink_generate_update_newsegment_event (pad, &segment_copy,
+          &event1, &event2);
+      GST_DEBUG_OBJECT (playsink,
+          "Pushing %s accumulate newsegment event with reset "
+          "segment marker set: %" GST_PTR_FORMAT, sink_type, event1->structure);
+      GST_DEBUG_OBJECT (playsink,
+          "Pushing %s update newsegment event with reset "
+          "segment marker set: %" GST_PTR_FORMAT, sink_type, event2->structure);
+      gst_pad_send_event (pad, event1);
+      gst_pad_send_event (pad, event2);
+    }
+  } else {
+    GST_PLAY_SINK_UNLOCK (playsink);
+  }
+
+  ret = gst_proxy_pad_chain_default (pad, buffer);
+
+  GST_PLAY_SINK_LOCK (playsink);
+  if (ret == GST_FLOW_WRONG_STATE && *sink_ignore_wrong_state) {
+    GST_DEBUG_OBJECT (pad, "Ignoring wrong state for %s during flush",
+        sink_type);
+    if (*sink_custom_flush_finished) {
+      GST_DEBUG_OBJECT (pad, "Custom flush finished, stop ignoring "
+          "wrong state for %s", sink_type);
+      *sink_ignore_wrong_state = FALSE;
+    }
+
+    ret = GST_FLOW_OK;
+  }
+  GST_PLAY_SINK_UNLOCK (playsink);
+
+  gst_object_unref (playsink);
+  gst_object_unref (tbin);
+  return ret;
+}
+
+/* sending audio/video flushes break stream changes when the pipeline
+ * is paused and played again in 0.10 */
+#if 0
+static gboolean
+gst_play_sink_video_sink_event (GstPad * pad, GstEvent * event)
+{
+  GstBin *tbin = GST_BIN_CAST (gst_pad_get_parent (pad));
+  GstPlaySink *playsink = GST_PLAY_SINK_CAST (gst_pad_get_parent (tbin));
+  gboolean ret;
+
+  ret = gst_play_sink_sink_event (pad, event, "video",
+      &playsink->video_ignore_wrong_state,
+      &playsink->video_custom_flush_finished,
+      &playsink->video_pending_flush, &playsink->video_segment);
+
+  gst_object_unref (playsink);
+  gst_object_unref (tbin);
+  return ret;
+}
+
+static GstFlowReturn
+gst_play_sink_video_sink_chain (GstPad * pad, GstBuffer * buffer)
+{
+  GstBin *tbin = GST_BIN_CAST (gst_pad_get_parent (pad));
+  GstPlaySink *playsink = GST_PLAY_SINK_CAST (gst_pad_get_parent (tbin));
+  gboolean ret;
+
+  ret = gst_play_sink_sink_chain (pad, buffer, "video",
+      &playsink->video_ignore_wrong_state,
+      &playsink->video_custom_flush_finished,
+      &playsink->video_pending_flush, &playsink->video_segment);
+
+  gst_object_unref (playsink);
+  gst_object_unref (tbin);
+  return ret;
+}
+
+static gboolean
+gst_play_sink_audio_sink_event (GstPad * pad, GstEvent * event)
+{
+  GstBin *tbin = GST_BIN_CAST (gst_pad_get_parent (pad));
+  GstPlaySink *playsink = GST_PLAY_SINK_CAST (gst_pad_get_parent (tbin));
+  gboolean ret;
+
+  ret = gst_play_sink_sink_event (pad, event, "audio",
+      &playsink->audio_ignore_wrong_state,
+      &playsink->audio_custom_flush_finished,
+      &playsink->audio_pending_flush, &playsink->audio_segment);
+
+  gst_object_unref (playsink);
+  gst_object_unref (tbin);
+  return ret;
+}
+
+static GstFlowReturn
+gst_play_sink_audio_sink_chain (GstPad * pad, GstBuffer * buffer)
+{
+  GstBin *tbin = GST_BIN_CAST (gst_pad_get_parent (pad));
+  GstPlaySink *playsink = GST_PLAY_SINK_CAST (gst_pad_get_parent (tbin));
+  gboolean ret;
+
+  ret = gst_play_sink_sink_chain (pad, buffer, "audio",
+      &playsink->audio_ignore_wrong_state,
+      &playsink->audio_custom_flush_finished,
+      &playsink->audio_pending_flush, &playsink->audio_segment);
+
+  gst_object_unref (playsink);
+  gst_object_unref (tbin);
+  return ret;
+}
+#endif
+
+static gboolean
+gst_play_sink_text_sink_event (GstPad * pad, GstEvent * event)
+{
+  GstBin *tbin = GST_BIN_CAST (gst_pad_get_parent (pad));
+  GstPlaySink *playsink = GST_PLAY_SINK_CAST (gst_pad_get_parent (tbin));
+  gboolean ret;
+
+  ret = gst_play_sink_sink_event (pad, event, "subtitle",
+      &playsink->text_ignore_wrong_state,
+      &playsink->text_custom_flush_finished,
+      &playsink->text_pending_flush, &playsink->text_segment);
+
+  gst_object_unref (playsink);
+  gst_object_unref (tbin);
+  return ret;
+}
+
+static GstFlowReturn
+gst_play_sink_text_sink_chain (GstPad * pad, GstBuffer * buffer)
+{
+  GstBin *tbin = GST_BIN_CAST (gst_pad_get_parent (pad));
+  GstPlaySink *playsink = GST_PLAY_SINK_CAST (gst_pad_get_parent (tbin));
+  gboolean ret;
+
+  ret = gst_play_sink_sink_chain (pad, buffer, "subtitle",
+      &playsink->text_ignore_wrong_state,
+      &playsink->text_custom_flush_finished,
+      &playsink->text_pending_flush, &playsink->text_segment);
+
+  gst_object_unref (playsink);
+  gst_object_unref (tbin);
+  return ret;
+}
+
+static gboolean
+gst_play_sink_text_src_event (GstPad * pad, GstEvent * event)
+{
+  gboolean ret;
+
+  GST_DEBUG_OBJECT (pad, "Got event %" GST_PTR_FORMAT, event);
+
+  if (event->structure &&
+      gst_structure_id_has_field (event->structure,
+          _playsink_reset_segment_event_marker_id)) {
+    /* the events marked with a reset segment marker
+     * are sent internally to reset the queue and
+     * must be dropped here */
+    GST_DEBUG_OBJECT (pad, "Dropping event with reset "
+        "segment marker set: %" GST_PTR_FORMAT, event);
+    ret = TRUE;
+    goto out;
+  }
+
+  ret = gst_proxy_pad_event_default (pad, gst_event_ref (event));
+
+out:
+  gst_event_unref (event);
+  return ret;
+}
+
 /* make an element for playback of video with subtitles embedded.
  * Only used for *raw* video streams.
  *
@@ -1511,7 +2350,7 @@ gen_text_chain (GstPlaySink * playsink)
                   "queue"), ("rendering might be suboptimal"));
         } else {
           g_object_set (G_OBJECT (chain->queue), "max-size-buffers", 3,
-              "max-size-bytes", 0, "max-size-time", (gint64) 0,
+              "max-size-bytes", 0, "max-size-time", (gint64) GST_SECOND,
               "silent", TRUE, NULL);
           gst_bin_add (bin, chain->queue);
         }
@@ -1545,7 +2384,7 @@ gen_text_chain (GstPlaySink * playsink)
     if (textsinkpad == NULL) {
       GST_ELEMENT_WARNING (playsink, CORE, MISSING_PLUGIN,
           (_("Custom text sink element is not usable.")),
-          ("fallback to default textoverlay"));
+          ("fallback to default subtitleoverlay"));
     }
   }
 
@@ -1600,7 +2439,7 @@ gen_text_chain (GstPlaySink * playsink)
                   "queue"), ("rendering might be suboptimal"));
         } else {
           g_object_set (G_OBJECT (element), "max-size-buffers", 3,
-              "max-size-bytes", 0, "max-size-time", (gint64) 0,
+              "max-size-bytes", 0, "max-size-time", (gint64) GST_SECOND,
               "silent", TRUE, NULL);
           gst_bin_add (bin, element);
           if (gst_element_link_pads_full (element, "src", chain->overlay,
@@ -1648,11 +2487,21 @@ gen_text_chain (GstPlaySink * playsink)
   if (textsinkpad) {
     chain->textsinkpad = gst_ghost_pad_new ("text_sink", textsinkpad);
     gst_object_unref (textsinkpad);
+
+    gst_pad_set_event_function (chain->textsinkpad,
+        GST_DEBUG_FUNCPTR (gst_play_sink_text_sink_event));
+    gst_pad_set_chain_function (chain->textsinkpad,
+        GST_DEBUG_FUNCPTR (gst_play_sink_text_sink_chain));
+
     gst_element_add_pad (chain->chain.bin, chain->textsinkpad);
   }
   if (srcpad) {
     chain->srcpad = gst_ghost_pad_new ("src", srcpad);
     gst_object_unref (srcpad);
+
+    gst_pad_set_event_function (chain->srcpad,
+        GST_DEBUG_FUNCPTR (gst_play_sink_text_src_event));
+
     gst_element_add_pad (chain->chain.bin, chain->srcpad);
   }
 
@@ -1810,10 +2659,10 @@ gen_audio_chain (GstPlaySink * playsink, gboolean raw)
   }
 
   if (!(playsink->flags & GST_PLAY_FLAG_NATIVE_AUDIO) || (!have_volume
-          && playsink->flags & GST_PLAY_FLAG_SOFT_VOLUME)) {
+          && (playsink->flags & GST_PLAY_FLAG_SOFT_VOLUME))) {
     gboolean use_converters = !(playsink->flags & GST_PLAY_FLAG_NATIVE_AUDIO);
     gboolean use_volume =
-        !have_volume && playsink->flags & GST_PLAY_FLAG_SOFT_VOLUME;
+        !have_volume && (playsink->flags & GST_PLAY_FLAG_SOFT_VOLUME);
     GST_DEBUG_OBJECT (playsink,
         "creating audioconvert with use-converters %d, use-volume %d",
         use_converters, use_volume);
@@ -1830,7 +2679,7 @@ gen_audio_chain (GstPlaySink * playsink, gboolean raw)
     }
     prev = chain->conv;
 
-    if (!have_volume && playsink->flags & GST_PLAY_FLAG_SOFT_VOLUME) {
+    if (!have_volume && (playsink->flags & GST_PLAY_FLAG_SOFT_VOLUME)) {
       GstPlaySinkAudioConvert *conv =
           GST_PLAY_SINK_AUDIO_CONVERT_CAST (chain->conv);
 
@@ -1873,6 +2722,16 @@ gen_audio_chain (GstPlaySink * playsink, gboolean raw)
   GST_DEBUG_OBJECT (playsink, "ghosting sink pad");
   pad = gst_element_get_static_pad (head, "sink");
   chain->sinkpad = gst_ghost_pad_new ("sink", pad);
+
+  /* sending audio/video flushes break stream changes when the pipeline
+   * is paused and played again in 0.10 */
+#if 0
+  gst_pad_set_event_function (chain->sinkpad,
+      GST_DEBUG_FUNCPTR (gst_play_sink_audio_sink_event));
+  gst_pad_set_chain_function (chain->sinkpad,
+      GST_DEBUG_FUNCPTR (gst_play_sink_audio_sink_chain));
+#endif
+
   gst_object_unref (pad);
   gst_element_add_pad (chain->chain.bin, chain->sinkpad);
 
@@ -1928,8 +2787,10 @@ setup_audio_chain (GstPlaySink * playsink, gboolean raw)
   GstElement *elem;
   GstPlayAudioChain *chain;
   GstStateChangeReturn ret;
+  GstPlaySinkAudioConvert *conv;
 
   chain = playsink->audiochain;
+  conv = GST_PLAY_SINK_AUDIO_CONVERT_CAST (chain->conv);
 
   chain->chain.raw = raw;
 
@@ -1978,18 +2839,16 @@ setup_audio_chain (GstPlaySink * playsink, gboolean raw)
     }
 
     g_object_set (chain->conv, "use-volume", FALSE, NULL);
-  } else {
-    GstPlaySinkAudioConvert *conv =
-        GST_PLAY_SINK_AUDIO_CONVERT_CAST (chain->conv);
-
+  } else if (conv) {
     /* no volume, we need to add a volume element when we can */
-    g_object_set (chain->conv, "use-volume", TRUE, NULL);
+    g_object_set (chain->conv, "use-volume",
+        ! !(playsink->flags & GST_PLAY_FLAG_SOFT_VOLUME), NULL);
     GST_DEBUG_OBJECT (playsink, "the sink has no volume property");
 
     /* Disconnect signals */
     disconnect_chain (chain, playsink);
 
-    if (conv->volume) {
+    if (conv->volume && (playsink->flags & GST_PLAY_FLAG_SOFT_VOLUME)) {
       chain->volume = conv->volume;
       chain->mute = chain->volume;
 
@@ -2146,12 +3005,49 @@ link_failed:
   }
 }
 
+gboolean
+gst_play_sink_reconfigure (GstPlaySink * playsink)
+{
+  GST_LOG_OBJECT (playsink, "Triggering reconfiguration");
+
+  GST_PLAY_SINK_LOCK (playsink);
+  if (playsink->video_pad) {
+    GstPad *opad =
+        GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD
+            (playsink->video_pad)));
+    gst_pad_set_blocked_async (opad, TRUE, sinkpad_blocked_cb, playsink);
+    PENDING_FLAG_SET (playsink, GST_PLAY_SINK_TYPE_VIDEO);
+    gst_object_unref (opad);
+  }
+
+  if (playsink->audio_pad) {
+    GstPad *opad =
+        GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD
+            (playsink->audio_pad)));
+    gst_pad_set_blocked_async (opad, TRUE, sinkpad_blocked_cb, playsink);
+    PENDING_FLAG_SET (playsink, GST_PLAY_SINK_TYPE_AUDIO);
+    gst_object_unref (opad);
+  }
+
+  if (playsink->text_pad) {
+    GstPad *opad =
+        GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD
+            (playsink->text_pad)));
+    gst_pad_set_blocked_async (opad, TRUE, sinkpad_blocked_cb, playsink);
+    PENDING_FLAG_SET (playsink, GST_PLAY_SINK_TYPE_TEXT);
+    gst_object_unref (opad);
+  }
+  GST_PLAY_SINK_UNLOCK (playsink);
+
+  return TRUE;
+}
+
 /* this function is called when all the request pads are requested and when we
  * have to construct the final pipeline. Based on the flags we construct the
  * final output pipelines.
  */
-gboolean
-gst_play_sink_reconfigure (GstPlaySink * playsink)
+static gboolean
+gst_play_sink_do_reconfigure (GstPlaySink * playsink)
 {
   GstPlayFlags flags;
   gboolean need_audio, need_video, need_deinterlace, need_vis, need_text;
@@ -2201,7 +3097,7 @@ gst_play_sink_reconfigure (GstPlaySink * playsink)
 
   /* we have a text_pad and we need text rendering, in this case we need a
    * video_pad to combine the video with the text or visualizations */
-  if (need_text && !need_video) {
+  if (need_text && !need_video && !playsink->text_sink) {
     if (playsink->video_pad) {
       need_video = TRUE;
     } else if (need_audio) {
@@ -2258,6 +3154,19 @@ gst_play_sink_reconfigure (GstPlaySink * playsink)
         activate_chain (GST_PLAY_CHAIN (playsink->videochain), FALSE);
         free_chain ((GstPlayChain *) playsink->videochain);
         playsink->videochain = NULL;
+
+        GST_OBJECT_LOCK (playsink);
+        if (playsink->xoverlay_element)
+          gst_object_unref (playsink->xoverlay_element);
+        playsink->xoverlay_element = NULL;
+
+        if (playsink->colorbalance_element) {
+          g_signal_handlers_disconnect_by_func (playsink->colorbalance_element,
+              G_CALLBACK (colorbalance_value_changed_cb), playsink);
+          gst_object_unref (playsink->colorbalance_element);
+        }
+        playsink->colorbalance_element = NULL;
+        GST_OBJECT_UNLOCK (playsink);
       }
     }
 
@@ -2299,6 +3208,8 @@ gst_play_sink_reconfigure (GstPlaySink * playsink)
       add_chain (GST_PLAY_CHAIN (playsink->videodeinterlacechain), TRUE);
       activate_chain (GST_PLAY_CHAIN (playsink->videodeinterlacechain), TRUE);
 
+      gst_pad_unlink (playsink->video_srcpad_stream_synchronizer,
+          playsink->videochain->sinkpad);
       gst_pad_link_full (playsink->video_srcpad_stream_synchronizer,
           playsink->videodeinterlacechain->sinkpad, GST_PAD_LINK_CHECK_NOTHING);
     } else {
@@ -2316,6 +3227,12 @@ gst_play_sink_reconfigure (GstPlaySink * playsink)
     if (!need_vis && !need_text && (!playsink->textchain
             || !playsink->text_pad)) {
       GST_DEBUG_OBJECT (playsink, "ghosting video sinkpad");
+      gst_pad_unlink (playsink->video_srcpad_stream_synchronizer,
+          playsink->videochain->sinkpad);
+      if (playsink->videodeinterlacechain
+          && playsink->videodeinterlacechain->srcpad)
+        gst_pad_unlink (playsink->videodeinterlacechain->srcpad,
+            playsink->videochain->sinkpad);
       if (need_deinterlace)
         gst_pad_link_full (playsink->videodeinterlacechain->srcpad,
             playsink->videochain->sinkpad, GST_PAD_LINK_CHECK_NOTHING);
@@ -2369,6 +3286,19 @@ gst_play_sink_reconfigure (GstPlaySink * playsink)
 
     if (playsink->video_pad)
       gst_ghost_pad_set_target (GST_GHOST_PAD_CAST (playsink->video_pad), NULL);
+
+    GST_OBJECT_LOCK (playsink);
+    if (playsink->xoverlay_element)
+      gst_object_unref (playsink->xoverlay_element);
+    playsink->xoverlay_element = NULL;
+
+    if (playsink->colorbalance_element) {
+      g_signal_handlers_disconnect_by_func (playsink->colorbalance_element,
+          G_CALLBACK (colorbalance_value_changed_cb), playsink);
+      gst_object_unref (playsink->colorbalance_element);
+    }
+    playsink->colorbalance_element = NULL;
+    GST_OBJECT_UNLOCK (playsink);
   }
 
   if (need_audio) {
@@ -2565,25 +3495,27 @@ gst_play_sink_reconfigure (GstPlaySink * playsink)
             playsink->textchain->textsinkpad, GST_PAD_LINK_CHECK_NOTHING);
       }
 
-      if (need_vis) {
-        GstPad *srcpad;
+      if (need_vis || need_video) {
+        if (need_vis) {
+          GstPad *srcpad;
 
-        srcpad =
-            gst_element_get_static_pad (playsink->vischain->chain.bin, "src");
-        gst_pad_unlink (srcpad, playsink->videochain->sinkpad);
-        gst_pad_link_full (srcpad, playsink->textchain->videosinkpad,
-            GST_PAD_LINK_CHECK_NOTHING);
-        gst_object_unref (srcpad);
-      } else {
-        if (need_deinterlace)
-          gst_pad_link_full (playsink->videodeinterlacechain->srcpad,
-              playsink->textchain->videosinkpad, GST_PAD_LINK_CHECK_NOTHING);
-        else
-          gst_pad_link_full (playsink->video_srcpad_stream_synchronizer,
-              playsink->textchain->videosinkpad, GST_PAD_LINK_CHECK_NOTHING);
+          srcpad =
+              gst_element_get_static_pad (playsink->vischain->chain.bin, "src");
+          gst_pad_unlink (srcpad, playsink->videochain->sinkpad);
+          gst_pad_link_full (srcpad, playsink->textchain->videosinkpad,
+              GST_PAD_LINK_CHECK_NOTHING);
+          gst_object_unref (srcpad);
+        } else {
+          if (need_deinterlace)
+            gst_pad_link_full (playsink->videodeinterlacechain->srcpad,
+                playsink->textchain->videosinkpad, GST_PAD_LINK_CHECK_NOTHING);
+          else
+            gst_pad_link_full (playsink->video_srcpad_stream_synchronizer,
+                playsink->textchain->videosinkpad, GST_PAD_LINK_CHECK_NOTHING);
+        }
+        gst_pad_link_full (playsink->textchain->srcpad,
+            playsink->videochain->sinkpad, GST_PAD_LINK_CHECK_NOTHING);
       }
-      gst_pad_link_full (playsink->textchain->srcpad,
-          playsink->videochain->sinkpad, GST_PAD_LINK_CHECK_NOTHING);
 
       activate_chain (GST_PLAY_CHAIN (playsink->textchain), TRUE);
     }
@@ -2994,14 +3926,13 @@ sinkpad_blocked_cb (GstPad * blockedpad, gboolean blocked, gpointer user_data)
           playsink->audio_pad_raw);
     }
 
-    gst_play_sink_reconfigure (playsink);
+    gst_play_sink_do_reconfigure (playsink);
 
     if (playsink->video_pad) {
       GstPad *opad =
           GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD
               (playsink->video_pad)));
-      gst_pad_set_blocked_async_full (opad, FALSE, sinkpad_blocked_cb,
-          gst_object_ref (playsink), (GDestroyNotify) gst_object_unref);
+      gst_pad_set_blocked_async (opad, FALSE, sinkpad_blocked_cb, playsink);
       gst_object_unref (opad);
     }
 
@@ -3009,8 +3940,7 @@ sinkpad_blocked_cb (GstPad * blockedpad, gboolean blocked, gpointer user_data)
       GstPad *opad =
           GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD
               (playsink->audio_pad)));
-      gst_pad_set_blocked_async_full (opad, FALSE, sinkpad_blocked_cb,
-          gst_object_ref (playsink), (GDestroyNotify) gst_object_unref);
+      gst_pad_set_blocked_async (opad, FALSE, sinkpad_blocked_cb, playsink);
       gst_object_unref (opad);
     }
 
@@ -3018,8 +3948,7 @@ sinkpad_blocked_cb (GstPad * blockedpad, gboolean blocked, gpointer user_data)
       GstPad *opad =
           GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD
               (playsink->text_pad)));
-      gst_pad_set_blocked_async_full (opad, FALSE, sinkpad_blocked_cb,
-          gst_object_ref (playsink), (GDestroyNotify) gst_object_unref);
+      gst_pad_set_blocked_async (opad, FALSE, sinkpad_blocked_cb, playsink);
       gst_object_unref (opad);
     }
   }
@@ -3042,14 +3971,14 @@ caps_notify_cb (GstPad * pad, GParamSpec * unused, GstPlaySink * playsink)
 
   if (pad == playsink->audio_pad) {
     raw = is_raw_pad (pad);
-    reconfigure = (!!playsink->audio_pad_raw != !!raw)
+    reconfigure = (! !playsink->audio_pad_raw != ! !raw)
         && playsink->audiochain;
     GST_DEBUG_OBJECT (pad,
         "Audio caps changed: raw %d reconfigure %d caps %" GST_PTR_FORMAT, raw,
         reconfigure, caps);
   } else if (pad == playsink->video_pad) {
     raw = is_raw_pad (pad);
-    reconfigure = (!!playsink->video_pad_raw != !!raw)
+    reconfigure = (! !playsink->video_pad_raw != ! !raw)
         && playsink->videochain;
     GST_DEBUG_OBJECT (pad,
         "Video caps changed: raw %d reconfigure %d caps %" GST_PTR_FORMAT, raw,
@@ -3058,35 +3987,49 @@ caps_notify_cb (GstPad * pad, GParamSpec * unused, GstPlaySink * playsink)
 
   gst_caps_unref (caps);
 
-  if (reconfigure) {
-    GST_PLAY_SINK_LOCK (playsink);
-    if (playsink->video_pad) {
-      GstPad *opad =
-          GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD
-              (playsink->video_pad)));
-      gst_pad_set_blocked_async_full (opad, TRUE, sinkpad_blocked_cb,
-          gst_object_ref (playsink), (GDestroyNotify) gst_object_unref);
-      gst_object_unref (opad);
-    }
+  if (reconfigure)
+    gst_play_sink_reconfigure (playsink);
+}
 
-    if (playsink->audio_pad) {
-      GstPad *opad =
-          GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD
-              (playsink->audio_pad)));
-      gst_pad_set_blocked_async_full (opad, TRUE, sinkpad_blocked_cb,
-          gst_object_ref (playsink), (GDestroyNotify) gst_object_unref);
-      gst_object_unref (opad);
-    }
+void
+gst_play_sink_refresh_pad (GstPlaySink * playsink, GstPad * pad,
+    GstPlaySinkType type)
+{
+  GST_DEBUG_OBJECT (playsink, "refresh pad %" GST_PTR_FORMAT, pad);
 
-    if (playsink->text_pad) {
-      GstPad *opad =
-          GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD
-              (playsink->text_pad)));
-      gst_pad_set_blocked_async_full (opad, TRUE, sinkpad_blocked_cb,
-          gst_object_ref (playsink), (GDestroyNotify) gst_object_unref);
-      gst_object_unref (opad);
-    }
+  GST_PLAY_SINK_LOCK (playsink);
+  if (pad == playsink->video_pad) {
+    if (type != GST_PLAY_SINK_TYPE_VIDEO_RAW &&
+        type != GST_PLAY_SINK_TYPE_VIDEO)
+      goto wrong_type;
+  } else if (pad == playsink->audio_pad) {
+    if (type != GST_PLAY_SINK_TYPE_AUDIO_RAW &&
+        type != GST_PLAY_SINK_TYPE_AUDIO)
+      goto wrong_type;
+  } else if (pad == playsink->text_pad) {
+    if (type != GST_PLAY_SINK_TYPE_TEXT)
+      goto wrong_type;
+  }
+
+  if (type != GST_PLAY_SINK_TYPE_FLUSHING) {
+    GstPad *blockpad =
+        GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD (pad)));
+
+    gst_pad_set_blocked_async (blockpad, TRUE, sinkpad_blocked_cb, playsink);
+    PENDING_FLAG_SET (playsink, type);
+    gst_object_unref (blockpad);
+  }
+  GST_PLAY_SINK_UNLOCK (playsink);
+
+  return;
+
+  /* ERRORS */
+wrong_type:
+  {
+    GST_WARNING_OBJECT (playsink, "wrong type %d for pad %" GST_PTR_FORMAT,
+        type, pad);
     GST_PLAY_SINK_UNLOCK (playsink);
+    return;
   }
 }
 
@@ -3197,8 +4140,7 @@ gst_play_sink_request_pad (GstPlaySink * playsink, GstPlaySinkType type)
       GstPad *blockpad =
           GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD (res)));
 
-      gst_pad_set_blocked_async_full (blockpad, TRUE, sinkpad_blocked_cb,
-          gst_object_ref (playsink), (GDestroyNotify) gst_object_unref);
+      gst_pad_set_blocked_async (blockpad, TRUE, sinkpad_blocked_cb, playsink);
       PENDING_FLAG_SET (playsink, type);
       gst_object_unref (blockpad);
     }
@@ -3209,6 +4151,7 @@ gst_play_sink_request_pad (GstPlaySink * playsink, GstPlaySinkType type)
   return res;
 }
 
+
 static GstPad *
 gst_play_sink_request_new_pad (GstElement * element, GstPadTemplate * templ,
     const gchar * name)
@@ -3331,6 +4274,46 @@ gst_play_sink_handle_message (GstBin * bin, GstMessage * message)
       GST_BIN_CLASS (gst_play_sink_parent_class)->handle_message (bin, message);
       break;
     }
+    case GST_MESSAGE_ELEMENT:{
+      if (gst_structure_has_name (message->structure, "prepare-xwindow-id")) {
+        GstXOverlay *xoverlay;
+
+        GST_OBJECT_LOCK (playsink);
+        if (playsink->xoverlay_element
+            && GST_OBJECT_CAST (playsink->xoverlay_element) !=
+            GST_MESSAGE_SRC (message)) {
+          gst_object_unref (playsink->xoverlay_element);
+          playsink->xoverlay_element = NULL;
+        }
+
+        if (!playsink->xoverlay_element)
+          playsink->xoverlay_element =
+              GST_X_OVERLAY (gst_object_ref (GST_MESSAGE_SRC (message)));
+        xoverlay = GST_X_OVERLAY (gst_object_ref (playsink->xoverlay_element));
+        GST_OBJECT_UNLOCK (playsink);
+
+        GST_DEBUG_OBJECT (playsink, "Got prepare-xwindow-id message");
+
+        if (playsink->xoverlay_handle_set)
+          gst_x_overlay_set_window_handle (playsink->xoverlay_element,
+              playsink->xoverlay_handle);
+        if (playsink->xoverlay_handle_events_set)
+          gst_x_overlay_handle_events (playsink->xoverlay_element,
+              playsink->xoverlay_handle_events);
+        if (playsink->xoverlay_render_rectangle_set)
+          gst_x_overlay_set_render_rectangle (playsink->xoverlay_element,
+              playsink->xoverlay_x, playsink->xoverlay_y,
+              playsink->xoverlay_width, playsink->xoverlay_height);
+
+        gst_object_unref (xoverlay);
+        gst_message_unref (message);
+        gst_x_overlay_prepare_xwindow_id (GST_X_OVERLAY (playsink));
+      } else {
+        GST_BIN_CLASS (gst_play_sink_parent_class)->handle_message (bin,
+            message);
+      }
+      break;
+    }
     default:
       GST_BIN_CLASS (gst_play_sink_parent_class)->handle_message (bin, message);
       break;
@@ -3346,31 +4329,41 @@ static gboolean
 gst_play_sink_send_event_to_sink (GstPlaySink * playsink, GstEvent * event)
 {
   gboolean res = TRUE;
-
-  if (playsink->textchain && playsink->textchain->sink) {
-    gst_event_ref (event);
-    if ((res = gst_element_send_event (playsink->textchain->chain.bin, event))) {
-      GST_DEBUG_OBJECT (playsink, "Sent event successfully to text sink");
-    } else {
-      GST_DEBUG_OBJECT (playsink, "Event failed when sent to text sink");
+  if (playsink->send_event_mode == MODE_FIRST) {
+    if (playsink->textchain && playsink->textchain->sink) {
+      gst_event_ref (event);
+      if ((res =
+              gst_element_send_event (playsink->textchain->chain.bin, event))) {
+        GST_DEBUG_OBJECT (playsink, "Sent event successfully to text sink");
+      } else {
+        GST_DEBUG_OBJECT (playsink, "Event failed when sent to text sink");
+      }
     }
-  }
 
-  if (playsink->videochain) {
-    gst_event_ref (event);
-    if ((res = gst_element_send_event (playsink->videochain->chain.bin, event))) {
-      GST_DEBUG_OBJECT (playsink, "Sent event successfully to video sink");
-      goto done;
+    if (playsink->videochain) {
+      gst_event_ref (event);
+      if ((res =
+              gst_element_send_event (playsink->videochain->chain.bin,
+                  event))) {
+        GST_DEBUG_OBJECT (playsink, "Sent event successfully to video sink");
+        goto done;
+      }
+      GST_DEBUG_OBJECT (playsink, "Event failed when sent to video sink");
     }
-    GST_DEBUG_OBJECT (playsink, "Event failed when sent to video sink");
-  }
-  if (playsink->audiochain) {
-    gst_event_ref (event);
-    if ((res = gst_element_send_event (playsink->audiochain->chain.bin, event))) {
-      GST_DEBUG_OBJECT (playsink, "Sent event successfully to audio sink");
-      goto done;
+    if (playsink->audiochain) {
+      gst_event_ref (event);
+      if ((res =
+              gst_element_send_event (playsink->audiochain->chain.bin,
+                  event))) {
+        GST_DEBUG_OBJECT (playsink, "Sent event successfully to audio sink");
+        goto done;
+      }
+      GST_DEBUG_OBJECT (playsink, "Event failed when sent to audio sink");
     }
-    GST_DEBUG_OBJECT (playsink, "Event failed when sent to audio sink");
+  } else {
+    return
+        GST_ELEMENT_CLASS (gst_play_sink_parent_class)->send_event
+        (GST_ELEMENT_CAST (playsink), event);
   }
 
 done:
@@ -3387,9 +4380,7 @@ gst_play_sink_send_event (GstElement * element, GstEvent * event)
   gboolean res = FALSE;
   GstEventType event_type = GST_EVENT_TYPE (event);
   GstPlaySink *playsink;
-
   playsink = GST_PLAY_SINK_CAST (element);
-
   switch (event_type) {
     case GST_EVENT_SEEK:
       GST_DEBUG_OBJECT (element, "Sending event to a sink");
@@ -3401,10 +4392,8 @@ gst_play_sink_send_event (GstElement * element, GstEvent * event)
       guint64 amount;
       gdouble rate;
       gboolean flush, intermediate;
-
       gst_event_parse_step (event, &format, &amount, &rate, &flush,
           &intermediate);
-
       if (format == GST_FORMAT_BUFFERS) {
         /* for buffers, we will try to step video frames, for other formats we
          * send the step to all sinks */
@@ -3430,18 +4419,21 @@ gst_play_sink_change_state (GstElement * element, GstStateChange transition)
 {
   GstStateChangeReturn ret;
   GstStateChangeReturn bret;
-
   GstPlaySink *playsink;
-
   playsink = GST_PLAY_SINK (element);
-
   switch (transition) {
     case GST_STATE_CHANGE_READY_TO_PAUSED:
+      gst_segment_init (&playsink->text_segment, GST_FORMAT_UNDEFINED);
+
       playsink->need_async_start = TRUE;
       /* we want to go async to PAUSED until we managed to configure and add the
        * sinks */
       do_async_start (playsink);
       ret = GST_STATE_CHANGE_ASYNC;
+
+      /* block all pads here */
+      if (!gst_play_sink_reconfigure (playsink))
+        ret = GST_STATE_CHANGE_FAILURE;
       break;
     case GST_STATE_CHANGE_PAUSED_TO_READY:
       /* unblock all pads here */
@@ -3451,8 +4443,7 @@ gst_play_sink_change_state (GstElement * element, GstStateChange transition)
             GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD
                 (playsink->video_pad)));
         if (gst_pad_is_blocked (opad)) {
-          gst_pad_set_blocked_async_full (opad, FALSE, sinkpad_blocked_cb,
-              gst_object_ref (playsink), (GDestroyNotify) gst_object_unref);
+          gst_pad_set_blocked_async (opad, FALSE, sinkpad_blocked_cb, playsink);
         }
         gst_object_unref (opad);
         playsink->video_pad_blocked = FALSE;
@@ -3462,10 +4453,8 @@ gst_play_sink_change_state (GstElement * element, GstStateChange transition)
         GstPad *opad =
             GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD
                 (playsink->audio_pad)));
-
         if (gst_pad_is_blocked (opad)) {
-          gst_pad_set_blocked_async_full (opad, FALSE, sinkpad_blocked_cb,
-              gst_object_ref (playsink), (GDestroyNotify) gst_object_unref);
+          gst_pad_set_blocked_async (opad, FALSE, sinkpad_blocked_cb, playsink);
         }
         gst_object_unref (opad);
         playsink->audio_pad_blocked = FALSE;
@@ -3476,8 +4465,7 @@ gst_play_sink_change_state (GstElement * element, GstStateChange transition)
             GST_PAD_CAST (gst_proxy_pad_get_internal (GST_PROXY_PAD
                 (playsink->text_pad)));
         if (gst_pad_is_blocked (opad)) {
-          gst_pad_set_blocked_async_full (opad, FALSE, sinkpad_blocked_cb,
-              gst_object_ref (playsink), (GDestroyNotify) gst_object_unref);
+          gst_pad_set_blocked_async (opad, FALSE, sinkpad_blocked_cb, playsink);
         }
         gst_object_unref (opad);
         playsink->text_pad_blocked = FALSE;
@@ -3502,6 +4490,20 @@ gst_play_sink_change_state (GstElement * element, GstStateChange transition)
         gst_object_unref (playsink->videochain->ts_offset);
         playsink->videochain->ts_offset = NULL;
       }
+
+      GST_OBJECT_LOCK (playsink);
+      if (playsink->xoverlay_element)
+        gst_object_unref (playsink->xoverlay_element);
+      playsink->xoverlay_element = NULL;
+
+      if (playsink->colorbalance_element) {
+        g_signal_handlers_disconnect_by_func (playsink->colorbalance_element,
+            G_CALLBACK (colorbalance_value_changed_cb), playsink);
+        gst_object_unref (playsink->colorbalance_element);
+      }
+      playsink->colorbalance_element = NULL;
+      GST_OBJECT_UNLOCK (playsink);
+
       ret = GST_STATE_CHANGE_SUCCESS;
       break;
     default:
@@ -3611,7 +4613,6 @@ gst_play_sink_change_state (GstElement * element, GstStateChange transition)
         if (playsink->textchain && playsink->textchain->sink)
           gst_bin_remove (GST_BIN_CAST (playsink->textchain->chain.bin),
               playsink->textchain->sink);
-
         if (playsink->audio_sink != NULL)
           gst_element_set_state (playsink->audio_sink, GST_STATE_NULL);
         if (playsink->video_sink != NULL)
@@ -3620,7 +4621,6 @@ gst_play_sink_change_state (GstElement * element, GstStateChange transition)
           gst_element_set_state (playsink->visualisation, GST_STATE_NULL);
         if (playsink->text_sink != NULL)
           gst_element_set_state (playsink->text_sink, GST_STATE_NULL);
-
         free_chain ((GstPlayChain *) playsink->videodeinterlacechain);
         playsink->videodeinterlacechain = NULL;
         free_chain ((GstPlayChain *) playsink->videochain);
@@ -3637,7 +4637,6 @@ gst_play_sink_change_state (GstElement * element, GstStateChange transition)
       break;
   }
   return ret;
-
   /* ERRORS */
 activate_failed:
   {
@@ -3652,7 +4651,6 @@ gst_play_sink_set_property (GObject * object, guint prop_id,
     const GValue * value, GParamSpec * spec)
 {
   GstPlaySink *playsink = GST_PLAY_SINK (object);
-
   switch (prop_id) {
     case PROP_FLAGS:
       gst_play_sink_set_flags (playsink, g_value_get_flags (value));
@@ -3688,6 +4686,32 @@ gst_play_sink_set_property (GObject * object, guint prop_id,
       gst_play_sink_set_sink (playsink, GST_PLAY_SINK_TYPE_TEXT,
           g_value_get_object (value));
       break;
+    case PROP_SEND_EVENT_MODE:
+      playsink->send_event_mode = g_value_get_enum (value);
+      break;
+    case PROP_FORCE_ASPECT_RATIO:{
+      GstPlayVideoChain *chain;
+      GstElement *elem;
+
+      playsink->force_aspect_ratio = g_value_get_boolean (value);
+
+      GST_PLAY_SINK_LOCK (playsink);
+      if (playsink->videochain) {
+        chain = (GstPlayVideoChain *) playsink->videochain;
+
+        if (chain->sink) {
+          elem =
+              gst_play_sink_find_property_sinks (playsink, chain->sink,
+              "force-aspect-ratio", G_TYPE_BOOLEAN);
+
+          if (elem)
+            g_object_set (elem, "force-aspect-ratio",
+                playsink->force_aspect_ratio, NULL);
+        }
+      }
+      GST_PLAY_SINK_UNLOCK (playsink);
+      break;
+    }
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, spec);
       break;
@@ -3699,7 +4723,6 @@ gst_play_sink_get_property (GObject * object, guint prop_id,
     GValue * value, GParamSpec * spec)
 {
   GstPlaySink *playsink = GST_PLAY_SINK (object);
-
   switch (prop_id) {
     case PROP_FLAGS:
       g_value_set_flags (value, gst_play_sink_get_flags (playsink));
@@ -3738,18 +4761,303 @@ gst_play_sink_get_property (GObject * object, guint prop_id,
       g_value_take_object (value, gst_play_sink_get_sink (playsink,
               GST_PLAY_SINK_TYPE_TEXT));
       break;
+    case PROP_SEND_EVENT_MODE:
+      g_value_set_enum (value, playsink->send_event_mode);
+      break;
+    case PROP_FORCE_ASPECT_RATIO:
+      g_value_set_boolean (value, playsink->force_aspect_ratio);
+      break;
     default:
       G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, spec);
       break;
   }
 }
 
+static void
+gst_play_sink_xoverlay_expose (GstXOverlay * overlay)
+{
+  GstPlaySink *playsink = GST_PLAY_SINK (overlay);
+  GstXOverlay *xoverlay;
+
+  GST_OBJECT_LOCK (playsink);
+  if (playsink->xoverlay_element)
+    xoverlay = GST_X_OVERLAY (gst_object_ref (playsink->xoverlay_element));
+  else
+    xoverlay = NULL;
+  GST_OBJECT_UNLOCK (playsink);
+
+  if (xoverlay) {
+    gst_x_overlay_expose (xoverlay);
+    gst_object_unref (xoverlay);
+  }
+}
+
+static void
+gst_play_sink_xoverlay_handle_events (GstXOverlay * overlay,
+    gboolean handle_events)
+{
+  GstPlaySink *playsink = GST_PLAY_SINK (overlay);
+  GstXOverlay *xoverlay;
+
+  GST_OBJECT_LOCK (playsink);
+  if (playsink->xoverlay_element)
+    xoverlay = GST_X_OVERLAY (gst_object_ref (playsink->xoverlay_element));
+  else
+    xoverlay = NULL;
+  GST_OBJECT_UNLOCK (playsink);
+
+  playsink->xoverlay_handle_events_set = TRUE;
+  playsink->xoverlay_handle_events = handle_events;
+
+  if (xoverlay) {
+    gst_x_overlay_handle_events (xoverlay, handle_events);
+    gst_object_unref (xoverlay);
+  }
+}
+
+static void
+gst_play_sink_xoverlay_set_render_rectangle (GstXOverlay * overlay, gint x,
+    gint y, gint width, gint height)
+{
+  GstPlaySink *playsink = GST_PLAY_SINK (overlay);
+  GstXOverlay *xoverlay;
+
+  GST_OBJECT_LOCK (playsink);
+  if (playsink->xoverlay_element)
+    xoverlay = GST_X_OVERLAY (gst_object_ref (playsink->xoverlay_element));
+  else
+    xoverlay = NULL;
+  GST_OBJECT_UNLOCK (playsink);
+
+  playsink->xoverlay_render_rectangle_set = TRUE;
+  playsink->xoverlay_x = x;
+  playsink->xoverlay_y = y;
+  playsink->xoverlay_width = width;
+  playsink->xoverlay_height = height;
+
+  if (xoverlay) {
+    gst_x_overlay_set_render_rectangle (xoverlay, x, y, width, height);
+    gst_object_unref (xoverlay);
+  }
+}
+
+static void
+gst_play_sink_xoverlay_set_window_handle (GstXOverlay * overlay,
+    guintptr handle)
+{
+  GstPlaySink *playsink = GST_PLAY_SINK (overlay);
+  GstXOverlay *xoverlay;
+
+  GST_OBJECT_LOCK (playsink);
+  if (playsink->xoverlay_element)
+    xoverlay = GST_X_OVERLAY (gst_object_ref (playsink->xoverlay_element));
+  else
+    xoverlay = NULL;
+  GST_OBJECT_UNLOCK (playsink);
+
+  playsink->xoverlay_handle_set = TRUE;
+  playsink->xoverlay_handle = handle;
+
+  if (xoverlay) {
+    gst_x_overlay_set_window_handle (xoverlay, handle);
+    gst_object_unref (xoverlay);
+  }
+}
+
+static void
+gst_play_sink_xoverlay_init (gpointer g_iface, gpointer g_iface_data)
+{
+  GstXOverlayClass *iface = (GstXOverlayClass *) g_iface;
+  iface->expose = gst_play_sink_xoverlay_expose;
+  iface->handle_events = gst_play_sink_xoverlay_handle_events;
+  iface->set_render_rectangle = gst_play_sink_xoverlay_set_render_rectangle;
+  iface->set_window_handle = gst_play_sink_xoverlay_set_window_handle;
+}
+
+static gboolean
+gst_play_sink_implements_interface_supported (GstImplementsInterface * iface,
+    GType type)
+{
+  if (type == GST_TYPE_X_OVERLAY || type == GST_TYPE_STREAM_VOLUME ||
+      type == GST_TYPE_NAVIGATION || type == GST_TYPE_COLOR_BALANCE)
+    return TRUE;
+  else
+    return FALSE;
+}
+
+static void
+gst_play_sink_implements_interface_init (gpointer g_iface,
+    gpointer g_iface_data)
+{
+  GstImplementsInterfaceClass *iface = (GstImplementsInterfaceClass *) g_iface;
+  iface->supported = gst_play_sink_implements_interface_supported;
+}
+
+static void
+gst_play_sink_navigation_send_event (GstNavigation * navigation,
+    GstStructure * structure)
+{
+  GstPlaySink *playsink = GST_PLAY_SINK (navigation);
+  GstBin *bin = NULL;
+
+  GST_PLAY_SINK_LOCK (playsink);
+  if (playsink->videochain && playsink->videochain->chain.bin)
+    bin = GST_BIN (gst_object_ref (playsink->videochain->chain.bin));
+  GST_PLAY_SINK_UNLOCK (playsink);
+
+  if (bin) {
+    GstElement *nav = gst_bin_get_by_interface (bin, GST_TYPE_NAVIGATION);
+
+    if (nav) {
+      gst_navigation_send_event (GST_NAVIGATION (nav), structure);
+      structure = NULL;
+      gst_object_unref (nav);
+    } else {
+      GstEvent *event = gst_event_new_navigation (structure);
+      structure = NULL;
+      gst_element_send_event (GST_ELEMENT (bin), event);
+    }
+
+    gst_object_unref (bin);
+  }
+
+  if (structure)
+    gst_structure_free (structure);
+}
+
+static void
+gst_play_sink_navigation_init (gpointer g_iface, gpointer g_iface_data)
+{
+  GstNavigationInterface *iface = (GstNavigationInterface *) g_iface;
+
+  iface->send_event = gst_play_sink_navigation_send_event;
+}
+
+static const GList *
+gst_play_sink_colorbalance_list_channels (GstColorBalance * balance)
+{
+  GstPlaySink *playsink = GST_PLAY_SINK (balance);
+
+  return playsink->colorbalance_channels;
+}
+
+static void
+gst_play_sink_colorbalance_set_value (GstColorBalance * balance,
+    GstColorBalanceChannel * proxy, gint value)
+{
+  GstPlaySink *playsink = GST_PLAY_SINK (balance);
+  GList *l;
+  gint i;
+  GstColorBalance *balance_element = NULL;
+
+  GST_OBJECT_LOCK (playsink);
+  if (playsink->colorbalance_element)
+    balance_element =
+        GST_COLOR_BALANCE (gst_object_ref (playsink->colorbalance_element));
+  GST_OBJECT_UNLOCK (playsink);
+
+  for (i = 0, l = playsink->colorbalance_channels; l; l = l->next, i++) {
+    GstColorBalanceChannel *proxy_tmp = l->data;
+    gdouble new_val;
+
+    if (proxy_tmp != proxy)
+      continue;
+
+    playsink->colorbalance_values[i] = value;
+
+    if (balance_element) {
+      GstColorBalanceChannel *channel = NULL;
+      const GList *channels, *k;
+
+      channels = gst_color_balance_list_channels (balance_element);
+      for (k = channels; k; k = k->next) {
+        GstColorBalanceChannel *tmp = l->data;
+
+        if (g_strrstr (tmp->label, proxy->label)) {
+          channel = tmp;
+          break;
+        }
+      }
+
+      g_assert (channel);
+
+      /* Convert to [0, 1] range */
+      new_val =
+          ((gdouble) value -
+          (gdouble) proxy->min_value) / ((gdouble) proxy->max_value -
+          (gdouble) proxy->min_value);
+      /* Convert to channel range */
+      new_val =
+          channel->min_value + new_val * ((gdouble) channel->max_value -
+          (gdouble) channel->min_value);
+
+      gst_color_balance_set_value (balance_element, channel,
+          (gint) (new_val + 0.5));
+
+      gst_object_unref (balance_element);
+    }
+
+    gst_color_balance_value_changed (balance, proxy, value);
+    break;
+  }
+}
+
+static gint
+gst_play_sink_colorbalance_get_value (GstColorBalance * balance,
+    GstColorBalanceChannel * proxy)
+{
+  GstPlaySink *playsink = GST_PLAY_SINK (balance);
+  GList *l;
+  gint i;
+
+  for (i = 0, l = playsink->colorbalance_channels; l; l = l->next, i++) {
+    GstColorBalanceChannel *proxy_tmp = l->data;
+
+    if (proxy_tmp != proxy)
+      continue;
+
+    return playsink->colorbalance_values[i];
+  }
+
+  g_return_val_if_reached (0);
+}
+
+static GstColorBalanceType
+gst_play_sink_colorbalance_get_balance_type (GstColorBalance * balance)
+{
+  GstPlaySink *playsink = GST_PLAY_SINK (balance);
+  GstColorBalance *balance_element = NULL;
+  GstColorBalanceType t = GST_COLOR_BALANCE_SOFTWARE;
+
+  GST_OBJECT_LOCK (playsink);
+  if (playsink->colorbalance_element)
+    balance_element =
+        GST_COLOR_BALANCE (gst_object_ref (playsink->colorbalance_element));
+  GST_OBJECT_UNLOCK (playsink);
+
+  if (balance_element) {
+    t = gst_color_balance_get_balance_type (balance_element);
+    gst_object_unref (balance_element);
+  }
+
+  return t;
+}
+
+static void
+gst_play_sink_colorbalance_init (gpointer g_iface, gpointer g_iface_data)
+{
+  GstColorBalanceClass *iface = (GstColorBalanceClass *) g_iface;
+
+  iface->list_channels = gst_play_sink_colorbalance_list_channels;
+  iface->set_value = gst_play_sink_colorbalance_set_value;
+  iface->get_value = gst_play_sink_colorbalance_get_value;
+  iface->get_balance_type = gst_play_sink_colorbalance_get_balance_type;
+}
 
 gboolean
 gst_play_sink_plugin_init (GstPlugin * plugin)
 {
   GST_DEBUG_CATEGORY_INIT (gst_play_sink_debug, "playsink", 0, "play bin");
-
   return gst_element_register (plugin, "playsink", GST_RANK_NONE,
       GST_TYPE_PLAY_SINK);
 }
diff --git a/gst/playback/gstplaysink.h b/gst/playback/gstplaysink.h
index 6759ea4..2c7e110 100644
--- a/gst/playback/gstplaysink.h
+++ b/gst/playback/gstplaysink.h
@@ -70,6 +70,7 @@ GType gst_play_sink_get_type (void);
 
 GstPad *         gst_play_sink_request_pad    (GstPlaySink *playsink, GstPlaySinkType type);
 void             gst_play_sink_release_pad    (GstPlaySink *playsink, GstPad *pad);
+void             gst_play_sink_refresh_pad    (GstPlaySink *playsink, GstPad *pad, GstPlaySinkType type);
 
 void             gst_play_sink_set_sink       (GstPlaySink * playsink, GstPlaySinkType type, GstElement * sink);
 GstElement *     gst_play_sink_get_sink       (GstPlaySink * playsink, GstPlaySinkType type);
diff --git a/gst/playback/gstplaysinkaudioconvert.c b/gst/playback/gstplaysinkaudioconvert.c
index a0756bc..77504da 100644
--- a/gst/playback/gstplaysinkaudioconvert.c
+++ b/gst/playback/gstplaysinkaudioconvert.c
@@ -64,7 +64,6 @@ gst_play_sink_audio_convert_add_conversion_elements (GstPlaySinkAudioConvert *
     el = gst_play_sink_convert_bin_add_conversion_element_factory (cbin,
         "audioresample", "resample");
     if (el) {
-
       if (prev) {
         if (!gst_element_link_pads_full (prev, "src", el, "sink",
                 GST_PAD_LINK_CHECK_TEMPLATE_CAPS))
diff --git a/gst/playback/gstplaysinkconvertbin.c b/gst/playback/gstplaysinkconvertbin.c
index 51ede9b..fc929a2 100644
--- a/gst/playback/gstplaysinkconvertbin.c
+++ b/gst/playback/gstplaysinkconvertbin.c
@@ -57,11 +57,11 @@ is_raw_caps (GstCaps * caps, gboolean audio)
   for (i = 0; i < n; i++) {
     s = gst_caps_get_structure (caps, i);
     name = gst_structure_get_name (s);
-    if (!g_str_has_prefix (name, prefix))
-      return FALSE;
+    if (g_str_has_prefix (name, prefix))
+      return TRUE;
   }
 
-  return TRUE;
+  return FALSE;
 }
 
 static void
@@ -194,6 +194,7 @@ gst_play_sink_convert_bin_remove_element (GstElement * element,
     GstPlaySinkConvertBin * self)
 {
   gst_element_set_state (element, GST_STATE_NULL);
+  gst_object_unref (element);
   gst_bin_remove (GST_BIN_CAST (self), element);
 }
 
@@ -253,8 +254,7 @@ pad_blocked_cb (GstPad * pad, gboolean blocked, GstPlaySinkConvertBin * self)
 
 unblock:
   gst_pad_set_blocked_async_full (self->sink_proxypad, FALSE,
-      (GstPadBlockCallback) pad_blocked_cb, gst_object_ref (self),
-      (GDestroyNotify) gst_object_unref);
+      (GstPadBlockCallback) pad_blocked_cb, self, NULL);
 
 done:
   GST_PLAY_SINK_CONVERT_BIN_UNLOCK (self);
@@ -337,8 +337,7 @@ gst_play_sink_convert_bin_sink_setcaps (GstPad * pad, GstCaps * caps)
 
         reconfigure = TRUE;
         gst_pad_set_blocked_async_full (self->sink_proxypad, TRUE,
-            (GstPadBlockCallback) pad_blocked_cb, gst_object_ref (self),
-            (GDestroyNotify) gst_object_unref);
+            (GstPadBlockCallback) pad_blocked_cb, self, NULL);
       }
 
       if (target)
@@ -349,8 +348,7 @@ gst_play_sink_convert_bin_sink_setcaps (GstPad * pad, GstCaps * caps)
       GST_DEBUG_OBJECT (self, "Changing caps from raw to non-raw");
       reconfigure = TRUE;
       gst_pad_set_blocked_async_full (self->sink_proxypad, TRUE,
-          (GstPadBlockCallback) pad_blocked_cb, gst_object_ref (self),
-          (GDestroyNotify) gst_object_unref);
+          (GstPadBlockCallback) pad_blocked_cb, self, NULL);
     }
   }
 
@@ -396,7 +394,7 @@ gst_play_sink_convert_bin_getcaps (GstPad * pad)
       gst_object_unref (peer);
       if (self->converter_caps && is_raw_caps (peer_caps, self->audio)) {
         peer_caps = gst_caps_make_writable (peer_caps);
-        gst_caps_merge (peer_caps, gst_caps_ref (self->converter_caps));
+        gst_caps_merge (peer_caps, gst_caps_copy (self->converter_caps));
         ret = peer_caps;
       } else {
         ret = peer_caps;
@@ -508,8 +506,7 @@ gst_play_sink_convert_bin_change_state (GstElement * element,
       GST_PLAY_SINK_CONVERT_BIN_LOCK (self);
       if (gst_pad_is_blocked (self->sink_proxypad))
         gst_pad_set_blocked_async_full (self->sink_proxypad, FALSE,
-            (GstPadBlockCallback) pad_blocked_cb, gst_object_ref (self),
-            (GDestroyNotify) gst_object_unref);
+            (GstPadBlockCallback) pad_blocked_cb, self, NULL);
       GST_PLAY_SINK_CONVERT_BIN_UNLOCK (self);
       break;
     case GST_STATE_CHANGE_READY_TO_PAUSED:
@@ -539,8 +536,7 @@ gst_play_sink_convert_bin_change_state (GstElement * element,
       GST_PLAY_SINK_CONVERT_BIN_LOCK (self);
       if (!gst_pad_is_blocked (self->sink_proxypad))
         gst_pad_set_blocked_async_full (self->sink_proxypad, TRUE,
-            (GstPadBlockCallback) pad_blocked_cb, gst_object_ref (self),
-            (GDestroyNotify) gst_object_unref);
+            (GstPadBlockCallback) pad_blocked_cb, self, NULL);
       GST_PLAY_SINK_CONVERT_BIN_UNLOCK (self);
       break;
     default:
diff --git a/gst/playback/gstplaysinkvideoconvert.c b/gst/playback/gstplaysinkvideoconvert.c
index 72a9aff..38c8878 100644
--- a/gst/playback/gstplaysinkvideoconvert.c
+++ b/gst/playback/gstplaysinkvideoconvert.c
@@ -34,6 +34,13 @@ GST_DEBUG_CATEGORY_STATIC (gst_play_sink_video_convert_debug);
 G_DEFINE_TYPE (GstPlaySinkVideoConvert, gst_play_sink_video_convert,
     GST_TYPE_PLAY_SINK_CONVERT_BIN);
 
+enum
+{
+  PROP_0,
+  PROP_USE_CONVERTERS,
+  PROP_USE_BALANCE,
+};
+
 static gboolean
 gst_play_sink_video_convert_add_conversion_elements (GstPlaySinkVideoConvert *
     self)
@@ -41,22 +48,51 @@ gst_play_sink_video_convert_add_conversion_elements (GstPlaySinkVideoConvert *
   GstPlaySinkConvertBin *cbin = GST_PLAY_SINK_CONVERT_BIN (self);
   GstElement *el, *prev = NULL;
 
-  el = gst_play_sink_convert_bin_add_conversion_element_factory (cbin,
-      COLORSPACE, "conv");
-  if (el)
-    prev = el;
+  g_assert (cbin->conversion_elements == NULL);
+
+  GST_DEBUG_OBJECT (self,
+      "Building video conversion with use-converters %d, use-balance %d",
+      self->use_converters, self->use_balance);
+
+  if (self->use_converters) {
+    el = gst_play_sink_convert_bin_add_conversion_element_factory (cbin,
+        COLORSPACE, "conv");
+    if (el)
+      prev = el;
+
+    el = gst_play_sink_convert_bin_add_conversion_element_factory (cbin,
+        "videoscale", "scale");
+    if (el) {
+      /* Add black borders if necessary to keep the DAR */
+      g_object_set (el, "add-borders", TRUE, NULL);
+      if (prev) {
+        if (!gst_element_link_pads_full (prev, "src", el, "sink",
+                GST_PAD_LINK_CHECK_TEMPLATE_CAPS))
+          goto link_failed;
+      }
+      prev = el;
+    }
+  }
 
-  el = gst_play_sink_convert_bin_add_conversion_element_factory (cbin,
-      "videoscale", "scale");
-  if (el) {
-    /* Add black borders if necessary to keep the DAR */
-    g_object_set (el, "add-borders", TRUE, NULL);
+  if (self->use_balance && self->balance) {
+    el = self->balance;
+    gst_play_sink_convert_bin_add_conversion_element (cbin, el);
     if (prev) {
       if (!gst_element_link_pads_full (prev, "src", el, "sink",
               GST_PAD_LINK_CHECK_TEMPLATE_CAPS))
         goto link_failed;
     }
     prev = el;
+
+    el = gst_play_sink_convert_bin_add_conversion_element_factory (cbin,
+        COLORSPACE, "conv2");
+    if (prev) {
+      if (!gst_element_link_pads_full (prev, "src", el, "sink",
+              GST_PAD_LINK_CHECK_TEMPLATE_CAPS))
+        goto link_failed;
+    }
+    if (el)
+      prev = el;
   }
 
   return TRUE;
@@ -66,15 +102,100 @@ link_failed:
 }
 
 static void
+gst_play_sink_video_convert_finalize (GObject * object)
+{
+  GstPlaySinkVideoConvert *self = GST_PLAY_SINK_VIDEO_CONVERT_CAST (object);
+
+  if (self->balance)
+    gst_object_unref (self->balance);
+
+  G_OBJECT_CLASS (parent_class)->finalize (object);
+}
+
+static void
+gst_play_sink_video_convert_set_property (GObject * object, guint prop_id,
+    const GValue * value, GParamSpec * pspec)
+{
+  GstPlaySinkVideoConvert *self = GST_PLAY_SINK_VIDEO_CONVERT_CAST (object);
+  gboolean v, changed = FALSE;
+
+  GST_PLAY_SINK_CONVERT_BIN_LOCK (self);
+  switch (prop_id) {
+    case PROP_USE_CONVERTERS:
+      v = g_value_get_boolean (value);
+      if (v != self->use_converters) {
+        self->use_converters = v;
+        changed = TRUE;
+      }
+      break;
+    case PROP_USE_BALANCE:
+      v = g_value_get_boolean (value);
+      if (v != self->use_balance) {
+        self->use_balance = v;
+        changed = TRUE;
+      }
+      break;
+    default:
+      break;
+  }
+
+  if (changed) {
+    GstPlaySinkConvertBin *cbin = GST_PLAY_SINK_CONVERT_BIN (self);
+    GST_DEBUG_OBJECT (self, "Rebuilding converter bin");
+    gst_play_sink_convert_bin_remove_elements (cbin);
+    gst_play_sink_video_convert_add_conversion_elements (self);
+    gst_play_sink_convert_bin_add_identity (cbin);
+    gst_play_sink_convert_bin_cache_converter_caps (cbin);
+  }
+  GST_PLAY_SINK_CONVERT_BIN_UNLOCK (self);
+}
+
+static void
+gst_play_sink_video_convert_get_property (GObject * object, guint prop_id,
+    GValue * value, GParamSpec * pspec)
+{
+  GstPlaySinkVideoConvert *self = GST_PLAY_SINK_VIDEO_CONVERT_CAST (object);
+
+  GST_PLAY_SINK_CONVERT_BIN_LOCK (self);
+  switch (prop_id) {
+    case PROP_USE_CONVERTERS:
+      g_value_set_boolean (value, self->use_converters);
+      break;
+    case PROP_USE_BALANCE:
+      g_value_set_boolean (value, self->use_balance);
+      break;
+    default:
+      break;
+  }
+  GST_PLAY_SINK_CONVERT_BIN_UNLOCK (self);
+}
+
+static void
 gst_play_sink_video_convert_class_init (GstPlaySinkVideoConvertClass * klass)
 {
+  GObjectClass *gobject_class;
   GstElementClass *gstelement_class;
 
   GST_DEBUG_CATEGORY_INIT (gst_play_sink_video_convert_debug,
       "playsinkvideoconvert", 0, "play bin");
 
+  gobject_class = (GObjectClass *) klass;
   gstelement_class = (GstElementClass *) klass;
 
+  gobject_class->finalize = gst_play_sink_video_convert_finalize;
+  gobject_class->set_property = gst_play_sink_video_convert_set_property;
+  gobject_class->get_property = gst_play_sink_video_convert_get_property;
+
+  g_object_class_install_property (gobject_class, PROP_USE_CONVERTERS,
+      g_param_spec_boolean ("use-converters", "Use converters",
+          "Whether to use conversion elements", FALSE,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
+  g_object_class_install_property (gobject_class, PROP_USE_BALANCE,
+      g_param_spec_boolean ("use-balance", "Use balance",
+          "Whether to use a videobalance element", FALSE,
+          G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
   gst_element_class_set_details_simple (gstelement_class,
       "Player Sink Video Converter", "Video/Bin/Converter",
       "Convenience bin for video conversion",
@@ -87,6 +208,14 @@ gst_play_sink_video_convert_init (GstPlaySinkVideoConvert * self)
   GstPlaySinkConvertBin *cbin = GST_PLAY_SINK_CONVERT_BIN (self);
   cbin->audio = FALSE;
 
+  /* FIXME: Only create this on demand but for now we need
+   * it to always exist because of playsink's color balance
+   * proxying logic.
+   */
+  self->balance = gst_element_factory_make ("videobalance", "videobalance");
+  if (self->balance)
+    gst_object_ref_sink (self->balance);
+
   gst_play_sink_video_convert_add_conversion_elements (self);
   gst_play_sink_convert_bin_cache_converter_caps (cbin);
 }
diff --git a/gst/playback/gstplaysinkvideoconvert.h b/gst/playback/gstplaysinkvideoconvert.h
index df56d97..5c50462 100644
--- a/gst/playback/gstplaysinkvideoconvert.h
+++ b/gst/playback/gstplaysinkvideoconvert.h
@@ -43,6 +43,10 @@ struct _GstPlaySinkVideoConvert
 {
   GstPlaySinkConvertBin parent;
 
+  /* < pseudo public > */
+  GstElement *balance;
+  gboolean use_converters;
+  gboolean use_balance;
 };
 
 struct _GstPlaySinkVideoConvertClass
diff --git a/gst/playback/gststreamselector.c b/gst/playback/gststreamselector.c
index aafe1fb..68e69f6 100644
--- a/gst/playback/gststreamselector.c
+++ b/gst/playback/gststreamselector.c
@@ -496,6 +496,8 @@ gst_stream_selector_class_init (GstStreamSelectorClass * klass)
 
   gstelement_class->request_new_pad = gst_stream_selector_request_new_pad;
   gstelement_class->release_pad = gst_stream_selector_release_pad;
+
+  g_type_class_ref (GST_TYPE_SELECTOR_PAD);
 }
 
 static void
diff --git a/gst/playback/gstsubtitleoverlay.c b/gst/playback/gstsubtitleoverlay.c
index a3e96c7..f132113 100644
--- a/gst/playback/gstsubtitleoverlay.c
+++ b/gst/playback/gstsubtitleoverlay.c
@@ -559,24 +559,77 @@ _remove_element (GstSubtitleOverlay * self, GstElement ** element)
   }
 }
 
+static gboolean
+_pad_query_convert_to_time (GstPad * pad, GstFormat src_format, gint64 src_val,
+    gint64 * dest_val)
+{
+  GstFormat dest_format;
+
+  if (src_val == GST_CLOCK_TIME_NONE) {
+    *dest_val = GST_CLOCK_TIME_NONE;
+    return TRUE;
+  }
+
+  dest_format = GST_FORMAT_TIME;
+  return gst_pad_query_convert (pad, src_format, src_val, &dest_format,
+      dest_val);
+}
+
 static void
-_generate_update_newsegment_event (GstSegment * segment, GstEvent ** event1,
-    GstEvent ** event2)
+_generate_update_newsegment_event (GstPad * pad, GstSegment * segment,
+    GstEvent ** event1, GstEvent ** event2)
 {
   GstEvent *event;
+  gboolean res;
+  gint64 accum = GST_CLOCK_TIME_NONE;
+  gint64 start = 0;
+  gint64 stop = GST_CLOCK_TIME_NONE;
+  gint64 time = 0;
 
   *event1 = NULL;
   *event2 = NULL;
 
+  /* always push newsegment with format TIME */
+  if (segment->format != GST_FORMAT_TIME) {
+    GstPad *peer;
+
+    peer = gst_pad_get_peer (pad);
+    if (peer) {
+      res = _pad_query_convert_to_time (peer, segment->format,
+          segment->accum, &accum);
+      if (!res) {
+        accum = GST_CLOCK_TIME_NONE;
+      }
+
+      res = _pad_query_convert_to_time (peer, segment->format,
+          segment->start, &start);
+      res = res && _pad_query_convert_to_time (peer, segment->format,
+          segment->stop, &stop);
+      res = res && _pad_query_convert_to_time (peer, segment->format,
+          segment->time, &time);
+      if (!res) {
+        start = 0;
+        stop = GST_CLOCK_TIME_NONE;
+        time = 0;
+      }
+
+      gst_object_unref (peer);
+    }
+  } else {
+    accum = segment->accum;
+    start = segment->start;
+    stop = segment->stop;
+    time = segment->time;
+  }
+
   event = gst_event_new_new_segment_full (FALSE, segment->rate,
-      segment->applied_rate, segment->format, 0, segment->accum, 0);
+      segment->applied_rate, GST_FORMAT_TIME, 0, accum, 0);
   gst_structure_id_set (event->structure, _subtitle_overlay_event_marker_id,
       G_TYPE_BOOLEAN, TRUE, NULL);
   *event1 = event;
 
   event = gst_event_new_new_segment_full (FALSE, segment->rate,
-      segment->applied_rate, segment->format,
-      segment->start, segment->stop, segment->time);
+      segment->applied_rate, GST_FORMAT_TIME, start, stop, time);
   gst_structure_id_set (event->structure, _subtitle_overlay_event_marker_id,
       G_TYPE_BOOLEAN, TRUE, NULL);
   *event2 = event;
@@ -645,7 +698,8 @@ _setup_passthrough (GstSubtitleOverlay * self)
   if (self->video_segment.format != GST_FORMAT_UNDEFINED) {
     GstEvent *event1, *event2;
 
-    _generate_update_newsegment_event (&self->video_segment, &event1, &event2);
+    _generate_update_newsegment_event (sink, &self->video_segment, &event1,
+        &event2);
     GST_DEBUG_OBJECT (self,
         "Pushing video accumulate newsegment event: %" GST_PTR_FORMAT,
         event1->structure);
@@ -681,18 +735,25 @@ out:
 }
 
 /* Must be called with subtitleoverlay lock! */
-static void
-gst_subtitle_overlay_set_fps (GstSubtitleOverlay * self)
+static gboolean
+_has_property_with_type (GObject * object, const gchar * property, GType type)
 {
   GObjectClass *gobject_class;
   GParamSpec *pspec;
 
+  gobject_class = G_OBJECT_GET_CLASS (object);
+  pspec = g_object_class_find_property (gobject_class, property);
+  return (pspec && pspec->value_type == type);
+}
+
+static void
+gst_subtitle_overlay_set_fps (GstSubtitleOverlay * self)
+{
   if (!self->parser || self->fps_d == 0)
     return;
 
-  gobject_class = G_OBJECT_GET_CLASS (self->parser);
-  pspec = g_object_class_find_property (gobject_class, "video-fps");
-  if (!pspec || pspec->value_type != GST_TYPE_FRACTION)
+  if (!_has_property_with_type (G_OBJECT (self->parser), "video-fps",
+          GST_TYPE_FRACTION))
     return;
 
   GST_DEBUG_OBJECT (self, "Updating video-fps property in parser");
@@ -709,15 +770,11 @@ _get_silent_property (GstElement * element, gboolean * invert)
   } properties[] = { {
   "silent", FALSE}, {
   "enable", TRUE}};
-  GObjectClass *gobject_class;
-  GParamSpec *pspec;
   guint i;
 
-  gobject_class = G_OBJECT_GET_CLASS (element);
-
   for (i = 0; i < G_N_ELEMENTS (properties); i++) {
-    pspec = g_object_class_find_property (gobject_class, properties[i].name);
-    if (pspec && pspec->value_type == G_TYPE_BOOLEAN) {
+    if (_has_property_with_type (G_OBJECT (element), properties[i].name,
+            G_TYPE_BOOLEAN)) {
       *invert = properties[i].invert;
       return properties[i].name;
     }
@@ -726,24 +783,277 @@ _get_silent_property (GstElement * element, gboolean * invert)
 }
 
 static gboolean
-_has_subtitle_encoding_property (GstElement * element)
+_setup_parser (GstSubtitleOverlay * self)
 {
-  GParamSpec *pspec;
+  GstPad *video_peer;
+
+  /* Try to get the latest video framerate */
+  video_peer = gst_pad_get_peer (self->video_sinkpad);
+  if (video_peer) {
+    GstCaps *video_caps;
+    gint fps_n, fps_d;
+
+    video_caps = gst_pad_get_negotiated_caps (video_peer);
+    if (!video_caps) {
+      video_caps = gst_pad_get_caps_reffed (video_peer);
+      if (!gst_caps_is_fixed (video_caps)) {
+        gst_caps_unref (video_caps);
+        video_caps = NULL;
+      }
+    }
+
+    if (video_caps
+        && gst_video_parse_caps_framerate (video_caps, &fps_n, &fps_d)) {
+      if (self->fps_n != fps_n || self->fps_d != fps_d) {
+        GST_DEBUG_OBJECT (self, "New video fps: %d/%d", fps_n, fps_d);
+        self->fps_n = fps_n;
+        self->fps_d = fps_d;
+      }
+    }
+
+    if (video_caps)
+      gst_caps_unref (video_caps);
+    gst_object_unref (video_peer);
+  }
+
+  if (_has_property_with_type (G_OBJECT (self->parser), "subtitle-encoding",
+          G_TYPE_STRING))
+    g_object_set (self->parser, "subtitle-encoding", self->encoding, NULL);
+
+  /* Try to set video fps on the parser */
+  gst_subtitle_overlay_set_fps (self);
+
 
-  pspec =
-      g_object_class_find_property (G_OBJECT_GET_CLASS (element),
-      "subtitle-encoding");
-  return (pspec && pspec->value_type == G_TYPE_STRING);
+  return TRUE;
 }
 
 static gboolean
-_has_font_desc_property (GstElement * element)
+_setup_renderer (GstSubtitleOverlay * self, GstElement * renderer)
 {
-  GParamSpec *pspec;
+  GstElementFactory *factory = gst_element_get_factory (renderer);
+  const gchar *name =
+      gst_plugin_feature_get_name (GST_PLUGIN_FEATURE_CAST (factory));
+
+  if (strcmp (name, "textoverlay") == 0) {
+    /* Set some textoverlay specific properties */
+    g_object_set (G_OBJECT (renderer),
+        "halign", "center", "valign", "bottom", "wait-text", FALSE, NULL);
+    if (self->font_desc)
+      g_object_set (G_OBJECT (renderer), "font-desc", self->font_desc, NULL);
+    self->silent_property = "silent";
+    self->silent_property_invert = FALSE;
+  } else {
+    self->silent_property =
+        _get_silent_property (renderer, &self->silent_property_invert);
+    if (_has_property_with_type (G_OBJECT (renderer), "subtitle-encoding",
+            G_TYPE_STRING))
+      g_object_set (renderer, "subtitle-encoding", self->encoding, NULL);
+    if (_has_property_with_type (G_OBJECT (renderer), "font-desc",
+            G_TYPE_STRING))
+      g_object_set (renderer, "font-desc", self->font_desc, NULL);
+  }
 
-  pspec =
-      g_object_class_find_property (G_OBJECT_GET_CLASS (element), "font-desc");
-  return (pspec && pspec->value_type == G_TYPE_STRING);
+  return TRUE;
+}
+
+/* subtitle_src==NULL means: use subtitle_sink ghostpad */
+static gboolean
+_link_renderer (GstSubtitleOverlay * self, GstElement * renderer,
+    GstPad * subtitle_src)
+{
+  GstPad *sink, *src;
+  gboolean is_video, is_hw;
+
+  is_video = _is_video_pad (self->video_sinkpad, &is_hw);
+
+  if (is_video) {
+    gboolean render_is_hw;
+
+    /* First check that renderer also supports the video format */
+    sink = _get_video_pad (renderer);
+    if (G_UNLIKELY (!sink)) {
+      GST_WARNING_OBJECT (self, "Can't get video sink from renderer");
+      return FALSE;
+    }
+
+    if (is_video != _is_video_pad (sink, &render_is_hw) ||
+        is_hw != render_is_hw) {
+      GST_DEBUG_OBJECT (self, "Renderer doesn't support %s video",
+          is_hw ? "surface" : "raw");
+      gst_object_unref (sink);
+      return FALSE;
+    }
+    gst_object_unref (sink);
+
+    if (!is_hw) {
+      /* First link everything internally */
+      if (G_UNLIKELY (!_create_element (self, &self->post_colorspace,
+                  COLORSPACE, NULL, "post-colorspace", FALSE))) {
+        return FALSE;
+      }
+      src = gst_element_get_static_pad (renderer, "src");
+      if (G_UNLIKELY (!src)) {
+        GST_WARNING_OBJECT (self, "Can't get src pad from renderer");
+        return FALSE;
+      }
+
+      sink = gst_element_get_static_pad (self->post_colorspace, "sink");
+      if (G_UNLIKELY (!sink)) {
+        GST_WARNING_OBJECT (self, "Can't get sink pad from " COLORSPACE);
+        gst_object_unref (src);
+        return FALSE;
+      }
+
+      if (G_UNLIKELY (gst_pad_link (src, sink) != GST_PAD_LINK_OK)) {
+        GST_WARNING_OBJECT (self, "Can't link renderer with " COLORSPACE);
+        gst_object_unref (src);
+        gst_object_unref (sink);
+        return FALSE;
+      }
+      gst_object_unref (src);
+      gst_object_unref (sink);
+
+      if (G_UNLIKELY (!_create_element (self, &self->pre_colorspace,
+                  COLORSPACE, NULL, "pre-colorspace", FALSE))) {
+        return FALSE;
+      }
+
+      sink = _get_video_pad (renderer);
+      if (G_UNLIKELY (!sink)) {
+        GST_WARNING_OBJECT (self, "Can't get video sink from renderer");
+        return FALSE;
+      }
+
+      src = gst_element_get_static_pad (self->pre_colorspace, "src");
+      if (G_UNLIKELY (!src)) {
+        GST_WARNING_OBJECT (self, "Can't get srcpad from " COLORSPACE);
+        gst_object_unref (sink);
+        return FALSE;
+      }
+
+      if (G_UNLIKELY (gst_pad_link (src, sink) != GST_PAD_LINK_OK)) {
+        GST_WARNING_OBJECT (self, "Can't link " COLORSPACE " to renderer");
+        gst_object_unref (src);
+        gst_object_unref (sink);
+        return FALSE;
+      }
+      gst_object_unref (src);
+      gst_object_unref (sink);
+
+      /* Set src ghostpad target */
+      src = gst_element_get_static_pad (self->post_colorspace, "src");
+      if (G_UNLIKELY (!src)) {
+        GST_WARNING_OBJECT (self, "Can't get src pad from " COLORSPACE);
+        return FALSE;
+      }
+    } else {
+      /* Set src ghostpad target in the harware accelerated case */
+
+      src = gst_element_get_static_pad (renderer, "src");
+      if (G_UNLIKELY (!src)) {
+        GST_WARNING_OBJECT (self, "Can't get src pad from renderer");
+        return FALSE;
+      }
+    }
+  } else {                      /* No video pad */
+    GstCaps *allowed_caps, *video_caps = NULL;
+    GstPad *video_peer;
+    gboolean can_intersect = FALSE;
+
+    video_peer = gst_pad_get_peer (self->video_sinkpad);
+    if (video_peer) {
+      video_caps = gst_pad_get_negotiated_caps (video_peer);
+      if (!video_caps) {
+        video_caps = gst_pad_get_caps_reffed (video_peer);
+      }
+      gst_object_unref (video_peer);
+    }
+
+    sink = _get_video_pad (renderer);
+    if (G_UNLIKELY (!sink)) {
+      GST_WARNING_OBJECT (self, "Can't get video sink from renderer");
+      return FALSE;
+    }
+    allowed_caps = gst_pad_get_caps_reffed (sink);
+    gst_object_unref (sink);
+
+    if (allowed_caps && video_caps)
+      can_intersect = gst_caps_can_intersect (allowed_caps, video_caps);
+
+    if (allowed_caps)
+      gst_caps_unref (allowed_caps);
+
+    if (video_caps)
+      gst_caps_unref (video_caps);
+
+    if (G_UNLIKELY (!can_intersect)) {
+      GST_WARNING_OBJECT (self, "Renderer with custom caps is not "
+          "compatible with video stream");
+      return FALSE;
+    }
+
+    src = gst_element_get_static_pad (renderer, "src");
+    if (G_UNLIKELY (!src)) {
+      GST_WARNING_OBJECT (self, "Can't get src pad from renderer");
+      return FALSE;
+    }
+  }
+
+  if (G_UNLIKELY (!gst_ghost_pad_set_target (GST_GHOST_PAD_CAST
+              (self->srcpad), src))) {
+    GST_WARNING_OBJECT (self, "Can't set srcpad target");
+    gst_object_unref (src);
+    return FALSE;
+  }
+  gst_object_unref (src);
+
+  /* Set the sink ghostpad targets */
+  if (self->pre_colorspace) {
+    sink = gst_element_get_static_pad (self->pre_colorspace, "sink");
+    if (G_UNLIKELY (!sink)) {
+      GST_WARNING_OBJECT (self, "Can't get sink pad from " COLORSPACE);
+      return FALSE;
+    }
+  } else {
+    sink = _get_video_pad (renderer);
+    if (G_UNLIKELY (!sink)) {
+      GST_WARNING_OBJECT (self, "Can't get sink pad from %" GST_PTR_FORMAT,
+          renderer);
+      return FALSE;
+    }
+  }
+
+  if (G_UNLIKELY (!gst_ghost_pad_set_target (GST_GHOST_PAD_CAST
+              (self->video_sinkpad), sink))) {
+    GST_WARNING_OBJECT (self, "Can't set video sinkpad target");
+    gst_object_unref (sink);
+    return FALSE;
+  }
+  gst_object_unref (sink);
+
+  sink = _get_sub_pad (renderer);
+  if (G_UNLIKELY (!sink)) {
+    GST_WARNING_OBJECT (self, "Failed to get subpad");
+    return FALSE;
+  }
+
+  if (subtitle_src) {
+    if (G_UNLIKELY (gst_pad_link (subtitle_src, sink) != GST_PAD_LINK_OK)) {
+      GST_WARNING_OBJECT (self, "Failed to link subtitle srcpad with renderer");
+      gst_object_unref (sink);
+      return FALSE;
+    }
+  } else {
+    if (G_UNLIKELY (!gst_ghost_pad_set_target (GST_GHOST_PAD_CAST
+                (self->subtitle_sinkpad), sink))) {
+      GST_WARNING_OBJECT (self, "Failed to set subtitle sink target");
+      gst_object_unref (sink);
+      return FALSE;
+    }
+  }
+  gst_object_unref (sink);
+
+  return TRUE;
 }
 
 static void
@@ -870,8 +1180,7 @@ _pad_blocked_cb (GstPad * pad, gboolean blocked, gpointer user_data)
 
   for (l = factories; l; l = l->next) {
     GstElementFactory *factory = l->data;
-    gboolean is_video, is_hw, is_renderer = _is_renderer (factory);
-    GstElement *element;
+    gboolean is_renderer = _is_renderer (factory);
     GstPad *sink, *src;
 
     /* Unlink & destroy everything */
@@ -899,519 +1208,114 @@ _pad_blocked_cb (GstPad * pad, gboolean blocked, gpointer user_data)
                     "parser", FALSE))))
       continue;
 
-    element = is_renderer ? self->renderer : self->parser;
-
-    is_video = _is_video_pad (self->video_sinkpad, &is_hw);
-    /* If this is a parser, create textoverlay and link video and the parser to it
-     * Else link the renderer to the output colorspace */
     if (!is_renderer) {
-      GstElement *overlay;
-      GstPad *video_peer;
-
-      /* Try to get the latest video framerate */
-      video_peer = gst_pad_get_peer (self->video_sinkpad);
-      if (video_peer) {
-        GstCaps *video_caps;
-        gint fps_n, fps_d;
-
-        video_caps = gst_pad_get_negotiated_caps (video_peer);
-        if (!video_caps) {
-          video_caps = gst_pad_get_caps_reffed (video_peer);
-          if (!gst_caps_is_fixed (video_caps)) {
-            gst_caps_unref (video_caps);
-            video_caps = NULL;
-          }
-        }
+      GstCaps *parser_caps;
+      GList *overlay_factories, *k;
 
-        if (video_caps
-            && gst_video_parse_caps_framerate (video_caps, &fps_n, &fps_d)) {
-          if (self->fps_n != fps_n || self->fps_d != fps_d) {
-            GST_DEBUG_OBJECT (self, "New video fps: %d/%d", fps_n, fps_d);
-            self->fps_n = fps_n;
-            self->fps_d = fps_d;
-          }
-        }
-
-        if (video_caps)
-          gst_caps_unref (video_caps);
-        gst_object_unref (video_peer);
-      }
-
-      if (_has_subtitle_encoding_property (self->parser))
-        g_object_set (self->parser, "subtitle-encoding", self->encoding, NULL);
-
-      /* Try to set video fps on the parser */
-      gst_subtitle_overlay_set_fps (self);
-
-      /* First link everything internally */
-      if (G_UNLIKELY (!_create_element (self, &self->overlay, "textoverlay",
-                  NULL, "overlay", FALSE))) {
+      if (!_setup_parser (self))
         continue;
-      }
-      overlay = self->overlay;
-      self->silent_property = "silent";
-      self->silent_property_invert = FALSE;
 
-      /* Set some properties */
-      g_object_set (G_OBJECT (overlay),
-          "halign", "center", "valign", "bottom", "wait-text", FALSE, NULL);
-      if (self->font_desc)
-        g_object_set (G_OBJECT (overlay), "font-desc", self->font_desc, NULL);
+      /* Find our factories */
+      src = gst_element_get_static_pad (self->parser, "src");
+      parser_caps = gst_pad_get_caps_reffed (src);
+      gst_object_unref (src);
 
-      src = gst_element_get_static_pad (element, "src");
-      if (G_UNLIKELY (!src)) {
-        continue;
-      }
+      g_assert (parser_caps != NULL);
 
-      sink = gst_element_get_static_pad (overlay, "text_sink");
-      if (G_UNLIKELY (!sink)) {
-        GST_WARNING_OBJECT (self, "Can't get text sink from textoverlay");
-        gst_object_unref (src);
-        continue;
-      }
+      g_mutex_lock (self->factories_lock);
+      gst_subtitle_overlay_update_factory_list (self);
+      GST_DEBUG_OBJECT (self,
+          "Searching overlay factories for caps %" GST_PTR_FORMAT, parser_caps);
+      overlay_factories =
+          gst_subtitle_overlay_get_factories_for_caps (self->factories,
+          parser_caps);
+      g_mutex_unlock (self->factories_lock);
 
-      if (G_UNLIKELY (gst_pad_link (src, sink) != GST_PAD_LINK_OK)) {
-        GST_WARNING_OBJECT (self, "Can't link parser to textoverlay");
-        gst_object_unref (sink);
-        gst_object_unref (src);
+      if (!overlay_factories) {
+        GST_WARNING_OBJECT (self,
+            "Found no suitable overlay factories for caps %" GST_PTR_FORMAT,
+            parser_caps);
+        gst_caps_unref (parser_caps);
         continue;
       }
-      gst_object_unref (sink);
-      gst_object_unref (src);
-
-      /* If we are working with video/x-surface, we do not add
-       * colorspace conversion elements */
-      if (is_video && !is_hw) {
-        if (G_UNLIKELY (!_create_element (self, &self->post_colorspace,
-                    COLORSPACE, NULL, "post-colorspace", FALSE))) {
-          continue;
-        }
-
-        src = gst_element_get_static_pad (overlay, "src");
-        if (G_UNLIKELY (!src)) {
-          GST_WARNING_OBJECT (self, "Can't get src pad from overlay");
-          continue;
-        }
-
-        sink = gst_element_get_static_pad (self->post_colorspace, "sink");
-        if (G_UNLIKELY (!sink)) {
-          GST_WARNING_OBJECT (self, "Can't get sink pad from " COLORSPACE);
-          gst_object_unref (src);
-          continue;
-        }
+      gst_caps_unref (parser_caps);
 
-        if (G_UNLIKELY (gst_pad_link (src, sink) != GST_PAD_LINK_OK)) {
-          GST_WARNING_OBJECT (self, "Can't link overlay with " COLORSPACE);
-          gst_object_unref (src);
-          gst_object_unref (sink);
-          continue;
-        }
-        gst_object_unref (src);
-        gst_object_unref (sink);
+      /* Sort the factories by rank */
+      overlay_factories =
+          g_list_sort (overlay_factories, (GCompareFunc) _sort_by_ranks);
 
-        if (G_UNLIKELY (!_create_element (self, &self->pre_colorspace,
-                    "identity", NULL, "pre-colorspace", FALSE))) {
-          continue;
-        }
+      for (k = overlay_factories; k; k = k->next) {
+        GstElementFactory *overlay_factory = k->data;
 
-        sink = gst_element_get_static_pad (overlay, "video_sink");
-        if (G_UNLIKELY (!sink)) {
-          GST_WARNING_OBJECT (self, "Can't get video sink from textoverlay");
-          continue;
-        }
+        GST_DEBUG_OBJECT (self, "Trying overlay factory '%s'",
+            GST_STR_NULL (gst_plugin_feature_get_name (GST_PLUGIN_FEATURE_CAST
+                    (overlay_factory))));
 
-        src = gst_element_get_static_pad (self->pre_colorspace, "src");
-        if (G_UNLIKELY (!src)) {
-          GST_WARNING_OBJECT (self, "Can't get srcpad from " COLORSPACE);
-          gst_object_unref (sink);
-          continue;
-        }
+        /* Try this factory and link it, otherwise unlink everything
+         * again and remove the overlay. Up to this point only the
+         * parser was instantiated and setup, nothing was linked
+         */
 
-        if (G_UNLIKELY (gst_pad_link (src, sink) != GST_PAD_LINK_OK)) {
-          GST_WARNING_OBJECT (self, "Can't link " COLORSPACE " to textoverlay");
-          gst_object_unref (src);
-          gst_object_unref (sink);
-          continue;
-        }
-        gst_object_unref (src);
-        gst_object_unref (sink);
+        gst_ghost_pad_set_target (GST_GHOST_PAD_CAST (self->srcpad), NULL);
+        gst_ghost_pad_set_target (GST_GHOST_PAD_CAST (self->video_sinkpad),
+            NULL);
+        gst_ghost_pad_set_target (GST_GHOST_PAD_CAST (self->subtitle_sinkpad),
+            NULL);
+        self->silent_property = NULL;
+        _remove_element (self, &self->post_colorspace);
+        _remove_element (self, &self->overlay);
+        _remove_element (self, &self->pre_colorspace);
 
-        /* Set src ghostpad target */
-        src = gst_element_get_static_pad (self->post_colorspace, "src");
-        if (G_UNLIKELY (!src)) {
-          GST_WARNING_OBJECT (self, "Can't get src pad from " COLORSPACE);
+        if (!_create_element (self, &self->overlay, NULL, overlay_factory,
+                "overlay", FALSE))
           continue;
-        }
 
-        if (G_UNLIKELY (!gst_ghost_pad_set_target (GST_GHOST_PAD_CAST
-                    (self->srcpad), src))) {
-          GST_WARNING_OBJECT (self, "Can't set srcpad target");
-          gst_object_unref (src);
-          continue;
-        }
-        gst_object_unref (src);
-      } else if (is_hw) {
-        GST_DEBUG_OBJECT (self,
-            "Is Hardware, not adding colorspace converters, ");
-        /* Set src ghostpad target */
-        src = gst_element_get_static_pad (self->overlay, "src");
-        if (G_UNLIKELY (!src)) {
-          GST_WARNING_OBJECT (self, "Can't get src pad from textoverlay");
+        if (!_setup_renderer (self, self->overlay))
           continue;
-        }
 
-        if (G_UNLIKELY (!gst_ghost_pad_set_target (GST_GHOST_PAD_CAST
-                    (self->srcpad), src))) {
-          GST_WARNING_OBJECT (self, "Can't set srcpad target");
+        src = gst_element_get_static_pad (self->parser, "src");
+        if (!_link_renderer (self, self->overlay, src)) {
           gst_object_unref (src);
           continue;
         }
         gst_object_unref (src);
-      }
-
-      /* Send segments to the parser/overlay if necessary. These are not sent
-       * outside this element because of the proxy pad event function */
-      if (self->video_segment.format != GST_FORMAT_UNDEFINED) {
-        GstEvent *event1, *event2;
-
-        if (is_video) {
-          sink = gst_element_get_static_pad (self->pre_colorspace, "sink");
-          if (G_UNLIKELY (!sink)) {
-            GST_WARNING_OBJECT (self, "Can't get sink pad from " COLORSPACE);
-            continue;
-          }
-        } else {
-          sink = gst_element_get_static_pad (self->overlay, "video_sink");
-          if (G_UNLIKELY (!sink)) {
-            GST_WARNING_OBJECT (self, "Can't get sink pad from textoverlay");
-            continue;
-          }
-        }
-
-        _generate_update_newsegment_event (&self->video_segment, &event1,
-            &event2);
-        GST_DEBUG_OBJECT (self,
-            "Pushing video accumulate newsegment event: %" GST_PTR_FORMAT,
-            event1->structure);
-        GST_DEBUG_OBJECT (self,
-            "Pushing video update newsegment event: %" GST_PTR_FORMAT,
-            event2->structure);
-        gst_pad_send_event (sink, event1);
-        gst_pad_send_event (sink, event2);
-
-        gst_object_unref (sink);
-      }
-
-      if (self->subtitle_segment.format != GST_FORMAT_UNDEFINED) {
-        GstEvent *event1, *event2;
 
-        sink = gst_element_get_static_pad (element, "sink");
-        if (G_UNLIKELY (!sink)) {
-          GST_WARNING_OBJECT (self, "Failed to get subpad");
-          continue;
-        }
-
-        _generate_update_newsegment_event (&self->subtitle_segment, &event1,
-            &event2);
-        GST_DEBUG_OBJECT (self,
-            "Pushing subtitle accumulate newsegment event: %" GST_PTR_FORMAT,
-            event1->structure);
-        GST_DEBUG_OBJECT (self,
-            "Pushing subtitle update newsegment event: %" GST_PTR_FORMAT,
-            event2->structure);
-        gst_pad_send_event (sink, event1);
-        gst_pad_send_event (sink, event2);
-
-        gst_object_unref (sink);
-      }
-
-      /* Set the sink ghostpad targets */
-      if (is_video && !is_hw) {
-        sink = gst_element_get_static_pad (self->pre_colorspace, "sink");
-        if (G_UNLIKELY (!sink)) {
-          GST_WARNING_OBJECT (self, "Can't get sink pad from " COLORSPACE);
-          continue;
-        }
-      } else if (is_video && is_hw) {
-        GST_DEBUG_OBJECT (self, "Setting ghostpad to overlay video sink");
-        sink = gst_element_get_static_pad (self->overlay, "video_sink");
-        if (G_UNLIKELY (!sink)) {
-          GST_WARNING_OBJECT (self, "Can't get sink pad from overlay");
-          continue;
-        }
+        /* Everything done here, go out of loop */
+        break;
       }
 
-      if (G_UNLIKELY (!gst_ghost_pad_set_target (GST_GHOST_PAD_CAST
-                  (self->video_sinkpad), sink))) {
-        GST_WARNING_OBJECT (self, "Can't set video sinkpad target");
-        gst_object_unref (sink);
-        continue;
-      }
-      gst_object_unref (sink);
+      if (overlay_factories)
+        gst_plugin_feature_list_free (overlay_factories);
 
-      /* Link subtitle identity to subtitle pad of our element */
-      sink = gst_element_get_static_pad (element, "sink");
-      if (G_UNLIKELY (!sink)) {
-        GST_WARNING_OBJECT (self, "Failed to get subpad");
+      if (G_UNLIKELY (k == NULL)) {
+        GST_WARNING_OBJECT (self, "Failed to find usable overlay factory");
         continue;
       }
 
-      if (G_UNLIKELY (!gst_ghost_pad_set_target (GST_GHOST_PAD_CAST
-                  (self->subtitle_sinkpad), sink))) {
-        GST_WARNING_OBJECT (self, "Failed to set subtitle sink target");
+      /* Now link subtitle sinkpad of the bin and the parser */
+      sink = gst_element_get_static_pad (self->parser, "sink");
+      if (!gst_ghost_pad_set_target (GST_GHOST_PAD_CAST
+              (self->subtitle_sinkpad), sink)) {
         gst_object_unref (sink);
         continue;
       }
       gst_object_unref (sink);
-    } else {
-      const gchar *name =
-          gst_plugin_feature_get_name (GST_PLUGIN_FEATURE_CAST (factory));
-
-      if (strcmp (name, "textoverlay") == 0) {
-        /* Set some textoverlay specific properties */
-        g_object_set (G_OBJECT (element),
-            "halign", "center", "valign", "bottom", "wait-text", FALSE, NULL);
-        if (self->font_desc)
-          g_object_set (G_OBJECT (element), "font-desc", self->font_desc, NULL);
-        self->silent_property = "silent";
-        self->silent_property_invert = FALSE;
-      } else {
-        self->silent_property =
-            _get_silent_property (element, &self->silent_property_invert);
-        if (_has_subtitle_encoding_property (self->renderer))
-          g_object_set (self->renderer, "subtitle-encoding", self->encoding,
-              NULL);
-        if (_has_font_desc_property (self->renderer))
-          g_object_set (self->renderer, "font-desc", self->font_desc, NULL);
-      }
-
-      if (is_video) {
-        gboolean render_is_hw;
-
-        /* First check that renderer also supports the video format */
-        sink = _get_video_pad (element);
-        if (G_UNLIKELY (!sink)) {
-          GST_WARNING_OBJECT (self, "Can't get video sink from renderer");
-          continue;
-        }
-
-        if (is_video != _is_video_pad (sink, &render_is_hw) ||
-            is_hw != render_is_hw) {
-          GST_DEBUG_OBJECT (self, "Renderer doesn't support %s video",
-              is_hw ? "surface" : "raw");
-          gst_object_unref (sink);
-          continue;
-        }
-        gst_object_unref (sink);
-
-        if (!is_hw) {
-          /* First link everything internally */
-          if (G_UNLIKELY (!_create_element (self, &self->post_colorspace,
-                      COLORSPACE, NULL, "post-colorspace", FALSE))) {
-            continue;
-          }
-          src = gst_element_get_static_pad (element, "src");
-          if (G_UNLIKELY (!src)) {
-            GST_WARNING_OBJECT (self, "Can't get src pad from renderer");
-            continue;
-          }
-
-          sink = gst_element_get_static_pad (self->post_colorspace, "sink");
-          if (G_UNLIKELY (!sink)) {
-            GST_WARNING_OBJECT (self, "Can't get sink pad from " COLORSPACE);
-            gst_object_unref (src);
-            continue;
-          }
-
-          if (G_UNLIKELY (gst_pad_link (src, sink) != GST_PAD_LINK_OK)) {
-            GST_WARNING_OBJECT (self, "Can't link renderer with " COLORSPACE);
-            gst_object_unref (src);
-            gst_object_unref (sink);
-            continue;
-          }
-          gst_object_unref (src);
-          gst_object_unref (sink);
-
-          if (G_UNLIKELY (!_create_element (self, &self->pre_colorspace,
-                      COLORSPACE, NULL, "pre-colorspace", FALSE))) {
-            continue;
-          }
-
-          sink = _get_video_pad (element);
-          if (G_UNLIKELY (!sink)) {
-            GST_WARNING_OBJECT (self, "Can't get video sink from renderer");
-            continue;
-          }
-
-          src = gst_element_get_static_pad (self->pre_colorspace, "src");
-          if (G_UNLIKELY (!src)) {
-            GST_WARNING_OBJECT (self, "Can't get srcpad from " COLORSPACE);
-            gst_object_unref (sink);
-            continue;
-          }
-
-          if (G_UNLIKELY (gst_pad_link (src, sink) != GST_PAD_LINK_OK)) {
-            GST_WARNING_OBJECT (self, "Can't link " COLORSPACE " to renderer");
-            gst_object_unref (src);
-            gst_object_unref (sink);
-            continue;
-          }
-          gst_object_unref (src);
-          gst_object_unref (sink);
-
-          /* Set src ghostpad target */
-          src = gst_element_get_static_pad (self->post_colorspace, "src");
-          if (G_UNLIKELY (!src)) {
-            GST_WARNING_OBJECT (self, "Can't get src pad from " COLORSPACE);
-            continue;
-          }
-        } else {
-          /* Set src ghostpad target in the harware accelerated case */
-
-          src = gst_element_get_static_pad (self->renderer, "src");
-          if (G_UNLIKELY (!src)) {
-            GST_WARNING_OBJECT (self, "Can't get src pad from renderer");
-            continue;
-          }
-        }
-      } else {                  /* No video pad */
-        GstCaps *allowed_caps, *video_caps = NULL;
-        GstPad *video_peer;
-        gboolean can_intersect = FALSE;
-
-        video_peer = gst_pad_get_peer (self->video_sinkpad);
-        if (video_peer) {
-          video_caps = gst_pad_get_negotiated_caps (video_peer);
-          if (!video_caps) {
-            video_caps = gst_pad_get_caps_reffed (video_peer);
-          }
-          gst_object_unref (video_peer);
-        }
-
-        sink = _get_video_pad (element);
-        if (G_UNLIKELY (!sink)) {
-          GST_WARNING_OBJECT (self, "Can't get video sink from renderer");
-          continue;
-        }
-        allowed_caps = gst_pad_get_caps_reffed (sink);
-        gst_object_unref (sink);
-
-        if (allowed_caps && video_caps)
-          can_intersect = gst_caps_can_intersect (allowed_caps, video_caps);
-
-        if (allowed_caps)
-          gst_caps_unref (allowed_caps);
 
-        if (video_caps)
-          gst_caps_unref (video_caps);
-
-        if (G_UNLIKELY (!can_intersect)) {
-          GST_WARNING_OBJECT (self, "Renderer with custom caps is not "
-              "compatible with video stream");
-          continue;
-        }
-
-        src = gst_element_get_static_pad (element, "src");
-        if (G_UNLIKELY (!src)) {
-          GST_WARNING_OBJECT (self, "Can't get src pad from renderer");
-          continue;
-        }
-      }
-
-      if (G_UNLIKELY (!gst_ghost_pad_set_target (GST_GHOST_PAD_CAST
-                  (self->srcpad), src))) {
-        GST_WARNING_OBJECT (self, "Can't set srcpad target");
-        gst_object_unref (src);
-        continue;
-      }
-      gst_object_unref (src);
-
-      /* Send segments to the renderer if necessary. These are not sent
-       * outside this element because of the proxy pad event handler */
-      if (self->video_segment.format != GST_FORMAT_UNDEFINED) {
-        GstEvent *event1, *event2;
-
-        sink = gst_element_get_static_pad (self->pre_colorspace, "sink");
-        if (G_UNLIKELY (!sink)) {
-          GST_WARNING_OBJECT (self, "Can't get sink pad from " COLORSPACE);
-          continue;
-        }
-
-        _generate_update_newsegment_event (&self->video_segment, &event1,
-            &event2);
-        GST_DEBUG_OBJECT (self,
-            "Pushing video accumulate newsegment event: %" GST_PTR_FORMAT,
-            event1->structure);
-        GST_DEBUG_OBJECT (self,
-            "Pushing video update newsegment event: %" GST_PTR_FORMAT,
-            event2->structure);
-        gst_pad_send_event (sink, event1);
-        gst_pad_send_event (sink, event2);
-        gst_object_unref (sink);
-      }
-
-      if (self->subtitle_segment.format != GST_FORMAT_UNDEFINED) {
-        GstEvent *event1, *event2;
-
-        sink = _get_sub_pad (element);
-        if (G_UNLIKELY (!sink)) {
-          GST_WARNING_OBJECT (self, "Failed to get subpad");
-          continue;
-        }
-
-        _generate_update_newsegment_event (&self->subtitle_segment, &event1,
-            &event2);
-        GST_DEBUG_OBJECT (self,
-            "Pushing subtitle accumulate newsegment event: %" GST_PTR_FORMAT,
-            event1->structure);
-        GST_DEBUG_OBJECT (self,
-            "Pushing subtitle update newsegment event: %" GST_PTR_FORMAT,
-            event2->structure);
-        gst_pad_send_event (sink, event1);
-        gst_pad_send_event (sink, event2);
-        gst_object_unref (sink);
-      }
-
-      /* Set the sink ghostpad targets */
-      if (self->pre_colorspace) {
-        sink = gst_element_get_static_pad (self->pre_colorspace, "sink");
-        if (G_UNLIKELY (!sink)) {
-          GST_WARNING_OBJECT (self, "Can't get sink pad from " COLORSPACE);
-          continue;
-        }
-      } else {
-        sink = _get_video_pad (element);
-        if (G_UNLIKELY (!sink)) {
-          GST_WARNING_OBJECT (self, "Can't get sink pad from %" GST_PTR_FORMAT,
-              element);
-          continue;
-        }
-      }
+      /* Everything done here, go out of loop */
+      break;
+    } else {
+      /* Is renderer factory */
 
-      if (G_UNLIKELY (!gst_ghost_pad_set_target (GST_GHOST_PAD_CAST
-                  (self->video_sinkpad), sink))) {
-        GST_WARNING_OBJECT (self, "Can't set video sinkpad target");
-        gst_object_unref (sink);
+      if (!_setup_renderer (self, self->renderer))
         continue;
-      }
-      gst_object_unref (sink);
 
-      sink = _get_sub_pad (element);
-      if (G_UNLIKELY (!sink)) {
-        GST_WARNING_OBJECT (self, "Failed to get subpad");
+      /* subtitle_src==NULL means: use subtitle_sink ghostpad */
+      if (!_link_renderer (self, self->renderer, NULL))
         continue;
-      }
 
-      if (G_UNLIKELY (!gst_ghost_pad_set_target (GST_GHOST_PAD_CAST
-                  (self->subtitle_sinkpad), sink))) {
-        GST_WARNING_OBJECT (self, "Failed to set subtitle sink target");
-        gst_object_unref (sink);
-        continue;
-      }
-      gst_object_unref (sink);
+      /* Everything done here, go out of loop */
+      break;
     }
-
-    break;
   }
 
   if (G_UNLIKELY (l == NULL)) {
@@ -1420,15 +1324,63 @@ _pad_blocked_cb (GstPad * pad, gboolean blocked, gpointer user_data)
     self->subtitle_error = TRUE;
     _setup_passthrough (self);
     do_async_done (self);
-  } else {
-    GST_DEBUG_OBJECT (self, "Everything worked, unblocking pads");
-    gst_pad_set_blocked_async_full (self->video_block_pad, FALSE,
-        _pad_blocked_cb, self, NULL);
-    gst_pad_set_blocked_async_full (self->subtitle_block_pad, FALSE,
-        _pad_blocked_cb, self, NULL);
-    do_async_done (self);
+    goto out;
+  }
+
+  /* Send segments to the renderer if necessary. These are not sent
+   * outside this element because of the proxy pad event handler */
+  if (self->video_segment.format != GST_FORMAT_UNDEFINED) {
+    GstEvent *event1, *event2;
+    GstPad *sink;
+
+    if (self->pre_colorspace) {
+      sink = gst_element_get_static_pad (self->pre_colorspace, "sink");
+    } else {
+      sink = _get_video_pad ((self->renderer) ? self->renderer : self->overlay);
+    }
+
+    _generate_update_newsegment_event (sink, &self->video_segment, &event1,
+        &event2);
+    GST_DEBUG_OBJECT (self,
+        "Pushing video accumulate newsegment event: %" GST_PTR_FORMAT,
+        event1->structure);
+    GST_DEBUG_OBJECT (self,
+        "Pushing video update newsegment event: %" GST_PTR_FORMAT,
+        event2->structure);
+    gst_pad_send_event (sink, event1);
+    gst_pad_send_event (sink, event2);
+    gst_object_unref (sink);
   }
 
+  if (self->subtitle_segment.format != GST_FORMAT_UNDEFINED) {
+    GstEvent *event1, *event2;
+    GstPad *sink;
+
+    if (self->renderer)
+      sink = _get_sub_pad (self->renderer);
+    else
+      sink = gst_element_get_static_pad (self->parser, "sink");
+
+    _generate_update_newsegment_event (sink, &self->subtitle_segment, &event1,
+        &event2);
+    GST_DEBUG_OBJECT (self,
+        "Pushing subtitle accumulate newsegment event: %" GST_PTR_FORMAT,
+        event1->structure);
+    GST_DEBUG_OBJECT (self,
+        "Pushing subtitle update newsegment event: %" GST_PTR_FORMAT,
+        event2->structure);
+    gst_pad_send_event (sink, event1);
+    gst_pad_send_event (sink, event2);
+    gst_object_unref (sink);
+  }
+
+  GST_DEBUG_OBJECT (self, "Everything worked, unblocking pads");
+  gst_pad_set_blocked_async_full (self->video_block_pad, FALSE,
+      _pad_blocked_cb, self, NULL);
+  gst_pad_set_blocked_async_full (self->subtitle_block_pad, FALSE,
+      _pad_blocked_cb, self, NULL);
+  do_async_done (self);
+
 out:
   if (factories)
     gst_plugin_feature_list_free (factories);
@@ -1669,9 +1621,13 @@ gst_subtitle_overlay_set_property (GObject * object, guint prop_id,
       GST_SUBTITLE_OVERLAY_LOCK (self);
       g_free (self->font_desc);
       self->font_desc = g_value_dup_string (value);
-      if (self->overlay)
+      if (self->overlay
+          && _has_property_with_type (G_OBJECT (self->overlay), "font-desc",
+              G_TYPE_STRING))
         g_object_set (self->overlay, "font-desc", self->font_desc, NULL);
-      else if (self->renderer && _has_font_desc_property (self->renderer))
+      else if (self->renderer
+          && _has_property_with_type (G_OBJECT (self->renderer), "font-desc",
+              G_TYPE_STRING))
         g_object_set (self->renderer, "font-desc", self->font_desc, NULL);
       GST_SUBTITLE_OVERLAY_UNLOCK (self);
       break;
@@ -1679,10 +1635,14 @@ gst_subtitle_overlay_set_property (GObject * object, guint prop_id,
       GST_SUBTITLE_OVERLAY_LOCK (self);
       g_free (self->encoding);
       self->encoding = g_value_dup_string (value);
-      if (self->renderer && _has_subtitle_encoding_property (self->renderer))
+      if (self->renderer
+          && _has_property_with_type (G_OBJECT (self->renderer),
+              "subtitle-encoding", G_TYPE_STRING))
         g_object_set (self->renderer, "subtitle-encoding", self->encoding,
             NULL);
-      if (self->parser && _has_subtitle_encoding_property (self->parser))
+      if (self->parser
+          && _has_property_with_type (G_OBJECT (self->parser),
+              "subtitle-encoding", G_TYPE_STRING))
         g_object_set (self->parser, "subtitle-encoding", self->encoding, NULL);
       GST_SUBTITLE_OVERLAY_UNLOCK (self);
       break;
@@ -1799,8 +1759,8 @@ gst_subtitle_overlay_src_proxy_event (GstPad * proxypad, GstEvent * event)
 
   s = gst_event_get_structure (event);
   if (s && gst_structure_id_has_field (s, _subtitle_overlay_event_marker_id)) {
-    GST_DEBUG_OBJECT (ghostpad, "Dropping event with marker: %" GST_PTR_FORMAT,
-        event->structure);
+    GST_DEBUG_OBJECT (ghostpad,
+        "Dropping event with marker: %" GST_PTR_FORMAT, event->structure);
     gst_event_unref (event);
     event = NULL;
     ret = TRUE;
@@ -2118,10 +2078,12 @@ gst_subtitle_overlay_subtitle_sink_event (GstPad * pad, GstEvent * event)
   gboolean ret;
   GstFormat format;
 
+  GST_DEBUG_OBJECT (pad, "Got event %" GST_PTR_FORMAT, event);
+
   if (GST_EVENT_TYPE (event) == GST_EVENT_CUSTOM_DOWNSTREAM_OOB &&
       event->structure
       && strcmp (gst_structure_get_name (event->structure),
-          "subtitleoverlay-flush-subtitle") == 0) {
+          "playsink-custom-subtitle-flush") == 0) {
     GST_DEBUG_OBJECT (pad, "Custom subtitle flush event");
     GST_SUBTITLE_OVERLAY_LOCK (self);
     self->subtitle_flush = TRUE;
@@ -2170,8 +2132,8 @@ gst_subtitle_overlay_subtitle_sink_event (GstPad * pad, GstEvent * event)
         gst_structure_set_parent_refcount (event->structure,
             &event->mini_object.refcount);
       }
-      gst_structure_id_set (event->structure, _subtitle_overlay_event_marker_id,
-          G_TYPE_BOOLEAN, TRUE, NULL);
+      gst_structure_id_set (event->structure,
+          _subtitle_overlay_event_marker_id, G_TYPE_BOOLEAN, TRUE, NULL);
       break;
     default:
       break;
@@ -2191,15 +2153,43 @@ gst_subtitle_overlay_subtitle_sink_event (GstPad * pad, GstEvent * event)
 
     GST_DEBUG_OBJECT (pad, "Old subtitle segment: %" GST_SEGMENT_FORMAT,
         &self->subtitle_segment);
-    if (self->subtitle_segment.format != format) {
-      GST_DEBUG_OBJECT (pad, "Subtitle segment format changed: %s -> %s",
-          gst_format_get_name (self->subtitle_segment.format),
-          gst_format_get_name (format));
-      gst_segment_init (&self->subtitle_segment, format);
+    if (self->subtitle_segment.format != GST_FORMAT_TIME) {
+      gst_segment_init (&self->subtitle_segment, GST_FORMAT_TIME);
+    }
+
+    if (format != GST_FORMAT_TIME) {
+      GstPad *peer;
+      gboolean res = FALSE;
+      gint64 tstart = 0;
+      gint64 tstop = GST_CLOCK_TIME_NONE;
+      gint64 tposition = 0;
+
+      GST_DEBUG_OBJECT (pad, "Subtitle newsegment event (%s) not in TIME "
+          "format, converting", gst_format_get_name (format));
+      peer = gst_pad_get_peer (pad);
+
+      if (peer) {
+        res = _pad_query_convert_to_time (peer, format, start, &tstart);
+        res = res && _pad_query_convert_to_time (peer, format, stop, &tstop);
+        res = res && _pad_query_convert_to_time (peer, format, position,
+            &tposition);
+
+        gst_object_unref (peer);
+      }
+
+      if (res) {
+        start = tstart;
+        stop = tstop;
+        position = tposition;
+      } else {
+        start = 0;
+        stop = GST_CLOCK_TIME_NONE;
+        position = 0;
+      }
     }
 
     gst_segment_set_newsegment_full (&self->subtitle_segment, update, rate,
-        applied_rate, format, start, stop, position);
+        applied_rate, GST_FORMAT_TIME, start, stop, position);
     GST_DEBUG_OBJECT (pad, "New subtitle segment: %" GST_SEGMENT_FORMAT,
         &self->subtitle_segment);
   }
diff --git a/gst/playback/gsturidecodebin.c b/gst/playback/gsturidecodebin.c
index 2a5026f..2858cd9 100644
--- a/gst/playback/gsturidecodebin.c
+++ b/gst/playback/gsturidecodebin.c
@@ -24,6 +24,10 @@
  * handle the given #GstURIDecodeBin:uri scheme and connects it to a decodebin2.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #  include "config.h"
 #endif
@@ -40,6 +44,9 @@
 
 #include "gst/glib-compat-private.h"
 
+/* From gstdecodebin2.c */
+gint _decode_bin_compare_factories_func (gconstpointer p1, gconstpointer p2);
+
 #define GST_TYPE_URI_DECODE_BIN \
   (gst_uri_decode_bin_get_type())
 #define GST_URI_DECODE_BIN(obj) \
@@ -298,6 +305,8 @@ gst_uri_decode_bin_update_factories_list (GstURIDecodeBin * dec)
     dec->factories =
         gst_element_factory_list_get_elements
         (GST_ELEMENT_FACTORY_TYPE_DECODABLE, GST_RANK_MARGINAL);
+    dec->factories =
+        g_list_sort (dec->factories, _decode_bin_compare_factories_func);
     dec->factories_cookie = gst_default_registry_get_feature_list_cookie ();
   }
 }
@@ -1200,6 +1209,7 @@ static GstElement *
 gen_source_element (GstURIDecodeBin * decoder)
 {
   GstElement *source;
+  GParamSpec *pspec;
 
   if (!decoder->uri)
     goto no_uri;
@@ -1233,13 +1243,32 @@ gen_source_element (GstURIDecodeBin * decoder)
     g_object_set (source, "iradio-mode", TRUE, NULL);
   }
 
-  if (g_object_class_find_property (G_OBJECT_GET_CLASS (source),
-          "connection-speed")) {
-    GST_DEBUG_OBJECT (decoder,
-        "setting connection-speed=%d to source element",
-        decoder->connection_speed / 1000);
-    g_object_set (source, "connection-speed",
-        decoder->connection_speed / 1000, NULL);
+  if ((pspec = g_object_class_find_property (G_OBJECT_GET_CLASS (source),
+              "connection-speed"))) {
+    guint speed = decoder->connection_speed / 1000;
+    gboolean wrong_type = FALSE;
+
+    if (G_PARAM_SPEC_TYPE (pspec) == G_TYPE_PARAM_UINT) {
+      GParamSpecUInt *pspecuint = G_PARAM_SPEC_UINT (pspec);
+
+      speed = CLAMP (speed, pspecuint->minimum, pspecuint->maximum);
+    } else if (G_PARAM_SPEC_TYPE (pspec) == G_TYPE_PARAM_INT) {
+      GParamSpecInt *pspecint = G_PARAM_SPEC_INT (pspec);
+
+      speed = CLAMP (speed, pspecint->minimum, pspecint->maximum);
+    } else {
+      GST_WARNING_OBJECT (decoder, "The connection speed property %i of type %s"
+          " is not usefull not setting it", speed,
+          g_type_name (G_PARAM_SPEC_TYPE (pspec)));
+      wrong_type = TRUE;
+    }
+
+    if (wrong_type == FALSE) {
+      g_object_set (source, "connection-speed", speed, NULL);
+
+      GST_DEBUG_OBJECT (decoder,
+          "setting connection-speed=%d to source element", speed);
+    }
   }
   if (g_object_class_find_property (G_OBJECT_GET_CLASS (source),
           "subtitle-encoding")) {
@@ -1509,6 +1538,8 @@ remove_decoders (GstURIDecodeBin * bin, gboolean force)
       caps = DEFAULT_CAPS;
       g_object_set (decoder, "caps", caps, NULL);
       gst_caps_unref (caps);
+      /* make it freshly floating again */
+      GST_OBJECT_FLAG_SET (decoder, GST_OBJECT_FLOATING);
 
       bin->pending_decodebins =
           g_slist_prepend (bin->pending_decodebins, decoder);
@@ -1666,9 +1697,9 @@ make_decoder (GstURIDecodeBin * decoder)
   if (decoder->caps)
     g_object_set (decodebin, "caps", decoder->caps, NULL);
 
-  /* Propagate expose-all-streams property */
+  /* Propagate expose-all-streams and connection-speed properties */
   g_object_set (decodebin, "expose-all-streams", decoder->expose_allstreams,
-      NULL);
+      "connection-speed", decoder->connection_speed / 1000, NULL);
 
   if (!decoder->is_stream) {
     /* propagate the use-buffering property but only when we are not already
@@ -1764,7 +1795,7 @@ type_found (GstElement * typefind, guint probability,
     gchar *temp_template, *filename;
     const gchar *tmp_dir, *prgname;
 
-    tmp_dir = g_get_tmp_dir ();
+    tmp_dir = g_get_user_cache_dir ();
     prgname = g_get_prgname ();
     if (prgname == NULL)
       prgname = "GStreamer";
@@ -1988,6 +2019,21 @@ could_not_link:
   }
 }
 
+static gboolean
+is_live_source (GstElement * source)
+{
+  GObjectClass *source_class = NULL;
+  gboolean is_live = FALSE;
+
+  source_class = G_OBJECT_GET_CLASS (source);
+  if (!g_object_class_find_property (source_class, "is-live"))
+    return FALSE;
+
+  g_object_get (G_OBJECT (source), "is-live", &is_live, NULL);
+
+  return is_live;
+}
+
 /* construct and run the source and decoder elements until we found
  * all the streams or until a preroll queue has been filled.
 */
@@ -2017,6 +2063,9 @@ setup_source (GstURIDecodeBin * decoder)
   g_signal_emit (decoder, gst_uri_decode_bin_signals[SIGNAL_SOURCE_SETUP],
       0, decoder->source);
 
+  if (is_live_source (decoder->source))
+    decoder->is_stream = FALSE;
+
   /* remove the old decoders now, if any */
   remove_decoders (decoder, FALSE);
 
diff --git a/gst/subparse/Makefile.in b/gst/subparse/Makefile.in
index f026e27..8b0955a 100644
--- a/gst/subparse/Makefile.in
+++ b/gst/subparse/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/subparse
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -128,10 +145,23 @@ libgstsubparse_la_OBJECTS = $(am_libgstsubparse_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstsubparse_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstsubparse_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstsubparse_la_CFLAGS) $(CFLAGS) \
 	$(libgstsubparse_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -144,22 +174,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstsubparse_la_SOURCES)
 DIST_SOURCES = $(am__libgstsubparse_la_SOURCES_DIST)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -452,7 +483,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -520,7 +555,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -528,6 +562,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -543,12 +579,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstsubparse.la: $(libgstsubparse_la_OBJECTS) $(libgstsubparse_la_DEPENDENCIES) $(EXTRA_libgstsubparse_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstsubparse_la_LINK) -rpath $(plugindir) $(libgstsubparse_la_OBJECTS) $(libgstsubparse_la_LIBADD) $(LIBS)
 
@@ -683,6 +721,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -827,18 +879,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/gst/subparse/gstsubparse.c b/gst/subparse/gstsubparse.c
index 9c31b54..0b5df1f 100644
--- a/gst/subparse/gstsubparse.c
+++ b/gst/subparse/gstsubparse.c
@@ -1244,7 +1244,8 @@ gst_sub_parse_data_format_autodetect_regex_once (GstSubParseRegex regtype)
       }
       break;
     case GST_SUB_PARSE_REGEX_SUBRIP:
-      result = (gpointer) g_regex_new ("^ {0,3}[ 0-9]{1,4}\\s*(\x0d)?\x0a"
+      result = (gpointer)
+          g_regex_new ("^[\\s\\n]*[\\n]? {0,3}[ 0-9]{1,4}\\s*(\x0d)?\x0a"
           " ?[0-9]{1,2}: ?[0-9]{1,2}: ?[0-9]{1,2}[,.] {0,2}[0-9]{1,3}"
           " +--> +[0-9]{1,2}: ?[0-9]{1,2}: ?[0-9]{1,2}[,.] {0,2}[0-9]{1,2}",
           G_REGEX_RAW | G_REGEX_OPTIMIZE, 0, &gerr);
diff --git a/gst/tcp/Makefile.in b/gst/tcp/Makefile.in
index 4b0f983..f91d627 100644
--- a/gst/tcp/Makefile.in
+++ b/gst/tcp/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -25,6 +24,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -43,8 +59,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/gst-glib-gen.mak
+	$(srcdir)/Makefile.in $(top_srcdir)/common/gst-glib-gen.mak \
+	$(top_srcdir)/depcomp
 subdir = gst/tcp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
@@ -136,10 +154,23 @@ libgsttcp_la_OBJECTS = $(am_libgsttcp_la_OBJECTS) \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgsttcp_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgsttcp_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgsttcp_la_CFLAGS) $(CFLAGS) \
 	$(libgsttcp_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -152,22 +183,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgsttcp_la_SOURCES) $(nodist_libgsttcp_la_SOURCES)
 DIST_SOURCES = $(libgsttcp_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -460,7 +492,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -538,7 +574,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -546,6 +581,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -561,12 +598,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgsttcp.la: $(libgsttcp_la_OBJECTS) $(libgsttcp_la_DEPENDENCIES) $(EXTRA_libgsttcp_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgsttcp_la_LINK) -rpath $(plugindir) $(libgsttcp_la_OBJECTS) $(libgsttcp_la_LIBADD) $(LIBS)
 
@@ -725,6 +764,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -873,18 +926,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # these are all the rules generating the relevant files
diff --git a/gst/typefind/Makefile.in b/gst/typefind/Makefile.in
index 9448a85..c2a09c5 100644
--- a/gst/typefind/Makefile.in
+++ b/gst/typefind/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,8 +50,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/typefind
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -120,11 +138,24 @@ libgsttypefindfunctions_la_OBJECTS =  \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgsttypefindfunctions_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgsttypefindfunctions_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgsttypefindfunctions_la_CFLAGS) \
 	$(CFLAGS) $(libgsttypefindfunctions_la_LDFLAGS) $(LDFLAGS) -o \
 	$@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -137,22 +168,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgsttypefindfunctions_la_SOURCES)
 DIST_SOURCES = $(libgsttypefindfunctions_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -444,7 +476,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -496,7 +532,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -504,6 +539,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -519,12 +556,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgsttypefindfunctions.la: $(libgsttypefindfunctions_la_OBJECTS) $(libgsttypefindfunctions_la_DEPENDENCIES) $(EXTRA_libgsttypefindfunctions_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgsttypefindfunctions_la_LINK) -rpath $(plugindir) $(libgsttypefindfunctions_la_OBJECTS) $(libgsttypefindfunctions_la_LIBADD) $(LIBS)
 
@@ -619,6 +658,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -763,18 +816,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/typefind/gsttypefindfunctions.c b/gst/typefind/gsttypefindfunctions.c
index 27823b6..19ee389 100644
--- a/gst/typefind/gsttypefindfunctions.c
+++ b/gst/typefind/gsttypefindfunctions.c
@@ -2402,6 +2402,9 @@ h264_video_type_find (GstTypeFind * tf, gpointer unused)
   /* Stream consists of: a series of sync codes (00 00 00 01) followed 
    * by NALs
    */
+  gboolean seen_idr = FALSE;
+  gboolean seen_sps = FALSE;
+  gboolean seen_pps = FALSE;
   int nut, ref;
   int good = 0;
   int bad = 0;
@@ -2426,6 +2429,13 @@ h264_video_type_find (GstTypeFind * tf, gpointer unused)
             ((nut == 6 || (nut >= 9 && nut <= 12)) && ref != 0)) {
           bad++;
         } else {
+          if (nut == 7)
+            seen_sps = TRUE;
+          else if (nut == 8)
+            seen_pps = TRUE;
+          else if (nut == 5)
+            seen_idr = TRUE;
+
           good++;
         }
       } else if (nut >= 14 && nut <= 33) {
@@ -2439,9 +2449,10 @@ h264_video_type_find (GstTypeFind * tf, gpointer unused)
         /* don't consider these bad */
       }
 
-      GST_DEBUG ("good %d bad %d", good, bad);
+      GST_LOG ("good:%d, bad:%d, pps:%d, sps:%d, idr:%d", good, bad, seen_pps,
+          seen_sps, seen_idr);
 
-      if (good >= 10 && bad < 4) {
+      if (seen_sps && seen_pps && seen_idr && good >= 10 && bad < 4) {
         gst_type_find_suggest (tf, GST_TYPE_FIND_LIKELY, H264_VIDEO_CAPS);
         return;
       }
@@ -2451,9 +2462,11 @@ h264_video_type_find (GstTypeFind * tf, gpointer unused)
     data_scan_ctx_advance (tf, &c, 1);
   }
 
-  if (good >= 2 && bad < 1) {
+  GST_LOG ("good:%d, bad:%d, pps:%d, sps:%d, idr:%d", good, bad, seen_pps,
+      seen_sps, seen_idr);
+
+  if (good >= 2 && bad == 0) {
     gst_type_find_suggest (tf, GST_TYPE_FIND_POSSIBLE, H264_VIDEO_CAPS);
-    return;
   }
 }
 
@@ -2783,6 +2796,12 @@ qt_type_find (GstTypeFind * tf, gpointer unused)
       break;
     }
 
+    if (STRNCMP (&data[4], "ftypisml", 8) == 0) {
+      tip = GST_TYPE_FIND_MAXIMUM;
+      variant = "iso-fragmented";
+      break;
+    }
+
     /* box/atom types that are in common with ISO base media file format */
     if (STRNCMP (&data[4], "moov", 4) == 0 ||
         STRNCMP (&data[4], "mdat", 4) == 0 ||
@@ -4289,6 +4308,32 @@ degas_type_find (GstTypeFind * tf, gpointer private)
   }
 }
 
+/*** DVD ISO images (looks like H.264, see #674069) ***/
+static void
+dvdiso_type_find (GstTypeFind * tf, gpointer private)
+{
+  /* 0x8000 bytes of zeros, then "\001CD001" */
+  gint64 len;
+  const guint8 *data;
+
+  len = gst_type_find_get_length (tf);
+  if (len < 0x8006)
+    return;
+  data = gst_type_find_peek (tf, 0, 0x8006);
+  if (G_UNLIKELY (data == NULL))
+    return;
+  for (len = 0; len < 0x8000; len++)
+    if (data[len])
+      return;
+  /* Can the '1' be anything else ? My three samples all have '1'. */
+  if (memcmp (data + 0x8000, "\001CD001", 6))
+    return;
+
+  /* May need more inspection, we may be able to demux some of them */
+  gst_type_find_suggest_simple (tf, GST_TYPE_FIND_LIKELY,
+      "application/octet-stream", NULL);
+}
+
 /*** generic typefind for streams that have some data at a specific position***/
 typedef struct
 {
@@ -4775,6 +4820,8 @@ plugin_init (GstPlugin * plugin)
 
   TYPE_FIND_REGISTER (plugin, "image/x-degas", GST_RANK_MARGINAL,
       degas_type_find, NULL, NULL, NULL, NULL);
+  TYPE_FIND_REGISTER (plugin, "application/octet-stream", GST_RANK_MARGINAL,
+      dvdiso_type_find, NULL, NULL, NULL, NULL);
 
   return TRUE;
 }
diff --git a/gst/videorate/Makefile.in b/gst/videorate/Makefile.in
index b0d8239..c8922f5 100644
--- a/gst/videorate/Makefile.in
+++ b/gst/videorate/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = gst/videorate
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -119,10 +136,23 @@ libgstvideorate_la_OBJECTS = $(am_libgstvideorate_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstvideorate_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstvideorate_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstvideorate_la_CFLAGS) $(CFLAGS) \
 	$(libgstvideorate_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -135,22 +165,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstvideorate_la_SOURCES)
 DIST_SOURCES = $(libgstvideorate_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -443,7 +474,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -490,7 +525,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -498,6 +532,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -513,12 +549,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstvideorate.la: $(libgstvideorate_la_OBJECTS) $(libgstvideorate_la_DEPENDENCIES) $(EXTRA_libgstvideorate_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstvideorate_la_LINK) -rpath $(plugindir) $(libgstvideorate_la_OBJECTS) $(libgstvideorate_la_LIBADD) $(LIBS)
 
@@ -613,6 +651,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -757,18 +809,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 Android.mk: Makefile.am $(BUILT_SOURCES)
diff --git a/gst/videoscale/Makefile.in b/gst/videoscale/Makefile.in
index c55cf51..7807d1c 100644
--- a/gst/videoscale/Makefile.in
+++ b/gst/videoscale/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -39,6 +38,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -57,8 +73,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak
+	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak \
+	$(top_srcdir)/depcomp
 subdir = gst/videoscale
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
@@ -150,10 +168,23 @@ libgstvideoscale_la_OBJECTS = $(am_libgstvideoscale_la_OBJECTS) \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstvideoscale_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstvideoscale_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstvideoscale_la_CFLAGS) $(CFLAGS) \
 	$(libgstvideoscale_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -166,23 +197,24 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstvideoscale_la_SOURCES) \
 	$(nodist_libgstvideoscale_la_SOURCES)
 DIST_SOURCES = $(libgstvideoscale_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -475,7 +507,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -551,7 +587,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -559,6 +594,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -574,12 +611,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstvideoscale.la: $(libgstvideoscale_la_OBJECTS) $(libgstvideoscale_la_DEPENDENCIES) $(EXTRA_libgstvideoscale_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstvideoscale_la_LINK) -rpath $(plugindir) $(libgstvideoscale_la_OBJECTS) $(libgstvideoscale_la_LIBADD) $(LIBS)
 
@@ -722,6 +761,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -872,8 +925,8 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-local clean-pluginLTLIBRARIES ctags \
-	dist-hook distclean distclean-compile distclean-generic \
+	clean-libtool clean-local clean-pluginLTLIBRARIES cscopelist \
+	ctags dist-hook distclean distclean-compile distclean-generic \
 	distclean-libtool distclean-tags distdir dvi dvi-am html \
 	html-am info info-am install install-am install-data \
 	install-data-am install-dvi install-dvi-am install-exec \
diff --git a/gst/videoscale/gstvideoscale.c b/gst/videoscale/gstvideoscale.c
index 7b44647..60dd5ff 100644
--- a/gst/videoscale/gstvideoscale.c
+++ b/gst/videoscale/gstvideoscale.c
@@ -1,6 +1,6 @@
 /* GStreamer
  * Copyright (C) <1999> Erik Walthinsen <omega@cse.ogi.edu>
- * Copyright (C) 2005 David Schleef <ds@schleef.org>
+ * Copyright (C) 2005-2012 David Schleef <ds@schleef.org>
  *
  * This library is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Library General Public
@@ -140,7 +140,8 @@ static GstStaticCaps gst_video_scale_format_caps[] = {
   GST_STATIC_CAPS (GST_VIDEO_CAPS_YUV ("Y8  ")),
   GST_STATIC_CAPS (GST_VIDEO_CAPS_YUV ("GREY")),
   GST_STATIC_CAPS (GST_VIDEO_CAPS_YUV ("AY64")),
-  GST_STATIC_CAPS (GST_VIDEO_CAPS_ARGB_64)
+  GST_STATIC_CAPS (GST_VIDEO_CAPS_ARGB_64),
+  GST_STATIC_CAPS (GST_VIDEO_CAPS_YUV ("NV12"))
 };
 
 #define GST_TYPE_VIDEO_SCALE_METHOD (gst_video_scale_method_get_type())
@@ -423,10 +424,118 @@ gst_video_scale_get_property (GObject * object, guint prop_id, GValue * value,
   }
 }
 
+#define NEAREST  (1 << GST_VIDEO_SCALE_NEAREST)
+#define BILINEAR (1 << GST_VIDEO_SCALE_BILINEAR)
+#define FOURTAP  (1 << GST_VIDEO_SCALE_4TAP)
+#define LANCZOS  (1 << GST_VIDEO_SCALE_LANCZOS)
+
+/* or we could just do lookups via table[format] if we could be bothered..  */
+static const struct
+{
+  GstVideoFormat format;
+  guint8 methods;
+} formats_methods_table[] = {
+  {
+  GST_VIDEO_FORMAT_RGBx, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_xRGB, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_BGRx, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_xBGR, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_RGBA, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_ARGB, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_BGRA, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_ABGR, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_AYUV, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_ARGB64, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_AYUV64, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_RGB, NEAREST | BILINEAR | FOURTAP}, {
+  GST_VIDEO_FORMAT_BGR, NEAREST | BILINEAR | FOURTAP}, {
+  GST_VIDEO_FORMAT_v308, NEAREST | BILINEAR | FOURTAP}, {
+  GST_VIDEO_FORMAT_YUY2, NEAREST | BILINEAR | FOURTAP}, {
+  GST_VIDEO_FORMAT_YVYU, NEAREST | BILINEAR | FOURTAP}, {
+  GST_VIDEO_FORMAT_UYVY, NEAREST | BILINEAR | FOURTAP}, {
+  GST_VIDEO_FORMAT_Y800, NEAREST | BILINEAR | FOURTAP}, {
+  GST_VIDEO_FORMAT_GRAY8, NEAREST | BILINEAR | FOURTAP}, {
+  GST_VIDEO_FORMAT_GRAY16_LE, NEAREST | BILINEAR | FOURTAP}, {
+  GST_VIDEO_FORMAT_GRAY16_BE, NEAREST | BILINEAR | FOURTAP}, {
+  GST_VIDEO_FORMAT_Y16, NEAREST | BILINEAR | FOURTAP}, {
+  GST_VIDEO_FORMAT_I420, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_YV12, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_Y444, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_Y42B, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_Y41B, NEAREST | BILINEAR | FOURTAP | LANCZOS}, {
+  GST_VIDEO_FORMAT_NV12, NEAREST | BILINEAR}, {
+  GST_VIDEO_FORMAT_RGB16, NEAREST | BILINEAR | FOURTAP}, {
+  GST_VIDEO_FORMAT_RGB15, NEAREST | BILINEAR | FOURTAP}
+};
+
+static gboolean
+gst_video_scale_format_supported_for_method (GstVideoFormat format,
+    GstVideoScaleMethod method)
+{
+  int i;
+
+  for (i = 0; i < G_N_ELEMENTS (formats_methods_table); ++i) {
+    if (formats_methods_table[i].format == format)
+      return ((formats_methods_table[i].methods & (1 << method)) != 0);
+  }
+  return FALSE;
+}
+
+static gboolean
+gst_video_scale_transform_supported (GstVideoScale * videoscale,
+    GstVideoScaleMethod method, GstStructure * structure)
+{
+  const GValue *val;
+  GstVideoFormat fmt;
+  gboolean supported = TRUE;
+  GstStructure *s;
+  GstCaps *c;
+
+  /* we support these methods for all formats */
+  if (method == GST_VIDEO_SCALE_NEAREST || method == GST_VIDEO_SCALE_BILINEAR)
+    return TRUE;
+
+  /* we need fixed caps if we want to use gst_video_parse_caps() */
+  s = gst_structure_new (gst_structure_get_name (structure),
+      "width", G_TYPE_INT, 1, "height", G_TYPE_INT, 1, NULL);
+
+  if ((val = gst_structure_get_value (structure, "format"))) {
+    gst_structure_set_value (s, "format", val);
+  } else {
+    if ((val = gst_structure_get_value (structure, "endianness")))
+      gst_structure_set_value (s, "endianness", val);
+    if ((val = gst_structure_get_value (structure, "red_mask")))
+      gst_structure_set_value (s, "red_mask", val);
+    if ((val = gst_structure_get_value (structure, "blue_mask")))
+      gst_structure_set_value (s, "blue_mask", val);
+    if ((val = gst_structure_get_value (structure, "green_mask")))
+      gst_structure_set_value (s, "green_mask", val);
+    if ((val = gst_structure_get_value (structure, "alpha_mask")))
+      gst_structure_set_value (s, "alpha_mask", val);
+    if ((val = gst_structure_get_value (structure, "depth")))
+      gst_structure_set_value (s, "depth", val);
+    if ((val = gst_structure_get_value (structure, "bpp")))
+      gst_structure_set_value (s, "bpp", val);
+  }
+  c = gst_caps_new_full (s, NULL);
+  if (!gst_video_format_parse_caps (c, &fmt, NULL, NULL)) {
+    GST_ERROR_OBJECT (videoscale, "couldn't parse %" GST_PTR_FORMAT, c);
+  } else if (!gst_video_scale_format_supported_for_method (fmt, method)) {
+    supported = FALSE;
+  }
+  GST_LOG_OBJECT (videoscale, "method %d %ssupported for format %d",
+      method, (supported) ? "" : "not ", fmt);
+  gst_caps_unref (c);
+
+  return supported;
+}
+
 static GstCaps *
 gst_video_scale_transform_caps (GstBaseTransform * trans,
     GstPadDirection direction, GstCaps * caps)
 {
+  GstVideoScale *videoscale = GST_VIDEO_SCALE (trans);
+  GstVideoScaleMethod method;
   GstCaps *ret;
   GstStructure *structure;
 
@@ -440,6 +549,13 @@ gst_video_scale_transform_caps (GstBaseTransform * trans,
   ret = gst_caps_copy (caps);
   structure = gst_structure_copy (gst_caps_get_structure (ret, 0));
 
+  GST_OBJECT_LOCK (videoscale);
+  method = videoscale->method;
+  GST_OBJECT_UNLOCK (videoscale);
+
+  if (!gst_video_scale_transform_supported (videoscale, method, structure))
+    goto format_not_supported;
+
   gst_structure_set (structure,
       "width", GST_TYPE_INT_RANGE, 1, G_MAXINT,
       "height", GST_TYPE_INT_RANGE, 1, G_MAXINT, NULL);
@@ -451,9 +567,19 @@ gst_video_scale_transform_caps (GstBaseTransform * trans,
   }
   gst_caps_append_structure (ret, structure);
 
+done:
+
   GST_DEBUG_OBJECT (trans, "returning caps: %" GST_PTR_FORMAT, ret);
 
   return ret;
+
+format_not_supported:
+  {
+    gst_structure_free (structure);
+    gst_caps_unref (ret);
+    ret = gst_caps_new_empty ();
+    goto done;
+  }
 }
 
 static gboolean
@@ -1024,7 +1150,8 @@ gst_video_scale_setup_vs_image (VSImage * image, GstVideoFormat format,
   if (format == GST_VIDEO_FORMAT_I420
       || format == GST_VIDEO_FORMAT_YV12
       || format == GST_VIDEO_FORMAT_Y444
-      || format == GST_VIDEO_FORMAT_Y42B || format == GST_VIDEO_FORMAT_Y41B) {
+      || format == GST_VIDEO_FORMAT_Y42B || format == GST_VIDEO_FORMAT_Y41B
+      || format == GST_VIDEO_FORMAT_NV12) {
     image->real_pixels = data + gst_video_format_get_component_offset (format,
         component, width, height);
   } else {
@@ -1090,6 +1217,7 @@ _get_black_for_format (GstVideoFormat format)
     case GST_VIDEO_FORMAT_Y444:
     case GST_VIDEO_FORMAT_Y42B:
     case GST_VIDEO_FORMAT_Y41B:
+    case GST_VIDEO_FORMAT_NV12:
       return black[4];          /* Y, U, V, 0 */
     case GST_VIDEO_FORMAT_RGB16:
     case GST_VIDEO_FORMAT_RGB15:
@@ -1153,6 +1281,14 @@ gst_video_scale_transform (GstBaseTransform * trans, GstBuffer * in,
         videoscale->to_width, videoscale->to_height, videoscale->borders_w,
         videoscale->borders_h, GST_BUFFER_DATA (out));
   }
+  if (videoscale->format == GST_VIDEO_FORMAT_NV12) {
+    gst_video_scale_setup_vs_image (&src_u, videoscale->format, 1,
+        videoscale->from_width, videoscale->from_height, 0, 0,
+        GST_BUFFER_DATA (in));
+    gst_video_scale_setup_vs_image (&dest_u, videoscale->format, 1,
+        videoscale->to_width, videoscale->to_height, videoscale->borders_w,
+        videoscale->borders_h, GST_BUFFER_DATA (out));
+  }
 
   switch (videoscale->format) {
     case GST_VIDEO_FORMAT_RGBx:
@@ -1199,6 +1335,11 @@ gst_video_scale_transform (GstBaseTransform * trans, GstBuffer * in,
         case GST_VIDEO_SCALE_4TAP:
           vs_image_scale_4tap_AYUV64 (&dest, &src, videoscale->tmp_buf);
           break;
+        case GST_VIDEO_SCALE_LANCZOS:
+          vs_image_scale_lanczos_AYUV64 (&dest, &src, videoscale->tmp_buf,
+              videoscale->sharpness, videoscale->dither, videoscale->submethod,
+              videoscale->envelope, videoscale->sharpen);
+          break;
         default:
           goto unknown_mode;
       }
@@ -1335,6 +1476,20 @@ gst_video_scale_transform (GstBaseTransform * trans, GstBuffer * in,
           goto unknown_mode;
       }
       break;
+    case GST_VIDEO_FORMAT_NV12:
+      switch (method) {
+        case GST_VIDEO_SCALE_NEAREST:
+          vs_image_scale_nearest_Y (&dest, &src, videoscale->tmp_buf);
+          vs_image_scale_nearest_NV12 (&dest_u, &src_u, videoscale->tmp_buf);
+          break;
+        case GST_VIDEO_SCALE_BILINEAR:
+          vs_image_scale_linear_Y (&dest, &src, videoscale->tmp_buf);
+          vs_image_scale_linear_NV12 (&dest_u, &src_u, videoscale->tmp_buf);
+          break;
+        default:
+          goto unknown_mode;
+      }
+      break;
     case GST_VIDEO_FORMAT_RGB16:
       if (add_borders)
         vs_fill_borders_RGB565 (&dest, black);
diff --git a/gst/videoscale/vs_image.c b/gst/videoscale/vs_image.c
index c28b0d8..09ccf25 100644
--- a/gst/videoscale/vs_image.c
+++ b/gst/videoscale/vs_image.c
@@ -1,6 +1,6 @@
 /*
  * Image Scaling Functions
- * Copyright (c) 2005 David A. Schleef <ds@schleef.org>
+ * Copyright (c) 2005-2012 David A. Schleef <ds@schleef.org>
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -522,6 +522,136 @@ vs_image_scale_linear_UYVY (const VSImage * dest, const VSImage * src,
   }
 }
 
+/* NV12 */
+
+void
+vs_image_scale_nearest_NV12 (const VSImage * dest, const VSImage * src,
+    uint8_t * tmpbuf)
+{
+  int acc;
+  int y_increment;
+  int x_increment;
+  int i;
+  int j;
+  int xacc;
+
+  if (dest->height == 1)
+    y_increment = 0;
+  else
+    y_increment = ((src->height - 1) << 16) / (dest->height - 1);
+
+  if (dest->width == 1)
+    x_increment = 0;
+  else
+    x_increment = ((src->width - 1) << 16) / (dest->width - 1);
+
+  acc = 0;
+  for (i = 0; i < dest->height; i++) {
+    j = acc >> 16;
+
+    xacc = 0;
+    vs_scanline_resample_nearest_NV12 (dest->pixels + i * dest->stride,
+        src->pixels + j * src->stride, src->width, dest->width, &xacc,
+        x_increment);
+
+    acc += y_increment;
+  }
+}
+
+void
+vs_image_scale_linear_NV12 (const VSImage * dest, const VSImage * src,
+    uint8_t * tmpbuf)
+{
+  int acc;
+  int y_increment;
+  int x_increment;
+  uint8_t *tmp1;
+  uint8_t *tmp2;
+  int y1;
+  int y2;
+  int i;
+  int j;
+  int x;
+  int dest_size;
+  int xacc;
+
+  if (dest->height == 1)
+    y_increment = 0;
+  else
+    y_increment = ((src->height - 1) << 16) / (dest->height - 1) - 1;
+
+  if (dest->width == 1)
+    x_increment = 0;
+  else
+    x_increment = ((src->width - 1) << 16) / (dest->width - 1) - 1;
+
+  dest_size = ROUND_UP_4 (dest->width * 2);
+
+  tmp1 = tmpbuf;
+  tmp2 = tmpbuf + dest_size;
+
+  acc = 0;
+  xacc = 0;
+  y2 = -1;
+  vs_scanline_resample_linear_NV12 (tmp1, src->pixels, src->width, dest->width,
+      &xacc, x_increment);
+  y1 = 0;
+  for (i = 0; i < dest->height; i++) {
+    j = acc >> 16;
+    x = acc & 0xffff;
+
+    if (x == 0) {
+      if (j == y1) {
+        memcpy (dest->pixels + i * dest->stride, tmp1, dest_size);
+      } else if (j == y2) {
+        memcpy (dest->pixels + i * dest->stride, tmp2, dest_size);
+      } else {
+        xacc = 0;
+        vs_scanline_resample_linear_NV12 (tmp1, src->pixels + j * src->stride,
+            src->width, dest->width, &xacc, x_increment);
+        y1 = j;
+        memcpy (dest->pixels + i * dest->stride, tmp1, dest_size);
+      }
+    } else {
+      if (j == y1) {
+        if (j + 1 != y2) {
+          xacc = 0;
+          vs_scanline_resample_linear_NV12 (tmp2,
+              src->pixels + (j + 1) * src->stride, src->width, dest->width,
+              &xacc, x_increment);
+          y2 = j + 1;
+        }
+        vs_scanline_merge_linear_NV12 (dest->pixels + i * dest->stride,
+            tmp1, tmp2, dest->width, x);
+      } else if (j == y2) {
+        if (j + 1 != y1) {
+          xacc = 0;
+          vs_scanline_resample_linear_NV12 (tmp1,
+              src->pixels + (j + 1) * src->stride, src->width, dest->width,
+              &xacc, x_increment);
+          y1 = j + 1;
+        }
+        vs_scanline_merge_linear_NV12 (dest->pixels + i * dest->stride,
+            tmp2, tmp1, dest->width, x);
+      } else {
+        xacc = 0;
+        vs_scanline_resample_linear_NV12 (tmp1, src->pixels + j * src->stride,
+            src->width, dest->width, &xacc, x_increment);
+        y1 = j;
+        xacc = 0;
+        vs_scanline_resample_linear_NV12 (tmp2,
+            src->pixels + (j + 1) * src->stride, src->width, dest->width,
+            &xacc, x_increment);
+        y2 = (j + 1);
+        vs_scanline_merge_linear_NV12 (dest->pixels + i * dest->stride,
+            tmp1, tmp2, dest->width, x);
+      }
+    }
+
+    acc += y_increment;
+  }
+}
+
 /* greyscale */
 
 void
diff --git a/gst/videoscale/vs_image.h b/gst/videoscale/vs_image.h
index 2312acc..d3cc31d 100644
--- a/gst/videoscale/vs_image.h
+++ b/gst/videoscale/vs_image.h
@@ -52,6 +52,9 @@ void vs_image_scale_linear_RGBA (const VSImage *dest, const VSImage *src,
 void vs_image_scale_lanczos_AYUV (const VSImage * dest, const VSImage * src,
     uint8_t * tmpbuf, double sharpness, gboolean dither, int submethod,
     double a, double sharpen);
+void vs_image_scale_lanczos_AYUV64 (const VSImage * dest, const VSImage * src,
+    uint8_t * tmpbuf, double sharpness, gboolean dither, int submethod,
+    double a, double sharpen);
 
 void vs_image_scale_nearest_RGB (const VSImage *dest, const VSImage *src,
     uint8_t *tmpbuf);
@@ -68,6 +71,11 @@ void vs_image_scale_nearest_UYVY (const VSImage *dest, const VSImage *src,
 void vs_image_scale_linear_UYVY (const VSImage *dest, const VSImage *src,
     uint8_t *tmpbuf);
 
+void vs_image_scale_nearest_NV12 (const VSImage *dest, const VSImage *src,
+    uint8_t *tmpbuf);
+void vs_image_scale_linear_NV12 (const VSImage *dest, const VSImage *src,
+    uint8_t *tmpbuf);
+
 void vs_image_scale_nearest_Y (const VSImage *dest, const VSImage *src,
     uint8_t *tmpbuf);
 void vs_image_scale_linear_Y (const VSImage *dest, const VSImage *src,
diff --git a/gst/videoscale/vs_lanczos.c b/gst/videoscale/vs_lanczos.c
index 1c87ba3..67cd401 100644
--- a/gst/videoscale/vs_lanczos.c
+++ b/gst/videoscale/vs_lanczos.c
@@ -204,6 +204,9 @@ static void vs_image_scale_lanczos_AYUV_float (const VSImage * dest,
 static void vs_image_scale_lanczos_AYUV_double (const VSImage * dest,
     const VSImage * src, uint8_t * tmpbuf, double sharpness, gboolean dither,
     double a, double sharpen);
+static void vs_image_scale_lanczos_AYUV64_double (const VSImage * dest,
+    const VSImage * src, uint8_t * tmpbuf, double sharpness, gboolean dither,
+    double a, double sharpen);
 
 static double
 sinc (double x)
@@ -590,6 +593,15 @@ vs_image_scale_lanczos_AYUV (const VSImage * dest, const VSImage * src,
   }
 }
 
+void
+vs_image_scale_lanczos_AYUV64 (const VSImage * dest, const VSImage * src,
+    uint8_t * tmpbuf, double sharpness, gboolean dither, int submethod,
+    double a, double sharpen)
+{
+  vs_image_scale_lanczos_AYUV64_double (dest, src, tmpbuf, sharpness, dither,
+      a, sharpen);
+}
+
 
 
 #define RESAMPLE_HORIZ_FLOAT(function, dest_type, tap_type, src_type, _n_taps) \
@@ -716,6 +728,9 @@ RESAMPLE_HORIZ_AYUV_FLOAT (resample_horiz_double_ayuv_generic, double, double,
 RESAMPLE_HORIZ_AYUV_FLOAT (resample_horiz_float_ayuv_generic, float, float,
     guint8, n_taps)
 
+RESAMPLE_HORIZ_AYUV_FLOAT (resample_horiz_double_ayuv_generic_s16, double, double,
+    guint16, n_taps)
+
 RESAMPLE_HORIZ (resample_horiz_int32_int32_u8_generic, gint32, gint32,
     guint8, n_taps, shift)
 RESAMPLE_HORIZ (resample_horiz_int16_int16_u8_generic, gint16, gint16,
@@ -813,9 +828,9 @@ RESAMPLE_VERT_DITHER (resample_vert_dither_int16_generic, gint16, gint16,
     n_taps, shift)
 /* *INDENT-ON* */
 
-#define RESAMPLE_VERT_FLOAT(function, tap_type, src_type, _n_taps, _shift) \
+#define RESAMPLE_VERT_FLOAT(function, dest_type, clamp, tap_type, src_type, _n_taps, _shift) \
 static void \
-function (guint8 *dest, \
+function (dest_type *dest, \
     const tap_type *taps, const src_type *src, int stride, int n_taps, \
     int shift, int n) \
 { \
@@ -828,13 +843,13 @@ function (guint8 *dest, \
       const src_type *line = PTR_OFFSET(src, stride * l); \
       sum_y += line[i] * taps[l]; \
     } \
-    dest[i] = CLAMP (floor(0.5 + sum_y), 0, 255); \
+    dest[i] = CLAMP (floor(0.5 + sum_y), 0, clamp); \
   } \
 }
 
-#define RESAMPLE_VERT_FLOAT_DITHER(function, tap_type, src_type, _n_taps, _shift) \
+#define RESAMPLE_VERT_FLOAT_DITHER(function, dest_type, clamp, tap_type, src_type, _n_taps, _shift) \
 static void \
-function (guint8 *dest, \
+function (dest_type *dest, \
     const tap_type *taps, const src_type *src, int stride, int n_taps, \
     int shift, int n) \
 { \
@@ -849,19 +864,24 @@ function (guint8 *dest, \
       sum_y += line[i] * taps[l]; \
     } \
     err_y += sum_y; \
-    dest[i] = CLAMP (floor (err_y), 0, 255); \
+    dest[i] = CLAMP (floor (err_y), 0, clamp); \
     err_y -= floor (err_y); \
   } \
 }
 
 /* *INDENT-OFF* */
-RESAMPLE_VERT_FLOAT (resample_vert_double_generic, double, double, n_taps,
+RESAMPLE_VERT_FLOAT (resample_vert_double_generic, guint8, 255, double, double, n_taps,
     shift)
-RESAMPLE_VERT_FLOAT_DITHER (resample_vert_dither_double_generic, double, double,
+RESAMPLE_VERT_FLOAT_DITHER (resample_vert_dither_double_generic, guint8, 255, double, double,
     n_taps, shift)
 
-RESAMPLE_VERT_FLOAT (resample_vert_float_generic, float, float, n_taps, shift)
-RESAMPLE_VERT_FLOAT_DITHER (resample_vert_dither_float_generic, float, float,
+RESAMPLE_VERT_FLOAT (resample_vert_double_generic_u16, guint16, 65535, double, double, n_taps,
+    shift)
+RESAMPLE_VERT_FLOAT_DITHER (resample_vert_dither_double_generic_u16, guint16, 65535, double, double,
+    n_taps, shift)
+
+RESAMPLE_VERT_FLOAT (resample_vert_float_generic, guint8, 255, float, float, n_taps, shift)
+RESAMPLE_VERT_FLOAT_DITHER (resample_vert_dither_float_generic, guint8, 255, float, float,
     n_taps, shift)
 /* *INDENT-ON* */
 
@@ -1556,3 +1576,77 @@ vs_image_scale_lanczos_AYUV_float (const VSImage * dest, const VSImage * src,
   scale1d_cleanup (&scale->y_scale1d);
   g_free (scale->tmpdata);
 }
+
+static void
+vs_scale_lanczos_AYUV64_double (Scale * scale)
+{
+  int j;
+  int yi;
+  int tmp_yi;
+
+  tmp_yi = 0;
+
+  for (j = 0; j < scale->dest->height; j++) {
+    guint16 *destline;
+    double *taps;
+
+    destline = (guint16 *) (scale->dest->pixels + scale->dest->stride * j);
+
+    yi = scale->y_scale1d.offsets[j];
+
+    while (tmp_yi < yi + scale->y_scale1d.n_taps) {
+      scale->horiz_resample_func (TMP_LINE_DOUBLE_AYUV (tmp_yi),
+          scale->x_scale1d.offsets, scale->x_scale1d.taps, SRC_LINE (tmp_yi),
+          scale->x_scale1d.n_taps, 0, scale->dest->width);
+      tmp_yi++;
+    }
+
+    taps = (double *) scale->y_scale1d.taps + j * scale->y_scale1d.n_taps;
+    if (scale->dither) {
+      resample_vert_dither_double_generic_u16 (destline,
+          taps, TMP_LINE_DOUBLE_AYUV (scale->y_scale1d.offsets[j]),
+          sizeof (double) * 4 * scale->dest->width,
+          scale->y_scale1d.n_taps, 0, scale->dest->width * 4);
+    } else {
+      resample_vert_double_generic_u16 (destline,
+          taps, TMP_LINE_DOUBLE_AYUV (scale->y_scale1d.offsets[j]),
+          sizeof (double) * 4 * scale->dest->width,
+          scale->y_scale1d.n_taps, 0, scale->dest->width * 4);
+    }
+  }
+}
+
+void
+vs_image_scale_lanczos_AYUV64_double (const VSImage * dest, const VSImage * src,
+    uint8_t * tmpbuf, double sharpness, gboolean dither, double a,
+    double sharpen)
+{
+  Scale s = { 0 };
+  Scale *scale = &s;
+  int n_taps;
+
+  scale->dest = dest;
+  scale->src = src;
+
+  n_taps = scale1d_get_n_taps (src->width, dest->width, a, sharpness);
+  scale1d_calculate_taps (&scale->x_scale1d,
+      src->width, dest->width, n_taps, a, sharpness, sharpen);
+
+  n_taps = scale1d_get_n_taps (src->height, dest->height, a, sharpness);
+  scale1d_calculate_taps (&scale->y_scale1d,
+      src->height, dest->height, n_taps, a, sharpness, sharpen);
+
+  scale->dither = dither;
+
+  scale->horiz_resample_func =
+      (HorizResampleFunc) resample_horiz_double_ayuv_generic_s16;
+
+  scale->tmpdata =
+      g_malloc (sizeof (double) * scale->dest->width * scale->src->height * 4);
+
+  vs_scale_lanczos_AYUV64_double (scale);
+
+  scale1d_cleanup (&scale->x_scale1d);
+  scale1d_cleanup (&scale->y_scale1d);
+  g_free (scale->tmpdata);
+}
diff --git a/gst/videoscale/vs_scanline.c b/gst/videoscale/vs_scanline.c
index 822a6b6..c9459c2 100644
--- a/gst/videoscale/vs_scanline.c
+++ b/gst/videoscale/vs_scanline.c
@@ -519,6 +519,88 @@ vs_scanline_merge_linear_UYVY (uint8_t * dest, uint8_t * src1,
 }
 
 
+/* NV12 */
+
+/* n is the number of bi-pixels */
+
+void
+vs_scanline_downsample_NV12 (uint8_t * dest, uint8_t * src, int n)
+{
+  int i;
+
+  for (i = 0; i < n; i++) {
+    dest[i * 2 + 0] = (src[i * 4 + 0] + src[i * 4 + 2]) / 2;
+    dest[i * 2 + 1] = (src[i * 4 + 1] + src[i * 4 + 3]) / 2;
+  }
+}
+
+void
+vs_scanline_resample_nearest_NV12 (uint8_t * dest, uint8_t * src, int src_width,
+    int n, int *accumulator, int increment)
+{
+  int acc = *accumulator;
+  int i;
+  int j;
+  int x;
+
+  for (i = 0; i < n; i++) {
+    j = acc >> 16;
+    x = acc & 0xffff;
+
+    dest[i * 2 + 0] = (x < 32768
+        || j + 1 >= src_width) ? src[j * 2 + 0] : src[j * 2 + 2];
+    dest[i * 2 + 1] = (x < 32768
+        || j + 1 >= src_width) ? src[j * 2 + 1] : src[j * 2 + 3];
+
+    acc += increment;
+  }
+
+  *accumulator = acc;
+}
+
+void
+vs_scanline_resample_linear_NV12 (uint8_t * dest, uint8_t * src, int src_width,
+    int n, int *accumulator, int increment)
+{
+  int acc = *accumulator;
+  int i;
+  int j;
+  int x;
+
+  for (i = 0; i < n; i++) {
+    j = acc >> 16;
+    x = acc & 0xffff;
+
+    if (j + 1 < src_width) {
+      dest[i * 2 + 0] =
+          (src[j * 2 + 0] * (65536 - x) + src[j * 2 + 2] * x) >> 16;
+      dest[i * 2 + 1] =
+          (src[j * 2 + 1] * (65536 - x) + src[j * 2 + 3] * x) >> 16;
+    } else {
+      dest[i * 4 + 0] = src[j * 2 + 0];
+      dest[i * 4 + 1] = src[j * 2 + 1];
+    }
+
+    acc += increment;
+  }
+
+  *accumulator = acc;
+}
+
+void
+vs_scanline_merge_linear_NV12 (uint8_t * dest, uint8_t * src1,
+    uint8_t * src2, int n, int x)
+{
+  uint32_t value = x >> 8;
+
+  if (value == 0) {
+    memcpy (dest, src1, n * 2);
+  } else {
+    orc_merge_linear_u8 (dest, src1, src2, value, n * 2);
+  }
+}
+
+
 /* RGB565 */
 
 /* note that src and dest are uint16_t, and thus endian dependent */
diff --git a/gst/videoscale/vs_scanline.h b/gst/videoscale/vs_scanline.h
index 387fc95..92d8f6f 100644
--- a/gst/videoscale/vs_scanline.h
+++ b/gst/videoscale/vs_scanline.h
@@ -55,6 +55,11 @@ void vs_scanline_resample_nearest_UYVY (uint8_t *dest, uint8_t *src, int src_wid
 void vs_scanline_resample_linear_UYVY (uint8_t *dest, uint8_t *src, int src_width, int n, int *accumulator, int increment);
 void vs_scanline_merge_linear_UYVY (uint8_t *dest, uint8_t *src1, uint8_t *src2, int n, int x);
 
+void vs_scanline_downsample_NV12 (uint8_t *dest, uint8_t *src, int n);
+void vs_scanline_resample_nearest_NV12 (uint8_t *dest, uint8_t *src, int src_width, int n, int *accumulator, int increment);
+void vs_scanline_resample_linear_NV12 (uint8_t *dest, uint8_t *src, int src_width, int n, int *accumulator, int increment);
+void vs_scanline_merge_linear_NV12 (uint8_t *dest, uint8_t *src1, uint8_t *src2, int n, int x);
+
 void vs_scanline_downsample_RGB565 (uint8_t *dest, uint8_t *src, int n);
 void vs_scanline_resample_nearest_RGB565 (uint8_t *dest, uint8_t *src, int src_width, int n, int *accumulator, int increment);
 void vs_scanline_resample_linear_RGB565 (uint8_t *dest, uint8_t *src, int src_width, int n, int *accumulator, int increment);
diff --git a/gst/videotestsrc/Makefile.am b/gst/videotestsrc/Makefile.am
index 91b6f63..de4ce26 100644
--- a/gst/videotestsrc/Makefile.am
+++ b/gst/videotestsrc/Makefile.am
@@ -15,7 +15,7 @@ libgstvideotestsrc_la_LIBTOOLFLAGS = --tag=disable-static
 
 noinst_HEADERS = gstvideotestsrc.h videotestsrc.h
 
-noinst_PROGRAMS = generate_sine_table
+EXTRA_PROGRAMS = generate_sine_table
 
 generate_sine_table_SOURCES = generate_sine_table.c
 generate_sine_table_CFLAGS = $(GST_CFLAGS)
diff --git a/gst/videotestsrc/Makefile.in b/gst/videotestsrc/Makefile.in
index 583dbeb..3946404 100644
--- a/gst/videotestsrc/Makefile.in
+++ b/gst/videotestsrc/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -38,8 +37,24 @@
 #
 
 
-
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -58,9 +73,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak
-noinst_PROGRAMS = generate_sine_table$(EXEEXT)
+	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak \
+	$(top_srcdir)/depcomp
+EXTRA_PROGRAMS = generate_sine_table$(EXEEXT)
 subdir = gst/videotestsrc
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
@@ -149,11 +166,11 @@ libgstvideotestsrc_la_OBJECTS = $(am_libgstvideotestsrc_la_OBJECTS) \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstvideotestsrc_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstvideotestsrc_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstvideotestsrc_la_CFLAGS) $(CFLAGS) \
 	$(libgstvideotestsrc_la_LDFLAGS) $(LDFLAGS) -o $@
-PROGRAMS = $(noinst_PROGRAMS)
 am_generate_sine_table_OBJECTS =  \
 	generate_sine_table-generate_sine_table.$(OBJEXT)
 generate_sine_table_OBJECTS = $(am_generate_sine_table_OBJECTS)
@@ -163,6 +180,18 @@ generate_sine_table_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(generate_sine_table_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) \
 	$(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -175,25 +204,26 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstvideotestsrc_la_SOURCES) \
 	$(nodist_libgstvideotestsrc_la_SOURCES) \
 	$(generate_sine_table_SOURCES)
 DIST_SOURCES = $(libgstvideotestsrc_la_SOURCES) \
 	$(generate_sine_table_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -486,7 +516,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -552,7 +586,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -560,6 +593,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -575,23 +610,16 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstvideotestsrc.la: $(libgstvideotestsrc_la_OBJECTS) $(libgstvideotestsrc_la_DEPENDENCIES) $(EXTRA_libgstvideotestsrc_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstvideotestsrc_la_LINK) -rpath $(plugindir) $(libgstvideotestsrc_la_OBJECTS) $(libgstvideotestsrc_la_LIBADD) $(LIBS)
-
-clean-noinstPROGRAMS:
-	@list='$(noinst_PROGRAMS)'; test -n "$$list" || exit 0; \
-	echo " rm -f" $$list; \
-	rm -f $$list || exit $$?; \
-	test -n "$(EXEEXT)" || exit 0; \
-	list=`for p in $$list; do echo "$$p"; done | sed 's/$(EXEEXT)$$//'`; \
-	echo " rm -f" $$list; \
-	rm -f $$list
 generate_sine_table$(EXEEXT): $(generate_sine_table_OBJECTS) $(generate_sine_table_DEPENDENCIES) $(EXTRA_generate_sine_table_DEPENDENCIES) 
 	@rm -f generate_sine_table$(EXEEXT)
 	$(AM_V_CCLD)$(generate_sine_table_LINK) $(generate_sine_table_OBJECTS) $(generate_sine_table_LDADD) $(LIBS)
@@ -718,6 +746,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -757,7 +799,7 @@ distdir: $(DISTFILES)
 check-am: all-am
 check: $(BUILT_SOURCES)
 	$(MAKE) $(AM_MAKEFLAGS) check-am
-all-am: Makefile $(LTLIBRARIES) $(PROGRAMS) $(HEADERS)
+all-am: Makefile $(LTLIBRARIES) $(HEADERS)
 installdirs:
 	for dir in "$(DESTDIR)$(plugindir)"; do \
 	  test -z "$$dir" || $(MKDIR_P) "$$dir"; \
@@ -796,7 +838,7 @@ maintainer-clean-generic:
 	-test -z "$(BUILT_SOURCES)" || rm -f $(BUILT_SOURCES)
 clean: clean-am
 
-clean-am: clean-generic clean-libtool clean-local clean-noinstPROGRAMS \
+clean-am: clean-generic clean-libtool clean-local \
 	clean-pluginLTLIBRARIES mostlyclean-am
 
 distclean: distclean-am
@@ -868,19 +910,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-local clean-noinstPROGRAMS \
-	clean-pluginLTLIBRARIES ctags dist-hook distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-local clean-pluginLTLIBRARIES cscopelist \
+	ctags dist-hook distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 orc-update: tmp-orc.c $(ORC_SOURCE).h
diff --git a/gst/volume/Makefile.in b/gst/volume/Makefile.in
index 4f538e1..c9a4b4c 100644
--- a/gst/volume/Makefile.in
+++ b/gst/volume/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -39,6 +38,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -57,8 +73,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak
+	$(srcdir)/Makefile.in $(top_srcdir)/common/orc.mak \
+	$(top_srcdir)/depcomp
 subdir = gst/volume
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
@@ -146,10 +164,23 @@ libgstvolume_la_OBJECTS = $(am_libgstvolume_la_OBJECTS) \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstvolume_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstvolume_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link \
 	$(CCLD) $(libgstvolume_la_CFLAGS) $(CFLAGS) \
 	$(libgstvolume_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -162,22 +193,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstvolume_la_SOURCES) $(nodist_libgstvolume_la_SOURCES)
 DIST_SOURCES = $(libgstvolume_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -470,7 +502,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -537,7 +573,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -545,6 +580,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -560,12 +597,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstvolume.la: $(libgstvolume_la_OBJECTS) $(libgstvolume_la_DEPENDENCIES) $(EXTRA_libgstvolume_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstvolume_la_LINK) -rpath $(plugindir) $(libgstvolume_la_OBJECTS) $(libgstvolume_la_LIBADD) $(LIBS)
 
@@ -668,6 +707,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -818,8 +871,8 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: all check install install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-local clean-pluginLTLIBRARIES ctags \
-	dist-hook distclean distclean-compile distclean-generic \
+	clean-libtool clean-local clean-pluginLTLIBRARIES cscopelist \
+	ctags dist-hook distclean distclean-compile distclean-generic \
 	distclean-libtool distclean-tags distdir dvi dvi-am html \
 	html-am info info-am install install-am install-data \
 	install-data-am install-dvi install-dvi-am install-exec \
diff --git a/ltmain.sh b/ltmain.sh
index c7d06c3..79fb897 100644
--- a/ltmain.sh
+++ b/ltmain.sh
@@ -70,7 +70,7 @@
 #         compiler:		$LTCC
 #         compiler flags:		$LTCFLAGS
 #         linker:		$LD (gnu? $with_gnu_ld)
-#         $progname:	(GNU libtool) 2.4.2 Debian-2.4.2-1
+#         $progname:	(GNU libtool) 2.4.2
 #         automake:	$automake_version
 #         autoconf:	$autoconf_version
 #
@@ -80,7 +80,7 @@
 
 PROGRAM=libtool
 PACKAGE=libtool
-VERSION="2.4.2 Debian-2.4.2-1"
+VERSION=2.4.2
 TIMESTAMP=""
 package_revision=1.3337
 
@@ -6124,10 +6124,7 @@ func_mode_link ()
 	case $pass in
 	dlopen) libs="$dlfiles" ;;
 	dlpreopen) libs="$dlprefiles" ;;
-	link)
-	  libs="$deplibs %DEPLIBS%"
-	  test "X$link_all_deplibs" != Xno && libs="$libs $dependency_libs"
-	  ;;
+	link) libs="$deplibs %DEPLIBS% $dependency_libs" ;;
 	esac
       fi
       if test "$linkmode,$pass" = "lib,dlpreopen"; then
@@ -6447,19 +6444,19 @@ func_mode_link ()
 	    # It is a libtool convenience library, so add in its objects.
 	    func_append convenience " $ladir/$objdir/$old_library"
 	    func_append old_convenience " $ladir/$objdir/$old_library"
-	    tmp_libs=
-	    for deplib in $dependency_libs; do
-	      deplibs="$deplib $deplibs"
-	      if $opt_preserve_dup_deps ; then
-		case "$tmp_libs " in
-		*" $deplib "*) func_append specialdeplibs " $deplib" ;;
-		esac
-	      fi
-	      func_append tmp_libs " $deplib"
-	    done
 	  elif test "$linkmode" != prog && test "$linkmode" != lib; then
 	    func_fatal_error "\`$lib' is not a convenience library"
 	  fi
+	  tmp_libs=
+	  for deplib in $dependency_libs; do
+	    deplibs="$deplib $deplibs"
+	    if $opt_preserve_dup_deps ; then
+	      case "$tmp_libs " in
+	      *" $deplib "*) func_append specialdeplibs " $deplib" ;;
+	      esac
+	    fi
+	    func_append tmp_libs " $deplib"
+	  done
 	  continue
 	fi # $pass = conv
 
@@ -6921,7 +6918,7 @@ func_mode_link ()
 	      fi
 	    else
 	      # We cannot seem to hardcode it, guess we'll fake it.
-	      add_dir="-L$libdir"
+	      add_dir="-L$lt_sysroot$libdir"
 	      # Try looking first in the location we're being installed to.
 	      if test -n "$inst_prefix_dir"; then
 		case $libdir in
@@ -7352,9 +7349,6 @@ func_mode_link ()
 	    revision="$number_minor"
 	    lt_irix_increment=no
 	    ;;
-	  *)
-	    func_fatal_configuration "$modename: unknown library version type \`$version_type'"
-	    ;;
 	  esac
 	  ;;
 	no)
diff --git a/m4/Makefile.in b/m4/Makefile.in
index b85cc25..5807732 100644
--- a/m4/Makefile.in
+++ b/m4/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,6 +14,23 @@
 
 @SET_MAKE@
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -33,6 +49,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = m4
 DIST_COMMON = README $(srcdir)/Makefile.am $(srcdir)/Makefile.in
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
@@ -79,14 +96,25 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 ACLOCAL = @ACLOCAL@
 ACLOCAL_AMFLAGS = @ACLOCAL_AMFLAGS@
@@ -376,7 +404,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -450,6 +482,8 @@ TAGS:
 ctags: CTAGS
 CTAGS:
 
+cscope cscopelist:
+
 
 distdir: $(DISTFILES)
 	@srcdirstrip=`echo "$(srcdir)" | sed 's/[].[^$$\\*]/\\\\&/g'`; \
diff --git a/m4/glibc2.m4 b/m4/glibc2.m4
new file mode 100644
index 0000000..e8f5bfe
--- /dev/null
+++ b/m4/glibc2.m4
@@ -0,0 +1,30 @@
+# glibc2.m4 serial 1
+dnl Copyright (C) 2000-2002, 2004 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+# Test for the GNU C Library, version 2.0 or newer.
+# From Bruno Haible.
+
+AC_DEFUN([gt_GLIBC2],
+  [
+    AC_CACHE_CHECK(whether we are using the GNU C Library 2 or newer,
+      ac_cv_gnu_library_2,
+      [AC_EGREP_CPP([Lucky GNU user],
+	[
+#include <features.h>
+#ifdef __GNU_LIBRARY__
+ #if (__GLIBC__ >= 2)
+  Lucky GNU user
+ #endif
+#endif
+	],
+	ac_cv_gnu_library_2=yes,
+	ac_cv_gnu_library_2=no)
+      ]
+    )
+    AC_SUBST(GLIBC2)
+    GLIBC2="$ac_cv_gnu_library_2"
+  ]
+)
diff --git a/m4/intl.m4 b/m4/intl.m4
new file mode 100644
index 0000000..934408b
--- /dev/null
+++ b/m4/intl.m4
@@ -0,0 +1,285 @@
+# intl.m4 serial 8 (gettext-0.17)
+dnl Copyright (C) 1995-2007 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+dnl
+dnl This file can can be used in projects which are not available under
+dnl the GNU General Public License or the GNU Library General Public
+dnl License but which still want to provide support for the GNU gettext
+dnl functionality.
+dnl Please note that the actual code of the GNU gettext library is covered
+dnl by the GNU Library General Public License, and the rest of the GNU
+dnl gettext package package is covered by the GNU General Public License.
+dnl They are *not* in the public domain.
+
+dnl Authors:
+dnl   Ulrich Drepper <drepper@cygnus.com>, 1995-2000.
+dnl   Bruno Haible <haible@clisp.cons.org>, 2000-2006.
+
+AC_PREREQ(2.52)
+
+dnl Checks for all prerequisites of the intl subdirectory,
+dnl except for INTL_LIBTOOL_SUFFIX_PREFIX (and possibly LIBTOOL), INTLOBJS,
+dnl            USE_INCLUDED_LIBINTL, BUILD_INCLUDED_LIBINTL.
+AC_DEFUN([AM_INTL_SUBDIR],
+[
+  AC_REQUIRE([AC_PROG_INSTALL])dnl
+  AC_REQUIRE([AM_PROG_MKDIR_P])dnl defined by automake
+  AC_REQUIRE([AC_PROG_CC])dnl
+  AC_REQUIRE([AC_CANONICAL_HOST])dnl
+  AC_REQUIRE([gt_GLIBC2])dnl
+  AC_REQUIRE([AC_PROG_RANLIB])dnl
+  AC_REQUIRE([gl_VISIBILITY])dnl
+  AC_REQUIRE([gt_INTL_SUBDIR_CORE])dnl
+  AC_REQUIRE([AC_TYPE_LONG_LONG_INT])dnl
+  AC_REQUIRE([gt_TYPE_WCHAR_T])dnl
+  AC_REQUIRE([gt_TYPE_WINT_T])dnl
+  AC_REQUIRE([gl_AC_HEADER_INTTYPES_H])
+  AC_REQUIRE([gt_TYPE_INTMAX_T])
+  AC_REQUIRE([gt_PRINTF_POSIX])
+  AC_REQUIRE([gl_GLIBC21])dnl
+  AC_REQUIRE([gl_XSIZE])dnl
+  AC_REQUIRE([gt_INTL_MACOSX])dnl
+
+  AC_CHECK_TYPE([ptrdiff_t], ,
+    [AC_DEFINE([ptrdiff_t], [long],
+       [Define as the type of the result of subtracting two pointers, if the system doesn't define it.])
+    ])
+  AC_CHECK_HEADERS([stddef.h stdlib.h string.h])
+  AC_CHECK_FUNCS([asprintf fwprintf putenv setenv setlocale snprintf wcslen])
+
+  dnl Use the _snprintf function only if it is declared (because on NetBSD it
+  dnl is defined as a weak alias of snprintf; we prefer to use the latter).
+  gt_CHECK_DECL(_snprintf, [#include <stdio.h>])
+  gt_CHECK_DECL(_snwprintf, [#include <stdio.h>])
+
+  dnl Use the *_unlocked functions only if they are declared.
+  dnl (because some of them were defined without being declared in Solaris
+  dnl 2.5.1 but were removed in Solaris 2.6, whereas we want binaries built
+  dnl on Solaris 2.5.1 to run on Solaris 2.6).
+  dnl Don't use AC_CHECK_DECLS because it isn't supported in autoconf-2.13.
+  gt_CHECK_DECL(getc_unlocked, [#include <stdio.h>])
+
+  case $gt_cv_func_printf_posix in
+    *yes) HAVE_POSIX_PRINTF=1 ;;
+    *) HAVE_POSIX_PRINTF=0 ;;
+  esac
+  AC_SUBST([HAVE_POSIX_PRINTF])
+  if test "$ac_cv_func_asprintf" = yes; then
+    HAVE_ASPRINTF=1
+  else
+    HAVE_ASPRINTF=0
+  fi
+  AC_SUBST([HAVE_ASPRINTF])
+  if test "$ac_cv_func_snprintf" = yes; then
+    HAVE_SNPRINTF=1
+  else
+    HAVE_SNPRINTF=0
+  fi
+  AC_SUBST([HAVE_SNPRINTF])
+  if test "$ac_cv_func_wprintf" = yes; then
+    HAVE_WPRINTF=1
+  else
+    HAVE_WPRINTF=0
+  fi
+  AC_SUBST([HAVE_WPRINTF])
+
+  AM_LANGINFO_CODESET
+  gt_LC_MESSAGES
+
+  dnl Compilation on mingw and Cygwin needs special Makefile rules, because
+  dnl 1. when we install a shared library, we must arrange to export
+  dnl    auxiliary pointer variables for every exported variable,
+  dnl 2. when we install a shared library and a static library simultaneously,
+  dnl    the include file specifies __declspec(dllimport) and therefore we
+  dnl    must arrange to define the auxiliary pointer variables for the
+  dnl    exported variables _also_ in the static library.
+  if test "$enable_shared" = yes; then
+    case "$host_os" in
+      mingw* | cygwin*) is_woe32dll=yes ;;
+      *) is_woe32dll=no ;;
+    esac
+  else
+    is_woe32dll=no
+  fi
+  WOE32DLL=$is_woe32dll
+  AC_SUBST([WOE32DLL])
+
+  dnl On mingw and Cygwin, we can activate special Makefile rules which add
+  dnl version information to the shared libraries and executables.
+  case "$host_os" in
+    mingw* | cygwin*) is_woe32=yes ;;
+    *) is_woe32=no ;;
+  esac
+  WOE32=$is_woe32
+  AC_SUBST([WOE32])
+  if test $WOE32 = yes; then
+    dnl Check for a program that compiles Windows resource files.
+    AC_CHECK_TOOL([WINDRES], [windres])
+  fi
+
+  dnl Determine whether when creating a library, "-lc" should be passed to
+  dnl libtool or not. On many platforms, it is required for the libtool option
+  dnl -no-undefined to work. On HP-UX, however, the -lc - stored by libtool
+  dnl in the *.la files - makes it impossible to create multithreaded programs,
+  dnl because libtool also reorders the -lc to come before the -pthread, and
+  dnl this disables pthread_create() <http://docs.hp.com/en/1896/pthreads.html>.
+  case "$host_os" in
+    hpux*) LTLIBC="" ;;
+    *)     LTLIBC="-lc" ;;
+  esac
+  AC_SUBST([LTLIBC])
+
+  dnl Rename some macros and functions used for locking.
+  AH_BOTTOM([
+#define __libc_lock_t                   gl_lock_t
+#define __libc_lock_define              gl_lock_define
+#define __libc_lock_define_initialized  gl_lock_define_initialized
+#define __libc_lock_init                gl_lock_init
+#define __libc_lock_lock                gl_lock_lock
+#define __libc_lock_unlock              gl_lock_unlock
+#define __libc_lock_recursive_t                   gl_recursive_lock_t
+#define __libc_lock_define_recursive              gl_recursive_lock_define
+#define __libc_lock_define_initialized_recursive  gl_recursive_lock_define_initialized
+#define __libc_lock_init_recursive                gl_recursive_lock_init
+#define __libc_lock_lock_recursive                gl_recursive_lock_lock
+#define __libc_lock_unlock_recursive              gl_recursive_lock_unlock
+#define glthread_in_use  libintl_thread_in_use
+#define glthread_lock_init     libintl_lock_init
+#define glthread_lock_lock     libintl_lock_lock
+#define glthread_lock_unlock   libintl_lock_unlock
+#define glthread_lock_destroy  libintl_lock_destroy
+#define glthread_rwlock_init     libintl_rwlock_init
+#define glthread_rwlock_rdlock   libintl_rwlock_rdlock
+#define glthread_rwlock_wrlock   libintl_rwlock_wrlock
+#define glthread_rwlock_unlock   libintl_rwlock_unlock
+#define glthread_rwlock_destroy  libintl_rwlock_destroy
+#define glthread_recursive_lock_init     libintl_recursive_lock_init
+#define glthread_recursive_lock_lock     libintl_recursive_lock_lock
+#define glthread_recursive_lock_unlock   libintl_recursive_lock_unlock
+#define glthread_recursive_lock_destroy  libintl_recursive_lock_destroy
+#define glthread_once                 libintl_once
+#define glthread_once_call            libintl_once_call
+#define glthread_once_singlethreaded  libintl_once_singlethreaded
+])
+])
+
+
+dnl Checks for the core files of the intl subdirectory:
+dnl   dcigettext.c
+dnl   eval-plural.h
+dnl   explodename.c
+dnl   finddomain.c
+dnl   gettextP.h
+dnl   gmo.h
+dnl   hash-string.h hash-string.c
+dnl   l10nflist.c
+dnl   libgnuintl.h.in (except the *printf stuff)
+dnl   loadinfo.h
+dnl   loadmsgcat.c
+dnl   localealias.c
+dnl   log.c
+dnl   plural-exp.h plural-exp.c
+dnl   plural.y
+dnl Used by libglocale.
+AC_DEFUN([gt_INTL_SUBDIR_CORE],
+[
+  AC_REQUIRE([AC_C_INLINE])dnl
+  AC_REQUIRE([AC_TYPE_SIZE_T])dnl
+  AC_REQUIRE([gl_AC_HEADER_STDINT_H])
+  AC_REQUIRE([AC_FUNC_ALLOCA])dnl
+  AC_REQUIRE([AC_FUNC_MMAP])dnl
+  AC_REQUIRE([gt_INTDIV0])dnl
+  AC_REQUIRE([gl_AC_TYPE_UINTMAX_T])dnl
+  AC_REQUIRE([gt_INTTYPES_PRI])dnl
+  AC_REQUIRE([gl_LOCK])dnl
+
+  AC_TRY_LINK(
+    [int foo (int a) { a = __builtin_expect (a, 10); return a == 10 ? 0 : 1; }],
+    [],
+    [AC_DEFINE([HAVE_BUILTIN_EXPECT], 1,
+       [Define to 1 if the compiler understands __builtin_expect.])])
+
+  AC_CHECK_HEADERS([argz.h inttypes.h limits.h unistd.h sys/param.h])
+  AC_CHECK_FUNCS([getcwd getegid geteuid getgid getuid mempcpy munmap \
+    stpcpy strcasecmp strdup strtoul tsearch argz_count argz_stringify \
+    argz_next __fsetlocking])
+
+  dnl Use the *_unlocked functions only if they are declared.
+  dnl (because some of them were defined without being declared in Solaris
+  dnl 2.5.1 but were removed in Solaris 2.6, whereas we want binaries built
+  dnl on Solaris 2.5.1 to run on Solaris 2.6).
+  dnl Don't use AC_CHECK_DECLS because it isn't supported in autoconf-2.13.
+  gt_CHECK_DECL(feof_unlocked, [#include <stdio.h>])
+  gt_CHECK_DECL(fgets_unlocked, [#include <stdio.h>])
+
+  AM_ICONV
+
+  dnl glibc >= 2.4 has a NL_LOCALE_NAME macro when _GNU_SOURCE is defined,
+  dnl and a _NL_LOCALE_NAME macro always.
+  AC_CACHE_CHECK([for NL_LOCALE_NAME macro], gt_cv_nl_locale_name,
+    [AC_TRY_LINK([#include <langinfo.h>
+#include <locale.h>],
+      [char* cs = nl_langinfo(_NL_LOCALE_NAME(LC_MESSAGES));
+       return !cs;
+      ],
+      gt_cv_nl_locale_name=yes,
+      gt_cv_nl_locale_name=no)
+    ])
+  if test $gt_cv_nl_locale_name = yes; then
+    AC_DEFINE(HAVE_NL_LOCALE_NAME, 1,
+      [Define if you have <langinfo.h> and it defines the NL_LOCALE_NAME macro if _GNU_SOURCE is defined.])
+  fi
+
+  dnl intl/plural.c is generated from intl/plural.y. It requires bison,
+  dnl because plural.y uses bison specific features. It requires at least
+  dnl bison-1.26 because earlier versions generate a plural.c that doesn't
+  dnl compile.
+  dnl bison is only needed for the maintainer (who touches plural.y). But in
+  dnl order to avoid separate Makefiles or --enable-maintainer-mode, we put
+  dnl the rule in general Makefile. Now, some people carelessly touch the
+  dnl files or have a broken "make" program, hence the plural.c rule will
+  dnl sometimes fire. To avoid an error, defines BISON to ":" if it is not
+  dnl present or too old.
+  AC_CHECK_PROGS([INTLBISON], [bison])
+  if test -z "$INTLBISON"; then
+    ac_verc_fail=yes
+  else
+    dnl Found it, now check the version.
+    AC_MSG_CHECKING([version of bison])
+changequote(<<,>>)dnl
+    ac_prog_version=`$INTLBISON --version 2>&1 | sed -n 's/^.*GNU Bison.* \([0-9]*\.[0-9.]*\).*$/\1/p'`
+    case $ac_prog_version in
+      '') ac_prog_version="v. ?.??, bad"; ac_verc_fail=yes;;
+      1.2[6-9]* | 1.[3-9][0-9]* | [2-9].*)
+changequote([,])dnl
+         ac_prog_version="$ac_prog_version, ok"; ac_verc_fail=no;;
+      *) ac_prog_version="$ac_prog_version, bad"; ac_verc_fail=yes;;
+    esac
+    AC_MSG_RESULT([$ac_prog_version])
+  fi
+  if test $ac_verc_fail = yes; then
+    INTLBISON=:
+  fi
+])
+
+
+dnl gt_CHECK_DECL(FUNC, INCLUDES)
+dnl Check whether a function is declared.
+AC_DEFUN([gt_CHECK_DECL],
+[
+  AC_CACHE_CHECK([whether $1 is declared], ac_cv_have_decl_$1,
+    [AC_TRY_COMPILE([$2], [
+#ifndef $1
+  char *p = (char *) $1;
+#endif
+], ac_cv_have_decl_$1=yes, ac_cv_have_decl_$1=no)])
+  if test $ac_cv_have_decl_$1 = yes; then
+    gt_value=1
+  else
+    gt_value=0
+  fi
+  AC_DEFINE_UNQUOTED([HAVE_DECL_]translit($1, [a-z], [A-Z]), [$gt_value],
+    [Define to 1 if you have the declaration of `$1', and to 0 if you don't.])
+])
diff --git a/m4/intldir.m4 b/m4/intldir.m4
new file mode 100644
index 0000000..7a28843
--- /dev/null
+++ b/m4/intldir.m4
@@ -0,0 +1,19 @@
+# intldir.m4 serial 1 (gettext-0.16)
+dnl Copyright (C) 2006 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+dnl
+dnl This file can can be used in projects which are not available under
+dnl the GNU General Public License or the GNU Library General Public
+dnl License but which still want to provide support for the GNU gettext
+dnl functionality.
+dnl Please note that the actual code of the GNU gettext library is covered
+dnl by the GNU Library General Public License, and the rest of the GNU
+dnl gettext package package is covered by the GNU General Public License.
+dnl They are *not* in the public domain.
+
+AC_PREREQ(2.52)
+
+dnl Tells the AM_GNU_GETTEXT macro to consider an intl/ directory.
+AC_DEFUN([AM_GNU_GETTEXT_INTL_SUBDIR], [])
diff --git a/m4/intmax.m4 b/m4/intmax.m4
new file mode 100644
index 0000000..ce7a8a4
--- /dev/null
+++ b/m4/intmax.m4
@@ -0,0 +1,33 @@
+# intmax.m4 serial 3 (gettext-0.16)
+dnl Copyright (C) 2002-2005 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+dnl Test whether the system has the 'intmax_t' type, but don't attempt to
+dnl find a replacement if it is lacking.
+
+AC_DEFUN([gt_TYPE_INTMAX_T],
+[
+  AC_REQUIRE([gl_AC_HEADER_INTTYPES_H])
+  AC_REQUIRE([gl_AC_HEADER_STDINT_H])
+  AC_CACHE_CHECK(for intmax_t, gt_cv_c_intmax_t,
+    [AC_TRY_COMPILE([
+#include <stddef.h>
+#include <stdlib.h>
+#if HAVE_STDINT_H_WITH_UINTMAX
+#include <stdint.h>
+#endif
+#if HAVE_INTTYPES_H_WITH_UINTMAX
+#include <inttypes.h>
+#endif
+],     [intmax_t x = -1;
+        return !x;],
+       gt_cv_c_intmax_t=yes,
+       gt_cv_c_intmax_t=no)])
+  if test $gt_cv_c_intmax_t = yes; then
+    AC_DEFINE(HAVE_INTMAX_T, 1,
+      [Define if you have the 'intmax_t' type in <stdint.h> or <inttypes.h>.])
+  fi
+])
diff --git a/m4/libtool.m4 b/m4/libtool.m4
index 828104c..327d0bd 100644
--- a/m4/libtool.m4
+++ b/m4/libtool.m4
@@ -2684,18 +2684,6 @@ linux* | k*bsd*-gnu | kopensolaris*-gnu)
   dynamic_linker='GNU/Linux ld.so'
   ;;
 
-netbsdelf*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='NetBSD ld.elf_so'
-  ;;
-
 netbsd*)
   version_type=sunos
   need_lib_prefix=no
@@ -3301,7 +3289,7 @@ linux* | k*bsd*-gnu | kopensolaris*-gnu)
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-netbsd* | netbsdelf*-gnu)
+netbsd*)
   if echo __ELF__ | $CC -E - | $GREP __ELF__ > /dev/null; then
     lt_cv_deplibs_check_method='match_pattern /lib[[^/]]+(\.so\.[[0-9]]+\.[[0-9]]+|_pic\.a)$'
   else
@@ -4113,7 +4101,7 @@ m4_if([$1], [CXX], [
 	    ;;
 	esac
 	;;
-      netbsd* | netbsdelf*-gnu)
+      netbsd*)
 	;;
       *qnx* | *nto*)
         # QNX uses GNU C++, but need to define -shared option too, otherwise
@@ -4590,9 +4578,6 @@ m4_if([$1], [CXX], [
       ;;
     esac
     ;;
-  linux* | k*bsd*-gnu | gnu*)
-    _LT_TAGVAR(link_all_deplibs, $1)=no
-    ;;
   *)
     _LT_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq > $export_symbols'
     ;;
@@ -4655,9 +4640,6 @@ dnl Note also adjust exclude_expsyms for C++ above.
   openbsd*)
     with_gnu_ld=no
     ;;
-  linux* | k*bsd*-gnu | gnu*)
-    _LT_TAGVAR(link_all_deplibs, $1)=no
-    ;;
   esac
 
   _LT_TAGVAR(ld_shlibs, $1)=yes
@@ -4879,7 +4861,7 @@ _LT_EOF
       fi
       ;;
 
-    netbsd* | netbsdelf*-gnu)
+    netbsd*)
       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
 	_LT_TAGVAR(archive_cmds, $1)='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
 	wlarc=
@@ -5056,7 +5038,6 @@ _LT_EOF
 	if test "$aix_use_runtimelinking" = yes; then
 	  shared_flag="$shared_flag "'${wl}-G'
 	fi
-	_LT_TAGVAR(link_all_deplibs, $1)=no
       else
 	# not using gcc
 	if test "$host_cpu" = ia64; then
@@ -5361,7 +5342,7 @@ _LT_EOF
       _LT_TAGVAR(link_all_deplibs, $1)=yes
       ;;
 
-    netbsd* | netbsdelf*-gnu)
+    netbsd*)
       if echo __ELF__ | $CC -E - | $GREP __ELF__ >/dev/null; then
 	_LT_TAGVAR(archive_cmds, $1)='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'  # a.out
       else
@@ -5938,8 +5919,13 @@ if test "$_lt_caught_CXX_error" != yes; then
       # Check if GNU C++ uses GNU ld as the underlying linker, since the
       # archiving commands below assume that GNU ld is being used.
       if test "$with_gnu_ld" = yes; then
-        _LT_TAGVAR(archive_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
-        _LT_TAGVAR(archive_expsym_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+        if test "$cross_compiling" = yes; then
+          _LT_TAGVAR(archive_cmds, $1)='$CC $pic_flag $compiler_flags -shared $libobjs $deplibs ${wl}-soname $wl$soname -o $lib'
+          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC $pic_flag $compiler_flags -shared $libobjs $deplibs ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+        else
+          _LT_TAGVAR(archive_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
+          _LT_TAGVAR(archive_expsym_cmds, $1)='$CC $pic_flag -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+        fi
 
         _LT_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
         _LT_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
@@ -7036,23 +7022,27 @@ if AC_TRY_EVAL(ac_compile); then
        if test "$pre_test_object_deps_done" = no; then
 	 case ${prev} in
 	 -L | -R)
-	   # Internal compiler library paths should come after those
-	   # provided the user.  The postdeps already come after the
-	   # user supplied libs so there is no need to process them.
-	   if test -z "$_LT_TAGVAR(compiler_lib_search_path, $1)"; then
-	     _LT_TAGVAR(compiler_lib_search_path, $1)="${prev}${p}"
-	   else
-	     _LT_TAGVAR(compiler_lib_search_path, $1)="${_LT_TAGVAR(compiler_lib_search_path, $1)} ${prev}${p}"
+	   if test "$cross_compiling" != yes; then
+	     # Internal compiler library paths should come after those
+	     # provided the user.  The postdeps already come after the
+	     # user supplied libs so there is no need to process them.
+	     if test -z "$_LT_TAGVAR(compiler_lib_search_path, $1)"; then
+	       _LT_TAGVAR(compiler_lib_search_path, $1)="${prev}${p}"
+	     else
+	       _LT_TAGVAR(compiler_lib_search_path, $1)="${_LT_TAGVAR(compiler_lib_search_path, $1)} ${prev}${p}"
+	     fi
 	   fi
 	   ;;
 	 # The "-l" case would never come before the object being
 	 # linked, so don't bother handling this case.
 	 esac
        else
-	 if test -z "$_LT_TAGVAR(postdeps, $1)"; then
-	   _LT_TAGVAR(postdeps, $1)="${prev}${p}"
-	 else
-	   _LT_TAGVAR(postdeps, $1)="${_LT_TAGVAR(postdeps, $1)} ${prev}${p}"
+	 if test "$cross_compiling" != yes; then
+	   if test -z "$_LT_TAGVAR(postdeps, $1)"; then
+	     _LT_TAGVAR(postdeps, $1)="${prev}${p}"
+	   else
+	     _LT_TAGVAR(postdeps, $1)="${_LT_TAGVAR(postdeps, $1)} ${prev}${p}"
+	   fi
 	 fi
        fi
        prev=
@@ -7067,17 +7057,19 @@ if AC_TRY_EVAL(ac_compile); then
 	 continue
        fi
 
-       if test "$pre_test_object_deps_done" = no; then
-	 if test -z "$_LT_TAGVAR(predep_objects, $1)"; then
-	   _LT_TAGVAR(predep_objects, $1)="$p"
-	 else
-	   _LT_TAGVAR(predep_objects, $1)="$_LT_TAGVAR(predep_objects, $1) $p"
-	 fi
-       else
-	 if test -z "$_LT_TAGVAR(postdep_objects, $1)"; then
-	   _LT_TAGVAR(postdep_objects, $1)="$p"
+       if test "$cross_compiling" != yes; then
+	 if test "$pre_test_object_deps_done" = no; then
+	   if test -z "$_LT_TAGVAR(predep_objects, $1)"; then
+	     _LT_TAGVAR(predep_objects, $1)="$p"
+	   else
+	     _LT_TAGVAR(predep_objects, $1)="$_LT_TAGVAR(predep_objects, $1) $p"
+	   fi
 	 else
-	   _LT_TAGVAR(postdep_objects, $1)="$_LT_TAGVAR(postdep_objects, $1) $p"
+	   if test -z "$_LT_TAGVAR(postdep_objects, $1)"; then
+	     _LT_TAGVAR(postdep_objects, $1)="$p"
+	   else
+	     _LT_TAGVAR(postdep_objects, $1)="$_LT_TAGVAR(postdep_objects, $1) $p"
+	   fi
 	 fi
        fi
        ;;
diff --git a/m4/lock.m4 b/m4/lock.m4
new file mode 100644
index 0000000..9111933
--- /dev/null
+++ b/m4/lock.m4
@@ -0,0 +1,316 @@
+# lock.m4 serial 7 (gettext-0.17)
+dnl Copyright (C) 2005-2007 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+
+dnl Tests for a multithreading library to be used.
+dnl Defines at most one of the macros USE_POSIX_THREADS, USE_SOLARIS_THREADS,
+dnl USE_PTH_THREADS, USE_WIN32_THREADS
+dnl Sets the variables LIBTHREAD and LTLIBTHREAD to the linker options for use
+dnl in a Makefile (LIBTHREAD for use without libtool, LTLIBTHREAD for use with
+dnl libtool).
+dnl Sets the variables LIBMULTITHREAD and LTLIBMULTITHREAD similarly, for
+dnl programs that really need multithread functionality. The difference
+dnl between LIBTHREAD and LIBMULTITHREAD is that on platforms supporting weak
+dnl symbols, typically LIBTHREAD="" whereas LIBMULTITHREAD="-lpthread".
+dnl Adds to CPPFLAGS the flag -D_REENTRANT or -D_THREAD_SAFE if needed for
+dnl multithread-safe programs.
+
+AC_DEFUN([gl_LOCK_EARLY],
+[
+  AC_REQUIRE([gl_LOCK_EARLY_BODY])
+])
+
+dnl The guts of gl_LOCK_EARLY. Needs to be expanded only once.
+
+AC_DEFUN([gl_LOCK_EARLY_BODY],
+[
+  dnl Ordering constraints: This macro modifies CPPFLAGS in a way that
+  dnl influences the result of the autoconf tests that test for *_unlocked
+  dnl declarations, on AIX 5 at least. Therefore it must come early.
+  AC_BEFORE([$0], [gl_FUNC_GLIBC_UNLOCKED_IO])dnl
+  AC_BEFORE([$0], [gl_ARGP])dnl
+
+  AC_REQUIRE([AC_CANONICAL_HOST])
+  dnl _GNU_SOURCE is needed for pthread_rwlock_t on glibc systems.
+  dnl AC_USE_SYSTEM_EXTENSIONS was introduced in autoconf 2.60 and obsoletes
+  dnl AC_GNU_SOURCE.
+  m4_ifdef([AC_USE_SYSTEM_EXTENSIONS],
+    [AC_REQUIRE([AC_USE_SYSTEM_EXTENSIONS])],
+    [AC_REQUIRE([AC_GNU_SOURCE])])
+  dnl Check for multithreading.
+  AC_ARG_ENABLE(threads,
+AC_HELP_STRING([--enable-threads={posix|solaris|pth|win32}], [specify multithreading API])
+AC_HELP_STRING([--disable-threads], [build without multithread safety]),
+    [gl_use_threads=$enableval],
+    [case "$host_os" in
+       dnl Disable multithreading by default on OSF/1, because it interferes
+       dnl with fork()/exec(): When msgexec is linked with -lpthread, its child
+       dnl process gets an endless segmentation fault inside execvp().
+       osf*) gl_use_threads=no ;;
+       *)    gl_use_threads=yes ;;
+     esac
+    ])
+  if test "$gl_use_threads" = yes || test "$gl_use_threads" = posix; then
+    # For using <pthread.h>:
+    case "$host_os" in
+      osf*)
+        # On OSF/1, the compiler needs the flag -D_REENTRANT so that it
+        # groks <pthread.h>. cc also understands the flag -pthread, but
+        # we don't use it because 1. gcc-2.95 doesn't understand -pthread,
+        # 2. putting a flag into CPPFLAGS that has an effect on the linker
+        # causes the AC_TRY_LINK test below to succeed unexpectedly,
+        # leading to wrong values of LIBTHREAD and LTLIBTHREAD.
+        CPPFLAGS="$CPPFLAGS -D_REENTRANT"
+        ;;
+    esac
+    # Some systems optimize for single-threaded programs by default, and
+    # need special flags to disable these optimizations. For example, the
+    # definition of 'errno' in <errno.h>.
+    case "$host_os" in
+      aix* | freebsd*) CPPFLAGS="$CPPFLAGS -D_THREAD_SAFE" ;;
+      solaris*) CPPFLAGS="$CPPFLAGS -D_REENTRANT" ;;
+    esac
+  fi
+])
+
+dnl The guts of gl_LOCK. Needs to be expanded only once.
+
+AC_DEFUN([gl_LOCK_BODY],
+[
+  AC_REQUIRE([gl_LOCK_EARLY_BODY])
+  gl_threads_api=none
+  LIBTHREAD=
+  LTLIBTHREAD=
+  LIBMULTITHREAD=
+  LTLIBMULTITHREAD=
+  if test "$gl_use_threads" != no; then
+    dnl Check whether the compiler and linker support weak declarations.
+    AC_MSG_CHECKING([whether imported symbols can be declared weak])
+    gl_have_weak=no
+    AC_TRY_LINK([extern void xyzzy ();
+#pragma weak xyzzy], [xyzzy();], [gl_have_weak=yes])
+    AC_MSG_RESULT([$gl_have_weak])
+    if test "$gl_use_threads" = yes || test "$gl_use_threads" = posix; then
+      # On OSF/1, the compiler needs the flag -pthread or -D_REENTRANT so that
+      # it groks <pthread.h>. It's added above, in gl_LOCK_EARLY_BODY.
+      AC_CHECK_HEADER(pthread.h, gl_have_pthread_h=yes, gl_have_pthread_h=no)
+      if test "$gl_have_pthread_h" = yes; then
+        # Other possible tests:
+        #   -lpthreads (FSU threads, PCthreads)
+        #   -lgthreads
+        gl_have_pthread=
+        # Test whether both pthread_mutex_lock and pthread_mutexattr_init exist
+        # in libc. IRIX 6.5 has the first one in both libc and libpthread, but
+        # the second one only in libpthread, and lock.c needs it.
+        AC_TRY_LINK([#include <pthread.h>],
+          [pthread_mutex_lock((pthread_mutex_t*)0);
+           pthread_mutexattr_init((pthread_mutexattr_t*)0);],
+          [gl_have_pthread=yes])
+        # Test for libpthread by looking for pthread_kill. (Not pthread_self,
+        # since it is defined as a macro on OSF/1.)
+        if test -n "$gl_have_pthread"; then
+          # The program links fine without libpthread. But it may actually
+          # need to link with libpthread in order to create multiple threads.
+          AC_CHECK_LIB(pthread, pthread_kill,
+            [LIBMULTITHREAD=-lpthread LTLIBMULTITHREAD=-lpthread
+             # On Solaris and HP-UX, most pthread functions exist also in libc.
+             # Therefore pthread_in_use() needs to actually try to create a
+             # thread: pthread_create from libc will fail, whereas
+             # pthread_create will actually create a thread.
+             case "$host_os" in
+               solaris* | hpux*)
+                 AC_DEFINE([PTHREAD_IN_USE_DETECTION_HARD], 1,
+                   [Define if the pthread_in_use() detection is hard.])
+             esac
+            ])
+        else
+          # Some library is needed. Try libpthread and libc_r.
+          AC_CHECK_LIB(pthread, pthread_kill,
+            [gl_have_pthread=yes
+             LIBTHREAD=-lpthread LTLIBTHREAD=-lpthread
+             LIBMULTITHREAD=-lpthread LTLIBMULTITHREAD=-lpthread])
+          if test -z "$gl_have_pthread"; then
+            # For FreeBSD 4.
+            AC_CHECK_LIB(c_r, pthread_kill,
+              [gl_have_pthread=yes
+               LIBTHREAD=-lc_r LTLIBTHREAD=-lc_r
+               LIBMULTITHREAD=-lc_r LTLIBMULTITHREAD=-lc_r])
+          fi
+        fi
+        if test -n "$gl_have_pthread"; then
+          gl_threads_api=posix
+          AC_DEFINE([USE_POSIX_THREADS], 1,
+            [Define if the POSIX multithreading library can be used.])
+          if test -n "$LIBMULTITHREAD" || test -n "$LTLIBMULTITHREAD"; then
+            if test $gl_have_weak = yes; then
+              AC_DEFINE([USE_POSIX_THREADS_WEAK], 1,
+                [Define if references to the POSIX multithreading library should be made weak.])
+              LIBTHREAD=
+              LTLIBTHREAD=
+            fi
+          fi
+          # OSF/1 4.0 and MacOS X 10.1 lack the pthread_rwlock_t type and the
+          # pthread_rwlock_* functions.
+          AC_CHECK_TYPE([pthread_rwlock_t],
+            [AC_DEFINE([HAVE_PTHREAD_RWLOCK], 1,
+               [Define if the POSIX multithreading library has read/write locks.])],
+            [],
+            [#include <pthread.h>])
+          # glibc defines PTHREAD_MUTEX_RECURSIVE as enum, not as a macro.
+          AC_TRY_COMPILE([#include <pthread.h>],
+            [#if __FreeBSD__ == 4
+error "No, in FreeBSD 4.0 recursive mutexes actually don't work."
+#else
+int x = (int)PTHREAD_MUTEX_RECURSIVE;
+return !x;
+#endif],
+            [AC_DEFINE([HAVE_PTHREAD_MUTEX_RECURSIVE], 1,
+               [Define if the <pthread.h> defines PTHREAD_MUTEX_RECURSIVE.])])
+        fi
+      fi
+    fi
+    if test -z "$gl_have_pthread"; then
+      if test "$gl_use_threads" = yes || test "$gl_use_threads" = solaris; then
+        gl_have_solaristhread=
+        gl_save_LIBS="$LIBS"
+        LIBS="$LIBS -lthread"
+        AC_TRY_LINK([#include <thread.h>
+#include <synch.h>],
+          [thr_self();],
+          [gl_have_solaristhread=yes])
+        LIBS="$gl_save_LIBS"
+        if test -n "$gl_have_solaristhread"; then
+          gl_threads_api=solaris
+          LIBTHREAD=-lthread
+          LTLIBTHREAD=-lthread
+          LIBMULTITHREAD="$LIBTHREAD"
+          LTLIBMULTITHREAD="$LTLIBTHREAD"
+          AC_DEFINE([USE_SOLARIS_THREADS], 1,
+            [Define if the old Solaris multithreading library can be used.])
+          if test $gl_have_weak = yes; then
+            AC_DEFINE([USE_SOLARIS_THREADS_WEAK], 1,
+              [Define if references to the old Solaris multithreading library should be made weak.])
+            LIBTHREAD=
+            LTLIBTHREAD=
+          fi
+        fi
+      fi
+    fi
+    if test "$gl_use_threads" = pth; then
+      gl_save_CPPFLAGS="$CPPFLAGS"
+      AC_LIB_LINKFLAGS(pth)
+      gl_have_pth=
+      gl_save_LIBS="$LIBS"
+      LIBS="$LIBS -lpth"
+      AC_TRY_LINK([#include <pth.h>], [pth_self();], gl_have_pth=yes)
+      LIBS="$gl_save_LIBS"
+      if test -n "$gl_have_pth"; then
+        gl_threads_api=pth
+        LIBTHREAD="$LIBPTH"
+        LTLIBTHREAD="$LTLIBPTH"
+        LIBMULTITHREAD="$LIBTHREAD"
+        LTLIBMULTITHREAD="$LTLIBTHREAD"
+        AC_DEFINE([USE_PTH_THREADS], 1,
+          [Define if the GNU Pth multithreading library can be used.])
+        if test -n "$LIBMULTITHREAD" || test -n "$LTLIBMULTITHREAD"; then
+          if test $gl_have_weak = yes; then
+            AC_DEFINE([USE_PTH_THREADS_WEAK], 1,
+              [Define if references to the GNU Pth multithreading library should be made weak.])
+            LIBTHREAD=
+            LTLIBTHREAD=
+          fi
+        fi
+      else
+        CPPFLAGS="$gl_save_CPPFLAGS"
+      fi
+    fi
+    if test -z "$gl_have_pthread"; then
+      if test "$gl_use_threads" = yes || test "$gl_use_threads" = win32; then
+        if { case "$host_os" in
+               mingw*) true;;
+               *) false;;
+             esac
+           }; then
+          gl_threads_api=win32
+          AC_DEFINE([USE_WIN32_THREADS], 1,
+            [Define if the Win32 multithreading API can be used.])
+        fi
+      fi
+    fi
+  fi
+  AC_MSG_CHECKING([for multithread API to use])
+  AC_MSG_RESULT([$gl_threads_api])
+  AC_SUBST(LIBTHREAD)
+  AC_SUBST(LTLIBTHREAD)
+  AC_SUBST(LIBMULTITHREAD)
+  AC_SUBST(LTLIBMULTITHREAD)
+])
+
+AC_DEFUN([gl_LOCK],
+[
+  AC_REQUIRE([gl_LOCK_EARLY])
+  AC_REQUIRE([gl_LOCK_BODY])
+  gl_PREREQ_LOCK
+])
+
+# Prerequisites of lib/lock.c.
+AC_DEFUN([gl_PREREQ_LOCK], [
+  AC_REQUIRE([AC_C_INLINE])
+])
+
+dnl Survey of platforms:
+dnl
+dnl Platform          Available   Compiler    Supports   test-lock
+dnl                   flavours    option      weak       result
+dnl ---------------   ---------   ---------   --------   ---------
+dnl Linux 2.4/glibc   posix       -lpthread       Y      OK
+dnl
+dnl GNU Hurd/glibc    posix
+dnl
+dnl FreeBSD 5.3       posix       -lc_r           Y
+dnl                   posix       -lkse ?         Y
+dnl                   posix       -lpthread ?     Y
+dnl                   posix       -lthr           Y
+dnl
+dnl FreeBSD 5.2       posix       -lc_r           Y
+dnl                   posix       -lkse           Y
+dnl                   posix       -lthr           Y
+dnl
+dnl FreeBSD 4.0,4.10  posix       -lc_r           Y      OK
+dnl
+dnl NetBSD 1.6        --
+dnl
+dnl OpenBSD 3.4       posix       -lpthread       Y      OK
+dnl
+dnl MacOS X 10.[123]  posix       -lpthread       Y      OK
+dnl
+dnl Solaris 7,8,9     posix       -lpthread       Y      Sol 7,8: 0.0; Sol 9: OK
+dnl                   solaris     -lthread        Y      Sol 7,8: 0.0; Sol 9: OK
+dnl
+dnl HP-UX 11          posix       -lpthread       N (cc) OK
+dnl                                               Y (gcc)
+dnl
+dnl IRIX 6.5          posix       -lpthread       Y      0.5
+dnl
+dnl AIX 4.3,5.1       posix       -lpthread       N      AIX 4: 0.5; AIX 5: OK
+dnl
+dnl OSF/1 4.0,5.1     posix       -pthread (cc)   N      OK
+dnl                               -lpthread (gcc) Y
+dnl
+dnl Cygwin            posix       -lpthread       Y      OK
+dnl
+dnl Any of the above  pth         -lpth                  0.0
+dnl
+dnl Mingw             win32                       N      OK
+dnl
+dnl BeOS 5            --
+dnl
+dnl The test-lock result shows what happens if in test-lock.c EXPLICIT_YIELD is
+dnl turned off:
+dnl   OK if all three tests terminate OK,
+dnl   0.5 if the first test terminates OK but the second one loops endlessly,
+dnl   0.0 if the first test already loops endlessly.
diff --git a/m4/longlong.m4 b/m4/longlong.m4
new file mode 100644
index 0000000..a72e53b
--- /dev/null
+++ b/m4/longlong.m4
@@ -0,0 +1,109 @@
+# longlong.m4 serial 13
+dnl Copyright (C) 1999-2007 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Paul Eggert.
+
+# Define HAVE_LONG_LONG_INT if 'long long int' works.
+# This fixes a bug in Autoconf 2.61, but can be removed once we
+# assume 2.62 everywhere.
+
+# Note: If the type 'long long int' exists but is only 32 bits large
+# (as on some very old compilers), HAVE_LONG_LONG_INT will not be
+# defined. In this case you can treat 'long long int' like 'long int'.
+
+AC_DEFUN([AC_TYPE_LONG_LONG_INT],
+[
+  AC_CACHE_CHECK([for long long int], [ac_cv_type_long_long_int],
+    [AC_LINK_IFELSE(
+       [_AC_TYPE_LONG_LONG_SNIPPET],
+       [dnl This catches a bug in Tandem NonStop Kernel (OSS) cc -O circa 2004.
+	dnl If cross compiling, assume the bug isn't important, since
+	dnl nobody cross compiles for this platform as far as we know.
+	AC_RUN_IFELSE(
+	  [AC_LANG_PROGRAM(
+	     [[@%:@include <limits.h>
+	       @%:@ifndef LLONG_MAX
+	       @%:@ define HALF \
+			(1LL << (sizeof (long long int) * CHAR_BIT - 2))
+	       @%:@ define LLONG_MAX (HALF - 1 + HALF)
+	       @%:@endif]],
+	     [[long long int n = 1;
+	       int i;
+	       for (i = 0; ; i++)
+		 {
+		   long long int m = n << i;
+		   if (m >> i != n)
+		     return 1;
+		   if (LLONG_MAX / 2 < m)
+		     break;
+		 }
+	       return 0;]])],
+	  [ac_cv_type_long_long_int=yes],
+	  [ac_cv_type_long_long_int=no],
+	  [ac_cv_type_long_long_int=yes])],
+       [ac_cv_type_long_long_int=no])])
+  if test $ac_cv_type_long_long_int = yes; then
+    AC_DEFINE([HAVE_LONG_LONG_INT], 1,
+      [Define to 1 if the system has the type `long long int'.])
+  fi
+])
+
+# Define HAVE_UNSIGNED_LONG_LONG_INT if 'unsigned long long int' works.
+# This fixes a bug in Autoconf 2.61, but can be removed once we
+# assume 2.62 everywhere.
+
+# Note: If the type 'unsigned long long int' exists but is only 32 bits
+# large (as on some very old compilers), AC_TYPE_UNSIGNED_LONG_LONG_INT
+# will not be defined. In this case you can treat 'unsigned long long int'
+# like 'unsigned long int'.
+
+AC_DEFUN([AC_TYPE_UNSIGNED_LONG_LONG_INT],
+[
+  AC_CACHE_CHECK([for unsigned long long int],
+    [ac_cv_type_unsigned_long_long_int],
+    [AC_LINK_IFELSE(
+       [_AC_TYPE_LONG_LONG_SNIPPET],
+       [ac_cv_type_unsigned_long_long_int=yes],
+       [ac_cv_type_unsigned_long_long_int=no])])
+  if test $ac_cv_type_unsigned_long_long_int = yes; then
+    AC_DEFINE([HAVE_UNSIGNED_LONG_LONG_INT], 1,
+      [Define to 1 if the system has the type `unsigned long long int'.])
+  fi
+])
+
+# Expands to a C program that can be used to test for simultaneous support
+# of 'long long' and 'unsigned long long'. We don't want to say that
+# 'long long' is available if 'unsigned long long' is not, or vice versa,
+# because too many programs rely on the symmetry between signed and unsigned
+# integer types (excluding 'bool').
+AC_DEFUN([_AC_TYPE_LONG_LONG_SNIPPET],
+[
+  AC_LANG_PROGRAM(
+    [[/* Test preprocessor.  */
+      #if ! (-9223372036854775807LL < 0 && 0 < 9223372036854775807ll)
+        error in preprocessor;
+      #endif
+      #if ! (18446744073709551615ULL <= -1ull)
+        error in preprocessor;
+      #endif
+      /* Test literals.  */
+      long long int ll = 9223372036854775807ll;
+      long long int nll = -9223372036854775807LL;
+      unsigned long long int ull = 18446744073709551615ULL;
+      /* Test constant expressions.   */
+      typedef int a[((-9223372036854775807LL < 0 && 0 < 9223372036854775807ll)
+		     ? 1 : -1)];
+      typedef int b[(18446744073709551615ULL <= (unsigned long long int) -1
+		     ? 1 : -1)];
+      int i = 63;]],
+    [[/* Test availability of runtime routines for shift and division.  */
+      long long int llmax = 9223372036854775807ll;
+      unsigned long long int ullmax = 18446744073709551615ull;
+      return ((ll << 63) | (ll >> 63) | (ll < i) | (ll > i)
+	      | (llmax / ll) | (llmax % ll)
+	      | (ull << 63) | (ull >> 63) | (ull << i) | (ull >> i)
+	      | (ullmax / ull) | (ullmax % ull));]])
+])
diff --git a/m4/printf-posix.m4 b/m4/printf-posix.m4
new file mode 100644
index 0000000..14ba612
--- /dev/null
+++ b/m4/printf-posix.m4
@@ -0,0 +1,44 @@
+# printf-posix.m4 serial 3 (gettext-0.17)
+dnl Copyright (C) 2003, 2007 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+dnl Test whether the printf() function supports POSIX/XSI format strings with
+dnl positions.
+
+AC_DEFUN([gt_PRINTF_POSIX],
+[
+  AC_REQUIRE([AC_PROG_CC])
+  AC_CACHE_CHECK([whether printf() supports POSIX/XSI format strings],
+    gt_cv_func_printf_posix,
+    [
+      AC_TRY_RUN([
+#include <stdio.h>
+#include <string.h>
+/* The string "%2$d %1$d", with dollar characters protected from the shell's
+   dollar expansion (possibly an autoconf bug).  */
+static char format[] = { '%', '2', '$', 'd', ' ', '%', '1', '$', 'd', '\0' };
+static char buf[100];
+int main ()
+{
+  sprintf (buf, format, 33, 55);
+  return (strcmp (buf, "55 33") != 0);
+}], gt_cv_func_printf_posix=yes, gt_cv_func_printf_posix=no,
+      [
+        AC_EGREP_CPP(notposix, [
+#if defined __NetBSD__ || defined __BEOS__ || defined _MSC_VER || defined __MINGW32__ || defined __CYGWIN__
+  notposix
+#endif
+        ], gt_cv_func_printf_posix="guessing no",
+           gt_cv_func_printf_posix="guessing yes")
+      ])
+    ])
+  case $gt_cv_func_printf_posix in
+    *yes)
+      AC_DEFINE(HAVE_POSIX_PRINTF, 1,
+        [Define if your printf() function supports format strings with positions.])
+      ;;
+  esac
+])
diff --git a/m4/size_max.m4 b/m4/size_max.m4
new file mode 100644
index 0000000..6cb4868
--- /dev/null
+++ b/m4/size_max.m4
@@ -0,0 +1,68 @@
+# size_max.m4 serial 6
+dnl Copyright (C) 2003, 2005-2006 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+
+AC_DEFUN([gl_SIZE_MAX],
+[
+  AC_CHECK_HEADERS(stdint.h)
+  dnl First test whether the system already has SIZE_MAX.
+  AC_MSG_CHECKING([for SIZE_MAX])
+  AC_CACHE_VAL([gl_cv_size_max], [
+    gl_cv_size_max=
+    AC_EGREP_CPP([Found it], [
+#include <limits.h>
+#if HAVE_STDINT_H
+#include <stdint.h>
+#endif
+#ifdef SIZE_MAX
+Found it
+#endif
+], gl_cv_size_max=yes)
+    if test -z "$gl_cv_size_max"; then
+      dnl Define it ourselves. Here we assume that the type 'size_t' is not wider
+      dnl than the type 'unsigned long'. Try hard to find a definition that can
+      dnl be used in a preprocessor #if, i.e. doesn't contain a cast.
+      AC_COMPUTE_INT([size_t_bits_minus_1], [sizeof (size_t) * CHAR_BIT - 1],
+        [#include <stddef.h>
+#include <limits.h>], size_t_bits_minus_1=)
+      AC_COMPUTE_INT([fits_in_uint], [sizeof (size_t) <= sizeof (unsigned int)],
+        [#include <stddef.h>], fits_in_uint=)
+      if test -n "$size_t_bits_minus_1" && test -n "$fits_in_uint"; then
+        if test $fits_in_uint = 1; then
+          dnl Even though SIZE_MAX fits in an unsigned int, it must be of type
+          dnl 'unsigned long' if the type 'size_t' is the same as 'unsigned long'.
+          AC_TRY_COMPILE([#include <stddef.h>
+            extern size_t foo;
+            extern unsigned long foo;
+            ], [], fits_in_uint=0)
+        fi
+        dnl We cannot use 'expr' to simplify this expression, because 'expr'
+        dnl works only with 'long' integers in the host environment, while we
+        dnl might be cross-compiling from a 32-bit platform to a 64-bit platform.
+        if test $fits_in_uint = 1; then
+          gl_cv_size_max="(((1U << $size_t_bits_minus_1) - 1) * 2 + 1)"
+        else
+          gl_cv_size_max="(((1UL << $size_t_bits_minus_1) - 1) * 2 + 1)"
+        fi
+      else
+        dnl Shouldn't happen, but who knows...
+        gl_cv_size_max='((size_t)~(size_t)0)'
+      fi
+    fi
+  ])
+  AC_MSG_RESULT([$gl_cv_size_max])
+  if test "$gl_cv_size_max" != yes; then
+    AC_DEFINE_UNQUOTED([SIZE_MAX], [$gl_cv_size_max],
+      [Define as the maximum value of type 'size_t', if the system doesn't define it.])
+  fi
+])
+
+dnl Autoconf >= 2.61 has AC_COMPUTE_INT built-in.
+dnl Remove this when we can assume autoconf >= 2.61.
+m4_ifdef([AC_COMPUTE_INT], [], [
+  AC_DEFUN([AC_COMPUTE_INT], [_AC_COMPUTE_INT([$2],[$1],[$3],[$4])])
+])
diff --git a/m4/visibility.m4 b/m4/visibility.m4
new file mode 100644
index 0000000..2ff6330
--- /dev/null
+++ b/m4/visibility.m4
@@ -0,0 +1,52 @@
+# visibility.m4 serial 1 (gettext-0.15)
+dnl Copyright (C) 2005 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+
+dnl Tests whether the compiler supports the command-line option
+dnl -fvisibility=hidden and the function and variable attributes
+dnl __attribute__((__visibility__("hidden"))) and
+dnl __attribute__((__visibility__("default"))).
+dnl Does *not* test for __visibility__("protected") - which has tricky
+dnl semantics (see the 'vismain' test in glibc) and does not exist e.g. on
+dnl MacOS X.
+dnl Does *not* test for __visibility__("internal") - which has processor
+dnl dependent semantics.
+dnl Does *not* test for #pragma GCC visibility push(hidden) - which is
+dnl "really only recommended for legacy code".
+dnl Set the variable CFLAG_VISIBILITY.
+dnl Defines and sets the variable HAVE_VISIBILITY.
+
+AC_DEFUN([gl_VISIBILITY],
+[
+  AC_REQUIRE([AC_PROG_CC])
+  CFLAG_VISIBILITY=
+  HAVE_VISIBILITY=0
+  if test -n "$GCC"; then
+    AC_MSG_CHECKING([for simple visibility declarations])
+    AC_CACHE_VAL(gl_cv_cc_visibility, [
+      gl_save_CFLAGS="$CFLAGS"
+      CFLAGS="$CFLAGS -fvisibility=hidden"
+      AC_TRY_COMPILE(
+        [extern __attribute__((__visibility__("hidden"))) int hiddenvar;
+         extern __attribute__((__visibility__("default"))) int exportedvar;
+         extern __attribute__((__visibility__("hidden"))) int hiddenfunc (void);
+         extern __attribute__((__visibility__("default"))) int exportedfunc (void);],
+        [],
+        gl_cv_cc_visibility=yes,
+        gl_cv_cc_visibility=no)
+      CFLAGS="$gl_save_CFLAGS"])
+    AC_MSG_RESULT([$gl_cv_cc_visibility])
+    if test $gl_cv_cc_visibility = yes; then
+      CFLAG_VISIBILITY="-fvisibility=hidden"
+      HAVE_VISIBILITY=1
+    fi
+  fi
+  AC_SUBST([CFLAG_VISIBILITY])
+  AC_SUBST([HAVE_VISIBILITY])
+  AC_DEFINE_UNQUOTED([HAVE_VISIBILITY], [$HAVE_VISIBILITY],
+    [Define to 1 or 0, depending whether the compiler supports simple visibility declarations.])
+])
diff --git a/m4/wchar_t.m4 b/m4/wchar_t.m4
new file mode 100644
index 0000000..cde2129
--- /dev/null
+++ b/m4/wchar_t.m4
@@ -0,0 +1,20 @@
+# wchar_t.m4 serial 1 (gettext-0.12)
+dnl Copyright (C) 2002-2003 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+dnl Test whether <stddef.h> has the 'wchar_t' type.
+dnl Prerequisite: AC_PROG_CC
+
+AC_DEFUN([gt_TYPE_WCHAR_T],
+[
+  AC_CACHE_CHECK([for wchar_t], gt_cv_c_wchar_t,
+    [AC_TRY_COMPILE([#include <stddef.h>
+       wchar_t foo = (wchar_t)'\0';], ,
+       gt_cv_c_wchar_t=yes, gt_cv_c_wchar_t=no)])
+  if test $gt_cv_c_wchar_t = yes; then
+    AC_DEFINE(HAVE_WCHAR_T, 1, [Define if you have the 'wchar_t' type.])
+  fi
+])
diff --git a/m4/wint_t.m4 b/m4/wint_t.m4
new file mode 100644
index 0000000..af5ed93
--- /dev/null
+++ b/m4/wint_t.m4
@@ -0,0 +1,28 @@
+# wint_t.m4 serial 2 (gettext-0.17)
+dnl Copyright (C) 2003, 2007 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+dnl From Bruno Haible.
+dnl Test whether <wchar.h> has the 'wint_t' type.
+dnl Prerequisite: AC_PROG_CC
+
+AC_DEFUN([gt_TYPE_WINT_T],
+[
+  AC_CACHE_CHECK([for wint_t], gt_cv_c_wint_t,
+    [AC_TRY_COMPILE([
+/* Tru64 with Desktop Toolkit C has a bug: <stdio.h> must be included before
+   <wchar.h>.
+   BSD/OS 4.0.1 has a bug: <stddef.h>, <stdio.h> and <time.h> must be included
+   before <wchar.h>.  */
+#include <stddef.h>
+#include <stdio.h>
+#include <time.h>
+#include <wchar.h>
+       wint_t foo = (wchar_t)'\0';], ,
+       gt_cv_c_wint_t=yes, gt_cv_c_wint_t=no)])
+  if test $gt_cv_c_wint_t = yes; then
+    AC_DEFINE(HAVE_WINT_T, 1, [Define if you have the 'wint_t' type.])
+  fi
+])
diff --git a/m4/xsize.m4 b/m4/xsize.m4
new file mode 100644
index 0000000..85bb721
--- /dev/null
+++ b/m4/xsize.m4
@@ -0,0 +1,13 @@
+# xsize.m4 serial 3
+dnl Copyright (C) 2003-2004 Free Software Foundation, Inc.
+dnl This file is free software; the Free Software Foundation
+dnl gives unlimited permission to copy and/or distribute it,
+dnl with or without modifications, as long as this notice is preserved.
+
+AC_DEFUN([gl_XSIZE],
+[
+  dnl Prerequisites of lib/xsize.h.
+  AC_REQUIRE([gl_SIZE_MAX])
+  AC_REQUIRE([AC_C_INLINE])
+  AC_CHECK_HEADERS(stdint.h)
+])
diff --git a/pkgconfig/Makefile.in b/pkgconfig/Makefile.in
index de45038..54b99c1 100644
--- a/pkgconfig/Makefile.in
+++ b/pkgconfig/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,6 +50,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = pkgconfig
 DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
 	$(srcdir)/gstreamer-app-uninstalled.pc.in \
@@ -124,14 +141,25 @@ CONFIG_CLEAN_FILES = gstreamer-audio.pc gstreamer-audio-uninstalled.pc \
 	gstreamer-video-uninstalled.pc gstreamer-plugins-base.pc \
 	gstreamer-plugins-base-uninstalled.pc
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
 am__vpath_adj = case $$p in \
     $(srcdir)/*) f=`echo "$$p" | sed "s|^$$srcdirstrip/||"`;; \
@@ -450,7 +478,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -616,8 +648,11 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-pkgconfigDATA: $(pkgconfig_DATA)
 	@$(NORMAL_INSTALL)
-	test -z "$(pkgconfigdir)" || $(MKDIR_P) "$(DESTDIR)$(pkgconfigdir)"
 	@list='$(pkgconfig_DATA)'; test -n "$(pkgconfigdir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(pkgconfigdir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(pkgconfigdir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; \
@@ -638,6 +673,8 @@ TAGS:
 ctags: CTAGS
 CTAGS:
 
+cscope cscopelist:
+
 
 distdir: $(DISTFILES)
 	@srcdirstrip=`echo "$(srcdir)" | sed 's/[].[^$$\\*]/\\\\&/g'`; \
diff --git a/po/Makevars.template b/po/Makevars.template
new file mode 100644
index 0000000..32692ab
--- /dev/null
+++ b/po/Makevars.template
@@ -0,0 +1,41 @@
+# Makefile variables for PO directory in any package using GNU gettext.
+
+# Usually the message domain is the same as the package name.
+DOMAIN = $(PACKAGE)
+
+# These two variables depend on the location of this directory.
+subdir = po
+top_builddir = ..
+
+# These options get passed to xgettext.
+XGETTEXT_OPTIONS = --keyword=_ --keyword=N_
+
+# This is the copyright holder that gets inserted into the header of the
+# $(DOMAIN).pot file.  Set this to the copyright holder of the surrounding
+# package.  (Note that the msgstr strings, extracted from the package's
+# sources, belong to the copyright holder of the package.)  Translators are
+# expected to transfer the copyright for their translations to this person
+# or entity, or to disclaim their copyright.  The empty string stands for
+# the public domain; in this case the translators are expected to disclaim
+# their copyright.
+COPYRIGHT_HOLDER = Free Software Foundation, Inc.
+
+# This is the email address or URL to which the translators shall report
+# bugs in the untranslated strings:
+# - Strings which are not entire sentences, see the maintainer guidelines
+#   in the GNU gettext documentation, section 'Preparing Strings'.
+# - Strings which use unclear terms or require additional context to be
+#   understood.
+# - Strings which make invalid assumptions about notation of date, time or
+#   money.
+# - Pluralisation problems.
+# - Incorrect English spelling.
+# - Incorrect formatting.
+# It can be your email address, or a mailing list address where translators
+# can write to without being subscribed, or the URL of a web page through
+# which the translators can contact you.
+MSGID_BUGS_ADDRESS =
+
+# This is the list of locale categories, beyond LC_MESSAGES, for which the
+# message catalogs shall be used.  It is usually empty.
+EXTRA_LOCALE_CATEGORIES =
diff --git a/po/af.po b/po/af.po
index 796fc0a..d679ad2 100644
--- a/po/af.po
+++ b/po/af.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins 0.7.6\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2004-03-18 14:16+0200\n"
 "Last-Translator: Petri Jooste <rkwjpj@puk.ac.za>\n"
 "Language-Team: Afrikaans <i18n@af.org.za>\n"
diff --git a/po/az.po b/po/az.po
index d282bed..01902ff 100644
--- a/po/az.po
+++ b/po/az.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-0.8.0\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2004-03-19 18:29+0200\n"
 "Last-Translator: Metin Amiroff <metin@karegen.com>\n"
 "Language-Team: Azerbaijani <translation-team-az@lists.sourceforge.net>\n"
diff --git a/po/bg.po b/po/bg.po
index 3b77b33..0a2ceb2 100644
--- a/po/bg.po
+++ b/po/bg.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2011-04-26 22:31+0300\n"
 "Last-Translator: Alexander Shopov <ash@kambanaria.org>\n"
 "Language-Team: Bulgarian <dict@fsa-bg.org>\n"
diff --git a/po/ca.po b/po/ca.po
index a5817bc..fbcd690 100644
--- a/po/ca.po
+++ b/po/ca.po
@@ -2,22 +2,19 @@
 # Copyright © 2005, 2010 Free Software Foundation, Inc.
 # This file is put in the public domain.
 # Jordi Mallach <jordi@sindominio.net>, 2005, 2010.
-# Jordi Estrada <jordi.estrada@yamaha-motor.es>, 2011.
-# Gil Forcada <gforcada@gnome.org>, 2012.
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: gst-plugins-base 0.10.32.2\n"
+"Project-Id-Version: gst-plugins-base 0.10.30.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
-"PO-Revision-Date: 2012-01-01 14:19+0100\n"
-"Last-Translator: Gil Forcada <gforcada@gnome.org>\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
+"PO-Revision-Date: 2010-11-04 23:13+0100\n"
+"Last-Translator: Jordi Mallach <jordi@sindominio.net>\n"
 "Language-Team: Catalan <ca@dodds.net>\n"
 "Language: ca\n"
 "MIME-Version: 1.0\n"
 "Content-Type: text/plain; charset=UTF-8\n"
 "Content-Transfer-Encoding: 8bit\n"
-"Plural-Forms: nplurals=2; plural=n != 1;\n"
 
 msgid "Master"
 msgstr "Mestre"
@@ -26,7 +23,7 @@ msgid "Bass"
 msgstr "Baixos"
 
 msgid "Treble"
-msgstr "Aguts"
+msgstr "Treble"
 
 msgid "PCM"
 msgstr "PCM"
@@ -44,7 +41,7 @@ msgid "Microphone"
 msgstr "Micròfon"
 
 msgid "PC Speaker"
-msgstr "Altaveu del PC"
+msgstr "Altaveu PC"
 
 msgid "Playback"
 msgstr "Reproducció"
@@ -53,51 +50,48 @@ msgid "Capture"
 msgstr "Captura"
 
 msgid "Could not open device for playback in mono mode."
-msgstr "No s'ha pogut obrir el dispositiu per a la reproducció en mode mono."
+msgstr "No s'ha pogut obrir el dispositiu per a reproduir en mode mono."
 
 msgid "Could not open device for playback in stereo mode."
-msgstr ""
-"No s'ha pogut obrir el dispositiu per a la reproducció en mode estèreo."
+msgstr "No s'ha pogut obrir el dispositiu per a reproduir en mode estèreo."
 
 #, c-format
 msgid "Could not open device for playback in %d-channel mode."
-msgstr ""
-"No s'ha pogut obrir el dispositiu per a la reproducció en mode %d-canals."
+msgstr "No s'ha pogut obrir el dispositiu per a reproduir en mode %d-canals."
 
 msgid ""
 "Could not open audio device for playback. Device is being used by another "
 "application."
 msgstr ""
-"No s'ha pogut obrir el dispositiu d'àudio per a la reproducció. El "
-"dispositiu està en ús per una altra aplicació."
+"No s'ha pogut obrir el dispositiu d'àudio per a reproduir. El dispositiu "
+"està en ús per una altra aplicació."
 
 msgid "Could not open audio device for playback."
-msgstr "No s'ha pogut obrir el dispositiu d'àudio per a la reproducció."
+msgstr "No s'ha pogut obrir el dispositiu d'àudio per a reproduir."
 
 msgid "Could not open device for recording in mono mode."
-msgstr "No s'ha pogut obrir el dispositiu per a l'enregistrament en mode mono."
+msgstr "No s'ha pogut obrir el dispositiu per a enregistrar en mode mono."
 
 msgid "Could not open device for recording in stereo mode."
-msgstr ""
-"No s'ha pogut obrir el dispositiu per a l'enregistrament en mode estèreo."
+msgstr "No s'ha pogut obrir el dispositiu per a enregistrar en mode estèreo."
 
+# FIXME Trailing dot. jm
 #, c-format
 msgid "Could not open device for recording in %d-channel mode"
-msgstr ""
-"No s'ha pogut obrir el dispositiu per a l'enregistrament en mode %d-canals"
+msgstr "No s'ha pogut obrir el dispositiu per a enregistrar en mode %d-canals"
 
 msgid ""
 "Could not open audio device for recording. Device is being used by another "
 "application."
 msgstr ""
-"No s'ha pogut obrir el dispositiu d'àudio per a l'enregistrament. El "
-"dispositiu està en ús per una altra aplicació."
+"No s'ha pogut obrir el dispositiu d'àudio per a enregistrar. El dispositiu "
+"està en ús per una altra aplicació."
 
 msgid "Could not open audio device for recording."
-msgstr "No s'ha pogut obrir el dispositiu d'àudio per a l'enregistrament."
+msgstr "No s'ha pogut obrir el dispositiu d'àudio per a enregistrar."
 
 msgid "Could not open CD device for reading."
-msgstr "No s'ha pogut obrir el dispositiu del CD per a la lectura."
+msgstr "No s'ha pogut obrir el dispositiu del CD per a lectura."
 
 msgid "Could not seek CD."
 msgstr "No s'ha pogut cercar el CD."
@@ -130,21 +124,21 @@ msgstr ""
 "instaŀlat."
 
 msgid "This appears to be a text file"
-msgstr "Això sembla ser un fitxer de text"
+msgstr "Açò sembla ser un fitxer de text"
 
 msgid "Could not determine type of stream"
 msgstr "No s'ha pogut determinar el tipus de flux"
 
 #, c-format
 msgid "Invalid subtitle URI \"%s\", subtitles disabled."
-msgstr "L'URI de subtítols «%s» no és vàlid, s'inhabiliten els subtítols."
+msgstr "L'URI de subtítols «%s» és invàlida, s'inhabiliten els subtítols."
 
 msgid "No URI specified to play from."
-msgstr "No s'ha especificat cap URI des d'on reproduir."
+msgstr "No s'ha especificat cap URL des d'on reproduir."
 
 #, c-format
 msgid "Invalid URI \"%s\"."
-msgstr "L'URI «%s» no és vàlid."
+msgstr "L'URI «%s» és invàlid."
 
 msgid "RTSP streams cannot be played yet."
 msgstr "Encara no es poden reproduir els fluxes RTSP."
@@ -153,7 +147,7 @@ msgid "Could not create \"decodebin\" element."
 msgstr "No s'ha pogut crear l'element «decodebin»."
 
 msgid "Source element is invalid."
-msgstr "L'element font no és vàlid."
+msgstr "L'element font és invàlid."
 
 msgid ""
 "Only a subtitle stream was detected. Either you are loading a subtitle file "
@@ -161,30 +155,30 @@ msgid ""
 msgstr ""
 "Només s'ha detectat un flux de subtítols. O bé esteu carregant un fitxer de "
 "subtítols o qualsevol altre tipus de fitxer de text, o no s'ha reconegut el "
-"fitxer multimèdia."
+"fitxer de medi."
 
 msgid ""
 "You do not have a decoder installed to handle this file. You might need to "
 "install the necessary plugins."
 msgstr ""
-"No teniu un descodificador instaŀlat per a gestionar aquest fitxer. És "
+"No teniu un decodificador instaŀlat per a gestionar aquest fitxer. És "
 "possible que necessiteu instaŀlar els connectors necessaris."
 
 msgid "This is not a media file"
-msgstr "Això no és un fitxer multimèdia"
+msgstr "Aquest no és un fitxer de medi"
 
 msgid "A subtitle stream was detected, but no video stream."
 msgstr "S'ha detectat un flux de subtítols, però no un flux de vídeo."
 
 msgid "Both autovideosink and xvimagesink elements are missing."
-msgstr "Manquen els elements autovideosink i xvimagesink."
+msgstr "Manquen l'element autovideosink i el xvimagesink."
 
 #, c-format
 msgid "Missing element '%s' - check your GStreamer installation."
 msgstr "Manca l'element «%s» - comproveu la vostra instaŀlació del GStreamer."
 
 msgid "Both autoaudiosink and alsasink elements are missing."
-msgstr "Manquen els elements autoaudiosink i alsasink."
+msgstr "Manquen l'element autoaudiosink i l'alsasink."
 
 #, c-format
 msgid "Both autovideosink and %s elements are missing."
@@ -199,13 +193,13 @@ msgstr "El videosink configurat %s no funciona."
 
 #, c-format
 msgid "Both autovideosink and %s elements are not working."
-msgstr "Els elements autovideosink i %s no funcionen."
+msgstr "Tant l'element autovideosink com el %s no funcionen."
 
 msgid "The autovideosink element is not working."
 msgstr "L'element autovideosink no funciona."
 
 msgid "Custom text sink element is not usable."
-msgstr "L'element sortida de text personalitzat no es pot utilitzar."
+msgstr "L'element sortida personalitzat de text no es pot emprar."
 
 msgid "No volume control found"
 msgstr "No s'ha trobat un control de volum"
@@ -223,7 +217,7 @@ msgstr "L'audiosink configurat %s no funciona."
 
 #, c-format
 msgid "Both autoaudiosink and %s elements are not working."
-msgstr "Els elements autoaudiosink i %s no funcionen."
+msgstr "No funcionen tant l'element autoaudiosink com el %s."
 
 msgid "The autoaudiosink element is not working."
 msgstr "L'element autoaudiosink no funciona."
@@ -233,7 +227,7 @@ msgstr "No es pot reproduir un fitxer de text sense vídeo o visualitzacions."
 
 #, c-format
 msgid "No decoder available for type '%s'."
-msgstr "No hi ha cap descodificador disponible per al tipus «%s»."
+msgstr "No hi ha un decodificador disponible per al tipus «%s»."
 
 msgid "This stream type cannot be played yet."
 msgstr "Encara no es pot reproduir aquest tipus de flux."
@@ -296,132 +290,125 @@ msgid "MusicBrainz TRM ID"
 msgstr "ID TRM al MusicBrainz"
 
 msgid "capturing shutter speed"
-msgstr "velocitat d'obturació de la captura"
+msgstr "velocitat de l'obturador de la captura"
 
 msgid "Shutter speed used when capturing an image, in seconds"
-msgstr "Velocitat d'obturació utilitzat en capturar una imatge, en segons"
+msgstr ""
 
 msgid "capturing focal ratio"
-msgstr "relació focal de la captura"
+msgstr ""
 
 msgid "Focal ratio (f-number) used when capturing the image"
-msgstr "Relació focal (nombre f) utilitzat en capturar la imatge"
+msgstr ""
 
 msgid "capturing focal length"
-msgstr "longitud focal de la captura"
+msgstr ""
 
 msgid "Focal length of the lens used capturing the image, in mm"
-msgstr "Longitud focal de la lent utilitzada en capturar la imatge, en mm"
+msgstr ""
 
 msgid "capturing digital zoom ratio"
-msgstr "relació de zoom digital de la captura"
+msgstr ""
 
 msgid "Digital zoom ratio used when capturing an image"
-msgstr "Relació de zoom digital utilitzat en capturar una imatge"
+msgstr ""
 
 msgid "capturing iso speed"
-msgstr "velocitat iso de la captura"
+msgstr ""
 
 msgid "The ISO speed used when capturing an image"
-msgstr "La velocitat ISO utilitzada en capturar una imatge"
+msgstr ""
 
 msgid "capturing exposure program"
-msgstr "programa d'exposició de la captura"
+msgstr ""
 
 msgid "The exposure program used when capturing an image"
-msgstr "El programa d'exposició utilitzar en capturar una imatge"
+msgstr ""
 
 msgid "capturing exposure mode"
-msgstr "mode d'exposició de la captura"
+msgstr ""
 
 msgid "The exposure mode used when capturing an image"
-msgstr "El mode d'exposició utilitzat en capturar una imatge"
+msgstr ""
 
-#, fuzzy
 msgid "capturing exposure compensation"
-msgstr "mode d'exposició de la captura"
+msgstr ""
 
-#, fuzzy
 msgid "The exposure compensation used when capturing an image"
-msgstr "El mode d'exposició utilitzat en capturar una imatge"
+msgstr ""
 
 msgid "capturing scene capture type"
-msgstr "tipus de captura d'escena de la captura"
+msgstr ""
 
 msgid "The scene capture mode used when capturing an image"
-msgstr "El mode de captura d'escena utilitzat en capturar una imatge"
+msgstr ""
 
 msgid "capturing gain adjustment"
-msgstr "ajust de guany de la captura"
+msgstr ""
 
 msgid "The overall gain adjustment applied on an image"
-msgstr "L'ajust del guany general aplicat a una imatge"
+msgstr ""
 
 msgid "capturing white balance"
-msgstr "balanç de blancs de la captura"
+msgstr ""
 
 msgid "The white balance mode set when capturing an image"
-msgstr "El mode de balanç de blancs utilitzat en capturar una imatge"
+msgstr ""
 
 msgid "capturing contrast"
-msgstr "contrast de la captura"
+msgstr ""
 
 msgid "The direction of contrast processing applied when capturing an image"
 msgstr ""
-"La direcció del processament del contrast aplicada en capturar una imatge"
 
 msgid "capturing saturation"
-msgstr "saturació de la captura"
+msgstr ""
 
 msgid "The direction of saturation processing applied when capturing an image"
 msgstr ""
-"La direcció del processament de la saturació aplicada en capturar una imatge"
 
 msgid "capturing sharpness"
-msgstr "nitidesa de la captura"
+msgstr ""
 
 msgid "The direction of sharpness processing applied when capturing an image"
 msgstr ""
-"La direcció del processament de la nitidesa aplicada en capturar una imatge"
 
 msgid "capturing flash fired"
-msgstr "flaix de la captura"
+msgstr ""
 
 msgid "If the flash fired while capturing an image"
-msgstr "Si el flaix s'ha disparat en capturar una imatge"
+msgstr ""
 
 msgid "capturing flash mode"
-msgstr "mode de flaix de la captura"
+msgstr ""
 
 msgid "The selected flash mode while capturing an image"
-msgstr "El mode de flaix seleccionat en capturar una imatge"
+msgstr ""
 
 msgid "capturing metering mode"
-msgstr "mode de mesurament de la captura"
+msgstr ""
 
 msgid ""
 "The metering mode used while determining exposure for capturing an image"
 msgstr ""
-"El mode de mesurament utilitzat en determinar l'exposició per a capturar una "
-"imatge"
 
 msgid "capturing source"
-msgstr "font de la captura"
+msgstr ""
 
 msgid "The source or type of device used for the capture"
-msgstr "La font o tipus de dispositiu utilitzat per a la captura"
+msgstr ""
 
 msgid "image horizontal ppi"
-msgstr "ppp horitzontal de la imatge"
+msgstr "ppi horitzontal de la imatge"
 
 msgid "Media (image/video) intended horizontal pixel density in ppi"
-msgstr "Densitat horitzontal de píxels del multimèdia (imatge/vídeo), en ppp"
+msgstr "Densitat horitzontal de píxels del medi (imatge/vídeo), en ppi"
 
 msgid "image vertical ppi"
-msgstr "ppp vertical de la imatge"
+msgstr "ppi vertical de la imatge"
 
 msgid "Media (image/video) intended vertical pixel density in ppi"
-msgstr "Densitat vertical de píxels del multimèdia (imatge/vídeo), en ppp"
+msgstr "Densitat vertical de píxels del medi (imatge/vídeo), en ppi"
 
 msgid "ID3v2 frame"
 msgstr ""
@@ -439,34 +426,34 @@ msgid "APE tag"
 msgstr "Etiqueta APE"
 
 msgid "ICY internet radio"
-msgstr "Emissora de ràdio per Internet ICY"
+msgstr "Emisora de ràdio per Internet ICY"
 
 msgid "Apple Lossless Audio (ALAC)"
-msgstr "Àudio sense pèrdues d'Apple (ALAC)"
+msgstr "Apple Lossless Audio (ALAC)"
 
 msgid "Free Lossless Audio Codec (FLAC)"
-msgstr "Còdec d'àudio sense pèrdues lliure (FLAC)"
+msgstr "Free Lossless Audio Codec (FLAC)"
 
 msgid "Lossless True Audio (TTA)"
-msgstr "Àudio sense pèrdues real (TTA)"
+msgstr "Lossless True Audio (TTA)"
 
 msgid "Windows Media Speech"
-msgstr "Parla de Windows Media"
+msgstr "Windows Media Speech"
 
 msgid "CYUV Lossless"
-msgstr "CYUV sense pèrdues"
+msgstr "CYUV sense pèrdua"
 
 msgid "FFMpeg v1"
 msgstr "FFMpeg v1"
 
 msgid "Lossless MSZH"
-msgstr "MSZH sense pèrdues"
+msgstr "MSZH sense pèrdua"
 
 msgid "Uncompressed Gray Image"
-msgstr "Imatge en escala de grisos sense comprimir"
+msgstr "Imatge en escala de grisos no comprimida"
 
 msgid "Run-length encoding"
-msgstr "Codificació Run-length"
+msgstr ""
 
 msgid "Sami subtitle format"
 msgstr "Format de subtítols Sami"
@@ -478,41 +465,41 @@ msgid "Kate subtitle format"
 msgstr "Format de subtítols Kate"
 
 msgid "Uncompressed planar YUV 4:2:0"
-msgstr "YUV 4:2:0 planar sense comprimir"
+msgstr ""
 
 msgid "Uncompressed planar YVU 4:2:0"
-msgstr "YVU 4:2:0 planar sense comprimir"
+msgstr ""
 
 msgid "Uncompressed packed YUV 4:2:2"
-msgstr "YUV 4:2:2 empaquetat sense comprimir"
+msgstr ""
 
 msgid "Uncompressed packed YUV 4:1:0"
-msgstr "YUV 4:1:0 empaquetat sense comprimir"
+msgstr ""
 
 msgid "Uncompressed packed YVU 4:1:0"
-msgstr "YVU 4:1:0 empaquetat sense comprimir"
+msgstr ""
 
 msgid "Uncompressed packed YUV 4:1:1"
-msgstr "YUV 4:1:1 empaquetat sense comprimir"
+msgstr ""
 
 msgid "Uncompressed packed YUV 4:4:4"
-msgstr "YUV 4:4:4 empaquetat sense comprimir"
+msgstr ""
 
 msgid "Uncompressed planar YUV 4:2:2"
-msgstr "YUV 4:2:2 planar sense comprimir"
+msgstr ""
 
 msgid "Uncompressed planar YUV 4:1:1"
-msgstr "YUV 4:1:1 planar sense comprimir"
+msgstr ""
 
 msgid "Uncompressed black and white Y-plane"
-msgstr "Pla Y blanc i negre sense comprimir"
+msgstr ""
 
 msgid "Uncompressed YUV"
 msgstr "YUV sense comprimir"
 
 #, c-format
 msgid "Uncompressed palettized %d-bit %s"
-msgstr "Paletitzat %d-bit %s sense comprimir"
+msgstr ""
 
 #, c-format
 msgid "DivX MPEG-4 Version %d"
@@ -520,7 +507,7 @@ msgstr "DivX MPEG-4 versió %d"
 
 #, c-format
 msgid "Raw %d-bit PCM audio"
-msgstr "Àudio PCM en cru de %d-bit"
+msgstr "Àudio en cru de %d-bit"
 
 msgid "Raw PCM audio"
 msgstr "Àudio PCM en cru"
@@ -539,10 +526,10 @@ msgid "DVD source"
 msgstr "Font de DVD"
 
 msgid "Real Time Streaming Protocol (RTSP) source"
-msgstr "Font del protocol de transmissió en temps real (RTSP)"
+msgstr "Font del Real Time Streaming Protocol (RTSP)"
 
 msgid "Microsoft Media Server (MMS) protocol source"
-msgstr "Font del protocol de servidor Microsoft Media (MMS)"
+msgstr "Font del protocol Microsoft Media Server (MMS)"
 
 #, c-format
 msgid "%s protocol source"
@@ -562,11 +549,11 @@ msgstr "Descarregador RTP %s"
 
 #, c-format
 msgid "%s demuxer"
-msgstr "Desmultiplexor %s"
+msgstr "Demultiplexor %s"
 
 #, c-format
 msgid "%s decoder"
-msgstr "Descodificador %s"
+msgstr "Decodificador %s"
 
 #, c-format
 msgid "%s video RTP payloader"
@@ -602,7 +589,7 @@ msgid "Unknown element"
 msgstr "L'element és desconegut"
 
 msgid "Unknown decoder element"
-msgstr "L'element descodificador és desconegut"
+msgstr "L'element decodificador és desconegut"
 
 msgid "Unknown encoder element"
 msgstr "L'element codificador és desconegut"
@@ -623,7 +610,7 @@ msgstr "El dispositiu «%s» ja és en ús."
 
 #, c-format
 msgid "Could not open device \"%s\" for reading and writing."
-msgstr "No s'ha pogut obrir el dispositiu «%s» per a lectura o escriptura."
+msgstr "No s'ha pogut obrir el dispositiu «%s» per a llegir i escriure."
 
 #~ msgid "discid"
 #~ msgstr "id del disc"
diff --git a/po/cs.po b/po/cs.po
index b442bb1..5924099 100644
--- a/po/cs.po
+++ b/po/cs.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base-0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-12-10 01:13+0000\n"
 "PO-Revision-Date: 2011-05-29 16:49+0200\n"
 "Last-Translator: Petr Kovar <pknbe@volny.cz>\n"
 "Language-Team: Czech <translation-team-cs@lists.sourceforge.net>\n"
diff --git a/po/da.po b/po/da.po
index 02c2c0b..c0425fa 100644
--- a/po/da.po
+++ b/po/da.po
@@ -33,7 +33,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2011-04-28 16:38+0100\n"
 "Last-Translator: Joe Hansen <joedalton2@yahoo.dk>\n"
 "Language-Team: Danish <dansk@dansk-gruppen.dk>\n"
diff --git a/po/de.po b/po/de.po
index 1730be6..18ccfbd 100644
--- a/po/de.po
+++ b/po/de.po
@@ -9,7 +9,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2011-04-28 00:04+0200\n"
 "Last-Translator: Christian Kirbach <christian.kirbach@googlemail.com>\n"
 "Language-Team: German <translation-team-de@lists.sourceforge.net>\n"
diff --git a/po/el.po b/po/el.po
index dfb2485..c542fdf 100644
--- a/po/el.po
+++ b/po/el.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.30.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2010-10-27 12:05+0200\n"
 "Last-Translator: Michael Kotsarinis <mk73628@gmail.com>\n"
 "Language-Team: Greek <team@lists.gnome.gr>\n"
diff --git a/po/en_GB.po b/po/en_GB.po
index d8f7f7f..2526c86 100644
--- a/po/en_GB.po
+++ b/po/en_GB.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins 0.8.1\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2004-04-26 10:41-0400\n"
 "Last-Translator: Gareth Owen <gowen72@yahoo.com>\n"
 "Language-Team: English (British) <en_gb@li.org>\n"
diff --git a/po/eo.po b/po/eo.po
index 781d4a2..d7d20a8 100644
--- a/po/eo.po
+++ b/po/eo.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-12-10 01:13+0000\n"
 "PO-Revision-Date: 2011-06-04 21:11+0100\n"
 "Last-Translator: Kristjan SCHMIDT <kristjan.schmidt@googlemail.com>\n"
 "Language-Team: Esperanto <translation-team-eo@lists.sourceforge.net>\n"
diff --git a/po/es.po b/po/es.po
index d4b41ad..ba55c9b 100644
--- a/po/es.po
+++ b/po/es.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-12-10 01:13+0000\n"
 "PO-Revision-Date: 2011-10-02 15:46+0200\n"
 "Last-Translator: Jorge González González <aloriel@gmail.com>\n"
 "Language-Team: Spanish <es@li.org>\n"
diff --git a/po/eu.po b/po/eu.po
index 931e4d6..97d1632 100644
--- a/po/eu.po
+++ b/po/eu.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base-0.10.26.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2010-03-25 12:32+0100\n"
 "Last-Translator: Mikel Olasagasti Uranga <hey_neken@mundurat.net>\n"
 "Language-Team: Basque <translation-team-eu@lists.sourceforge.net>\n"
diff --git a/po/fi.po b/po/fi.po
index b2d9b0d..0e35ce2 100644
--- a/po/fi.po
+++ b/po/fi.po
@@ -12,7 +12,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.30.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2010-12-31 23:21+0200\n"
 "Last-Translator: Tommi Vainikainen <Tommi.Vainikainen@iki.fi>\n"
 "Language-Team: Finnish <translation-team-fi@lists.sourceforge.net>\n"
diff --git a/po/fr.po b/po/fr.po
index f23cb1f..50865f9 100644
--- a/po/fr.po
+++ b/po/fr.po
@@ -9,7 +9,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2011-04-28 09:19+0200\n"
 "Last-Translator: Claude Paroz <claude@2xlibre.net>\n"
 "Language-Team: French <traduc@traduc.org>\n"
diff --git a/po/gl.po b/po/gl.po
index 1585351..6478ffc 100644
--- a/po/gl.po
+++ b/po/gl.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-12-10 01:13+0000\n"
 "PO-Revision-Date: 2011-09-05 12:48+0200\n"
 "Last-Translator: Fran Dieguez <frandieguez@ubuntu.com>\n"
 "Language-Team: Galician <proxecto@trasno.net>\n"
diff --git a/po/gst-plugins-base-0.10.pot b/po/gst-plugins-base-0.10.pot
index fa1e881..e69de29 100644
--- a/po/gst-plugins-base-0.10.pot
+++ b/po/gst-plugins-base-0.10.pot
@@ -1,795 +0,0 @@
-# SOME DESCRIPTIVE TITLE.
-# This file is put in the public domain.
-# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
-#
-#, fuzzy
-msgid ""
-msgstr ""
-"Project-Id-Version: gst-plugins-base 0.10.36\n"
-"Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
-"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
-"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
-"Language-Team: LANGUAGE <LL@li.org>\n"
-"Language: \n"
-"MIME-Version: 1.0\n"
-"Content-Type: text/plain; charset=CHARSET\n"
-"Content-Transfer-Encoding: 8bit\n"
-
-#: ext/alsa/gstalsamixertrack.c:144
-msgid "Master"
-msgstr ""
-
-#: ext/alsa/gstalsamixertrack.c:145
-msgid "Bass"
-msgstr ""
-
-#: ext/alsa/gstalsamixertrack.c:146
-msgid "Treble"
-msgstr ""
-
-#: ext/alsa/gstalsamixertrack.c:147
-msgid "PCM"
-msgstr ""
-
-#: ext/alsa/gstalsamixertrack.c:148
-msgid "Synth"
-msgstr ""
-
-#: ext/alsa/gstalsamixertrack.c:149
-msgid "Line-in"
-msgstr ""
-
-#: ext/alsa/gstalsamixertrack.c:150
-msgid "CD"
-msgstr ""
-
-#: ext/alsa/gstalsamixertrack.c:151
-msgid "Microphone"
-msgstr ""
-
-#: ext/alsa/gstalsamixertrack.c:152
-msgid "PC Speaker"
-msgstr ""
-
-#: ext/alsa/gstalsamixertrack.c:153
-msgid "Playback"
-msgstr ""
-
-#: ext/alsa/gstalsamixertrack.c:154 ext/alsa/gstalsamixertrack.c:220
-#: ext/alsa/gstalsamixertrack.c:223
-msgid "Capture"
-msgstr ""
-
-#: ext/alsa/gstalsasink.c:485
-msgid "Could not open device for playback in mono mode."
-msgstr ""
-
-#: ext/alsa/gstalsasink.c:487
-msgid "Could not open device for playback in stereo mode."
-msgstr ""
-
-#: ext/alsa/gstalsasink.c:491
-#, c-format
-msgid "Could not open device for playback in %d-channel mode."
-msgstr ""
-
-#: ext/alsa/gstalsasink.c:687
-msgid ""
-"Could not open audio device for playback. Device is being used by another "
-"application."
-msgstr ""
-
-#: ext/alsa/gstalsasink.c:692
-msgid "Could not open audio device for playback."
-msgstr ""
-
-#: ext/alsa/gstalsasrc.c:422
-msgid "Could not open device for recording in mono mode."
-msgstr ""
-
-#: ext/alsa/gstalsasrc.c:424
-msgid "Could not open device for recording in stereo mode."
-msgstr ""
-
-#: ext/alsa/gstalsasrc.c:428
-#, c-format
-msgid "Could not open device for recording in %d-channel mode"
-msgstr ""
-
-#: ext/alsa/gstalsasrc.c:634
-msgid ""
-"Could not open audio device for recording. Device is being used by another "
-"application."
-msgstr ""
-
-#: ext/alsa/gstalsasrc.c:639
-msgid "Could not open audio device for recording."
-msgstr ""
-
-#: ext/cdparanoia/gstcdparanoiasrc.c:283 ext/cdparanoia/gstcdparanoiasrc.c:289
-msgid "Could not open CD device for reading."
-msgstr ""
-
-#: ext/cdparanoia/gstcdparanoiasrc.c:415
-msgid "Could not seek CD."
-msgstr ""
-
-#: ext/cdparanoia/gstcdparanoiasrc.c:423
-msgid "Could not read CD."
-msgstr ""
-
-#: ext/gnomevfs/gstgnomevfssink.c:374
-#, c-format
-msgid "Could not open vfs file \"%s\" for writing: %s."
-msgstr ""
-
-#: ext/gnomevfs/gstgnomevfssink.c:381
-msgid "No filename given"
-msgstr ""
-
-#: ext/gnomevfs/gstgnomevfssink.c:407
-#, c-format
-msgid "Could not close vfs file \"%s\"."
-msgstr ""
-
-#: ext/gnomevfs/gstgnomevfssink.c:565
-#, c-format
-msgid "Error while writing to file \"%s\"."
-msgstr ""
-
-#: ext/ogg/gstoggdemux.c:4466
-msgid "Internal data stream error."
-msgstr ""
-
-#: gst/playback/gstdecodebin.c:1000 gst/playback/gstdecodebin2.c:1696
-#: gst/playback/gstplaybasebin.c:1549 gst/playback/gstplaybasebin.c:1685
-#, c-format
-msgid "A %s plugin is required to play this stream, but not installed."
-msgstr ""
-
-#: gst/playback/gstdecodebin.c:1845 gst/playback/gstdecodebin2.c:2264
-msgid "This appears to be a text file"
-msgstr ""
-
-#: gst/playback/gstdecodebin2.c:1703
-msgid "Could not determine type of stream"
-msgstr ""
-
-#: gst/playback/gstplaybasebin.c:1532
-#, c-format
-msgid "Invalid subtitle URI \"%s\", subtitles disabled."
-msgstr ""
-
-#: gst/playback/gstplaybasebin.c:1655 gst/playback/gsturidecodebin.c:1256
-msgid "No URI specified to play from."
-msgstr ""
-
-#: gst/playback/gstplaybasebin.c:1661 gst/playback/gsturidecodebin.c:1262
-#, c-format
-msgid "Invalid URI \"%s\"."
-msgstr ""
-
-#: gst/playback/gstplaybasebin.c:1667
-msgid "RTSP streams cannot be played yet."
-msgstr ""
-
-#: gst/playback/gstplaybasebin.c:2020
-msgid "Could not create \"decodebin\" element."
-msgstr ""
-
-#: gst/playback/gstplaybasebin.c:2240 gst/playback/gsturidecodebin.c:2091
-msgid "Source element is invalid."
-msgstr ""
-
-#: gst/playback/gstplaybasebin.c:2317
-msgid ""
-"Only a subtitle stream was detected. Either you are loading a subtitle file "
-"or some other type of text file, or the media file was not recognized."
-msgstr ""
-
-#: gst/playback/gstplaybasebin.c:2322
-msgid ""
-"You do not have a decoder installed to handle this file. You might need to "
-"install the necessary plugins."
-msgstr ""
-
-#: gst/playback/gstplaybasebin.c:2326
-msgid "This is not a media file"
-msgstr ""
-
-#: gst/playback/gstplaybasebin.c:2331
-msgid "A subtitle stream was detected, but no video stream."
-msgstr ""
-
-#: gst/playback/gstplaybin.c:902
-msgid "Both autovideosink and xvimagesink elements are missing."
-msgstr ""
-
-#: gst/playback/gstplaybin.c:910 gst/playback/gstplaybin.c:920
-#: gst/playback/gstplaybin.c:1177 gst/playback/gstplaybin.c:1186
-#: gst/playback/gstplaybin.c:1195 gst/playback/gstplaybin.c:1326
-#: gst/playback/gstplaybin.c:1335 gst/playback/gstplaybin.c:1344
-#: gst/playback/gstplaysink.c:1186 gst/playback/gstplaysink.c:1199
-#: gst/playback/gstplaysink.c:1330 gst/playback/gstplaysink.c:1510
-#: gst/playback/gstplaysink.c:1559 gst/playback/gstplaysink.c:1574
-#: gst/playback/gstplaysink.c:1599 gst/playback/gstplaysink.c:1631
-#: gst/playback/gstplaysink.c:1751 gst/playback/gstplaysink.c:2106
-#: gst/playback/gstplaysink.c:2115 gst/playback/gstplaysink.c:2124
-#: gst/playback/gstplaysink.c:2133 gst/playback/gstplaysink.c:3125
-#: gst/playback/gsturidecodebin.c:1343
-#, c-format
-msgid "Missing element '%s' - check your GStreamer installation."
-msgstr ""
-
-#: gst/playback/gstplaybin.c:1170
-msgid "Both autoaudiosink and alsasink elements are missing."
-msgstr ""
-
-#: gst/playback/gstplaysink.c:1379
-#, c-format
-msgid "Both autovideosink and %s elements are missing."
-msgstr ""
-
-#: gst/playback/gstplaysink.c:1383
-msgid "The autovideosink element is missing."
-msgstr ""
-
-#: gst/playback/gstplaysink.c:1388
-#, c-format
-msgid "Configured videosink %s is not working."
-msgstr ""
-
-#: gst/playback/gstplaysink.c:1392
-#, c-format
-msgid "Both autovideosink and %s elements are not working."
-msgstr ""
-
-#: gst/playback/gstplaysink.c:1396
-msgid "The autovideosink element is not working."
-msgstr ""
-
-#: gst/playback/gstplaysink.c:1547
-msgid "Custom text sink element is not usable."
-msgstr ""
-
-#: gst/playback/gstplaysink.c:1869
-msgid "No volume control found"
-msgstr ""
-
-#: gst/playback/gstplaysink.c:1889
-#, c-format
-msgid "Both autoaudiosink and %s elements are missing."
-msgstr ""
-
-#: gst/playback/gstplaysink.c:1893
-msgid "The autoaudiosink element is missing."
-msgstr ""
-
-#: gst/playback/gstplaysink.c:1898
-#, c-format
-msgid "Configured audiosink %s is not working."
-msgstr ""
-
-#: gst/playback/gstplaysink.c:1902
-#, c-format
-msgid "Both autoaudiosink and %s elements are not working."
-msgstr ""
-
-#: gst/playback/gstplaysink.c:1906
-msgid "The autoaudiosink element is not working."
-msgstr ""
-
-#: gst/playback/gstplaysink.c:2209 gst/playback/gstplaysink.c:2214
-msgid "Can't play a text file without video or visualizations."
-msgstr ""
-
-#: gst/playback/gsturidecodebin.c:874
-#, c-format
-msgid "No decoder available for type '%s'."
-msgstr ""
-
-#: gst/playback/gsturidecodebin.c:1268
-msgid "This stream type cannot be played yet."
-msgstr ""
-
-#: gst/playback/gsturidecodebin.c:1285
-#, c-format
-msgid "No URI handler implemented for \"%s\"."
-msgstr ""
-
-#: gst/tcp/gsttcp.c:503 gst/tcp/gsttcpclientsink.c:282
-#, c-format
-msgid "Error while sending data to \"%s:%d\"."
-msgstr ""
-
-#: gst/tcp/gsttcp.c:555
-#, c-format
-msgid "Error while sending gdp header data to \"%s:%d\"."
-msgstr ""
-
-#: gst/tcp/gsttcp.c:564
-#, c-format
-msgid "Error while sending gdp payload data to \"%s:%d\"."
-msgstr ""
-
-#: gst/tcp/gsttcpclientsink.c:394 gst/tcp/gsttcpclientsrc.c:378
-#, c-format
-msgid "Connection to %s:%d refused."
-msgstr ""
-
-#: gst-libs/gst/audio/gstbaseaudiosrc.c:837
-msgid "Can't record audio fast enough"
-msgstr ""
-
-#: gst-libs/gst/tag/gsttagdemux.c:1078
-msgid "Failed to read tag: not enough data"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:79
-msgid "track ID"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:79
-msgid "MusicBrainz track ID"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:81
-msgid "artist ID"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:81
-msgid "MusicBrainz artist ID"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:83
-msgid "album ID"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:83
-msgid "MusicBrainz album ID"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:86
-msgid "album artist ID"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:86
-msgid "MusicBrainz album artist ID"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:88
-msgid "track TRM ID"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:88
-msgid "MusicBrainz TRM ID"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:110
-msgid "capturing shutter speed"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:111
-msgid "Shutter speed used when capturing an image, in seconds"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:114
-msgid "capturing focal ratio"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:115
-msgid "Focal ratio (f-number) used when capturing the image"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:118
-msgid "capturing focal length"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:119
-msgid "Focal length of the lens used capturing the image, in mm"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:122
-msgid "capturing digital zoom ratio"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:123
-msgid "Digital zoom ratio used when capturing an image"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:126
-msgid "capturing iso speed"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:127
-msgid "The ISO speed used when capturing an image"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:130
-msgid "capturing exposure program"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:131
-msgid "The exposure program used when capturing an image"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:134
-msgid "capturing exposure mode"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:135
-msgid "The exposure mode used when capturing an image"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:138
-msgid "capturing exposure compensation"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:139
-msgid "The exposure compensation used when capturing an image"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:142
-msgid "capturing scene capture type"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:143
-msgid "The scene capture mode used when capturing an image"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:146
-msgid "capturing gain adjustment"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:147
-msgid "The overall gain adjustment applied on an image"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:150
-msgid "capturing white balance"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:151
-msgid "The white balance mode set when capturing an image"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:154
-msgid "capturing contrast"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:155
-msgid "The direction of contrast processing applied when capturing an image"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:159
-msgid "capturing saturation"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:160
-msgid "The direction of saturation processing applied when capturing an image"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:164
-msgid "capturing sharpness"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:165
-msgid "The direction of sharpness processing applied when capturing an image"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:169
-msgid "capturing flash fired"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:170
-msgid "If the flash fired while capturing an image"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:173
-msgid "capturing flash mode"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:174
-msgid "The selected flash mode while capturing an image"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:177
-msgid "capturing metering mode"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:178
-msgid ""
-"The metering mode used while determining exposure for capturing an image"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:182
-msgid "capturing source"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:183
-msgid "The source or type of device used for the capture"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:186
-msgid "image horizontal ppi"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:187
-msgid "Media (image/video) intended horizontal pixel density in ppi"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:190
-msgid "image vertical ppi"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:191
-msgid "Media (image/video) intended vertical pixel density in ppi"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:194
-msgid "ID3v2 frame"
-msgstr ""
-
-#: gst-libs/gst/tag/tags.c:194
-msgid "unparsed id3v2 tag frame"
-msgstr ""
-
-#: gst-libs/gst/cdda/gstcddabasesrc.c:1468
-#: gst-libs/gst/cdda/gstcddabasesrc.c:1501
-msgid "This CD has no audio tracks"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:70
-msgid "ID3 tag"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:71
-#: gst-libs/gst/pbutils/descriptions.c:72
-msgid "APE tag"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:73
-msgid "ICY internet radio"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:102
-msgid "Apple Lossless Audio (ALAC)"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:112
-msgid "Free Lossless Audio Codec (FLAC)"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:138
-#: gst-libs/gst/pbutils/descriptions.c:139
-msgid "Lossless True Audio (TTA)"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:147
-msgid "Windows Media Speech"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:162
-msgid "CYUV Lossless"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:167
-msgid "FFMpeg v1"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:181
-msgid "Lossless MSZH"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:187
-msgid "Uncompressed Gray Image"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:192
-msgid "Run-length encoding"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:238
-msgid "Sami subtitle format"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:239
-msgid "TMPlayer subtitle format"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:241
-msgid "Kate subtitle format"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:305
-msgid "Uncompressed planar YUV 4:2:0"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:308
-msgid "Uncompressed planar YVU 4:2:0"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:311
-#: gst-libs/gst/pbutils/descriptions.c:321
-msgid "Uncompressed packed YUV 4:2:2"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:314
-msgid "Uncompressed packed YUV 4:1:0"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:317
-msgid "Uncompressed packed YVU 4:1:0"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:324
-msgid "Uncompressed packed YUV 4:1:1"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:327
-msgid "Uncompressed packed YUV 4:4:4"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:330
-msgid "Uncompressed planar YUV 4:2:2"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:333
-msgid "Uncompressed planar YUV 4:1:1"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:336
-msgid "Uncompressed black and white Y-plane"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:339
-msgid "Uncompressed YUV"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:350
-#, c-format
-msgid "Uncompressed palettized %d-bit %s"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:402
-#, c-format
-msgid "DivX MPEG-4 Version %d"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:620
-#, c-format
-msgid "Raw %d-bit PCM audio"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:622
-msgid "Raw PCM audio"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:628
-#, c-format
-msgid "Raw %d-bit floating-point audio"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:630
-msgid "Raw floating-point audio"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:717
-msgid "Audio CD source"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:720
-msgid "DVD source"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:723
-msgid "Real Time Streaming Protocol (RTSP) source"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:727
-msgid "Microsoft Media Server (MMS) protocol source"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:735
-#, c-format
-msgid "%s protocol source"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:807
-#, c-format
-msgid "%s video RTP depayloader"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:809
-#, c-format
-msgid "%s audio RTP depayloader"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:811
-#, c-format
-msgid "%s RTP depayloader"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:818
-#, c-format
-msgid "%s demuxer"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:820
-#, c-format
-msgid "%s decoder"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:858
-#, c-format
-msgid "%s video RTP payloader"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:860
-#, c-format
-msgid "%s audio RTP payloader"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:862
-#, c-format
-msgid "%s RTP payloader"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:869
-#, c-format
-msgid "%s muxer"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:871
-#, c-format
-msgid "%s encoder"
-msgstr ""
-
-#: gst-libs/gst/pbutils/descriptions.c:903
-#, c-format
-msgid "GStreamer element %s"
-msgstr ""
-
-#: gst-libs/gst/pbutils/missing-plugins.c:555
-msgid "Unknown source element"
-msgstr ""
-
-#: gst-libs/gst/pbutils/missing-plugins.c:558
-msgid "Unknown sink element"
-msgstr ""
-
-#: gst-libs/gst/pbutils/missing-plugins.c:561
-msgid "Unknown element"
-msgstr ""
-
-#: gst-libs/gst/pbutils/missing-plugins.c:564
-msgid "Unknown decoder element"
-msgstr ""
-
-#: gst-libs/gst/pbutils/missing-plugins.c:567
-msgid "Unknown encoder element"
-msgstr ""
-
-#: gst-libs/gst/pbutils/missing-plugins.c:572
-msgid "Plugin or element of unknown type"
-msgstr ""
-
-#: sys/v4l/v4l_calls.c:159
-msgid "No device specified."
-msgstr ""
-
-#: sys/v4l/v4l_calls.c:168
-#, c-format
-msgid "Device \"%s\" does not exist."
-msgstr ""
-
-#: sys/v4l/v4l_calls.c:173
-#, c-format
-msgid "Device \"%s\" is already being used."
-msgstr ""
-
-#: sys/v4l/v4l_calls.c:178
-#, c-format
-msgid "Could not open device \"%s\" for reading and writing."
-msgstr ""
diff --git a/po/hu.po b/po/hu.po
index 40f63b0..29b6ccf 100644
--- a/po/hu.po
+++ b/po/hu.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.30.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2010-11-03 02:48+0100\n"
 "Last-Translator: Gabor Kelemen <kelemeng@gnome.hu>\n"
 "Language-Team: Hungarian <translation-team-hu@lists.sourceforge.net>\n"
diff --git a/po/id.po b/po/id.po
index f90522d..98fc9a6 100644
--- a/po/id.po
+++ b/po/id.po
@@ -1,13 +1,13 @@
 # Indonesian translations for gst-plugins-base package.
 # This file is put in the public domain.
-# Andhika Padmawan <andhika.padmawan@gmail.com>, 2010-2012.
+# Andhika Padmawan <andhika.padmawan@gmail.com>, 2010.
 #
 msgid ""
 msgstr ""
-"Project-Id-Version: gst-plugins-base 0.10.32.2\n"
+"Project-Id-Version: gst-plugins-base 0.10.28.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
-"PO-Revision-Date: 2012-01-28 11:31+0700\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
+"PO-Revision-Date: 2010-04-26 22:01+0700\n"
 "Last-Translator: Andhika Padmawan <andhika.padmawan@gmail.com>\n"
 "Language-Team: Indonesian <translation-team-id@lists.sourceforge.net>\n"
 "Language: id\n"
@@ -284,127 +284,125 @@ msgid "MusicBrainz TRM ID"
 msgstr "ID TRM MusicBrainz"
 
 msgid "capturing shutter speed"
-msgstr "menangkap kecepatan rana"
+msgstr ""
 
 msgid "Shutter speed used when capturing an image, in seconds"
-msgstr "Kecepatan rana digunakan saat menangkap gambar, dalam detik"
+msgstr ""
 
 msgid "capturing focal ratio"
-msgstr "menangkap bukaan"
+msgstr ""
 
 msgid "Focal ratio (f-number) used when capturing the image"
-msgstr "Bukaan (angka-f) digunakan ketika menangkap gambar"
+msgstr ""
 
 msgid "capturing focal length"
-msgstr "menangkap panjang fokal"
+msgstr ""
 
 msgid "Focal length of the lens used capturing the image, in mm"
-msgstr "Panjang fokal dari lensa digunakan ketika menangkap gambar, dalam mm"
+msgstr ""
 
 msgid "capturing digital zoom ratio"
-msgstr "menangkap rasio pembesaran digital"
+msgstr ""
 
 msgid "Digital zoom ratio used when capturing an image"
-msgstr "Rasio pembesaran digital digunakan ketika menangkap gambar"
+msgstr ""
 
 msgid "capturing iso speed"
-msgstr "menangkap kecepatan iso"
+msgstr ""
 
 msgid "The ISO speed used when capturing an image"
-msgstr "Kecepatan ISO digunakan menangkap gambar"
+msgstr ""
 
 msgid "capturing exposure program"
-msgstr "menangkap program pajanan"
+msgstr ""
 
 msgid "The exposure program used when capturing an image"
-msgstr "Program pajanan digunakan ketika menangkap gambar"
+msgstr ""
 
 msgid "capturing exposure mode"
-msgstr "menangkap mode pajanan"
+msgstr ""
 
 msgid "The exposure mode used when capturing an image"
-msgstr "Mode pajanan digunakan ketika menangkap gambar"
+msgstr ""
 
 msgid "capturing exposure compensation"
-msgstr "menangkap kompensasi pajanan"
+msgstr ""
 
 msgid "The exposure compensation used when capturing an image"
-msgstr "Kompensasi pajanan digunakan ketika menangkap gambar"
+msgstr ""
 
 msgid "capturing scene capture type"
-msgstr "menangkap tipe pengambilan scene"
+msgstr ""
 
 msgid "The scene capture mode used when capturing an image"
-msgstr "Mode penangkapan scene digunakan ketika menangkap gambar"
+msgstr ""
 
 msgid "capturing gain adjustment"
-msgstr "menangkap penyesuaian bati"
+msgstr ""
 
 msgid "The overall gain adjustment applied on an image"
-msgstr "Keseluruhan penyesuaian bati diterapkan pada gambar"
+msgstr ""
 
 msgid "capturing white balance"
-msgstr "menangkap white balance"
+msgstr ""
 
 msgid "The white balance mode set when capturing an image"
-msgstr "Pengaturan mode white balance ketika menangkap gambar"
+msgstr ""
 
 msgid "capturing contrast"
-msgstr "menangkap kontras"
+msgstr ""
 
 msgid "The direction of contrast processing applied when capturing an image"
-msgstr "Arah pemrosesan kontras diterapkan ketika menangkap gambar"
+msgstr ""
 
 msgid "capturing saturation"
-msgstr "menangkap saturasi"
+msgstr ""
 
 msgid "The direction of saturation processing applied when capturing an image"
-msgstr "Arah pemrosesan saturasi diterapkan ketika menangkap gambar"
+msgstr ""
 
 msgid "capturing sharpness"
-msgstr "menangkap ketajaman"
+msgstr ""
 
 msgid "The direction of sharpness processing applied when capturing an image"
-msgstr "Arah pemrosesan ketajaman diterapkan ketika menangkap gambar"
+msgstr ""
 
 msgid "capturing flash fired"
-msgstr "menangkap blitz ditembakkan"
+msgstr ""
 
 msgid "If the flash fired while capturing an image"
-msgstr "Apakah blitz ditembakkan ketika menangkap gambar"
+msgstr ""
 
 msgid "capturing flash mode"
-msgstr "menangkap mode blitz"
+msgstr ""
 
 msgid "The selected flash mode while capturing an image"
-msgstr "Mode blitz terpilih ketika menangkap gambar"
+msgstr ""
 
 msgid "capturing metering mode"
-msgstr "menangkap mode meter"
+msgstr ""
 
 msgid ""
 "The metering mode used while determining exposure for capturing an image"
-msgstr "Mode meter digunakan untuk menentukan pajanan ketika menangkap gambar"
+msgstr ""
 
 msgid "capturing source"
-msgstr "menangkap sumber"
+msgstr ""
 
 msgid "The source or type of device used for the capture"
-msgstr "Sumber atau tipe divais digunakan untuk menangkap"
+msgstr ""
 
 msgid "image horizontal ppi"
-msgstr "ppi horizontal gambar"
+msgstr ""
 
 msgid "Media (image/video) intended horizontal pixel density in ppi"
 msgstr ""
-"Kerapatan pixel horizontal yang diinginkan media (gambar/video) dalam ppi"
 
 msgid "image vertical ppi"
-msgstr "ppi vertikal gambar"
+msgstr ""
 
 msgid "Media (image/video) intended vertical pixel density in ppi"
 msgstr ""
-"Kerapatan pixel vertikal yang diinginkan media (gambar/video) dalam ppi"
 
 msgid "ID3v2 frame"
 msgstr ""
diff --git a/po/it.po b/po/it.po
index d776f41..dbef8e4 100644
--- a/po/it.po
+++ b/po/it.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.28.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2010-04-28 14:27+0200\n"
 "Last-Translator: Luca Ferretti <elle.uca@infinito.it>\n"
 "Language-Team: Italian <tp@lists.linux.it>\n"
diff --git a/po/ja.po b/po/ja.po
index 9235e3c..bbef9dd 100644
--- a/po/ja.po
+++ b/po/ja.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.30.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2010-10-25 10:27+0900\n"
 "Last-Translator: Makoto Kato <makoto.kt@gmail.com>\n"
 "Language-Team: Japanese <translation-team-ja@lists.sourceforge.net>\n"
diff --git a/po/lt.po b/po/lt.po
index 624ce03..d37745e 100644
--- a/po/lt.po
+++ b/po/lt.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base-0.10.15.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2008-03-07 23:43+0200\n"
 "Last-Translator: Gintautas Miliauskas <gintas@akl.lt>\n"
 "Language-Team: Lithuanian <komp_lt@konferencijos.lt>\n"
diff --git a/po/lv.po b/po/lv.po
index 0ff562c..b97483a 100644
--- a/po/lv.po
+++ b/po/lv.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-12-10 01:13+0000\n"
 "PO-Revision-Date: 2011-09-02 12:02-0000\n"
 "Last-Translator: Rihards Priedītis <rprieditis@gmail.com>\n"
 "Language-Team: Latvian <translation-team-lv@lists.sourceforge.net>\n"
diff --git a/po/nb.po b/po/nb.po
index 74c576a..d55ffdd 100644
--- a/po/nb.po
+++ b/po/nb.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.30.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2010-10-24 21:44+0200\n"
 "Last-Translator: Kjartan Maraas <kmaraas@gnome.org>\n"
 "Language-Team: Norwegian Bokmaal <i18n-nb@lister.ping.uio.no>\n"
diff --git a/po/nl.po b/po/nl.po
index 227d7dc..6e888be 100644
--- a/po/nl.po
+++ b/po/nl.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2011-04-27 00:12+0200\n"
 "Last-Translator: Freek de Kruijf <f.de.kruijf@gmail.com>\n"
 "Language-Team: Dutch <vertaling@vrijschrift.org>\n"
diff --git a/po/or.po b/po/or.po
index c704ff4..f7ab8dc 100644
--- a/po/or.po
+++ b/po/or.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-0.8.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2004-09-27 13:32+0530\n"
 "Last-Translator: Gora Mohanty <gora_mohanty@yahoo.co.in>\n"
 "Language-Team: Oriya <gora_mohanty@yahoo.co.in>\n"
diff --git a/po/pl.po b/po/pl.po
index 1f02706..6665d2f 100644
--- a/po/pl.po
+++ b/po/pl.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2011-04-26 18:01+0200\n"
 "Last-Translator: Jakub Bogusz <qboosh@pld-linux.org>\n"
 "Language-Team: Polish <translation-team-pl@lists.sourceforge.net>\n"
diff --git a/po/pt_BR.po b/po/pt_BR.po
index f3d9a18..9df31ca 100644
--- a/po/pt_BR.po
+++ b/po/pt_BR.po
@@ -9,7 +9,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base-0.10.31.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2011-01-08 01:02-0300\n"
 "Last-Translator: Fabrício Godoy <skarllot@gmail.com>\n"
 "Language-Team: Brazilian Portuguese <ldp-br@bazar.conectiva.com.br>\n"
diff --git a/po/ro.po b/po/ro.po
index 92bec00..a530073 100644
--- a/po/ro.po
+++ b/po/ro.po
@@ -5,7 +5,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.29.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2010-08-16 01:21+0300\n"
 "Last-Translator: Lucian Adrian Grijincu <lucian.grijincu@gmail.com>\n"
 "Language-Team: Romanian <translation-team-ro@lists.sourceforge.net>\n"
diff --git a/po/ru.po b/po/ru.po
index a259243..029d3e9 100644
--- a/po/ru.po
+++ b/po/ru.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2011-04-26 20:30+0400\n"
 "Last-Translator: Yuri Kozlov <yuray@komyakino.ru>\n"
 "Language-Team: Russian <gnu@mx.ru>\n"
diff --git a/po/sk.po b/po/sk.po
index 03d23a2..449cae5 100644
--- a/po/sk.po
+++ b/po/sk.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.30.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2010-11-08 15:34+0100\n"
 "Last-Translator: Peter Tuhársky <tuharsky@misbb.sk>\n"
 "Language-Team: Slovak <sk-i18n@lists.linux.sk>\n"
diff --git a/po/sl.po b/po/sl.po
index f30c714..2fb0b9b 100644
--- a/po/sl.po
+++ b/po/sl.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2011-04-26 15:56+0100\n"
 "Last-Translator: Klemen Košir <klemen.kosir@gmx.com>\n"
 "Language-Team: Slovenian <translation-team-sl@lists.sourceforge.net>\n"
diff --git a/po/sq.po b/po/sq.po
index 85d8044..7b825c3 100644
--- a/po/sq.po
+++ b/po/sq.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins 0.8.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2004-08-07 20:29+0200\n"
 "Last-Translator: Laurent Dhima <laurenti@alblinux.net>\n"
 "Language-Team: Albanian <begraj@hotmail.com>\n"
diff --git a/po/sr.po b/po/sr.po
index 50ec072..2feacfa 100644
--- a/po/sr.po
+++ b/po/sr.po
@@ -7,7 +7,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base-0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-12-10 01:13+0000\n"
 "PO-Revision-Date: 2011-12-05 09:10+0200\n"
 "Last-Translator: Мирослав Николић <miroslavnikolic@rocketmail.com>\n"
 "Language-Team: Serbian <gnu@prevod.org>\n"
diff --git a/po/sv.po b/po/sv.po
index 8e84a6a..5515c5c 100644
--- a/po/sv.po
+++ b/po/sv.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.28.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2010-06-07 18:17+0100\n"
 "Last-Translator: Daniel Nylander <po@danielnylander.se>\n"
 "Language-Team: Swedish <tp-sv@listor.tp-sv.se>\n"
diff --git a/po/tr.po b/po/tr.po
index 2794ca7..b2f28c0 100644
--- a/po/tr.po
+++ b/po/tr.po
@@ -5,7 +5,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2011-04-26 19:22+0200\n"
 "Last-Translator: Server Acim <serveracim@gmail.com>\n"
 "Language-Team: Turkish <gnu-tr-u12a@lists.sourceforge.net>\n"
diff --git a/po/uk.po b/po/uk.po
index 56bfb2b..c7286a5 100644
--- a/po/uk.po
+++ b/po/uk.po
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.32.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2011-04-27 17:49+0300\n"
 "Last-Translator: Yuri Chornoivan <yurchor@ukr.net>\n"
 "Language-Team: Ukrainian <translation-team-uk@lists.sourceforge.net>\n"
diff --git a/po/vi.po b/po/vi.po
index dd5c694..30650ea 100644
--- a/po/vi.po
+++ b/po/vi.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.28.2\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2010-04-27 22:51+0930\n"
 "Last-Translator: Clytie Siddall <clytie@riverland.net.au>\n"
 "Language-Team: Vietnamese <vi-VN@googlegroups.com>\n"
diff --git a/po/zh_CN.po b/po/zh_CN.po
index 1f34fe9..76a304e 100644
--- a/po/zh_CN.po
+++ b/po/zh_CN.po
@@ -6,7 +6,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: gst-plugins-base 0.10.21.3\n"
 "Report-Msgid-Bugs-To: http://bugzilla.gnome.org/\n"
-"POT-Creation-Date: 2012-02-20 23:28+0000\n"
+"POT-Creation-Date: 2011-08-20 12:18+0100\n"
 "PO-Revision-Date: 2009-01-14 12:41+0800\n"
 "Last-Translator: Ji ZhengYu <zhengyuji@gmail.com>\n"
 "Language-Team: Chinese (simplified) <i18n-zh@googlegroups.com>\n"
diff --git a/stamp-h.in b/stamp-h.in
new file mode 100644
index 0000000..9788f70
--- /dev/null
+++ b/stamp-h.in
@@ -0,0 +1 @@
+timestamp
diff --git a/sys/Makefile.in b/sys/Makefile.in
index 93e4768..df971c6 100644
--- a/sys/Makefile.in
+++ b/sys/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -20,6 +19,23 @@
 # descending into all subdirectories a second time, but only after the first
 # (parallel) run has finished, so it should go right through the second time.
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -38,6 +54,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
 	$(top_srcdir)/common/parallel-subdirs.mak
 subdir = sys
@@ -85,12 +102,18 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
 RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
@@ -100,6 +123,11 @@ RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
@@ -421,7 +449,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -483,12 +515,12 @@ clean-libtool:
 	-rm -rf .libs _libs
 
 # This directory's subdirectories are mostly independent; you can cd
-# into them and run `make' without going through this Makefile.
-# To change the values of `make' variables: instead of editing Makefiles,
-# (1) if the variable is set in `config.status', edit `config.status'
-#     (which will cause the Makefiles to be regenerated when you run `make');
-# (2) otherwise, pass the desired values on the `make' command line.
-$(RECURSIVE_TARGETS):
+# into them and run 'make' without going through this Makefile.
+# To change the values of 'make' variables: instead of editing Makefiles,
+# (1) if the variable is set in 'config.status', edit 'config.status'
+#     (which will cause the Makefiles to be regenerated when you run 'make');
+# (2) otherwise, pass the desired values on the 'make' command line.
+$(RECURSIVE_TARGETS) $(RECURSIVE_CLEAN_TARGETS):
 	@fail= failcom='exit 1'; \
 	for f in x $$MAKEFLAGS; do \
 	  case $$f in \
@@ -498,7 +530,11 @@ $(RECURSIVE_TARGETS):
 	done; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
-	list='$(SUBDIRS)'; for subdir in $$list; do \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	for subdir in $$list; do \
 	  echo "Making $$target in $$subdir"; \
 	  if test "$$subdir" = "."; then \
 	    dot_seen=yes; \
@@ -512,37 +548,6 @@ $(RECURSIVE_TARGETS):
 	if test "$$dot_seen" = "no"; then \
 	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
 	fi; test -z "$$fail"
-
-$(RECURSIVE_CLEAN_TARGETS):
-	@fail= failcom='exit 1'; \
-	for f in x $$MAKEFLAGS; do \
-	  case $$f in \
-	    *=* | --[!k]*);; \
-	    *k*) failcom='fail=yes';; \
-	  esac; \
-	done; \
-	dot_seen=no; \
-	case "$@" in \
-	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
-	  *) list='$(SUBDIRS)' ;; \
-	esac; \
-	rev=''; for subdir in $$list; do \
-	  if test "$$subdir" = "."; then :; else \
-	    rev="$$subdir $$rev"; \
-	  fi; \
-	done; \
-	rev="$$rev ."; \
-	target=`echo $@ | sed s/-recursive//`; \
-	for subdir in $$rev; do \
-	  echo "Making $$target in $$subdir"; \
-	  if test "$$subdir" = "."; then \
-	    local_target="$$target-am"; \
-	  else \
-	    local_target="$$target"; \
-	  fi; \
-	  ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
-	  || eval $$failcom; \
-	done && test -z "$$fail"
 tags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
@@ -551,6 +556,10 @@ ctags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
 	done
+cscopelist-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) cscopelist); \
+	done
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -614,6 +623,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist: cscopelist-recursive $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -649,13 +672,10 @@ distdir: $(DISTFILES)
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -776,22 +796,23 @@ ps-am:
 
 uninstall-am:
 
-.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) ctags-recursive \
-	install-am install-strip tags-recursive
+.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) \
+	cscopelist-recursive ctags-recursive install-am install-strip \
+	tags-recursive
 
 .PHONY: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) CTAGS GTAGS \
 	all all-am check check-am clean clean-generic clean-libtool \
-	ctags ctags-recursive distclean distclean-generic \
-	distclean-libtool distclean-tags distdir dvi dvi-am html \
-	html-am info info-am install install-am install-data \
-	install-data-am install-dvi install-dvi-am install-exec \
-	install-exec-am install-html install-html-am install-info \
-	install-info-am install-man install-pdf install-pdf-am \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs installdirs-am maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-generic \
-	mostlyclean-libtool pdf pdf-am ps ps-am tags tags-recursive \
-	uninstall uninstall-am
+	cscopelist cscopelist-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-libtool distclean-tags \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-dvi \
+	install-dvi-am install-exec install-exec-am install-html \
+	install-html-am install-info install-info-am install-man \
+	install-pdf install-pdf-am install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	mostlyclean mostlyclean-generic mostlyclean-libtool pdf pdf-am \
+	ps ps-am tags tags-recursive uninstall uninstall-am
 
 
 .PHONY: independent-subdirs $(SUBDIRS)
diff --git a/sys/v4l/Makefile.in b/sys/v4l/Makefile.in
index d089422..513a710 100644
--- a/sys/v4l/Makefile.in
+++ b/sys/v4l/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = sys/v4l
 DIST_COMMON = README $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in TODO
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp TODO
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -133,10 +150,23 @@ libgstvideo4linux_la_OBJECTS = $(am_libgstvideo4linux_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstvideo4linux_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstvideo4linux_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstvideo4linux_la_CFLAGS) $(CFLAGS) \
 	$(libgstvideo4linux_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -149,22 +179,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstvideo4linux_la_SOURCES)
 DIST_SOURCES = $(am__libgstvideo4linux_la_SOURCES_DIST)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -457,7 +488,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -535,7 +570,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -543,6 +577,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -558,12 +594,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstvideo4linux.la: $(libgstvideo4linux_la_OBJECTS) $(libgstvideo4linux_la_DEPENDENCIES) $(EXTRA_libgstvideo4linux_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstvideo4linux_la_LINK) -rpath $(plugindir) $(libgstvideo4linux_la_OBJECTS) $(libgstvideo4linux_la_LIBADD) $(LIBS)
 
@@ -714,6 +752,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -858,18 +910,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/sys/v4l/gstv4ljpegsrc.c b/sys/v4l/gstv4ljpegsrc.c
new file mode 100644
index 0000000..724a66f
--- /dev/null
+++ b/sys/v4l/gstv4ljpegsrc.c
@@ -0,0 +1,293 @@
+/* GStreamer
+ *
+ * gstv4ljpegsrc.c: V4L source element for JPEG cameras
+ *
+ * Copyright (C) 2004-2005 Jan Schmidt <thaytan@mad.scientist.com>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ e Boston, MA 02111-1307, USA.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include <config.h>
+#endif
+
+#include <string.h>
+#include <sys/time.h>
+#include "gstv4ljpegsrc.h"
+#include "v4lsrc_calls.h"
+
+GST_DEBUG_CATEGORY_STATIC (v4ljpegsrc_debug);
+#define GST_CAT_DEFAULT v4ljpegsrc_debug
+
+/* init functions */
+static void gst_v4ljpegsrc_base_init (gpointer g_class);
+static void gst_v4ljpegsrc_class_init (GstV4lJpegSrcClass * klass);
+static void gst_v4ljpegsrc_init (GstV4lJpegSrc * v4ljpegsrc);
+
+/* buffer functions */
+static GstPadLinkReturn gst_v4ljpegsrc_src_link (GstPad * pad,
+    const GstCaps * caps);
+static GstCaps *gst_v4ljpegsrc_getcaps (GstPad * pad);
+static GstData *gst_v4ljpegsrc_get (GstPad * pad);
+
+static GstElementClass *parent_class = NULL;
+
+GType
+gst_v4ljpegsrc_get_type (void)
+{
+  static GType v4ljpegsrc_type = 0;
+
+  if (!v4ljpegsrc_type) {
+    static const GTypeInfo v4ljpegsrc_info = {
+      sizeof (GstV4lJpegSrcClass),
+      gst_v4ljpegsrc_base_init,
+      NULL,
+      (GClassInitFunc) gst_v4ljpegsrc_class_init,
+      NULL,
+      NULL,
+      sizeof (GstV4lJpegSrc),
+      0,
+      (GInstanceInitFunc) gst_v4ljpegsrc_init,
+      NULL
+    };
+
+    v4ljpegsrc_type =
+        g_type_register_static (GST_TYPE_V4LSRC, "GstV4lJpegSrc",
+        &v4ljpegsrc_info, 0);
+    GST_DEBUG_CATEGORY_INIT (v4ljpegsrc_debug, "v4ljpegsrc", 0,
+        "V4L JPEG source element");
+  }
+  return v4ljpegsrc_type;
+}
+
+static void
+gst_v4ljpegsrc_base_init (gpointer g_class)
+{
+  GstElementClass *gstelement_class = GST_ELEMENT_CLASS (g_class);
+
+  gst_element_class_set_details_simple (gstelement_class,
+      "Video (video4linux/raw) Jpeg Source", "Source/Video",
+      "Reads jpeg frames from a video4linux (eg ov519) device",
+      "Jan Schmidt <thaytan@mad.scientist.com>");
+}
+
+static void
+gst_v4ljpegsrc_class_init (GstV4lJpegSrcClass * klass)
+{
+  parent_class = g_type_class_peek_parent (klass);
+}
+
+static void
+gst_v4ljpegsrc_init (GstV4lJpegSrc * v4ljpegsrc)
+{
+  GstV4lSrc *v4lsrc = GST_V4LSRC (v4ljpegsrc);
+  GstPad *pad = v4lsrc->srcpad;
+
+  /*
+   * Stash away and then replace the getcaps and get functions on the src pad
+   */
+  v4ljpegsrc->getfn = GST_RPAD_GETFUNC (pad);
+  v4ljpegsrc->getcapsfn = GST_RPAD_GETCAPSFUNC (pad);
+
+  gst_pad_set_get_function (v4lsrc->srcpad, gst_v4ljpegsrc_get);
+  gst_pad_set_getcaps_function (v4lsrc->srcpad, gst_v4ljpegsrc_getcaps);
+  gst_pad_set_link_function (v4lsrc->srcpad, gst_v4ljpegsrc_src_link);
+}
+
+static GstPadLinkReturn
+gst_v4ljpegsrc_src_link (GstPad * pad, const GstCaps * vscapslist)
+{
+  GstV4lJpegSrc *v4ljpegsrc;
+  GstV4lSrc *v4lsrc;
+  gint w, h, palette = -1;
+  const GValue *fps;
+  GstStructure *structure;
+  gboolean was_capturing;
+  struct video_window *vwin;
+
+  v4ljpegsrc = GST_V4LJPEGSRC (gst_pad_get_parent (pad));
+  v4lsrc = GST_V4LSRC (v4ljpegsrc);
+  vwin = &GST_V4LELEMENT (v4lsrc)->vwin;
+  was_capturing = v4lsrc->is_capturing;
+
+  /* in case the buffers are active (which means that we already
+   * did capsnego before and didn't clean up), clean up anyways */
+  if (GST_V4L_IS_ACTIVE (GST_V4LELEMENT (v4lsrc))) {
+    if (was_capturing) {
+      if (!gst_v4lsrc_capture_stop (v4lsrc))
+        return GST_PAD_LINK_REFUSED;
+    }
+    if (!gst_v4lsrc_capture_deinit (v4lsrc))
+      return GST_PAD_LINK_REFUSED;
+  } else if (!GST_V4L_IS_OPEN (GST_V4LELEMENT (v4lsrc))) {
+    return GST_PAD_LINK_DELAYED;
+  }
+
+  structure = gst_caps_get_structure (vscapslist, 0);
+
+  gst_structure_get_int (structure, "width", &w);
+  gst_structure_get_int (structure, "height", &h);
+  fps = gst_structure_get_value (structure, "framerate");
+
+  GST_DEBUG_OBJECT (v4ljpegsrc, "linking with %dx%d at %d/%d fps", w, h,
+      gst_value_get_fraction_numerator (fps),
+      gst_value_get_fraction_denominator (fps));
+
+  /* set framerate if it's not already correct */
+  if (fps != gst_v4lsrc_get_fps (v4lsrc)) {
+    int fps_index = fps / 15.0 * 16;
+
+    GST_DEBUG_OBJECT (v4ljpegsrc, "Trying to set fps index %d", fps_index);
+    /* set bits 16 to 21 to 0 */
+    vwin->flags &= (0x3F00 - 1);
+    /* set bits 16 to 21 to the index */
+    vwin->flags |= fps_index << 16;
+    if (!gst_v4l_set_window_properties (GST_V4LELEMENT (v4lsrc))) {
+      return GST_PAD_LINK_DELAYED;
+    }
+  }
+
+  /*
+   * Try to set the camera to capture RGB24 
+   */
+  palette = VIDEO_PALETTE_RGB24;
+  v4lsrc->buffer_size = w * h * 3;
+
+  GST_DEBUG_OBJECT (v4ljpegsrc, "trying to set_capture %dx%d, palette %d",
+      w, h, palette);
+  /* this only fills in v4lsrc->mmap values */
+  if (!gst_v4lsrc_set_capture (v4lsrc, w, h, palette)) {
+    GST_WARNING_OBJECT (v4ljpegsrc, "could not set_capture %dx%d, palette %d",
+        w, h, palette);
+    return GST_PAD_LINK_REFUSED;
+  }
+
+  /* first try the negotiated settings using try_capture */
+  if (!gst_v4lsrc_try_capture (v4lsrc, w, h, palette)) {
+    GST_DEBUG_OBJECT (v4ljpegsrc, "failed trying palette %d for %dx%d", palette,
+        w, h);
+    return GST_PAD_LINK_REFUSED;
+  }
+
+  if (!gst_v4lsrc_capture_init (v4lsrc))
+    return GST_PAD_LINK_REFUSED;
+
+  if (was_capturing || GST_STATE (v4lsrc) == GST_STATE_PLAYING) {
+    if (!gst_v4lsrc_capture_start (v4lsrc))
+      return GST_PAD_LINK_REFUSED;
+  }
+
+  return GST_PAD_LINK_OK;
+}
+
+static GstCaps *
+gst_v4ljpegsrc_getcaps (GstPad * pad)
+{
+  GstCaps *list;
+  GstV4lJpegSrc *v4ljpegsrc = GST_V4LJPEGSRC (gst_pad_get_parent (pad));
+  GstV4lSrc *v4lsrc = GST_V4LSRC (v4ljpegsrc);
+  struct video_capability *vcap = &GST_V4LELEMENT (v4lsrc)->vcap;
+  gfloat fps = 0.0;
+
+  if (!GST_V4L_IS_OPEN (GST_V4LELEMENT (v4lsrc))) {
+    return gst_caps_new_any ();
+  }
+  if (!v4lsrc->autoprobe) {
+    /* FIXME: query current caps and return those, with _any appended */
+    return gst_caps_new_any ();
+  }
+
+  list = gst_caps_new_simple ("image/jpeg", NULL);
+  GST_DEBUG_OBJECT (v4ljpegsrc,
+      "Device reports w: %d-%d, h: %d-%d, fps: %f",
+      vcap->minwidth, vcap->maxwidth, vcap->minheight, vcap->maxheight, fps);
+
+  if (vcap->minwidth < vcap->maxwidth) {
+    gst_caps_set_simple (list, "width", GST_TYPE_INT_RANGE, vcap->minwidth,
+        vcap->maxwidth, NULL);
+  } else {
+    gst_caps_set_simple (list, "width", G_TYPE_INT, vcap->minwidth, NULL);
+  }
+  if (vcap->minheight < vcap->maxheight) {
+    gst_caps_set_simple (list, "height", GST_TYPE_INT_RANGE, vcap->minheight,
+        vcap->maxheight, NULL);
+  } else {
+    gst_caps_set_simple (list, "height", G_TYPE_INT, vcap->minheight, NULL);
+  }
+
+  if (v4lsrc->fps_list) {
+    GstStructure *structure = gst_caps_get_structure (list, 0);
+
+    gst_structure_set_value (structure, "framerate", v4lsrc->fps_list);
+  }
+  GST_DEBUG_OBJECT (v4ljpegsrc, "caps: %" GST_PTR_FORMAT, list);
+
+  return list;
+}
+
+static GstData *
+gst_v4ljpegsrc_get (GstPad * pad)
+{
+  GstV4lJpegSrc *v4ljpegsrc;
+  GstV4lSrc *v4lsrc;
+  GstData *data;
+  GstBuffer *buf;
+  GstBuffer *outbuf;
+  int jpeg_size;
+
+  g_return_val_if_fail (pad != NULL, NULL);
+  v4ljpegsrc = GST_V4LJPEGSRC (gst_pad_get_parent (pad));
+  v4lsrc = GST_V4LSRC (v4ljpegsrc);
+
+  /* Fetch from the v4lsrc class get fn.  */
+  data = v4ljpegsrc->getfn (pad);
+
+  /* If not a buffer, return it unchanged */
+  if (!data || (!GST_IS_BUFFER (data)))
+    return data;
+
+  buf = GST_BUFFER (data);
+
+  /* Confirm that the buffer contains jpeg data */
+
+  /* 
+   * Create a new subbuffer from the jpeg data 
+   * The first 2 bytes in the buffer are the size of the jpeg data
+   */
+  if (GST_BUFFER_SIZE (buf) > 2) {
+    jpeg_size = (int) (GST_READ_UINT16_LE (GST_BUFFER_DATA (buf))) * 8;
+  } else
+    jpeg_size = 0;
+
+  /* Check that the size is sensible */
+  if ((jpeg_size <= 0) || (jpeg_size > GST_BUFFER_SIZE (buf) - 2)) {
+    GST_ELEMENT_ERROR (v4ljpegsrc, STREAM, FORMAT, (NULL),
+        ("Invalid non-jpeg frame from camera"));
+    return NULL;
+  }
+
+  GST_DEBUG_OBJECT (v4ljpegsrc, "Creating JPEG subbuffer of size %d",
+      jpeg_size);
+  outbuf = gst_buffer_create_sub (buf, 2, jpeg_size);
+
+  /* Copy timestamps onto the subbuffer */
+  gst_buffer_stamp (outbuf, buf);
+
+  /* Release the main buffer */
+  gst_buffer_unref (buf);
+
+  return GST_DATA (outbuf);
+}
diff --git a/sys/v4l/gstv4lmjpegsink.c b/sys/v4l/gstv4lmjpegsink.c
new file mode 100644
index 0000000..9e12357
--- /dev/null
+++ b/sys/v4l/gstv4lmjpegsink.c
@@ -0,0 +1,430 @@
+/* GStreamer
+ *
+ * gstv4lmjpegsink.c: hardware MJPEG video sink plugin
+ *
+ * Copyright (C) 2001-2002 Ronald Bultje <rbultje@ronald.bitfreak.net>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include <config.h>
+#endif
+
+#include <string.h>
+#include "v4lmjpegsink_calls.h"
+
+GST_DEBUG_CATEGORY_STATIC (v4lmjpegsink_debug);
+#define GST_CAT_DEFAULT v4lmjpegsink_debug
+
+/* v4lmjpegsink signals and args */
+enum
+{
+  SIGNAL_FRAME_DISPLAYED,
+  LAST_SIGNAL
+};
+
+enum
+{
+  ARG_0,
+  ARG_NUMBUFS,
+  ARG_BUFSIZE,
+  ARG_X_OFFSET,
+  ARG_Y_OFFSET,
+  ARG_FRAMES_DISPLAYED,
+  ARG_FRAME_TIME
+};
+
+
+/* init functions */
+static void gst_v4lmjpegsink_base_init (gpointer g_class);
+static void gst_v4lmjpegsink_class_init (GstV4lMjpegSinkClass * klass);
+static void gst_v4lmjpegsink_init (GstV4lMjpegSink * v4lmjpegsink);
+
+/* the chain of buffers */
+static GstPadLinkReturn gst_v4lmjpegsink_sinkconnect (GstPad * pad,
+    const GstCaps * vscapslist);
+static void gst_v4lmjpegsink_chain (GstPad * pad, GstData * _data);
+
+/* get/set gst object functions */
+static void gst_v4lmjpegsink_set_property (GObject * object,
+    guint prop_id, const GValue * value, GParamSpec * pspec);
+static void gst_v4lmjpegsink_get_property (GObject * object,
+    guint prop_id, GValue * value, GParamSpec * pspec);
+static GstStateChangeReturn gst_v4lmjpegsink_change_state (GstElement *
+    element);
+static void gst_v4lmjpegsink_set_clock (GstElement * element, GstClock * clock);
+
+
+static GstElementClass *parent_class = NULL;
+static guint gst_v4lmjpegsink_signals[LAST_SIGNAL] = { 0 };
+
+
+GType
+gst_v4lmjpegsink_get_type (void)
+{
+  static GType v4lmjpegsink_type = 0;
+
+  if (!v4lmjpegsink_type) {
+    static const GTypeInfo v4lmjpegsink_info = {
+      sizeof (GstV4lMjpegSinkClass),
+      gst_v4lmjpegsink_base_init,
+      NULL,
+      (GClassInitFunc) gst_v4lmjpegsink_class_init,
+      NULL,
+      NULL,
+      sizeof (GstV4lMjpegSink),
+      0,
+      (GInstanceInitFunc) gst_v4lmjpegsink_init,
+    };
+
+    v4lmjpegsink_type =
+        g_type_register_static (GST_TYPE_V4LELEMENT, "GstV4lMjpegSink",
+        &v4lmjpegsink_info, 0);
+  }
+  return v4lmjpegsink_type;
+}
+
+static void
+gst_v4lmjpegsink_base_init (gpointer g_class)
+{
+  static GstStaticPadTemplate sink_template = GST_STATIC_PAD_TEMPLATE ("sink",
+      GST_PAD_SINK,
+      GST_PAD_ALWAYS,
+      GST_STATIC_CAPS ("image/jpeg, "
+          "width = (int) [ 1, MAX ], "
+          "height = (int) [ 1, MAX ], " "framerate = (fraction) [ 0, MAX ]")
+      );
+  GstElementClass *gstelement_class = GST_ELEMENT_CLASS (g_class);
+
+  gst_element_class_set_details_simple (gstelement_class,
+      "Video (video4linux/MJPEG) sink", "Sink/Video",
+      "Writes MJPEG-encoded frames to a zoran MJPEG/video4linux device",
+      "GStreamer maintainers <gstreamer-devel@lists.sourceforge.net>");
+
+  gst_element_class_add_static_pad_template (gstelement_class, &sink_template);
+}
+
+static void
+gst_v4lmjpegsink_class_init (GstV4lMjpegSinkClass * klass)
+{
+  GObjectClass *gobject_class;
+  GstElementClass *gstelement_class;
+
+  gobject_class = (GObjectClass *) klass;
+  gstelement_class = (GstElementClass *) klass;
+
+  parent_class = g_type_class_peek_parent (klass);
+
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_NUMBUFS,
+      g_param_spec_int ("num-buffers", "num-buffers", "num-buffers",
+          G_MININT, G_MAXINT, 0, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_BUFSIZE,
+      g_param_spec_int ("buffer-size", "buffer-size", "buffer-size",
+          G_MININT, G_MAXINT, 0, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_X_OFFSET,
+      g_param_spec_int ("x-offset", "x-offset", "x-offset",
+          G_MININT, G_MAXINT, 0, G_PARAM_WRITABLE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_Y_OFFSET,
+      g_param_spec_int ("y-offset", "y-offset", "y-offset",
+          G_MININT, G_MAXINT, 0, G_PARAM_WRITABLE | G_PARAM_STATIC_STRINGS));
+
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_FRAMES_DISPLAYED,
+      g_param_spec_int ("frames-displayed", "frames-displayed",
+          "frames-displayed", G_MININT, G_MAXINT, 0,
+          G_PARAM_READABLE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_FRAME_TIME,
+      g_param_spec_int ("frame-time", "frame-time", "frame-time", G_MININT,
+          G_MAXINT, 0, G_PARAM_READABLE | G_PARAM_STATIC_STRINGS));
+
+  GST_DEBUG_CATEGORY_INIT (v4lmjpegsink_debug, "v4lmjpegsink", 0,
+      "V4L MJPEG sink element");
+  gobject_class->set_property = gst_v4lmjpegsink_set_property;
+  gobject_class->get_property = gst_v4lmjpegsink_get_property;
+
+  gst_v4lmjpegsink_signals[SIGNAL_FRAME_DISPLAYED] =
+      g_signal_new ("frame-displayed", G_TYPE_FROM_CLASS (klass),
+      G_SIGNAL_RUN_LAST, G_STRUCT_OFFSET (GstV4lMjpegSinkClass,
+          frame_displayed), NULL, NULL, g_cclosure_marshal_VOID__VOID,
+      G_TYPE_NONE, 0);
+
+  gstelement_class->change_state = gst_v4lmjpegsink_change_state;
+  gstelement_class->set_clock = gst_v4lmjpegsink_set_clock;
+}
+
+
+static void
+gst_v4lmjpegsink_init (GstV4lMjpegSink * v4lmjpegsink)
+{
+  GstElementClass *klass = GST_ELEMENT_GET_CLASS (v4lmjpegsink);
+
+  v4lmjpegsink->sinkpad =
+      gst_pad_new_from_template (gst_element_class_get_pad_template (klass,
+          "sink"), "sink");
+  gst_element_add_pad (GST_ELEMENT (v4lmjpegsink), v4lmjpegsink->sinkpad);
+
+  gst_pad_set_chain_function (v4lmjpegsink->sinkpad, gst_v4lmjpegsink_chain);
+  gst_pad_set_link_function (v4lmjpegsink->sinkpad,
+      gst_v4lmjpegsink_sinkconnect);
+
+  v4lmjpegsink->clock = NULL;
+
+  v4lmjpegsink->width = -1;
+  v4lmjpegsink->height = -1;
+
+  v4lmjpegsink->x_offset = -1;
+  v4lmjpegsink->y_offset = -1;
+
+  v4lmjpegsink->numbufs = 64;
+  v4lmjpegsink->bufsize = 256;
+
+  GST_OBJECT_FLAG_SET (v4lmjpegsink, GST_ELEMENT_THREAD_SUGGESTED);
+}
+
+
+static GstPadLinkReturn
+gst_v4lmjpegsink_sinkconnect (GstPad * pad, const GstCaps * vscapslist)
+{
+  GstV4lMjpegSink *v4lmjpegsink;
+  GstStructure *structure;
+
+  v4lmjpegsink = GST_V4LMJPEGSINK (gst_pad_get_parent (pad));
+
+  /* in case the buffers are active (which means that we already
+   * did capsnego before and didn't clean up), clean up anyways */
+  if (GST_V4L_IS_ACTIVE (GST_V4LELEMENT (v4lmjpegsink)))
+    if (!gst_v4lmjpegsink_playback_deinit (v4lmjpegsink))
+      return GST_PAD_LINK_REFUSED;
+
+  structure = gst_caps_get_structure (vscapslist, 0);
+
+  gst_structure_get_int (structure, "width", &v4lmjpegsink->width);
+  gst_structure_get_int (structure, "height", &v4lmjpegsink->height);
+
+  if (!gst_v4lmjpegsink_set_playback (v4lmjpegsink, v4lmjpegsink->width, v4lmjpegsink->height, v4lmjpegsink->x_offset, v4lmjpegsink->y_offset, GST_V4LELEMENT (v4lmjpegsink)->vchan.norm, 0))   /* TODO: interlacing */
+    return GST_PAD_LINK_REFUSED;
+
+  /* set buffer info */
+  if (!gst_v4lmjpegsink_set_buffer (v4lmjpegsink,
+          v4lmjpegsink->numbufs, v4lmjpegsink->bufsize))
+    return GST_PAD_LINK_REFUSED;
+  if (!gst_v4lmjpegsink_playback_init (v4lmjpegsink))
+    return GST_PAD_LINK_REFUSED;
+
+  return GST_PAD_LINK_OK;
+
+}
+
+
+static void
+gst_v4lmjpegsink_set_clock (GstElement * element, GstClock * clock)
+{
+  GstV4lMjpegSink *v4mjpegsink = GST_V4LMJPEGSINK (element);
+
+  v4mjpegsink->clock = clock;
+}
+
+
+static void
+gst_v4lmjpegsink_chain (GstPad * pad, GstData * _data)
+{
+  GstBuffer *buf = GST_BUFFER (_data);
+  GstV4lMjpegSink *v4lmjpegsink;
+  gint num;
+
+  g_return_if_fail (pad != NULL);
+  g_return_if_fail (GST_IS_PAD (pad));
+  g_return_if_fail (buf != NULL);
+
+  v4lmjpegsink = GST_V4LMJPEGSINK (gst_pad_get_parent (pad));
+
+  if (v4lmjpegsink->clock) {
+    GST_DEBUG ("videosink: clock wait: %" G_GUINT64_FORMAT,
+        GST_BUFFER_TIMESTAMP (buf));
+
+    gst_element_wait (GST_ELEMENT (v4lmjpegsink), GST_BUFFER_TIMESTAMP (buf));
+  }
+#if 0
+  if (GST_BUFFER_POOL (buf) == v4lmjpegsink->bufferpool) {
+    num = GPOINTER_TO_INT (GST_BUFFER_POOL_PRIVATE (buf));
+    gst_v4lmjpegsink_play_frame (v4lmjpegsink, num);
+  } else {
+#endif
+    /* check size */
+    if (GST_BUFFER_SIZE (buf) > v4lmjpegsink->breq.size) {
+      GST_ELEMENT_ERROR (v4lmjpegsink, RESOURCE, WRITE, (NULL),
+          ("Buffer too big (%d KB), max. buffersize is %ld KB",
+              GST_BUFFER_SIZE (buf) / 1024, v4lmjpegsink->breq.size / 1024));
+      return;
+    }
+
+    /* put JPEG data to the device */
+    gst_v4lmjpegsink_wait_frame (v4lmjpegsink, &num);
+    memcpy (gst_v4lmjpegsink_get_buffer (v4lmjpegsink, num),
+        GST_BUFFER_DATA (buf), GST_BUFFER_SIZE (buf));
+    gst_v4lmjpegsink_play_frame (v4lmjpegsink, num);
+#if 0
+  }
+#endif
+
+  g_signal_emit (G_OBJECT (v4lmjpegsink),
+      gst_v4lmjpegsink_signals[SIGNAL_FRAME_DISPLAYED], 0);
+
+  gst_buffer_unref (buf);
+}
+
+
+#if 0
+static GstBuffer *
+gst_v4lmjpegsink_buffer_new (GstBufferPool * pool,
+    guint64 offset, guint size, gpointer user_data)
+{
+  GstV4lMjpegSink *v4lmjpegsink = GST_V4LMJPEGSINK (user_data);
+  GstBuffer *buffer = NULL;
+  guint8 *data;
+  gint num;
+
+  if (!GST_V4L_IS_ACTIVE (GST_V4LELEMENT (v4lmjpegsink)))
+    return NULL;
+  if (v4lmjpegsink->breq.size < size) {
+    GST_DEBUG ("Requested buffer size is too large (%d > %ld)",
+        size, v4lmjpegsink->breq.size);
+    return NULL;
+  }
+  if (!gst_v4lmjpegsink_wait_frame (v4lmjpegsink, &num))
+    return NULL;
+  data = gst_v4lmjpegsink_get_buffer (v4lmjpegsink, num);
+  if (!data)
+    return NULL;
+  buffer = gst_buffer_new ();
+  GST_BUFFER_DATA (buffer) = data;
+  GST_BUFFER_MAXSIZE (buffer) = v4lmjpegsink->breq.size;
+  GST_BUFFER_SIZE (buffer) = size;
+  GST_BUFFER_POOL (buffer) = pool;
+  GST_BUFFER_POOL_PRIVATE (buffer) = GINT_TO_POINTER (num);
+
+  /* with this flag set, we don't need our own buffer_free() function */
+  GST_BUFFER_FLAG_SET (buffer, GST_BUFFER_DONTFREE);
+
+  return buffer;
+}
+#endif
+
+
+static void
+gst_v4lmjpegsink_set_property (GObject * object,
+    guint prop_id, const GValue * value, GParamSpec * pspec)
+{
+  GstV4lMjpegSink *v4lmjpegsink;
+
+  g_return_if_fail (GST_IS_V4LMJPEGSINK (object));
+
+  v4lmjpegsink = GST_V4LMJPEGSINK (object);
+
+  switch (prop_id) {
+    case ARG_NUMBUFS:
+      v4lmjpegsink->numbufs = g_value_get_int (value);
+      break;
+    case ARG_BUFSIZE:
+      v4lmjpegsink->bufsize = g_value_get_int (value);
+      break;
+    case ARG_X_OFFSET:
+      v4lmjpegsink->x_offset = g_value_get_int (value);
+      break;
+    case ARG_Y_OFFSET:
+      v4lmjpegsink->y_offset = g_value_get_int (value);
+      break;
+    default:
+      G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
+      break;
+  }
+}
+
+
+static void
+gst_v4lmjpegsink_get_property (GObject * object,
+    guint prop_id, GValue * value, GParamSpec * pspec)
+{
+  GstV4lMjpegSink *v4lmjpegsink;
+
+  v4lmjpegsink = GST_V4LMJPEGSINK (object);
+
+  switch (prop_id) {
+    case ARG_FRAMES_DISPLAYED:
+      g_value_set_int (value, v4lmjpegsink->frames_displayed);
+      break;
+    case ARG_FRAME_TIME:
+      g_value_set_int (value, v4lmjpegsink->frame_time / 1000000);
+      break;
+    case ARG_NUMBUFS:
+      g_value_set_int (value, v4lmjpegsink->numbufs);
+      break;
+    case ARG_BUFSIZE:
+      g_value_set_int (value, v4lmjpegsink->bufsize);
+      break;
+    default:
+      G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
+      break;
+  }
+}
+
+
+static GstStateChangeReturn
+gst_v4lmjpegsink_change_state (GstElement * element, GstStateChange transition)
+{
+  GstV4lMjpegSink *v4lmjpegsink;
+  GstStateChangeReturn parent_value;
+
+  g_return_val_if_fail (GST_IS_V4LMJPEGSINK (element),
+      GST_STATE_CHANGE_FAILURE);
+  v4lmjpegsink = GST_V4LMJPEGSINK (element);
+
+  /* set up change state */
+  switch (transition) {
+    case GST_STATE_CHANGE_READY_TO_PAUSED:
+      /* we used to do buffer setup here, but that's now done
+       * right after capsnego */
+      break;
+    case GST_STATE_CHANGE_PAUSED_TO_PLAYING:
+      /* start */
+      if (!gst_v4lmjpegsink_playback_start (v4lmjpegsink))
+        return GST_STATE_CHANGE_FAILURE;
+      break;
+    case GST_STATE_CHANGE_PLAYING_TO_PAUSED:
+      /* de-queue all queued buffers */
+      if (!gst_v4lmjpegsink_playback_stop (v4lmjpegsink))
+        return GST_STATE_CHANGE_FAILURE;
+      break;
+    case GST_STATE_CHANGE_PAUSED_TO_READY:
+      /* stop playback, unmap all buffers */
+      if (!gst_v4lmjpegsink_playback_deinit (v4lmjpegsink))
+        return GST_STATE_CHANGE_FAILURE;
+      break;
+  }
+
+  if (GST_ELEMENT_CLASS (parent_class)->change_state) {
+    parent_value =
+        GST_ELEMENT_CLASS (parent_class)->change_state (element, transition);
+  } else {
+    parent_value = GST_STATE_CHANGE_FAILURE;
+  }
+
+  if (GST_ELEMENT_CLASS (parent_class)->change_state)
+    return parent_value;
+
+  return GST_STATE_CHANGE_SUCCESS;
+}
diff --git a/sys/v4l/gstv4lmjpegsrc.c b/sys/v4l/gstv4lmjpegsrc.c
new file mode 100644
index 0000000..4887642
--- /dev/null
+++ b/sys/v4l/gstv4lmjpegsrc.c
@@ -0,0 +1,867 @@
+/* GStreamer
+ *
+ * gstv4lmjpegsrc.c: hardware MJPEG video source plugin
+ *
+ * Copyright (C) 2001-2002 Ronald Bultje <rbultje@ronald.bitfreak.net>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include <config.h>
+#endif
+
+#include <string.h>
+#include "v4lmjpegsrc_calls.h"
+
+GST_DEBUG_CATEGORY (v4lmjpegsrc_debug);
+#define GST_CAT_DEFAULT v4lmjpegsrc_debug
+
+/* V4lMjpegSrc signals and args */
+enum
+{
+  SIGNAL_FRAME_CAPTURE,
+  SIGNAL_FRAME_DROP,
+  SIGNAL_FRAME_INSERT,
+  SIGNAL_FRAME_LOST,
+  LAST_SIGNAL
+};
+
+/* arguments */
+enum
+{
+  ARG_0,
+#if 0
+  ARG_X_OFFSET,
+  ARG_Y_OFFSET,
+  ARG_F_WIDTH,
+  ARG_F_HEIGHT,
+  /* normally, we would want to use subframe capture, however,
+   * for the time being it's easier if we disable it first */
+#endif
+  ARG_QUALITY,
+  ARG_NUMBUFS,
+  ARG_BUFSIZE,
+  ARG_USE_FIXED_FPS
+};
+
+GST_FORMATS_FUNCTION (GstPad *, gst_v4lmjpegsrc_get_formats,
+    GST_FORMAT_TIME, GST_FORMAT_DEFAULT);
+GST_QUERY_TYPE_FUNCTION (GstPad *, gst_v4lmjpegsrc_get_query_types,
+    GST_QUERY_POSITION);
+
+/* init functions */
+static void gst_v4lmjpegsrc_base_init (gpointer g_class);
+static void gst_v4lmjpegsrc_class_init (GstV4lMjpegSrcClass * klass);
+static void gst_v4lmjpegsrc_init (GstV4lMjpegSrc * v4lmjpegsrc);
+
+/* pad/info functions */
+static gboolean gst_v4lmjpegsrc_src_convert (GstPad * pad,
+    GstFormat src_format,
+    gint64 src_value, GstFormat * dest_format, gint64 * dest_value);
+static gboolean gst_v4lmjpegsrc_src_query (GstPad * pad,
+    GstQueryType type, GstFormat * format, gint64 * value);
+
+/* buffer functions */
+static GstPadLinkReturn gst_v4lmjpegsrc_srcconnect (GstPad * pad,
+    const GstCaps * caps);
+static GstData *gst_v4lmjpegsrc_get (GstPad * pad);
+static GstCaps *gst_v4lmjpegsrc_getcaps (GstPad * pad);
+
+/* get/set params */
+static void gst_v4lmjpegsrc_set_property (GObject * object,
+    guint prop_id, const GValue * value, GParamSpec * pspec);
+static void gst_v4lmjpegsrc_get_property (GObject * object,
+    guint prop_id, GValue * value, GParamSpec * pspec);
+
+/* set_clock function for A/V sync */
+static void gst_v4lmjpegsrc_set_clock (GstElement * element, GstClock * clock);
+
+/* state handling */
+static GstStateChangeReturn gst_v4lmjpegsrc_change_state (GstElement * element);
+
+/* requeue buffer after use */
+static void gst_v4lmjpegsrc_buffer_free (GstBuffer * buffer);
+
+static GstElementClass *parent_class = NULL;
+static guint gst_v4lmjpegsrc_signals[LAST_SIGNAL] = { 0 };
+
+
+GType
+gst_v4lmjpegsrc_get_type (void)
+{
+  static GType v4lmjpegsrc_type = 0;
+
+  if (!v4lmjpegsrc_type) {
+    static const GTypeInfo v4lmjpegsrc_info = {
+      sizeof (GstV4lMjpegSrcClass),
+      gst_v4lmjpegsrc_base_init,
+      NULL,
+      (GClassInitFunc) gst_v4lmjpegsrc_class_init,
+      NULL,
+      NULL,
+      sizeof (GstV4lMjpegSrc),
+      0,
+      (GInstanceInitFunc) gst_v4lmjpegsrc_init,
+      NULL
+    };
+
+    v4lmjpegsrc_type =
+        g_type_register_static (GST_TYPE_V4LELEMENT, "GstV4lMjpegSrc",
+        &v4lmjpegsrc_info, 0);
+  }
+  return v4lmjpegsrc_type;
+}
+
+
+static void
+gst_v4lmjpegsrc_base_init (gpointer g_class)
+{
+  static GstStaticPadTemplate src_template = GST_STATIC_PAD_TEMPLATE ("src",
+      GST_PAD_SRC,
+      GST_PAD_ALWAYS,
+      GST_STATIC_CAPS ("image/jpeg, "
+          "width = (int) [ 0, MAX ], "
+          "height = (int) [ 0, MAX ], " "framerate = (fraction) [ 0, MAX ]")
+      );
+  GstElementClass *gstelement_class = GST_ELEMENT_CLASS (g_class);
+
+  gst_element_class_set_details_sinmple (gstelement_class,
+      "Video (video4linux/MJPEG) Source", "Source/Video",
+      "Reads MJPEG-encoded frames from a zoran MJPEG/video4linux device",
+      "GStreamer maintainers <gstreamer-devel@lists.sourceforge.net>");
+
+  gst_element_class_add_static_pad_template (gstelement_class, &src_template);
+}
+
+static void
+gst_v4lmjpegsrc_class_init (GstV4lMjpegSrcClass * klass)
+{
+  GObjectClass *gobject_class;
+  GstElementClass *gstelement_class;
+
+  gobject_class = (GObjectClass *) klass;
+  gstelement_class = (GstElementClass *) klass;
+
+  parent_class = g_type_class_peek_parent (klass);
+
+#if 0
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_X_OFFSET,
+      g_param_spec_int ("x-offset", "x_offset", "x_offset",
+          G_MININT, G_MAXINT, 0, G_PARAM_WRITABLE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_Y_OFFSET,
+      g_param_spec_int ("y-offset", "y_offset", "y_offset",
+          G_MININT, G_MAXINT, 0, G_PARAM_WRITABLE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_F_WIDTH,
+      g_param_spec_int ("frame-width", "frame_width", "frame_width",
+          G_MININT, G_MAXINT, 0, G_PARAM_WRITABLE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_F_HEIGHT,
+      g_param_spec_int ("frame-height", "frame_height", "frame_height",
+          G_MININT, G_MAXINT, 0, G_PARAM_WRITABLE | G_PARAM_STATIC_STRINGS));
+#endif
+
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_QUALITY,
+      g_param_spec_int ("quality", "Quality", "JPEG frame quality",
+          1, 100, 50, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_NUMBUFS,
+      g_param_spec_int ("num-buffers", "Num Buffers", "Number of Buffers",
+          1, 256, 64, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_BUFSIZE,
+      g_param_spec_int ("buffer-size", "Buffer Size", "Size of buffers",
+          0, 512 * 1024, 128 * 1024,
+          G_PARAM_READABLE | G_PARAM_STATIC_STRINGS));
+
+  g_object_class_install_property (G_OBJECT_CLASS (klass), ARG_USE_FIXED_FPS,
+      g_param_spec_boolean ("use-fixed-fps", "Use Fixed FPS",
+          "Drop/Insert frames to reach a certain FPS (TRUE) "
+          "or adapt FPS to suit the number of grabbed frames",
+          TRUE, G_PARAM_READWRITE | G_PARAM_STATIC_STRINGS));
+
+  /* signals */
+  gst_v4lmjpegsrc_signals[SIGNAL_FRAME_CAPTURE] =
+      g_signal_new ("frame-capture", G_TYPE_FROM_CLASS (klass),
+      G_SIGNAL_RUN_LAST, G_STRUCT_OFFSET (GstV4lMjpegSrcClass, frame_capture),
+      NULL, NULL, g_cclosure_marshal_VOID__VOID, G_TYPE_NONE, 0);
+  gst_v4lmjpegsrc_signals[SIGNAL_FRAME_DROP] =
+      g_signal_new ("frame-drop", G_TYPE_FROM_CLASS (klass), G_SIGNAL_RUN_LAST,
+      G_STRUCT_OFFSET (GstV4lMjpegSrcClass, frame_drop), NULL, NULL,
+      g_cclosure_marshal_VOID__VOID, G_TYPE_NONE, 0);
+  gst_v4lmjpegsrc_signals[SIGNAL_FRAME_INSERT] =
+      g_signal_new ("frame-insert", G_TYPE_FROM_CLASS (klass),
+      G_SIGNAL_RUN_LAST, G_STRUCT_OFFSET (GstV4lMjpegSrcClass, frame_insert),
+      NULL, NULL, g_cclosure_marshal_VOID__VOID, G_TYPE_NONE, 0);
+  gst_v4lmjpegsrc_signals[SIGNAL_FRAME_LOST] =
+      g_signal_new ("frame-lost", G_TYPE_FROM_CLASS (klass), G_SIGNAL_RUN_LAST,
+      G_STRUCT_OFFSET (GstV4lMjpegSrcClass, frame_lost), NULL, NULL,
+      g_cclosure_marshal_VOID__INT, G_TYPE_NONE, 1, G_TYPE_INT);
+
+  GST_DEBUG_CATEGORY_INIT (v4lmjpegsrc_debug, "v4lmjpegsrc", 0,
+      "V4L MJPEG source element");
+  gobject_class->set_property = gst_v4lmjpegsrc_set_property;
+  gobject_class->get_property = gst_v4lmjpegsrc_get_property;
+
+  gstelement_class->change_state = gst_v4lmjpegsrc_change_state;
+
+  gstelement_class->set_clock = gst_v4lmjpegsrc_set_clock;
+}
+
+
+static void
+gst_v4lmjpegsrc_init (GstV4lMjpegSrc * v4lmjpegsrc)
+{
+  GstElementClass *klass = GST_ELEMENT_GET_CLASS (v4lmjpegsrc);
+
+  GST_OBJECT_FLAG_SET (GST_ELEMENT (v4lmjpegsrc), GST_ELEMENT_THREAD_SUGGESTED);
+
+  v4lmjpegsrc->srcpad =
+      gst_pad_new_from_template (gst_element_class_get_pad_template (klass,
+          "src"), "src");
+  gst_element_add_pad (GST_ELEMENT (v4lmjpegsrc), v4lmjpegsrc->srcpad);
+
+  gst_pad_set_get_function (v4lmjpegsrc->srcpad, gst_v4lmjpegsrc_get);
+  gst_pad_set_getcaps_function (v4lmjpegsrc->srcpad, gst_v4lmjpegsrc_getcaps);
+  gst_pad_set_link_function (v4lmjpegsrc->srcpad, gst_v4lmjpegsrc_srcconnect);
+  gst_pad_set_convert_function (v4lmjpegsrc->srcpad,
+      gst_v4lmjpegsrc_src_convert);
+  gst_pad_set_formats_function (v4lmjpegsrc->srcpad,
+      gst_v4lmjpegsrc_get_formats);
+  gst_pad_set_query_function (v4lmjpegsrc->srcpad, gst_v4lmjpegsrc_src_query);
+  gst_pad_set_query_type_function (v4lmjpegsrc->srcpad,
+      gst_v4lmjpegsrc_get_query_types);
+
+#if 0
+  v4lmjpegsrc->frame_width = 0;
+  v4lmjpegsrc->frame_height = 0;
+  v4lmjpegsrc->x_offset = -1;
+  v4lmjpegsrc->y_offset = -1;
+#endif
+
+  v4lmjpegsrc->quality = 50;
+
+  v4lmjpegsrc->numbufs = 64;
+
+  /* no clock */
+  v4lmjpegsrc->clock = NULL;
+
+  /* fps */
+  v4lmjpegsrc->use_fixed_fps = TRUE;
+
+  v4lmjpegsrc->is_capturing = FALSE;
+}
+
+
+static gboolean
+gst_v4lmjpegsrc_get_fps (GstV4lMjpegSrc * v4lmjpegsrc, GValue * fps)
+{
+  gint norm;
+
+  g_return_val_if_fail (GST_VALUE_HOLDS_FRACTION (fps), FALSE);
+
+  if (!v4lmjpegsrc->use_fixed_fps &&
+      v4lmjpegsrc->clock != NULL && v4lmjpegsrc->handled > 0) {
+    /* try to get time from clock master and calculate fps */
+    GstClockTime time =
+        gst_clock_get_time (v4lmjpegsrc->clock) - v4lmjpegsrc->substract_time;
+    return v4lmjpegsrc->handled * GST_SECOND / time;
+  }
+
+  /* if that failed ... */
+
+  if (!GST_V4L_IS_OPEN (GST_V4LELEMENT (v4lmjpegsrc)))
+    return FALSE;
+
+  if (!gst_v4l_get_chan_norm (GST_V4LELEMENT (v4lmjpegsrc), NULL, &norm))
+    return FALSE;
+
+  if (norm == VIDEO_MODE_NTSC)
+    gst_value_set_fraction (fps, 30000, 1001);
+  else
+    gst_value_set_fraction (fps, 25, 1);
+
+  return TRUE;
+}
+
+static gboolean
+gst_v4lmjpegsrc_src_convert (GstPad * pad,
+    GstFormat src_format,
+    gint64 src_value, GstFormat * dest_format, gint64 * dest_value)
+{
+  GstV4lMjpegSrc *v4lmjpegsrc;
+  GValue fps = { 0 };
+  gboolean result = TRUE;
+
+  v4lmjpegsrc = GST_V4LMJPEGSRC (gst_pad_get_parent (pad));
+
+  g_value_init (&fps, GST_VALUE_FRACTION);
+  if (!gst_v4lmjpegsrc_get_fps (v4lmjpegsrc, &fps))
+    return FALSE;
+
+  switch (src_format) {
+    case GST_FORMAT_TIME:
+      switch (*dest_format) {
+        case GST_FORMAT_DEFAULT:
+          *dest_value = gst_util_uint64_scale (src_value,
+              gst_value_get_fraction_numerator (&fps),
+              gst_value_get_fraction_denominator (&fps) * GST_SECOND);
+          break;
+        default:
+          result = FALSE;
+      }
+      break;
+
+    case GST_FORMAT_DEFAULT:
+      switch (*dest_format) {
+        case GST_FORMAT_TIME:
+          *dest_value = src_value * gst_util_uint64_scale_int (GST_SECOND,
+              gst_value_get_fraction_denominator (&fps),
+              gst_value_get_fraction_numerator (&fps));
+          break;
+        default:
+          result = FALSE;
+      }
+      break;
+
+    default:
+      result = FALSE;
+  }
+
+  g_value_unset (&fps);
+  return result;
+}
+
+static gboolean
+gst_v4lmjpegsrc_src_query (GstPad * pad,
+    GstQueryType type, GstFormat * format, gint64 * value)
+{
+  GstV4lMjpegSrc *v4lmjpegsrc = GST_V4LMJPEGSRC (gst_pad_get_parent (pad));
+  gboolean res = TRUE;
+  GValue fps = { 0 };
+
+  g_value_init (&fps, GST_VALUE_FRACTION);
+  if (!gst_v4lmjpegsrc_get_fps (v4lmjpegsrc, &fps))
+    return FALSE;
+
+  switch (type) {
+    case GST_QUERY_POSITION:
+      switch (*format) {
+        case GST_FORMAT_TIME:
+          *value = v4lmjpegsrc->handled * gst_util_uint64_scale_int (GST_SECOND,
+              gst_value_get_fraction_denominator (&fps),
+              gst_value_get_fraction_numerator (&fps));
+          break;
+        case GST_FORMAT_DEFAULT:
+          *value = v4lmjpegsrc->handled;
+          break;
+        default:
+          res = FALSE;
+          break;
+      }
+      break;
+    default:
+      res = FALSE;
+      break;
+  }
+
+  g_value_unset (&fps);
+  return res;
+}
+
+static inline gulong
+calc_bufsize (int hor_dec, int ver_dec)
+{
+  guint8 div = hor_dec * ver_dec;
+  guint32 num = (1024 * 512) / (div);
+  guint32 result = 2;
+
+  num--;
+  while (num) {
+    num >>= 1;
+    result <<= 1;
+  }
+
+  if (result > (512 * 1024))
+    return (512 * 1024);
+  if (result < 8192)
+    return 8192;
+  return result;
+}
+
+static GstPadLinkReturn
+gst_v4lmjpegsrc_srcconnect (GstPad * pad, const GstCaps * caps)
+{
+  GstV4lMjpegSrc *v4lmjpegsrc = GST_V4LMJPEGSRC (gst_pad_get_parent (pad));
+  gint hor_dec, ver_dec;
+  gint w, h;
+  gint max_w = GST_V4LELEMENT (v4lmjpegsrc)->vcap.maxwidth,
+      max_h = GST_V4LELEMENT (v4lmjpegsrc)->vcap.maxheight;
+  gulong bufsize;
+  GstStructure *structure;
+  gboolean was_capturing;
+
+  /* in case the buffers are active (which means that we already
+   * did capsnego before and didn't clean up), clean up anyways */
+  if ((was_capturing = v4lmjpegsrc->is_capturing)) {
+    if (!gst_v4lmjpegsrc_capture_stop (v4lmjpegsrc))
+      return GST_PAD_LINK_REFUSED;
+  }
+  if (GST_V4L_IS_ACTIVE (GST_V4LELEMENT (v4lmjpegsrc))) {
+    if (!gst_v4lmjpegsrc_capture_deinit (v4lmjpegsrc))
+      return GST_PAD_LINK_REFUSED;
+  } else if (!GST_V4L_IS_OPEN (GST_V4LELEMENT (v4lmjpegsrc))) {
+    return GST_PAD_LINK_DELAYED;
+  }
+
+  /* Note: basically, we don't give a damn about the opposite caps here.
+   * that might seem odd, but it isn't. we know that the opposite caps is
+   * either NULL or has mime type image/jpeg, and in both cases, we'll set
+   * our own mime type back and it'll work. Other properties are to be set
+   * by the src, not by the opposite caps */
+
+  structure = gst_caps_get_structure (caps, 0);
+  gst_structure_get_int (structure, "width", &w);
+  gst_structure_get_int (structure, "height", &h);
+
+  /* figure out decimation */
+  if (w >= max_w) {
+    hor_dec = 1;
+  } else if (w * 2 >= max_w) {
+    hor_dec = 2;
+  } else {
+    hor_dec = 4;
+  }
+  if (h >= max_h) {
+    ver_dec = 1;
+  } else if (h * 2 >= max_h) {
+    ver_dec = 2;
+  } else {
+    ver_dec = 4;
+  }
+
+  /* calculate bufsize */
+  bufsize = calc_bufsize (hor_dec, ver_dec);
+
+  /* set buffer info */
+  if (!gst_v4lmjpegsrc_set_buffer (v4lmjpegsrc, v4lmjpegsrc->numbufs, bufsize)) {
+    return GST_PAD_LINK_REFUSED;
+  }
+
+  /* set capture parameters and mmap the buffers */
+  if (hor_dec == ver_dec) {
+    if (!gst_v4lmjpegsrc_set_capture (v4lmjpegsrc,
+            hor_dec, v4lmjpegsrc->quality)) {
+      return GST_PAD_LINK_REFUSED;
+    }
+  } else {
+    if (!gst_v4lmjpegsrc_set_capture_m (v4lmjpegsrc,
+            0, 0, max_w, max_h, hor_dec, ver_dec, v4lmjpegsrc->quality)) {
+      return GST_PAD_LINK_REFUSED;
+    }
+  }
+#if 0
+  if (!v4lmjpegsrc->frame_width && !v4lmjpegsrc->frame_height &&
+      v4lmjpegsrc->x_offset < 0 && v4lmjpegsrc->y_offset < 0 &&
+      v4lmjpegsrc->horizontal_decimation == v4lmjpegsrc->vertical_decimation) {
+    if (!gst_v4lmjpegsrc_set_capture (v4lmjpegsrc,
+            v4lmjpegsrc->horizontal_decimation, v4lmjpegsrc->quality))
+      return GST_PAD_LINK_REFUSED;
+  } else {
+    if (!gst_v4lmjpegsrc_set_capture_m (v4lmjpegsrc,
+            v4lmjpegsrc->x_offset, v4lmjpegsrc->y_offset,
+            v4lmjpegsrc->frame_width, v4lmjpegsrc->frame_height,
+            v4lmjpegsrc->horizontal_decimation,
+            v4lmjpegsrc->vertical_decimation, v4lmjpegsrc->quality))
+      return GST_PAD_LINK_REFUSED;
+  }
+#endif
+
+  if (!gst_v4lmjpegsrc_capture_init (v4lmjpegsrc))
+    return GST_PAD_LINK_REFUSED;
+
+  if (was_capturing || GST_STATE (v4lmjpegsrc) == GST_STATE_PLAYING)
+    if (!gst_v4lmjpegsrc_capture_start (v4lmjpegsrc))
+      return GST_PAD_LINK_REFUSED;
+
+  return GST_PAD_LINK_OK;
+}
+
+
+static GstData *
+gst_v4lmjpegsrc_get (GstPad * pad)
+{
+  GstV4lMjpegSrc *v4lmjpegsrc;
+  GstBuffer *buf;
+  gint num;
+  GValue fps = { 0 };
+  GstClockTime duration;
+  GstClockTime cur_frame_time;
+
+  g_return_val_if_fail (pad != NULL, NULL);
+
+  v4lmjpegsrc = GST_V4LMJPEGSRC (gst_pad_get_parent (pad));
+
+  if (v4lmjpegsrc->use_fixed_fps) {
+    g_value_init (&fps, GST_VALUE_FRACTION);
+    duration = gst_util_uint64_scale_int (GST_SECOND,
+        gst_value_get_fraction_denominator (&fps),
+        gst_value_get_fraction_numerator (&fps));
+    cur_frame_time =
+        gst_util_uint64_scale_int (v4lmjpegsrc->handled * GST_SECOND,
+        gst_value_get_fraction_denominator (&fps),
+        gst_value_get_fraction_numerator (&fps));
+
+
+    if (!gst_v4lmjpegsrc_get_fps (v4lmjpegsrc, &fps)) {
+      g_value_unset (&fps);
+      return NULL;
+    }
+  }
+
+  if (v4lmjpegsrc->need_writes > 0) {
+    /* use last frame */
+    num = v4lmjpegsrc->last_frame;
+    v4lmjpegsrc->need_writes--;
+  } else if (v4lmjpegsrc->clock && v4lmjpegsrc->use_fixed_fps) {
+    GstClockTime time;
+    gboolean have_frame = FALSE;
+
+    do {
+      /* by default, we use the frame once */
+      v4lmjpegsrc->need_writes = 1;
+
+      /* grab a frame from the device */
+      if (!gst_v4lmjpegsrc_grab_frame (v4lmjpegsrc, &num,
+              &v4lmjpegsrc->last_size))
+        return NULL;
+
+      v4lmjpegsrc->last_frame = num;
+      time = GST_TIMEVAL_TO_TIME (v4lmjpegsrc->bsync.timestamp) -
+          v4lmjpegsrc->substract_time;
+
+      /* first check whether we lost any frames according to the device */
+      if (v4lmjpegsrc->last_seq != 0) {
+        if (v4lmjpegsrc->bsync.seq - v4lmjpegsrc->last_seq > 1) {
+          v4lmjpegsrc->need_writes =
+              v4lmjpegsrc->bsync.seq - v4lmjpegsrc->last_seq;
+          g_signal_emit (G_OBJECT (v4lmjpegsrc),
+              gst_v4lmjpegsrc_signals[SIGNAL_FRAME_LOST], 0,
+              v4lmjpegsrc->bsync.seq - v4lmjpegsrc->last_seq - 1);
+        }
+      }
+      v4lmjpegsrc->last_seq = v4lmjpegsrc->bsync.seq;
+
+      /* decide how often we're going to write the frame - set
+       * v4lmjpegsrc->need_writes to (that-1) and have_frame to TRUE
+       * if we're going to write it - else, just continue.
+       * 
+       * time is generally the system or audio clock. Let's
+       * say that we've written one second of audio, then we want
+       * to have written one second of video too, within the same
+       * timeframe. This means that if time - begin_time = X sec,
+       * we want to have written X*fps frames. If we've written
+       * more - drop, if we've written less - dup... */
+      if (cur_frame_time - time > 1.5 * duration) {
+        /* yo dude, we've got too many frames here! Drop! DROP! */
+        v4lmjpegsrc->need_writes--;     /* -= (v4lmjpegsrc->handled - (time / fps)); */
+        g_signal_emit (G_OBJECT (v4lmjpegsrc),
+            gst_v4lmjpegsrc_signals[SIGNAL_FRAME_DROP], 0);
+      } else if (cur_frame_time - time < -1.5 * duration) {
+        /* this means we're lagging far behind */
+        v4lmjpegsrc->need_writes++;     /* += ((time / fps) - v4lmjpegsrc->handled); */
+        g_signal_emit (G_OBJECT (v4lmjpegsrc),
+            gst_v4lmjpegsrc_signals[SIGNAL_FRAME_INSERT], 0);
+      }
+
+      if (v4lmjpegsrc->need_writes > 0) {
+        have_frame = TRUE;
+        v4lmjpegsrc->use_num_times[num] = v4lmjpegsrc->need_writes;
+        v4lmjpegsrc->need_writes--;
+      } else {
+        gst_v4lmjpegsrc_requeue_frame (v4lmjpegsrc, num);
+      }
+    } while (!have_frame);
+  } else {
+    /* grab a frame from the device */
+    if (!gst_v4lmjpegsrc_grab_frame (v4lmjpegsrc, &num,
+            &v4lmjpegsrc->last_size))
+      return NULL;
+
+    v4lmjpegsrc->use_num_times[num] = 1;
+  }
+
+  buf = gst_buffer_new ();
+  GST_BUFFER_FREE_DATA_FUNC (buf) = gst_v4lmjpegsrc_buffer_free;
+  GST_BUFFER_PRIVATE (buf) = v4lmjpegsrc;
+  GST_BUFFER_DATA (buf) = gst_v4lmjpegsrc_get_buffer (v4lmjpegsrc, num);
+  GST_BUFFER_SIZE (buf) = v4lmjpegsrc->last_size;
+  GST_BUFFER_MAXSIZE (buf) = v4lmjpegsrc->breq.size;
+  GST_BUFFER_FLAG_SET (buf, GST_BUFFER_READONLY);
+  GST_BUFFER_FLAG_SET (buf, GST_BUFFER_DONTFREE);
+  if (v4lmjpegsrc->use_fixed_fps)
+    GST_BUFFER_TIMESTAMP (buf) = cur_frame_time;
+  else                          /* calculate time based on our own clock */
+    GST_BUFFER_TIMESTAMP (buf) =
+        GST_TIMEVAL_TO_TIME (v4lmjpegsrc->bsync.timestamp) -
+        v4lmjpegsrc->substract_time;
+
+  v4lmjpegsrc->handled++;
+  g_signal_emit (G_OBJECT (v4lmjpegsrc),
+      gst_v4lmjpegsrc_signals[SIGNAL_FRAME_CAPTURE], 0);
+
+  return GST_DATA (buf);
+}
+
+
+static GstCaps *
+gst_v4lmjpegsrc_getcaps (GstPad * pad)
+{
+  GstV4lMjpegSrc *v4lmjpegsrc = GST_V4LMJPEGSRC (gst_pad_get_parent (pad));
+  struct video_capability *vcap = &GST_V4LELEMENT (v4lmjpegsrc)->vcap;
+  GstCaps *caps;
+  GstStructure *str;
+  gint i;
+  GValue w = { 0 }, h = {
+  0}, w1 = {
+  0}, h1 = {
+  0}, fps = {
+  0};
+
+  if (!GST_V4L_IS_OPEN (GST_V4LELEMENT (v4lmjpegsrc))) {
+    return gst_caps_copy (gst_pad_get_pad_template_caps (pad));
+  }
+
+  g_value_init (&fps, GST_TYPE_FRACTION);
+  gst_return_val_if_fail (gst_v4lmjpegsrc_get_fps (v4lmjpegsrc, &fps), NULL);
+
+  caps = gst_caps_new_simple ("image/jpeg", NULL);
+  str = gst_caps_get_structure (caps, 0);
+  gst_structure_set_value (str, "framerate", &fps);
+  g_value_unset (&fps);
+
+  g_value_init (&w, GST_TYPE_LIST);
+  g_value_init (&h, GST_TYPE_LIST);
+  g_value_init (&w1, G_TYPE_INT);
+  g_value_init (&h1, G_TYPE_INT);
+  for (i = 0; i <= 2; i++) {
+    g_value_set_int (&w1, vcap->maxwidth / (1 << i));
+    g_value_set_int (&h1, vcap->maxheight / (1 << i));
+    gst_value_list_append_value (&w, &w1);
+    gst_value_list_append_value (&h, &h1);
+  }
+  g_value_unset (&h1);
+  g_value_unset (&w1);
+  gst_structure_set_value (str, "width", &w);
+  gst_structure_set_value (str, "height", &h);
+  g_value_unset (&w);
+  g_value_unset (&h);
+
+  return caps;
+}
+
+
+static void
+gst_v4lmjpegsrc_set_property (GObject * object,
+    guint prop_id, const GValue * value, GParamSpec * pspec)
+{
+  GstV4lMjpegSrc *v4lmjpegsrc;
+
+  g_return_if_fail (GST_IS_V4LMJPEGSRC (object));
+  v4lmjpegsrc = GST_V4LMJPEGSRC (object);
+
+  switch (prop_id) {
+#if 0
+    case ARG_X_OFFSET:
+      v4lmjpegsrc->x_offset = g_value_get_int (value);
+      break;
+    case ARG_Y_OFFSET:
+      v4lmjpegsrc->y_offset = g_value_get_int (value);
+      break;
+    case ARG_F_WIDTH:
+      v4lmjpegsrc->frame_width = g_value_get_int (value);
+      break;
+    case ARG_F_HEIGHT:
+      v4lmjpegsrc->frame_height = g_value_get_int (value);
+      break;
+#endif
+    case ARG_QUALITY:
+      v4lmjpegsrc->quality = g_value_get_int (value);
+      break;
+    case ARG_NUMBUFS:
+      v4lmjpegsrc->numbufs = g_value_get_int (value);
+      break;
+    case ARG_USE_FIXED_FPS:
+      if (!GST_V4L_IS_ACTIVE (GST_V4LELEMENT (v4lmjpegsrc))) {
+        v4lmjpegsrc->use_fixed_fps = g_value_get_boolean (value);
+      }
+      break;
+    default:
+      G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
+      break;
+  }
+}
+
+
+static void
+gst_v4lmjpegsrc_get_property (GObject * object,
+    guint prop_id, GValue * value, GParamSpec * pspec)
+{
+  GstV4lMjpegSrc *v4lmjpegsrc;
+
+  g_return_if_fail (GST_IS_V4LMJPEGSRC (object));
+  v4lmjpegsrc = GST_V4LMJPEGSRC (object);
+
+  switch (prop_id) {
+#if 0
+    case ARG_X_OFFSET:
+      g_value_set_int (value, v4lmjpegsrc->x_offset);
+      break;
+    case ARG_Y_OFFSET:
+      g_value_set_int (value, v4lmjpegsrc->y_offset);
+      break;
+    case ARG_F_WIDTH:
+      g_value_set_int (value, v4lmjpegsrc->frame_width);
+      break;
+    case ARG_F_HEIGHT:
+      g_value_set_int (value, v4lmjpegsrc->frame_height);
+      break;
+#endif
+    case ARG_QUALITY:
+      g_value_set_int (value, v4lmjpegsrc->quality);
+      break;
+    case ARG_NUMBUFS:
+      if (GST_V4L_IS_ACTIVE (GST_V4LELEMENT (v4lmjpegsrc)))
+        g_value_set_int (value, v4lmjpegsrc->breq.count);
+      else
+        g_value_set_int (value, v4lmjpegsrc->numbufs);
+      break;
+    case ARG_BUFSIZE:
+      g_value_set_int (value, v4lmjpegsrc->breq.size);
+      break;
+    case ARG_USE_FIXED_FPS:
+      g_value_set_boolean (value, v4lmjpegsrc->use_fixed_fps);
+      break;
+    default:
+      G_OBJECT_WARN_INVALID_PROPERTY_ID (object, prop_id, pspec);
+      break;
+  }
+}
+
+
+static GstStateChangeReturn
+gst_v4lmjpegsrc_change_state (GstElement * element, GstStateChange transition)
+{
+  GstV4lMjpegSrc *v4lmjpegsrc;
+  GTimeVal time;
+
+  g_return_val_if_fail (GST_IS_V4LMJPEGSRC (element), GST_STATE_CHANGE_FAILURE);
+
+  v4lmjpegsrc = GST_V4LMJPEGSRC (element);
+
+  switch (transition) {
+    case GST_STATE_CHANGE_READY_TO_PAUSED:
+      /* actual buffer set-up used to be done here - but I moved
+       * it to capsnego itself */
+      v4lmjpegsrc->handled = 0;
+      v4lmjpegsrc->need_writes = 0;
+      v4lmjpegsrc->last_frame = 0;
+      v4lmjpegsrc->substract_time = 0;
+      break;
+    case GST_STATE_CHANGE_PAUSED_TO_PLAYING:
+      /* queue all buffer, start streaming capture */
+      if (GST_V4LELEMENT (v4lmjpegsrc)->buffer &&
+          !gst_v4lmjpegsrc_capture_start (v4lmjpegsrc))
+        return GST_STATE_CHANGE_FAILURE;
+      g_get_current_time (&time);
+      v4lmjpegsrc->substract_time = GST_TIMEVAL_TO_TIME (time) -
+          v4lmjpegsrc->substract_time;
+      v4lmjpegsrc->last_seq = 0;
+      break;
+    case GST_STATE_CHANGE_PLAYING_TO_PAUSED:
+      g_get_current_time (&time);
+      v4lmjpegsrc->substract_time = GST_TIMEVAL_TO_TIME (time) -
+          v4lmjpegsrc->substract_time;
+      /* de-queue all queued buffers */
+      if (v4lmjpegsrc->is_capturing &&
+          !gst_v4lmjpegsrc_capture_stop (v4lmjpegsrc))
+        return GST_STATE_CHANGE_FAILURE;
+      break;
+    case GST_STATE_CHANGE_PAUSED_TO_READY:
+      /* stop capturing, unmap all buffers */
+      if (GST_V4LELEMENT (v4lmjpegsrc)->buffer &&
+          !gst_v4lmjpegsrc_capture_deinit (v4lmjpegsrc))
+        return GST_STATE_CHANGE_FAILURE;
+      break;
+  }
+
+  if (GST_ELEMENT_CLASS (parent_class)->change_state)
+    return GST_ELEMENT_CLASS (parent_class)->change_state (element, transition);
+
+  return GST_STATE_CHANGE_SUCCESS;
+}
+
+
+static void
+gst_v4lmjpegsrc_set_clock (GstElement * element, GstClock * clock)
+{
+  GST_V4LMJPEGSRC (element)->clock = clock;
+}
+
+
+#if 0
+static GstBuffer *
+gst_v4lmjpegsrc_buffer_new (GstBufferPool * pool,
+    guint64 offset, guint size, gpointer user_data)
+{
+  GstBuffer *buffer;
+  GstV4lMjpegSrc *v4lmjpegsrc = GST_V4LMJPEGSRC (user_data);
+
+  if (!GST_V4L_IS_ACTIVE (GST_V4LELEMENT (v4lmjpegsrc)))
+    return NULL;
+
+  buffer = gst_buffer_new ();
+  if (!buffer)
+    return NULL;
+
+  /* TODO: add interlacing info to buffer as metadata */
+  GST_BUFFER_MAXSIZE (buffer) = v4lmjpegsrc->breq.size;
+  GST_BUFFER_FLAG_SET (buffer, GST_BUFFER_DONTFREE);
+
+  return buffer;
+}
+#endif
+
+static void
+gst_v4lmjpegsrc_buffer_free (GstBuffer * buf)
+{
+  GstV4lMjpegSrc *v4lmjpegsrc = GST_V4LMJPEGSRC (GST_BUFFER_PRIVATE (buf));
+  int n;
+
+  if (gst_element_get_state (GST_ELEMENT (v4lmjpegsrc)) != GST_STATE_PLAYING)
+    return;                     /* we've already cleaned up ourselves */
+
+  for (n = 0; n < v4lmjpegsrc->breq.count; n++)
+    if (GST_BUFFER_DATA (buf) == gst_v4lmjpegsrc_get_buffer (v4lmjpegsrc, n)) {
+      v4lmjpegsrc->use_num_times[n]--;
+      if (v4lmjpegsrc->use_num_times[n] <= 0) {
+        gst_v4lmjpegsrc_requeue_frame (v4lmjpegsrc, n);
+      }
+      break;
+    }
+
+  if (n == v4lmjpegsrc->breq.count)
+    GST_ELEMENT_ERROR (v4lmjpegsrc, RESOURCE, TOO_LAZY, (NULL),
+        ("Couldn't find the buffer"));
+}
diff --git a/sys/v4l/gstv4lxoverlay.c b/sys/v4l/gstv4lxoverlay.c
index 5867caf..c9a1c93 100644
--- a/sys/v4l/gstv4lxoverlay.c
+++ b/sys/v4l/gstv4lxoverlay.c
@@ -32,6 +32,7 @@
 #include <X11/extensions/Xv.h>
 #include <X11/extensions/Xvlib.h>
 
+#include <gst/glib-compat-private.h>
 #include "gstv4lxoverlay.h"
 #include "gstv4lelement.h"
 #include "v4l_calls.h"
diff --git a/sys/v4l/v4l_calls.c b/sys/v4l/v4l_calls.c
index b2b7573..3f8e16b 100644
--- a/sys/v4l/v4l_calls.c
+++ b/sys/v4l/v4l_calls.c
@@ -36,6 +36,7 @@
 #include <gst/gst.h>
 #include <gst/interfaces/tuner.h>
 #include <gst/interfaces/colorbalance.h>
+#include <gst/glib-compat-private.h>
 
 #include "v4l_calls.h"
 #include "gstv4ltuner.h"
diff --git a/sys/v4l/v4lmjpegsink_calls.c b/sys/v4l/v4lmjpegsink_calls.c
new file mode 100644
index 0000000..416f80e
--- /dev/null
+++ b/sys/v4l/v4lmjpegsink_calls.c
@@ -0,0 +1,525 @@
+/* GStreamer
+ *
+ * v4lmjpegsink_calls.c: functions for hardware MJPEG video sink
+ *
+ * Copyright (C) 2001-2002 Ronald Bultje <rbultje@ronald.bitfreak.net>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include <config.h>
+#endif
+
+#include <stdlib.h>
+#include <sys/types.h>
+#include <sys/stat.h>
+#include <fcntl.h>
+#include <sys/ioctl.h>
+#include <sys/mman.h>
+#include <string.h>
+#include <errno.h>
+#include "v4lmjpegsink_calls.h"
+
+/* On some systems MAP_FAILED seems to be missing */
+#ifndef MAP_FAILED
+#define MAP_FAILED ( (caddr_t) -1 )
+#endif
+
+GST_DEBUG_CATEGORY_EXTERN (v4lmjpegsink_debug);
+#define GST_CAT_DEFAULT v4lmjpegsink_debug
+
+/******************************************************
+ * gst_v4lmjpegsink_sync_thread()
+ *   thread keeps track of played frames
+ ******************************************************/
+
+static void *
+gst_v4lmjpegsink_sync_thread (void *arg)
+{
+  GstV4lMjpegSink *v4lmjpegsink = GST_V4LMJPEGSINK (arg);
+  gint frame = 0;               /* frame that we're currently syncing on */
+
+  GST_DEBUG_OBJECT (v4lmjpegsink, "starting sync thread");
+
+#if 0
+  /* Allow easy shutting down by other processes... */
+  pthread_setcancelstate (PTHREAD_CANCEL_ENABLE, NULL);
+  pthread_setcanceltype (PTHREAD_CANCEL_ASYNCHRONOUS, NULL);
+#endif
+
+  while (1) {
+    g_mutex_lock (v4lmjpegsink->mutex_queued_frames);
+    if (!v4lmjpegsink->isqueued_queued_frames[frame]) {
+      g_cond_wait (v4lmjpegsink->cond_queued_frames[frame],
+          v4lmjpegsink->mutex_queued_frames);
+    }
+    if (v4lmjpegsink->isqueued_queued_frames[frame] != 1) {
+      g_mutex_unlock (v4lmjpegsink->mutex_queued_frames);
+      goto end;
+    }
+    g_mutex_unlock (v4lmjpegsink->mutex_queued_frames);
+
+    GST_DEBUG_OBJECT (v4lmjpegsink, "thread-syncing on next frame");
+    if (ioctl (GST_V4LELEMENT (v4lmjpegsink)->video_fd, MJPIOC_SYNC,
+            &(v4lmjpegsink->bsync)) < 0) {
+      GST_ELEMENT_ERROR (v4lmjpegsink, RESOURCE, SYNC, (NULL),
+          ("Failed to sync on frame %d: %s", frame, g_strerror (errno)));
+      g_mutex_lock (v4lmjpegsink->mutex_queued_frames);
+      v4lmjpegsink->isqueued_queued_frames[frame] = -1;
+      g_cond_broadcast (v4lmjpegsink->cond_queued_frames[frame]);
+      g_mutex_unlock (v4lmjpegsink->mutex_queued_frames);
+      goto end;
+    } else {
+      /* be sure that we're not confusing */
+      if (frame != v4lmjpegsink->bsync.frame) {
+        GST_ELEMENT_ERROR (v4lmjpegsink, CORE, TOO_LAZY, (NULL),
+            ("Internal error: frame number confusion"));
+        goto end;
+      }
+      g_mutex_lock (v4lmjpegsink->mutex_queued_frames);
+      v4lmjpegsink->isqueued_queued_frames[frame] = 0;
+      g_cond_broadcast (v4lmjpegsink->cond_queued_frames[frame]);
+      g_mutex_unlock (v4lmjpegsink->mutex_queued_frames);
+    }
+
+    frame = (frame + 1) % v4lmjpegsink->breq.count;
+  }
+
+end:
+  GST_DEBUG_OBJECT (v4lmjpegsink, "Sync thread got signalled to exit");
+  g_thread_exit (NULL);
+  return NULL;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsink_queue_frame()
+ *   queue a frame for playback
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+static gboolean
+gst_v4lmjpegsink_queue_frame (GstV4lMjpegSink * v4lmjpegsink, gint num)
+{
+  GST_DEBUG_OBJECT (v4lmjpegsink, "queueing frame %d", num);
+
+  /* queue on this frame */
+  if (ioctl (GST_V4LELEMENT (v4lmjpegsink)->video_fd, MJPIOC_QBUF_PLAY,
+          &num) < 0) {
+    GST_ELEMENT_ERROR (v4lmjpegsink, RESOURCE, WRITE, (NULL),
+        ("Failed to queue frame %d: %s", num, g_strerror (errno)));
+    return FALSE;
+  }
+
+  g_mutex_lock (v4lmjpegsink->mutex_queued_frames);
+  v4lmjpegsink->isqueued_queued_frames[num] = 1;
+  g_cond_broadcast (v4lmjpegsink->cond_queued_frames[num]);
+  g_mutex_unlock (v4lmjpegsink->mutex_queued_frames);
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsink_sync_frame()
+ *   wait for a frame to be finished playing
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+static gboolean
+gst_v4lmjpegsink_sync_frame (GstV4lMjpegSink * v4lmjpegsink, gint * num)
+{
+  GST_DEBUG_OBJECT (v4lmjpegsink, "syncing on next frame");
+
+  /* calculate next frame */
+  v4lmjpegsink->current_frame =
+      (v4lmjpegsink->current_frame + 1) % v4lmjpegsink->breq.count;
+  *num = v4lmjpegsink->current_frame;
+
+  g_mutex_lock (v4lmjpegsink->mutex_queued_frames);
+  if (v4lmjpegsink->isqueued_queued_frames[*num] == 1) {
+    g_cond_wait (v4lmjpegsink->cond_queued_frames[*num],
+        v4lmjpegsink->mutex_queued_frames);
+  }
+  if (v4lmjpegsink->isqueued_queued_frames[*num] != 0) {
+    g_mutex_unlock (v4lmjpegsink->mutex_queued_frames);
+    return FALSE;
+  } else
+    g_mutex_unlock (v4lmjpegsink->mutex_queued_frames);
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsink_set_buffer()
+ *   set buffer options
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsink_set_buffer (GstV4lMjpegSink * v4lmjpegsink,
+    gint numbufs, gint bufsize)
+{
+  GST_DEBUG_OBJECT (v4lmjpegsink,
+      "setting buffer info to numbufs = %d, bufsize = %d KB", numbufs, bufsize);
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsink));
+  GST_V4L_CHECK_NOT_ACTIVE (GST_V4LELEMENT (v4lmjpegsink));
+
+  v4lmjpegsink->breq.size = bufsize * 1024;
+  v4lmjpegsink->breq.count = numbufs;
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsink_set_playback()
+ *   set playback options (video, interlacing, etc.)
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsink_set_playback (GstV4lMjpegSink * v4lmjpegsink,
+    gint width,
+    gint height, gint x_offset, gint y_offset, gint norm, gint interlacing)
+{
+  gint mw, mh;
+  struct mjpeg_params bparm;
+
+  GST_DEBUG_OBJECT (v4lmjpegsink,
+      "setting size=%dx%d, X/Y offsets=%d/%d, norm=%d, interlacing=%d\n",
+      width, height, x_offset, y_offset, norm, interlacing);
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsink));
+  /*GST_V4L_CHECK_NOT_ACTIVE(GST_V4LELEMENT(v4lmjpegsink)); */
+
+  if (ioctl (GST_V4LELEMENT (v4lmjpegsink)->video_fd, MJPIOC_G_PARAMS,
+          &bparm) < 0) {
+    GST_ELEMENT_ERROR (v4lmjpegsink, RESOURCE, SETTINGS, (NULL),
+        GST_ERROR_SYSTEM);
+    return FALSE;
+  }
+
+  bparm.input = 0;
+  bparm.norm = norm;
+  bparm.decimation = 0;         /* we'll set proper values later on */
+
+  /* maxwidth is broken on marvel cards */
+  mw = GST_V4LELEMENT (v4lmjpegsink)->vcap.maxwidth;
+  if (mw != 768 && mw != 640)
+    mw = 720;
+  mh = (norm == VIDEO_MODE_NTSC ? 480 : 576);
+
+  if (width > mw || height > mh) {
+    GST_ELEMENT_ERROR (v4lmjpegsink, RESOURCE, TOO_LAZY, (NULL),
+        ("Video dimensions (%dx%d) are larger than device max (%dx%d)",
+            width, height, mw, mh));
+    return FALSE;
+  }
+
+  if (width <= mw / 4)
+    bparm.HorDcm = 4;
+  else if (width <= mw / 2)
+    bparm.HorDcm = 2;
+  else
+    bparm.HorDcm = 1;
+
+  /* TODO: add proper interlacing handling */
+#if 0
+  if (interlacing != INTERLACING_NOT_INTERLACED) {
+    bparm.field_per_buff = 2;
+    bparm.TmpDcm = 1;
+
+    if (height <= mh / 2)
+      bparm.VerDcm = 2;
+    else
+      bparm.VerDcm = 1;
+  } else
+#endif
+  {
+    if (height > mh / 2) {
+      GST_ELEMENT_ERROR (v4lmjpegsink, RESOURCE, TOO_LAZY, (NULL),
+          ("Video dimensions (%dx%d) too large for non-interlaced playback (%dx%d)",
+              width, height, mw, mh / 2));
+      return FALSE;
+    }
+
+    bparm.field_per_buff = 1;
+    bparm.TmpDcm = 2;
+
+    if (height <= mh / 4)
+      bparm.VerDcm = 2;
+    else
+      bparm.VerDcm = 1;
+  }
+
+  /* TODO: add proper interlacing handling */
+#if 0
+  bparm.odd_even = (interlacing == INTERLACING_TOP_FIRST);
+#endif
+
+  bparm.quality = 100;
+  bparm.img_width = bparm.HorDcm * width;
+  bparm.img_height = bparm.VerDcm * height / bparm.field_per_buff;
+
+  /* image X/Y offset on device */
+  if (x_offset < 0)
+    bparm.img_x = (mw - bparm.img_width) / 2;
+  else {
+    if (x_offset + bparm.img_width > mw)
+      bparm.img_x = mw - bparm.img_width;
+    else
+      bparm.img_x = x_offset;
+  }
+
+  if (y_offset < 0)
+    bparm.img_y = (mh / 2 - bparm.img_height) / 2;
+  else {
+    if (y_offset + bparm.img_height * 2 > mh)
+      bparm.img_y = mh / 2 - bparm.img_height;
+    else
+      bparm.img_y = y_offset / 2;
+  }
+
+  if (ioctl (GST_V4LELEMENT (v4lmjpegsink)->video_fd, MJPIOC_S_PARAMS,
+          &bparm) < 0) {
+    GST_ELEMENT_ERROR (v4lmjpegsink, RESOURCE, SETTINGS, (NULL),
+        GST_ERROR_SYSTEM);
+    return FALSE;
+  }
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsink_playback_init()
+ *   initialize playback system, set up buffer, etc.
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsink_playback_init (GstV4lMjpegSink * v4lmjpegsink)
+{
+  gint n;
+
+  GST_DEBUG_OBJECT (v4lmjpegsink, "initting playback subsystem");
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsink));
+  GST_V4L_CHECK_NOT_ACTIVE (GST_V4LELEMENT (v4lmjpegsink));
+
+  /* Request buffers */
+  if (ioctl (GST_V4LELEMENT (v4lmjpegsink)->video_fd, MJPIOC_REQBUFS,
+          &(v4lmjpegsink->breq)) < 0) {
+    GST_ELEMENT_ERROR (v4lmjpegsink, RESOURCE, READ, (NULL), GST_ERROR_SYSTEM);
+    return FALSE;
+  }
+
+  GST_INFO_OBJECT (v4lmjpegsink, "Got %ld buffers of size %ld KB",
+      v4lmjpegsink->breq.count, v4lmjpegsink->breq.size / 1024);
+
+  /* Map the buffers */
+  GST_V4LELEMENT (v4lmjpegsink)->buffer = mmap (0,
+      v4lmjpegsink->breq.count * v4lmjpegsink->breq.size,
+      PROT_READ | PROT_WRITE, MAP_SHARED,
+      GST_V4LELEMENT (v4lmjpegsink)->video_fd, 0);
+  if (GST_V4LELEMENT (v4lmjpegsink)->buffer == MAP_FAILED) {
+    GST_ELEMENT_ERROR (v4lmjpegsink, RESOURCE, TOO_LAZY, (NULL),
+        ("Error mapping video buffers: %s", g_strerror (errno)));
+    GST_V4LELEMENT (v4lmjpegsink)->buffer = NULL;
+    return FALSE;
+  }
+
+  /* allocate/init the GThread thingies */
+  v4lmjpegsink->mutex_queued_frames = g_mutex_new ();
+  v4lmjpegsink->isqueued_queued_frames = (gint8 *)
+      malloc (sizeof (gint8) * v4lmjpegsink->breq.count);
+  if (!v4lmjpegsink->isqueued_queued_frames) {
+    GST_ELEMENT_ERROR (v4lmjpegsink, RESOURCE, TOO_LAZY, (NULL),
+        ("Failed to create queue tracker: %s", g_strerror (errno)));
+    return FALSE;
+  }
+  v4lmjpegsink->cond_queued_frames = (GCond **)
+      malloc (sizeof (GCond *) * v4lmjpegsink->breq.count);
+  if (!v4lmjpegsink->cond_queued_frames) {
+    GST_ELEMENT_ERROR (v4lmjpegsink, RESOURCE, TOO_LAZY, (NULL),
+        ("Failed to create queue condition holders: %s", g_strerror (errno)));
+    return FALSE;
+  }
+  for (n = 0; n < v4lmjpegsink->breq.count; n++)
+    v4lmjpegsink->cond_queued_frames[n] = g_cond_new ();
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsink_playback_start()
+ *   start playback system
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsink_playback_start (GstV4lMjpegSink * v4lmjpegsink)
+{
+  GError *error;
+  gint n;
+
+  GST_DEBUG_OBJECT (v4lmjpegsink, "starting playback");
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsink));
+  GST_V4L_CHECK_ACTIVE (GST_V4LELEMENT (v4lmjpegsink));
+
+  /* mark all buffers as unqueued */
+  for (n = 0; n < v4lmjpegsink->breq.count; n++)
+    v4lmjpegsink->isqueued_queued_frames[n] = 0;
+
+  v4lmjpegsink->current_frame = -1;
+
+  /* create sync() thread */
+  v4lmjpegsink->thread_queued_frames =
+      g_thread_create (gst_v4lmjpegsink_sync_thread, (void *) v4lmjpegsink,
+      TRUE, &error);
+  if (!v4lmjpegsink->thread_queued_frames) {
+    GST_ELEMENT_ERROR (v4lmjpegsink, RESOURCE, TOO_LAZY, (NULL),
+        ("Failed to create sync thread: %s", error->message));
+    return FALSE;
+  }
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsink_get_buffer()
+ *   get address of a buffer
+ * return value: buffer's address or NULL
+ ******************************************************/
+
+guint8 *
+gst_v4lmjpegsink_get_buffer (GstV4lMjpegSink * v4lmjpegsink, gint num)
+{
+  /*GST_DEBUG_OBJECT (v4lmjpegsink, gst_v4lmjpegsink_get_buffer(), num = %d", num); */
+
+  if (!GST_V4L_IS_ACTIVE (GST_V4LELEMENT (v4lmjpegsink)) ||
+      !GST_V4L_IS_OPEN (GST_V4LELEMENT (v4lmjpegsink)))
+    return NULL;
+
+  if (num < 0 || num >= v4lmjpegsink->breq.count)
+    return NULL;
+
+  return GST_V4LELEMENT (v4lmjpegsink)->buffer +
+      (v4lmjpegsink->breq.size * num);
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsink_play_frame()
+ *   queue a new buffer
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsink_play_frame (GstV4lMjpegSink * v4lmjpegsink, gint num)
+{
+  GST_DEBUG_OBJECT (v4lmjpegsink, "playing frame %d", num);
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsink));
+  GST_V4L_CHECK_ACTIVE (GST_V4LELEMENT (v4lmjpegsink));
+
+  if (!gst_v4lmjpegsink_queue_frame (v4lmjpegsink, num))
+    return FALSE;
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsink_wait_frame()
+ *   wait for buffer to be actually played
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsink_wait_frame (GstV4lMjpegSink * v4lmjpegsink, gint * num)
+{
+  GST_DEBUG_OBJECT (v4lmjpegsink,
+      "waiting for next frame to be finished playing");
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsink));
+  GST_V4L_CHECK_ACTIVE (GST_V4LELEMENT (v4lmjpegsink));
+
+  if (!gst_v4lmjpegsink_sync_frame (v4lmjpegsink, num))
+    return FALSE;
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsink_playback_stop()
+ *   stop playback system and sync on remaining frames
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsink_playback_stop (GstV4lMjpegSink * v4lmjpegsink)
+{
+  gint num;
+
+  GST_DEBUG_OBJECT (v4lmjpegsink, "stopping playback");
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsink));
+  GST_V4L_CHECK_ACTIVE (GST_V4LELEMENT (v4lmjpegsink));
+
+  /* mark next buffer as wrong */
+  if (!gst_v4lmjpegsink_sync_frame (v4lmjpegsink, &num) ||
+      !gst_v4lmjpegsink_queue_frame (v4lmjpegsink, num)) {
+    return FALSE;
+  }
+
+  /* .. and wait for all buffers to be queued on */
+  g_thread_join (v4lmjpegsink->thread_queued_frames);
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsink_playback_deinit()
+ *   deinitialize the playback system and unmap buffer
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsink_playback_deinit (GstV4lMjpegSink * v4lmjpegsink)
+{
+  int n;
+
+  GST_DEBUG_OBJECT (v4lmjpegsink, "quitting playback subsystem");
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsink));
+  GST_V4L_CHECK_ACTIVE (GST_V4LELEMENT (v4lmjpegsink));
+
+  /* free GThread thingies */
+  g_mutex_free (v4lmjpegsink->mutex_queued_frames);
+  for (n = 0; n < v4lmjpegsink->breq.count; n++)
+    g_cond_free (v4lmjpegsink->cond_queued_frames[n]);
+  free (v4lmjpegsink->cond_queued_frames);
+  free (v4lmjpegsink->isqueued_queued_frames);
+
+  /* unmap the buffer */
+  munmap (GST_V4LELEMENT (v4lmjpegsink)->buffer,
+      v4lmjpegsink->breq.size * v4lmjpegsink->breq.count);
+  GST_V4LELEMENT (v4lmjpegsink)->buffer = NULL;
+
+  return TRUE;
+}
diff --git a/sys/v4l/v4lmjpegsrc_calls.c b/sys/v4l/v4lmjpegsrc_calls.c
new file mode 100644
index 0000000..eb96e13
--- /dev/null
+++ b/sys/v4l/v4lmjpegsrc_calls.c
@@ -0,0 +1,577 @@
+/* GStreamer
+ *
+ * v4lmjpegsrc_calls.c: functions for hardware MJPEG video source
+ *
+ * Copyright (C) 2001-2002 Ronald Bultje <rbultje@ronald.bitfreak.net>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include <config.h>
+#endif
+
+#include <sys/types.h>
+#include <sys/stat.h>
+#include <fcntl.h>
+#include <sys/ioctl.h>
+#include <sys/mman.h>
+#include <string.h>
+#include <errno.h>
+#include "v4lmjpegsrc_calls.h"
+
+/* On some systems MAP_FAILED seems to be missing */
+#ifndef MAP_FAILED
+#define MAP_FAILED ( (caddr_t) -1 )
+#endif
+
+#define MIN_BUFFERS_QUEUED 2
+
+GST_DEBUG_CATEGORY_EXTERN (v4lmjpegsrc_debug);
+#define GST_CAT_DEFAULT v4lmjpegsrc_debug
+
+enum
+{
+  QUEUE_STATE_ERROR = -1,
+  QUEUE_STATE_READY_FOR_QUEUE,
+  QUEUE_STATE_QUEUED,
+  QUEUE_STATE_SYNCED,
+};
+
+/******************************************************
+ * gst_v4lmjpegsrc_queue_frame():
+ *   queue a frame for capturing
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+static gboolean
+gst_v4lmjpegsrc_queue_frame (GstV4lMjpegSrc * v4lmjpegsrc, gint num)
+{
+  GST_DEBUG_OBJECT (v4lmjpegsrc, "queueing frame %d", num);
+
+  if (v4lmjpegsrc->frame_queue_state[num] != QUEUE_STATE_READY_FOR_QUEUE) {
+    return FALSE;
+  }
+
+  if (ioctl (GST_V4LELEMENT (v4lmjpegsrc)->video_fd, MJPIOC_QBUF_CAPT,
+          &num) < 0) {
+    GST_ELEMENT_ERROR (v4lmjpegsrc, RESOURCE, READ, (NULL),
+        ("Error queueing a buffer (%d): %s", num, g_strerror (errno)));
+    return FALSE;
+  }
+
+  v4lmjpegsrc->frame_queue_state[num] = QUEUE_STATE_QUEUED;
+  v4lmjpegsrc->num_queued++;
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsrc_sync_next_frame():
+ *   sync on the next frame for capturing
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+static gboolean
+gst_v4lmjpegsrc_sync_next_frame (GstV4lMjpegSrc * v4lmjpegsrc, gint * num)
+{
+  GST_DEBUG_OBJECT (v4lmjpegsrc, "syncing on next frame");
+
+  if (v4lmjpegsrc->num_queued <= 0) {
+    return FALSE;
+  }
+
+  while (ioctl (GST_V4LELEMENT (v4lmjpegsrc)->video_fd,
+          MJPIOC_SYNC, &(v4lmjpegsrc->bsync)) < 0) {
+    if (errno != EINTR) {
+      GST_ELEMENT_ERROR (v4lmjpegsrc, RESOURCE, SYNC, (NULL), GST_ERROR_SYSTEM);
+      return FALSE;
+    }
+    GST_DEBUG_OBJECT (v4lmjpegsrc, "Sync got interrupted");
+  }
+
+  *num = v4lmjpegsrc->bsync.frame;
+
+  v4lmjpegsrc->frame_queue_state[*num] = QUEUE_STATE_SYNCED;
+  v4lmjpegsrc->num_queued--;
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsrc_set_buffer():
+ *   set buffer parameters (size/count)
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsrc_set_buffer (GstV4lMjpegSrc * v4lmjpegsrc,
+    gint numbufs, gint bufsize)
+{
+  GST_DEBUG_OBJECT (v4lmjpegsrc,
+      "setting buffer info to numbufs = %d, bufsize = %d KB", numbufs, bufsize);
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsrc));
+  GST_V4L_CHECK_NOT_ACTIVE (GST_V4LELEMENT (v4lmjpegsrc));
+
+  v4lmjpegsrc->breq.size = bufsize * 1024;
+  v4lmjpegsrc->breq.count = numbufs;
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsrc_set_capture():
+ *   set capture parameters (simple)
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsrc_set_capture (GstV4lMjpegSrc * v4lmjpegsrc,
+    gint decimation, gint quality)
+{
+  int norm, input, mw;
+  struct mjpeg_params bparm;
+
+  GST_DEBUG_OBJECT (v4lmjpegsrc, "setting decimation = %d, quality = %d",
+      decimation, quality);
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsrc));
+  GST_V4L_CHECK_NOT_ACTIVE (GST_V4LELEMENT (v4lmjpegsrc));
+
+  gst_v4l_get_chan_norm (GST_V4LELEMENT (v4lmjpegsrc), &input, &norm);
+
+  /* Query params for capture */
+  if (ioctl (GST_V4LELEMENT (v4lmjpegsrc)->video_fd, MJPIOC_G_PARAMS,
+          &bparm) < 0) {
+    GST_ELEMENT_ERROR (v4lmjpegsrc, RESOURCE, SETTINGS, (NULL),
+        GST_ERROR_SYSTEM);
+    return FALSE;
+  }
+
+  bparm.decimation = decimation;
+  bparm.quality = quality;
+  bparm.norm = norm;
+  bparm.input = input;
+  bparm.APP_len = 0;            /* no JPEG markers - TODO: this is definitely not right for decimation==1 */
+
+  mw = GST_V4LELEMENT (v4lmjpegsrc)->vcap.maxwidth;
+  if (mw != 768 && mw != 640) {
+    if (decimation == 1)
+      mw = 720;
+    else
+      mw = 704;
+  }
+  v4lmjpegsrc->end_width = mw / decimation;
+  v4lmjpegsrc->end_height = (norm == VIDEO_MODE_NTSC ? 480 : 576) / decimation;
+
+  /* TODO: interlacing */
+
+  /* Set params for capture */
+  if (ioctl (GST_V4LELEMENT (v4lmjpegsrc)->video_fd, MJPIOC_S_PARAMS,
+          &bparm) < 0) {
+    GST_ELEMENT_ERROR (v4lmjpegsrc, RESOURCE, SETTINGS, (NULL),
+        GST_ERROR_SYSTEM);
+    return FALSE;
+  }
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsrc_set_capture_m():
+ *   set capture parameters (advanced)
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsrc_set_capture_m (GstV4lMjpegSrc * v4lmjpegsrc,
+    gint x_offset,
+    gint y_offset,
+    gint width, gint height, gint h_decimation, gint v_decimation, gint quality)
+{
+  gint norm, input;
+  gint maxwidth;
+  struct mjpeg_params bparm;
+
+  GST_DEBUG_OBJECT (v4lmjpegsrc, "setting x_offset = %d, y_offset = %d, "
+      "width = %d, height = %d, h_decimation = %d, v_decimation = %d, quality = %d\n",
+      x_offset, y_offset, width, height, h_decimation, v_decimation, quality);
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsrc));
+  GST_V4L_CHECK_NOT_ACTIVE (GST_V4LELEMENT (v4lmjpegsrc));
+
+  gst_v4l_get_chan_norm (GST_V4LELEMENT (v4lmjpegsrc), &input, &norm);
+
+  if (GST_V4LELEMENT (v4lmjpegsrc)->vcap.maxwidth != 768 &&
+      GST_V4LELEMENT (v4lmjpegsrc)->vcap.maxwidth != 640)
+    maxwidth = 720;
+  else
+    maxwidth = GST_V4LELEMENT (v4lmjpegsrc)->vcap.maxwidth;
+
+  /* Query params for capture */
+  if (ioctl (GST_V4LELEMENT (v4lmjpegsrc)->video_fd, MJPIOC_G_PARAMS,
+          &bparm) < 0) {
+    GST_ELEMENT_ERROR (v4lmjpegsrc, RESOURCE, SETTINGS, (NULL),
+        GST_ERROR_SYSTEM);
+    return FALSE;
+  }
+
+  bparm.decimation = 0;
+  bparm.quality = quality;
+  bparm.norm = norm;
+  bparm.input = input;
+  bparm.APP_len = 0;            /* no JPEG markers - TODO: this is definitely
+                                 * not right for decimation==1 */
+
+  if (width <= 0) {
+    if (x_offset < 0)
+      x_offset = 0;
+    width = (maxwidth == 720
+        && h_decimation != 1) ? 704 : maxwidth - 2 * x_offset;
+  } else {
+    if (x_offset < 0)
+      x_offset = (maxwidth - width) / 2;
+  }
+
+  if (height <= 0) {
+    if (y_offset < 0)
+      y_offset = 0;
+    height = (norm == VIDEO_MODE_NTSC) ? 480 : 576 - 2 * y_offset;
+  } else {
+    if (y_offset < 0)
+      y_offset = ((norm == VIDEO_MODE_NTSC) ? 480 : 576 - height) / 2;
+  }
+
+  if (width + x_offset > maxwidth) {
+    GST_ELEMENT_ERROR (v4lmjpegsrc, RESOURCE, TOO_LAZY, (NULL),
+        ("Image width+offset (%d) bigger than maximum (%d)",
+            width + x_offset, maxwidth));
+    return FALSE;
+  }
+  if ((width % (bparm.HorDcm * 16)) != 0) {
+    GST_ELEMENT_ERROR (v4lmjpegsrc, STREAM, FORMAT, (NULL),
+        ("Image width (%d) not multiple of %d (required for JPEG)",
+            width, bparm.HorDcm * 16));
+    return FALSE;
+  }
+  if (height + y_offset > (norm == VIDEO_MODE_NTSC ? 480 : 576)) {
+    GST_ELEMENT_ERROR (v4lmjpegsrc, RESOURCE, TOO_LAZY, (NULL),
+        ("Image height+offset (%d) bigger than maximum (%d)",
+            height + y_offset, (norm == VIDEO_MODE_NTSC ? 480 : 576)));
+    return FALSE;
+  }
+  /* RJ: Image height must only be a multiple of 8, but geom_height
+   * is double the field height
+   */
+  if ((height % (bparm.VerDcm * 16)) != 0) {
+    GST_ELEMENT_ERROR (v4lmjpegsrc, STREAM, FORMAT, (NULL),
+        ("Image height (%d) not multiple of %d (required for JPEG)",
+            height, bparm.VerDcm * 16));
+    return FALSE;
+  }
+
+  bparm.img_x = x_offset;
+  bparm.img_width = width;
+  bparm.img_y = y_offset;
+  bparm.img_height = height;
+  bparm.HorDcm = h_decimation;
+  bparm.VerDcm = (v_decimation == 4) ? 2 : 1;
+  bparm.TmpDcm = (v_decimation == 1) ? 1 : 2;
+  bparm.field_per_buff = (v_decimation == 1) ? 2 : 1;
+
+  v4lmjpegsrc->end_width = width / h_decimation;
+  v4lmjpegsrc->end_width = height / v_decimation;
+
+  /* TODO: interlacing */
+
+  /* Set params for capture */
+  if (ioctl (GST_V4LELEMENT (v4lmjpegsrc)->video_fd, MJPIOC_S_PARAMS,
+          &bparm) < 0) {
+    GST_ELEMENT_ERROR (v4lmjpegsrc, RESOURCE, SETTINGS, (NULL),
+        GST_ERROR_SYSTEM);
+    return FALSE;
+  }
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsrc_capture_init():
+ *   initialize the capture system
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsrc_capture_init (GstV4lMjpegSrc * v4lmjpegsrc)
+{
+  GST_DEBUG_OBJECT (v4lmjpegsrc, "initting capture subsystem");
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsrc));
+  GST_V4L_CHECK_NOT_ACTIVE (GST_V4LELEMENT (v4lmjpegsrc));
+
+  /* Request buffers */
+  if (ioctl (GST_V4LELEMENT (v4lmjpegsrc)->video_fd,
+          MJPIOC_REQBUFS, &(v4lmjpegsrc->breq)) < 0) {
+    GST_ELEMENT_ERROR (v4lmjpegsrc, RESOURCE, READ, (NULL), GST_ERROR_SYSTEM);
+    return FALSE;
+  }
+
+  if (v4lmjpegsrc->breq.count < MIN_BUFFERS_QUEUED) {
+    GST_ELEMENT_ERROR (v4lmjpegsrc, RESOURCE, READ, (NULL),
+        ("Too little buffers. We got %ld, we want at least %d",
+            v4lmjpegsrc->breq.count, MIN_BUFFERS_QUEUED));
+    return FALSE;
+  }
+
+  GST_INFO_OBJECT (v4lmjpegsrc, "Got %ld buffers of size %ld KB",
+      v4lmjpegsrc->breq.count, v4lmjpegsrc->breq.size / 1024);
+
+  /* keep track of queued buffers */
+  v4lmjpegsrc->frame_queue_state = (gint8 *)
+      g_malloc (sizeof (gint8) * v4lmjpegsrc->breq.count);
+
+  /* track how often to use each frame */
+  v4lmjpegsrc->use_num_times = (gint *)
+      g_malloc (sizeof (gint) * v4lmjpegsrc->breq.count);
+
+  /* lock for the frame_state */
+  v4lmjpegsrc->mutex_queue_state = g_mutex_new ();
+  v4lmjpegsrc->cond_queue_state = g_cond_new ();
+
+  /* Map the buffers */
+  GST_V4LELEMENT (v4lmjpegsrc)->buffer = mmap (0,
+      v4lmjpegsrc->breq.count * v4lmjpegsrc->breq.size,
+      PROT_READ | PROT_WRITE, MAP_SHARED,
+      GST_V4LELEMENT (v4lmjpegsrc)->video_fd, 0);
+  if (GST_V4LELEMENT (v4lmjpegsrc)->buffer == MAP_FAILED) {
+    GST_ELEMENT_ERROR (v4lmjpegsrc, RESOURCE, TOO_LAZY, (NULL),
+        ("Error mapping video buffers: %s", g_strerror (errno)));
+    GST_V4LELEMENT (v4lmjpegsrc)->buffer = NULL;
+    return FALSE;
+  }
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsrc_capture_start():
+ *   start streaming capture
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsrc_capture_start (GstV4lMjpegSrc * v4lmjpegsrc)
+{
+  int n;
+
+  GST_DEBUG_OBJECT (v4lmjpegsrc, "starting capture");
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsrc));
+  GST_V4L_CHECK_ACTIVE (GST_V4LELEMENT (v4lmjpegsrc));
+
+  g_mutex_lock (v4lmjpegsrc->mutex_queue_state);
+
+  v4lmjpegsrc->quit = FALSE;
+  v4lmjpegsrc->num_queued = 0;
+  v4lmjpegsrc->queue_frame = 0;
+
+  /* set all buffers ready to queue , this starts streaming capture */
+  for (n = 0; n < v4lmjpegsrc->breq.count; n++) {
+    v4lmjpegsrc->frame_queue_state[n] = QUEUE_STATE_READY_FOR_QUEUE;
+    if (!gst_v4lmjpegsrc_queue_frame (v4lmjpegsrc, n)) {
+      g_mutex_unlock (v4lmjpegsrc->mutex_queue_state);
+      gst_v4lmjpegsrc_capture_stop (v4lmjpegsrc);
+      return FALSE;
+    }
+  }
+
+  v4lmjpegsrc->is_capturing = TRUE;
+  g_mutex_unlock (v4lmjpegsrc->mutex_queue_state);
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsrc_grab_frame():
+ *   grab one frame during streaming capture
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsrc_grab_frame (GstV4lMjpegSrc * v4lmjpegsrc,
+    gint * num, gint * size)
+{
+  GST_DEBUG_OBJECT (v4lmjpegsrc, "grabbing frame");
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsrc));
+  GST_V4L_CHECK_ACTIVE (GST_V4LELEMENT (v4lmjpegsrc));
+
+  g_mutex_lock (v4lmjpegsrc->mutex_queue_state);
+
+  /* do we have enough frames? */
+  while (v4lmjpegsrc->num_queued < MIN_BUFFERS_QUEUED ||
+      v4lmjpegsrc->frame_queue_state[v4lmjpegsrc->queue_frame] ==
+      QUEUE_STATE_READY_FOR_QUEUE) {
+    while (v4lmjpegsrc->frame_queue_state[v4lmjpegsrc->queue_frame] !=
+        QUEUE_STATE_READY_FOR_QUEUE && !v4lmjpegsrc->quit) {
+      GST_DEBUG_OBJECT (v4lmjpegsrc,
+          "Waiting for frames to become available (%d < %d)",
+          v4lmjpegsrc->num_queued, MIN_BUFFERS_QUEUED);
+      g_cond_wait (v4lmjpegsrc->cond_queue_state,
+          v4lmjpegsrc->mutex_queue_state);
+    }
+    if (v4lmjpegsrc->quit) {
+      g_mutex_unlock (v4lmjpegsrc->mutex_queue_state);
+      return TRUE;              /* it won't get through anyway */
+    }
+    if (!gst_v4lmjpegsrc_queue_frame (v4lmjpegsrc, v4lmjpegsrc->queue_frame)) {
+      g_mutex_unlock (v4lmjpegsrc->mutex_queue_state);
+      return FALSE;
+    }
+    v4lmjpegsrc->queue_frame =
+        (v4lmjpegsrc->queue_frame + 1) % v4lmjpegsrc->breq.count;
+  }
+
+  /* syncing on the buffer grabs it */
+  if (!gst_v4lmjpegsrc_sync_next_frame (v4lmjpegsrc, num)) {
+    return FALSE;
+  }
+
+  *size = v4lmjpegsrc->bsync.length;
+
+  g_mutex_unlock (v4lmjpegsrc->mutex_queue_state);
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsrc_get_buffer():
+ *   get the memory address of a single buffer
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+guint8 *
+gst_v4lmjpegsrc_get_buffer (GstV4lMjpegSrc * v4lmjpegsrc, gint num)
+{
+  /*DEBUG("gst_v4lmjpegsrc_get_buffer(), num = %d", num); */
+
+  if (!GST_V4L_IS_ACTIVE (GST_V4LELEMENT (v4lmjpegsrc)) ||
+      !GST_V4L_IS_OPEN (GST_V4LELEMENT (v4lmjpegsrc)))
+    return NULL;
+
+  if (num < 0 || num >= v4lmjpegsrc->breq.count)
+    return NULL;
+
+  return GST_V4LELEMENT (v4lmjpegsrc)->buffer + (v4lmjpegsrc->breq.size * num);
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsrc_requeue_frame():
+ *   requeue a frame for capturing
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsrc_requeue_frame (GstV4lMjpegSrc * v4lmjpegsrc, gint num)
+{
+  GST_DEBUG_OBJECT (v4lmjpegsrc, "requeueing frame %d", num);
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsrc));
+  GST_V4L_CHECK_ACTIVE (GST_V4LELEMENT (v4lmjpegsrc));
+
+  /* mark frame as 'ready to requeue' */
+  g_mutex_lock (v4lmjpegsrc->mutex_queue_state);
+
+  if (v4lmjpegsrc->frame_queue_state[num] != QUEUE_STATE_SYNCED) {
+    GST_ELEMENT_ERROR (v4lmjpegsrc, RESOURCE, TOO_LAZY, (NULL),
+        ("Invalid state %d (expected %d), can't requeue",
+            v4lmjpegsrc->frame_queue_state[num], QUEUE_STATE_SYNCED));
+    return FALSE;
+  }
+
+  v4lmjpegsrc->frame_queue_state[num] = QUEUE_STATE_READY_FOR_QUEUE;
+
+  /* let an optional wait know */
+  g_cond_broadcast (v4lmjpegsrc->cond_queue_state);
+
+  g_mutex_unlock (v4lmjpegsrc->mutex_queue_state);
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsrc_capture_stop():
+ *   stop streaming capture
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsrc_capture_stop (GstV4lMjpegSrc * v4lmjpegsrc)
+{
+  int n;
+
+  GST_DEBUG_OBJECT (v4lmjpegsrc, "stopping capture");
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsrc));
+  GST_V4L_CHECK_ACTIVE (GST_V4LELEMENT (v4lmjpegsrc));
+
+  g_mutex_lock (v4lmjpegsrc->mutex_queue_state);
+
+  /* make an optional pending wait stop */
+  v4lmjpegsrc->quit = TRUE;
+  g_cond_broadcast (v4lmjpegsrc->cond_queue_state);
+
+  /* sync on remaining frames */
+  while (v4lmjpegsrc->num_queued > 0) {
+    gst_v4lmjpegsrc_sync_next_frame (v4lmjpegsrc, &n);
+  }
+
+  v4lmjpegsrc->is_capturing = FALSE;
+  g_mutex_unlock (v4lmjpegsrc->mutex_queue_state);
+
+  return TRUE;
+}
+
+
+/******************************************************
+ * gst_v4lmjpegsrc_capture_deinit():
+ *   deinitialize the capture system
+ * return value: TRUE on success, FALSE on error
+ ******************************************************/
+
+gboolean
+gst_v4lmjpegsrc_capture_deinit (GstV4lMjpegSrc * v4lmjpegsrc)
+{
+  GST_DEBUG_OBJECT (v4lmjpegsrc, "quitting capture subsystem");
+  GST_V4L_CHECK_OPEN (GST_V4LELEMENT (v4lmjpegsrc));
+  GST_V4L_CHECK_ACTIVE (GST_V4LELEMENT (v4lmjpegsrc));
+
+  /* unmap the buffer */
+  munmap (GST_V4LELEMENT (v4lmjpegsrc)->buffer,
+      v4lmjpegsrc->breq.size * v4lmjpegsrc->breq.count);
+  GST_V4LELEMENT (v4lmjpegsrc)->buffer = NULL;
+
+  /* free buffer tracker */
+  g_mutex_free (v4lmjpegsrc->mutex_queue_state);
+  g_cond_free (v4lmjpegsrc->cond_queue_state);
+  g_free (v4lmjpegsrc->frame_queue_state);
+  g_free (v4lmjpegsrc->use_num_times);
+
+  return TRUE;
+}
diff --git a/sys/v4l/v4lsrc_calls.c b/sys/v4l/v4lsrc_calls.c
index 31bd6de..5428dea 100644
--- a/sys/v4l/v4lsrc_calls.c
+++ b/sys/v4l/v4lsrc_calls.c
@@ -34,6 +34,7 @@
 #include <errno.h>
 #include "v4lsrc_calls.h"
 #include <sys/time.h>
+#include <gst/glib-compat-private.h>
 
 /* number of buffers to be queued *at least* before syncing */
 #define MIN_BUFFERS_QUEUED 2
diff --git a/sys/ximage/Makefile.in b/sys/ximage/Makefile.in
index d0cc25f..1d873ee 100644
--- a/sys/ximage/Makefile.in
+++ b/sys/ximage/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = sys/ximage
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -118,10 +135,23 @@ libgstximagesink_la_OBJECTS = $(am_libgstximagesink_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstximagesink_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstximagesink_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstximagesink_la_CFLAGS) $(CFLAGS) \
 	$(libgstximagesink_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -134,22 +164,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstximagesink_la_SOURCES)
 DIST_SOURCES = $(libgstximagesink_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -442,7 +473,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -495,7 +530,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -503,6 +537,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -518,12 +554,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstximagesink.la: $(libgstximagesink_la_OBJECTS) $(libgstximagesink_la_DEPENDENCIES) $(EXTRA_libgstximagesink_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstximagesink_la_LINK) -rpath $(plugindir) $(libgstximagesink_la_OBJECTS) $(libgstximagesink_la_LIBADD) $(LIBS)
 
@@ -626,6 +664,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -770,18 +822,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/sys/ximage/ximagesink.c b/sys/ximage/ximagesink.c
index 2adcc73..7ef200a 100644
--- a/sys/ximage/ximagesink.c
+++ b/sys/ximage/ximagesink.c
@@ -115,6 +115,9 @@
 
 #include "gst/glib-compat-private.h"
 
+/* for XkbKeycodeToKeysym */
+#include <X11/XKBlib.h>
+
 GST_DEBUG_CATEGORY_EXTERN (gst_debug_ximagesink);
 #define GST_CAT_DEFAULT gst_debug_ximagesink
 
@@ -1024,6 +1027,7 @@ gst_ximagesink_handle_xevents (GstXImageSink * ximagesink)
           KeyPressMask | KeyReleaseMask |
           ButtonPressMask | ButtonReleaseMask, &e)) {
     KeySym keysym;
+    const char *key_str = NULL;
 
     /* We lock only for the X function call */
     g_mutex_unlock (ximagesink->x_lock);
@@ -1048,25 +1052,20 @@ gst_ximagesink_handle_xevents (GstXImageSink * ximagesink)
       case KeyRelease:
         /* Key pressed/released over our window. We send upstream
            events for interactivity/navigation */
-        GST_DEBUG ("ximagesink key %d pressed over window at %d,%d",
-            e.xkey.keycode, e.xkey.x, e.xkey.x);
         g_mutex_lock (ximagesink->x_lock);
-        keysym = XKeycodeToKeysym (ximagesink->xcontext->disp,
-            e.xkey.keycode, 0);
-        g_mutex_unlock (ximagesink->x_lock);
+        keysym = XkbKeycodeToKeysym (ximagesink->xcontext->disp,
+            e.xkey.keycode, 0, 0);
         if (keysym != NoSymbol) {
-          char *key_str = NULL;
-
-          g_mutex_lock (ximagesink->x_lock);
           key_str = XKeysymToString (keysym);
-          g_mutex_unlock (ximagesink->x_lock);
-          gst_navigation_send_key_event (GST_NAVIGATION (ximagesink),
-              e.type == KeyPress ? "key-press" : "key-release", key_str);
-
         } else {
-          gst_navigation_send_key_event (GST_NAVIGATION (ximagesink),
-              e.type == KeyPress ? "key-press" : "key-release", "unknown");
+          key_str = "unknown";
         }
+        g_mutex_unlock (ximagesink->x_lock);
+        GST_DEBUG_OBJECT (ximagesink,
+            "key %d pressed over window at %d,%d (%s)",
+            e.xkey.keycode, e.xkey.x, e.xkey.y, key_str);
+        gst_navigation_send_key_event (GST_NAVIGATION (ximagesink),
+            e.type == KeyPress ? "key-press" : "key-release", key_str);
         break;
       default:
         GST_DEBUG_OBJECT (ximagesink, "ximagesink unhandled X event (%d)",
diff --git a/sys/xvimage/Makefile.in b/sys/xvimage/Makefile.in
index 0b9d3de..cc2fe81 100644
--- a/sys/xvimage/Makefile.in
+++ b/sys/xvimage/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = sys/xvimage
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in
+	$(srcdir)/Makefile.in $(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -117,10 +134,23 @@ libgstxvimagesink_la_OBJECTS = $(am_libgstxvimagesink_la_OBJECTS)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 libgstxvimagesink_la_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(libgstxvimagesink_la_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(libgstxvimagesink_la_CFLAGS) $(CFLAGS) \
 	$(libgstxvimagesink_la_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -133,22 +163,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(libgstxvimagesink_la_SOURCES)
 DIST_SOURCES = $(libgstxvimagesink_la_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
@@ -441,7 +472,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -495,7 +530,6 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	@$(NORMAL_INSTALL)
-	test -z "$(plugindir)" || $(MKDIR_P) "$(DESTDIR)$(plugindir)"
 	@list='$(plugin_LTLIBRARIES)'; test -n "$(plugindir)" || list=; \
 	list2=; for p in $$list; do \
 	  if test -f $$p; then \
@@ -503,6 +537,8 @@ install-pluginLTLIBRARIES: $(plugin_LTLIBRARIES)
 	  else :; fi; \
 	done; \
 	test -z "$$list2" || { \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(plugindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(plugindir)" || exit 1; \
 	  echo " $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 '$(DESTDIR)$(plugindir)'"; \
 	  $(LIBTOOL) $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=install $(INSTALL) $(INSTALL_STRIP_FLAG) $$list2 "$(DESTDIR)$(plugindir)"; \
 	}
@@ -518,12 +554,14 @@ uninstall-pluginLTLIBRARIES:
 
 clean-pluginLTLIBRARIES:
 	-test -z "$(plugin_LTLIBRARIES)" || rm -f $(plugin_LTLIBRARIES)
-	@list='$(plugin_LTLIBRARIES)'; for p in $$list; do \
-	  dir="`echo $$p | sed -e 's|/[^/]*$$||'`"; \
-	  test "$$dir" != "$$p" || dir=.; \
-	  echo "rm -f \"$${dir}/so_locations\""; \
-	  rm -f "$${dir}/so_locations"; \
-	done
+	@list='$(plugin_LTLIBRARIES)'; \
+	locs=`for p in $$list; do echo $$p; done | \
+	      sed 's|^[^/]*$$|.|; s|/[^/]*$$||; s|$$|/so_locations|' | \
+	      sort -u`; \
+	test -z "$$locs" || { \
+	  echo rm -f $${locs}; \
+	  rm -f $${locs}; \
+	}
 libgstxvimagesink.la: $(libgstxvimagesink_la_OBJECTS) $(libgstxvimagesink_la_DEPENDENCIES) $(EXTRA_libgstxvimagesink_la_DEPENDENCIES) 
 	$(AM_V_CCLD)$(libgstxvimagesink_la_LINK) -rpath $(plugindir) $(libgstxvimagesink_la_OBJECTS) $(libgstxvimagesink_la_LIBADD) $(LIBS)
 
@@ -618,6 +656,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -762,18 +814,19 @@ uninstall-am: uninstall-pluginLTLIBRARIES
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-pluginLTLIBRARIES ctags distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-pluginLTLIBRARIES \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-pluginLTLIBRARIES
+	clean-libtool clean-pluginLTLIBRARIES cscopelist ctags \
+	distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-pluginLTLIBRARIES install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-pluginLTLIBRARIES
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/sys/xvimage/xvimagesink.c b/sys/xvimage/xvimagesink.c
index 8a7913b..29fe98c 100644
--- a/sys/xvimage/xvimagesink.c
+++ b/sys/xvimage/xvimagesink.c
@@ -109,6 +109,10 @@
 
 /* for developers: there are two useful tools : xvinfo and xvattr */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
@@ -129,6 +133,9 @@
 
 #include "gst/glib-compat-private.h"
 
+/* for XkbKeycodeToKeysym */
+#include <X11/XKBlib.h>
+
 GST_DEBUG_CATEGORY_STATIC (gst_debug_xvimagesink);
 #define GST_CAT_DEFAULT gst_debug_xvimagesink
 GST_DEBUG_CATEGORY_STATIC (GST_CAT_PERFORMANCE);
@@ -244,6 +251,8 @@ gst_xvimage_buffer_destroy (GstXvImageBuffer * xvimage)
       shmdt (xvimage->SHMInfo.shmaddr);
     }
 #endif
+    if (xvimage->xvimage)
+      XFree (xvimage->xvimage);
     goto beach;
   }
 
@@ -1230,6 +1239,7 @@ gst_xvimagesink_handle_xevents (GstXvImageSink * xvimagesink)
           KeyPressMask | KeyReleaseMask | ButtonPressMask | ButtonReleaseMask,
           &e)) {
     KeySym keysym;
+    const char *key_str = NULL;
 
     /* We lock only for the X function call */
     g_mutex_unlock (xvimagesink->x_lock);
@@ -1256,24 +1266,20 @@ gst_xvimagesink_handle_xevents (GstXvImageSink * xvimagesink)
       case KeyRelease:
         /* Key pressed/released over our window. We send upstream
            events for interactivity/navigation */
-        GST_DEBUG ("xvimagesink key %d pressed over window at %d,%d",
-            e.xkey.keycode, e.xkey.x, e.xkey.y);
         g_mutex_lock (xvimagesink->x_lock);
-        keysym = XKeycodeToKeysym (xvimagesink->xcontext->disp,
-            e.xkey.keycode, 0);
-        g_mutex_unlock (xvimagesink->x_lock);
+        keysym = XkbKeycodeToKeysym (xvimagesink->xcontext->disp,
+            e.xkey.keycode, 0, 0);
         if (keysym != NoSymbol) {
-          char *key_str = NULL;
-
-          g_mutex_lock (xvimagesink->x_lock);
           key_str = XKeysymToString (keysym);
-          g_mutex_unlock (xvimagesink->x_lock);
-          gst_navigation_send_key_event (GST_NAVIGATION (xvimagesink),
-              e.type == KeyPress ? "key-press" : "key-release", key_str);
         } else {
-          gst_navigation_send_key_event (GST_NAVIGATION (xvimagesink),
-              e.type == KeyPress ? "key-press" : "key-release", "unknown");
+          key_str = "unknown";
         }
+        g_mutex_unlock (xvimagesink->x_lock);
+        GST_DEBUG_OBJECT (xvimagesink,
+            "key %d pressed over window at %d,%d (%s)",
+            e.xkey.keycode, e.xkey.x, e.xkey.y, key_str);
+        gst_navigation_send_key_event (GST_NAVIGATION (xvimagesink),
+            e.type == KeyPress ? "key-press" : "key-release", key_str);
         break;
       default:
         GST_DEBUG ("xvimagesink unhandled X event (%d)", e.type);
@@ -1420,7 +1426,7 @@ gst_xvimagesink_get_xv_support (GstXvImageSink * xvimagesink,
     xcontext->adaptors[i] = g_strdup (adaptors[i].name);
   }
 
-  if (xvimagesink->adaptor_no >= 0 &&
+  if (xvimagesink->adaptor_no != -1 &&
       xvimagesink->adaptor_no < xcontext->nb_adaptors) {
     /* Find xv port from user defined adaptor */
     gst_lookup_xv_port_from_adaptor (xcontext, adaptors,
diff --git a/tests/Makefile.in b/tests/Makefile.in
index ca8083f..594a547 100644
--- a/tests/Makefile.in
+++ b/tests/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,6 +14,23 @@
 
 @SET_MAKE@
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -33,6 +49,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = tests
 DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
@@ -79,12 +96,18 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
 RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
@@ -94,6 +117,11 @@ RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
@@ -415,7 +443,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -477,12 +509,12 @@ clean-libtool:
 	-rm -rf .libs _libs
 
 # This directory's subdirectories are mostly independent; you can cd
-# into them and run `make' without going through this Makefile.
-# To change the values of `make' variables: instead of editing Makefiles,
-# (1) if the variable is set in `config.status', edit `config.status'
-#     (which will cause the Makefiles to be regenerated when you run `make');
-# (2) otherwise, pass the desired values on the `make' command line.
-$(RECURSIVE_TARGETS):
+# into them and run 'make' without going through this Makefile.
+# To change the values of 'make' variables: instead of editing Makefiles,
+# (1) if the variable is set in 'config.status', edit 'config.status'
+#     (which will cause the Makefiles to be regenerated when you run 'make');
+# (2) otherwise, pass the desired values on the 'make' command line.
+$(RECURSIVE_TARGETS) $(RECURSIVE_CLEAN_TARGETS):
 	@fail= failcom='exit 1'; \
 	for f in x $$MAKEFLAGS; do \
 	  case $$f in \
@@ -492,7 +524,11 @@ $(RECURSIVE_TARGETS):
 	done; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
-	list='$(SUBDIRS)'; for subdir in $$list; do \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	for subdir in $$list; do \
 	  echo "Making $$target in $$subdir"; \
 	  if test "$$subdir" = "."; then \
 	    dot_seen=yes; \
@@ -506,37 +542,6 @@ $(RECURSIVE_TARGETS):
 	if test "$$dot_seen" = "no"; then \
 	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
 	fi; test -z "$$fail"
-
-$(RECURSIVE_CLEAN_TARGETS):
-	@fail= failcom='exit 1'; \
-	for f in x $$MAKEFLAGS; do \
-	  case $$f in \
-	    *=* | --[!k]*);; \
-	    *k*) failcom='fail=yes';; \
-	  esac; \
-	done; \
-	dot_seen=no; \
-	case "$@" in \
-	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
-	  *) list='$(SUBDIRS)' ;; \
-	esac; \
-	rev=''; for subdir in $$list; do \
-	  if test "$$subdir" = "."; then :; else \
-	    rev="$$subdir $$rev"; \
-	  fi; \
-	done; \
-	rev="$$rev ."; \
-	target=`echo $@ | sed s/-recursive//`; \
-	for subdir in $$rev; do \
-	  echo "Making $$target in $$subdir"; \
-	  if test "$$subdir" = "."; then \
-	    local_target="$$target-am"; \
-	  else \
-	    local_target="$$target"; \
-	  fi; \
-	  ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
-	  || eval $$failcom; \
-	done && test -z "$$fail"
 tags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
@@ -545,6 +550,10 @@ ctags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
 	done
+cscopelist-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) cscopelist); \
+	done
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -608,6 +617,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist: cscopelist-recursive $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -643,13 +666,10 @@ distdir: $(DISTFILES)
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -770,22 +790,23 @@ ps-am:
 
 uninstall-am:
 
-.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) ctags-recursive \
-	install-am install-strip tags-recursive
+.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) \
+	cscopelist-recursive ctags-recursive install-am install-strip \
+	tags-recursive
 
 .PHONY: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) CTAGS GTAGS \
 	all all-am check check-am clean clean-generic clean-libtool \
-	ctags ctags-recursive distclean distclean-generic \
-	distclean-libtool distclean-tags distdir dvi dvi-am html \
-	html-am info info-am install install-am install-data \
-	install-data-am install-dvi install-dvi-am install-exec \
-	install-exec-am install-html install-html-am install-info \
-	install-info-am install-man install-pdf install-pdf-am \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs installdirs-am maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-generic \
-	mostlyclean-libtool pdf pdf-am ps ps-am tags tags-recursive \
-	uninstall uninstall-am
+	cscopelist cscopelist-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-libtool distclean-tags \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-dvi \
+	install-dvi-am install-exec install-exec-am install-html \
+	install-html-am install-info install-info-am install-man \
+	install-pdf install-pdf-am install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	mostlyclean mostlyclean-generic mostlyclean-libtool pdf pdf-am \
+	ps ps-am tags tags-recursive uninstall uninstall-am
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/tests/check/Makefile.am b/tests/check/Makefile.am
index 3280ba3..9874d03 100644
--- a/tests/check/Makefile.am
+++ b/tests/check/Makefile.am
@@ -394,6 +394,9 @@ elements_decodebin2_CFLAGS = $(GST_BASE_CFLAGS) $(AM_CFLAGS)
 elements_subparse_LDADD =  $(LDADD)
 elements_subparse_CFLAGS = $(CFLAGS) $(AM_CFLAGS)
 
+elements_adder_LDADD = $(GST_BASE_LIBS) $(LDADD)
+elements_adder_CFLAGS = $(GST_BASE_CFLAGS) $(AM_CFLAGS)
+
 elements_audioresample_CFLAGS = \
 	$(GST_PLUGINS_BASE_CFLAGS) \
 	$(GST_BASE_CFLAGS) \
diff --git a/tests/check/Makefile.in b/tests/check/Makefile.in
index aa49617..128e0ee 100644
--- a/tests/check/Makefile.in
+++ b/tests/check/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,8 +51,10 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
-	$(srcdir)/Makefile.in $(top_srcdir)/common/check.mak
+	$(srcdir)/Makefile.in $(top_srcdir)/common/check.mak \
+	$(top_srcdir)/depcomp
 check_PROGRAMS = $(am__EXEEXT_1) $(am__EXEEXT_2) $(am__EXEEXT_3) \
 	$(am__EXEEXT_4) $(am__EXEEXT_5) $(am__EXEEXT_6) \
 	$(am__EXEEXT_7) elements/adder$(EXEEXT) \
@@ -129,18 +147,22 @@ CONFIG_CLEAN_VPATH_FILES =
 @USE_LIBVISUAL_TRUE@am__EXEEXT_12 = elements/libvisual$(EXEEXT)
 PROGRAMS = $(noinst_PROGRAMS)
 elements_adder_SOURCES = elements/adder.c
-elements_adder_OBJECTS = adder.$(OBJEXT)
-elements_adder_LDADD = $(LDADD)
+elements_adder_OBJECTS = elements_adder-adder.$(OBJEXT)
 am__DEPENDENCIES_1 =
+am__DEPENDENCIES_2 = $(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
 elements_adder_DEPENDENCIES = $(am__DEPENDENCIES_1) \
-	$(am__DEPENDENCIES_1)
+	$(am__DEPENDENCIES_2)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
+elements_adder_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
+	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
+	$(elements_adder_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o \
+	$@
 am__dirstamp = $(am__leading_dot)dirstamp
 elements_alsa_SOURCES = elements/alsa.c
 elements_alsa_OBJECTS = elements_alsa-alsa.$(OBJEXT)
-am__DEPENDENCIES_2 = $(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
 elements_alsa_DEPENDENCIES = $(top_builddir)/gst-libs/gst/interfaces/libgstinterfaces-@GST_MAJORMINOR@.la \
 	$(am__DEPENDENCIES_2)
 elements_alsa_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
@@ -586,6 +608,18 @@ pipelines_vorbisenc_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(pipelines_vorbisenc_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) \
 	$(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -598,17 +632,16 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
 	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
 LTCXXCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) \
@@ -617,17 +650,16 @@ LTCXXCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) \
 	$(AM_CXXFLAGS) $(CXXFLAGS)
 AM_V_CXX = $(am__v_CXX_@AM_V@)
 am__v_CXX_ = $(am__v_CXX_@AM_DEFAULT_V@)
-am__v_CXX_0 = @echo "  CXX   " $@;
+am__v_CXX_0 = @echo "  CXX     " $@;
+am__v_CXX_1 = 
 CXXLD = $(CXX)
 CXXLINK = $(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CXXLD) $(AM_CXXFLAGS) \
 	$(CXXFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CXXLD = $(am__v_CXXLD_@AM_V@)
 am__v_CXXLD_ = $(am__v_CXXLD_@AM_DEFAULT_V@)
-am__v_CXXLD_0 = @echo "  CXXLD " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CXXLD_0 = @echo "  CXXLD   " $@;
+am__v_CXXLD_1 = 
 SOURCES = elements/adder.c elements/alsa.c elements/appsink.c \
 	elements/appsrc.c elements/audioconvert.c elements/audiorate.c \
 	elements/audioresample.c elements/audiotestsrc.c \
@@ -676,11 +708,18 @@ DIST_SOURCES = elements/adder.c elements/alsa.c elements/appsink.c \
 	pipelines/oggmux.c pipelines/simple-launch-lines.c \
 	pipelines/streamheader.c pipelines/theoraenc.c \
 	pipelines/vorbisdec.c pipelines/vorbisenc.c
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 HEADERS = $(noinst_HEADERS)
 ETAGS = etags
 CTAGS = ctags
-am__tty_colors = \
-red=; grn=; lgn=; blu=; std=
+am__tty_colors_dummy = \
+  mgn= red= grn= lgn= blu= brg= std=; \
+  am__color_tests=no
+am__tty_colors = $(am__tty_colors_dummy)
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 ACLOCAL = @ACLOCAL@
 ACLOCAL_AMFLAGS = @ACLOCAL_AMFLAGS@
@@ -970,7 +1009,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -1252,6 +1295,8 @@ elements_decodebin2_LDADD = $(GST_BASE_LIBS) $(LDADD)
 elements_decodebin2_CFLAGS = $(GST_BASE_CFLAGS) $(AM_CFLAGS)
 elements_subparse_LDADD = $(LDADD)
 elements_subparse_CFLAGS = $(CFLAGS) $(AM_CFLAGS)
+elements_adder_LDADD = $(GST_BASE_LIBS) $(LDADD)
+elements_adder_CFLAGS = $(GST_BASE_CFLAGS) $(AM_CFLAGS)
 elements_audioresample_CFLAGS = \
 	$(GST_PLUGINS_BASE_CFLAGS) \
 	$(GST_BASE_CFLAGS) \
@@ -1420,7 +1465,7 @@ elements/$(am__dirstamp):
 	@: > elements/$(am__dirstamp)
 elements/adder$(EXEEXT): $(elements_adder_OBJECTS) $(elements_adder_DEPENDENCIES) $(EXTRA_elements_adder_DEPENDENCIES) elements/$(am__dirstamp)
 	@rm -f elements/adder$(EXEEXT)
-	$(AM_V_CCLD)$(LINK) $(elements_adder_OBJECTS) $(elements_adder_LDADD) $(LIBS)
+	$(AM_V_CCLD)$(elements_adder_LINK) $(elements_adder_OBJECTS) $(elements_adder_LDADD) $(LIBS)
 elements/alsa$(EXEEXT): $(elements_alsa_OBJECTS) $(elements_alsa_DEPENDENCIES) $(EXTRA_elements_alsa_DEPENDENCIES) elements/$(am__dirstamp)
 	@rm -f elements/alsa$(EXEEXT)
 	$(AM_V_CCLD)$(elements_alsa_LINK) $(elements_alsa_OBJECTS) $(elements_alsa_LDADD) $(LIBS)
@@ -1623,11 +1668,11 @@ mostlyclean-compile:
 distclean-compile:
 	-rm -f *.tab.c
 
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/adder.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/audiotestsrc.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/basetime.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/capsfilter-renegotiation.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/clock-selection.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/elements_adder-adder.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/elements_alsa-alsa.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/elements_appsink-appsink.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/elements_appsrc-appsrc.Po@am__quote@
@@ -1706,19 +1751,19 @@ distclean-compile:
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
 @am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LTCOMPILE) -c -o $@ $<
 
-adder.o: elements/adder.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT adder.o -MD -MP -MF $(DEPDIR)/adder.Tpo -c -o adder.o `test -f 'elements/adder.c' || echo '$(srcdir)/'`elements/adder.c
-@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/adder.Tpo $(DEPDIR)/adder.Po
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='elements/adder.c' object='adder.o' libtool=no @AMDEPBACKSLASH@
+elements_adder-adder.o: elements/adder.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(elements_adder_CFLAGS) $(CFLAGS) -MT elements_adder-adder.o -MD -MP -MF $(DEPDIR)/elements_adder-adder.Tpo -c -o elements_adder-adder.o `test -f 'elements/adder.c' || echo '$(srcdir)/'`elements/adder.c
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/elements_adder-adder.Tpo $(DEPDIR)/elements_adder-adder.Po
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='elements/adder.c' object='elements_adder-adder.o' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o adder.o `test -f 'elements/adder.c' || echo '$(srcdir)/'`elements/adder.c
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(elements_adder_CFLAGS) $(CFLAGS) -c -o elements_adder-adder.o `test -f 'elements/adder.c' || echo '$(srcdir)/'`elements/adder.c
 
-adder.obj: elements/adder.c
-@am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -MT adder.obj -MD -MP -MF $(DEPDIR)/adder.Tpo -c -o adder.obj `if test -f 'elements/adder.c'; then $(CYGPATH_W) 'elements/adder.c'; else $(CYGPATH_W) '$(srcdir)/elements/adder.c'; fi`
-@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/adder.Tpo $(DEPDIR)/adder.Po
-@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='elements/adder.c' object='adder.obj' libtool=no @AMDEPBACKSLASH@
+elements_adder-adder.obj: elements/adder.c
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(elements_adder_CFLAGS) $(CFLAGS) -MT elements_adder-adder.obj -MD -MP -MF $(DEPDIR)/elements_adder-adder.Tpo -c -o elements_adder-adder.obj `if test -f 'elements/adder.c'; then $(CYGPATH_W) 'elements/adder.c'; else $(CYGPATH_W) '$(srcdir)/elements/adder.c'; fi`
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/elements_adder-adder.Tpo $(DEPDIR)/elements_adder-adder.Po
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='elements/adder.c' object='elements_adder-adder.obj' libtool=no @AMDEPBACKSLASH@
 @AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS) -c -o adder.obj `if test -f 'elements/adder.c'; then $(CYGPATH_W) 'elements/adder.c'; else $(CYGPATH_W) '$(srcdir)/elements/adder.c'; fi`
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(elements_adder_CFLAGS) $(CFLAGS) -c -o elements_adder-adder.obj `if test -f 'elements/adder.c'; then $(CYGPATH_W) 'elements/adder.c'; else $(CYGPATH_W) '$(srcdir)/elements/adder.c'; fi`
 
 elements_alsa-alsa.o: elements/alsa.c
 @am__fastdepCC_TRUE@	$(AM_V_CC)$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(elements_alsa_CFLAGS) $(CFLAGS) -MT elements_alsa-alsa.o -MD -MP -MF $(DEPDIR)/elements_alsa-alsa.Tpo -c -o elements_alsa-alsa.o `test -f 'elements/alsa.c' || echo '$(srcdir)/'`elements/alsa.c
@@ -2642,6 +2687,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -2655,7 +2714,7 @@ check-TESTS: $(TESTS)
 	    if test -f ./$$tst; then dir=./; \
 	    elif test -f $$tst; then dir=; \
 	    else dir="$(srcdir)/"; fi; \
-	    if $(TESTS_ENVIRONMENT) $${dir}$$tst; then \
+	    if $(TESTS_ENVIRONMENT) $${dir}$$tst $(AM_TESTS_FD_REDIRECT); then \
 	      all=`expr $$all + 1`; \
 	      case " $(XFAIL_TESTS) " in \
 	      *[\ \	]$$tst[\ \	]*) \
@@ -2886,17 +2945,17 @@ uninstall-am:
 
 .PHONY: CTAGS GTAGS all all-am check check-TESTS check-am clean \
 	clean-checkPROGRAMS clean-generic clean-libtool clean-local \
-	clean-noinstPROGRAMS ctags distclean distclean-compile \
-	distclean-generic distclean-libtool distclean-tags distdir dvi \
-	dvi-am html html-am info info-am install install-am \
-	install-data install-data-am install-dvi install-dvi-am \
-	install-exec install-exec-am install-html install-html-am \
-	install-info install-info-am install-man install-pdf \
-	install-pdf-am install-ps install-ps-am install-strip \
-	installcheck installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am
+	clean-noinstPROGRAMS cscopelist ctags distclean \
+	distclean-compile distclean-generic distclean-libtool \
+	distclean-tags distdir dvi dvi-am html html-am info info-am \
+	install install-am install-data install-data-am install-dvi \
+	install-dvi-am install-exec install-exec-am install-html \
+	install-html-am install-info install-info-am install-man \
+	install-pdf install-pdf-am install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am
 
 
 # keep target around, since it's referenced in the modules' Makefiles
@@ -2920,6 +2979,12 @@ clean-local-check:
 	CK_DEFAULT_TIMEOUT=20					\
 	$*
 
+# just like 'check', but don't run it again if it fails (useful for debugging)
+%.check-norepeat: %
+	@$(TESTS_ENVIRONMENT)					\
+	CK_DEFAULT_TIMEOUT=20					\
+	$*
+
 # run any given test in a loop
 %.torture: %
 	@for i in `seq 1 $(LOOPS)`; do				\
@@ -3045,7 +3110,8 @@ help:
 	@echo
 	@echo "make check                         -- run all checks"
 	@echo "make torture                       -- run all checks $(LOOPS) times"
-	@echo "make (dir)/(test).check            -- run the given check once"
+	@echo "make (dir)/(test).check            -- run the given check once, repeat with GST_DEBUG=*:2 if it fails"
+	@echo "make (dir)/(test).check-norepeat   -- run the given check once, but don't run it again if it fails"
 	@echo "make (dir)/(test).forever          -- run the given check forever"
 	@echo "make (dir)/(test).torture          -- run the given check $(LOOPS) times"
 	@echo
diff --git a/tests/check/elements/adder.c b/tests/check/elements/adder.c
index a6cba90..afd7444 100644
--- a/tests/check/elements/adder.c
+++ b/tests/check/elements/adder.c
@@ -32,6 +32,7 @@
 
 #include <gst/check/gstcheck.h>
 #include <gst/check/gstconsistencychecker.h>
+#include <gst/base/gstbasesrc.h>
 
 static GMainLoop *main_loop;
 
@@ -100,9 +101,10 @@ GST_START_TEST (test_event)
   GstElement *bin, *src1, *src2, *adder, *sink;
   GstBus *bus;
   GstEvent *seek_event;
+  GstStateChangeReturn state_res;
   gboolean res;
-  GstPad *srcpad;
-  GstStreamConsistency *consist;
+  GstPad *srcpad, *sinkpad;
+  GstStreamConsistency *chk_1, *chk_2, *chk_3;
 
   GST_INFO ("preparing test");
 
@@ -130,7 +132,22 @@ GST_START_TEST (test_event)
   fail_unless (res == TRUE, NULL);
 
   srcpad = gst_element_get_static_pad (adder, "src");
-  consist = gst_consistency_checker_new (srcpad);
+  chk_3 = gst_consistency_checker_new (srcpad);
+  gst_object_unref (srcpad);
+
+  /* create consistency checkers for the pads */
+  srcpad = gst_element_get_static_pad (src1, "src");
+  chk_1 = gst_consistency_checker_new (srcpad);
+  sinkpad = gst_pad_get_peer (srcpad);
+  gst_consistency_checker_add_pad (chk_3, sinkpad);
+  gst_object_unref (sinkpad);
+  gst_object_unref (srcpad);
+
+  srcpad = gst_element_get_static_pad (src2, "src");
+  chk_2 = gst_consistency_checker_new (srcpad);
+  sinkpad = gst_pad_get_peer (srcpad);
+  gst_consistency_checker_add_pad (chk_3, sinkpad);
+  gst_object_unref (sinkpad);
   gst_object_unref (srcpad);
 
   seek_event = gst_event_new_seek (1.0, GST_FORMAT_TIME,
@@ -151,32 +168,34 @@ GST_START_TEST (test_event)
   GST_INFO ("starting test");
 
   /* prepare playing */
-  res = gst_element_set_state (bin, GST_STATE_PAUSED);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  state_res = gst_element_set_state (bin, GST_STATE_PAUSED);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   /* wait for completion */
-  res = gst_element_get_state (bin, NULL, NULL, GST_CLOCK_TIME_NONE);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  state_res = gst_element_get_state (bin, NULL, NULL, GST_CLOCK_TIME_NONE);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   res = gst_element_send_event (bin, seek_event);
   fail_unless (res == TRUE, NULL);
 
   /* run pipeline */
-  res = gst_element_set_state (bin, GST_STATE_PLAYING);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  state_res = gst_element_set_state (bin, GST_STATE_PLAYING);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   g_main_loop_run (main_loop);
 
-  res = gst_element_set_state (bin, GST_STATE_NULL);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  state_res = gst_element_set_state (bin, GST_STATE_NULL);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   fail_unless (position == 2 * GST_SECOND, NULL);
 
   /* cleanup */
   g_main_loop_unref (main_loop);
-  gst_consistency_checker_free (consist);
-  gst_object_unref (G_OBJECT (bus));
-  gst_object_unref (G_OBJECT (bin));
+  gst_consistency_checker_free (chk_1);
+  gst_consistency_checker_free (chk_2);
+  gst_consistency_checker_free (chk_3);
+  gst_object_unref (bus);
+  gst_object_unref (bin);
 }
 
 GST_END_TEST;
@@ -189,6 +208,7 @@ test_play_twice_message_received (GstBus * bus, GstMessage * message,
     GstPipeline * bin)
 {
   gboolean res;
+  GstStateChangeReturn state_res;
 
   GST_INFO ("bus message from \"%" GST_PTR_FORMAT "\": %" GST_PTR_FORMAT,
       GST_MESSAGE_SRC (message), message);
@@ -197,25 +217,26 @@ test_play_twice_message_received (GstBus * bus, GstMessage * message,
     case GST_MESSAGE_SEGMENT_DONE:
       play_count++;
       if (play_count == 1) {
-        res = gst_element_set_state (GST_ELEMENT (bin), GST_STATE_READY);
-        fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+        state_res = gst_element_set_state (GST_ELEMENT (bin), GST_STATE_READY);
+        fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
         /* prepare playing again */
-        res = gst_element_set_state (GST_ELEMENT (bin), GST_STATE_PAUSED);
-        fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+        state_res = gst_element_set_state (GST_ELEMENT (bin), GST_STATE_PAUSED);
+        fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
         /* wait for completion */
-        res =
+        state_res =
             gst_element_get_state (GST_ELEMENT (bin), NULL, NULL,
             GST_CLOCK_TIME_NONE);
-        fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+        fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
         res = gst_element_send_event (GST_ELEMENT (bin),
             gst_event_ref (play_seek_event));
         fail_unless (res == TRUE, NULL);
 
-        res = gst_element_set_state (GST_ELEMENT (bin), GST_STATE_PLAYING);
-        fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+        state_res =
+            gst_element_set_state (GST_ELEMENT (bin), GST_STATE_PLAYING);
+        fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
       } else {
         g_main_loop_quit (main_loop);
       }
@@ -232,6 +253,7 @@ GST_START_TEST (test_play_twice)
   GstElement *bin, *src1, *src2, *adder, *sink;
   GstBus *bus;
   gboolean res;
+  GstStateChangeReturn state_res;
   GstPad *srcpad;
   GstStreamConsistency *consist;
 
@@ -278,14 +300,14 @@ GST_START_TEST (test_play_twice)
   GST_INFO ("starting test");
 
   /* prepare playing */
-  res = gst_element_set_state (bin, GST_STATE_PAUSED);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  state_res = gst_element_set_state (bin, GST_STATE_PAUSED);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   /* wait for completion */
-  res =
+  state_res =
       gst_element_get_state (GST_ELEMENT (bin), NULL, NULL,
       GST_CLOCK_TIME_NONE);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   res = gst_element_send_event (bin, gst_event_ref (play_seek_event));
   fail_unless (res == TRUE, NULL);
@@ -293,13 +315,13 @@ GST_START_TEST (test_play_twice)
   GST_INFO ("seeked");
 
   /* run pipeline */
-  res = gst_element_set_state (bin, GST_STATE_PLAYING);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  state_res = gst_element_set_state (bin, GST_STATE_PLAYING);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   g_main_loop_run (main_loop);
 
-  res = gst_element_set_state (bin, GST_STATE_NULL);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  state_res = gst_element_set_state (bin, GST_STATE_NULL);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   fail_unless (play_count == 2, NULL);
 
@@ -307,8 +329,8 @@ GST_START_TEST (test_play_twice)
   g_main_loop_unref (main_loop);
   gst_consistency_checker_free (consist);
   gst_event_ref (play_seek_event);
-  gst_object_unref (G_OBJECT (bus));
-  gst_object_unref (G_OBJECT (bin));
+  gst_object_unref (bus);
+  gst_object_unref (bin);
 }
 
 GST_END_TEST;
@@ -318,6 +340,7 @@ GST_START_TEST (test_play_twice_then_add_and_play_again)
   GstElement *bin, *src1, *src2, *src3, *adder, *sink;
   GstBus *bus;
   gboolean res;
+  GstStateChangeReturn state_res;
   gint i;
   GstPad *srcpad;
   GstStreamConsistency *consist;
@@ -367,14 +390,14 @@ GST_START_TEST (test_play_twice_then_add_and_play_again)
     GST_INFO ("starting test-loop %d", i);
 
     /* prepare playing */
-    res = gst_element_set_state (bin, GST_STATE_PAUSED);
-    fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+    state_res = gst_element_set_state (bin, GST_STATE_PAUSED);
+    fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
     /* wait for completion */
-    res =
+    state_res =
         gst_element_get_state (GST_ELEMENT (bin), NULL, NULL,
         GST_CLOCK_TIME_NONE);
-    fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+    fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
     res = gst_element_send_event (bin, gst_event_ref (play_seek_event));
     fail_unless (res == TRUE, NULL);
@@ -382,13 +405,13 @@ GST_START_TEST (test_play_twice_then_add_and_play_again)
     GST_INFO ("seeked");
 
     /* run pipeline */
-    res = gst_element_set_state (bin, GST_STATE_PLAYING);
-    fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+    state_res = gst_element_set_state (bin, GST_STATE_PLAYING);
+    fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
     g_main_loop_run (main_loop);
 
-    res = gst_element_set_state (bin, GST_STATE_READY);
-    fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+    state_res = gst_element_set_state (bin, GST_STATE_READY);
+    fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
     fail_unless (play_count == 2, NULL);
 
@@ -405,15 +428,15 @@ GST_START_TEST (test_play_twice_then_add_and_play_again)
     gst_consistency_checker_reset (consist);
   }
 
-  res = gst_element_set_state (bin, GST_STATE_NULL);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  state_res = gst_element_set_state (bin, GST_STATE_NULL);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   /* cleanup */
   g_main_loop_unref (main_loop);
   gst_event_ref (play_seek_event);
   gst_consistency_checker_free (consist);
-  gst_object_unref (G_OBJECT (bus));
-  gst_object_unref (G_OBJECT (bin));
+  gst_object_unref (bus);
+  gst_object_unref (bin);
 }
 
 GST_END_TEST;
@@ -443,6 +466,7 @@ GST_START_TEST (test_live_seeking)
   GstElement *bin, *src1, *src2, *ac1, *ac2, *adder, *sink;
   GstBus *bus;
   gboolean res;
+  GstStateChangeReturn state_res;
   GstPad *srcpad;
   gint i;
   GstStreamConsistency *consist;
@@ -467,11 +491,11 @@ GST_START_TEST (test_live_seeking)
     goto cleanup;
   }
   /* Test that the audio source can get to paused, else skip */
-  res = gst_element_set_state (src1, GST_STATE_PAUSED);
+  state_res = gst_element_set_state (src1, GST_STATE_PAUSED);
   (void) gst_element_set_state (src1, GST_STATE_NULL);
   gst_object_unref (src1);
 
-  if (res == GST_STATE_CHANGE_FAILURE)
+  if (state_res == GST_STATE_CHANGE_FAILURE)
     goto cleanup;
   src1 = gst_element_factory_make ("alsasrc", "src1");
 
@@ -521,14 +545,14 @@ GST_START_TEST (test_live_seeking)
     GST_INFO ("starting test-loop %d", i);
 
     /* prepare playing */
-    res = gst_element_set_state (bin, GST_STATE_PAUSED);
-    fail_unless (res != GST_STATE_CHANGE_FAILURE);
+    state_res = gst_element_set_state (bin, GST_STATE_PAUSED);
+    fail_unless (state_res != GST_STATE_CHANGE_FAILURE);
 
     /* wait for completion */
-    res =
+    state_res =
         gst_element_get_state (GST_ELEMENT (bin), NULL, NULL,
         GST_CLOCK_TIME_NONE);
-    fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+    fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
     res = gst_element_send_event (bin, gst_event_ref (play_seek_event));
 #if 1
@@ -541,15 +565,15 @@ GST_START_TEST (test_live_seeking)
     GST_INFO ("seeked");
 
     /* run pipeline */
-    res = gst_element_set_state (bin, GST_STATE_PLAYING);
-    fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+    state_res = gst_element_set_state (bin, GST_STATE_PLAYING);
+    fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
     GST_INFO ("playing");
 
     g_main_loop_run (main_loop);
 
-    res = gst_element_set_state (bin, GST_STATE_NULL);
-    fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+    state_res = gst_element_set_state (bin, GST_STATE_NULL);
+    fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
     gst_consistency_checker_reset (consist);
   }
@@ -561,8 +585,8 @@ cleanup:
     g_main_loop_unref (main_loop);
   if (play_seek_event)
     gst_event_unref (play_seek_event);
-  gst_object_unref (G_OBJECT (bus));
-  gst_object_unref (G_OBJECT (bin));
+  gst_object_unref (bus);
+  gst_object_unref (bin);
 }
 
 GST_END_TEST;
@@ -574,6 +598,7 @@ GST_START_TEST (test_add_pad)
   GstBus *bus;
   GstPad *srcpad;
   gboolean res;
+  GstStateChangeReturn state_res;
 
   GST_INFO ("preparing test");
 
@@ -611,14 +636,14 @@ GST_START_TEST (test_add_pad)
   GST_INFO ("starting test");
 
   /* prepare playing */
-  res = gst_element_set_state (bin, GST_STATE_PAUSED);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  state_res = gst_element_set_state (bin, GST_STATE_PAUSED);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   /* wait for completion */
-  res =
+  state_res =
       gst_element_get_state (GST_ELEMENT (bin), NULL, NULL,
       GST_CLOCK_TIME_NONE);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   /* add other element */
   gst_bin_add_many (GST_BIN (bin), src2, NULL);
@@ -628,21 +653,22 @@ GST_START_TEST (test_add_pad)
   fail_unless (res == TRUE, NULL);
 
   /* set to PAUSED as well */
-  res = gst_element_set_state (src2, GST_STATE_PAUSED);
+  state_res = gst_element_set_state (src2, GST_STATE_PAUSED);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   /* now play all */
-  res = gst_element_set_state (bin, GST_STATE_PLAYING);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  state_res = gst_element_set_state (bin, GST_STATE_PLAYING);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   g_main_loop_run (main_loop);
 
-  res = gst_element_set_state (bin, GST_STATE_NULL);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  state_res = gst_element_set_state (bin, GST_STATE_NULL);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   /* cleanup */
   g_main_loop_unref (main_loop);
-  gst_object_unref (G_OBJECT (bus));
-  gst_object_unref (G_OBJECT (bin));
+  gst_object_unref (bus);
+  gst_object_unref (bin);
 }
 
 GST_END_TEST;
@@ -654,6 +680,7 @@ GST_START_TEST (test_remove_pad)
   GstBus *bus;
   GstPad *pad, *srcpad;
   gboolean res;
+  GstStateChangeReturn state_res;
 
   GST_INFO ("preparing test");
 
@@ -692,8 +719,8 @@ GST_START_TEST (test_remove_pad)
 
   /* prepare playing, this will not preroll as adder is waiting
    * on the unconnected sinkpad. */
-  res = gst_element_set_state (bin, GST_STATE_PAUSED);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  state_res = gst_element_set_state (bin, GST_STATE_PAUSED);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   /* wait for completion for one second, will return ASYNC */
   res = gst_element_get_state (GST_ELEMENT (bin), NULL, NULL, GST_SECOND);
@@ -705,24 +732,24 @@ GST_START_TEST (test_remove_pad)
   gst_object_unref (pad);
 
   /* wait for completion, should work now */
-  res =
+  state_res =
       gst_element_get_state (GST_ELEMENT (bin), NULL, NULL,
       GST_CLOCK_TIME_NONE);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   /* now play all */
-  res = gst_element_set_state (bin, GST_STATE_PLAYING);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  state_res = gst_element_set_state (bin, GST_STATE_PLAYING);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   g_main_loop_run (main_loop);
 
-  res = gst_element_set_state (bin, GST_STATE_NULL);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  state_res = gst_element_set_state (bin, GST_STATE_NULL);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   /* cleanup */
   g_main_loop_unref (main_loop);
-  gst_object_unref (G_OBJECT (bus));
-  gst_object_unref (G_OBJECT (bin));
+  gst_object_unref (bus);
+  gst_object_unref (bin);
 }
 
 GST_END_TEST;
@@ -744,6 +771,7 @@ GST_START_TEST (test_clip)
   GstBus *bus;
   GstPad *sinkpad;
   gboolean res;
+  GstStateChangeReturn state_res;
   GstFlowReturn ret;
   GstEvent *event;
   GstBuffer *buffer;
@@ -771,8 +799,8 @@ GST_START_TEST (test_clip)
   fail_unless (res == TRUE, NULL);
 
   /* set to playing */
-  res = gst_element_set_state (bin, GST_STATE_PLAYING);
-  fail_unless (res != GST_STATE_CHANGE_FAILURE, NULL);
+  state_res = gst_element_set_state (bin, GST_STATE_PLAYING);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
   /* create an unconnected sinkpad in adder, should also automatically activate
    * the pad */
@@ -832,12 +860,123 @@ GST_START_TEST (test_clip)
   ret = gst_pad_chain (sinkpad, buffer);
   fail_unless (ret == GST_FLOW_OK);
   fail_unless (handoff_buffer == NULL);
+}
+
+GST_END_TEST;
+
+GST_START_TEST (test_duration_is_max)
+{
+  GstElement *bin, *src[3], *adder, *sink;
+  GstStateChangeReturn state_res;
+  GstFormat format = GST_FORMAT_TIME;
+  gboolean res;
+  gint64 duration;
+
+  GST_INFO ("preparing test");
+
+  /* build pipeline */
+  bin = gst_pipeline_new ("pipeline");
+
+  /* 3 sources, an adder and a fakesink */
+  src[0] = gst_element_factory_make ("audiotestsrc", NULL);
+  src[1] = gst_element_factory_make ("audiotestsrc", NULL);
+  src[2] = gst_element_factory_make ("audiotestsrc", NULL);
+  adder = gst_element_factory_make ("adder", "adder");
+  sink = gst_element_factory_make ("fakesink", "sink");
+  gst_bin_add_many (GST_BIN (bin), src[0], src[1], src[2], adder, sink, NULL);
+
+  gst_element_link (src[0], adder);
+  gst_element_link (src[1], adder);
+  gst_element_link (src[2], adder);
+  gst_element_link (adder, sink);
 
+  /* irks, duration is reset on basesrc */
+  state_res = gst_element_set_state (bin, GST_STATE_PAUSED);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
+
+  /* set durations on src */
+  GST_BASE_SRC (src[0])->segment.duration = 1000;
+  GST_BASE_SRC (src[1])->segment.duration = 3000;
+  GST_BASE_SRC (src[2])->segment.duration = 2000;
+
+  /* set to playing */
+  state_res = gst_element_set_state (bin, GST_STATE_PLAYING);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
+
+  /* wait for completion */
+  state_res =
+      gst_element_get_state (GST_ELEMENT (bin), NULL, NULL,
+      GST_CLOCK_TIME_NONE);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
 
+  res = gst_element_query_duration (GST_ELEMENT (bin), &format, &duration);
+  fail_unless (res, NULL);
+
+  ck_assert_int_eq (duration, 3000);
+
+  gst_element_set_state (bin, GST_STATE_NULL);
+  gst_object_unref (bin);
 }
 
 GST_END_TEST;
 
+GST_START_TEST (test_duration_unknown_overrides)
+{
+  GstElement *bin, *src[3], *adder, *sink;
+  GstStateChangeReturn state_res;
+  GstFormat format = GST_FORMAT_TIME;
+  gboolean res;
+  gint64 duration;
+
+  GST_INFO ("preparing test");
+
+  /* build pipeline */
+  bin = gst_pipeline_new ("pipeline");
+
+  /* 3 sources, an adder and a fakesink */
+  src[0] = gst_element_factory_make ("audiotestsrc", NULL);
+  src[1] = gst_element_factory_make ("audiotestsrc", NULL);
+  src[2] = gst_element_factory_make ("audiotestsrc", NULL);
+  adder = gst_element_factory_make ("adder", "adder");
+  sink = gst_element_factory_make ("fakesink", "sink");
+  gst_bin_add_many (GST_BIN (bin), src[0], src[1], src[2], adder, sink, NULL);
+
+  gst_element_link (src[0], adder);
+  gst_element_link (src[1], adder);
+  gst_element_link (src[2], adder);
+  gst_element_link (adder, sink);
+
+  /* irks, duration is reset on basesrc */
+  state_res = gst_element_set_state (bin, GST_STATE_PAUSED);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
+
+  /* set durations on src */
+  GST_BASE_SRC (src[0])->segment.duration = GST_CLOCK_TIME_NONE;
+  GST_BASE_SRC (src[1])->segment.duration = 3000;
+  GST_BASE_SRC (src[2])->segment.duration = 2000;
+
+  /* set to playing */
+  state_res = gst_element_set_state (bin, GST_STATE_PLAYING);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
+
+  /* wait for completion */
+  state_res =
+      gst_element_get_state (GST_ELEMENT (bin), NULL, NULL,
+      GST_CLOCK_TIME_NONE);
+  fail_unless (state_res != GST_STATE_CHANGE_FAILURE, NULL);
+
+  res = gst_element_query_duration (GST_ELEMENT (bin), &format, &duration);
+  fail_unless (res, NULL);
+
+  ck_assert_int_eq (duration, GST_CLOCK_TIME_NONE);
+
+  gst_element_set_state (bin, GST_STATE_NULL);
+  gst_object_unref (bin);
+}
+
+GST_END_TEST;
+
+
 static Suite *
 adder_suite (void)
 {
@@ -852,6 +991,8 @@ adder_suite (void)
   tcase_add_test (tc_chain, test_add_pad);
   tcase_add_test (tc_chain, test_remove_pad);
   tcase_add_test (tc_chain, test_clip);
+  tcase_add_test (tc_chain, test_duration_is_max);
+  tcase_add_test (tc_chain, test_duration_unknown_overrides);
 
   /* Use a longer timeout */
 #ifdef HAVE_VALGRIND
diff --git a/tests/check/elements/alsa.c b/tests/check/elements/alsa.c
index ddd95c7..feae0b5 100644
--- a/tests/check/elements/alsa.c
+++ b/tests/check/elements/alsa.c
@@ -20,6 +20,10 @@
  * Boston, MA 02111-1307, USA.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #include <unistd.h>
 
 #include <gst/check/gstcheck.h>
diff --git a/tests/check/elements/appsrc.c b/tests/check/elements/appsrc.c
index b888f48..ceb3eca 100644
--- a/tests/check/elements/appsrc.c
+++ b/tests/check/elements/appsrc.c
@@ -20,6 +20,7 @@
 
 #include <gst/check/gstcheck.h>
 #include <gst/app/gstappsrc.h>
+#include <gst/app/gstappsink.h>
 
 #define SAMPLE_CAPS "application/x-gst-check-test"
 
@@ -170,6 +171,155 @@ GST_START_TEST (test_appsrc_non_null_caps)
 
 GST_END_TEST;
 
+static GstAppSinkCallbacks app_callbacks;
+
+typedef struct
+{
+  GMainLoop *loop;
+  GstElement *source;
+  GstElement *sink;
+} ProgramData;
+
+static GstFlowReturn
+on_new_buffer_from_source (GstAppSink * elt, gpointer user_data)
+{
+  ProgramData *data = (ProgramData *) user_data;
+  GstBuffer *buffer;
+  GstElement *source;
+
+  buffer = gst_app_sink_pull_buffer (GST_APP_SINK (elt));
+  source = gst_bin_get_by_name (GST_BIN (data->sink), "testsource");
+  gst_app_src_push_buffer (GST_APP_SRC (source), gst_buffer_ref (buffer));
+  g_object_unref (source);
+  return GST_FLOW_OK;
+}
+
+/* called when we get a GstMessage from the source pipeline when we get EOS, we
+ * notify the appsrc of it. */
+static gboolean
+on_source_message (GstBus * bus, GstMessage * message, ProgramData * data)
+{
+  GstElement *source;
+
+  switch (GST_MESSAGE_TYPE (message)) {
+    case GST_MESSAGE_EOS:
+      source = gst_bin_get_by_name (GST_BIN (data->sink), "testsource");
+      fail_unless (gst_app_src_end_of_stream (GST_APP_SRC (source)) ==
+          GST_FLOW_OK);
+      break;
+    case GST_MESSAGE_ERROR:
+      g_main_loop_quit (data->loop);
+      break;
+    default:
+      break;
+  }
+  return TRUE;
+}
+
+static gboolean
+on_sink_message (GstBus * bus, GstMessage * message, ProgramData * data)
+{
+  switch (GST_MESSAGE_TYPE (message)) {
+    case GST_MESSAGE_EOS:
+      g_main_loop_quit (data->loop);
+      break;
+    case GST_MESSAGE_ERROR:
+      ASSERT_SET_STATE (data->sink, GST_STATE_NULL, GST_STATE_CHANGE_SUCCESS);
+      ASSERT_SET_STATE (data->source, GST_STATE_NULL, GST_STATE_CHANGE_SUCCESS);
+      g_main_loop_quit (data->loop);
+      break;
+    default:
+      break;
+  }
+  return TRUE;
+}
+
+static gboolean
+error_timeout (ProgramData * data)
+{
+  GstBus *bus;
+  bus = gst_element_get_bus (data->sink);
+  gst_bus_post (bus, gst_message_new_error (GST_OBJECT (data->sink), NULL,
+          "test error"));
+  gst_object_unref (bus);
+  return FALSE;
+}
+
+/*
+ * appsink => appsrc pipelines executed 100 times: 
+ * - appsink pipeline has sync=false
+ * - appsrc pipeline has sync=true
+ * - appsrc has block=true
+ * after 1 second an error message is posted on appsink pipeline bus
+ * when the error is received the appsrc pipeline is set to NULL
+ * and then the appsink pipeline is
+ * set to NULL too, this must not deadlock 
+ */
+
+GST_START_TEST (test_appsrc_block_deadlock)
+{
+  int i = 0;
+  int num_iteration = 100;
+  while (i < num_iteration) {
+    ProgramData *data = NULL;
+    GstBus *bus = NULL;
+    GstElement *testsink = NULL;
+
+    gint tout;
+
+    data = g_new0 (ProgramData, 1);
+
+    data->loop = g_main_loop_new (NULL, FALSE);
+
+    data->source =
+        gst_parse_launch ("videotestsrc ! appsink sync=false name=testsink",
+        NULL);
+
+    fail_unless (data->source != NULL);
+
+    bus = gst_element_get_bus (data->source);
+    gst_bus_add_watch (bus, (GstBusFunc) on_source_message, data);
+    gst_object_unref (bus);
+
+    app_callbacks.new_buffer = on_new_buffer_from_source;
+    testsink = gst_bin_get_by_name (GST_BIN (data->source), "testsink");
+    gst_app_sink_set_callbacks (GST_APP_SINK_CAST (testsink), &app_callbacks,
+        data, NULL);
+
+    gst_object_unref (testsink);
+
+    data->sink =
+        gst_parse_launch
+        ("appsrc name=testsource block=1 max-bytes=1000 is-live=true ! fakesink sync=true",
+        NULL);
+
+    fail_unless (data->sink != NULL);
+
+    bus = gst_element_get_bus (data->sink);
+    gst_bus_add_watch (bus, (GstBusFunc) on_sink_message, data);
+    gst_object_unref (bus);
+
+    tout = g_timeout_add (150, (GSourceFunc) error_timeout, data);
+
+    ASSERT_SET_STATE (data->sink, GST_STATE_PLAYING, GST_STATE_CHANGE_ASYNC);
+    ASSERT_SET_STATE (data->source, GST_STATE_PLAYING, GST_STATE_CHANGE_ASYNC);
+
+    g_main_loop_run (data->loop);
+
+    ASSERT_SET_STATE (data->sink, GST_STATE_NULL, GST_STATE_CHANGE_SUCCESS);
+    ASSERT_SET_STATE (data->source, GST_STATE_NULL, GST_STATE_CHANGE_SUCCESS);
+
+    g_source_remove (tout);
+    gst_object_unref (data->source);
+    gst_object_unref (data->sink);
+    g_main_loop_unref (data->loop);
+    g_free (data);
+    i++;
+    g_print ("appsrc deadlock test iteration number %d/%d\n", i, num_iteration);
+  }
+}
+
+GST_END_TEST;
 
 static Suite *
 appsrc_suite (void)
@@ -179,7 +329,9 @@ appsrc_suite (void)
 
   tcase_add_test (tc_chain, test_appsrc_null_caps);
   tcase_add_test (tc_chain, test_appsrc_non_null_caps);
+  tcase_add_test (tc_chain, test_appsrc_block_deadlock);
 
+  tcase_set_timeout (tc_chain, 20);
   suite_add_tcase (s, tc_chain);
 
   return s;
diff --git a/tests/check/elements/playbin.c b/tests/check/elements/playbin.c
index c550571..cc0ecd6 100644
--- a/tests/check/elements/playbin.c
+++ b/tests/check/elements/playbin.c
@@ -18,6 +18,10 @@
  * Boston, MA 02111-1307, USA.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #ifdef HAVE_CONFIG_H
 # include <config.h>
 #endif
diff --git a/tests/check/elements/videoscale.c b/tests/check/elements/videoscale.c
index f297efc..9a39a0e 100644
--- a/tests/check/elements/videoscale.c
+++ b/tests/check/elements/videoscale.c
@@ -30,20 +30,20 @@
 #define LINK_CHECK_FLAGS GST_PAD_LINK_CHECK_NOTHING
 
 static GstCaps **
-videoscale_get_allowed_caps (void)
+videoscale_get_allowed_caps_for_method (int method)
 {
-  GstElement *scale = gst_element_factory_make ("videoscale", "scale");
-  GstPadTemplate *templ;
+  GstElement *scale;
   GstCaps *caps, **ret;
+  GstPad *pad;
   GstStructure *s;
   gint i, n;
 
-  templ =
-      gst_element_class_get_pad_template (GST_ELEMENT_GET_CLASS (scale),
-      "sink");
-  fail_unless (templ != NULL);
-
-  caps = gst_pad_template_get_caps (templ);
+  scale = gst_element_factory_make ("videoscale", "vscale");
+  g_object_set (scale, "method", method, NULL);
+  pad = gst_element_get_static_pad (scale, "sink");
+  caps = gst_pad_get_caps (pad);
+  gst_object_unref (pad);
+  gst_object_unref (scale);
 
   n = gst_caps_get_size (caps);
   ret = g_new0 (GstCaps *, n + 1);
@@ -52,10 +52,10 @@ videoscale_get_allowed_caps (void)
     s = gst_caps_get_structure (caps, i);
     ret[i] = gst_caps_new_empty ();
     gst_caps_append_structure (ret[i], gst_structure_copy (s));
+    GST_LOG ("method %d supports: %" GST_PTR_FORMAT, method, s);
   }
 
-  gst_object_unref (scale);
-
+  gst_caps_unref (caps);
   return ret;
 }
 
@@ -206,52 +206,52 @@ on_src_handoff_passthrough (GstElement * element, GstBuffer * buffer,
   *list = g_list_prepend (*list, gst_buffer_ref (buffer));
 }
 
-GST_START_TEST (test_passthrough)
+static void
+test_passthrough (int method)
 {
   GList *l1, *l2, *src_buffers = NULL, *sink_buffers = NULL;
   GstCaps **allowed_caps = NULL, **p;
-  gint method;
   static const gint src_width = 640, src_height = 480;
   static const gint dest_width = 640, dest_height = 480;
 
-  p = allowed_caps = videoscale_get_allowed_caps ();
+  p = allowed_caps = videoscale_get_allowed_caps_for_method (method);
 
   while (*p) {
     GstCaps *caps = *p;
 
-    for (method = 0; method < 3; method++) {
-      /* skip formats that ffmpegcolorspace can't handle */
-      if (caps_are_64bpp (caps))
-        continue;
-
-      GST_DEBUG ("Running test for caps '%" GST_PTR_FORMAT "'"
-          " from %dx%u to %dx%d with method %d", caps, src_width, src_height,
-          dest_width, dest_height, method);
-      run_test (caps, src_width, src_height,
-          dest_width, dest_height, method,
-          G_CALLBACK (on_src_handoff_passthrough), &src_buffers,
-          G_CALLBACK (on_sink_handoff_passthrough), &sink_buffers);
-
-      fail_unless (src_buffers && sink_buffers);
-      fail_unless_equals_int (g_list_length (src_buffers),
-          g_list_length (sink_buffers));
-
-      for (l1 = src_buffers, l2 = sink_buffers; l1 && l2;
-          l1 = l1->next, l2 = l2->next) {
-        GstBuffer *a = l1->data;
-        GstBuffer *b = l2->data;
-
-        fail_unless_equals_int (GST_BUFFER_SIZE (a), GST_BUFFER_SIZE (b));
-        fail_unless (GST_BUFFER_DATA (a) == GST_BUFFER_DATA (b));
-
-        gst_buffer_unref (a);
-        gst_buffer_unref (b);
-      }
-      g_list_free (src_buffers);
-      src_buffers = NULL;
-      g_list_free (sink_buffers);
-      sink_buffers = NULL;
+    /* skip formats that ffmpegcolorspace can't handle */
+    if (caps_are_64bpp (caps))
+      goto skip;
+
+    GST_DEBUG ("Running test for caps '%" GST_PTR_FORMAT "'"
+        " from %dx%u to %dx%d with method %d", caps, src_width, src_height,
+        dest_width, dest_height, method);
+    run_test (caps, src_width, src_height,
+        dest_width, dest_height, method,
+        G_CALLBACK (on_src_handoff_passthrough), &src_buffers,
+        G_CALLBACK (on_sink_handoff_passthrough), &sink_buffers);
+
+    fail_unless (src_buffers && sink_buffers);
+    fail_unless_equals_int (g_list_length (src_buffers),
+        g_list_length (sink_buffers));
+
+    for (l1 = src_buffers, l2 = sink_buffers; l1 && l2;
+        l1 = l1->next, l2 = l2->next) {
+      GstBuffer *a = l1->data;
+      GstBuffer *b = l2->data;
+
+      fail_unless_equals_int (GST_BUFFER_SIZE (a), GST_BUFFER_SIZE (b));
+      fail_unless (GST_BUFFER_DATA (a) == GST_BUFFER_DATA (b));
+
+      gst_buffer_unref (a);
+      gst_buffer_unref (b);
     }
+    g_list_free (src_buffers);
+    src_buffers = NULL;
+    g_list_free (sink_buffers);
+    sink_buffers = NULL;
+
+  skip:
 
     gst_caps_unref (caps);
     p++;
@@ -259,6 +259,32 @@ GST_START_TEST (test_passthrough)
   g_free (allowed_caps);
 }
 
+GST_START_TEST (test_passthrough_method_0)
+{
+  test_passthrough (0);
+}
+
+GST_END_TEST;
+
+GST_START_TEST (test_passthrough_method_1)
+{
+  test_passthrough (1);
+}
+
+GST_END_TEST;
+
+GST_START_TEST (test_passthrough_method_2)
+{
+  test_passthrough (2);
+}
+
+GST_END_TEST;
+
+GST_START_TEST (test_passthrough_method_3)
+{
+  test_passthrough (3);
+}
+
 GST_END_TEST;
 
 #define CREATE_TEST(name,method,src_width,src_height,dest_width,dest_height) \
@@ -266,7 +292,7 @@ GST_START_TEST (name) \
 { \
   GstCaps **allowed_caps = NULL, **p; \
   \
-  p = allowed_caps = videoscale_get_allowed_caps (); \
+  p = allowed_caps = videoscale_get_allowed_caps_for_method (method); \
   \
   while (*p) { \
     GstCaps *caps = *p; \
@@ -288,39 +314,51 @@ GST_END_TEST;
 CREATE_TEST (test_downscale_640x480_320x240_method_0, 0, 640, 480, 320, 240);
 CREATE_TEST (test_downscale_640x480_320x240_method_1, 1, 640, 480, 320, 240);
 CREATE_TEST (test_downscale_640x480_320x240_method_2, 2, 640, 480, 320, 240);
+CREATE_TEST (test_downscale_640x480_320x240_method_3, 3, 640, 480, 320, 240);
 CREATE_TEST (test_upscale_320x240_640x480_method_0, 0, 320, 240, 640, 480);
 CREATE_TEST (test_upscale_320x240_640x480_method_1, 1, 320, 240, 640, 480);
 CREATE_TEST (test_upscale_320x240_640x480_method_2, 2, 320, 240, 640, 480);
+CREATE_TEST (test_upscale_320x240_640x480_method_3, 3, 320, 240, 640, 480);
 CREATE_TEST (test_downscale_640x480_1x1_method_0, 0, 640, 480, 1, 1);
 CREATE_TEST (test_downscale_640x480_1x1_method_1, 1, 640, 480, 1, 1);
 CREATE_TEST (test_downscale_640x480_1x1_method_2, 2, 640, 480, 1, 1);
+CREATE_TEST (test_downscale_640x480_1x1_method_3, 3, 640, 480, 1, 1);
 CREATE_TEST (test_upscale_1x1_640x480_method_0, 0, 1, 1, 640, 480);
 CREATE_TEST (test_upscale_1x1_640x480_method_1, 1, 1, 1, 640, 480);
 CREATE_TEST (test_upscale_1x1_640x480_method_2, 2, 1, 1, 640, 480);
+CREATE_TEST (test_upscale_1x1_640x480_method_3, 3, 1, 1, 640, 480);
 CREATE_TEST (test_downscale_641x481_111x30_method_0, 0, 641, 481, 111, 30);
 CREATE_TEST (test_downscale_641x481_111x30_method_1, 1, 641, 481, 111, 30);
 CREATE_TEST (test_downscale_641x481_111x30_method_2, 2, 641, 481, 111, 30);
+CREATE_TEST (test_downscale_641x481_111x30_method_3, 3, 641, 481, 111, 30);
 CREATE_TEST (test_upscale_111x30_641x481_method_0, 0, 111, 30, 641, 481);
 CREATE_TEST (test_upscale_111x30_641x481_method_1, 1, 111, 30, 641, 481);
 CREATE_TEST (test_upscale_111x30_641x481_method_2, 2, 111, 30, 641, 481);
+CREATE_TEST (test_upscale_111x30_641x481_method_3, 2, 111, 30, 641, 481);
 CREATE_TEST (test_downscale_641x481_30x111_method_0, 0, 641, 481, 30, 111);
 CREATE_TEST (test_downscale_641x481_30x111_method_1, 1, 641, 481, 30, 111);
 CREATE_TEST (test_downscale_641x481_30x111_method_2, 2, 641, 481, 30, 111);
+CREATE_TEST (test_downscale_641x481_30x111_method_3, 3, 641, 481, 30, 111);
 CREATE_TEST (test_upscale_30x111_641x481_method_0, 0, 30, 111, 641, 481);
 CREATE_TEST (test_upscale_30x111_641x481_method_1, 1, 30, 111, 641, 481);
 CREATE_TEST (test_upscale_30x111_641x481_method_2, 2, 30, 111, 641, 481);
+CREATE_TEST (test_upscale_30x111_641x481_method_3, 3, 30, 111, 641, 481);
 CREATE_TEST (test_downscale_640x480_320x1_method_0, 0, 640, 480, 320, 1);
 CREATE_TEST (test_downscale_640x480_320x1_method_1, 1, 640, 480, 320, 1);
 CREATE_TEST (test_downscale_640x480_320x1_method_2, 2, 640, 480, 320, 1);
+CREATE_TEST (test_downscale_640x480_320x1_method_3, 3, 640, 480, 320, 1);
 CREATE_TEST (test_upscale_320x1_640x480_method_0, 0, 320, 1, 640, 480);
 CREATE_TEST (test_upscale_320x1_640x480_method_1, 1, 320, 1, 640, 480);
 CREATE_TEST (test_upscale_320x1_640x480_method_2, 2, 320, 1, 640, 480);
+CREATE_TEST (test_upscale_320x1_640x480_method_3, 3, 320, 1, 640, 480);
 CREATE_TEST (test_downscale_640x480_1x240_method_0, 0, 640, 480, 1, 240);
 CREATE_TEST (test_downscale_640x480_1x240_method_1, 1, 640, 480, 1, 240);
 CREATE_TEST (test_downscale_640x480_1x240_method_2, 2, 640, 480, 1, 240);
+CREATE_TEST (test_downscale_640x480_1x240_method_3, 3, 640, 480, 1, 240);
 CREATE_TEST (test_upscale_1x240_640x480_method_0, 0, 1, 240, 640, 480);
 CREATE_TEST (test_upscale_1x240_640x480_method_1, 1, 1, 240, 640, 480);
 CREATE_TEST (test_upscale_1x240_640x480_method_2, 2, 1, 240, 640, 480);
+CREATE_TEST (test_upscale_1x240_640x480_method_3, 3, 1, 240, 640, 480);
 
 typedef struct
 {
@@ -642,8 +680,7 @@ gst_test_reverse_negotiation_sink_base_init (gpointer g_class)
       "Test Reverse Negotiation Sink",
       "Sink",
       "Some test sink", "Sebastian Dröge <sebastian.droege@collabora.co.uk>");
-  gst_element_class_add_static_pad_template (gstelement_class,
-      &sinktemplate);
+  gst_element_class_add_static_pad_template (gstelement_class, &sinktemplate);
 }
 
 static void
@@ -810,6 +847,13 @@ GST_START_TEST (test_basetransform_negotiation)
 
 GST_END_TEST;
 
+#ifndef tcase_skip_broken_test
+#define tcase_skip_broken_test(chain,test_func) \
+  if (0) { tcase_add_test(chain,test_func); } else { \
+    GST_ERROR ("FIXME: skipping test %s because it's broken.", G_STRINGIFY (test_func)); \
+  }
+#endif
+
 static Suite *
 videoscale_suite (void)
 {
@@ -818,43 +862,58 @@ videoscale_suite (void)
 
   suite_add_tcase (s, tc_chain);
   tcase_set_timeout (tc_chain, 180);
-  tcase_add_test (tc_chain, test_passthrough);
+  tcase_add_test (tc_chain, test_passthrough_method_0);
+  tcase_add_test (tc_chain, test_passthrough_method_1);
+  tcase_add_test (tc_chain, test_passthrough_method_2);
+  tcase_add_test (tc_chain, test_passthrough_method_3);
   tcase_add_test (tc_chain, test_downscale_640x480_320x240_method_0);
   tcase_add_test (tc_chain, test_downscale_640x480_320x240_method_1);
   tcase_add_test (tc_chain, test_downscale_640x480_320x240_method_2);
+  tcase_add_test (tc_chain, test_downscale_640x480_320x240_method_3);
   tcase_add_test (tc_chain, test_upscale_320x240_640x480_method_0);
   tcase_add_test (tc_chain, test_upscale_320x240_640x480_method_1);
   tcase_add_test (tc_chain, test_upscale_320x240_640x480_method_2);
+  tcase_add_test (tc_chain, test_upscale_320x240_640x480_method_3);
   tcase_add_test (tc_chain, test_downscale_640x480_1x1_method_0);
   tcase_add_test (tc_chain, test_downscale_640x480_1x1_method_1);
   tcase_add_test (tc_chain, test_downscale_640x480_1x1_method_2);
+  tcase_skip_broken_test (tc_chain, test_downscale_640x480_1x1_method_3);
   tcase_add_test (tc_chain, test_upscale_1x1_640x480_method_0);
   tcase_add_test (tc_chain, test_upscale_1x1_640x480_method_1);
   tcase_add_test (tc_chain, test_upscale_1x1_640x480_method_2);
+  tcase_add_test (tc_chain, test_upscale_1x1_640x480_method_3);
   tcase_add_test (tc_chain, test_downscale_641x481_111x30_method_0);
   tcase_add_test (tc_chain, test_downscale_641x481_111x30_method_1);
   tcase_add_test (tc_chain, test_downscale_641x481_111x30_method_2);
+  tcase_add_test (tc_chain, test_downscale_641x481_111x30_method_3);
   tcase_add_test (tc_chain, test_upscale_111x30_641x481_method_0);
   tcase_add_test (tc_chain, test_upscale_111x30_641x481_method_1);
   tcase_add_test (tc_chain, test_upscale_111x30_641x481_method_2);
+  tcase_add_test (tc_chain, test_upscale_111x30_641x481_method_3);
   tcase_add_test (tc_chain, test_downscale_641x481_30x111_method_0);
   tcase_add_test (tc_chain, test_downscale_641x481_30x111_method_1);
   tcase_add_test (tc_chain, test_downscale_641x481_30x111_method_2);
+  tcase_add_test (tc_chain, test_downscale_641x481_30x111_method_3);
   tcase_add_test (tc_chain, test_upscale_30x111_641x481_method_0);
   tcase_add_test (tc_chain, test_upscale_30x111_641x481_method_1);
   tcase_add_test (tc_chain, test_upscale_30x111_641x481_method_2);
+  tcase_add_test (tc_chain, test_upscale_30x111_641x481_method_3);
   tcase_add_test (tc_chain, test_downscale_640x480_320x1_method_0);
   tcase_add_test (tc_chain, test_downscale_640x480_320x1_method_1);
   tcase_add_test (tc_chain, test_downscale_640x480_320x1_method_2);
+  tcase_skip_broken_test (tc_chain, test_downscale_640x480_320x1_method_3);
   tcase_add_test (tc_chain, test_upscale_320x1_640x480_method_0);
   tcase_add_test (tc_chain, test_upscale_320x1_640x480_method_1);
   tcase_add_test (tc_chain, test_upscale_320x1_640x480_method_2);
+  tcase_skip_broken_test (tc_chain, test_upscale_320x1_640x480_method_3);
   tcase_add_test (tc_chain, test_downscale_640x480_1x240_method_0);
   tcase_add_test (tc_chain, test_downscale_640x480_1x240_method_1);
   tcase_add_test (tc_chain, test_downscale_640x480_1x240_method_2);
+  tcase_skip_broken_test (tc_chain, test_downscale_640x480_1x240_method_3);
   tcase_add_test (tc_chain, test_upscale_1x240_640x480_method_0);
   tcase_add_test (tc_chain, test_upscale_1x240_640x480_method_1);
   tcase_add_test (tc_chain, test_upscale_1x240_640x480_method_2);
+  tcase_add_test (tc_chain, test_upscale_1x240_640x480_method_3);
   tcase_add_test (tc_chain, test_negotiation);
   tcase_add_test (tc_chain, test_reverse_negotiation);
   tcase_add_test (tc_chain, test_basetransform_negotiation);
diff --git a/tests/check/libs/audio.c b/tests/check/libs/audio.c
index f5fab57..d2fc2e2 100644
--- a/tests/check/libs/audio.c
+++ b/tests/check/libs/audio.c
@@ -524,6 +524,41 @@ GST_START_TEST (test_channel_layout_value_intersect)
 
 GST_END_TEST;
 
+GST_START_TEST (test_format_from_caps)
+{
+  GstAudioInfo info = { NULL, };
+  GstCaps *caps;
+
+  caps = gst_caps_from_string ("audio/x-raw-int, "
+      "signed=(boolean)true, rate=(int)44100, channels=(int)2, "
+      "width=(int)8, depth=(int)8");
+  fail_unless (gst_audio_info_from_caps (&info, caps));
+  fail_unless_equals_int (GST_AUDIO_INFO_FORMAT (&info), GST_AUDIO_FORMAT_S8);
+  fail_unless_equals_int (GST_AUDIO_INFO_WIDTH (&info), 8);
+  fail_unless_equals_int (GST_AUDIO_INFO_DEPTH (&info), 8);
+  fail_unless_equals_int (GST_AUDIO_INFO_BPF (&info), sizeof (guint8) * 2);
+  fail_unless_equals_int (GST_AUDIO_INFO_RATE (&info), 44100);
+  fail_unless_equals_int (GST_AUDIO_INFO_CHANNELS (&info), 2);
+  fail_unless_equals_int (GST_AUDIO_INFO_ENDIANNESS (&info), 0);
+  gst_caps_unref (caps);
+
+  /* superfluous endianess field should not break stuff */
+  caps = gst_caps_from_string ("audio/x-raw-int, endianness=(int)1234, "
+      "signed=(boolean)false, rate=(int)44100, channels=(int)2, "
+      "width=(int)8, depth=(int)8");
+  fail_unless (gst_audio_info_from_caps (&info, caps));
+  fail_unless_equals_int (GST_AUDIO_INFO_FORMAT (&info), GST_AUDIO_FORMAT_U8);
+  fail_unless_equals_int (GST_AUDIO_INFO_WIDTH (&info), 8);
+  fail_unless_equals_int (GST_AUDIO_INFO_DEPTH (&info), 8);
+  fail_unless_equals_int (GST_AUDIO_INFO_BPF (&info), sizeof (guint8) * 2);
+  fail_unless_equals_int (GST_AUDIO_INFO_RATE (&info), 44100);
+  fail_unless_equals_int (GST_AUDIO_INFO_CHANNELS (&info), 2);
+  fail_unless_equals_int (GST_AUDIO_INFO_ENDIANNESS (&info), 0);
+  gst_caps_unref (caps);
+}
+
+GST_END_TEST;
+
 static Suite *
 audio_suite (void)
 {
@@ -536,6 +571,7 @@ audio_suite (void)
   tcase_add_test (tc_chain, test_buffer_clipping_time);
   tcase_add_test (tc_chain, test_buffer_clipping_samples);
   tcase_add_test (tc_chain, test_channel_layout_value_intersect);
+  tcase_add_test (tc_chain, test_format_from_caps);
 
   return s;
 }
diff --git a/tests/check/libs/discoverer.c b/tests/check/libs/discoverer.c
index 2d20576..f787d29 100644
--- a/tests/check/libs/discoverer.c
+++ b/tests/check/libs/discoverer.c
@@ -52,7 +52,8 @@ GST_START_TEST (test_disco_sync)
   GstDiscovererResult result;
   gchar *uri;
 
-  dc = gst_discoverer_new (GST_SECOND, &err);
+  /* high timeout, in case we're running under valgrind */
+  dc = gst_discoverer_new (5 * GST_SECOND, &err);
   fail_unless (dc != NULL);
   fail_unless (err == NULL);
 
@@ -78,6 +79,108 @@ GST_START_TEST (test_disco_sync)
 
 GST_END_TEST;
 
+static void
+test_disco_sync_reuse (const gchar * test_fn, guint num, GstClockTime timeout)
+{
+  GError *err = NULL;
+  GstDiscoverer *dc;
+  GstDiscovererInfo *info;
+  GstDiscovererResult result;
+  gchar *uri, *path;
+  int i;
+
+  dc = gst_discoverer_new (timeout, &err);
+  fail_unless (dc != NULL);
+  fail_unless (err == NULL);
+
+  /* GST_TEST_FILE comes from makefile CFLAGS */
+  path = g_build_filename (GST_TEST_FILES_PATH, test_fn, NULL);
+  uri = gst_filename_to_uri (path, &err);
+  g_free (path);
+  fail_unless (err == NULL);
+
+  for (i = 0; i < num; ++i) {
+    GST_INFO ("[%02d] discovering uri '%s'", i, uri);
+    info = gst_discoverer_discover_uri (dc, uri, &err);
+    if (info) {
+      result = gst_discoverer_info_get_result (info);
+      GST_INFO ("result: %d", result);
+      gst_discoverer_info_unref (info);
+    }
+    /* in case we don't have some of the elements needed */
+    if (err) {
+      g_error_free (err);
+      err = NULL;
+    }
+  }
+  g_free (uri);
+
+  g_object_unref (dc);
+}
+
+GST_START_TEST (test_disco_sync_reuse_ogg)
+{
+  test_disco_sync_reuse ("theora-vorbis.ogg", 2, 10 * GST_SECOND);
+}
+
+GST_END_TEST;
+
+GST_START_TEST (test_disco_sync_reuse_mp3)
+{
+  /* this will cause errors because -base doesn't do mp3 parsing or decoding */
+  test_disco_sync_reuse ("test.mp3", 3, 10 * GST_SECOND);
+}
+
+GST_END_TEST;
+
+GST_START_TEST (test_disco_sync_reuse_timeout)
+{
+  /* set minimum timeout to test that, esp. leakage under valgrind */
+  /* FIXME: should really be even shorter */
+  test_disco_sync_reuse ("theora-vorbis.ogg", 2, GST_SECOND);
+}
+
+GST_END_TEST;
+
+GST_START_TEST (test_disco_missing_plugins)
+{
+  const gchar *files[] = { "test.mkv", "test.mp3", "partialframe.mjpeg" };
+  GError *err = NULL;
+  GstDiscoverer *dc;
+  GstDiscovererInfo *info;
+  GstDiscovererResult result;
+  gchar *uri, *path;
+  int i;
+
+  for (i = 0; i < G_N_ELEMENTS (files); ++i) {
+    dc = gst_discoverer_new (5 * GST_SECOND, &err);
+    fail_unless (dc != NULL);
+    fail_unless (err == NULL);
+
+    /* GST_TEST_FILE comes from makefile CFLAGS */
+    path = g_build_filename (GST_TEST_FILES_PATH, files[i], NULL);
+    uri = gst_filename_to_uri (path, &err);
+    g_free (path);
+    fail_unless (err == NULL);
+
+    GST_INFO ("discovering uri '%s'", uri);
+    info = gst_discoverer_discover_uri (dc, uri, &err);
+    fail_unless (info != NULL);
+    fail_unless (err != NULL);
+    result = gst_discoverer_info_get_result (info);
+    GST_INFO ("result: %d, error message: %s", result, err->message);
+    fail_unless_equals_int (result, GST_DISCOVERER_MISSING_PLUGINS);
+    GST_INFO ("misc: %" GST_PTR_FORMAT, gst_discoverer_info_get_misc (info));
+
+    gst_discoverer_info_unref (info);
+    g_error_free (err);
+    err = NULL;
+    g_free (uri);
+    g_object_unref (dc);
+  }
+}
+
+GST_END_TEST;
 
 static Suite *
 discoverer_suite (void)
@@ -88,6 +191,10 @@ discoverer_suite (void)
   suite_add_tcase (s, tc_chain);
   tcase_add_test (tc_chain, test_disco_init);
   tcase_add_test (tc_chain, test_disco_sync);
+  tcase_add_test (tc_chain, test_disco_sync_reuse_ogg);
+  tcase_add_test (tc_chain, test_disco_sync_reuse_mp3);
+  tcase_add_test (tc_chain, test_disco_sync_reuse_timeout);
+  tcase_add_test (tc_chain, test_disco_missing_plugins);
   return s;
 }
 
diff --git a/tests/check/libs/tag.c b/tests/check/libs/tag.c
index 634cc3f..58748e0 100644
--- a/tests/check/libs/tag.c
+++ b/tests/check/libs/tag.c
@@ -748,6 +748,16 @@ GST_START_TEST (test_language_utils)
   ASSERT_STRINGS_EQUAL (gst_tag_get_language_code_iso_639_2B ("de"), "ger");
   ASSERT_STRINGS_EQUAL (gst_tag_get_language_code_iso_639_2B ("deu"), "ger");
   ASSERT_STRINGS_EQUAL (gst_tag_get_language_code_iso_639_2B ("ger"), "ger");
+
+  fail_unless (gst_tag_check_language_code ("de"));
+  fail_unless (gst_tag_check_language_code ("deu"));
+  fail_unless (gst_tag_check_language_code ("ger"));
+  fail_if (gst_tag_check_language_code ("xxx"));
+  fail_if (gst_tag_check_language_code ("und"));
+  fail_if (gst_tag_check_language_code ("un"));
+  fail_if (gst_tag_check_language_code (""));
+  fail_if (gst_tag_check_language_code ("\377"));
+  fail_if (gst_tag_check_language_code ("deutsch"));
 }
 
 GST_END_TEST;
diff --git a/tests/check/libs/video.c b/tests/check/libs/video.c
index fd3178d..02d5522 100644
--- a/tests/check/libs/video.c
+++ b/tests/check/libs/video.c
@@ -3,6 +3,7 @@
  * Copyright (C) <2003> David A. Schleef <ds@schleef.org>
  * Copyright (C) <2006> Jan Schmidt <thaytan@mad.scientist.com>
  * Copyright (C) <2008,2011> Tim-Philipp Müller <tim centricular net>
+ * Copyright (C) <2012> Collabora Ltd. <tim.muller@collabora.co.uk>
  *
  * This library is free software; you can redistribute it and/or
  * modify it under the terms of the GNU Library General Public
@@ -24,6 +25,10 @@
 #include "config.h"
 #endif
 
+#ifdef HAVE_VALGRIND
+# include <valgrind/valgrind.h>
+#endif
+
 #include <unistd.h>
 
 #include <gst/check/gstcheck.h>
@@ -364,6 +369,7 @@ GST_START_TEST (test_video_formats)
   guint i;
 
   for (i = 0; i < G_N_ELEMENTS (fourcc_list); ++i) {
+    const GstVideoFormatInfo *vf_info;
     GstVideoFormat fmt;
     const gchar *s;
     guint32 fourcc;
@@ -373,8 +379,15 @@ GST_START_TEST (test_video_formats)
     fourcc = GST_MAKE_FOURCC (s[0], s[1], s[2], s[3]);
     fmt = gst_video_format_from_fourcc (fourcc);
 
-    if (fmt == GST_VIDEO_FORMAT_UNKNOWN)
+    if (fmt == GST_VIDEO_FORMAT_UNKNOWN) {
+      GST_DEBUG ("Unknown format %s, skipping tests", fourcc_list[i].fourcc);
       continue;
+    }
+
+    vf_info = gst_video_format_get_info (fmt);
+    fail_unless (vf_info != NULL);
+
+    fail_unless_equals_int (GST_VIDEO_FORMAT_INFO_FORMAT (vf_info), fmt);
 
     GST_INFO ("Fourcc %s, packed=%d", fourcc_list[i].fourcc,
         gst_video_format_is_packed (fmt));
@@ -405,8 +418,8 @@ GST_START_TEST (test_video_formats)
         fourcc_list[i].paint_setup (&paintinfo, NULL);
         fail_unless_equals_int (gst_video_format_get_row_stride (fmt, 0, w),
             paintinfo.ystride);
-        if (!gst_video_format_is_packed (fmt)
-            && !gst_video_format_is_gray (fmt)) {
+        if (GST_VIDEO_FORMAT_INFO_N_COMPONENTS (vf_info) > 1 &&
+            !gst_video_format_is_packed (fmt)) {
           /* planar */
           fail_unless_equals_int (gst_video_format_get_row_stride (fmt, 1, w),
               paintinfo.ustride);
@@ -560,7 +573,13 @@ GST_START_TEST (test_parse_caps_rgb)
     GST_VIDEO_CAPS_RGBA, GST_VIDEO_FORMAT_RGBA}, {
     GST_VIDEO_CAPS_ARGB, GST_VIDEO_FORMAT_ARGB}, {
     GST_VIDEO_CAPS_BGRA, GST_VIDEO_FORMAT_BGRA}, {
-    GST_VIDEO_CAPS_ABGR, GST_VIDEO_FORMAT_ABGR}
+    GST_VIDEO_CAPS_ABGR, GST_VIDEO_FORMAT_ABGR},
+        /* 16 bit */
+    {
+    GST_VIDEO_CAPS_RGB_16, GST_VIDEO_FORMAT_RGB16}, {
+    GST_VIDEO_CAPS_BGR_16, GST_VIDEO_FORMAT_BGR16}, {
+    GST_VIDEO_CAPS_RGB_15, GST_VIDEO_FORMAT_RGB15}, {
+    GST_VIDEO_CAPS_BGR_15, GST_VIDEO_FORMAT_BGR15}
   };
   gint i;
 
@@ -775,9 +794,6 @@ GST_START_TEST (test_video_size_from_caps)
 
 GST_END_TEST;
 
-#undef ASSERT_CRITICAL
-#define ASSERT_CRITICAL(code) while(0){}        /* nothing */
-
 GST_START_TEST (test_overlay_composition)
 {
   GstVideoOverlayComposition *comp1, *comp2;
@@ -901,7 +917,13 @@ GST_START_TEST (test_overlay_composition)
   fail_unless (gst_video_buffer_get_overlay_composition (buf) == NULL);
 
   gst_buffer_ref (buf);
-  ASSERT_CRITICAL (gst_video_buffer_set_overlay_composition (buf, comp1));
+  /* buffer now has refcount of 2, so its metadata is not writable.
+   * only check this if we are not running in valgrind, as it leaks */
+#ifdef HAVE_VALGRIND
+  if (!RUNNING_ON_VALGRIND) {
+    ASSERT_CRITICAL (gst_video_buffer_set_overlay_composition (buf, comp1));
+  }
+#endif
   gst_buffer_unref (buf);
   gst_video_buffer_set_overlay_composition (buf, comp1);
   fail_unless (gst_video_buffer_get_overlay_composition (buf) == comp1);
@@ -920,6 +942,498 @@ GST_START_TEST (test_overlay_composition)
 
 GST_END_TEST;
 
+GST_START_TEST (test_overlay_composition_premultiplied_alpha)
+{
+  GstVideoOverlayRectangle *rect1;
+  GstBuffer *pix1, *pix2, *pix3, *pix4, *pix5;
+  GstBuffer *pix6, *pix7, *pix8, *pix9, *pix10;
+  guint8 *data5, *data7;
+  guint w, h, stride, w2, h2, stride2;
+
+  pix1 = gst_buffer_new_and_alloc (200 * sizeof (guint32) * 50);
+  memset (GST_BUFFER_DATA (pix1), 0x80, GST_BUFFER_SIZE (pix1));
+
+  rect1 = gst_video_overlay_rectangle_new_argb (pix1, 200, 50, 200 * 4,
+      600, 50, 300, 50, GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE);
+  gst_buffer_unref (pix1);
+
+  /* same flags, unscaled, should be the same buffer */
+  pix2 = gst_video_overlay_rectangle_get_pixels_unscaled_argb (rect1, &w, &h,
+      &stride, GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE);
+  fail_unless (pix1 == pix2);
+
+  /* same flags, but scaled */
+  pix3 = gst_video_overlay_rectangle_get_pixels_argb (rect1, &stride,
+      GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE);
+  fail_if (pix3 == pix1 || pix3 == pix2);
+
+  /* same again, should hopefully get the same (cached) buffer as before */
+  pix4 = gst_video_overlay_rectangle_get_pixels_argb (rect1, &stride,
+      GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE);
+  fail_unless (pix4 == pix3);
+
+  /* just to update the vars */
+  pix2 = gst_video_overlay_rectangle_get_pixels_unscaled_argb (rect1, &w, &h,
+      &stride, GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE);
+
+  /* now, let's try to get premultiplied alpha from the unpremultiplied input */
+  pix5 = gst_video_overlay_rectangle_get_pixels_unscaled_argb (rect1, &w2, &h2,
+      &stride2, GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA);
+  fail_if (pix5 == pix1 || pix5 == pix2 || pix5 == pix3);
+  fail_unless_equals_int (stride, stride2);
+  fail_unless_equals_int (w, w2);
+  fail_unless_equals_int (h, h2);
+  fail_unless_equals_int (GST_BUFFER_SIZE (pix2), GST_BUFFER_SIZE (pix5));
+  data5 = GST_BUFFER_DATA (pix5);
+  fail_if (memcmp (data5, GST_BUFFER_DATA (pix2), GST_BUFFER_SIZE (pix5)) == 0);
+
+  /* make sure it actually did what we expected it to do (input=0x80808080) */
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  /* B - G - R - A */
+  fail_unless_equals_int (data5[0], 0x40);
+  fail_unless_equals_int (data5[1], 0x40);
+  fail_unless_equals_int (data5[2], 0x40);
+  fail_unless_equals_int (data5[3], 0x80);
+#else
+  /* A - R - G - B */
+  fail_unless_equals_int (data5[0], 0x40);
+  fail_unless_equals_int (data5[1], 0x40);
+  fail_unless_equals_int (data5[2], 0x40);
+  fail_unless_equals_int (data5[3], 0x80);
+#endif
+
+  /* same again, now we should be getting back the same buffer as before,
+   * as it should have been cached */
+  pix6 = gst_video_overlay_rectangle_get_pixels_unscaled_argb (rect1, &w2, &h2,
+      &stride2, GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA);
+  fail_unless (pix6 == pix5);
+
+  /* just to update the stride var */
+  pix3 = gst_video_overlay_rectangle_get_pixels_argb (rect1, &stride,
+      GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE);
+  fail_unless (pix3 == pix4);
+
+  /* now try to get scaled premultiplied alpha from unpremultiplied input */
+  pix7 = gst_video_overlay_rectangle_get_pixels_argb (rect1, &stride2,
+      GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA);
+  fail_if (pix7 == pix1 || pix7 == pix2 || pix7 == pix3 || pix7 == pix5);
+  fail_unless_equals_int (stride, stride2);
+
+  data7 = GST_BUFFER_DATA (pix7);
+  /* make sure it actually did what we expected it to do (input=0x80808080)
+   * hoping that the scaling didn't mess up our values */
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  /* B - G - R - A */
+  fail_unless_equals_int (data7[0], 0x40);
+  fail_unless_equals_int (data7[1], 0x40);
+  fail_unless_equals_int (data7[2], 0x40);
+  fail_unless_equals_int (data7[3], 0x80);
+#else
+  /* A - R - G - B */
+  fail_unless_equals_int (data7[0], 0x40);
+  fail_unless_equals_int (data7[1], 0x40);
+  fail_unless_equals_int (data7[2], 0x40);
+  fail_unless_equals_int (data7[3], 0x80);
+#endif
+
+  /* and the same again, it should be cached now */
+  pix8 = gst_video_overlay_rectangle_get_pixels_argb (rect1, &stride2,
+      GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA);
+  fail_unless (pix8 == pix7);
+
+  /* make sure other cached stuff is still there */
+  pix9 = gst_video_overlay_rectangle_get_pixels_argb (rect1, &stride,
+      GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE);
+  fail_unless (pix9 == pix3);
+  pix10 = gst_video_overlay_rectangle_get_pixels_unscaled_argb (rect1, &w2, &h2,
+      &stride2, GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA);
+  fail_unless (pix10 == pix5);
+
+  gst_video_overlay_rectangle_unref (rect1);
+}
+
+GST_END_TEST;
+
+
+GST_START_TEST (test_overlay_composition_global_alpha)
+{
+  GstVideoOverlayRectangle *rect1;
+  GstBuffer *pix1, *pix2, *pix3, *pix4, *pix5;
+  guint8 *data2, *data4, *data5;
+  guint w, h, stride, stride3, w4, h4, stride4, stride5;
+  guint seq1, seq2;
+  gfloat ga1, ga2;
+  GstVideoOverlayFormatFlags flags1;
+
+  pix1 = gst_buffer_new_and_alloc (200 * sizeof (guint32) * 50);
+  memset (GST_BUFFER_DATA (pix1), 0x80, GST_BUFFER_SIZE (pix1));
+
+  rect1 = gst_video_overlay_rectangle_new_argb (pix1, 200, 50, 200 * 4,
+      600, 50, 300, 50, GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE);
+  gst_buffer_unref (pix1);
+
+  /* same flags, unscaled, should be the same buffer */
+  pix2 = gst_video_overlay_rectangle_get_pixels_unscaled_argb (rect1, &w, &h,
+      &stride, GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE);
+  fail_unless (pix1 == pix2);
+
+  /* same flags, but scaled */
+  pix3 = gst_video_overlay_rectangle_get_pixels_argb (rect1, &stride3,
+      GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE);
+  fail_if (pix3 == pix1 || pix3 == pix2);
+
+  /* get unscaled premultiplied data, new cached rectangle should be created */
+  pix4 = gst_video_overlay_rectangle_get_pixels_unscaled_argb (rect1, &w4, &h4,
+      &stride4, GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA);
+  fail_if (pix4 == pix2 || pix4 == pix3);
+  fail_unless_equals_int (stride, stride4);
+  fail_unless_equals_int (w, w4);
+  fail_unless_equals_int (h, h4);
+  fail_unless_equals_int (GST_BUFFER_SIZE (pix2), GST_BUFFER_SIZE (pix4));
+  data4 = GST_BUFFER_DATA (pix4);
+  fail_if (memcmp (data4, GST_BUFFER_DATA (pix1), GST_BUFFER_SIZE (pix1)) == 0);
+  /* make sure it actually did what we expected it to do (input=0x80808080) */
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  /* B - G - R - A */
+  fail_unless_equals_int (data4[0], 0x40);
+  fail_unless_equals_int (data4[1], 0x40);
+  fail_unless_equals_int (data4[2], 0x40);
+  fail_unless_equals_int (data4[3], 0x80);
+#else
+  /* A - R - G - B */
+  fail_unless_equals_int (data4[0], 0x80);
+  fail_unless_equals_int (data4[1], 0x40);
+  fail_unless_equals_int (data4[2], 0x40);
+  fail_unless_equals_int (data4[3], 0x40);
+#endif
+
+  /* now premultiplied and scaled, again a new cached rectangle should be cached */
+  pix5 = gst_video_overlay_rectangle_get_pixels_argb (rect1, &stride5,
+      GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA);
+  fail_if (pix5 == pix2 || pix5 == pix3 || pix5 == pix4);
+  /* stride and size should be equal to the first scaled rect */
+  fail_unless_equals_int (stride5, stride3);
+  fail_unless_equals_int (GST_BUFFER_SIZE (pix3), GST_BUFFER_SIZE (pix3));
+  data5 = GST_BUFFER_DATA (pix5);
+  /* data should be different (premutliplied) though */
+  fail_if (memcmp (data5, GST_BUFFER_DATA (pix3), GST_BUFFER_SIZE (pix3)) == 0);
+  /* make sure it actually did what we expected it to do (input=0x80808080) */
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  /* B - G - R - A */
+  fail_unless_equals_int (data5[0], 0x40);
+  fail_unless_equals_int (data5[1], 0x40);
+  fail_unless_equals_int (data5[2], 0x40);
+  fail_unless_equals_int (data5[3], 0x80);
+#else
+  /* A - R - G - B */
+  fail_unless_equals_int (data5[0], 0x80);
+  fail_unless_equals_int (data5[1], 0x40);
+  fail_unless_equals_int (data5[2], 0x40);
+  fail_unless_equals_int (data5[3], 0x40);
+#endif
+
+  /* global_alpha should initially be 1.0 */
+  ga1 = gst_video_overlay_rectangle_get_global_alpha (rect1);
+  fail_unless_equals_float (ga1, 1.0);
+
+  /* now set global_alpha */
+  seq1 = gst_video_overlay_rectangle_get_seqnum (rect1);
+  gst_video_overlay_rectangle_set_global_alpha (rect1, 0.5);
+  ga2 = gst_video_overlay_rectangle_get_global_alpha (rect1);
+  fail_unless_equals_float (ga2, 0.5);
+
+  /* seqnum should have changed */
+  seq2 = gst_video_overlay_rectangle_get_seqnum (rect1);
+  fail_unless (seq1 < seq2);
+
+  /* internal flags should have been set */
+  flags1 = gst_video_overlay_rectangle_get_flags (rect1);
+  fail_unless_equals_int (flags1, GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA);
+
+  /* request unscaled pixel-data, global-alpha not applied */
+  pix2 = gst_video_overlay_rectangle_get_pixels_unscaled_argb (rect1, &w, &h,
+      &stride, GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA);
+  /* this should just return the same buffer */
+  fail_unless (pix2 == pix1);
+  data2 = GST_BUFFER_DATA (pix2);
+  fail_unless (memcmp (data2, GST_BUFFER_DATA (pix1),
+          GST_BUFFER_SIZE (pix1)) == 0);
+  /* make sure we got the initial data (input=0x80808080) */
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  /* B - G - R - A */
+  fail_unless_equals_int (data2[0], 0x80);
+  fail_unless_equals_int (data2[1], 0x80);
+  fail_unless_equals_int (data2[2], 0x80);
+  fail_unless_equals_int (data2[3], 0x80);
+#else
+  /* A - R - G - B */
+  fail_unless_equals_int (data2[0], 0x80);
+  fail_unless_equals_int (data2[1], 0x80);
+  fail_unless_equals_int (data2[2], 0x80);
+  fail_unless_equals_int (data2[3], 0x80);
+#endif
+
+  /* unscaled pixel-data, global-alpha applied */
+  pix2 = gst_video_overlay_rectangle_get_pixels_unscaled_argb (rect1, &w, &h,
+      &stride, GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE);
+  /* this should be the same buffer with on-the-fly modified alpha-channel */
+  fail_unless (pix2 == pix1);
+  data2 = GST_BUFFER_DATA (pix2);
+  fail_unless (memcmp (data2, GST_BUFFER_DATA (pix1),
+          GST_BUFFER_SIZE (pix1)) == 0);
+  /* make sure we got the initial data with adjusted alpha-channel */
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  /* B - G - R - A */
+  fail_unless_equals_int (data2[0], 0x80);
+  fail_unless_equals_int (data2[1], 0x80);
+  fail_unless_equals_int (data2[2], 0x80);
+  fail_unless_equals_int (data2[3], 0x40);
+#else
+  /* A - R - G - B */
+  fail_unless_equals_int (data2[0], 0x40);
+  fail_unless_equals_int (data2[1], 0x80);
+  fail_unless_equals_int (data2[2], 0x80);
+  fail_unless_equals_int (data2[3], 0x80);
+#endif
+
+  /* adjust global_alpha once more */
+  gst_video_overlay_rectangle_set_global_alpha (rect1, 0.25);
+  ga2 = gst_video_overlay_rectangle_get_global_alpha (rect1);
+  fail_unless_equals_float (ga2, 0.25);
+  /* and again request unscaled pixel-data, global-alpha applied */
+  pix2 = gst_video_overlay_rectangle_get_pixels_unscaled_argb (rect1, &w, &h,
+      &stride, GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE);
+  fail_unless (pix2 == pix1);
+  data2 = GST_BUFFER_DATA (pix2);
+  fail_unless (memcmp (data2, GST_BUFFER_DATA (pix1),
+          GST_BUFFER_SIZE (pix1)) == 0);
+  /* make sure we got the initial data with adjusted alpha-channel */
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  /* B - G - R - A */
+  fail_unless_equals_int (data2[0], 0x80);
+  fail_unless_equals_int (data2[1], 0x80);
+  fail_unless_equals_int (data2[2], 0x80);
+  fail_unless_equals_int (data2[3], 0x20);
+#else
+  /* A - R - G - B */
+  fail_unless_equals_int (data2[0], 0x20);
+  fail_unless_equals_int (data2[1], 0x80);
+  fail_unless_equals_int (data2[2], 0x80);
+  fail_unless_equals_int (data2[3], 0x80);
+#endif
+
+  /* again: unscaled pixel-data, global-alpha not applied,
+   * this should revert alpha-channel to initial values */
+  pix2 = gst_video_overlay_rectangle_get_pixels_unscaled_argb (rect1, &w, &h,
+      &stride, GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA);
+  fail_unless (pix2 == pix1);
+  data2 = GST_BUFFER_DATA (pix2);
+  fail_unless (memcmp (data2, GST_BUFFER_DATA (pix1),
+          GST_BUFFER_SIZE (pix1)) == 0);
+  /* make sure we got the initial data (input=0x80808080) */
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  /* B - G - R - A */
+  fail_unless_equals_int (data2[0], 0x80);
+  fail_unless_equals_int (data2[1], 0x80);
+  fail_unless_equals_int (data2[2], 0x80);
+  fail_unless_equals_int (data2[3], 0x80);
+#else
+  /* A - R - G - B */
+  fail_unless_equals_int (data2[0], 0x80);
+  fail_unless_equals_int (data2[1], 0x80);
+  fail_unless_equals_int (data2[2], 0x80);
+  fail_unless_equals_int (data2[3], 0x80);
+#endif
+
+  /* now scaled, global-alpha not applied */
+  pix2 = gst_video_overlay_rectangle_get_pixels_argb (rect1, &stride,
+      GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA);
+  /* this should just return the rect/buffer, that was cached for these
+   * scaling dimensions */
+  fail_unless (pix2 == pix3);
+  data2 = GST_BUFFER_DATA (pix2);
+  fail_unless (memcmp (data2, GST_BUFFER_DATA (pix3),
+          GST_BUFFER_SIZE (pix3)) == 0);
+  /* make sure we got the initial data (input=0x80808080) */
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  /* B - G - R - A */
+  fail_unless_equals_int (data2[0], 0x80);
+  fail_unless_equals_int (data2[1], 0x80);
+  fail_unless_equals_int (data2[2], 0x80);
+  fail_unless_equals_int (data2[3], 0x80);
+#else
+  /* A - R - G - B */
+  fail_unless_equals_int (data2[0], 0x80);
+  fail_unless_equals_int (data2[1], 0x80);
+  fail_unless_equals_int (data2[2], 0x80);
+  fail_unless_equals_int (data2[3], 0x80);
+#endif
+
+  /* scaled, global-alpha (0.25) applied */
+  pix2 = gst_video_overlay_rectangle_get_pixels_argb (rect1, &stride,
+      GST_VIDEO_OVERLAY_FORMAT_FLAG_NONE);
+  /* this should just return the rect/buffer, that was cached for these
+   * scaling dimensions with modified alpha channel */
+  fail_unless (pix2 == pix3);
+  data2 = GST_BUFFER_DATA (pix2);
+  fail_unless (memcmp (data2, GST_BUFFER_DATA (pix3),
+          GST_BUFFER_SIZE (pix3)) == 0);
+  /* make sure we got the data we expect for global-alpha=0.25 */
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  /* B - G - R - A */
+  fail_unless_equals_int (data2[0], 0x80);
+  fail_unless_equals_int (data2[1], 0x80);
+  fail_unless_equals_int (data2[2], 0x80);
+  fail_unless_equals_int (data2[3], 0x20);
+#else
+  /* A - R - G - B */
+  fail_unless_equals_int (data2[0], 0x20);
+  fail_unless_equals_int (data2[1], 0x80);
+  fail_unless_equals_int (data2[2], 0x80);
+  fail_unless_equals_int (data2[3], 0x80);
+#endif
+
+  /* now unscaled premultiplied data, global-alpha not applied,
+   * is this really a valid use case?*/
+  pix2 = gst_video_overlay_rectangle_get_pixels_unscaled_argb (rect1, &w, &h,
+      &stride, GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA |
+      GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA);
+  /* this should just return the rect/buffer, that was cached for the
+   * premultiplied data */
+  fail_unless (pix2 == pix4);
+  data2 = GST_BUFFER_DATA (pix2);
+  fail_unless (memcmp (data2, GST_BUFFER_DATA (pix4),
+          GST_BUFFER_SIZE (pix4)) == 0);
+  /* make sure we got what we expected */
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  /* B - G - R - A */
+  fail_unless_equals_int (data2[0], 0x40);
+  fail_unless_equals_int (data2[1], 0x40);
+  fail_unless_equals_int (data2[2], 0x40);
+  fail_unless_equals_int (data2[3], 0x80);
+#else
+  /* A - R - G - B */
+  fail_unless_equals_int (data2[0], 0x80);
+  fail_unless_equals_int (data2[1], 0x40);
+  fail_unless_equals_int (data2[2], 0x40);
+  fail_unless_equals_int (data2[3], 0x40);
+#endif
+
+  /* unscaled premultiplied data, global-alpha (0.25) applied */
+  pix2 = gst_video_overlay_rectangle_get_pixels_unscaled_argb (rect1, &w, &h,
+      &stride, GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA);
+  /* this should just return the rect/buffer, that was cached for the
+   * premultiplied data */
+  fail_unless (pix2 == pix4);
+  data2 = GST_BUFFER_DATA (pix2);
+  fail_unless (memcmp (data2, GST_BUFFER_DATA (pix4),
+          GST_BUFFER_SIZE (pix4)) == 0);
+  /* make sure we got what we expected:
+   * (0x40 / (0x80/0xFF) * (0x20/0xFF) = 0x10
+   * NOTE: unless we are using round() for the premultiplied case
+   * in gst_video_overlay_rectangle_apply_global_alpha() we get rounding
+   * error, i.e. 0x0F here */
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  /* B - G - R - A */
+  fail_unless_equals_int (data2[0], 0x0F);
+  fail_unless_equals_int (data2[1], 0x0F);
+  fail_unless_equals_int (data2[2], 0x0F);
+  fail_unless_equals_int (data2[3], 0x20);
+#else
+  /* A - R - G - B */
+  fail_unless_equals_int (data2[0], 0x20);
+  fail_unless_equals_int (data2[1], 0x0F);
+  fail_unless_equals_int (data2[2], 0x0F);
+  fail_unless_equals_int (data2[3], 0x0F);
+#endif
+
+  /* set global_alpha once more */
+  gst_video_overlay_rectangle_set_global_alpha (rect1, 0.75);
+  /* and verify that also premultiplied data is adjusted
+   * correspondingly (though with increasing rounding errors) */
+  pix2 = gst_video_overlay_rectangle_get_pixels_unscaled_argb (rect1, &w, &h,
+      &stride, GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA);
+  /* this should just return the rect/buffer, that was cached for the
+   * premultiplied data */
+  fail_unless (pix2 == pix4);
+  data2 = GST_BUFFER_DATA (pix2);
+  fail_unless (memcmp (data2, GST_BUFFER_DATA (pix4),
+          GST_BUFFER_SIZE (pix4)) == 0);
+  /* make sure we got what we expected:
+   * (0x0F / (0x20/0xFF) * (0x60/0xFF) = 0x2D
+   * NOTE: using floats everywhere we would get 0x30
+   * here we will actually end up with 0x2C */
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  /* B - G - R - A */
+  fail_unless_equals_int (data2[0], 0x2C);
+  fail_unless_equals_int (data2[1], 0x2C);
+  fail_unless_equals_int (data2[2], 0x2C);
+  fail_unless_equals_int (data2[3], 0x60);
+#else
+  /* A - R - G - B */
+  fail_unless_equals_int (data2[0], 0x60);
+  fail_unless_equals_int (data2[1], 0x2C);
+  fail_unless_equals_int (data2[2], 0x2C);
+  fail_unless_equals_int (data2[3], 0x2C);
+#endif
+
+  /* now scaled and premultiplied data, global-alpha not applied,
+   * is this really a valid use case?*/
+  pix2 = gst_video_overlay_rectangle_get_pixels_argb (rect1, &stride,
+      GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA |
+      GST_VIDEO_OVERLAY_FORMAT_FLAG_GLOBAL_ALPHA);
+  /* this should just return the rect/buffer, that was cached for the
+   * first premultiplied+scaled rect*/
+  fail_unless (pix2 == pix5);
+  fail_unless (stride == stride5);
+  data2 = GST_BUFFER_DATA (pix2);
+  fail_unless (memcmp (data2, GST_BUFFER_DATA (pix5),
+          GST_BUFFER_SIZE (pix5)) == 0);
+  /* make sure we got what we expected */
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  /* B - G - R - A */
+  fail_unless_equals_int (data2[0], 0x40);
+  fail_unless_equals_int (data2[1], 0x40);
+  fail_unless_equals_int (data2[2], 0x40);
+  fail_unless_equals_int (data2[3], 0x80);
+#else
+  /* A - R - G - B */
+  fail_unless_equals_int (data2[0], 0x80);
+  fail_unless_equals_int (data2[1], 0x40);
+  fail_unless_equals_int (data2[2], 0x40);
+  fail_unless_equals_int (data2[3], 0x40);
+#endif
+
+  /* scaled and premultiplied data, global-alpha applied */
+  pix2 = gst_video_overlay_rectangle_get_pixels_argb (rect1, &stride,
+      GST_VIDEO_OVERLAY_FORMAT_FLAG_PREMULTIPLIED_ALPHA);
+  /* this should just return the rect/buffer, that was cached for the
+   * first premultiplied+scaled rect*/
+  fail_unless (pix2 == pix5);
+  fail_unless (stride == stride5);
+  data2 = GST_BUFFER_DATA (pix2);
+  fail_unless (memcmp (data2, GST_BUFFER_DATA (pix5),
+          GST_BUFFER_SIZE (pix5)) == 0);
+  /* make sure we got what we expected; see above note about rounding errors! */
+#if G_BYTE_ORDER == G_LITTLE_ENDIAN
+  /* B - G - R - A */
+  fail_unless_equals_int (data2[0], 0x2F);
+  fail_unless_equals_int (data2[1], 0x2F);
+  fail_unless_equals_int (data2[2], 0x2F);
+  fail_unless_equals_int (data2[3], 0x60);
+#else
+  /* A - R - G - B */
+  fail_unless_equals_int (data2[0], 0x60);
+  fail_unless_equals_int (data2[1], 0x2F);
+  fail_unless_equals_int (data2[2], 0x2F);
+  fail_unless_equals_int (data2[3], 0x2F);
+#endif
+
+  gst_video_overlay_rectangle_unref (rect1);
+}
+
+GST_END_TEST;
+
 static Suite *
 video_suite (void)
 {
@@ -937,6 +1451,8 @@ video_suite (void)
   tcase_add_test (tc_chain, test_convert_frame_async);
   tcase_add_test (tc_chain, test_video_size_from_caps);
   tcase_add_test (tc_chain, test_overlay_composition);
+  tcase_add_test (tc_chain, test_overlay_composition_premultiplied_alpha);
+  tcase_add_test (tc_chain, test_overlay_composition_global_alpha);
 
   return s;
 }
diff --git a/tests/check/pipelines/theoraenc.c b/tests/check/pipelines/theoraenc.c
index 3b101d0..d230707 100644
--- a/tests/check/pipelines/theoraenc.c
+++ b/tests/check/pipelines/theoraenc.c
@@ -308,119 +308,6 @@ GST_START_TEST (test_continuity)
 
 GST_END_TEST;
 
-static gboolean
-drop_second_data_buffer (GstPad * droppad, GstBuffer * buffer, gpointer unused)
-{
-  return !(GST_BUFFER_OFFSET (buffer) == 1);
-}
-
-GST_START_TEST (test_discontinuity)
-{
-  GstElement *bin;
-  GstPad *pad, *droppad;
-  gchar *pipe_str;
-  GstBuffer *buffer;
-  GError *error = NULL;
-  guint drop_id;
-
-  pipe_str = g_strdup_printf ("videotestsrc num-buffers=10"
-      " ! video/x-raw-yuv,format=(fourcc)I420,framerate=10/1"
-      " ! theoraenc ! fakesink name=fs0");
-
-  bin = gst_parse_launch (pipe_str, &error);
-  fail_unless (bin != NULL, "Error parsing pipeline: %s",
-      error ? error->message : "(invalid error)");
-  g_free (pipe_str);
-
-  /* the plan: same as test_continuity, but dropping a buffer and seeing if
-     theoraenc correctly notes the discontinuity */
-
-  /* get the pad to use to drop buffers */
-  {
-    GstElement *sink = gst_bin_get_by_name (GST_BIN (bin), "theoraenc0");
-
-    fail_unless (sink != NULL, "Could not get theoraenc out of bin");
-    droppad = gst_element_get_static_pad (sink, "sink");
-    fail_unless (droppad != NULL, "Could not get pad out of theoraenc");
-    gst_object_unref (sink);
-  }
-
-  /* get the pad */
-  {
-    GstElement *sink = gst_bin_get_by_name (GST_BIN (bin), "fs0");
-
-    fail_unless (sink != NULL, "Could not get fakesink out of bin");
-    pad = gst_element_get_static_pad (sink, "sink");
-    fail_unless (pad != NULL, "Could not get pad out of fakesink");
-    gst_object_unref (sink);
-  }
-
-  drop_id = gst_pad_add_buffer_probe (droppad,
-      G_CALLBACK (drop_second_data_buffer), NULL);
-  gst_buffer_straw_start_pipeline (bin, pad);
-
-  /* header packets should have timestamp == NONE, granulepos 0 */
-  buffer = gst_buffer_straw_get_buffer (bin, pad);
-  check_buffer_timestamp (buffer, GST_CLOCK_TIME_NONE);
-  check_buffer_duration (buffer, GST_CLOCK_TIME_NONE);
-  check_buffer_granulepos (buffer, 0);
-  check_buffer_is_header (buffer, TRUE);
-  gst_buffer_unref (buffer);
-
-  buffer = gst_buffer_straw_get_buffer (bin, pad);
-  check_buffer_timestamp (buffer, GST_CLOCK_TIME_NONE);
-  check_buffer_duration (buffer, GST_CLOCK_TIME_NONE);
-  check_buffer_granulepos (buffer, 0);
-  check_buffer_is_header (buffer, TRUE);
-  gst_buffer_unref (buffer);
-
-  buffer = gst_buffer_straw_get_buffer (bin, pad);
-  check_buffer_timestamp (buffer, GST_CLOCK_TIME_NONE);
-  check_buffer_duration (buffer, GST_CLOCK_TIME_NONE);
-  check_buffer_granulepos (buffer, 0);
-  check_buffer_is_header (buffer, TRUE);
-  gst_buffer_unref (buffer);
-
-  {
-    buffer = gst_buffer_straw_get_buffer (bin, pad);
-    check_buffer_timestamp (buffer, 0);
-    /* plain division because I know the answer is exact */
-    check_buffer_duration (buffer, GST_SECOND / 10);
-    check_buffer_granulepos (buffer, 1 << GRANULEPOS_SHIFT);
-    check_buffer_is_header (buffer, FALSE);
-    fail_if (GST_BUFFER_IS_DISCONT (buffer), "expected continuous buffer yo");
-    gst_buffer_unref (buffer);
-
-    /* check discontinuity with the next buffer */
-    buffer = gst_buffer_straw_get_buffer (bin, pad);
-    check_buffer_duration (buffer, GST_SECOND / 10);
-    /* After a discont, we'll always get a keyframe, so this one should be 
-     * 3<<GRANULEPOS_SHIFT */
-    check_buffer_granulepos (buffer, 3 << GRANULEPOS_SHIFT);
-    check_buffer_is_header (buffer, FALSE);
-    fail_unless (GST_BUFFER_IS_DISCONT (buffer),
-        "expected discontinuous buffer yo");
-    gst_buffer_unref (buffer);
-
-    /* Then the buffer after that should be continuous */
-    buffer = gst_buffer_straw_get_buffer (bin, pad);
-    fail_if (GST_BUFFER_IS_DISCONT (buffer), "expected continuous buffer yo");
-    /* plain division because I know the answer is exact */
-    check_buffer_duration (buffer, GST_SECOND / 10);
-    check_buffer_granulepos (buffer, (3 << GRANULEPOS_SHIFT) | 1);
-    check_buffer_is_header (buffer, FALSE);
-    gst_buffer_unref (buffer);
-  }
-
-  gst_buffer_straw_stop_pipeline (bin, pad);
-  gst_pad_remove_buffer_probe (droppad, drop_id);
-
-  gst_object_unref (droppad);
-  gst_object_unref (pad);
-  gst_object_unref (bin);
-}
-
-GST_END_TEST;
 
 #endif /* #ifndef GST_DISABLE_PARSE */
 
@@ -437,7 +324,6 @@ theoraenc_suite (void)
 #ifndef GST_DISABLE_PARSE
   tcase_add_test (tc_chain, test_granulepos_offset);
   tcase_add_test (tc_chain, test_continuity);
-  tcase_add_test (tc_chain, test_discontinuity);
 #endif
 
   return s;
diff --git a/tests/examples/Makefile.am b/tests/examples/Makefile.am
index d765419..f2ac27f 100644
--- a/tests/examples/Makefile.am
+++ b/tests/examples/Makefile.am
@@ -8,9 +8,13 @@ if USE_GIO
 GIO_SUBDIRS = gio
 endif
 
-SUBDIRS = app audio dynamic fft $(FT2_SUBDIRS) $(GIO_SUBDIRS) overlay playrec v4l encoding
+if HAVE_GTK
+GTK_SUBDIRS = playback
+endif
+
+SUBDIRS = app audio dynamic fft $(FT2_SUBDIRS) $(GIO_SUBDIRS) overlay $(GTK_SUBDIRS) playrec v4l encoding
 
-DIST_SUBDIRS = app audio dynamic fft gio overlay seek snapshot playrec v4l encoding
+DIST_SUBDIRS = app audio dynamic fft gio overlay seek snapshot playback playrec v4l encoding
 
 include $(top_srcdir)/common/parallel-subdirs.mak
 
diff --git a/tests/examples/Makefile.in b/tests/examples/Makefile.in
index 7076434..b7889e8 100644
--- a/tests/examples/Makefile.in
+++ b/tests/examples/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -20,6 +19,23 @@
 # descending into all subdirectories a second time, but only after the first
 # (parallel) run has finished, so it should go right through the second time.
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -38,6 +54,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
 	$(top_srcdir)/common/parallel-subdirs.mak
 subdir = tests/examples
@@ -85,12 +102,18 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
 RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
@@ -100,6 +123,11 @@ RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
@@ -421,15 +449,20 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
 @HAVE_FT2_FALSE@FT2_SUBDIRS = 
 @HAVE_FT2_TRUE@FT2_SUBDIRS = seek snapshot
 @USE_GIO_TRUE@GIO_SUBDIRS = gio
-SUBDIRS = app audio dynamic fft $(FT2_SUBDIRS) $(GIO_SUBDIRS) overlay playrec v4l encoding
-DIST_SUBDIRS = app audio dynamic fft gio overlay seek snapshot playrec v4l encoding
+@HAVE_GTK_TRUE@GTK_SUBDIRS = playback
+SUBDIRS = app audio dynamic fft $(FT2_SUBDIRS) $(GIO_SUBDIRS) overlay $(GTK_SUBDIRS) playrec v4l encoding
+DIST_SUBDIRS = app audio dynamic fft gio overlay seek snapshot playback playrec v4l encoding
 all: all-recursive
 
 .SUFFIXES:
@@ -472,12 +505,12 @@ clean-libtool:
 	-rm -rf .libs _libs
 
 # This directory's subdirectories are mostly independent; you can cd
-# into them and run `make' without going through this Makefile.
-# To change the values of `make' variables: instead of editing Makefiles,
-# (1) if the variable is set in `config.status', edit `config.status'
-#     (which will cause the Makefiles to be regenerated when you run `make');
-# (2) otherwise, pass the desired values on the `make' command line.
-$(RECURSIVE_TARGETS):
+# into them and run 'make' without going through this Makefile.
+# To change the values of 'make' variables: instead of editing Makefiles,
+# (1) if the variable is set in 'config.status', edit 'config.status'
+#     (which will cause the Makefiles to be regenerated when you run 'make');
+# (2) otherwise, pass the desired values on the 'make' command line.
+$(RECURSIVE_TARGETS) $(RECURSIVE_CLEAN_TARGETS):
 	@fail= failcom='exit 1'; \
 	for f in x $$MAKEFLAGS; do \
 	  case $$f in \
@@ -487,7 +520,11 @@ $(RECURSIVE_TARGETS):
 	done; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
-	list='$(SUBDIRS)'; for subdir in $$list; do \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	for subdir in $$list; do \
 	  echo "Making $$target in $$subdir"; \
 	  if test "$$subdir" = "."; then \
 	    dot_seen=yes; \
@@ -501,37 +538,6 @@ $(RECURSIVE_TARGETS):
 	if test "$$dot_seen" = "no"; then \
 	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
 	fi; test -z "$$fail"
-
-$(RECURSIVE_CLEAN_TARGETS):
-	@fail= failcom='exit 1'; \
-	for f in x $$MAKEFLAGS; do \
-	  case $$f in \
-	    *=* | --[!k]*);; \
-	    *k*) failcom='fail=yes';; \
-	  esac; \
-	done; \
-	dot_seen=no; \
-	case "$@" in \
-	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
-	  *) list='$(SUBDIRS)' ;; \
-	esac; \
-	rev=''; for subdir in $$list; do \
-	  if test "$$subdir" = "."; then :; else \
-	    rev="$$subdir $$rev"; \
-	  fi; \
-	done; \
-	rev="$$rev ."; \
-	target=`echo $@ | sed s/-recursive//`; \
-	for subdir in $$rev; do \
-	  echo "Making $$target in $$subdir"; \
-	  if test "$$subdir" = "."; then \
-	    local_target="$$target-am"; \
-	  else \
-	    local_target="$$target"; \
-	  fi; \
-	  ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
-	  || eval $$failcom; \
-	done && test -z "$$fail"
 tags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
@@ -540,6 +546,10 @@ ctags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
 	done
+cscopelist-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) cscopelist); \
+	done
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -603,6 +613,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist: cscopelist-recursive $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -638,13 +662,10 @@ distdir: $(DISTFILES)
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -765,22 +786,23 @@ ps-am:
 
 uninstall-am:
 
-.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) ctags-recursive \
-	install-am install-strip tags-recursive
+.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) \
+	cscopelist-recursive ctags-recursive install-am install-strip \
+	tags-recursive
 
 .PHONY: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) CTAGS GTAGS \
 	all all-am check check-am clean clean-generic clean-libtool \
-	ctags ctags-recursive distclean distclean-generic \
-	distclean-libtool distclean-tags distdir dvi dvi-am html \
-	html-am info info-am install install-am install-data \
-	install-data-am install-dvi install-dvi-am install-exec \
-	install-exec-am install-html install-html-am install-info \
-	install-info-am install-man install-pdf install-pdf-am \
-	install-ps install-ps-am install-strip installcheck \
-	installcheck-am installdirs installdirs-am maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-generic \
-	mostlyclean-libtool pdf pdf-am ps ps-am tags tags-recursive \
-	uninstall uninstall-am
+	cscopelist cscopelist-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-libtool distclean-tags \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-dvi \
+	install-dvi-am install-exec install-exec-am install-html \
+	install-html-am install-info install-info-am install-man \
+	install-pdf install-pdf-am install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	mostlyclean mostlyclean-generic mostlyclean-libtool pdf pdf-am \
+	ps ps-am tags tags-recursive uninstall uninstall-am
 
 
 .PHONY: independent-subdirs $(SUBDIRS)
diff --git a/tests/examples/app/Makefile.in b/tests/examples/app/Makefile.in
index 5d1300c..aaf711e 100644
--- a/tests/examples/app/Makefile.in
+++ b/tests/examples/app/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,11 +50,13 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 noinst_PROGRAMS = appsrc_ex$(EXEEXT) appsrc-stream$(EXEEXT) \
 	appsrc-stream2$(EXEEXT) appsrc-ra$(EXEEXT) \
 	appsrc-seekable$(EXEEXT) appsink-src$(EXEEXT)
 subdir = tests/examples/app
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -92,6 +110,7 @@ appsink_src_DEPENDENCIES = $(top_builddir)/gst-libs/gst/app/libgstapp-@GST_MAJOR
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 appsink_src_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(appsink_src_CFLAGS) \
 	$(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
@@ -132,6 +151,18 @@ appsrc_ex_DEPENDENCIES = $(top_builddir)/gst-libs/gst/app/libgstapp-@GST_MAJORMI
 appsrc_ex_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(appsrc_ex_CFLAGS) \
 	$(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -144,26 +175,27 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(appsink_src_SOURCES) $(appsrc_ra_SOURCES) \
 	$(appsrc_seekable_SOURCES) $(appsrc_stream_SOURCES) \
 	$(appsrc_stream2_SOURCES) $(appsrc_ex_SOURCES)
 DIST_SOURCES = $(appsink_src_SOURCES) $(appsrc_ra_SOURCES) \
 	$(appsrc_seekable_SOURCES) $(appsrc_stream_SOURCES) \
 	$(appsrc_stream2_SOURCES) $(appsrc_ex_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -455,7 +487,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -718,6 +754,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -859,7 +909,7 @@ uninstall-am:
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-noinstPROGRAMS ctags distclean \
+	clean-libtool clean-noinstPROGRAMS cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
diff --git a/tests/examples/audio/Makefile.in b/tests/examples/audio/Makefile.in
index c2bccda..9588ad9 100644
--- a/tests/examples/audio/Makefile.in
+++ b/tests/examples/audio/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,9 +50,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 noinst_PROGRAMS = testchannels$(EXEEXT) $(am__EXEEXT_1)
 subdir = tests/examples/audio
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -92,6 +110,7 @@ am__DEPENDENCIES_1 =
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 audiomix_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(audiomix_CFLAGS) \
 	$(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
@@ -110,6 +129,18 @@ volume_OBJECTS = $(am_volume_OBJECTS)
 volume_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(volume_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -122,24 +153,25 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(audiomix_SOURCES) $(testchannels_SOURCES) \
 	$(volume_SOURCES)
 DIST_SOURCES = $(am__audiomix_SOURCES_DIST) $(testchannels_SOURCES) \
 	$(am__volume_SOURCES_DIST)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -431,7 +463,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -629,6 +665,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -770,7 +820,7 @@ uninstall-am:
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-noinstPROGRAMS ctags distclean \
+	clean-libtool clean-noinstPROGRAMS cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
diff --git a/tests/examples/audio/audiomix.c b/tests/examples/audio/audiomix.c
index 937f4db..4ad1894 100644
--- a/tests/examples/audio/audiomix.c
+++ b/tests/examples/audio/audiomix.c
@@ -23,6 +23,9 @@
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
+/* FIXME 0.11: suppress warnings for deprecated API such as GStaticRecMutex
+ * with newer GTK versions (>= 3.3.0) */
+#define GDK_DISABLE_DEPRECATION_WARNINGS
 
 #include <string.h>
 #include <gst/gst.h>
diff --git a/tests/examples/audio/volume.c b/tests/examples/audio/volume.c
index d5bf9ed..a5e13c4 100644
--- a/tests/examples/audio/volume.c
+++ b/tests/examples/audio/volume.c
@@ -23,6 +23,9 @@
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
+/* FIXME 0.11: suppress warnings for deprecated API such as GStaticRecMutex
+ * with newer GTK versions (>= 3.3.0) */
+#define GDK_DISABLE_DEPRECATION_WARNINGS
 
 #include <math.h>
 
diff --git a/tests/examples/dynamic/Makefile.in b/tests/examples/dynamic/Makefile.in
index 5f28d34..7bcf1d8 100644
--- a/tests/examples/dynamic/Makefile.in
+++ b/tests/examples/dynamic/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,10 +50,12 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 noinst_PROGRAMS = addstream$(EXEEXT) codec-select$(EXEEXT) \
 	sprinkle$(EXEEXT) sprinkle2$(EXEEXT) sprinkle3$(EXEEXT)
 subdir = tests/examples/dynamic
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -90,6 +108,7 @@ addstream_DEPENDENCIES = $(am__DEPENDENCIES_1)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 addstream_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(addstream_CFLAGS) \
 	$(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
@@ -117,6 +136,18 @@ sprinkle3_DEPENDENCIES = $(am__DEPENDENCIES_1)
 sprinkle3_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(sprinkle3_CFLAGS) \
 	$(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -129,24 +160,25 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(addstream_SOURCES) $(codec_select_SOURCES) \
 	$(sprinkle_SOURCES) $(sprinkle2_SOURCES) $(sprinkle3_SOURCES)
 DIST_SOURCES = $(addstream_SOURCES) $(codec_select_SOURCES) \
 	$(sprinkle_SOURCES) $(sprinkle2_SOURCES) $(sprinkle3_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -438,7 +470,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -674,6 +710,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -815,7 +865,7 @@ uninstall-am:
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-noinstPROGRAMS ctags distclean \
+	clean-libtool clean-noinstPROGRAMS cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
diff --git a/tests/examples/encoding/Makefile.in b/tests/examples/encoding/Makefile.in
index a5a84a6..041b843 100644
--- a/tests/examples/encoding/Makefile.in
+++ b/tests/examples/encoding/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,9 +50,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 noinst_PROGRAMS = $(am__EXEEXT_1)
 subdir = tests/examples/encoding
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -92,6 +110,19 @@ encoding_DEPENDENCIES = $(top_builddir)/gst-libs/gst/pbutils/libgstpbutils-@GST_
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -104,22 +135,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(encoding_SOURCES)
 DIST_SOURCES = $(encoding_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -411,7 +443,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -559,6 +595,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -700,7 +750,7 @@ uninstall-am:
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-noinstPROGRAMS ctags distclean \
+	clean-libtool clean-noinstPROGRAMS cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
diff --git a/tests/examples/fft/Makefile.in b/tests/examples/fft/Makefile.in
index 777c336..b4a115b 100644
--- a/tests/examples/fft/Makefile.in
+++ b/tests/examples/fft/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,9 +50,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 noinst_PROGRAMS = fftrange$(EXEEXT)
 subdir = tests/examples/fft
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -90,9 +108,22 @@ fftrange_DEPENDENCIES = $(top_builddir)/gst-libs/gst/fft/libgstfft-$(GST_MAJORMI
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 fftrange_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(fftrange_CFLAGS) \
 	$(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -105,22 +136,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(fftrange_SOURCES)
 DIST_SOURCES = $(fftrange_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -412,7 +444,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -567,6 +603,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -708,7 +758,7 @@ uninstall-am:
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-noinstPROGRAMS ctags distclean \
+	clean-libtool clean-noinstPROGRAMS cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
diff --git a/tests/examples/fft/fftrange.c b/tests/examples/fft/fftrange.c
index 956f4a3..6573730 100644
--- a/tests/examples/fft/fftrange.c
+++ b/tests/examples/fft/fftrange.c
@@ -181,4 +181,6 @@ main (gint argc, gchar * argv[])
   test_f64 ("300, bartlett", num_bands, GST_FFT_WINDOW_BARTLETT);
   test_f64 ("300, blackman", num_bands, GST_FFT_WINDOW_BLACKMAN);
   puts ("\n");
+
+  return 0;
 }
diff --git a/tests/examples/gio/Makefile.in b/tests/examples/gio/Makefile.in
index 28c5d6f..46aabae 100644
--- a/tests/examples/gio/Makefile.in
+++ b/tests/examples/gio/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,10 +50,12 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 @HAVE_GTK_TRUE@@USE_GIO_TRUE@noinst_PROGRAMS =  \
 @HAVE_GTK_TRUE@@USE_GIO_TRUE@	giosrc-mounting$(EXEEXT)
 subdir = tests/examples/gio
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -94,10 +112,23 @@ am__DEPENDENCIES_1 =
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 giosrc_mounting_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(giosrc_mounting_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) \
 	-o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -110,22 +141,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(giosrc_mounting_SOURCES)
 DIST_SOURCES = $(am__giosrc_mounting_SOURCES_DIST)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -417,7 +449,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -569,6 +605,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -710,7 +760,7 @@ uninstall-am:
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-noinstPROGRAMS ctags distclean \
+	clean-libtool clean-noinstPROGRAMS cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
diff --git a/tests/examples/overlay/Makefile.in b/tests/examples/overlay/Makefile.in
index e299e25..dd160c6 100644
--- a/tests/examples/overlay/Makefile.in
+++ b/tests/examples/overlay/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,12 +50,14 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 @HAVE_GTK_X11_TRUE@@USE_X_TRUE@am__append_1 = gtk-xoverlay
 @HAVE_QT_TRUE@@USE_X_TRUE@am__append_2 = qt-xoverlay
 @HAVE_QT_GV_TRUE@@USE_X_TRUE@am__append_3 = qtgv-xoverlay
 noinst_PROGRAMS = $(am__EXEEXT_4)
 subdir = tests/examples/overlay
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -102,6 +120,7 @@ am__DEPENDENCIES_1 =
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 gtk_xoverlay_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(gtk_xoverlay_CFLAGS) \
 	$(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
@@ -133,6 +152,18 @@ qtgv_xoverlay_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CXX \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CXXLD) \
 	$(qtgv_xoverlay_CXXFLAGS) $(CXXFLAGS) $(AM_LDFLAGS) $(LDFLAGS) \
 	-o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -145,17 +176,16 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
 	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
 LTCXXCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) \
@@ -164,22 +194,26 @@ LTCXXCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) \
 	$(AM_CXXFLAGS) $(CXXFLAGS)
 AM_V_CXX = $(am__v_CXX_@AM_V@)
 am__v_CXX_ = $(am__v_CXX_@AM_DEFAULT_V@)
-am__v_CXX_0 = @echo "  CXX   " $@;
+am__v_CXX_0 = @echo "  CXX     " $@;
+am__v_CXX_1 = 
 CXXLD = $(CXX)
 CXXLINK = $(LIBTOOL) $(AM_V_lt) --tag=CXX $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CXXLD) $(AM_CXXFLAGS) \
 	$(CXXFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CXXLD = $(am__v_CXXLD_@AM_V@)
 am__v_CXXLD_ = $(am__v_CXXLD_@AM_DEFAULT_V@)
-am__v_CXXLD_0 = @echo "  CXXLD " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CXXLD_0 = @echo "  CXXLD   " $@;
+am__v_CXXLD_1 = 
 SOURCES = $(gtk_xoverlay_SOURCES) $(qt_xoverlay_SOURCES) \
 	$(qtgv_xoverlay_SOURCES) $(nodist_qtgv_xoverlay_SOURCES)
 DIST_SOURCES = $(am__gtk_xoverlay_SOURCES_DIST) \
 	$(am__qt_xoverlay_SOURCES_DIST) \
 	$(am__qtgv_xoverlay_SOURCES_DIST)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -471,7 +505,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -713,6 +751,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -855,7 +907,7 @@ uninstall-am:
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-noinstPROGRAMS ctags distclean \
+	clean-libtool clean-noinstPROGRAMS cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
diff --git a/tests/examples/playback/Makefile.am b/tests/examples/playback/Makefile.am
new file mode 100644
index 0000000..e28c512
--- /dev/null
+++ b/tests/examples/playback/Makefile.am
@@ -0,0 +1,7 @@
+noinst_PROGRAMS = playback-test
+
+LDADD = \
+	$(top_builddir)/gst-libs/gst/interfaces/libgstinterfaces-@GST_MAJORMINOR@.la \
+	$(GST_LIBS) $(GTK_LIBS) $(LIBM)
+
+AM_CFLAGS = -I$(top_builddir)/gst-libs $(GST_PLUGINS_BASE_CFLAGS) $(GST_BASE_CFLAGS) $(GST_CFLAGS) $(GTK_CFLAGS)
diff --git a/tests/examples/playback/Makefile.in b/tests/examples/playback/Makefile.in
new file mode 100644
index 0000000..df5e055
--- /dev/null
+++ b/tests/examples/playback/Makefile.in
@@ -0,0 +1,760 @@
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
+# @configure_input@
+
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
+# This Makefile.in is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY, to the extent permitted by law; without
+# even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+# PARTICULAR PURPOSE.
+
+@SET_MAKE@
+
+VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
+pkgdatadir = $(datadir)/@PACKAGE@
+pkgincludedir = $(includedir)/@PACKAGE@
+pkglibdir = $(libdir)/@PACKAGE@
+pkglibexecdir = $(libexecdir)/@PACKAGE@
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
+NORMAL_INSTALL = :
+PRE_INSTALL = :
+POST_INSTALL = :
+NORMAL_UNINSTALL = :
+PRE_UNINSTALL = :
+POST_UNINSTALL = :
+build_triplet = @build@
+host_triplet = @host@
+target_triplet = @target@
+noinst_PROGRAMS = playback-test$(EXEEXT)
+subdir = tests/examples/playback
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
+	$(top_srcdir)/common/m4/as-auto-alt.m4 \
+	$(top_srcdir)/common/m4/as-compiler-flag.m4 \
+	$(top_srcdir)/common/m4/as-libtool.m4 \
+	$(top_srcdir)/common/m4/as-python.m4 \
+	$(top_srcdir)/common/m4/as-scrub-include.m4 \
+	$(top_srcdir)/common/m4/as-version.m4 \
+	$(top_srcdir)/common/m4/ax_create_stdint_h.m4 \
+	$(top_srcdir)/common/m4/gst-arch.m4 \
+	$(top_srcdir)/common/m4/gst-args.m4 \
+	$(top_srcdir)/common/m4/gst-check.m4 \
+	$(top_srcdir)/common/m4/gst-default.m4 \
+	$(top_srcdir)/common/m4/gst-error.m4 \
+	$(top_srcdir)/common/m4/gst-feature.m4 \
+	$(top_srcdir)/common/m4/gst-function.m4 \
+	$(top_srcdir)/common/m4/gst-gettext.m4 \
+	$(top_srcdir)/common/m4/gst-glib2.m4 \
+	$(top_srcdir)/common/m4/gst-package-release-datetime.m4 \
+	$(top_srcdir)/common/m4/gst-platform.m4 \
+	$(top_srcdir)/common/m4/gst-plugin-docs.m4 \
+	$(top_srcdir)/common/m4/gst-plugindir.m4 \
+	$(top_srcdir)/common/m4/gst-x11.m4 \
+	$(top_srcdir)/common/m4/gst.m4 \
+	$(top_srcdir)/common/m4/gtk-doc.m4 \
+	$(top_srcdir)/common/m4/introspection.m4 \
+	$(top_srcdir)/common/m4/orc.m4 $(top_srcdir)/common/m4/pkg.m4 \
+	$(top_srcdir)/m4/freetype2.m4 $(top_srcdir)/m4/gettext.m4 \
+	$(top_srcdir)/m4/gst-alsa.m4 $(top_srcdir)/m4/gst-fionread.m4 \
+	$(top_srcdir)/m4/iconv.m4 $(top_srcdir)/m4/intlmacosx.m4 \
+	$(top_srcdir)/m4/lib-ld.m4 $(top_srcdir)/m4/lib-link.m4 \
+	$(top_srcdir)/m4/lib-prefix.m4 $(top_srcdir)/m4/libtool.m4 \
+	$(top_srcdir)/m4/lrint.m4 $(top_srcdir)/m4/lrintf.m4 \
+	$(top_srcdir)/m4/ltoptions.m4 $(top_srcdir)/m4/ltsugar.m4 \
+	$(top_srcdir)/m4/ltversion.m4 $(top_srcdir)/m4/lt~obsolete.m4 \
+	$(top_srcdir)/m4/nls.m4 $(top_srcdir)/m4/ogg.m4 \
+	$(top_srcdir)/m4/po.m4 $(top_srcdir)/m4/progtest.m4 \
+	$(top_srcdir)/m4/vorbis.m4 $(top_srcdir)/configure.ac
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(install_sh) -d
+CONFIG_HEADER = $(top_builddir)/config.h
+CONFIG_CLEAN_FILES =
+CONFIG_CLEAN_VPATH_FILES =
+PROGRAMS = $(noinst_PROGRAMS)
+playback_test_SOURCES = playback-test.c
+playback_test_OBJECTS = playback-test.$(OBJEXT)
+playback_test_LDADD = $(LDADD)
+am__DEPENDENCIES_1 =
+playback_test_DEPENDENCIES = $(top_builddir)/gst-libs/gst/interfaces/libgstinterfaces-@GST_MAJORMINOR@.la \
+	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
+	$(am__DEPENDENCIES_1)
+AM_V_lt = $(am__v_lt_@AM_V@)
+am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
+am__v_lt_0 = --silent
+am__v_lt_1 = 
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
+DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
+depcomp = $(SHELL) $(top_srcdir)/depcomp
+am__depfiles_maybe = depfiles
+am__mv = mv -f
+COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
+	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
+LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
+	$(LIBTOOLFLAGS) --mode=compile $(CC) $(DEFS) \
+	$(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) \
+	$(AM_CFLAGS) $(CFLAGS)
+AM_V_CC = $(am__v_CC_@AM_V@)
+am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
+CCLD = $(CC)
+LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
+	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
+	$(AM_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_CCLD = $(am__v_CCLD_@AM_V@)
+am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
+SOURCES = playback-test.c
+DIST_SOURCES = playback-test.c
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
+ETAGS = etags
+CTAGS = ctags
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ACLOCAL_AMFLAGS = @ACLOCAL_AMFLAGS@
+ALSA_CFLAGS = @ALSA_CFLAGS@
+ALSA_LIBS = @ALSA_LIBS@
+AMTAR = @AMTAR@
+AM_DEFAULT_VERBOSITY = @AM_DEFAULT_VERBOSITY@
+AR = @AR@
+AS = @AS@
+AUDIORESAMPLE_FORMAT_AUTO = @AUDIORESAMPLE_FORMAT_AUTO@
+AUDIORESAMPLE_FORMAT_FLOAT = @AUDIORESAMPLE_FORMAT_FLOAT@
+AUDIORESAMPLE_FORMAT_INT = @AUDIORESAMPLE_FORMAT_INT@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+CC = @CC@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CDPARANOIA_CFLAGS = @CDPARANOIA_CFLAGS@
+CDPARANOIA_LIBS = @CDPARANOIA_LIBS@
+CFLAGS = @CFLAGS@
+CPP = @CPP@
+CPPFLAGS = @CPPFLAGS@
+CXX = @CXX@
+CXXCPP = @CXXCPP@
+CXXDEPMODE = @CXXDEPMODE@
+CXXFLAGS = @CXXFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFAULT_AUDIOSINK = @DEFAULT_AUDIOSINK@
+DEFAULT_AUDIOSRC = @DEFAULT_AUDIOSRC@
+DEFAULT_VIDEOSINK = @DEFAULT_VIDEOSINK@
+DEFAULT_VIDEOSRC = @DEFAULT_VIDEOSRC@
+DEFAULT_VISUALIZER = @DEFAULT_VISUALIZER@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DEPRECATED_CFLAGS = @DEPRECATED_CFLAGS@
+DLLTOOL = @DLLTOOL@
+DSYMUTIL = @DSYMUTIL@
+DUMPBIN = @DUMPBIN@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EGREP = @EGREP@
+ERROR_CFLAGS = @ERROR_CFLAGS@
+ERROR_CXXFLAGS = @ERROR_CXXFLAGS@
+EXEEXT = @EXEEXT@
+FFLAGS = @FFLAGS@
+FGREP = @FGREP@
+FT2_CFLAGS = @FT2_CFLAGS@
+FT2_CONFIG = @FT2_CONFIG@
+FT2_LIBS = @FT2_LIBS@
+GCOV = @GCOV@
+GCOV_CFLAGS = @GCOV_CFLAGS@
+GCOV_LIBS = @GCOV_LIBS@
+GETTEXT_MACRO_VERSION = @GETTEXT_MACRO_VERSION@
+GETTEXT_PACKAGE = @GETTEXT_PACKAGE@
+GIO_CFLAGS = @GIO_CFLAGS@
+GIO_LDFLAGS = @GIO_LDFLAGS@
+GIO_LIBS = @GIO_LIBS@
+GLIB_CFLAGS = @GLIB_CFLAGS@
+GLIB_EXTRA_CFLAGS = @GLIB_EXTRA_CFLAGS@
+GLIB_LIBS = @GLIB_LIBS@
+GLIB_PREFIX = @GLIB_PREFIX@
+GLIB_REQ = @GLIB_REQ@
+GMSGFMT = @GMSGFMT@
+GMSGFMT_015 = @GMSGFMT_015@
+GNOME_VFS_CFLAGS = @GNOME_VFS_CFLAGS@
+GNOME_VFS_LIBS = @GNOME_VFS_LIBS@
+GREP = @GREP@
+GST_AGE = @GST_AGE@
+GST_ALL_LDFLAGS = @GST_ALL_LDFLAGS@
+GST_BASE_CFLAGS = @GST_BASE_CFLAGS@
+GST_BASE_LIBS = @GST_BASE_LIBS@
+GST_CFLAGS = @GST_CFLAGS@
+GST_CHECK_CFLAGS = @GST_CHECK_CFLAGS@
+GST_CHECK_LIBS = @GST_CHECK_LIBS@
+GST_CONTROLLER_CFLAGS = @GST_CONTROLLER_CFLAGS@
+GST_CONTROLLER_LIBS = @GST_CONTROLLER_LIBS@
+GST_CURRENT = @GST_CURRENT@
+GST_CXXFLAGS = @GST_CXXFLAGS@
+GST_DISABLE_ALLOC_TRACE = @GST_DISABLE_ALLOC_TRACE@
+GST_DISABLE_GST_DEBUG = @GST_DISABLE_GST_DEBUG@
+GST_DISABLE_LOADSAVE = @GST_DISABLE_LOADSAVE@
+GST_DISABLE_PARSE = @GST_DISABLE_PARSE@
+GST_DISABLE_PLUGIN = @GST_DISABLE_PLUGIN@
+GST_DISABLE_REGISTRY = @GST_DISABLE_REGISTRY@
+GST_DISABLE_TRACE = @GST_DISABLE_TRACE@
+GST_DISABLE_XML = @GST_DISABLE_XML@
+GST_GDP_CFLAGS = @GST_GDP_CFLAGS@
+GST_GDP_LIBS = @GST_GDP_LIBS@
+GST_INSTALL_PLUGINS_HELPER = @GST_INSTALL_PLUGINS_HELPER@
+GST_LEVEL_DEFAULT = @GST_LEVEL_DEFAULT@
+GST_LIBS = @GST_LIBS@
+GST_LIBVERSION = @GST_LIBVERSION@
+GST_LIB_LDFLAGS = @GST_LIB_LDFLAGS@
+GST_LICENSE = @GST_LICENSE@
+GST_LT_LDFLAGS = @GST_LT_LDFLAGS@
+GST_MAJORMINOR = @GST_MAJORMINOR@
+GST_OPTION_CFLAGS = @GST_OPTION_CFLAGS@
+GST_OPTION_CXXFLAGS = @GST_OPTION_CXXFLAGS@
+GST_PACKAGE_NAME = @GST_PACKAGE_NAME@
+GST_PACKAGE_ORIGIN = @GST_PACKAGE_ORIGIN@
+GST_PKG_CONFIG_PATH = @GST_PKG_CONFIG_PATH@
+GST_PLUGINS_ALL = @GST_PLUGINS_ALL@
+GST_PLUGINS_BASE_CFLAGS = @GST_PLUGINS_BASE_CFLAGS@
+GST_PLUGINS_DIR = @GST_PLUGINS_DIR@
+GST_PLUGINS_SELECTED = @GST_PLUGINS_SELECTED@
+GST_PLUGIN_LDFLAGS = @GST_PLUGIN_LDFLAGS@
+GST_PREFIX = @GST_PREFIX@
+GST_REVISION = @GST_REVISION@
+GST_TOOLS_DIR = @GST_TOOLS_DIR@
+GTKDOC_CHECK = @GTKDOC_CHECK@
+GTK_CFLAGS = @GTK_CFLAGS@
+GTK_LIBS = @GTK_LIBS@
+GTK_X11_CFLAGS = @GTK_X11_CFLAGS@
+GTK_X11_LIBS = @GTK_X11_LIBS@
+GUDEV_CFLAGS = @GUDEV_CFLAGS@
+GUDEV_LIBS = @GUDEV_LIBS@
+HAVE_CDPARANOIA = @HAVE_CDPARANOIA@
+HAVE_X = @HAVE_X@
+HAVE_XSHM = @HAVE_XSHM@
+HAVE_ZLIB = @HAVE_ZLIB@
+HSTRERROR_LIBS = @HSTRERROR_LIBS@
+HTML_DIR = @HTML_DIR@
+INSTALL = @INSTALL@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+INTLLIBS = @INTLLIBS@
+INTL_MACOSX_LIBS = @INTL_MACOSX_LIBS@
+INTROSPECTION_CFLAGS = @INTROSPECTION_CFLAGS@
+INTROSPECTION_COMPILER = @INTROSPECTION_COMPILER@
+INTROSPECTION_GENERATE = @INTROSPECTION_GENERATE@
+INTROSPECTION_GIRDIR = @INTROSPECTION_GIRDIR@
+INTROSPECTION_LIBS = @INTROSPECTION_LIBS@
+INTROSPECTION_MAKEFILE = @INTROSPECTION_MAKEFILE@
+INTROSPECTION_SCANNER = @INTROSPECTION_SCANNER@
+INTROSPECTION_TYPELIBDIR = @INTROSPECTION_TYPELIBDIR@
+IVORBIS_CFLAGS = @IVORBIS_CFLAGS@
+IVORBIS_LIBS = @IVORBIS_LIBS@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBICONV = @LIBICONV@
+LIBINTL = @LIBINTL@
+LIBM = @LIBM@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LIBTOOL = @LIBTOOL@
+LIBVISUAL_CFLAGS = @LIBVISUAL_CFLAGS@
+LIBVISUAL_LIBS = @LIBVISUAL_LIBS@
+LIPO = @LIPO@
+LN_S = @LN_S@
+LOCALEDIR = @LOCALEDIR@
+LTLIBICONV = @LTLIBICONV@
+LTLIBINTL = @LTLIBINTL@
+LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
+MAKEINFO = @MAKEINFO@
+MANIFEST_TOOL = @MANIFEST_TOOL@
+MKDIR_P = @MKDIR_P@
+MSGFMT = @MSGFMT@
+MSGFMT_015 = @MSGFMT_015@
+MSGMERGE = @MSGMERGE@
+NM = @NM@
+NMEDIT = @NMEDIT@
+OBJDUMP = @OBJDUMP@
+OBJEXT = @OBJEXT@
+OGG_CFLAGS = @OGG_CFLAGS@
+OGG_LIBS = @OGG_LIBS@
+ORCC = @ORCC@
+ORCC_FLAGS = @ORCC_FLAGS@
+ORC_CFLAGS = @ORC_CFLAGS@
+ORC_LIBS = @ORC_LIBS@
+OTOOL = @OTOOL@
+OTOOL64 = @OTOOL64@
+PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_URL = @PACKAGE_URL@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PACKAGE_VERSION_MAJOR = @PACKAGE_VERSION_MAJOR@
+PACKAGE_VERSION_MICRO = @PACKAGE_VERSION_MICRO@
+PACKAGE_VERSION_MINOR = @PACKAGE_VERSION_MINOR@
+PACKAGE_VERSION_NANO = @PACKAGE_VERSION_NANO@
+PACKAGE_VERSION_RELEASE = @PACKAGE_VERSION_RELEASE@
+PANGO_CFLAGS = @PANGO_CFLAGS@
+PANGO_LIBS = @PANGO_LIBS@
+PATH_SEPARATOR = @PATH_SEPARATOR@
+PKG_CONFIG = @PKG_CONFIG@
+PLUGINDIR = @PLUGINDIR@
+POSUB = @POSUB@
+PROFILE_CFLAGS = @PROFILE_CFLAGS@
+PYTHON = @PYTHON@
+PYTHON_EXEC_PREFIX = @PYTHON_EXEC_PREFIX@
+PYTHON_PLATFORM = @PYTHON_PLATFORM@
+PYTHON_PREFIX = @PYTHON_PREFIX@
+PYTHON_VERSION = @PYTHON_VERSION@
+QT4_MOC = @QT4_MOC@
+QT_CFLAGS = @QT_CFLAGS@
+QT_LIBS = @QT_LIBS@
+RANLIB = @RANLIB@
+SED = @SED@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
+THEORA_CFLAGS = @THEORA_CFLAGS@
+THEORA_LIBS = @THEORA_LIBS@
+USE_NLS = @USE_NLS@
+VALGRIND_CFLAGS = @VALGRIND_CFLAGS@
+VALGRIND_LIBS = @VALGRIND_LIBS@
+VALGRIND_PATH = @VALGRIND_PATH@
+VERSION = @VERSION@
+VORBISENC_LIBS = @VORBISENC_LIBS@
+VORBISFILE_LIBS = @VORBISFILE_LIBS@
+VORBIS_CFLAGS = @VORBIS_CFLAGS@
+VORBIS_LIBS = @VORBIS_LIBS@
+WARNING_CFLAGS = @WARNING_CFLAGS@
+WARNING_CXXFLAGS = @WARNING_CXXFLAGS@
+WIN32_LIBS = @WIN32_LIBS@
+XGETTEXT = @XGETTEXT@
+XGETTEXT_015 = @XGETTEXT_015@
+XGETTEXT_EXTRA_OPTIONS = @XGETTEXT_EXTRA_OPTIONS@
+XMKMF = @XMKMF@
+XSHM_LIBS = @XSHM_LIBS@
+XVIDEO_LIBS = @XVIDEO_LIBS@
+X_CFLAGS = @X_CFLAGS@
+X_EXTRA_LIBS = @X_EXTRA_LIBS@
+X_LIBS = @X_LIBS@
+X_PRE_LIBS = @X_PRE_LIBS@
+ZLIB_CFLAGS = @ZLIB_CFLAGS@
+ZLIB_LIBS = @ZLIB_LIBS@
+abs_builddir = @abs_builddir@
+abs_srcdir = @abs_srcdir@
+abs_top_builddir = @abs_top_builddir@
+abs_top_srcdir = @abs_top_srcdir@
+ac_ct_AR = @ac_ct_AR@
+ac_ct_CC = @ac_ct_CC@
+ac_ct_CXX = @ac_ct_CXX@
+ac_ct_DUMPBIN = @ac_ct_DUMPBIN@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+am__tar = @am__tar@
+am__untar = @am__untar@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+builddir = @builddir@
+datadir = @datadir@
+datarootdir = @datarootdir@
+docdir = @docdir@
+dvidir = @dvidir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+htmldir = @htmldir@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localedir = @localedir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+pdfdir = @pdfdir@
+pkgpyexecdir = @pkgpyexecdir@
+pkgpythondir = @pkgpythondir@
+plugindir = @plugindir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+psdir = @psdir@
+pyexecdir = @pyexecdir@
+pythondir = @pythondir@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+srcdir = @srcdir@
+sysconfdir = @sysconfdir@
+target = @target@
+target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
+top_build_prefix = @top_build_prefix@
+top_builddir = @top_builddir@
+top_srcdir = @top_srcdir@
+LDADD = \
+	$(top_builddir)/gst-libs/gst/interfaces/libgstinterfaces-@GST_MAJORMINOR@.la \
+	$(GST_LIBS) $(GTK_LIBS) $(LIBM)
+
+AM_CFLAGS = -I$(top_builddir)/gst-libs $(GST_PLUGINS_BASE_CFLAGS) $(GST_BASE_CFLAGS) $(GST_CFLAGS) $(GTK_CFLAGS)
+all: all-am
+
+.SUFFIXES:
+.SUFFIXES: .c .lo .o .obj
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      ( cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh ) \
+	        && { if test -f $@; then exit 0; else break; fi; }; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu tests/examples/playback/Makefile'; \
+	$(am__cd) $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu tests/examples/playback/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(am__aclocal_m4_deps):
+
+clean-noinstPROGRAMS:
+	@list='$(noinst_PROGRAMS)'; test -n "$$list" || exit 0; \
+	echo " rm -f" $$list; \
+	rm -f $$list || exit $$?; \
+	test -n "$(EXEEXT)" || exit 0; \
+	list=`for p in $$list; do echo "$$p"; done | sed 's/$(EXEEXT)$$//'`; \
+	echo " rm -f" $$list; \
+	rm -f $$list
+playback-test$(EXEEXT): $(playback_test_OBJECTS) $(playback_test_DEPENDENCIES) $(EXTRA_playback_test_DEPENDENCIES) 
+	@rm -f playback-test$(EXEEXT)
+	$(AM_V_CCLD)$(LINK) $(playback_test_OBJECTS) $(playback_test_LDADD) $(LIBS)
+
+mostlyclean-compile:
+	-rm -f *.$(OBJEXT)
+
+distclean-compile:
+	-rm -f *.tab.c
+
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/playback-test.Po@am__quote@
+
+.c.o:
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(COMPILE) -MT $@ -MD -MP -MF $(DEPDIR)/$*.Tpo -c -o $@ $<
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/$*.Tpo $(DEPDIR)/$*.Po
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(COMPILE) -c $<
+
+.c.obj:
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(COMPILE) -MT $@ -MD -MP -MF $(DEPDIR)/$*.Tpo -c -o $@ `$(CYGPATH_W) '$<'`
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/$*.Tpo $(DEPDIR)/$*.Po
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(COMPILE) -c `$(CYGPATH_W) '$<'`
+
+.c.lo:
+@am__fastdepCC_TRUE@	$(AM_V_CC)$(LTCOMPILE) -MT $@ -MD -MP -MF $(DEPDIR)/$*.Tpo -c -o $@ $<
+@am__fastdepCC_TRUE@	$(AM_V_at)$(am__mv) $(DEPDIR)/$*.Tpo $(DEPDIR)/$*.Plo
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(AM_V_CC)source='$<' object='$@' libtool=yes @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	DEPDIR=$(DEPDIR) $(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(AM_V_CC@am__nodep@)$(LTCOMPILE) -c -o $@ $<
+
+mostlyclean-libtool:
+	-rm -f *.lo
+
+clean-libtool:
+	-rm -rf .libs _libs
+
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '{ files[$$0] = 1; nonempty = 1; } \
+	      END { if (nonempty) { for (i in files) print i; }; }'`; \
+	mkid -fID $$unique
+tags: TAGS
+
+TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	set x; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '{ files[$$0] = 1; nonempty = 1; } \
+	      END { if (nonempty) { for (i in files) print i; }; }'`; \
+	shift; \
+	if test -z "$(ETAGS_ARGS)$$*$$unique"; then :; else \
+	  test -n "$$unique" || unique=$$empty_fix; \
+	  if test $$# -gt 0; then \
+	    $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	      "$$@" $$unique; \
+	  else \
+	    $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	      $$unique; \
+	  fi; \
+	fi
+ctags: CTAGS
+CTAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '{ files[$$0] = 1; nonempty = 1; } \
+	      END { if (nonempty) { for (i in files) print i; }; }'`; \
+	test -z "$(CTAGS_ARGS)$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && $(am__cd) $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) "$$here"
+
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
+distclean-tags:
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
+
+distdir: $(DISTFILES)
+	@srcdirstrip=`echo "$(srcdir)" | sed 's/[].[^$$\\*]/\\\\&/g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's/[].[^$$\\*]/\\\\&/g'`; \
+	list='$(DISTFILES)'; \
+	  dist_files=`for file in $$list; do echo $$file; done | \
+	  sed -e "s|^$$srcdirstrip/||;t" \
+	      -e "s|^$$topsrcdirstrip/|$(top_builddir)/|;t"`; \
+	case $$dist_files in \
+	  */*) $(MKDIR_P) `echo "$$dist_files" | \
+			   sed '/\//!d;s|^|$(distdir)/|;s,/[^/]*$$,,' | \
+			   sort -u` ;; \
+	esac; \
+	for file in $$dist_files; do \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  if test -d $$d/$$file; then \
+	    dir=`echo "/$$file" | sed -e 's,/[^/]*$$,,'`; \
+	    if test -d "$(distdir)/$$file"; then \
+	      find "$(distdir)/$$file" -type d ! -perm -700 -exec chmod u+rwx {} \;; \
+	    fi; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -fpR $(srcdir)/$$file "$(distdir)$$dir" || exit 1; \
+	      find "$(distdir)/$$file" -type d ! -perm -700 -exec chmod u+rwx {} \;; \
+	    fi; \
+	    cp -fpR $$d/$$file "$(distdir)$$dir" || exit 1; \
+	  else \
+	    test -f "$(distdir)/$$file" \
+	    || cp -p $$d/$$file "$(distdir)/$$file" \
+	    || exit 1; \
+	  fi; \
+	done
+check-am: all-am
+check: check-am
+all-am: Makefile $(PROGRAMS)
+installdirs:
+install: install-am
+install-exec: install-exec-am
+install-data: install-data-am
+uninstall: uninstall-am
+
+install-am: all-am
+	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
+
+installcheck: installcheck-am
+install-strip:
+	if test -z '$(STRIP)'; then \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	      install; \
+	else \
+	  $(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	    install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	    "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'" install; \
+	fi
+mostlyclean-generic:
+
+clean-generic:
+
+distclean-generic:
+	-test -z "$(CONFIG_CLEAN_FILES)" || rm -f $(CONFIG_CLEAN_FILES)
+	-test . = "$(srcdir)" || test -z "$(CONFIG_CLEAN_VPATH_FILES)" || rm -f $(CONFIG_CLEAN_VPATH_FILES)
+
+maintainer-clean-generic:
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-am
+
+clean-am: clean-generic clean-libtool clean-noinstPROGRAMS \
+	mostlyclean-am
+
+distclean: distclean-am
+	-rm -rf ./$(DEPDIR)
+	-rm -f Makefile
+distclean-am: clean-am distclean-compile distclean-generic \
+	distclean-tags
+
+dvi: dvi-am
+
+dvi-am:
+
+html: html-am
+
+html-am:
+
+info: info-am
+
+info-am:
+
+install-data-am:
+
+install-dvi: install-dvi-am
+
+install-dvi-am:
+
+install-exec-am:
+
+install-html: install-html-am
+
+install-html-am:
+
+install-info: install-info-am
+
+install-info-am:
+
+install-man:
+
+install-pdf: install-pdf-am
+
+install-pdf-am:
+
+install-ps: install-ps-am
+
+install-ps-am:
+
+installcheck-am:
+
+maintainer-clean: maintainer-clean-am
+	-rm -rf ./$(DEPDIR)
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-am
+
+mostlyclean-am: mostlyclean-compile mostlyclean-generic \
+	mostlyclean-libtool
+
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
+
+ps-am:
+
+uninstall-am:
+
+.MAKE: install-am install-strip
+
+.PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
+	clean-libtool clean-noinstPROGRAMS cscopelist ctags distclean \
+	distclean-compile distclean-generic distclean-libtool \
+	distclean-tags distdir dvi dvi-am html html-am info info-am \
+	install install-am install-data install-data-am install-dvi \
+	install-dvi-am install-exec install-exec-am install-html \
+	install-html-am install-info install-info-am install-man \
+	install-pdf install-pdf-am install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am
+
+
+# Tell versions [3.59,3.63) of GNU make to not export all variables.
+# Otherwise a system limit (for SysV at least) may be exceeded.
+.NOEXPORT:
diff --git a/tests/examples/playback/playback-test.c b/tests/examples/playback/playback-test.c
new file mode 100644
index 0000000..ef6526b
--- /dev/null
+++ b/tests/examples/playback/playback-test.c
@@ -0,0 +1,3379 @@
+/* GStreamer
+ *
+ * playback-test.c: playback sample application
+ *
+ * Copyright (C) 2005 Wim Taymans <wim@fluendo.com>
+ *               2006 Stefan Kost <ensonic@users.sf.net>
+ *               2012 Collabora Ltd.
+ *                 Author: Sebastian Dröge <sebastian.droege@collabora.co.uk>
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Library General Public
+ * License as published by the Free Software Foundation; either
+ * version 2 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Library General Public License for more details.
+ *
+ * You should have received a copy of the GNU Library General Public
+ * License along with this library; if not, write to the
+ * Free Software Foundation, Inc., 59 Temple Place - Suite 330,
+ * Boston, MA 02111-1307, USA.
+ */
+
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+/* FIXME 0.11: suppress warnings for deprecated API such as GStaticRecMutex
+ * with newer GTK versions (>= 3.3.0) */
+#define GDK_DISABLE_DEPRECATION_WARNINGS
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
+#include <stdlib.h>
+#include <math.h>
+#include <glib.h>
+#include <gtk/gtk.h>
+#include <gst/gst.h>
+#include <string.h>
+
+#include <gdk/gdk.h>
+#if defined (GDK_WINDOWING_X11)
+#include <gdk/gdkx.h>
+#elif defined (GDK_WINDOWING_WIN32)
+#include <gdk/gdkwin32.h>
+#elif defined (GDK_WINDOWING_QUARTZ)
+#include <gdk/gdkquartzwindow.h>
+#endif
+
+#include <gst/interfaces/xoverlay.h>
+#include <gst/interfaces/navigation.h>
+#include <gst/interfaces/colorbalance.h>
+
+GST_DEBUG_CATEGORY_STATIC (playback_debug);
+#define GST_CAT_DEFAULT (playback_debug)
+
+/* Copied from gst-plugins-base/gst/playback/gstplay-enum.h */
+typedef enum
+{
+  GST_PLAY_FLAG_VIDEO = (1 << 0),
+  GST_PLAY_FLAG_AUDIO = (1 << 1),
+  GST_PLAY_FLAG_TEXT = (1 << 2),
+  GST_PLAY_FLAG_VIS = (1 << 3),
+  GST_PLAY_FLAG_SOFT_VOLUME = (1 << 4),
+  GST_PLAY_FLAG_NATIVE_AUDIO = (1 << 5),
+  GST_PLAY_FLAG_NATIVE_VIDEO = (1 << 6),
+  GST_PLAY_FLAG_DOWNLOAD = (1 << 7),
+  GST_PLAY_FLAG_BUFFERING = (1 << 8),
+  GST_PLAY_FLAG_DEINTERLACE = (1 << 9),
+  GST_PLAY_FLAG_SOFT_COLORBALANCE = (1 << 10)
+} GstPlayFlags;
+
+/* configuration */
+
+#define FILL_INTERVAL 100
+//#define UPDATE_INTERVAL 500
+//#define UPDATE_INTERVAL 100
+#define UPDATE_INTERVAL 40
+
+/* number of milliseconds to play for after a seek */
+#define SCRUB_TIME 100
+
+/* timeout for gst_element_get_state() after a seek */
+#define SEEK_TIMEOUT 40 * GST_MSECOND
+
+#define DEFAULT_VIDEO_HEIGHT 300
+
+/* the state to go to when stop is pressed */
+#define STOP_STATE      GST_STATE_READY
+
+#define N_GRAD 1000.0
+
+/* we keep an array of the visualisation entries so that we can easily switch
+ * with the combo box index. */
+typedef struct
+{
+  GstElementFactory *factory;
+} VisEntry;
+
+typedef struct
+{
+  /* GTK widgets */
+  GtkWidget *window;
+  GtkWidget *video_combo, *audio_combo, *text_combo, *vis_combo;
+  GtkWidget *video_window;
+
+  GtkWidget *vis_checkbox, *video_checkbox, *audio_checkbox;
+  GtkWidget *text_checkbox, *mute_checkbox, *volume_spinbutton;
+  GtkWidget *soft_volume_checkbox, *native_audio_checkbox,
+      *native_video_checkbox;
+  GtkWidget *download_checkbox, *buffering_checkbox, *deinterlace_checkbox;
+  GtkWidget *soft_colorbalance_checkbox;
+  GtkWidget *video_sink_entry, *audio_sink_entry, *text_sink_entry;
+  GtkWidget *buffer_size_entry, *buffer_duration_entry;
+  GtkWidget *ringbuffer_maxsize_entry, *connection_speed_entry;
+  GtkWidget *av_offset_entry, *subtitle_encoding_entry;
+  GtkWidget *subtitle_fontdesc_button;
+
+  GtkWidget *seek_format_combo, *seek_position_label, *seek_duration_label;
+  GtkWidget *seek_entry;
+
+  GtkWidget *seek_scale, *statusbar;
+  guint status_id;
+
+  GtkWidget *step_format_combo, *step_amount_spinbutton, *step_rate_spinbutton;
+  GtkWidget *shuttle_scale;
+
+  GtkWidget *contrast_scale, *brightness_scale, *hue_scale, *saturation_scale;
+
+  struct
+  {
+    GstNavigationCommand cmd;
+    GtkWidget *button;
+  } navigation_buttons[14];
+
+  guintptr embed_xid;
+
+  /* GStreamer pipeline */
+  GstElement *pipeline;
+
+  GstElement *navigation_element;
+  GstElement *colorbalance_element;
+  GstElement *xoverlay_element;
+
+  /* Settings */
+  gboolean accurate_seek;
+  gboolean keyframe_seek;
+  gboolean loop_seek;
+  gboolean flush_seek;
+  gboolean scrub;
+  gboolean play_scrub;
+  gboolean skip_seek;
+  gdouble rate;
+  gboolean snap_before;
+  gboolean snap_after;
+
+  /* From commandline parameters */
+  gboolean stats;
+  gboolean verbose;
+  const gchar *pipeline_spec;
+  gint pipeline_type;
+  GList *paths, *current_path;
+  GList *sub_paths, *current_sub_path;
+
+  gchar *audiosink_str, *videosink_str;
+
+  /* Internal state */
+  gint64 position, duration;
+
+  gboolean is_live;
+  gboolean buffering;
+  GstBufferingMode mode;
+  gint64 buffering_left;
+  GstState state;
+  guint update_id;
+  guint seek_timeout_id;        /* Used for scrubbing in paused */
+  gulong changed_id;
+  guint fill_id;
+
+  gboolean need_streams;
+  gint n_video, n_audio, n_text;
+
+  GStaticMutex state_mutex;
+
+  GArray *vis_entries;          /* Array of VisEntry structs */
+
+  gboolean shuttling;
+  gdouble shuttle_rate;
+  gdouble play_rate;
+
+  const GstFormatDefinition *seek_format;
+  GList *formats;
+} PlaybackApp;
+
+static void clear_streams (PlaybackApp * app);
+static void find_interface_elements (PlaybackApp * app);
+static void volume_notify_cb (GstElement * pipeline, GParamSpec * arg,
+    PlaybackApp * app);
+static void mute_notify_cb (GstElement * pipeline, GParamSpec * arg,
+    PlaybackApp * app);
+
+static void video_sink_activate_cb (GtkEntry * entry, PlaybackApp * app);
+static void text_sink_activate_cb (GtkEntry * entry, PlaybackApp * app);
+static void audio_sink_activate_cb (GtkEntry * entry, PlaybackApp * app);
+static void buffer_size_activate_cb (GtkEntry * entry, PlaybackApp * app);
+static void buffer_duration_activate_cb (GtkEntry * entry, PlaybackApp * app);
+static void ringbuffer_maxsize_activate_cb (GtkEntry * entry,
+    PlaybackApp * app);
+static void connection_speed_activate_cb (GtkEntry * entry, PlaybackApp * app);
+static void av_offset_activate_cb (GtkEntry * entry, PlaybackApp * app);
+static void subtitle_encoding_activate_cb (GtkEntry * entry, PlaybackApp * app);
+
+/* pipeline construction */
+
+static GstElement *
+gst_element_factory_make_or_warn (const gchar * type, const gchar * name)
+{
+  GstElement *element = gst_element_factory_make (type, name);
+
+#ifndef GST_DISABLE_PARSE
+  if (!element) {
+    /* Try parsing it as a pipeline description */
+    element = gst_parse_bin_from_description (type, TRUE, NULL);
+    if (element) {
+      gst_element_set_name (element, name);
+    }
+  }
+#endif
+
+  if (!element) {
+    g_warning ("Failed to create element %s of type %s", name, type);
+  }
+
+  return element;
+}
+
+static void
+set_uri_property (GObject * object, const gchar * property,
+    const gchar * location)
+{
+  gchar *uri;
+
+  /* Add "file://" prefix for convenience */
+  if (location && (g_str_has_prefix (location, "/")
+          || !gst_uri_is_valid (location))) {
+    uri = gst_filename_to_uri (location, NULL);
+    g_print ("Setting URI: %s\n", uri);
+    g_object_set (object, property, uri, NULL);
+    g_free (uri);
+  } else {
+    g_print ("Setting URI: %s\n", location);
+    g_object_set (object, property, location, NULL);
+  }
+}
+
+static void
+playbin_set_uri (GstElement * playbin, const gchar * location,
+    const gchar * sub_location)
+{
+  set_uri_property (G_OBJECT (playbin), "uri", location);
+  set_uri_property (G_OBJECT (playbin), "suburi", sub_location);
+}
+
+static void
+make_playbin2_pipeline (PlaybackApp * app, const gchar * location)
+{
+  GstElement *pipeline;
+
+  app->pipeline = pipeline = gst_element_factory_make ("playbin2", "playbin2");
+  g_assert (pipeline);
+
+  playbin_set_uri (pipeline, location,
+      app->current_sub_path ? app->current_sub_path->data : NULL);
+
+  g_signal_connect (pipeline, "notify::volume", G_CALLBACK (volume_notify_cb),
+      app);
+  g_signal_connect (pipeline, "notify::mute", G_CALLBACK (mute_notify_cb), app);
+
+  app->navigation_element = GST_ELEMENT (gst_object_ref (pipeline));
+  app->colorbalance_element = GST_ELEMENT (gst_object_ref (pipeline));
+}
+
+#ifndef GST_DISABLE_PARSE
+static void
+make_parselaunch_pipeline (PlaybackApp * app, const gchar * description)
+{
+  app->pipeline = gst_parse_launch (description, NULL);
+}
+#endif
+
+typedef struct
+{
+  const gchar *name;
+  void (*func) (PlaybackApp * app, const gchar * location);
+}
+Pipeline;
+
+static const Pipeline pipelines[] = {
+  {"playbin2", make_playbin2_pipeline},
+#ifndef GST_DISABLE_PARSE
+  {"parse-launch", make_parselaunch_pipeline},
+#endif
+};
+
+/* ui callbacks and helpers */
+
+static gchar *
+format_value (GtkScale * scale, gdouble value, PlaybackApp * app)
+{
+  gint64 real;
+  gint64 seconds;
+  gint64 subseconds;
+
+  real = value * app->duration / N_GRAD;
+  seconds = (gint64) real / GST_SECOND;
+  subseconds = (gint64) real / (GST_MSECOND);
+
+  return g_strdup_printf ("%02" G_GINT64_FORMAT ":%02" G_GINT64_FORMAT ":%03"
+      G_GINT64_FORMAT, seconds / 60, seconds % 60, subseconds % 1000);
+}
+
+static gchar *
+shuttle_format_value (GtkScale * scale, gdouble value)
+{
+  return g_strdup_printf ("%0.*g", gtk_scale_get_digits (scale), value);
+}
+
+typedef struct
+{
+  const gchar *name;
+  const GstFormat format;
+}
+seek_format;
+
+static seek_format seek_formats[] = {
+  {"tim", GST_FORMAT_TIME},
+  {"byt", GST_FORMAT_BYTES},
+  {"buf", GST_FORMAT_BUFFERS},
+  {"def", GST_FORMAT_DEFAULT},
+  {NULL, 0},
+};
+
+static void
+query_positions (PlaybackApp * app)
+{
+  gint i = 0;
+
+  g_print ("positions %8.8s: ", GST_ELEMENT_NAME (app->pipeline));
+  while (seek_formats[i].name) {
+    gint64 position, total;
+    GstFormat format;
+
+    format = seek_formats[i].format;
+
+    if (gst_element_query_position (app->pipeline, &format, &position) &&
+        gst_element_query_duration (app->pipeline, &format, &total)) {
+      g_print ("%s %13" G_GINT64_FORMAT " / %13" G_GINT64_FORMAT " | ",
+          seek_formats[i].name, position, total);
+    } else {
+      g_print ("%s %13.13s / %13.13s | ", seek_formats[i].name, "*NA*", "*NA*");
+    }
+    i++;
+  }
+  g_print (" %s\n", GST_ELEMENT_NAME (app->pipeline));
+}
+
+static gboolean start_seek (GtkRange * range, GdkEventButton * event,
+    PlaybackApp * app);
+static gboolean stop_seek (GtkRange * range, GdkEventButton * event,
+    PlaybackApp * app);
+static void seek_cb (GtkRange * range, PlaybackApp * app);
+
+static void
+set_scale (PlaybackApp * app, gdouble value)
+{
+  g_signal_handlers_block_by_func (app->seek_scale, start_seek, app);
+  g_signal_handlers_block_by_func (app->seek_scale, stop_seek, app);
+  g_signal_handlers_block_by_func (app->seek_scale, seek_cb, app);
+  gtk_range_set_value (GTK_RANGE (app->seek_scale), value);
+  g_signal_handlers_unblock_by_func (app->seek_scale, start_seek, app);
+  g_signal_handlers_unblock_by_func (app->seek_scale, stop_seek, app);
+  g_signal_handlers_unblock_by_func (app->seek_scale, seek_cb, app);
+  gtk_widget_queue_draw (app->seek_scale);
+}
+
+static gboolean
+update_fill (PlaybackApp * app)
+{
+  GstQuery *query;
+
+  query = gst_query_new_buffering (GST_FORMAT_PERCENT);
+  if (gst_element_query (app->pipeline, query)) {
+    gint64 start, stop, buffering_total;
+    GstFormat format;
+    gdouble fill;
+    gboolean busy;
+    gint percent;
+    GstBufferingMode mode;
+    gint avg_in, avg_out;
+    gint64 buffering_left;
+
+    gst_query_parse_buffering_percent (query, &busy, &percent);
+    gst_query_parse_buffering_range (query, &format, &start, &stop,
+        &buffering_total);
+    gst_query_parse_buffering_stats (query, &mode, &avg_in, &avg_out,
+        &buffering_left);
+
+    /* note that we could start the playback when buffering_left < remaining
+     * playback time */
+    GST_DEBUG ("buffering total %" G_GINT64_FORMAT " ms, left %"
+        G_GINT64_FORMAT " ms", buffering_total, buffering_left);
+    GST_DEBUG ("start %" G_GINT64_FORMAT ", stop %" G_GINT64_FORMAT,
+        start, stop);
+
+    if (stop != -1)
+      fill = N_GRAD * stop / GST_FORMAT_PERCENT_MAX;
+    else
+      fill = N_GRAD;
+
+    gtk_range_set_fill_level (GTK_RANGE (app->seek_scale), fill);
+  }
+  gst_query_unref (query);
+
+  return TRUE;
+}
+
+static gboolean
+update_scale (PlaybackApp * app)
+{
+  GstFormat format = GST_FORMAT_TIME;
+  gint64 seek_pos, seek_dur;
+  gchar *str;
+
+  //position = 0;
+  //duration = 0;
+
+  gst_element_query_position (app->pipeline, &format, &app->position);
+  gst_element_query_duration (app->pipeline, &format, &app->duration);
+
+  if (app->stats)
+    query_positions (app);
+
+  if (app->position >= app->duration)
+    app->duration = app->position;
+
+  if (app->duration > 0) {
+    set_scale (app, app->position * N_GRAD / app->duration);
+  }
+
+  if (app->seek_format) {
+    format = app->seek_format->value;
+    seek_pos = seek_dur = -1;
+    gst_element_query_position (app->pipeline, &format, &seek_pos);
+    gst_element_query_duration (app->pipeline, &format, &seek_dur);
+
+    str = g_strdup_printf ("%" G_GINT64_FORMAT, seek_pos);
+    gtk_label_set_text (GTK_LABEL (app->seek_position_label), str);
+    g_free (str);
+
+    str = g_strdup_printf ("%" G_GINT64_FORMAT, seek_dur);
+    gtk_label_set_text (GTK_LABEL (app->seek_duration_label), str);
+    g_free (str);
+  }
+
+  return TRUE;
+}
+
+static void set_update_scale (PlaybackApp * app, gboolean active);
+static void set_update_fill (PlaybackApp * app, gboolean active);
+
+static gboolean
+end_scrub (PlaybackApp * app)
+{
+  GST_DEBUG ("end scrub, PAUSE");
+  gst_element_set_state (app->pipeline, GST_STATE_PAUSED);
+  app->seek_timeout_id = 0;
+
+  return FALSE;
+}
+
+static gboolean
+send_event (PlaybackApp * app, GstEvent * event)
+{
+  gboolean res = FALSE;
+
+  GST_DEBUG ("send event on element %s", GST_ELEMENT_NAME (app->pipeline));
+  res = gst_element_send_event (app->pipeline, event);
+
+  return res;
+}
+
+static void
+do_seek (PlaybackApp * app, GstFormat format, gint64 position)
+{
+  gboolean res = FALSE;
+  GstEvent *s_event;
+  GstSeekFlags flags;
+
+  flags = 0;
+  if (app->flush_seek)
+    flags |= GST_SEEK_FLAG_FLUSH;
+  if (app->accurate_seek)
+    flags |= GST_SEEK_FLAG_ACCURATE;
+  if (app->keyframe_seek)
+    flags |= GST_SEEK_FLAG_KEY_UNIT;
+  if (app->loop_seek)
+    flags |= GST_SEEK_FLAG_SEGMENT;
+  if (app->skip_seek)
+    flags |= GST_SEEK_FLAG_SKIP;
+  if (app->snap_before)
+    flags |= GST_SEEK_FLAG_SNAP_BEFORE;
+  if (app->snap_after)
+    flags |= GST_SEEK_FLAG_SNAP_AFTER;
+
+  if (app->rate >= 0) {
+    s_event = gst_event_new_seek (app->rate,
+        format, flags, GST_SEEK_TYPE_SET, position, GST_SEEK_TYPE_SET,
+        GST_CLOCK_TIME_NONE);
+    GST_DEBUG ("seek with rate %lf to %" GST_TIME_FORMAT " / %" GST_TIME_FORMAT,
+        app->rate, GST_TIME_ARGS (position), GST_TIME_ARGS (app->duration));
+  } else {
+    s_event = gst_event_new_seek (app->rate,
+        format, flags, GST_SEEK_TYPE_SET, G_GINT64_CONSTANT (0),
+        GST_SEEK_TYPE_SET, position);
+    GST_DEBUG ("seek with rate %lf to %" GST_TIME_FORMAT " / %" GST_TIME_FORMAT,
+        app->rate, GST_TIME_ARGS (0), GST_TIME_ARGS (position));
+  }
+
+  res = send_event (app, s_event);
+
+  if (res) {
+    if (app->flush_seek) {
+      gst_element_get_state (GST_ELEMENT (app->pipeline), NULL, NULL,
+          SEEK_TIMEOUT);
+    } else {
+      set_update_scale (app, TRUE);
+    }
+  } else {
+    g_print ("seek failed\n");
+    set_update_scale (app, TRUE);
+  }
+}
+
+static void
+seek_cb (GtkRange * range, PlaybackApp * app)
+{
+  gint64 real;
+
+  real =
+      gtk_range_get_value (GTK_RANGE (app->seek_scale)) * app->duration /
+      N_GRAD;
+
+  GST_DEBUG ("value=%f, real=%" G_GINT64_FORMAT,
+      gtk_range_get_value (GTK_RANGE (app->seek_scale)), real);
+
+  GST_DEBUG ("do seek");
+  do_seek (app, GST_FORMAT_TIME, real);
+
+  if (app->play_scrub) {
+    GST_DEBUG ("do scrub seek, PLAYING");
+    gst_element_set_state (app->pipeline, GST_STATE_PLAYING);
+
+    if (app->seek_timeout_id == 0) {
+      app->seek_timeout_id =
+          g_timeout_add (SCRUB_TIME, (GSourceFunc) end_scrub, app);
+    }
+  }
+}
+
+static void
+advanced_seek_button_cb (GtkButton * button, PlaybackApp * app)
+{
+  GstFormat fmt;
+  gint64 pos;
+  const gchar *text;
+  gchar *endptr;
+
+  fmt = app->seek_format->value;
+
+  text = gtk_entry_get_text (GTK_ENTRY (app->seek_entry));
+
+  pos = g_ascii_strtoll (text, &endptr, 10);
+  if (endptr != text && pos != G_MAXINT64 && pos != G_MININT64) {
+    do_seek (app, fmt, pos);
+  }
+}
+
+static void
+set_update_fill (PlaybackApp * app, gboolean active)
+{
+  GST_DEBUG ("fill scale is %d", active);
+
+  if (active) {
+    if (app->fill_id == 0) {
+      app->fill_id =
+          g_timeout_add (FILL_INTERVAL, (GSourceFunc) update_fill, app);
+    }
+  } else {
+    if (app->fill_id) {
+      g_source_remove (app->fill_id);
+      app->fill_id = 0;
+    }
+  }
+}
+
+static void
+set_update_scale (PlaybackApp * app, gboolean active)
+{
+  GST_DEBUG ("update scale is %d", active);
+
+  if (active) {
+    if (app->update_id == 0) {
+      app->update_id =
+          g_timeout_add (UPDATE_INTERVAL, (GSourceFunc) update_scale, app);
+    }
+  } else {
+    if (app->update_id) {
+      g_source_remove (app->update_id);
+      app->update_id = 0;
+    }
+  }
+}
+
+static gboolean
+start_seek (GtkRange * range, GdkEventButton * event, PlaybackApp * app)
+{
+  if (event->type != GDK_BUTTON_PRESS)
+    return FALSE;
+
+  set_update_scale (app, FALSE);
+
+  if (app->state == GST_STATE_PLAYING && app->flush_seek && app->scrub) {
+    GST_DEBUG ("start scrub seek, PAUSE");
+    gst_element_set_state (app->pipeline, GST_STATE_PAUSED);
+  }
+
+  if (app->changed_id == 0 && app->flush_seek && app->scrub) {
+    app->changed_id =
+        g_signal_connect (app->seek_scale, "value-changed",
+        G_CALLBACK (seek_cb), app);
+  }
+
+  return FALSE;
+}
+
+static gboolean
+stop_seek (GtkRange * range, GdkEventButton * event, PlaybackApp * app)
+{
+  if (app->changed_id) {
+    g_signal_handler_disconnect (app->seek_scale, app->changed_id);
+    app->changed_id = 0;
+  }
+
+  if (!app->flush_seek || !app->scrub) {
+    gint64 real;
+
+    GST_DEBUG ("do final seek");
+    real =
+        gtk_range_get_value (GTK_RANGE (app->seek_scale)) * app->duration /
+        N_GRAD;
+    do_seek (app, GST_FORMAT_TIME, real);
+  }
+
+  if (app->seek_timeout_id != 0) {
+    g_source_remove (app->seek_timeout_id);
+    app->seek_timeout_id = 0;
+    /* Still scrubbing, so the pipeline is playing, see if we need PAUSED
+     * instead. */
+    if (app->state == GST_STATE_PAUSED) {
+      GST_DEBUG ("stop scrub seek, PAUSED");
+      gst_element_set_state (app->pipeline, GST_STATE_PAUSED);
+    }
+  } else {
+    if (app->state == GST_STATE_PLAYING) {
+      GST_DEBUG ("stop scrub seek, PLAYING");
+      gst_element_set_state (app->pipeline, GST_STATE_PLAYING);
+    }
+  }
+
+  return FALSE;
+}
+
+static void
+play_cb (GtkButton * button, PlaybackApp * app)
+{
+  GstStateChangeReturn ret;
+
+  if (app->state != GST_STATE_PLAYING) {
+    g_print ("PLAY pipeline\n");
+    gtk_statusbar_pop (GTK_STATUSBAR (app->statusbar), app->status_id);
+
+    if (app->pipeline_type == 0) {
+      video_sink_activate_cb (GTK_ENTRY (app->video_sink_entry), app);
+      audio_sink_activate_cb (GTK_ENTRY (app->audio_sink_entry), app);
+      text_sink_activate_cb (GTK_ENTRY (app->text_sink_entry), app);
+      buffer_size_activate_cb (GTK_ENTRY (app->buffer_size_entry), app);
+      buffer_duration_activate_cb (GTK_ENTRY (app->buffer_duration_entry), app);
+      ringbuffer_maxsize_activate_cb (GTK_ENTRY (app->ringbuffer_maxsize_entry),
+          app);
+      connection_speed_activate_cb (GTK_ENTRY (app->connection_speed_entry),
+          app);
+      av_offset_activate_cb (GTK_ENTRY (app->av_offset_entry), app);
+      subtitle_encoding_activate_cb (GTK_ENTRY (app->subtitle_encoding_entry),
+          app);
+    }
+
+    ret = gst_element_set_state (app->pipeline, GST_STATE_PLAYING);
+    switch (ret) {
+      case GST_STATE_CHANGE_FAILURE:
+        goto failed;
+      case GST_STATE_CHANGE_NO_PREROLL:
+        app->is_live = TRUE;
+        break;
+      default:
+        break;
+    }
+    app->state = GST_STATE_PLAYING;
+    gtk_statusbar_push (GTK_STATUSBAR (app->statusbar), app->status_id,
+        "Playing");
+  }
+
+  return;
+
+failed:
+  {
+    g_print ("PLAY failed\n");
+    gtk_statusbar_push (GTK_STATUSBAR (app->statusbar), app->status_id,
+        "Play failed");
+  }
+}
+
+static void
+pause_cb (GtkButton * button, PlaybackApp * app)
+{
+  g_static_mutex_lock (&app->state_mutex);
+  if (app->state != GST_STATE_PAUSED) {
+    GstStateChangeReturn ret;
+
+    gtk_statusbar_pop (GTK_STATUSBAR (app->statusbar), app->status_id);
+    g_print ("PAUSE pipeline\n");
+    ret = gst_element_set_state (app->pipeline, GST_STATE_PAUSED);
+    switch (ret) {
+      case GST_STATE_CHANGE_FAILURE:
+        goto failed;
+      case GST_STATE_CHANGE_NO_PREROLL:
+        app->is_live = TRUE;
+        break;
+      default:
+        break;
+    }
+
+    app->state = GST_STATE_PAUSED;
+    gtk_statusbar_push (GTK_STATUSBAR (app->statusbar), app->status_id,
+        "Paused");
+  }
+  g_static_mutex_unlock (&app->state_mutex);
+
+  return;
+
+failed:
+  {
+    g_static_mutex_unlock (&app->state_mutex);
+    g_print ("PAUSE failed\n");
+    gtk_statusbar_push (GTK_STATUSBAR (app->statusbar), app->status_id,
+        "Pause failed");
+  }
+}
+
+static void
+stop_cb (GtkButton * button, PlaybackApp * app)
+{
+  if (app->state != STOP_STATE) {
+    GstStateChangeReturn ret;
+    gint i;
+
+    g_print ("READY pipeline\n");
+    gtk_statusbar_pop (GTK_STATUSBAR (app->statusbar), app->status_id);
+
+    g_static_mutex_lock (&app->state_mutex);
+    ret = gst_element_set_state (app->pipeline, STOP_STATE);
+    if (ret == GST_STATE_CHANGE_FAILURE)
+      goto failed;
+
+    app->state = STOP_STATE;
+    gtk_statusbar_push (GTK_STATUSBAR (app->statusbar), app->status_id,
+        "Stopped");
+    gtk_widget_queue_draw (app->video_window);
+
+    app->is_live = FALSE;
+    app->buffering = FALSE;
+    set_update_scale (app, FALSE);
+    set_scale (app, 0.0);
+    set_update_fill (app, FALSE);
+
+    if (app->pipeline_type == 0)
+      clear_streams (app);
+    g_static_mutex_unlock (&app->state_mutex);
+
+    gtk_widget_set_sensitive (GTK_WIDGET (app->seek_scale), TRUE);
+    for (i = 0; i < G_N_ELEMENTS (app->navigation_buttons); i++)
+      gtk_widget_set_sensitive (app->navigation_buttons[i].button, FALSE);
+  }
+  return;
+
+failed:
+  {
+    g_static_mutex_unlock (&app->state_mutex);
+    g_print ("STOP failed\n");
+    gtk_statusbar_push (GTK_STATUSBAR (app->statusbar), app->status_id,
+        "Stop failed");
+  }
+}
+
+static void
+snap_before_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  app->snap_before = gtk_toggle_button_get_active (button);
+}
+
+static void
+snap_after_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  app->snap_after = gtk_toggle_button_get_active (button);
+}
+
+static void
+accurate_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  app->accurate_seek = gtk_toggle_button_get_active (button);
+}
+
+static void
+key_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  app->keyframe_seek = gtk_toggle_button_get_active (button);
+}
+
+static void
+loop_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  app->loop_seek = gtk_toggle_button_get_active (button);
+  if (app->state == GST_STATE_PLAYING) {
+    gint64 real;
+
+    real =
+        gtk_range_get_value (GTK_RANGE (app->seek_scale)) * app->duration /
+        N_GRAD;
+    do_seek (app, GST_FORMAT_TIME, real);
+  }
+}
+
+static void
+flush_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  app->flush_seek = gtk_toggle_button_get_active (button);
+}
+
+static void
+scrub_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  app->scrub = gtk_toggle_button_get_active (button);
+}
+
+static void
+play_scrub_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  app->play_scrub = gtk_toggle_button_get_active (button);
+}
+
+static void
+skip_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  app->skip_seek = gtk_toggle_button_get_active (button);
+  if (app->state == GST_STATE_PLAYING) {
+    gint64 real;
+
+    real =
+        gtk_range_get_value (GTK_RANGE (app->seek_scale)) * app->duration /
+        N_GRAD;
+    do_seek (app, GST_FORMAT_TIME, real);
+  }
+}
+
+static void
+rate_spinbutton_changed_cb (GtkSpinButton * button, PlaybackApp * app)
+{
+  gboolean res = FALSE;
+  GstEvent *s_event;
+  GstSeekFlags flags;
+
+  app->rate = gtk_spin_button_get_value (button);
+
+  GST_DEBUG ("rate changed to %lf", app->rate);
+
+  flags = 0;
+  if (app->flush_seek)
+    flags |= GST_SEEK_FLAG_FLUSH;
+  if (app->loop_seek)
+    flags |= GST_SEEK_FLAG_SEGMENT;
+  if (app->accurate_seek)
+    flags |= GST_SEEK_FLAG_ACCURATE;
+  if (app->keyframe_seek)
+    flags |= GST_SEEK_FLAG_KEY_UNIT;
+  if (app->skip_seek)
+    flags |= GST_SEEK_FLAG_SKIP;
+
+  if (app->rate >= 0.0) {
+    s_event = gst_event_new_seek (app->rate,
+        GST_FORMAT_TIME, flags, GST_SEEK_TYPE_SET, app->position,
+        GST_SEEK_TYPE_SET, GST_CLOCK_TIME_NONE);
+  } else {
+    s_event = gst_event_new_seek (app->rate,
+        GST_FORMAT_TIME, flags, GST_SEEK_TYPE_SET, G_GINT64_CONSTANT (0),
+        GST_SEEK_TYPE_SET, app->position);
+  }
+
+  res = send_event (app, s_event);
+
+  if (res) {
+    if (app->flush_seek) {
+      gst_element_get_state (GST_ELEMENT (app->pipeline), NULL, NULL,
+          SEEK_TIMEOUT);
+    }
+  } else
+    g_print ("seek failed\n");
+}
+
+static void
+update_flag (GstElement * pipeline, GstPlayFlags flag, gboolean state)
+{
+  gint flags;
+
+  g_print ("%ssetting flag 0x%08x\n", (state ? "" : "un"), flag);
+
+  g_object_get (pipeline, "flags", &flags, NULL);
+  if (state)
+    flags |= flag;
+  else
+    flags &= ~(flag);
+  g_object_set (pipeline, "flags", flags, NULL);
+}
+
+static void
+vis_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  gboolean state;
+
+  state = gtk_toggle_button_get_active (button);
+  update_flag (app->pipeline, GST_PLAY_FLAG_VIS, state);
+  gtk_widget_set_sensitive (app->vis_combo, state);
+}
+
+static void
+audio_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  gboolean state;
+
+  state = gtk_toggle_button_get_active (button);
+  update_flag (app->pipeline, GST_PLAY_FLAG_AUDIO, state);
+  gtk_widget_set_sensitive (app->audio_combo, state);
+}
+
+static void
+video_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  gboolean state;
+
+  state = gtk_toggle_button_get_active (button);
+  update_flag (app->pipeline, GST_PLAY_FLAG_VIDEO, state);
+  gtk_widget_set_sensitive (app->video_combo, state);
+}
+
+static void
+text_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  gboolean state;
+
+  state = gtk_toggle_button_get_active (button);
+  update_flag (app->pipeline, GST_PLAY_FLAG_TEXT, state);
+  gtk_widget_set_sensitive (app->text_combo, state);
+}
+
+static void
+mute_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  gboolean mute;
+
+  mute = gtk_toggle_button_get_active (button);
+  g_object_set (app->pipeline, "mute", mute, NULL);
+}
+
+static void
+download_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  gboolean state;
+
+  state = gtk_toggle_button_get_active (button);
+  update_flag (app->pipeline, GST_PLAY_FLAG_DOWNLOAD, state);
+}
+
+static void
+buffering_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  gboolean state;
+
+  state = gtk_toggle_button_get_active (button);
+  update_flag (app->pipeline, GST_PLAY_FLAG_BUFFERING, state);
+}
+
+static void
+soft_volume_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  gboolean state;
+
+  state = gtk_toggle_button_get_active (button);
+  update_flag (app->pipeline, GST_PLAY_FLAG_SOFT_VOLUME, state);
+}
+
+static void
+native_audio_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  gboolean state;
+
+  state = gtk_toggle_button_get_active (button);
+  update_flag (app->pipeline, GST_PLAY_FLAG_NATIVE_AUDIO, state);
+}
+
+static void
+native_video_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  gboolean state;
+
+  state = gtk_toggle_button_get_active (button);
+  update_flag (app->pipeline, GST_PLAY_FLAG_NATIVE_VIDEO, state);
+}
+
+static void
+deinterlace_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  gboolean state;
+
+  state = gtk_toggle_button_get_active (button);
+  update_flag (app->pipeline, GST_PLAY_FLAG_DEINTERLACE, state);
+}
+
+static void
+soft_colorbalance_toggle_cb (GtkToggleButton * button, PlaybackApp * app)
+{
+  gboolean state;
+
+  state = gtk_toggle_button_get_active (button);
+  update_flag (app->pipeline, GST_PLAY_FLAG_SOFT_COLORBALANCE, state);
+}
+
+static void
+clear_streams (PlaybackApp * app)
+{
+  gint i;
+
+  /* remove previous info */
+  for (i = 0; i < app->n_video; i++)
+    gtk_combo_box_text_remove (GTK_COMBO_BOX_TEXT (app->video_combo), 0);
+  for (i = 0; i < app->n_audio; i++)
+    gtk_combo_box_text_remove (GTK_COMBO_BOX_TEXT (app->audio_combo), 0);
+  for (i = 0; i < app->n_text; i++)
+    gtk_combo_box_text_remove (GTK_COMBO_BOX_TEXT (app->text_combo), 0);
+
+  app->n_audio = app->n_video = app->n_text = 0;
+  gtk_widget_set_sensitive (app->video_combo, FALSE);
+  gtk_widget_set_sensitive (app->audio_combo, FALSE);
+  gtk_widget_set_sensitive (app->text_combo, FALSE);
+
+  app->need_streams = TRUE;
+}
+
+static void
+update_streams (PlaybackApp * app)
+{
+  gint i;
+
+  if (app->pipeline_type == 0 && app->need_streams) {
+    GstTagList *tags;
+    gchar *name, *str;
+    gint active_idx;
+    gboolean state;
+
+    /* remove previous info */
+    clear_streams (app);
+
+    /* here we get and update the different streams detected by playbin2 */
+    g_object_get (app->pipeline, "n-video", &app->n_video, NULL);
+    g_object_get (app->pipeline, "n-audio", &app->n_audio, NULL);
+    g_object_get (app->pipeline, "n-text", &app->n_text, NULL);
+
+    g_print ("video %d, audio %d, text %d\n", app->n_video, app->n_audio,
+        app->n_text);
+
+    active_idx = 0;
+    for (i = 0; i < app->n_video; i++) {
+      g_signal_emit_by_name (app->pipeline, "get-video-tags", i, &tags);
+      if (tags) {
+        str = gst_structure_to_string ((GstStructure *) tags);
+        g_print ("video %d: %s\n", i, str);
+        g_free (str);
+      }
+      /* find good name for the label */
+      name = g_strdup_printf ("video %d", i + 1);
+      gtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT (app->video_combo),
+          name);
+      g_free (name);
+    }
+    state =
+        gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON (app->video_checkbox));
+    gtk_widget_set_sensitive (app->video_combo, state && app->n_video > 0);
+    gtk_combo_box_set_active (GTK_COMBO_BOX (app->video_combo), active_idx);
+
+    active_idx = 0;
+    for (i = 0; i < app->n_audio; i++) {
+      g_signal_emit_by_name (app->pipeline, "get-audio-tags", i, &tags);
+      if (tags) {
+        str = gst_structure_to_string ((GstStructure *) tags);
+        g_print ("audio %d: %s\n", i, str);
+        g_free (str);
+      }
+      /* find good name for the label */
+      name = g_strdup_printf ("audio %d", i + 1);
+      gtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT (app->audio_combo),
+          name);
+      g_free (name);
+    }
+    state =
+        gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON (app->audio_checkbox));
+    gtk_widget_set_sensitive (app->audio_combo, state && app->n_audio > 0);
+    gtk_combo_box_set_active (GTK_COMBO_BOX (app->audio_combo), active_idx);
+
+    active_idx = 0;
+    for (i = 0; i < app->n_text; i++) {
+      g_signal_emit_by_name (app->pipeline, "get-text-tags", i, &tags);
+
+      name = NULL;
+      if (tags) {
+        const GValue *value;
+
+        str = gst_structure_to_string ((GstStructure *) tags);
+        g_print ("text %d: %s\n", i, str);
+        g_free (str);
+
+        /* get the language code if we can */
+        value = gst_tag_list_get_value_index (tags, GST_TAG_LANGUAGE_CODE, 0);
+        if (value && G_VALUE_HOLDS_STRING (value)) {
+          name = g_strdup_printf ("text %s", g_value_get_string (value));
+        }
+      }
+      /* find good name for the label if we didn't use a tag */
+      if (name == NULL)
+        name = g_strdup_printf ("text %d", i + 1);
+
+      gtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT (app->text_combo),
+          name);
+      g_free (name);
+    }
+    state =
+        gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON (app->text_checkbox));
+    gtk_widget_set_sensitive (app->text_combo, state && app->n_text > 0);
+    gtk_combo_box_set_active (GTK_COMBO_BOX (app->text_combo), active_idx);
+
+    app->need_streams = FALSE;
+  }
+}
+
+static void
+video_combo_cb (GtkComboBox * combo, PlaybackApp * app)
+{
+  gint active;
+
+  active = gtk_combo_box_get_active (combo);
+
+  g_print ("setting current video track %d\n", active);
+  g_object_set (app->pipeline, "current-video", active, NULL);
+}
+
+static void
+audio_combo_cb (GtkComboBox * combo, PlaybackApp * app)
+{
+  gint active;
+
+  active = gtk_combo_box_get_active (combo);
+
+  g_print ("setting current audio track %d\n", active);
+  g_object_set (app->pipeline, "current-audio", active, NULL);
+}
+
+static void
+text_combo_cb (GtkComboBox * combo, PlaybackApp * app)
+{
+  gint active;
+
+  active = gtk_combo_box_get_active (combo);
+
+  g_print ("setting current text track %d\n", active);
+  g_object_set (app->pipeline, "current-text", active, NULL);
+}
+
+static gboolean
+filter_vis_features (GstPluginFeature * feature, gpointer data)
+{
+  GstElementFactory *f;
+
+  if (!GST_IS_ELEMENT_FACTORY (feature))
+    return FALSE;
+  f = GST_ELEMENT_FACTORY (feature);
+  if (!g_strrstr (gst_element_factory_get_klass (f), "Visualization"))
+    return FALSE;
+
+  return TRUE;
+}
+
+static void
+init_visualization_features (PlaybackApp * app)
+{
+  GList *list, *walk;
+
+  app->vis_entries = g_array_new (FALSE, FALSE, sizeof (VisEntry));
+
+  list = gst_registry_feature_filter (gst_registry_get_default (),
+      filter_vis_features, FALSE, NULL);
+
+  for (walk = list; walk; walk = g_list_next (walk)) {
+    VisEntry entry;
+    const gchar *name;
+
+    entry.factory = GST_ELEMENT_FACTORY (walk->data);
+    name = gst_element_factory_get_longname (entry.factory);
+
+    g_array_append_val (app->vis_entries, entry);
+    gtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT (app->vis_combo), name);
+  }
+  gtk_combo_box_set_active (GTK_COMBO_BOX (app->vis_combo), 0);
+}
+
+static void
+vis_combo_cb (GtkComboBox * combo, PlaybackApp * app)
+{
+  guint index;
+  VisEntry *entry;
+  GstElement *element;
+
+  /* get the selected index and get the factory for this index */
+  index = gtk_combo_box_get_active (GTK_COMBO_BOX (app->vis_combo));
+  if (app->vis_entries->len > 0) {
+    entry = &g_array_index (app->vis_entries, VisEntry, index);
+
+    /* create an instance of the element from the factory */
+    element = gst_element_factory_create (entry->factory, NULL);
+    if (!element)
+      return;
+
+    /* set vis plugin for playbin2 */
+    g_object_set (app->pipeline, "vis-plugin", element, NULL);
+  }
+}
+
+static void
+volume_spinbutton_changed_cb (GtkSpinButton * button, PlaybackApp * app)
+{
+  gdouble volume;
+
+  volume = gtk_spin_button_get_value (button);
+
+  g_object_set (app->pipeline, "volume", volume, NULL);
+}
+
+static gboolean
+volume_notify_idle_cb (PlaybackApp * app)
+{
+  gdouble cur_volume, new_volume;
+
+  g_object_get (app->pipeline, "volume", &new_volume, NULL);
+  cur_volume =
+      gtk_spin_button_get_value (GTK_SPIN_BUTTON (app->volume_spinbutton));
+  if (fabs (cur_volume - new_volume) > 0.001) {
+    g_signal_handlers_block_by_func (app->volume_spinbutton,
+        volume_spinbutton_changed_cb, app);
+    gtk_spin_button_set_value (GTK_SPIN_BUTTON (app->volume_spinbutton),
+        new_volume);
+    g_signal_handlers_unblock_by_func (app->volume_spinbutton,
+        volume_spinbutton_changed_cb, app);
+  }
+
+  return FALSE;
+}
+
+static void
+volume_notify_cb (GstElement * pipeline, GParamSpec * arg, PlaybackApp * app)
+{
+  /* Do this from the main thread */
+  g_idle_add ((GSourceFunc) volume_notify_idle_cb, app);
+}
+
+static gboolean
+mute_notify_idle_cb (PlaybackApp * app)
+{
+  gboolean cur_mute, new_mute;
+
+  g_object_get (app->pipeline, "mute", &new_mute, NULL);
+  cur_mute =
+      gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON (app->mute_checkbox));
+  if (cur_mute != new_mute) {
+    g_signal_handlers_block_by_func (app->mute_checkbox, mute_toggle_cb, app);
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (app->mute_checkbox),
+        new_mute);
+    g_signal_handlers_unblock_by_func (app->mute_checkbox, mute_toggle_cb, app);
+  }
+
+  return FALSE;
+}
+
+static void
+mute_notify_cb (GstElement * pipeline, GParamSpec * arg, PlaybackApp * app)
+{
+  /* Do this from the main thread */
+  g_idle_add ((GSourceFunc) mute_notify_idle_cb, app);
+}
+
+static void
+shot_cb (GtkButton * button, PlaybackApp * app)
+{
+  GstBuffer *buffer;
+  GstCaps *caps;
+
+  /* convert to our desired format (RGB24) */
+  caps = gst_caps_new_simple ("video/x-raw-rgb",
+      "bpp", G_TYPE_INT, 24, "depth", G_TYPE_INT, 24,
+      /* Note: we don't ask for a specific width/height here, so that
+       * videoscale can adjust dimensions from a non-1/1 pixel aspect
+       * ratio to a 1/1 pixel-aspect-ratio */
+      "pixel-aspect-ratio", GST_TYPE_FRACTION, 1, 1,
+      "endianness", G_TYPE_INT, G_BIG_ENDIAN,
+      "red_mask", G_TYPE_INT, 0xff0000,
+      "green_mask", G_TYPE_INT, 0x00ff00,
+      "blue_mask", G_TYPE_INT, 0x0000ff, NULL);
+
+  /* convert the latest frame to the requested format */
+  g_signal_emit_by_name (app->pipeline, "convert-frame", caps, &buffer);
+  gst_caps_unref (caps);
+
+  if (buffer) {
+    GstCaps *caps;
+    GstStructure *s;
+    gboolean res;
+    gint width, height;
+    GdkPixbuf *pixbuf;
+    GError *error = NULL;
+
+    /* get the snapshot buffer format now. We set the caps on the appsink so
+     * that it can only be an rgb buffer. The only thing we have not specified
+     * on the caps is the height, which is dependant on the pixel-aspect-ratio
+     * of the source material */
+    caps = GST_BUFFER_CAPS (buffer);
+    if (!caps) {
+      g_warning ("could not get snapshot format\n");
+      goto done;
+    }
+    s = gst_caps_get_structure (caps, 0);
+
+    /* we need to get the final caps on the buffer to get the size */
+    res = gst_structure_get_int (s, "width", &width);
+    res |= gst_structure_get_int (s, "height", &height);
+    if (!res) {
+      g_warning ("could not get snapshot dimension\n");
+      goto done;
+    }
+
+    /* create pixmap from buffer and save, gstreamer video buffers have a stride
+     * that is rounded up to the nearest multiple of 4 */
+    pixbuf = gdk_pixbuf_new_from_data (GST_BUFFER_DATA (buffer),
+        GDK_COLORSPACE_RGB, FALSE, 8, width, height,
+        GST_ROUND_UP_4 (width * 3), NULL, NULL);
+
+    /* save the pixbuf */
+    gdk_pixbuf_save (pixbuf, "snapshot.png", "png", &error, NULL);
+
+  done:
+    gst_buffer_unref (buffer);
+  }
+}
+
+/* called when the Step button is pressed */
+static void
+step_cb (GtkButton * button, PlaybackApp * app)
+{
+  GstEvent *event;
+  GstFormat format;
+  guint64 amount;
+  gdouble rate;
+  gboolean flush, res;
+  gint active;
+
+  active = gtk_combo_box_get_active (GTK_COMBO_BOX (app->step_format_combo));
+  amount =
+      gtk_spin_button_get_value_as_int (GTK_SPIN_BUTTON
+      (app->step_amount_spinbutton));
+  rate =
+      gtk_spin_button_get_value (GTK_SPIN_BUTTON (app->step_rate_spinbutton));
+  flush = TRUE;
+
+  switch (active) {
+    case 0:
+      format = GST_FORMAT_BUFFERS;
+      break;
+    case 1:
+      format = GST_FORMAT_TIME;
+      amount *= GST_MSECOND;
+      break;
+    default:
+      format = GST_FORMAT_UNDEFINED;
+      break;
+  }
+
+  event = gst_event_new_step (format, amount, rate, flush, FALSE);
+
+  res = send_event (app, event);
+
+  if (!res) {
+    g_print ("Sending step event failed\n");
+  }
+}
+
+static void
+message_received (GstBus * bus, GstMessage * message, PlaybackApp * app)
+{
+  const GstStructure *s;
+
+  switch (GST_MESSAGE_TYPE (message)) {
+    case GST_MESSAGE_ERROR:
+      GST_DEBUG_BIN_TO_DOT_FILE_WITH_TS (GST_BIN (app->pipeline),
+          GST_DEBUG_GRAPH_SHOW_ALL, "seek.error");
+      break;
+    case GST_MESSAGE_WARNING:
+      GST_DEBUG_BIN_TO_DOT_FILE_WITH_TS (GST_BIN (app->pipeline),
+          GST_DEBUG_GRAPH_SHOW_ALL, "seek.warning");
+      break;
+    default:
+      break;
+  }
+
+  s = gst_message_get_structure (message);
+  g_print ("message from \"%s\" (%s): ",
+      GST_STR_NULL (GST_ELEMENT_NAME (GST_MESSAGE_SRC (message))),
+      gst_message_type_get_name (GST_MESSAGE_TYPE (message)));
+  if (s) {
+    gchar *sstr;
+
+    sstr = gst_structure_to_string (s);
+    g_print ("%s\n", sstr);
+    g_free (sstr);
+  } else {
+    g_print ("no message details\n");
+  }
+}
+
+static void
+do_shuttle (PlaybackApp * app)
+{
+  guint64 duration;
+
+  if (app->shuttling)
+    duration = 40 * GST_MSECOND;
+  else
+    duration = -1;
+
+  gst_element_send_event (app->pipeline,
+      gst_event_new_step (GST_FORMAT_TIME, duration, app->shuttle_rate, FALSE,
+          FALSE));
+}
+
+static void
+msg_sync_step_done (GstBus * bus, GstMessage * message, PlaybackApp * app)
+{
+  GstFormat format;
+  guint64 amount;
+  gdouble rate;
+  gboolean flush;
+  gboolean intermediate;
+  guint64 duration;
+  gboolean eos;
+
+  gst_message_parse_step_done (message, &format, &amount, &rate, &flush,
+      &intermediate, &duration, &eos);
+
+  if (eos) {
+    g_print ("stepped till EOS\n");
+    return;
+  }
+
+  if (g_static_mutex_trylock (&app->state_mutex)) {
+    if (app->shuttling)
+      do_shuttle (app);
+    g_static_mutex_unlock (&app->state_mutex);
+  } else {
+    /* ignore step messages that come while we are doing a state change */
+    g_print ("state change is busy\n");
+  }
+}
+
+static void
+shuttle_toggled (GtkToggleButton * button, PlaybackApp * app)
+{
+  gboolean active;
+
+  active = gtk_toggle_button_get_active (button);
+
+  if (active != app->shuttling) {
+    app->shuttling = active;
+    g_print ("shuttling %s\n", app->shuttling ? "active" : "inactive");
+    if (active) {
+      app->shuttle_rate = 0.0;
+      app->play_rate = 1.0;
+      pause_cb (NULL, app);
+      gst_element_get_state (app->pipeline, NULL, NULL, -1);
+    }
+  }
+}
+
+static void
+shuttle_rate_switch (PlaybackApp * app)
+{
+  GstSeekFlags flags;
+  GstEvent *s_event;
+  gboolean res;
+
+  if (app->state == GST_STATE_PLAYING) {
+    /* pause when we need to */
+    pause_cb (NULL, app);
+    gst_element_get_state (app->pipeline, NULL, NULL, -1);
+  }
+
+  if (app->play_rate == 1.0)
+    app->play_rate = -1.0;
+  else
+    app->play_rate = 1.0;
+
+  g_print ("rate changed to %lf %" GST_TIME_FORMAT "\n", app->play_rate,
+      GST_TIME_ARGS (app->position));
+
+  flags = GST_SEEK_FLAG_FLUSH;
+  flags |= GST_SEEK_FLAG_ACCURATE;
+
+  if (app->play_rate >= 0.0) {
+    s_event = gst_event_new_seek (app->play_rate,
+        GST_FORMAT_TIME, flags, GST_SEEK_TYPE_SET, app->position,
+        GST_SEEK_TYPE_SET, GST_CLOCK_TIME_NONE);
+  } else {
+    s_event = gst_event_new_seek (app->play_rate,
+        GST_FORMAT_TIME, flags, GST_SEEK_TYPE_SET, G_GINT64_CONSTANT (0),
+        GST_SEEK_TYPE_SET, app->position);
+  }
+  res = send_event (app, s_event);
+  if (res) {
+    gst_element_get_state (app->pipeline, NULL, NULL, SEEK_TIMEOUT);
+  } else {
+    g_print ("seek failed\n");
+  }
+}
+
+static void
+shuttle_value_changed (GtkRange * range, PlaybackApp * app)
+{
+  gdouble rate;
+
+  rate = gtk_range_get_value (range);
+
+  if (rate == 0.0) {
+    g_print ("rate 0.0, pause\n");
+    pause_cb (NULL, app);
+    gst_element_get_state (app->pipeline, NULL, NULL, -1);
+  } else {
+    g_print ("rate changed %0.3g\n", rate);
+
+    if ((rate < 0.0 && app->play_rate > 0.0) || (rate > 0.0
+            && app->play_rate < 0.0)) {
+      shuttle_rate_switch (app);
+    }
+
+    app->shuttle_rate = ABS (rate);
+    if (app->state != GST_STATE_PLAYING) {
+      do_shuttle (app);
+      play_cb (NULL, app);
+    }
+  }
+}
+
+static void
+colorbalance_value_changed (GtkRange * range, PlaybackApp * app)
+{
+  const gchar *label;
+  gdouble val;
+  gint ival;
+  GstColorBalanceChannel *channel = NULL;
+  const GList *channels, *l;
+
+  if (range == GTK_RANGE (app->contrast_scale))
+    label = "CONTRAST";
+  else if (range == GTK_RANGE (app->brightness_scale))
+    label = "BRIGHTNESS";
+  else if (range == GTK_RANGE (app->hue_scale))
+    label = "HUE";
+  else if (range == GTK_RANGE (app->saturation_scale))
+    label = "SATURATION";
+  else
+    g_assert_not_reached ();
+
+  val = gtk_range_get_value (range);
+
+  g_print ("colorbalance %s value changed %lf\n", label, val / N_GRAD);
+
+  if (!app->colorbalance_element) {
+    find_interface_elements (app);
+    if (!app->colorbalance_element)
+      return;
+  }
+
+  channels =
+      gst_color_balance_list_channels (GST_COLOR_BALANCE
+      (app->colorbalance_element));
+  for (l = channels; l; l = l->next) {
+    GstColorBalanceChannel *tmp = l->data;
+
+    if (g_strrstr (tmp->label, label)) {
+      channel = tmp;
+      break;
+    }
+  }
+
+  if (!channel)
+    return;
+
+  ival =
+      (gint) (0.5 + channel->min_value +
+      (val / N_GRAD) * ((gdouble) channel->max_value -
+          (gdouble) channel->min_value));
+  gst_color_balance_set_value (GST_COLOR_BALANCE (app->colorbalance_element),
+      channel, ival);
+}
+
+static void
+seek_format_changed_cb (GtkComboBox * box, PlaybackApp * app)
+{
+  gchar *format_str;
+  GList *l;
+  const GstFormatDefinition *format = NULL;
+
+  format_str = gtk_combo_box_text_get_active_text (GTK_COMBO_BOX_TEXT (box));
+
+  for (l = app->formats; l; l = l->next) {
+    const GstFormatDefinition *tmp = l->data;
+
+    if (g_strcmp0 (tmp->nick, format_str) == 0) {
+      format = tmp;
+      break;
+    }
+  }
+
+  if (!format)
+    goto done;
+
+  app->seek_format = format;
+  update_scale (app);
+
+done:
+  g_free (format_str);
+}
+
+static void
+update_formats (PlaybackApp * app)
+{
+  GstIterator *it;
+  gboolean done;
+  GList *l;
+  gpointer item;
+  gchar *selected;
+  gint selected_idx = 0, i;
+
+  selected =
+      gtk_combo_box_text_get_active_text (GTK_COMBO_BOX_TEXT
+      (app->seek_format_combo));
+  if (selected == NULL)
+    selected = g_strdup ("time");
+
+  it = gst_format_iterate_definitions ();
+  done = FALSE;
+
+  g_list_free (app->formats);
+  app->formats = NULL;
+
+  while (!done) {
+    switch (gst_iterator_next (it, &item)) {
+      case GST_ITERATOR_OK:
+        app->formats = g_list_prepend (app->formats, item);
+        break;
+      case GST_ITERATOR_RESYNC:
+        g_list_free (app->formats);
+        app->formats = NULL;
+        gst_iterator_resync (it);
+        break;
+      case GST_ITERATOR_ERROR:
+      case GST_ITERATOR_DONE:
+      default:
+        done = TRUE;
+        break;
+    }
+  }
+
+  app->formats = g_list_reverse (app->formats);
+  gst_iterator_free (it);
+
+  g_signal_handlers_block_by_func (app->seek_format_combo,
+      seek_format_changed_cb, app);
+  gtk_combo_box_text_remove_all (GTK_COMBO_BOX_TEXT (app->seek_format_combo));
+
+  for (i = 0, l = app->formats; l; l = l->next, i++) {
+    const GstFormatDefinition *def = l->data;
+
+    gtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT (app->seek_format_combo),
+        def->nick);
+    if (g_strcmp0 (def->nick, selected) == 0)
+      selected_idx = i;
+  }
+  g_signal_handlers_unblock_by_func (app->seek_format_combo,
+      seek_format_changed_cb, app);
+
+  gtk_combo_box_set_active (GTK_COMBO_BOX (app->seek_format_combo),
+      selected_idx);
+
+  g_free (selected);
+}
+
+static void
+msg_async_done (GstBus * bus, GstMessage * message, PlaybackApp * app)
+{
+  GST_DEBUG ("async done");
+
+  /* Now query all available GstFormats */
+  update_formats (app);
+
+  /* when we get ASYNC_DONE we can query position, duration and other
+   * properties */
+  update_scale (app);
+
+  /* update the available streams */
+  update_streams (app);
+
+  find_interface_elements (app);
+}
+
+static void
+msg_state_changed (GstBus * bus, GstMessage * message, PlaybackApp * app)
+{
+  const GstStructure *s;
+
+  s = gst_message_get_structure (message);
+
+  /* We only care about state changed on the pipeline */
+  if (s && GST_MESSAGE_SRC (message) == GST_OBJECT_CAST (app->pipeline)) {
+    GstState old, new, pending;
+
+    gst_message_parse_state_changed (message, &old, &new, &pending);
+
+    /* When state of the pipeline changes to paused or playing we start updating scale */
+    if (new == GST_STATE_PLAYING) {
+      set_update_scale (app, TRUE);
+    } else {
+      set_update_scale (app, FALSE);
+    }
+
+    /* dump graph for (some) pipeline state changes */
+    {
+      gchar *dump_name;
+
+      dump_name = g_strdup_printf ("seek.%s_%s",
+          gst_element_state_get_name (old), gst_element_state_get_name (new));
+
+      GST_DEBUG_BIN_TO_DOT_FILE_WITH_TS (GST_BIN (app->pipeline),
+          GST_DEBUG_GRAPH_SHOW_ALL, dump_name);
+
+      g_free (dump_name);
+    }
+  }
+}
+
+static void
+msg_segment_done (GstBus * bus, GstMessage * message, PlaybackApp * app)
+{
+  GstEvent *s_event;
+  GstSeekFlags flags;
+  gboolean res;
+  GstFormat format;
+
+  GST_DEBUG ("position is %" GST_TIME_FORMAT, GST_TIME_ARGS (app->position));
+  gst_message_parse_segment_done (message, &format, &app->position);
+  GST_DEBUG ("end of segment at %" GST_TIME_FORMAT,
+      GST_TIME_ARGS (app->position));
+
+  flags = 0;
+  /* in the segment-done callback we never flush as this would not make sense
+   * for seamless playback. */
+  if (app->loop_seek)
+    flags |= GST_SEEK_FLAG_SEGMENT;
+  if (app->skip_seek)
+    flags |= GST_SEEK_FLAG_SKIP;
+
+  s_event = gst_event_new_seek (app->rate,
+      GST_FORMAT_TIME, flags, GST_SEEK_TYPE_SET, G_GINT64_CONSTANT (0),
+      GST_SEEK_TYPE_SET, app->duration);
+
+  GST_DEBUG ("restart loop with rate %lf to 0 / %" GST_TIME_FORMAT,
+      app->rate, GST_TIME_ARGS (app->duration));
+
+  res = send_event (app, s_event);
+  if (!res)
+    g_print ("segment seek failed\n");
+}
+
+/* in stream buffering mode we PAUSE the pipeline until we receive a 100%
+ * message */
+static void
+do_stream_buffering (PlaybackApp * app, gint percent)
+{
+  gchar *bufstr;
+
+  gtk_statusbar_pop (GTK_STATUSBAR (app->statusbar), app->status_id);
+  bufstr = g_strdup_printf ("Buffering...%d", percent);
+  gtk_statusbar_push (GTK_STATUSBAR (app->statusbar), app->status_id, bufstr);
+  g_free (bufstr);
+
+  if (percent == 100) {
+    /* a 100% message means buffering is done */
+    app->buffering = FALSE;
+    /* if the desired state is playing, go back */
+    if (app->state == GST_STATE_PLAYING) {
+      /* no state management needed for live pipelines */
+      if (!app->is_live) {
+        fprintf (stderr, "Done buffering, setting pipeline to PLAYING ...\n");
+        gst_element_set_state (app->pipeline, GST_STATE_PLAYING);
+      }
+      gtk_statusbar_pop (GTK_STATUSBAR (app->statusbar), app->status_id);
+      gtk_statusbar_push (GTK_STATUSBAR (app->statusbar), app->status_id,
+          "Playing");
+    }
+  } else {
+    /* buffering busy */
+    if (app->buffering == FALSE && app->state == GST_STATE_PLAYING) {
+      /* we were not buffering but PLAYING, PAUSE  the pipeline. */
+      if (!app->is_live) {
+        fprintf (stderr, "Buffering, setting pipeline to PAUSED ...\n");
+        gst_element_set_state (app->pipeline, GST_STATE_PAUSED);
+      }
+    }
+    app->buffering = TRUE;
+  }
+}
+
+static void
+do_download_buffering (PlaybackApp * app, gint percent)
+{
+  if (!app->buffering && percent < 100) {
+    gchar *bufstr;
+
+    app->buffering = TRUE;
+
+    bufstr = g_strdup_printf ("Downloading...");
+    gtk_statusbar_push (GTK_STATUSBAR (app->statusbar), app->status_id, bufstr);
+    g_free (bufstr);
+
+    /* once we get a buffering message, we'll do the fill update */
+    set_update_fill (app, TRUE);
+
+    if (app->state == GST_STATE_PLAYING && !app->is_live) {
+      fprintf (stderr, "Downloading, setting pipeline to PAUSED ...\n");
+      gst_element_set_state (app->pipeline, GST_STATE_PAUSED);
+      /* user has to manually start the playback */
+      app->state = GST_STATE_PAUSED;
+    }
+  }
+}
+
+static void
+msg_buffering (GstBus * bus, GstMessage * message, PlaybackApp * app)
+{
+  gint percent;
+
+  gst_message_parse_buffering (message, &percent);
+
+  /* get more stats */
+  gst_message_parse_buffering_stats (message, &app->mode, NULL, NULL,
+      &app->buffering_left);
+
+  switch (app->mode) {
+    case GST_BUFFERING_DOWNLOAD:
+      do_download_buffering (app, percent);
+      break;
+    case GST_BUFFERING_LIVE:
+      app->is_live = TRUE;
+    case GST_BUFFERING_TIMESHIFT:
+    case GST_BUFFERING_STREAM:
+      do_stream_buffering (app, percent);
+      break;
+  }
+}
+
+static void
+msg_clock_lost (GstBus * bus, GstMessage * message, PlaybackApp * app)
+{
+  g_print ("clock lost! PAUSE and PLAY to select a new clock\n");
+  if (app->state == GST_STATE_PLAYING) {
+    gst_element_set_state (app->pipeline, GST_STATE_PAUSED);
+    gst_element_set_state (app->pipeline, GST_STATE_PLAYING);
+  }
+}
+
+static gboolean
+is_valid_color_balance_element (GstElement * element)
+{
+  GstColorBalance *bal = GST_COLOR_BALANCE (element);
+  gboolean have_brightness = FALSE;
+  gboolean have_contrast = FALSE;
+  gboolean have_hue = FALSE;
+  gboolean have_saturation = FALSE;
+  const GList *channels, *l;
+
+  channels = gst_color_balance_list_channels (bal);
+  for (l = channels; l; l = l->next) {
+    GstColorBalanceChannel *ch = l->data;
+
+    if (g_strrstr (ch->label, "BRIGHTNESS"))
+      have_brightness = TRUE;
+    else if (g_strrstr (ch->label, "CONTRAST"))
+      have_contrast = TRUE;
+    else if (g_strrstr (ch->label, "HUE"))
+      have_hue = TRUE;
+    else if (g_strrstr (ch->label, "SATURATION"))
+      have_saturation = TRUE;
+  }
+
+  return have_brightness && have_contrast && have_hue && have_saturation;
+}
+
+static void
+find_interface_elements (PlaybackApp * app)
+{
+  GstIterator *it;
+  gpointer item;
+  gboolean done = FALSE, hardware = FALSE;
+
+  if (app->pipeline_type == 0)
+    return;
+
+  if (app->navigation_element)
+    gst_object_unref (app->navigation_element);
+  app->navigation_element = NULL;
+
+  if (app->colorbalance_element)
+    gst_object_unref (app->colorbalance_element);
+  app->colorbalance_element = NULL;
+
+  app->navigation_element =
+      gst_bin_get_by_interface (GST_BIN (app->pipeline), GST_TYPE_NAVIGATION);
+
+  it = gst_bin_iterate_all_by_interface (GST_BIN (app->pipeline),
+      GST_TYPE_COLOR_BALANCE);
+  while (!done) {
+    switch (gst_iterator_next (it, &item)) {
+      case GST_ITERATOR_OK:{
+        GstElement *element = GST_ELEMENT (item);
+
+        if (is_valid_color_balance_element (element)) {
+          if (!app->colorbalance_element) {
+            app->colorbalance_element =
+                GST_ELEMENT_CAST (gst_object_ref (element));
+            hardware =
+                (gst_color_balance_get_balance_type (GST_COLOR_BALANCE
+                    (element)) == GST_COLOR_BALANCE_HARDWARE);
+          } else if (!hardware) {
+            gboolean tmp =
+                (gst_color_balance_get_balance_type (GST_COLOR_BALANCE
+                    (element)) == GST_COLOR_BALANCE_HARDWARE);
+
+            if (tmp) {
+              if (app->colorbalance_element)
+                gst_object_unref (app->colorbalance_element);
+              app->colorbalance_element =
+                  GST_ELEMENT_CAST (gst_object_ref (element));
+              hardware = TRUE;
+            }
+          }
+        }
+
+        gst_object_unref (element);
+
+        if (hardware && app->colorbalance_element)
+          done = TRUE;
+        break;
+      }
+      case GST_ITERATOR_RESYNC:
+        gst_iterator_resync (it);
+        done = FALSE;
+        hardware = FALSE;
+        if (app->colorbalance_element)
+          gst_object_unref (app->colorbalance_element);
+        app->colorbalance_element = NULL;
+        break;
+      case GST_ITERATOR_DONE:
+      case GST_ITERATOR_ERROR:
+      default:
+        done = TRUE;
+    }
+  }
+
+  gst_iterator_free (it);
+}
+
+/* called when Navigation command button is pressed */
+static void
+navigation_cmd_cb (GtkButton * button, PlaybackApp * app)
+{
+  GstNavigationCommand cmd = GST_NAVIGATION_COMMAND_INVALID;
+  gint i;
+
+  if (!app->navigation_element) {
+    find_interface_elements (app);
+    if (!app->navigation_element)
+      return;
+  }
+
+  for (i = 0; i < G_N_ELEMENTS (app->navigation_buttons); i++) {
+    if (app->navigation_buttons[i].button == GTK_WIDGET (button)) {
+      cmd = app->navigation_buttons[i].cmd;
+      break;
+    }
+  }
+
+  if (cmd != GST_NAVIGATION_COMMAND_INVALID)
+    gst_navigation_send_command (GST_NAVIGATION (app->navigation_element), cmd);
+}
+
+#if defined (GDK_WINDOWING_X11) || defined (GDK_WINDOWING_WIN32) || defined (GDK_WINDOWING_QUARTZ)
+/* We set the xid here in response to the prepare-xwindow-id message via a
+ * bus sync handler because we don't know the actual videosink used from the
+ * start (as we don't know the pipeline, or bin elements such as autovideosink
+ * or gconfvideosink may be used which create the actual videosink only once
+ * the pipeline is started) */
+static GstBusSyncReply
+bus_sync_handler (GstBus * bus, GstMessage * message, PlaybackApp * app)
+{
+  if ((GST_MESSAGE_TYPE (message) == GST_MESSAGE_ELEMENT) &&
+      gst_structure_has_name (message->structure, "prepare-xwindow-id")) {
+    GstElement *element = GST_ELEMENT (GST_MESSAGE_SRC (message));
+
+    if (app->xoverlay_element)
+      gst_object_unref (app->xoverlay_element);
+    app->xoverlay_element = GST_ELEMENT (gst_object_ref (element));
+
+    g_print ("got prepare-xwindow-id, setting XID %" G_GUINTPTR_FORMAT "\n",
+        app->embed_xid);
+
+    if (g_object_class_find_property (G_OBJECT_GET_CLASS (element),
+            "force-aspect-ratio")) {
+      g_object_set (element, "force-aspect-ratio", TRUE, NULL);
+    }
+
+    /* Should have been initialised from main thread before (can't use
+     * GDK_WINDOW_XID here with Gtk+ >= 2.18, because the sync handler will
+     * be called from a streaming thread and GDK_WINDOW_XID maps to more than
+     * a simple structure lookup with Gtk+ >= 2.18, where 'more' is stuff that
+     * shouldn't be done from a non-GUI thread without explicit locking).  */
+    g_assert (app->embed_xid != 0);
+
+    gst_x_overlay_set_window_handle (GST_X_OVERLAY (element), app->embed_xid);
+
+    find_interface_elements (app);
+  }
+  return GST_BUS_PASS;
+}
+#endif
+
+static gboolean
+draw_cb (GtkWidget * widget, cairo_t * cr, PlaybackApp * app)
+{
+  if (app->state < GST_STATE_PAUSED) {
+    int width, height;
+
+    width = gtk_widget_get_allocated_width (widget);
+    height = gtk_widget_get_allocated_height (widget);
+    cairo_set_source_rgb (cr, 0, 0, 0);
+    cairo_rectangle (cr, 0, 0, width, height);
+    cairo_fill (cr);
+    return TRUE;
+  }
+
+  if (app->xoverlay_element)
+    gst_x_overlay_expose (GST_X_OVERLAY (app->xoverlay_element));
+
+  return FALSE;
+}
+
+static void
+realize_cb (GtkWidget * widget, PlaybackApp * app)
+{
+  GdkWindow *window = gtk_widget_get_window (widget);
+
+  /* This is here just for pedagogical purposes, GDK_WINDOW_XID will call it
+   * as well */
+  if (!gdk_window_ensure_native (window))
+    g_error ("Couldn't create native window needed for GstXOverlay!");
+
+#if defined (GDK_WINDOWING_WIN32)
+  app->embed_xid = GDK_WINDOW_HWND (window);
+  g_print ("Window realize: video window HWND = %lu\n", app->embed_xid);
+#elif defined (GDK_WINDOWING_QUARTZ)
+  app->embed_xid = gdk_quartz_window_get_nsview (window);
+  g_print ("Window realize: video window NSView = %p\n", app->embed_xid);
+#elif defined (GDK_WINDOWING_X11)
+  app->embed_xid = GDK_WINDOW_XID (window);
+  g_print ("Window realize: video window XID = %" G_GUINTPTR_FORMAT "\n",
+      app->embed_xid);
+#endif
+}
+
+static gboolean
+button_press_cb (GtkWidget * widget, GdkEventButton * event, PlaybackApp * app)
+{
+  gtk_widget_grab_focus (widget);
+
+  if (app->navigation_element)
+    gst_navigation_send_mouse_event (GST_NAVIGATION (app->navigation_element),
+        "mouse-button-press", event->button, event->x, event->y);
+
+  return FALSE;
+}
+
+static gboolean
+button_release_cb (GtkWidget * widget, GdkEventButton * event,
+    PlaybackApp * app)
+{
+  if (app->navigation_element)
+    gst_navigation_send_mouse_event (GST_NAVIGATION (app->navigation_element),
+        "mouse-button-release", event->button, event->x, event->y);
+
+  return FALSE;
+}
+
+static gboolean
+key_press_cb (GtkWidget * widget, GdkEventKey * event, PlaybackApp * app)
+{
+  if (app->navigation_element)
+    gst_navigation_send_key_event (GST_NAVIGATION (app->navigation_element),
+        "key-press", gdk_keyval_name (event->keyval));
+
+  return FALSE;
+}
+
+static gboolean
+key_release_cb (GtkWidget * widget, GdkEventKey * event, PlaybackApp * app)
+{
+  if (app->navigation_element)
+    gst_navigation_send_key_event (GST_NAVIGATION (app->navigation_element),
+        "key-release", gdk_keyval_name (event->keyval));
+
+  return FALSE;
+}
+
+static gboolean
+motion_notify_cb (GtkWidget * widget, GdkEventMotion * event, PlaybackApp * app)
+{
+  if (app->navigation_element)
+    gst_navigation_send_mouse_event (GST_NAVIGATION (app->navigation_element),
+        "mouse-move", 0, event->x, event->y);
+
+  return FALSE;
+}
+
+static void
+msg_eos (GstBus * bus, GstMessage * message, PlaybackApp * app)
+{
+  message_received (bus, message, app);
+
+  /* Set new uri for playerbins and continue playback */
+  if (app->current_path && app->pipeline_type == 0) {
+    stop_cb (NULL, app);
+    app->current_path = g_list_next (app->current_path);
+    app->current_sub_path = g_list_next (app->current_sub_path);
+    if (app->current_path) {
+      playbin_set_uri (app->pipeline, app->current_path->data,
+          app->current_sub_path ? app->current_sub_path->data : NULL);
+      play_cb (NULL, app);
+    }
+  }
+}
+
+static void
+msg_step_done (GstBus * bus, GstMessage * message, PlaybackApp * app)
+{
+  if (!app->shuttling)
+    message_received (bus, message, app);
+}
+
+static void
+msg (GstBus * bus, GstMessage * message, PlaybackApp * app)
+{
+  GstNavigationMessageType nav_type;
+
+  nav_type = gst_navigation_message_get_type (message);
+  switch (nav_type) {
+    case GST_NAVIGATION_MESSAGE_COMMANDS_CHANGED:{
+      GstQuery *query;
+      gboolean res, j;
+
+      /* Heuristic to detect if we're dealing with a DVD menu */
+      query = gst_navigation_query_new_commands ();
+      res = gst_element_query (GST_ELEMENT (GST_MESSAGE_SRC (message)), query);
+
+      for (j = 0; j < G_N_ELEMENTS (app->navigation_buttons); j++)
+        gtk_widget_set_sensitive (app->navigation_buttons[j].button, FALSE);
+
+      if (res) {
+        gboolean is_menu = FALSE;
+        guint i, n;
+
+        if (gst_navigation_query_parse_commands_length (query, &n)) {
+          for (i = 0; i < n; i++) {
+            GstNavigationCommand cmd;
+
+            if (!gst_navigation_query_parse_commands_nth (query, i, &cmd))
+              break;
+
+            is_menu |= (cmd == GST_NAVIGATION_COMMAND_ACTIVATE);
+            is_menu |= (cmd == GST_NAVIGATION_COMMAND_LEFT);
+            is_menu |= (cmd == GST_NAVIGATION_COMMAND_RIGHT);
+            is_menu |= (cmd == GST_NAVIGATION_COMMAND_UP);
+            is_menu |= (cmd == GST_NAVIGATION_COMMAND_DOWN);
+
+            for (j = 0; j < G_N_ELEMENTS (app->navigation_buttons); j++) {
+              if (app->navigation_buttons[j].cmd != cmd)
+                continue;
+
+              gtk_widget_set_sensitive (app->navigation_buttons[j].button,
+                  TRUE);
+            }
+          }
+        }
+
+        gtk_widget_set_sensitive (GTK_WIDGET (app->seek_scale), !is_menu);
+      } else {
+        g_assert_not_reached ();
+      }
+
+      gst_query_unref (query);
+      message_received (bus, message, app);
+      break;
+    }
+    default:
+      break;
+  }
+}
+
+static void
+connect_bus_signals (PlaybackApp * app)
+{
+  GstBus *bus = gst_pipeline_get_bus (GST_PIPELINE (app->pipeline));
+
+#if defined (GDK_WINDOWING_X11) || defined (GDK_WINDOWING_WIN32) || defined (GDK_WINDOWING_QUARTZ)
+  if (app->pipeline_type != 0) {
+    /* handle prepare-xwindow-id element message synchronously, but only for non-playbin2 */
+    gst_bus_set_sync_handler (bus, (GstBusSyncHandler) bus_sync_handler, app);
+  }
+#endif
+
+  gst_bus_add_signal_watch_full (bus, G_PRIORITY_HIGH);
+  gst_bus_enable_sync_message_emission (bus);
+
+  g_signal_connect (bus, "message::state-changed",
+      G_CALLBACK (msg_state_changed), app);
+  g_signal_connect (bus, "message::segment-done", G_CALLBACK (msg_segment_done),
+      app);
+  g_signal_connect (bus, "message::async-done", G_CALLBACK (msg_async_done),
+      app);
+
+  g_signal_connect (bus, "message::new-clock", G_CALLBACK (message_received),
+      app);
+  g_signal_connect (bus, "message::clock-lost", G_CALLBACK (msg_clock_lost),
+      app);
+  g_signal_connect (bus, "message::error", G_CALLBACK (message_received), app);
+  g_signal_connect (bus, "message::warning", G_CALLBACK (message_received),
+      app);
+  g_signal_connect (bus, "message::eos", G_CALLBACK (msg_eos), app);
+  g_signal_connect (bus, "message::tag", G_CALLBACK (message_received), app);
+  g_signal_connect (bus, "message::element", G_CALLBACK (message_received),
+      app);
+  g_signal_connect (bus, "message::segment-done", G_CALLBACK (message_received),
+      app);
+  g_signal_connect (bus, "message::buffering", G_CALLBACK (msg_buffering), app);
+//  g_signal_connect (bus, "message::step-done", G_CALLBACK (msg_step_done),
+//      app);
+  g_signal_connect (bus, "message::step-start", G_CALLBACK (msg_step_done),
+      app);
+  g_signal_connect (bus, "sync-message::step-done",
+      G_CALLBACK (msg_sync_step_done), app);
+  g_signal_connect (bus, "message", G_CALLBACK (msg), app);
+
+  gst_object_unref (bus);
+}
+
+/* Return GList of paths described in location string */
+static GList *
+handle_wildcards (const gchar * location)
+{
+  GList *res = NULL;
+  gchar *path = g_path_get_dirname (location);
+  gchar *pattern = g_path_get_basename (location);
+  GPatternSpec *pspec = g_pattern_spec_new (pattern);
+  GDir *dir = g_dir_open (path, 0, NULL);
+  const gchar *name;
+
+  g_print ("matching %s from %s\n", pattern, path);
+
+  if (!dir) {
+    g_print ("opening directory %s failed\n", path);
+    goto out;
+  }
+
+  while ((name = g_dir_read_name (dir)) != NULL) {
+    if (g_pattern_match_string (pspec, name)) {
+      res = g_list_append (res, g_strjoin ("/", path, name, NULL));
+      g_print ("  found clip %s\n", name);
+    }
+  }
+
+  g_dir_close (dir);
+out:
+  g_pattern_spec_free (pspec);
+  g_free (pattern);
+  g_free (path);
+
+  return res;
+}
+
+static void
+delete_event_cb (GtkWidget * widget, GdkEvent * event, PlaybackApp * app)
+{
+  stop_cb (NULL, app);
+  gtk_main_quit ();
+}
+
+static void
+video_sink_activate_cb (GtkEntry * entry, PlaybackApp * app)
+{
+  GstElement *sink = NULL;
+  const gchar *text;
+
+  text = gtk_entry_get_text (entry);
+  if (text != NULL && *text != '\0') {
+    sink = gst_element_factory_make_or_warn (text, NULL);
+  }
+
+  g_object_set (app->pipeline, "video-sink", sink, NULL);
+}
+
+static void
+audio_sink_activate_cb (GtkEntry * entry, PlaybackApp * app)
+{
+  GstElement *sink = NULL;
+  const gchar *text;
+
+  text = gtk_entry_get_text (entry);
+  if (text != NULL && *text != '\0') {
+    sink = gst_element_factory_make_or_warn (text, NULL);
+  }
+
+  g_object_set (app->pipeline, "audio-sink", sink, NULL);
+}
+
+static void
+text_sink_activate_cb (GtkEntry * entry, PlaybackApp * app)
+{
+  GstElement *sink = NULL;
+  const gchar *text;
+
+  text = gtk_entry_get_text (entry);
+  if (text != NULL && *text != '\0') {
+    sink = gst_element_factory_make_or_warn (text, NULL);
+  }
+
+  g_object_set (app->pipeline, "text-sink", sink, NULL);
+}
+
+static void
+buffer_size_activate_cb (GtkEntry * entry, PlaybackApp * app)
+{
+  const gchar *text;
+
+  text = gtk_entry_get_text (entry);
+  if (text != NULL && *text != '\0') {
+    gint v;
+    gchar *endptr;
+
+    v = g_ascii_strtoll (text, &endptr, 10);
+    if (endptr != text && v != G_MAXINT64 && v != G_MININT64) {
+      g_object_set (app->pipeline, "buffer-size", v, NULL);
+    }
+  }
+}
+
+static void
+buffer_duration_activate_cb (GtkEntry * entry, PlaybackApp * app)
+{
+  const gchar *text;
+
+  text = gtk_entry_get_text (entry);
+  if (text != NULL && *text != '\0') {
+    gint64 v;
+    gchar *endptr;
+
+    v = g_ascii_strtoll (text, &endptr, 10);
+    if (endptr != text && v != G_MAXINT64 && v != G_MININT64) {
+      g_object_set (app->pipeline, "buffer-duration", v, NULL);
+    }
+  }
+}
+
+static void
+ringbuffer_maxsize_activate_cb (GtkEntry * entry, PlaybackApp * app)
+{
+  const gchar *text;
+
+  text = gtk_entry_get_text (entry);
+  if (text != NULL && *text != '\0') {
+    guint64 v;
+    gchar *endptr;
+
+    v = g_ascii_strtoull (text, &endptr, 10);
+    if (endptr != text && v != G_MAXUINT64) {
+      g_object_set (app->pipeline, "ring-buffer-max-size", v, NULL);
+    }
+  }
+}
+
+static void
+connection_speed_activate_cb (GtkEntry * entry, PlaybackApp * app)
+{
+  const gchar *text;
+
+  text = gtk_entry_get_text (entry);
+  if (text != NULL && *text != '\0') {
+    guint v;
+    gchar *endptr;
+
+    v = g_ascii_strtoll (text, &endptr, 10);
+    if (endptr != text && v != G_MAXINT64 && v != G_MININT64) {
+      g_object_set (app->pipeline, "connection-speed", v, NULL);
+    }
+  }
+}
+
+static void
+subtitle_encoding_activate_cb (GtkEntry * entry, PlaybackApp * app)
+{
+  const gchar *text;
+
+  text = gtk_entry_get_text (entry);
+  g_object_set (app->pipeline, "subtitle-encoding", text, NULL);
+}
+
+static void
+subtitle_fontdesc_cb (GtkFontButton * button, PlaybackApp * app)
+{
+  const gchar *text;
+
+  text = gtk_font_button_get_font_name (button);
+  g_object_set (app->pipeline, "subtitle-font-desc", text, NULL);
+}
+
+static void
+av_offset_activate_cb (GtkEntry * entry, PlaybackApp * app)
+{
+  const gchar *text;
+
+  text = gtk_entry_get_text (entry);
+  if (text != NULL && *text != '\0') {
+    gint64 v;
+    gchar *endptr;
+
+    v = g_ascii_strtoll (text, &endptr, 10);
+    if (endptr != text && v != G_MAXINT64 && v != G_MININT64) {
+      g_object_set (app->pipeline, "av-offset", v, NULL);
+    }
+  }
+}
+
+static void
+print_usage (int argc, char **argv)
+{
+  gint i;
+
+  g_print ("usage: %s <type> <filename>\n", argv[0]);
+  g_print ("   possible types:\n");
+
+  for (i = 0; i < G_N_ELEMENTS (pipelines); i++) {
+    g_print ("     %d = %s\n", i, pipelines[i].name);
+  }
+}
+
+static void
+create_ui (PlaybackApp * app)
+{
+  GtkWidget *hbox, *vbox, *seek, *playbin, *step, *navigation, *colorbalance;
+  GtkWidget *play_button, *pause_button, *stop_button;
+  GtkAdjustment *adjustment;
+
+  /* initialize gui elements ... */
+  app->window = gtk_window_new (GTK_WINDOW_TOPLEVEL);
+  app->video_window = gtk_drawing_area_new ();
+  g_signal_connect (app->video_window, "draw", G_CALLBACK (draw_cb), app);
+  g_signal_connect (app->video_window, "realize", G_CALLBACK (realize_cb), app);
+  g_signal_connect (app->video_window, "button-press-event",
+      G_CALLBACK (button_press_cb), app);
+  g_signal_connect (app->video_window, "button-release-event",
+      G_CALLBACK (button_release_cb), app);
+  g_signal_connect (app->video_window, "key-press-event",
+      G_CALLBACK (key_press_cb), app);
+  g_signal_connect (app->video_window, "key-release-event",
+      G_CALLBACK (key_release_cb), app);
+  g_signal_connect (app->video_window, "motion-notify-event",
+      G_CALLBACK (motion_notify_cb), app);
+  gtk_widget_set_can_focus (app->video_window, TRUE);
+  gtk_widget_set_double_buffered (app->video_window, FALSE);
+  gtk_widget_add_events (app->video_window,
+      GDK_POINTER_MOTION_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK
+      | GDK_KEY_PRESS_MASK | GDK_KEY_RELEASE_MASK);
+
+  app->statusbar = gtk_statusbar_new ();
+  app->status_id =
+      gtk_statusbar_get_context_id (GTK_STATUSBAR (app->statusbar),
+      "playback-test");
+  gtk_statusbar_push (GTK_STATUSBAR (app->statusbar), app->status_id,
+      "Stopped");
+  hbox = gtk_hbox_new (FALSE, 0);
+  vbox = gtk_vbox_new (FALSE, 0);
+  gtk_container_set_border_width (GTK_CONTAINER (vbox), 3);
+
+  /* media controls */
+  play_button = gtk_button_new_from_stock (GTK_STOCK_MEDIA_PLAY);
+  pause_button = gtk_button_new_from_stock (GTK_STOCK_MEDIA_PAUSE);
+  stop_button = gtk_button_new_from_stock (GTK_STOCK_MEDIA_STOP);
+
+  /* seek expander */
+  {
+    GtkWidget *accurate_checkbox, *key_checkbox, *loop_checkbox,
+        *flush_checkbox, *snap_before_checkbox, *snap_after_checkbox;
+    GtkWidget *scrub_checkbox, *play_scrub_checkbox, *rate_label;
+    GtkWidget *skip_checkbox, *rate_spinbutton;
+    GtkWidget *flagtable, *advanced_seek, *advanced_seek_grid;
+    GtkWidget *duration_label, *position_label, *seek_button;
+
+    seek = gtk_expander_new ("seek options");
+    flagtable = gtk_grid_new ();
+    gtk_grid_set_row_spacing (GTK_GRID (flagtable), 2);
+    gtk_grid_set_row_homogeneous (GTK_GRID (flagtable), FALSE);
+    gtk_grid_set_column_spacing (GTK_GRID (flagtable), 2);
+    gtk_grid_set_column_homogeneous (GTK_GRID (flagtable), FALSE);
+
+    accurate_checkbox = gtk_check_button_new_with_label ("Accurate Playback");
+    key_checkbox = gtk_check_button_new_with_label ("Key-unit Playback");
+    loop_checkbox = gtk_check_button_new_with_label ("Loop");
+    flush_checkbox = gtk_check_button_new_with_label ("Flush");
+    scrub_checkbox = gtk_check_button_new_with_label ("Scrub");
+    play_scrub_checkbox = gtk_check_button_new_with_label ("Play Scrub");
+    skip_checkbox = gtk_check_button_new_with_label ("Play Skip");
+    snap_before_checkbox = gtk_check_button_new_with_label ("Snap before");
+    snap_after_checkbox = gtk_check_button_new_with_label ("Snap after");
+    rate_spinbutton = gtk_spin_button_new_with_range (-100, 100, 0.1);
+    gtk_spin_button_set_digits (GTK_SPIN_BUTTON (rate_spinbutton), 3);
+    rate_label = gtk_label_new ("Rate");
+
+    gtk_widget_set_tooltip_text (accurate_checkbox,
+        "accurate position is requested, this might be considerably slower for some formats");
+    gtk_widget_set_tooltip_text (key_checkbox,
+        "seek to the nearest keyframe. This might be faster but less accurate");
+    gtk_widget_set_tooltip_text (loop_checkbox, "loop playback");
+    gtk_widget_set_tooltip_text (flush_checkbox,
+        "flush pipeline after seeking");
+    gtk_widget_set_tooltip_text (rate_spinbutton,
+        "define the playback rate, " "negative value trigger reverse playback");
+    gtk_widget_set_tooltip_text (scrub_checkbox, "show images while seeking");
+    gtk_widget_set_tooltip_text (play_scrub_checkbox,
+        "play video while seeking");
+    gtk_widget_set_tooltip_text (skip_checkbox,
+        "Skip frames while playing at high frame rates");
+    gtk_widget_set_tooltip_text (snap_before_checkbox,
+        "Favor snapping to the frame before the seek target");
+    gtk_widget_set_tooltip_text (snap_after_checkbox,
+        "Favor snapping to the frame after the seek target");
+
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (flush_checkbox), TRUE);
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (scrub_checkbox), TRUE);
+
+    gtk_spin_button_set_value (GTK_SPIN_BUTTON (rate_spinbutton), app->rate);
+
+    g_signal_connect (G_OBJECT (accurate_checkbox), "toggled",
+        G_CALLBACK (accurate_toggle_cb), app);
+    g_signal_connect (G_OBJECT (key_checkbox), "toggled",
+        G_CALLBACK (key_toggle_cb), app);
+    g_signal_connect (G_OBJECT (loop_checkbox), "toggled",
+        G_CALLBACK (loop_toggle_cb), app);
+    g_signal_connect (G_OBJECT (flush_checkbox), "toggled",
+        G_CALLBACK (flush_toggle_cb), app);
+    g_signal_connect (G_OBJECT (scrub_checkbox), "toggled",
+        G_CALLBACK (scrub_toggle_cb), app);
+    g_signal_connect (G_OBJECT (play_scrub_checkbox), "toggled",
+        G_CALLBACK (play_scrub_toggle_cb), app);
+    g_signal_connect (G_OBJECT (skip_checkbox), "toggled",
+        G_CALLBACK (skip_toggle_cb), app);
+    g_signal_connect (G_OBJECT (rate_spinbutton), "value-changed",
+        G_CALLBACK (rate_spinbutton_changed_cb), app);
+    g_signal_connect (G_OBJECT (snap_before_checkbox), "toggled",
+        G_CALLBACK (snap_before_toggle_cb), app);
+    g_signal_connect (G_OBJECT (snap_after_checkbox), "toggled",
+        G_CALLBACK (snap_after_toggle_cb), app);
+
+    gtk_grid_attach (GTK_GRID (flagtable), accurate_checkbox, 0, 0, 1, 1);
+    gtk_grid_attach (GTK_GRID (flagtable), flush_checkbox, 1, 0, 1, 1);
+    gtk_grid_attach (GTK_GRID (flagtable), loop_checkbox, 2, 0, 1, 1);
+    gtk_grid_attach (GTK_GRID (flagtable), key_checkbox, 0, 1, 1, 1);
+    gtk_grid_attach (GTK_GRID (flagtable), scrub_checkbox, 1, 1, 1, 1);
+    gtk_grid_attach (GTK_GRID (flagtable), play_scrub_checkbox, 2, 1, 1, 1);
+    gtk_grid_attach (GTK_GRID (flagtable), skip_checkbox, 3, 0, 1, 1);
+    gtk_grid_attach (GTK_GRID (flagtable), rate_label, 4, 0, 1, 1);
+    gtk_grid_attach (GTK_GRID (flagtable), rate_spinbutton, 4, 1, 1, 1);
+    gtk_grid_attach (GTK_GRID (flagtable), snap_before_checkbox, 0, 2, 1, 1);
+    gtk_grid_attach (GTK_GRID (flagtable), snap_after_checkbox, 1, 2, 1, 1);
+
+    advanced_seek = gtk_frame_new ("Advanced Seeking");
+    advanced_seek_grid = gtk_grid_new ();
+    gtk_grid_set_row_spacing (GTK_GRID (advanced_seek_grid), 2);
+    gtk_grid_set_row_homogeneous (GTK_GRID (advanced_seek_grid), FALSE);
+    gtk_grid_set_column_spacing (GTK_GRID (advanced_seek_grid), 5);
+    gtk_grid_set_column_homogeneous (GTK_GRID (advanced_seek_grid), FALSE);
+
+    app->seek_format_combo = gtk_combo_box_text_new ();
+    g_signal_connect (app->seek_format_combo, "changed",
+        G_CALLBACK (seek_format_changed_cb), app);
+    gtk_grid_attach (GTK_GRID (advanced_seek_grid), app->seek_format_combo, 0,
+        0, 1, 1);
+
+    app->seek_entry = gtk_entry_new ();
+    gtk_entry_set_width_chars (GTK_ENTRY (app->seek_entry), 12);
+    gtk_grid_attach (GTK_GRID (advanced_seek_grid), app->seek_entry, 0, 1, 1,
+        1);
+
+    seek_button = gtk_button_new_with_label ("Seek");
+    g_signal_connect (G_OBJECT (seek_button), "clicked",
+        G_CALLBACK (advanced_seek_button_cb), app);
+    gtk_grid_attach (GTK_GRID (advanced_seek_grid), seek_button, 1, 0, 1, 1);
+
+    position_label = gtk_label_new ("Position:");
+    gtk_grid_attach (GTK_GRID (advanced_seek_grid), position_label, 2, 0, 1, 1);
+    duration_label = gtk_label_new ("Duration:");
+    gtk_grid_attach (GTK_GRID (advanced_seek_grid), duration_label, 2, 1, 1, 1);
+
+    app->seek_position_label = gtk_label_new ("-1");
+    gtk_grid_attach (GTK_GRID (advanced_seek_grid), app->seek_position_label, 3,
+        0, 1, 1);
+    app->seek_duration_label = gtk_label_new ("-1");
+    gtk_grid_attach (GTK_GRID (advanced_seek_grid), app->seek_duration_label, 3,
+        1, 1, 1);
+
+    gtk_container_add (GTK_CONTAINER (advanced_seek), advanced_seek_grid);
+    gtk_grid_attach (GTK_GRID (flagtable), advanced_seek, 0, 3, 3, 2);
+    gtk_container_add (GTK_CONTAINER (seek), flagtable);
+  }
+
+  /* step expander */
+  {
+    GtkWidget *hbox;
+    GtkWidget *step_button, *shuttle_checkbox;
+
+    step = gtk_expander_new ("step options");
+    hbox = gtk_hbox_new (FALSE, 0);
+
+    app->step_format_combo = gtk_combo_box_text_new ();
+    gtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT (app->step_format_combo),
+        "frames");
+    gtk_combo_box_text_append_text (GTK_COMBO_BOX_TEXT (app->step_format_combo),
+        "time (ms)");
+    gtk_combo_box_set_active (GTK_COMBO_BOX (app->step_format_combo), 0);
+    gtk_box_pack_start (GTK_BOX (hbox), app->step_format_combo, FALSE, FALSE,
+        2);
+
+    app->step_amount_spinbutton = gtk_spin_button_new_with_range (1, 1000, 1);
+    gtk_spin_button_set_digits (GTK_SPIN_BUTTON (app->step_amount_spinbutton),
+        0);
+    gtk_spin_button_set_value (GTK_SPIN_BUTTON (app->step_amount_spinbutton),
+        1.0);
+    gtk_box_pack_start (GTK_BOX (hbox), app->step_amount_spinbutton, FALSE,
+        FALSE, 2);
+
+    app->step_rate_spinbutton = gtk_spin_button_new_with_range (0.0, 100, 0.1);
+    gtk_spin_button_set_digits (GTK_SPIN_BUTTON (app->step_rate_spinbutton), 3);
+    gtk_spin_button_set_value (GTK_SPIN_BUTTON (app->step_rate_spinbutton),
+        1.0);
+    gtk_box_pack_start (GTK_BOX (hbox), app->step_rate_spinbutton, FALSE, FALSE,
+        2);
+
+    step_button = gtk_button_new_from_stock (GTK_STOCK_MEDIA_FORWARD);
+    gtk_button_set_label (GTK_BUTTON (step_button), "Step");
+    gtk_box_pack_start (GTK_BOX (hbox), step_button, FALSE, FALSE, 2);
+
+    g_signal_connect (G_OBJECT (step_button), "clicked", G_CALLBACK (step_cb),
+        app);
+
+    /* shuttle scale */
+    shuttle_checkbox = gtk_check_button_new_with_label ("Shuttle");
+    gtk_box_pack_start (GTK_BOX (hbox), shuttle_checkbox, FALSE, FALSE, 2);
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (shuttle_checkbox), FALSE);
+    g_signal_connect (shuttle_checkbox, "toggled", G_CALLBACK (shuttle_toggled),
+        app);
+
+    adjustment =
+        GTK_ADJUSTMENT (gtk_adjustment_new (0.0, -3.00, 4.0, 0.1, 1.0, 1.0));
+    app->shuttle_scale = gtk_hscale_new (adjustment);
+    gtk_scale_set_digits (GTK_SCALE (app->shuttle_scale), 2);
+    gtk_scale_set_value_pos (GTK_SCALE (app->shuttle_scale), GTK_POS_TOP);
+    g_signal_connect (app->shuttle_scale, "value-changed",
+        G_CALLBACK (shuttle_value_changed), app);
+    g_signal_connect (app->shuttle_scale, "format_value",
+        G_CALLBACK (shuttle_format_value), app);
+
+    gtk_box_pack_start (GTK_BOX (hbox), app->shuttle_scale, TRUE, TRUE, 2);
+
+    gtk_container_add (GTK_CONTAINER (step), hbox);
+  }
+
+  /* navigation command expander */
+  {
+    GtkWidget *navigation_button;
+    GtkWidget *grid;
+    gint i = 0;
+
+    navigation = gtk_expander_new ("navigation commands");
+    grid = gtk_grid_new ();
+    gtk_grid_set_row_spacing (GTK_GRID (grid), 2);
+    gtk_grid_set_row_homogeneous (GTK_GRID (grid), FALSE);
+    gtk_grid_set_column_spacing (GTK_GRID (grid), 2);
+    gtk_grid_set_column_homogeneous (GTK_GRID (grid), FALSE);
+
+    navigation_button = gtk_button_new_with_label ("Menu 1");
+    g_signal_connect (G_OBJECT (navigation_button), "clicked",
+        G_CALLBACK (navigation_cmd_cb), app);
+    gtk_grid_attach (GTK_GRID (grid), navigation_button, i, 0, 1, 1);
+    gtk_widget_set_sensitive (navigation_button, FALSE);
+    gtk_widget_set_tooltip_text (navigation_button, "DVD Menu");
+    app->navigation_buttons[i].button = navigation_button;
+    app->navigation_buttons[i++].cmd = GST_NAVIGATION_COMMAND_MENU1;
+
+    navigation_button = gtk_button_new_with_label ("Menu 2");
+    g_signal_connect (G_OBJECT (navigation_button), "clicked",
+        G_CALLBACK (navigation_cmd_cb), app);
+    gtk_grid_attach (GTK_GRID (grid), navigation_button, i, 0, 1, 1);
+    gtk_widget_set_sensitive (navigation_button, FALSE);
+    gtk_widget_set_tooltip_text (navigation_button, "DVD Title Menu");
+    app->navigation_buttons[i].button = navigation_button;
+    app->navigation_buttons[i++].cmd = GST_NAVIGATION_COMMAND_MENU2;
+
+    navigation_button = gtk_button_new_with_label ("Menu 3");
+    g_signal_connect (G_OBJECT (navigation_button), "clicked",
+        G_CALLBACK (navigation_cmd_cb), app);
+    gtk_grid_attach (GTK_GRID (grid), navigation_button, i, 0, 1, 1);
+    gtk_widget_set_sensitive (navigation_button, FALSE);
+    gtk_widget_set_tooltip_text (navigation_button, "DVD Root Menu");
+    app->navigation_buttons[i].button = navigation_button;
+    app->navigation_buttons[i++].cmd = GST_NAVIGATION_COMMAND_MENU3;
+
+    navigation_button = gtk_button_new_with_label ("Menu 4");
+    g_signal_connect (G_OBJECT (navigation_button), "clicked",
+        G_CALLBACK (navigation_cmd_cb), app);
+    gtk_grid_attach (GTK_GRID (grid), navigation_button, i, 0, 1, 1);
+    gtk_widget_set_sensitive (navigation_button, FALSE);
+    gtk_widget_set_tooltip_text (navigation_button, "DVD Subpicture Menu");
+    app->navigation_buttons[i].button = navigation_button;
+    app->navigation_buttons[i++].cmd = GST_NAVIGATION_COMMAND_MENU4;
+
+    navigation_button = gtk_button_new_with_label ("Menu 5");
+    g_signal_connect (G_OBJECT (navigation_button), "clicked",
+        G_CALLBACK (navigation_cmd_cb), app);
+    gtk_grid_attach (GTK_GRID (grid), navigation_button, i, 0, 1, 1);
+    gtk_widget_set_sensitive (navigation_button, FALSE);
+    gtk_widget_set_tooltip_text (navigation_button, "DVD Audio Menu");
+    app->navigation_buttons[i].button = navigation_button;
+    app->navigation_buttons[i++].cmd = GST_NAVIGATION_COMMAND_MENU5;
+
+    navigation_button = gtk_button_new_with_label ("Menu 6");
+    g_signal_connect (G_OBJECT (navigation_button), "clicked",
+        G_CALLBACK (navigation_cmd_cb), app);
+    gtk_grid_attach (GTK_GRID (grid), navigation_button, i, 0, 1, 1);
+    gtk_widget_set_sensitive (navigation_button, FALSE);
+    gtk_widget_set_tooltip_text (navigation_button, "DVD Angle Menu");
+    app->navigation_buttons[i].button = navigation_button;
+    app->navigation_buttons[i++].cmd = GST_NAVIGATION_COMMAND_MENU6;
+
+    navigation_button = gtk_button_new_with_label ("Menu 7");
+    g_signal_connect (G_OBJECT (navigation_button), "clicked",
+        G_CALLBACK (navigation_cmd_cb), app);
+    gtk_grid_attach (GTK_GRID (grid), navigation_button, i, 0, 1, 1);
+    gtk_widget_set_sensitive (navigation_button, FALSE);
+    gtk_widget_set_tooltip_text (navigation_button, "DVD Chapter Menu");
+    app->navigation_buttons[i].button = navigation_button;
+    app->navigation_buttons[i++].cmd = GST_NAVIGATION_COMMAND_MENU7;
+
+    navigation_button = gtk_button_new_with_label ("Left");
+    g_signal_connect (G_OBJECT (navigation_button), "clicked",
+        G_CALLBACK (navigation_cmd_cb), app);
+    gtk_grid_attach (GTK_GRID (grid), navigation_button, i - 7, 1, 1, 1);
+    gtk_widget_set_sensitive (navigation_button, FALSE);
+    app->navigation_buttons[i].button = navigation_button;
+    app->navigation_buttons[i++].cmd = GST_NAVIGATION_COMMAND_LEFT;
+
+    navigation_button = gtk_button_new_with_label ("Right");
+    g_signal_connect (G_OBJECT (navigation_button), "clicked",
+        G_CALLBACK (navigation_cmd_cb), app);
+    gtk_grid_attach (GTK_GRID (grid), navigation_button, i - 7, 1, 1, 1);
+    gtk_widget_set_sensitive (navigation_button, FALSE);
+    app->navigation_buttons[i].button = navigation_button;
+    app->navigation_buttons[i++].cmd = GST_NAVIGATION_COMMAND_RIGHT;
+
+    navigation_button = gtk_button_new_with_label ("Up");
+    g_signal_connect (G_OBJECT (navigation_button), "clicked",
+        G_CALLBACK (navigation_cmd_cb), app);
+    gtk_grid_attach (GTK_GRID (grid), navigation_button, i - 7, 1, 1, 1);
+    gtk_widget_set_sensitive (navigation_button, FALSE);
+    app->navigation_buttons[i].button = navigation_button;
+    app->navigation_buttons[i++].cmd = GST_NAVIGATION_COMMAND_UP;
+
+    navigation_button = gtk_button_new_with_label ("Down");
+    g_signal_connect (G_OBJECT (navigation_button), "clicked",
+        G_CALLBACK (navigation_cmd_cb), app);
+    gtk_grid_attach (GTK_GRID (grid), navigation_button, i - 7, 1, 1, 1);
+    gtk_widget_set_sensitive (navigation_button, FALSE);
+    app->navigation_buttons[i].button = navigation_button;
+    app->navigation_buttons[i++].cmd = GST_NAVIGATION_COMMAND_DOWN;
+
+    navigation_button = gtk_button_new_with_label ("Activate");
+    g_signal_connect (G_OBJECT (navigation_button), "clicked",
+        G_CALLBACK (navigation_cmd_cb), app);
+    gtk_grid_attach (GTK_GRID (grid), navigation_button, i - 7, 1, 1, 1);
+    gtk_widget_set_sensitive (navigation_button, FALSE);
+    app->navigation_buttons[i].button = navigation_button;
+    app->navigation_buttons[i++].cmd = GST_NAVIGATION_COMMAND_ACTIVATE;
+
+    navigation_button = gtk_button_new_with_label ("Prev. Angle");
+    g_signal_connect (G_OBJECT (navigation_button), "clicked",
+        G_CALLBACK (navigation_cmd_cb), app);
+    gtk_grid_attach (GTK_GRID (grid), navigation_button, i - 7, 1, 1, 1);
+    gtk_widget_set_sensitive (navigation_button, FALSE);
+    app->navigation_buttons[i].button = navigation_button;
+    app->navigation_buttons[i++].cmd = GST_NAVIGATION_COMMAND_PREV_ANGLE;
+
+    navigation_button = gtk_button_new_with_label ("Next. Angle");
+    g_signal_connect (G_OBJECT (navigation_button), "clicked",
+        G_CALLBACK (navigation_cmd_cb), app);
+    gtk_grid_attach (GTK_GRID (grid), navigation_button, i - 7, 1, 1, 1);
+    gtk_widget_set_sensitive (navigation_button, FALSE);
+    app->navigation_buttons[i].button = navigation_button;
+    app->navigation_buttons[i++].cmd = GST_NAVIGATION_COMMAND_NEXT_ANGLE;
+
+    gtk_container_add (GTK_CONTAINER (navigation), grid);
+  }
+
+  /* colorbalance expander */
+  {
+    GtkWidget *vbox, *frame;
+
+    colorbalance = gtk_expander_new ("color balance options");
+    vbox = gtk_vbox_new (FALSE, 0);
+
+    /* contrast scale */
+    frame = gtk_frame_new ("Contrast");
+    adjustment =
+        GTK_ADJUSTMENT (gtk_adjustment_new (N_GRAD / 2.0, 0.00, N_GRAD, 0.1,
+            1.0, 1.0));
+    app->contrast_scale = gtk_hscale_new (adjustment);
+    gtk_scale_set_draw_value (GTK_SCALE (app->contrast_scale), FALSE);
+    g_signal_connect (app->contrast_scale, "value-changed",
+        G_CALLBACK (colorbalance_value_changed), app);
+    gtk_container_add (GTK_CONTAINER (frame), app->contrast_scale);
+    gtk_box_pack_start (GTK_BOX (vbox), frame, TRUE, TRUE, 2);
+
+    /* brightness scale */
+    frame = gtk_frame_new ("Brightness");
+    adjustment =
+        GTK_ADJUSTMENT (gtk_adjustment_new (N_GRAD / 2.0, 0.00, N_GRAD, 0.1,
+            1.0, 1.0));
+    app->brightness_scale = gtk_hscale_new (adjustment);
+    gtk_scale_set_draw_value (GTK_SCALE (app->brightness_scale), FALSE);
+    g_signal_connect (app->brightness_scale, "value-changed",
+        G_CALLBACK (colorbalance_value_changed), app);
+    gtk_container_add (GTK_CONTAINER (frame), app->brightness_scale);
+    gtk_box_pack_start (GTK_BOX (vbox), frame, TRUE, TRUE, 2);
+
+    /* hue scale */
+    frame = gtk_frame_new ("Hue");
+    adjustment =
+        GTK_ADJUSTMENT (gtk_adjustment_new (N_GRAD / 2.0, 0.00, N_GRAD, 0.1,
+            1.0, 1.0));
+    app->hue_scale = gtk_hscale_new (adjustment);
+    gtk_scale_set_draw_value (GTK_SCALE (app->hue_scale), FALSE);
+    g_signal_connect (app->hue_scale, "value-changed",
+        G_CALLBACK (colorbalance_value_changed), app);
+    gtk_container_add (GTK_CONTAINER (frame), app->hue_scale);
+    gtk_box_pack_start (GTK_BOX (vbox), frame, TRUE, TRUE, 2);
+
+    /* saturation scale */
+    frame = gtk_frame_new ("Saturation");
+    adjustment =
+        GTK_ADJUSTMENT (gtk_adjustment_new (N_GRAD / 2.0, 0.00, N_GRAD, 0.1,
+            1.0, 1.0));
+    app->saturation_scale = gtk_hscale_new (adjustment);
+    gtk_scale_set_draw_value (GTK_SCALE (app->saturation_scale), FALSE);
+    g_signal_connect (app->saturation_scale, "value-changed",
+        G_CALLBACK (colorbalance_value_changed), app);
+    gtk_container_add (GTK_CONTAINER (frame), app->saturation_scale);
+    gtk_box_pack_start (GTK_BOX (vbox), frame, TRUE, TRUE, 2);
+
+    gtk_container_add (GTK_CONTAINER (colorbalance), vbox);
+  }
+
+  /* seek bar */
+  adjustment =
+      GTK_ADJUSTMENT (gtk_adjustment_new (0.0, 0.00, N_GRAD, 0.1, 1.0, 1.0));
+  app->seek_scale = gtk_hscale_new (adjustment);
+  gtk_scale_set_digits (GTK_SCALE (app->seek_scale), 2);
+  gtk_scale_set_value_pos (GTK_SCALE (app->seek_scale), GTK_POS_RIGHT);
+  gtk_range_set_show_fill_level (GTK_RANGE (app->seek_scale), TRUE);
+  gtk_range_set_fill_level (GTK_RANGE (app->seek_scale), N_GRAD);
+
+  g_signal_connect (app->seek_scale, "button_press_event",
+      G_CALLBACK (start_seek), app);
+  g_signal_connect (app->seek_scale, "button_release_event",
+      G_CALLBACK (stop_seek), app);
+  g_signal_connect (app->seek_scale, "format_value", G_CALLBACK (format_value),
+      app);
+
+  if (app->pipeline_type == 0) {
+    GtkWidget *pb2vbox, *boxes, *boxes2, *panel, *boxes3;
+    GtkWidget *volume_label, *shot_button;
+    GtkWidget *label;
+
+    playbin = gtk_expander_new ("playbin2 options");
+    /* the playbin2 panel controls for the video/audio/subtitle tracks */
+    panel = gtk_hbox_new (FALSE, 0);
+    app->video_combo = gtk_combo_box_text_new ();
+    app->audio_combo = gtk_combo_box_text_new ();
+    app->text_combo = gtk_combo_box_text_new ();
+    gtk_widget_set_sensitive (app->video_combo, FALSE);
+    gtk_widget_set_sensitive (app->audio_combo, FALSE);
+    gtk_widget_set_sensitive (app->text_combo, FALSE);
+    gtk_box_pack_start (GTK_BOX (panel), app->video_combo, TRUE, TRUE, 2);
+    gtk_box_pack_start (GTK_BOX (panel), app->audio_combo, TRUE, TRUE, 2);
+    gtk_box_pack_start (GTK_BOX (panel), app->text_combo, TRUE, TRUE, 2);
+    g_signal_connect (G_OBJECT (app->video_combo), "changed",
+        G_CALLBACK (video_combo_cb), app);
+    g_signal_connect (G_OBJECT (app->audio_combo), "changed",
+        G_CALLBACK (audio_combo_cb), app);
+    g_signal_connect (G_OBJECT (app->text_combo), "changed",
+        G_CALLBACK (text_combo_cb), app);
+    /* playbin2 panel for flag checkboxes and volume/mute */
+    boxes = gtk_grid_new ();
+    gtk_grid_set_row_spacing (GTK_GRID (boxes), 2);
+    gtk_grid_set_row_homogeneous (GTK_GRID (boxes), FALSE);
+    gtk_grid_set_column_spacing (GTK_GRID (boxes), 2);
+    gtk_grid_set_column_homogeneous (GTK_GRID (boxes), FALSE);
+
+    app->video_checkbox = gtk_check_button_new_with_label ("Video");
+    app->audio_checkbox = gtk_check_button_new_with_label ("Audio");
+    app->text_checkbox = gtk_check_button_new_with_label ("Text");
+    app->vis_checkbox = gtk_check_button_new_with_label ("Vis");
+    app->soft_volume_checkbox = gtk_check_button_new_with_label ("Soft Volume");
+    app->native_audio_checkbox =
+        gtk_check_button_new_with_label ("Native Audio");
+    app->native_video_checkbox =
+        gtk_check_button_new_with_label ("Native Video");
+    app->download_checkbox = gtk_check_button_new_with_label ("Download");
+    app->buffering_checkbox = gtk_check_button_new_with_label ("Buffering");
+    app->deinterlace_checkbox = gtk_check_button_new_with_label ("Deinterlace");
+    app->soft_colorbalance_checkbox =
+        gtk_check_button_new_with_label ("Soft Colorbalance");
+    app->mute_checkbox = gtk_check_button_new_with_label ("Mute");
+    volume_label = gtk_label_new ("Volume");
+    app->volume_spinbutton = gtk_spin_button_new_with_range (0, 10.0, 0.1);
+
+    gtk_grid_attach (GTK_GRID (boxes), app->video_checkbox, 0, 0, 1, 1);
+    gtk_grid_attach (GTK_GRID (boxes), app->audio_checkbox, 1, 0, 1, 1);
+    gtk_grid_attach (GTK_GRID (boxes), app->text_checkbox, 2, 0, 1, 1);
+    gtk_grid_attach (GTK_GRID (boxes), app->vis_checkbox, 3, 0, 1, 1);
+    gtk_grid_attach (GTK_GRID (boxes), app->soft_volume_checkbox, 4, 0, 1, 1);
+    gtk_grid_attach (GTK_GRID (boxes), app->native_audio_checkbox, 5, 0, 1, 1);
+    gtk_grid_attach (GTK_GRID (boxes), app->native_video_checkbox, 0, 1, 1, 1);
+    gtk_grid_attach (GTK_GRID (boxes), app->download_checkbox, 1, 1, 1, 1);
+    gtk_grid_attach (GTK_GRID (boxes), app->buffering_checkbox, 2, 1, 1, 1);
+    gtk_grid_attach (GTK_GRID (boxes), app->deinterlace_checkbox, 3, 1, 1, 1);
+    gtk_grid_attach (GTK_GRID (boxes), app->soft_colorbalance_checkbox, 4, 1, 1,
+        1);
+
+    gtk_grid_attach (GTK_GRID (boxes), app->mute_checkbox, 6, 0, 1, 1);
+    gtk_grid_attach (GTK_GRID (boxes), volume_label, 5, 1, 1, 1);
+    gtk_grid_attach (GTK_GRID (boxes), app->volume_spinbutton, 6, 1, 1, 1);
+
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (app->video_checkbox),
+        TRUE);
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (app->audio_checkbox),
+        TRUE);
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (app->text_checkbox), TRUE);
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (app->vis_checkbox), FALSE);
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (app->soft_volume_checkbox),
+        TRUE);
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON
+        (app->native_audio_checkbox), FALSE);
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON
+        (app->native_video_checkbox), FALSE);
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (app->download_checkbox),
+        FALSE);
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (app->buffering_checkbox),
+        FALSE);
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (app->deinterlace_checkbox),
+        FALSE);
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON
+        (app->soft_colorbalance_checkbox), TRUE);
+    gtk_toggle_button_set_active (GTK_TOGGLE_BUTTON (app->mute_checkbox),
+        FALSE);
+    gtk_spin_button_set_value (GTK_SPIN_BUTTON (app->volume_spinbutton), 1.0);
+
+    g_signal_connect (G_OBJECT (app->video_checkbox), "toggled",
+        G_CALLBACK (video_toggle_cb), app);
+    g_signal_connect (G_OBJECT (app->audio_checkbox), "toggled",
+        G_CALLBACK (audio_toggle_cb), app);
+    g_signal_connect (G_OBJECT (app->text_checkbox), "toggled",
+        G_CALLBACK (text_toggle_cb), app);
+    g_signal_connect (G_OBJECT (app->vis_checkbox), "toggled",
+        G_CALLBACK (vis_toggle_cb), app);
+    g_signal_connect (G_OBJECT (app->soft_volume_checkbox), "toggled",
+        G_CALLBACK (soft_volume_toggle_cb), app);
+    g_signal_connect (G_OBJECT (app->native_audio_checkbox), "toggled",
+        G_CALLBACK (native_audio_toggle_cb), app);
+    g_signal_connect (G_OBJECT (app->native_video_checkbox), "toggled",
+        G_CALLBACK (native_video_toggle_cb), app);
+    g_signal_connect (G_OBJECT (app->download_checkbox), "toggled",
+        G_CALLBACK (download_toggle_cb), app);
+    g_signal_connect (G_OBJECT (app->buffering_checkbox), "toggled",
+        G_CALLBACK (buffering_toggle_cb), app);
+    g_signal_connect (G_OBJECT (app->deinterlace_checkbox), "toggled",
+        G_CALLBACK (deinterlace_toggle_cb), app);
+    g_signal_connect (G_OBJECT (app->soft_colorbalance_checkbox), "toggled",
+        G_CALLBACK (soft_colorbalance_toggle_cb), app);
+    g_signal_connect (G_OBJECT (app->mute_checkbox), "toggled",
+        G_CALLBACK (mute_toggle_cb), app);
+    g_signal_connect (G_OBJECT (app->volume_spinbutton), "value-changed",
+        G_CALLBACK (volume_spinbutton_changed_cb), app);
+    /* playbin2 panel for snapshot */
+    boxes2 = gtk_hbox_new (FALSE, 0);
+    shot_button = gtk_button_new_from_stock (GTK_STOCK_SAVE);
+    gtk_widget_set_tooltip_text (shot_button,
+        "save a screenshot .png in the current directory");
+    g_signal_connect (G_OBJECT (shot_button), "clicked", G_CALLBACK (shot_cb),
+        app);
+    app->vis_combo = gtk_combo_box_text_new ();
+    g_signal_connect (G_OBJECT (app->vis_combo), "changed",
+        G_CALLBACK (vis_combo_cb), app);
+    gtk_widget_set_sensitive (app->vis_combo, FALSE);
+    gtk_box_pack_start (GTK_BOX (boxes2), shot_button, TRUE, TRUE, 2);
+    gtk_box_pack_start (GTK_BOX (boxes2), app->vis_combo, TRUE, TRUE, 2);
+
+    /* fill the vis combo box and the array of factories */
+    init_visualization_features (app);
+
+    /* Grid with other properties */
+    boxes3 = gtk_grid_new ();
+    gtk_grid_set_row_spacing (GTK_GRID (boxes3), 2);
+    gtk_grid_set_row_homogeneous (GTK_GRID (boxes3), FALSE);
+    gtk_grid_set_column_spacing (GTK_GRID (boxes3), 2);
+    gtk_grid_set_column_homogeneous (GTK_GRID (boxes3), FALSE);
+
+    label = gtk_label_new ("Video sink");
+    gtk_grid_attach (GTK_GRID (boxes3), label, 0, 0, 1, 1);
+    app->video_sink_entry = gtk_entry_new ();
+    g_signal_connect (app->video_sink_entry, "activate",
+        G_CALLBACK (video_sink_activate_cb), app);
+    gtk_grid_attach (GTK_GRID (boxes3), app->video_sink_entry, 0, 1, 1, 1);
+
+    label = gtk_label_new ("Audio sink");
+    gtk_grid_attach (GTK_GRID (boxes3), label, 1, 0, 1, 1);
+    app->audio_sink_entry = gtk_entry_new ();
+    g_signal_connect (app->audio_sink_entry, "activate",
+        G_CALLBACK (audio_sink_activate_cb), app);
+    gtk_grid_attach (GTK_GRID (boxes3), app->audio_sink_entry, 1, 1, 1, 1);
+
+    label = gtk_label_new ("Text sink");
+    gtk_grid_attach (GTK_GRID (boxes3), label, 2, 0, 1, 1);
+    app->text_sink_entry = gtk_entry_new ();
+    g_signal_connect (app->text_sink_entry, "activate",
+        G_CALLBACK (text_sink_activate_cb), app);
+    gtk_grid_attach (GTK_GRID (boxes3), app->text_sink_entry, 2, 1, 1, 1);
+
+    label = gtk_label_new ("Buffer Size");
+    gtk_grid_attach (GTK_GRID (boxes3), label, 0, 2, 1, 1);
+    app->buffer_size_entry = gtk_entry_new ();
+    gtk_entry_set_text (GTK_ENTRY (app->buffer_size_entry), "-1");
+    g_signal_connect (app->buffer_size_entry, "activate",
+        G_CALLBACK (buffer_size_activate_cb), app);
+    gtk_grid_attach (GTK_GRID (boxes3), app->buffer_size_entry, 0, 3, 1, 1);
+
+    label = gtk_label_new ("Buffer Duration");
+    gtk_grid_attach (GTK_GRID (boxes3), label, 1, 2, 1, 1);
+    app->buffer_duration_entry = gtk_entry_new ();
+    gtk_entry_set_text (GTK_ENTRY (app->buffer_duration_entry), "-1");
+    g_signal_connect (app->buffer_duration_entry, "activate",
+        G_CALLBACK (buffer_duration_activate_cb), app);
+    gtk_grid_attach (GTK_GRID (boxes3), app->buffer_duration_entry, 1, 3, 1, 1);
+
+    label = gtk_label_new ("Ringbuffer Max Size");
+    gtk_grid_attach (GTK_GRID (boxes3), label, 2, 2, 1, 1);
+    app->ringbuffer_maxsize_entry = gtk_entry_new ();
+    gtk_entry_set_text (GTK_ENTRY (app->ringbuffer_maxsize_entry), "0");
+    g_signal_connect (app->ringbuffer_maxsize_entry, "activate",
+        G_CALLBACK (ringbuffer_maxsize_activate_cb), app);
+    gtk_grid_attach (GTK_GRID (boxes3), app->ringbuffer_maxsize_entry, 2, 3, 1,
+        1);
+
+    label = gtk_label_new ("Connection Speed");
+    gtk_grid_attach (GTK_GRID (boxes3), label, 3, 2, 1, 1);
+    app->connection_speed_entry = gtk_entry_new ();
+    gtk_entry_set_text (GTK_ENTRY (app->connection_speed_entry), "0");
+    g_signal_connect (app->connection_speed_entry, "activate",
+        G_CALLBACK (connection_speed_activate_cb), app);
+    gtk_grid_attach (GTK_GRID (boxes3), app->connection_speed_entry, 3, 3, 1,
+        1);
+
+    label = gtk_label_new ("A/V offset");
+    gtk_grid_attach (GTK_GRID (boxes3), label, 4, 2, 1, 1);
+    app->av_offset_entry = gtk_entry_new ();
+    g_signal_connect (app->av_offset_entry, "activate",
+        G_CALLBACK (av_offset_activate_cb), app);
+    gtk_entry_set_text (GTK_ENTRY (app->av_offset_entry), "0");
+    g_signal_connect (app->av_offset_entry, "activate",
+        G_CALLBACK (av_offset_activate_cb), app);
+    gtk_grid_attach (GTK_GRID (boxes3), app->av_offset_entry, 4, 3, 1, 1);
+
+    label = gtk_label_new ("Subtitle Encoding");
+    gtk_grid_attach (GTK_GRID (boxes3), label, 0, 4, 1, 1);
+    app->subtitle_encoding_entry = gtk_entry_new ();
+    g_signal_connect (app->subtitle_encoding_entry, "activate",
+        G_CALLBACK (subtitle_encoding_activate_cb), app);
+    gtk_grid_attach (GTK_GRID (boxes3), app->subtitle_encoding_entry, 0, 5, 1,
+        1);
+
+    label = gtk_label_new ("Subtitle Fontdesc");
+    gtk_grid_attach (GTK_GRID (boxes3), label, 1, 4, 1, 1);
+    app->subtitle_fontdesc_button = gtk_font_button_new ();
+    g_signal_connect (app->subtitle_fontdesc_button, "font-set",
+        G_CALLBACK (subtitle_fontdesc_cb), app);
+    gtk_grid_attach (GTK_GRID (boxes3), app->subtitle_fontdesc_button, 1, 5, 1,
+        1);
+
+    pb2vbox = gtk_vbox_new (FALSE, 0);
+    gtk_box_pack_start (GTK_BOX (pb2vbox), panel, FALSE, FALSE, 2);
+    gtk_box_pack_start (GTK_BOX (pb2vbox), boxes, FALSE, FALSE, 2);
+    gtk_box_pack_start (GTK_BOX (pb2vbox), boxes2, FALSE, FALSE, 2);
+    gtk_box_pack_start (GTK_BOX (pb2vbox), boxes3, FALSE, FALSE, 2);
+    gtk_container_add (GTK_CONTAINER (playbin), pb2vbox);
+  } else {
+    playbin = NULL;
+  }
+
+  /* do the packing stuff ... */
+  gtk_window_set_default_size (GTK_WINDOW (app->window), 250, 96);
+  /* FIXME: can we avoid this for audio only? */
+  gtk_widget_set_size_request (GTK_WIDGET (app->video_window), -1,
+      DEFAULT_VIDEO_HEIGHT);
+  gtk_container_add (GTK_CONTAINER (app->window), vbox);
+  gtk_box_pack_start (GTK_BOX (vbox), app->video_window, TRUE, TRUE, 2);
+  gtk_box_pack_start (GTK_BOX (vbox), hbox, FALSE, FALSE, 2);
+  gtk_box_pack_start (GTK_BOX (hbox), play_button, FALSE, FALSE, 2);
+  gtk_box_pack_start (GTK_BOX (hbox), pause_button, FALSE, FALSE, 2);
+  gtk_box_pack_start (GTK_BOX (hbox), stop_button, FALSE, FALSE, 2);
+
+  gtk_box_pack_start (GTK_BOX (vbox), seek, FALSE, FALSE, 2);
+  if (playbin)
+    gtk_box_pack_start (GTK_BOX (vbox), playbin, FALSE, FALSE, 2);
+  gtk_box_pack_start (GTK_BOX (vbox), step, FALSE, FALSE, 2);
+  gtk_box_pack_start (GTK_BOX (vbox), navigation, FALSE, FALSE, 2);
+  gtk_box_pack_start (GTK_BOX (vbox), colorbalance, FALSE, FALSE, 2);
+  gtk_box_pack_start (GTK_BOX (vbox), gtk_hseparator_new (), FALSE, FALSE, 2);
+  gtk_box_pack_start (GTK_BOX (vbox), app->seek_scale, FALSE, FALSE, 2);
+  gtk_box_pack_start (GTK_BOX (vbox), app->statusbar, FALSE, FALSE, 2);
+
+  /* connect things ... */
+  g_signal_connect (G_OBJECT (play_button), "clicked", G_CALLBACK (play_cb),
+      app);
+  g_signal_connect (G_OBJECT (pause_button), "clicked", G_CALLBACK (pause_cb),
+      app);
+  g_signal_connect (G_OBJECT (stop_button), "clicked", G_CALLBACK (stop_cb),
+      app);
+
+  g_signal_connect (G_OBJECT (app->window), "delete-event",
+      G_CALLBACK (delete_event_cb), app);
+
+  gtk_widget_set_can_default (play_button, TRUE);
+  gtk_widget_grab_default (play_button);
+}
+
+static void
+set_defaults (PlaybackApp * app)
+{
+  memset (app, 0, sizeof (PlaybackApp));
+
+  app->flush_seek = TRUE;
+  app->scrub = TRUE;
+  app->rate = 1.0;
+
+  app->position = app->duration = -1;
+  app->state = GST_STATE_NULL;
+
+  app->need_streams = TRUE;
+
+  g_static_mutex_init (&app->state_mutex);
+
+  app->play_rate = 1.0;
+}
+
+static void
+reset_app (PlaybackApp * app)
+{
+  g_free (app->audiosink_str);
+  g_free (app->videosink_str);
+
+  g_list_free (app->formats);
+
+  g_static_mutex_free (&app->state_mutex);
+
+  if (app->xoverlay_element)
+    gst_object_unref (app->xoverlay_element);
+  if (app->navigation_element)
+    gst_object_unref (app->navigation_element);
+
+  g_list_foreach (app->paths, (GFunc) g_free, NULL);
+  g_list_free (app->paths);
+  g_list_foreach (app->sub_paths, (GFunc) g_free, NULL);
+  g_list_free (app->sub_paths);
+
+  g_print ("free pipeline\n");
+  gst_object_unref (app->pipeline);
+}
+
+int
+main (int argc, char **argv)
+{
+  PlaybackApp app;
+  GOptionEntry options[] = {
+    {"stats", 's', 0, G_OPTION_ARG_NONE, &app.stats,
+        "Show pad stats", NULL},
+    {"verbose", 'v', 0, G_OPTION_ARG_NONE, &app.verbose,
+        "Verbose properties", NULL},
+    {NULL}
+  };
+  GOptionContext *ctx;
+  GError *err = NULL;
+
+  set_defaults (&app);
+
+#if !GLIB_CHECK_VERSION (2, 31, 0)
+  if (!g_thread_supported ())
+    g_thread_init (NULL);
+#endif
+
+  ctx = g_option_context_new ("- playback testing in gsteamer");
+  g_option_context_add_main_entries (ctx, options, NULL);
+  g_option_context_add_group (ctx, gst_init_get_option_group ());
+  g_option_context_add_group (ctx, gtk_get_option_group (TRUE));
+
+  if (!g_option_context_parse (ctx, &argc, &argv, &err)) {
+    g_print ("Error initializing: %s\n", err->message);
+    exit (1);
+  }
+
+  GST_DEBUG_CATEGORY_INIT (playback_debug, "playback-test", 0,
+      "playback example");
+
+  if (argc < 3) {
+    print_usage (argc, argv);
+    exit (-1);
+  }
+
+  app.pipeline_type = atoi (argv[1]);
+
+  if (app.pipeline_type < 0 || app.pipeline_type >= G_N_ELEMENTS (pipelines)) {
+    print_usage (argc, argv);
+    exit (-1);
+  }
+
+  app.pipeline_spec = argv[2];
+
+  if (g_path_is_absolute (app.pipeline_spec) &&
+      (g_strrstr (app.pipeline_spec, "*") != NULL ||
+          g_strrstr (app.pipeline_spec, "?") != NULL)) {
+    app.paths = handle_wildcards (app.pipeline_spec);
+  } else {
+    app.paths = g_list_prepend (app.paths, g_strdup (app.pipeline_spec));
+  }
+
+  if (!app.paths) {
+    g_print ("opening %s failed\n", app.pipeline_spec);
+    exit (-1);
+  }
+
+  app.current_path = app.paths;
+
+  if (argc > 3 && argv[3]) {
+    if (g_path_is_absolute (argv[3]) &&
+        (g_strrstr (argv[3], "*") != NULL ||
+            g_strrstr (argv[3], "?") != NULL)) {
+      app.sub_paths = handle_wildcards (argv[3]);
+    } else {
+      app.sub_paths = g_list_prepend (app.sub_paths, g_strdup (argv[3]));
+    }
+
+    if (!app.sub_paths) {
+      g_print ("opening %s failed\n", argv[3]);
+      exit (-1);
+    }
+
+    app.current_sub_path = app.sub_paths;
+  }
+
+  pipelines[app.pipeline_type].func (&app, app.current_path->data);
+  g_assert (app.pipeline);
+
+  create_ui (&app);
+
+  /* show the gui. */
+  gtk_widget_show_all (app.window);
+
+  /* realize window now so that the video window gets created and we can
+   * obtain its XID before the pipeline is started up and the videosink
+   * asks for the XID of the window to render onto */
+  gtk_widget_realize (app.window);
+
+#if defined (GDK_WINDOWING_X11) || defined (GDK_WINDOWING_WIN32) || defined (GDK_WINDOWING_QUARTZ)
+  /* we should have the XID now */
+  g_assert (app.embed_xid != 0);
+
+  if (app.pipeline_type == 0) {
+    gst_x_overlay_set_window_handle (GST_X_OVERLAY (app.pipeline),
+        app.embed_xid);
+  }
+#endif
+
+  if (app.verbose) {
+    g_signal_connect (app.pipeline, "deep_notify",
+        G_CALLBACK (gst_object_default_deep_notify), NULL);
+  }
+
+  connect_bus_signals (&app);
+
+  gtk_main ();
+
+  g_print ("NULL pipeline\n");
+  gst_element_set_state (app.pipeline, GST_STATE_NULL);
+
+  reset_app (&app);
+
+  return 0;
+}
diff --git a/tests/examples/playrec/Makefile.in b/tests/examples/playrec/Makefile.in
index 5dc9f17..eff1553 100644
--- a/tests/examples/playrec/Makefile.in
+++ b/tests/examples/playrec/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,9 +50,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 noinst_PROGRAMS = playrec$(EXEEXT)
 subdir = tests/examples/playrec
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -89,9 +107,22 @@ playrec_DEPENDENCIES = $(am__DEPENDENCIES_1)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 playrec_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(playrec_CFLAGS) \
 	$(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -104,22 +135,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(playrec_SOURCES)
 DIST_SOURCES = $(playrec_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -411,7 +443,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -563,6 +599,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -704,7 +754,7 @@ uninstall-am:
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-noinstPROGRAMS ctags distclean \
+	clean-libtool clean-noinstPROGRAMS cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
diff --git a/tests/examples/seek/Makefile.am b/tests/examples/seek/Makefile.am
index ae34780..4fe8955 100644
--- a/tests/examples/seek/Makefile.am
+++ b/tests/examples/seek/Makefile.am
@@ -1,8 +1,8 @@
 if HAVE_GTK_X11
 if HAVE_LINUX_JOYSTICK_HEADERS
-GTK_EXAMPLES=seek scrubby jsseek
+GTK_EXAMPLES=scrubby jsseek
 else
-GTK_EXAMPLES=seek scrubby
+GTK_EXAMPLES=scrubby
 endif
 endif
 
diff --git a/tests/examples/seek/Makefile.in b/tests/examples/seek/Makefile.in
index 8e5bee7..7a01392 100644
--- a/tests/examples/seek/Makefile.in
+++ b/tests/examples/seek/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,9 +50,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 noinst_PROGRAMS = $(am__EXEEXT_2)
 subdir = tests/examples/seek
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -81,10 +99,8 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
-@HAVE_GTK_X11_TRUE@@HAVE_LINUX_JOYSTICK_HEADERS_FALSE@am__EXEEXT_1 = seek$(EXEEXT) \
-@HAVE_GTK_X11_TRUE@@HAVE_LINUX_JOYSTICK_HEADERS_FALSE@	scrubby$(EXEEXT)
-@HAVE_GTK_X11_TRUE@@HAVE_LINUX_JOYSTICK_HEADERS_TRUE@am__EXEEXT_1 = seek$(EXEEXT) \
-@HAVE_GTK_X11_TRUE@@HAVE_LINUX_JOYSTICK_HEADERS_TRUE@	scrubby$(EXEEXT) \
+@HAVE_GTK_X11_TRUE@@HAVE_LINUX_JOYSTICK_HEADERS_FALSE@am__EXEEXT_1 = scrubby$(EXEEXT)
+@HAVE_GTK_X11_TRUE@@HAVE_LINUX_JOYSTICK_HEADERS_TRUE@am__EXEEXT_1 = scrubby$(EXEEXT) \
 @HAVE_GTK_X11_TRUE@@HAVE_LINUX_JOYSTICK_HEADERS_TRUE@	jsseek$(EXEEXT)
 am__EXEEXT_2 = $(am__EXEEXT_1) stepping$(EXEEXT) stepping2$(EXEEXT)
 PROGRAMS = $(noinst_PROGRAMS)
@@ -98,18 +114,13 @@ jsseek_DEPENDENCIES = $(top_builddir)/gst-libs/gst/interfaces/libgstinterfaces-@
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 scrubby_SOURCES = scrubby.c
 scrubby_OBJECTS = scrubby.$(OBJEXT)
 scrubby_LDADD = $(LDADD)
 scrubby_DEPENDENCIES = $(top_builddir)/gst-libs/gst/interfaces/libgstinterfaces-@GST_MAJORMINOR@.la \
 	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1)
-seek_SOURCES = seek.c
-seek_OBJECTS = seek.$(OBJEXT)
-seek_LDADD = $(LDADD)
-seek_DEPENDENCIES = $(top_builddir)/gst-libs/gst/interfaces/libgstinterfaces-@GST_MAJORMINOR@.la \
-	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
-	$(am__DEPENDENCIES_1)
 stepping_SOURCES = stepping.c
 stepping_OBJECTS = stepping.$(OBJEXT)
 stepping_LDADD = $(LDADD)
@@ -122,6 +133,18 @@ stepping2_LDADD = $(LDADD)
 stepping2_DEPENDENCIES = $(top_builddir)/gst-libs/gst/interfaces/libgstinterfaces-@GST_MAJORMINOR@.la \
 	$(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
 	$(am__DEPENDENCIES_1)
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -134,22 +157,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
-SOURCES = jsseek.c scrubby.c seek.c stepping.c stepping2.c
-DIST_SOURCES = jsseek.c scrubby.c seek.c stepping.c stepping2.c
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
+SOURCES = jsseek.c scrubby.c stepping.c stepping2.c
+DIST_SOURCES = jsseek.c scrubby.c stepping.c stepping2.c
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -441,12 +465,16 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
-@HAVE_GTK_X11_TRUE@@HAVE_LINUX_JOYSTICK_HEADERS_FALSE@GTK_EXAMPLES = seek scrubby
-@HAVE_GTK_X11_TRUE@@HAVE_LINUX_JOYSTICK_HEADERS_TRUE@GTK_EXAMPLES = seek scrubby jsseek
+@HAVE_GTK_X11_TRUE@@HAVE_LINUX_JOYSTICK_HEADERS_FALSE@GTK_EXAMPLES = scrubby
+@HAVE_GTK_X11_TRUE@@HAVE_LINUX_JOYSTICK_HEADERS_TRUE@GTK_EXAMPLES = scrubby jsseek
 examples = $(GTK_EXAMPLES) stepping stepping2
 LDADD = \
 	$(top_builddir)/gst-libs/gst/interfaces/libgstinterfaces-@GST_MAJORMINOR@.la \
@@ -502,9 +530,6 @@ jsseek$(EXEEXT): $(jsseek_OBJECTS) $(jsseek_DEPENDENCIES) $(EXTRA_jsseek_DEPENDE
 scrubby$(EXEEXT): $(scrubby_OBJECTS) $(scrubby_DEPENDENCIES) $(EXTRA_scrubby_DEPENDENCIES) 
 	@rm -f scrubby$(EXEEXT)
 	$(AM_V_CCLD)$(LINK) $(scrubby_OBJECTS) $(scrubby_LDADD) $(LIBS)
-seek$(EXEEXT): $(seek_OBJECTS) $(seek_DEPENDENCIES) $(EXTRA_seek_DEPENDENCIES) 
-	@rm -f seek$(EXEEXT)
-	$(AM_V_CCLD)$(LINK) $(seek_OBJECTS) $(seek_LDADD) $(LIBS)
 stepping$(EXEEXT): $(stepping_OBJECTS) $(stepping_DEPENDENCIES) $(EXTRA_stepping_DEPENDENCIES) 
 	@rm -f stepping$(EXEEXT)
 	$(AM_V_CCLD)$(LINK) $(stepping_OBJECTS) $(stepping_LDADD) $(LIBS)
@@ -520,7 +545,6 @@ distclean-compile:
 
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/jsseek.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/scrubby.Po@am__quote@
-@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/seek.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/stepping.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/stepping2.Po@am__quote@
 
@@ -600,6 +624,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -741,7 +779,7 @@ uninstall-am:
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-noinstPROGRAMS ctags distclean \
+	clean-libtool clean-noinstPROGRAMS cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
diff --git a/tests/examples/seek/jsseek.c b/tests/examples/seek/jsseek.c
index fd16c54..a2e2ae5 100644
--- a/tests/examples/seek/jsseek.c
+++ b/tests/examples/seek/jsseek.c
@@ -24,6 +24,9 @@
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
+/* FIXME 0.11: suppress warnings for deprecated API such as GStaticRecMutex
+ * with newer GTK versions (>= 3.3.0) */
+#define GDK_DISABLE_DEPRECATION_WARNINGS
 
 #include <glib.h>
 #include <glib/gstdio.h>
diff --git a/tests/examples/seek/scrubby.c b/tests/examples/seek/scrubby.c
index 501d559..53a28d5 100644
--- a/tests/examples/seek/scrubby.c
+++ b/tests/examples/seek/scrubby.c
@@ -1,3 +1,9 @@
+#ifdef HAVE_CONFIG_H
+#include "config.h"
+#endif
+/* FIXME 0.11: suppress warnings for deprecated API such as GStaticRecMutex
+ * with newer GTK versions (>= 3.3.0) */
+#define GDK_DISABLE_DEPRECATION_WARNINGS
 #include <stdlib.h>
 #include <glib.h>
 #include <gtk/gtk.h>
diff --git a/tests/examples/snapshot/Makefile.in b/tests/examples/snapshot/Makefile.in
index cfdc1c0..0d1e0e2 100644
--- a/tests/examples/snapshot/Makefile.in
+++ b/tests/examples/snapshot/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,9 +50,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 noinst_PROGRAMS = $(am__EXEEXT_2)
 subdir = tests/examples/snapshot
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -90,6 +108,19 @@ snapshot_LDADD = $(LDADD)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -102,22 +133,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = snapshot.c
 DIST_SOURCES = snapshot.c
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -409,7 +441,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -547,6 +583,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -688,7 +738,7 @@ uninstall-am:
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-noinstPROGRAMS ctags distclean \
+	clean-libtool clean-noinstPROGRAMS cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
diff --git a/tests/examples/v4l/Makefile.in b/tests/examples/v4l/Makefile.in
index 28a1854..2b039a3 100644
--- a/tests/examples/v4l/Makefile.in
+++ b/tests/examples/v4l/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,9 +50,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 noinst_PROGRAMS = probe$(EXEEXT)
 subdir = tests/examples/v4l
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -88,9 +106,22 @@ probe_LDADD = $(LDADD)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 probe_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(probe_CFLAGS) $(CFLAGS) \
 	$(probe_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -103,22 +134,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(probe_SOURCES)
 DIST_SOURCES = $(probe_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -410,7 +442,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -567,6 +603,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -708,7 +758,7 @@ uninstall-am:
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-noinstPROGRAMS ctags distclean \
+	clean-libtool clean-noinstPROGRAMS cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
diff --git a/tests/examples/v4l/probe.c b/tests/examples/v4l/probe.c
index 435aeac..c29be16 100644
--- a/tests/examples/v4l/probe.c
+++ b/tests/examples/v4l/probe.c
@@ -17,6 +17,10 @@
  * Boston, MA 02111-1307, USA.
  */
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GValueArray
+ * with newer GLib versions (>= 2.31.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+
 #include <stdlib.h>
 #include <gst/gst.h>
 #include <gst/interfaces/propertyprobe.h>
diff --git a/tests/files/Makefile.in b/tests/files/Makefile.in
index 4cc136e..3997a64 100644
--- a/tests/files/Makefile.in
+++ b/tests/files/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -15,6 +14,23 @@
 
 @SET_MAKE@
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -33,6 +49,7 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 subdir = tests/files
 DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
@@ -79,14 +96,25 @@ mkinstalldirs = $(install_sh) -d
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
 CONFIG_CLEAN_VPATH_FILES =
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
 AM_V_GEN = $(am__v_GEN_@AM_V@)
 am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
 AM_V_at = $(am__v_at_@AM_V@)
 am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
 am__v_at_0 = @
+am__v_at_1 = 
 SOURCES =
 DIST_SOURCES =
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
 ACLOCAL = @ACLOCAL@
 ACLOCAL_AMFLAGS = @ACLOCAL_AMFLAGS@
@@ -376,7 +404,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -432,6 +464,8 @@ TAGS:
 ctags: CTAGS
 CTAGS:
 
+cscope cscopelist:
+
 
 distdir: $(DISTFILES)
 	@srcdirstrip=`echo "$(srcdir)" | sed 's/[].[^$$\\*]/\\\\&/g'`; \
diff --git a/tests/icles/Makefile.in b/tests/icles/Makefile.in
index 08d80f2..8dba82f 100644
--- a/tests/icles/Makefile.in
+++ b/tests/icles/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,13 +50,15 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 @HAVE_GTK_X11_TRUE@@USE_X_TRUE@am__append_1 = test-colorkey test-xoverlay
 noinst_PROGRAMS = $(am__EXEEXT_2) $(am__EXEEXT_3) \
 	audio-trickplay$(EXEEXT) playbin-text$(EXEEXT) \
 	position-formats$(EXEEXT) stress-playbin$(EXEEXT) \
 	test-scale$(EXEEXT) test-box$(EXEEXT)
 subdir = tests/icles
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -101,6 +119,7 @@ audio_trickplay_DEPENDENCIES = $(am__DEPENDENCIES_1) \
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 audio_trickplay_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC \
 	$(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=link $(CCLD) \
 	$(audio_trickplay_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) \
@@ -203,6 +222,18 @@ test_xoverlay_OBJECTS = $(am_test_xoverlay_OBJECTS)
 test_xoverlay_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(test_xoverlay_CFLAGS) \
 	$(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -215,20 +246,16 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(audio_trickplay_SOURCES) $(input_selector_test_SOURCES) \
 	$(output_selector_test_SOURCES) $(playbin_text_SOURCES) \
 	$(position_formats_SOURCES) $(stress_playbin_SOURCES) \
@@ -250,6 +277,11 @@ RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
 	install-pdf-recursive install-ps-recursive install-recursive \
 	installcheck-recursive installdirs-recursive pdf-recursive \
 	ps-recursive uninstall-recursive
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 RECURSIVE_CLEAN_TARGETS = mostlyclean-recursive clean-recursive	\
   distclean-recursive maintainer-clean-recursive
 AM_RECURSIVE_TARGETS = $(RECURSIVE_TARGETS:-recursive=) \
@@ -571,7 +603,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -927,12 +963,12 @@ clean-libtool:
 	-rm -rf .libs _libs
 
 # This directory's subdirectories are mostly independent; you can cd
-# into them and run `make' without going through this Makefile.
-# To change the values of `make' variables: instead of editing Makefiles,
-# (1) if the variable is set in `config.status', edit `config.status'
-#     (which will cause the Makefiles to be regenerated when you run `make');
-# (2) otherwise, pass the desired values on the `make' command line.
-$(RECURSIVE_TARGETS):
+# into them and run 'make' without going through this Makefile.
+# To change the values of 'make' variables: instead of editing Makefiles,
+# (1) if the variable is set in 'config.status', edit 'config.status'
+#     (which will cause the Makefiles to be regenerated when you run 'make');
+# (2) otherwise, pass the desired values on the 'make' command line.
+$(RECURSIVE_TARGETS) $(RECURSIVE_CLEAN_TARGETS):
 	@fail= failcom='exit 1'; \
 	for f in x $$MAKEFLAGS; do \
 	  case $$f in \
@@ -942,7 +978,11 @@ $(RECURSIVE_TARGETS):
 	done; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
-	list='$(SUBDIRS)'; for subdir in $$list; do \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	for subdir in $$list; do \
 	  echo "Making $$target in $$subdir"; \
 	  if test "$$subdir" = "."; then \
 	    dot_seen=yes; \
@@ -956,37 +996,6 @@ $(RECURSIVE_TARGETS):
 	if test "$$dot_seen" = "no"; then \
 	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
 	fi; test -z "$$fail"
-
-$(RECURSIVE_CLEAN_TARGETS):
-	@fail= failcom='exit 1'; \
-	for f in x $$MAKEFLAGS; do \
-	  case $$f in \
-	    *=* | --[!k]*);; \
-	    *k*) failcom='fail=yes';; \
-	  esac; \
-	done; \
-	dot_seen=no; \
-	case "$@" in \
-	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
-	  *) list='$(SUBDIRS)' ;; \
-	esac; \
-	rev=''; for subdir in $$list; do \
-	  if test "$$subdir" = "."; then :; else \
-	    rev="$$subdir $$rev"; \
-	  fi; \
-	done; \
-	rev="$$rev ."; \
-	target=`echo $@ | sed s/-recursive//`; \
-	for subdir in $$rev; do \
-	  echo "Making $$target in $$subdir"; \
-	  if test "$$subdir" = "."; then \
-	    local_target="$$target-am"; \
-	  else \
-	    local_target="$$target"; \
-	  fi; \
-	  ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
-	  || eval $$failcom; \
-	done && test -z "$$fail"
 tags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
@@ -995,6 +1004,10 @@ ctags-recursive:
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
 	done
+cscopelist-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || ($(am__cd) $$subdir && $(MAKE) $(AM_MAKEFLAGS) cscopelist); \
+	done
 
 ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
 	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
@@ -1058,6 +1071,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist: cscopelist-recursive $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -1093,13 +1120,10 @@ distdir: $(DISTFILES)
 	done
 	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d "$(distdir)/$$subdir" \
-	    || $(MKDIR_P) "$(distdir)/$$subdir" \
-	    || exit 1; \
-	  fi; \
-	done
-	@list='$(DIST_SUBDIRS)'; for subdir in $$list; do \
-	  if test "$$subdir" = .; then :; else \
+	    $(am__make_dryrun) \
+	      || test -d "$(distdir)/$$subdir" \
+	      || $(MKDIR_P) "$(distdir)/$$subdir" \
+	      || exit 1; \
 	    dir1=$$subdir; dir2="$(distdir)/$$subdir"; \
 	    $(am__relativize); \
 	    new_distdir=$$reldir; \
@@ -1225,23 +1249,24 @@ ps-am:
 
 uninstall-am:
 
-.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) ctags-recursive \
-	install-am install-strip tags-recursive
+.MAKE: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) \
+	cscopelist-recursive ctags-recursive install-am install-strip \
+	tags-recursive
 
 .PHONY: $(RECURSIVE_CLEAN_TARGETS) $(RECURSIVE_TARGETS) CTAGS GTAGS \
 	all all-am check check-am clean clean-generic clean-libtool \
-	clean-noinstPROGRAMS ctags ctags-recursive distclean \
-	distclean-compile distclean-generic distclean-libtool \
-	distclean-tags distdir dvi dvi-am html html-am info info-am \
-	install install-am install-data install-data-am install-dvi \
-	install-dvi-am install-exec install-exec-am install-html \
-	install-html-am install-info install-info-am install-man \
-	install-pdf install-pdf-am install-ps install-ps-am \
-	install-strip installcheck installcheck-am installdirs \
-	installdirs-am maintainer-clean maintainer-clean-generic \
-	mostlyclean mostlyclean-compile mostlyclean-generic \
-	mostlyclean-libtool pdf pdf-am ps ps-am tags tags-recursive \
-	uninstall uninstall-am
+	clean-noinstPROGRAMS cscopelist cscopelist-recursive ctags \
+	ctags-recursive distclean distclean-compile distclean-generic \
+	distclean-libtool distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-dvi install-dvi-am install-exec \
+	install-exec-am install-html install-html-am install-info \
+	install-info-am install-man install-pdf install-pdf-am \
+	install-ps install-ps-am install-strip installcheck \
+	installcheck-am installdirs installdirs-am maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-compile \
+	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
+	tags tags-recursive uninstall uninstall-am
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff --git a/tests/icles/playback/Makefile.in b/tests/icles/playback/Makefile.in
index f670bbc..a888dcd 100644
--- a/tests/icles/playback/Makefile.in
+++ b/tests/icles/playback/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -16,6 +15,23 @@
 @SET_MAKE@
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -34,11 +50,13 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 noinst_PROGRAMS = test$(EXEEXT) decodetest$(EXEEXT) test2$(EXEEXT) \
 	test3$(EXEEXT) test4$(EXEEXT) test5$(EXEEXT) test6$(EXEEXT) \
 	test7$(EXEEXT)
 subdir = tests/icles/playback
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -91,6 +109,7 @@ decodetest_DEPENDENCIES = $(am__DEPENDENCIES_1)
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 decodetest_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(decodetest_CFLAGS) \
 	$(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
@@ -136,6 +155,18 @@ test7_DEPENDENCIES = $(am__DEPENDENCIES_1)
 test7_LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(test7_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -148,24 +179,25 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = decodetest.c test.c test2.c test3.c test4.c test5.c test6.c \
 	test7.c
 DIST_SOURCES = decodetest.c test.c test2.c test3.c test4.c test5.c \
 	test6.c test7.c
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -457,7 +489,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -748,6 +784,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -889,7 +939,7 @@ uninstall-am:
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-libtool clean-noinstPROGRAMS ctags distclean \
+	clean-libtool clean-noinstPROGRAMS cscopelist ctags distclean \
 	distclean-compile distclean-generic distclean-libtool \
 	distclean-tags distdir dvi dvi-am html html-am info info-am \
 	install install-am install-data install-data-am install-dvi \
diff --git a/tests/icles/test-colorkey.c b/tests/icles/test-colorkey.c
index 9d88aec..5ab1c33 100644
--- a/tests/icles/test-colorkey.c
+++ b/tests/icles/test-colorkey.c
@@ -23,6 +23,11 @@
 #include "config.h"
 #endif
 
+/* FIXME 0.11: suppress warnings for deprecated API such as GStaticRecMutex
+ * with newer GTK versions (>= 3.3.0) */
+#define GLIB_DISABLE_DEPRECATION_WARNINGS
+#define GDK_DISABLE_DEPRECATION_WARNINGS
+
 #include <stdlib.h>
 #include <string.h>
 
diff --git a/tests/icles/test-xoverlay.c b/tests/icles/test-xoverlay.c
index c1610b6..c7dcbd3 100644
--- a/tests/icles/test-xoverlay.c
+++ b/tests/icles/test-xoverlay.c
@@ -22,6 +22,9 @@
 #ifdef HAVE_CONFIG_H
 #include "config.h"
 #endif
+/* FIXME 0.11: suppress warnings for deprecated API such as GStaticRecMutex
+ * with newer GTK versions (>= 3.3.0) */
+#define GDK_DISABLE_DEPRECATION_WARNINGS
 
 #include <stdlib.h>
 #include <string.h>
diff --git a/tools/Makefile.in b/tools/Makefile.in
index 4d21dad..78d0f7b 100644
--- a/tools/Makefile.in
+++ b/tools/Makefile.in
@@ -1,9 +1,8 @@
-# Makefile.in generated by automake 1.11.3 from Makefile.am.
+# Makefile.in generated by automake 1.12.6 from Makefile.am.
 # @configure_input@
 
-# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
-# 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 Free Software
-# Foundation, Inc.
+# Copyright (C) 1994-2012 Free Software Foundation, Inc.
+
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -17,6 +16,23 @@
 
 
 VPATH = @srcdir@
+am__make_dryrun = \
+  { \
+    am__dry=no; \
+    case $$MAKEFLAGS in \
+      *\\[\ \	]*) \
+        echo 'am--echo: ; @echo "AM"  OK' | $(MAKE) -f - 2>/dev/null \
+          | grep '^AM OK$$' >/dev/null || am__dry=yes;; \
+      *) \
+        for am__flg in $$MAKEFLAGS; do \
+          case $$am__flg in \
+            *=*|--*) ;; \
+            *n*) am__dry=yes; break;; \
+          esac; \
+        done;; \
+    esac; \
+    test $$am__dry = yes; \
+  }
 pkgdatadir = $(datadir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
@@ -35,9 +51,11 @@ PRE_UNINSTALL = :
 POST_UNINSTALL = :
 build_triplet = @build@
 host_triplet = @host@
+target_triplet = @target@
 bin_PROGRAMS = gst-discoverer-@GST_MAJORMINOR@$(EXEEXT)
 subdir = tools
-DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	$(top_srcdir)/depcomp
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
 am__aclocal_m4_deps = $(top_srcdir)/common/m4/as-ac-expand.m4 \
 	$(top_srcdir)/common/m4/as-auto-alt.m4 \
@@ -96,6 +114,7 @@ gst_discoverer_@GST_MAJORMINOR@_DEPENDENCIES = $(top_builddir)/gst-libs/gst/pbut
 AM_V_lt = $(am__v_lt_@AM_V@)
 am__v_lt_ = $(am__v_lt_@AM_DEFAULT_V@)
 am__v_lt_0 = --silent
+am__v_lt_1 = 
 am__vpath_adj_setup = srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`;
 am__vpath_adj = case $$p in \
     $(srcdir)/*) f=`echo "$$p" | sed "s|^$$srcdirstrip/||"`;; \
@@ -124,6 +143,18 @@ am__uninstall_files_from_dir = { \
          $(am__cd) "$$dir" && rm -f $$files; }; \
   }
 SCRIPTS = $(bin_SCRIPTS)
+AM_V_P = $(am__v_P_@AM_V@)
+am__v_P_ = $(am__v_P_@AM_DEFAULT_V@)
+am__v_P_0 = false
+am__v_P_1 = :
+AM_V_GEN = $(am__v_GEN_@AM_V@)
+am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
+am__v_GEN_0 = @echo "  GEN     " $@;
+am__v_GEN_1 = 
+AM_V_at = $(am__v_at_@AM_V@)
+am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
+am__v_at_0 = @
+am__v_at_1 = 
 DEFAULT_INCLUDES = -I.@am__isrc@ -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -136,22 +167,23 @@ LTCOMPILE = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(AM_CFLAGS) $(CFLAGS)
 AM_V_CC = $(am__v_CC_@AM_V@)
 am__v_CC_ = $(am__v_CC_@AM_DEFAULT_V@)
-am__v_CC_0 = @echo "  CC    " $@;
-AM_V_at = $(am__v_at_@AM_V@)
-am__v_at_ = $(am__v_at_@AM_DEFAULT_V@)
-am__v_at_0 = @
+am__v_CC_0 = @echo "  CC      " $@;
+am__v_CC_1 = 
 CCLD = $(CC)
 LINK = $(LIBTOOL) $(AM_V_lt) --tag=CC $(AM_LIBTOOLFLAGS) \
 	$(LIBTOOLFLAGS) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 AM_V_CCLD = $(am__v_CCLD_@AM_V@)
 am__v_CCLD_ = $(am__v_CCLD_@AM_DEFAULT_V@)
-am__v_CCLD_0 = @echo "  CCLD  " $@;
-AM_V_GEN = $(am__v_GEN_@AM_V@)
-am__v_GEN_ = $(am__v_GEN_@AM_DEFAULT_V@)
-am__v_GEN_0 = @echo "  GEN   " $@;
+am__v_CCLD_0 = @echo "  CCLD    " $@;
+am__v_CCLD_1 = 
 SOURCES = $(gst_discoverer_@GST_MAJORMINOR@_SOURCES)
 DIST_SOURCES = $(gst_discoverer_@GST_MAJORMINOR@_SOURCES)
+am__can_run_installinfo = \
+  case $$AM_UPDATE_INFO_DIR in \
+    n|no|NO) false;; \
+    *) (install-info --version) >/dev/null 2>&1;; \
+  esac
 man1dir = $(mandir)/man1
 NROFF = nroff
 MANS = $(man_MANS)
@@ -446,7 +478,11 @@ sbindir = @sbindir@
 sharedstatedir = @sharedstatedir@
 srcdir = @srcdir@
 sysconfdir = @sysconfdir@
+target = @target@
 target_alias = @target_alias@
+target_cpu = @target_cpu@
+target_os = @target_os@
+target_vendor = @target_vendor@
 top_build_prefix = @top_build_prefix@
 top_builddir = @top_builddir@
 top_srcdir = @top_srcdir@
@@ -502,8 +538,11 @@ $(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
 $(am__aclocal_m4_deps):
 install-binPROGRAMS: $(bin_PROGRAMS)
 	@$(NORMAL_INSTALL)
-	test -z "$(bindir)" || $(MKDIR_P) "$(DESTDIR)$(bindir)"
 	@list='$(bin_PROGRAMS)'; test -n "$(bindir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(bindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(bindir)" || exit 1; \
+	fi; \
 	for p in $$list; do echo "$$p $$p"; done | \
 	sed 's/$(EXEEXT)$$//' | \
 	while read p p1; do if test -f $$p || test -f $$p1; \
@@ -548,8 +587,11 @@ gst-discoverer-@GST_MAJORMINOR@$(EXEEXT): $(gst_discoverer_@GST_MAJORMINOR@_OBJE
 	$(AM_V_CCLD)$(LINK) $(gst_discoverer_@GST_MAJORMINOR@_OBJECTS) $(gst_discoverer_@GST_MAJORMINOR@_LDADD) $(LIBS)
 install-binSCRIPTS: $(bin_SCRIPTS)
 	@$(NORMAL_INSTALL)
-	test -z "$(bindir)" || $(MKDIR_P) "$(DESTDIR)$(bindir)"
 	@list='$(bin_SCRIPTS)'; test -n "$(bindir)" || list=; \
+	if test -n "$$list"; then \
+	  echo " $(MKDIR_P) '$(DESTDIR)$(bindir)'"; \
+	  $(MKDIR_P) "$(DESTDIR)$(bindir)" || exit 1; \
+	fi; \
 	for p in $$list; do \
 	  if test -f "$$p"; then d=; else d="$(srcdir)/"; fi; \
 	  if test -f "$$d$$p"; then echo "$$d$$p"; echo "$$p"; else :; fi; \
@@ -615,11 +657,18 @@ clean-libtool:
 	-rm -rf .libs _libs
 install-man1: $(man_MANS)
 	@$(NORMAL_INSTALL)
-	test -z "$(man1dir)" || $(MKDIR_P) "$(DESTDIR)$(man1dir)"
-	@list=''; test -n "$(man1dir)" || exit 0; \
-	{ for i in $$list; do echo "$$i"; done; \
-	l2='$(man_MANS)'; for i in $$l2; do echo "$$i"; done | \
-	  sed -n '/\.1[a-z]*$$/p'; \
+	@list1=''; \
+	list2='$(man_MANS)'; \
+	test -n "$(man1dir)" \
+	  && test -n "`echo $$list1$$list2`" \
+	  || exit 0; \
+	echo " $(MKDIR_P) '$(DESTDIR)$(man1dir)'"; \
+	$(MKDIR_P) "$(DESTDIR)$(man1dir)" || exit 1; \
+	{ for i in $$list1; do echo "$$i"; done;  \
+	if test -n "$$list2"; then \
+	  for i in $$list2; do echo "$$i"; done \
+	    | sed -n '/\.1[a-z]*$$/p'; \
+	fi; \
 	} | while read p; do \
 	  if test -f $$p; then d=; else d="$(srcdir)/"; fi; \
 	  echo "$$d$$p"; echo "$$p"; \
@@ -699,6 +748,20 @@ GTAGS:
 	  && $(am__cd) $(top_srcdir) \
 	  && gtags -i $(GTAGS_ARGS) "$$here"
 
+cscopelist:  $(HEADERS) $(SOURCES) $(LISP)
+	list='$(SOURCES) $(HEADERS) $(LISP)'; \
+	case "$(srcdir)" in \
+	  [\\/]* | ?:[\\/]*) sdir="$(srcdir)" ;; \
+	  *) sdir=$(subdir)/$(srcdir) ;; \
+	esac; \
+	for i in $$list; do \
+	  if test -f "$$i"; then \
+	    echo "$(subdir)/$$i"; \
+	  else \
+	    echo "$$sdir/$$i"; \
+	  fi; \
+	done >> $(top_builddir)/cscope.files
+
 distclean-tags:
 	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
@@ -709,10 +772,10 @@ distdir: $(DISTFILES)
 	    if test -f "$$d$$p"; then echo "$$d$$p"; else :; fi; done`; \
 	  if test -n "$$list" && \
 	    grep 'ab help2man is required to generate this page' $$list >/dev/null; then \
-	    echo "error: found man pages containing the \`missing help2man' replacement text:" >&2; \
+	    echo "error: found man pages containing the 'missing help2man' replacement text:" >&2; \
 	    grep -l 'ab help2man is required to generate this page' $$list | sed 's/^/         /' >&2; \
 	    echo "       to fix them, install help2man, remove and regenerate the man pages;" >&2; \
-	    echo "       typically \`make maintainer-clean' will remove them" >&2; \
+	    echo "       typically 'make maintainer-clean' will remove them" >&2; \
 	    exit 1; \
 	  else :; fi; \
 	else :; fi
@@ -858,19 +921,20 @@ uninstall-man: uninstall-man1
 .MAKE: install-am install-strip
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-binPROGRAMS \
-	clean-generic clean-libtool ctags distclean distclean-compile \
-	distclean-generic distclean-libtool distclean-tags distdir dvi \
-	dvi-am html html-am info info-am install install-am \
-	install-binPROGRAMS install-binSCRIPTS install-data \
-	install-data-am install-dvi install-dvi-am install-exec \
-	install-exec-am install-html install-html-am install-info \
-	install-info-am install-man install-man1 install-pdf \
-	install-pdf-am install-ps install-ps-am install-strip \
-	installcheck installcheck-am installdirs maintainer-clean \
-	maintainer-clean-generic mostlyclean mostlyclean-compile \
-	mostlyclean-generic mostlyclean-libtool pdf pdf-am ps ps-am \
-	tags uninstall uninstall-am uninstall-binPROGRAMS \
-	uninstall-binSCRIPTS uninstall-man uninstall-man1
+	clean-generic clean-libtool cscopelist ctags distclean \
+	distclean-compile distclean-generic distclean-libtool \
+	distclean-tags distdir dvi dvi-am html html-am info info-am \
+	install install-am install-binPROGRAMS install-binSCRIPTS \
+	install-data install-data-am install-dvi install-dvi-am \
+	install-exec install-exec-am install-html install-html-am \
+	install-info install-info-am install-man install-man1 \
+	install-pdf install-pdf-am install-ps install-ps-am \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-compile mostlyclean-generic mostlyclean-libtool \
+	pdf pdf-am ps ps-am tags uninstall uninstall-am \
+	uninstall-binPROGRAMS uninstall-binSCRIPTS uninstall-man \
+	uninstall-man1
 
 
 # generate versioned scripts from templates
diff --git a/tools/README.filterstamp b/tools/README.filterstamp
new file mode 100644
index 0000000..a7b3d21
--- /dev/null
+++ b/tools/README.filterstamp
@@ -0,0 +1,24 @@
+filterstamp.sh is a script to copy a filter and change filenames and all
+occurrences of the old name to the new name.
+
+This is used for writing new audio filters. The best one to copy for now is
+passthrough; it works on raw/audio int or float data.
+
+If your new filter is called StereoPan, for example, then do this :
+
+cd gst
+../tools/filterstamp.sh Passthrough StereoPan
+cd stereopan
+make
+
+(Please note the upper- and lower-case !)
+
+You should also add a line to configure.ac to make sure the Makefiles are built
+correctly. Just search for "passthrough" and add corresponding "stereopan" (or
+whatever your plugin is) lines.
+
+Register it, then try it out.  It shouldn't do anything !
+
+Now edit the filter.func in the new directory; this file contains the body
+of the main processing loop.
+
diff --git a/tools/filterstamp.sh b/tools/filterstamp.sh
new file mode 100755
index 0000000..56b3d8d
--- /dev/null
+++ b/tools/filterstamp.sh
@@ -0,0 +1,57 @@
+#!/bin/bash
+
+# copies from gstreamer filter boilerplate
+# to new filter
+# changing file names and function references
+
+# thomas@apestaart.org
+
+# modified 23 aug 2001 apwingo@eos.ncsu.edu:
+# conform better to gtk naming conventions (GstFoo->gst_foo in functions, etc)
+
+if [ "$1" = "" ]
+then
+  echo "please specify the filter to copy FROM (e.g. Passthrough)"
+  exit
+fi
+
+if [ "$2" = "" ]
+then
+  echo "please specify the filter to copy TO (e.g. NewFilter)"
+  exit
+fi
+
+FROM=$1
+TO=$2
+FROM_LC=`echo $FROM | tr [A-Z] [a-z]`
+TO_LC=`echo $TO | tr [A-Z] [a-z]`
+FROM_UC=`echo $FROM | tr [a-z] [A-Z]`
+TO_UC=`echo $TO | tr [a-z] [A-Z]`
+FROM_LC_UNDERSCORE=`echo $FROM | perl -n -p -e 's/([a-z])([A-Z])/$1_$2/g; tr/A-Z/a-z/'`
+TO_LC_UNDERSCORE=`echo $TO | perl -n -p -e 's/([a-z])([A-Z])/$1_$2/g; tr/A-Z/a-z/'`
+
+echo "Copying filter boilerplate $FROM to new filter $TO..."
+
+if [ ! -d $FROM_LC ]
+then
+  echo "Filter directory $FROM_LC does not exist !"
+  exit
+fi
+
+if [ -d $TO_LC ]
+then
+  echo "Filter directory $TO_LC already exists !"
+  exit
+fi
+
+cp  -r $FROM_LC $TO_LC
+
+cd $TO_LC
+
+for a in *$FROM_LC*; do mv $a `echo $a | sed s/$FROM_LC/$TO_LC/g`; done
+
+perl -i -p -e "s/$FROM/$TO/g" *
+perl -i -p -e "s/${FROM_LC_UNDERSCORE}_/${TO_LC_UNDERSCORE}_/g" *
+perl -i -p -e "s/$FROM_LC/$TO_LC/g" *
+perl -i -p -e "s/$FROM_UC/$TO_UC/g" *
+
diff --git a/tools/gst-launch-ext.1.in b/tools/gst-launch-ext.1.in
new file mode 100644
index 0000000..ada7380
--- /dev/null
+++ b/tools/gst-launch-ext.1.in
@@ -0,0 +1,42 @@
+.TH "GStreamer" "1" "February 2002" "" ""
+.SH "NAME"
+gst\-launch\-ext \- Run a predefined GStreamer pipeline
+.SH "SYNOPSIS"
+\fBgst\-launch\-ext\fR \fIfilename [filename...]\fR
+.SH "DESCRIPTION"
+.LP 
+\fIgst\-launch\-ext\fP is a tool that is used to run a basic predefined 
+\fIGStreamer\fP pipeline.  This application is only used as a quick test to 
+ensure proper working of codecs and GStreamer.  It doesn't handle more advanced
+features like synchronisation.
+
+All supported formats in GStreamer should be playable by simply typing:
+
+ gst\-launch\-ext filename
+
+It will also print out the pipeline it uses, so you can customize it using
+cut and paste.
+
+.SH "CONFIGURATION"
+.LP 
+\fIgst\-launch\-ext\fP can be configured by creating a .gst file in your
+home directory.  This is a perl-style configuration file and can override
+the defaults for audio and video output sinks.
+
+Here is an example .gst file that implements the same defaults as hard-coded
+in the script :
+
+AUDIOSINK = osssink
+VIDEOSINK = ffmpegcolorspace ! xvimagesink
+
+You can change osssink to esdsink or alsasink (if you have
+the plug-in), and you can change xvimagesink to ximagesink, aasink
+or sdlvideosink.
+
+Other plug-ins might be used as well if GStreamer has them.
+
+.SH "SEE ALSO"
+.BR gst\-inspect (1),
+.BR gst\-launch (1),
+.SH "AUTHOR"
+The GStreamer team at http://gstreamer.net/
diff --git a/win32/common/config.h-new b/win32/common/config.h-new
new file mode 100644
index 0000000..b463ba7
--- /dev/null
+++ b/win32/common/config.h-new
@@ -0,0 +1,436 @@
+/* Autogenerated config.h created for win32 Visual Studio builds */
+
+/* PREFIX -- specifically added for Windows for easier moving */
+#define PREFIX "C:\\gstreamer"
+
+/* Define if building universal (internal helper macro) */
+#undef AC_APPLE_UNIVERSAL_BUILD
+
+/* The implementation that should be used for integer audio resampling witll
+   be benchmarked at runtime */
+#undef AUDIORESAMPLE_FORMAT_AUTO
+
+/* The float implementation should be used for integer audio resampling */
+#undef AUDIORESAMPLE_FORMAT_FLOAT
+
+/* The int implementation should be used for integer audio resampling */
+#undef AUDIORESAMPLE_FORMAT_INT
+
+/* defined if cdda headers are in a cdda/ directory */
+#undef CDPARANOIA_HEADERS_IN_DIR
+
+/* Default audio sink */
+#define DEFAULT_AUDIOSINK "directsoundsink"
+
+/* Default audio source */
+#undef DEFAULT_AUDIOSRC
+
+/* Default video sink */
+#define DEFAULT_VIDEOSINK "directdrawsink"
+
+/* Default video source */
+#undef DEFAULT_VIDEOSRC
+
+/* Default visualizer */
+#define DEFAULT_VISUALIZER "goom"
+
+/* Disable Orc */
+#undef DISABLE_ORC
+
+/* Define to 1 if translation of program messages to the user's native
+   language is requested. */
+#undef ENABLE_NLS
+
+/* gettext package name */
+#define GETTEXT_PACKAGE "gst-plugins-base-0.10"
+
+/* The GIO library directory. */
+#undef GIO_LIBDIR
+
+/* The GIO modules directory. */
+#undef GIO_MODULE_DIR
+
+/* The GnomeVFS modules directory. */
+#undef GNOME_VFS_MODULES_DIR
+
+/* system wide data directory */
+#define GST_DATADIR PREFIX "\\share"
+
+/* Extra platform specific plugin suffix */
+#undef GST_EXTRA_MODULE_SUFFIX
+
+/* macro to use to show function name */
+#undef GST_FUNCTION
+
+/* Defined if gcov is enabled to force a rebuild due to config.h changing */
+#undef GST_GCOV_ENABLED
+
+/* Defined when registry scanning through fork is unsafe */
+#undef GST_HAVE_UNSAFE_FORK
+
+/* plugin install helper script */
+#define GST_INSTALL_PLUGINS_HELPER PREFIX "\\libexec\\gst-install-plugins-helper.exe"
+
+/* Default errorlevel to use */
+#define GST_LEVEL_DEFAULT GST_LEVEL_ERROR
+
+/* GStreamer license */
+#define GST_LICENSE "LGPL"
+
+/* major/minor version */
+#define GST_MAJORMINOR "0.10"
+
+/* package name in plugins */
+#define GST_PACKAGE_NAME "GStreamer Base Plug-ins git"
+
+/* package origin */
+#define GST_PACKAGE_ORIGIN "Unknown package origin"
+
+/* GStreamer package release date/time for plugins as YYYY-MM-DD */
+#define GST_PACKAGE_RELEASE_DATETIME "2013-04-11T08:48Z"
+
+/* I know the API is subject to change. */
+#undef G_UDEV_API_IS_SUBJECT_TO_CHANGE
+
+/* Define to enable ALSA (used by alsa). */
+#undef HAVE_ALSA
+
+/* Define to enable CDParanoia (used by cdparanoia). */
+#undef HAVE_CDPARANOIA
+
+/* Define to 1 if you have the MacOS X function CFLocaleCopyCurrent in the
+   CoreFoundation framework. */
+#undef HAVE_CFLOCALECOPYCURRENT
+
+/* Define to 1 if you have the MacOS X function CFPreferencesCopyAppValue in
+   the CoreFoundation framework. */
+#undef HAVE_CFPREFERENCESCOPYAPPVALUE
+
+/* Define if the target CPU is an Alpha */
+#undef HAVE_CPU_ALPHA
+
+/* Define if the target CPU is an ARM */
+#undef HAVE_CPU_ARM
+
+/* Define if the target CPU is a CRIS */
+#undef HAVE_CPU_CRIS
+
+/* Define if the target CPU is a CRISv32 */
+#undef HAVE_CPU_CRISV32
+
+/* Define if the target CPU is a HPPA */
+#undef HAVE_CPU_HPPA
+
+/* Define if the target CPU is an x86 */
+#define HAVE_CPU_I386 1
+
+/* Define if the target CPU is a IA64 */
+#undef HAVE_CPU_IA64
+
+/* Define if the target CPU is a M68K */
+#undef HAVE_CPU_M68K
+
+/* Define if the target CPU is a MIPS */
+#undef HAVE_CPU_MIPS
+
+/* Define if the target CPU is a PowerPC */
+#undef HAVE_CPU_PPC
+
+/* Define if the target CPU is a 64 bit PowerPC */
+#undef HAVE_CPU_PPC64
+
+/* Define if the target CPU is a S390 */
+#undef HAVE_CPU_S390
+
+/* Define if the target CPU is a SPARC */
+#undef HAVE_CPU_SPARC
+
+/* Define if the target CPU is a x86_64 */
+#undef HAVE_CPU_X86_64
+
+/* Define if the GNU dcgettext() function is already present or preinstalled.
+   */
+#undef HAVE_DCGETTEXT
+
+/* Define to 1 if you have the <dlfcn.h> header file. */
+#undef HAVE_DLFCN_H
+
+/* Define to 1 if you have the <emmintrin.h> header file. */
+#undef HAVE_EMMINTRIN_H
+
+/* Define to enable building of experimental plug-ins. */
+#undef HAVE_EXPERIMENTAL
+
+/* Define to enable building of plug-ins with external deps. */
+#undef HAVE_EXTERNAL
+
+/* FIONREAD ioctl found in sys/filio.h */
+#undef HAVE_FIONREAD_IN_SYS_FILIO
+
+/* FIONREAD ioctl found in sys/ioclt.h */
+#undef HAVE_FIONREAD_IN_SYS_IOCTL
+
+/* Define to 1 if fseeko (and presumably ftello) exists and is declared. */
+#undef HAVE_FSEEKO
+
+/* defined if the compiler implements __func__ */
+#undef HAVE_FUNC
+
+/* defined if the compiler implements __FUNCTION__ */
+#undef HAVE_FUNCTION
+
+/* Define if the GNU gettext() function is already present or preinstalled. */
+#undef HAVE_GETTEXT
+
+/* Define to enable GIO library (used by gio). */
+#undef HAVE_GIO
+
+/* Define to 1 if you have the `gmtime_r' function. */
+#undef HAVE_GMTIME_R
+
+/* Define to enable GNOME VFS (used by gnomevfs). */
+#undef HAVE_GNOME_VFS
+
+/* Define to enable Video 4 Linux (used by video4linux). */
+#undef HAVE_GST_V4L
+
+/* Whether gudev is available for device detection */
+#undef HAVE_GUDEV
+
+/* Define if you have the iconv() function and it works. */
+#undef HAVE_ICONV
+
+/* Define to 1 if you have the <inttypes.h> header file. */
+#undef HAVE_INTTYPES_H
+
+/* make use of iso-codes for ISO-639 */
+#undef HAVE_ISO_CODES
+
+/* Define to enable integer vorbis plug-in (used by ivorbisdec). */
+#undef HAVE_IVORBIS
+
+/* Define to 1 if you have the `asound' library (-lasound). */
+#undef HAVE_LIBASOUND
+
+/* Define to 1 if you have the `nsl' library (-lnsl). */
+#undef HAVE_LIBNSL
+
+/* Define to 1 if you have the `resolv' library (-lresolv). */
+#undef HAVE_LIBRESOLV
+
+/* Define to 1 if you have the `socket' library (-lsocket). */
+#undef HAVE_LIBSOCKET
+
+/* Define to enable libvisual visualization library (used by libvisual). */
+#undef HAVE_LIBVISUAL
+
+/* Define to 1 if you have the `localtime_r' function. */
+#undef HAVE_LOCALTIME_R
+
+/* Define to 1 if you have the `log2' function. */
+#undef HAVE_LOG2
+
+/* Define if you have C99's lrint function. */
+#undef HAVE_LRINT
+
+/* Define if you have C99's lrintf function. */
+#undef HAVE_LRINTF
+
+/* Define to 1 if you have the <malloc.h> header file. */
+#undef HAVE_MALLOC_H
+
+/* Define to 1 if you have the <memory.h> header file. */
+#undef HAVE_MEMORY_H
+
+/* Define to enable Xiph Ogg library (used by ogg). */
+#undef HAVE_OGG
+
+/* Use Orc */
+#undef HAVE_ORC
+
+/* Defined if compiling for OSX */
+#undef HAVE_OSX
+
+/* Define to enable Pango font rendering (used by pango). */
+#undef HAVE_PANGO
+
+/* defined if the compiler implements __PRETTY_FUNCTION__ */
+#undef HAVE_PRETTY_FUNCTION
+
+/* Define to 1 if you have the <process.h> header file. */
+#define HAVE_PROCESS_H 1
+
+/* Define if RDTSC is available */
+#undef HAVE_RDTSC
+
+/* Define to 1 if you have the <stdint.h> header file. */
+#undef HAVE_STDINT_H
+
+/* Define to 1 if you have the <stdlib.h> header file. */
+#define HAVE_STDLIB_H 1
+
+/* Define to 1 if you have the <strings.h> header file. */
+#undef HAVE_STRINGS_H
+
+/* Define to 1 if you have the <string.h> header file. */
+#define HAVE_STRING_H 1
+
+/* Define to 1 if you have the <sys/socket.h> header file. */
+#undef HAVE_SYS_SOCKET_H
+
+/* Define to 1 if you have the <sys/stat.h> header file. */
+#define HAVE_SYS_STAT_H 1
+
+/* Define to 1 if you have the <sys/types.h> header file. */
+#define HAVE_SYS_TYPES_H 1
+
+/* Define to 1 if you have the <sys/wait.h> header file. */
+#undef HAVE_SYS_WAIT_H
+
+/* Define to enable Xiph Theora video codec (used by theora). */
+#undef HAVE_THEORA
+
+/* Define to 1 if you have the <unistd.h> header file. */
+#undef HAVE_UNISTD_H
+
+/* Define if valgrind should be used */
+#undef HAVE_VALGRIND
+
+/* Define to enable Xiph Vorbis audio codec (used by vorbis). */
+#undef HAVE_VORBIS
+
+/* defined if vorbis_synthesis_restart is present */
+#undef HAVE_VORBIS_SYNTHESIS_RESTART
+
+/* Defined if compiling for Windows */
+#define HAVE_WIN32 1
+
+/* Define to 1 if you have the <winsock2.h> header file. */
+#define HAVE_WINSOCK2_H 1
+
+/* Define to enable X libraries and plugins (used by ximagesink). */
+#undef HAVE_X
+
+/* Define to 1 if you have the <xmmintrin.h> header file. */
+#undef HAVE_XMMINTRIN_H
+
+/* Define to enable X Shared Memory extension. */
+#undef HAVE_XSHM
+
+/* Define to enable X11 XVideo extensions (used by xvimagesink). */
+#undef HAVE_XVIDEO
+
+/* Define to enable zlib support for ID3 parsing in libgsttag. */
+#undef HAVE_ZLIB
+
+/* the host CPU */
+#define HOST_CPU "i686"
+
+/* prefix */
+#undef ISO_CODES_PREFIX
+
+/* */
+#undef ISO_CODES_VERSION
+
+/* directory in which the detected libvisual's plugins are located */
+#undef LIBVISUAL_PLUGINSBASEDIR
+
+/* gettext locale dir */
+#define LOCALEDIR PREFIX "\\share\\locale"
+
+/* Define to the sub-directory in which libtool stores uninstalled libraries.
+   */
+#undef LT_OBJDIR
+
+/* Define if you have no native hstrerror() function. */
+#undef NO_HSTRERROR
+
+/* Define to 1 if your C compiler doesn't accept -c and -o together. */
+#undef NO_MINUS_C_MINUS_O
+
+/* Name of package */
+#define PACKAGE "gst-plugins-base"
+
+/* Define to the address where bug reports for this package should be sent. */
+#define PACKAGE_BUGREPORT "http://bugzilla.gnome.org/enter_bug.cgi?product=GStreamer"
+
+/* Define to the full name of this package. */
+#define PACKAGE_NAME "GStreamer Base Plug-ins"
+
+/* Define to the full name and version of this package. */
+#define PACKAGE_STRING "GStreamer Base Plug-ins 0.10.36.1"
+
+/* Define to the one symbol short name of this package. */
+#define PACKAGE_TARNAME "gst-plugins-base"
+
+/* Define to the home page for this package. */
+#undef PACKAGE_URL
+
+/* Define to the version of this package. */
+#define PACKAGE_VERSION "0.10.36.1"
+
+/* directory where plugins are located */
+#ifdef _DEBUG
+#  define PLUGINDIR PREFIX "\\debug\\lib\\gstreamer-0.10"
+#else
+#  define PLUGINDIR PREFIX "\\lib\\gstreamer-0.10"
+#endif
+
+/* The size of `char', as computed by sizeof. */
+#undef SIZEOF_CHAR
+
+/* The size of `int', as computed by sizeof. */
+#undef SIZEOF_INT
+
+/* The size of `long', as computed by sizeof. */
+#undef SIZEOF_LONG
+
+/* The size of `short', as computed by sizeof. */
+#undef SIZEOF_SHORT
+
+/* The size of `void*', as computed by sizeof. */
+#undef SIZEOF_VOIDP
+
+/* Define to 1 if you have the ANSI C header files. */
+#undef STDC_HEADERS
+
+/* the target CPU */
+#undef TARGET_CPU
+
+/* "Define if building for android" */
+#undef USE_TREMOLO
+
+/* Version number of package */
+#define VERSION "0.10.36.1"
+
+/* Define WORDS_BIGENDIAN to 1 if your processor stores words with the most
+   significant byte first (like Motorola and SPARC, unlike Intel). */
+#if defined AC_APPLE_UNIVERSAL_BUILD
+# if defined __BIG_ENDIAN__
+#  define WORDS_BIGENDIAN 1
+# endif
+#else
+# ifndef WORDS_BIGENDIAN
+#  undef WORDS_BIGENDIAN
+# endif
+#endif
+
+/* Define to 1 if the X Window System is missing or not being used. */
+#undef X_DISPLAY_MISSING
+
+/* Enable large inode numbers on Mac OS X 10.5.  */
+#ifndef _DARWIN_USE_64_BIT_INODE
+# define _DARWIN_USE_64_BIT_INODE 1
+#endif
+
+/* Number of bits in a file offset, on hosts where this is settable. */
+#undef _FILE_OFFSET_BITS
+
+/* Define to 1 to make fseeko visible on some hosts (e.g. glibc 2.2). */
+#undef _LARGEFILE_SOURCE
+
+/* Define for large files, on AIX-style hosts. */
+#undef _LARGE_FILES
+
+/* We need at least WinXP SP2 for __stat64 */
+#undef __MSVCRT_VERSION__
-- 
1.8.1.4


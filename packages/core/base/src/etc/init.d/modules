#!/bin/sh

if [ ! -f /etc/modules ]; then
	exit 0
fi

if [ ! -f /lib/modules/`uname -r`/modules.dep ]; then
	echo -n 'Generating module dependencies ... '
	/sbin/depmod
	echo 'done'
fi

echo 'Loading modules ...'

/bin/cat /etc/modules | /bin/grep -v '^#' | /bin/grep -v '^$' |
(
	read module
	while [ "x$module" != "x" ]; do
		echo -n "  $module ... "
		if /sbin/modprobe "$module"; then
			echo 'done'
		else
			echo 'failed'
		fi
		read module
	done
)

echo done


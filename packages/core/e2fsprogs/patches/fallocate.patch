From e8b84a7e506aeb06488df43970119d3328e44540 Mon Sep 17 00:00:00 2001
From: Khem Raj <raj.khem@gmail.com>
Date: Tue, 31 Jan 2012 12:37:19 +0100
Subject: [PATCH] Use fallocate() only if it is available.

We assume that fallocate is supported somehow but we need to check if we
have fallocate() this problem shows up on uclibc systems since uclibc
does not have fallocate() implemented.

Signed-off-by: Khem Raj <raj.khem@gmail.com>
---
 lib/ext2fs/unix_io.c |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git a/lib/ext2fs/unix_io.c b/lib/ext2fs/unix_io.c
index 5337022..3de3830 100644
--- a/lib/ext2fs/unix_io.c
+++ b/lib/ext2fs/unix_io.c
@@ -895,7 +895,7 @@ static errcode_t unix_discard(io_channel channel, unsigned long long block,
 		goto unimplemented;
 #endif
 	} else {
-#ifdef FALLOC_FL_PUNCH_HOLE
+#if defined(FALLOC_FL_PUNCH_HOLE) && defined(HAVE_FALLOCATE)
 		/*
 		 * If we are not on block device, try to use punch hole
 		 * to reclaim free space.
-- 
1.7.9


#!/bin/sh -e

PREREQS=""

prereqs() { echo "$PREREQS"; }

case "$1" in
	prereqs)
		prereqs
		exit 0
		;;
esac

root_mp=/root
cmdline=`cat $root_mp/proc/cmdline`
ro='n'

for arg in $cmdline; do
	case $arg in
		ro | remount-ro)
			ro='y'
			;;

		*)
			;;
	esac
done

if [ "x$ro" = "xy" ]; then
	# mount /tmp filesystem
	echo -n "Mounting /tmp ... "
	mount -o rw,mode=1777,nodev,noexec,nosuid,size=256K -t tmpfs overflow "$root_mp/tmp"
	echo "done"

	# mount /var/lock filesystem
	echo -n "Mounting /var/lock ... "
	mount -o mode=1777,nodev,noexec,nosuid,size=256K -t tmpfs varlock "$root_mp/var/lock"
	echo "done"

	# mount /var/log filesystem
	echo -n "Mounting /var/log ... "
	mount -o mode=0644,size=256K -t tmpfs varlog "$root_mp/var/log"
	echo "done"

	# mount /var/run filesystem
	echo -n "Mounting /var/run ... "
	mount -o mode=0755,nosuid,size=256K -t tmpfs varrun "$root_mp/var/run"
	echo "done"

	# recreate part of the /var/log hierarchy
	touch "$root_mp/var/log/dmesg"
	mkdir "$root_mp/var/log/news"
fi

